<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
	<title>SmartFilterBar Accessibility Test Page</title>

	<script id='sap-ui-bootstrap'
		src="../../../../../../resources/sap-ui-core.js"
		data-sap-ui-async='true'
		data-sap-ui-compat-version='edge'
		data-sap-ui-flexibility-services = '[{"connector": "SessionStorageConnector"}]'
		data-sap-ui-libs='sap.m, sap.ui.comp, sap.ui.fl'
		data-sap-ui-resource-roots='{
			"qunit.internal.acc": "../../../../../../test-resources/sap/ui/core/qunit/internal/acc"
		}'
	></script>

	<script id="mainView" type="text/xml">
		<mvc:View xmlns="sap.m"
			xmlns:f="sap.f"
			xmlns:mvc="sap.ui.core.mvc"
			xmlns:smartFilterBar="sap.ui.comp.smartfilterbar"
			xmlns:smartTable="sap.ui.comp.smarttable"
			xmlns:customData="http://schemas.sap.com/sapui5/extension/sap.ui.core.CustomData/1"
			controllerName="View.controller" height="100%">
			<f:DynamicPage id="dynamicPage" fitContent="true">
				<f:header>
						<f:DynamicPageHeader>
						<smartFilterBar:SmartFilterBar
							id="smartFilterBar"
							entitySet="CompanyItemsSet"

							persistencyKey="UniqueAndStablePersistencyKey1"
							enableBasicSearch="true"
							basicSearchFieldName="CompanyCode">
								<smartFilterBar:controlConfiguration>
									<smartFilterBar:ControlConfiguration key="DateInterval">
											<smartFilterBar:defaultFilterValues>
												<smartFilterBar:SelectOption low="2018-12-24" high="2018-12-26">
												</smartFilterBar:SelectOption>
											</smartFilterBar:defaultFilterValues>
									</smartFilterBar:ControlConfiguration>
									<smartFilterBar:ControlConfiguration
											key="SemanticDate"
											conditionType="{
												module: 'sap.ui.comp.config.condition.DateRangeType',
												defaultOperation: 'TODAYFROMTO',
												values:[5,6]
											}"
									/>
								</smartFilterBar:controlConfiguration>
						</smartFilterBar:SmartFilterBar>

						<smartTable:SmartTable
							id="smartTable"
							entitySet="CompanyItemsSet"
							smartFilterId="smartFilterBar"
							tableType="Table"
							enableAutoBinding="true"
							useVariantManagement="true"
							useTablePersonalisation="true"
							header="Company Items"
							showRowCount="true"
							initiallyVisibleFields="DateInterval,CompanyCode,CompanyName,Email,Street,Country">
								<smartTable:layoutData>
									<FlexItemData growFactor="1"/>
								</smartTable:layoutData>
						</smartTable:SmartTable>
					</f:DynamicPageHeader>
				</f:header>
			</f:DynamicPage>

		</mvc:View>
		</script>
		<script id="dataSectionCompanyCode" type="text/json">
			{"d": {
				"__count": "2",
				"results": [
					{
						"__metadata": {
							"uri": "testService.CompanyCodeVH/CompanyCodeVH('0001')",
							"type": "AccessibilityNamespace.CompanyCodeVH"
						},
						"CompanyCode": "0001",
						"CompanyName": "Grandma Kelly's Homestead"
					},
					{
						"__metadata": {
							"uri": "testService.CompanyCodeVH/CompanyCodeVH('0002')",
							"type": "AccessibilityNamespace.CompanyCodeVH"
						},
						"CompanyCode": "0002",
						"CompanyName": "New England Seafood Cannery"
					}
				]
			}}
		</script>
		<script id="dataSection" type="text/json">
			{"d": {
				"__count": "2",
				"results": [
				{
					"__metadata": {
						"uri": "testService.CompanyItemsSet/CompanyItemsSet('0001')",
						"type": "AccessibilityNamespace.CompanyItemsSet"
					},
					"CompanyCode": "0001",
					"CompanyName": "SAP SE",
					"Email": "gatesfernandez@quintity.com",
					"Phone": "+1 (826) 451-3236",
					"Street": "River Street 835",
					"City": "Veguita",
					"Country": "Cocos (Keeling Islands)",
					"CurrencyCode": "EUR",
					"BoolCode": true,
					"DateInterval": "/Date(1737838336000)/",
					"SemanticDate": "/Date(1737838336000)/"
				}
			]
			}}
		</script>
		<script id="metadata" type="text/xml"><?xml version="1.0" encoding="utf-8"?>
			<edmx:Edmx xmlns:edmx="http://schemas.microsoft.com/ado/2007/06/edmx"
					   xmlns:m="http://schemas.microsoft.com/ado/2007/08/dataservices/metadata"
					   xmlns:sap="http://www.sap.com/Protocols/SAPData" Version="1.0">

				<edmx:DataServices m:DataServiceVersion="2.0">
					<Schema xmlns="http://schemas.microsoft.com/ado/2008/09/edm"
							Namespace="AccessibilityNamespace"
							xml:lang="en"
							sap:schema-version="1">

							<EntityType Name="CompanyItemsType" sap:label="Company Item" sap:semantics="aggregate" sap:content-version="1">
								<Key>
									<PropertyRef Name="CompanyCode" />
								</Key>
								<Property Name="CompanyCode" Type="Edm.String" Nullable="false"
								MaxLength="4" sap:display-format="UpperCase" sap:label="Company Code"/>
								<Property Name="CompanyName" Type="Edm.String" Nullable="false"
								MaxLength="256" sap:display-format="UpperCase" sap:label="Company Name" />
								<Property Name="Email" Type="Edm.String" sap:label="Email" sap:creatable="false"
								sap:updatable="true" sap:sortable="false" />
								<Property Name="Phone" Type="Edm.String" Nullable="true" sap:label="Phone" sap:creatable="false"
								sap:quickinfo="Property contains a phone number" sap:updatable="true" sap:sortable="false" />
								<Property Name="Street" Type="Edm.String" Nullable="false"
								MaxLength="256" sap:display-format="UpperCase" sap:label="Street" />
								<Property Name="City" Type="Edm.String" Nullable="false"
								MaxLength="256" sap:display-format="UpperCase" sap:label="City" />
								<Property Name="Country" Type="Edm.String" Nullable="false"
								MaxLength="256" sap:display-format="UpperCase" sap:label="Country" />
								<Property Name="CurrencyCode" Type="Edm.String" sap:label="Currency Code" sap:updatable="true"/>
								<Property Name="BoolCode" Type="Edm.Boolean" sap:label="Wifi" sap:filter-restriction="single-value"/>
								<Property Name="DateInterval" Type="Edm.DateTime" sap:display-format="Date" sap:filter-restriction="interval" sap:label="Posting Date" />
								<Property Name="SemanticDate" Type="Edm.DateTime" sap:display-format="Date" sap:filter-restriction="interval" sap:label="Semantic Date" />
							</EntityType>
							<EntityType Name="CompanyCodeVHType" sap:content-version="1">
								<Key>
									<PropertyRef Name="CompanyCode" />
								</Key>
								<Property Name="CompanyCode"
									Type="Edm.String"
									Nullable="false"
									MaxLength="4"
									sap:display-format="UpperCase"
									sap:label="Company Code" />
								<Property Name="CompanyName"
									Type="Edm.String"
									sap:label="Company Name" />
							</EntityType>

							<EntityContainer Name="AccessibilityNamespace_Entities"
							m:IsDefaultEntityContainer="true"
							sap:supported-formats="atom json xlsx">

						<EntitySet Name="CompanyItemsSet"
									EntityType="AccessibilityNamespace.CompanyItemsType"
									sap:creatable="false"
									sap:updatable="true"
									sap:deletable="true"
									sap:content-version="1"/>
						<EntitySet Name="CompanyCodeVH" EntityType="AccessibilityNamespace.CompanyCodeVHType"/>


					</EntityContainer>
						<Annotations Target="AccessibilityNamespace.CompanyItemsType"
							xmlns="http://docs.oasis-open.org/odata/ns/edm">
							<Annotation Term="com.sap.vocabularies.UI.v1.SelectionFields">
								<Collection>
								<PropertyPath>BoolCode</PropertyPath>
								<PropertyPath>DateInterval</PropertyPath>
								<PropertyPath>SemanticDate</PropertyPath>
								<PropertyPath>CompanyCode</PropertyPath>
								<PropertyPath>CompanyName</PropertyPath>
								<PropertyPath>Email</PropertyPath>
								<PropertyPath>Phone</PropertyPath>
								<PropertyPath>Street</PropertyPath>
								<PropertyPath>City</PropertyPath>

								</Collection>
							</Annotation>

						</Annotations>
						<Annotations Target="AccessibilityNamespace.CompanyItemsType/CompanyCode"
						xmlns="http://docs.oasis-open.org/odata/ns/edm">
							<Annotation Term="com.sap.vocabularies.Common.v1.ValueList">
								<Record>
									<PropertyValue Property="Label" String="Company Codes" />
									<PropertyValue Property="CollectionPath" String="CompanyCodeVH" />
									<PropertyValue Property="SearchSupported" Bool="true" />
									<PropertyValue Property="Parameters">
										<Collection>
											<Record Type="com.sap.vocabularies.Common.v1.ValueListParameterInOut">
												<PropertyValue Property="LocalDataProperty"
													PropertyPath="CompanyCode" />
												<PropertyValue Property="ValueListProperty"
													String="CompanyCode" />
											</Record>
											<Record
												Type="com.sap.vocabularies.Common.v1.ValueListParameterDisplayOnly">
												<PropertyValue Property="ValueListProperty"
													String="CompanyName" />
											</Record>
										</Collection>
									</PropertyValue>
								</Record>
							</Annotation>
						</Annotations>
					</Schema>
				</edmx:DataServices>
			</edmx:Edmx>
		</script>
		<script>
			sap.ui.getCore().attachInit(function () {
				"use strict";

				sap.ui.require([
					"sap/ui/core/ComponentContainer",
				], function (
					ComponentContainer
				) {
					sap.ui.define("mainView/Controller.controller", [
						"sap/ui/core/mvc/Controller",
						"sap/ui/core/util/MockServer",
						"sap/ui/model/odata/v2/ODataModel",
						"sap/ui/thirdparty/jquery"
					], function(
						Controller,
						MockServer,
						ODataModel,
						jQuery
					) {
						var MyController = Controller.extend("View.controller", {
							onInit : function() {
								var oModel,
									sServiceName = "testService";

								this.setupMockServer(sServiceName);

								oModel = new ODataModel(sServiceName + "/", {
									useBatch: false,
									defaultBindingMode: "TwoWay"
								});
								this.getView().setModel(oModel);
							},
							onExit: function() {
								this._oMockServer.stop();
							},
							setupMockServer: function (service) {
								var basePath = service,
										mockServer = new MockServer({
										rootUri: basePath
									}),
									aReqList = mockServer.getRequests();

								// configure mock server with a delay
								MockServer.config({
									autoRespond: true,
									autoRespondAfter: 500
								});

								// $metadata
								aReqList.push({
									method: 'GET',
									path: '/\\$metadata(.*)',
									response: function(req, resp) {
										req.respondXML(200, {}, jQuery("#metadata").html());
									}
								});

								// Data
								aReqList.push({
									method: 'GET',
									path: '/\\CompanyItemsSet(.*)',
									response: function(req, resp) {
										req.respondJSON(200, {}, jQuery("#dataSection").html());
									}
								});

								// Data
								aReqList.push({
									method: 'GET',
									path: '/\\CompanyCodeVH[\/?](.*)',
									response: function (req, resp) {
										req.respondJSON(200, {}, jQuery("#dataSectionCompanyCode").html());
									}
								});

								mockServer.setRequests(aReqList);
								mockServer.simulate(basePath + '/$metadata',
									{
										sMockdataBaseUrl: basePath + '/Employees',
										bGenerateMissingMockData: true
									});
								mockServer.start();
							}
						});
					});

					sap.ui.define("mainView/Component", [
						"sap/m/App",
						"sap/ui/core/UIComponent",
						"sap/ui/core/mvc/XMLView"
					], function(App, UIComponent, XMLView) {
						return UIComponent.extend("mainView.Component", {
							metadata: {
								interfaces: ["sap.ui.core.IAsyncContentCreation"]
							},
							createContent: async function() {
								return new App({
									initialPage: "idView",
									pages: [
										await XMLView.create({
											id: "idView",
											definition: document.getElementById("mainView").textContent
										}) 
									]
								});
							}
						});
					});

					new ComponentContainer({
						name : "mainView",
						manifest: true
					}).placeAt("content");

				});

			});
		</script>

</head>

<body id='content' class='sapUiBody'>
</body>

</html>
