/*!
 * Copyright (c) 2009-2014 SAP SE, All Rights Reserved
 */
sap.ui.define(["sap/ovp/flexibility/changeHandler/CardChangeHandler","sap/ovp/flexibility/changeHandler/RemoveCardContainer","sap/ui/dt/OverlayRegistry","sap/ui/core/ComponentContainer","sap/m/MessageToast","sap/ovp/cards/rta/SettingsDialogConstants","sap/ovp/cards/SettingsUtils","sap/ovp/cards/CommonUtils","sap/ovp/app/resources","sap/base/util/merge","sap/ui/model/odata/v2/ODataModel","sap/ui/model/odata/CountMode"],function(e,t,n,o,r,a,i,s,d,l,C,g){"use strict";return{moveControls:{changeHandler:"default",layers:{CUSTOMER_BASE:true,CUSTOMER:true,USER:true}},unhideControl:e.UnhideControlConfig,unhideCardContainer:e.UnhideCardContainer,hideCardContainer:e.HideCardContainer,removeCardContainer:t,editCardSettings:{changeHandler:{applyChange:function(e,t,n){var o=s.getApp(),r=o.getView(),i=e.getContent(),d=i.newAppDescriptor,l=r.byId(d.id);e.setRevertData(i.oldAppDescriptor);if(l){if(d.settings.tabs){var C=d.settings.selectedKey;if(!C||C<1){C=1}a.tabFields.forEach(function(e){var t=d.settings.tabs[C-1][e];if(e!=="entitySet"||e==="entitySet"&&t){delete d.settings[e]}if(t){d.settings[e]=t}})}var g=l.getComponentInstance();g.destroy()}o.recreateRTAClonedCard(d);return true},revertChange:function(e,t,n){var o=s.getApp(),r=o.getView(),a=e.getRevertData(),i=r.byId(a.id);if(i){var d=i.getComponentInstance();d.destroy()}o.recreateRTAClonedCard(a);e.resetRevertData();return true},completeChangeContent:function(e,t,n){return}},layers:{CUSTOMER_BASE:true,CUSTOMER:true,USER:true}},newCardSettings:{changeHandler:{applyChange:function(e,t,a){var l=s.getApp(),u=l.getView(),p=e.getContent();e.setRevertData(p.id);var c=new o(u.getId()+"--"+p.id),v=a.appComponent,f=l.getUIModel(),y=f.getProperty("/cards"),S=l.getLayout(),R=p.id.indexOf("newStaticLinkListCard_N")!==-1&&!i.checkClonedCard(p.id),m=p.id.indexOf("newKPICard_N")!==-1&&!i.checkClonedCard(p.id),M=p.id.indexOf("newCard_N")!==-1&&!i.checkClonedCard(p.id),U=i.newDataSource;if(m){var h=p.settings.selectedKPI,A=new C(h.ODataURI,{annotationURI:h.ModelURI,defaultCountMode:g.None}),D=p.model;if(p.settings["sAnnoKey"]){i.setDataSources(p.settings["sAnnoKey"],h.ModelURI)}u.setModel(A,D);v.setModel(A,D)}if(U&&!v.getModel(p.model)){var E=new C(i.newDataSourceModel.serviceURI,{annotationURI:i.newDataSourceModel.serviceAnnotationURI,defaultCountMode:g.None}),D=p.model;i.setDataSources(i.newDataSourceModel.serviceAnnotation,i.newDataSourceModel.serviceAnnotationURI);u.setModel(E,D);v.setModel(E,D)}p.settings.baseUrl=l._getBaseUrl();if(R||m||M){p.settings.newCard=true}else{p.settings.cloneCard=true}var O=-1,P;for(P=0;P<y.length;P++){if(p.id.lastIndexOf(s._getLayerNamespace()+"."+y[P].id,0)===0){O=P;break}}y.splice(O+1,0,p);f.setProperty("/cards",y);S.insertContent(c,O+1);setTimeout(function(){var e=n.getOverlay(c);e.setSelected(true);e.focus();var t=R||m||M?d.getText("OVP_KEYUSER_TOAST_MESSAGE_FOR_NEW"):d.getText("OVP_KEYUSER_TOAST_MESSAGE_FOR_CLONE");r.show(t,{duration:1e4})},0);l.recreateRTAClonedCard(p);return true},revertChange:function(e,t,n){var o=n.appComponent,r=s.getApp(),a=r.getView(),d=e.getRevertData(),l=e.getContent();var C=a.byId(d),g=r.getUIModel(),u=g.getProperty("/cards"),p=r.getLayout();var c=-1,v;for(v=0;v<u.length;v++){if(d===u[v].id){c=v;break}}u.splice(c,1);g.setProperty("/cards",u);if(C){var f=C.getComponentInstance(),y=f.getComponentData(),S=y.cardId.indexOf("newKPICard_N")!==-1&&!i.checkClonedCard(d);if(S){var R=y.modelName,m=a.getModel(R);m.destroy();if(l.settings["sAnnoKey"]){i.removeDataSources(l.settings["sAnnoKey"])}a.setModel(null,R);o.setModel(null,R)}f.destroy()}p.removeContent(c);C.destroy();e.resetRevertData();return true},completeChangeContent:function(e,t,n){return}},layers:{CUSTOMER_BASE:true,CUSTOMER:true,USER:true}},dragAndDropUI:{changeHandler:{applyChange:function(e,t,o){var r=s.getApp(),a=e.getContent(),i=l({},a),d=r.getUIModel(),C=d.getProperty("/cards"),g=r.getLayout(),u;u=i.position;i.position=i.oldPosition;i.oldPosition=u;e.setRevertData(i);u=C[a.position];C[a.position]=C[a.oldPosition];C[a.oldPosition]=u;d.setProperty("/cards",C);var p=g.getContent()[a.position],c=g.getContent()[a.oldPosition];g.removeContent(c);g.insertContent(c,a.position);g.removeContent(p);g.insertContent(p,a.oldPosition);setTimeout(function(){var e=n.getOverlay(c);e.setSelected(true);e.focus()},0);return true},revertChange:function(e,t,o){var r=s.getApp(),a=e.getRevertData(),i=r.getUIModel(),d=i.getProperty("/cards"),l=r.getLayout(),C;C=d[a.position];d[a.position]=d[a.oldPosition];d[a.oldPosition]=C;i.setProperty("/cards",d);var g=l.getContent()[a.position],u=l.getContent()[a.oldPosition];l.removeContent(u);l.insertContent(u,a.position);l.removeContent(g);l.insertContent(g,a.oldPosition);setTimeout(function(){var e=n.getOverlay(u);e.setSelected(true);e.focus()},0);e.resetRevertData();return true},completeChangeContent:function(e,t,n){return}},layers:{CUSTOMER_BASE:true,CUSTOMER:true,USER:true}},viewSwitch:e.PersonalizationDefaultConfig,visibility:e.PersonalizationDefaultConfig,position:e.PersonalizationDefaultConfig}},true);
//# sourceMappingURL=EasyScanLayout.flexibility.js.map