/*!
 * Copyright (c) 2009-2014 SAP SE, All Rights Reserved
 */
sap.ui.define(["sap/ovp/cards/CommonUtils","sap/ovp/insights/IntegrationCard","sap/insights/CardHelper"],function(e,t,n){"use strict";var i={};var r=[];return{init:function(e){var t=i[e];if(!t){return n.getServiceAsync().then(function(t){return t.getCardsChannel().then(function(t){if(t.isEnabled()){this.channel=t;this.id=e;this.sharedCards=r;this.consumers={};return this.registerProvider().then(function(){i[e]=Object.assign({},this);return this}.bind(this))}}.bind(this))}.bind(this))}else if(!t.registered){return t.registerProvider().then(function(){t.shareAvailableCards();return t})}},registerProvider:function(){if(this.channel){return this.channel.registerProvider(this.id,this).then(function(){this.registered=true}.bind(this))}},onConsumerConnected:function(e){if(!this.consumers[e]){this.consumers[e]=true;this.shareAvailableCards(e)}},onConsumerDisconnected:function(e){if(this.consumers[e]){delete this.consumers[e]}},shareAvailableCards:function(e){if(this.sharedCards.length!==r.length){this.sharedCards=r}this.channel.publishAvailableCards(this.id,this.sharedCards,e)},onCardRequested:function(e,t){if(this.consumers[e]){this.getCardDetails(t).then(function(t){this.channel.publishCard(this.id,t,e)}.bind(this))}},unregisterProvider:function(e){r=[];var t=i[e];if(t&&t.channel&&t.registered){return t.channel.unregister(t.id).then(function(){t.registered=false;t.consumers={};t.sharedCards={}})}},getCardDetails:function(n){var i=e.getApp();var r=i&&i.getView().byId(n).getComponentInstance(),s=r&&r.getRootControl()&&r.getRootControl().getController();var a={entitySet:s.entitySet,entityType:s.entityType,cardComponentData:s.oCardComponentData,cardComponent:s.oCardComponent,view:s.getView()};switch(s.getView().getControllerName()){case"sap.ovp.cards.list.List":case"sap.ovp.cards.v4.list.List":a.cardComponentName="List";a.itemBindingInfo=s.getCardItemBindingInfo();break;case"sap.ovp.cards.table.Table":case"sap.ovp.cards.v4.table.Table":a.cardComponentName="Table";a.itemBindingInfo=s.getCardItemBindingInfo();break;case"sap.ovp.cards.charts.analytical.analyticalChart":case"sap.ovp.cards.v4.charts.analytical.analyticalChart":a.cardComponentName="Analytical";a.vizFrame=s.vizFrame;break}return t.createManifestFor(a).then(function(e){return t.UpdateManifestDeltaChanges(e,a).then(function(e){return{id:n,descriptorContent:e}})})},onViewUpdate:function(e){var t=i[e];if(t&&t.registered){t.shareAvailableCards()}},resetInsightCards:function(){r=[]},addInsightCard:function(t,n){var i=t&&t.getProperty("/bInsightRTEnabled"),s=t&&t.getProperty("/enableAddToInsights");if(i&&s){var a=t.getProperty("/cardId"),o=e.getApp(),d=o.getOwnerComponent().getOvpConfig().cards;if(d[a]){r.push({title:d[a].settings.title,id:a,parentAppId:n,description:d[a].settings.subTitle})}}}}},true);
//# sourceMappingURL=CardProvider.js.map