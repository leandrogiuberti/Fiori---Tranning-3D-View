/*!
 * Copyright (c) 2009-2014 SAP SE, All Rights Reserved
 */
sap.ui.define(["sap/ovp/cards/generic/base/analytical/Utils","sap/ovp/insights/helpers/i18n","sap/ovp/insights/helpers/Batch","sap/ovp/app/OVPUtils","sap/ovp/cards/CommonUtils","sap/ovp/helpers/ODataAnnotationHelper","sap/ovp/helpers/ODataDelegator"],function(e,t,a,r,n,i,s){"use strict";var o={},l=0,u=0,p={},g={},c={};function d(e,t){if(o&&!o[e]){o[e]=t}else{o[e]=r.merge(true,{},o[e],t)}}function f(){l=0;u=0;p={}}function v(e,t){var a=e&&e.getFeeds(),r;for(var n=0;n<a.length;n++){if(a[n]&&a[n].getValues()&&a[n].getValues().indexOf(t)>-1){r=n;p[r]=p[r]+1||0}}return{sFeedNo:r,count:p[r]}}function h(e,t,a){if(!g[e]){g[e]={}}g[e][t]=a}function y(e,t){if(g){if(g[e]){return g[e][t]}}}function m(e,t){c[e]=t}function P(e){return c&&c[e]}function T(t,a,r,n){if(t==="date"){var i=s.getPropertyFromEntityType(a,r,n);var o=e.getSemanticProperties(i);var l=o&&o.propertyType;if(l){var u={propertyType:l};return"{= extension.formatters.formatDateValue(${"+a+"},"+JSON.stringify(u)+")}"}return"{= format.dateTime(${"+a+"}, {pattern: 'YYYY-MM-dd'}) }"}return"{"+a+"}"}function V(e,t,a){if(a){return a}else if(t){return"{"+t+"}"}else{return e.getProperty("displayValue")||""}}function M(e,r,s){var p=e.entityType,g=e.vizFrame,c=e.cardComponentData.cardId,d=e.view,h=a.getBatchObject(e,s["configuration"]),m=d.getModel();var P=i.getRecords(p,r,m);var M=P.Title&&P.Title.String||"",b=g.getVizType(),_=c,D=c,F,z;if(!M&&g.getVizProperties()&&g.getVizProperties().title&&g.getVizProperties().title.text){M=g.getVizProperties().title.text}if(M&&!M.startsWith("{")){F=M.replace(/[!@#$%^&*()_+\-=\[\]{};':"\\|,.<>\/?]+/g,"");F=c+"_"+F.replace(/ /g,"_");z=M;t.seti18nValueToMap("content.chartProperties.title.text","{{"+F+"}}",true);t.inserti18nPayLoad(c,F,M,"Title","chart Title")}else if(M.includes("@i18n&gt;")){var B=M.split("@i18n&gt;");z="{{"+B[1]+"}"}else if(M.includes("@i18n>")){var B=M.split("@i18n>");z="{{"+B[1]+"}"}var O=function(e,a,r){return function(n){var i=n.getBinding("displayValue"),s=i&&i.getPath(),o=n.getBinding("value"),u=o&&o.getPath(),p=n.getName(),g=p.replace(/[!@#$%^&*()_+\-=\[\]{};':"\\|,.<>\/?]+/g,"");var c="";if(u){c=y(a,u)}e=e+"_"+g.replace(/ /g,"_")+"_"+l;t.inserti18nPayLoad(a,e,p,"Label","chart dimension name");t.seti18nValueToMap("content.dimensions."+l+".label","{{"+e+"}}",true);var d=n.getParent().getParent(),f=v(d,p);t.seti18nValueToMap("content.feeds."+f.sFeedNo+".values."+f.count,"{{"+e+"}}",true);l=l+1;return{label:p,value:T(n.getProperty("dataType"),u,r,o.getModel()),dataType:n.getProperty("dataType"),displayValue:V(n,s,c)}}};var x=function(e){return function(a){var r=a.getBinding("value"),i=r&&r.getPath(),s=a.getName(),o=s.replace(/[!@#$%^&*()_+\-=\[\]{};':"\\|,.<>\/?]+/g,"");if(n.isODataV4(r.getModel())){i=i+"Aggregate"}e=e+"_"+o.replace(/ /g,"_")+"_"+u;t.inserti18nPayLoad(c,e,s,"Label","chart measure name");t.seti18nValueToMap("content.measures."+u+".label","{{"+e+"}}",true);var l=a.getParent().getParent(),p=v(l,s);t.seti18nValueToMap("content.feeds."+p.sFeedNo+".values."+p.count,"{{"+e+"}}",true);u=u+1;return{label:s,value:"{"+i+"}"}}};f();var N={chartType:b,chartProperties:o&&o[g&&g.getId()]||{},title:{text:z,visible:true,alignment:"left"},dimensions:g.getDataset().getDimensions().map(O(D,c,p)),measures:g.getDataset().getMeasures().map(x(_)),feeds:g.getFeeds().map(function(e){return{type:e.getType(),uid:e.getUid(),values:e.getValues()}}),data:{path:a.getBatchRequestPath("/content/d/results",m)},actionableArea:"Chart"};if(!h.header){N.data.path=a.getBatchRequestPath("/d/results",m)}return N}return{setVizPropertyMap:d,setDimensionPath:h,setUoMForSubTitle:m,getUoMForSubTitle:P,createChartContent:M}});
//# sourceMappingURL=AnalyticalCard.js.map