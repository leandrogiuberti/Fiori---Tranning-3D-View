/*!
 * Copyright (c) 2009-2014 SAP SE, All Rights Reserved
 */
sap.ui.define(["sap/ui/layout/form/SimpleForm","sap/ui/comp/smartfield/SmartField","sap/ui/comp/smartfield/SmartLabel","sap/ui/comp/library"],function(a,e,r,t){"use strict";var n=t.smartfield.JSONType;return{getActionInfo:function(a,e,r){var t=a.getModel().getMetaModel();var n=e.action.split("/")[1];var o=a.getObject();var i={oContext:a,sFunctionImportPath:e.action,sFunctionLabel:e.label,oFunctionImport:t.getODataFunctionImport(n),parameterData:{},allParameters:[]};var l;if(i.oFunctionImport.parameter){var s=this._getKeyProperties(r);for(var m=0;m<i.oFunctionImport.parameter.length;m++){var u=i.oFunctionImport.parameter[m];this._addParamLabel(u,r,t);if(s[u.name]){u.isKey=true}if(typeof u.nullable==="undefined"){u.nullable=true}if(o.hasOwnProperty(u.name)){l=o[u.name]}else{l=""}i.parameterData[u.name]=l;i.allParameters.push(u)}}return i},_getKeyProperties:function(a){var e={};if(a&&a.key&&a.key.propertyRef){for(var r=0;r<a.key.propertyRef.length;r++){var t=a.key.propertyRef[r].name;e[t]=true}}return e},_addParamLabel:function(a,e,r){if(e&&a&&!a["com.sap.vocabularies.Common.v1.Label"]){var t=r.getODataProperty(e,a.name,false);if(t&&t["com.sap.vocabularies.Common.v1.Label"]){a["com.sap.vocabularies.Common.v1.Label"]=t["com.sap.vocabularies.Common.v1.Label"]}else if(t&&t["sap:label"]){a["sap:label"]=t["sap:label"]}}},buildParametersForm:function(t,o){function i(a){var e="";if(a["com.sap.vocabularies.Common.v1.Label"]){e=a["com.sap.vocabularies.Common.v1.Label"].String}else if(a["sap:label"]){e=a["sap:label"]}else{e=a.name}return e}var l=new a({editable:true});var s=[];for(var m=0;m<t.allParameters.length;m++){var u=t.allParameters[m];var p=i(u);var v="{/"+u.name+"}";var f=null;var d=u.type;var c=u.maxLength?parseInt(u.maxLength,10):undefined;if(d==="Edm.Boolean"){f=n.Boolean}else if(d==="Edm.Byte"||d==="Edm.SByte"||d==="Edm.Int16"||d==="Edm.Int32"){f=n.Integer}else{f=n.String}var y=this._isMandatoryParameter(u);var b=new e({value:v,mandatory:y,jsontype:f,maxLength:c,editable:!u.isKey});b.attachChange(o);s.push(b);var g=new r;g.setRequired(y&&!u.isKey);g.setText(p);g.setLabelFor(b);l.addContent(g);l.addContent(b)}return l},getParameters:function(a,e){var r=this._validateParametersValue(a,e);return r.preparedParameterData},mandatoryParamsMissing:function(a,e){var r=this._validateParametersValue(a,e);return r.missingMandatoryParameters&&r.missingMandatoryParameters.length>0},_validateParametersValue:function(a,e){var r=[];var t=a.getObject("/");var n={};var o,i;for(var l=0;l<e.parameter.length;l++){var s=e.parameter[l];var m=s.name;if(t.hasOwnProperty(m)){o=t[m];i=this._isMandatoryParameter(s);if(o===undefined||o===""){if(i){if(s.type==="Edm.Boolean"){n[m]=false}else{r.push(s)}}}else{n[m]=o}}else{throw new Error("Unknown parameter: "+m)}}return{preparedParameterData:n,missingMandatoryParameters:r}},_isMandatoryParameter:function(a){return!this._toBoolean(a.nullable)},_toBoolean:function(a){if(typeof a==="string"){var e=a.toLowerCase();return!(e=="false"||e==""||e==" ")}return!!a}}},true);
//# sourceMappingURL=ActionUtils.js.map