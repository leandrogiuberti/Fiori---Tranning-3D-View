/*!
 * Copyright (c) 2009-2014 SAP SE, All Rights Reserved
 */
sap.ui.define(["sap/ovp/app/OVPLogger","sap/ui/core/Component"],function(t,e){"use strict";var a=new t("OVP.cards.OVPCardsAsAPIUtils");var n=["sap.ovp.cards.list","sap.ovp.cards.table","sap.ovp.cards.v4.list","sap.ovp.cards.v4.table","sap.ovp.cards.stack","sap.ovp.cards.linklist","sap.ovp.cards.v4.linklist","sap.ovp.cards.charts.analytical","sap.ovp.cards.charts.smart.chart","sap.ovp.cards.charts.bubble","sap.ovp.cards.charts.donut","sap.ovp.cards.charts.line","sap.ovp.cards.v4.charts.analytical","sap.ovp.cards.v4.charts.smart.chart","sap.ovp.cards.v4.charts.bubble","sap.ovp.cards.v4.charts.donut","sap.ovp.cards.v4.charts.line","sap.ovp.cards.error","sap.ovp.cards.v4.error"];function s(){return n}function r(t,e,n){var s={};s.message=t;if(n){s._oError=n;s.getActualError=function(){return s._oError}}a.error(s.message);e(s)}function o(t){var e=false;var a=t.getOwnerComponent();if(!!a){var n=a.getComponentData();if(!!n&&n.ovpCardsAsApi){e=true}}return e}function i(t,e){var a=e.manifest;var n;for(var s in a.cards){n=s}var r=a.cards[n];if(r.template==="sap.ovp.cards.charts.analytical"||r.template==="sap.ovp.cards.charts.smart.chart"){r.settings.chartAnnotationPath=t.chartAnnotationPath;r.settings.navigation=t.navigation}if(t.entitySet){r.settings.entitySet=t.entitySet}r.settings.annotationPath=t.annotationPath;r.settings.dynamicSubtitleAnnotationPath=t.dynamicSubtitleAnnotationPath;r.settings.presentationAnnotationPath=t.presentationAnnotationPath;r.settings.selectionAnnotationPath=t.selectionAnnotationPath;r.settings.selectionPresentationAnnotationPath=t.selectionPresentationAnnotationPath;r.settings.kpiAnnotationPath=t.kpiAnnotationPath;r.settings.dataPointAnnotationPath=t.dataPointAnnotationPath;r.settings.identificationAnnotationPath=t.identificationAnnotationPath;r.settings.headerAnnotationPath=t.headerAnnotationPath;r.settings.selectedKey=t.selectedKey;if(r){a.cards[n]=r;d.createCardComponent(e.parentView,a,e.containerId,e.selectionVariant)}}function p(t){var e=true;if(t.template==="sap.ovp.cards.error"||t.template==="sap.ovp.cards.v4.error"||(t.template==="sap.ovp.cards.linklist"||t.template==="sap.ovp.cards.v4.linklist")&&t.settings.staticContent){e=false}return e}function l(t,e){var a=[],n=[],s,r;var o=e.getSelectOptionsPropertyNames();for(s=0;s<o.length;s++){var i=e.getSelectOption(o[s]);if(i&&i.length>0){for(r=0;r<i.length;r++){if(i[r]){var p={path:o[s],operator:i[r].Option,value1:i[r].Low,sign:i[r].Sign};if(i[r].High){p.value2=i[r].High}a.push(p)}}}}var l=e.getParameterNames();for(s=0;s<l.length;s++){var c={path:l[s],value:e.getParameter(l[s])};n.push(c)}t.settings.filters=a;t.settings.parameters=n;return t}function c(t,a,s,o,i){return new Promise(function(c,d){var v,f,g="";if(!!a){for(var h in a.cards){if(a.cards.hasOwnProperty(h)){v=a.cards[h];f=h}}if(!!v&&!!f){if(!!v.template&&!!v.settings&&(!!v.model||!p(v))){if(n.indexOf(v.template)!==-1){if(!!s&&typeof s==="string"){if(!!t){var u=!v.model?undefined:t.getModel(v.model);var m;if(!p(v)){m=Promise.resolve()}else{if(u&&u.getODataVersion&&u.getODataVersion()=="4.0"){m=u.getMetaModel().requestObject("/"+v.settings.entitySet)}else{m=u.getMetaModel().loaded()}}m.then(function(){var n=false;if(o){v=l(v,o);n=true}v.settings.ignoreSelectionVariant=n;var p={name:v.template,componentData:{model:u,ovpCardsAsApi:true,parentView:t,manifest:a,containerId:s,selectionVariant:o,fnCheckNavigation:i,showDateInRelativeFormat:a.showDateInRelativeFormat,disableTableCardFlexibility:a.disableTableCardFlexibility,template:v.template,i18n:t.getModel("@i18n"),cardId:f,settings:v.settings,appComponent:null,mainComponent:null}};var h=t.byId(s);if(h){h.getComponentInstance()&&h.getComponentInstance().destroy()}e.create(p).then(function(e){var a=t.byId(s);if(!!a){var n=a.getComponentInstance();e.setModel(u);a.setComponent(e);if(n){setTimeout(function(){n.destroy()},0)}c(true)}else{g="Component Container '"+s+"' is not present in the current View";r(g,d)}},function(t){g="Component creation failed";r(g,d,t)})},function(t){g="MetaModel was not loaded";r(g,d,t)})}else{g="First argument oView is null";r(g,d)}}else{g="ContainerId should be of type string and not null";r(g,d)}}else{g=v.template+" card type is not supported in the API";r(g,d)}}else{g="Cards template or model or settings are not defined";r(g,d)}}else{g="Cards manifest entry or cardId is null";r(g,d)}}else{g="Second argument oManifest is null";r(g,d)}})}var d={createCardComponent:c,recreateCard:i,checkIfAPIIsUsed:o,getSupportedCardTypes:s};return d},true);
//# sourceMappingURL=OVPCardAsAPIUtils.js.map