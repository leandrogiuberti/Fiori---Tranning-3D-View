/*!
 * Copyright (c) 2009-2014 SAP SE, All Rights Reserved
 * @fileOverview Library to Manage rendering of Viz Charts.
 *
 * Any function that needs to be exported(used outside this file) via namespace should be defined as
 * a function and then added to the return statement at the end of this file
 */
sap.ui.define(["sap/ovp/cards/generic/base/analytical/Utils","sap/ovp/cards/AnnotationHelper","sap/ui/core/format/DateFormat","sap/viz/ui5/controls/VizTooltip","sap/ovp/cards/CommonUtils","sap/ovp/cards/OVPCardAsAPIUtils","sap/viz/ui5/data/DimensionDefinition","sap/viz/ui5/data/MeasureDefinition","sap/viz/ui5/controls/common/feeds/FeedItem","sap/ovp/app/resources","sap/ovp/app/OVPUtils","sap/base/util/each","sap/base/util/merge","sap/ovp/app/OVPLogger","sap/ovp/helpers/V4/MetadataAnalyzer","sap/ovp/insights/helpers/AnalyticalCard","sap/ovp/cards/NavigationHelper","sap/ovp/cards/Constants","sap/ovp/cards/MetadataAnalyser","sap/ovp/cards/Filterhelper","sap/ovp/cards/charts/VizAnnotationManager","sap/ovp/cards/generic/base/analytical/VizAnnotationManagerHelper"],function(e,t,a,r,i,n,o,s,l,u,f,v,c,p,g,h,d,m,P,A,y,T){"use strict";var _=m.Annotations;var E=m.errorMessages;var b=[_.COLUMNSTACKED_CHARTTYPE,_.DONUT_CHARTTYPE,_.COLUMN_CHARTTYPE,_.BAR_CHARTTYPE,_.VERTICALBULLET_CHARTTYPE,_.LINE_CHARTTYPE,_.COMBINATION_CHARTTYPE,_.BUBBLE_CHARTTYPE];var C=[_.COLUMNSTACKED_CHARTTYPE];var S;var N=new p("OVP.charts.VizAnnotationManager");function O(a,r,i,n,o,s,l){var u="{";if(!a||!a.getSetting("ovpCardProperties")){N.error(E.ANALYTICAL_CONFIG_ERROR);u+="}";return u}var f=a.getSetting("dataModel");var p;if(l&&l.$EnumMember){p=l.$EnumMember.split("/");if(p&&p[1]!="Donut"&&o===undefined){return null}}var h=[];var d=[];var m=[];var T=[];var b=[];var C=[];var S=[];var O=[];var I=i&&i.Parameters;var x=n&&n.SortOrder;var V=n&&n.MaxItems,Y=null;var $;var L;var U;var F=null;var K=_.TEXT_KEY;var k=_.TEXT_KEY_V4;var w=_.UNIT_KEY;var B="@"+_.UNIT_KEY_V4_ISOCurrency;var z="@"+_.UNIT_KEY_V4_Unit;var j={};if(typeof V==="number"||typeof V==="string"&&!isNaN(V)){Y=parseInt(V,10)}if(Y){if(Y==="0"){N.error("OVP-AC: Analytic card Error: maxItems is configured as "+Y);u+="}";return u}if(!/^\d+$/.test(Y)){N.error("OVP-AC: Analytic card Error: maxItems is Invalid. Please enter an Integer.");u+="}";return u}}var H=a.getSetting("ovpCardProperties"),X=H.getProperty("/parameters");var q=H.getProperty("/metaModel");var W=H.getProperty("/measureAggregate");var Q=g.getEntitySetName(q,r.$Type);I=I||!!X;if(I){var J=P.resolveParameterizedEntitySet(f,r,i,X);u+="path: '"+J+"'"}else{u+="path: '/"+Q+"'"}var Z=[];F=a.getSetting("ovpCardProperties").getProperty("/entitySet");if(!f||!F){return u}var ee=e.getMetadata(f,F);G(f,ee,r.$Type);var te=a.getSetting("ovpCardProperties").getProperty("/cardLayout");var ae=1,re;var ie=e.getConfig();var ne;var oe;if(o&&te&&te.colSpan&&te.colSpan>1){re=te.colSpan-ae;for(var se in ie){if((oe=ie[se].reference)&&ie[oe]){var le=c({},ie[oe]);ie[se]=le}if(se===p[1]||ie[se].time&&ie[se].time.type===p[1].toLowerCase()){ne=ie[se];break}}var ue=e.hasTimeSemantics(o,ne,f,F,true);if(ue){ne=ne.time}else{ne=ne.default}var fe=a.getSetting("ovpCardProperties").getProperty("/dataStep");if(!fe){if(ne.resize&&ne.resize.hasOwnProperty("dataStep")&&!isNaN(ne.resize.dataStep)){fe=ne.resize.dataStep}}fe=parseInt(fe,10);if(re>0&&fe&&!isNaN(fe)){Y=parseInt(Y,10)+fe*re}}var H=a.getSetting("ovpCardProperties");Z=A.getFilters(H,i,true);if(Z.length>0){Z=A.createExcludeFilters(Z,H)}var ve=q.getObject("/"+r.$Type+"/@");v(s,function(e,t){$=M(ve,t);if(t.DataPoint&&t.DataPoint.$AnnotationPath){var a=ve[t.DataPoint.$AnnotationPath];if(a.ForecastValue&&(a.ForecastValue.PropertyPath||a.ForecastValue.Path)){var r=a.ForecastValue.PropertyPath||a.ForecastValue.Path;b.push(a.ForecastValue.PropertyPath||a.ForecastValue.Path);if(ee&&ee[r]){var i;if(ee[r].annotations&&ee[r].annotations[B]){i=ee[r].annotations[B].$Path?ee[r].annotations[B].$Path:undefined}else if(ee[r].annotations&&ee[r].annotations[z]){i=ee[r].annotations[z].$Path?ee[r].annotations[z].$Path:undefined}else if(ee[r][w]){i=ee[r][w]}if(i){if((C?Array.prototype.indexOf.call(C,i):-1)===-1){C.push(i)}}}}if(a.TargetValue&&(a.TargetValue.PropertyPath||a.TargetValue.Path)){var n=a.TargetValue.PropertyPath||a.TargetValue.Path;b.push(a.TargetValue.PropertyPath||a.TargetValue.Path);if(ee&&ee[n]){var i;if(ee[n].annotations&&ee[n].annotations[B]){i=ee[n].annotations[B].$Path?ee[n].annotations[B].$Path:undefined}else if(ee[n].annotations&&ee[n].annotations[z]){i=ee[n].annotations[z].$Path?ee[n].annotations[z].$Path:undefined}else if(ee[n][w]){i=ee[n][w]}if(i){if((C?Array.prototype.indexOf.call(C,i):-1)===-1){C.push(i)}}}}}b.push($);if(ee&&ee[$]){if(ee[$][k]){if(ee[$][k].String&&$!=ee[$][k].String){b.push(ee[$][k].String?ee[$][k].String:$)}else if(ee[$][k].Path&&$!=ee[$][k].Path){b.push(ee[$][k].Path?ee[$][k].Path:$)}}else if(ee[$][K]&&$!=ee[$][K]){b.push(ee[$][K]?ee[$][K]:$)}}if(ee&&ee[$]){var i;if(ee[$].annotations&&ee[$].annotations[B]){i=ee[$].annotations[B].$Path?ee[$].annotations[B].$Path:undefined}else if(ee[$].annotations&&ee[$].annotations[z]){i=ee[$].annotations[z].$Path?ee[$].annotations[z].$Path:undefined}else if(ee[$][w]){i=ee[$][w]}if(i){if((C?Array.prototype.indexOf.call(C,i):-1)===-1){C.push(i)}}}});v(o,function(e,t){$=t.Dimension.$PropertyPath;h.push($);if(ee&&ee[$]){if(ee[$]["annotations"]&&ee[$]["annotations"]["@"+k]){if(typeof ee[$]["annotations"]["@"+k]==="string"&&ee[$]["annotations"]["@"+k]&&$!=ee[$]["annotations"]["@"+k]){h.push(ee[$]["annotations"]["@"+k])}else if(ee[$]["annotations"]["@"+k].$Path&&$!=ee[$]["annotations"]["@"+k].$Path){U=ee[$]["annotations"]["@"+k].$Path;var a=U.split("/");if(a.length>1){L=y.getNavigationPrefix(q,ve,U);if(L!==""){h.push(U);d.push(L);T=y.getAssociationKeys(q,ve,U);if(T.length>0){m=m.concat(T)}}}else{h.push(U?U:$)}}}else if(ee[$][K]&&$!=ee[$][K]){h.push(ee[$][K]?ee[$][K]:$)}}});if(m.length>0){var ce=0;while(ce<m.length){if(h.indexOf(m[ce])!==-1){m.splice(ce,1)}else{ce++}}}if(b.length>0){v(b,function(e,t){t+="Aggregate";j[t]=true})}if(h.length>0){v(h,function(e,t){j[t]=true})}if(x){var pe=n.SortOrder;if(!pe.length){pe=e.getSortAnnotationCollection(f,n,r)}if(pe.length<1){N.warning(E.CARD_WARNING+E.SORTORDER_WARNING)}else{var ge="";var he;var de;var me;for(var Pe=0;Pe<pe.length;Pe++){he=pe[Pe];me=he.Property.$PropertyPath;if(b.includes(me)){me+="Aggregate"}O.push(me);if(typeof he.Descending==="undefined"){de="true"}else if(typeof he.Descending==="boolean"){de=he.Descending.toString()}ge=ge+"{path: '"+me+"',descending: "+de+"},"}u+=", sorter: ["+ge.substring(0,ge.length-1)+"]"}}var Ae=D(C,h);if(O.length>0){v(O,function(e,t){if(!j.hasOwnProperty(t)){Ae.push(t)}})}u+=", parameters: {$apply:'groupby(("+Ae.join(",")+"),";u+="aggregate(";var ye=[];var Te=H.getProperty("/chartAnnotationPath");b.forEach(function(e,t){var a=R(Te,q,r,t,W);var i=[e," with ",a," as ",e,"Aggregate"].join("");ye.push(i)});u+=ye.join(",");u+="))";var _e=q.getObject("/"+r.$Type);if(_e){var Ee=t.getRequestFields(n);if(Ee&&Ee.length>0){v(Ee,function(e,t){if(!j.hasOwnProperty(t)){j[t]=true;S.push(t)}});if(S.length>0){u+=","+S.join(",")}}}if(d.length>0){u+="'"+","+" expand:'"+d.join(",")}var be=t.checkFilterPreference(a.getSetting("ovpCardProperties"));if(be){u+="', custom: {cardId: '"+a.getSetting("ovpCardProperties").getProperty("/cardId")+"'}}"}else{u+="'}"}if(p&&p[1]==="Donut"&&o===undefined){u+=", length: 1"}else if(p&&p[1]==="Donut"&&o&&Y){u+=", length: "+(parseInt(Y,10)+1)}else if(Y){u+=", length: "+Y}if(Z.length>0&&Ae.length>0){var Ce=Z.every(function(e){return Ae.indexOf(e.path)!==-1});var Se=Ce?JSON.stringify(Z):"[]";u+=", filters: "+Se}u+="}";return u}O.requiresIContext=true;function M(e,t,a){var r;if(t.DynamicMeasure){r=e[t.DynamicMeasure.$AnnotationPath].AggregatableProperty.$PropertyPath}else{r=a?t[a].$PropertyPath:t.Measure.$PropertyPath}return r}function R(e,t,a,r,i){var n,o;var s=t.getObject("/"+a.$Type+"@"+e).MeasureAttributes[r];var l=s.DynamicMeasure;if(l){var u=l.$AnnotationPath;o=t.getObject("/"+a.$Type+"/"+u).AggregationMethod}var n=o?o:i&&i["Axis"+(r+1)];n=n?n:"sum";return n}function D(e,t){var a=e.length>0?t.concat(e):t;return a.filter(function(e,t){return a.indexOf(e)===t})}function I(e,t,a){}function x(e,t){var a={boolFlag:false};v(e,function(e,r){if(r.DataPoint&&r.DataPoint.$AnnotationPath){var i=t[r.DataPoint.$AnnotationPath];T.updateFlagValueForDataPoint(i,a)}});if(a.boolFlag===true&&e.length>1){N.warning(E.CARD_WARNING+E.INVALID_SEMANTIC_MEASURES)}return a.boolFlag}function V(e,t,a,r){var i=T.getMeasureName(e,a,r);var n=e.DataPoint.$AnnotationPath;var o=t[n];return T.getSemanticLegends(o,true,i)}function Y(e,t,a,r){var i=M(r,t,a);if(e[i].$Type===_.EDM_INT32){return true}return false}function $(e,t,a,r){var i=M(r,t,a);if(e[i].$Type===_.EDM_INT64){return true}return false}function L(t,a,i){var p,g,d,P,A;var O,R,D,I,L,K=false;var w;var B,z,j;var H,W=[],Q=[];var J=[];var Z;var ee;var te=i&&i.getView();var ae,re;var ie=te&&te.getModel("ui");var ne=ie&&ie.getProperty("/chartSettings");p=t.getModel("ovpCardProperties");if(n.checkIfAPIIsUsed(i)){K=p&&p.getData()&&p.getData().showDataLabel}A=ne?ne.showDataLabel:K;O=t.getVizType();R=e.getConfig();for(var oe in R){if((ee=R[oe].reference)&&R[ee]){var se=c({},R[ee]);R[oe]=se}if(R[oe].default.type===O||R[oe].time&&R[oe].time.type===O){D=R[oe];break}}if(!D){N.error(E.CARD_ERROR+"in "+E.CARD_CONFIG+E.CARD_CONFIG_ERROR+O+" "+E.CARD_CONFIG_JSON);return}if(!p){N.error(E.CARD_ERROR+"in "+E.CARD_CONFIG+E.NO_CARD_MODEL);return}var le=t.getModel();var ue=p.getProperty("/entitySet");if(!le||!ue){return}var fe=p.getProperty("/entityType").$Type;var ve=i.getMetaModel().getData().$Annotations[fe];var ce={property:i.getMetaModel().getObject("/"+fe+"/")};g=f.merge(true,{},ve,ce);if(!g){N.error(E.CARD_ANNO_ERROR+"in "+E.CARD_ANNO);return}var pe=e.getMetadata(le,ue);G(le,pe,fe);d=p.getProperty("/chartAnnotationPath");if(!d||!(P=g["@"+d])){N.error(E.CARD_ANNO_ERROR+"in "+E.CARD_ANNO);return}var ge=F(g,d,t);if(!(I=P.DimensionAttributes)||!I.length){N.error(E.CHART_ANNO_ERROR+"in "+E.CHART_ANNO+" "+E.DIMENSIONS_MANDATORY);return}var he;if(!(L=P.MeasureAttributes)||!L.length){N.error(E.CHART_ANNO_ERROR+"in "+E.CHART_ANNO+" "+E.MEASURES_MANDATORY);return}else{var de=L[0].DataPoint?g[L[0].DataPoint.$AnnotationPath]:null;var me=de&&de.ValueFormat&&de.ValueFormat.NumberOfFractionalDigits&&de.ValueFormat.NumberOfFractionalDigits;he=me?me:0}Z=e.hasTimeSemantics(I,D,le,ue,true);if(Z){D=D.time}else{D=D.default}var Pe=p.getProperty("/ChartProperties")||p.getProperty("/chartProperties");if(p&&p.getProperty("/tabs")&&Pe===undefined){ae=te.byId("ovp_card_dropdown");re=parseInt(ae.getSelectedKey(),10);Pe=p.getProperty("/tabs")&&p.getProperty("/tabs")[re-1]&&(p.getProperty("/tabs")[re-1]["ChartProperties"]||p.getProperty("/tabs")[re-1]["chartProperties"])}var Ae=false;var ye=he>0?"tooltipNoScaleFormatter/"+he.toString()+"/":"tooltipNoScaleFormatter/-1/";var Te=new r({formatString:ye});Te.connect(t.getVizUid());Te.connect(t.getVizUid());t._oOvpVizFrameTooltip=Te;var _e=[];var Ee=C.indexOf(P.ChartType.$EnumMember)>=0;if(Ee&&t&&t.getModel("analyticalmodel")){_e=t.getModel("analyticalmodel").getData()||[]}[D.dimensions,D.measures].forEach(function(e,t){var a=t?L:I;var r=t?"measure(s)":"dimension(s)";if(e.min&&a.length<e.min){N.error(E.CARD_ERROR+"in "+O+" "+E.CARD_LEAST+e.min+" "+r);Ae=true}if(e.max&&a.length>e.max){N.error(E.CARD_ERROR+"in "+O+E.CARD_MOST+e.max+" "+r);Ae=true}});if(Ae){return}var be=true;if(D.properties&&D.properties.hasOwnProperty("hideLabel")&&!D.properties["hideLabel"]){be=false}if(D.type&&(D.type==="timeseries_bullet"||D.type==="timeseries_stacked_column")){T.enableTimeAxisForChart(D,p)}var Ce=true;var Se=false;if(O==="donut"){Se=true}t.removeAllAggregation();w={legend:{isScrollable:false,itemMargin:1.25},title:{visible:true},interaction:{noninteractiveMode:Ce?false:true,selectability:{legendSelection:Se?true:false,axisLabelSelection:false,mode:"EXCLUSIVE",plotLassoSelection:false,plotStdSelection:true},zoom:{enablement:"disabled"}},plotArea:{window:{start:"firstDataPoint",end:"lastDataPoint"},dataLabel:{visible:A||Se?true:false,type:"value"},dataPoint:{invalidity:"ignore"},alignment:{vertical:"top"}},categoryAxis:{label:{truncatedLabelRatio:.15}},general:{groupData:false,showAsUTC:true}};if(D.properties&&D.properties.semanticColor===true&&x(L,g)){var Ne=u.getText("GOOD");var Oe=u.getText("BAD");var Me=u.getText("CRITICAL");var Re=u.getText("OTHERS");if(L.length===1){var De=V(L[0],g,pe,t);var Ne=De[0]||Ne,Oe=De[1]||Oe,Me=De[2]||Me,Re=u.getText("OTHERS")}w.plotArea.dataPointStyle={rules:[{callback:function(t){var a=e.mapMeasures(t,pe,L,true);if(!a){return false}var r=g[a];var i=T.formThePathForCriticalityStateCalculation(t,r);if(i===m.Criticality.StateValues.Positive){return true}else if(i==="Positive"){return true}},properties:{color:"sapUiChartPaletteSemanticGoodLight1"},displayName:Ne},{callback:function(t){var a=e.mapMeasures(t,pe,L,true);if(!a){return false}var r=g[a];var i=T.formThePathForCriticalityStateCalculation(t,r);if(i===m.Criticality.StateValues.Critical){return true}else if(i==="Critical"){return true}},properties:{color:"sapUiChartPaletteSemanticCriticalLight1"},displayName:Me},{callback:function(t){var a=e.mapMeasures(t,pe,L,true);if(!a){return false}var r=g[a];var i=T.formThePathForCriticalityStateCalculation(t,r);if(i===m.Criticality.StateValues.Negative){return true}else if(i==="Negative"){return true}},properties:{color:"sapUiChartPaletteSemanticBadLight1"},displayName:Oe},{callback:function(t){var a=e.mapMeasures(t,pe,L,true);if(!a){return false}var r=g[a];var i=T.formThePathForCriticalityStateCalculation(t,r);if(i===m.Criticality.StateValues.None){return true}else if(i==="Neutral"){return true}},properties:{color:"sapUiChartPaletteSemanticNeutralLight1"},displayName:Re}]}}var Ie=p.getProperty("/bEnableStableColors");var xe=p.getProperty("/colorPalette");var Ve;if(!Ie&&b.indexOf(P.ChartType.$EnumMember)>=0&&xe&&Object.keys(xe).length>=2&&Object.keys(xe).length<=4){v(I,function(e,t){if(t&&t.Role&&t.Role.$EnumMember==="com.sap.vocabularies.UI.v1.ChartDimensionRoleType/Series"){Ve=t.Dimension&&t.Dimension.$PropertyPath;return}});var Ye;if(Ve){if(pe&&pe[Ve]){if(pe[Ve][_.LABEL_KEY_V4]){Ye=T.getLabelFromAnnotationPath(pe[Ve][_.LABEL_KEY_V4]?pe[Ve][_.LABEL_KEY_V4]:pe[Ve][_.LABEL_KEY_V4].Path,t,pe)}else if(pe[Ve][_.LABEL_KEY]){Ye=pe[Ve][_.LABEL_KEY]}else if(Ve){Ye=Ve}}if(xe instanceof Array){var $e=xe.map(function(e){return e.color});var Le=xe.map(function(e){return e.legendText});var Ue=Le[0]!=undefined?Le[0]:u.getText("OTHERS");var Fe=Le[1]!=undefined?Le[1]:u.getText("BAD");var Ke=Le[2]!=undefined?Le[2]:u.getText("CRITICAL");var ke=Le[3]!=undefined?Le[3]:u.getText("GOOD")}w.plotArea.dataPointStyle={rules:[{callback:function(e){if(e&&(e[Ye]==="3"||e[Ye]===3)){if(xe instanceof Array){if(xe.length<4){return false}}else if(xe&&!xe.hasOwnProperty(3)){return false}return true}},properties:{color:xe instanceof Array&&$e.length?$e[3]:xe[3]&&xe[3]["color"]},displayName:ke||xe[3]&&xe[3]["legendText"]},{callback:function(e){if(e&&(e[Ye]==="2"||e[Ye]===2)){if(xe instanceof Array){if(xe.length<3){return false}}else if(xe&&!xe.hasOwnProperty(2)){return false}return true}},properties:{color:xe instanceof Array&&$e.length?$e[2]:xe[2]&&xe[2]["color"]},displayName:Ke||xe[2]&&xe[2]["legendText"]},{callback:function(e){if(e&&(e[Ye]==="1"||e[Ye]===1)){return true}},properties:{color:xe instanceof Array&&$e.length?$e[1]:xe[1]&&xe[1]["color"]},displayName:Fe||xe[1]&&xe[1]["legendText"]},{callback:function(e){if(e&&(e[Ye]==="0"||e[Ye]===0)){return true}},properties:{color:xe instanceof Array&&$e.length?$e[0]:xe[0]&&xe[0]["color"]},displayName:Ue||xe[0]&&xe[0]["legendText"]}]};var we;if(p&&p.getProperty("/bInsightEnabled")){we=c({},w.plotArea.dataPointStyle);var Be=pe&&pe[Ve]&&pe[Ve][_.TYPE_KEY]||"";we.rules.forEach(function(e,t,a){delete e["callback"];e.dataContext={};if(Be){e.dataContext[Ye]=Be==="Edm.String"?a.length-1-t+"":a.length-1-t}else{e.dataContext[Ye]=a.length-1-t+""}})}}}var ze=false;var je=false;if(P.ChartType.$EnumMember===_.SCATTER_CHARTTYPE||P.ChartType.$EnumMember===_.BUBBLE_CHARTTYPE||P.ChartType.$EnumMember===_.LINE_CHARTTYPE){if(P&&P.AxisScaling&&P.AxisScaling.RecordType=="com.sap.vocabularies.UI.v1.ChartAxisScalingType"){var He=P.AxisScaling;if(He.AutoScaleBehavior&&He.AutoScaleBehavior.RecordType=="com.sap.vocabularies.UI.v1.ChartAxisAutoScaleBehaviorType"){var Ge=He.AutoScaleBehavior;if(Ge.ZeroAlwaysVisible&&Ge.ZeroAlwaysVisible=="true"){w.plotArea.adjustScale=false;ze=true}else if(Ge.DataScope){w.plotArea.adjustScale=true;ze=true}}else if(He.RecordType=="com.sap.vocabularies.UI.v1.ChartAxisScalingType"&&He.ScaleBehavior&&He.ScaleBehavior.$EnumMember){var Xe=He.ScaleBehavior.$EnumMember;var qe=Xe.substring(Xe.lastIndexOf("/")+1,Xe.length);if(qe=="FixedScale"){je=true}}}else if(P&&P.AxisScaling&&P.AxisScaling.$EnumMember){var We=P.AxisScaling.$EnumMember.substring(P.AxisScaling.$EnumMember.lastIndexOf("/")+1,P.AxisScaling.$EnumMember.length);switch(We){case"AdjustToDataIncluding0":w.plotArea.adjustScale=false;ze=true;break;case"AdjustToData":w.plotArea.adjustScale=true;ze=true;break;case"MinMaxValues":je=true;break;default:break}}if(je){var Qe=[];if(P["MeasureAttributes"][0]&&P["MeasureAttributes"][0].DataPoint&&P["MeasureAttributes"][0].DataPoint.$AnnotationPath){var Je=P["MeasureAttributes"][0].DataPoint.$AnnotationPath;var Ze=Je.substring(Je.lastIndexOf("@")+1,Je.length);if(g&&g[Ze]){var et=g[Ze];if(et&&et.MaximumValue&&et.MinimumValue){Qe.push({feed:"valueAxis",max:et.MaximumValue,min:et.MinimumValue});ze=true}else{N.error(E.ERROR_MISSING_AXISSCALES)}}}if(P.ChartType.$EnumMember!==_.LINE_CHARTTYPE&&P["MeasureAttributes"][1]&&P["MeasureAttributes"][1].DataPoint&&P["MeasureAttributes"][1].DataPoint.$AnnotationPath){var Je=P["MeasureAttributes"][1].DataPoint.$AnnotationPath;var Ze=Je.substring(Je.lastIndexOf("@")+1,Je.length);if(g&&g[Ze]){var et=g[Ze];if(et&&et.MaximumValue&&et.MinimumValue){Qe.push({feed:"valueAxis2",max:et.MaximumValue,min:et.MinimumValue});ze=true}else{N.error(E.ERROR_MISSING_AXISSCALES)}}}t.setVizScales(Qe)}}z=I.slice();j=L.slice();var tt=0;var at=0;var rt;var it;var nt=false;var ot=false;var st;var lt=[];var ut=[],ft=[];if((O==="column"||O==="bar"||O==="vertical_bullet")&&D.feeds&&D.feeds.length>0){var vt;for(vt=0;vt<D.feeds.length;vt++){if(D.feeds[vt].uid==="color"){D.feeds.splice(vt,1);break}}for(vt=0;vt<D.feeds.length;vt++){if(D.feeds[vt].uid==="categoryAxis"){delete D.feeds[vt].role;break}}if(p.getProperty("/colorPalette")){for(vt=0;vt<D.feeds.length;vt++){if(D.feeds[vt].uid==="categoryAxis"){D.feeds[vt].role="Category";break}}D.feeds.push({uid:"color",min:1,type:"dimension",role:"Series"})}}v(D.feeds,function(a,r){var i=r.uid;var n=[];if(r.type){var u,f,c;if(r.type==="dimension"){u=I.length;f="Dimension";c="dimensions";B=z;H=W}else{u=L.length;f="Measure";c="measures";B=j;H=Q}var d=0,m=u;if(r.min){d=d>r.min?d:r.min}if(r.max){m=m<r.max?m:r.max}if(!r.role){var P=B.length;for(var A=0;A<P&&n.length<m;++A){var b=B[A];B.splice(A,1);--P;--A;n.push(b);var C=M(ve,b,f);if(pe[C][_.UNIT_KEY_V4_ISOCurrency]){st=pe[C][_.UNIT_KEY_V4_ISOCurrency].$Path?pe[C][_.UNIT_KEY_V4_ISOCurrency].$Path:undefined}else if(pe[C][_.UNIT_KEY_V4_Unit]){st=pe[C][_.UNIT_KEY_V4_Unit].$Path?pe[C][_.UNIT_KEY_V4_Unit].$Path:undefined}else if(pe[C][_.UNIT_KEY]){st=pe[C][_.UNIT_KEY]}if(e.isMeasureCurrency(pe,st)){nt=true}else{ot=true}if(!nt){tt=e.checkNumberFormat(tt,b,g,true);rt=e.getMaxScaleFactor(rt,b,g,true)}else{at=e.checkNumberFormat(at,b,g,true);it=e.getMaxScaleFactor(it,b,g,true)}}}else{var R=r.role.split("|");v(R,function(t,a){if(n.length===m){return false}var r=B.length;for(var i=0;i<r&&n.length<m;++i){var o=B[i];if(o&&o.Role&&o.Role.$EnumMember&&o.Role.$EnumMember.split("/")&&o.Role.$EnumMember.split("/")[1]){var s=o.Role.$EnumMember.split("/")[1];if(s===a){B.splice(i,1);--r;--i;n.push(o);var l=M(ve,o,f);if(pe[l][_.UNIT_KEY_V4_ISOCurrency]){st=pe[l][_.UNIT_KEY_V4_ISOCurrency].$Path?pe[l][_.UNIT_KEY_V4_ISOCurrency].$Path:undefined}else if(pe[l][_.UNIT_KEY_V4_Unit]){st=pe[l][_.UNIT_KEY_V4_Unit].$Path?pe[l][_.UNIT_KEY_V4_Unit].$Path:undefined}else if(pe[l][_.UNIT_KEY]){st=pe[l][_.UNIT_KEY]}if(e.isMeasureCurrency(pe,st)){nt=true}else{ot=true}if(!nt){tt=e.checkNumberFormat(tt,o,g,true);rt=e.getMaxScaleFactor(rt,o,g,true)}else{at=e.checkNumberFormat(at,o,g,true);it=e.getMaxScaleFactor(it,o,g,true)}}}else if((H?Array.prototype.indexOf.call(H,o):-1)===-1){H.push(o)}}});if(n.length<m){v(H,function(t,a){var r;var i;if((r=D[c].defaultRole)&&(R?Array.prototype.indexOf.call(R,r):-1)!==-1&&(i=(B?Array.prototype.indexOf.call(B,a):-1)!==-1)){B.splice(i,1);n.push(a);var o=M(ve,a,f);if(pe[o][_.UNIT_KEY_V4_ISOCurrency]){st=pe[o][_.UNIT_KEY_V4_ISOCurrency].$Path?pe[o][_.UNIT_KEY_V4_ISOCurrency].$Path:undefined}else if(pe[o][_.UNIT_KEY_V4_Unit]){st=pe[o][_.UNIT_KEY_V4_Unit].$Path?pe[o][_.UNIT_KEY_V4_Unit].$Path:undefined}else if(pe[o][_.UNIT_KEY]){st=pe[o][_.UNIT_KEY]}if(e.isMeasureCurrency(pe,st)){nt=true}else{ot=true}if(!nt){tt=e.checkNumberFormat(tt,a,g,true);rt=e.getMaxScaleFactor(rt,a,g,true)}else{at=e.checkNumberFormat(at,a,g,true);it=e.getMaxScaleFactor(it,a,g,true)}if(n.length===m){return false}}})}if(n.length<d){N.error(E.CARD_ERROR+E.MIN_FEEDS+O+" "+E.FEEDS_OBTAINED+n.length+" "+E.FEEDS_REQUIRED+d+" "+E.FEEDS);return false}}if(n.length){var x=[];var V;if(!(V=t.getDataset())){N.error(E.NO_DATASET);return false}S=g;v(n,function(a,r){if((!r||!r[f]||!r[f].$PropertyPath)&&(!r.DynamicMeasure||!r.DynamicMeasure.$AnnotationPath)){N.error(E.INVALID_CHART_ANNO);return false}var n=M(ve,r,f);var l=n;var u=n;var v=null;if(pe&&pe[n]){if(pe[n]["annotations"]){if(pe[n]["annotations"]["@"+_.LABEL_KEY_V4]){if(pe[n]["annotations"]["@"+_.LABEL_KEY_V4]instanceof String&&pe[n]["annotations"]["@"+_.LABEL_KEY_V4]){l=T.getLabelFromAnnotationPath(pe[n]["annotations"]["@"+_.LABEL_KEY_V4],t,pe)}else if(pe[n]["annotations"]["@"+_.LABEL_KEY_V4].$Path){l=pe[n]["annotations"]["@"+_.LABEL_KEY_V4].$Path}else{l=pe[n]["annotations"]["@"+_.LABEL_KEY_V4]}}else if(pe[n]["annotations"]["@"+_.LABEL_KEY]){l=pe[n]["annotations"]["@"+_.LABEL_KEY]}else if(n){l=n}if(pe[n]["annotations"]["@"+_.TEXT_KEY_V4]){u=pe[n]["annotations"]["@"+_.TEXT_KEY_V4].$String?pe[n]["annotations"]["@"+_.TEXT_KEY_V4].$String:pe[n]["annotations"]["@"+_.TEXT_KEY_V4].$Path}else if(pe[n]["annotations"]["@"+_.TEXT_KEY]){u=pe[n]["annotations"]["@"+_.TEXT_KEY]}}else if(n){u=n}v=pe[n].$Type||null}var c;if((v==="Edm.DateTime"||v==="Edm.DateTimeOffset")&&u===n){c="{= ${"+n+"} ? ${"+n+"} : ''}"}else{if(pe[n]&&pe[n]["annotations"]&&pe[n]["annotations"]["@"+_.TEXT_KEY_V4]&&pe[n]["annotations"]["@"+_.TEXT_KEY_V4+"@"+_.TEXT_ARRANGEMENT_ANNO]){var g,d;g=pe[n]["annotations"]["@"+_.TEXT_KEY_V4+"@"+_.TEXT_ARRANGEMENT_ANNO];d=g&&g.$EnumMember;if(!d){g=pe[n]["annotations"]["@"+_.TEXT_KEY_V4]["@"+_.TEXT_ARRANGEMENT_ANNO];d=g&&g.$EnumMember}if(!d){var m=S;g=m&&m["@"+_.TEXT_ARRANGEMENT_ANNO];d=g&&g.$EnumMember}var P;switch(d){case"com.sap.vocabularies.UI.v1.TextArrangementType/TextFirst":c="{"+u+"}"+" "+"("+"{"+n+"}"+")";if(Ee&&_e.length){P=y.getPropertyTextColumnMap(n,u,_e);for(var A in P){P[A]=P[A]+" "+"("+A+")"}J[n]=P}break;case"com.sap.vocabularies.UI.v1.TextArrangementType/TextLast":c="{"+n+"}"+" "+"("+"{"+u+"}"+")";if(Ee&&_e.length){P=y.getPropertyTextColumnMap(n,u,_e);for(var b in P){P[b]=b+" "+"("+P[b]+")"}J[n]=P}break;case"com.sap.vocabularies.UI.v1.TextArrangementType/TextOnly":c="{"+u+"}";if(Ee&&_e.length){J[n]=y.getPropertyTextColumnMap(n,u,_e)}break;case"com.sap.vocabularies.UI.v1.TextArrangementType/TextSeperate":c="{"+n+"}"+" "+"("+"{"+u+"}"+")";break;default:c="{"+n+"}";break}}else{c="{"+u+"}"}if(p&&p.getProperty("/bInsightEnabled")){h.setDimensionPath(p.getData().cardId,n,c)}}x.push(l);if(f==="Dimension"){if(i==="waterfallType"){var C=new o({name:l,value:"{"+n+"}"})}else{var C=new o({name:l,value:"{"+n+"}",displayValue:c})}var O=pe[n][_.SEMANTICS_KEY];var R=e.isV4TimeSeriesSemantics(t.getModel(),ue,n,true);if(Z&&(v==="Edm.DateTime"||R||v==="Edm.DateTimeOffset"||O&&O.lastIndexOf("year",0)===0)){C.setDataType("date")}V.addDimension(C);if((ft?Array.prototype.indexOf.call(ft,l):-1)===-1){ft.push(l)}}else{V.addMeasure(new s({name:l,value:"{"+n+"}"}));if((ut?Array.prototype.indexOf.call(ut,l):-1)===-1&&i!="bubbleWidth"){ut.push(l)}}});t.addFeed(new l({uid:i,type:f,values:x}));if(i==="categoryAxis"){w[i]={title:{visible:be?false:true,text:x.join(", ")},label:{formatString:nt?"CURR":"axisFormatter",truncatedLabelRatio:.15}}}else{w[i]={title:{visible:be?false:true,text:x.join(", ")},label:{formatString:nt?"CURR":"axisFormatter"}}}lt.push(w[i]);if(D.hasOwnProperty("vizProperties")){var Y=0;var $=D.vizProperties.length;var U;var F;for(;Y<$;Y++){if(D.vizProperties[Y].hasOwnProperty("value")){F=D.vizProperties[Y].value}if(D.vizProperties[Y].hasOwnProperty("path")){U=D.vizProperties[Y].path.split(".");var K=U.length;var k,G;var X;for(var q=0,X=U[0],k=w,G=Pe;q<K;++q){if(q===K-1){if(G&&G.hasOwnProperty(X)){if(O==="donut"&&(G[X]==="value"||G[X]==="percentage")){F=G[X]}else if(O!="donut"){F=G[X]}}if(ze&&X!="adjustScale"||!ze&&X==="adjustScale"||!ze&&X!="adjustScale"){k[X]=F}break}k[X]=k[X]||{};k=k[X];if(G){G[X]=G[X]||{};G=G[X]}X=U[q+1]}}}}if(r.hasOwnProperty("vizProperties")){var a=0;var ee=r.vizProperties.length;var te;var ae;var re;for(;a<ee;a++){if(r.vizProperties[a].hasOwnProperty("method")){ae=r.vizProperties[a].method;switch(ae){case"count":te=x.length;if(r.vizProperties[a].hasOwnProperty("min")&&te<=r.vizProperties[a].min){te=r.vizProperties[a].min}else if(r.vizProperties[a].hasOwnProperty("max")&&te>=r.vizProperties[a].max){te=r.vizProperties[a].max}break;default:break}}else if(r.vizProperties[a].hasOwnProperty("value")){te=r.vizProperties[a].value}if(r.vizProperties[a].hasOwnProperty("path")){re=r.vizProperties[a].path.split(".");var ie=re.length;for(var A=0,ne=re[0],oe=w;A<ie;++A){if(A===ie-1){oe[ne]=te;break}oe[ne]=oe[ne]||{};oe=oe[ne];ne=re[A+1]}}}}}}});var ct=t.getFeeds();if(D.properties&&D.properties.semanticPattern===true&&y.getMeasureDimCheck(ct,O)){v(ct,function(e,a){if(ct[e].getType()==="Measure"&&(ct[e].getUid()==="valueAxis"||ct[e].getUid()==="actualValues")){var r;v(L,function(t,a){var i=M(ve,a);var n=y.getSapLabel(i,pe);if(n===ct[e].getValues()[0]){r=y.checkForecastMeasure(a,g);return false}});if(r){var i=y.getSapLabel(r.Measure.$PropertyPath,pe);var n=g[r.DataPoint.$AnnotationPath].ForecastValue.PropertyPath||g[r.DataPoint.$AnnotationPath].ForecastValue.Path;var o=y.getSapLabel(n,pe);var l=u.getText("ACTUAL",[i]);var f=u.getText("FORECAST",[o]);w.plotArea.dataPointStyle={rules:[{dataContext:{MeasureNamesDimension:i},properties:{color:"sapUiChartPaletteSequentialHue1Light1",lineType:"line",lineColor:"sapUiChartPaletteSequentialHue1Light1"},displayName:l},{dataContext:{MeasureNamesDimension:o},properties:{color:"sapUiChartPaletteSequentialHue1Light1",lineType:"dotted",lineColor:"sapUiChartPaletteSequentialHue1Light1",pattern:"diagonalLightStripe"},displayName:f}]};t.getDataset().addMeasure(new s({name:o,value:"{"+n+"}"}));var c=ct[e].getValues();c.push(o);ct[e].setValues(c)}return false}})}var pt=false;if(xe&&xe.dimensionSettings&&Object.keys(xe.dimensionSettings).length>0){var gt=Object.keys(xe.dimensionSettings);for(var ht=0;ht<gt.length;ht++){var dt=gt[ht];var mt=xe.dimensionSettings[dt];if(Object.keys(mt).length>10){pt=true;break}}}if(Ie&&Ee&&!Boolean(pt)){var Pt=[];var At=true;for(var ht=0;ht<I.length;ht++){var yt=I[ht].Dimension.$PropertyPath;Pt.push(yt)}for(var ht=0;ht<Pt.length;ht++){var dt=Pt[ht];if(gt.indexOf(dt)>-1){var Tt=xe.dimensionSettings[dt];var _t=Object.keys(Tt);var Et=[];for(var ht=0;ht<_t.length;ht++){var bt=Tt[_t[ht]];Et.push(bt)}At=At&&Et.every(X)}}if(At){var Ct=[];for(var ht=0;ht<Pt.length;ht++){var dt=Pt[ht];if(gt.indexOf(dt)>-1){var Tt=xe.dimensionSettings[dt];var _t=Object.keys(Tt);var Et=[];for(var ht=0;ht<_t.length;ht++){var bt=Tt[_t[ht]];Et.push(bt)}y._sortColorsByIndex(Et);for(var St=0;St<Et.length;St++){var Nt=Et[St].dimensionValue;var Ot=Et[St].color;var bt={properties:{color:Ot}};bt.dataContext={};var Mt=U(pe,t,dt);bt.dataContext[Mt]=Nt;var Rt=J[dt]?J[dt][Nt]:Nt;bt.displayName=Rt;Ct.push(bt)}}}w.plotArea.dataPointStyle=w.plotArea.dataPointStyle||{};w.plotArea.dataPointStyle["rules"]=Ct}else{var Ct=[];for(var ht=0;ht<Pt.length;ht++){var dt=Pt[ht];if(gt.indexOf(dt)>-1){var Tt=xe.dimensionSettings[dt];var _t=Object.keys(Tt);var Et=[];for(var ht=0;ht<_t.length;ht++){var bt=Tt[_t[ht]];Et.push(bt)}y._sortColorsByIndex(Et);var Dt=Et.map(q)}}w.legend.order=function(e,t){var a=Dt.indexOf(e);var r=Dt.indexOf(t);return a>r?1:-1}}}if(D.properties&&D.properties.semanticPattern===true&&y.getMeasureDimCheck(ct,O)&&t.getVizType()==="vertical_bullet"){v(ct,function(e,a){if(ct[e].getType()==="Measure"&&(ct[e].getUid()==="valueAxis"||ct[e].getUid()==="actualValues")){var r;v(L,function(t,a){var i=y.getSapLabel(a.Measure.PropertyPath,pe);if(i===ct[e].getValues()[0]){r=y.checkTargetMeasure(a,g);return false}});if(r){var i=g[r.DataPoint.$AnnotationPath].TargetValue.PropertyPath||g[r.DataPoint.$AnnotationPath].TargetValue.Path;var n=y.getSapLabel(i,pe);t.getDataset().addMeasure(new s({name:n,value:"{"+i+"}"}));t.addFeed(new l({uid:"targetValues",type:"Measure",values:[n]}))}return false}})}if(nt&&ot){N.warning(u.getText("Currency_non_currency_measure"))}v(ct,function(e,t){var a=t.getProperty("type");if(a==="Measure"){var r=t.getProperty("values");var i=true;var n=P.MeasureAttributes.filter(function(e){var t=M(ve,e,a);var i=pe[t];return Object.keys(i).length>0&&r.indexOf(t)>=0});v(n,function(e,t){if(Y(pe,t,a,ve)||$(pe,t,a,ve)){i=false}else{i=true;return false}});if(!i){w[t.getProperty("uid")]["label"]["allowDecimals"]=false}}});var It;if(it===undefined){it=""}if(rt===undefined){rt=""}if(nt){It=y.getScaleUnit(it,nt)}else{It=y.getScaleUnit(rt,nt)}if(a){a.setScale(It)}var xt=k(ut,ft,ge);var Vt="";v(ct,function(e,t){var a="-1";var r=t.getProperty("type");if(r==="Measure"){var i=lt.filter(function(e){var a=e["title"]["text"].split(",").filter(function(e){if(t.getValues().indexOf(e.trim())>=0){return true}else{return false}});if(a.length>0){return true}else{return false}});if(i&&i.length){var n=t.getValues();if(n&&n.length){v(n,function(e,t){var i=t.trim();var n=L.filter(function(e){if(e["Measure"]&&e["Measure"]["PropertyPath"]){var t=e["Measure"]["PropertyPath"];if(pe[t]&&pe[t][_.LABEL_KEY]===i||pe[t]&&pe[t][_.LABEL_KEY_V4]===i){return true}else{return false}}});if(n&&n.length){var o=n[0];if(!Y(pe,o,r,ve)&&!$(pe,o,r,ve)){var s="";if(o&&o["DataPoint"]&&o["DataPoint"]["AnnotationPath"]&&o["DataPoint"]["AnnotationPath"]){s=o["DataPoint"]["AnnotationPath"]&&o["DataPoint"]["AnnotationPath"].substring(1);if(s!=""){var l;l=g[s]&&g[s]["ValueFormat"]&&g[s]["ValueFormat"]["NumberOfFractionalDigits"]&&g[s]["ValueFormat"]["NumberOfFractionalDigits"]["Int"];a=l>a?l:a}}}else{a=a<"0"?"0":a}}})}}if(i&&i[0]&&i[0].label&&i[0].label.formatString){var o=i[0].label.formatString}Vt="";if(nt){if(o==="CURR"){Vt="CURR/"+a.toString()+"/"}else{Vt="axisFormatter/"+a.toString()+"/"}}else{Vt="axisFormatter/"+a.toString()+"/"}if(i&&i[0]){i[0].label.formatString=Vt}}});if(O==="vertical_bullet"){w["valueAxis"]={title:{visible:be?false:true},label:{formatString:Vt}}}var Yt="";var $t="";if(nt){Yt=at.toString();$t="CURR/"+at.toString()+"/"}else{Yt=tt.toString();$t="axisFormatter/"+tt.toString()+"/"}if(O==="donut"||A){w.plotArea.dataLabel.formatString=$t;if(w.plotArea.dataLabel.type==="percentage"){w.plotArea.dataLabel.formatString="0.0%/"+Yt+"/"}}y._checkRolesForProperty(z,D,"dimension");y._checkRolesForProperty(j,D,"measure");if(Z){var Lt=I[0].Dimension.$PropertyPath;var Ut=t.getModel().getMetaModel().getObject("/"+ue+"/"+Lt+"@");if(Ut["@com.sap.vocabularies.Common.v1.IsCalendarYearMonth"]){w.timeAxis.levels=["year","month"]}else if(Ut["@com.sap.vocabularies.Common.v1.IsCalendarYearQuarter"]){w.timeAxis.levels=["year","quarter"]}else if(Ut["@com.sap.vocabularies.Common.v1.IsCalendarYearWeek"]){w.timeAxis.levels=["year","week"]}else if(Ut["@com.sap.vocabularies.Common.v1.IsCalendarYear"]){w.timeAxis.levels=["year"]}}w.title={text:ge?ge:xt,alignment:"left",layout:{respectPlotPosition:false},style:{fontFamily:"72, 72full, Arial, Helvetica, sans-serif !important",fontSize:".875rem",fontWeight:"normal"}};t.setVizProperties(w);if(p&&p.getProperty("/bInsightEnabled")){var Ft=t&&t.getId();var Kt=c({},w);if(we!==undefined){Kt.plotArea.dataPointStyle=we}h.setVizPropertyMap(Ft,Kt)}}function U(e,t,a){var r="";if(e&&e[a]){if(e[a].annotations&&e[a].annotations["@"+_.LABEL_KEY_V4]){r=T.getLabelFromAnnotationPath(e[a].annotations["@"+_.LABEL_KEY_V4],t,e)}else if(e[a][_.LABEL_KEY]){r=e[a][_.LABEL_KEY]}else if(a){r=a}}return r}function F(t,a,r){var i="";var n=t&&t["@"+a]&&t["@"+a].Title;if(n){i=n}return e.resolvei18nKeyToChartTitle(r,i)}function K(t,a,r){if(t&&(t.getVizType()==="bubble"||t.getVizType()==="scatter")){return}var i,n,o,s;var l;var f=_.UNIT_KEY;var c="@"+_.UNIT_KEY_V4_ISOCurrency;var p="@"+_.UNIT_KEY_V4_Unit;var g;var h=[];if(!(i=t.getModel("ovpCardProperties"))){N.error(E.CARD_ERROR+"in "+E.CARD_CONFIG+E.NO_CARD_MODEL);return}var d=t.getModel();var m=i.getProperty("/entitySet");if(!d||!m){return}n=r[i.getProperty("/entityType").$Type];if(!n){N.error(E.CARD_ANNO_ERROR+"in "+E.CARD_ANNO);return}var P=e.getMetadata(d,m);o=i.getProperty("/chartAnnotationPath");if(!o||!(s=n["@"+o])){N.error(E.CARD_ANNO_ERROR+"in "+E.CARD_ANNO);return}if(!(l=s.MeasureAttributes)||!l.length){N.error(E.CHART_ANNO_ERROR+"in "+E.CHART_ANNO+" "+E.MEASURES_MANDATORY);return}v(l,function(e,t){g=M(n,t);if(t.DataPoint&&t.DataPoint.$AnnotationPath){var a=n[t.DataPoint.$AnnotationPath];if(a&&a.ForecastValue&&(a.ForecastValue.PropertyPath||a.ForecastValue.Path)){h.push(a.ForecastValue.PropertyPath||a.ForecastValue.Path)}}h.push(g)});var A=a?a:null;var y="";var T=true;var b=[];var C=t.getFeeds();v(C,function(e,t){if(t.getType()==="Measure"){b=b.concat(t.getValues())}});if(A){v(h,function(e,a){var r=U(P,t,a);if((b?Array.prototype.indexOf.call(b,r):-1)!=-1){if(P&&P[a]){var i;if(P[a].annotations[c]){i=P[a].annotations[c].$Path?P[a].annotations[c].$Path:P[a].annotations[c].$String}else if(P[a].annotations[p]){i=P[a].annotations[p].$Path?P[a].annotations[p].$Path:P[a].annotations[p].$String}else if(P[a][f]){i=P[a][f]}if(!i){T=false;return false}if(i&&P[i]){for(var e=0;e<A.length;e++){var n=A[e];if(T){if(y&&n[i]&&n[i]!=""&&y!=""&&y!=n[i]){T=false;break}}y=n[i];if(!y){T=false;break}}}}}})}var S="";if(T){if(y!=""){S=u.getText("IN_NO_SCALE",[y]);S=" "+S}var O=t.data("aria-label");if(O&&S&&O.indexOf(S)===-1){var R=O+S;t.data("aria-label",R,true)}var D=t.getVizProperties().title&&t.getVizProperties().title.text;if(D){var I=D.indexOf("|");if(I!==-1){var x=D.slice(I+2);if(x!==y){D=D.slice(0,I-1)}}var V={title:{visible:true,text:x===y?D:D+S,alignment:"left",layout:{respectPlotPosition:false},style:{fontFamily:"72, 72full, Arial, Helvetica, sans-serif !important",fontSize:".875rem",fontWeight:"normal"}}};t.setVizProperties(V)}}}function k(e,t,a){var r="",i="",n="";if(a){r=a}if(e&&e.length>1){for(var o=0;o<e.length-1;o++){if(i!=""){i+=", "}i+=e[o]}i=u.getText("MEAS_DIM_TITLE",[i,e[o]])}else if(e){i=e[0]}if(t&&t.length>1){for(var o=0;o<t.length-1;o++){if(n!=""){n+=", "}n+=t[o]}n=u.getText("MEAS_DIM_TITLE",[n,t[o]])}else if(t){n=t[0]}if(r===""){a=u.getText("NO_CHART_TITLE",[i,n])}return a}function w(r,o){r.attachSelectData(function(s){var l=f.bCRTLPressed?f.constants.explace:f.constants.inplace;f.bCRTLPressed=false;var u=r.getModel("ovpCardProperties");var c=r.getModel();var p=u.getProperty("/entitySet");var g=e.getMetadata(c,p);var h=[],m=[];var P={},A={};var y=r.getDataset().getDimensions();var T;var E=u.getProperty("/entityType");var b=o.getMetaModel().getData()["$Annotations"];for(var C=0;C<y.length;C++){h.push(y[C].getName())}var S=r.getDataset().getBinding("data").getCurrentContexts().map(function(e){return e.getObject()});if(s.getParameter("data")&&s.getParameter("data")[0]&&s.getParameter("data")[0].data){m=Object.keys(s.getParameter("data")[0].data);T=s.getParameter("data")[0].data._context_row_number;var N=r.getDataset().getBinding("data").getContexts()[T];var O=d.getEntityNavigationEntries(N,c,o.getEntityType(),o.getCardPropertiesModel())[0];if(S[T].$isOthers&&S[T].$isOthers===true){var M={},R=[];for(var D=0;D<h.length;D++){for(var I=0;I<m.length;I++){if(h[D]===m[I]){for(var x in g){if(g.hasOwnProperty(x)){var V=g[x][_.LABEL_KEY]||g[x][_.NAME_KEY]||g[x][_.NAME_CAP_KEY];if(V===m[I]){R.push(x)}}}}}}for(var C=0;C<R.length;C++){M[R[C]]=[];for(var D=0;D<S.length-1;D++){if(D!=T){M[R[C]].push(S[D][R[C]])}}}var Y={$isOthers:true};var $={getObject:function(){return Y},getOtherNavigationDimensions:function(){return M}};if(n.checkIfAPIIsUsed(o)){if(o.checkAPINavigation()){i.onContentClicked($)}}else{if(O){r.vizSelection([],{clearSelection:true});o.doNavigation($,O,l)}}}else{for(var D=0;D<h.length;D++){for(var I=0;I<m.length;I++){if(h[D]===m[I]){for(var x in g){if(b[E.$Type+"/"+x]){var V=typeof b[E.$Type+"/"+x]["@"+_.LABEL_KEY_V4]==="string"&&b[E.$Type+"/"+x]["@"+_.LABEL_KEY_V4]||b[E.$Type+"/"+x][_.LABEL_KEY]||b[E.$Type+"/"+x][_.NAME_KEY]||b[E.$Type+"/"+x][_.NAME_CAP_KEY]||x;if(V.match(/{@i18n>.+}/gi)){var L=this.getModel("@i18n").getResourceBundle();V=L.getText(V.substring(V.indexOf(">")+1,V.length-1))}if(V===m[I]){P[x]=S[T][x]}}}}for(var x in S[T]){if(g.hasOwnProperty(x)){A[x]=S[T][x]}}}}if(P){v(Object.keys(P),function(e,t){var r=g[t]&&g[t]["annotations"];if(g[t]["$Type"]==="Edm.String"){if(g[t]["sap:semantics"]==="yearmonth"||r&&r["@com.sap.vocabularies.Common.v1.IsCalendarYearMonth"]){P[t]=P[t].constructor===Date?a.getDateTimeInstance({pattern:"YYYYMM"}).format(P[t]):P[t]}else if(g[t]["sap:semantics"]==="yearquarter"||r&&r["@com.sap.vocabularies.Common.v1.IsCalendarYearQuarter"]){P[t]=P[t].constructor===Date?a.getDateTimeInstance({pattern:"YYYYQ"}).format(P[t]):P[t]}else if(g[t]["sap:semantics"]==="yearweek"||r&&r["@com.sap.vocabularies.Common.v1.IsCalendarYearWeek"]){P[t]=P[t].constructor===Date?a.getDateTimeInstance({pattern:"YYYYww"}).format(P[t]):P[t]}else if(g[t]["@com.sap.vocabularies.Common.v1.IsFiscalYearPeriod"]){var i=P[t];if(i.includes(".")){P[t]=i.split(".").reverse().join("")}else if(i.includes("/")){P[t]=i.split("/").reverse().join("")}}}})}if(A){v(Object.keys(A),function(e,t){var r=g[t]&&g[t]["annotations"];if(g[t]["$Type"]==="Edm.String"){if(g[t]["sap:semantics"]==="yearmonth"||r&&r["@com.sap.vocabularies.Common.v1.IsCalendarYearMonth"]){A[t]=A[t].constructor===Date?a.getDateTimeInstance({pattern:"YYYYMM"}).format(A[t]):A[t]}else if(g[t]["sap:semantics"]==="yearquarter"||r&&r["@com.sap.vocabularies.Common.v1.IsCalendarYearQuarter"]){A[t]=A[t].constructor===Date?a.getDateTimeInstance({pattern:"YYYYQ"}).format(A[t]):A[t]}else if(g[t]["sap:semantics"]==="yearweek"||r&&r["@com.sap.vocabularies.Common.v1.IsCalendarYearWeek"]){A[t]=A[t].constructor===Date?a.getDateTimeInstance({pattern:"YYYYww"}).format(A[t]):A[t]}else if(g[t]["@com.sap.vocabularies.Common.v1.IsFiscalYearPeriod"]){var i=A[t];if(i.includes(".")){A[t]=i.split(".").reverse().join("")}else if(i.includes("/")){A[t]=i.split("/").reverse().join("")}}}})}var U=E[u.getProperty("/presentationAnnotationPath")];if(E){var F=t.getRequestFields(U);if(F&&F.length>0){v(F,function(e,t){if(!P.hasOwnProperty(t)){P[t]=S[T][t]}})}}var $={getObject:function(){return P},getAllData:function(){return A}};if(n.checkIfAPIIsUsed(o)){if(o.checkAPINavigation()){i.onContentClicked($)}}else{if(O){r.vizSelection([],{clearSelection:true});o.doNavigation($,O,l)}}}}})}function B(e){return e.$EnumMember.endsWith("Bubble")}function z(e){var t=false;if(!e||e.constructor!=Array||e.length<1||e[0].constructor!=Object||!e[0].Dimension||!e[0].Dimension.$PropertyPath){N.error(E.CHART_ANNO_ERROR+"in "+E.CHART_ANNO+" "+E.DIMENSIONS_MANDATORY);return t}t=true;return t}function j(e){var t=false;var a=e[0].Measure&&e[0].Measure.$PropertyPath;var r=e[0].DynamicMeasure&&e[0].DynamicMeasure.$AnnotationPath;if(!e||e.constructor!=Array||e.length<1||e[0].constructor!=Object||!a&&!r){N.error(E.CHART_ANNO_ERROR+"in "+E.CHART_ANNO+" "+E.MEASURES_MANDATORY);return t}t=true;return t}function H(e){e=e["$Type"];return e}function G(e,t,a){var r=e.getMetaModel().getData().$Annotations;for(var i in t){if(r[a+"/"+i]&&!t[i]["annotations"]){t[i]["annotations"]=r[a+"/"+i]}}}function X(e){return e.color!==undefined}function q(e){return e.dimensionValue}return{constants:_,errorMessages:E,formatItems:O,checkNoData:I,checkFlag:x,buildVizAttributes:L,setChartUoMTitle:K,getSelectedDataPoint:w,checkBubbleChart:B,dimensionAttrCheck:z,measureAttrCheck:j,getEntitySet:H,formGroupByList:D,getChartTitle:F}},true);
//# sourceMappingURL=VizAnnotationManager.js.map