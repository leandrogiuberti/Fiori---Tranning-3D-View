/*!
 * Copyright (c) 2009-2014 SAP SE, All Rights Reserved
 */
sap.ui.define(["sap/ovp/cards/generic/base/analytical/BaseAnalyticalChart.controller","sap/ovp/cards/v4/charts/VizAnnotationManager","sap/ovp/cards/charts/VizAnnotationManager","sap/ovp/cards/OVPCardAsAPIUtils","sap/ovp/app/resources","sap/base/util/each","sap/ovp/cards/Filterhelper","sap/ovp/cards/generic/base/analytical/Utils","sap/ovp/filter/FilterUtils","sap/ui/Device","sap/ui/model/json/JSONModel"],function(t,e,a,i,r,s,o,n,l,d,h){"use strict";return t.extend("sap.ovp.cards.charts.v4.analytical.analyticalChart",{onInit:function(){t.prototype.onInit.apply(this,arguments);var e=new h({error:false});this.getView().setModel(e,"oAnalyticalCardErrorModel")},onAfterRendering:function(){t.prototype.onAfterRendering.apply(this,arguments);if(!i.checkIfAPIIsUsed(this)){var e=this.getCardPropertiesModel();var a=this.getOwnerComponent().getModel("ui").getData().cards;this.selectionVaraintFilter=o.getSelectionVariantFilters(a,e,this.getEntityType())}},onDataReceived:function(t){if(n.checkIfDataExistInEvent(t)){var i=this;var o=this.getView().byId("analyticalChart");var l=this.getView().byId("bubbleText");var p=r.getText("BUBBLESIZE");var c=i.getMetaModel().getData()["$Annotations"];this.oDataSet.bindData("analyticalmodel>/","");o.setDataset(this.oDataSet);var g=o.getParent();if(!this.isVizPropSet){e.buildVizAttributes(o,g,this);this.isVizPropSet=true;if(l!=undefined){var u=o.getFeeds();s(u,function(t,e){if(u[t].getUid()=="bubbleWidth"){l.setText(p+" "+u[t].getValues())}})}a.hideDateTimeAxis(o)}if(this.getCardPropertiesModel()&&this.getCardPropertiesModel().getData()&&this.getCardPropertiesModel().getData().colorPalette&&o.getVizType()==="stacked_column"){var f=o.getDataset().getDimensions(),v=o.getFeeds(),y,b;for(var C=0;C<v.length;C++){if(v[C].getUid()==="color"){y=v[C].getValues()[0];break}}for(var D=0;D<f.length;D++){if(f[D].getName()===y){b=f[D];break}}if(y&&b){var m={};m["bDescending"]=true;b.setSorter(m)}}var M=t?t.getSource().getCurrentContexts().map(function(t){return t&&t.getObject()}):null;e.setChartUoMTitle(o,M,c);if(this.bFlag==true){this.bFlag=false;this.vbLayout.setBusy(false)}else{setTimeout(function(){i.vbLayout.setBusy(false);i.bdataLoadedToEnableAddToInsight=true},0)}if(n.isDataSetEmpty(t)){var P=this.getOwnerComponent().getComponentData().cardId;if(P&&this.oMainComponent.aErrorCards.indexOf(P)===-1){this.oMainComponent.createNoDataCard(P)}}a.checkNoData(t,this.getCardContentContainer(),o);if(d.system.phone){if(this.getCardPropertiesModel().getProperty("/layoutDetail")==="resizable"){var V=this.oDashboardLayoutUtil.dashboardLayoutModel.getCardById(this.cardId);var I=Math.max(V.dashboardLayout.rowSpan,this.iPreviousRowSpan);this.iPreviousRowSpan=I}if(n.isDataSetEmpty(t)){o.setHeight(50+"px")}else{var A=this._calculateVizFrameHeight();if(A!==undefined&&typeof A==="number"){o.setHeight(A+"px")}}}}else if(t&&t.getParameters().error){this.vbLayout.setBusy(false);var S=new h({error:true});this.getView().setModel(S,"oAnalyticalCardErrorModel")}}})});
//# sourceMappingURL=analyticalChart.controller.js.map