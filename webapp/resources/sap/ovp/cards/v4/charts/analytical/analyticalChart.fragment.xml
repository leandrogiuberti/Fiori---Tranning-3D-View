<core:FragmentDefinition 
	xmlns="sap.m"
	xmlns:core="sap.ui.core"
	xmlns:template="http://schemas.sap.com/sapui5/extension/sap.ui.core.template/1"
	xmlns:suite="sap.suite.ui.commons" 
	xmlns:viz="sap.viz.ui5.controls"
	xmlns:dataSet="sap.viz.ui5.data" 
	xmlns:feed="sap.viz.ui5.controls.common.feeds"
	xmlns:ovp="sap.ovp.ui" 
	xmlns:charts="sap.ovp.cards.v4.charts"
	template:require="{
		CardAnnotationhelperV4: 'sap/ovp/cards/v4/V4AnnotationHelper',
		VizAnnotationManagerV2: 'sap/ovp/cards/charts/VizAnnotationManager',
		VizAnnotationManagerV4: 'sap/ovp/cards/v4/charts/VizAnnotationManager',
		ModelAnnotationhelperV4: 'sap/ui/model/odata/v4/AnnotationHelper'
	}" 	
>
	<VBox visible="{= ${oAnalyticalCardErrorModel>/error} === true ? false : true}" class="ovpChartTitleVBox cardType" id="vbLayout">
        <customData>
            <ovp:CustomData key="aria-label" value="{ovplibResourceBundle>analyticalCardType}" writeToDom="true" />
        </customData>
	<template:with 
		path="ovpCardProperties>/chartAnnotationPath"
		helper="CardAnnotationhelperV4.resolveEntityTypePath" 
		var='chart'>
		<template:with 
			path="ovpCardProperties>/selectionAnnotationPath"
			helper="CardAnnotationhelperV4.resolveEntityTypePath" 
			var='selVar'>
			<template:with 
				path="ovpCardProperties>/presentationAnnotationPath"
				helper="CardAnnotationhelperV4.resolveEntityTypePath" 
				var='preVar'>
				<template:if test="{chart>}">
						<!-- FIORITECHP1-4935Reversal of Scale factor in Chart and Chart title. -->
						<!-- <template:if test="{chart>Title}"> -->
                        <!-- </template:if> -->
					<template:if test="{path:'chart>DimensionAttributes', formatter: 'VizAnnotationManagerV4.dimensionAttrCheck'}">
						<template:if test="{path:'chart>MeasureAttributes', formatter: 'VizAnnotationManagerV4.measureAttrCheck'}">
							<template:if test="{chart>ChartType}">
								<template:if test="{preVar>MaxItems}">
									<template:then>
										<charts:OVPVizDataHandler
											chartType="{path: 'chart>ChartType', formatter: 'VizAnnotationManagerV2.getChartType'}"
											entitySet="{ path:'entitySet>' , formatter: 'VizAnnotationManagerV4.getEntitySet' }"
											data="{parts: [{path:'entitySet>'}, {path:'selVar>'}, {path:'preVar>'}, {path:'chart>DimensionAttributes'}, {path:'chart>MeasureAttributes'}, {path:'chart>ChartType'}], formatter: 'VizAnnotationManagerV4.formatItems'}"
											aggregateData="{parts: [{path:'entitySet>'}, {path:'selVar>'}, {path:'preVar>'}, {path:'chart>undefined'}, {path:'chart>MeasureAttributes'}, {path:'chart>ChartType'}], formatter: 'VizAnnotationManagerV4.formatItems'}">
											<charts:data>
												<core:Element />
											</charts:data>
											<charts:aggregateData>
												<core:Element />
											</charts:aggregateData>
											<charts:content width="100%">
												<viz:VizFrame id="analyticalChart" class="ovpViz"
													uiConfig="{applicationSet:'fiori'}"
													vizType="{parts: [{path: 'chart>ChartType'}, {path: 'chart>DimensionAttributes'}], formatter: 'VizAnnotationManagerV2.getChartType'}"
													width="100%">
													<viz:customData>
														<template:if test="{chart>Title}">
															<ovp:CustomData key="aria-label"
																value="{chart>Title@@ModelAnnotationhelperV4.format}"
																writeToDom="true" />
														</template:if>
													</viz:customData>
													<viz:dataset>
														<dataSet:FlattenedDataset data="{analyticalmodel>/}">
														</dataSet:FlattenedDataset>
													</viz:dataset>
												</viz:VizFrame>
											</charts:content>
										</charts:OVPVizDataHandler>
									</template:then>
									<template:else>
										<charts:OVPVizDataHandler
											chartType="{path: 'chart>ChartType', formatter: 'VizAnnotationManagerV2.getChartType'}"
											entitySet="{ path:'entitySet>' , formatter: 'VizAnnotationManagerV4.getEntitySet' }"
											data="{parts: [{path:'entitySet>'}, {path:'selVar>'}, {path:'preVar>'}, {path:'chart>DimensionAttributes'}, {path:'chart>MeasureAttributes'}, {path:'chart>ChartType'}], formatter: 'VizAnnotationManagerV4.formatItems'}">
											<charts:data>
												<core:Element />
											</charts:data>
											<charts:aggregateData>
												<core:Element />
											</charts:aggregateData>
											<charts:content width="100%">
												<viz:VizFrame id="analyticalChart" class="ovpViz"
													uiConfig="{applicationSet:'fiori'}"
													vizType="{parts: [{path: 'chart>ChartType'}, {path: 'chart>DimensionAttributes'}], formatter: 'VizAnnotationManagerV2.getChartType'}"
													width="100%">
													<viz:customData>
														<template:if test="{chart>Title}">
															<ovp:CustomData key="aria-label"
																value="{chart>Title@@ModelAnnotationhelperV4.format}"
																writeToDom="true" />
														</template:if>
													</viz:customData>
													<viz:dataset>
														<dataSet:FlattenedDataset data="{analyticalmodel>/}">
														</dataSet:FlattenedDataset>
													</viz:dataset>
												</viz:VizFrame>
											</charts:content>
										</charts:OVPVizDataHandler>
									</template:else>
								</template:if>
							</template:if>
						</template:if>
					</template:if>
				</template:if>
			</template:with>
		</template:with>
	</template:with>
	</VBox>
	<template:with 
		path="ovpCardProperties>/chartAnnotationPath"
		helper="CardAnnotationhelperV4.resolveEntityTypePath" 
		var='chart'>
		<template:if test="{chart>}">
			<template:if test="{chart>ChartType}">
				<template:if test="{path:'chart>ChartType',formatter:'VizAnnotationManagerV4.checkBubbleChart'}">
					<Text visible="{= ${oAnalyticalCardErrorModel>/error} === true ? false : true}" id="bubbleText" class="ovpChartFooter"/>
				</template:if>
			</template:if>
		</template:if>
	</template:with>
	<IllustratedMessage visible="{= ${oAnalyticalCardErrorModel>/error} === true ? true : false}" illustrationType="sapIllus-UnableToLoad" enableDefaultTitleAndDescription="false" />
</core:FragmentDefinition>