/*!
 * Copyright (c) 2009-2014 SAP SE, All Rights Reserved
 */
sap.ui.define(["sap/ovp/cards/AnnotationHelper","sap/ui/model/odata/AnnotationHelper","sap/ovp/cards/MetadataAnalyser","sap/ovp/cards/Filterhelper"],function(e,t,r,a){"use strict";function n(e){var t=[];var r,a;var n=e.getProperty("/sortBy");if(n){var i=e.getProperty("/sortOrder");if(i&&i.toLowerCase()!=="descending"){a=false}else{a=true}r={path:n,descending:a};t.push(r)}return t}function i(t,i,o){var s=t.getSetting("ovpCardProperties");var f=s.getProperty("/metaModel");var l=e.isODataV4Context(t);var u=l?i:f.getODataEntityType(i.entityType);var d=l?"/"+s.getProperty("/entitySet"):"/"+i.name;var p;var g=s.getProperty("/selectionAnnotationPath");if(l&&g){var c="@"+g;p=f.getData()["$Annotations"][u.$Type][c]}else{p=u[g]}var y;var v=s.getProperty("/layoutDetail");if(v==="resizable"){var P=s.getProperty("/cardLayout");if(P){if(s.getProperty("/listFlavor")==="standard"){var x="";for(var h in o){x+=h}var m=s.getProperty("/cardLayout/iRowHeigthPx");if(m===undefined){m=16}var O;if(s.getProperty("/densityStyle")==="cozy"){O=72;if(x.indexOf("Description")===-1&&(x.indexOf("Title")>0&&x.indexOf("ImageUrl")>0||x.indexOf("Title")>0&&x.indexOf("TypeImageUrl")>0)){O=56}else if(x.indexOf("Description")===-1&&x.indexOf("Title")>0){O=48}}else{O=60;if(x.indexOf("Description")===-1&&(x.indexOf("Title")>0&&x.indexOf("ImageUrl")>0||x.indexOf("Title")>0&&x.indexOf("TypeImageUrl")>0)){O=48}else if(x.indexOf("Description")===-1&&x.indexOf("Title")>0){O=40}}s.setProperty("/cardLayout/itemHeight",O);if(!s.getProperty("/defaultSpan")&&s.getProperty("/cardLayout/autoSpan")){y=s.getProperty("/cardLayout/noOfItems");var I=Math.ceil((y*O+s.getProperty("/cardLayout/headerHeight")+2*s.getProperty("/cardLayout/iCardBorderPx"))/m);s.setProperty("/cardLayout/noOfItems",I)}else{var C=Math.floor(P.rowSpan*m-s.getProperty("/cardLayout/headerHeight")-2*s.getProperty("/cardLayout/iCardBorderPx"));y=Math.floor(C/O)*P.colSpan}}}}else{y=6}var S=t.getSetting("ovpCardProperties"),L=S.getProperty("/parameters");if(p||!!L){if(p&&p.Parameters||!!L){d=r.resolveParameterizedEntitySet(t.getSetting("dataModel"),i,p,L)}}var w="{path: '"+d+"', length: "+y;var D=n(s);if(D.length>0){w=w+", sorter:"+JSON.stringify(D)}var U=a.getFilters(s,p,l);if(U.length>0){U=a.createExcludeFilters(U,s);w=w+", filters:"+JSON.stringify(U)}var T=e.checkFilterPreference(s);if(l){if(T){w=w+", parameters:{custom: {cardId: '"+s.getProperty("/cardId")+"'}}"}}else{if(T){w=w+", parameters:{custom: {cardId: '"+s.getProperty("/cardId")+"', _requestFrom: 'ovp_internal'}}"}else{w=w+", parameters:{custom: {_requestFrom: 'ovp_internal'}}"}}w=w+"}";return w}i.requiresIContext=true;function o(e,t){var r=e.getModel().getProperty("/baseUrl");return g(r,t)}o.requiresIContext=true;function s(e,r){var a=true;var n=t.format(e,r);if(n.toLowerCase().indexOf("icon")>0){a=false}return a}s.requiresIContext=true;function f(e){var t=true;if(!e){return null}else if(e.toLowerCase().indexOf("icon")>0){t=false}return t}function l(e){var t=new RegExp("http(s)?://(www.)?[a-z0-9]+([-.]{1}[a-z0-9]+)*.[a-z]{2,5}(:[0-9]{1,5})?(/.*)?","i");return t.test(e)}function u(t,r){var a=e.isODataV4Context(t);var n;if(!a){if(r.hasOwnProperty("Path")){n="{"+r.Path+"}"}else{n=r.String}}else{if(r.hasOwnProperty("$Path")){n="{"+r.$Path+"}"}else{n=r}}return n}u.requiresIContext=true;function d(t,r){var a=e.isODataV4Context(t);return a?"{"+r+"}":"{"+r.String+"}"}d.requiresIContext=true;function p(e){if(e){return 1}return 0}function g(e,t){if(!t){return undefined}else if(t.lastIndexOf(e,0)===0||t.indexOf("://")>0){return t}else if(t.lastIndexOf("/",0)===0){return e+t}else{return e+"/"+t}}function c(e,t,r){var a;if(typeof r==="object"){a=r[e]}else{a=typeof r==="boolean"?r:true}return!t[e]&&a}function y(e,t,r){var a="";if(e){if(t&&r){a="#"+t+"-"+r;for(var n=0;n<e.length;n++){if(e[n].value===a){return e[n].name}}a=""}else{return e[0].name}}return a}function v(e,t){return g(e.baseUrl,t)}function P(e){return this.getModel("contentRow").aBindings[0].getContext().getPath().replace("/staticContent/","")}function x(t,r){var a=e.isODataV4Context(t);if(!a){return r.Path&&"{"+r.Path+"}"||r.String||""}else{return r.$Path&&"{"+r.$Path+"}"||r||""}}x.requiresIContext=true;return{formatItems:i,formatUrl:o,isImageUrl:s,isImageUrlStaticData:f,isValidURL:l,getIconPath:u,formatString:d,linkedAction:p,formUrl:g,isVisible:c,getApplicationName:y,getImageUrl:v,contentRowIndex:P,getAvatarInitials:x,getSorters:n}},true);
//# sourceMappingURL=AnnotationHelper.js.map