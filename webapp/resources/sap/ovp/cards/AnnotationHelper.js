/*!
 * Copyright (c) 2009-2014 SAP SE, All Rights Reserved
 * Any function that needs to be exported(used outside this file) via namespace should be defined as
 * a function and then added to the return statement at the end of this file
 */
sap.ui.define(["sap/ui/core/format/NumberFormat","sap/ui/core/format/DateFormat","sap/ovp/cards/CommonUtils","sap/ui/model/odata/AnnotationHelper","sap/ui/model/odata/v4/AnnotationHelper","sap/ui/Device","sap/ovp/app/resources","sap/base/i18n/date/CalendarType","sap/base/strings/formatMessage","sap/base/util/isPlainObject","sap/base/util/each","sap/ovp/cards/MetadataAnalyser","sap/base/util/merge","sap/ovp/app/OVPLogger","sap/base/util/isEmptyObject","sap/ovp/cards/PeriodDateFormat","sap/ovp/cards/Constants","sap/ovp/helpers/V4/MetadataAnalyzer","sap/ovp/app/OVPUtils","sap/ovp/cards/Filterhelper"],function(e,t,r,a,i,n,o,l,u,s,f,c,v,g,p,m,h,P,y,d){"use strict";var C=h.errorMessages;var T={TEXT:"com.sap.vocabularies.Common.v1.Text",TEXT_ARRANGEMENT:"com.sap.vocabularies.UI.v1.TextArrangement",UOM:"Org.OData.Measures.V1.Unit",ISO_CURRENCY:"Org.OData.Measures.V1.ISOCurrency"};var b={TEXT_LAST:"com.sap.vocabularies.UI.v1.TextArrangementType/TextLast",TEXT_FIRST:"com.sap.vocabularies.UI.v1.TextArrangementType/TextFirst",TEXT_ONLY:"com.sap.vocabularies.UI.v1.TextArrangementType/TextOnly",TEXT_SEPARATE:"com.sap.vocabularies.UI.v1.TextArrangementType/TextSeparate"};var D=new g("OVP.cards.AnnotationHelper");function O(e,t){if(!t){return""}var r=ke(e);if(t.Label){return r?t.Label:t.Label.String}var a=e.getSetting&&e.getSetting("ovpCardProperties");var i=a&&a.getProperty("/metaModel");var n=a&&a.getProperty("/entityType");if(!i||!n){return""}var o;if(t.Value){o=r?t.Value.$Path:t.Value.Path}if(t.Target){var l=r?"/"+_(n.$Type,t,e):_(n.$path,t,e);var u=l&&i.getProperty(l);o=r?u&&u.Value.$Path:u&&u.Value.Path}if(!o||!o.length>0||o===" "){return""}var s=r?i.getData()["$Annotations"][n.$Type+"/"+o]:i.getODataProperty(n,o);if(!s){return""}var f="";if(r){f=s["@com.sap.vocabularies.Common.v1.Label"]||""}else{f=s["sap:label"]||(s["com.sap.vocabularies.Common.v1.Label"]||"").String||""}return f}O.requiresIContext=true;function I(e){if(e.EdmType==="Edm.DateTime"||e.EdmType==="Edm.DateTimeOffset"){return"Right"}return"Left"}I.requiresContext=true;function V(e,t){if(e.getSetting){var r=e.getSetting("_ovpCache");if(r){return r[t]}}return undefined}function F(e,t,r){if(e.getSetting){var a=e.getSetting("_ovpCache");if(a){a[t]=r}}}function S(e,t,r){var a,i;if(t){a=t.None;i=r?e&&e.$EnumMember:e&&e.EnumMember;if(i){if(N(i,"Negative")){a=t.Negative}else if(N(i,"Critical")){a=t.Critical}else if(N(i,"Positive")){a=t.Positive}}}return a}function N(e,t){return e&&e.indexOf(t,e.length-t.length)!==-1}function x(t,r,a,i,n,o,l,u){if(typeof t=="string"&&u){t=e.getFloatInstance().parse(t)}var s={};s.EnumMember="None";var f=Number.NEGATIVE_INFINITY;var c=Number.POSITIVE_INFINITY;if(!n&&n!==0&&(a||a===0)){n=a}if(!o&&o!==0&&(i||i===0)){o=i}if(!a&&a!==0){a=f}if(!i&&i!==0){i=c}if(t!==undefined){t=Number(t);if(N(r,"Minimize")||N(r,"Minimizing")){if((o||o===0)&&(i||i===0)){if(t<=parseFloat(o)){s.EnumMember="Positive"}else if(t>parseFloat(i)){s.EnumMember="Negative"}else{s.EnumMember="Critical"}}}else if(N(r,"Maximize")||N(r,"Maximizing")){if((n||n===0)&&(a||a===0)){if(t>=parseFloat(n)){s.EnumMember="Positive"}else if(t<parseFloat(a)){s.EnumMember="Negative"}else{s.EnumMember="Critical"}}}else if(N(r,"Target")){if((o||o===0)&&(i||i===0)&&(n||n===0)&&(a||a===0)){if(t>=parseFloat(n)&&t<=parseFloat(o)){s.EnumMember="Positive"}else if(t<parseFloat(a)||t>parseFloat(i)){s.EnumMember="Negative"}else{s.EnumMember="Critical"}}}}return S(s,l,false)}function E(t,r,a,i,n){if(n&&typeof t=="string"){t=e.getFloatInstance().parse(t)}if(!t||!r){return}t=Number(t);if(!i&&t-r>=0){return"Up"}if(!a&&t-r<=0){return"Down"}if(r&&i&&t-r>=i){return"Up"}if(r&&a&&t-r<=a){return"Down"}}function A(e,t){var r=e.getPath(0)+"-DataFields-Sorted";var a=V(e,r);var i=ke(e);if(!a){var n=R(e,t);var o=n.map(function(e){return i?e.Value.$Path:e.Value.Path});o=o.filter(function(e){return!!e});var l,u,s;a=t.filter(function(e){s=e&&e.Value||{};l=(i?s.$Path:s.Path)||"";u=(i?e.$Type:e.RecordType)||"";return u==="com.sap.vocabularies.UI.v1.DataField"&&o.indexOf(l)===-1});a=L(a,e);F(e,r,a)}return a}A.requiresIContext=true;function R(e,t,r){var a=e.getPath(0)+"-DataPoints-Sorted";var i=V(e,a);var n=ke(e);if(!i){if(r){i=t.filter(function(e){return U(e,n)})}else{i=t.filter(function(e){return M(e,n)})}i=L(i,e);var o;for(var l=0;l<i.length;l++){o=e.getPath(0).substr(0,e.getPath(0).lastIndexOf("/")+1);i[l]=e.getModel(0).getProperty(_(o,i[l],e));o=""}F(e,a,i)}return i}R.requiresIContext=true;function M(e,t){var r=t?e&&e.$Type:e&&e.RecordType;var a=e&&e.Target||{};var i=(t?a.$AnnotationPath:a.AnnotationPath)||"";return r==="com.sap.vocabularies.UI.v1.DataFieldForAnnotation"&&i.match(/@com.sap.vocabularies.UI.v1.DataPoint.*/)}function U(e,t){var r=t?e&&e.$Type:e&&e.RecordType||"";var a=e&&e.Target||{};var i=(t?a.$AnnotationPath:a.AnnotationPath)||"";return r==="com.sap.vocabularies.UI.v1.DataFieldForAnnotation"&&i.match(/@com.sap.vocabularies.UI.v1.DataPoint.*/)||r==="com.sap.vocabularies.UI.v1.DataFieldForAnnotation"&&i.match(/@com.sap.vocabularies.Communication.v1.Contact.*/)}function $(e){if(!e||!e.Criticality||!e.Criticality.Path){return}return"{path:'"+e.Criticality.Path+"'}"}function _(e,t,r){var a=ke(r);if(a){return e+t.Target.$AnnotationPath}if(e&&!N(e,"/")){e+="/"}return e+t.Target.AnnotationPath.slice(1)}function w(e,t){var r,a;var i=ke(t);var n=i?e["@com.sap.vocabularies.UI.v1.Importance"]:e["com.sap.vocabularies.UI.v1.Importance"];if(n){r=i?n.$EnumMember:n.EnumMember;switch(r){case"com.sap.vocabularies.UI.v1.ImportanceType/High":a=1;break;case"com.sap.vocabularies.UI.v1.ImportanceType/Medium":a=2;break;case"com.sap.vocabularies.UI.v1.ImportanceType/Low":a=3;break}}else{a=4}return a}function L(e,t){if(e.length<2){return e}var r=parseInt(e.length/2,10);var a=e.slice(0,r);var i=e.slice(r,e.length);return q(L(a,t),L(i,t),t)}function q(e,t,r){var a=[];while(e.length&&t.length){var i=w(e[0],r),n=w(t[0],r);if(i<=n){a.push(e.shift())}else{a.push(t.shift())}}while(e.length){a.push(e.shift())}while(t.length){a.push(t.shift())}return a}function j(e,t,r){var a=A(e,t)[r];if(a){return X(e,a)}return""}function B(e,t,r){var a=A(e,t)[r];return O(e,a)}function Y(e,t,r){var a=t.filter(M);a=L(a,e);if(!a||!a.length||!a.length>0){return""}return O(e,a[0])}function k(e,t,r,a){var i=R(e,t)[r];if(!i){return""}var n=e.getSetting("ovpCardProperties");var o=n.getProperty("/entityType");var l=n.getProperty("/metaModel");return G(e,i,o,l,a)}function H(e,t,r){var a=R(e,t)[r];return a&&a.Criticality?true:false}function G(e,t,r,a,i){if(!t||!t.Value){return""}var n=e.getSetting("ovpCardProperties");var o=false;if(n){var l=n.getProperty("/ignoreSapText");o=l==undefined?o:l}var u=a.getODataProperty(r,t.Value.Path);var s=false;if(o==true){if(u&&(u["com.sap.vocabularies.Analytics.v1.Measure"]||u["sap:aggregation-role"]=="measure")){s=true}}if(!s&&u){var f;if(u[T.TEXT]){f=u[T.TEXT].String?u[T.TEXT].String:u[T.TEXT].Path}else if(u["sap:text"]){f=u["sap:text"]}if(f){u=a.getODataProperty(r,f);t={Value:{Path:u.name}}}}return X(e,t,i)}function X(e,t,r,i){if(t.Value.Apply){return a.format(e,t.Value)}var n=e.getSetting("ovpCardProperties");var o=n.getProperty("/entityType");var l=n.getProperty("/metaModel");return J(e,t,o,l,r,i)}X.requiresIContext=true;function z(e,t,r,i){if(!r||typeof i!=="string"){return i}var n=r[T.TEXT]||r["sap:text"];if(!n){return i}var o,l;o=r[T.TEXT_ARRANGEMENT];l=o&&o.EnumMember;if(!l){o=n&&n[T.TEXT_ARRANGEMENT];l=o&&o.EnumMember}if(!l){o=t&&t[T.TEXT_ARRANGEMENT];l=o&&o.EnumMember}var u;if(typeof n==="object"){u=a.format(e,n)}else{u=a.format(e,{Path:n})}if(!u||u===" "){return i}if(!l){return i+" ("+u+")"}var s;switch(l){case b.TEXT_FIRST:s=u+" ("+i+")";break;case b.TEXT_LAST:s=i+" ("+u+")";break;case b.TEXT_ONLY:s=u;break;case b.TEXT_SEPARATE:s=i+" ("+u+")";break;default:s=i;break}return s}function J(e,t,r,i,n,o,l){if(t.Value.Apply){return a.format(e,t.Value)}var u=t.Value.Path?t.Value.Path:t.Value.String;var s=i.getODataProperty(r,u),f="",c,v;var g=e.getSetting("ovpCardProperties");var p=g&&g.getProperty("/contentFragment");if(!o){if(t.Value.Path&&t.Value.Path.split("/").length>1){s=te(i,r,t.Value.Path,e)}if(!s){return""}if(s["type"]==="Edm.DateTime"||s["type"]==="Edm.DateTimeOffset"){var m={relative:true,relativeScale:"auto"},h=g&&g.getProperty("/showDateInRelativeFormat");if(h!==undefined&&!h){m={style:"medium"}}c="CardAnnotationhelper.formatDate";v={dateFormat:m,bUTC:s["type"]==="Edm.DateTime"?true:false,functionName:c};f=W([t.Value.Path?t.Value.Path:s.name],c,v)}else if(t.ValueFormat&&t.ValueFormat.NumberOfFractionalDigits||s["scale"]){var P=t.ValueFormat&&t.ValueFormat.NumberOfFractionalDigits?t.ValueFormat.NumberOfFractionalDigits.Int:0,y;var d=t.ValueFormat&&t.ValueFormat.ScaleFactor&&t.ValueFormat.ScaleFactor.Decimal;if(s[T.ISO_CURRENCY]){y=s[T.ISO_CURRENCY].Path?s[T.ISO_CURRENCY].Path:s[T.ISO_CURRENCY].String}else if(s[T.UOM]){y=s[T.UOM].Path?s[T.UOM].Path:s[T.UOM].String}else if(s["sap:unit"]){y=s["sap:unit"]}var C=y?i.getODataProperty(r,y):null,b=[t.Value.Path?t.Value.Path:s.name];if(P>2){P=2}v={numberOfFractionalDigits:P,scaleFactor:d};if(s[T.ISO_CURRENCY]){var D=s[T.ISO_CURRENCY];if(D.Path){c="CardAnnotationhelper.formatCurrency";b.push(D.Path)}else if(D.String){v.currencyString=D.String;c="CardAnnotationhelper.formatCurrency"}}else if(C&&(C[T.ISO_CURRENCY]||C["sap:semantics"]==="currency-code")){c="CardAnnotationhelper.formatCurrency";b.push(y)}else{c="CardAnnotationhelper.formatNumberCalculation"}v.functionName=c;f=W(b,c,v)}else{if(l){f=a.simplePath(e,t.Value)}else{var O=a.format(e.getModel()?e:e.getInterface(0),t.Value);var I=O.split(",");var V=[];if(I.length>1){for(var F=0;F<I.length;F++){if(I[F].indexOf("path:")>=0||I[F].indexOf("type:")>=0){V.push(I[F])}}if(V.length>0){f=f+V.join(",");if(f.substring(f.length-1)!=="}"){f=f+"}"}}}else{f=O}}}if(p){f=z(e,r,s,f)}if(s&&s[T.UOM]){var S=s[T.UOM];if(S.Path){f+=" "+W([S.Path]);f+=" "+K(S.Path,i,r,e)}else if(S.String){if(S.String!=="%"){f+=" "}f+=S.String}}}if(!n){if(s[T.ISO_CURRENCY]){var D=s[T.ISO_CURRENCY];if(D){if(D.Path){f+=" "+W([D.Path]);f+=" "+K(D.Path,i,r,e)}else if(D.String){f+=" "+D.String}}}}if(f[0]===" "){f=f.substring(1)}return f}function K(e,t,r,a){if(e){var i,n,o;var l=ke(a);if(e.split("/").length>1){i=te(t,r,e,a);n=ce(t,r,e,a)}else{i=l?Ut(t,r,e):t.getODataProperty(r,e)}if(i){o=l?i["@"+T.TEXT]&&i["@"+T.TEXT].$Path:i[T.TEXT]&&i[T.TEXT].Path||i["sap:text"]}if(o&&n){o=n+"/"+o}if(o){return" ({"+o+"})"}return""}}function W(e,t,r,a,i){i=i||false;var n="",o=e.length;if(o>1||r){n="{parts:[";for(var l=0;l<o;l++){if(a){n+="{path: '"+e[l]+"',type:'sap.ui.model.odata.type."+a+"'}"+(l===o-1&&!r?"]":", ")}else{n+="{path: '"+e[l]+"'}"+(l===o-1&&!r?"]":", ")}}if(r){var u="{value:"+JSON.stringify(r)+", model: 'ovpCardProperties'}";n+=u+"]"}}else{n="{path: '"+e[0]+"'"}if(i){n+=", useInternalValues:true"}n+=(t?", formatter: '"+t+"'":"")+"}";return n}function Z(){var t=arguments[arguments.length-1],r=arguments[0];var a=e.getFloatInstance({style:"short",showMeasure:false,shortRefNumber:t.scaleFactor,minFractionDigits:t.numberOfFractionalDigits,maxFractionDigits:t.numberOfFractionalDigits});if(typeof r=="string"&&t.bODataV4){r=e.getFloatInstance().parse(r)}return a.format(Number(r))}function Q(){var e=arguments[arguments.length-1],r=arguments[0];var a=t.getInstance(e.dateFormat);if(!r){r="";return r}return a.format(new Date(r),e.bUTC)}function ee(){var t=arguments[arguments.length-1],r=Number(arguments[0]),a=arguments[1];var i="";var n=e.getFloatInstance({style:"short",showMeasure:false,shortRefNumber:t.scaleFactor,minFractionDigits:t.numberOfFractionalDigits,maxFractionDigits:t.numberOfFractionalDigits});if(typeof r=="string"&&t.bODataV4){r=e.getFloatInstance().parse(r)}if(a){i=n.format(r,a)}else{i=t.currencyString?n.format(r,t.currencyString):n.format(r)}return i}function te(e,t,r,a){var i=r.split("/");var n=ke(a);if(i.length>1){if(n){for(var o=0;o<i.length-1;o++){t=e.getProperty("/"+t.$Type)[i[o]]}return Ut(e,t,i[i.length-1])}else{for(var o=0;o<i.length-1;o++){var l=e.getODataAssociationEnd(t,i[o]);if(l){t=e.getODataEntityType(l.type)}}return e.getODataProperty(t,i[i.length-1])}}}function re(e,t,r){var a=R(e,t);var i=h.Criticality.StateValues;var n=a[r];if(!n){return i.None}if(n.Criticality){return oe(e,n,i)}return le(e,n,i)}function ae(e,t,r){var a=R(e,t);if(a&&a.length){var i=a[0];if(i&&(i.Criticality||i.CriticalityCalculation)){return true}}return false}function ie(e,t,r){if(ae(e,t,r)){return""}return"sapUiChartPaletteQualitativeHue1"}ie.requiresIContext=true;function ne(e,t,r){var a=R(e,t),i=h.Criticality.ColorValues;var n=i.None;if(a.length>r){var o=a[r];if(o&&o.Criticality){n=oe(e,o,i)}else{n=le(e,o,i)}}return n}function oe(e,t,r){var n=r.None;var o;var l=t.Criticality;var s=ke(e);if(l){o="'{'= ({0} === ''com.sap.vocabularies.UI.v1.CriticalityType/Negative'') || ({0} === ''1'') || ({0} === 1) ? ''"+r.Negative+"'' : "+"({0} === ''com.sap.vocabularies.UI.v1.CriticalityType/Critical'') || ({0} === ''2'') || ({0} === 2) ? ''"+r.Critical+"'' : "+"({0} === ''com.sap.vocabularies.UI.v1.CriticalityType/Positive'') || ({0} === ''3'') || ({0} === 3) ? ''"+r.Positive+"'' : "+"''"+r.None+"'' '}'";if(l.Path&&!s){var f="$"+a.simplePath(e,l);n=u(o,f)}else if(s&&l.$Path){var f="$"+i.format(l,{context:e});n=u(o,f)}else if(l.EnumMember||l.$EnumMember){var c=s?l.$EnumMember:l.EnumMember;var v="'"+c+"'";n=u(o,v)}else{D.warning("Case not supported, returning the default Neutral state")}}else{D.warning("Case not supported, returning the default Neutral state")}return n}function le(e,t,r,a){var i=ke(e);var n=r.None;var o=t&&t.Value||{};var l=i?o.$Path:o.Path;if(t.Criticality){n=S(t.Criticality,r,i)}else if(t.CriticalityCalculation&&l){n=ue(e,t,r,a)}return n}function ue(e,t,r,a){var i=ke(e);var n=be(t.Value,i,a);var o=i?t.CriticalityCalculation.ImprovementDirection.$EnumMember:t.CriticalityCalculation.ImprovementDirection.EnumMember;var l=be(t.CriticalityCalculation.DeviationRangeLowValue,i,a);var u=be(t.CriticalityCalculation.DeviationRangeHighValue,i,a);var s=be(t.CriticalityCalculation.ToleranceRangeLowValue,i,a);var f=be(t.CriticalityCalculation.ToleranceRangeHighValue,i,a);var c=fe(l);var v=fe(u);var g=fe(s);var p=fe(f);var m="CardAnnotationhelper.formatColor";var h={deviationLow:l,deviationHigh:u,toleranceLow:s,toleranceHigh:f,bIsDeviationLowBinding:c,bIsDeviationHighBinding:v,bIsToleranceLowBinding:g,bIsToleranceHighBinding:p,sImprovementDirection:o,oCriticalityConfigValues:r,functionName:m,bODataV4:i};var P="{value:"+JSON.stringify(h)+", model: 'ovpCardProperties'}";var y="parts: ["+n;y+=c?","+l:"";y+=v?","+u:"";y+=g?","+s:"";y+=p?","+f:"";y+=","+P;y+="]";return"{"+y+", formatter: '"+m+"'}"}function se(){var e=arguments[arguments.length-1];var t=1;if(e&&e.bODataV4){return x(arguments[0],e.sImprovementDirection,e.bIsDeviationLowBinding?parseFloat(arguments[t++].split(",").join("")):e.deviationLow,e.bIsDeviationHighBinding?parseFloat(arguments[t++].split(",").join("")):e.deviationHigh,e.bIsToleranceLowBinding?parseFloat(arguments[t++].split(",").join("")):e.toleranceLow,e.bIsToleranceHighBinding?parseFloat(arguments[t++].split(",").join("")):e.toleranceHigh,e.oCriticalityConfigValues,e.bODataV4)}return x(arguments[0],e.sImprovementDirection,e.bIsDeviationLowBinding?arguments[t++]:e.deviationLow,e.bIsDeviationHighBinding?arguments[t++]:e.deviationHigh,e.bIsToleranceLowBinding?arguments[t++]:e.toleranceLow,e.bIsToleranceHighBinding?arguments[t++]:e.toleranceHigh,e.oCriticalityConfigValues,e.bODataV4)}function fe(e){return typeof e==="string"&&e.charAt(0)==="{"}function ce(e,t,r,a){var i="";var n=r.split("/");var o=ke(a);if(n.length>1){if(o){n.pop();i=n.join("/")}else{for(var l=0;l<n.length-1;l++){var u=e.getODataAssociationEnd(t,n[l]);if(u){t=e.getODataEntityType(u.type);if(i){i=i+"/"}i=i+n[l]}else{return i}}}}return i}function ve(e){var t;if(e&&typeof e.getData==="function"){var r=e.getData();if(r.tabs){var a=0;var i=r.selectedKey;if(i&&r.tabs.length>=i){a=i-1}t=r.tabs[a].mFilterPreference}else{t=r.mFilterPreference}}return!!t}function ge(e,t){var r=e.getSetting("ovpCardProperties");var a=r.getProperty("/addODataSelect");var i=r.getProperty("/metaModel");var n=i.getODataEntityType(t.entityType);var o=n[r.getProperty("/selectionAnnotationPath")];var l=n[r.getProperty("/presentationAnnotationPath")];var u="/"+t.name;var s=Array.prototype.slice.call(arguments,2);var f=e.getSetting("ovpCardProperties"),v=f.getProperty("/parameters");var g=ke(e);if(o||!!v){if(o&&o.Parameters&&o.Parameters.length>0||!!v){u=c.resolveParameterizedEntitySet(e.getSetting("dataModel"),t,o,v)}}if(r.getProperty("/cardLayout")&&r.getProperty("/cardLayout/noOfItems")){var p="{path: '"+u+"', length: "+ +r.getProperty("/cardLayout/noOfItems")}else{var p="{path: '"+u+"', length: "+De(r)}var m=[];if(a){m=me(e,i,n,s);var h=r.getProperty("/template");if(h!="sap.ovp.cards.charts.analytical"&&h!="sap.ovp.cards.charts.smart.chart"){var P=ye(l);for(var y=0;y<P.length;y++){if(m.indexOf(P[y])===-1){m.push(P[y])}}}}var C=pe(i,n,s,e);var T=ve(r);var b=false;if(T||m.length>0||C.length>0){p=p+", parameters: {"}if(m.length>0||C.length>0){if(m.length>0){p=p+"select: '"+m.join(",")+"'";b=true}if(C.length>0){if(m.length>0){p=p+", "}p=p+"expand: '"+C.join(",")+"'";b=true}if(T){p=p+", "}}if(T){p=p+"custom: {cardId: '"+r.getProperty("/cardId")+"'"+", _requestFrom: 'ovp_internal'}";b=false}else if(!p.includes(", parameters: {")){p=p+", parameters: {custom: {_requestFrom: 'ovp_internal'}}";b=false}else if(b){p=p+", custom: {_requestFrom: 'ovp_internal'}"}if(T||m.length>0||C.length>0){p=p+"}"}var D=Pe(r,l,g);if(D.length>0){p=p+", sorter:"+JSON.stringify(D)}var O=d.getFilters(r,o);if(O.length>0){O=d.createExcludeFilters(O,r);p=p+", filters:"+JSON.stringify(O)}p=p+"}";return p}ge.requiresIContext=true;function pe(e,t,r,a){var i=[];var n,o,l,u;for(var s=0;s<r.length;s++){if(!r[s]){continue}n=t.$path+"/"+r[s];o=e.createBindingContext(n);l=o.getObject();l=l?l:[];for(var f=0;f<l.length;f++){if(l[f].Value&&l[f].Value.Path){u=ce(e,t,l[f].Value.Path,a);if(u&&i.indexOf(u)===-1){i.push(u)}var c=e.getODataProperty(t,l[f].Value.Path);if(c){var v;if(c[T.UOM]){v=c[T.UOM].Path}else if(c[T.ISO_CURRENCY]){v=c[T.ISO_CURRENCY].Path}else if(c[T.TEXT]){v=c[T.TEXT].Path}if(v&&v.split("/").length>1){u=ce(e,t,v,a);if(u&&i.indexOf(u)===-1){i.push(u)}}else{var g=e.getODataProperty(t,v);if(g){var p=g[T.TEXT]&&g[T.TEXT].Path;if(p&&p.split("/").length>1){u=ce(e,t,p,a);if(u&&i.indexOf(u)===-1){i.push(u)}}}}}}}}return i}function me(e,t,i,n){var o=[];var l,u,f;for(var c=0;c<n.length;c++){if(!n[c]){continue}l=i.$path+"/"+n[c];u=t.createBindingContext(l);var g={};if(e&&e.bDummyContext){v(g,e,u,true)}else{g=e}f=u.getObject();if(!f){f=[]}else if(s(f)){if(f.Data){f=f.Data}else{f=[]}}var p;var m;var h;var P;for(var y=0;y<f.length;y++){m=[];p=f[y];h="";P=p.RecordType;if(P==="com.sap.vocabularies.UI.v1.DataField"){h=J(g,p,i,t,undefined,undefined,true)}else if(P==="com.sap.vocabularies.UI.v1.DataFieldForAnnotation"){var d=_(i.$path,p,e);h=G(g,t.getProperty(d),i,t);var C=$(t.getProperty(d));if(C&&C.length>0){h+=C}}else if(P==="com.sap.vocabularies.UI.v1.DataFieldWithUrl"&&p.Url){var T;if(!p.Url.UrlRef){T=a.format(g,p.Url)}if(T&&T.substring(0,2)==="{="){h=T}}if(h){var b=a.simplePath(g,p.Value);if(h.indexOf("(")<0&&h!==b){h=[].concat(b,h).join(" ")}m=he(h)}if(m&&m.length>0){var D;for(var O=0;O<m.length;O++){D=m[O];if(!o[D]){o[D]=true;var I=r.getUnitColumn(D,i);if(I&&I!==D){o[I]=true}var V=Rt(t,i,D,e);if(V&&V!==D){o[V]=true}}}}}}return Object.keys(o)}function he(e){var t,r=0,a=e.length,i="",n;for(t=0;t<a;t++){n=e.charAt(t);if(!n){return}switch(n){case"{":r++;break;case"}":r--;break;default:if(r<=0){continue}break}i+=n}e=i;var o=/\${([a-zA-Z0-9\_|\/]*)/g;var l=/[^[{]*[a-zA-Z0-9\_]/g;var u=/path *\: *\'([a-zA-Z0-9\_]+)*\'/g;var s,f,c=[];if(e.indexOf("{parts:[")!==-1){e=e.replace("{parts:[","");e=e.replace("]","");e=e.replace(e.lastIndexOf("}",""))}if(e.substring(0,2)==="{="){s=o;f=1}else if(e.indexOf("path")!==-1){if(e.indexOf("{value")>0){var v=0;var t=e.indexOf("{value")+5;var g;while(t<a){if(e[t]==="}"&&v===0){g=t;break}if(e[t]==="{"){v+=1}if(e[t]==="}"){v-=1}t++}e=e.slice(0,e.indexOf("{value"))+e.slice(g)}if(e.indexOf("constraints:{")!==-1){var v=0;var t=e.indexOf("constraints:{")+12;var g;while(t<a){if(e[t]==="{"){v+=1}if(e[t]==="}"){v-=1;if(v===0){g=t;break}}t++}e=e.slice(0,e.indexOf("constraints:{")-1)+e.slice(g+1)}var p=l.exec(e);while(p){if(p[0].indexOf("path")===-1&&p[0].indexOf("@i18n")!==0&&p[0].indexOf("model: 'ovpCardProperties'")<=-1){c.push(p[0])}p=l.exec(e)}s=u;f=1}else{s=l;f=0}var m=s.exec(e);while(m){if(m[f]&&m[f].indexOf("@i18n")!==0){c.push(m[f])}m=s.exec(e)}return c}function Pe(e,t,r){var a=[];var i,n;var o=e.getProperty("/sortBy");if(o){var l=e.getProperty("/sortOrder");if(l&&l.toLowerCase()!=="descending"){n=false}else{n=true}i={path:o,descending:n};a.push(i)}var u=t&&t.SortOrder||undefined;var s,o;if(u){for(var f=0;f<u.length;f++){s=u[f];o=r?s.Property.$PropertyPath:s.Property.PropertyPath;n=d.getBooleanValue(s.Descending,true);i={path:o,descending:n};a.push(i)}}return a}function ye(e){var t=[];var r=e&&e.RequestAtLeast||undefined;if(r){for(var a=0;a<r.length;a++){if(r[a].PropertyPath){t.push(r[a].PropertyPath)}}}return t}function de(e,t){var r=e.getProperty("/selectionAnnotationPath");var a,i;if(t&&r){var n=e.getProperty("/entityType");var o=e.getProperty("/metaModel");a=o.getObject("/"+n.$Type+"/@");r="@"+r}else{a=e.getProperty("/entityType")}i=r&&a[r];return{filters:d.getFilters(e,i,t),parameters:Te(i,t)}}function Ce(e,t){if(!e){return}var r=e.getProperty("/entityType");var a=r&&r[e.getProperty("/presentationAnnotationPath")];var i=Pe(e,a,t);var n=[];var o,l=i.length;for(o=0;o<l;o++){if(!i[o].path){continue}n.push({Property:i[o].path,Descending:i[o].descending})}if(n.length>0){return{SortOrder:n}}}function Te(e,t){var r,a=[];if(!e||!e.Parameters){return a}var i=e.Parameters.length;for(var n=0;n<i;n++){r=e.Parameters[n];if(!r.PropertyName||!r.PropertyName.PropertyPath){continue}if(!r.PropertyValue){D.error("Missing value for parameter "+r.PropertyName.PropertyPath);continue}a[a.length]={path:r.PropertyName.PropertyPath,value:d.getPrimitiveValue(r.PropertyValue,t)}}return a}function be(e,t,r){if(e){var a=t?e.$Path:e.Path;if(a){return r?"{path:'"+a+"Agg"+"', type:'sap.ui.model.odata.type.Decimal'}":"{path:'"+a+"'}"}else{return d.getPrimitiveValue(e,t)}}else{return""}}function De(e){var t=e.getProperty("/contentFragment");var r=e.getProperty("/listType");var a=e.getProperty("/listFlavor");var i;var o="desktop";if(n.system.phone){o="phone"}else if(n.system.tablet){o="tablet"}if(t=="sap.ovp.cards.list.List"){if(r=="extended"){if(a=="bar"){i=h.ItemLength["List_extended_bar"]}else{i=h.ItemLength["List_extended"]}}else if(a=="bar"){i=h.ItemLength["List_condensed_bar"]}else{i=h.ItemLength["List_condensed"]}}else if(t=="sap.ovp.cards.table.Table"){i=h.ItemLength["Table"]}else if(t=="sap.ovp.cards.stack.Stack"){if(e.getProperty("/objectStreamCardsNavigationProperty")){i=h.ItemLength["Stack_complex"]}else{i=h.ItemLength["Stack_simple"]}}if(i){return i[o]}return 5}function Oe(e){var t=e.getObject();var r=R(e,t,true);var a,i;var n=ke(e);var o,l;var u=r.map(function(e){a=e&&e.Value;i=e&&e.fn;if(a&&(a.Path||a.$Path)){return n?a.$Path:a.Path}else if(i&&(i.Path||i.$Path)){return n?i.$Path:i.Path}});t.filter(function(e,r){o=n?e.$Type:e.RecordType;l=n?e.Value&&e.Value.$Path:e.Value&&e.Value.Path;if(o==="com.sap.vocabularies.UI.v1.DataField"&&u.indexOf(l)>-1){t.splice(r,1)}});if(n){return e.sPath}}Oe.requiresIContext=true;function Ie(e,t){var r=R(e,t);return r.length}Ie.requiresIContext=true;function Ve(e,t){return Fe(e,t,0)}Ve.requiresIContext=true;function Fe(e,t,r){var a=R(e,t),i=a[r],n=i&&i.Value,o=ke(e),l=o?n&&n.$Path:n&&n.Path;return l||""}function Se(e,t){return B(e,t,0)}Se.requiresIContext=true;function Ne(e,t){return B(e,t,1)}Ne.requiresIContext=true;function xe(e,t){return B(e,t,2)}xe.requiresIContext=true;function Ee(e,t,r){return j(e,t,r)}Ee.requiresIContext=true;function Ae(e,t,r){return k(e,t,r)}Ae.requiresIContext=true;function Re(e,t,r,a){var i=Ie(e,t);if(i>0){return Ae(e,t,r)}else{return Ee(e,t,a)}}Re.requiresIContext=true;function Me(e,t,r){return Ke(e,t,r)}Me.requiresIContext=true;function Ue(e,t){return Y(e,t,0)}Ue.requiresIContext=true;function $e(e,t){var r=ke(e);var n;for(var o=0;o<t.length;o++){var l=t[o];n=r?l.$Type:l.RecordType;if(n==="com.sap.vocabularies.UI.v1.DataField"){if(l.IconUrl&&l.IconUrl.String){return l.IconUrl.String}if(r&&l.IconUrl&&l.IconUrl.$Path){return i.format(l.IconUrl,{context:e})}if(!r&&l.IconUrl&&l.IconUrl.Path){return a.simplePath(e,l.IconUrl)}}}}$e.requiresIContext=true;function _e(e,t,r){var a="";var i;if(Array.isArray(t)){i=R(e,t)[r]}else{var n=Object.assign({},t);var o=Object.assign({},e);i=ze(o,n)}if(!i||!i.Value){return a}var l=e.getSetting("ovpCardProperties");var u=l&&l.getProperty("/entityType");var s=l&&l.getProperty("/metaModel");var f=ke(e);var c=f?s&&s.getData()["$Annotations"][u.$Type+"/"+i.Value.$Path]:s&&s.getODataProperty(u,i.Value.Path);var v=f?c&&c["@"+T.ISO_CURRENCY]:c&&c[T.ISO_CURRENCY];if(v&&!f){if(v.Path){a+=" "+W([v.Path]);a+=" "+K(v.Path,s,u,e)}else if(v.String){a+=" "+v.String}}else if(v&&f){if(v.$Path){a+=" "+W([v.$Path])}else{a+=" "+v}a+=" "+K(v.$Path,s,u,e)}return a}_e.requiresIContext=true;function we(e,t,r,a){return k(e,t,r,a)}we.requiresIContext=true;function Le(e,t){return re(e,t,0)}Le.requiresIContext=true;function qe(e,t){return ne(e,t,0)}qe.requiresIContext=true;function je(e,t){return re(e,t,1)}je.requiresIContext=true;function Be(e,t){return re(e,t,2)}Be.requiresIContext=true;function Ye(e){var t={};t.EnumMember="None";if(Number(e)===1){t.EnumMember="Negative"}else if(Number(e)===2){t.EnumMember="Critical"}else if(Number(e)===3){t.EnumMember="Positive"}return S(t,h.Criticality.ColorValues,false)}function ke(e){var t=e&&typeof e.getModel==="function"&&e.getModel(0)&&e.getModel(0).oModel;return t&&r.isODataV4(t)||false}function He(e,t){var r=ke(e),a=t&&t.Criticality||{},i=r?a.$Path:a.Path;if(i&&r){return"{parts: [{path:'"+i+"Agg', type:'sap.ui.model.odata.type.Decimal'}], formatter: 'CardAnnotationhelper.kpiValueCriticality'}"}else if(i&&!r){return"{parts: [{path:'"+t.Criticality.Path+"'}], formatter: 'CardAnnotationhelper.kpiValueCriticality'}"}else{return le(e,t,h.Criticality.ColorValues,r)}}He.requiresIContext=true;function Ge(e,t){return H(e,t,0)}Ge.requiresIContext=true;function Xe(e,t){var r=R(e,t)[0];return r&&(r.Criticality||r.CriticalityCalculation)?true:false}Xe.requiresIContext=true;function ze(e,t){var r=e.getPath(0);var a=r.slice(0,r.lastIndexOf("/"));a=a.slice(0,a.lastIndexOf("/"));var i=_(a,t,e);t=e.getModel(0).getProperty(i);return t}function Je(e,t){if(!t){return""}return X(e,t)}Je.requiresIContext=true;function Ke(e,t,r,n){var o;var l=ke(e);var u=n==undefined?r:A(e,r)[n];var s=e.getSetting("ovpCardProperties");var f=s.getProperty("/metaModel");var c=l?t.$Type:f.getODataEntityType(t.entityType);var v=l?f.getData()["$Annotations"][c+"/"+u.Value.$Path]:c.property;if(v&&l){o=v["@com.sap.vocabularies.Common.v1.SemanticObject"];if(o){return i.format(o,e.getModel()?{context:e}:{context:e.getInterface(0)})}else{return""}}if(v&&!l){for(var g=0;g<v.length;g++){if(u.Value.Path===v[g].name){o=v[g]["com.sap.vocabularies.Common.v1.SemanticObject"];if(o){return a.format(e,o)}else{return""}}}}}function We(e,t,r){var a=ke(e);var i=t&&t.Value;var n=t&&t[r]&&t[r].Value;var o=a?i&&i.$Path:i&&i.Path;var l=a?n&&n.$Path:n&&n.Path;var u=r===undefined?o:l;var s=u.indexOf("/")!=-1?u.split("/")[0]:"";return s}We.requiresIContext=true;function Ze(e,t){var r=e.getSetting("ovpCardProperties");var a=r.getProperty("/metaModel");var i=ke(e);var n=i?a.getData()["$Annotations"][t.$Type]:a.getODataEntityType(t.entityType);var o="com.sap.vocabularies.Communication.v1.Contact";if(i){o="@"+o}return n&&n[o]?true:false}Ze.requiresIContext=true;function Qe(e,t,r){if(!t){return""}var a=e.getSetting("ovpCardProperties");var i=a.getProperty("/entityType");var n=a.getProperty("/metaModel");var o=Object.assign({},t);var l=Object.assign({},e);t=ze(l,o);return G(e,t,i,n,r)}Qe.requiresIContext=true;function et(e,t){var r=Object.assign({},t);var a=Object.assign({},e);var i="None",n=h.Criticality.StateValues;t=ze(a,r);if(t&&t.Criticality){i=oe(e,t,n)}else{i=le(e,t,n)}return i}et.requiresIContext=true;function tt(e,t){var r=Object.assign({},t);var a=Object.assign({},e);t=ze(a,r);if(t&&t.Criticality){return true}}tt.requiresIContext=true;function rt(e,t){var r=Object.assign({},t);var a=Object.assign({},e);var i=e.getSetting("ovpCardProperties");var n=i.getProperty("/entityType");var o=i.getProperty("/metaModel");var l=ke(e);t=ze(a,r);if(!t){return}var u=l?o.getProperty("/"+n.$Type)[t.Value.$Path]:o.getODataProperty(n,t.Value.Path);var s=l?u&&u.$Type:u&&u.type;if(t&&(s=="Edm.String"||s=="Edm.DateTime"||s=="Edm.DateTimeOffset")&&(t.Criticality||t.CriticalityCalculation)){return"textAlignLeft"}if(u&&(s=="Edm.DateTime"||s=="Edm.DateTimeOffset")){return"textNormalAlignRight"}return"textAlignRight"}rt.requiresIContext=true;function at(e,t){var r;var a=ke(e);var i;for(var n=0;n<t.length;n++){r=t[n];i=a?r.$Type:r.RecordType;if(i==="com.sap.vocabularies.UI.v1.DataFieldForIntentBasedNavigation"||i==="com.sap.vocabularies.UI.v1.DataFieldForAction"||i==="com.sap.vocabularies.UI.v1.DataFieldWithUrl"){return true}}return false}at.requiresIContext=true;function it(e,t){var r=R(e,t)[0];var a=ke(e);var i=r&&r.Value;var n=a?i&&i.$Path:i&&i.Path;if(n){var o=e.getPath(0).substr(0,e.getPath(0).lastIndexOf("/")+1);var l=e.getModel(0);var u;if(!a){u=l.getProperty(o)}var s=a?l.getData(n):l.getODataProperty(u,n);var f=o.substr(1,o.length-2);if(s&&s[T.UOM]&&!a){return s[T.UOM].String==="%"}if(a&&s){var c=s[f][n]["annotations"]&&s[f][n]["annotations"]["@"+T.UOM];return c==="%"}}return false}it.requiresIContext=true;function nt(e){var t=e.getObject();var r=e.getModel();var a=r.getProperty("/metaModel");var i=a&&a.getODataEntitySet(r.getProperty("/entitySet"));var n=i&&a&&a.getODataEntityType(i.entityType);t=n&&n.$path+"/"+t;return a&&a.createBindingContext(t)}function ot(e,t,r){var a=e.getServiceMetadata().dataServices.schema[0].association;for(var i=0;i<a.length;i++){if(r+"."+a[i].name===t){return a[i]}}}function lt(e,t,r){var a=ke(e);var i=t.filter(function(e){return a?e.$Type==="com.sap.vocabularies.UI.v1.DataField":e.RecordType==="com.sap.vocabularies.UI.v1.DataField"});var n=L(i,e);if(n){return n[r]}return}function ut(e,t,r){if(!r||!r.length||r.length===0){return false}r=lt(e,r,0);return Ke(e,t,r)}ut.requiresIContext=true;function st(e,t,r){if(!r||!r.length||r.length===0){return false}r=lt(e,r,1);return Ke(e,t,r)}st.requiresIContext=true;function ft(e,t,r){var a=ke(e);var i,n,o;var l=t.filter(function(e){i=a?e.$Type:e.RecordType;o=e&&e.Target||{};n=a?o.$AnnotationPath:o.AnnotationPath||"";return i==="com.sap.vocabularies.UI.v1.DataFieldForAnnotation"&&n.indexOf("@com.sap.vocabularies.Communication.v1.Contact")!==-1});var u=L(l,e);if(u){return u[r]}return}function ct(e,t){if(!t||!t.length||t.length===0){return false}var r=ft(e,t,0);if(r){return true}return false}ct.requiresIContext=true;function vt(e,t,a,i){var n,o,l;if(a&&a.Value&&a.Value.Path){n=a.Value.Path}else if(a&&a.Description&&a.Description.Value&&a.Description.Value.Path){n=a.Description.Value.Path}if(a&&a.Description&&a.Description.Path){o=a.Description.Path}else if(a&&a.Title&&a.Title.Path){l=a.Title.Path}var u="";var s=i&&i.Parameters;var f="";var v=e.getSetting("ovpCardProperties"),g=v.getProperty("/parameters");s=s||!!g;if(s){var p=e.getSetting("dataModel");var m=c.resolveParameterizedEntitySet(p,t,i,g);u+="{path: '"+m+"'"}else{u+="{path: '/"+t.name+"'"}u+=", length: 1";var h=e.getSetting("ovpCardProperties");var P=h.getProperty("/entityType");var y=r.getUnitColumn(n,P);var C=d.getFilters(h,i);if(C.length>0){C=d.createExcludeFilters(C,h);f+=", filters: "+JSON.stringify(C)}var T=[];T.push(n);if(o){T.push(o)}else if(l){T.push(l)}if(a&&a.Criticality&&a.Criticality.Path){T.push(a.Criticality.Path)}if(a&&a.CriticalityCalculation&&a.CriticalityCalculation.DeviationRangeLowValue&&a.CriticalityCalculation.DeviationRangeLowValue.Path){T.push(a.CriticalityCalculation.DeviationRangeLowValue.Path)}if(a&&a.CriticalityCalculation&&a.CriticalityCalculation.ToleranceRangeLowValue&&a.CriticalityCalculation.ToleranceRangeLowValue.Path){T.push(a.CriticalityCalculation.ToleranceRangeLowValue.Path)}if(a&&a.CriticalityCalculation&&a.CriticalityCalculation.DeviationRangeHighValue&&a.CriticalityCalculation.DeviationRangeHighValue.Path){T.push(a.CriticalityCalculation.DeviationRangeHighValue.Path)}if(a&&a.CriticalityCalculation&&a.CriticalityCalculation.ToleranceRangeHighValue&&a.CriticalityCalculation.ToleranceRangeHighValue.Path){T.push(a.CriticalityCalculation.ToleranceRangeHighValue.Path)}if(y){T.push(y)}if(a&&a.TrendCalculation&&a.TrendCalculation.ReferenceValue&&a.TrendCalculation.ReferenceValue.Path){T.push(a.TrendCalculation.ReferenceValue.Path)}var b=ve(v);var D=b?", custom: {cardId: '"+v.getProperty("/cardId")+"', _requestFrom: 'ovp_internal'}":", custom: {_requestFrom: 'ovp_internal'}";var O=v.getProperty("/searchQuery");var I=v.getProperty("/enableOVPCardAsAPI");if(O&&I){if(D===""){D=", custom: {search: '"+O+"'}"}else{D=D.slice(0,11)+"search: '"+O+"', "+D.slice(11)}}return u+", parameters:{select:'"+T.join(",")+"'"+D+"}"+f+"}"}vt.requiresIContext=true;function gt(e,t){if(!t||!t.Value){return""}var r=ke(e);var a=r?t.Value.$Path:t.Value.Path;if(!a){return""}var i=e.getSetting("ovpCardProperties");var n=i.getProperty("/entityType");var o=i.getProperty("/metaModel");var l=r?Ut(o,n,a):o.getODataProperty(n,a);var u=t&&t.ValueFormat&&t.ValueFormat.NumberOfFractionalDigits;var s=u&&u.Int;if(l[T.UOM]){var f=l[T.UOM];if(f.String=="%"){i.oData.percentageAvailable=true}}if(u&&r){i.oData.NumberOfFractionalDigits=u}else if(!r&&s){i.oData.NumberOfFractionalDigits=s}var c={NumberOfFractionalDigits:i.oData.NumberOfFractionalDigits||0,percentageAvailable:i.oData.percentageAvailable||false};var v="CardAnnotationhelper.KpiValueFormatter";var g=r?a+"Agg":a;var p=[g];var m=r?"String":"";return W(p,v,c,m)}gt.requiresIContext=true;function pt(){var t=arguments[arguments.length-1],r=arguments[0];var a=e.getFloatInstance({minFractionDigits:t.NumberOfFractionalDigits,maxFractionDigits:t.NumberOfFractionalDigits,style:"short",showScale:true,shortRefNumber:r});if(t.percentageAvailable){return a.format(Number(r))+" %"}else{return a.format(Number(r))}}function mt(e,t){if(!t||!t.Value||!t.Value.Path&&!t.Value.$Path||!t.TrendCalculation){return"None"}var r=ke(e);var a=be(t.Value,r,r);var i=be(t.TrendCalculation.ReferenceValue,r,r);var n=be(t.TrendCalculation.DownDifference,r,r);var o=be(t.TrendCalculation.UpDifference,r,r);var l=fe(i);var u=fe(n);var s=fe(o);var f={referenceValue:i,downDifference:n,upDifference:o,bIsRefValBinding:l,bIsDownDiffBinding:u,bIsUpDiffBinding:s,bODataV4:r};var c="{value:"+JSON.stringify(f)+", model: 'ovpCardProperties'}";var v="parts: ["+a;v+=l?","+i:"";v+=u?","+n:"";v+=s?","+o:"";v+=","+c;v+="]";var g="CardAnnotationhelper.formatTrendIcon";return"{"+v+", formatter: '"+g+"'}"}mt.requiresIContext=true;function ht(){var e=arguments[arguments.length-1];var t=1;return E(arguments[0],e.bIsRefValBinding?arguments[t++]:e.referenceValue,e.bIsDownDiffBinding?arguments[t++]:e.downDifference,e.bIsUpDiffBinding?arguments[t++]:e.upDifference,e.bODataV4)}function Pt(e,t){if(!t||!t.TrendCalculation||!t.TrendCalculation.ReferenceValue){return""}var r=ke(e);var a=e.getSetting("ovpCardProperties");var i=t&&t.ValueFormat&&t.ValueFormat.NumberOfFractionalDigits;if(r&&i){a.oData.NumberOfFractionalDigits=i}else if(!r&&i&&i.Int){a.oData.NumberOfFractionalDigits=i.Int}var n={numberOfFractionalDigits:a.getProperty("/iNumberOfFractionalDigits")||0,manifestTargetValue:a.getProperty("/sManifestTargetValue"),bODataV4:r};var o="CardAnnotationhelper.returnPercentageChange";var l=r?t.Value.$Path+"Agg":t.Value.Path;var u=[l];if(t.TrendCalculation.ReferenceValue.Path&&!r){var s=t.TrendCalculation.ReferenceValue.Path;u.push(s)}if(t.TrendCalculation.ReferenceValue.$Path&&r){var s=t.TrendCalculation.ReferenceValue.$Path;u.push(s)}return W(u,o,n,r?"Decimal":"")}Pt.requiresIContext=true;function yt(){var t,r=arguments[0];var a=arguments[arguments.length-1];if(typeof arguments[1]!=="object"){t=arguments[1]}var i,n,o,l=false;if(typeof r=="string"){r=e.getFloatInstance().parse(r)}if(isNaN(+r)){return""}o=r==0?+t:r;n=+a.numberOfFractionalDigits;l=a.percentageAvailable;if(t){i=t}else if(a.manifestTargetValue){i=+a.manifestTargetValue}if(!n||n<0){n=0}else if(n>2){n=2}if(i){var u=e.getFloatInstance({minFractionDigits:n,maxFractionDigits:n,style:"short",showScale:true,shortRefNumber:o});if(l){return u.format(+i)+" %"}else{return u.format(+i)}}}function dt(e,t){if(!t||!t.TrendCalculation||!t.TrendCalculation.ReferenceValue){return""}if(!t||!t.Value||!t.Value.Path&&!t.Value.$Path){return""}var r=e.getSetting("ovpCardProperties");var a=r.getProperty("/entityType");var i=r.getProperty("/metaModel");var n=ke(e);var o=t&&t.ValueFormat&&t.ValueFormat.NumberOfFractionalDigits;var l=o&&o.Int;if(l&&!n){r.setProperty("/iNumberOfFractionalDigits",l)}else if(n&&o){r.setProperty("/iNumberOfFractionalDigits",o)}var u="CardAnnotationhelper.TargetValueFormatter";var s=n?t.Value.$Path+"Agg":t.Value.Path;var f=[s];if(t.TrendCalculation.ReferenceValue&&!n){if(t.TrendCalculation.ReferenceValue.String){r.setProperty("/sManifestTargetValue",t.TrendCalculation.ReferenceValue.String)}if(t.TrendCalculation.ReferenceValue.Path){var c=i.getODataProperty(a,t.TrendCalculation.ReferenceValue.Path);if(c[T.UOM]){var v=c[T.UOM];if(v.String=="%"){r.setProperty("/bPercentageAvailableForTarget",true)}}var g=t.TrendCalculation.ReferenceValue.Path;f.push(g)}}else if(n&&t.TrendCalculation.ReferenceValue){if(t.TrendCalculation.ReferenceValue.$Path){var c=Ut(i,a,t.TrendCalculation.ReferenceValue.$Path);if(c[T.UOM]){var v=c[T.UOM];if(v.String=="%"){r.setProperty("/bPercentageAvailableForTarget",true)}}var g=t.TrendCalculation.ReferenceValue.$Path+"Agg";f.push(g)}if(t.TrendCalculation.ReferenceValue){r.setProperty("/sManifestTargetValue",t.TrendCalculation.ReferenceValue)}}var p={numberOfFractionalDigits:r.getProperty("/iNumberOfFractionalDigits")||0,percentageAvailable:r.getProperty("/bPercentageAvailableForTarget")||false,manifestTargetValue:r.getProperty("/sManifestTargetValue")};return W(f,u,p,n?"Decimal":"")}dt.requiresIContext=true;function Ct(){var t,r=arguments[0];var a=arguments[arguments.length-1];if(typeof arguments[1]!=="object"){t=arguments[1]}var i=a.bODataV4;var n,o;if(typeof r=="string"&&i){r=e.getFloatInstance().parse(r)}if(isNaN(+r)){return""}r=+r;n=+a.numberOfFractionalDigits;if(t){o=+t}else if(a.manifestTargetValue){o=+a.manifestTargetValue}if(!n||n<0){n=0}else if(n>2){n=2}if(o){var l=(r-o)/o;var u=e.getPercentInstance({style:"short",minFractionDigits:n,maxFractionDigits:n,showScale:true});return u.format(l)}}function Tt(e,t){var r=ke(e);if(t&&t.GroupBy&&!p(t.GroupBy)){return r?t.GroupBy[0].hasOwnProperty("$PropertyPath"):t.GroupBy[0].hasOwnProperty("PropertyPath")}return false}Tt.requiresIContext=true;function bt(e,t){var r;for(var a=0;e&&a<e.length;a++){if(e[a].value==t){r=e[a];break}}return r?r.name:null}function Dt(e,t){return bt(e,t)}function Ot(e,t){var r=bt(e,t);return r?r:o.getText("OVP_KEYUSER_LABEL_NO_NAVIGATION")}function It(e,t){var r="";var a=t&&t.GroupBy;if(!a){return r}var i=ke(e);var n=e.getSetting("ovpCardProperties").getProperty("/metaModel");var l=e.getSetting("ovpCardProperties").getProperty("/entityType");var u;if(t.GroupBy.constructor===Array){u=t.GroupBy}else if(!t.GroupBy.Collection){return r}else{u=t.GroupBy.Collection}var s;var c;f(u,function(){c=i?this.$PropertyPath:this.PropertyPath;s=At(n,l,c,e);if(!s){return}r+=s;r+=", "});if(r[r.length-1]===" "&&r[r.length-2]===","){r=r.substring(0,r.length-2)}return r==""?"":o.getText("By",[r])}It.requiresIContext=true;function Vt(e,t,r){var a=true;var i=ke(e);var n=r["SelectOptions"].length-1;if(t.PropertyName.PropertyPath===r["SelectOptions"][n].PropertyName.PropertyPath){a=false}t=[t];var o=e.getSetting("ovpCardProperties");var l=o.getProperty("/entityType");var u=o.getProperty("/metaModel");var s=d.getFilters(o,t,i);if(s.length==0){return""}s=d.createExcludeFilters(s,o);var f;var c;f=s[0].path;c=Rt(u,l,f,e);if(c!==f){return""}var v=u.getODataProperty(l,t[0].PropertyName.PropertyPath)["type"];var g=xt(s,v);if(a===true){return g+", "}return g}Vt.requiresIContext=true;function Ft(e,t,r){var a=!(t.index===r.length-1);var i=e.getSetting("ovpCardProperties");var n=i.getProperty("/metaModel");var o=i.getProperty("/entityType");var l=n.getODataProperty(o,r[t.index].path)["type"];var u=xt([r[t.index]],l);if(a===true){return u+", "}return u}Ft.requiresIContext=true;function St(e){return e.id}function Nt(e){return e.id}function xt(e,t){var r=[];for(var a=0;a<e.length;a++){r.push(Et(e[a],t))}return r.join(", ")}function Et(e,r){var a=false;var i,n=t.getInstance({style:"medium"});if(r==="Edm.DateTime"){i=n.format(new Date(e.value1))}else if(r==="Edm.DateTimeOffset"){i=n.format(new Date(e.value1),true)}else{i=e.value1}if(e.operator[0]==="N"){a=true}if(e.value2){if(r==="Edm.DateTime"){i+=" - "+n.format(new Date(e.value1))}else if(r==="Edm.DateTimeOffset"){i+=" - "+n.format(new Date(e.value1),true)}else{i+=" - "+e.value1}}if(a){i=o.getText("kpiHeader_Filter_NotOperator",[i])}return i}function At(e,t,r,a){return Mt(e,t,r,"com.sap.vocabularies.Common.v1.Label",a)}function Rt(e,t,r,a){return Mt(e,t,r,"sap:text",a)}function Mt(e,t,r,a,i){var n=ke(i);var o;if(n){o={};o[r]=Ut(e,t,r)}else{o=e.getODataProperty(t,r)}if(!o){D.error("No Property Found for with Name '"+r+" For Entity-Type '"+t.name+"'");return}if(n){if(o[r].annotations){var l=o[r].annotations["@"+a]}if(l){return l}return Object.keys(o)[0]}else{var l=o[a];if(l){if(a==="com.sap.vocabularies.Common.v1.Label"){return l.String}return l}return o.name}}function Ut(e,t,r){var a=e.getData().$Annotations[t.$Type+"/"+r];var i=P.getEntitySetName(e,t.$Type);var n=e.getObject("/"+i+"/"+r);var o=y.merge(true,{},a,n);return o}function $t(e,t){var r=ke(e);var a=e.getSetting("ovpCardProperties");if(!t||!t.Value||!t.Value.Path&&!t.Value.$Path){return""}var i={NumberOfFractionalDigits:a.oData.NumberOfFractionalDigits||0,percentageAvailable:a.oData.percentageAvailable||false};var n="CardAnnotationhelper.KpiValueFormatter";var o=r?t.Value.$Path+"Agg":t.Value.Path;var l=[o];return W(l,n,i)}$t.requiresIContext=true;function _t(e,t){return t&&t.hasOwnProperty(e)}function wt(e,t){var r;if(t[e].customDateRangeImplementation){return t[e].customDateRangeImplementation}else if(t[e].filter){r={module:"sap.ui.comp.config.condition.DateRangeType",operations:{filter:t[e].filter}};return JSON.stringify(r)}else if(t[e].selectedValues){r={module:"sap.ui.comp.config.condition.DateRangeType",operations:{filter:[{path:"key",contains:t[e].selectedValues,exclude:t[e].exclude}]}};return JSON.stringify(r)}else if(t[e].defaultValue){r={module:"sap.ui.comp.config.condition.DateRangeType"};return JSON.stringify(r)}}function Lt(e){if(e){return undefined}return"_BASIC"}function qt(e,t){if(t==="com.sap.vocabularies.Common.v1.IsFiscalYearPeriod"){var r=e.substring(0,4);var a=e.substring(4);while(a.length<3){a="0"+a}var i="YYYYPPP";var n={UTC:false,style:"medium"};var o=new m(null,Object.assign({format:i,calendarType:l.Gregorian},n));var u=o.getPattern();if(u==="PPP/YYYY"){return a+"/"+r}else if(u==="PPP.YYYY"){return a+"."+r}else{return a+r}}else{return e}}function jt(e,t,r,a,i,n,o){a=typeof a==="undefined"?false:a;var l=false;var u;if(!e&&a){D.error(i+C.CARD_ERROR+r+C.IS_MANDATORY);return l}if(!e){D.warning(i+C.CARD_WARNING+r+C.IS_MISSING);return true}if(o){e="@"+e}u=t[e];if(!u||typeof u!=="object"){var s=a?D.error:D.warning;s(i+C.CARD_ERROR+"in "+r+". ("+e+" "+C.NOT_WELL_FORMED);return l}var f=o?"sap.ovp.cards.v4.charts.analytical.analyticalChart":"sap.ovp.cards.charts.analytical.analyticalChart";var c=o?!u.ChartType||!u.ChartType.$EnumMember:!u.ChartType||!u.ChartType.EnumMember;if(n&&n===f&&r==="Chart Annotation"&&c){D.error(i+C.CARD_ERROR+C.MISSING_CHARTTYPE+C.CHART_ANNO);return l}return true}return{getFormattedFiscalData:qt,getGroupID:Lt,getConditionTypeForDateProperties:wt,isDateRangeType:_t,TextArrangementType:b,getLabelForDataItem:O,setAlignmentForDataPoint:I,colorPaletteForComparisonMicroChart:ie,formatField:X,checkFilterPreference:ve,formatItems:ge,getCardSelections:de,getCardSorters:Ce,getAnnotationLabel:Dt,getApplicationName:Ot,removeDuplicateDataField:Oe,getDataPointsCount:Ie,getFirstDataPointValue:Ve,getFirstDataFieldName:Se,getSecondDataFieldName:Ne,getRequestFields:ye,getThirdDataFieldName:xe,formatDataFieldValueOnIndex:Ee,formatDataPointValueOnIndex:Ae,formatDataPointOrField:Re,formatsemanticObjectOfDataFieldGeneric:Me,getLabelForFirstDataPoint:Ue,formatImageUrl:$e,formatUnit:_e,formatObjectNumber:we,formatFirstDataPointState:Le,formatFirstDataPointColor:qe,formatSecondDataPointState:je,formatThirdDataPointState:Be,formatKPIHeaderState:He,isFirstDataPointCriticality:Ge,isFirstDataPointCriticalityForTableStatus:Xe,getSortedDataFields:A,getSortedDataPoints:R,formatDataFieldValueGeneric:Je,formatDataPointValue:Qe,formatDataPointStateGeneric:et,checkCriticalityGeneric:tt,checkCriticalityGenericForTableStatus:rt,hasActions:at,isFirstDataPointPercentageUnit:it,resolveEntityTypePath:nt,getAssociationObject:ot,semanticObjectOfFirstDataField:ut,semanticObjectOfSecondDataField:st,isFirstContactAnnotation:ct,getAggregateNumber:vt,KpiValueFormatter:pt,kpiValueCriticality:Ye,formThePathForAggregateNumber:gt,formThePathForTrendIcon:mt,formPathForPercentageChange:Pt,TargetValueFormatter:yt,formPathForTargetValue:dt,returnPercentageChange:Ct,isPresentationVarientPresent:Tt,listGroupBy:It,formTheFilterByString:Vt,formTheFilterByStringNotFromSelVar:Ft,formTheIdForFilter:St,formTheIdForFilterNotFromSelVar:Nt,_criticality2state:S,_calculateCriticalityState:x,_calculateTrendDirection:E,_getPropertiesFromBindingString:he,sortCollectionByImportance:L,checkNavTargetForContactAnno:We,checkForContactAnnotation:Ze,getKPIHeaderAggregateNumber:$t,formatColor:se,formatTrendIcon:ht,formatNumberCalculation:Z,formatCurrency:ee,formatDate:Q,getSapTextPathForUOM:K,getPathOrPrimitiveValue:be,getSorters:Pe,_getItemsLength:De,isODataV4Context:ke,_generatePathForField:W,_getNavigationSuffix:te,_getNavigationPrefix:ce,_getEntityTypeForODataV4Model:Ut,_formatValueFromTarget:ze,checkExists:jt}},true);
//# sourceMappingURL=AnnotationHelper.js.map