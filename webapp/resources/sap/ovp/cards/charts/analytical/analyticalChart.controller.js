/*!
 * Copyright (c) 2009-2014 SAP SE, All Rights Reserved
 */
sap.ui.define(["sap/ovp/cards/generic/base/analytical/BaseAnalyticalChart.controller","sap/ovp/cards/charts/VizAnnotationManager","sap/ovp/app/resources","sap/base/util/each","sap/ovp/filter/FilterUtils","sap/ui/Device","sap/ovp/cards/generic/base/analytical/Utils","sap/base/util/isEmptyObject","sap/ui/core/EventBus"],function(t,e,a,i,s,r,o,n,l){"use strict";return t.extend("sap.ovp.cards.charts.analytical.analyticalChart",{onInit:function(){t.prototype.onInit.apply(this,arguments);var e=this;this.eventhandler=function(t,a,i){s.applyFiltersToV2Card(i,e)};this.GloabalEventBus=l.getInstance();if(this.oMainComponent&&this.oMainComponent.isMacroFilterBar){this.GloabalEventBus.subscribe("OVPGlobalfilter","OVPGlobalFilterSeacrhfired",e.eventhandler)}},onDataReceived:function(t){var s=this;var l=this.getCardContentContainer();if(!l){return}var d=t.getParameter("data");if(!d||n(d)||!d.results||!d.results.length){var h=this.getOwnerComponent().getComponentData();var p=h&&h.cardId;if(p){var u=this.getOwnerComponent().getComponentData().cardId;if(u&&this.oMainComponent&&this.oMainComponent.aErrorCards.indexOf(u)===-1){this.oMainComponent.createNoDataCard(u)}}}else{var c=this.getView().byId("analyticalChart");var g=this.getView().byId("bubbleText");var v=a.getText("BUBBLESIZE");this.oDataSet.bindData("analyticalmodel>/","");c.setDataset(this.oDataSet);var b=c.getParent();if(!this.isVizPropSet){e.buildVizAttributes(c,b,this);this.isVizPropSet=true;if(g!=undefined){var f=c.getFeeds();i(f,function(t,e){if(f[t].getUid()=="bubbleWidth"){g.setText(v+" "+f[t].getValues())}})}e.hideDateTimeAxis(c)}if(this.getCardPropertiesModel()&&this.getCardPropertiesModel().getData()&&this.getCardPropertiesModel().getData().colorPalette&&c.getVizType()==="stacked_column"){var y=c.getDataset().getDimensions(),C=c.getFeeds(),m,D;for(var P=0;P<C.length;P++){if(C[P].getUid()==="color"){m=C[P].getValues()[0];break}}for(var M=0;M<y.length;M++){if(y[M].getName()===m){D=y[M];break}}if(m&&D){var V={};V["bDescending"]=true;D.setSorter(V)}}var B=t?t.getParameter("data"):null;e.setChartUoMTitle(c,B);if(this.bFlag==true){this.bFlag=false;this.vbLayout.setBusy(false)}else{setTimeout(function(){s.vbLayout.setBusy(false);s.bdataLoadedToEnableAddToInsight=true},0)}e.checkNoData(t,this.getCardContentContainer(),c);if(r.system.phone){if(this.getCardPropertiesModel().getProperty("/layoutDetail")==="resizable"){var I=this.oDashboardLayoutUtil.dashboardLayoutModel.getCardById(this.cardId);var S=Math.max(I.dashboardLayout.rowSpan,this.iPreviousRowSpan);this.iPreviousRowSpan=S}if(o.isDataSetEmpty(t)){c.setHeight(50+"px")}else{var T=this._calculateVizFrameHeight();if(T!==undefined&&typeof T==="number"){c.setHeight(T+"px")}}}}}})});
//# sourceMappingURL=analyticalChart.controller.js.map