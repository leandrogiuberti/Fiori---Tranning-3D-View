<core:FragmentDefinition 
	xmlns="sap.m"
	xmlns:core="sap.ui.core"
	xmlns:template="http://schemas.sap.com/sapui5/extension/sap.ui.core.template/1"
	xmlns:suite="sap.suite.ui.commons" 
	xmlns:viz="sap.viz.ui5.controls"
	xmlns:dataSet="sap.viz.ui5.data" 
	xmlns:feed="sap.viz.ui5.controls.common.feeds"
	xmlns:ovp="sap.ovp.ui" 
	xmlns:charts="sap.ovp.cards.charts"
	template:require="{
		CardAnnotationhelper: 'sap/ovp/cards/AnnotationHelper',
		VizAnnotationManagerV2: 'sap/ovp/cards/charts/VizAnnotationManager',
		ModelAnnotationhelper: 'sap/ui/model/odata/AnnotationHelper'
	}"	
>
	<VBox class="ovpChartTitleVBox cardType" id="vbLayout">
        <customData>
            <ovp:CustomData key="aria-label" value="{ovplibResourceBundle>analyticalCardType}" writeToDom="true" />
        </customData>
		<template:with 
			path="ovpCardProperties>/chartAnnotationPath"
			helper="CardAnnotationhelper.resolveEntityTypePath" 
			var='chart'>
			<template:with 
				path="ovpCardProperties>/selectionAnnotationPath"
				helper="CardAnnotationhelper.resolveEntityTypePath" 
				var='selVar'>
				<template:with 
					path="ovpCardProperties>/presentationAnnotationPath"
					helper="CardAnnotationhelper.resolveEntityTypePath" 
					var='preVar'>
					<template:if test="{chart>}">
	<!-- 				FIORITECHP1-4935Reversal of Scale factor in Chart and Chart title. -->
	<!-- 				<template:if test="{chart>Title}"> -->
	<!-- 				</template:if> -->
						<template:if test="{path:'chart>DimensionAttributes', formatter: 'VizAnnotationManagerV2.dimensionAttrCheck'}">
							<template:if test="{path:'chart>MeasureAttributes', formatter: 'VizAnnotationManagerV2.measureAttrCheck'}">
								<template:if test="{chart>ChartType}">
									<template:if test="{preVar>MaxItems}">
										<template:then>
											<charts:OVPVizDataHandler
												chartType="{path: 'chart>ChartType', formatter: 'VizAnnotationManagerV2.getChartType'}"
												entitySet="{ path:'entitySet>' , formatter: 'VizAnnotationManagerV2.getEntitySet' }"
												data="{parts: [{path:'entitySet>'}, {path:'selVar>'}, {path:'preVar>'}, {path:'chart>DimensionAttributes'}, {path:'chart>MeasureAttributes'}, {path:'chart>ChartType'}], formatter: 'VizAnnotationManagerV2.formatItems'}"
												aggregateData="{parts: [{path:'entitySet>'}, {path:'selVar>'}, {path:'preVar>'}, {path:'chart>undefined'}, {path:'chart>MeasureAttributes'}, {path:'chart>ChartType'}], formatter: 'VizAnnotationManagerV2.formatItems'}">
												<charts:data>
													<core:Element />
												</charts:data>
												<charts:aggregateData>
													<core:Element />
												</charts:aggregateData>
												<charts:content width="100%">
													<viz:VizFrame 
														id="analyticalChart" 
														class="ovpViz"
														uiConfig="{applicationSet:'fiori'}"
														vizType="{parts: [{path: 'chart>ChartType'}, {path: 'chart>DimensionAttributes'}], formatter: 'VizAnnotationManagerV2.getChartType'}"
														width="100%">
														<viz:customData>
															<template:if test="{chart>Title}">
																<ovp:CustomData
																	key="aria-label"
																	value="{path: 'chart>Title', formatter: 'ModelAnnotationhelper.format'}"
																	writeToDom="true" />
															</template:if>
														</viz:customData>
														<viz:dataset>
															<dataSet:FlattenedDataset data="{analyticalmodel>/}">
															</dataSet:FlattenedDataset>
														</viz:dataset>
													</viz:VizFrame>
												</charts:content>
											</charts:OVPVizDataHandler>
										</template:then>
										<template:else>
											<charts:OVPVizDataHandler
												chartType="{path: 'chart>ChartType', formatter: 'VizAnnotationManagerV2.getChartType'}"
												entitySet="{ path:'entitySet>' , formatter: 'VizAnnotationManagerV2.getEntitySet' }"
												data="{parts: [{path:'entitySet>'}, {path:'selVar>'}, {path:'preVar>'}, {path:'chart>DimensionAttributes'}, {path:'chart>MeasureAttributes'}, {path:'chart>ChartType'}], formatter: 'VizAnnotationManagerV2.formatItems'}">
												<charts:data>
													<core:Element />
												</charts:data>
												<charts:aggregateData>
													<core:Element />
												</charts:aggregateData>
												<charts:content width="100%">
													<viz:VizFrame 
														id="analyticalChart" 
														class="ovpViz"
														uiConfig="{applicationSet:'fiori'}"
														vizType="{parts: [{path: 'chart>ChartType'}, {path: 'chart>DimensionAttributes'}], formatter: 'VizAnnotationManagerV2.getChartType'}"
														width="100%">
														<viz:customData>
															<template:if test="{chart>Title}">
																<ovp:CustomData
																	key="aria-label"
																	value="{path: 'chart>Title', formatter: 'ModelAnnotationhelper.format'}"
																	writeToDom="true" />
															</template:if>
														</viz:customData>
														<viz:dataset>
															<dataSet:FlattenedDataset data="{analyticalmodel>/}">
															</dataSet:FlattenedDataset>
														</viz:dataset>
													</viz:VizFrame>
												</charts:content>
											</charts:OVPVizDataHandler>
										</template:else>
									</template:if>
								</template:if>
							</template:if>
						</template:if>
					</template:if>
				</template:with>
			</template:with>
		</template:with>
	</VBox>
	
	<template:with 
		path="ovpCardProperties>/chartAnnotationPath"
		helper="CardAnnotationhelper.resolveEntityTypePath" 
		var='chart'>
		<template:if test="{chart>}">
			<template:if test="{chart>ChartType}">
				<template:if test="{path:'chart>ChartType',formatter:'VizAnnotationManagerV2.checkBubbleChart'}">
					<Text id="bubbleText" class="ovpChartFooter"/>
				</template:if>
			</template:if>
		</template:if>
	</template:with>
</core:FragmentDefinition>