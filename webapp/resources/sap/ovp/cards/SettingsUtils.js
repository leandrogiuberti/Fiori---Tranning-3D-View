/*!
 * Copyright (c) 2009-2014 SAP SE, All Rights Reserved
 */
sap.ui.define(["sap/m/Dialog","sap/m/Button","sap/ovp/cards/PayLoadUtils","sap/ovp/cards/OVPCardAsAPIUtils","sap/ovp/cards/rta/SettingsDialogConstants","sap/ovp/cards/CommonUtils","sap/ovp/cards/generic/base/analytical/Utils","sap/ui/Device","sap/m/MessagePopover","sap/m/MessageItem","sap/m/Link","sap/m/MessageBox","sap/ovp/cards/AnnotationHelper","sap/ui/core/mvc/ViewType","sap/ui/model/json/JSONModel","sap/ovp/app/resources","sap/base/util/merge","sap/ovp/app/OVPLogger","sap/ui/model/odata/v2/ODataModel","sap/ui/model/odata/CountMode","sap/ui/core/mvc/View","sap/ui/core/Element"],function(e,t,a,i,n,r,o,s,l,d,p,c,u,f,g,v,h,m,y,C,b,P){"use strict";var S=v;var w=new m("OVP.cards.SettingsUtils");function V(e,t,a){var n=e.getComponentInstance(),o=n.getComponentData(),s=o.appComponent,l=o.mainComponent,d=a?"":o.cardId,p=d+"Dialog",c=a?"":o.modelName,u=!c?undefined:s.getModel(c),f=t.getModel().getData(),g={cards:{}};g.cards[p]={template:f.template,settings:f};if(ve.bNewKPICardFlag){var v=f.selectedKPI;u=new y(v.ODataURI,{annotationURI:v.ModelURI,defaultCountMode:C.None});c=r._getLayerNamespace()+".kpi_card_model_"+L(v.ODataURI)}if(u&&!!c){g.cards[p].model=c;t.setModel(u,c)}g.cards[p]=l._getTemplateForChart(g.cards[p]);t.getController()._oManifest=g;if(ve.bNewKPICardFlag){u.getMetaModel().loaded().then(function(){var e=i.createCardComponent(t,g,"dialogCard");e.then(function(){t.setBusy(false)}).catch(function(){D(g.cards[p].settings,"OVP_KEYUSER_ANNOTATION_FAILURE");E(t,g,p)})},function(e){w.error(e)});u.attachMetadataFailed(function(){D(g.cards[p].settings,"OVP_KEYUSER_METADATA_FAILURE");E(t,g,p)})}else{i.createCardComponent(t,g,"dialogCard")}}function O(e,t){if(!this.oNewDataSources[e]){this.oNewDataSources[e]={uri:t}}}function I(e){if(this.oNewDataSources[e]){delete this.oNewDataSources[e]}}function T(e){var t=this.oAppComponent,a=t.getManifestEntry("sap.app").dataSources;if(this.oNewDataSources[e]){return this.oNewDataSources}return a}function L(e){var t=e.split("/");return t[t.length-1]?t[t.length-1]:t[t.length-2]}function E(e,t,a){var n=e.getModel();var o=r.isODataV4(n);var s=o?"sap.ovp.cards.v4.error":"sap.ovp.cards.error";t.cards[a].template=s;t.cards[a].model=undefined;var l=i.createCardComponent(e,t,"dialogCard");var d=e.getController();l.then(function(){e.setBusy(false);d.setBusy(false)}).catch(function(){e.setBusy(false);d.setBusy(false)})}function D(e,t){if(e){e.errorStatusText=v.getText(t)}}function A(e){if(e.indexOf("#")!==-1){return e.split("#")[1]}else{return"Default"}}function R(e,t){if(e){var a,i,n;if(e.indexOf("{")===0&&e.indexOf("}")===e.length-1){e=e.slice(1,-1);if(e.indexOf(">")!=-1){a=e.split(">");n=a[0];i=a[1]}else if(e.indexOf("&gt;")!=-1){a=e.split("&gt;");n=a[0];i=a[1]}if(!!i&&n==="@i18n"&&ve.oi18nModel){return ve.oi18nModel.getProperty(i)}else{return e}}else{return e}}else{return t}}function x(e,t,a,i){if(t[e]&&t[e][a]){var n=typeof t[e][a]==="string"?t[e][a]:t[e][a].String;return R(n,i)}else{return i}}function _(e,t){var a=A(t),i=v.getText("OVP_KEYUSER_LABEL_DEFAULT_LABEL_WITH_QUALIFIER",[a]);i=i?i:a;if(t.indexOf(",")!==-1){t=t.split(",")[0]}if(t.indexOf(".Identification")!==-1){if(e[t]){var n=u.sortCollectionByImportance(e[t]);for(var r=0;r<n.length;r++){var o=n[r];if(o.RecordType==="com.sap.vocabularies.UI.v1.DataFieldForIntentBasedNavigation"){if(o&&o["Label"]){return R(o["Label"].String,i)}else{return o["SemanticObject"].String+"-"+o["Action"].String}}if(o.RecordType==="com.sap.vocabularies.UI.v1.DataFieldWithUrl"){if(o&&o["Label"]){return R(o["Label"].String,i)}else{return o["Url"].String}}}}return v.getText("OVP_KEYUSER_LABEL_NO_NAVIGATION")}else if(t.indexOf(".LineItem")!==-1){var s=u.sortCollectionByImportance(e[t]);s.forEach(function(e,t){if(e["RecordType"]&&e["RecordType"].indexOf(".DataField")!==-1&&e["Label"]){s[t]["Label"]={String:R(e["Label"].String,i)}}});return s}else if(t.indexOf(".HeaderInfo")!==-1){if(e[t]&&e[t]["Description"]&&e[t]["Description"].Label){return R(e[t]["Description"].Label.String,i)}else{return i}}else if(t.indexOf(".PresentationVariant")!==-1||t.indexOf(".SelectionVariant")!==-1||t.indexOf(".SelectionPresentationVariant")!==-1){return x(t,e,"Text",i)}else if(t.indexOf(".DataPoint")!==-1){return x(t,e,"Title",i)}else if(t.indexOf(".Chart")!==-1){return x(t,e,"Description",i)}else if(t.indexOf(".FieldGroup")!==-1){return x(t,e,"Label",i)}else{var l="";if(a!=="Default"){l="#"+a}var d="com.sap.vocabularies.Common.v1.Label"+l;if(e[t]&&e[t][d]){return R(e[t][d].String,i)}else{return i}}}function k(e,t){var a=A(t),i=v.getText("OVP_KEYUSER_LABEL_DEFAULT_LABEL_WITH_QUALIFIER",[a]);i=i?i:a;if(t.indexOf(",")!==-1){t=t.split(",")[0]}if(t.indexOf(".Identification")!==-1){if(e[t]){var n=u.sortCollectionByImportance(e[t]);for(var r=0;r<n.length;r++){var o=n[r];if(o.$Type==="com.sap.vocabularies.UI.v1.DataFieldForIntentBasedNavigation"){if(o&&o["Label"]){return R(o["Label"],i)}else{return o["SemanticObject"]+"-"+o["Action"]}}if(o.$Type==="com.sap.vocabularies.UI.v1.DataFieldWithUrl"){if(o&&o["Label"]){return R(o["Label"],i)}else{return o["Url"]}}}}return v.getText("OVP_KEYUSER_LABEL_NO_NAVIGATION")}else if(t.indexOf(".LineItem")!==-1){var n=u.sortCollectionByImportance(e[t]);n.forEach(function(e,t){if(e["$Type"]&&e["$Type"].indexOf(".DataField")!==-1&&e["Label"]){n[t]["Label"]=R(e["Label"],i)}});return n}else if(t.indexOf(".HeaderInfo")!==-1){if(e[t]&&e[t]["Description"]&&e[t]["Description"].Label){return R(e[t]["Description"].Label,i)}else{return i}}else if(t.indexOf(".PresentationVariant")!==-1||t.indexOf(".SelectionVariant")!==-1||t.indexOf(".SelectionPresentationVariant")!==-1){return x(t,e,"Text",i)}else if(t.indexOf(".DataPoint")!==-1){return x(t,e,"Title",i)}else if(t.indexOf(".Chart")!==-1){return x(t,e,"Description",i)}else if(t.indexOf(".FieldGroup")!==-1){return x(t,e,"Label",i)}else{var s="";if(a!=="Default"){s="#"+a}var l="com.sap.vocabularies.Common.v1.Label"+s;if(e[t]&&e[t][l]){return R(e[t][l],i)}else{return i}}}function N(e,t,a){switch(t){case"cardPreview":return i.getSupportedCardTypes().indexOf(e)!==-1;case"noOfRows":case"noOfColumns":case"stopResizing":var n=["sap.ovp.cards.stack"];return n.indexOf(e)===-1;case"listType":case"listFlavor":var r=["sap.ovp.cards.list","sap.ovp.cards.v4.list"];return r.indexOf(e)!==-1;case"listFlavorForLinkList":var o=["sap.ovp.cards.linklist","sap.ovp.cards.v4.linklist"];return o.indexOf(e)!==-1;case"isViewSwitchSupportedCard":case"showViewSwitch":case"kpiHeader":var s=["sap.ovp.cards.list","sap.ovp.cards.table","sap.ovp.cards.v4.list","sap.ovp.cards.v4.table","sap.ovp.cards.charts.analytical","sap.ovp.cards.charts.smart.chart","sap.ovp.cards.charts.bubble","sap.ovp.cards.charts.donut","sap.ovp.cards.charts.line"];return s.indexOf(e)!==-1;case"chartSPVorKPI":case"chart":var l=["sap.ovp.cards.charts.analytical","sap.ovp.cards.charts.smart.chart","sap.ovp.cards.charts.bubble","sap.ovp.cards.charts.donut","sap.ovp.cards.charts.line"];return l.indexOf(e)!==-1;case"sortOrder":case"sortBy":case"lineItem":if(!a){var d=["sap.ovp.cards.list","sap.ovp.cards.table","sap.ovp.cards.v4.list","sap.ovp.cards.v4.table"];return d.indexOf(e)!==-1}else{var d=["sap.ovp.cards.list","sap.ovp.cards.table","sap.ovp.cards.v4.list","sap.ovp.cards.v4.table","sap.ovp.cards.charts.analytical","sap.ovp.cards.linklist","sap.ovp.cards.v4.linklist","sap.ovp.cards.stack"];return d.indexOf(e)!==-1}break;case"identification":var p=["sap.ovp.cards.stack"];return p.indexOf(e)!==-1;case"addViewSwitch":var c=["sap.ovp.cards.list","sap.ovp.cards.table","sap.ovp.cards.v4.list","sap.ovp.cards.v4.table"];return c.indexOf(e)!==-1;case"addKPIHeader":var c=["sap.ovp.cards.list","sap.ovp.cards.table","sap.ovp.cards.v4.list","sap.ovp.cards.v4.table","sap.ovp.cards.charts.analytical"];return c.indexOf(e)!==-1;case"selecionOrPresentation":var u=["sap.ovp.cards.list","sap.ovp.cards.table","sap.ovp.cards.v4.list","sap.ovp.cards.v4.table","sap.ovp.cards.linklist","sap.ovp.cards.v4.linklist"];return u.indexOf(e)!==-1;case"addODataSelect":var f=["sap.ovp.cards.list","sap.ovp.cards.table","sap.ovp.cards.v4.list","sap.ovp.cards.v4.table","sap.ovp.cards.stack"];return f.indexOf(e)!==-1;case"addCustomActions":var f=["sap.ovp.cards.stack"];return f.indexOf(e)!==-1;case"setCardProperties":if(a){var d=["sap.ovp.cards.list","sap.ovp.cards.table","sap.ovp.cards.v4.list","sap.ovp.cards.v4.table","sap.ovp.cards.linklist","sap.ovp.cards.v4.linklist","sap.ovp.cards.stack"];return d.indexOf(e)!==-1}break;default:break}}function M(e){return!!e.kpiAnnotationPath}function F(e){return!!e.selectionPresentationAnnotationPath}function B(e){return F(e)||M(e)}function K(e){return e.substring(e.lastIndexOf("_")+1,e.length).indexOf("C")!==-1}function H(e){if(e.NewKPICard){return e.NewKPICard}else if(e.selectedKPICardID){return e.selectedKPICardID.indexOf("newKPICard")!==-1}else{return false}}function U(e,t,a,i){var n=true;var r=true;var o=false;var s=false;var l=false;if(a){if(e.mainViewSelected){r=false}else{n=false}}if(e.addNewCard&&e.model){var s=true;if(e.template){l=true;if(e.entitySet){o=true}}}var d=X(e);var p=d&&d.substring(1);var c=e.entityType&&e.entityType[p];var u=c&&c.CriticalityCalculation&&c.CriticalityCalculation.ImprovementDirection&&c.CriticalityCalculation.ImprovementDirection.EnumMember;var f=e.tabs||[];var g=parseInt(e["selectedKey"],10);var v;if(g){v=f[g-1]}var h;switch(t){case"cardPreview":h=N(e.template,"cardPreview");break;case"noOfRows":case"noOfColumns":case"stopResizing":h=n&&N(e.template,t);break;case"title":h=n;break;case"dynamicSwitchSubTitle":h=n&&!!e.dynamicSubTitle;break;case"enableAddToInsights":h=n&&!!e.enableAddToInsights;break;case"dynamicSwitchStateSubTitle":h=!!e.dynamicSubtitleAnnotationPath;break;case"toleranceRangeHighValue":h=W("toleranceRangeHighValue",v,e,u);break;case"toleranceRangeLowValue":h=W("toleranceRangeLowValue",v,e,u);break;case"deviationRangeHighValue":h=W("deviationRangeHighValue",v,e,u);break;case"deviationRangeLowValue":h=W("deviationRangeLowValue",v,e,u);break;case"subTitle":if(!e.addNewCard){if(!e.subTitle){e.subTitle=" ";h=true}else{h=n&&!e.dynamicSubtitleAnnotationPath}}else{h=n}break;case"dynamicSubTitle":h=n&&!!e.dynamicSubtitleAnnotationPath;break;case"valueSelectionInfo":if(!e.addNewCard){if(!e.valueSelectionInfo){e.valueSelectionInfo=" "}h=n&&N(e.template,"kpiHeader")&&!!e.dataPointAnnotationPath&&!H(e)}else{h=n&&s&&l&&o&&e.addKPIHeaderCheckBox&&N(e.template,"addKPIHeader")}break;case"dataPoint":if(!e.addNewCard){h=r&&!M(e)&&N(e.template,"kpiHeader")&&!!e.dataPointAnnotationPath}else{h=r&&s&&l&&o&&e.addKPIHeaderCheckBox&&N(e.template,"addKPIHeader")}break;case"listType":case"listFlavor":case"listFlavorForLinkList":if(!e.addNewCard){h=n&&N(e.template,t)}else{h=n&&s&&l&&o&&N(e.template,t)}break;case"identification":if(!e.addNewCard){h=r&&!e.staticContent&&!N(e.template,t)}else{h=r&&s&&l&&o&&!N(e.template,t)}break;case"selectionPresentationVariant":if(!e.addNewCard){h=r&&F(e)&&!M(e)&&N(e.template,"kpiHeader")}else{h=r&&s&&l&&o&&N(e.template,"selecionOrPresentation")&&!!(Array.isArray(e.selectionPresentationVariant)&&e.selectionPresentationVariant.length)}break;case"KPI":case"dataPointSelectionMode":if(!e.addNewCard){h=r&&M(e)&&!F(e)&&N(e.template,"chart")&&!H(e)}else{h=r&&s&&l&&o&&N(e.template,"chart")}break;case"presentationVariant":case"selectionVariant":if(!e.addNewCard){h=r&&!B(e)&&!e.staticContent&&N(e.template,"kpiHeader")}else{h=r&&s&&l&&o&&!(Array.isArray(e.selectionPresentationVariant)&&e.selectionPresentationVariant.length)&&N(e.template,"selecionOrPresentation")}break;case"kpiHeader":h=n&&!M(e)&&N(e.template,t);break;case"lineItem":case"chart":if(!e.addNewCard){h=r&&!B(e)&&N(e.template,t)}else{h=r&&s&&l&&o&&N(e.template,t,e.addNewCard)}break;case"chartSPVorKPI":h=r&&B(e)&&!H(e)&&N(e.template,t);break;case"presentationVariantSPVorKPI":case"selectionVariantSPVorKPI":h=r&&B(e)&&!H(e)&&!e.staticContent&&N(e.template,"kpiHeader");break;case"showViewName":h=a&&r;break;case"showDefaultView":if(a&&r){if(e.defaultViewSelected!=e.selectedKey){h=true}}else{h=false}break;case"showEntitySet":if(a&&r){if(e.selectedKey>0&&e.tabs[e.selectedKey-1].entitySet){h=true}else{h=false}}else{h=false}break;case"showMore":case"removeVisual":case"lineItemSubTitle":case"lineItemTitle":case"staticLink":case"links":var m=(e.template==="sap.ovp.cards.linklist"||e.template==="sap.ovp.cards.v4.linklist")&&!!e.staticContent;if(t==="staticLink"){h=m&&!!e.staticContent[i].targetUri}else if(t==="links"){h=m&&!!e.staticContent[i].semanticObject}else if(t==="removeVisual"){h=m&&(!!e.staticContent[i].targetUri||!!e.staticContent[i].semanticObject)}else{h=m}break;case"selectCardType":h=n&&s;break;case"addKPIHeader":h=n&&s&&l&&N(e.template,t);break;case"setEntitySet":h=r&&s&&l;break;case"setCardProperties":h=n&&s&&l&&o&&N(e.template,t,e.addNewCard);break;case"setGeneralCardProperties":h=n&&s&&l&&o;break;case"setAnnotationCardProperties":h=r&&s&&l&&o;break;case"subTitleRequired":h=s&&l&&o&&e.addKPIHeaderCheckBox;break;case"addODataSelect":if(!e.addNewCard){h=r&&N(e.template,t)}else{h=r&&s&&l&&o&&N(e.template,t)}break;case"isViewSwitchSupportedCard":case"showViewSwitch":h=s&&l&&(o||!!e.showViewSwitchButton)&&N(e.template,t);break;case"dataSource":h=n;break;case"dataSourceExisting":h=!e.newDataSource;break;case"dataSourceNew":h=e.newDataSource;break;case"addCustomActions":h=n&&N(e.template,t);break;default:break}return h}function W(e,t,a,i){if(t){return!!i&&!!t[e]}else{return!!i&&!!a[e]}}function z(e){var t=false;this.oVisibility.viewSwitchEnabled=false;this.oVisibility.showViewSwitch=false;if(!this.bAddNewCardFlag){if(N(e.template,"isViewSwitchSupportedCard")&&!H(e)){if(e.tabs&&e.tabs.length){t=true;this.oVisibility.showViewSwitch=true}this.oVisibility.viewSwitchEnabled=true}}else{if(e.tabs&&e.tabs.length){t=true;this.oVisibility.showViewSwitch=U(e,"showViewSwitch")}this.oVisibility.viewSwitchEnabled=U(e,"isViewSwitchSupportedCard")}this.oVisibility.cardPreview=U(e,"cardPreview");this.oVisibility.stopResizing=U(e,"stopResizing",t);this.oVisibility.toleranceRangeHighValue=U(e,"toleranceRangeHighValue",t);this.oVisibility.toleranceRangeLowValue=U(e,"toleranceRangeLowValue",t);this.oVisibility.deviationRangeHighValue=U(e,"deviationRangeHighValue",t);this.oVisibility.deviationRangeLowValue=U(e,"deviationRangeLowValue",t);this.oVisibility.noOfRows=U(e,"noOfRows",t);this.oVisibility.noOfColumns=U(e,"noOfColumns",t);this.oVisibility.title=U(e,"title",t);this.oVisibility.subTitle=U(e,"subTitle",t);this.oVisibility.valueSelectionInfo=U(e,"valueSelectionInfo",t);this.oVisibility.listType=U(e,"listType",t);this.oVisibility.listFlavor=U(e,"listFlavor",t);this.oVisibility.listFlavorForLinkList=U(e,"listFlavorForLinkList",t);if((e.template==="sap.ovp.cards.linklist"||e.template==="sap.ovp.cards.v4.linklist")&&!!e.staticContent){var a=e.staticContent,i={},n={},r={},o={};for(var s=0;s<a.length;s++){var l=a[s].index;i[l]=U(e,"staticLink",null,s);n[l]=U(e,"links",null,s);r[l]=U(e,"removeVisual",null,s);o[l]=U(e,"showMore",null,s)}this.oVisibility.staticLink=i;this.oVisibility.links=n;this.oVisibility.removeVisual=r;this.oVisibility.showMore=o}this.oVisibility.lineItemTitle=U(e,"lineItemTitle");this.oVisibility.lineItemSubTitle=U(e,"lineItemSubTitle");this.oVisibility.showViewName=U(e,"showViewName",t);this.oVisibility.showDefaultView=U(e,"showDefaultView",t);this.oVisibility.showEntitySet=U(e,"showEntitySet",t);this.aVariantNames.forEach(function(a){this.oVisibility[a.sPath]=U(e,a.sPath,t)&&!!e[a.sPath]&&!!e[a.sPath].length}.bind(this));this.oVisibility.kpiHeader=U(e,"kpiHeader",t)&&!!e["dataPoint"]&&!!e["dataPoint"].length;this.oVisibility.dynamicSwitchSubTitle=U(e,"dynamicSwitchSubTitle",t);this.oVisibility.dynamicSwitchStateSubTitle=U(e,"dynamicSwitchStateSubTitle",t);this.oVisibility.dataSource=U(e,"dataSource",t);this.oVisibility.dataSourceExisting=U(e,"dataSourceExisting",t);this.oVisibility.dataSourceNew=U(e,"dataSourceNew",t);this.oVisibility.selectCardType=U(e,"selectCardType",t);this.oVisibility.addKPIHeader=U(e,"addKPIHeader",t);this.oVisibility.setEntitySet=U(e,"setEntitySet",t);this.oVisibility.setCardProperties=U(e,"setCardProperties",t);this.oVisibility.setGeneralCardProperties=U(e,"setGeneralCardProperties",t);this.oVisibility.subTitleRequired=U(e,"subTitleRequired",t);this.oVisibility.dataPointSelectionMode=U(e,"dataPointSelectionMode",t);var d;for(var s=0;s<this.aVisiblePropertiesForAnnotation.length;s++){if(this.oVisibility[this.aVisiblePropertiesForAnnotation[s].sProperty]){d=true;break}}this.oVisibility.setAnnotationCardProperties=d?U(e,"setAnnotationCardProperties",t):false;this.oVisibility.addODataSelect=U(e,"addODataSelect",t);this.oVisibility.addCustomActions=U(e,"addCustomActions",t);this.oVisibility.moveToTheTop=false;this.oVisibility.moveUp=false;this.oVisibility.moveDown=false;this.oVisibility.moveToTheBottom=false;this.oVisibility.delete=false}function Y(e){var t=e.getProperty("/staticContent");for(var a=0;a<t.length;a++){t[a].index="Index--"+(a+1)}e.setProperty("/staticContent",t)}function j(e){var t=0;for(var a=e.length-1;a>=0;a--){if(/^\d+$/.test(e[a])){t=parseInt(e[a],10);break}}return t}function G(e){var t=e&&e.metaModel&&e.metaModel.oModel;var a=r.isODataV4(t);var i=parseInt(e.selectedKey,10);if(e.lineItem){e.lineItem.forEach(function(t){if(a&&t.value==="@"+e.annotationPath||t.value===e.annotationPath){e.lineItemQualifier=t.name}})}if(e.tabs&&e.tabs.length&&i){e.viewName=e.tabs[i-1].value;e.isDefaultView=false;if(i===e.defaultViewSelected){e.isDefaultView=true}}var n=e.sortOrder;e.sortOrder="descending";if(n&&n.toLowerCase()!=="descending"){e.sortOrder="ascending"}e.isExtendedList=false;if(e.listType==="extended"){e.isExtendedList=true}e.bInsightsEnable=false;if(e.enableAddToInsights){e.bInsightsEnable=true}var o=Q(e);var s=X(e);if(o&&s){var l=s.substring(1);var d=e.entityType&&e.entityType[l];var p=e;if(e.tabs&&e.tabs.length){if(i===0){p=e.tabs[e.defaultViewSelected-1]}else{p=e.tabs[i-1]}}$(p,d);var c=["deviationRangeLowValue","deviationRangeHighValue","toleranceRangeLowValue","toleranceRangeHighValue"];if(e.tabs&&e.tabs.length&&i){c.forEach(function(t){e.tabs[i-1][t]=p[t]?p[t].toString():p[t]})}c.forEach(function(t){e[t]=p[t]?p[t].toString():p[t]})}e.isBarList=false;if(e.listFlavor==="bar"){e.isBarList=true}e.hasKPIHeader=false;if(e.dataPointAnnotationPath){e.hasKPIHeader=true}return e}function $(e,t){var a=t.CriticalityCalculation.ImprovementDirection.EnumMember||"";var i=e.deviationRangeLowValue||o.getNumberValue(t.CriticalityCalculation.DeviationRangeLowValue);var n=e.deviationRangeHighValue||o.getNumberValue(t.CriticalityCalculation.DeviationRangeHighValue);var r=e.toleranceRangeLowValue||o.getNumberValue(t.CriticalityCalculation.ToleranceRangeLowValue);var s=e.toleranceRangeHighValue||o.getNumberValue(t.CriticalityCalculation.ToleranceRangeHighValue);if(a.endsWith("Minimize")||a.endsWith("Minimizing")&&(s&&n)){e.toleranceRangeHighValue=s;e.deviationRangeHighValue=n}else if(a.endsWith("Maximize")||a.endsWith("Maximizing")&&(r&&i)){e.deviationRangeLowValue=i;e.toleranceRangeLowValue=r}else if(a.endsWith("Target")&&(r&&i&&s&&n)){e.toleranceRangeLowValue=r;e.toleranceRangeHighValue=s;e.deviationRangeLowValue=i;e.deviationRangeHighValue=n}}function Q(e){var t=o.getConfig();var a=e.entityType&&e.entityType[e.chartAnnotationPath];var i=a&&a.ChartType&&a.ChartType.EnumMember;var n=i&&i.split("/")[1];var r=n&&n.toLowerCase();var s=Object.values(t).find(function(e){return e.default&&e.default.type&&e.default.type.toLowerCase()===r||e.time&&e.time.type&&e.time.type.toLowerCase()===r});return s&&s.default&&s.default.properties&&s.default.properties.semanticColor||false}function X(e){var t=e.entityType&&e.entityType[e.chartAnnotationPath];var a=t&&t.MeasureAttributes;var i=a&&a[0];var n=i&&i.DataPoint&&i.DataPoint.AnnotationPath;return n}function q(e){var t=e&&e.metaModel&&e.metaModel.oModel;var a=r.isODataV4(t);var i=e.kpiAnnotationPath;var n=e.template;var o=a?e.entityType.$Type:e.entityType;var s="";if(i&&o&&n==="sap.ovp.cards.charts.analytical"){var l=o[i];var d=l&&l.Detail;if(d&&d.RecordType==="com.sap.vocabularies.UI.v1.KPIDetailType"&&d.SemanticObject&&d.Action){s="#"+d.SemanticObject.String+"-"+d.Action.String}}e["KPINav"]=s}function J(e){var t=[],a=e.metaModel,i=!!a?a.getODataEntityContainer().entitySet:[],n=a&&a.getODataEntityContainer().namespace+".";i.forEach(function(i){if(!e.addNewCard){var r=v.getText("OVP_KEYUSER_LABEL_DEFAULT_LABEL_WITH_QUALIFIER",[i.name]),o=a.getODataEntityType(i.entityType)["sap:label"];t.push({name:R(o,r),value:i.name})}else{var r=v.getText("OVP_KEYUSER_LABEL_DEFAULT_LABEL_WITH_QUALIFIER",[i.name]),o=a.getODataEntityType(i.entityType)["sap:label"],s=i.entityType.split(n)[1];t.push({name:R(o,r),value:i.name,entityType:s})}});if(t.length>0){e["allEntitySet"]=t}}function Z(e){var t=e.metaModel,a=t.getObject("/"),i=Object.keys(a),n=[],r=[];for(var o=0;o<i.length;o++){if(i[o].startsWith("$")){continue}n.push({name:i[o],entityType:a[i[o]].$Type})}var s=t.getData();var l=s.$EntityContainer;var d=l?l.split("."):"";d.pop();var p=d.join(".")+".";n.forEach(function(t){var a=v.getText("OVP_KEYUSER_LABEL_DEFAULT_LABEL_WITH_QUALIFIER",[t.name]);var i=s&&s[t.entityType]&&s[t.entityType]["sap:label"];if(!e.addNewCard){r.push({name:R(i,a),value:t.name})}else{var n=t.entityType.split(p)[1];r.push({name:R(i,a),value:t.name,entityType:n})}});if(r.length>0){e["allEntitySet"]=r}}function ee(e){var t=e.metaModel&&e.metaModel.getObject("/dataServices/schema")&&e.metaModel.getObject("/dataServices/schema")[0].entityType;if(t){t.forEach(function(t){var a=0;this.aVariantNames.forEach(function(e){for(var i in t){if(i.indexOf(e.sVariant)!==-1){a++}}});if(!a){e.allEntitySet=e.allEntitySet.filter(function(e){return e.entityType!==t.name})}}.bind(this))}}function te(e){var t=e&&e.metaModel&&e.metaModel.oModel;var a=r.isODataV4(t);var i;if(a){i=e.metaModel.getData()["$Annotations"][e.entityType.$Type]}else{i=e.entityType}if(!e["allEntitySet"]){if(a){Z(e)}else{J(e)}}q(e);if(e.addNewCard){ee.call(this,e)}this.aVariantNames.forEach(function(t){var n=[],r=1;for(var o in i){if(i.hasOwnProperty(o)&&o.indexOf(t.sVariant)!==-1){if(t.sVariant===".LineItem"){var s={name:S.getText("OVP_KEYUSER_LABEL_LINEITEM_OPTIONS",[r]),value:a?o.substring(1):o,fields:a?k(i,o):_(i,o)};n.push(s);r++}else{n.push({name:a?k(i,o):_(i,o),value:a?o.substring(1):o})}}}if(n.length!==0){e[t.sPath]=n}});if(a){var n=ge(e);e["modelProperties"]=n.map(function(e){return{name:e,value:e}})}else if(e.entityType&&e.entityType.property){e["modelProperties"]=e.entityType.property.map(function(e){return{name:e.name,value:e.name}})}if(!!e.tabs&&e.tabs.length){var o=false,s=e.tabs[e.tabs.length-1].value,l=s.split(" ");e.newViewCounter=j(l);e.defaultViewSelected=e.selectedKey;e.isViewResetEnabled=false;e.aViews=[{text:S&&S.getText("OVP_KEYUSER_LABEL_MAIN_VIEW"),key:0,isLaterAddedView:false,isViewResetEnabled:false}];o=e.tabs.some(function(e){return e.dataPointAnnotationPath});e.tabs.forEach(function(t,a){var i=t.value;if(o&&!t.dataPointAnnotationPath&&t.dataPoint&&t.dataPoint.length){t.dataPointAnnotationPath=t.dataPoint[0].value}if(a+1===e.selectedKey){i=t.value;if(S){i+=" ("+S.getText("OVP_KEYUSER_LABEL_DEFAULT_VIEW")+")"}else{i+=" (Default view)"}}e.aViews.push({text:i,key:a+1,initialSelectedKey:a+1,isLaterAddedView:false,isViewResetEnabled:false})})}else if(N(e.template,"isViewSwitchSupportedCard")){e.newViewCounter=0;e.aViews=[{text:S.getText("OVP_KEYUSER_SHOWS_DIFFERENT_VIEWS"),key:0,initialSelectedKey:0,isLaterAddedView:false,isViewResetEnabled:false}]}return e}function ae(e){var t=e.getData();var a=r.getUshellContainer();var i=[];if(a){a.getServiceAsync("Navigation").then(function(a){a.getLinks().then(function(n){var n=n&&n[0];var r=[];for(var o=0;o<n.length;o++){r.push({target:{shellHash:n[o].intent}});i.push({name:n[o].text,value:n[o].intent})}a.isNavigationSupported(r).then(function(a){var n=[];for(var r=0;r<a.length;r++){if(a[r].supported===true&&i[r]){n.push({name:i[r].name,value:i[r].value})}}if(n.length>0){t["links"]=n}e.refresh()}).catch(function(e){w.error(e)})}).catch(function(e){w.error(e)})})}}function ie(e){this.oResetButton.setEnabled(e)}function ne(e){this.oSaveButton.setEnabled(e);var t=this.oMessagePopOver.getModel(),a=t.getProperty("/Counter/Error");this.bError=a>0}function re(e){var t=new RegExp("http(s)?://(www.)?[a-z0-9]+([-.]{1}[a-z0-9]+)*.[a-z]{2,5}(:[0-9]{1,5})?(/.*)?","i");return t.test(e)}function oe(e,t){if(t==="targetUri"){return!re(e)&&(!!e||e==="")}else{return!e.trim().length}}function se(e){var t=e.getParameter("path"),a="",i,n,r,o,s,l;if(t==="/title"||t==="title"||t==="/viewName"||t==="targetUri"||t==="value"){var d=e.getParameter("value"),p=oe(d,t),c,u=e.getParameter("context");if(t==="/viewName"){c=e.getSource().getProperty("/selectedKey");a=v.getText("OVP_KEYUSER_INPUT_ERROR_VIEW_NAME");t="/tabs/"+(c-1)+"/value"}if(t==="value"){a=v.getText("OVP_KEYUSER_INPUT_ERROR_VIEW_NAME");t=u.getPath()+"/"+t}if(t.indexOf("/title")!==-1){a=v.getText("OVP_KEYUSER_INPUT_ERROR")}if(u&&u.getPath().indexOf("staticContent")!==-1){i=u.getPath().split("/");if(t==="title"){a=v.getText("OVP_KEYUSER_INPUT_ERROR_RECORD_TITLE")+(parseInt(i[i.length-1],10)+1)}else if(t==="targetUri"){a=v.getText("OVP_KEYUSER_INPUT_ERROR_RECORD_URL")+" "+(parseInt(i[i.length-1],10)+1)}t=u.getPath()+"/"+t}r=this.oMessagePopOver.getModel();o=r.getProperty("/Messages");s=r.getProperty("/Counter/All");l=r.getProperty("/Counter/Error");if(p){ne.bind(this)(true);for(n=0;n<o.length;n++){if(o[n].fieldName===t){o.splice(n,1);s--;l--;n--}}o.push({type:"Error",title:a,fieldName:t,counter:l+1});s++;l++}else{ne.bind(this)(true);for(n=0;n<o.length;n++){if(o[n].fieldName===t){o.splice(n,1);s--;l--;n--}}}r.setProperty("/Messages",o);r.setProperty("/Counter/All",s);r.setProperty("/Counter/Error",l);r.refresh(true)}else if(t==="/staticContent,title"||t==="/staticContent,targetUri"||t==="/tabs,value"){i=t.split(",");r=this.oMessagePopOver.getModel();o=r.getProperty("/Messages");s=r.getProperty("/Counter/All");l=r.getProperty("/Counter/Error");ne.bind(this)(true);for(n=0;n<o.length;n++){if(o[n].fieldName.indexOf(i[0])!==-1&&o[n].fieldName.indexOf(i[1])!==-1){o.splice(n,1);s--;l--;n--}}r.setProperty("/Messages",o);r.setProperty("/Counter/All",s);r.setProperty("/Counter/Error",l);r.refresh(true)}}function le(){var e=this.oMessagePopOver.getModel();e.setProperty("/Messages",[]);e.setProperty("/Counter/All",0);e.setProperty("/Counter/Error",0);e.setProperty("/Counter/Success",0);e.setProperty("/Counter/Warning",0);e.setProperty("/Counter/Information",0);e.refresh(true)}function de(){var e=new p({text:"Show more information",href:"",target:"_blank"});var t=new d({type:"{type}",title:"{title}",description:"{description}",subtitle:"{subtitle}",counter:"{counter}",groupName:"{fieldName}",link:e});this.oMessagePopOver=new l({items:{path:"/Messages",template:t}});var a={Counter:{All:0,Error:0,Success:0,Warning:0,Information:0},Messages:[]};var i=new g(a);this.oMessagePopOver.setModel(i);this.oMessagePopOverButton.setModel(i)}function pe(e,t){var a=e.byId("sapOvpSettingsForm");if(a){var i=a.getDomRef();if(i){i.style.width=t}}}function ce(e){var t=this.dialogBox.getContent()[0],a=t.getModel(),i=t.getModel("deviceMediaProperties");switch(e.name){case"S":case"M":i.setProperty("/deviceMedia","Column");pe(t,"100%");break;case"L":case"XL":default:i.setProperty("/deviceMedia","Row");pe(t,"calc(100% - "+(a.getProperty("/dialogBoxWidth")+1)+"rem)");break}i.refresh(true)}function ue(){s.media.detachHandler(ce.bind(this),null,"SettingsViewRangeSet");s.media.removeRangeSet("SettingsViewRangeSet")}function fe(){s.media.initRangeSet("SettingsViewRangeSet",[520,760,960],"px",["S","M","L","XL"]);s.media.attachHandler(ce.bind(this),null,"SettingsViewRangeSet");ce.bind(this)(s.media.getCurrentRange("SettingsViewRangeSet"))}function ge(e){var t=e.entitySet,a=e.metaModel,i=a.getObject("/"+t),n=i.$Type,r=a.getObject("/"+n),o=Object.keys(r);var s=o.filter(function(e){return!e.startsWith("$")});return s}var ve={dialogBox:undefined,oSaveButton:undefined,oResetButton:undefined,oMessagePopOverButton:undefined,oMessagePopOver:undefined,oAppDescriptor:undefined,oOriginalAppDescriptor:undefined,oMainComponent:undefined,oAppComponent:undefined,oNewDataSources:{},sApplicationId:"",oi18nModel:undefined,iContentHeightForDialog:38,iContentHeightForDialogWithViewSwitch:33,aVariantNames:n.aVariantNames,aVisiblePropertiesForAnnotation:n.aVisiblePropertiesForAnnotation,getDataSources:T,removeDataSources:I,setDataSources:O,attachWindowResizeHandler:fe,detachWindowResizeHandler:ue,settingFormWidth:pe,addKPINavApplicationName:q,addManifestSettings:G,setVisibilityForFormElements:z,getVisibilityOfElement:U,checkForEmptyString:R,enableResetButton:ie,enableSaveButton:ne,checkClonedCard:K,resetErrorHandling:le,createErrorCard:E,setErrorMessage:D,getQualifier:A,getTrimmedDataURIName:L,addSupportingObjects:te,oVisibility:n.oVisibility,bError:false,bNewStaticLinkListCardFlag:false,bNewKPICardFlag:false,bAddNewCardFlag:false,aListType:n.aListType,aListFlavour:n.aListFlavour,aDataPointSelectionMode:n.aDataPointSelectionMode,aSortOrder:n.aSortOrder,aCardType:n.aCardType,aLinkListFlavour:n.aLinkListFlavour,verifyCardsMaxLimitExceeded:he,getDialogBox:function(a){return new Promise(function(i,o){if(!this.dialogBox){this.oSaveButton=new t("settingsSaveBtn",{text:v.getText("save"),type:"Emphasized"});var l=new t("settingsCancelBtn",{text:v.getText("cancelBtn")});this.oResetButton=new t("settingsResetBtn",{text:v.getText("resetCardBtn")});this.oMessagePopOverButton=new t("settingsMessagePopOverBtn",{text:"{/Counter/All}",type:"Emphasized",icon:"sap-icon://message-popup",visible:"{= ${/Counter/All} === 0 ? false : true}"}).addStyleClass("sapOvpSettingsMessagePopOverBtn");this.dialogBox=new e("settingsDialog",{title:v.getText("settingsDialogTitle"),buttons:[this.oMessagePopOverButton,this.oSaveButton,l,this.oResetButton],afterClose:function(e){var t=this.dialogBox.getContent()[0],a=t.byId("sapOvpSettingsLineItemTitle"),i=t.byId("sapOvpSettingsLineItemSubTitle");if(a){a.destroy()}if(i){i.destroy()}this.bNewStaticLinkListCardFlag=false;this.bNewKPICardFlag=false;this.bAddNewCardFlag=false;this.newDataSource=false;this.dialogBox.destroyContent();this.detachWindowResizeHandler()}.bind(this)});this.dialogBox.setBusyIndicatorDelay(0);l.attachPress(function(e){this.dialogBox.close()}.bind(this))}this.oResetButton.setVisible(!this.bNewKPICardFlag);de.bind(this)();var d=this.bNewStaticLinkListCardFlag||this.bNewKPICardFlag||this.bAddNewCardFlag;var p=a.getComponentInstance(),c=p.getRootControl().getModel("ovpCardProperties"),u;this.oi18nModel=p.getComponentData().i18n;if(this.bNewStaticLinkListCardFlag){u={title:"New Title",subTitle:"New Subtitle",staticContent:[],listFlavor:"standard",template:"sap.ovp.cards.linklist",layoutDetail:c.getProperty("/layoutDetail")}}else if(this.bNewKPICardFlag){var m=p.getComponentData().mainComponent.getView().getModel("JSONModelForSSB").getProperty("/d/results"),y=m[0];u={entitySet:y.ODataEntityset,kpiAnnotationPath:"com.sap.vocabularies.UI.v1.KPI#"+y.KPIQualifier,title:y.GroupTitle,subTitle:y.KPITitle,template:"sap.ovp.cards.charts.analytical",layoutDetail:c.getProperty("/layoutDetail"),selectedKPI:y,errorStatusText:undefined,KPIData:m}}else if(this.bAddNewCardFlag){u={addNewCard:true,newDataSource:false,title:"",subTitle:"",cardType:this.aCardType,aListType:this.aListType,aListFlavour:this.aListFlavour,valueSelectionInfo:"",navigation:this.aDataPointSelectionMode,aLinkListFlavour:this.aLinkListFlavour,authorization:""}}else{u=c.getData()}var C=h({},u);C=te.call(this,C);C=this.addManifestSettings(C);var S=new g(C),w=a.getDomRef().offsetHeight,O=new g(s.system),I=new g({deviceMedia:"Row"}),T=p.getComponentData(),L=T.mainComponent,E=T.appComponent,D=d?"":T.cardId;this.oAppComponent=E;this.oAppDescriptor=L._getCardFromManifest(D);this.sApplicationId=L._getApplicationId();this.oMainComponent=L;this.oOriginalAppDescriptor=E._getOvpCardOriginalConfig(D);O.setDefaultBindingMode("OneWay");C.dialogBoxHeight=w;C.dialogBoxWidth=20;var A=[];if(C.customParams||C.staticParameters){S.setProperty("/addCustomParameters",true);if(C.staticParameters&&Object.keys(C.staticParameters).length){for(var R in C.staticParameters){A.push({key:R,value:C.staticParameters[R]})}S.setProperty("/aAllStaticParameters",A)}}else{S.setProperty("/addCustomParameters",false)}var x=r._getLayer();var _=r.getQueryParameterValue("fiori-tools-rta-mode");if(_){S.setProperty("/layer",x);S.setProperty("/bFioriToolsRTAMode",_);if(C.objectStreamCardsSettings&&C.objectStreamCardsSettings.customActions){S.setProperty("/addCustomActions",true)}else{S.setProperty("/addCustomActions",false)}var k=p.getComponentData().appComponent.sId;var M=P.getElementById(k+"---mainView").getModel("i18n");var F=M.oData.bundle&&M.oData.bundle.oi18nModel;if(Array.isArray(F)&&F[0]&&F[0].aPropertyFiles[0]&&F[0].aPropertyFiles[0].mProperties){var B=F[0].aPropertyFiles[0].mProperties;var K=[];var H=[];var U=[];var W=[];if(!C.addNewCard){var z=n.oI18nKeyValueProperty;for(var R in z){if(R==="title"){H.push({key:"",value:C[R]})}if(R==="subTitle"){U.push({key:"",value:C[R]})}if(R==="valueSelectionInfo"){W.push({key:"",value:C[R]})}}for(var R in B){if(B.hasOwnProperty(R)){H.push({key:R,value:B[R]})}}for(var R in B){if(B.hasOwnProperty(R)){U.push({key:R,value:B[R]})}}for(var R in B){if(B.hasOwnProperty(R)){W.push({key:R,value:B[R]})}}S.setProperty("/ai18nPropertiesAndTitle",H);S.setProperty("/ai18nPropertiesAndSubTitle",U);S.setProperty("/ai18nPropertiesAndValSelInfo",W)}for(var R in B){if(B.hasOwnProperty(R)){K.push({key:R,value:B[R]})}}S.setProperty("/ai18nProperties",K)}}if(C.template==="sap.ovp.cards.linklist"||C.template==="sap.ovp.cards.v4.linklist"){S.setProperty("/listFlavorName",v.getText("OVP_KEYUSER_CAROUSEL"))}else{S.setProperty("/listFlavorName",v.getText("OVP_KEYUSER_BARLIST"))}if(C.layoutDetail==="resizable"){var j=["sap.ovp.cards.list","sap.ovp.cards.table","sap.ovp.cards.v4.list","sap.ovp.cards.v4.table"];if(!C.defaultSpan){C.defaultSpan={};S.setProperty("/defaultSpan/cols",S.getProperty("/cardLayout/colSpan"));S.setProperty("/defaultSpan/rows",j.indexOf(C.template)>-1?S.getProperty("/cardLayout/noOfItems"):S.getProperty("/cardLayout/rowSpan"))}else{if(!C.defaultSpan.rows){S.setProperty("/defaultSpan/rows",j.indexOf(C.template)>-1?S.getProperty("/cardLayout/noOfItems"):S.getProperty("/cardLayout/rowSpan"))}if(!C.defaultSpan.cols){S.setProperty("/defaultSpan/cols",S.getProperty("/cardLayout/colSpan"))}}C.NoOfColumns=[];var G=1,$=6;for(var Q=G;Q<=$;Q++){C.NoOfColumns.push({value:Q})}if(N(C.template,"chart")||C.template==="sap.ovp.cards.linklist"||C.template==="sap.ovp.cards.v4.linklist"){var X=a.getComponentInstance().getComponentData().mainComponent,q=X.getLayout(),J=q.getDashboardLayoutUtil(),Z=L._getCardId(a.getId()),ee=J.calculateCardProperties(Z),ie=J._getCardController(Z).getView().byId("bubbleText")?43:0,ne=ee.headerHeight+ee.dropDownHeight+ie+50,re=Math.ceil(ee.minCardHeight/J.getRowHeightPx())+1;C.NoOfRows=[];C.NoOfRows.push({name:"None",value:0});C.NoOfRows.push({name:"Small",value:re});C.NoOfRows.push({name:"Standard",value:Math.ceil((ne+480)/J.getRowHeightPx())+1});if(this.bNewStaticLinkListCardFlag||this.bNewKPICardFlag){S.setProperty("/defaultSpan/cols",1);S.setProperty("/defaultSpan/rows",re)}}}if(C.addNewCard){S.setProperty("/addViewSwitchCheckBox",false);S.setProperty("/addKPIHeaderCheckBox",false);var oe=[];var le=L.oCardsModels;if(le){for(var R in le){if(R.indexOf("kpi_card_model_")<0){oe.push(Object.assign({},{Title:R},le[R]))}}S.setProperty("/datasources",oe);S.setProperty("/datasourcesFromManifest",oe)}}var pe={};var ce=new g(pe);ae(ce);if((C.template==="sap.ovp.cards.linklist"||C.template==="sap.ovp.cards.v4.linklist")&&C.staticContent){Y(S);S.setProperty("/lineItemId","linkListItem--1");S.setProperty("/lineItemIdCounter",C.staticContent.length)}if(C.template==="sap.ovp.cards.charts.analytical"){var ue=L._getCardId(a.getId());S.setProperty("/NewKPICard",this.bNewKPICardFlag);S.setProperty("/selectedKPICardID",ue)}this.setVisibilityForFormElements(C);var fe=new g(this.oVisibility);if(!this.bAddNewCardFlag){S.attachPropertyChange(se.bind(this))}var ge={id:"settingsView",viewName:"sap.ovp.cards.rta.SettingsDialog",type:f.XML,preprocessors:{xml:{bindingContexts:{ovpCardProperties:S.createBindingContext("/")},models:{ovpCardProperties:S,deviceSystemProperties:O}}}};b.create(ge).then(function(e){e.setModel(ce,"staticCardProperties");var t=v.oResourceModel;e.setModel(S);e.setModel(t,"ovpResourceModel");e.setModel(I,"deviceMediaProperties");e.setModel(fe,"visibility");if(this.oi18nModel){e.setModel(this.oi18nModel,"@i18n")}this.dialogBox.addContent(e);this.attachWindowResizeHandler();if(!this.bAddNewCardFlag){var n=e.byId("dialogCard");if(!n.getVisible()){n=e.byId("dialogCardNoPreview");var r=e.getModel().getProperty("/template").split("."),o=r[r.length-1],s=v.getText("OVP_KEYUSER_NO_CARD_PREVIEW_MSG",[o]);n.setTitle(s)}else{n.setWidth(C.dialogBoxWidth+"rem")}}V(a,e,d);this.dialogBox.open();e.getController().settingsResolve=i}.bind(this))}.bind(this))}};ve.fnEditCardHandler=function(e,t){var a=e.getComponentInstance().getComponentData().mainComponent,i=a.getLayout(),n=a.getUIModel();return ve.getDialogBox(e).then(function(t){var o=[{appComponent:e.getComponentInstance().getComponentData().appComponent,changeSpecificData:{appDescriptorChangeType:"appdescr_ovp_changeCard",content:t.appDescriptorChange}},{selectorControl:r.getApp().getLayout(),changeSpecificData:{runtimeOnly:true,changeType:"editCardSettings",content:t.flexibilityChange}}];if(t.viewSwitchChange){o.push({selectorControl:r.getApp().getLayout(),changeSpecificData:{changeType:"viewSwitch",content:t.viewSwitchChange}})}if(n.getProperty("/containerLayout")==="resizable"){var s=i.getDashboardLayoutModel(),l=i.getDashboardLayoutUtil(),d=a._getCardId(e.getId()),p=s.getCardById(d),c=l.calculateCardProperties(d),u=s.getColCount(),f="C"+u,g=t.flexibilityChange.newAppDescriptor.settings.defaultSpan,v,h=[];if(g&&g.cols){o.forEach(function(e){if(e.changeSpecificData.changeType==="editCardSettings"){var t=e.changeSpecificData.content.oldAppDescriptor;t.settings.defaultSpan={rowSpan:p.dashboardLayout.rowSpan,colSpan:p.dashboardLayout.colSpan,showOnlyHeader:p.dashboardLayout.showOnlyHeader}}});if(g.rows===0){p.dashboardLayout.autoSpan=false;v=Math.ceil((c.headerHeight+2*l.CARD_BORDER_PX)/l.getRowHeightPx())}else{p.dashboardLayout.autoSpan=true;var m=["sap.ovp.cards.list","sap.ovp.cards.table","sap.ovp.cards.v4.list","sap.ovp.cards.v4.table"];if(m.indexOf(p.template>-1)){p.dashboardLayout.noOfItems=g.rows}else{v=g.rows}}s._arrangeCards(p,{row:v,column:g.cols},"resize",h);s._removeSpaceBeforeCard(h);h.forEach(function(e){var t={};t.dashboardLayout={};t.cardId=e.content.cardId;t.dashboardLayout[f]=e.content.dashboardLayout;o.push({selectorControl:r.getApp().getLayout(),changeSpecificData:{changeType:"dragOrResize",content:t}})})}}return o})};ve.fnCloneCardHandler=function(e,t){var i=e.getComponentInstance().getComponentData().mainComponent;if(he(i)){return Promise.resolve([])}return a.getPayLoadForCloneCard(e).then(function(t){return[{appComponent:e.getComponentInstance().getComponentData().appComponent,changeSpecificData:{appDescriptorChangeType:"appdescr_ovp_addNewCard",content:t.appDescriptorChange}},{selectorControl:r.getApp().getLayout(),changeSpecificData:{runtimeOnly:true,changeType:"newCardSettings",content:t.flexibilityChange}}]})};ve.fnAddStaticLinkListCardHandler=function(e,t){var a=e.getComponentInstance().getComponentData().mainComponent;if(he(a)){return Promise.resolve([])}ve.bNewStaticLinkListCardFlag=true;return ve.getDialogBox(e).then(function(t){return[{appComponent:e.getComponentInstance().getComponentData().appComponent,changeSpecificData:{appDescriptorChangeType:"appdescr_ovp_addNewCard",content:t.appDescriptorChange}},{selectorControl:r.getApp().getLayout(),changeSpecificData:{runtimeOnly:true,changeType:"newCardSettings",content:t.flexibilityChange}}]})};ve.fnAddKPICardHandler=function(e,t){var a=e.getComponentInstance().getComponentData().mainComponent;if(he(a)){return Promise.resolve([])}ve.bNewKPICardFlag=true;return ve.getDialogBox(e).then(function(t){var a=[{appComponent:e.getComponentInstance().getComponentData().appComponent,changeSpecificData:{appDescriptorChangeType:"appdescr_ovp_addNewCard",content:t.appDescriptorChange}},{selectorControl:r.getApp().getLayout(),changeSpecificData:{runtimeOnly:true,changeType:"newCardSettings",content:t.flexibilityChange}}];if(t.addODataAnnotation){a.push({appComponent:e.getComponentInstance().getComponentData().appComponent,changeSpecificData:{appDescriptorChangeType:"appdescr_app_addAnnotationsToOData",content:t.addODataAnnotation}})}return a})};ve.fnAddNewCardHandler=function(e,t){var a=e.getComponentInstance().getComponentData().mainComponent;if(he(a)){return Promise.resolve([])}ve.bAddNewCardFlag=true;return ve.getDialogBox(e).then(function(t){var a=[{appComponent:e.getComponentInstance().getComponentData().appComponent,changeSpecificData:{appDescriptorChangeType:"appdescr_ovp_addNewCard",content:t.appDescriptorChange}},{selectorControl:r.getApp().getLayout(),changeSpecificData:{runtimeOnly:true,changeType:"newCardSettings",content:t.flexibilityChange}}];if(t.addODataAnnotation){a.push({appComponent:e.getComponentInstance().getComponentData().appComponent,changeSpecificData:{appDescriptorChangeType:"appdescr_app_addAnnotationsToOData",content:t.addODataAnnotation}})}return a})};ve.fnRemoveCardHandler=function(e,t){return new Promise(function(t,i){c.confirm(v.getText("OVP_KEYUSER_MESSAGE_BOX_WARNING_MESSAGE_DELETE"),{actions:[c.Action.DELETE,c.Action.CANCEL],icon:c.Icon.WARNING,title:v.getText("OVP_KEYUSER_MESSAGE_BOX_TITLE_DELETE"),initialFocus:c.Action.CANCEL,onClose:function(n){if(n==="DELETE"){t(a.getPayLoadForRemoveCard(e))}else{i(null)}}})}).then(function(t){var a=[{appComponent:e.getComponentInstance().getComponentData().appComponent,changeSpecificData:{appDescriptorChangeType:"appdescr_ovp_removeCard",content:t.appDescriptorChange}},{selectorControl:r.getApp().getLayout(),changeSpecificData:{runtimeOnly:true,changeType:"removeCardContainer",content:t.flexibilityChange}}];if(t.removeDataSourceChange){t.removeDataSourceChange.forEach(function(t){a.push({appComponent:e.getComponentInstance().getComponentData().appComponent,changeSpecificData:{appDescriptorChangeType:"appdescr_app_removeDataSource",content:t}})})}return a},function(e){return[]})};function he(e){var t=e&&e.getAllowedNumberOfCards();var a=t&&t.numberOfCards;var i=t&&t.errorMessage;var n=e&&e.getUIModel().getProperty("/aOrderedCards");var r=n&&n.filter(function(e){return e.visibility===true});if(r&&r.length>=a){c.warning(i,{actions:c.Action.OK,emphasizedAction:c.Action.OK});return true}return false}return ve},true);
//# sourceMappingURL=SettingsUtils.js.map