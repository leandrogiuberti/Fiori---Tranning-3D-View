/*!
 * Copyright (c) 2009-2014 SAP SE, All Rights Reserved
 */
sap.ui.define(["sap/base/util/isEmptyObject","sap/ui/model/Filter","sap/ui/model/FilterOperator"],function(e,t,r){"use strict";var n={};function i(e){var t;if(e){if(e.settings.tabs){var r=0;var n=e.settings.selectedKey;if(n&&e.settings.tabs.length>=n){r=n-1}t=e.settings.tabs[r]["selectionAnnotationPath"]}else{t=e.settings["selectionAnnotationPath"]}}return t}function a(e){var t={EQ:"NE",GE:"LT",LT:"GE",LE:"GT",GT:"LE",BT:"NB",Contains:"NotContains",StartsWith:"NotStartsWith",EndsWith:"NotEndsWith"}[e];return t?t:e}function s(e){var t=["NE","NB","NotContains","NotStartsWith","NotEndsWith"];return t.indexOf(e)>-1}function o(e,t){var r;if(e){if(e.String){r=Number(e.String)}else if(e.Int){r=Number(e.Int)}else if(e.Decimal){r=Number(e.Decimal)}else if(t&&e.$Decimal){r=Number(e.$Decimal)}else if(e.Double){r=Number(e.Double)}else if(e.Single){r=Number(e.Single)}else if(t&&typeof e==="number"){return e}}return r}function l(e,r,n){if(e&&e.length){var i={};e.forEach(function(e){if(i[e.path]){i[e.path].push(new t(e))}else{i[e.path]=[new t(e)]}});Object.keys(i).forEach(function(e){r.push(new t({filters:i[e],and:n}))})}}return{_getEntityRelevantFilters:function(e,t){var r=[];if(t.length>0&&e){var n=this._checkRelevantFiltersRecursive(e,t[0]);if(n){r.push(n)}}return r},_checkRelevantFiltersRecursive:function(e,r){if(!r._bMultiFilter){r.sPath=r.sPath.split("/").pop();var n=this._getPropertyMapping(e,r.sPath);if(n){r.sPath=n;return r}}else{var i=r.aFilters;var a,s=[];if(i){for(var o=0;o<i.length;o++){a=this._checkRelevantFiltersRecursive(e,i[o]);if(a){s.push(a)}}if(s.length>0){return new t(s,r.bAnd)}}}},_getPropertyMapping:function(e,t){if(t in e){return t}},mergeFilters:function(r,i,a){var s=a.getProperty("/cardId");var o=n[s]||[];if(i&&i.length===0&&r&&r.length===0){return[]}var u=[];if(o.length&&i&&i.length){i=i.filter(function(e){return!o.includes(e)})}if(i&&i.length>0||o.length){var f=[];l(i,f,false);l(o,f,true);u.push(new t({filters:f,and:true}))}if(!e(r[0])){u.push(r[0])}return new t({filters:u,and:true})},getSelectionVariantFilters:function(e,t,r){var n=t.getData(),a=e.filter(function(e){return e.id===n.cardId})[0],s=i(a);if(s){s="@"+s;var o=r[s];return o?this.getFilters(t,o,true):[]}return[]},formatLiteral:function(e,t){var r=/'/g;if(e===undefined){throw new Error("Illegal value: undefined")}if(e===null){return"null"}switch(t){case"Edm.Binary":return"binary'"+e+"'";case"Edm.Boolean":case"Edm.Byte":case"Edm.Double":case"Edm.Int16":case"Edm.Int32":case"Edm.SByte":case"Edm.Single":return String(e);case"Edm.Date":case"Edm.DateTimeOffset":case"Edm.Decimal":case"Edm.Guid":case"Edm.Int64":case"Edm.TimeOfDay":return e;case"Edm.Duration":return"duration'"+e+"'";case"Edm.String":return"'"+e.replace(r,"''")+"'";default:throw new Error("Unsupported type: "+t)}},getBooleanValue:function(e,t){if(e&&e.Boolean){if(e.Boolean.toLowerCase()==="true"){return true}else if(e.Boolean.toLowerCase()==="false"){return false}}else if(e&&e.Bool){if(e.Bool.toLowerCase()==="true"){return true}else if(e.Bool.toLowerCase()==="false"){return false}}return t},getPrimitiveValue:function(e,t){var r;if(e){if(e.String||e.String===""){r=e.String}else if(t&&typeof e=="string"){r=e}else if(e.Boolean||e.Bool){r=this.getBooleanValue(e)}else if(e.DateTime){r=e.DateTime}else if(e.DateTimeOffset){r=e.DateTimeOffset}else{r=o(e,t)}}return r},getFilters:function(e,t,i){var o=[];var l=e.getProperty("/filters");if(l){o=o.concat(l)}var u=t&&t.SelectOptions;var f,c,g;var h=[];if(u){for(var p=0;p<u.length;p++){f=u[p];c=i?f.PropertyName.$PropertyPath:f.PropertyName.PropertyPath;for(var v=0;v<f.Ranges.length;v++){g=f.Ranges[v];var d=i?g.Sign.$EnumMember:g.Sign.EnumMember;var m=i?g.Option.$EnumMember:g.Option.EnumMember;if(d){var E={path:c,operator:m.split("/")[1],value1:this.getPrimitiveValue(g.Low,i),value2:this.getPrimitiveValue(g.High,i),sign:d==="com.sap.vocabularies.UI.v1.SelectionRangeSignType/I"?"I":"E"};if(E.sign==="E"){E.operator=a(E.operator);E.sign="I";h.push(E)}else if(E.sign==="I"&&s(E.operator)){h.push(E)}if(E.operator==="CP"&&E.sign==="I"){var b=r.Contains;var N=E.value1;if(N){var y=N.indexOf("*");var S=N.lastIndexOf("*");if(y>-1){if(y===0&&S!==N.length-1){b=r.EndsWith;N=N.substring(1,N.length)}else if(y!==0&&S===N.length-1){b=r.StartsWith;N=N.substring(0,N.length-1)}else{N=N.substring(1,N.length-1)}}}E.operator=b;E.value1=N}o.push(E)}}}if(h.length){var P=e.getProperty("/cardId");n[P]=h}}return o},transformExcludeOperationForNavigation:function(e){var t={NE:"EQ",NB:"BT",NotContains:"Contains",NotStartsWith:"StartsWith",NotEndsWith:"EndsWith"};if(e&&e.operator&&t[e.operator]){e.operator=t[e.operator];e.sign="E"}},createExcludeFilters:function(e,t){var r=[];var i=t.getProperty("/cardId");var a=n[i]||[];if(a.length>0){e.forEach(function(e){if(!a.includes(e)){r.push(e)}});r.push({filters:a,and:true});return r}return e}}},true);
//# sourceMappingURL=Filterhelper.js.map