/*!
 * Copyright (c) 2009-2014 SAP SE, All Rights Reserved
 */
sap.ui.define(["sap/base/util/each","sap/base/util/merge","sap/ovp/insights/helpers/AnalyticalCard","sap/ui/model/json/JSONModel","sap/ui/core/Control","sap/ovp/cards/AnnotationHelper"],function(e,t,a,r,s,n){"use strict";var i=[];var o="";var l="";var c="";var u=[];var d=[];var p=function(e,t,a){var r={dataContext:{},properties:{color:i&&i[e]},displayName:a.results[t][o]};r.dataContext[l]=a.results[t][c];return r};return{cacheValues:function(e,t,a,r){u=[];i=[];if(e instanceof Array){i=e.map(function(e){return e.color});u=e}else{var s=Object.keys(e)||[];for(var n=0;n<s.length;n++){i.push(e[s[n]]);u.push({dimensionValue:s[n],color:e[s[n]]})}}d=i.slice();o=a;l=r;c=t},addColorRulesToVizProperties:function(t,a){if(u instanceof Array){e(u,function(e,r){for(var s=0;s<t.results.length;s++){if(t.results[s][c]===r.dimensionValue){var n=p(e,s,t);a.plotArea.dataPointStyle["rules"].push(n);d.splice(e,1)}}})}},handleOthersSectionForCharts:function(e,t){if(e&&e.results&&Array.isArray(e.results)){var a="";if(d&&d.length){a=d[d.length-1]}t.plotArea.dataPointStyle["rules"].push({callback:function(e){return e&&e[l]&&e[l].lastIndexOf("Others")!=-1},properties:{color:a},displayName:e.results[0][c]})}},setVizPropertiesForInsightCards:function(e,r,s){if(e&&e.getProperty("/bInsightEnabled")){var n=r.getId(),i=t({},s);a.setVizPropertyMap(n,i)}},formatDateBasedOnSemantics:function(t,a,r){if(t&&t.length){if(r&&r.length){e(r,function(r,s){e(t,function(e,t){if(s.hasOwnProperty(t)){var r=s[t];var i,o,l,c,u,d,p;switch(a[t]["semantics"]){case"yearmonth":i=parseInt(r.substr(0,4),10);o=r.substr(4);u=parseInt(o,10)-1;s[t]=new Date(Date.UTC(i,u));break;case"yearquarter":i=parseInt(r.substr(0,4),10);l=r.substr(4);c=parseInt(l,10)*3-2;u=c-1;s[t]=new Date(Date.UTC(i,u));break;case"yearweek":i=parseInt(r.substr(0,4),10);d=r.substr(4);var p=1+(parseInt(d,10)-1)*7;s[t]=new Date(Date.UTC(i,0,p));break;case"fiscalyearperiod":var g="com.sap.vocabularies.Common.v1.IsFiscalYearPeriod";var f=n.getFormattedFiscalData(r,g);s[t]=f;break;default:break}}})})}}},attachDataReceivedToAggregationBinding:function(){var e=this.getBinding("aggregateData");var a=this.getBinding("data");if(this.chartAggrBinding!==e){this.chartAggrBinding=e;if(e){var n=this;e.attachEvent("dataReceived",function(e){n.aggregateSet=e&&e.getParameter("data");if(n.getChartType()=="donut"){if(n.getDependentDataReceived()===true||n.getDependentDataReceived()==="true"){n.oDataClone=t({},n.dataSet);n.mergeDatasets(a,n.oDataClone,n.getContent());n.setDependentDataReceived(false)}else{n.setDependentDataReceived(true)}}else{var s=new r;s.setData(n.aggregateSet.results);n.getContent().setModel(s,"analyticalmodel")}})}s.prototype.updateBindingContext.apply(this,arguments)}}}});
//# sourceMappingURL=OVPVizDatahelper.js.map