/*!
 * Copyright (c) 2009-2014 SAP SE, All Rights Reserved
 */
sap.ui.define(["sap/ovp/cards/AnnotationHelper","sap/ovp/app/OVPLogger","sap/ovp/cards/Constants","sap/ovp/app/resources","sap/ovp/cards/generic/base/analytical/Utils"],function(e,i,a,t,r){"use strict";var n=new i("OVP.charts.VizAnnotationManagerHelper");var l=a.errorMessages;var o=a.Annotations;function u(i,t,r){var n=r.getModel("ovpCardProperties");var l=i[i.measureNames];if(t&&t.CriticalityCalculation&&t.CriticalityCalculation.ImprovementDirection){var o=t.CriticalityCalculation.ImprovementDirection.EnumMember||"";var u=c(n,"/deviationRangeLowValue",t.CriticalityCalculation.DeviationRangeLowValue);var g=c(n,"/deviationRangeHighValue",t.CriticalityCalculation.DeviationRangeHighValue);var s=c(n,"/toleranceRangeLowValue",t.CriticalityCalculation.ToleranceRangeLowValue);var C=c(n,"/toleranceRangeHighValue",t.CriticalityCalculation.ToleranceRangeHighValue);return e._calculateCriticalityState(l,o,u,g,s,C,a.Criticality.StateValues)}else if(t&&t.Criticality&&t.Criticality.EnumMember){var v=t.Criticality.EnumMember.split("/");return v[1]}}function c(e,i,a,t){var n=e.getProperty("/tabs");var l=parseInt(e.getProperty("/selectedKey"),10);if(n&&n.length&&l){var o=n[l-1];var u=o[i.substring(1)];return u||r.getPathFormedOrPrimitiveValue(a,t)}else{return e&&e.getProperty&&e.getProperty(i)||r.getPathFormedOrPrimitiveValue(a,t)}}function g(e,i){if(e&&e.CriticalityCalculation&&e.CriticalityCalculation.ImprovementDirection&&e.CriticalityCalculation.ImprovementDirection.EnumMember){var a=e.CriticalityCalculation.ImprovementDirection.EnumMember||"";var t=r.getPathOrPrimitiveValue(e.CriticalityCalculation.DeviationRangeLowValue);var o=r.getPathOrPrimitiveValue(e.CriticalityCalculation.DeviationRangeHighValue);var u=r.getPathOrPrimitiveValue(e.CriticalityCalculation.ToleranceRangeLowValue);var c=r.getPathOrPrimitiveValue(e.CriticalityCalculation.ToleranceRangeHighValue);if(a.endsWith("Minimize")||a.endsWith("Minimizing")){if(c&&o){i.boolFlag=true;return false}else{n.warning(l.CARD_WARNING+l.INVALID_CRITICALITY)}}else if(a.endsWith("Maximize")||a.endsWith("Maximizing")){if(u&&t){i.boolFlag=true;return false}else{n.warning(l.CARD_WARNING+l.INVALID_CRITICALITY)}}else if(a.endsWith("Target")){if(u&&t&&c&&o){i.boolFlag=true;return false}else{n.warning(l.CARD_WARNING+l.INVALID_CRITICALITY)}}}else if(e&&e.Criticality){i.boolFlag=true;return false}else{n.warning(l.CARD_WARNING+l.INVALID_IMPROVEMENT_DIR)}}function s(e,i,a){var t;var r;var l;if(e&&e.indexOf("{")===0){e=e.slice(1,-1);if(e.indexOf(">")!=-1){l=e.split(">");t=l[0];r=l[1]}else if(e.indexOf("&gt;")!=-1){l=e.split("&gt;");t=l[0];r=l[1]}try{var u=i.getModel(t);e=u&&u.getProperty(r)||r}catch(i){e=a[e][o.LABEL_KEY_V4].String;n.error("Unable to read labels from resource file",i)}}return e}function C(e,i,a){var t=e.Measure.PropertyPath;if(i[t]){if(i[t][o.LABEL_KEY_V4]){t=s(i[t][o.LABEL_KEY_V4].String?i[t][o.LABEL_KEY_V4].String:i[t][o.LABEL_KEY_V4].Path,a,i)}else if(i[t][o.LABEL_KEY]){t=i[t][o.LABEL_KEY]}else if(t){t=t}}return t}function v(e,i,a,r){var n=r.getModel("ovpCardProperties");var l=[null,null];if(!e.CriticalityCalculation||!e.CriticalityCalculation.ImprovementDirection||!e.CriticalityCalculation.ImprovementDirection.EnumMember){return l}var o=e.CriticalityCalculation.ImprovementDirection.EnumMember||"";var u=c(n,"/deviationRangeLowValue",e.CriticalityCalculation.DeviationRangeLowValue,i);var g=c(n,"/deviationRangeHighValue",e.CriticalityCalculation.DeviationRangeHighValue,i);var s=c(n,"/toleranceRangeLowValue",e.CriticalityCalculation.ToleranceRangeLowValue,i);var C=c(n,"/toleranceRangeHighValue",e.CriticalityCalculation.ToleranceRangeHighValue,i);if(o.endsWith("Minimize")||o.endsWith("Minimizing")&&(C&&g)){l[0]=t.getText("MINIMIZING_LESS",[a,C]);l[1]=t.getText("MINIMIZING_MORE",[a,g]);l[2]=t.getText("MINIMIZING_CRITICAL",[C,a,g])}else if(o.endsWith("Maximize")||o.endsWith("Maximizing")&&(s&&u)){l[0]=t.getText("MAXIMISING_MORE",[a,s]);l[1]=t.getText("MAXIMISING_LESS",[a,u]);l[2]=t.getText("MAXIMIZING_CRITICAL",[u,a,s])}else if(o.endsWith("Target")&&(s&&u&&C&&g)){l[0]=t.getText("TARGET_BETWEEN",[s,a,C]);l[1]=t.getText("TARGET_AROUND",[a,u,g]);l[2]=t.getText("TARGET_CRITICAL",[u,a,s,C,g])}return l}function I(e,i){if(!i){return}if(i.getProperty("/showTimeAxis")){var a=e&&e.vizProperties;if(Array.isArray(a)){var t=a.find(function(e){return e.path==="timeAxis.levels"});if(t){t.value=["year","month","day","hour","minute"]}}}}return{formThePathForCriticalityStateCalculation:u,updateFlagValueForDataPoint:g,getMeasureName:C,getSemanticLegends:v,getLabelFromAnnotationPath:s,enableTimeAxisForChart:I}});
//# sourceMappingURL=VizAnnotationManagerHelper.js.map