<core:FragmentDefinition
    xmlns="sap.m"
    xmlns:core="sap.ui.core"
    xmlns:build="sap.build"
    xmlns:ovp="sap.ovp.ui"
    xmlns:template="http://schemas.sap.com/sapui5/extension/sap.ui.core.template/1"
    template:require="{
		CardAnnotationhelper: 'sap/ovp/cards/AnnotationHelper',
        ModelAnnotationhelper: 'sap/ui/model/odata/AnnotationHelper'
	}"    
>
    <template:if test="{= ${ovpCardProperties>/state} !== 'Loading'}">
        <HBox justifyContent="SpaceBetween" renderType="Bare">
            <template:if test="{ovpCardProperties>/dynamicSubtitleAnnotationPath}">
                <template:then>
                    <template:with 
                        path='ovpCardProperties>/dynamicSubtitleAnnotationPath'
                        helper="CardAnnotationhelper.resolveEntityTypePath"
                        var='headerInfo'>
                        <template:with 
                            path="ovpCardProperties>/selectionAnnotationPath"
                            helper="CardAnnotationhelper.resolveEntityTypePath" 
                            var='selVar'>
                            <template:if test="{headerInfo>Description}">
                                <HBox>
                                    <FlexBox
                                        core:require="{CardAnnotationhelper: 'sap/ovp/cards/AnnotationHelper'}"
                                        items="{parts:[{path:'entitySet>'}, {path:'headerInfo>'}, {path:'selVar>'}], formatter: 'CardAnnotationhelper.getAggregateNumber'}"
                                        class="sapOvpCardSubtitleContainer ovpHeaderContainer sapOvpCardDynamicSubTitle">
                                        <Text
                                            id="ovpDescriptionValue" 
                                            maxLines="2"
                                            text="{path: 'headerInfo>Description/Value', formatter: 'ModelAnnotationhelper.format'}"
                                            class="sapOvpCardSubtitle sapUiTinyMarginTop tabindex-1">
                                            <customData>
                                                <ovp:CustomData 
                                                    key="aria-label"
                                                    value="{path: 'headerInfo>Description/Value', formatter: 'ModelAnnotationhelper.format'}"
                                                    writeToDom="true"/>
                                                <ovp:CustomData key="role" value="heading" writeToDom="true"/>
                                                <ovp:CustomData key="aria-level" value="2" writeToDom="true"/>
                                            </customData>
                                        </Text>
                                    </FlexBox>
                                </HBox>
                            </template:if>
                        </template:with>
                    </template:with>
                </template:then>
                <template:else>
                    <template:if test="{ovpCardProperties>/subTitle}">
                        <template:then>
                            <FlexBox class="sapOvpCardSubtitleContainer ovpHeaderContainer">
                                <Text
                                    id = "SubTitle-Text" 
                                    maxLines="2"
                                    text="{ovpCardProperties>/subTitle}"
                                    class="sapOvpCardSubtitle sapUiTinyMarginTop tabindex-1">
                                    <customData>
                                        <ovp:CustomData 
                                            key="aria-label" 
                                            value="{ovpCardProperties>/subTitle}"
                                            writeToDom="true"/>
                                        <ovp:CustomData key="role" value="heading" writeToDom="true"/>
                                        <ovp:CustomData key="aria-level" value="2" writeToDom="true"/>
                                    </customData>
                                </Text>
                            </FlexBox>
                        </template:then>
                        <template:else>
                            <template:if test="{ovpCardProperties>/dataPointAnnotationPath}">
                                <template:then>
                                    <template:with 
                                        path='ovpCardProperties>/dataPointAnnotationPath'
                                        helper="CardAnnotationhelper.resolveEntityTypePath"
                                        var='dataPoint'>
                                        <template:with 
                                            path="ovpCardProperties>/selectionAnnotationPath"
                                            helper="CardAnnotationhelper.resolveEntityTypePath" 
                                            var='selVar'>
                                            <template:if test="{dataPoint>Description}">
                                                <HBox width="100%">
                                                    <FlexBox
                                                        core:require="{CardAnnotationhelper: 'sap/ovp/cards/AnnotationHelper'}"
                                                        items="{parts:[{path:'entitySet>'}, {path:'dataPoint>'}, {path:'selVar>'} ], formatter: 'CardAnnotationhelper.getAggregateNumber'}"
                                                        class="sapOvpCardSubtitleContainer ovpHeaderContainer">
                                                        <Text
                                                            id = "ovpDescriptionValue" 
                                                            maxLines="2"
                                                            text="{path: 'dataPoint>Description', formatter: 'ModelAnnotationhelper.format'}"
                                                            class="sapOvpCardSubtitle sapUiTinyMarginTop tabindex-1">
                                                            <customData>
                                                                <ovp:CustomData 
                                                                    key="aria-label"
                                                                    value="{path: 'dataPoint>Description', formatter: 'ModelAnnotationhelper.format'}"
                                                                    writeToDom="true"/>
                                                                <ovp:CustomData key="role" value="heading" writeToDom="true"/>
                                                                <ovp:CustomData key="aria-level" value="2" writeToDom="true"/>
                                                            </customData>
                                                        </Text>
                                                    </FlexBox>
                                                </HBox>
                                            </template:if>
                                        </template:with>
                                    </template:with>
                                </template:then>
                                <template:else>
                                    <FlexBox class="sapOvpCardSubtitleContainer ovpHeaderContainer"></FlexBox>
                                </template:else>
                            </template:if>
                        </template:else>
                    </template:if>
                </template:else>
            </template:if>
            <template:if test="{= ${ovpCardProperties>/contentFragment} === 'sap.ovp.cards.list.List' || ${ovpCardProperties>/contentFragment} === 'sap.ovp.cards.table.Table'}">
                <template:if test="{ovpCardProperties>/countHeaderFragment}">
                    <core:Fragment fragmentName="{ovpCardProperties>/countHeaderFragment}" type="XML"/>
                </template:if>
            </template:if>
        </HBox>
    </template:if>
</core:FragmentDefinition>
