/*!
 * Copyright (c) 2009-2014 SAP SE, All Rights Reserved
 */
sap.ui.define(["sap/ui/thirdparty/jquery","sap/ovp/cards/CommonUtils","sap/ovp/ui/UIActions","sap/ui/Device","sap/ui/core/Control","sap/ui/core/ResizeHandler","sap/ovp/app/resources","sap/ui/events/F6Navigation","sap/ui/events/KeyCodes","sap/ovp/cards/jUtils","sap/ui/core/Component","sap/ui/core/Element","sap/base/i18n/Localization","sap/ui/dom/jquery/Selectors"],function(jQuery,e,t,a,i,n,s,r,o,l,d,u,p){"use strict";var h=function(e){this.init(e)};h.prototype.init=function(e){e.beforeDragCallback=this._beforeDragHandler.bind(this);e.dragStartCallback=this._dragStartHandler.bind(this);e.dragMoveCallback=this._dragMoveHandler.bind(this);e.dragEndCallback=this._dragEndHandler.bind(this);e.endCallback=this._endHandler.bind(this);this.layout=e.layout;this.afterReplaceElements=e.afterReplaceElements||function(){};this.settings=e;delete e.afterReplaceElements;this.destroy();this.uiActions=new t(this.settings).enable();this.aCardsOrder=null;this.verticalMargin=null;this.horizontalMargin=null;this.columnCount=null;this.top=null;this.left=null;this.width=null;this.layoutOffset=null;this.jqLayout=null;this.jqLayoutInner=null;this.isRTLEnabled=null;this.lastCollidedEl=null;this.lastCollisionTop=null;this.SCROLL_OFFSET=16};h.prototype.findCollision=function(e,t,a){var i;for(var n=0;n<a.length;n++){var s=a[n];var r=!(s.posDnD.right<e||s.posDnD.left>e);var o=!(s.posDnD.bottom<t||s.posDnD.top>t);if(r&&o){i=s;break}}return i};h.prototype.isCollisionTop=function(e,t,a){var i=(a.posDnD.bottom-a.posDnD.top)/2+a.posDnD.top;var n=!(i<t||a.posDnD.top>t);return n};h.prototype._dragMoveHandler=function(e,t){var a=e.element;var i=e.moveX-this.layoutOffset.left;var n=e.moveY-this.jqLayout.get(0).getBoundingClientRect().top+this.jqLayout.scrollTop();if(!t){var s=document.getElementsByClassName("sapFDynamicPageContentWrapper")[0];var r=s.offsetHeight;var o=s.getBoundingClientRect();if(e.evt.clientY-s.offsetTop+this.SCROLL_OFFSET>r){s.scrollTop=s.scrollTop+this.SCROLL_OFFSET}else if(e.evt.clientY-s.offsetTop<o.top+this.SCROLL_OFFSET&&s.scrollTop!==0){s.scrollTop=s.scrollTop-this.SCROLL_OFFSET}}var l=this.findCollision(i,n,this.aCardsOrder);if(!l){return}var d=this.isCollisionTop(i,n,l);if(l===a){this.lastCollidedEl=l;return}if(l===this.lastCollidedEl){if(this.lastCollisionTop===d){return}if(this.lastCollisionTop){this.lastCollisionTop=d;if(a.posDnD.top>l.posDnD.top){return}}else{this.lastCollisionTop=d;if(a.posDnD.top<l.posDnD.top){return}}}if(this.lastCollidedEl&&this.lastCollidedEl!==l&&this.lastCollidedEl!==a&&this.lastCollidedEl.posDnD.left===l.posDnD.left&&this.lastCollidedEl.posDnD.left===a.posDnD.left){l=this.lastCollidedEl}this.dragAndDropElement(a,l);this.lastCollidedEl=this.findCollision(i,n,this.aCardsOrder);if(this.lastCollidedEl){this.lastCollisionTop=this.isCollisionTop(i,n,this.lastCollidedEl)}};h.prototype.dragAndDropElement=function(e,t){if(e&&t){this.aCardsOrder=this.dragAndDropSwapElement(e,t,this.aCardsOrder);this.drawLayout(this.aCardsOrder)}};h.prototype.dragAndDropSwapElement=function(e,t,a){var i=a.slice();var n=a.indexOf(e);var s=a.indexOf(t);i[s]=e;i[n]=t;if(!!this.positionChanges&&t&&t.children){var r=t.children[0].getAttribute("id");this.positionChanges.push({changeType:"position",content:{cardId:r.substring(r.indexOf("mainView--")+10,r.length),position:n},isUserDependent:true});if(e&&e.children){var o=e.children[0].getAttribute("id");this.positionChanges.push({changeType:"position",content:{cardId:o.substring(o.indexOf("mainView--")+10,o.length),position:s},isUserDependent:true})}}return i};h.prototype.dragAndDropSwapElementForKeyboardNavigation=function(e,t){if(e&&t){var a=this.layout.getVisibleLayoutItems().map(function(e){return e.$().parent()[0]});var i=0;for(var n=0;n<a.length;n++){if(a[n]===e){a[n]=t;i++;continue}if(a[n]===t){a[n]=e;i++;continue}}if(i===2){this.afterReplaceElements(a)}}};h.prototype.initCardsSettingsForDragAndDrop=function(){this.jqLayout=this.layout.$();this.jqLayoutInner=this.jqLayout&&this.jqLayout.children().first();var e=this.jqLayout.scrollTop();var t=this.jqLayoutInner.height();this.isRTLEnabled=p.getRTL()?1:-1;this.aCardsOrder=[];this.layoutOffset=this.jqLayout.offset();if(a.system.tablet===true&&a.system.desktop===false){this.jqLayout.css("height",this.jqLayoutInner.height())}var i=this.layout.getVisibleLayoutItems();if(!i){return}this.aCardsOrder=i.map(function(e){var t=e.$().parent()[0];t.posDnD={width:t.offsetWidth,height:t.offsetHeight};t.style.width=t.offsetWidth+"px";return t});var n=this.jqLayoutInner&&this.jqLayoutInner.children().first();var s=this.isRTLEnabled===1?"margin-left":"margin-right";this.verticalMargin=parseInt(n.css(s),10);var r=this.aCardsOrder[0];this.horizontalMargin=parseInt(getComputedStyle(r)["margin-bottom"],10);this.columnCount=this.layout.getColumnCount();this.top=r.getBoundingClientRect().top-this.jqLayoutInner[0].getBoundingClientRect().top;this.left=r.getBoundingClientRect().left-this.jqLayoutInner[0].getBoundingClientRect().left;this.width=r.offsetWidth;l.addStyleToAllElements(this.aCardsOrder,"position","absolute");this.drawLayout(this.aCardsOrder);this.jqLayoutInner.height(t);this.jqLayout.scrollTop(e)};h.prototype.drawLayout=function(e){var t=[];for(var a=0;a<this.columnCount;a++){t[a]=0}for(var i=0;i<e.length;i++){var n=i%this.columnCount;var s=t[n]++;var r=this.left-this.isRTLEnabled*(n*this.verticalMargin+n*this.width);var o=this.top;var l=e[i];for(var d=0;d<s;d++){o+=this.horizontalMargin;var u=i-(d+1)*this.columnCount;o+=e[u].posDnD.height}l.posDnD.top=o;l.posDnD.bottom=o+l.posDnD.height;l.posDnD.left=r;l.posDnD.right=r+l.posDnD.width;this.updateElementCSS(e[i])}};h.prototype.updateElementCSS=function(e){jQuery(e).css({top:e.posDnD.top,left:e.posDnD.left})};h.prototype._dragStartHandler=function(e,t){this.positionChanges=[];if(a.system.desktop){l.addClassToAllElements(document.querySelectorAll("body"),"sapOVPDisableUserSelect");l.addClassToAllElements(document.querySelectorAll("body"),"sapOVPDisableImageDrag")}if(window.getSelection){var i=window.getSelection();i.removeAllRanges()}this.initCardsSettingsForDragAndDrop()};h.prototype._beforeDragHandler=function(e,t){if(a.browser.mobile){this.selectableElemets=jQuery(t).find(".sapUiSelectable");this.selectableElemets.removeClass("sapUiSelectable")}jQuery(this.settings.wrapper).addClass("dragAndDropMode")};h.prototype._dragEndHandler=function(e,t){this.lastCollidedEl=null;if(e.type=="mouseup"||e.type=="touchend"){if(this.aCardsOrder){this.afterReplaceElements(this.aCardsOrder)}}if(a.system.desktop){l.addClassToAllElements(document.querySelectorAll("body"),"sapOVPDisableUserSelect");l.addClassToAllElements(document.querySelectorAll("body"),"sapOVPDisableImageDrag")}jQuery(this.settings.wrapper).removeClass("dragAndDropMode");if(this.jqLayoutInner){this.jqLayoutInner.removeAttr("style")}if(this.aCardsOrder){jQuery(this.aCardsOrder).removeAttr("style")}this.uiActions.removeClone()};h.prototype._endHandler=function(e,t){if(a.browser.mobile&&this.selectableElemets){this.selectableElemets.addClass("sapUiSelectable")}};h.prototype.getSwapItemsFunction=function(){return this.dragAndDropSwapElementForKeyboardNavigation.bind(this)};h.prototype.destroy=function(){if(this.uiActions){this.uiActions.disable();this.uiActions=null}};var c={buildReplaceItemsInstance:function(e){var t={containerSelector:".sapUshellEasyScanLayoutInner",wrapper:".sapUshellEasyScanLayout",draggableSelector:".easyScanLayoutItemWrapper",placeHolderClass:"easyScanLayoutItemWrapper-placeHolder",cloneClass:"easyScanLayoutItemWrapperClone",moveTolerance:10,switchModeDelay:800,isTouch:!a.system.desktop,debug:false};e=Object.assign({},t,e);return new h(e)}};var f=function(e,t){this.init(e,t)};f.prototype.init=function(e,t){this.easyScanLayout=e;this.swapItemsFunction=typeof t==="function"?t:function(){};this.keyCodes=o;this.jqElement=e.$();var a=this;this.jqElement.on("keydown",function(e){a.keydownHandler.call(a,e)});this.jqElement.on("keyup",function(e){a.keyupHandler.call(a,e)});this.jqElement.find(".after").on("focus.keyboardNavigation",function(){a.afterFocusHandler.call(a)});this.jqElement.find(".sapUshellEasyScanLayoutInner").on("focus.keyboardNavigation",function(){a.layoutFocusHandler.call(a)});this.jqElement.on("focus.keyboardNavigation",".easyScanLayoutItemWrapper",this.layoutItemFocusHandler);this._ignoreSelfFocus=false;this.swapSourceElement=null;this.lastFocussedElement=null;this.lastFocussedClassId=null;this.jqElement.on("keyup",function(e){a.ctrlArrowUpDownHandler.call(a,e)})};f.prototype.ctrlArrowUpDownHandler=function(e){switch(e.keyCode){case this.keyCodes.PAGE_UP:if(e.ctrlKey){this.ctrlArrowHandler(e);this.pageUpDownHandler(e,true)}break;case this.keyCodes.PAGE_DOWN:if(e.ctrlKey){this.ctrlArrowHandler(e);this.pageUpDownHandler(e,false)}break;default:break}};f.prototype.destroy=function(){if(this.jqElement){this.jqElement.off(".keyboardNavigation");this.jqElement.find(".after").off(".keyboardNavigation");this.jqElement.find(".sapUshellEasyScanLayoutInner").off(".keyboardNavigation")}delete this.jqElement;delete this.easyScanLayout};f.prototype.getVisibleLayoutItems=function(){var e=this.easyScanLayout.getContent();var t=e.filter(function(e){return e.getVisible()});return t};f.prototype.afterFocusHandler=function(){if(this._ignoreSelfFocus){this._ignoreSelfFocus=false;return}var e=this.jqElement.find(".easyScanLayoutItemWrapper:sapTabbable").first();var t=e.find(":sapTabbable").last();if(!t.length){t=e}t.focus()};f.prototype.layoutFocusHandler=function(){if(this._ignoreSelfFocus){this._ignoreSelfFocus=false;return}var e=this.jqElement.find(".easyScanLayoutItemWrapper:sapTabbable").first();e=e.length===1?e.get(0):e;e.focus();this.handleScrollBar(true)};f.prototype.layoutItemFocusHandler=function(){var e=jQuery(document.activeElement);if(e){var t,a="";if(e.find(".valueStateText").length==1){var i=e.find(".valueStateText").find(".sapMObjectNumberText").text();var n=e.find(".valueStateText").find(".sapUiInvisibleText").text();e.find(".valueStateText").attr("aria-label",i+" "+n);e.find(".valueStateText").attr("aria-labelledby","")}e.find("[role='listitem']").attr("aria-label","");if(e.hasClass("easyScanLayoutItemWrapper")){var r="";var o=e.find(".cardCount");if(o.length===0){r="countDiv_"+(new Date).getTime();var l='<div id="'+r+'" class="cardCount"'+'" hidden></div>';e.append(l)}else{r=o[0].id}a+=r+" ";var d=e.find(".cardType");if(d.length!==0){a+=d[0].id+" "}}var u="cardHeaderType_";if(e.hasClass("sapOvpCardHeader")&&!e.hasClass("sapOvpStackCardContent")){var p="";var h=e.find(".cardHeaderType");if(h.length===0){var c=s.getText("CardHeaderType");p=u+(new Date).getTime();var f='<div id="'+p+'" class="cardHeaderType" aria-label="'+c+'" hidden></div>';e.append(f)}else{p=h[0].id}a+=p+" "}var m,y;if(e.hasClass("easyScanLayoutItemWrapper")){y=e.find(".sapOvpCardHeader");m=y.find("[aria-label]")}else{m=e.find("[aria-label]")}var g=e.find(".sapOvpStackCardHeader").length!==1;if(g){var v=[u,"sapOvpCardAdditionalActions","listItem","linkListItem"];var C=function(e){return!v.some(function(t){return e.includes(t)})};for(t=0;t<m.length;t++){var b=m[t].id;var S=b&&C(b);if(S){a+=b+" "}}}if(e.hasClass("sapOvpCardHeader")){var E=e.find(".cardHeaderText");if(E.length!==0){for(var t=0;t<E.length;t++){if(a.indexOf(E[t].id)===-1){a+=E[t].id+" "}}}}if(a.length){e.attr("aria-labelledby",a)}if(e.prop("nodeName")==="LI"&&e.find(".linkListHasPopover").length!==0){if(e.find("#hasDetails").length===0){e.append("<div id='hasDetails' hidden>"+s.getText("HAS_DETAILS")+"</div>");e.attr("aria-describedby","hasDetails")}}var D=e.attr("id");if(D&&D.indexOf("ovpTable")!=-1&&e.find("[role='Link']")&&!e.hasClass("sapUiCompSmartLink")){var w=e.closest("td").attr("data-sap-ui-column"),L=e.closest("tbody").siblings().children().filter("tr").children();for(var t=0;t<L.length;t++){if(L[t].getAttribute("data-sap-ui")==w&&L[t].hasChildNodes("span")){var I=L[t].firstElementChild.getAttribute("id");e.attr("aria-labelledby",I)}}}}};f.prototype._getLayoutItemIndex=function(e){if(!e.hasClass("easyScanLayoutItemWrapper")){return false}var t=e.children().attr("id");var a=false;this.getVisibleLayoutItems().forEach(function(e,i){if(t==e.getId()){a=i}});return a};f.prototype._changeItemsFocus=function(e){var t=document.querySelectorAll(".easyScanLayoutItemWrapper");l.addAttributeToAllElements(t,"tabindex","-1");e.attr("tabindex",0);setTimeout(function(){e.focus()},500)};f.prototype._swapItemsFocus=function(e,t,a){e.preventDefault();t.attr("tabindex","-1");setTimeout(function(){a.attr("tabindex","0").focus()},0)};f.prototype.tabButtonHandler=function(e){var t=jQuery(document.activeElement);this.lastFocussedElement=t;if(t.hasClass("easyScanLayoutItemWrapper")){return}var a=t.closest(".easyScanLayoutItemWrapper");if(!a.length){return}var i=a.find(jQuery(".lastElement"));if(t.is(i)){e.stopPropagation();e.stopImmediatePropagation();var n=this.jqElement.scrollTop();this._ignoreSelfFocus=true;this.jqElement.find(".after").focus();this.jqElement.scrollTop(n)}};f.prototype.f7Handler=function(e){e.preventDefault();e.stopPropagation();e.stopImmediatePropagation();var t=jQuery(document.activeElement);if(t.hasClass("easyScanLayoutItemWrapper")){t.find(":sapTabbable").first().focus()}else{var a=t.closest(".easyScanLayoutItemWrapper");a=a.length===1?a.get(0):a;a.focus()}};f.prototype.shiftTabButtonHandler=function(e){var t=jQuery(document.activeElement);if(t.hasClass("after")){this.lastFocussedElement.focus();return}if(!t.hasClass("easyScanLayoutItemWrapper")){return}this._ignoreSelfFocus=true;this.jqElement.find(".sapUshellEasyScanLayoutInner").focus()};f.prototype.arrowUpDownHandler=function(e,t){e.preventDefault();var a=t?"prev":"next";var i=jQuery(document.activeElement);if(!i.hasClass("sapOvpCardHeader")){var n=jQuery(i)[a](".easyScanLayoutItemWrapper");if(!n.is(i)){this._swapItemsFocus(e,i,n)}}};f.prototype.arrowRightLeftHandler=function(e,t){var a=t?1:-1;var i=jQuery(document.activeElement);var n=this._getLayoutItemIndex(i);if(n===false){return}var s=this.getVisibleLayoutItems()[n+a];if(s){this._swapItemsFocus(e,i,s.$().parent())}};f.prototype.altPageUpAndHomeHandler=function(e){var t=jQuery(document.activeElement);var a=this._getLayoutItemIndex(t);if(a===false){return}var i=this.easyScanLayout.getColumnCount();var n=a%i;var s;var r=this.getVisibleLayoutItems();if(n==0){s=r[0]}else{s=r[a-n]}this._swapItemsFocus(e,t,s.$().parent())};f.prototype.altPageDownAndEndHandler=function(e){var t=jQuery(document.activeElement);var a=this._getLayoutItemIndex(t);if(a===false){return}var i=this.easyScanLayout.getColumnCount();var n=a%i;var s;var r=this.getVisibleLayoutItems();if(n==i-1||a+(i-n)>r.length){s=r[r.length-1]}else{s=r[a+(i-n-1)]}this._swapItemsFocus(e,t,s.$().parent())};f.prototype.ctrlHomeHandler=function(e){var t=jQuery(document.activeElement);var a=this._getLayoutItemIndex(t);if(a===false){return}var i=this.easyScanLayout.getColumnCount();var n=a%i;var s=this.getVisibleLayoutItems();var r=s[n];var o=r.$().parent();if(o.is(t)){o=s[0].$().parent()}this._swapItemsFocus(e,t,o)};f.prototype.ctrlEndHandler=function(e){var t=jQuery(document.activeElement);var a=this._getLayoutItemIndex(t);if(a<0){return}var i=this.easyScanLayout.getColumnCount();var n=a%i;var s;var r=this.getVisibleLayoutItems();for(var o=r.length-1;o>=0;o--){if(o%i==n){s=r[o];break}}var l=s.$().parent();if(l.is(t)){l=r[r.length-1].$().parent()}this._swapItemsFocus(e,t,l)};f.prototype.pageUpDownHandler=function(e,t){var a=t?"prev":"next";var i=jQuery(document.activeElement);if(!i.hasClass("easyScanLayoutItemWrapper")){return}if(!i[a]().length){return}var n=false;var s=i;var r=jQuery(window).height();while(!n){var o=s[a]();if(!o.length){n=s;break}if(!t&&o.offset().top>r){n=o;break}var l=o.offset().top;var d=0;if(l){d=l<0?-1:1}if(t&&d<=0){n=o;break}s=o}this._swapItemsFocus(e,i,n)};f.prototype.ctrlArrowHandler=function(e){if(this.swapSourceElement==null){this.swapSourceElement=jQuery(document.activeElement);if(!this.swapSourceElement.hasClass("easyScanLayoutItemWrapper")){this.endSwap()}else{var t=this;this.jqElement.on("keyup.keyboardNavigation",function(e){t.keyupHandler.call(t,e)});this.jqElement.addClass("dragAndDropMode");this.swapSourceElement.addClass("dragHovered")}}};f.prototype.keyupHandler=function(e){if(this.swapSourceElement!=null&&e.keyCode===this.keyCodes.CONTROL){var t=jQuery(document.activeElement);if(t.hasClass("easyScanLayoutItemWrapper")){this.swapItemsFunction(this.swapSourceElement[0],t[0]);this._changeItemsFocus(this.swapSourceElement)}this.endSwap()}else if(e.keyCode===this.keyCodes.SPACE){this.spacebarHandler(e)}else if(e.keyCode===this.keyCodes.F6){if(e.shiftKey){var a=document.getElementsByClassName("sapUshellEasyScanLayoutInner");var i=a[0].firstElementChild;if(i.firstElementChild){document.getElementsByClassName(i.firstElementChild.className)[0].focus()}this.handleScrollBar(true)}}};f.prototype.endSwap=function(e){this.swapSourceElement.removeClass("dragHovered");this.jqElement.removeClass("dragAndDropMode");this.swapSourceElement=null;this.jqElement.off("keyup.keyboardNavigation")};f.prototype.checkIfSwapInterrupted=function(e){if(this.swapSourceElement!=null&&e.keyCode!=this.keyCodes.ARROW_LEFT&&e.keyCode!=this.keyCodes.ARROW_RIGHT&&e.keyCode!=this.keyCodes.ARROW_UP&&e.keyCode!=this.keyCodes.ARROW_DOWN){this.endSwap()}};f.prototype.spacebarHandler=function(e){var t=u.getElementById(e.target.id);if(t&&t.mEventRegistry.hasOwnProperty("press")){var a="#"+e.target.id;l.addClassToAllElements(document.querySelectorAll(a),"sapMLIBActive");t.firePress()}};f.prototype.keydownHandler=function(e){this.checkIfSwapInterrupted(e);switch(e.keyCode){case this.keyCodes.TAB:e.shiftKey?this.shiftTabButtonHandler(e):this.tabButtonHandler(e);break;case this.keyCodes.F6:if(e.shiftKey){this._ignoreSelfFocus=true;this.jqElement.find(".sapUshellEasyScanLayoutInner").focus();r.handleF6GroupNavigation(e)}else{this._ignoreSelfFocus=true;var t=this.jqElement.scrollTop();this.jqElement.find(".after").focus();r.handleF6GroupNavigation(e);this.jqElement.scrollTop(t);this.handleScrollBar(true)}break;case this.keyCodes.F7:this.f7Handler(e);break;case this.keyCodes.ARROW_UP:if(e.ctrlKey==true){this.ctrlArrowHandler(e)}this.arrowUpDownHandler(e,true);this.handleScrollBar(false);break;case this.keyCodes.ARROW_DOWN:if(e.ctrlKey==true){this.ctrlArrowHandler(e)}this.arrowUpDownHandler(e,false);break;case this.keyCodes.ARROW_RIGHT:if(e.ctrlKey==true){this.ctrlArrowHandler(e)}this.arrowRightLeftHandler(e,true);break;case this.keyCodes.ARROW_LEFT:if(e.ctrlKey==true){this.ctrlArrowHandler(e)}this.arrowRightLeftHandler(e,false);break;case this.keyCodes.HOME:e.ctrlKey==true?this.ctrlHomeHandler(e):this.altPageUpAndHomeHandler(e);break;case this.keyCodes.END:e.ctrlKey==true?this.ctrlEndHandler(e):this.altPageDownAndEndHandler(e);break;case this.keyCodes.PAGE_UP:e.altKey==true?this.altPageUpAndHomeHandler(e):this.pageUpDownHandler(e,true);if(e.ctrlKey){this.ctrlArrowHandler(e);this.pageUpDownHandler(e,true)}break;case this.keyCodes.PAGE_DOWN:e.altKey==true?this.altPageDownAndEndHandler(e):this.pageUpDownHandler(e,false);if(e.ctrlKey){this.ctrlArrowHandler(e);this.pageUpDownHandler(e,false)}break;case this.keyCodes.ENTER:this.spacebarHandler(e);break;default:break}};f.prototype.handleScrollBar=function(e){var t=this.easyScanLayout._sOwnerId+"---mainView--ovpMain";if(t){var a=u.getElementById(t);if(a){setTimeout(function(){var t=a.getScrollDelegate();if(t){var i=document.activeElement.getBoundingClientRect().height;var n=t.getScrollTop();var s=e?0:n-i-32;t.scrollTo(0,s)}},0)}}};var m=i.extend("sap.ovp.ui.EasyScanLayout",{metadata:{designTime:true,library:"sap.ovp",aggregations:{content:{type:"sap.ui.core.Control",multiple:true,singularName:"content"}},defaultAggregation:"content",events:{afterRendering:{},afterDragEnds:{},afterColumnUpdate:{}},properties:{useMediaQueries:{group:"Misc",type:"boolean",defaultValue:false},dragAndDropRootSelector:{group:"Misc",type:"string"},dragAndDropEnabled:{group:"Misc",type:"boolean",defaultValue:true},debounceTime:{group:"Misc",type:"int",defaultValue:150}}},renderer:{render:function(e,t){var a=d.getComponentById(t._sOwnerId)&&d.getComponentById(t._sOwnerId).oOvpConfig.cards;e.openStart("div",t);e.class("sapUshellEasyScanLayout");e.openEnd();e.openStart("div");e.class("sapUshellEasyScanLayoutInner");e.attr("role","list");e.attr("aria-label","Cards");if(a&&a.length>0){e.attr("tabindex",0)}e.openEnd();var i=t.columnCount;var n=Array.apply(null,new Array(i)).map(function(){return[]});var s=t.getContent().filter(function(e){return e.getVisible()});for(var r=0;r<s.length;r++){n[r%i].push(s[r])}var o=1;n.forEach(function(t){e.openStart("div");e.class("easyScanLayoutColumn");e.accessibilityState(undefined,{role:"list"});e.openEnd();t.forEach(function(t,a){e.openStart("div");if(o===1){e.attr("tabindex",0)}else{e.attr("tabindex",-1)}e.class("easyScanLayoutItemWrapper");e.accessibilityState(undefined,{role:"listitem"});e.attr("aria-setsize",s.length);e.attr("aria-posinset",o);o++;e.openEnd();e.renderControl(t);e.openStart("div").class("lastElement").accessibilityState(undefined,{role:"none"}).attr("tabindex",0).openEnd();e.close("div");e.close("div")});e.close("div")});e.close("div");e.openStart("div");e.class("after");if(a&&a.length>0){e.attr("tabindex",0).accessibilityState(undefined,{role:"none"})}e.openEnd();e.close("div")}}});m.prototype.getColumnResolutionList=function(){return[{minWidth:0,styleClass:"columns-blank",columnCount:1},{minWidth:240,styleClass:"columns-block",columnCount:1},{minWidth:352,styleClass:"columns-narrow",columnCount:1},{minWidth:433,styleClass:"columns-wide",columnCount:1},{minWidth:704,styleClass:"columns-narrow",columnCount:2},{minWidth:864,styleClass:"columns-wide",columnCount:2},{minWidth:1024,styleClass:"columns-narrow",columnCount:3},{minWidth:1280,styleClass:"columns-wide",columnCount:3},{minWidth:1440,styleClass:"columns-narrow",columnCount:4},{minWidth:1800,styleClass:"columns-wide",columnCount:4},{minWidth:2560,styleClass:"columns-narrow",columnCount:5},{minWidth:3008,styleClass:"columns-wide",columnCount:5},{minWidth:3600,styleClass:"columns-narrow",columnCount:4},{minWidth:3840,styleClass:"columns-wide",columnCount:4},{minWidth:5120,styleClass:"columns-wide",columnCount:5},{minWidth:6016,styleClass:"columns-wide",columnCount:5}]};m.prototype.init=function(){this.columnResolutionList=this.getColumnResolutionList();this.columnCount=this.columnResolutionList[0].columnCount;this.columnStyle="";this.updateColumnClass(this.columnResolutionList[0].styleClass);this.initResizeHandlerOrMediaListeners(this.columnResolutionList);if(d.getComponentById(this._sOwnerId)&&d.getComponentById(this._sOwnerId).oOvpConfig.cards.length===0){this.data("sap-ui-fastnavgroup","false",false)}else{this.data("sap-ui-fastnavgroup","true",true)}};var y;var g=function(e,t,a){var i=function(e,t){this.updateColumnClass(t);this.refreshColumnCount(e,this.getContent())};if(a.matches){window.clearTimeout(y);y=window.setTimeout(i.bind(this,e,t),this.getDebounceTime())}};var v=function(e,t){var a=e.minWidth;var i=t&&t.minWidth;return"(min-width: "+a+"px)"+(i?" and (max-width: "+(i-1)+"px)":"")};m.prototype.initMediaListeners=function(e){var t=[];for(var a=0;a<e.length;a++){var i=v(e[a],e[a+1]);var n=window.matchMedia(i);var s=g.bind(this,e[a].columnCount,e[a].styleClass);n.addListener(s);n.bindedListener=s;s(n);t.push(n)}return t};m.prototype.initResizeHandler=function(e){var t;var a=this.getDebounceTime();var i=function(){window.clearTimeout(t);t=window.setTimeout(this.oControl.resizeHandler.bind(this,e),a)};return n.register(this,i)};m.prototype.initResizeHandlerOrMediaListeners=function(e){var t=a.browser.msie&&a.browser.version>9;if(t&&this.getUseMediaQueries()){this.mediaQueryList=this.initMediaListeners(e)}else{this.resizeHandlerId=this.initResizeHandler(e)}};m.prototype.resizeHandler=function(e){var t=this.iWidth;var a=this;var i=this.oControl;var n;if(document.querySelectorAll(".ovpWrapper .sapFDynamicPageContent").length>0){t=window.innerWidth}for(var s=0;s<e.length;s++){if(!e[s+1]){n=e[s];break}if(e[s].minWidth<=t&&e[s+1].minWidth>t){n=e[s];break}}i.refreshColumnCount(n.columnCount,i.getContent(),a);i.updateColumnClass(n.styleClass);i.fireAfterColumnUpdate(n)};m.prototype.getColumnWidth=function(e){var t;switch(e){case"columns-blank":t=0;break;case"columns-narrow":t=20;break;case"columns-wide":t=25;break;default:break}return t};m.prototype.refreshColumnCount=function(e,t,a){this.columnCount=e;var i=jQuery();for(var n=0;n<e;n++){i=i.add("<div class='easyScanLayoutColumn'></div>")}var s=t.filter(function(e){return e.getVisible()});var r=1;for(var o=0;o<s.length;o++){jQuery(s[o].getDomRef()).parent().attr("aria-posinset",r);r++;i.get(o%e).appendChild(s[o].getDomRef().parentNode)}this.$().children(".sapUshellEasyScanLayoutInner").empty().append(i);if(a&&a.iWidth){this.headerMargin(a)}};m.prototype.headerMargin=function(t){var i=0,n=0;var s=t.iWidth;var r,o,l,d=0,u,p=0;var h=this.getColumnResolutionList();var c=e.getPixelPerRem();var f=parseInt(window.getComputedStyle(document.querySelector(".ovpWrapper .sapFDynamicPageTitleWrapper"),null).getPropertyValue("width").split("px")[0],10)*1/c;if(document.querySelectorAll(".ovpWrapper .sapFDynamicPageContent").length>0){s=window.innerWidth}for(var m=0;m<h.length;m++){if(!h[m+1]){r=h[m];break}if(h[m].minWidth<=s&&h[m+1].minWidth>s){r=h[m];break}}u=this.getColumnWidth(r.styleClass);l=r.columnCount*u+(r.columnCount-1)*1;o=(f-l)/2;if(a.system.desktop){jQuery(".ovpWrapper .sapFDynamicPageTitle").css({"margin-left":o+"rem","margin-right":o+"rem"});jQuery(".ovpWrapper .sapFDynamicPageHeader").css({"margin-left":o+"rem","margin-right":o+"rem"})}if(a.system.desktop){f=document.body.clientWidth;if(document.querySelectorAll(".ovpWrapper .sapFDynamicPageContentFitContainer").length>0){i=document.querySelectorAll(".ovpWrapper .sapFDynamicPageContentFitContainer")[0].clientWidth}if(f===i){var y=document.querySelector(".ovpWrapper .sapFDynamicPageTitle")||undefined;var g=y&&getComputedStyle(y)["margin-left"];var v=y&&getComputedStyle(y)["margin-right"];if(typeof g==="string"||g instanceof String){g=g.length>0?parseInt(g.split("px")[0],10):0}if(typeof v==="string"||v instanceof String){v=v.length>0?parseInt(v.split("px")[0],10):0}d=jQuery(".ovpWrapper .sapFDynamicPageScrollBar").css("width");if(typeof d==="string"||d instanceof String){p=d.length>0?parseInt(d.split("px")[0],10):0}d=p;n=d/2;g=(g+n)/(c*1);v=(v+n)/(c*1);jQuery(".ovpWrapper .sapFDynamicPageTitle").css({"margin-left":g+"rem","margin-right":v+"rem",visibility:"visible"});jQuery(".ovpWrapper .sapFDynamicPageHeader").css({"margin-left":g+"rem","margin-right":v+"rem"})}}};m.prototype.getColumnCount=function(){return this.columnCount};m.prototype.getVisibleLayoutItems=function(){var e=this.getContent();var t=e.filter(function(e){return e.getVisible()});return t};m.prototype.updateColumnClass=function(e){if(this.columnStyle===e){return}this.removeStyleClass(this.columnStyle);this.addStyleClass(e);this.columnStyle=e};m.prototype.afterDragAndDropHandler=function(e){var t=this.removeAllAggregation("content",true);var a=[];var i=0;e.forEach(function(e,t){var i=e.children[0].getAttribute("id");var n=u.getElementById(i);a.push(n);jQuery(e).attr("aria-posinset",t+1)});for(var n=0;n<t.length;n++){if(t[n].getVisible()){this.addAggregation("content",a[i],true);i++}else{this.addAggregation("content",t[n],true)}}this.fireAfterDragEnds({positionChanges:this.layoutDragAndDrop.positionChanges});this.refreshColumnCount(this.getColumnCount(),this.getContent())};m.prototype.setActive=function(e){if(e){this.removeStyleClass("ovpOverlay")}else{this.addStyleClass("ovpOverlay")}};m.prototype.getActive=function(){return!this.hasStyleClass("ovpOverlay")};m.prototype.onAfterRendering=function(){if(!this.getDragAndDropRootSelector()){this.setDragAndDropRootSelector("#"+this.getId())}if(this.layoutDragAndDrop){this.layoutDragAndDrop.destroy()}if(this.getDragAndDropEnabled()){this.layoutDragAndDrop=c.buildReplaceItemsInstance({afterReplaceElements:this.afterDragAndDropHandler.bind(this),rootSelector:this.getDragAndDropRootSelector(),layout:this})}if(this.keyboardNavigation){this.keyboardNavigation.destroy()}var e=this.layoutDragAndDrop?this.layoutDragAndDrop.getSwapItemsFunction():null;this.keyboardNavigation=new f(this,e);this.fireAfterRendering()};m.prototype.exit=function(){if(this.mediaQueryList){this.mediaQueryList.forEach(function(e){e.removeListener(e.bindedListener)});delete this.mediaQueryList}if(this.resizeHandlerId){n.deregister(this.resizeHandlerId)}if(this.layoutDragAndDrop){this.layoutDragAndDrop.destroy();delete this.layoutDragAndDrop}};return m});
//# sourceMappingURL=EasyScanLayout.js.map