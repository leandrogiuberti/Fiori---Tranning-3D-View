/*!
 * Copyright (c) 2009-2014 SAP SE, All Rights Reserved
 */
sap.ui.define(["sap/ui/thirdparty/jquery","sap/ui/base/Object","sap/ui/events/KeyCodes","sap/ui/core/Element","sap/base/i18n/Localization"],function(jQuery,e,t,l,s){"use strict";return e.extend("sap.ovp.ui.UIActions",{constructor:function(e){if(!e||!e.rootSelector||!e.containerSelector||!e.draggableSelector){throw new Error("No configuration object to initialize User Interaction module.")}this.captureStart=null;this.captureMove=null;this.captureEnd=null;this.clickCallback=null;this.clickEvent=null;this.clickHandler=null;this.clone=null;this.cloneClass=null;this.container=null;this.contextMenuEvent=null;this.debug=false;this.dragMoveCallback=null;this.draggable=null;this.placeHolderClass=null;this.draggableSelector=null;this.doubleTapCallback=null;this.doubleTapDelay=null;this.element=null;this.swapTargetElement=null;this.endX=null;this.endY=null;this.isTouch=null;this.lastElement=null;this.lastTapTime=null;this.lockMode=null;this.log=null;this.mode=null;this.mouseDownEvent=null;this.mouseMoveEvent=null;this.mouseUpEvent=null;this.keyUpEvent=null;this.moveTolerance=null;this.moveX=null;this.moveY=null;this.noop=null;this.preventClickFlag=false;this.preventClickTimeoutId=null;this.scrollContainer=null;this.scrollContainerSelector=null;this.scrollEvent=null;this.scrollTimer=null;this.startX=null;this.startY=null;this.switchModeDelay=null;this.tapsNumber=null;this.timer=null;this.scrollHandler=null;this.touchCancelEvent=null;this.dragStartCallback=null;this.dragEndCallback=null;this.endCallback=null;this.touchEndEvent=null;this.touchMoveEvent=null;this.beforeDragCallback=null;this.touchStartEvent=null;this.wrapper=null;this.wrapperRect=null;this.scrollEdge=100;this.isRTLEnabled=null;this.resizeStartCallback=null;this.resizeMoveCallback=null;this.resizeEndCallback=null;this.isResize=null;this.isResizeX=null;this.isResizeY=null;this.resizeHandleDistance=null;this.layoutDetails=null;this.init=function(e){this.startX=-1;this.startY=-1;this.moveX=-1;this.moveY=-1;this.endX=-1;this.endY=-1;this.resizeHandleDistance=16;this.isResize=false;this.isResizeX=false;this.isResizeY=false;this.noop=function(){};this.isTouch=e.isTouch?!!e.isTouch:false;this.container=document.querySelector(e.containerSelector);this.scrollContainerSelector=e.scrollContainerSelector||e.containerSelector;this.switchModeDelay=e.switchModeDelay||1500;this.moveTolerance=e.moveTolerance===0?0:e.moveTolerance||1e3;this.draggableSelector=e.draggableSelector;this.mode="normal";this.debug=e.debug||false;this.root=document.querySelector(e.rootSelector);this.tapsNumber=0;this.lastTapTime=0;this.log=this.debug?this.logToConsole:this.noop;this.lockMode=false;this.placeHolderClass=e.placeHolderClass||"";this.cloneClass=e.cloneClass||"";this.wrapper=e.wrapperSelector?document.querySelector(e.wrapperSelector):this.container.parentNode;this.clickCallback=typeof e.clickCallback==="function"?e.clickCallback:this.noop;this.beforeDragCallback=typeof e.beforeDragCallback==="function"?e.beforeDragCallback:this.noop;this.doubleTapCallback=typeof e.doubleTapCallback==="function"?e.doubleTapCallback:this.noop;this.dragEndCallback=typeof e.dragEndCallback==="function"?e.dragEndCallback:this.noop;this.endCallback=typeof e.endCallback==="function"?e.endCallback:this.noop;this.dragStartCallback=typeof e.dragStartCallback==="function"?e.dragStartCallback:this.noop;this.dragMoveCallback=typeof e.dragMoveCallback==="function"?e.dragMoveCallback:this.noop;this.doubleTapDelay=e.doubleTapDelay||500;this.wrapperRect=this.wrapper.getBoundingClientRect();this.scrollEvent="scroll";this.touchStartEvent="touchstart";this.touchMoveEvent="touchmove";this.touchEndEvent="touchend";this.mouseDownEvent="mousedown";this.mouseMoveEvent="mousemove";this.mouseUpEvent="mouseup";this.keyUpEvent="keyup";this.contextMenuEvent="contextmenu";this.touchCancelEvent="touchcancel";this.clickEvent="click";this.layoutDetails=e.layout?e.layout.dashboardLayoutUtil:null;this.isRTLEnabled=s.getRTL();this.resizeStartCallback=typeof e.resizeStartCallback==="function"?e.resizeStartCallback:this.noop;this.resizeMoveCallback=typeof e.resizeMoveCallback==="function"?e.resizeMoveCallback:this.noop;this.resizeEndCallback=typeof e.resizeEndCallback==="function"?e.resizeEndCallback:this.noop;if(this.wrapper){jQuery(this.wrapper).css({position:"relative",top:0,left:0,right:0,bottom:0,"-webkit-transform":"translateZ(0)",transform:"translateZ(0)"})}};this.forEach=function(e,t){return Array.prototype.forEach.call(e,t)};this.indexOf=function(e,t){return Array.prototype.indexOf.call(e,t)};this.insertBefore=function(e,t,l){var s,i,a;a=Array.prototype.splice;s=this.indexOf(e,t);i=this.indexOf(e,l);a.call(e,i-(s<i?1:0),0,a.call(e,s,1)[0])};this.logToConsole=function(){window.console.log.apply(console,arguments)};this.getDraggableElement=function(e){var t;this.draggable=jQuery(this.draggableSelector,this.container);while(typeof t==="undefined"&&e!==this.root){if(this.indexOf(this.draggable,e)>=0){t=e}e=e.parentNode}return t};this.captureStart=function(e){var t;if(e.type==="touchstart"&&e.touches.length===1){t=e.touches[0]}else if(e.type==="mousedown"){t=e;if(e.which!==1){return}}if(t){this.element=this.getDraggableElement(t.target);this.startX=t.pageX;this.startY=t.pageY;this.lastMoveX=0;this.lastMoveY=0;if(this.element){var l=jQuery(this.element);var s=l.offset().left;var i=l.offset().top;var a=l.height();var n=l.width();if(this.layoutDetails){var o=this.isRTLEnabled?this.startX-s<this.resizeHandleDistance:s+n-this.startX<this.resizeHandleDistance;var r=i+a-this.startY<this.resizeHandleDistance;if(o||r){if(o&&r){this.isResizeX=false;this.isResizeY=false}else if(!o&&r){this.isResizeX=false;this.isResizeY=true}else if(o&&!r){this.isResizeX=true;this.isResizeY=false}this.isResize=true}}else{var h=s+n-this.startX;var c=i+a-this.startY;if(h<this.resizeHandleDistance&&c<this.resizeHandleDistance){this.isResize=true}}}if(this.lastTapTime&&this.lastElement&&this.element&&this.lastElement===this.element&&Math.abs(Date.now()-this.lastTapTime)<this.doubleTapDelay){this.lastTapTime=0;this.tapsNumber=2}else{this.lastTapTime=Date.now();this.tapsNumber=1;this.lastElement=this.element}this.log("captureStart("+this.startX+", "+this.startY+")")}};var i=this;this.startHandler=function(e){i.log("startHandler");i.captureStart(e);if(i.element){i.beforeDragCallback(e,i.element);if(i.lockMode===false){if(i.tapsNumber===2){i.mode="double-tap";return}if(e.type==="touchstart"){i.timer=setTimeout(function(){if(i.isResize){i.log("mode switched to resize");i.mode="resize";i.resizeStartCallback(e,i.element)}else{i.log("mode switched to drag");i.mode="drag";i.createClone();i.dragStartCallback(e,i.element)}},i.switchModeDelay)}}}};this.captureMove=function(e){var t;if(e.type==="touchmove"&&e.touches.length===1){t=e.touches[0]}else if(e.type==="mousemove"){t=e}if(t){this.moveX=t.pageX;this.moveY=t.pageY;this.log("captureMove("+this.moveX+", "+this.moveY+")")}};this.moveHandler=function(e){i.log("moveHandler");i.captureMove(e);switch(i.mode){case"normal":if(Math.abs(i.startX-i.moveX)>i.moveTolerance||Math.abs(i.startY-i.moveY)>i.moveTolerance){if(e.type==="touchmove"){i.log("-> normal");clearTimeout(i.timer);delete i.timer}else if(i.element){if(i.isResize){i.log("mode switched to resize");i.mode="resize"}else{i.log("mode switched to drag");i.mode="drag";i.createClone()}}}break;case"drag":e.preventDefault();i.log("-> drag");i.mode="drag-and-scroll";window.addEventListener(i.mouseUpEvent,i.endHandler,true);window.addEventListener(i.keyUpEvent,i.endHandler,true);i.translateClone();i.scrollContainer=document.querySelector(i.scrollContainerSelector);if(e.type==="mousemove"){i.dragStartCallback(e,i.element)}break;case"drag-and-scroll":e.stopPropagation();e.preventDefault();i.log("-> drag-and-scroll");i.translateClone();i.dragMoveCallback({evt:e,clone:i.clone,element:i.element,draggable:i.draggable,moveX:i.moveX,moveY:i.moveY});break;case"resize":e.preventDefault();i.log("-> resize");i.mode="resize-and-scroll";window.addEventListener(i.mouseUpEvent,i.endHandler,true);i.scrollContainer=document.querySelector(i.scrollContainerSelector);if(e.type==="mousemove"){i.resizeStartCallback(e,i.element)}break;case"resize-and-scroll":e.stopPropagation();e.preventDefault();i.log("-> resize-and-scroll");i.resizeMoveCallback({evt:e,element:i.element,draggable:i.draggable,moveX:i.moveX,moveY:i.moveY});break;default:break}};this.captureEnd=function(e){var t;if((e.type==="touchend"||e.type==="touchcancel")&&e.changedTouches.length===1){t=e.changedTouches[0]}else if(e.type==="mouseup"){t=e}if(t){this.endX=t.pageX;this.endY=t.pageY;this.log("captureEnd("+this.endX+", "+this.endY+")")}};this.contextMenuHandler=function(e){if(i.isTouch){e.preventDefault()}};this.clickHandler=function(e){var t=document.getElementsByClassName("viz-controls-chartTooltip");var s=t&&t[0]&&t[0].id;var a=l.getElementById(s);if(a){var n=a&&a.aDelegates[0]&&a.aDelegates[0].oDelegate;if(n){n.close()}}if(i.preventClickFlag){i.preventClickFlag=false;e.preventDefault();e.stopPropagation();e.stopImmediatePropagation();clearTimeout(i.preventClickTimeoutId)}i.clickCallback()};this.preventClick=function(){this.preventClickFlag=true;this.preventClickTimeoutId=setTimeout(function(){i.preventClickFlag=false},100)};this.endHandler=function(e){i.log("endHandler");if(e.type==i.keyUpEvent&&e.which==t.ESCAPE||e.type==i.mouseUpEvent||e.type==i.touchEndEvent){i.captureEnd(e);switch(i.mode){case"normal":i.log("-> normal");break;case"drag":i.log("-> drag");i.dragEndCallback(e,i.element,i.clone);i.preventClick();break;case"drag-and-scroll":i.log("-> drag-and-scroll");window.removeEventListener(i.mouseUpEvent,i.endHandler,true);i.dragEndCallback(e,i.element,i.clone);i.preventClick();e.stopPropagation();e.preventDefault();break;case"double-tap":i.log("-> double-tap");i.doubleTapCallback(e,i.element);break;case"resize":i.log("-> resize");i.isResize=false;i.resizeEndCallback(e,i.element);i.preventClick();break;case"resize-and-scroll":i.log("-> resize-and-scroll");window.removeEventListener(i.mouseUpEvent,i.endHandler,true);i.isResize=false;i.resizeEndCallback(e,i.element);i.preventClick();e.stopPropagation();e.preventDefault();break;default:break}if(i.element){i.endCallback(e,i.element)}clearTimeout(i.timer);delete i.timer;i.lastMoveX=0;i.lastMoveY=0;i.swapTargetElement=null;i.element=null;i.mode="normal"}};this.defaultDragStartHandler=function(e){e.preventDefault()};this.scrollHandler=function(){clearTimeout(i.scrollTimer);i.lockMode=true;i.scrollTimer=setTimeout(function(){i.lockMode=false},500)};this.createClone=function(){var e,t;if(this.clone){this.removeClone()}t=this.element.getBoundingClientRect();this.clone=this.element.cloneNode(true);var l=this.element.querySelectorAll("canvas");if(l.length){var s=this.clone.querySelectorAll("canvas");for(var i=0;i<l.length;i++){s[i].getContext("2d").drawImage(l[i],0,0)}}this.clone.className+=" "+this.cloneClass;if(!this.layoutDetails){this.element.className+=" "+"easyScanLayoutItemWrapper-placeHolder"}else{this.element.className+=" "+"dashboardLayoutItemWrapper-placeHolder"}e=this.clone.style;e.position="absolute";e.display="block";e.top=t.top-this.root.getBoundingClientRect().top+"px";e.left=t.left-this.root.getBoundingClientRect().left+"px";e.width=t.width+"px";e.zIndex="100";e.webkitTransition="-webkit-transform 0ms cubic-bezier(0.33, 0.66, 0.66, 1)";e.mozTransition="-moz-transform 0ms cubic-bezier(0.33, 0.66, 0.66, 1)";e.msTransition="-ms-transform 0ms cubic-bezier(0.33, 0.66, 0.66, 1)";e.transition="transform 0ms cubic-bezier(0.33, 0.66, 0.66, 1)";e.webkitTransform="translate3d(0px, 0px, 0px) ";e.mozTransform="translate3d(0px, 0px, 0px) ";e.msTransform="translate3d(0px, 0px, 0px) ";e.transform="translate3d(0px, 0px, 0px) ";this.root.appendChild(this.clone);this.log("createClone")};this.removeClone=function(){if(this.element!==null&&typeof this.element!=="undefined"){this.element.className=this.element.className.split(" "+this.placeHolderClass).join("")}if(this.clone!==null){this.clone.parentElement.removeChild(this.clone);this.clone=null;this.log("removeClone")}};this.translateClone=function(){var e,t;e=this.moveX-this.startX;t=this.moveY-this.startY;if(this.clone&&e&&t){this.clone.style.webkitTransform="translate3d("+e+"px, "+t+"px, 0px)";this.clone.style.mozTransform="translate3d("+e+"px, "+t+"px, 0px)";this.clone.style.msTransform="translate("+e+"px, "+t+"px)";this.clone.style.transform="translate3d("+e+"px, "+t+"px, 0px)";this.log("translateClone ("+e+", "+t+")")}};this.enable=function(){this.log("enable");this.root.addEventListener(this.touchStartEvent,this.startHandler,false);this.root.addEventListener(this.touchMoveEvent,this.moveHandler,true);this.root.addEventListener(this.touchEndEvent,this.endHandler,false);this.root.addEventListener(this.touchCancelEvent,this.endHandler,false);this.root.addEventListener(this.mouseMoveEvent,this.moveHandler,true);this.root.addEventListener(this.mouseDownEvent,this.startHandler,false);this.root.addEventListener(this.mouseUpEvent,this.endHandler,false);this.root.addEventListener(this.contextMenuEvent,this.contextMenuHandler,false);this.root.addEventListener(this.clickEvent,this.clickHandler,true);this.wrapper.addEventListener(this.scrollEvent,this.scrollHandler,false);return this};this.disable=function(){this.log("disable");this.root.removeEventListener(this.touchStartEvent,this.startHandler,false);this.root.removeEventListener(this.touchMoveEvent,this.moveHandler,true);this.root.removeEventListener(this.touchEndEvent,this.endHandler,false);this.root.removeEventListener(this.mouseDownEvent,this.startHandler,false);this.root.removeEventListener(this.mouseMoveEvent,this.moveHandler,true);this.root.removeEventListener(this.mouseUpEvent,this.endHandler,false);this.root.removeEventListener(this.contextMenuEvent,this.contextMenuHandler,false);this.root.removeEventListener(this.clickEvent,this.clickHandler,true);this.root.removeEventListener(this.touchCancelEvent,this.endHandler,false);this.wrapper.removeEventListener(this.scrollEvent,this.scrollHandler,false);return this};this.init(e);this.getMove=function(){return{x:this.moveX,y:this.moveY}}}})});
//# sourceMappingURL=UIActions.js.map