/*!
 * Copyright (c) 2009-2014 SAP SE, All Rights Reserved
 */
sap.ui.define(["sap/fe/navigation/PresentationVariant","sap/ovp/cards/AnnotationHelper","sap/ovp/cards/CommonUtils","sap/ovp/insights/helpers/Filters","sap/ovp/helpers/ODataAnnotationHelper","sap/ovp/cards/NavigationHelper","sap/ovp/app/OVPLogger"],function(t,e,a,r,n,i,o){"use strict";var s=new o("OVP.app.NavigationHelper");function c(t){if(t.startsWith("#")){t=t.slice(1)}var e=t.split("-");var a=e[0]||"";var r=e[1]?e[1].split("?")[0]:"";var n={};var i=e[1]?e[1].split("?")[1]:undefined;if(i){var o=i.split("&");for(var s=0;s<o.length;s++){var c=o[s];var v=c.split("=")[0];var l=c.split("=")[1];n[v]=l}}return{semanticObject:a,action:r,parameters:n}}function v(t){if(!t){return false}var e=t.getEntityType();var a=t.getCardPropertiesModel();if(e&&a){var r=a.getProperty("/identificationAnnotationPath");var o=n.getRecords(e,r,t.getView().getModel());var s=t.getModel();if(i.isNavigationInAnnotation(s,o)){return true}}var c=a&&a.getProperty("/template");var v=["sap.ovp.cards.table","sap.ovp.cards.list","sap.ovp.cards.v4.table","sap.ovp.cards.v4.list"];return v.indexOf(c)>-1&&i.checkLineItemNavigation(t.getModel(),t.getEntityType(),a)}function l(t,e){if(e.semanticObject&&e.action&&t.semanticObject&&t.action){t["lineItemSemanticObject"]=e.semanticObject;t["lineItemAction"]=e.action}else if(e.semanticObject&&e.action){e["lineItemSemanticObject"]=e.semanticObject;e["lineItemAction"]=e.action;e.semanticObject="";e.action="";return e}return t}function p(t,e){var a=t.getCardPropertiesModel();var r=i.getEntityNavigationEntries(null,t.getModel(),t.getEntityType(),a)||[];var n=r.length>0?r[0]:{};if(e.cardComponentName==="List"||e.cardComponentName==="Table"){var o=t.getCardItemsBinding(),s=o&&o.getAllCurrentContexts(),c=s&&s[0],v=i.getEntityNavigationEntries(c,t.getModel(),t.getEntityType(),a,a.getProperty("/annotationPath")),p=v.length>0?v[0]:{};var g={};var f={};var d,y;if(n&&n.type==="com.sap.vocabularies.UI.v1.DataFieldWithUrl"){y=u(t,n)}else if(n&&n.type==="com.sap.vocabularies.UI.v1.DataFieldForIntentBasedNavigation"){f=m(t,n)}if(p&&p.type==="com.sap.vocabularies.UI.v1.DataFieldWithUrl"){d=u(t,p)}else if(p&&p.type==="com.sap.vocabularies.UI.v1.DataFieldForIntentBasedNavigation"){g=m(t,p)}return Promise.all([y,d]).then(function(t){var e=t&&t[0]||f,a=t&&t[1]||g;return l(e,a)})}else{if(n&&n.type==="com.sap.vocabularies.UI.v1.DataFieldWithUrl"){return u(t,n).then(function(t){return t})}if(n&&n.type==="com.sap.vocabularies.UI.v1.DataFieldForIntentBasedNavigation"){var P=m(t,n);return Promise.resolve(P)}}}function u(t,e){var r=a.getUshellContainer();if(!r){return}return r.getServiceAsync("URLParsing").then(function(a){return a.isIntentUrlAsync(e.url).then(function(r){if(r){var n=m(t,e);if(n.semanticObject){return n}else{var i=a.parseShellHash(e.url);return m(t,i)}}return{type:"url",url:e.url}})}).catch(function(t){s.error(t)})}function g(t){var e=d(t);var n=e&&e["sNavPresentationVariant"];if(n&&!a.isJSONData(n)){e["sNavPresentationVariant"]=r.removeExtraInfoVariant(n)}return e}function f(t){var e=[];for(var a=0;a<t.property.length;a++){if(t.property[a]["com.sap.vocabularies.PersonalData.v1.IsPotentiallySensitive"]&&t.property[a]["com.sap.vocabularies.PersonalData.v1.IsPotentiallySensitive"].Bool){e.push(t.property[a].name)}}return e}function d(r){var n=r.getCardPropertiesModel(),i=n&&n.getProperty("/staticContent");var o,s;var c=r.getModel();var v=a.isODataV4(c);if(!i){var l=e.getCardSorters(r.getCardPropertiesModel(),v);var p=r.getEntityType();s=l&&new t(l);o=n&&n.getProperty("/staticParameters")}var u=f(p);return{sensitiveProperties:u,staticPropertyMap:o,sNavPresentationVariant:s?s.toJSONObject():null}}function m(t,e){return{type:"intent",semanticObject:e.semanticObject,action:e.action,staticParams:g(t)}}function y(t,e){if(t&&t.length){var r=a.isODataV4(e);for(var n=0;n<t.length;n++){var i=t[n];if(r&&i.$Type==="com.sap.vocabularies.UI.v1.DataFieldForIntentBasedNavigation"){return true}else if(!r&&i.RecordType==="com.sap.vocabularies.UI.v1.DataFieldForIntentBasedNavigation"){return true}}}return false}function P(t,e,a){if(e&&t){var r=t.getProperty("/identificationAnnotationPath");var i=n.getRecords(e,r,a);return y(i,a)}return false}function h(t,e){if(e&&t){if(t.getProperty("/template")==="sap.ovp.cards.charts.analytical"){var a=t.getProperty("/kpiAnnotationPath");if(a){var r=e[a];if(r&&r.Detail){var n=r.Detail.SemanticObject&&r.Detail.SemanticObject.String;var i=r.Detail.Action&&r.Detail.Action.String;if(n&&i){return true}}}}}return false}function b(t,e,a){if(e&&t){var r=t.getProperty("/annotationPath");var i=n.getRecords(e,r,a);return y(i,a)}return false}return{getNavigationIntentFromAuthString:c,bCheckNavigationForCard:v,getNavigationParameters:p,checkLineItemNavigation:b,checkIdentificationAnnotationNavigation:P,checkKPIAnnotationNavigation:h,getStaticParams:g}},true);
//# sourceMappingURL=NavigationHelper.js.map