/*!
 * Copyright (c) 2009-2014 SAP SE, All Rights Reserved
 */
sap.ui.define(["sap/ui/base/Object","sap/m/library","sap/m/MenuItem","sap/ui/core/Fragment","sap/ui/core/CustomData","sap/base/util/ObjectPath","sap/ui/thirdparty/hasher","sap/ushell/ui/footerbar/AddBookmarkButton","sap/suite/ui/commons/collaboration/ServiceContainer","sap/ui/performance/trace/FESRHelper","sap/ui/core/Component","sap/ovp/app/OVPLogger"],function(e,t,r,o,a,i,n,s,l,c,u,p){"use strict";return e.extend("sap.ovp.app.ShareUtils",{constructor:function(e){if(!e){throw new Error("controller is undefined!")}this.oController=e},init:function(){this._createModelForTile();this._checkJamAuth()},onShareButtonAvailableAndPressed:function(e){var i=this.oController._getLibraryResourceBundle();var n=this.oController.getUIModel();var h=n&&n.getProperty("/title");var m=this;var d;var f={shareEmailPressed:function(){t.URLHelper.triggerEmail(null,i.getText("Email_Subject",[h]),document.URL)},shareMSTeamsPressed:function(){var e="";var t=n.getProperty("/subtitle");if(t&&t.length>0){e=n.getProperty("/appTitle")||"";t=h+" - "+t}else{t="";e=h}var r={url:document.URL,appTitle:e,subTitle:t,minifyUrlForChat:true};m.oSuiteCollaborationService.share(this.getCustomData()[0].getValue(),r)},shareJamPressed:function(){u.create({name:"sap.collaboration.components.fiori.sharing.dialog",settings:{object:{id:document.URL,share:h}}}).then(function(e){e.open()})},shareTilePressed:function(){d.firePress()}};if(this.oShareActionSheet){this.oShareActionSheet.destroy()}this.oSharePageFragment=o.load({name:"sap.ovp.app.SharePage",controller:f}).then(function(e){m.oController.getView().addDependent(e);return e});this.oSharePageFragment.then(function(t){m.oShareActionSheet=t;var o=new p("OVP.app.ShareUtils");try{d=new s("",{customUrl:n.getProperty("/tileInfo").tileCustomURL(),title:h,tileIcon:n.getProperty("/icon")||"sap-icon://bookmark"});n.setProperty("/tileVisible",d.getEnabled());n.setProperty("/tileIcon",d.getIcon());n.setProperty("/tileText",d.getText())}catch(e){o.error("Error initializing AddBookmarkButton:",e);n.setProperty("/tileVisible",false)}var i=2;if(!n.getProperty("/jamVisible")){i=1}l.getServiceAsync().then(function(t){m.oSuiteCollaborationService=t;var o=m.oSuiteCollaborationService.getOptions();if(Array.isArray(o)&&o.length>0){o.forEach(function(e){if(Array.isArray(e.subOptions)&&e.subOptions.length>1){var t=[];e.subOptions.forEach(function(e){var o=new r({text:e.text,icon:e.icon,press:f.shareMSTeamsPressed});o.addCustomData(new a({key:"data",value:e}));c.setSemanticStepname(o,"press",e.fesrStepName);t.push(o)});m.oShareActionSheet.insertItem(new r({text:e.text,icon:e.icon,items:t}),i)}else{var o=new r({text:e.text,icon:e.icon,press:f.shareMSTeamsPressed});o.addCustomData(new a({key:"data",value:e}));c.setSemanticStepname(o,"press",e.fesrStepName);m.oShareActionSheet.insertItem(o,i)}i++})}m.oShareActionSheet.openBy(e)})})},_checkJamAuth:function(){var e=i.get("sap.ushell.Container.getUser");var t=this.oController.getUIModel();if(t){t.setProperty("/jamVisible",!!e&&e().isJamActive())}},_createModelForTile:function(){var e=this.oController.getUIModel();var t,r=e&&e.getProperty("/title");var o={tileTitle:r,tileCustomURL:function(){t=n.getHash();return t?"#"+t:window.location.href}};if(e){e.setProperty("/tileInfo",o)}}})});
//# sourceMappingURL=ShareUtils.js.map