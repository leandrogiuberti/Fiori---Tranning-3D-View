<core:FragmentDefinition
    xmlns="sap.m"
    xmlns:core="sap.ui.core"
    xmlns:smartFilterBar="sap.ui.comp.smartfilterbar"
    xmlns:template="http://schemas.sap.com/sapui5/extension/sap.ui.core.template/1"
    template:require="{
		CardAnnotationhelper: 'sap/ovp/cards/AnnotationHelper'
	}"    
>
    <smartFilterBar:SmartFilterBar 
        id="ovpGlobalFilter"
        entitySet="{ui>/globalFilterEntitySet}"
        persistencyKey="ovpGlobalFilter"
        filterBarExpanded="true"
        showMessages="false"
        beforeVariantFetch="onBeforeSFBVariantSave"
        afterVariantLoad="onAfterSFBVariantLoad"
        assignedFiltersChanged="onAssignedFiltersChanged"
        useToolbar="false"
        smartVariant="ovpPageVariant"
        useDateRangeType="{ui>/useDateRangeType}"
        liveMode="{ui>/enableLiveFilter}"
        enableBasicSearch="{ui>/showBasicSearch}"
        search="cmd:Search"
        considerAnalyticalParameters="{ui>/considerAnalyticalParameters}">
        <template:if test="{meta>}">
            <smartFilterBar:controlConfiguration>
                <template:with 
                    path='ui>allControlConfiguration'
                    var='selectionField'>
                    <template:repeat list="{selectionField>}">
                         <template:if test="{parts: [{path: 'selectionField>PropertyPath'}, {path: 'ui>datePropertiesSettings'}], formatter: 'CardAnnotationhelper.isDateRangeType'}">
                            <template:then>
                                <!-- if SelField has custom date range implementation or selected values -->
                                <smartFilterBar:ControlConfiguration
                                    key="{= (${selectionField>PropertyPath}).replace('/', '.').trim() }"
                                    groupId="{path: 'selectionField>bNotPartOfSelectionField', formatter: 'CardAnnotationhelper.getGroupID'}"
                                    conditionType="{parts: [{path: 'selectionField>PropertyPath'}, {path: 'ui>datePropertiesSettings'}], formatter: 'CardAnnotationhelper.getConditionTypeForDateProperties'}" />
                            </template:then>
                            <template:else>
                                <smartFilterBar:ControlConfiguration
                                    key="{= (${selectionField>PropertyPath}).replace('/', '.').trim() }"
                                    groupId="_BASIC" />
                            </template:else>
                        </template:if>
                    </template:repeat>
                </template:with>
                <!-- Extension provided in manifest will be automatically hooked into matching extension point -->
                    <template:if test="{= ${ui>globalFilterEntityType}}">
                        <core:ExtensionPoint name="SmartFilterBarControlConfigurationExtension|{ui>globalFilterEntityTypeNQ}"/>
                        <core:ExtensionPoint name="SmartFilterBarControlConfigurationExtension|{ui>globalFilterEntityType}"/>
                    </template:if>
            </smartFilterBar:controlConfiguration>
        </template:if>
		<smartFilterBar:customData>
			<core:CustomData key="dateFormatSettings" value='\{"UTC":true,"style":"medium"\}'/>
		</smartFilterBar:customData>
    </smartFilterBar:SmartFilterBar>
</core:FragmentDefinition>