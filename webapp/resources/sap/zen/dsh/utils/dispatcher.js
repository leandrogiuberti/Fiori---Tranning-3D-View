/*
 * SAPUI5
  (c) Copyright 2009-2021 SAP SE. All rights reserved
 */
sap.ui.define("sap/zen/dsh/utils/dispatcher",["jquery.sap.global","sap/base/Log","sap/zen/dsh/utils/request"],function(jQuery,e,t){jQuery.sap.declare("sap.zen.dsh.utils.Dispatcher");sap.zen.dsh.sapbi_page=sap.zen.dsh.sapbi_page||{};var i=function(){var n=this;var s={};var r={};var a={};var o=false;var l=[];var d=false;var h=0;var u=null;var g=false;var c={};var f={};var p;var v;var D;var m;if(sap.zen.dsh.sapbi_page.m_profileMode&&jQuery.sap.measure.getActive()){var y=0}this.reset=function(){r={};a={}};this.addHandler=function(t,i,n){if(sap.zen.dsh.sapbi_page.m_profileMode&&jQuery.sap.measure.getActive()){e.info("Register Handler "+y);if(!jQuery.sap.measure.getMeasurement("zen addHandler "+y)){jQuery.sap.measure.start("zen addHandler "+y,"addHandler/"+t)}else{jQuery.sap.measure.end("zen addHandler "+y);jQuery.sap.measure.start("zen addHandler "+ ++y,"addHandler/"+t)}}var r=s[t];if(!r){r=[];s[t]=r}r[i]=n};this.addHandlers=function(e,t,i){this.addHandler(e,0,t);if(sap.zen.designmode){this.addHandler(e,1,new sap.zen.designmode.DefaultDesignHandler(null,i,t))}};this.getHandlers=function(t){var i=s[t];if(i){return i.slice()}var n="No handler found for type "+t;e.error(n);throw new Error(n)};this.removeHandlers=function(e){delete s[e]};this.dispatchDelta=function(e){this.deleteMessageStack();o=true;d=false;l=e;this.resizeControlsForNotification=[];for(var t=0;t<e.length;t++){var i=e[t];if(i.component){this.dispatchUpdateControl(i.component,false)}else{this.dispatchUpdateControl(i,true)}this.notifyControlsOfResize()}w();this.doAfterDispatchingWork();o=false;l=[];this.renderDeferredObjects();return true};this.resizeControlsForNotification=[];this.registerControlForResizeNotificationIfNecessary=function(e,t,i,n,s,r,a){if(t&&i&&e){var o=true;for(var l in i){if(Object.prototype.hasOwnProperty.call(i,l)){var d=t[l];if(!d){o=false;break}if(i[l]!==d){o=false;break}}}if(n!==null&&s){if(n!=s&&s!=="auto"){o=false}}if(r!==null&&a){if(r!=a&&a!=="auto"){o=false}}if(!o){this.resizeControlsForNotification.push(e)}}};this.notifyControlsOfResize=function(){for(var e=0;e<this.resizeControlsForNotification.length;e++){var t=this.resizeControlsForNotification[e];for(var i in a){if(Object.prototype.hasOwnProperty.call(a,i)){var n=a[i];if(!(typeof n.obj==="string")){var s=n.obj.getId();var r=true;if(t.getId()!==s){var o=jQuery(document.getElementById(t.getId())).find("#"+jQuery.sap.encodeCSS(s));r=o&&o.length>0}if(r){var l=a[i].handler;var d=l["beginResize"];if(d){d.call(l,{})}d=l["endResize"];if(d){d.call(l,{})}}}}}}};this.dragHandler=function(){var e=this;this.dragAreas=[];this.dropAreas=[];this.activeDragArea=null;this.registerActiveDragArea=function(e){if(this.activeDragArea===null){this.activeDragArea=e;return}throw new Error("Unregister active drag area first!")};this.unregisterActiveDragArea=function(){this.activeDragArea=null};this.isDragAreaActive=function(){return this.activeDragArea!==null};this.getDragAreas=function(){return this.dragAreas};this.registerDragArea=function(e){if(this.dragAreas.indexOf(e)===-1){this.dragAreas.push(e)}};this.unregisterDragArea=function(e){var t=this.dragAreas.indexOf(e);if(t>-1){this.dragAreas.splice(t,1)}};var t=[];this.notifyAffectedDropAreas=function(e){var i,n,s;var r=this.getAllAffectedDropAreas();for(n=0;n<r.length;n++){var a=r[n];i=false;for(s=0;s<t.length;s++){var o=t[s];if(o===a){i=true;break}}if(!i){a.execInCallback(e,{drag:this.activeDragArea,drop:a});this.activeDragArea.execInCallback(e,{drag:this.activeDragArea,drop:a})}a.execMoveCallback(e,{drag:this.activeDragArea,drop:a});this.activeDragArea.execMoveCallback(e,{drag:this.activeDragArea,drop:a})}for(n=0;n<t.length;n++){var l=t[n];i=false;for(s=0;s<r.length;s++){var d=r[s];if(l===d){i=true;break}}if(!i){l.execOutCallback(e,{drag:this.activeDragArea,drop:l});this.activeDragArea.execOutCallback(e,{drag:this.activeDragArea,drop:l})}}t=r};this.getDropAreas=function(){return this.dropAreas};this.registerDropArea=function(e){if(this.dropAreas.indexOf(e)===-1){this.dropAreas.push(e)}};this.unregisterDropArea=function(e){var t=this.dropAreas.indexOf(e);if(t>-1){this.dropAreas.splice(t,1)}};this.zIndexObjects=null;this.calculateZIndex=function(){if(this.zIndexObjects===null){this.zIndexObjects=jQuery("body").find("*")}};this.getAllAffectedDropAreas=function(){this.calculateZIndex();var e=[];if(this.activeDragArea===null){return e}var t=-1;var i=null;for(var n=0;n<this.dropAreas.length;n++){var s=this.dropAreas[n];var r=s.getIndex(this.zIndexObjects);if(s.isPointWithinDropInfoRegion(this.activeDragArea.getMousePosX(),this.activeDragArea.getMousePosY())&&r>t){i=s;t=r}}if(i===null){return e}e.push(i);return e};this.executeDrop=function(e){var t=this.getAllAffectedDropAreas();var i;for(var n=0;n<t.length;n++){i=t[n];i.execDropCallback(e,{drag:this.activeDragArea,drop:i})}this.activeDragArea.execDropCallback(e,{drag:this.activeDragArea,drop:i});this.cleanup()};this.abort=function(){var e=this.getAllAffectedDropAreas();for(var t=0;t<e.length;t++){var i=e[t];i.execOutCallback(this.activeDragArea)}this.activeDragArea.execOutCallback(i);this.cleanup()};this.cleanup=function(){e.zIndexObjects=null;t=[]}};this.dragHandlerInstance=new this.dragHandler;this.dragAreaBase=function(e,t,i,n,s,r){this.jqObj=e;this.sType=t;this.fMove=i;this.fOut=n;this.fIn=s;this.fDrop=r;this.phxObj=null;this.init=function(){if(this.jqObj instanceof sap.ui.core.Element){this.phxObj=e}else{this.jqObj=e}};this.getJQObject=function(){if(this.phxObj){return this.phxObj.$()}return this.jqObj};this.getPhxObject=function(){return this.phxObj};this.getType=function(){return this.sType};this.execMoveCallback=function(e,t){if(this.fMove){this.fMove(e,t)}};this.execOutCallback=function(e,t){if(this.fOut){this.fOut(t)}};this.execInCallback=function(e,t){if(this.fIn){this.fIn(t)}};this.execDropCallback=function(e,t){if(this.fDrop){this.fDrop(e,t)}};this.isDragArea=function(){return false};this.isDropArea=function(){return false}};this.dragArea=function(e,t,n,s,r,a,o,l,d){i.instance.dragAreaBase.apply(this,[e,t,a,o,l,d]);this.fDown=r;this.fCreate=s;this.oPayload=n;this.jqDragClone=null;this.dragging=false;var h=this;var u=function(e){h.mouseMove(e)};var g=function(e){h.mouseUp(e)};var c=function(){h.abort()};this.isDragArea=function(){return true};this.getPayload=function(){return this.oPayload};this.iXStart=null;this.iYStart=null;this.lastMousePosX=null;this.lastMousePosY=null;this.getMousePosX=function(){return this.lastMousePosX};this.getMousePosY=function(){return this.lastMousePosY};this.getDragCloneX=function(){return this.iXStart};this.getDragCloneY=function(){return this.iYStart};var f=function(e){var t=h.execDownCallback(e,this);if(t===undefined||t===true){i.instance.dragHandlerInstance.registerActiveDragArea(h);h.lastMousePosX=e.pageX;h.lastMousePosY=e.pageY;jQuery(document.body).addClass("zenSplitUserSel");jQuery(document).bind("mousemove",u);jQuery(document).bind("mouseup",g);jQuery(document).bind("keydown",c)}};var p=this.init;this.init=function(){p.apply(this,arguments);var e=this.getPhxObject();if(!e){e=this.getJQObject();e.bind("mousedown",f)}else{e.attachBrowserEvent("mousedown",f)}};var v=function(e){if(h.iXStart===null){h.iXStart=h.getJQObject().offset().left}if(h.iYStart===null){h.iYStart=h.getJQObject().offset().top}if(h.lastMousePosX===null){h.lastMousePosX=e.pageX}if(h.lastMousePosY===null){h.lastMousePosY=e.pageY}};var D=function(e){var t=e.pageX-h.lastMousePosX;var i=e.pageY-h.lastMousePosY;h.lastMousePosX=e.pageX;h.lastMousePosY=e.pageY;h.iXStart=h.iXStart+t;h.iYStart=h.iYStart+i;if(h.getDragClone()){h.getDragClone().css("left",h.getDragCloneX()+"px");h.getDragClone().css("top",h.getDragCloneY()+"px")}};this.updatePositions=function(e){v(e);D(e)};this.mouseMove=function(e){if(this.isDragging()===false){this.setDragClone(h.createDragObject(e));this.setDragging(true)}this.updatePositions(e);i.instance.dragHandlerInstance.notifyAffectedDropAreas(e);this.execMoveCallback(e,this)};this.mouseUp=function(e){this.updatePositions(e);i.instance.dragHandlerInstance.executeDrop(e);this.cleanup()};this.abort=function(){i.instance.dragHandlerInstance.abort();this.cleanup()};this.cleanup=function(){jQuery(document).unbind("mousemove",u);jQuery(document).unbind("mouseup",g);jQuery(document).unbind("keydown",c);i.instance.dragHandlerInstance.unregisterActiveDragArea(this);this.setDragging(false);this.iXStart=null;this.iYStart=null;this.lastMousePosX=null;this.lastMousePosY=null;jQuery(document.body).removeClass("zenSplitUserSel");if(this.getDragClone()){this.getDragClone().remove()}};this.getDragClone=function(){return this.jqDragClone};this.setDragClone=function(e){this.jqDragClone=e};this.createDragObject=function(e){if(this.fCreate){return this.fCreate(e,this)}else{var t=this.getJQObject().clone();t.css("position","absolute");t.css("top",this.getJQObject().offset().top+"px");t.css("left",this.getJQObject().offset().left+"px");t.css("width",this.getJQObject().outerWidth()+"px");t.css("height",this.getJQObject().outerHeight()+"px");t.addClass("zenDragClone");t.appendTo(jQuery(document.body));return t}};this.setDragging=function(e){this.dragging=e};this.isDragging=function(){return this.dragging};this.execDownCallback=function(e,t){if(this.fDown){return this.fDown(e,t)}return null};this.init()};this.dropArea=function(e,t,n,s,r,a,o,l,d,h){i.instance.dragAreaBase.apply(this,arguments);this.iWidth=d;this.iHeight=h;this.iX=o;this.iY=l;this.getX=function(){if(this.iX===null||this.iX===undefined){var e=this.getJQObject();if(e===null||e===undefined||e.length!==null&&e.length!==undefined&&e.length===0){return null}return e.offset().left}return this.iX};this.getY=function(){if(this.iY===null||this.iY===undefined){var e=this.getJQObject();if(e===null||e===undefined||e.length!==null&&e.length!==undefined&&e.length===0){return null}return e.offset().top}return this.iY};this.getWidth=function(){if(this.iWidth===null||this.iWidth===undefined){var e=this.getJQObject();if(e===null||e===undefined||e.length!==null&&e.length!==undefined&&e.length===0){return null}return e.outerWidth()}return this.iWidth};this.getHeight=function(){if(this.iHeight===null||this.iHeight===undefined){var e=this.getJQObject();if(e===null||e===undefined||e.length!==null&&e.length!==undefined&&e.length===0){return null}return e.outerHeight()}return this.iHeight};this.isDropArea=function(){return true};this.getXPlusWidth=function(){var e=this.getX();if(e===null){return null}var t=this.getWidth();if(t===null){return null}return e+t};this.getYPlusHeight=function(){var e=this.getY();if(e===null){return null}var t=this.getHeight();if(t===null){return null}return e+t};this.getIndex=function(e){return e.index(this.getJQObject())};this.isPointWithinDropInfoRegion=function(e,t){var i=e;var n=t;var s=this.getX();var r=this.getY();var a=this.getXPlusWidth();var o=this.getYPlusHeight();if(s===null||r===null||a===null||o===null){return false}if(s<=i&&i<a&&r<=n&&n<o){return true}return false};this.init()};this.aDebugJsonLogger=[];this.aDebugJsonReplay=[];this.loggerDiv=null;this.numberDiv=null;this.jsonArea=null;this.replayDiv=null;this.replayJsonEnder="<ENDOFJSON>";this.replayDivId=null;this.replayIndex=0;this.getStringifiedJson=function(e){return JSON.stringify(e,null,"    ")};this.convertStringToArray=function(e){if(!e){return[]}var t=e.split(this.replayJsonEnder);var i=[];for(var n=0;n<t.length;n++){if(t[n].length>0){i.push(JSON.parse(t[n]))}}return i};this.logJson=function(e,t,i){if(!this.replayDiv||this.replayDiv.css("display")==="none"){this.aDebugJsonLogger.push(e)}this.replayDivId=i;var n=this;var s="100%";if(this.loggerDiv===null){this.loggerDiv=jQuery("<div id='sapZenDebugJsonLogger'/>");if(t){this.loggerDiv.height("15px");this.loggerDiv.width("10px")}else{this.loggerDiv.width(s);this.loggerDiv.height("100%")}this.loggerDiv.css("left","0");this.loggerDiv.css("top","0");this.loggerDiv.css("position","absolute");this.loggerDiv.css("background-color","red");this.loggerDiv.css("overflow","hidden");if(!t){this.loggerDiv.css("display","none")}this.numberDiv=jQuery("<span id='sapZenDebugJsonLoggerNumber'/>");this.numberDiv.css("background-color","white");this.numberDiv.html(this.aDebugJsonLogger.length-1);this.jsonArea=jQuery("<textarea id='sapZenDebugJsonLoggerArea' />");this.jsonArea.width("100%");this.jsonArea.css("height","-webkit-calc(100% - 50px)");this.jsonArea.css("height","calc(100% - 50px)");this.jsonArea.css("height","-moz-calc(100% - 50px)");this.jsonArea.css("font-family","Courier New, monospace");this.jsonArea.css("overflow","auto");this.jsonArea.css("-webkit-overflow-scrolling","touch");this.jsonArea.bind("touchmove",function(e){e.stopPropagation()});this.jsonArea.val(this.getStringifiedJson(this.aDebugJsonLogger[this.aDebugJsonLogger.length-1]));this.numberDiv.bind("click",function(){if(n.loggerDiv.width()===10){n.loggerDiv.width(s);n.loggerDiv.height("100%")}else{n.loggerDiv.width("10px");n.loggerDiv.height("15px")}});var r=jQuery("<button id='sapZenDebugJsonLoggerBtnBackward' height='20px'/>");r.html("<");r.bind("click",function(){var e=parseInt(n.numberDiv.html())-1;if(e>=0){n.numberDiv.html(e);n.jsonArea.val(n.getStringifiedJson(n.aDebugJsonLogger[e]))}});var a=jQuery("<button id='sapZenDebugJsonLoggerBtnForward' height='20px'/>");a.html(">");a.bind("click",function(){var e=parseInt(n.numberDiv.html())+1;if(e<n.aDebugJsonLogger.length){n.numberDiv.html(e);n.jsonArea.val(n.getStringifiedJson(n.aDebugJsonLogger[e]))}});var o=jQuery("<button id='sapZenDebugJsonLoggerBtnSummary' height='20px'/>");o.html("Summary");o.bind("click",function(){var e="";for(var t=0;t<=n.aDebugJsonLogger.length-1;t++){e+="JSON: Z"+t+"\r\n\r\n\r\n";e+=n.getStringifiedJson(n.aDebugJsonLogger[t]);e+="\r\n\r\n\r\n"}n.jsonArea.val(e)});var l=jQuery("<button id='sapZenDebugJsonLoggerBtnReplay' height='20px'/>");l.html("Replay");l.bind("click",function(){var e="";for(var t=0;t<=n.aDebugJsonLogger.length-1;t++){e+=JSON.stringify(n.aDebugJsonLogger[t]);e+=n.replayJsonEnder}n.jsonArea.val(e)});this.numberDiv.appendTo(this.loggerDiv);this.jsonArea.appendTo(this.loggerDiv);r.appendTo(this.loggerDiv);a.appendTo(this.loggerDiv);o.appendTo(this.loggerDiv);l.appendTo(this.loggerDiv);this.loggerDiv.appendTo(jQuery(document.body));this.replayDiv=jQuery("<div id='sapZenDebugJsonLoggerReplayDiv'/>");this.replayDiv.css("right","0");this.replayDiv.css("bottom","4px");this.replayDiv.css("position","absolute");this.replayDiv.css("background-color","red");this.replayDiv.css("display","none");this.replayDiv.width("56px");this.replayDiv.height("25px");this.replayDiv.appendTo(jQuery(document.body));var d=jQuery("<button id='sapZenDebugJsonLoggerBtnReplayBck'/>");d.html("<");d.bind("click",function(){if(n.replayIndex>0){n.replayIndex--;sap.zen.dsh.sapbi_phx(n.replayDivId,{delta:[n.aDebugJsonReplay[0]]});for(var e=1;e<=n.replayIndex;e++){sap.zen.dsh.sapbi_phx(n.replayDivId,n.aDebugJsonReplay[e])}}});var h=jQuery("<button id='sapZenDebugJsonLoggerBtnReplayFwd'/>");h.html(">");h.bind("click",function(){if(n.replayIndex<n.aDebugJsonReplay.length-1){n.replayIndex++;sap.zen.dsh.sapbi_phx(n.replayDivId,n.aDebugJsonReplay[n.replayIndex])}});d.appendTo(this.replayDiv);h.appendTo(this.replayDiv);var u=function(e){if(e.ctrlKey&&e.altKey&&e.which===68){if(n.loggerDiv.css("display")!=="none"){n.loggerDiv.css("display","none")}else{n.loggerDiv.css("display","inline")}}if(e.ctrlKey&&e.altKey&&e.which===80){if(n.replayDiv.css("display")!=="none"){n.replayDiv.css("display","none")}else{n.replayDiv.css("display","inline");n.aDebugJsonReplay=n.convertStringToArray(prompt("Copy JSON",""));n.aDebugJsonLogger=n.aDebugJsonReplay;n.numberDiv.html(0);n.jsonArea.val(n.getStringifiedJson(n.aDebugJsonLogger[0]));sap.zen.dsh.sapbi_phx(n.replayDivId,{delta:[n.aDebugJsonReplay[0]]})}}};jQuery(document).bind("keydown",u)}else{if(parseInt(this.numberDiv.html())===this.aDebugJsonLogger.length-2||this.replayDiv&&this.replayDiv.css("display")!=="none"){var g=this.aDebugJsonLogger.length-1;this.numberDiv.html(g);this.jsonArea.val(this.getStringifiedJson(this.aDebugJsonLogger[g]))}}};var C={};function b(e){if(e.content.control){var t=e.content.control.content;if(t){for(var i=0;i<t.length;i++){var n=t[i];C[n.component.id]=e.id;b(n.component)}}}}function I(e){var t=C[e];if(t){return I(t)+"/"+e}return e}var A=0;this.dispatchCreateControl=function(e,t,i){var n="";if(this.dshPrefix){n=this.dshPrefix}if(e.id===n+"ROOT"||e.id===n+"ROOT_DIALOG"){this.resetDispatcher(e.id)}if(sap.zen.dsh.sapbi_page.m_profileMode&&jQuery.sap.measure.getActive()){if(e.id===n+"ROOT"){C={}}if(!C[e.id]){b(e)}jQuery.sap.measure.start("zen create "+e.id,"dispatch/create/"+I(e.id)+":"+e.type)}if(!t){t=function(){}}var s;if(e.content){s=e.content.control;if(!s){throw new Error("Missing control in component JSON")}}var r=O(s,e,t,i);if(r){this.setComponentIdForControl(e.id,r);r.zenControlType=s&&s.type.toLowerCase()}if(sap.zen.dsh.sapbi_page.m_profileMode&&jQuery.sap.measure.getActive()){jQuery.sap.measure.end("zen create "+e.id)}this.doAfterDispatchingWork();return r};this.doAfterDispatchingWork=function(){var e=this;if(window.eclipse_needsReadyEvents){if(window.eclipse_sendZenUrl){this.sendZenUrlReady()}else{setTimeout(function(){e.sendZenUrlReady()},100)}}};this.bIsReadyEventEnabled=true;this.enableReady=function(e){this.bIsReadyEventEnabled=e};this.sendZenUrlReady=function(){if(window.eclipse_sendZenUrl&&this.bIsReadyEventEnabled){window.eclipse_sendZenUrl("zen://ready")}};this.dispatchCreateNestedControl=function(e,t,i){var s=null;var r=n.getHandlers(e.type.toLowerCase())[0];if(r){s=r.createAndAdd(s,e,null,t,i)}if(s&&r.styleClasses[s.getId()]){s.removeStyleClass(r.styleClasses[s.getId()])}if(s&&!e["cssclass"]){var a=e["cssclass"];if(a){s.addStyleClass(a)}r.styleClasses[s.getId()]=a}return s};function O(e,t,i,s){var r=null;var a=n.getHandlers(e.type.toLowerCase());for(var o in a){if(Object.prototype.hasOwnProperty.call(a,o)){var l=a[o];r=l.createAndAdd(r,e,t,i,s);if(r.addStyleClass){r.addStyleClass("zenControl")}if(!(typeof t["cssclass"]=="undefined"||!l.styleClasses)){if(l.styleClasses[r.getId()]){r.removeStyleClass(l.styleClasses[r.getId()])}var d=t["cssclass"];if(d){r.addStyleClass(d)}l.styleClasses[r.getId()]=d}}}return r}this.dispatchUpdateControl=function(e,t){if(sap.zen.dsh.sapbi_page.m_profileMode&&jQuery.sap.measure.getActive()){jQuery.sap.measure.start("zen update "+e.id,"dispatch/update/"+I(e.id)+":"+e.type)}if(e.content&&!e.content.control&&e.type==="CROSSTAB_COMPONENT"){e.content.control=dummyTable;e.content.control.id=e.content.control.id+A++}var i=this.getRootControlForComponentId(e.id);if(!i){return}var n=i.zenControlType;var s;if(e.content){var r=e.content;s=r&&r.control}var a=this.getHandlers(n);for(var o in a){if(Object.prototype.hasOwnProperty.call(a,o)){var l=a[o];if(!(typeof e["cssclass"]==="undefined"||!l.styleClasses)){if(l.styleClasses[i.getId()]){i.removeStyleClass(l.styleClasses[i.getId()])}var d=e["cssclass"];if(d){i.addStyleClass(d)}l.styleClasses[i.getId()]=d}l.updateComponent(i,s,e,t)}}if(sap.zen.dsh.sapbi_page.m_profileMode&&jQuery.sap.measure.getActive()){jQuery.sap.measure.end("zen update "+e.id)}};this.updateComponentProperties=function(e,t){if(t&&e&&this.isApplicationRoot(e)){if(t.width!=="auto"&&t.height!=="auto"){var i=this.createAbsoluteLayoutInfo(t);e.zenOldLayoutArgs=i;e.$().css(i);var n=this.calcWidthUseOrderOfPriority(i.left,i.right,t.width);var s=this.calcHeightUseOrderOfPriority(i.top,i.bottom,t.height);this.setWidthHeight(e,n,s)}return}this.updateComponentPropertiesBase(e,t)};this.suppressRendering=function(){return o};var S={};this.registerForDeferredRendering=function(e){S[e.getId()]=e};this.isDeferredRendering=function(){return d};this.renderDeferredObjects=function(){d=true;var e=false;for(var t in S){if(Object.prototype.hasOwnProperty.call(S,t)){e=true;var i=S[t];i.invalidate()}}if(e){sap.ui.getCore().applyChanges()}S={};d=false};this.isSingleDelta=function(e){if(l.length!==1){return false}if(!l[0].component){return false}if(l[0].component.content&&l[0].component.content.control&&l[0].component.content.control.content){return false}if(l[0].component.id===e){return true}return false};this.addMessageOverlay=function(e,t,n,s){if(e.zenMessageControl){this.removeMessageOverlay(e)}if(e.showLoadingState){var r=e.getParent().$();var a=jQuery("<div/>");var o=false;a.attr("id",e.getId()+"_loadingState");a.addClass("componentLoadingState");if(jQuery.support.opacity){a.addClass("zenLoadingStateOpacity")}else{a.addClass("zenLoadingStateFilter")}r.append(a);e.zenMessageControl=a;var l="";if(r.width()<=200||r.height()<=90){l=" hideLoadingStateClass";o=true}var d="";if(r.width()<=68||r.height()<=14){d=" hideLoadingStateClassIcon";o=true}var h=jQuery("<div/>");h.attr("id",e.getId()+"_loadingStateBox");h.addClass("componentLoadingStateBox"+l);if(jQuery.support.opacity){h.addClass("zenLoadingStateOpacity75")}else{h.addClass("zenLoadingStateFilter75")}r.append(h);e.zenMessageControlBox=h;if(t!==""){var u=jQuery("<div/>");u.attr("id",e.getId()+"_loadingState_message");u.addClass("componentLoadingStateMessage"+l);u.addClass("componentLoadingStateMessageDT");if(n){u.addClass("componentLoadingStateMessageWithIcon")}u.attr("title",t);u.html(t);r.append(u);e.zenMessageText=u}else{h.addClass("componentLoadingStateBoxNoText")}if(n){var g=jQuery("<div/>");g.attr("id",e.getId()+"_loadingState_icon");g.addClass("componentLoadingStateIconBackground"+d);g.addClass("componentLoadingStateIcon");r.append(g);e.zenMessageIcon=g}else{h.addClass("componentLoadingStateBoxNoIcon")}if(s&&o){var c=e;var f=e;while(c&&/ROOT_absolutelayout$/.exec(c.sId)===null){var p=c.$();if(p){if(p.width()>200&&p.height()>90&&f instanceof sap.ui.core.Control){i.instance.putOnMessageStack(f,e,function(){i.instance.addMessageOverlay(e,t,n,false)});f.onAfterRendering=function(){i.instance.execMessageStack(this)};break}}f=c;c=c.getParent()}}}};this.aMessageStack=[];this.putOnMessageStack=function(e,t,i){if(this.aMessageStack[e.sId]){this.aMessageStack[e.sId].elements[t.sId]=i}else{var n=e.onAfterRendering;var s=[];s[t.sId]=i;this.aMessageStack[e.sId]={oldOnAfterRendering:n,elements:s,exec:function(e){if(this.oldOnAfterRendering){this.oldOnAfterRendering.apply(e,arguments)}for(var t in this.elements){if(Object.prototype.hasOwnProperty.call(this.elements,t)){this.elements[t]()}}e.onAfterRendering=this.oldOnAfterRendering}}}};this.execMessageStack=function(e){var t=this.aMessageStack[e.sId];if(t){t.exec(e);delete this.aMessageStack[e.sId]}};this.deleteMessageStack=function(){for(var e in this.aMessageStack){if(Object.prototype.hasOwnProperty.call(this.aMessageStack,e)){var t=sap.ui.getCore().byId(e);if(t){t.onAfterRendering=this.aMessageStack[e].oldOnAfterRendering}}}this.aMessageStack=[]};this.removeMessageOverlay=function(e){e.zenMessageControl.remove();if(e.zenMessageControlBox){e.zenMessageControlBox.remove()}if(e.zenMessageText){e.zenMessageText.remove()}if(e.zenMessageIcon){e.zenMessageIcon.remove()}};this.updateComponentPropertiesBase=function(e,t){if(!t||!e||this.isApplicationRoot(e)){return}var n=this.createAbsoluteLayoutInfo(t);var s=this.calcWidthUseOrderOfPriority(n.left,n.right,t.width);var r=this.calcHeightUseOrderOfPriority(n.top,n.bottom,t.height);var a=this.getAbsoluteLayoutInfo(e);var o=e.$().width();var l=e.$().height();this.setWidthHeight(e,s,r);this.setAbsoluteLayoutInfo(e,n);this.registerControlForResizeNotificationIfNecessary(e,a,n,o,s,l,r);if(t.message||t.showLoadingState!==undefined){if(!t.showLoadingState&&t.message===undefined){if(e.zenMessageControl){e.showLoadingState=false;this.removeMessageOverlay(e);e.onAfterRendering=e.oldAfterRenderingForDispatching||e.onAfterRendering;delete e.oldAfterRenderingForDispatching;delete e.showLoadingState;delete e.showLoadingStateText;delete e.showLoadingStateIcon;delete e.zenMessageControl}}else{var d=t.showLoadingState||t.message!==undefined;var h="";var u=true;if(t.showLoadingStateText){h=t.showLoadingStateText}else if(t.message&&t.message._v&&sap.zen.designmode){h=t.message._v}else if(t.message&&t.message._v&&!sap.zen.designmode&&t.message.visibleAtRuntime===true){h=t.message._v}if(t.message&&t.message._v){u=false}if(t.showLoadingState){u=true}if(e.showLoadingState!==d||e.showLoadingStateText!==h||e.showLoadingStateIcon!==u){if(!e.zenMessageControl){e.oldAfterRenderingForDispatching=e.onAfterRendering}e.showLoadingState=d;e.showLoadingStateText=h;e.showLoadingStateIcon=u;this.addMessageOverlay(e,e.showLoadingStateText,e.showLoadingStateIcon,true);e.onAfterRendering=function(){if(this.oldAfterRenderingForDispatching){this.oldAfterRenderingForDispatching()}i.instance.addMessageOverlay(this,this.showLoadingStateText,this.showLoadingStateIcon,true)}}}}if(t.visible===false){if(jQuery.support.opacity){e.addStyleClass("zenInvisibleWithOpacity")}else{e.addStyleClass("zenInvisibleWithFilter")}}else if(t.visible===true){if(jQuery.support.opacity){e.removeStyleClass("zenInvisibleWithOpacity")}else{e.removeStyleClass("zenInvisibleWithFilter")}}};this.calcWidthUseOrderOfPriority=function(e,t,i){if(e&&e!=="auto"&&t&&t!=="auto"){return"auto"}return i};this.calcHeightUseOrderOfPriority=function(e,t,i){if(e&&e!=="auto"&&t&&t!=="auto"){return"auto"}return i};var x={};this.getTransferControl=function(e){var t=this.getRootControlForComponentId(e);delete x[t.getId()];return t};this.addTransferControl=function(e,t){t(e);x[e.getId()]=e};function w(){for(var e in x){if(Object.prototype.hasOwnProperty.call(x,e)){var t=x[e];n.dispatchRemove(t)}}x={}}this.dispatchRemove=function(e){var t=e.zenControlType;var i=this.getHandlers(t);for(var n=i.length-1;n>=0;n--){var s=i[n];if(s.styleClasses&&s.styleClasses[e.getId()]){delete s.styleClasses[e.getId()]}if(s.remove){s.remove(e)}}var r=this.getComponentIdForControl(e);if(r){this.removeComponentId(r)}};this.cleanChildrenControls=function(e){var t={},i;for(i in r){if(Object.prototype.hasOwnProperty.call(r,i)&&r[i]){if(r[i].getId().indexOf(e)>-1&&r[i].getId()!==e){r[i].destroy();r[i]=null;t[i]=i}}}for(i in t){if(Object.prototype.hasOwnProperty.call(r,i)&&r[i]){removeComponentId(i)}}};this.cleanAllControls=function(){r={}};this.setAbsoluteLayoutInfo=function(e,t){var i=e.getParent();var n=this.getAbsoluteLayoutInfo(e);if(i.updatePosition){t=jQuery.extend(jQuery.extend({},n),t);i.updatePosition(t);e.zenOldLayoutArgs=t}return t};this.getAbsoluteLayoutInfo=function(e){return e.zenOldLayoutArgs};this.createAbsoluteLayoutInfo=function(e){var t=e.leftmargin;var i=e.rightmargin;var n=e.topmargin;var s=e.bottommargin;var r={};if(n){if(n==="auto"){r.top=""}else{r.top=n+"px"}}if(t){if(t==="auto"){r.left=""}else{r.left=t+"px"}}if(i){if(i==="auto"){r.right=""}else{r.right=i+"px"}}if(s){if(s==="auto"){r.bottom=""}else{r.bottom=s+"px"}}return r};this.insertIntoAbsoluteLayoutContainer=function(e,t,i){e.insertContent(t,i);if(t.zenMessageControl){this.addMessageOverlay(t,t.showLoadingStateText,t.showLoadingStateIcon,true)}};this.getValue=function(e,t){if(e[t]){return e[t]["_v"]}return null};this.isApplicationRoot=function(e){var t=e.getId();if(t==="ROOT_grid"||/ROOT_absolutelayout$/.exec(t)!==null){return true}var i=e.getParent();if(i){return false}return true};this.setWidthHeight=function(e,t,i){if(t&&e.setWidth){if(t!=="auto"){if(t.indexOf&&t.indexOf("%")>-1){e.setWidth(t)}else{e.setWidth(t+"px")}}else{e.setWidth("auto")}}if(i&&e.setHeight){if(i!=="auto"){if(i.indexOf&&i.indexOf("%")>-1){e.setHeight(i)}else{e.setHeight(i+"px")}}else{e.setHeight("auto")}}};this.setComponentIdForControl=function(e,t){r[e]=t};this.getComponentIds=function(){var e=[];for(var t in r){if(Object.prototype.hasOwnProperty.call(r,t)){e.push(t)}}return e};this.removeComponentId=function(e){delete r[e]};this.getComponentIdForControlId=function(e){for(var t in r){if(Object.prototype.hasOwnProperty.call(r,t)&&r[t].getId()===e){return t}}return null};this.getControlForId=function(e){for(var t in r){if(Object.prototype.hasOwnProperty.call(r,t)&&r[t].getId()===e){return r[t]}}return null};this.getComponentIdForControl=function(e){var t=e.getId();return this.getComponentIdForControlId(t)};this.getRootControlForComponentId=function(e){if(r[e]){if(r[e].bIsDestroyed===true){r[e]=null}}return r[e]};this.getGridInfo=function(e){var t={};t.noOfRows=e.getRows().length;t.noOfCols=e.getRows()[0].getCells().length;t.heights=[];t.widths=e.aWidths;var i=e.getRows();for(var n=0;n<i.length;n++){var s=i[n];var r=s.getHeight();t.heights[n]=r}return t};this.findControlById=function(e,t){var i=null;var s=function(e,r,a,o){if(e){if(e.getId&&e.getId()===t){i={control:e,row:r,col:a,contentIndex:o}}var l=n.getHandlers(e.zenControlType);if(l[0].applyForChildren){l[0].applyForChildren(e,s)}}};this.getHandlers(e.zenControlType)[0].applyForChildren(e,s);return i};this.createDelayedResizeHandler=function(e,t,i,n,s){var r=0;var a=0;var o=null;var l=function(l){o=l;if(r===0){if(e){e(l)}a=window.setInterval(function(){if(t){t(o)}},s)}else{window.clearTimeout(r)}r=window.setTimeout(function(){r=0;window.clearInterval(a);if(i){i(o)}o=null},n)};return l};this.registerResizeHandler=function(e,t){a[e]={handler:t,obj:e}};this.deregisterResizeHandler=function(e){delete a[e]};this.registerGlobalHandlers=function(){function e(e,t){for(var i in a){if(Object.prototype.hasOwnProperty.call(a,i)){var n=a[i].handler;var s=n[e];if(s){s.call(n,t)}}}}jQuery&&jQuery(window).bind("resize",this.createDelayedResizeHandler(function(t){e("beginResize",t)},function(t){e("updateResize",t)},function(t){e("endResize",t)},300,500))};this.getLogicalParent=function(e){return e.getParent().getParent()};this.disableContextMenu=function(){jQuery(document).bind("contextmenu",function(e){return e.ctrlKey})};this.prepareCommand=function(e,t,i){i=(i+"").replace(/\\/g,"\\\\");i=i.replace(/'/g,"\\'");i=i.replace(/\r/g,"");i=i.replace(/\n/g,"");if(typeof sap.zen.dsh.DSH_deployment!=="undefined"){i=i.replace(/\\/g,"\\\\");i=i.replace(/'/g,"\\'")}i=i.replace(/[$]*/g,"$&$&");return e.replace(t,i)};this.dispatchAdvancedPropertyCall=function(e,t,i,n,s,r){var a=this.getRootControlForComponentId(e);if(a){var o=a.zenControlType;var l=this.getHandlers(o);for(var d in l){if(Object.prototype.hasOwnProperty.call(l,d)){var h=l[d];if(h.advancedPropertyCall){var u=h.advancedPropertyCall(a,t,i,n,s,r);if(u){return u}}}}}};this.pauseDispatching=function(){h++};this.resumeDispatching=function(){if(h>0){h--;if(h===0){var e=u;u=null;if(e)e()}}};this.isPaused=function(t){if(h>0){if(u!=null){e.error("Undispatched Delayed Data found "+u)}u=t;return true}return false};this.isDispatching=function(){return g};this.resetDispatcher=function(e){var i="",n;if(this.dshPrefix){i=this.dshPrefix}if(e===i+"ROOT"){n=this.getRootControlForComponentId(i+"ROOT");if(n){this.dispatchRemove(n)}}if(t){t.que.instance.stopScheduling();n=this.getRootControlForComponentId(i+"ROOT_DIALOG");if(n){this.dispatchRemove(n)}t.que.instance.continueScheduling()}if(e===i+"ROOT"){this.reset()}};function M(){if(sap.zen.dsh.sapbi_page.m_profileMode&&jQuery.sap.measure.getActive()){var t=jQuery.sap.measure.getAllMeasurements();var i=sap.ui.getCore().byId("RenderingStatisticsTree");var n=null;var s="Step"+sapbi_statisticsStepCounter++;var r;if(i){n=i.getModel().getData();n["root"][s]={};n["root"][s]["text"]=s}for(r=0;r<t.length;r++){var a=t[r];if(a&&a.id.substr(0,3)==="zen"){if(n){var o=a.info.split(":");var l=o[0].split("/");var d=n["root"][s];var h="";for(var u=0;u<l.length;u++){h=l[u];if(!d[h]){d[h]={};d[h]["text"]=h}d=d[h]}d["text"]=h+": "+a.duration+" ms"}jQuery.sap.measure.remove(a.id)}}if(n){i.getModel().setData(n);var g=sap.ui.getCore().byId("ZEN_PROFILING");g.setMinWidth("50%");g.setMinHeight("50%");var c=jQuery(document.getElementById(g.getId()));var f=c.parent();var p=f.css("top");if(p&&p.charAt(0)==="-"){g.close();setTimeout(function(){g.open()},500)}else{g.open()}}if(sapbi_showUI5Measures){e.info("Other: ");for(r=0;r<t.length;r++){a=t[r];if(a&&a.id.substr(0,3)!=="zen"){jQuery.sap.measure.remove(a.id)}}}}}this.dispatch=function(e,t){g=true;try{if(e.delta){this.dispatchDelta(e.delta)}else if(e.component){this.dispatchCreateControl(e.component,t)}else if(e.control){this.dispatchCreateControl(e.control,t)}M();this.loadCustomCss();if(sap.zen.designmode){if(window.eclipse_sendZenUrl){sap.zen.designmode.DecoratorManager.instance.sendZenUrl("ready")}else{setTimeout(function(){sap.zen.designmode.DecoratorManager.instance.sendZenUrl("ready")},100)}sap.zen.designmode.DecoratorManager.instance.afterDispatching()}}finally{g=false}};this.sdkDataSources={};this.sdkDsFindInstances=function(e){var t=this.sdkDataSources[e];if(!t){t={};this.sdkDataSources[e]=t}return t};this.sdkDsFindEntryForComponent=function(e,t){var i=this.sdkDsFindInstances(t);var n=i[e];if(!n){n={};i[e]=n}return n};this.sdkDsFindEntryFor=function(e,t,i){var n=this.sdkDsFindEntryForComponent(e,i);var s=n[t];if(!s){s={data:{dimensions:[]}};n[t]=s}return s};this.sdkDsRender=function(e,t,n,s,r){var a=this.sdkDsFindEntryFor(e,t,n);a.selection=s;a.options=r;var o=i.instance.getRootControlForComponentId(n);if(o){var l=o.widget;l.updateDataInto(s,r,a.data)}return a.data};this.sdkDsRenderMetadata=function(e,t,i,n,s){return this.sdkDsRender(e,t,i,n,s)};this.sdkDsCallFunction=function(e,t,i,n,s){var r=this.getRootControlForComponentId(e);if(r){var a=r.widget;var o=a[t].call(a,i,n,s);a.lastCallbackResult=function(e){if(e===undefined&&o){return JSON.stringify(o)}return null};a.firePropertiesChanged(["lastCallbackResult"])}};this.sdkDsUnregister=function(e,t){var i=this.sdkDsFindInstances(t);delete i[e]};this.sdkDsDelete=function(e){delete this.sdkDataSources[e]};this.changeTheme=function(e){var t=this;var i=sap.ui.getCore();var n=i.getConfiguration().getTheme();if(n!==e){var s=function(){t.resumeDispatching();i.detachThemeChanged(s)};this.pauseDispatching();i.attachThemeChanged(s);i.applyTheme(e)}};this.closeContextMenu=function(){if(m){m.close()}};this.registerContextMenu=function(e){m=e};this.cancelDragDropOperation=function(){var e;if(p){this.setDragDropCanceled(true);jQuery.each(f,function(t,i){e=n.getControlForId(t);if(e){setTimeout(function(){i.call(e)},0)}})}};this.registerEscKeyHandler=function(){if(!v){jQuery(document).on("keydown",function(e){if(e.which===27){n.cancelDragDropOperation()}});v=true}};this.setDragDropCanceled=function(e){if(p){p.bDragOperationCanceled=e}};this.isDragDropCanceled=function(){if(p){return p.bDragOperationCanceled}return true};this.registerDragDropCancelHandler=function(e,t){this.registerEscKeyHandler();f[e]=t};this.deRegisterDragDropCancelHandler=function(e){delete f[e]};this.registerUnhandledDropHandler=function(e,t){c[e]=t};this.deRegisterUnhandledDropHandler=function(e){delete UnhandledDropHandlerRegistry[e]};this.setDragDropPayload=function(e){p=e};this.getDragDropPayload=function(){return p};this.onUnhandledDrop=function(e,t){if(p){var i=c[p.sComponentId];if(i){var s=n.getControlForId(p.sComponentId);if(s){i.call(s,e,t,p)}}}};this.setInterComponentDragDropEnabled=function(e){D=e};this.isInterComponentDragDropEnabled=function(){return D};this.createDragDropPayload=function(e){p={sComponentId:e,oDragDropInfo:{sDimensionName:"",sAttributeName:"",sAxisName:"",bIsMeasureStructure:false,bIsMemberDrag:false,iMemberRow:-1,iMemberCol:-1},oInterComponentAcceptStatus:{},bDragOperationCanceled:false};return p};this.setDropAccepted=function(e,t){if(p){p.oInterComponentAcceptStatus[e]=t}};this.isDropAcceptedForDroppable=function(e){if(p){return p.oInterComponentAcceptStatus[e]}return false};this.mainMode=false;this.setMainMode=function(e){this.mainMode=e};this.isMainMode=function(){return this.mainMode};this.bCompactMode=false;this.setCompactMode=function(e){if(!jQuery(document.body).hasClass("sapUiSizeCozy")){if(e){jQuery(document.body).addClass("sapUiSizeCompact")}else{jQuery(document.body).removeClass("sapUiSizeCompact")}}this.bCompactMode=e};this.isCompactMode=function(){return this.bCompactMode};this.sCustomCssUrl=null;this.bCustomCssLoaded=false;this.registerCustomCSS=function(e){this.sCustomCssUrl=e};this.customCssExists=function(){return this.sCustomCssUrl!==null&&this.sCustomCssUrl!==""};this.loadCustomCss=function(){if(!this.bCustomCssLoaded&&this.customCssExists()){sap.zen.dsh.sapbi_page.loadCssInclude(this.sCustomCssUrl);this.bCustomCssLoaded=true}}};i.instance=new i;i.instance.registerGlobalHandlers();return i.instance});
//# sourceMappingURL=dispatcher.js.map