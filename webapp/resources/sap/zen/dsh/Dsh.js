/*!
 * SAPUI5
  (c) Copyright 2009-2021 SAP SE. All rights reserved
 */
sap.ui.define("sap/zen/dsh/Dsh",["jquery.sap.global","sap/zen/dsh/library","sap/ui/thirdparty/URI","sap/ui/core/Control","sap/zen/dsh/DshRenderer","sap/viz/library"],function(jQuery,e,t,a,i){"use strict";var s=a.extend("sap.zen.dsh.Dsh",{metadata:{library:"sap.zen.dsh",properties:{dshAppName:{type:"string",group:"Misc",defaultValue:"0ANALYSIS"},repoPath:{type:"string",group:"Misc",defaultValue:null},width:{type:"sap.ui.core.CSSSize",group:"Misc",defaultValue:null},height:{type:"sap.ui.core.CSSSize",group:"Misc",defaultValue:null},deployment:{type:"string",group:"Misc",defaultValue:"bw"},protocol:{type:"string",group:"Misc",defaultValue:null},client:{type:"string",group:"Misc",defaultValue:null},language:{type:"string",group:"Misc",defaultValue:null},semanticMappings:{type:"object",group:"Misc",defaultValue:null},appComponent:{type:"object",group:"Misc",defaultValue:null},deferCreation:{type:"boolean",group:"Misc",defaultValue:false},systemAlias:{type:"string",group:"Misc",defaultValue:null}}},renderer:i});sap.zen.dsh.DSH_deployment=true;var r=r||{};sap.zen.dsh.sapbi_page=sap.zen.dsh.sapbi_page||{};sap.zen.dsh.sapbi_page.getParameter=sap.zen.dsh.sapbi_page.getParameter||function(){return""};sap.zen.dsh.sapbi_page.staticMimeUrlPrefix=sap.ui.resource("sap.zen.dsh","rt/");sap.zen.dsh.doReplaceDots=true;s.prototype.init=function(){this.initial=true;this.rendered=false;this.parameters={};this.dshBaseAppUrlBW="/sap/bw/Mime";this.dshBaseUrl=t(sap.ui.resource("sap.zen.dsh","widgets/")).absoluteTo(document.baseURI).toString()};s.prototype.createPage=function(){this.doIt()};s.prototype.doInit=function(){if(this.getDshAppName()==="0ANALYSIS"||this.getDshAppName()==="0ANALYTIC_GRID"){this.setRepoPath(t(sap.ui.resource("sap.zen.dsh","applications/")).absoluteTo(document.baseURI).toString())}if(this.getRepoPath()!==""){this.repositoryUrl=this.getRepoPath()}if(!this.initial){return}this.initial=false;var e=this;if(!this.getDeferCreation()){setTimeout(function(){e.doIt()},0)}};s.prototype.doIt=function(){this.doInit();sap.zen.dsh.scriptLoaded=true;var e=this;{var a=e.getLanguage();if(!a){var i=sap.ui.getCore().getConfiguration();a=i.getSAPLogonLanguage();if(!a){a=window.navigator.userLanguage||window.navigator.language}}var s=e.getClient();if(!s&&window.document.cookie){var r=/(?:sap-usercontext=)*sap-client=(\d{3})/.exec(window.document.cookie);if(r&&r[1]){s=r[1]}}var o=e.getDeployment();if(!o||o.length===0){o="bw"}var n=e.getDshAppName();var p=this.getStartupParameters();if(p){for(var u in p){if(this.isDshParameter(u)){if(!this.doesParameterExist(u)){this.addParameter(u,p[u][0])}}}}var g=sap.firefly.XHashMapByString.create();for(var h in this.parameters){g.put(h,this.parameters[h])}var l=new sap.zen.DesignStudio;l.setHost(window.document.location.hostname);l.setPort(window.document.location.port);l.setProtocol(window.document.location.protocol.split(":")[0]);l.setClient(s);l.setLanguage(a);if(this.repositoryUrl){l.setRepositoryUrl(this.repositoryUrl)}l.setApplicationPath(this.dshBaseAppUrlBW);l.setApplicationName(n);l.setUrlParameter(g);l.setSdkLoaderPath("");l.setHanaMode(true);l.setDshControlId(e.getId());l.setStaticMimesRootPath(this.dshBaseUrl);l.setSystemAlias(this.getSystemAlias());if(o==="bw2"||o==="bw"){l.setNewBW(true)}l.setRightToLeft(sap.ui.getCore().getConfiguration().getRTL());this._page=l.createPage();if(this.rendered){this._page.handleAfterRenderingOfRootControl()}if(!sap.zen.dsh.wnd){sap.zen.dsh.wnd={}}sap.zen.dsh.wnd[this._page.getPageIdForScripting()]=this._page;sap.zen.dsh.sapbi_page=sap.zen.dsh.sapbi_page||{};sap.zen.dsh.sapbi_page.staticMimeUrlPrefix=this.dshBaseUrl;sap.zen.dsh.sapbi_page.getParameter=function(){return""};sap.zen.dsh.sapbi_MIMES_PIXEL="";if(this.getAppComponent()){sap.zen.dsh.sapbi_page.appComponent=this.getAppComponent()}var d=this._page.getApplicationPropertiesComponent().getCustomCSSName();if(d){var f=window.document.createElement("link");f.setAttribute("type","text/css");f.setAttribute("rel","stylesheet");f.setAttribute("href",t(this._page.getRelativePathToApp()+d).normalize().toString());window.document.getElementsByTagName("head")[0].appendChild(f)}}};s.prototype.onAfterRendering=function(){this.doInit();if(this._page){this._page.handleAfterRenderingOfRootControl()}this.rendered=true};s.prototype.logoff=function(){if(this._page&&!this.loggedOff){this.loggedOff=true;sap.zen.dsh.buddhaHasSendLock++;this._page.exec("APPLICATION.logoff();")}};s.prototype.exit=function(){this.logoff();var e=sap.ui.getCore().byId(this.sId+"ROOT_absolutelayout");if(e){e.destroy()}var t=sap.ui.getCore().byId(this.sId+"VARIABLEDIALOG_MESSAGE_messageview1");if(t){t.destroy()}};s.prototype.addParameter=function(e,t){this.parameters[e]=t};s.prototype.doesParameterExist=function(e){if(this.parameters[e]){return true}return false};s.prototype.getStartupParameters=function(){if(this.getAppComponent()){if(this.getAppComponent().getComponentData()){return this.getAppComponent().getComponentData().startupParameters}}return null};s.prototype.isDshParameter=function(e){if(e==="XTITLE"||e==="XQUERY"||e==="XDISPLAY"||e==="XCHART_TYPE"||e==="XPROMPT"||e==="XVISIBLEPROMPTS"||e==="XDATALIMIT_ROWS"||e==="XDATALIMIT_COLS"||e=="XEXCEL_VERSION"){return true}return false};s.prototype.executeScript=function(e){this.page.exec(e)};s.prototype.getDataSource=function(e){return this.page.getDataSource(e)};s.prototype.getComponent=function(e){return this.page.getComponent(e)};s.prototype.getPage=function(){return this.page};s.prototype.getMapping=function(e){if(this.getSemanticMappings()&&this.getSemanticMappings()[e]){return this.getSemanticMappings()[e]}return e};s.prototype.initializeAppStateData=function(e,t){function a(e,t,a){if(Array.isArray(e)){for(var i in e){if(!Object.prototype.hasOwnProperty.call(t,e[i])){t[e[i]]=a}}}else{if(!Object.prototype.hasOwnProperty.call(t,e)){t[e]=a}}}t=t||{};for(var i=0;i<Object.keys(t).length;++i){var s=Object.keys(t)[i];if(this.isDshParameter(s)){delete t[s]}}if(e&&e.customData&&e.customData.bookmarkedAppState){this.addParameter("NAV_INITIAL_STATE",e.customData.bookmarkedAppState)}if(e&&e.selectionVariant){var r=e.selectionVariant;if(typeof r!=="object"&&typeof e.oSelectionVariant==="object"&&e.oSelectionVariant.toJSONObject){r=e.oSelectionVariant.toJSONObject()}var o=r.Parameters;var n=r.SelectOptions;if(o){for(var p=0;p<o.length;p++){var u=o[p];if(this.isDshParameter(u.PropertyName)){continue}t[u.PropertyName]=u.PropertyValue}}if(n){for(i=0;i<n.length;++i){var g=n[i];if(this.isDshParameter(g.PropertyName)){continue}var h=g.Ranges;var l=[];for(var d=0;d<h.length;++d){var f;var c=h[d];if(["EQ","BT","GE","LE","GT","LT"].indexOf(c.Option)==-1){continue}if(c.Sign==="I"&&c.Option==="EQ"){f=c.Low}else{f={exclude:c.Sign==="E"||undefined,operation:c.Option,from:c.Low,to:c.High}}l.push(f)}if(l.length>0){a(this.getMapping(g.PropertyName),t,l)}}}}if(!jQuery.isEmptyObject(t)){this.addParameter("NAV_PARAMS",JSON.stringify(t))}};s.prototype.initializeAppState=function(e,t){if(e){var a={};if(e.getData&&typeof e.getData==="function"){a=e.getData()}this.initializeAppStateData(a,t)}};return s});
//# sourceMappingURL=Dsh.js.map