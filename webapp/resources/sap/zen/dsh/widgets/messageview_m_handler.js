/*
 * SAPUI5
  (c) Copyright 2009-2021 SAP SE. All rights reserved
 */
sap.ui.define(["jquery.sap.global","sap/zen/dsh/utils/BaseHandler","sap/ui/core/IconPool"],function(jQuery,e){sap.zen.MessageViewHandler=function(){e.apply(this,arguments);sap.zen.MessageViewHandler.tTexts={};sap.zen.MessageViewHandler.info="INFO";sap.zen.MessageViewHandler.warning="WARNING";sap.zen.MessageViewHandler.error="ERROR";var t=e.dispatcher.dshPrefix+"MESSAGE_messageview1";var i=e.dispatcher.dshPrefix+"FOOTERBAR_footerbar";var n=e.dispatcher.dshPrefix+"PANEL_BODY_panel1";this.tMessageViews={};this.oldMessagesAfterVarScreen=[];sap.zen.MessageViewHandler.setVariableScreen=function(e){if(e){if(s.oMessageView){var t=sap.ui.getCore().byId(s.oMessageView.getMessageButton().getId());if(t){this.oldMessagesAfterVarScreen=t.oMsgPopover.getModel().getData()}}}s.varScreenMode=e};sap.zen.MessageViewHandler.createMessage=function(e,t,i,n){if(s.oMessageView){s.oMessageView.createMessage(e,t,i,n)}};sap.zen.MessageViewHandler.logMessage=function(e,t,i){if(s.oMessageView){s.oMessageView.logMessage(e,t,i)}};sap.zen.MessageViewHandler.clearMessages=function(){if(s.oMessageView){s.oMessageView.clearMessages()}};this.createAndAdd=function(s,t,i,n,a){var r=this.create(s,t,i);if(n){n(r,a,i)}e.dispatcher.updateComponentProperties(r,i,n);return r};this.create=function(e,s){this.sLogCommand=s.log_command;var t=s["id"];this.oMessageView=new sap.zen.MessageViewHandler.MessageView(t,null,r,a);this.tMessageViews[this.oMessageView.getId()]=this.oMessageView;var i=this.oMessageView.getMessageButton();this.init(i,s);return i};this.update=function(e,s){if(s){this.init(e,s)}};this.init=function(e,s){var t=this.oMessageView;var i=s["id"];if(t.getId()!==i){t=this.tMessageViews[i]}if(s.texts){sap.zen.MessageViewHandler.tTexts=s.texts}t.init(s.messages)};this.updateFooterBar=function(e){if(t!==e.getId()){return}var s=sap.ui.getCore().byId(i);var a=sap.ui.getCore().byId(n);if(s&&a){var r=e.getVisible();s.setHeight(r?"40px":"0px");var o=a.getPositions()[0];var g=o.getBottom();if(r&&g!=="40px"){o.setBottom("40px");a.invalidate()}if(!r&&g!=="0px"){o.setBottom("0px");a.invalidate()}}};function a(){if(this.oMessageView.onAfterRenderingOriginal){this.oMessageView.onAfterRenderingOriginal()}if(!s.varScreenMode){var e=jQuery("#sap-ui-blocklayer-popup");var t=null;if(e&&e.length>0&&e.css("visibility")==="visible"&&e.outerWidth()>0&&e.outerHeight()>0){var i=e.css("z-index");if(i&&i.length>0){var n=parseInt(i,10);t.css("z-index",""+(n+1))}}else{t.css("z-index","auto")}}}function r(e){var t=e.getMessageButton();s.updateFooterBar(t)}window._handleMessageView_onAfterInitMessages=function(){if(sap.zen.MessageViewHandler.oldMessagesAfterVarScreen&&!s.varScreenMode){var e=sap.zen.MessageViewHandler.oldMessagesAfterVarScreen.slice();delete sap.zen.MessageViewHandler.oldMessagesAfterVarScreen;return e}return null};var o=this.remove;this.remove=function(e){if(e.oMsgPopover){e.oMsgPopover.destroy()}o.apply(this,arguments)};this.getHighestMessageLevel=function(e){if(s.oMessageView){s.oMessageView.getHighestMessageLevel(e)}};this.getType=function(){return"messageview"};sap.zen.MessageViewHandler.MessageView=function(s,t,i,n,a){var r=this;this.id=s;this.oMsgBtn=null;this.logCommand;this.getId=function(){return this.id};this.getMessageButton=function(){return this.oMsgBtn};this.onAfterUpdate=function(){};this.onAfterRendering=function(){if(!r.oMsgBtn.oOriginalFuncOnAfterRendering){r.oMsgBtn.oOriginalFuncOnAfterRendering()}};this.onAfterInitMessages=function(){};function o(e,s,t,i,n){var a=sap.ui.getCore().byId(e);if(a){a.destroy()}var o=new sap.m.Button({id:e,icon:sap.ui.core.IconPool.getIconURI("message-popup"),text:"",type:sap.m.ButtonType.Emphasized,press:function(){this.oMsgPopover.toggle(this)}});var d=new sap.m.MessagePopoverItem({type:"{type}",title:"{title}",description:"{description}"});var M=new sap.m.Button({icon:"sap-icon://delete",press:function(){o.oMsgPopover.getModel().setData([]);o.setVisible(false);r.onAfterUpdate(r)}});o.oMsgPopover=new sap.m.MessagePopover({items:{path:"/",template:d},headerButton:M});g(t);f(o,i);l(n);r.oMsgBtn=o;p(o,s);return o}function g(e){if(!r.onAfterUpdateOriginal){r.onAfterUpdateOriginal=r.onAfterUpdate}if(e){r.onAfterUpdate=e}}function f(e,s){if(!r.onAfterRenderingOriginal){r.onAfterRenderingOriginal=r.onAfterRendering}if(s){r.onAfterRendering=s}if(!e.oOriginalFuncOnAfterRendering){e.oOriginalFuncOnAfterRendering=e.onAfterRendering}e.onAfterRendering=r.onAfterRenderingOriginal}function l(e){if(!r.onAfterInitMessagesOriginal){r.onAfterInitMessagesOriginal=r.onAfterInitMessages}if(e){r.onAfterInitMessages=e}}this.init=function(e){p(this.oMsgBtn,e)};function p(e,s){var t,i=[];if(e.oMsgPopover){t=e.oMsgPopover.getModel();if(t){var n=t.getData();if(n){i=n;i=[]}}}var a=M(i,s);if(e.oMsgPopover.getModel()){e.oMsgPopover.getModel().setData(a)}else{t=new sap.ui.model.json.JSONModel;t.setData(a);e.oMsgPopover.setModel(t)}d(e)}this.update=function(){d(this.oMsgBtn)};function d(e){var s=e.oMsgPopover.getModel().getData()?e.oMsgPopover.getModel().getData().length:0;var t=sap.zen.MessageViewHandler.tTexts&&sap.zen.MessageViewHandler.tTexts.notification_header?s+" "+sap.zen.MessageViewHandler.tTexts.notification_header:s+"";e.setText(s);e.setTooltip(t);e.setVisible(s>0);r.onAfterUpdate(r)}function M(e,s){var t=[];var i=0;var n={};if(e&&e.length>0){for(i=0;i<e.length;i++){var a=e[i].message;n={};if(a.level==="ERROR"){n.type="Error"}else if(a.level==="WARNING"){n.type="Warning"}else{n.type="Information"}n.title=a.short_text;n.description=a.long_text;t.push(n)}}if(s&&s.length>0){for(i=0;i<s.length;i++){var o=s[i].message;n={};if(o.level==="ERROR"){n.type="Error"}else if(o.level==="WARNING"){n.type="Warning"}else{n.type="Information"}n.title=o.short_text;n.description=o.long_text;t.push(n)}}else{if(u()){if(t){return t}else{return[]}}var g=false;var f=r.onAfterInitMessages(r,g);if(g){return f}return[]}return t}function u(){if(typeof sap.zen.dsh.DSH_deployment!=="undefined"){return true}else{return false}}this.getHighestMessageLevel=function(e){var s=e.getData();var t=false;for(var i=0;i<s.length;i++){var n=s[i];if(n.type==="Error"){return"message-error"}else if(n.type==="Warning"){t=true}}if(t){return"message-warning"}return"message-information"};this.createMessage=function(e,s,t,i){if(!this.oMsgBtn){return}var n={};if(e==="ERROR"){n.type="Error"}else if(e==="WARNING"){n.type="Warning"}else{n.type="Information"}n.title=s;n.description=t;var a;if(this.oMsgBtn.oMsgPopover&&this.oMsgBtn.oMsgPopover.getModel()){a=this.oMsgBtn.oMsgPopover.getModel();a.setData([n])}else{a=new sap.ui.model.json.JSONModel;a.setData([n]);a.oMsgPopover.setModel(a)}this.update();if(i){this.logMessage(e,s,t)}};this.logMessage=function(s,t,i){if(this.logCommand){var n=this.logCommand;n=e.dispatcher.prepareCommand(n,"__LEVEL__",s);n=e.dispatcher.prepareCommand(n,"__SHORTTEXT__",t);n=e.dispatcher.prepareCommand(n,"__LONGTEXT__",i);var a=new Function(n);a()}};this.clearMessages=function(){if(!this.oMsgBtn){return}if(this.oMsgBtn.oMsgPopover&&this.oMsgBtn.oMsgPopover.getModel()){var e=this.oMsgBtn.oMsgPopover.getModel();e.setData([]);this.update()}};this.oMsgBtn=o(s,t,i,n,a)}};var s=new sap.zen.MessageViewHandler;e.dispatcher.addHandlers(s.getType(),s);return s});
//# sourceMappingURL=messageview_m_handler.js.map