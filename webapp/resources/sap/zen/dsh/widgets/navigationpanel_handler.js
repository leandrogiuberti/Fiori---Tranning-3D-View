/*
 * SAPUI5
  (c) Copyright 2009-2021 SAP SE. All rights reserved
 */
sap.ui.define(["jquery.sap.global","sap/base/Log","sap/ui/model/json/JSONModel","sap/zen/commons/HAlign","sap/zen/dsh/utils/BaseHandler","sap/zen/dsh/utils/jq"],function(jQuery,e,t,r,n){"use strict";var a=function(){var a=this;var i;var o;n.apply(this,arguments);this.create=function(e,r){var i,o=r.property.navigationpanelmode;var s="M";n.dispatcher.registerUnhandledDropHandler(r.id,this.onUnhandledDrop);n.dispatcher.registerDragDropCancelHandler(r.id,this.onEscKeyPressed);var d=new t;d.setSizeLimit(Number.MAX_VALUE);if(!r.navigationpanel){r.navigationpanel={}}if(!r.navigationpanel.apply){r.navigationpanel.apply={}}if(!r.navigationpanel.measures){r.navigationpanel.measures={}}r.navigationpanel.apply.ready=false;r.navigationpanel.measures.expanded=false;this.rewriteMeasuresPosition(r);d.setData(r);if(e){i=e;i.destroyTop();i.destroyCenter()}else{i=this.createMainPanel(r["id"]);var l=i.exit;i.exit=function(){if(l){l.apply(i,arguments)}new Function(d.getProperty("/command/destroyfiltercomponent"))()};if(!r.visible&&!this.isDesignModeD4LIncluded()){i.addStyleClass("zenHideFilterPanel")}}if(o!=="LIST_ONLY"){i.oHorizontalSplitter={};i.oHorizontalSplitter=this.createSplitter({splitterOrientation:"Vertical",splitterPosition:"50%",minSizeFirstPane:50,minSizeSecondPane:50,showScrollBars:false,width:"100%",height:"100%"})}i.setModel(d);var c=this.createRowRepeater();c.bindAggregation(this.getRowRepeaterAggregation(),{path:"/characteristics",factory:a.getRowFactory(i,"/characteristic/name","/characteristic/text",function(e){return e},true)});var p=this.getRowFactory(i,"/entry/name","/entry/name",function(e){var t;var r=d.getProperty("/characteristics"),n;for(t=0;t<r.length;t++){n=r[t].characteristic;if(n.name===e){return n.text}}var a=d.getProperty("/charnames");if(a){for(t=0;t<a.length;t++){n=a[t];if(n.name===e){return n.text}}}var i=d.getProperty("/measures");if(i){for(t=0;t<i.length;t++){n=i[t].characteristic;if(n.name===e){return n.text}}}return e});var u=this.createSearchField({enableListSuggest:false,width:"100%",enableClear:true,startSuggestion:0,suggest:function(e){var t=e.getParameter("newValue");var r=new sap.ui.model.Filter("characteristic/text",sap.ui.model.FilterOperator.Contains,t);c.getBinding(a.getRowRepeaterAggregation()).filter([r])}});var f=this.createText({width:"100%",design:"Bold"},i.getId()+"_dimensions_label").bindProperty("text",{path:"/text/dimensions",mode:sap.ui.model.BindingMode.OneWay,formatter:function(e){if(e){return e.toUpperCase()}return""}});var g=this.createTopArea({size:"30px",overflowX:"hidden",overflowY:"hidden",content:[u]});var h=this.createCenterArea({overflowX:"hidden",overflowY:"hidden"});var m=this.createPanel({top:this.createTopArea({size:"30px",overflowX:"hidden",overflowY:"hidden",content:[f]}).addStyleClass("zenNavigationPanel-SubHeader"),center:this.createCenterArea({content:[c]})});if(r.property&&r.property.showmeasuresseparately){var v=this.createSplitter({splitterOrientation:"Horizontal",splitterPosition:"40%",minSizeFirstPane:50,minSizeSecondPane:50,showScrollBars:false,width:"100%",height:"100%"});var y=new sap.zen.commons.layout.MatrixLayout({widths:["20px","auto"]});var P=this.createRowRepeater();P.bindAggregation(this.getRowRepeaterAggregation(),{path:"/measures",factory:a.getRowFactory(i,"/characteristic/name","/characteristic/text",function(e){if(e){return e.toUpperCase()}return""},false,function(){y.destroyRows();a.changeTemplate(i,y,{sPath:"/measures/0",oModel:d},true,true)})});var w=this.createPanel({top:this.createTopArea({size:"30px",overflowX:"hidden",overflowY:"hidden",content:[P]}).addStyleClass("zenNavigationPanel-SubHeader"),center:this.createCenterArea({overflowX:"hidden",overflowY:"hidden",content:[y]})}).addStyleClass("zenNavigationPanel-MeasuresPanel");v.addFirstPaneContent(w);v.addSecondPaneContent(m);h.addContent(v)}else{h.addContent(m)}if(o==="LIST_ONLY"){c.onAfterRendering=this.getDimensionsOnAfterRendering(i,c.getId());if(P){P.onAfterRendering=this.getDimensionsOnAfterRendering(i,P.getId())}i.setTop(g);i.setCenter(h)}else{i.setCenter(this.createCenterArea({overflowX:"hidden",overflowY:"hidden",content:[i.oHorizontalSplitter]}));var S=this.cloneRowRepeater(c);var C=this.cloneRowRepeater(c);c.onAfterRendering=this.getDimensionsOnAfterRendering(i,c.getId(),S.getId(),C.getId());if(P){P.onAfterRendering=this.getDimensionsOnAfterRendering(i,P.getId(),S.getId(),C.getId())}var x=function(){var e=i.getModel();var t=a.prepareCommand(e.getProperty("/command/submitonlyfilter"),"__STRING__",JSON.stringify({filters:[],axis:e.getProperty("/axis")}));t=a.prepareCommand(t,"__BOOLEAN__","X");new Function(t)();e.setProperty("/navigationpanel/apply/ready",false)};i.ZEN_submit=x;S.onAfterRendering=this.getAxisOnAfterRendering("rows",C.getId(),i,x);C.onAfterRendering=this.getAxisOnAfterRendering("columns",S.getId(),i,x);S.bindAggregation(this.getRowRepeaterAggregation(),{path:"/axis/rows",factory:p});C.bindAggregation(this.getRowRepeaterAggregation(),{path:"/axis/columns",factory:p});var D=this.createPanel({top:g,center:h}).addStyleClass("zenNavigationPanel"+s+"-BorderLayoutLeft");if(i.oHorizontalSplitter){i.oHorizontalSplitter.addFirstPaneContent(D)}var b=this.createLabel({text:"{/text/ROWS}",design:"Bold"},i.getId()+"_rows_label");var z=this.createTopArea({size:"30px",overflowX:"hidden",overflowY:"hidden"}).addStyleClass("zenNavigationPanel-SubHeader");var R=this.createPanel({width:"100%",height:"100%",top:z,center:this.createCenterArea({content:[S]})});z.addContent(b);var I=this.createLabel({text:"{/text/COLUMNS}",design:"Bold"},i.getId()+"_columns_label");var A=this.createTopArea({size:"32px",overflowX:"hidden",overflowY:"hidden"}).addStyleClass("zenNavigationPanel-SubHeader");var M=this.createPanel({width:"100%",height:"100%",top:A,center:this.createCenterArea({content:[C]})});A.addContent(I);i.oVerticalSplitter={};i.oVerticalSplitter=this.createSplitter({splitterOrientation:"Horizontal",splitterPosition:"50%",minSizeFirstPane:50,minSizeSecondPane:50,showScrollBars:false,width:"100%",height:"100%"}).addStyleClass("zenNavigationPanel"+s+"-SplitterH");i.oVerticalSplitter.addFirstPaneContent(M);i.oVerticalSplitter.addSecondPaneContent(R);var N=i.oVerticalSplitter.resizeSplitterElements;i.oVerticalSplitter.resizeSplitterElements=function(){N.apply(this);R.invalidate();M.invalidate()};var T=this.createCenterArea({overflowX:"hidden",overflowY:"hidden",content:[i.oVerticalSplitter]});var E=this.createPanel({width:"100%",height:"100%",top:this.createTopArea({contentAlign:"right",size:"30px",content:[new sap.m.Button(i.getId()+"_pause_refresh",{press:function(){var e=i.getModel();var t=a.prepareCommand(e.getProperty("/command/pauserefreshcommand"),"__BOOLEAN__",e.getProperty("/property/pauserefresh")?"":"X");new Function(t)()}}).bindProperty("text",{path:"/property/pauserefresh",mode:sap.ui.model.BindingMode.OneWay,formatter:function(e){var t=i.getModel();return e?t.getProperty("/text/refresh"):t.getProperty("/text/pause")}})]}),center:T}).addStyleClass("zenNavigationPanel"+s+"-BorderLayoutRight");if(i.oHorizontalSplitter){i.oHorizontalSplitter.addSecondPaneContent(E)}}i.onAfterRendering=function(){var e=this.$();var t=jQuery(e.children("tbody")).children("tr");var r=t.length-1;for(var n=0;n<r;n++){var a=t[n];jQuery(a).css("height","0px")}};return i};this.update=function(e,t,r){if(e&&t){var n=e.getModel();if(this.isDesignModeD4LIncluded()||t.newds&&t.property&&n.getProperty("/property/navigationpanelmode")!==t.property.navigationpanelmode){return this.create(e,t,r)}if(t.newds||!n.getProperty("/navigationpanel/apply/ready")){if(t.charnames){n.setProperty("/charnames",t.charnames)}if(t.characteristics){this.rewriteMeasuresPosition(t,n.getProperty("/property/showmeasuresseparately"));n.setProperty("/characteristics",t.characteristics);n.setProperty("/measures",t.measures)}if(t.axis&&this.axisArraysNotSame(t.axis,n.getProperty("/axis"))){n.setProperty("/axis",t.axis)}}if(t.filters){n.setProperty("/filters",t.filters)}if(t.changeVisibility){if(t.visible){e.removeStyleClass("zenHideFilterPanel")}else{e.addStyleClass("zenHideFilterPanel")}}if(typeof sap.zen.dsh.DSH_deployment!=="undefined"){if(!t.pauserefresh&&e.getModel().getProperty("/property/pauserefresh")){e.ZEN_submit()}e.getModel().setProperty("/property/pauserefresh",t.pauserefresh)}e.getModel().setProperty("/dsName",t.dsName)}a.clearDragGhosts();if(e){this.updateSplitter(e.oHorizontalSplitter)}return e};this.createSplitter=function(e){var t=new sap.ui.layout.Splitter;t.mFnOrigOnAfterRendering=t.onAfterRendering;t.onAfterRendering=function(){if(t.mFnOrigOnAfterRendering){t.mFnOrigOnAfterRendering()}jQuery(t.getDomRef()).find("[tabIndex='-1']").attr("tabIndex","0")};t.oSplitterConfig=e;if(e.splitterOrientation==="Horizontal"){t.setOrientation(sap.ui.core.Orientation.Vertical)}t.addFirstPaneContent=function(e){t.addContentArea(e);e.getLayoutData().setMinSize(t.oSplitterConfig.minSizeFirstPane);e.getLayoutData().setSize(t.oSplitterConfig.splitterPosition)};t.addSecondPaneContent=function(e){t.addContentArea(e);e.getLayoutData().setMinSize(t.oSplitterConfig.minSizeSecondPane);e.getLayoutData().setSize("auto")};return t};this.updateSplitter=function(e){if(!e){return}var t=0;if(e.getOrientation()==="Horizontal"){t=e.getDomRef().offsetWidth}else{t=e.getDomRef().offsetHeight}if(e.splitterSize&&e.splitterSize!=t){var r=0;var n=0;e.getContentAreas().forEach(function(t){var a=0;if(e.getOrientation()==="Horizontal"){a=t.getDomRef().offsetWidth}else{a=t.getDomRef().offsetHeight}n+=a;if(t.getLayoutData().getSize().endsWith("px")){r+=1}});if(r>1){e.getContentAreas().forEach(function(t){var r=0;if(e.getOrientation()==="Horizontal"){r=t.getDomRef().offsetWidth}else{r=t.getDomRef().offsetHeight}var a=r*100/n;t.getLayoutData().setSize(a+"%")})}}e.splitterSize=t};this.createMainPanel=function(e){var t=new sap.m.NavContainer(e,{autoFocus:false}).addStyleClass("zenNavigationPanelM").addStyleClass("sapContrastPlus");var r=this.createPanel({});t.addPage(r);t.setTop=function(e){r.setTop(e)};t.setCenter=function(e){r.setCenter(e)};t.destroyTop=function(){t.getPages()[0].destroySubHeader()};t.destroyCenter=function(){t.getPages()[0].destroyContent()};return t};this.createPanel=function(e){var t=null;if(jQuery.type(e)==="string"){t=new sap.m.Page(e)}else{t=new sap.m.Page}t.setShowHeader(false);t.setTop=function(e){t.setSubHeader(e)};t.setCenter=function(e){var r=e.content;if(r){for(var n=0;n<r.length;n++){t.addContent(r[n])}}};if(e.top){t.setTop(e.top)}if(e.center){t.setCenter(e.center)}t.addEventDelegate({onAfterRendering:function(){var e=t.$();if(e.closest(".sapUiSizeCompact").length===0&&e.children("header").length>0){e.children("section").css("top","3rem")}}});t.onAfterRendering=function(){jQuery(t.getDomRef()).find("[tabIndex='-1']").attr("tabIndex","0")};return t};this.createTopArea=function(e){var t=new sap.m.Toolbar;var r=e.content;if(e.contentAlign==="right"){t.addContent(new sap.m.ToolbarSpacer)}if(r){for(var n=0;n<r.length;n++){t.addContent(r[n])}}return t};this.createCenterArea=function(e){var t={content:e.content?e.content:[],addContent:function(e){this.content.push(e)}};return t};this.createSearchField=function(e){var t=new sap.m.SearchField;t.setWidth(e.width);t.attachLiveChange(e.suggest);return t};this.createText=function(e,t){if(e&&e.design){delete e.design}return new sap.m.Title(t,e)};this.createLabel=function(e,t){var r;if(e&&e.design==="Bold"){delete e.design;delete e.labelFor;r=new sap.m.Title(t,e)}else{r=new sap.m.Label(t,e)}return r};this.createRowRepeater=function(){var e=new sap.m.List({noDataText:" "});return e};this.cloneRowRepeater=function(e){var t=e.clone();return t};this.getRowRepeaterAggregation=function(){return"items"};this.rewriteMeasuresPosition=function(e,t){if(e&&e.characteristics&&(t||e.property&&e.property.showmeasuresseparately)){for(var r=0,n=e.characteristics.length;r<n;r++){var a=e.characteristics[r];if(a.characteristic.measureStructure){e.measures=[a];e.characteristics.splice(r,1);break}}}};this.getRowFactory=function(e,t,n,i,o,s){return function(d,l){var c=new sap.zen.commons.layout.MatrixLayout({widths:["20px","auto"]});var p=l.oModel;var u=p.getProperty(l.sPath+"/characteristic/measureStructure");var f,g,h,m;var v=e.getId()+"-"+a.createUI5Identifier(p.getProperty(l.sPath+t));if(l.sPath.indexOf("/axis/rows")!==-1){v+="-rows"}if(l.sPath.indexOf("/axis/columns")!==-1){v+="-columns"}c.setWidth("100%");f=new sap.zen.commons.layout.MatrixLayoutRow;if(o){var y=new sap.ui.core.Icon;if(u){y.bindProperty("src",{path:"/navigationpanel/measures/expanded",mode:sap.ui.model.BindingMode.OneWay,formatter:function(e){if(e){return"sap-icon://navigation-down-arrow"}return"sap-icon://navigation-right-arrow"}});y.attachPress(function(){p.setProperty("/navigationpanel/measures/expanded",!p.getProperty("/navigationpanel/measures/expanded"));a.changeTemplate(e,c,l)});y.addStyleClass("sapzenExpandMeasuresIcon")}else{y.setSrc("sap-icon://accept");y.bindProperty("color",{path:l.sPath+"/characteristic/axis",mode:sap.ui.model.BindingMode.OneWay,formatter:function(e){if(e==="FREE"){return"transparent"}return"inherit"}})}g=new sap.zen.commons.layout.MatrixLayoutCell({hAlign:r.Center});g.addContent(y);f.addCell(g)}m=a.createText();m.bindProperty("text",{path:l.sPath+n,mode:sap.ui.model.BindingMode.OneWay,formatter:i});m.onAfterRendering=function(){this.$().css("cursor","move")};h=new sap.zen.commons.layout.MatrixLayoutCell({colSpan:2});h.addContent(m);h.addContent(a.createLabel({width:"0px"}).bindProperty("text",{path:l.sPath+t,mode:sap.ui.model.BindingMode.OneWay}).addStyleClass("zenDimensionId").addStyleClass("zenHideFilterPanel"));f.addCell(h);c.addRow(f);if(u){a.changeTemplate(e,c,l)}if(u){c.addEventDelegate({onAfterRendering:function(){var e=c;jQuery(e.getDomRef()).attr("tabIndex","0");var t=c.$().find("tr");t.not(".zenMeasure").css("cursor","move");t.css("white-space","nowrap")}})}if(s){s()}var P=new sap.m.CustomListItem(v,{content:[c]});P.onAfterRendering=function(){var e=this;jQuery(e.getDomRef()).attr("tabIndex","0")};return P}};this.changeTemplate=function(e,t,r,n){var i=r.oModel;if(n||i.getProperty("/navigationpanel/measures/expanded")){var o=i.getProperty(r.sPath+"/characteristic/members");var s=i.getProperty(r.sPath+"/characteristic/name");var d=i.getProperty(r.sPath+"/characteristic/axis");for(var l=0;l<o.length;l++){var c=o[l];var p=new sap.ui.core.Icon({src:"sap-icon://accept"});p.bindProperty("color",{path:"/filters/"+s,mode:sap.ui.model.BindingMode.OneWay,formatter:a.getFilterFormatter(c.key,d,c.parents)});var u=new sap.zen.commons.layout.MatrixLayoutCell({content:[this.createText({text:c.text}),this.createLabel({width:"0px",text:s}).addStyleClass("zenDimensionId").addStyleClass("zenHideFilterPanel"),this.createLabel({width:"0px",text:c.key}).addStyleClass("zenMemberId").addStyleClass("zenHideFilterPanel")]});var f=new sap.zen.commons.layout.MatrixLayoutRow(e.getId()+"-MeasureRow-"+(c.key?c.key.replace("!","x"):"x"));f.addCell(new sap.zen.commons.layout.MatrixLayoutCell({content:[this.createText()]}));f.addCell(new sap.zen.commons.layout.MatrixLayoutCell({content:[p]}));f.addCell(u);f.addStyleClass("zenMeasure");t.addRow(f)}t.setWidths(["20px","20px","auto"])}else{while(t.getRows().length>1){t.removeRow(1).destroy()}t.setWidths(["20px","auto"])}};this.getFilterFormatter=function(e,t,r){return function(n){var a,i,o;if(t==="FREE"){return"transparent"}if(n){if(n.members&&n.members.length>0){for(i=0,o=n.members.length;i<o;i++){var s=n.members[i].key;if(s===e){return n.exclude?"transparent":"inherit"}if(r){for(a=0;a<r.length;a++){if(r[a].key===s){return n.exclude?"transparent":"inherit"}}}}return n.exclude?"inherit":"transparent"}else if(n.ranges&&n.ranges.length>0){var d=true;for(i=0,o=n.ranges.length;i<o;i++){var l=n.ranges[i];if(l.operation==="EQ"||!l.operation){s=l.from.key;if(s===e){return l.exclude?"transparent":"inherit"}if(r){for(a=0;a<r.length;a++){if(r[a].key===s){return l.exclude?"transparent":"inherit"}}}}if(d&&!l.exclude){d=false}}return d?"inherit":"transparent"}}return"inherit"}};this.isDropInPanel=function(t,r){e.error("isDropInPanel");e.error(t);var n=document.getElementById(r).getBoundingClientRect();return t.clientX>=n.left&&t.clientX<=n.right&&t.clientY>=n.top&&t.clientY<=n.bottom};this.onUnhandledDrop=function(t){e.error("onUnhandledDrop");e.error(t);if(!a.isDropInPanel(t,this.getId())){n.dispatcher.setDragDropCanceled(true)}};this.onEscKeyPressed=function(){e.error("onEscKeyPressed");n.dispatcher.setDragDropCanceled(true);if(i){i.draggable().trigger("mouseup")}if(o){o.sortable().trigger("mouseup")}};this.getDimensionsOnAfterRendering=function(t,r,o,s){return function(){var d=jQuery(document.getElementById(r)).children("ul").children("li");var l=jQuery(document.getElementById(r));var c=t.getModel().getProperty("/property/rootcomponentid");if(!c){c="ROOT"}l.find(".sapUiRrNoData").remove();l.find(".sapMListNoData").remove();var p={helper:function(){var e=a.getDimensionNameAndIdForJQElement(jQuery(this)).dimensionName;var r=n.dispatcher.createDragDropPayload(t.getId());r.oDragDropInfo.sDimensionName=e;n.dispatcher.setDragDropPayload(r);i=jQuery(this);return jQuery("<div class='zenDnDHelper'></div>").append(jQuery(jQuery(this).find("span").not(".sapUiIcon")[0]).clone())},appendTo:function(){var t=n.dispatcher.getRootControlForComponentId(c);if(!t){e.error("Cannot find root control: "+c);return null}return document.getElementById(n.dispatcher.getRootControlForComponentId(c).getId())}(),revert:function(e){if(n.dispatcher.isDragDropCanceled()){this.context.ZENcancel=function(){var t;if(jQuery(document.getElementById(o)).find(e).length>0||jQuery(document.getElementById(s)).find(e).length>0){t=e.sortable("cancel").find("li");jQuery(t[t.length-1]).remove()}};return true}var t=n.dispatcher.getDragDropPayload();if(t&&e&&t.oInterComponentAcceptStatus[jQuery(e).attr("id")]===true){return false}var r=a.getDimensionNameAndIdForJQElement(jQuery(this));if(e){var i=e.children().not(".ui-draggable");var d=function(){var t=e.sortable("cancel").find("li");jQuery(t[t.length-1]).remove()};for(var l=0;l<i.length;l++){var c=a.getDimensionNameAndIdForJQElement(jQuery(i[l]));if(o&&s&&(e.attr("id")===o+"-listUl"||e.attr("id")===s+"-listUl")&&c.dimensionName===r.dimensionName&&c.id!==r.id){this.context.ZENcancel=d;return true}}}return false},start:function(e){if(e.isDefaultPrevented&&e.isDefaultPrevented()===true){e.isDefaultPrevented=function(){return false}}var t=jQuery(e.toElement);if(t.length>0&&(t.hasClass("zenMeasure")||t.parents(".zenMeasure").length>0)){return false}return null},stop:function(){if(this.ZENcancel){this.ZENcancel();this.ZENcancel=undefined}}};if(o&&s){p.connectToSortable="#"+o+" > ul"+", #"+s+" > ul"}d.draggable(p).disableSelection();var u=d.find("tr");u.not(".zenMeasure").css("cursor","move");u.css("white-space","nowrap");d.mousedown(function(e){n.dispatcher.closeContextMenu();if(e&&(!e.target||!jQuery(e.target).hasClass("sapzenExpandMeasuresIcon"))){if(e.preventDefault){e.preventDefault()}if(e.stopPropagation){e.stopPropagation()}if(e.cancelBubble){e.cancelBubble=true}}});if(sap.ui.Device.support.touch){d.bind(a.touchBindObject)}}};this.isOverParent=function(e){var t=e.offset.left;var r=e.offset.top;var n=e.item.outerHeight();var a=r+n*2;var i=t+n;var o=e.item.parent();if(o.length===0){o=e.item}var s=o.offset().left;var d=o.offset().top;var l=o.outerHeight();var c=o.outerWidth();var p=d+l;var u=s+c;if(p<r||d>a||u<t||s>i){return false}return true};this.getAxisOnAfterRendering=function(e,t,r,i){return function(){var s=this.getId();var d=jQuery(document.getElementById(s)).children("ul");jQuery(document.getElementById(s+"-body")).height("100%");d.height("100%");d.find(".sapUiRrNoData").remove();d.find(".sapMListNoData").remove();var l=jQuery(document.getElementById(s)).find("li");l.css("cursor","move");l.find("tr").css("white-space","nowrap");var c=l.outerHeight()*(l.length+1);var p=this.$();if(c===0){p.height("100%")}else{p.height(c+"px")}if(d.sortable){var u={rows:"columns",columns:"rows"};var f=l.outerHeight()+"px";d.sortable({containment:jQuery(document.getElementById(r.getId())),connectWith:"#"+t+" > ul",tolerance:"pointer",helper:function(e,t){var a=n.dispatcher.createDragDropPayload(r.getId());a.oDragDropInfo.sDimensionName="";n.dispatcher.setDragDropPayload(a);o=jQuery(this);return jQuery("<div class='zenDnDHelper'></div>").append(jQuery(t).find("span").clone())},placeholder:"zenNavDropHighlight",forcePlaceholderSize:true,change:function(e,t){t.placeholder.css("height",f)},stop:function(t,o){if(n.dispatcher.isDragDropCanceled()){jQuery(this).sortable("cancel");return}if(!a.isOverParent(o)){var s=a.getDimensionNameAndIdForJQElement(o.item).dimensionName;if(s){var d=r.getModel();var l=d.getProperty("/axis/"+e);for(var c=0;c<l.length;c++){var p=l[c].entry.name;if(p===s){l.splice(c,1);d.setProperty("/axis/"+e,l);d.setProperty("/navigationpanel/apply/ready",true);if(!d.getProperty("/property/pauserefresh")){i()}break}}}}},appendTo:document.getElementById(r.getId()),update:function(t,o){var s,d;a.clearDragGhosts();if(n.dispatcher.isDragDropCanceled()){return}var l=jQuery(this).find("li");var c=[],p=[];var f=u[e];var g=r.getModel();var h=g.getProperty("/axis/"+f);for(s=0;s<l.length;s++){var m=a.getDimensionNameAndIdForJQElement(jQuery(l[s])).dimensionName;if(m){var v=true;for(d=0;d<c.length;d++){if(m===c[d].entry.name){v=false;break}}if(v){for(d=0;d<h.length;d++){if(h[d].entry.name===m){h.splice(d,1);break}}if(o.item[0]!==l[s]||a.isOverParent(o)){c.push({entry:{name:m}})}else{p.push(s)}}}}for(s=0;s<p.length;s++){jQuery(l[p[s]]).remove()}var y=g.getProperty("/navigationpanel/timeout");if(y){clearTimeout(y)}g.setProperty("/navigationpanel/timeout",setTimeout(function(){var t=r.getModel();t.setProperty("/axis/"+e,c);t.setProperty("/axis/"+f,h);t.setProperty("/navigationpanel/apply/ready",true);if(!t.getProperty("/property/pauserefresh")){i()}t.setProperty("/navigationpanel/timeout",undefined)},0))},cursor:"move"}).disableSelection()}d.mousedown(function(e){n.dispatcher.closeContextMenu();if(e){if(e.preventDefault){e.preventDefault()}if(e.stopPropagation){e.stopPropagation()}if(e.cancelBubble){e.cancelBubble=true}}});if(sap.ui.Device.support.touch){d.bind(a.touchBindObject)}}};if(sap.ui.Device.support.touch){this.getTouchToMouse=function(e){return function(t){var r=t.originalEvent.changedTouches[0];var n=document.createEvent("MouseEvents");t.preventDefault();n.initMouseEvent(e,true,true,window,1,r.screenX,r.screenY,r.clientX,r.clientY);t.target.dispatchEvent(n)}};this.touchBindObject={touchstart:a.getTouchToMouse("mousedown"),touchmove:a.getTouchToMouse("mousemove"),touchend:a.getTouchToMouse("mouseup")}}this.axisArraysNotSame=function(e,t){var r=["rows","columns"];if(e&&t){for(var n=0;n<2;n++){var a=r[n];if(e[a].length===t[a].length){for(var i=0;i<e[a].length;i++){if(e[a][i].entry.name!==t[a][i].entry.name){return true}}}else{return true}}return false}return true};this.getContextMenuAction=function(e,t,r){var n=t.getModel().getProperty("/command/createcontextmenu");if(n){var i=r.prop("tagName").toLowerCase();var o;var s;if(i==="label"||i==="span"){o=a.getDimensionNameAndIdForJQElement(r.parent(),false,true).dimensionName;s=a.getDimensionNameAndIdForJQElement(r.parent(),true,true).dimensionName}else if(i==="td"||i==="li"){o=a.getDimensionNameAndIdForJQElement(r).dimensionName;s=a.getDimensionNameAndIdForJQElement(r.parent(),true).dimensionName}if(o){var d=a.prepareCommand(n,"__STRING__",e);d=a.prepareCommand(d,"__STRING2__",o);d=a.prepareCommand(d,"__STRING3__",s);d=a.prepareCommand(d,"__STRING4__",r[0].id);return new Function(d)}}return null};this.isDesignModeD4LIncluded=function(){return sap.zen.designmode};this.getType=function(){return"navigationpanel"};this.getDecorator=function(){return"DataSourceControlDecorator"};this.clearDragGhosts=function(){jQuery("div.zenDnDHelper").remove()};this.getDimensionNameAndIdForJQElement=function(e,t,r){var n=r?e.siblings(t?".zenMemberId":".zenDimensionId"):e.find(t?".zenMemberId":".zenDimensionId");var a=n.control(0);return{dimensionName:a&&a.getText(),id:n.attr("id")}};this.getType=function(){return"navigationpanel"}};var i=new a;n.dispatcher.addHandlers(i.getType(),i);return i});
//# sourceMappingURL=navigationpanel_handler.js.map