/*!
 * SAPUI5
  (c) Copyright 2009-2021 SAP SE. All rights reserved
 */
sap.ui.define(["jquery.sap.global","sap/base/Log","sap/zen/dsh/utils/BaseHandler","sap/zen/dsh/widgets/utilities/SDKUtilsHelper","sap/zen/dsh/widgets/dataMappers/helpers/SDKChartTypeHelper","sap/zen/dsh/widgets/dataMappers/helpers/SDKDataMapperHelper","sap/zen/dsh/widgets/charts/ChartException","sap/zen/dsh/widgets/sap_viz/CrossTableDataSet"],function(jQuery,e,t,s,i,a,r,n){"use strict";e.info("Loaded SDKChartDataMapper");function u(){var e=this;var t=null;var u=null;var l=null;var o=null;var f=null;var h=null;var d=null;var g=null;var v={key:"12345",isFake:true,text:"Key Figures",axis:"ROWS",axis_index:0,containsMeasures:true,members:[{key:"",text:"",scalingFactor:0,unitOfMeasure:"",formatString:""}]};this.getDataMapperHelper=function(){if(d==null)d=new a(this.getMeasureCounter());return d};this.getChartTypeHelper=function(){if(g==null)g=new i;return g};this.getMessages=function(){return this.messgaes};this.setMessages=function(e){this.messgaes=e};var p=function(e){t=e};this.getMeasureAxis=function(){return t};var c=function(e){u=e};this.getMeasureIndex=function(){return u};var m=function(e){l=e};this.getMeasureCounter=function(){return l};var M=function(e){h=e};this._getDataExist=function(){return h};var x=function(e){o=e};this._getRowDimensionCounter=function(){return o};var D=function(e){f=e};this._getColDimensionCounter=function(){return f};this.setDataFeeding=function(e){this.dataFeeding=e};this.getDataFeeding=function(){return this.dataFeeding};this.setTotalMeasure=function(t){var s=0;var i;for(var a=0;a<t.length;a++){i=t[a][0]||0;s=s+i}e.total=s};this.getTotalMeasure=function(){return e.total};this.setNumberOfDimensions=function(e){var t=e.dimensions;var s=0;var i=0;jQuery.each(t,function(e,t){if(t.axis=="COLUMNS"&&!t.containsMeasures)s++;else if(t.axis=="ROWS"&&!t.containsMeasures)i++});x(i);D(s)};this.setInfo=function(e,t){var s=true;for(var i=0;i<e.data.length;i++){if(e.data[i]!=null){s=false;break}}if(this._getColDimensionCounter()==0){v.axis="COLUMNS"}if(s){if(!this.getUtilsHelper().hasMeasures(e)){e.dimensions.push(v)}}var a=0;var r="";var n=-1;for(var u=0;u<e.dimensions.length;u++){var l=e.dimensions[u];if(l.containsMeasures==true){r=l.axis;a=l.members.length;n=u;break}}if(a==0){e.dimensions.push(v);r=v.axis;a=v.members.length}p(r);c(n);m(a);this.setNumberOfDimensions(e);M(!s);C(e,t)};this.validateData=function(){};var C=function(t,s){var i=e.getChartTypeHelper();if(i.isScatterBubbleChart(s)||i.isRadarChart(s)){e.validateData(s)}else if(i.isDualChart(s)){if(t.dualAxis!=undefined){var a=0;var n=0;for(var u=0;u<t.dualAxis.length;u++){if(t.dualAxis[u][1]=="axis1")a++;else n++}if(a==0&&n==0)throw new r(e.getMessages().datasource_no_measures)}e.validateData(t,s)}else{e.validateData()}};this.setAnalysisAxisValue=function(){};this.getAnalysisAxisValue=function(){return null};this.getxAxisValues=function(t){this.setInfo(t);var s=e.createAnalysisAxisGroup(t);var i=T(t,s);this.setTotalMeasure(i[0].data[0].values);for(var a in s){if(s[a].index==1){return s[a].data[0].values}}};var T=function(t,s){var i=e.getMeasureAxis();var a=e.getMeasureIndex();var r={};jQuery.each(t.dimensions,function(e,t){if(t.containsMeasures){r=t.members}});var n;if(t.cvomType&&t.cvomType==="viz/waterfall"||t.cvomType==="viz/horizontal_waterfall"||t.cvomType==="viz/stacked_waterfall"||t.cvomType.indexOf("pie")!==-1){i=e.getMeasureAxis();a=e.getMeasureIndex();r={};jQuery.each(t.dimensions,function(e,t){if(t.containsMeasures){r=t.members}});n=e.createMeasureValues(t,r,i,a)}else{n=e.createMeasureValues(t,s)}return n};this.createDataSet=function(t){var s={};s.analysisAxis=e.createAnalysisAxisGroup(t);s.measureValuesGroup=T(t,s.analysisAxis);var i=new n;i.data(s);return i};this.findKeyFigureAxis=function(e){for(var t=0;t<e.dimensions.length;t++){if(e.dimensions[t].containsMeasures){return e.dimensions[t].axis}}};this.setDimensionsOnAxis=function(e,t,s,i,a,r,n){var u={};var l=[];u.index=e;u.data=[];var o=-1;var f=0;var h=-1;var d=this;jQuery.each(r,function(e,s){if(h==-1||s[f]==h){jQuery.each(s,function(e,s){if(s!=-1&&(!t.dimensions[e].containsMeasures||n)){if(h!=-1&&h)if(o==-1)o=e;if(l[e-o]==undefined)l[e-o]=[];var i=d.getDimensionLabel(t.dimensions[e].members[s],t.presentationValue);l[e-o].push(i)}else if(t.dimensions[e].containsMeasures&&h==-1){f=e;h=s}})}});for(var g=0;g<t.dimensions.length;g++){var v=t.dimensions[g];if(v.containsMeasures&&!n||v.axis!=i){continue}var p={};p.name=v.text;p.type="Dimension";p.values=l[g-o];u.data.push(p)}s.push(u)};this.createAnalysisAxis=function(){return null};this.createAnalysisAxisGroup=function(e){var t=this.getMeasureAxis();var s=this.getMeasureCounter();var i=1;var a=1;if(t=="COLUMNS")i=s;else if(t=="ROWS")a=s;return this.createAnalysisAxis(e,a,i,this._getRowDimensionCounter(),this._getColDimensionCounter())};this.getValues=function(e,t,s,i,a,r,n,u,l){var o=[];var f=this.getDataMapperHelper();if(t=="ROWS"){if(u){o=f.getAllRowValuesInArray(e,s,a,i,n)}else{o=f.getAllRowValuesInOneArray(e,s,a,r,i,n,l)}}else if(t=="COLUMNS"){if(i)o=f.getFirstMeasureColValuesInArray(e,s,a);else if(u){o=f.getAllColValuesInArray(e,s,a,n)}else if(l){o=f.getAllColValuesInOneArrayRows(e,s,a,r,n)}else{o=f.getAllColValuesInOneArray(e,s,a,r,n)}}return o};this.getIDimensionOnRows=function(e,t,s){var i=0;if(t[s].data[0]!=undefined){i=t[s].data[0].values.length}return i};this.mergeValues=function(e,t,s){if(s=="ROWS"){e.push(t[0])}else if(s=="COLUMNS"){jQuery.each(t,function(t,s){e[t].push(s[0])})}};this.mapData=function(e,t){t.dualAxis=e.dualAxis;this.setInfo(t,e.cvomType);var s={};t.presentationValue=e.mProperties.presentation.selectedValue;t.newChartOptionsProperties=e.newChartOptionsProperties;t.cvomType=e.cvomType;s.ds=this.createDataSet(t);s.dataFeeding=this.getChartDataFeeding(e);this.setAnalysisAxisValue(s.ds);return s};this.getChartDataFeeding=function(e){var t=this.getChartTypeHelper();var s=this.getMeasureCounter();var i=e.getChartDataFeedingHelper();var a=this.getMeasureAxis()=="ROWS"?this._getRowDimensionCounter():this._getColDimensionCounter();if(e.isGenericViz||e.newChartOptionsProperties!==undefined&&e.newChartOptionsProperties.feeds!==undefined)return i.genericDataFeeding(e,this.getMeasureAxis(),this.getMeasureIndex(),o,f);if(t.isScatterChart(e.cvomType)){return e.getDataFeeding(this.getMeasureAxis(),this.getMeasureIndex(),o,f)}else if(t.isBubbleChart(e.cvomType)){var r=false;if(s>3)r=true;return e.getDataFeeding(this.getMeasureAxis(),this.getMeasureIndex(),o,f,r)}else if(t.isRadarChart(e.cvomType)){return e.getDataFeeding(this.getMeasureAxis(),this.getMeasureIndex(),o,f,s)}else if(t.isDualChart(e.cvomType)){return e.getDataDualFeeding(this.getMeasureAxis(),this.getMeasureIndex(),o,f)}else{return e.getDataFeeding(this.getMeasureAxis(),this.getMeasureIndex(),o,f,a)}};this.getLegendValues=function(e,t){var s=e.getData();var i=this.getMeasuresHelper();var a=[""];if(!s)return null;this.setInfo(s,e.cvomType);var r={};s.axesSwapped=e.axesSwapped;s.presentationValue=e.mProperties.presentation.selectedValue;s.cvomType=e.cvomType;r.ds=e.getMappedData().ds;var n=this.getMeasureIndex();var u=this.getMeasureAxis();if(t&&u!=t)return null;var l=this.getMeasureCounter();var o=this._getRowDimensionCounter();var f=this._getColDimensionCounter();if(t=="ROWS"){return i.getMeasureTuplesCombination(s,n)}if(e.getDataFeeding()==undefined){var h=0;if(e.cvomType=="viz/multi_pie"||e.cvomType=="viz/stacked_waterfall"){h=1}else if(e.cvomType=="viz/waterfall"||e.cvomType=="viz/horizontal_waterfall"||e.cvomType=="viz/horizontal_waterfall")return i.getMeasureTuples(r.ds);return i.getRowDimTuples(r.ds,h)}if(e.cvomType=="viz/multi_radar"||e.cvomType=="viz/radar"){if(o==0&&f==0&&u=="COLUMNS")return a;else if(o==0)return i.getMeasureTuples(r.ds);else if(e.cvomType=="viz/multi_radar")return i.getRowDimTuples(r.ds,1)}if(l>0&&o>0&&u=="ROWS"){a=i.getMeasureAndRowDimTuples(r.ds,n-f)}if(u=="COLUMNS"){if(o==0&&f==0){a=i.getRowDimTuples(r.ds,0)}else if(o==0&&f>1){a=i.getRowDimTuples(r.ds,1)}else if(o>0&&f==0){a=i.getRowDimTuples(r.ds,0)}else{a=i.getRowDimTuples(r.ds,1)}}else if(l>0&&o==0&&u=="ROWS"){a=i.getMeasureTuples(r.ds)}return a};this.getLegendValuesFromData=function(e,t,s,i){var a=this.getMeasuresHelper();var r=[""];if(!e)return null;this.setInfo(e,s);var n={};e.axesSwapped=t;e.presentationValue=i;n.ds=this.createDataSet(e);var u=this.getMeasureIndex();var l=this.getMeasureAxis();var o=this.getMeasureCounter();var f=this._getRowDimensionCounter();var h=this._getColDimensionCounter();var d=0;if(s=="viz/multi_pie"||s=="viz/stacked_waterfall"||s=="viz/pie"){if(s!="viz/pie")d=1;return a.getRowDimTuples(n.ds,d)}else if(s=="viz/waterfall"||s=="viz/horizontal_waterfall"||s=="viz/horizontal_waterfall")return a.getMeasureTuples(n.ds);else if(s=="viz/multi_radar"||s=="viz/radar"){if(f==0&&h==0&&l=="COLUMNS")return r;else if(f==0)return a.getMeasureTuples(n.ds);else if(s=="viz/multi_radar")return a.getRowDimTuples(n.ds,1)}if(this.getChartTypeHelper().isScatterBubbleChart(e.cvomType)&&f>0){for(var g=0;g<e.dimensions.length;g++){var v=e.dimensions[g];if(v.axis==="ROWS"&&v.axis_index===0){r=e.dimensions[g].members.map(function(e){return e.text});break}}}else if(l=="COLUMNS"){if(f==0&&h==0){r=a.getRowDimTuples(n.ds,0)}else if(f==0&&h>1){r=a.getRowDimTuples(n.ds,1)}else if(f>0&&h==0){r=a.getRowDimTuples(n.ds,0)}else{r=a.getRowDimTuples(n.ds,1)}}else if(o>0&&f>0&&l=="ROWS"){r=a.getMeasureAndRowDimTuples(n.ds,u-h)}else if(o>0&&f==0&&l=="ROWS"){if(this.getChartTypeHelper().isDualChart(s)){r=["Axis 1","Axis 2"]}else{r=a.getMeasureTuples(n.ds)}}return r};this.setEmptyDimension=function(e,t){var s={};var i={};s.index=e;s.data=[];i.name="";i.type="Dimension";i.values=[""];s.data.push(i);t.push(s)};this.getDimensionLabel=function(e){return e.text};this.getUtilsHelper=function(){if(this._utilsHelper!=null||this._utilsHelper!=undefined){return this._utilsHelper}this._utilsHelper=new s;return this._utilsHelper}}return u});
//# sourceMappingURL=SDKChartDataMapper.js.map