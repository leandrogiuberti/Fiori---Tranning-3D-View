/*
 * SAPUI5
  (c) Copyright 2009-2021 SAP SE. All rights reserved
 */
sap.ui.define(["jquery.sap.global","sap/sac/df/thirdparty/lodash","sap/zen/dsh/utils/BaseHandler","sap/ui/core/Popup","sap/m/Panel","sap/m/BackgroundDesign"],function(jQuery,_,BaseHandler){"use strict";var PopupmHandler=function(){var me=this;BaseHandler.apply(me,arguments);var dispatcher=BaseHandler.dispatcher;function init(e,t){var o=t.content;var n=e.getContent()[0];if(o){me.updateChildren(o,e,function(e,t){dispatcher.insertIntoAbsoluteLayoutContainer(n,e,t)},function(e){n.removeContent(e)})}}this.applyForChildren=function(e,t){var o=e.getContent()[0];var n=o.getContent();for(var r=0;r<n.length;r++){var i=n[r];if(i){t(i)}}};me.getDecorator=function(){return"PopupDecorator"};me.getType=function(){return"popupm"};me.createAndAdd=function(e,t,o,n,r){var i=new sap.m.Panel({content:[this.createAbsoluteLayout()]}).addStyleClass("zenmpopup");i.custProp={};setCommand(i,"CLOSE",t.command);setOriginalPositions(i,o);n(i,r);BaseHandler.dispatcher.updateComponentProperties(i,o);init(i,t);me.updatePanelBg(i,t);if(sap.zen.designmode)i.addStyleClass("zenborder");else{i.addEventDelegate({onAfterRendering:function(e){e.srcControl.removeEventDelegate(this);i.setVisible(false);jQuery(i.getParent().getDomRef()).addClass("zenmpopuphidden")}})}return i};me.update=function(e,t,o){t=t||{};init(e,t);me.updatePanelBg(e,t);var n=e.custProp.popup;if(!sap.zen.designmode){if(t.show===false)me.hide(e,t);else if(t.show===true||n&&n.isOpen())me.show(e,t,o)}return e};me.updatePanelBg=function(e,t){if(e&&t.backgroundDesign){if(t.backgroundDesign==="TRANSPARENT"){e.setBackgroundDesign(sap.m.BackgroundDesign.Transparent)}else if(t.backgroundDesign==="SOLID"){e.setBackgroundDesign(sap.m.BackgroundDesign.Solid)}else if(t.backgroundDesign==="TRANSLUCENT"){e.setBackgroundDesign(sap.m.BackgroundDesign.Translucent)}}};me.show=function(e,t,o){var n=e.custProp.popup;var r=true;if(!n){r=false;n=me.createPopup(e,t);if(t.openCentered){me.repositionPopup(n);n.zenOpenCentered=true}n.getContent().toggleStyleClass("autoHeight",isAuto(o.height));n.getContent().toggleStyleClass("autoWidth",isAuto(o.width));n.open()}if(!t.openCentered&&!n.zenOpenCentered){var i=getOriginalPositions(e,o);var p="px";var a=isAuto(i.topmargin)?i.topmargin:i.topmargin+p;var s=isAuto(i.rightmargin)?i.rightmargin:i.rightmargin+p;var u=isAuto(i.bottommargin)?i.bottommargin:i.bottommargin+p;var m=isAuto(i.leftmargin)?i.leftmargin:i.leftmargin+p;var d=isAuto(o.height)?o.height:o.height+p;var g=isAuto(o.width)?o.width:o.width+p;g=dispatcher.calcWidthUseOrderOfPriority(m,s,g);d=dispatcher.calcWidthUseOrderOfPriority(a,u,d);if(e.getDomRef()){var c={};if(a)c.top=a;if(s)c.right=s;if(u)c.bottom=u;if(m)c.left=m;if(d)c.height=d;if(g)c.width=g;n.getContent().toggleStyleClass("autoHeight",isAuto(o.height));n.getContent().toggleStyleClass("autoWidth",isAuto(o.width));jQuery(e.getDomRef()).css(c)}}else{if(r)setTimeout(function(){me.repositionPopup(n)},10)}};me.popupOpened=function(e){var t=e.oSource.getContent();jQuery(t.getDomRef()).attr("tabindex",0);if(e.oSource.getAutoClose())jQuery(t.getDomRef()).focus()};me.resizeHandler=function(){var e=getOpenCenterPopups();for(var t in e){me.repositionPopup(e[t])}};me.repositionPopup=function(e){if(e)e.setPosition("center center","center center",window,"0 0","fit")};me.hide=function(e){var t=e.custProp.popup;if(t&&t.isOpen())t.close()};me.createPopup=function(e,t){if(t.modal)t.autoclose=false;e.setVisible(true);var o=new sap.ui.core.Popup(e,!!t.modal,true,!!t.autoclose);o.attachClosed(function(){me.handlePopupClosed(e)});o.attachOpened(me.popupOpened);if(t.openCentered)addOpenCenterPopup(o);e.custProp.popup=o;return o};me.handlePopupClosed=function(oControl){var commandStr=getCommand(oControl,"CLOSE");if(commandStr){var command=me.prepareCommand(commandStr,"__VALUE__","false");eval(command)}var popup=oControl.custProp.popup;if(popup){removeOpenCenterPopup(popup);popup.destroy();oControl.custProp.popup=null}};function isAuto(e){return e===undefined||e==="auto"}function setOriginalPositions(e,t){if(e.custProp){if(!e.custProp.positions)e.custProp.positions={};e.custProp.positions.topmargin=t.topmargin;e.custProp.positions.leftmargin=t.leftmargin;e.custProp.positions.rightmargin=t.rightmargin;e.custProp.positions.bottommargin=t.bottommargin}}function getOriginalPositions(e,t){var o;if(e.custProp&&e.custProp.positions)o=e.custProp.positions;if(o){if(t.leftmargin)o.leftmargin=t.leftmargin;if(t.topmargin)o.topmargin=t.topmargin;if(t.rightmargin)o.rightmargin=t.rightmargin;if(t.bottommargin)o.bottommargin=t.bottommargin}return o}function getCommand(e,t){var o;if(e.custProp&&e.custProp.commands)o=e.custProp.commands[t];return o}function setCommand(e,t,o){if(e.custProp){if(!e.custProp.commands)e.custProp.commands={};e.custProp.commands[t]=o}}function removeOpenCenterPopup(e){if(me.openCenterPopups&&me.openCenterPopups[e.getId()]){delete me.openCenterPopups[e.getId()];me.openCenterPopupsCount--;if(me.openCenterPopupsCount===0){jQuery(window).off("resize",me.resizeHandler)}}}function addOpenCenterPopup(e){if(!me.openCenterPopups){me.openCenterPopups={};me.openCenterPopupsCount=0}me.openCenterPopups[e.getId()]=e;if(me.openCenterPopupsCount===0)jQuery(window).on("resize",me.resizeHandler);me.openCenterPopupsCount++}function getOpenCenterPopups(){return me.openCenterPopups}};var handler=new PopupmHandler;return handler});
//# sourceMappingURL=popupm_handler.js.map