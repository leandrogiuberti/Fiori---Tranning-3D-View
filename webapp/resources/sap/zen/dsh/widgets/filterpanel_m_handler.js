/*
 * SAPUI5
  (c) Copyright 2009-2021 SAP SE. All rights reserved
 */
sap.ui.define(["jquery.sap.global","sap/ui/model/json/JSONModel","sap/m/VBox","sap/m/Label","sap/m/Token","sap/m/Tokenizer","sap/m/Button","sap/m/Toolbar","sap/m/SearchField","sap/m/StandardListItem","sap/m/SelectDialog","sap/ui/core/BusyIndicator","sap/ui/model/Sorter","sap/ui/model/Filter","sap/zen/dsh/utils/BaseHandler","sap/zen/dsh/widgets/ValueHelpDialog","sap/zen/dsh/widgets/emptyComponent","sap/zen/dsh/ValueHelpRangeOperation","sap/ui/comp/util/FormatUtil","sap/ui/core/format/DateFormat"],function(jQuery,e,t,a,r,i,n,o,l,s,p,u,f,c,g,d,m,y){"use strict";var h=g.dispatcher;var v=function(){g.apply(this,arguments);var h=this;this.oClipboard={};this.create=function(a,r){var i=h.createUI5Identifier(r["id"]);var n;var o=new e;o.setData(r);var l=o.getProperty("/property/memberselector")||o.getProperty("/property/popupreference");if(l){n=a?a:new m(i);n.onAfterRendering=function(){new Function(h.prepareCommand(n.getModel().getProperty("/command/showfilterdialog"),"__STRING__",n.getModel().getProperty("/characteristics/0/characteristic/name")))();n.onAfterRendering=undefined}}else{n=a?a:new t(i).addStyleClass("sapzenfilterpanelM");if(!o.getProperty("/property/showembedded")){n.addStyleClass("sapzendimensionfilterM")}}if(!o.getProperty("/property/variablescreen")){n.ZEN_IdToDimensionMap={}}n.setModel(o);if(a){n.removeAllItems()}if(!l){this.addItems(n);n.ZEN_submit=this.submitExternal(o,true);n.ZEN_submit_with_apply=this.submitExternal(o,true,true);n.ZEN_check=this.submitExternal(o,false);n.ZEN_cancel=function(){new Function(o.getProperty("/command/cancelonlyfilter"))()}}var s=n.exit;n.exit=function(){if(s){s.apply(n,arguments)}sap.zen.dsh.sapbi_page.appComponent&&sap.zen.dsh.sapbi_page.appComponent._bIsBeingDestroyed||new Function(o.getProperty("/command/destroyfiltercomponent"))()};if(!this.isDesignModeD4LIncluded()){if(r.visible){n.removeStyleClass("zenHideFilterPanel")}else{n.addStyleClass("zenHideFilterPanel")}}return n};this.update=function(e,t,a){if(e&&t){var r=t.view;if(this.isDesignModeD4LIncluded()||t.newds){e.ZEN_multiInput=[];e=this.create(e,t,a);if(r!=="DIALOG"){return e}}if(t.changeVisibility){if(t.visible){e.removeStyleClass("zenHideFilterPanel")}else{e.addStyleClass("zenHideFilterPanel")}if(r==="SUBMIT"){e.ZEN_submit()}else if(r==="SUBMIT_WITH_APPLY"){e.ZEN_submit_with_apply()}else if(r==="CANCEL"){e.ZEN_cancel()}return e}var i=e.getModel();var n=i.getProperty("/filters"),o;var l=i.getProperty("/property/variablescreen");var s=t.filters;if(s){n=i.getProperty("/filters");var p=false;for(var u in s){var f=s[u];o=n[u];if(!o||!f){continue}p=true;if(t.filtercanceled||!o.dirty||l){if(l&&o.dirty){f.dirty=true}n[u]=f;if(i.getProperty("/dialog/name")===u){i.setProperty("/dialog/filters",f)}}}i.setProperty("/filters",p?n:s);x(i,"/filters")}var c=t.validatedfilters;if(c){n=i.getProperty("/filters");for(u in c){var g=c[u];o=n[u];if(!o||!g){continue}if(o&&o.dirty){g.dirty=true;n[u]=g;if(i.getProperty("/dialog/name")===u){i.setProperty("/dialog/filters",g)}}}x(i,"/filters")}var d=i.getProperty("/axis");var m=false;var y=i.getProperty("/characteristics");if(y){for(k=0;k<y.length;k++){if(y[k].characteristic.axisdirty){m=true;break}}}var h=m||d&&(d.rows.dirty||d.columns.dirty);if(r==="DEFAULT"&&(t.filtercanceled||!h)&&!_(t.characteristics,y)){i.setProperty("/characteristics",t.characteristics)}var v=-1;if(r==="DIALOG"){i.setProperty("/dialog",t.dialog);if(t.characteristics&&!_(t.characteristics,y)){i.setProperty("/characteristics",t.characteristics)}var P=this.getValueHelpDialog(e);P.open();P.update();e.zenValueHelpDialog=P}else if(r==="DIALOG_SEARCH"){var T=t.dialog;i.setProperty("/dialog/selection",T.selection);var b=i.getProperty("/dialog/hierarchical");if(b){var E=T.members;if(E){for(var k=0;k===v+1;k++){var F=E[""+k];if(!F){continue}F.level=0;v=k}}}i.setProperty("/dialog/members",T.members);if(e.zenValueHelpDialog){if(b&&e.zenValueHelpDialog.getTable().collapseAll){e.zenValueHelpDialog.getTable().collapseAll()}e.zenValueHelpDialog.update();e.zenValueHelpDialog.getFilterBar().setBusy(false);if(T.selection.maxelements||T.members&&(b||T.members.size>0)){e.zenValueHelpDialog.TableStateSearchData()}else{e.zenValueHelpDialog.TableStateDataFilled()}}}else if(r==="EXPAND_NODE"){var D=i.getProperty(t.path).level;var C=t.member;C.level=D;for(k=0;k===v+1;k++){F=C[""+k];if(!F){continue}F.level=D+1;v=k}i.setProperty(t.path,t.member);if(e.zenValueHelpDialog){e.zenValueHelpDialog.update(t.messages)}}else if(r==="SUBMIT"){e.ZEN_submit()}else if(r==="SUBMIT_WITH_APPLY"){e.ZEN_submit_with_apply()}else if(r==="CANCEL"){e.ZEN_cancel()}}return e};this.addItems=function(e){var t=e.getModel();var a=t.getProperty("/property/showembedded");if(a){var r=t.getProperty("/property/navigationpanel");var i=new l({liveChange:function(a){var i=a.getParameter("newValue");var n=new c(r?"entry/text":"characteristic/text",sap.ui.model.FilterOperator.Contains,i);var o=[n];var l=t.getProperty("/visibleprompts");if(l){o.push(T(l))}e.ZEN_multiInput=[];var s=e.ZENCharLists;for(var p=0;p<s.length;p++){s[p].getBinding("formElements").filter(o)}}});var n=new o({content:[null,i]});if(t.getProperty("/property/variablescreen")&&t.getProperty("/visibleprompts")){n.addContent(v(e,i))}e.addItem(n)}e.addItem(this.getMainItem(e))};this.getMainItem=function(e){var t=new sap.ui.layout.form.Form({editable:true,formContainers:[this.getMainContent(e)],layout:new sap.ui.layout.form.ResponsiveGridLayout({labelSpanXL:3,labelSpanL:4,labelSpanM:5,labelSpanS:12,adjustLabelSpan:false})});return t};this.getMainContent=function(e){var t;var a=e.getModel();if(a){var r=a.getProperty("/visibleprompts");if(r){t=this.getFormContainer(e,[T(r)])}else{t=this.getFormContainer(e)}}return t};this.getFormContainer=function(e,t,a){var r=new sap.ui.layout.form.FormContainer({formElements:{path:"/characteristics",factory:this.getFromElementsFactory(e,a),filters:t}});e.ZENCharLists=[r];return r};this.getFromElementsFactory=function(e,t){return function(r,i){var n=i.getModel();var o=n.getProperty(t?i.getPath("entry/name"):i.getPath("characteristic/name"));var l=t?b(n,o):i.getPath("characteristic");if(!l){return new sap.ui.layout.form.FormElement({visible:false})}var s=h.getInput(n,o,l,e);e.ZEN_multiInput=[];e.ZEN_multiInput.push(s);var p;var u;if(n.getProperty("/property/variablescreen")){p=e.getId()+"-"+h.createUI5Identifier(o);u=p+"-label"}if(n.getProperty("/property/label")){var f=new a(u).bindProperty("text",{path:l,formatter:function(e){return e.text}});f.bindProperty("tooltip",{path:l,formatter:function(e){return e.text}});f.bindProperty("required",{path:l,formatter:function(e){return e.mandatory}})}var c=new sap.ui.layout.form.FormElement(p,{label:f,fields:[s]});if(e.ZEN_IdToDimensionMap){e.ZEN_IdToDimensionMap[c.getId()]=o}return c}};this.getInput=function(e,t,a,n){var o=this.getCharacteristicByName(e,t);var l=e.getProperty(a+"/type");var s=e.getProperty(a+"/hierarchical");var p=e.getProperty(a+"/supportsMultiSelection");var f=e.getProperty(a+"/supportsInterval");var c=e.getProperty(a+"/supportsRange");var g=e.getProperty(a+"/supportsExcluding");var d=e.getProperty(a+"/showValueHelp");var m,v;if(e.getProperty("/property/variablescreen")){v=n.getId()+"-"+h.createUI5Identifier(t)+"-input"}if(l==="DATE"&&!p&&!g&&!c&&!s||l==="TIME"&&!p&&!f){if(f){m=new sap.m.DateRangeSelection(v,{dateValue:{path:"/filters",mode:sap.ui.model.BindingMode.OneWay,formatter:this.getFilterFormatter(t,l,e,"from")},secondDateValue:{path:"/filters",mode:sap.ui.model.BindingMode.OneWay,formatter:this.getFilterFormatter(t,l,e,"to")},change:function(a){if(a.getParameter("valid")){m.setValueState(sap.ui.core.ValueState.None);n.hasClientError=false;var r=a.getParameter("from")?a.getParameter("from"):a.getParameter("to");var i=a.getParameter("to")?a.getParameter("to"):a.getParameter("from");var l=h.createRange(false,"BT",r,null,i,null);var s=h.createTokenFromRange(e,t,o,l);var p=[];p.push(s);h.applyTokensToFilter(m.getModel(),t,p,false)}else{m.setValueState(sap.ui.core.ValueState.Error);n.hasClientError=true;E()}}})}else{if(l==="DATE"){m=new sap.m.DatePicker(v,{valueFormat:"yyyyMMdd",dateValue:{path:"/filters",mode:sap.ui.model.BindingMode.OneWay,formatter:this.getFilterFormatter(t,l,e,"from")},change:function(a){if(a.getParameter("valid")){m.setValueState(sap.ui.core.ValueState.None);n.hasClientError=false;var r=a.getParameter("value");var i=h.createRange(false,y.EQ,r,null,null,null);var l=h.createTokenFromRange(e,t,o,i);var s=[];s.push(l);h.applyTokensToFilter(m.getModel(),t,s,false)}else{m.setValueState(sap.ui.core.ValueState.Error);n.hasClientError=true;E()}}})}else if(l==="TIME"){m=new sap.m.TimePicker(v,{valueFormat:"HH:mm:ss",dateValue:{path:"/filters",mode:sap.ui.model.BindingMode.OneWay,formatter:this.getFilterFormatter(t,l,e,"from")},change:function(a){if(a.getParameter("valid")){m.setValueState(sap.ui.core.ValueState.None);n.hasClientError=false;var r=a.getParameter("value");var i=h.createRange(false,sap.zen.dsh.ValueHelpRangeOperation.EQ,r,null,null,null);var l=h.createTokenFromRange(e,t,o,i);var s=[];s.push(l);h.applyTokensToFilter(m.getModel(),t,s,false)}else{m.setValueState(sap.ui.core.ValueState.Error);n.hasClientError=true;E()}}})}}}else{m=new sap.m.MultiInput(v,{showValueHelp:d?true:false,enableMultiLineMode:{path:"/filters",mode:sap.ui.model.BindingMode.OneWay,formatter:this.applyFilterToTokens(n,e,t)},tokenUpdate:function(e){if(e.getParameter("type")===sap.m.MultiInput.TokenChangeType.Removed){var a=e.getParameter("removedTokens");var r=m.getTokens().filter(function(e){return a.every(function(t){return t!==e})});h.applyTokensToFilter(m.getModel(),t,r,true)}else if(e.getParameter("type")===sap.m.MultiInput.TokenChangeType.Added){var i=e.getParameter("addedTokens");var n=h.getTokensFromClipboard(t);if(n){for(var o=0;o<i.length;o++){var l=i[o];if(!l){continue}for(var s=0;s<n.length;s++){var p=n[s];if(!p){continue}if(l.getText()===p.getText()){l.setKey(p.getKey());l.setText(p.getText());l.setTooltip(p.getTooltip());l.data(p.data());n.splice(o,1);break}}}}h.clearClipboard(t);r=m.getTokens().filter(function(e){return i.every(function(t){return t!==e})});r=r.concat(i);h.applyTokensToFilter(m.getModel(),t,r,true)}}});m.addValidator(function(e){var t=new r({key:e.text,text:e.text,tooltip:e.text});return t});var P=m.getAggregation("tokenizer");P._copy=function(){if(i.prototype._copy){i.prototype._copy.apply(this,arguments)}h.addTokensToClipboard(t,this.getSelectedTokens())}}if(d&&m.attachValueHelpRequest){var T=function(){u.show(0);new Function(h.prepareCommand(e.getProperty("/command/showfilterdialog"),"__STRING__",t))()};m.attachValueHelpRequest(T)}m.addEventDelegate({onfocusin:function(){n.$().css("z-index","1")},onfocusout:function(){n.$().css("z-index","")},oncopy:function(){}});m.oZenControl=n;return m};this.addTokensToClipboard=function(e,t){if(!this.oClipboard[e]){this.oClipboard[e]=[]}for(var a=0;a<t.length;a++){var r=t[a];if(!r){continue}var i=this.copyToken(r);this.oClipboard[e].push(i)}};this.getTokensFromClipboard=function(e){return this.oClipboard[e]};this.clearClipboard=function(e){this.oClipboard[e]=[]};this.getFilterFormatter=function(e,t,a,r){return function(a){if(a&&e&&a[e]){var i=a[e];if(i.ranges){var n=i.ranges[0];if(n){var o=n[r];if(o){if(t==="DATE"){return h.getDateFormat().parse(o.key)}else if(t==="TIME"){return h.getTimeFormat().parse(o.key)}}}}}return null}};this.getDateFormat=function(){return sap.ui.core.format.DateFormat.getInstance({pattern:"yyyyMMdd",strictParsing:true})};this.getTimeFormat=function(){return sap.ui.core.format.DateFormat.getTimeInstance({pattern:"HH:mm:ss",strictParsing:true})};this.applyFilterToTokens=function(e,t,a){return function(r){if(e.ZEN_multiInput[0].getId()!==this.getId()){e.ZEN_multiInput[0]=this}if(!r||!a||!r[a]){this.setTokens([]);return true}var i=[];var n=r[a];if(n&&n.ranges&&n.ranges.length>0){var o=h.getCharacteristicByName(t,a);for(var l=0;l<n.ranges.length;l++){var s=n.ranges[l];if(!s){continue}var p=h.createTokenFromRange(t,a,o,s);if(p){p.data("validated",true);i.push(p)}}}this.setTokens(i);return true}};this.applyTokensToFilter=function(e,t,a,r){var i=this.getCharacteristicByName(e,t);var n=e.getProperty("/filters");var o=null;if(n){o=n[t]}if(o){o.dirty=true;o.input=[];o.ranges=[];for(var l=0;l<a.length;l++){var s=a[l];if(!s){continue}var p=false;if(s.data("validated")){p=s.data("validated")}var u=this.createRangeFromToken(e,t,i,s);if(u){var f=this.isRangeARangeDefinition(u);if(!p&&(r&&!f)){o.input.push(u.from.key)}else{o.ranges.push(u)}}}}var c=e.getProperty("/property/pauserefresh");if(!c){this.submitAll(e,!e.getProperty("/property/variablescreen"),!c)}else{this.submitAll(e,false,!c)}};this.createTokenFromRange=function(e,t,a,r){if(!r||!r.from){return null}if(!a){a=this.getCharacteristicByName(e,t)}var i=e.getProperty("/property/memberdisplay");var n;if(!a.supportsValueHelp){n=true}var o,l;if(a.type==="DATE"){o=this.getDateFormat();l=sap.ui.core.format.DateFormat.getDateInstance()}else if(a.type==="TIME"){o=this.getTimeFormat();l=sap.ui.core.format.DateFormat.getTimeInstance()}var s=this.isRangeARangeDefinition(r);if(o){s=true}var p,u,f,c;if(r.from){p=r.from.key&&r.from.key.length>0||!r.from.displaykey?r.from.key:r.from.displaykey;u=r.from.displaykey&&r.from.displaykey.length>0||!r.from.key?r.from.displaykey:s?r.from.key:r.from.text;if(o){u=p;try{if(u){c=o.parse(u);if(!c){c=u}f=l.format(c)}}catch(e){}}else{if(n||u===r.from.text){f=sap.ui.comp.util.FormatUtil.getFormattedExpressionFromDisplayBehaviour("idOnly",u)}else{f=sap.ui.comp.util.FormatUtil.getFormattedExpressionFromDisplayBehaviour(this.getValueHelpDialogMemberDisplay(i),u,r.from.text)}}if(!f||f.length<=0){f=u}}else{u="";f=""}var g,m,y,h;if(r.to){g=r.to.key&&r.to.key.length>0||!r.to.displaykey?r.to.key:r.to.displaykey;m=r.to.displaykey&&r.to.displaykey.length>0||!r.to.key?r.to.displaykey:s?r.to.key:r.to.text;if(o){m=g;try{if(m){h=o.parse(m);if(!h){h=m}y=l.format(h)}}catch(e){}}else{if(n||m===r.to.text){y=sap.ui.comp.util.FormatUtil.getFormattedExpressionFromDisplayBehaviour("idOnly",m)}else{y=sap.ui.comp.util.FormatUtil.getFormattedExpressionFromDisplayBehaviour(this.getValueHelpDialogMemberDisplay(i),m,r.to.text)}}if(!y||y.length<=0){y=m}}else{m=undefined;y=undefined}var v=r.operation?r.operation:sap.zen.dsh.ValueHelpRangeOperation.EQ;var P=r.exclude?true:false;var T="key";var b=null;var E=null;if(a.compound){f=u;y=m}if(!s){b=p;E=f}else{b="range"+"_"+P+"_"+v+"_"+u+"_"+m;E=d.prototype._getFormattedRangeTokenText(v,f,y,P,T)}var _=new sap.m.Token({key:b,text:E,tooltip:E});_.data("range",{isRange:s,exclude:P,operation:v,keyField:T,value1:c?c:u,textFrom:f,value2:h?h:m,textTo:y});return _};this.copyToken=function(e){if(!e){return null}var t=new r({key:e.getKey(),text:e.getText(),tooltip:e.getTooltip()});t.data(e.data());return t};this.createRangeFromToken=function(e,t,a,r){if(!r){return null}if(!a){a=this.getCharacteristicByName(e,t)}var i=null;var n=null;var o=r.getKey();var l=r.getText();var s=null;var p=null;var u=r.data("longKey");var f=false;if(r.data("range")){var c=r.data("range");f=c.isRange;i=c.exclude;n=c.operation;if(f){o=c.value1;l=c.textFrom;s=c.value2;p=c.textTo}}else{if(u){o=u}}var g=null;if(o){if(a.type==="DATE"){g=this.getDateFormat();if(!o.getDate){o=g.parse(o)}if(o.getDate){o=g.format(o)}}else if(a.type==="TIME"){g=this.getTimeFormat();if(!o.getTime){o=g.parse(o)}if(o.getTime){o=g.format(o)}}}if(s){if(a.type==="DATE"){if(!g){g=this.getDateFormat()}if(!s.getDate){s=g.parse(s)}if(s.getDate){s=g.format(s)}}else if(a.type==="TIME"){if(!g){g=this.getTimeFormat()}if(!s.getTime){s=g.parse(s)}if(s.getTime){s=g.format(s)}}}var d=this.createRange(i,n,o,l,s,p);return d};this.createRange=function(e,t,a,r,i,n){if(a===null||a===undefined){return null}var o={};if(e){o.exclude=e}if(t){o.operation=t}if(a!==null&&a!==undefined){o.from={};o.from.key=a;if(r){o.from.text=r}}if(i!==null&&i!==undefined){o.to={};o.to.key=i;if(n){o.to.text=n}}return o};this.isRangeARangeDefinition=function(e){var t=true;if(!e.exclude&&(!e.operation||e.operation===sap.zen.dsh.ValueHelpRangeOperation.EQ)){t=false}return t};this.submitExternal=function(e,t,a){return function(r,i){return h.submitAll(e,t,a,r,i)}};this.submitAll=function(e,t,a,r,i){var n=[];var o=e.getProperty("/filters");if(o){for(var l in o){var s=o[l];if(!s){continue}if(s.dirty){var p=this.getCharacteristicByName(e,l);s.dirty=!e.getProperty("/property/variablescreen")&&!t;var u={};u.name=l;if(s.input!==undefined&&s.input!==null){u.input=[];if(Array&&Array.isArray(s.input)||typeof s.input==="object"&&s.input.constructor===Array){u.input=s.input}else{u.input.push(s.input)}}u.ranges=[];n.push(u);var f=s.ranges.length;for(var c=0;c<f;c++){var g=s.ranges[c];if(!g){continue}var d={};if(p.type!=="DATE"&&g.operation&&g.operation!==sap.zen.dsh.ValueHelpRangeOperation.EQ&&!g.exclude&&g.from.displaykey){d.from=g.from.displaykey}else{d.from=g.from.key}if(p.type!=="DATE"&&g.to&&g.to.displaykey){d.to=g.to.displaykey}else if(g.to){d.to=g.to.key}if(g.operation&&g.operation!==sap.zen.dsh.ValueHelpRangeOperation.EQ){d.operation=g.operation}if(g.exclude){d.exclude=true}u.ranges.push(d)}}}}var m=e.getProperty("/characteristics");if(m){var y;for(c=0;c<m.length;c++){var v=m[c];if(!v){continue}if(v.characteristic.axisdirty){if(!y){y=e.getProperty("/axis")}v.characteristic.axisdirty=!t}}if(!y&&(e.getProperty("/axis/rows/dirty")||e.getProperty("/axis/columns/dirty"))){y=e.getProperty("/axis")}if(t&&y){e.setProperty("/axis/rows/dirty",undefined);e.setProperty("/axis/columns/dirty",undefined)}var P=e.getProperty("/property/variablescreen");if(y||n.length>0||P&&t){if(P){sap.zen.MessageViewHandler.clearMessages()}if(!y){y={}}var T={filters:n,axis:y};if(r&&i){var b=h.prepareCommand(i,r,JSON.stringify(T));return b}else{b=h.prepareCommand(e.getProperty(a?"/command/submitfilter":"/command/submitonlyfilter"),"__STRING__",JSON.stringify(T));b=h.prepareCommand(b,"__BOOLEAN__",t?"X":" ");new Function(b)()}}}};this.getValueHelpDialog=function(t){var a=t.getModel();var r=a.getProperty("/dialog/name");var i=a.getProperty("/command/destroyfilterdialog");var n=-1;var o=a.getProperty("/dialog/type");var l=a.getProperty("/dialog/compound");var s=a.getProperty("/dialog/hierarchical");var p=a.getProperty("/dialog/supportsMultiSelection");var u=a.getProperty("/dialog/supportsInterval");var f=a.getProperty("/dialog/supportsRange");var c=a.getProperty("/dialog/supportsIncludingPattern");var g=a.getProperty("/dialog/supportsExcluding");var m=a.getProperty("/dialog/supportsExcludingPattern");var y=a.getProperty("/dialog/supportsValueHelpRange");var v=a.getProperty("/dialog/showValueHelpRangesOnly");var P=a.getProperty("/dialog/showValueHelpConditionEQ");var T=a.getProperty("/dialog/requiresValueHelpRange");var b=a.getProperty("/dialog/range/visible");var E=t.getId()+"_ValueHelpDialog";var _=new d({id:E,title:"{/dialog/title}",supportMultiselect:p?true:false,supportRanges:T?true:false,supportRangesOnly:v?true:false,key:"key",descriptionKey:l?"":"text",ok:function(e){var n=e.getParameter("tokens");h.applyTokensToFilter(a,r,n,false);t.zenValueHelpDialog=null;new Function(h.prepareCommand(i,"__BOOLEAN__"," "))();_.close()},cancel:function(){t.zenValueHelpDialog=null;new Function(h.prepareCommand(i,"__BOOLEAN__","X"))();_.close()},afterClose:function(){if(t.zenValueHelpDialog){t.zenValueHelpDialog=null;new Function(h.prepareCommand(i,"__BOOLEAN__","X"))()}_.destroy()},afterOpen:function(){sap.ui.core.BusyIndicator.hide()}});var x=_.getMetadata;var k=Object.getPrototypeOf(_);if(k){k.getMetadata=function(){var e=x();Object.assign(e,{_sClassName:"sap.ui.comp.valuehelpdialog.ValueHelpDialog"});e.getName=function(){return"sap.ui.comp.valuehelpdialog.ValueHelpDialog"};return e}}if(s){_.setTable(new sap.ui.table.TreeTable)}if(T||b){var F=[];if(P){F.push(sap.zen.dsh.ValueHelpRangeOperation.EQ)}if(y){F.push(sap.zen.dsh.ValueHelpRangeOperation.BT)}if(!p){_.setMaxIncludeRanges("1")}else{if(f){F.push(sap.zen.dsh.ValueHelpRangeOperation.LT);F.push(sap.zen.dsh.ValueHelpRangeOperation.LE);F.push(sap.zen.dsh.ValueHelpRangeOperation.GT);F.push(sap.zen.dsh.ValueHelpRangeOperation.GE);if(c){F.push(sap.zen.dsh.ValueHelpRangeOperation.Contains);F.push(sap.zen.dsh.ValueHelpRangeOperation.StartsWith);F.push(sap.zen.dsh.ValueHelpRangeOperation.EndsWith)}}else if(u){_.setMaxIncludeRanges("1")}}_.setIncludeRangeOperations(F);if(o==="DATE"){_.setIncludeRangeOperations(F,"date")}else if(o==="TIME"){_.setIncludeRangeOperations(F,"time")}}else{_.setMaxIncludeRanges("0")}if(g){var D=[];D.push(sap.zen.dsh.ValueHelpRangeOperation.EQ);if(y||b){D.push(sap.zen.dsh.ValueHelpRangeOperation.BT)}if(!p){_.setMaxExcludeRanges("1")}else{if(f){D.push(sap.zen.dsh.ValueHelpRangeOperation.LT);D.push(sap.zen.dsh.ValueHelpRangeOperation.LE);D.push(sap.zen.dsh.ValueHelpRangeOperation.GT);D.push(sap.zen.dsh.ValueHelpRangeOperation.GE);if(m){D.push(sap.zen.dsh.ValueHelpRangeOperation.Contains);D.push(sap.zen.dsh.ValueHelpRangeOperation.StartsWith);D.push(sap.zen.dsh.ValueHelpRangeOperation.EndsWith)}}else if(u){_.setMaxExcludeRanges("1")}}_.setExcludeRangeOperations(D)}else{_.setMaxExcludeRanges("0")}var C=_.getTable();if(s&&C.attachToggleOpenState){var I;C.attachToggleOpenState(function(e){var t=e.getParameters();_._bIgnoreSelectionChange=true;if(t.expanded){var a=t.rowContext;var r=a.oModel;if(r.getProperty(a.sPath+"/0/node")){var i=h.prepareCommand(r.getProperty("/command/expandnode"),"__STRING__",r.getProperty(a.sPath+"/key"));i=h.prepareCommand(i,"__STRING2__",a.sPath);new Function(i)()}else{_.update()}}});var S=C.onclick;C.onclick=function(){if(S){S.apply(C,arguments)}_._bIgnoreSelectionChange=false;if(I){t.zenValueHelpDialog.update();I=false}};_.attachTokenRemove(function(e){var t=e.getParameters().tokenKeys;if(t&&t.length>0){var a=C.getBinding("rows").getContexts(0);if(a&&a.length>0){for(var r=0;r<t.length;r++){var i=t[r];if(!i){continue}for(var n=0;n<a.length;n++){var o=a[n];if(!o){continue}var l=o.getObject();if(l["key"]===i){C.removeSelectionInterval(n,n);_.setChildSelection(false,l);_.update()}}}}}});_.attachUpdateSelection(function(e){C.clearSelection();var t=e.getParameters().tokenKeys;if(t&&t.length>0){var a=C.getBinding("rows").getContexts(0);if(a&&a.length>0){for(var r=0;r<t.length;r++){var i=t[r];if(!i){continue}var n=null;for(var o=0;o<a.length;o++){var l=a[o];if(!l){continue}var s=l.getObject();if(n!==null){if(n<s.lLevel){C.addSelectionInterval(o,o)}else{n=null}}else if(s["key"]===i){this._oSelectedItems.add(s["key"],s);C.addSelectionInterval(o,o);n=s.lLevel}}}}}});_.attachSelectionChange(function(e){var t=C.getBinding("rows");var a=false;if(t.aKeys){a=true}var r=e.getParameter("tableSelectionParams").rowIndices;var i=e.getParameter("tableSelectionParams").selectAll&&!_.getFilterBar().ZEN_searchValue;if(i&&r.length){_.removeAllSelections(false)}if(!this.getSupportMultiselect()){_.removeAllSelections(true)}for(var n=0;n<r.length;n++){var o=r[n];var l=C.getContextByIndex(o);var s=l?l.getObject():null;if(s){var p;if(a){p=l.sPath.substring(1)}else{p=s["key"]}if(C.isIndexSelected(o)||i){if(!i||!s.level){_.setSelection(true,p,s);_.setChildSelection(false,s)}}else{_.setSelection(false,p,s);_.setChildSelection(false,s)}}}_.update()})}var R=new e;var V=a.getProperty("/property/memberdisplay");_.setTokenDisplayBehaviour(this.getValueHelpDialogMemberDisplay(V));if(V==="KEY"){R.setData({cols:[{label:a.getProperty("/text/key"),template:"displaykey"}]})}else if(V==="TEXT"){R.setData({cols:[{label:a.getProperty("/text/text"),template:"text"}]})}else if(V==="KEY_TEXT"){R.setData({cols:[{label:a.getProperty("/text/key"),template:"displaykey"},{label:a.getProperty("/text/text"),template:"text"}]})}else if(V==="TEXT_KEY"){R.setData({cols:[{label:a.getProperty("/text/text"),template:"text"},{label:a.getProperty("/text/key"),template:"displaykey"}]})}C.setModel(R,"columns");var M={label:a.getProperty("/text/key"),key:"key"};if(b||g){if(o==="DATE"){M.type="date"}else if(o==="TIME"){M.type="time"}}_.setRangeKeyFields([M]);_.setModel(a);C.bindRows("/dialog/members");if(t.$().closest(".sapUiSizeCompact").length>0){_.addStyleClass("sapUiSizeCompact")}this.applyFilterToTokens(t,a,a.getProperty("/dialog/name")).call(_,a.getProperty("/filters"));var w=new sap.m.SearchField({width:"95%",placeholder:"{/text/search}"});var H;if(s){H=a.getProperty("/dialog/members");if(H){for(var O=0;O===n+1;O++){var N=H[""+O];if(!N){continue}N.level=0;n=O}}}if(!a.getProperty("/dialog/nosearch")&&(a.getProperty("/dialog/selection/maxelements")||s)){w.setBusyIndicatorDelay(0);_.TableStateSearchData();w.attachSearch(function(e){w.setBusy(true);_.TableStateDataSearching();var t=e.getParameters().query;w.ZEN_searchValue=t;new Function(h.prepareCommand(a.getProperty("/command/membersearch"),"__STRING__",t))()})}else{H=a.getProperty("/dialog/members");if(H){for(O=0;O<H.length;O++){var z=H[O];if(!z){continue}var B="";if(V!=="KEY"){B+=z.text}if(V!=="TEXT"){if(B){B+=" "}B+=z.displaykey}z.searchstring=B}}w.setShowSearchButton(false);w.attachLiveChange(function(e){var t=e.getParameters().newValue?e.getParameters().newValue.toUpperCase():"";var r=["\\\\","\\^","\\$","\\+","\\.","\\(","\\)","\\[","\\]","\\{","\\}"];for(var i=0;i<r.length;i++){var n=r[i];if(!n){continue}t=t.replace(new RegExp(n,"g"),n)}t=t.replace(/\?/g,".").replace(/\*/g,".*?");var o=new sap.ui.model.Filter("searchstring","Wildcard",t);o.fnTest=function(e){return e.search(new RegExp(t))!==-1};if(!a.getProperty("/dialog/selection/maxelements")&&!a.getProperty("/dialog/hierarchical")){_._bIgnoreSelectionChange=true;_.getTable().getBinding("rows").filter([o]);_._bIgnoreSelectionChange=false;_.update()}});_.TableStateDataFilled()}_.setFilterBar(w);return _};this.getValueHelpDialogMemberDisplay=function(e){switch(e){case"TEXT_KEY":return"descriptionAndId";case"KEY_TEXT":return"idAndDescription";case"TEXT":return"descriptionOnly";default:return"idOnly"}};this.getVariableTechnicalName=function(e){return e.substring(e.indexOf(":")+1,e.length)};function v(e,t){var a=e.getModel();return new n({icon:"sap-icon://action-settings",press:function(){var r=new p({items:{path:"/characteristics",template:new s({title:"{characteristic/text}",selected:{path:"/visibleprompts",formatter:function(e){var t=h.getVariableTechnicalName(this.getBindingContext().getProperty("characteristic/name"));for(var a=0;a<e.length;a++){if(e[a]===t){return true}}return false}}}),filters:[P()],sorter:new f({path:"characteristic/text"})},growingThreshold:0,multiSelect:true,liveChange:function(e){var t=new sap.ui.model.Filter("characteristic/text",sap.ui.model.FilterOperator.Contains,e.getParameter("value"));e.getParameter("itemsBinding").filter([P(),t])},cancel:function(){r.destroy()},confirm:function(r){var i=[];var n=r.getParameter("selectedContexts");for(var o=0;o<n.length;o++){var l=n[o];if(!l){continue}var s=l.getProperty("characteristic/name");var p=s.substring(s.indexOf(":")+1,s.length);i.push(p)}a.setProperty("/visibleprompts",i);t.setValue("");e.ZENCharLists[0].getBinding("formElements").filter([T(i)]);new Function(h.prepareCommand(a.getProperty("/command/setvisibleprompts"),"__ARRAY__",JSON.stringify(i)))()}});r.setModel(a);r.open()}})}function P(){return new sap.ui.model.Filter({path:"characteristic",test:function(e){return e.mandatory?false:true}})}function T(e){return new sap.ui.model.Filter({path:"characteristic",test:function(t){if(t.mandatory){return true}var a=h.getVariableTechnicalName(t.name);for(var r=0;r<e.length;r++){if(e[r]===a){return true}}return false}})}function b(e,t){var a=e.getProperty("/characteristics");if(a){for(var r=0;r<a.length;r++){var i=a[r].characteristic;if(!i){continue}if(i.name===t){return"/characteristics/"+r+"/characteristic"}}}return null}function E(){var e=document.getElementsByClassName("zenDialogOkButton");if(e&&e.length){var t=sap.ui.getCore().byId(e[0].id);if(t){t.setEnabled(false)}}}function _(e,t){if(!e&&t||e&&!t){return false}if(e&&t){if(e.length!==t.length){return false}for(var a=0;a<e.length;a++){var r=e[a].characteristic;var i=t[a].characteristic;if(!r||!i){continue}if(r.name!==i.name||r.axis!==i.axis){return false}}}return true}this.isDesignModeD4LIncluded=function(){return sap.zen.designmode};function x(e,t){var a=e.aBindings.slice(0);jQuery.each(a,function(e,a){if(a.sPath===t){a.checkUpdate(true)}})}this.getCharacteristicByName=function(e,t){var a=e.getProperty("/characteristics");for(var r=0;r<a.length;r++){var i=a[r].characteristic;if(!i){continue}if(i.name===t){return i}}return null};this.getContextMenuAction=function(e,t,a){var r=t.getModel().getProperty("/command/createcontextmenu");if(r&&t.ZEN_IdToDimensionMap){var i=this.getListItemElement(a);if(i&&i[0]){var n=t.ZEN_IdToDimensionMap[i[0].id];var o;if(n){var l=h.prepareCommand(r,"__STRING__",e);l=h.prepareCommand(l,"__STRING2__",n);l=h.prepareCommand(l,"__STRING3__",o);l=h.prepareCommand(l,"__STRING4__",a[0].id);return new Function(l)}}}return null};this.getListItemElement=function(e){if(e.hasClass("sapzenfilterpanelM-ListItem")){return e}else{return e.parents(".sapzenfilterpanelM-ListItem")}};this.getType=function(){return"filter"};this.getDecorator=function(){return"DataSourceControlDecorator"}};var P=new v;h.addHandlers(P.getType(),P,"DataSourceControlDecorator");h.addHandlers("filterpanel",P,"DataSourceControlDecorator");return P});
//# sourceMappingURL=filterpanel_m_handler.js.map