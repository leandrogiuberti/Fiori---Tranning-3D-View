/*
 * SAPUI5
  (c) Copyright 2009-2021 SAP SE. All rights reserved
 */
sap.ui.define(["jquery.sap.global","sap/sac/df/thirdparty/lodash","sap/ui/layout/HorizontalLayout","sap/m/OverflowToolbarLayoutData","sap/ui/layout/Grid","sap/m/Dialog","sap/m/Panel","sap/m/List","sap/m/StandardListItem","sap/m/VBox","sap/m/HBox","sap/m/Token","sap/m/FlexItemData","sap/m/IconTabBar","sap/m/IconTabFilter","sap/ui/core/IconPool","sap/m/Link","sap/m/Button","sap/m/Text","sap/m/Title","sap/m/Bar","sap/ui/core/InvisibleText","sap/m/Tokenizer","sap/zen/dsh/ValueHelpRangeOperation","sap/zen/dsh/utils/BaseHandler","sap/zen/dsh/widgets/messageview_m_handler","sap/m/library","sap/ui/comp/library","sap/ui/table/library","sap/ui/comp/valuehelpdialog/ItemsCollection","sap/ui/core/format/DateFormat","sap/m/P13nConditionPanel","sap/m/P13nFilterPanel","sap/ui/model/odata/type/Boolean","sap/ui/table/Table"],function(jQuery,e,t,i,s,a,o,l,n,r,h,_,u,d,c,p,g,T,f,b,y,S,m,V,v){"use strict";var I=a.extend("sap.zen.dsh.ValueHelpDialog",{metadata:{properties:{basicSearchText:{type:"string",group:"Misc",defaultValue:""},supportMultiselect:{type:"boolean",group:"Misc",defaultValue:true},supportRanges:{type:"boolean",group:"Misc",defaultValue:false},supportRangesOnly:{type:"boolean",group:"Misc",defaultValue:false},key:{type:"string",group:"Misc",defaultValue:""},keys:{type:"string[]",group:"Misc",defaultValue:null},descriptionKey:{type:"string",group:"Misc",defaultValue:""},maxIncludeRanges:{type:"string",group:"Misc",defaultValue:"-1"},maxExcludeRanges:{type:"string",group:"Misc",defaultValue:"-1"},displayFormat:{type:"string",group:"Misc",defaultValue:""},tokenDisplayBehaviour:{type:"string",group:"Misc",defaultValue:""},filterMode:{type:"boolean",group:"Misc",defaultValue:false}},aggregations:{filterBar:{type:"sap.ui.core.Control",multiple:false}},events:{ok:{parameters:{tokens:{type:"sap.m.Token[]"}}},cancel:{},selectionChange:{parameters:{tableSelectionParams:{type:"object"},updateTokens:{type:"object[]"},useDefault:{type:"boolean",defaultValue:false}}},tokenRemove:{parameters:{tokenKeys:{type:"string[]"},useDefault:{type:"boolean",defaultValue:false}}},updateSelection:{parameters:{tokenKeys:{type:"string[]"},useDefault:{type:"boolean",defaultValue:false}}}}},renderer:sap.m.DialogRenderer.render});I.prototype.update=function(e){this._bIgnoreSelectionChange=true;var t=this._oSelectedItems.getItems();var i={tokenKeys:t,useDefault:false};if(this._hasListeners("updateSelection")){this.fireUpdateSelection(i)}else{i.useDefault=true}if(i.useDefault){if(sap.ui.table.Table&&this._oTable instanceof sap.ui.table.Table){this.oRows=this._oTable.getBinding("rows");this._oTable.clearSelection();if(this.oRows.aKeys){var s=this.getKeys();var a=s&&s.length>1?this.getKey()+"=":"";for(var o=0;o<t.length;o++){var l=t[r];var n=a+"'"+l+"'";for(var r=0;r<this.oRows.aKeys.length;r++){var h=this.oRows.aKeys[r];var _=h===l;if(_||h.indexOf(n)>=0){if(!_){this._oSelectedItems.remove(l);var u=this._getTokenByKey(l,this._oSelectedTokens);if(u){u.setKey(h)}}var d=this._oTable.getContextByIndex(r);if(d){c=d.getObject();this._oSelectedItems.add(h,c)}this._oTable.addSelectionInterval(r,r)}}}}else if(this.oRows.aIndices){this._oTable.clearSelection();for(o=0;o<t.length;o++){l=t[o];for(r=0;r<this.oRows.aIndices.length;r++){d=this._oTable.getContextByIndex(r);if(!d){continue}if(d){var c=d.getObject();if(c[this.getKey()]===l){this._oSelectedItems.add(c[this.getKey()],c);this._oTable.addSelectionInterval(r,r)}}}}}}else{var p=this._oTable;for(o=0;o<t.length;o++){l=t[o];for(r=0;r<p.getItems().length;r++){var g=p.getItems()[r];if(!g){continue}var T=g.getBindingContext().getObject();if(T[this.getKey()]===l){p.setSelectedItem(g,true)}}}}}this._bIgnoreSelectionChange=false;this._updateTitles();this._updateMessageView(e)};I.prototype.init=function(){a.prototype.init.apply(this);this._bTableCreatedInternal=false;this._aIncludeRangeOperations={};this._aExcludeRangeOperations={};this.setStretch(this._isPhone());this.setResizable(!this._isPhone());this.setDraggable(!this._isPhone());this.bCollectiveSearchActive=false;this.addStyleClass("compValueHelpDialog");this._oRb=sap.ui.getCore().getLibraryResourceBundle("sap.ui.comp");this._sTableTitle1=this._oRb.getText("VALUEHELPDLG_TABLETITLE1");this._sTableTitle2=this._oRb.getText("VALUEHELPDLG_TABLETITLE2");this._sTableTitleNoCount=this._oRb.getText("VALUEHELPDLG_TABLETITLENOCOUNT");this._currentViewMode=null;this._oSelectedItems=new sap.ui.comp.valuehelpdialog.ItemsCollection;this._oSelectedRanges={};this._createHeaderBar();this._createCollectiveSearch();this._createTokenizer();this._updateTokenizer();this._oVBox=new r({fitContainer:true});this.addContent(this._oVBox);this._oMainLayout=new r({fitContainer:true,items:[this._oFilterBar],layoutData:new u({growFactor:1,shrinkFactor:0})});this._createNavigationControl();this._updateNavigationControl();this._oVBox.addItem(this._oMainLayout);if(this.getMaxIncludeRanges()==="-1"&&this.getMaxExcludeRanges()!=="0"&&!this.getFilterMode()){this._oVBox.addItem(this._oTokenizerGrid)}this._createFooterControls();this.setVerticalScrolling(false);this.setHorizontalScrolling(false);if(!sap.ui.Device.system.desktop){this._oVBox.attachBrowserEvent("touchmove",function(e){e.setMarked()})}if(!this._isPhone()){this._updateView(sap.zen._ValueHelpViewMode.DESKTOP_LIST_VIEW)}};I.prototype._createHeaderBar=function(){this._oTitle=new b;var e=null;if(this._isPhone()){e=new T({visible:false,type:sap.m.ButtonType.Back,press:function(){if(this._currentViewMode===sap.zen._ValueHelpViewMode.PHONE_SEARCH_VIEW){this._updateView(sap.zen._ValueHelpViewMode.PHONE_LIST_VIEW)}else{this._updateView(sap.zen._ValueHelpViewMode.PHONE_MAIN_VIEW)}}.bind(this)});this._oBackButton=e}this.setCustomHeader(new y({contentLeft:e,contentMiddle:this._oTitle}))};I.prototype._createCollectiveSearch=function(){this.oSelectionTitle=new f({visible:false,wrapping:false}).addStyleClass("compVHColSearchText");this.oSelectionButton=new T({icon:"sap-icon://arrow-down",tooltip:this._oRb.getText("VALUEHELPVALDLG_SEARCHTEMPLATES_TOOLTIP"),type:sap.m.ButtonType.Transparent,visible:false,ariaLabelledBy:this.oSelectionTitle}).addStyleClass("compVHColSearchBtn");this._oColSearchBox=new h({fitContainer:true,visible:this.oSelectionButton.getVisible(),items:[this.oSelectionTitle,this.oSelectionButton]}).addStyleClass("compVHColSearchVBox")};I.prototype._createTokenizer=function(){if(this._oTokenizerGrid){return this._oTokenizerGrid}this._oSelectedTokenTitle=new S;this._oSelectedTokens=new m({tokenUpdate:function(e){if(this._ignoreRemoveToken){return}if(e.getParameter("type")===m.TokenChangeType.Removed){var t=[];var i=[];var s=e.getParameter("removedTokens");for(var a=0;a<s.length;a++){var o=s[a];if(!o){continue}var l=o.getKey();if(this._oSelectedRanges&&this._oSelectedRanges[l]){i.push(l);this._removeToken(l)}else{t.push(l);this._oSelectedItems.remove(l);this._removeTokenFromTokenizer(l,this._oSelectedTokens)}}this._removeRangeByKey(i,false);var n={tokenKeys:t,useDefault:false};if(this._hasListeners("tokenRemove")){this._bIgnoreSelectionChange=true;this.fireTokenRemove(n);this._bIgnoreSelectionChange=false}else{n.useDefault=true}if(n.useDefault){t.forEach(function(e){this._changeTableRowSelectionForKey(e,false)}.bind(this))}if(s.length===1){setTimeout(function(){if(this._oSelectedTokens.getTokens()){var e=this._oSelectedTokens.getTokens().length-1;if(e>=0){this._oSelectedTokens.getTokens()[e].focus()}}}.bind(this))}this._updateTitles()}}.bind(this),ariaLabelledBy:this._oSelectedTokenTitle}).addStyleClass("compVHTokensDiv");this._oRemoveAllSelectedItemsBtn=new T({type:sap.m.ButtonType.Transparent,icon:p.getIconURI("sys-cancel"),tooltip:this._oRb.getText("VALUEHELPVALDLG_REMOVETOKENS_TOOLTIP"),press:function(){this._oSelectedTokens.destroyTokens();this._removeRangeByKey(Object.keys(this._oSelectedRanges),false);this._oSelectedItems.removeAll();this._bIgnoreSelectionChange=true;if(this._oTable&&this._oTable.clearSelection){this._oTable.clearSelection()}if(this._oTable&&this._oTable.removeSelections){this._oTable.removeSelections()}this._bIgnoreSelectionChange=false;this._updateTitles()}.bind(this),ariaLabelledBy:this._oSelectedTokenTitle}).addStyleClass("compVHRemoveAllBtn");var e=new t({content:[this._oSelectedTokens,this._oRemoveAllSelectedItemsBtn]}).addStyleClass("compVHTokenizerHLayout");this._oIncludeTokenGrid=new s({width:"100%",defaultSpan:"L12 M12 S12",hSpacing:0,vSpacing:0,content:[this._oSelectedTokenTitle,e]});this._oExcludedTokenTitle=(new f).addStyleClass("compVHSelectedItemsText");this._oExcludedTokens=new m({tokenChange:function(e){if(this._ignoreRemoveToken){return}if(e.getParameter("type")===m.TokenChangeType.Removed||e.getParameter("type")===sap.m.Tokenizer.TokenChangeType.RemovedAll){var t=[];var i=e.getParameter("removedTokens");if(!i||i.length===0){i=[e.getParameter("token")]}for(var s=0;s<i.length;s++){var a=i[s];if(!a){continue}var o=a.getKey();if(this._oSelectedRanges&&this._oSelectedRanges[o]){t.push(o)}}this._removeRangeByKey(t,true);this._updateTitles()}}.bind(this),ariaLabelledBy:this._oExcludedTokenTitle}).addStyleClass("compVHTokensDiv");this._oRemoveAllExcludeItemsBtn=new T({type:sap.m.ButtonType.Transparent,icon:sap.ui.core.IconPool.getIconURI("sys-cancel"),tooltip:this._oRb.getText("VALUEHELPVALDLG_REMOVETOKENS_TOOLTIP"),press:function(){this._oExcludedTokens.destroyTokens();this._removeRangeByKey(Object.keys(this._oSelectedRanges),true);this._updateTitles()}.bind(this),ariaLabelledBy:this._oExcludedTokenTitle}).addStyleClass("compVHRemoveAllBtn");var i=new t({content:[this._oExcludedTokens,this._oRemoveAllExcludeItemsBtn]}).addStyleClass("compVHTokenizerHLayout");this._oExcludeTokenGrid=new sap.ui.layout.Grid({width:"100%",defaultSpan:"L12 M12 S12",hSpacing:0,vSpacing:0,content:[this._oExcludedTokenTitle,i]});this._oTokenizerPanel=new o({expanded:sap.ui.Device.system.desktop,expandable:true,expandAnimation:true,headerText:"",width:"auto",content:[this._oIncludeTokenGrid,this._oExcludeTokenGrid],expand:function(e){this._updateTokenizer();if(e.mParameters.expand&&!(this._oTable instanceof sap.m.Table)){var t=jQuery.sap.domById(this.getId()+"-scrollCont");if(t&&t.scrollTop){t.stop().animate({scrollTop:"1000"},1e3)}}}.bind(this)}).addStyleClass("compVHBackgroundTransparent").addStyleClass("compVHTokensPanel").addStyleClass("compValueHelpDialogTokens");if(this._isPhone()){this._oSelectedTokens.addStyleClass("sapMTokenizerMultiLine");this._oExcludedTokens.addStyleClass("sapMTokenizerMultiLine")}this._oTokenizerGrid=new s({width:"100%",defaultSpan:"L12 M12 S12",hSpacing:0,vSpacing:0,content:this._oTokenizerPanel}).addStyleClass("compVHDarkBackground");return this._oTokenizerGrid};I.prototype._createNavigationControl=function(){if(!this._isPhone()){this._oTabBar=new d({upperCase:true,expandable:false,items:[new c({visible:true,text:this._oRb.getText("VALUEHELPDLG_ITEMSTABLE"),key:sap.zen._ValueHelpViewMode.DESKTOP_LIST_VIEW}),new c({visible:true,text:this._oRb.getText("VALUEHELPDLG_RANGESTITLE",[""]),key:sap.zen._ValueHelpViewMode.DESKTOP_CONDITIONS_VIEW})],select:function(e){this._updateView(e.getParameters().key)}.bind(this)});this._oTabBar.setLayoutData(new u({shrinkFactor:0}));this._oVBox.addItem(this._oTabBar)}else{this._oSelectItemLI=new n({type:sap.m.ListType.Navigation,title:this._oRb.getText("VALUEHELPDLG_ITEMSTABLE")}).data("key",sap.zen._ValueHelpViewMode.PHONE_LIST_VIEW);this._oDefineConditionsLI=new n({type:sap.m.ListType.Navigation,title:this._oRb.getText("VALUEHELPDLG_RANGESTITLE",[""])}).data("key",sap.zen._ValueHelpViewMode.PHONE_CONDITIONS_VIEW);this._oMainListMenu=new l({mode:sap.m.ListMode.None,items:[this._oSelectItemLI,this._oDefineConditionsLI],itemPress:function(e){if(e){this._updateView(e.mParameters.listItem.data("key"))}}.bind(this)});this._oMainListMenu.setLayoutData(new u({shrinkFactor:0}));this._oVBox.addItem(this._oMainListMenu);this._oAdvancedSearchLink=new g({text:this._oRb.getText("VALUEHELPDLG_ADVANCEDSEARCH"),press:function(){this._updateView(sap.zen._ValueHelpViewMode.PHONE_SEARCH_VIEW)}.bind(this)}).addStyleClass("compVHAdvancedSearchLink");this._oAdvancedSearchLink.setLayoutData(new u({shrinkFactor:0}));this._oVBox.addItem(this._oAdvancedSearchLink)}};I.prototype._createFooterControls=function(){var e=this._getMessageView();var t=e.getMessageButton();this.addButton(t);this._oButtonOk=new T({text:this._oRb.getText("VALUEHELPDLG_OK"),press:this._onCloseAndTakeOverValues.bind(this),layoutData:new i({priority:sap.m.OverflowToolbarPriority.NeverOverflow})});this._oButtonCancel=new T({text:this._oRb.getText("VALUEHELPDLG_CANCEL"),press:this._onCancel.bind(this),layoutData:new i({priority:sap.m.OverflowToolbarPriority.NeverOverflow})});if(this._isPhone()){this._oButtonGo=new T({text:this._oRb.getText("VALUEHELPDLG_GO"),type:sap.m.ButtonType.Emphasized,press:this._onGo.bind(this),visible:false,layoutData:new i({priority:sap.m.OverflowToolbarPriority.NeverOverflow})});this._oButtonClear=new T({text:this._oRb.getText("VALUEHELPDLG_CLEAR"),press:this._onClear.bind(this),visible:false,layoutData:new i({priority:sap.m.OverflowToolbarPriority.NeverOverflow})});this.addButton(this._oButtonGo);this.addButton(this._oButtonClear)}this.addButton(this._oButtonOk);this.addButton(this._oButtonCancel)};I.prototype._getMessageView=function(){if(!this._oMessageView){var e=this.getId()+"_MessageView";this._oMessageView=new sap.zen.MessageViewHandler.MessageView(e,null,null,null)}return this._oMessageView};I.prototype._updateMessageView=function(e){var t=this._getMessageView();if(t){t.init(e)}};I.prototype._updateView=function(e){if(this._currentViewMode===e){return}switch(e){case sap.zen._ValueHelpViewMode.DESKTOP_LIST_VIEW:this._validateRanges(function(){this._oTokenizerGrid.setVisible(this.getSupportMultiselect());this._oMainLayout.removeAllItems();if(this._oTabBar&&this._oTabBar.getSelectedKey()!==sap.zen._ValueHelpViewMode.DESKTOP_LIST_VIEW){this._oTabBar.setSelectedKey(sap.zen._ValueHelpViewMode.DESKTOP_LIST_VIEW)}this._oMainLayout.addItem(this._oFilterBar);this._oMainLayout.addItem(this._oTable);this._updateDlgTitle()}.bind(this),function(){this._oTabBar.setSelectedKey(sap.zen._ValueHelpViewMode.DESKTOP_CONDITIONS_VIEW);this._updateView(sap.zen._ValueHelpViewMode.DESKTOP_CONDITIONS_VIEW)}.bind(this));break;case sap.zen._ValueHelpViewMode.DESKTOP_CONDITIONS_VIEW:if(this.getSupportRanges()){this.bCollectiveSearchActive=this.oSelectionTitle.getVisible()&&this.oSelectionButton.getVisible();this._oMainLayout.removeAllItems();if(this._oTabBar&&this._oTabBar.getSelectedKey()!==sap.zen._ValueHelpViewMode.DESKTOP_CONDITIONS_VIEW){this._oTabBar.setSelectedKey(sap.zen._ValueHelpViewMode.DESKTOP_CONDITIONS_VIEW)}this._oMainLayout.addItem(this._getRanges());this._oTokenizerGrid.setVisible(this.getSupportMultiselect());if(!(this.getMaxIncludeRanges()==="-1"&&this.getMaxExcludeRanges()!=="0"&&!this.getFilterMode())){this._oTokenizerGrid.setVisible(false)}}break;case sap.zen._ValueHelpViewMode.PHONE_MAIN_VIEW:this.setVerticalScrolling(false);this._oColSearchBox.setVisible(false);this._oMainListMenu.setVisible(true);this._updateNavigationControl();this._oAdvancedSearchLink.setVisible(false);if(this._oFilterBar&&this._oFilterBar.setFilterBarExpanded){this._oFilterBar.setVisible(false);this._oFilterBar.setFilterBarExpanded(false)}this._oTable.setVisible(false);this._oTokenizerGrid.setVisible(this.getSupportMultiselect());if(!(this.getMaxIncludeRanges()==="-1"&&this.getMaxExcludeRanges()!=="0"&&!this.getFilterMode())){this._oTokenizerGrid.setVisible(false)}if(this._oRanges){this._oRanges.setVisible(false)}this._oButtonGo.setVisible(false);this._oButtonClear.setVisible(false);this._oButtonOk.setVisible(true);this._oButtonCancel.setVisible(true);this._oBackButton.setVisible(false);this._bNoneMainView=false;if(!this._oTokenizerGrid.getVisible()&&!(this._oSelectItemLI.getVisible()&&this._oDefineConditionsLI.getVisible())){this._bNoneMainView=true;if(this._oSelectItemLI.getVisible()){this._updateView(sap.zen._ValueHelpViewMode.PHONE_LIST_VIEW)}if(this._oDefineConditionsLI.getVisible()){this._updateView(sap.zen._ValueHelpViewMode.PHONE_CONDITIONS_VIEW)}return}break;case sap.zen._ValueHelpViewMode.PHONE_LIST_VIEW:this.setVerticalScrolling(true);this._oColSearchBox.setVisible(this.bCollectiveSearchActive);this._oMainListMenu.setVisible(false);if(this._oFilterBar&&this._oFilterBar.getFilterGroupItems){var t=this._oFilterBar&&this._oFilterBar.getFilterGroupItems()&&this._oFilterBar.getFilterGroupItems().length>0;this._oAdvancedSearchLink.setVisible(t);this._oFilterBar.setShowGoButton(!(this._oFilterBar&&this._oFilterBar.getBasicSearch()));this._oFilterBar.setVisible(true);this._oFilterBar.setFilterBarExpanded(false)}this._oTable.setVisible(true);this._oTokenizerGrid.setVisible(false);if(this._oRanges){this._oRanges.setVisible(false)}this._oButtonGo.setVisible(false);this._oButtonClear.setVisible(false);this._oButtonCancel.setVisible(true);this._oBackButton.setVisible(!this._bNoneMainView);break;case sap.zen._ValueHelpViewMode.PHONE_SEARCH_VIEW:this.setVerticalScrolling(true);this._oColSearchBox.setVisible(false);this._oMainListMenu.setVisible(false);if(this._oFilterBar){this._oFilterBar.setVisible(true);this._oFilterBar.setFilterBarExpanded(true)}this._oAdvancedSearchLink.setVisible(false);this._oTable.setVisible(false);this._oTokenizerGrid.setVisible(false);if(this._oRanges){this._oRanges.setVisible(false)}this._oButtonGo.setVisible(true);this._oButtonClear.setVisible(true);this._oButtonOk.setVisible(false);this._oButtonCancel.setVisible(true);this._oBackButton.setVisible(true);break;case sap.zen._ValueHelpViewMode.PHONE_CONDITIONS_VIEW:this.setVerticalScrolling(true);this._oColSearchBox.setVisible(false);this._oMainListMenu.setVisible(false);if(this._oFilterBar){this._oFilterBar.setVisible(false)}this._oAdvancedSearchLink.setVisible(false);this._oTable.setVisible(false);this._oTokenizerGrid.setVisible(false);if(!this._oRanges){this._oMainLayout.addItem(this._getRanges())}this._oRanges.setVisible(true);this._oButtonGo.setVisible(false);this._oButtonClear.setVisible(false);this._oButtonOk.setVisible(true);this._oButtonCancel.setVisible(true);this._oBackButton.setVisible(!this._bNoneMainView);break;default:break}if(this._oMainListMenu&&this._oVBox){if(this._oFilterBar&&this._oFilterBar._handleVisibilityOfToolbar){this._oFilterBar._handleVisibilityOfToolbar()}this._oVBox.rerender()}this._currentViewMode=e;this._updateDlgTitle();if(e===sap.zen._ValueHelpViewMode.DESKTOP_LIST_VIEW){this.update()}};I.prototype._updatePropertySupportMultiselect=function(e){if(!this._oTable){return undefined}if(!this._isPhone()){if(this._oTable.setSelectionMode){this._oTable.setSelectionMode(e?sap.ui.table.SelectionMode.MultiToggle:sap.ui.table.SelectionMode.Single)}}else if(this._oTable.setMode){this._oTable.setMode(e?sap.m.ListMode.MultiSelect:sap.m.ListMode.SingleSelectLeft)}return this};I.prototype._updateNoDataText=function(e){if(this._oTable){if(this._oTable.setNoDataText){this._oTable.setNoDataText(e)}else if(this._oTable.setNoData){this._oTable.setNoData(e)}}};I.prototype._updateTitles=function(){this._updateTableTitle();this._updateTokenizer()};I.prototype._updateDlgTitle=function(){var e="";if(this._oTitle){if(this._oTabBar&&!this._oTabBar.getVisible()&&!this.getFilterMode()){if(this._oTabBar.getSelectedKey()===sap.zen._ValueHelpViewMode.DESKTOP_LIST_VIEW){e="VALUEHELPDLG_TITLE"}else if(this._oTabBar.getSelectedKey()===sap.zen._ValueHelpViewMode.DESKTOP_CONDITIONS_VIEW){if(this.getMaxIncludeRanges()==="1"&&this.getMaxExcludeRanges()==="0"){e="VALUEHELPDLG_SINGLECONDITION_TITLE"}else{e="VALUEHELPDLG_RANGESTITLE";t=""}}}else if(this._isPhone()&&!this.getFilterMode()){switch(this._currentViewMode){case sap.zen._ValueHelpViewMode.PHONE_MAIN_VIEW:e="";break;case sap.zen._ValueHelpViewMode.PHONE_LIST_VIEW:e="VALUEHELPDLG_ITEMSTABLE";break;case sap.zen._ValueHelpViewMode.PHONE_SEARCH_VIEW:e="VALUEHELPDLG_ADVANCEDSEARCH";break;case sap.zen._ValueHelpViewMode.PHONE_CONDITIONS_VIEW:if(this.getMaxIncludeRanges()==="1"&&this.getMaxExcludeRanges()==="0"){e="VALUEHELPDLG_SINGLECONDITION_TITLE"}else{e="VALUEHELPDLG_RANGESTITLE";t=""}break;default:break}}var t=null;if(!t){t=this.getTitle()}if(e){t=this._oRb.getText(e,[t])}if(t){this._oTitle.setText(t)}}};I.prototype._updateTableTitle=function(){if(!this._oTable){return}this.oRows=this._oTable.getBinding("rows");var e=false;if(e&&this.getModel()&&this.getModel().isCountSupported){e=this.getModel().isCountSupported()}var t=0;if(e){if(this.oRows){t=this.oRows.getLength()}this._setTableTitle(this._sTableTitle1.replace("{0}",t))}else{this._setTableTitle(this._sTableTitleNoCount)}};I.prototype._updateTokenizer=function(){var e=false;if(this._oTokenizerPanel){e=this._oTokenizerPanel.getExpanded()}var t=this._oSelectedTokens.getTokens().length;var i=this._oExcludedTokens.getTokens().length;var s=this._oRb.getText("VALUEHELPDLG_SELECTEDITEMS");var a=this._oRb.getText("VALUEHELPDLG_NONESELECTEDITEMS");var o=s.replace("{0}",t.toString());var l=this._oRb.getText("VALUEHELPDLG_EXCLUDEDITEMS",[i.toString()]);var n=t===0?a:o;if(this._oTokenizerPanel){if(!e){if(this._isPhone()){o=this._oRb.getText("VALUEHELPDLG_SELECTEDITEMS_SHORT",[t.toString()]);l=this._oRb.getText("VALUEHELPDLG_EXCLUDEDITEMS_SHORT",[i.toString()])}n="";if(t!==0){n=o}if(i!==0){n+=(t!==0?" / ":"")+l}if(n===""){n=a}}else if(t===0&&i!==0){n=l;l=""}this._oTokenizerPanel.setHeaderText(n);this._oSelectedTokenTitle.setText(n)}else{this._oSelectedTokenTitle.setText(n)}this._oRemoveAllSelectedItemsBtn.setEnabled(t!==0);this._oExcludedTokenTitle.setText(l);if(t===0&&i!==0){this._oIncludeTokenGrid.addStyleClass("displayNone");if(!this._isPhone()){this._oExcludedTokenTitle.addStyleClass("displayNone")}}else{this._oIncludeTokenGrid.removeStyleClass("displayNone");this._oExcludedTokenTitle.removeStyleClass("displayNone")}if(i===0){this._oExcludeTokenGrid.addStyleClass("displayNone")}else{this._oExcludeTokenGrid.removeStyleClass("displayNone")}};I.prototype._updateNavigationControl=function(){var e=!this.getSupportRangesOnly();var t=this.getSupportRangesOnly()||this.getSupportRanges();if(this._oTabBar){var i=this._oTabBar.getItems();i[0].setVisible(e);i[1].setVisible(t);this._oTabBar.setVisible(e&&t);this._updateDlgTitle()}if(this._oMainListMenu){this._oSelectItemLI.setVisible(e);this._oDefineConditionsLI.setVisible(t)}};I.prototype._updateFooterControls=function(){};I.prototype.setSupportMultiselect=function(e){this.setProperty("supportMultiselect",e);this._updatePropertySupportMultiselect(e);this._oTokenizerGrid.setVisible(e);return this};I.prototype.setSupportRanges=function(e){this.setProperty("supportRanges",e);this._updateNavigationControl();return this};I.prototype.setSupportRangesOnly=function(e){this.setProperty("supportRangesOnly",e);this._updateNavigationControl();return this};I.prototype.setTitle=function(e){this.setProperty("title",e);this._updateDlgTitle();return this};I.prototype.setBasicSearchText=function(e){this.setProperty("basicSearchText",e);if(this._oFilterBar&&this._oFilterBar._oBasicSearchField){this._oFilterBar._oBasicSearchField.setValue(e)}return this};I.prototype.setUpdateSingleRowCallback=function(e){this.fSingleRowCallback=e;this._updateNavigationControl()};I.prototype._isPhone=function(){return sap.ui.Device.system.phone};I.prototype._hasListeners=function(e){if(this._bTableCreatedInternal){return false}return this.hasListeners(e)};I.prototype._rotateSelectionButtonIcon=function(e){if(!sap.ui.Device.system.phone){var t=sap.ui.getCore().byId(this.oSelectionButton.$("img")[0].id);if(e){t.addStyleClass("sapUiVHImageExpand")}else{t.removeStyleClass("sapUiVHImageExpand")}}};I.prototype.onAfterRendering=function(){sap.m.Dialog.prototype.onAfterRendering.apply(this);if(this._oTable){this._updateTitles()}if(!this._isPhone()&&this.getContentHeight()===""){if(this.getSupportRangesOnly()&&(this.getMaxExcludeRanges()==="-1"||this.getMaxIncludeRanges()==="-1")){this.setContentHeight("70%")}else{var e=this.getDomRef("scroll");var t=e.clientHeight;this.setContentHeight(t+"px")}if(sap.ui.table.Table&&this._oTable&&this._oTable instanceof sap.ui.table.Table){this._oTable.setVisibleRowCountMode(sap.ui.table.VisibleRowCountMode.Auto)}}};I.prototype._getDialogOffset=function(e){var t=e||this._$Window.width();var i={small:600,large:1024};var s=1;if(t>i.small&&t<i.large||t>=i.large){s=2}var a=function(e){var t=parseInt(window.getComputedStyle(document.body).fontSize,10);return e*t*2};return{top:a(s),left:a(s)}};I.prototype.suggest=function(e){this._fSuggestCallback=e;if(this._oFilterPanel){if(this._oFilterPanel._oIncludeFilterPanel){this._oFilterPanel._oIncludeFilterPanel._fSuggestCallback=this._fSuggestCallback}if(this._oFilterPanel._oExcludeFilterPanel){this._oFilterPanel._oExcludeFilterPanel._fSuggestCallback=this._fSuggestCallback}}};I.prototype.open=function(){this._bIgnoreSelectionChange=false;this.bCollectiveSearchActive=this.oSelectionTitle.getVisible()&&this.oSelectionButton.getVisible();if(this._oColSearchBox){this._oColSearchBox.setVisible(this.bCollectiveSearchActive)}if(!this._isPhone()){if(this.getSupportRangesOnly()||this.getFilterMode()){this._updateView(sap.zen._ValueHelpViewMode.DESKTOP_CONDITIONS_VIEW)}else if(!this._oTable){this._createDefaultTable()}this.setContentWidth(this._getDefaultContentWidth())}else{if(!this._oTable){this._createDefaultTable()}this._updateView(sap.zen._ValueHelpViewMode.PHONE_MAIN_VIEW)}sap.m.Dialog.prototype.open.apply(this);return this};I.prototype.exit=function(){var e=function(e){if(e&&e.destroy){e.destroy()}return null};this._oTokenizerGrid=e(this._oTokenizerGrid);this._oRanges=e(this._oRanges);this._oFilterPanel=e(this._oFilterPanel);if(this._bTableCreatedInternal){this._oTable=e(this._oTable)}this._oTable=null;this.theTable=null;this._oTabBar=e(this._oTabBar);this._oMainListMenu=e(this._oMainListMenu);this._oVBox=e(this._oVBox);this._oVarManagment=e(this._oVarManagment);this._aRangeKeyFields=e(this._aRangeKeyFields);this._aIncludeRangeOperations=e(this._aIncludeRangeOperations);this._aExcludeRangeOperations=e(this._aExcludeRangeOperations);if(this._oFilterBar){this._oFilterBar=e(this._oFilterBar)}this._oRb=e(this._oRb);this._sTableTitle1=e(this._sTableTitle1);this._sTableTitle2=e(this._sTableTitle2);this._sTableTitleNoCount=e(this._sTableTitleNoCount);this._sValidationDialogTitle=e(this._sValidationDialogTitle);this._sValidationDialogMessage=e(this._sValidationDialogMessage);this._sValidationDialogFieldMessage=e(this._sValidationDialogFieldMessage);this._oSelectedItems=e(this._oSelectedItems);this._oSelectedRanges=e(this._oSelectedRanges);this._oButtonOk=e(this._oButtonOk);this._oButtonCancel=e(this._oButtonCancel);if(this._oButtonGo){this._oButtonGo=e(this._oButtonGo)}if(this._oButtonClear){this._oButtonClear=e(this._oButtonClear)}if(this._oColSearchBox){this._oColSearchBox=e(this._oColSearchBox)}a.prototype.exit.apply(this)};I.prototype._onCloseAndTakeOverValues=function(){var e=this;var t=function(){var t=e._oSelectedItems.getSelectedItemsTokenArray(e.getKey(),e.getDescriptionKey(),e.getTokenDisplayBehaviour());if(e._oSelectedRanges){var i=0;for(var s in e._oSelectedRanges){var a=e._oSelectedRanges[s];var o=a.tokenValue;if(!o){o=e._getFormattedRangeTokenText(a.operation,a.value1,a.value2,a.exclude,a.keyField)}if(!a._oGrid||a._oGrid.select.getSelected()){var l=new sap.m.Token({key:"range_"+i}).data("range",{isRange:true,exclude:a.exclude,operation:a.operation,keyField:a.keyField,value1:a.value1,value2:a.value2});l.setText(o);l.setTooltip(typeof o==="string"?o:null);t.push(l);i++}}}e.fireOk({tokens:t})};this._validateRanges(t)};I.prototype._onCancel=function(){this.fireCancel()};I.prototype._onGo=function(){this._oFilterBar.search()};I.prototype._onClear=function(){this._oFilterBar.clear()};I.prototype.setFilterBar=function(e){this.setAggregation("filterBar",e);if(this._oMainLayout&&e){if(this._isPhone()){if(this._oFilterBar){this._oVBox.removeItem(this._oFilterBar)}}else if(this._oFilterBar){this._oMainLayout.removeItem(this._oFilterBar)}this._oFilterBar=e;if(this._oFilterBar){this._oFilterBar.addStyleClass("compVHSearch");if(this._isPhone()){if(this._oFilterBar.getBasicSearch){var t=sap.ui.getCore().byId(this._oFilterBar.getBasicSearch());if(t instanceof sap.m.SearchField){t.setShowSearchButton(true);t.attachSearch(function(e){if(e.mParameters.refreshButtonPressed!==undefined){this.getFilterBar().search()}}.bind(this))}this._oFilterBar.setShowGoOnFB(false)}this._oColSearchBox.setLayoutData(new u({shrinkFactor:0}));this._oVBox.insertItem(this._oColSearchBox,0);if(this._oFilterBar.setLayoutData){this._oFilterBar.setLayoutData(new u({shrinkFactor:0}))}this._oVBox.insertItem(this._oFilterBar,1);this._oFilterBar.attachSearch(function(){this._updateView(sap.zen._ValueHelpViewMode.PHONE_LIST_VIEW)}.bind(this));if(this._currentViewMode===sap.zen._ValueHelpViewMode.PHONE_LIST_VIEW&&this._oFilterBar.setFilterBarExpanded){this._oFilterBar.setVisible(true);this._oFilterBar.setFilterBarExpanded(false);this._handleFilterBarInitialize()}}else{if(this._oFilterBar._setCollectiveSearch){this._oFilterBar._setCollectiveSearch(this._oColSearchBox)}this._oMainLayout.insertItem(this._oFilterBar,0)}}if(this._oFilterBar._oSearchButton){this.setInitialFocus(this._oFilterBar._oSearchButton)}if(this._oFilterBar._oBasicSearchField){var i=this._oFilterBar._oBasicSearchField;i.setValue(this.getBasicSearchText());this.setInitialFocus(i)}}return this};I.prototype._handleFilterBarInitialize=function(){if(this._currentViewMode===sap.ui.comp.valuehelpdialog._ValueHelpViewMode.PHONE_LIST_VIEW){this._oFilterBar._handleVisibilityOfToolbar();var e=this._oFilterBar&&this._oFilterBar.getFilterGroupItems()&&this._oFilterBar.getFilterGroupItems().length>0;this._oAdvancedSearchLink.setVisible(e);this._oFilterBar.setShowGoButton(!(this._oFilterBar&&this._oFilterBar.getBasicSearch()))}};I.prototype.getFilterBar=function(){return this._oFilterBar};I.prototype.setTable=function(e){if(this._oTable){this._oMainLayout.removeItem(this._oTable)}this._bTableCreatedInternal=arguments.length>1&&arguments[1]===true;if(e instanceof sap.ui.comp.smarttable.SmartTable){this._oTable=e.getTable()}else{this._oTable=e}this._oTable.setLayoutData(new u({shrinkFactor:0,growFactor:1}));this.theTable=this._oTable;this._initializeTable();this._oMainLayout.addItem(e)};I.prototype.getTable=function(){if(!this._oTable){this._createDefaultTable()}return this._oTable};I.prototype._setTableTitle=function(e){if(sap.ui.Device.system.desktop&&!(this._oTable instanceof sap.m.Table)){if(this._oTable.getTitle()){this._oTable.getTitle().setText(e)}else{this._oTable.setTitle(e)}}};I.prototype.resetTableState=function(){if(this._oTable){if(this._oTable.unbindRows){this._oTable.unbindRows()}this._updateNoDataText(this._oRb.getText("VALUEHELPDLG_TABLE_PRESSSEARCH"))}};I.prototype._getDefaultContentWidth=function(){var e=0;if(this._oTable){e=this._oTable.getColumns().length}var t=Math.max(1080,e*130);return t+"px"};I.prototype.TableStateSearchData=function(){this._updateNoDataText(this._oRb.getText("VALUEHELPDLG_TABLE_PRESSSEARCH"))};I.prototype.TableStateDataFilled=function(){this._updateNoDataText(this._oRb.getText("VALUEHELPDLG_TABLE_NODATA"))};I.prototype.TableStateDataSearching=function(){this._updateNoDataText(this._oRb.getText("VALUEHELPDLG_TABLE_SEARCHING"))};I.prototype._createDefaultTable=function(){this.setTable(new sap.ui.table.Table,true)};I.prototype._initializeTable=function(){if(sap.ui.table.Table&&this._oTable instanceof sap.ui.table.Table){this._oTable.setTitle(sap.ui.Device.system.desktop?this._sTableTitleNoCount:null);if(this._bTableCreatedInternal){this._oTable.setSelectionBehavior(sap.ui.table.SelectionBehavior.Row)}this._oTable.setSelectionMode(this.getSupportMultiselect()?sap.ui.table.SelectionMode.MultiToggle:sap.ui.table.SelectionMode.Single);this._updateNoDataText(this._oRb.getText("VALUEHELPDLG_TABLE_PRESSSEARCH"));this._oTable.setVisibleRowCountMode(sap.ui.table.VisibleRowCountMode.Fixed);this._oTable.setMinAutoRowCount(sap.ui.Device.system.desktop?5:4);this._oTable.addStyleClass("compVHMainTable")}else{this._oTable.setMode(this.getSupportMultiselect()?sap.m.ListMode.MultiSelect:sap.m.ListMode.SingleSelectLeft);this._oTable.setGrowing(true)}this._oTable.attachRowSelectionChange(E.bind(this));if(!(this._oTable.getParent()instanceof sap.ui.comp.smarttable.SmartTable)){this._oTable.bindAggregation("columns","columns>/cols",k.bind(this))}};function E(e){if(this._bIgnoreSelectionChange||!e.getParameter("userInteraction")){return}var t=e.mParameters;var i={tableSelectionParams:e.mParameters,updateTokens:[],useDefault:false};if(this._hasListeners("selectionChange")){this._bIgnoreSelectionChange=true;this.fireSelectionChange(i);this._bIgnoreSelectionChange=false;i.updateTokens.forEach(function(e){this._addRemoveTokenByKey(e.sKey,e.oRow,e.bSelected)}.bind(this))}else{i.useDefault=true}var s=0;var a=0;var o=null;var l=null;var n=null;if(i.useDefault){if(sap.ui.table.Table&&this._oTable instanceof sap.ui.table.Table){var r=e.getSource();var h=e.getParameter("rowIndices");for(s=0;s<h.length;s++){a=h[s];o=r.getContextByIndex(a);l=o?o.getObject():null;if(!l){sap.m.MessageBox.show(this._oRb.getText("VALUEHELPDLG_SELECTIONFAILED"),{icon:sap.m.MessageBox.Icon.ERROR,title:this._oRb.getText("VALUEHELPDLG_SELECTIONFAILEDTITLE"),actions:[sap.m.MessageBox.Action.OK],styleClass:this.$().closest(".sapUiSizeCompact").length?"sapUiSizeCompact":""});return}}if(!this.getSupportMultiselect()){this._oSelectedTokens.destroyTokens();this._oSelectedItems.removeAll()}var _=false;if(r.getBinding("rows").aKeys){_=true}for(s=0;s<h.length;s++){a=h[s];var u=r.isIndexSelected(a);o=r.getContextByIndex(a);l=o?o.getObject():null;if(l){if(_){n=o.sPath.substring(1)}else{n=l[this.getKey()]}this._addRemoveTokenByKey(n,l,u);this._changeTableRowSelectionForKey(n,u)}}}else{for(s=0;s<t.listItems.length;s++){var d=t.listItems[s];o=d.getBindingContext();l=o?o.getObject():null;if(l){n=l[this.getKey()];this._addRemoveTokenByKey(n,l,t.selected)}}}}if(sap.ui.table.Table&&this._oTable instanceof sap.ui.table.Table){this._updateTitles()}}function k(e,t){if(sap.ui.table.Table&&this._oTable instanceof sap.ui.table.Table){var i,s;if(t.getProperty("type")==="string"){s={path:t.getProperty("template")}}if(t.getProperty("type")==="boolean"){i=new sap.m.CheckBox({enabled:false,selected:{path:t.getProperty("template")}})}else{i=new sap.m.Text({wrapping:false,text:{path:t.getProperty("template"),type:t.getProperty("oType")},tooltip:s})}if(this._oTable instanceof sap.ui.table.AnalyticalTable){return new sap.ui.table.AnalyticalColumn(e,{label:"{columns>label}",tooltip:"{columns>tooltip}",template:i,width:"{columns>width}",hAlign:i instanceof sap.m.CheckBox?sap.ui.core.HorizontalAlign.Center:sap.ui.core.HorizontalAlign.Begin,filterProperty:t.getProperty("filter")})}else{return new sap.ui.table.Column(e,{label:"{columns>label}",tooltip:"{columns>tooltip}",template:i,width:"{columns>width}",hAlign:i instanceof sap.m.CheckBox?sap.ui.core.HorizontalAlign.Center:sap.ui.core.HorizontalAlign.Begin,sortProperty:t.getProperty("sort"),sorted:t.getProperty("sorted"),sortOrder:t.getProperty("sortOrder"),filterProperty:t.getProperty("filter")})}}else{var a=t.getProperty("label");var o=this._oTable.getColumns().length>=2;return new sap.m.Column({header:new sap.m.Label({text:a}),demandPopin:o,minScreenWidth:o?(this._oTable.getColumns().length+1)*10+"rem":"1px"})}}I.prototype._changeTableRowSelectionForKey=function(e,t){this._bIgnoreSelectionChange=true;var i=this._oTable;if(sap.ui.table.Table&&i instanceof sap.ui.table.Table){var s=i.getBinding("rows");if(s){if(s.aKeys){for(var a=0;a<s.aKeys.length;a++){if(s.aKeys[a]===e){if(t){i.addSelectionInterval(a,a)}else{i.removeSelectionInterval(a,a)}}}}else{this.oRows=i.getBinding("rows");if(this.oRows.aIndices){for(a=0;a<this.oRows.aIndices.length;a++){var o=i.getContextByIndex(a);var l=null;if(o){l=o.getObject()}else{l=i.getBinding("rows").oList[this.oRows.aIndices[a]]}if(l[this.getKey()]===e){if(t){i.addSelectionInterval(a,a)}else{i.removeSelectionInterval(a,a)}}}}}}}else{for(a=0;a<i.getItems().length;a++){var n=i.getItems()[a];var r=n.getBindingContext().getObject();if(r[this.getKey()]===e){i.setSelectedItem(n,t);break}}}this._bIgnoreSelectionChange=false};I.prototype.removeAllSelections=function(e){this._oSelectedItems.removeAll();this._oSelectedTokens.removeAllTokens();if(e){this._oSelectedTokens.destroyTokens()}};I.prototype.setSelection=function(e,t,i){var s=true;if(!t){t=i?i.key:undefined}if(t){if(e){this._oSelectedItems.add(t,i);this._addToken2Tokenizer(t,this._getFormattedTokenText(t),this._oSelectedTokens)}else{this._oSelectedItems.remove(t);s=this._removeTokenFromTokenizer(t,this._oSelectedTokens)}}return s};I.prototype.setChildSelection=function(t,i,s){if(i){if(s){this.setSelection(t,i.key,i)}var a=e.filter(i,function(e){return e.key&&!e.node}.bind(this));if(!a||a.length<=0){return}e.forEach(a,function(e){this.setChildSelection(t,e,true)}.bind(this))}};I.prototype.setTokens=function(e){var t=null;if(!e||!e.length){this._oSelectedItems.removeAll();this._oSelectedRanges={};return}for(var i=0;i<e.length;i++){var s=e[i];if(!s){continue}var a=s.getKey();var o=s.getText();var l=s.data("longKey");var n=s.data("row");var r=null;var h=false;if(s.data("range")){r=s.data("range");h=r.isRange}if(r){t=this._getKeyFieldByKey(r.keyField);r.value1=this._convertValue2Object(r.value1,t.type);r.value2=this._convertValue2Object(r.value2,t.type)}if(h){var u=this._getFormattedRangeTokenText(r.operation,r.value1,r.value2,r.exclude,r.keyField);this._addToken2Tokenizer(a,u,r.exclude?this._oExcludedTokens:this._oSelectedTokens);this._oSelectedRanges[a]=r}else{if(l){a=l}this._oSelectedItems.add(a,n?n:o);var d=new _({key:a,text:o,tooltip:o});this._oSelectedTokens.addToken(d)}}};I.prototype._convertValue2Object=function(e,t){if(!e){return e}var i=e;switch(t){case"date":i=new Date(e);break;case"time":i=new Date(e);if(!i||i.getDate&&Number.isNaN(i.getDate())){i=sap.ui.core.format.DateFormat.getTimeInstance().parse(e)}break;case"datetime":i=new Date(e);break;case"numeric":i=parseFloat(e);break;case"boolean":if(e===""){i=null}else{i=e=="true"}break;default:break}return i};I.prototype._getTokenByKey=function(e,t){var i=t.getTokens();for(var s=0;s<i.length;s++){var a=i[s];if(!a){continue}if(a.getKey()===e){return a}}return null};I.prototype._addRemoveTokenByKey=function(e,t,i){if(i){this._oSelectedItems.add(e,t);this._addToken2Tokenizer(e,this._getFormattedTokenText(e),this._oSelectedTokens)}else{this._oSelectedItems.remove(e);this._removeTokenFromTokenizer(e,this._oSelectedTokens)}};I.prototype._removeToken=function(e){if(!this._removeTokenFromTokenizer(e,this._oSelectedTokens)){this._removeTokenFromTokenizer(e,this._oExcludedTokens)}};I.prototype._addToken2Tokenizer=function(e,t,i){var s=typeof t==="string"?t:"";var a=this._getTokenByKey(e,i);if(!a){a=new sap.m.Token({key:e});i.addToken(a);this._updateTokenizer()}if(a){a.setText(t);a.setTooltip(s)}};I.prototype._removeTokenFromTokenizer=function(e,t){var i=this._getTokenByKey(e,t);if(i){this._ignoreRemoveToken=true;t.removeToken(i);this._ignoreRemoveToken=false;this._updateTokenizer();return true}return false};I.prototype._getFormattedTokenText=function(e){var t=this._oSelectedItems.getItem(e);var i=t[this.getDescriptionKey()];var s=t["displaykey"];if(!s){s=i}if(i===undefined){if(typeof t==="string"){i=t}else{i=""}}if(i===""){i=s}else{if(s===i){i=""}i=sap.ui.comp.util.FormatUtil.getFormattedExpressionFromDisplayBehaviour(this.getTokenDisplayBehaviour()?this.getTokenDisplayBehaviour():sap.ui.comp.smartfilterbar.ControlConfiguration.DISPLAYBEHAVIOUR.descriptionAndId,s,i)}return i};I.prototype._getRanges=function(){if(!this._oRanges){this._oRanges=this._createRanges()}return this._oRanges};I.prototype._createRanges=function(){this._oFilterPanel=new sap.m.P13nFilterPanel({maxIncludes:this.getMaxIncludeRanges(),maxExcludes:this.getMaxExcludeRanges(),containerQuery:true,addFilterItem:function(e){var t=e.mParameters;var i={exclude:t.filterItemData.getExclude(),keyField:t.filterItemData.getColumnKey(),operation:t.filterItemData.getOperation(),value1:t.filterItemData.getValue1(),value2:t.filterItemData.getValue2()};this._oSelectedRanges[t.key]=i;var s=this._getKeyFieldByKey(i.keyField);i.value1=this._convertValue2Object(i.value1,s.type);i.value2=this._convertValue2Object(i.value2,s.type);this._oFilterPanel.addFilterItem(t.filterItemData);var a=this._getFormattedRangeTokenText(i.operation,i.value1,i.value2,i.exclude,i.keyField);this._addToken2Tokenizer(t.key,a,i.exclude?this._oExcludedTokens:this._oSelectedTokens);this._updateTokenizer()}.bind(this),removeFilterItem:function(e){var t=e.mParameters;delete this._oSelectedRanges[t.key];this._removeToken(t.key);this._updateTokenizer()}.bind(this),updateFilterItem:function(e){var t=e.mParameters;var i=this._oSelectedRanges[t.key];i.exclude=t.filterItemData.getExclude();i.keyField=t.filterItemData.getColumnKey();i.operation=t.filterItemData.getOperation();i.value1=t.filterItemData.getValue1();i.value2=t.filterItemData.getValue2();var s=this._getKeyFieldByKey(i.keyField);i.value1=this._convertValue2Object(i.value1,s.type);i.value2=this._convertValue2Object(i.value2,s.type);var a=this._getFormattedRangeTokenText(i.operation,i.value1,i.value2,i.exclude,i.keyField);this._addToken2Tokenizer(t.key,a,i.exclude?this._oExcludedTokens:this._oSelectedTokens);this._updateTokenizer()}.bind(this)});this._oFilterPanel._oIncludeFilterPanel.setDisplayFormat(this.getDisplayFormat());this._oFilterPanel._oExcludeFilterPanel.setDisplayFormat(this.getDisplayFormat());this._oFilterPanel._oIncludeFilterPanel._fSuggestCallback=this._fSuggestCallback;this._oFilterPanel._oExcludeFilterPanel._fSuggestCallback=this._fSuggestCallback;this._oFilterPanel._oIncludeFilterPanel._sAddRemoveIconTooltipKey="CONDITION";this._oFilterPanel._oExcludeFilterPanel._sAddRemoveIconTooltipKey="CONDITION";if(this._aIncludeRangeOperations){for(var e in this._aIncludeRangeOperations){this._oFilterPanel.setIncludeOperations(this._aIncludeRangeOperations[e],e)}}if(this._aExcludeRangeOperations){for(e in this._aExcludeRangeOperations){this._oFilterPanel.setExcludeOperations(this._aExcludeRangeOperations[e],e)}}if(this._aRangeKeyFields){this._aRangeKeyFields.forEach(function(e){this._oFilterPanel.addItem(new sap.m.P13nItem({columnKey:e.key,text:e.label,type:e.type,maxLength:e.maxLength,formatSettings:e.formatSettings,scale:e.scale,precision:e.precision,isDefault:e.isDefault,values:e.type==="boolean"?this._getBooleanValues():null}))},this)}if(this._oSelectedRanges){for(var t in this._oSelectedRanges){var i=this._oSelectedRanges[t];var s=this._getKeyFieldByKey(i.keyField);var a;if(s.type==="date"){a=sap.ui.core.format.DateFormat.getDateInstance()}else if(s.type==="time"){a=sap.ui.core.format.DateFormat.getTimeInstance()}var o=i.value1;var l=i.value2;if(a){o=a.format(o);l=a.format(l)}var n=new sap.m.P13nFilterItem({key:t,exclude:i.exclude,columnKey:i.keyField,operation:i.operation});n.setValue1(o);n.setValue2(l);this._oFilterPanel.addFilterItem(n)}}var r=new sap.ui.layout.Grid({width:"100%",defaultSpan:"L12 M12 S12",vSpacing:0,hSpacing:0,content:[this._oFilterPanel]});this._sValidationDialogTitle=this._oRb.getText("VALUEHELPVALDLG_TITLE");this._sValidationDialogMessage=this._oRb.getText("VALUEHELPVALDLG_MESSAGE");this._sValidationDialogFieldMessage=this._oRb.getText("VALUEHELPVALDLG_FIELDMESSAGE");return r};I.prototype.getRangeKeyFields=function(){return this._aRangeKeyFields};I.prototype._getKeyFieldByKey=function(e){var t;if(this._aRangeKeyFields){this._aRangeKeyFields.some(function(i){if(typeof i!=="string"&&i.key===e){t=i;return true}return false})}return t};I.prototype._removeRangeByKey=function(e,t){var i=e;if(typeof i==="string"){i=[i]}i.forEach(function(e,i,s){var a=this._oSelectedRanges[e];if(a.exclude===t&&!a._oGrid){delete this._oSelectedRanges[e];if(this._oFilterPanel){var o=a.exclude?this._oFilterPanel._oExcludeFilterPanel:this._oFilterPanel._oIncludeFilterPanel;if(s.length===1){o.removeCondition(e)}else{o._removeConditionFromMap(e)}}}},this);if(i.length>1&&this._oFilterPanel){var s=t?this._oFilterPanel._oExcludeFilterPanel:this._oFilterPanel._oIncludeFilterPanel;s._clearConditions();s._fillConditions()}};I.prototype._validateRanges=function(e,t){if(this._oRanges){if(!this._oRanges.getParent()){e();return}var i=this._oFilterPanel.validateConditions();if(!i){sap.m.MessageBox.show(this._sValidationDialogMessage,{icon:sap.m.MessageBox.Icon.WARNING,title:this._sValidationDialogTitle,actions:[sap.m.MessageBox.Action.OK,sap.m.MessageBox.Action.CANCEL],styleClass:this.$().closest(".sapUiSizeCompact").length?"sapUiSizeCompact":"",onClose:function(i){if(i===sap.m.MessageBox.Action.OK&&e){e()}if(i===sap.m.MessageBox.Action.CANCEL&&t){t()}}});return}}e()};I.prototype.setRangeKeyFields=function(e){this._aRangeKeyFields=e};I.prototype.setIncludeRangeOperations=function(e,t){t=t||"default";this._aIncludeRangeOperations[t]=e;if(this._oFilterPanel){this._oFilterPanel.setIncludeOperations(this._aIncludeRangeOperations[t],t)}};I.prototype.setExcludeRangeOperations=function(e,t){t=t||"default";this._aExcludeRangeOperations[t]=e;if(this._oFilterPanel){this._oFilterPanel.setExcludeOperations(this._aExcludeRangeOperations[t],t)}};I.prototype._getFormattedRangeTokenText=function(e,t,i,s,a){var o="";var l=null;var n=this._getKeyFieldByKey(a);if(n){switch(n.type){case"numc":l={format:function(e){return this.oType.formatValue(e,"string")},oType:new sap.ui.model.odata.type.String({},n.formatSettings)};break;case"numeric":var r;if(n.precision||n.scale){r={};if(n.precision){r["maxIntegerDigits"]=parseInt(n.precision,10)}if(n.scale){r["maxFractionDigits"]=parseInt(n.scale,10)}}l=sap.ui.core.format.NumberFormat.getFloatInstance(r);break;case"date":l=sap.ui.core.format.DateFormat.getDateInstance(jQuery.extend({},n.formatSettings,{strictParsing:true}));t=new Date(t);i=i!==""?new Date(i):null;break;case"time":l=sap.ui.core.format.DateFormat.getTimeInstance(jQuery.extend({},n.formatSettings,{strictParsing:true}));t=new Date(t);i=i!==""?new Date(i):null;break;case"datetime":l=sap.ui.core.format.DateFormat.getDateTimeInstance(jQuery.extend({},n.formatSettings,{strictParsing:true}));t=new Date(t);i=i!==""?new Date(i):null;break;case"boolean":var h=this._getBooleanValues();t=h[t?2:1];i=h[i?2:1];break;case"stringdate":if(sap.m.P13nConditionStringDateFormatter){l=new sap.m.P13nConditionStringDateFormatter(jQuery.extend({},n.formatSettings,{strictParsing:true}))}break;default:break}if(l){if(t){t=l.format(t)}if(i){i=l.format(i)}}}if(t!==""){switch(e){case V.Initial:o="=''";break;case V.EQ:o="="+t;break;case V.GT:o=">"+t;break;case V.GE:o=">="+t;break;case V.LT:o="<"+t;break;case V.LE:o="<="+t;break;case V.Contains:o=t;if(!o.startsWith("*")){o="*"+o}if(!o.endsWith("*")){o=o+"*"}break;case V.StartsWith:o=t;if(!o.endsWith("*")){o=o+"*"}break;case V.EndsWith:o=t;if(!o.startsWith("*")){o="*"+o}break;case V.BT:if(i!==""){o=t+"..."+i;break}break;default:break}}if(s&&o!==""){o="!("+o+")"}if(this._aRangeKeyFields&&this._aRangeKeyFields.length>1&&n&&n.label&&o!==""){o=n.label+": "+o}return o};I.prototype._getBooleanValues=function(){var e=new sap.ui.model.odata.type.Boolean;var t=null;if(e){t=["",e.formatValue(false,"string"),e.formatValue(true,"string")]}return t};sap.zen._ValueHelpViewMode={DESKTOP_LIST_VIEW:"DESKTOP_LIST_VIEW",DESKTOP_CONDITIONS_VIEW:"DESKTOP_CONDITIONS_VIEW",PHONE_MAIN_VIEW:"PHONE_MAIN_VIEW",PHONE_SEARCH_VIEW:"PHONE_SEARCH_VIEW",PHONE_LIST_VIEW:"PHONE_LIST_VIEW",PHONE_CONDITIONS_VIEW:"PHONE_CONDITIONS_VIEW"};var B=new I;v.dispatcher.addHandlers(B.getType(),B,"DataSourceControlDecorator");return I});
//# sourceMappingURL=ValueHelpDialog.js.map