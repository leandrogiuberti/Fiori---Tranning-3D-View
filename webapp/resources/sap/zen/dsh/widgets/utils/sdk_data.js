/*
 * SAPUI5
  (c) Copyright 2009-2021 SAP SE. All rights reserved
 */
sap.ui.define(["jquery.sap.global","sap/sac/df/thirdparty/lodash","sap/zen/dsh/widgets/utils/info_chart_exception","sap/zen/dsh/utils/BaseHandler"],function(jQuery,e,t){"use strict";function n(n){if(!n){throw new t("mapper.nodata")}var i=c(n);this._dimensions=i.dimensions;this._measureMembers=i.measureMembers;r(this._dimensions);this._tupleTree=e.reduce(i.tuples,function(t,r,a){var s=n.conditionalFormatValues&&n.conditionalFormatValues[a];var o=n.data[a];var u=i.measureMembers[r[i.measureIndex]].key;var c=p(r,i.measureIndex);var l=f(i.dimensions,c);var d={isLeaf:true,measures:{}};d.measures[u]={value:o,index:a};if(s){d.measures[u].conditionalFormat=e.values(s)[0]}m(t,l,d);return t},{})}n.prototype.keepDimensions=function(t){var n=this;function r(s,o){var u=n._dimensions[s];var m=!o.isLeaf&&!e.includes(t,u.key);var c,f;if(o.isLeaf){f=o}else if(m){c=a(o,e.map(u.members,"key"));f=r(s+1,c)}else{f=i(o,e.partial(r,s+1))}return f}this._tupleTree=r(0,this._tupleTree);this._dimensions=e.filter(this._dimensions,function(n){return e.includes(t,n.key)})};function r(e){e.forEach(function(e){if(e.displayMode&&e.displayMode!=="TEXT"){e.members.forEach(function(t){if(e.displayMode==="KEY"){t.text=t.key+" ("+t.text+")"}else if(e.displayMode==="KEY_TEXT"){t.text=t.key+" | "+t.text}else if(e.displayMode==="TEXT_KEY"){t.text=t.text+" | "+t.key}})}})}function i(t,n){var r={};e.forEach(t,function(e,t){r[t]=n(e)});return r}function a(t,n){var r=e.find(n,e.partial(e.has,t));return t[r]}n.prototype.getConditionalFormatValues=function(){var t=this,n={};e.forEach(u(this._tupleTree,this._dimensions),function(r){e.forEach(r.measures,function(i,a){if(i.conditionalFormat){var s=e.map(t._dimensions,"key");var o=e.map(r.tuple,"key");var u=e.object(s,o);u[a]=i.value;n[i.conditionalFormat]=n[i.conditionalFormat]||[];n[i.conditionalFormat].push(u)}})});return n};n.prototype.toFlatData=function(e){return{metadata:{fields:s(this._dimensions,this._measureMembers)},data:o(this,!!e)}};n.prototype.getSDKFormatStrings=function(){return e.reduce(this._measureMembers,function(e,t){if(t.formatString)e[t.key]=t.formatString;return e},{})};n.prototype.getMeasuresArray=function(){return this._measureMembers};function s(t,n){var r=e.map(t,function(e){return{id:e.key,name:e.text,type:"Dimension",semanticType:"Dimension",dataType:"String"}});var i=e.map(n,function(e){return{id:e.key,name:e.text,type:"Measure",semanticType:"Measure",dataType:"Number"}});return r.concat(i)}function o(t,n){var r=e.map(u(t._tupleTree,t._dimensions,n),function(n){var r=e.map(n.tuple,function(e){return{v:e.key,d:e.text}});var i=e.map(t._measureMembers,function(e){var t=n.measures[e.key];if(t){return t.value}else{return null}});return r.concat(i)});return r}function u(t,n,r){var i=[];var a=[];var s=function(t,i,a){if(t.isLeaf){t.tuple=e.map(a,function(r,i){var a=e.find(n[i].members,{key:r});t.containsTotal=t.containsTotal||a.type==="RESULT";return{key:r,text:a.text}});if(!r||r&&!t.containsTotal){i.push(t)}}else{e.forEach(t,function(e,t){s(e,i,a.concat([t]))})}};s(t,i,a);return e.sortBy(i,function(t){var n=e.map(t.measures,"index");return e.min(n)})}function m(t,n,r){if(n.length===0){t.isLeaf=true;t.measures=t.measures||{};e.extend(t.measures,r.measures)}else{t[e.head(n)]=t[e.head(n)]||{};m(t[e.head(n)],e.tail(n),r)}}function c(t){var n=d(t.dimensions)||[];var r=d(t.tuples)||[];var i;var a;var s;var o;if(t.externalDimensions){i=e.find(t.externalDimensions,e.property("containsMeasures"));if(i){n=n.concat(i);r=e.map(r,h)}}a=e.partition(n,e.property("containsMeasures"));o=a[0][0]&&a[0][0].members;if(!o){o=[{key:" ",text:" "}];r=e.map(r,h);s=n.length}else{s=l(n,e.property("containsMeasures"))}return{dimensions:a[1],measureMembers:o,measureIndex:s,tuples:r}}function f(t,n){if(t.length!==n.length){throw new Error("Tuples do not match dimensions")}return e.map(n,function(e,n){return t[n].members[e].key})}function l(e,t){for(var n=0;e&&e.length&&n<e.length;n++){if(t(e[n])){return n}}return-1}function p(e,t){var n=e.slice(0);n.splice(t,1);return n}function d(e){return e&&e.slice(0)||[]}function h(e){return e.concat(0)}return n});
//# sourceMappingURL=sdk_data.js.map