/*
 * SAPUI5
  (c) Copyright 2009-2021 SAP SE. All rights reserved
 */
sap.ui.define(["jquery.sap.global","sap/sac/df/thirdparty/lodash","sap/zen/dsh/utils/BaseHandler","sap/zen/dsh/widgets/transitionhandler","sap/zen/commons/layout/AbsoluteLayout","sap/ui/core/Popup"],function(jQuery,_,BaseHandler,transitions){"use strict";var PopupHandler=function(){BaseHandler.apply(this,arguments);var dispatcher=BaseHandler.dispatcher;var baseDuration=600,that=this;function init(t,o){var e=o.content;if(e){that.updateChildren(e,t,function(o,e){dispatcher.insertIntoAbsoluteLayoutContainer(t,o,e)},function(o){t.removeContent(o)})}}function isAuto(t){return t===undefined||t==="auto"}this.createAndAdd=function(t,o,e,i,n){var r=null,a={},s,p;if(sap.zen.designmode){s=this.createAbsoluteLayout(o["id"]);a.isAbsLayout=true;s.oPopupProperties=a;i(s,n);BaseHandler.dispatcher.updateComponentProperties(s,e);init(s,o);s.addStyleClass("popup");return s}else{s=this.createAbsoluteLayout(o["id"]+"_abs");s.zenControlType=o.type;s.zenPopupHackId=o["id"];p=this.createDefaultProxy(o["id"]);p.oCommand=o.command;p.zenPopupHackId=o["id"]+"_abs";a.oAbsLayout=s;a.isAbsLayout=false;r=jQuery.extend({},e);a.positioner=new Positioning(r);p.oPopupProperties=a;a.positioner.calculateDimensions(e);a.positioner.setInvisible(e);i(s,n);BaseHandler.dispatcher.updateComponentProperties(s,e);init(s,o);if(o.show){setTimeout(function(){e.leftmargin=r.leftmargin;e.rightmargin=r.rightmargin;that.update(p,o,e,i,n)},50)}return p}};this.update=function(t,o,e){var i=t.oPopupProperties;var n=i.isAbsLayout?t:i.oAbsLayout;o=o||{};init(n,o);if(!sap.zen.designmode&&Object.prototype.hasOwnProperty.call(o,"show")){if(o.show){i.positioner.calculateDimensions(e);if(e.width>0&&e.height>0){var r=null;if(o.cid){r=dispatcher.getRootControlForComponentId(o.cid)}this.show(t,o,e,r,n)}}else{if(t.oPopup&&t.oPopup.isOpen()){if(o.animation.toLowerCase()==="slidevertical"&&!isAuto(e.bottommargin)&&isAuto(e.topmargin)&&t.oPopup.getOpenState()==="OPENING"){setTimeout(function(){that.hide(t)},baseDuration*1.5)}else{this.hide(t)}}else if(!Object.prototype.hasOwnProperty.call(t,"oPopup")&&!sap.zen.designmode){i.positioner.setInvisible(e)}}t.setVisible(false)}return t};var super_remove=this.remove;this.remove=function(t){super_remove.call(this,t);if(t.zenPopupHackId){var o=sap.ui.getCore().byId(t.zenPopupHackId);if(o){BaseHandler.dispatcher.dispatchRemove(o)}}};this.show=function(t,o,e,i,n){var r;i=i||null;if(!t.oPopup){this.createPopup(t,o,n)}else if(t.oPopup.isOpen()){return}r=this.configureTransitions(t,o);r&&r.preOperations({oComponentProperties:e,oAbsLayout:t});t.oPopupProperties["duration"]=r.getDuration()||baseDuration;t.oPopup.open(t.oPopupProperties["duration"]);r&&r.postOperations({oComponentProperties:e,oAbsLayout:t})};this.hide=function(t){t&&t.oPopup&&t.oPopup.close(t.oPopupProperties["duration"])};this.createPopup=function(t,o,e){if(o.modal){o.autoclose=false}t.oPopup=new sap.ui.core.Popup(e,!!o.modal,true,!!o.autoclose);var i=e.destroy;e.destroy=function(t){if(this.zenPopupHackId){var o=sap.ui.getCore().byId(this.zenPopupHackId);if(o){var n=o.oPopup;if(n&&n.destroy){n.destroy(t)}}}if(i){i.call(e,t)}};t.oPopup.attachClosed(function(){that.freeResources(t)})};this.freeResources=function(oControl){if(oControl.oCommand){var command=that.prepareCommand(oControl.oCommand,"__VALUE__","false");eval(command)}if(oControl&&oControl.oPopup){oControl.oPopup.destroy();oControl.oPopup=null}};var transitionHandler={};this.registerTransitionHandler=function(t,o){transitionHandler[t]=o};this.getTransitionHandler=function(t,o){if(t!=="none"&&(jQuery.browser.msie||!document.getElementById("ROOT_absolutelayout"))){return new transitionHandler["fade"](o)}return new transitionHandler[t](o)};this.configureTransitions=function(t,o){var e=this.getTransitionHandler(o.animation.toLowerCase(),t.oPopupProperties.positioner);t.oPopup.setAnimations(e.open,e.close);return e};this.applyForChildren=function(t,o){if(!t.getPositions){return null}var e=t.getPositions();for(var i=0;i<e.length;i++){var n=e[i].getControl();if(n){var r=o(n);if(r)return r}}return null};this.getDefaultProxyClass=function(){return["sap.m.Text","sap.ui.commons.TextView"]};this.getDecorator=function(){return"PopupDecorator"};this.getType=function(){return"popup"}};var Positioning=function(){var t="13 -10",o=1e3;this.store=arguments[0]||{};this.dockingPosition=null;function e(t){return t===undefined||t==="auto"}this.getComponentProperties=function(){return this.store};this.calculateRedocking=function(t){var o=Math.round(t.outerWidth()-t.width());var i=Math.round(t.outerHeight()-t.height());var n={top:"auto",bottom:"auto",left:"auto",right:"auto"};if(!e(this.store.bottommargin)){if(!e(this.store.topmargin)){n.bottom=this.store.bottommargin-i+"px"}else{n.bottom=this.store.bottommargin+"px"}}if(!e(this.store.topmargin)){n.top=this.store.topmargin+"px"}if(!e(this.store.leftmargin)){n.left=this.store.leftmargin+"px"}if(!e(this.store.rightmargin)){if(!e(this.store.leftmargin)){n.right=this.store.rightmargin-o+"px"}else{n.right=this.store.rightmargin+"px"}}return this.dockingPosition=n};this.getDockingPosition=function(){return this.dockingPosition};this.calculateDimensions=function(t){var o=jQuery("body");var i=o.width(),n=o.height();if(e(t.width)){t.width=i-parseInt(t.leftmargin)-parseInt(t.rightmargin);t.rightmargin="auto"}if(e(t.height)){t.height=n-parseInt(t.topmargin)-parseInt(t.bottommargin);t.bottommargin="auto"}};this.calculatePosition=function(o,i){var n,r,a,s;if(!e(o.leftmargin)){a=parseInt(o.leftmargin);if(!e(o.topmargin)){s=parseInt(o.topmargin);n=r=sap.ui.core.Popup.Dock.LeftTop}else{s=parseInt(o.bottommargin)*-1;n=r=sap.ui.core.Popup.Dock.LeftBottom}}else if(!e(o.rightmargin)){a=parseInt(o.rightmargin)*-1;if(!e(o.bottommargin)){s=parseInt(o.bottommargin)*-1;n=r=sap.ui.core.Popup.Dock.RightBottom}else{s=parseInt(o.topmargin);n=r=sap.ui.core.Popup.Dock.RightTop}}return{my:i?sap.ui.core.Popup.Dock.LeftTop:n,at:i?sap.ui.core.Popup.Dock.RightTop:r,of:document,offset:i?t:a+" "+s,collision:"none"}};this.setInvisible=function(t){if(!e(t.leftmargin)){t.leftmargin="-5000"}else if(!e(t.rightmargin)){t.rightmargin="5000"}};this.getHorizontalOffset=function(t){var i;if(!e(t.leftmargin)){i=parseInt(t.width)?-parseInt(t.width)-10:-o;if(!e(t.topmargin)){i+=" "+parseInt(t.topmargin)}else{i+=" "+parseInt(t.bottommargin)*-1}}else if(!e(t.rightmargin)){i=parseInt(t.width)?parseInt(t.width)+10:o;if(!e(t.topmargin)){i+=" "+parseInt(t.topmargin)}else{i+=" "+parseInt(t.bottommargin)*-1}}return i};this.getVerticalOffset=function(t){var i;if(!e(t.topmargin)){i=parseInt(t.height)?-parseInt(t.height)-10:-o;if(!e(t.leftmargin)){i=parseInt(t.leftmargin)+" "+i}else{i=parseInt(t.rightmargin)*-1+" "+i}}else if(!e(t.bottommargin)){i=parseInt(t.height)?parseInt(t.height)+10:o;if(!e(t.leftmargin)){i=parseInt(t.leftmargin)+" "+i}else{i=parseInt(t.rightmargin)*-1+" "+i}}return i}};var handler=new PopupHandler;for(var i=0;i<transitions.length;i++){var transition=transitions[i];handler.registerTransitionHandler((new transition).getType(),transition)}return handler});
//# sourceMappingURL=popup_handler.js.map