/*
 * SAPUI5
  (c) Copyright 2009-2021 SAP SE. All rights reserved
 */
sap.ui.define(["jquery.sap.global","sap/zen/dsh/utils/BaseHandler","sap/ui/model/json/JSONModel"],function(jQuery,e,a){"use strict";sap.zen.MessageViewHandler=function(){e.apply(this,arguments);this.getType=function(){return"messageview"};var s=null,t=null;var n={hDist:15,vDist1:15,vDist2:80,oMainLayout:undefined,oPopup:undefined,iInitialLayoutHeight:0,bDynamicHeight:undefined};var i={},o=null,r={},l="180px",g="60px",d={top:"auto",bottom:"auto",left:"auto",right:"auto"};this.create=function(e,a,n){var o=a["id"],l;a=a||{};if(a.texts){i=a.texts}if(a.log_command){sap.zen.MessageViewHandler.JSMessageHandler.sLogCommand=a.log_command}if(a.application_properties){r=a.application_properties;sap.zen.MessageViewHandler.JSMessageHandler.sMessageTypes=a.application_properties.message_types}else{l=new sap.ui.commons.Button(o,{width:"150px",height:"50px"});l.setVisible(false);sap.zen.MessageViewHandler.JSMessageHandler.oNotificationButton=l;sap.zen.MessageViewHandler.JSMessageHandler.createSavedMessages();return l}l=this.buildUI(o,n);if(a.messages){p(a);t.setData(s.getData())}else if(sap.zen.MessageViewHandler.JSMessageHandler.oOldDataModel&&!sap.zen.MessageViewHandler.bIsVariableScreen){s.setData(sap.zen.MessageViewHandler.JSMessageHandler.oOldDataModel);t.setData(s.getData());sap.zen.MessageViewHandler.JSMessageHandler.oOldDataModel=null}else{l.setVisible(false)}sap.zen.MessageViewHandler.JSMessageHandler.oNotificationButton=l;sap.zen.MessageViewHandler.JSMessageHandler.createSavedMessages();var g=l;if(!sap.zen.MessageViewHandler.bIsVariableScreen){var d=this.createAbsoluteLayout(o+"_abs");d.setHorizontalScrolling(sap.ui.core.Scrolling.None);d.setVerticalScrolling(sap.ui.core.Scrolling.None);d.insertContent(l,0);if(!d.fSaveOnAfterRendering){d.fSaveOnAfterRendering=d.onAfterRendering;d.onAfterRendering=function(){if(d.fSaveOnAfterRendering){d.fSaveOnAfterRendering()}if(!sap.zen.MessageViewHandler.bIsVariableScreen){var e=jQuery("#sap-ui-blocklayer-popup");var a=jQuery(window.document.getElementById(this.getId()));if(e&&e.length>0&&e.css("visibility")==="visible"&&e.outerWidth()>0&&e.outerHeight()>0){var s=e.css("z-index");if(s&&s.length>0){var t=parseInt(s,10);a.css("z-index",""+(t+1))}}else{a.css("z-index","auto")}}}}g=d}return g};this.update=function(e,a,n){if(a&&a.messages&&a.messages.length>0&&s){p(a);t.setData(s.getData());var i;if(e.getContent){i=e.getContent()[0]}else{i=e}i.setVisible(true);i.removeStyleClass("zenDialogMsgButton")}if(n){this.setMessagePosition(n)}return e};this.buildUI=function(e,r){s=new sap.zen.MessageViewHandler.DataModel;sap.zen.MessageViewHandler.JSMessageHandler.oDataModel=s;sap.zen.MessageViewHandler.JSMessageHandler.oRenderData=n;var p=s.getData();t=new a;sap.zen.MessageViewHandler.JSMessageHandler.oJsonModel=t;t.setData(p);sap.ui.getCore().setModel(t);var u=new sap.ui.commons.layout.BorderLayout;sap.zen.MessageViewHandler.JSMessageHandler.oRenderData.oMainLayout=u;u.addStyleClass("sapzenmessageview-PopupContainer");var c=new sap.ui.commons.RowRepeater("",{design:"BareShell",numberOfRows:15,currentPage:1});c.bindAggregation("rows",{path:"/data",factory:function(e,a){var n=new sap.ui.commons.layout.BorderLayout;n.addStyleClass("sapzenmessageview-RowRepeaterRow");n.setWidth("320px");n.setHeight("60px");var o=function(e){var a;var s;if(e.oSource){a=e.oSource.oParent.oParent;s=this}else{a=sap.ui.getCore().byId(jQuery(e.target.parentElement.parentElement.parentElement.parentElement).attr("id"));s=a.getBegin().getContent()[0]}var t=a.getBottom();if(t.getVisible()){a.setHeight(g);t.setVisible(false);s.removeStyleClass("sapzenmessageview-ExpandImageActive");a.removeStyleClass("sapzenmessageview-RowRepeaterRowActive")}else{a.setHeight(l);t.setVisible(true);s.addStyleClass("sapzenmessageview-ExpandImageActive");a.addStyleClass("sapzenmessageview-RowRepeaterRowActive")}};var r=new sap.ui.commons.Image;r.addStyleClass("sapzenmessageview-ExpandImage");r.setSrc(sap.zen.createStaticMimeUrl("zen.rt.components/resources/img/transparent.png"));r.setAlt(i.expand);r.attachPress(o);n.addContent(sap.ui.commons.layout.BorderLayoutAreaTypes.begin,r);n.setAreaData(sap.ui.commons.layout.BorderLayoutAreaTypes.begin,{size:"36px",visible:true});var d=new sap.ui.commons.layout.HorizontalLayout;var p=new sap.ui.commons.Image;var u="sapzenmessageview-LevelImageInfo";var c=t.getProperty(a+"/message/level");if(c==="ERROR"){u="sapzenmessageview-LevelImageError"}else if(c==="WARNING"){u="sapzenmessageview-LevelImageWarning"}p.setSrc(sap.zen.createStaticMimeUrl("zen.rt.components/resources/img/transparent.png"));p.addStyleClass(u);d.addContent(p);var m=new sap.ui.commons.TextView;m.setDesign(sap.ui.commons.TextViewDesign.H2);m.addStyleClass("sapzenmessageview-HeaderText");m.bindProperty("text",a+"/message/short_text");m.setWrapping(false);d.addContent(m);d.attachBrowserEvent("click",o);n.addContent(sap.ui.commons.layout.BorderLayoutAreaTypes.center,d);n.setAreaData(sap.ui.commons.layout.BorderLayoutAreaTypes.center,{visible:true});var h=new sap.ui.commons.Image;h.setSrc(sap.zen.createStaticMimeUrl("zen.rt.components/resources/img/transparent.png"));h.addStyleClass("sapzenmessageview-RemoveImage");h.setAlt(i.remove);h.attachPress(function(e){s.remove(e.oSource.getBindingContext().sPath);t.setData(s.getData())});n.addContent(sap.ui.commons.layout.BorderLayoutAreaTypes.end,h);n.setAreaData(sap.ui.commons.layout.BorderLayoutAreaTypes.end,{size:"39px",visible:true});var f=new sap.ui.commons.TextView;f.bindProperty("text",a+"/message/long_text");n.addContent(sap.ui.commons.layout.BorderLayoutAreaTypes.bottom,f);n.setAreaData(sap.ui.commons.layout.BorderLayoutAreaTypes.bottom,{size:"120px",contentAlign:"left",visible:false});return n}});var m=new sap.ui.commons.TextView("",{text:i.no_notifications});m.setDesign(sap.ui.commons.TextViewDesign.H1);m.addStyleClass("sapzenmessageview-NoNotifications");c.setNoData(m);u.addContent(sap.ui.commons.layout.BorderLayoutAreaTypes.center,c);var h=new sap.ui.commons.layout.BorderLayout;h.addStyleClass("sapzenmessageview-PopupContainerHeader");o=new sap.ui.commons.TextView;o.bindProperty("text","/length",function(e){return e+" "+(e===1?i.notification_header_singular:i.notification_header)});o.setDesign(sap.ui.commons.TextViewDesign.H1);h.addContent(sap.ui.commons.layout.BorderLayoutAreaTypes.center,o);var f=new sap.ui.commons.Button;f.setText(i.clear_all);f.attachPress(function(){s.removeAll();t.setData(s.getData());M.close(100)});h.addContent(sap.ui.commons.layout.BorderLayoutAreaTypes.end,f);h.setAreaData(sap.ui.commons.layout.BorderLayoutAreaTypes.begin,{size:"75px",visible:true});h.setAreaData(sap.ui.commons.layout.BorderLayoutAreaTypes.center,{visible:true});h.setAreaData(sap.ui.commons.layout.BorderLayoutAreaTypes.end,{size:"75px",visible:true});u.addContent(sap.ui.commons.layout.BorderLayoutAreaTypes.top,h);u.setAreaData(sap.ui.commons.layout.BorderLayoutAreaTypes.top,{visible:true});u.attachBrowserEvent("mousedown",function(){jQuery.sap.delayedCall(0,this,function(){f.focus()})});var v=new sap.ui.commons.Button(e,{text:"{/length}",icon:sap.zen.createStaticMimeUrl("zen.rt.components/resources/img/transparent.png")});if(!sap.zen.MessageViewHandler.bIsVariableScreen){v.setWidth(sap.zen.MessageViewHandler.width+"px");v.setHeight(sap.zen.MessageViewHandler.height+"px")}s.addMaxLevelChangeListener(function(e){v.removeStyleClass("sapzenmessageview-ButtonLevelImageInfo");v.removeStyleClass("sapzenmessageview-ButtonLevelImageWarning");v.removeStyleClass("sapzenmessageview-ButtonLevelImageError");var a;if(e==="INFO"){a="sapzenmessageview-ButtonLevelImageInfo"}else if(e==="WARNING"){a="sapzenmessageview-ButtonLevelImageWarning"}else{a="sapzenmessageview-ButtonLevelImageError"}v.addStyleClass(a)});this.setMessagePosition(r);var M=new sap.ui.core.Popup(u,false,true,false);n.oPopup=M;var w=this;v.attachPress(function(){if(M.isOpen()){M.close(100)}else{w.openMessagePopup(M)}});if(sap.zen.dsh.sapbi_isMobile){u.attachBrowserEvent("touchstart",function(){var e=jQuery(this.$().children()[1]);if(e.scrollTop()===0){e.scrollTop(1)}});u.attachBrowserEvent("touchmove",function(e){var a=jQuery(this.$().children()[1]);var s=c.$().height()-a.outerHeight()-1;if(s<5||!jQuery(e.target).parents("#"+a.attr("id")).length){return false}if(a.scrollTop()<1){a.scrollTop(0)}if(a.scrollTop()>=s){a.scrollTop(s)}e.stopPropagation()})}M.attachClosed(function(){if(!t.getProperty("/length")){v.setVisible(false)}});M.setAnimations(function(e,a,s){e.css("top",d.top);e.css("bottom",d.bottom);e.css("left",d.left);e.css("right",d.right);s()},function(e,a,s){s()});return v};this.openMessagePopup=function(e){var a,s,t=[];d={top:"auto",bottom:"auto",left:"auto",right:"auto"};if(r.message_popup_position==="LEFT"){if(r.message_position==="BOTTOMLEFT"||r.message_position==="BOTTOMRIGHT"){a=s=sap.ui.core.Popup.Dock.LeftBottom;t[0]=n.hDist;t[1]=r.message_position==="BOTTOMLEFT"?-n.vDist2:-n.vDist1;if(sap.zen.MessageViewHandler.fCalculationCallback){sap.zen.MessageViewHandler.fCalculationCallback(t,r.message_popup_position,r.message_position)}d.left=(t[0]>=0?t[0]:-t[0])+"px";d.bottom=(t[1]>=0?t[1]:-t[1])+"px"}else{a=s=sap.ui.core.Popup.Dock.LeftTop;t[0]=n.hDist;t[1]=r.message_position==="TOPLEFT"?n.vDist2:n.vDist1;if(sap.zen.MessageViewHandler.fCalculationCallback){sap.zen.MessageViewHandler.fCalculationCallback(t,r.message_popup_position,r.message_position)}d.left=(t[0]>=0?t[0]:-t[0])+"px";d.top=(t[1]>=0?t[1]:-t[1])+"px"}}else{if(r.message_position==="BOTTOMLEFT"||r.message_position==="BOTTOMRIGHT"){a=s=sap.ui.core.Popup.Dock.RightBottom;t[0]=-n.hDist;t[1]=r.message_position==="BOTTOMRIGHT"?-n.vDist2:-n.vDist1;if(sap.zen.MessageViewHandler.fCalculationCallback){sap.zen.MessageViewHandler.fCalculationCallback(t,r.message_popup_position,r.message_position)}d.right=(t[0]>=0?t[0]:-t[0])+"px";d.bottom=(t[1]>=0?t[1]:-t[1])+"px"}else{a=s=sap.ui.core.Popup.Dock.RightTop;t[0]=-n.hDist;t[1]=r.message_position==="TOPRIGHT"?n.vDist2:n.vDist1;if(sap.zen.MessageViewHandler.fCalculationCallback){sap.zen.MessageViewHandler.fCalculationCallback(t,r.message_popup_position,r.message_position)}d.right=(t[0]>=0?t[0]:-t[0])+"px";d.top=(t[1]>=0?t[1]:-t[1])+"px"}}e.setPosition(a,s,document,t.join(" "));e.open(100)};this.setMessagePosition=function(e){var a=n.vDist1;var s=n.hDist;if(!sap.zen.MessageViewHandler.bIsVariableScreen){e.width="0";e.height="0";a=a+sap.zen.MessageViewHandler.height;s=s+sap.zen.MessageViewHandler.width}else{e.width=sap.zen.MessageViewHandler.width;e.height=sap.zen.MessageViewHandler.height}if(r.message_position==="BOTTOMLEFT"){e.leftmargin=n.hDist;e.bottommargin=a;e.topmargin="auto";e.rightmargin="auto"}else if(r.message_position==="BOTTOMRIGHT"){e.leftmargin="auto";e.bottommargin=a;e.topmargin="auto";e.rightmargin=s}else if(r.message_position==="TOPLEFT"){e.leftmargin=n.hDist;e.bottommargin="auto";e.topmargin=n.vDist1;e.rightmargin="auto"}else if(r.message_position==="TOPRIGHT"){e.leftmargin="auto";e.bottommargin="auto";e.topmargin=n.vDist1;e.rightmargin=s}};var p=function(e){var a;for(var t=0;t<e.messages.length;t++){a=e.messages[t];s.add(a)}}};sap.zen.MessageViewHandler.DataModel=function(){this.oDataObject={};this.oDataObject.data=[];this.oDataObject.data.messageNumber=0;this.maxLevelChangelisteners=[];this.add=function(e){this.oDataObject.data.unshift(e);this.oDataObject.length=this.oDataObject.data.length;this.maxLevelNotify()};this.remove=function(e){var a=e.lastIndexOf("/");var s=parseInt(e.substring(a+1));this.oDataObject.data.splice(s,1);this.oDataObject.length=this.oDataObject.data.length;this.maxLevelNotify()};this.removeAll=function(){this.oDataObject.data=[];this.oDataObject.length=0;this.maxLevelNotify()};this.getData=function(){return this.oDataObject};this.setData=function(e){for(var a=0;a<e.length;a++){this.add(e[a])}};this.maxLevelNotify=function(){var e=this.oDataObject.maxLevel,a;this.oDataObject.maxLevel="INFO";for(a=0;a<this.oDataObject.data.length&&(this.oDataObject.maxLevel==="INFO"||this.oDataObject.maxLevel==="WARNING");a++){if(this.oDataObject.data[a].message.level==="WARNING"){this.oDataObject.maxLevel="WARNING"}else if(this.oDataObject.data[a].message.level==="ERROR"){this.oDataObject.maxLevel="ERROR"}}if(e!==this.oDataObject.maxLevel){for(a=0;a<this.maxLevelChangelisteners.length;a++){this.maxLevelChangelisteners[a](this.oDataObject.maxLevel)}}};this.addMaxLevelChangeListener=function(e){this.maxLevelChangelisteners.push(e)}};sap.zen.MessageViewHandler.createMessage=function(e,a,s,t){sap.zen.MessageViewHandler.JSMessageHandler.createMessage(e,a,s,t)};sap.zen.MessageViewHandler.clearMessages=function(){sap.zen.MessageViewHandler.JSMessageHandler.clearAllMessages()};sap.zen.MessageViewHandler.logMessage=function(e,a,s){sap.zen.MessageViewHandler.JSMessageHandler.createLogMessage(e,a,s)};sap.zen.MessageViewHandler.setSize=function(e){sap.zen.MessageViewHandler.width=e.width;sap.zen.MessageViewHandler.height=e.height};sap.zen.MessageViewHandler.setVariableScreen=function(e){if(!e){sap.zen.MessageViewHandler.width=150;sap.zen.MessageViewHandler.height=50;sap.zen.MessageViewHandler.JSMessageHandler.setPopupAutoClose(false);sap.zen.MessageViewHandler.JSMessageHandler.setPopupAreaIds([]);sap.zen.MessageViewHandler.JSMessageHandler.setDistanceToButton(80);sap.zen.MessageViewHandler.JSMessageHandler.allowDynSizeBehavior(false)}else{if(sap.zen.MessageViewHandler.JSMessageHandler.oRenderData){var a=sap.zen.MessageViewHandler.JSMessageHandler.oRenderData.oPopup;if(a){a.close()}var s=sap.zen.MessageViewHandler.JSMessageHandler.oDataModel.getData().data;if(s&&s.length>0){sap.zen.MessageViewHandler.JSMessageHandler.oOldDataModel=s}else{sap.zen.MessageViewHandler.JSMessageHandler.oOldDataModel=null}}}sap.zen.MessageViewHandler.bIsVariableScreen=e};sap.zen.MessageViewHandler.registerOffsetCalulationCallback=function(e){sap.zen.MessageViewHandler.fCalculationCallback=e};sap.zen.MessageViewHandler.width=150;sap.zen.MessageViewHandler.height=50;sap.zen.MessageViewHandler.bIsVariableScreen=false;sap.zen.MessageViewHandler.info="INFO";sap.zen.MessageViewHandler.warning="WARNING";sap.zen.MessageViewHandler.error="ERROR";sap.zen.MessageViewHandler.JSMessageHandler=new function(){var a=undefined;this.oDataModel=undefined;this.oOldDataModel=undefined;this.oJsonModel=undefined;this.oRenderData=undefined;this.oNotificationButton=undefined;this.sLogCommand=undefined;this.sMessageTypes=undefined;this.bAutoClose=false;this.aPopupAreaIds=[];this.setDistanceToButton=function(e){this.oRenderData.vDist2=e};this.setPopupAutoClose=function(e){this.bAutoClose=e};this.setPopupAreaIds=function(e){this.aPopupAreaIds=e};this.allowDynSizeBehavior=function(e){function a(e){var a=jQuery(document.getElementById(t.oRenderData.oMainLayout.getId()));var s=parseInt(a.css("bottom"),10);var n=parseInt(jQuery(window).innerHeight(),10);if(n-t.oRenderData.iInitialLayoutHeight-s<0){if(!t.oRenderData.bDynamicHeight||e===true){a.css("top","1px");a.addClass("sapzenmessageview-AutoHeight");t.oRenderData.bDynamicHeight=true}}else{if(t.oRenderData.bDynamicHeight===true||e===true){a.css("top","auto");a.removeClass("sapzenmessageview-AutoHeight");t.oRenderData.bDynamicHeight=false}}}function s(){clearTimeout(n);if(t.oRenderData.oPopup.isOpen()){a(true)}else{n=setTimeout(s,150)}}var t=this;var n;if(e){this.oRenderData.oMainLayout.oldOnAfterRendering=this.oRenderData.oMainLayout.onAfterRendering;this.oRenderData.oMainLayout.onAfterRendering=function(){if(this.oldOnAfterRendering){this.oldOnAfterRendering()}if(t.oRenderData.iInitialLayoutHeight===0){t.oRenderData.iInitialLayoutHeight=parseInt(jQuery(document.getElementById(this.getId())).css("height"),10)}t.oRenderData.oPopup.setAutoClose(t.bAutoClose);if(t.bAutoClose){var e=[],a,i,o;for(a=0;a<t.aPopupAreaIds.length;a++){i=t.aPopupAreaIds[a];if(i){o=jQuery(document.getElementById(i));if(o&&o.length>0){e.push(o[0])}}}e.push(document.getElementById(t.oNotificationButton.getId()));t.oRenderData.oPopup.setAutoCloseAreas(e)}n=setTimeout(s,150)};jQuery(window).resize(a)}else{if(this.oRenderData.oMainLayout.oldOnAfterRendering){this.oRenderData.oMainLayout.onAfterRendering=this.oRenderData.oMainLayout.oldOnAfterRendering}}};this.clearAllMessages=function(){if(this.oDataModel){this.oDataModel.removeAll();if(this.oJsonModel){this.oJsonModel.setData(this.oDataModel.getData())}}};this.createLogMessage=function(e,a,s){if(!this.oNotificationButton){this.saveMessage(e,a,s,true,true)}else{this.logMessage(e,a,s)}};this.createMessage=function(e,a,s,t){if(!this.oNotificationButton){this.saveMessage(e,a,s,t,false)}else{this.createMessageInternal(e,a,s);if(t){this.logMessage(e,a,s)}}};this.saveMessage=function(e,s,t,n,i){if(!a){a=[]}var o={};o.sLevel=e;o.sShortText=s;o.sLongText=t;o.bLogMessage=n;o.bLogOnly=i;a.push(o)};this.createSavedMessages=function(){if(a){for(var e=0;e<a.length;e++){var s=a[e];if(!s.bLogOnly){this.createMessageInternal(s.sLevel,s.sShortText,s.sLongText)}if(s.bLogMessage){this.logMessage(s.sLevel,s.sShortText,s.sLongText)}}a=undefined}};this.logMessage=function(a,s,t){if(this.sLogCommand){var n=this.sLogCommand;n=e.dispatcher.prepareCommand(n,"__LEVEL__",a);n=e.dispatcher.prepareCommand(n,"__SHORTTEXT__",s);n=e.dispatcher.prepareCommand(n,"__LONGTEXT__",t);var i=new Function(n);i()}};this.createMessageInternal=function(e,a,s){var t=true;if(!this.sMessageTypes){t=false}else{if(e!==sap.zen.MessageViewHandler.error&&e!==sap.zen.MessageViewHandler.warning&&e!==sap.zen.MessageViewHandler.info){t=false}if(e===sap.zen.MessageViewHandler.warning&&this.sMessageTypes==="ERRORS"){t=false}if(e===sap.zen.MessageViewHandler.info&&this.sMessageTypes==="ERRORS"){t=false}if(e===sap.zen.MessageViewHandler.info&&this.sMessageTypes==="WARNINGSERRORS"){t=false}}if(t){var n={};var i={};i.msg_idx=0;i.id="FrontEnd-Message-"+(new Date).getTime();i.short_text=a;i.long_text=s;i.level=e;n.message=i;this.oDataModel.add(n);this.oJsonModel.setData(this.oDataModel.getData());this.oNotificationButton.setVisible(true);if(!sap.ui.getCore().getUIDirty()){var o=this;window.setTimeout(function(){o.oNotificationButton.invalidate()},10)}}}};var s=new sap.zen.MessageViewHandler;e.dispatcher.addHandlers(s.getType(),s);return s});
//# sourceMappingURL=messageview_handler.js.map