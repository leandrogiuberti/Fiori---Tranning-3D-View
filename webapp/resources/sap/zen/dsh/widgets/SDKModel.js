/*
 * SAPUI5
  (c) Copyright 2009-2021 SAP SE. All rights reserved
 */
sap.ui.define(["jquery.sap.global","sap/zen/dsh/utils/BaseHandler","sap/zen/dsh/widgets/databuffer","sap/ui/model/ClientModel","sap/ui/model/ClientListBinding"],function(jQuery,BaseHandler,DataBuffer,ClientModel,ClientListBinding){"use strict";var SDKModel=ClientModel.extend("sap.zen.dsh.widgets.SDKModel",{constructor:function(e){ClientModel.apply(this,arguments);if(e&&typeof e=="object"){this.setData(e)}},metadata:{}});SDKModel.prototype.setData=function(e){this.buffer=new DataBuffer(null,e);this.checkUpdate()};SDKModel.prototype._getSelections=function(e,t){var i=this._getObject(e,t);if(isSelection(i)){var n=[],r;for(r=0;r<i.length;r++){if(i[r]===undefined){n[r]=[-1]}else{n[r]=i[r]}}var s=this.buffer.fetchData(n,{includeTuples:true,includeResults:true});var a=[];for(r=0;r<s.tuples.length;r++){var o=s.tuples[r];var u=[];u.isSelection=true;for(var l=0;l<o.length;l++){if(i[l]===null||i[l]===false){u[l]=[o[l]]}else{u[l]=i[l]}}a.push(u)}return a}else{return i}};function intersectSelections(e,t){if(!e)return t;var i=[];i.isSelection=true;for(var n=0;n<t.length;n++){if(t[n]===undefined)i[n]=e[n];else i[n]=t[n]}return i}SDKModel.prototype._parsePart=function(sPath){if(sPath.indexOf(":")===-1){return null}if(sPath.charAt(0)==="/"){sPath=sPath.substring(1)}sPath=sPath.replace(/%2F/g,"/");var sel=eval("({"+sPath+"})");var result=this.buffer.getIndexSelection(sel);result.isSelection=true;return result};function isSelection(e){return e&&e.isSelection===true}SDKModel.prototype._getObject=function(e,t){if(e==="/dimensions"){return this.buffer.buffer.dimensions}var i=null;var n=e.lastIndexOf("/");if(n>0){var r=e.substring(0,n);e=e.substring(n+1);i=this._getObject(r,t)}else if(n===-1&&!t){return null}else if(t){i=t.oSelection}var s;if(e==="value"){s=this.buffer.fetchData(i,{includeData:true,includeResults:true});return s.data[0]}if(e==="formattedValue"){s=this.buffer.fetchData(i,{includeFormattedData:true,includeResults:true});return s.formattedData[0]}if(e==="format"){s=this.buffer.fetchData(i,{includeConditionalFormats:true,includeResults:true});return s.conditionalFormatValues[0]}var a=this._parsePart(e);if(a!=null){return intersectSelections(i,a)}if(isSelection(i)){var o=_findByKey(this.buffer.buffer.dimensions,e);if(o!==-1&&i){return this.buffer.buffer.dimensions[o].members[i[o]]}}if(i&&!isSelection(i)){if(Array.isArray(i)&&i[e]===undefined){e=_findByKey(i,e)}return i[e]}return null};function _findByKey(e,t){t=t.replace(/%2F/g,"/");for(var i=0;i<e.length;i++){var n=e[i];if(n.key===t){return i}if(t==="(MEASURES_DIMENSION)"&&n.containsMeasures){return i}}return-1}SDKModel.prototype.getProperty=function(e,t){return this._getObject(e,t)};SDKModel.prototype.bindList=function(e,t,i,n,r){var s=new sap.zen.model.SDKListBinding(this,e,t,i,n,r);return s};SDKModel.prototype.bindProperty=function(e,t,i){var n=new sap.zen.model.SDKPropertyBinding(this,e,t,i);return n};var SDKListBinding=ClientListBinding.extend("sap.zen.dsh.widgets.SDKListBinding");SDKListBinding.prototype.getContexts=function(e,t){if(!e){e=0}if(!t){t=Math.min(this.iLength,this.oModel.iSizeLimit)}var i=Math.min(e+t,this.aIndices.length);var n,r=[],s=this.oModel.resolve(this.sPath,this.oContext);if(s&&!jQuery.sap.endsWith(s,"/")){s+="/"}for(var a=e;a<i;a++){n=this.oModel.getContext(s+this.aIndices[a]);n.oSelection=this.oList[a];r.push(n)}return r};SDKListBinding.prototype.update=function(){this.oList=this.oModel._getSelections(this.sPath,this.oContext);if(!this.oList){this.oList=[]}this.updateIndices();this.applyFilter();this.applySort();this.iLength=this._getLength()};SDKListBinding.prototype.checkUpdate=function(e){var t=this.oModel._getObject(this.sPath,this.oContext);if(!jQuery.sap.equal(this.oList,t)||e){this.update();this._fireChange({reason:sap.ui.model.ChangeReason.Change})}};var SDKPropertyBinding=sap.ui.model.ClientPropertyBinding.extend("sap.zen.dsh.widgets.SDKPropertyBinding");SDKPropertyBinding.prototype.setValue=function(){};SDKPropertyBinding.prototype.checkUpdate=function(e){var t=this._getValue();if(!jQuery.sap.equal(t,this.oValue)||e){this.oValue=t;this._fireChange({reason:sap.ui.model.ChangeReason.Change})}};return SDKModel});
//# sourceMappingURL=SDKModel.js.map