/*
 * SAPUI5
  (c) Copyright 2009-2021 SAP SE. All rights reserved
 */
sap.ui.define(["jquery.sap.global","sap/base/Log"],function(jQuery,a){"use strict";a.info("Create com.sap.ip.bi.SelectionTable");sap.designstudio.sdk.Component.subclass("com.sap.ip.bi.SelectionTable",function(){var a="sapzencrosstab-TableDiv";var r="sapzencrosstab-Crosstab";var e="sapzencrosstab-HeaderRow sapzencrosstab-DimensionHeaderArea";var n="sapzencrosstab-HeaderCellDefault";var t="sapzencrosstab-HeaderCellDefault sapzencrosstab-HeaderCellTotal";var s="sapzencrosstab-DataCellDefault";var i="sapzencrosstab-DataCellDefault sapzencrosstab-DataCellAlternating";var o="sapzencrosstab-DataCellDefault sapzencrosstab-DataCellTotal";var l="sapzencrosstab-DataCellDefault sapzencrosstab-DataCellTotal sapzencrosstab-DataCellAlternating";var v="sapzencrosstab-CollapseNode";var f="sapzencrosstab-ExpandNode";var u="sapzencrosstab-HeaderCellDivHierarchy";var c="sapzencrosstab-DataCellSelectData";var d="sapzencrosstab-HoverDataCell";var b="sapzencrosstab-HeaderCellDefault";var p="data-dim-";var m=this;var h=null;var S=undefined;var g=2;var D=0;var y=0;var T=0;var x=0;var C=0;var E=0;var _=[];var w=[];var z=[];var R=[];var k=[];this.init=function(){this.$().addClass(a);this.$().css("overflow-x","scroll");this.$().css("overflow-y","scroll")};this.afterUpdate=function(){if(this.jqTable==null&&h&&h.formattedData&&h.formattedData.length>0){U();_=L(D,y);w=L(D,y);z=L(D,y);R=L(D,y);k=L(D,y);j();H();I();B();F()}};function U(){var a=h.axis_columns;C=a.length;var r=h.axis_rows;E=r.length;T=0;var e=a[0];for(var n=0;n<e.length;n++){if(e[n]>-1){T++}}x=e.length-T;D=x+C;y=T+E}function L(a,r){var e=new Array(a);for(var n=0;n<a;n++){e[n]=new Array(r)}return e}function j(){q(0,0,x,T);_[0][0]=x;w[0][0]=T;z[0][0]="";R[0][0]="topleft"}function q(a,r,e,n){for(var t=r;t<r+n;t++){for(var s=a;s<a+e;s++){_[s][t]=-1;w[s][t]=-1}}}function A(a,r){var e=_[a][r];if(e===-1){return true}var n=w[a][r];if(n===-1){return true}return false}function M(a){var r="";var e=a.level;if(e){for(var n=0;n<e;n++){r+="&nbsp;&nbsp;"}var t="";var s=a.nodeState;if(s){t=s==="EXPANDED"?v:f}r+='<span style="display: inline-block; vertical-align: middle" class="'+u+" "+t+'"></span>';r+="&nbsp;"+a.text}else{r=a.text}return r}function H(){var a=x;for(var r=0;r<T;r++){for(var e=0;e<C;e++){if(!A(a+e,r)){var n=N(e,r);var t=O(e,r);q(a+e,r,n,t);var s=h.axis_columns[e][r];var i=h.dimensions[r].members[s];var o=M(i);var l=i.type;_[a+e][r]=n;w[a+e][r]=t;z[a+e][r]=o;R[a+e][r]=l==="RESULT"?"header-bold":"header";k[a+e][r]=p+r+"="+s;e+=n-1}}}}function N(a,r){var e=1;var n=h.axis_columns[a][r];for(var t=a+1;t<h.axis_columns.length;t++){var s=h.axis_columns[t][r];if(n===s){for(var i=0;i<r;i++){var o=h.axis_columns[a][i];var l=h.axis_columns[t][i];if(o!==l){return e}}e++}else{break}}return e}function O(a,r){var e=1;var n=h.dimensions[r].members[h.axis_columns[a][r]];if(n.type==="RESULT"){for(var t=r+1;t<T;t++){var s=h.dimensions[t].members[h.axis_columns[a][t]];if(s.type==="RESULT"){e++}else{break}}}return e}function I(){var a=T;var r=T;for(var e=0;e<x;e++){for(var n=0;n<E;n++){if(!A(e,r+n)){var t=P(e,n);var s=$(e,n);q(e,r+n,t,s);var i=a+e;var o=h.axis_rows[n][i];var l=h.dimensions[i].members[o];var v=M(l);var f=l.type;_[e][r+n]=t;w[e][r+n]=s;z[e][r+n]=v;R[e][r+n]=f==="RESULT"?"header-bold":"header";k[e][r+n]=p+i+"="+o;n+=s-1}}}}function $(a,r){var e=T;var n=1;var t=h.axis_rows[r][e+a];for(var s=r+1;s<h.axis_rows.length;s++){var i=h.axis_rows[s][e+a];if(t===i){for(var o=0;o<a;o++){var l=h.axis_rows[r][e+o];var v=h.axis_rows[s][e+o];if(l!==v){return n}}n++}else{break}}return n}function P(a,r){var e=T;var n=1;var t=h.dimensions[e+a].members[h.axis_rows[r][e+a]];if(t.type==="RESULT"){for(var s=a+1;s<x;s++){var i=h.dimensions[e+s].members[h.axis_rows[r][e+s]];if(i.type==="RESULT"){n++}else{break}}}return n}function B(){var a=x;var r=T;var e=0;for(var n=0;n<E;n++){for(var t=0;t<C;t++){_[a+t][r+n]=1;w[a+t][r+n]=1;z[a+t][r+n]=h.formattedData[e];R[a+t][r+n]=W(t,n);k[a+t][r+n]=J(h.tuples[e]);e++}}}function J(a){var r="";for(var e=0;e<a.length;e++){r+=p+e+"="+a[e]+" "}return r}function W(a,r){if(X(a,r)){return r%2==0?"data-bold-even":"data-bold-odd"}return r%2==0?"data-even":"data-odd"}function X(a,r){var e=h.axis_columns[a],n;for(n=0;n<T;n++){var t=h.dimensions[n].members[e[n]];if(t.type==="RESULT"){return true}}var s=T;var i=h.axis_rows[r];for(n=0;n<x;n++){var o=h.dimensions[s+n].members[i[s+n]];if(o.type==="RESULT"){return true}}return false}function F(){m.$().empty();var a='<table class="'+r+'">';for(var v=0;v<y;v++){a+='<tr class="'+e+'">';for(var f=0;f<D;f++){if(!A(f,v)){var u="";var c=R[f][v];switch(c){case"topleft":case"header":u=n;break;case"header-bold":u=t;break;case"data-odd":u=i;break;case"data-bold-odd":u=l;break;case"data-even":u=s;break;case"data-bold-even":u=o;break}var d=_[f][v];var b=w[f][v];var p=z[f][v];var h=k[f][v];h=!h?"":" "+h;if(d>1){h+=" colspan="+d}if(b>1){h+=" rowspan="+b}h+=" class='"+u+"'";a+="<td"+h+">"+p+"</td>";f+=d-1}}a+="</tr>"}a+="</table>";m.jqTable=jQuery(a);m.jqTable.click(G);m.$().append(m.jqTable);Y()}function G(a){var r=jQuery(a.target).hasClass(s);if(!r&&g===0)return;K(r);jQuery.each(a.target.attributes,function(a,r){if(r.name.indexOf(p)===0){var e=parseInt(r.name.substring(p.length),10);var n=parseInt(r.value);var t=S[e];S[e]=Q(t,n)}});m.firePropertiesChangedAndEvent(["visSelection","currrentSelectionShape"],"onSelect")}function K(a){if(!S||a){S=h.dimensions.map(function(){return[]})}return S}function Q(a,r){var e=[];var n=false;for(var t=0;t<a.length;t++){var s=a[t];if(s<r){e.push(s)}else if(s===r){n=true}else{if(!n){e.push(r);n=true}e.push(s)}}if(!n){e.push(r)}return e}function V(a){var r=1;for(var e=0;e<a.length;e++){var n=a[e];n=n+r;if(n<S[e].length){a[e]=n;return true}else{a[e]=0;r=1}}return r==0}function Y(){if(m.jqTable){jQuery("."+c,m.jqTable).removeClass(c);jQuery("."+d,m.jqTable).removeClass(d);var a=K().map(function(){return 0});do{var r="";jQuery.each(S,function(e,n){var t=n[a[e]];if(t!==undefined){var s="[data-dim-"+e+'="'+t+'"]';r+=s;jQuery("."+b+s,m.jqTable).addClass(d)}});var e=jQuery(r,m.jqTable);e.addClass(c)}while(V(a))}}this.data=function(a){if(a===undefined){return h}else{h=a;this.jqTable=null;return this}};this.visSelection=function(a){if(a===undefined){var r={};jQuery.each(K(false),function(a,e){var n=h.dimensions[a];var t=n.key;if(n.containsMeasures){t="(MEASURES_DIMENSION)"}if(e.length===1){r[t]=Z(n,e[0])}else if(e.length>1){r[t]=e.map(function(a){return Z(n,a)})}});return JSON.stringify(r)}else{if(a!==""&&h){K(true);try{var e=JSON.parse(a);for(var n in e){if(Object.prototype.hasOwnProperty.call(e,n)){var t=aa(n);var s=e[n];if(Array.isArray(s)){S[t]=s.map(function(a){return ra(t,a)})}else{var i=ra(t,s);S[t]=[i]}}}Y()}catch(a){}}return this}};function Z(a,r){var e=a.members[r];var n=e.key;if(e.type==="RESULT"){n="(RESULT_MEMBER)"}return n}function aa(a){var r=h.dimensions;for(var e=0;e<r.length;e++){if(a==="(MEASURES_DIMENSION)"&&r[e].containsMeasures){return e}var n=r[e].key;if(a===n){return e}}throw"Dimension "+a+" not found"}function ra(a,r){var e=h.dimensions[a].members;for(var n=0;n<e.length;n++){if(r==="(RESULT_MEMBER)"&&e[n].type==="RESULT"){return n}var t=e[n].key;if(r===t){return n}}throw"Member "+r+" not found"}this.currrentSelectionShape=function(a){if(a!==undefined)return this;var r=false;var e=false;for(var n=0;n<h.dimensions.length;n++){var t=h.dimensions[n];if(K(false)[n].length===0){if(t.axis==="ROWS")e=true;else r=true}}if(r&&e)return 2;if(r||e)return 1;return 0};this.selectionShape=function(a){if(a===undefined){return g}g=a;return this}})});
//# sourceMappingURL=SelectTable.js.map