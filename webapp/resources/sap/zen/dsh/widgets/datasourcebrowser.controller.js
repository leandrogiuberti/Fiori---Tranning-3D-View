/*
 * SAPUI5
  (c) Copyright 2009-2021 SAP SE. All rights reserved
 */
sap.ui.define(["jquery.sap.global","sap/base/Log","sap/ui/model/json/JSONModel","sap/ui/model/resource/ResourceModel","sap/zen/dsh/utils/BaseHandler"],function(jQuery,e,t,i,s){"use strict";sap.ui.controller("dsb.datasourcebrowser",{getControl:function(e){var t=this.getView();return t.byId(e)},onInit:function(){this.imageBaseUrl="zen.res/zen.rt.components.ui5/datasourcebrowser/images/";var e=this.getView();this.oResourceModel=new i({bundleUrl:"sap/zen/dsh/i18n/dsb/localization.properties"});e.setModel(this.oResourceModel,"i18n");var l=new t;var o={};var a="";if(e.controlProperties.config){o=JSON.parse(e.controlProperties.config);a=o.title}if(!a){o.title=this.oResourceModel.getResourceBundle().getText("DLGTITLE")}var r=this.oResourceModel.getResourceBundle().getText("LOADING");o.loadingText=r;l.setData(o);e.setModel(l);var n=this.getControl("searchTab");var d=this.getControl("rolesTab");d.isInitial=true;var f=this.getControl("workspacesTab");f.isInitial=true;var c=this.getControl("foldersTab");c.isInitial=true;if(o.hiddenTabs){var h=o.hiddenTabs;h.forEach(function(e){if(e==="searchTab"){n.setVisible(false)}else if(e==="rolesTab"){d.setVisible(false)}else if(e==="workspacesTab"){f.setVisible(false)}else if(e==="foldersTab"){c.setVisible(false)}})}if(e.controlProperties.connectionType==="BAE"||e.controlProperties.connectionType==="HTTP"){d.setVisible(false);f.setVisible(false);c.setText(this.oResourceModel.getResourceBundle().getText("FOLDERS"))}this.defaultIndex=-1;if(o.defaultTab){var u=this.getControl("tabStrip");if(!s.dispatcher.isMainMode()){if(o.defaultTab==="searchTab"&&n.getVisible()){u.setSelectedIndex(0);this.defaultIndex=0}else if(o.defaultTab==="rolesTab"&&d.getVisible()){u.setSelectedIndex(1);this.defaultIndex=1}else if(o.defaultTab==="workspacesTab"&&f.getVisible()){u.setSelectedIndex(2);this.defaultIndex=2}else if(o.defaultTab==="foldersTab"&&c.getVisible()){u.setSelectedIndex(3);this.defaultIndex=3}}else{if(o.defaultTab==="searchTab"&&n.getVisible()){this.defaultIndex=0;u.setSelectedKey(this.createId("searchTab"))}else if(o.defaultTab==="rolesTab"&&d.getVisible()){this.defaultIndex=1;u.setSelectedKey(this.createId("rolesTab"))}else if(o.defaultTab==="workspacesTab"&&f.getVisible()){this.defaultIndex=2;u.setSelectedKey(this.createId("workspacesTab"))}else if(o.defaultTab==="foldersTab"&&c.getVisible()){this.defaultIndex=3;u.setSelectedKey(this.createId("foldersTab"))}}}if(this.defaultIndex===-1){if(n.getVisible()){this.defaultIndex=0}else if(d.getVisible()){this.defaultIndex=1}else if(f.getVisible()){this.defaultIndex=2}else if(c.getVisible()){this.defaultIndex=3}}var g=this.getControl("dialog");if(o.width){g.setWidth(o.width)}if(o.height){g.setHeight(o.height)}if(n.getVisible()){g.setInitialFocus(this.getControl("searchPattern"))}g.open()},iconFormatter:function(e){if(e===null){return""}if(e==="QUERY"){return this.imageBaseUrl+"query.png"}else if(e==="VIEW"){return this.imageBaseUrl+"queryview.png"}else if(e==="INFOPROVIDER"){return this.imageBaseUrl+"cube.png"}else if(e==="FOLDER"){return this.imageBaseUrl+"folder.png"}return""},tooltipFormatter:function(e){if(e===null){return""}if(e==="QUERY"){return"Query"}else if(e==="VIEW"){return"QueryView"}else if(e==="INFOPROVIDER"){return"InfoProvider"}return""},onAfterRendering:function(){if(this.defaultIndex>0){this.populateTab(this.defaultIndex)}},getSelectedNode:function(){var e,t;if(this.getSelectedIndex()===0){e=this.getControl("resultTable")}if(this.getSelectedIndex()===1){e=this.getControl("rolesTree")}if(this.getSelectedIndex()===2){e=this.getControl("workspacesTree")}if(this.getSelectedIndex()===3){e=this.getControl("foldersTree")}if(e){t=e.getSelectedIndex();if(t>-1){var i=e.getContextByIndex(t);return i.getObject()}}return undefined},textFieldChanged:function(){this.searchClicked()},textFieldLiveChanged:function(e){var t=e.getParameters().liveValue;this.getControl("searchButton").setEnabled(t!=="")},fetchRootNodes:function(e,t){t.setModel(this.oResourceModel,"i18n");var i=t.getModel("i18n").getResourceBundle();var s=i.getText("LOADING");t.setNoData(s);var l=this;this.callZtlNoUndo("getRootFolders",e,function(o){var a=new sap.ui.model.json.JSONModel;var r={};for(var n=0,d=o.length;n<d;n++){var f=o[n];var c=l.iconFormatter(f.type);var h={name:f.name,description:f.description,type:f.type,icon:c,hasChildren:f.hasChildren,id:f.id};r[""+n]=h;if(f.hasChildren){h["0"]={name:"",description:s,type:"LOADING",hasChildren:false}}}a.setSizeLimit(Number.MAX_VALUE);a.setData({root:r});t.setModel(a);t.bindRows("/root");var u="";if(e==="ROLES"){u=i.getText("ROLES")}if(e==="WORKSPACES"){u=i.getText("WORKSPACES")}if(e==="FOLDERS"){u=i.getText("WORKSPACES")}var g=i.getText("NO_X_FOUND");var b=g.replace("{0}",u);t.setNoData(b)})},populateTab:function(e){if(e===0){this.getControl("searchPattern").focus()}else if(e===1){var t=this.getControl("rolesTab");if(t.isInitial){this.fetchRootNodes("ROLES",this.getControl("rolesTree"));t.isInitial=false}}else if(e===2){var i=this.getControl("workspacesTab");if(i.isInitial){this.fetchRootNodes("WORKSPACES",this.getControl("workspacesTree"));i.isInitial=false}}else if(e===3){var s=this.getControl("foldersTab");if(s.isInitial){this.fetchRootNodes("INFO_AREA_OR_FOLDER",this.getControl("foldersTree"));s.isInitial=false}}if(this.getSelectedNode()===undefined){this.getControl("okButton").setEnabled(false)}else{this.getControl("okButton").setEnabled(true)}},getSelectedIndex:function(){var e;var t=this.getControl("tabStrip");if(!s.dispatcher.isMainMode()){e=t.getSelectedIndex()}else{var i=t.getSelectedKey();if(i.indexOf("searchTab")>-1){e=0}else if(i.indexOf("rolesTab")>-1){e=1}else if(i.indexOf("workspacesTab")>-1){e=2}else if(i.indexOf("foldersTab")>-1){e=3}}return e},tabSelected:function(){this.populateTab(this.getSelectedIndex())},toggleExpandedState:function(e){if(e.getParameters().expanded){var t=e.getParameters().rowContext;var i=e.getSource();var s=i.getModel();var l=i.getModel("i18n").getResourceBundle();var o=l.getText("LOADING");var a=t.getObject();var r=a["0"];if(r.type==="LOADING"){var n=this;this.callZtlNoUndo("getChildren",a.id,function(e){if(e.length===0){delete a["0"]}else{for(var t=0,i=e.length;t<i;t++){var l=e[t];var r=n.iconFormatter(l.type);var d={name:l.name,description:l.description,type:l.type,icon:r,hasChildren:l.hasChildren,id:l.id};a[""+t]=d;if(l.hasChildren){d["0"]={name:"",description:o,type:"LOADING",hasChildren:false}}}}s.refresh()})}}},searchClicked:function(e){var t=e.getSource();t.setBusy(true);var i=this.getControl("searchResultsLabel");var s=this.getView().getModel("i18n").getResourceBundle();var l=this.getControl("resultTable");l.setModel(new sap.ui.model.json.JSONModel({}));l.setNoDataText(s.getText("SEARCHING"));var o=this;this.callZtlNoUndo("searchDataSources",t.getValue(),function(e){for(var a=0,r=e.length;a<r;a++){var n=o.tooltipFormatter(e[a].type);var d=o.iconFormatter(e[a].type);e[a].icon=d;e[a].tooltip=n}var f=new sap.ui.model.json.JSONModel;f.setSizeLimit(Number.MAX_VALUE);f.setData({data:e});l.setModel(f);l.bindRows("/data");var c=s.getText("RESULTS_COUNT");var h=c.replace("{0}",e.length+"");i.setText(h);if(e.length===0){l.setNoDataText(s.getText("NO_SEARCH_RESULTS"))}t.setBusy(false)})},tableRowSelected:function(){var e=this.getControl("resultTable").getSelectedIndex();this.getControl("okButton").setEnabled(e!==-1)},treeNodeSelected:function(e){var t=e.getSource();var i=t.getSelectedIndex();if(i===-1){this.getControl("okButton").setEnabled(false)}else{var s=e.getParameters().rowContext;if(s!==null){var l=s.getObject();var o=l.type;this.getControl("okButton").setEnabled(o==="QUERY"||o==="VIEW"||o==="INFOPROVIDER");if(o==="FOLDER"){t.setSelectedIndex(-1)}}}},okClicked:function(){this.getControl("dialog").close();this.selectedNodeId=this.getSelectedNode().id;this.getControl("dialog").close()},dialogClosed:function(){this.callZtl("close",this.selectedNodeId)},cancelClicked:function(){this.selectedNodeId=undefined;this.getControl("dialog").close()},callZtl:function(e,t,i){var s=this.getView();s.callZTLFunction(e,i,t)},callZtlNoUndo:function(e,t,i){var s=this.getView();s.callZTLFunctionNoUndo(e,i,t)}})});
//# sourceMappingURL=datasourcebrowser.controller.js.map