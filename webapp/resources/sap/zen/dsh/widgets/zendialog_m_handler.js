/*
 * SAPUI5
  (c) Copyright 2009-2021 SAP SE. All rights reserved
 */
sap.ui.define(["jquery.sap.global","sap/sac/df/thirdparty/lodash","sap/zen/dsh/utils/BaseHandler","sap/m/Dialog","sap/zen/commons/layout/MatrixLayout","sap/zen/commons/HAlign"],function(jQuery,o,t,e,i,n){"use strict";sap.zen.ZenDialogHandler=function(){sap.zen.ZenDialogHandler.anchorDivId="sapbi_snippet_ROOT_DIALOG";t.apply(this,arguments);this.dispatcher=t.dispatcher;var o=this;this.oTopLevelControl=null;this.loadingIndicatorCssHasBeenSet=false;this.iVertPaddingAndBorderContribution=-1;this.bIsRuntimeMode=false;this.bBrowserResize=false;this.resizeTimer=null;this.resizeEndTimer=null;this.initialWindowHeight=0;this.initialWindowWidth=0;this.contentTdHeight=0;this.contentHeight=0;this.oDomContentArea=null;this.oDomContentDiv=null;this.bDialogClosing=false;this.createAndAdd=function(o,e,i,n,r){this.dispatcher.enableReady(false);this.bIsRuntimeMode=e.renderruntimeinitvarscreen;this.bBrowserResize=e.hookbrowserresize;this.iVertPaddingAndBorderContribution=-1;this.oTopLevelControl={};var a=this.validateDialogContent(this.oTopLevelControl,e,i);this.oTopLevelControl=null;if(!a){return null}var s=null;if(this.bIsRuntimeMode===true){this.oTopLevelControl=new sap.m.Button(e["id"],{enabled:false});var l=this.oTopLevelControl.destroy;this.oTopLevelControl.destroy=function(){if(t.dispatcher.oCurrentVarDlg){t.dispatcher.oCurrentVarDlg.destroy();delete t.dispatcher.oCurrentVarDlg}l.apply(this,arguments)};this.oTopLevelControl.aZenChildren=[];this.oTopLevelControl.aZenChildren.push(t.dispatcher.oCurrentVarDlg);if(typeof sap.zen.dsh.DSH_deployment!=="undefined"&&sap.zen.dsh.DSH_deployment===true){n(this.oTopLevelControl,r)}}else{this.oTopLevelControl=this.createMatrixLayout(e,i);s=this.oTopLevelControl;this.oTopLevelControl.aZenChildren=[];n(this.oTopLevelControl,i)}this.oTopLevelControl.oDialogProperties={oComponentProperties:null,oControlProperties:null,oMatrixLayout:s,oMsgComponent:null,oMsgControl:null,tContentComponents:[],oContentComponent:null,oContentControl:null};this.init(this.oTopLevelControl,e,i,true);this.hookBrowserResize();if(this.bIsRuntimeMode===true){this.openDialog()}return this.oTopLevelControl};this.update=function(o,t,e){if(t){if(t.closeDialogCommand&&t.closeDialogCommand.length>0){sap.zen.ZenDialogHandler.closeDialog();setTimeout(function(){var o=new Function(t.closeDialogCommand);o()},0)}else{if(this.validateDialogContent(o,t,e)){this.init(o,t,e,false)}else{}}}};this.init=function(o,t,e,i){if(t.loadingIndicatorDelay){sap.zen.loadingIndicatorDelay=t.loadingIndicatorDelay}if(!this.loadingIndicatorCssHasBeenSet){r()}this.extractDialogProperties(o,t,e,i);this.initDialog(o)};this.validateDialogContent=function(o,t,e){this.extractDialogProperties(o,t,e,false);if(t){if(!t.content||t.content.length>2){return false}if(!o.oDialogProperties.oMsgComponent){if(!o.oDialogProperties.oContentComponent||o.oDialogProperties.oContentComponent&&t.content.length>1){return false}}else{if(!o.oDialogProperties.oContentComponent&&t.content.length>1){return false}}}else{return false}return true};this.extractDialogProperties=function(o,t,e,i){if(!o.oDialogProperties){o.oDialogProperties={oComponentProperties:null,oControlProperties:null,oMatrixLayout:null,oMsgComponent:null,oMsgControl:null,tContentComponents:[],oContentComponent:null,oContentControl:null}}o.oDialogProperties.oComponentProperties=e;o.oDialogProperties.oControlProperties=t;if(i){o.oDialogProperties.oMsgComponent=null;o.oDialogProperties.oMsgControl=null;o.oDialogProperties.tContentComponents=[];o.oDialogProperties.oContentComponent=null;o.oDialogProperties.oContentControl=null}var n=null;var r=[];if(t.content&&t.content.length>0){for(var a=0;a<t.content.length;a++){var s=t.content[a];if(s&&s.component){if(s.component.type==="MESSAGEVIEW_COMPONENT"&&!n){n=s.component}else{r.push(s.component)}}}}if(r&&r.length>0){o.oDialogProperties.tContentComponents=r;o.oDialogProperties.oContentComponent=o.oDialogProperties.tContentComponents[0]}if(o.oDialogProperties.oContentComponent){if(o.oDialogProperties.oContentComponent.content&&o.oDialogProperties.oContentComponent.content.control){o.oDialogProperties.oContentControl=this.dispatcher.getControlForId(o.oDialogProperties.oContentComponent.content.control.id)}}if(n){if(n.content&&n.content.control){o.oDialogProperties.oMsgComponent=n;o.oDialogProperties.oMsgControl=this.dispatcher.getControlForId(o.oDialogProperties.oMsgComponent.content.control.id)}}};this.initDialog=function(o){if(!o||!o.oDialogProperties||!o.oDialogProperties.oControlProperties){return}if(!o.oDialog){o.oDialog=new e(o.getId()+"_dlg",{title:o.oDialogProperties.oControlProperties.title?o.oDialogProperties.oControlProperties.title:o.oDialogProperties.oControlProperties.titletext,showHeader:o.oDialogProperties.oControlProperties.displaytitle,resizable:o.oDialogProperties.oControlProperties.canresize,draggable:o.oDialogProperties.oControlProperties.canmove,horizontalScrolling:false,verticalScrolling:false,contentHeight:"100%",contentWidth:Math.floor(window.innerWidth/2)+"px",afterOpen:function(){var t=this.$().find(".sapMDialogScroll");t.css("overflow-x","auto");var e;if(jQuery.browser.mozilla){e=jQuery(document.getElementById(o.oDialogProperties.oContentControl.getId()));e.css("display","inline-table")}else if(jQuery.browser.webkit){e=jQuery(document.getElementById(o.oDialogProperties.oContentControl.getId()));var i=e.parent();i.css("height","100%")}}});o.oDialog.addStyleClass("sapContrastPlus");o.oDialog.attachBrowserEvent("keydown",function(o){if(o.which===27){if(o.stopPropagation){o.stopPropagation()}if(o.cancelBubble){o.cancelBubble=true}}});t.dispatcher.oCurrentVarDlg=o.oDialog;if(this.bIsRuntimeMode===true){t.dispatcher.oCurrentVarDlg.oDispatcherHook=this.oTopLevelControl}}if(o.oDialog){if(o.oDialogProperties.oControlProperties.title){o.oDialog.setTitle(o.oDialogProperties.oControlProperties.title)}this.initDialogContent(o);this.initDialogButtons(o);this.initDialogMessage(o)}};this.initDialogContent=function(o){if(!o||!o.oDialog||!o.oDialogProperties){return}if(o.oDialogProperties.oMatrixLayout){if(o.oDialogProperties.oContentComponent){var t=this.createMatrixLayoutContentArea();o.oDialogProperties.oMatrixLayout.addRow(t)}}var e=false;if(o.oDialogProperties.oMatrixLayout){if(o.oDialogProperties.oContentComponent){e=this.dispatcher.getComponentIdForControlId(o.oDialogProperties.oContentComponent.content.control.id)==null}}else{if(o.oDialog){e=!o.oDialog.isOpen()}else{e=true}}if(o.oDialogProperties.oContentComponent){if(e){o.oDialogProperties.oContentControl=this.dispatcher.dispatchCreateControl(o.oDialogProperties.oContentComponent);if(o.oDialogProperties.oContentComponent.id){this.oTopLevelControl.aZenChildren.push(o.oDialogProperties.oContentComponent.id)}o.oDialogProperties.oContentControl.setWidth("100%");o.oDialogProperties.oContentControl.setHeight("100%");if(o.oDialogProperties.oMatrixLayout){var i=this.getMatrixLayoutCell(o.oDialogProperties.oMatrixLayout,0,0);i.addContent(o.oDialogProperties.oContentControl)}this.dispatcher.updateComponentProperties(undefined,o.oDialogProperties.oContentComponent)}else{o.oDialogProperties.oContentControl=this.dispatcher.getControlForId(o.oDialogProperties.oContentComponent.content.control.id);this.dispatcher.dispatchUpdateControl(o.oDialogProperties.oContentComponent);this.dispatcher.updateComponentProperties(null,o.oDialogProperties.oContentComponent)}}var n=o.oDialogProperties.oMatrixLayout?o.oDialogProperties.oMatrixLayout:o.oDialogProperties.oContentControl;n.onAfterRendering=this.dialogCallbackOnAfterRendering(n,o);if(!o.oDialog.isOpen()){o.oDialog.addContent(n)}};this.initDialogButtons=function(e){if(!e||!e.oDialog||!e.oDialogProperties||!e.oDialogProperties.oControlProperties){return}if(e.oDialogProperties.oMatrixLayout){var i=this.createMatrixLayoutButtonArea();e.oDialogProperties.oMatrixLayout.addRow(i)}var n=function(){if(this.zenOkBtn===true){t.dispatcher.enableReady(true)}if(this.zenOkBtn===true||this.zenCancelBtn===true){sap.zen.MessageViewHandler.setVariableScreen(false)}o.bDialogClosing=true;this.setEnabled(false);this.zenOnClick()};if(e.oDialogProperties.oControlProperties.buttons&&e.oDialogProperties.oControlProperties.buttons.length){var r=false;if(e.oDialogProperties.oMatrixLayout){if(e.oDialogProperties.oContentComponent){r=this.dispatcher.getComponentIdForControlId(e.oDialogProperties.oContentComponent.content.control.id)==null}}else{if(e.oDialog){r=!e.oDialog.isOpen()}else{r=true}}if(r){e.oDialog.removeAllButtons()}for(var a in e.oDialogProperties.oControlProperties.buttons){var s=e.oDialogProperties.oControlProperties.buttons[a].button;var l;if(s.rendered===true){if(r){l=this.createButton(s.name);l.setText(s.text);l.setEnabled(s.enabled);l.zenOkBtn=s.okBtn;l.zenCancelBtn=s.cancelBtn;if(s.okBtn===true){l.addStyleClass("zenDialogOkButton")}if(s.cancelBtn===true){l.addStyleClass("zenDialogCancelButton")}if(s.command){l.zenOnClick=new Function(s.command);l.attachPress(n)}else{l.setEnabled(false)}}else{l=sap.ui.getCore().getControl(s.name);var p=s.enabled;if(s.okBtn){p=p&&!e.oDialogProperties.oContentControl.hasClientError}if(s.rendered===true){if(l){l.setEnabled(p);l.setVisible(true)}}else{if(l){l.setVisible(false)}}}}if(r&&l){e.oDialog.addButton(l)}if(s.statustodesigner===true){if(s.command){window.eclipse_setOkButtonEnabled(s.enabled)}else{window.eclipse_setOkButtonEnabled(false)}}}}};this.initDialogMessage=function(o){if(!o||!o.oDialogProperties){return}if(o.oDialogProperties.oMsgComponent){var t=this.dispatcher.getComponentIdForControlId(o.oDialogProperties.oMsgComponent.content.control.id)==null;if(t){if(o.oDialogProperties.oMsgComponent.id){this.oTopLevelControl.aZenChildren.push(o.oDialogProperties.oMsgComponent.id)}sap.zen.MessageViewHandler.setVariableScreen(true);o.oDialogProperties.oMsgControl=this.dispatcher.dispatchCreateControl(o.oDialogProperties.oMsgComponent);if(o.oDialogProperties.oMatrixLayout){var e=this.getMatrixLayoutCell(o.oDialogProperties.oMatrixLayout,1,0);e.addContent(o.oDialogProperties.oMsgControl)}}else{o.oDialogProperties.oMsgControl=this.dispatcher.getControlForId(o.oDialogProperties.oMsgComponent.content.control.id);this.dispatcher.dispatchUpdateControl(o.oDialogProperties.oMsgComponent);this.dispatcher.updateComponentProperties(o.oDialogProperties.oMsgControl,o.oDialogProperties.oMsgComponent)}}};this.initDialogFooter=function(o){if(!o||!o.oDialog||!o.oDialogProperties.oMsgControl){return}var t=this.getDialogFooter(o.oDialog);if(!t){return}var e=[];e.push(o.oDialogProperties.oMsgControl);var i=t.getContent();if(i){for(var n=0;n<i.length;n++){var r=i[n];if(r&&r!==o.oDialogProperties.oMsgControl){e.push(r)}}}t.removeAllContent();for(n=0;n<e.length;n++){r=e[n];if(r){t.addContent(r)}}};this.getDialogFooter=function(o){var t=sap.ui.getCore().byId(o.getId()+"-footer");return t};this.openDialog=function(){var o=t.dispatcher.oCurrentVarDlg;if(o){o.open()}};this.dialogCallbackOnAfterRendering=function(o,t){o.fOrigOnAfterRendering=o.onAfterRendering;var e=this;return function(){if(this.fOrigOnAfterRendering){this.fOrigOnAfterRendering()}e.initDialogFooter(t)}};function r(){var t="loading.gif?1.0.0";if(sap.zen.dsh.sapbi_isMobile){t="loadingMobile.gif"}var e="margin:-20px 0px 0px -100px; background-position:center;background-repeat:no-repeat;height:40px;width:200px;"+"background-image:url("+sap.zen.createStaticMimeUrl("zen.rt.client.servlet/resources/images/"+t)+");z-index:19994;position:absolute;top:50%;left:50%;";jQuery("head").prepend("<style>.customLoadingIndicatorZenClass{"+e+"}</style>");o.loadingIndicatorCssHasBeenSet=true}this.createMatrixLayout=function(o){var t=new i(o["id"],{layoutFixed:false,height:"100%",width:"100%"});t.addStyleClass("zenDialogMatrixLayout");t.fOrigOnAfterRendering=t.onAfterRendering;var e=this;t.onAfterRendering=function(){if(this.fOrigOnAfterRendering){this.fOrigOnAfterRendering()}e.calculateAndSetMatrixLayoutDialogDivSizes();e.setMatrixLayoutInitialSizes();if(e.bIsRuntimeMode){e.addMsgControlToMatrixLayoutAndReorderDialogButtons()}};if(o.onepageprompt){t.addStyleClass("zenDialogOnePage")}if(o.toplevelcssclass.length>0){t.addStyleClass(o.toplevelcssclass)}this.initMatrixLayoutRootArea();return t};this.createMatrixLayoutContentArea=function(){var o=new sap.zen.commons.layout.MatrixLayoutCell;o.addStyleClass("zenDialogContentArea");var t=new sap.zen.commons.layout.MatrixLayoutRow;t.addStyleClass("zenDialogContentRow");t.addCell(o);return t};this.createMatrixLayoutButtonArea=function(){var o=new sap.zen.commons.layout.MatrixLayoutCell({hAlign:n.Begin});o.addStyleClass("zenDialogButtonArea");var t=new sap.zen.commons.layout.MatrixLayoutRow;t.addStyleClass("zenDialogButtonRow");t.addCell(o);return t};this.getMatrixLayoutCell=function(o,t,e){var i=o.getRows()[t];var n=i.getCells()[e];return n};this.initMatrixLayoutRootArea=function(){var o=jQuery(document.getElementById(sap.zen.ZenDialogHandler.anchorDivId));if(!o.length){o=jQuery('<div id="'+sap.zen.ZenDialogHandler.anchorDivId+'"></div>');jQuery("body").append(o)}return o};this.calculateAndSetMatrixLayoutDialogDivSizes=function(){this.oDomContentArea=jQuery(".zenDialogContentArea");this.oDomContentDiv=this.oDomContentArea.children(0);if(!this.bIsRuntimeMode){var o=this.initMatrixLayoutRootArea();var t=parseInt(o.css("height"),10);var e=a();var i=t-e;var n=i-this.getMatrixLayoutVertPaddingAndBorderContribution(this.oDomContentArea);this.oDomContentDiv.css("height",n+"px")}else{jQuery(document.getElementById(this.oTopLevelControl.oMatrixLayout.getId())).parent().css("padding","0px").css("height","100%");this.oDomContentDiv.css("height","100%")}};function a(){var o=s(".zenDialogTitleRow");o+=s(".zenDialogButtonRow");o+=s(".zenDialogResizeRow");return o}function s(o){var t=0;var e=jQuery(o);if(e&&e.length>0){t=e.outerHeight()}return t}this.getMatrixLayoutVertPaddingAndBorderContribution=function(o){var t=0;var e;var i;if(this.iVertPaddingAndBorderContribution===-1){e=parseInt(o.css("padding-top"),10);t+=isNaN(i)?0:e;e=parseInt(o.css("padding-bottom"),10);t+=isNaN(i)?0:e;e=parseInt(o.css("border-top"),10);t+=isNaN(i)?0:e;e=parseInt(o.css("border-bottom"),10);t+=isNaN(i)?0:e;this.iVertPaddingAndBorderContribution=t}return this.iVertPaddingAndBorderContribution};this.setMatrixLayoutInitialSizes=function(){if(this.bBrowserResize){this.initialWindowHeight=parseInt(jQuery(window).innerHeight(),10);this.initialWindowWidth=parseInt(jQuery(window).innerWidth(),10);this.contentTdHeight=parseInt(this.oDomContentArea.css("height"),10)-1;this.contentHeight=parseInt(this.oDomContentDiv.css("height"),10)-1}};this.addMsgControlToMatrixLayoutAndReorderDialogButtons=function(){var o=t.dispatcher.oCurrentVarDlg;if(o&&this.oTopLevelControl.oDialogProperties.oMsgControl){var e=this.getDialogFooter(o);if(e){var i=e.getContent();if(i&&i.length>0){var n=[];n.push(this.oTopLevelControl.oDialogProperties.oMsgControl);n.push(i[0]);for(var r=1;r<i.length;r++){if(i[r]!==this.oTopLevelControl.oDialogProperties.oMsgControl){n.push(i[r])}}e.removeAllContent();for(r=0;r<n.length;r++){e.addContent(n[r])}}}}};this.hookBrowserResize=function(){if(this.bBrowserResize===true){var o=this;jQuery(window).resize(function(){clearTimeout(o.resizeTimer);o.resizeTimer=setTimeout(function(o){return function(){o.browserResizeListener()}}(o),50)})}};this.browserResizeListener=function(){clearTimeout(this.resizeEndTimer);var o=parseInt(jQuery(window).innerHeight(),10);var t=o-this.initialWindowHeight;var e=parseInt(jQuery(window).innerWidth(),10);var i=e-this.initialWindowWidth;if(t!==0){this.contentTdHeight+=t;this.contentHeight+=t;this.initialWindowHeight=o;this.oDomContentArea.css("height",this.contentTdHeight+"px");this.oDomContentDiv.css("height",this.contentHeight+"px")}if(i!==0){this.initialWindowWidth=e}if(this.oTopLevelControl.oDialogProperties.oContentControl.ZEN_resize){this.oTopLevelControl.oDialogProperties.oContentControl.ZEN_resize()}this.resizeEndTimer=setTimeout(function(o,t,e){return function(){o.browserResizeEndEvent(t,e)}}(this,i,t),100)};this.browserResizeEndEvent=function(o,t){if(this.oTopLevelControl.oDialogProperties.oContentControl.ZEN_resizeEnd){this.oTopLevelControl.oDialogProperties.oContentControl.ZEN_resizeEnd(o,t)}};this.applyForChildren=function(o,t){if(o.aZenChildren){for(var e=0;e<o.aZenChildren.length;e++){var i=o.aZenChildren[e];var n=this.dispatcher.getRootControlForComponentId(i);if(n){var r=t(n);if(r){return r}}}}return null};this.getType=function(){return"zendialog"}};sap.zen.ZenDialogHandler.closeDialog=function(){var o=t.dispatcher.oCurrentVarDlg;if(o){var e=o.oDispatcherHook;t.dispatcher.dispatchRemove(e)}};var r=new sap.zen.ZenDialogHandler;t.dispatcher.addHandlers(r.getType(),r);return r});
//# sourceMappingURL=zendialog_m_handler.js.map