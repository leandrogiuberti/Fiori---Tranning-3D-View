/*!
 * (c) Copyright 2010-2019 SAP SE or an SAP affiliate company.
 */
sap.ui.define(["jquery.sap.global","sap/zen/crosstab/TextConstants","sap/zen/crosstab/utils/Utils","sap/zen/crosstab/rendering/RenderingConstants","sap/zen/crosstab/CrosstabCellApi","sap/zen/crosstab/DataCell","sap/zen/crosstab/HeaderCell","sap/zen/crosstab/CellStyleHandler"],function(jQuery,e,t,a,r,s,o,i){"use strict";jQuery.sap.declare("sap.zen.crosstab.datahandler.JsonDataHandler");sap.zen.crosstab.datahandler.JsonDataHandler=function(t){var n=t.getDimensionHeaderArea();var l=t.getColumnHeaderArea();var d=t.getRowHeaderArea();var c=t.getDataArea();var f=0;var u=0;var C=0;var p=0;var g=false;var h=false;var m=false;var T=null;var v=null;var y=0;var x=0;var E={};var S={};function w(){if(!sap.zen.CrosstabTextCache){sap.zen.CrosstabTextCache={};sap.zen.CrosstabTextCache.filled=false;sap.zen.CrosstabTextCache.oTexts={};sap.zen.CrosstabTextCache.oSortingTextLookupTable={};sap.zen.CrosstabTextCache.defaultProvided=false}var a=t.getPropertyBag();a.addText(e.ROW_TEXT_KEY,"Row");a.addText(e.COL_TEXT_KEY,"Column");a.addText(e.COLWIDTH_ADJUST_TEXT_KEY,"Double Click to adjust Column Width");a.addText(e.MOBILE_MENUITEM_COLWIDTH_ADJUST_TEXT_KEY,"Adjust Column Width");a.addText(e.MEASURE_STRUCTURE_TEXT_KEY,"Measure Structure");R(a);sap.zen.CrosstabTextCache.defaultProvided=true}function b(a){if(sap.zen.CrosstabTextCache.filled===false){var r=t.getPropertyBag();if(a){r.addText(e.ROW_TEXT_KEY,a.rowtext||"Row");r.addText(e.COL_TEXT_KEY,a.coltext||"Column");r.addText(e.COLWIDTH_ADJUST_TEXT_KEY,a.colwidthtext||"Double Click to adjust Column Width");r.addText(e.MOBILE_MENUITEM_COLWIDTH_ADJUST_TEXT_KEY,a.mobilemenuitemcolwidthtext||"Adjust Column Width");r.addText(e.MEASURE_STRUCTURE_TEXT_KEY,a.measurestructtext||"Measure Structure");_(a,r)}sap.zen.CrosstabTextCache.filled=true}}function R(e){var t={};t.alttext="Unsorted. Select to sort ascending";t.tooltipidx=0;e.addSortingTextLookup("0",t);t={};t.alttext="Sorted ascending. Select to sort descending";t.tooltipidx=1;e.addSortingTextLookup("1",t);t={};t.alttext="Sorted descending. Select to sort ascending";t.tooltipidx=2;e.addSortingTextLookup("2",t)}function _(e,t){var a=e.sorting;if(!a){R(t)}else{var r=0;var s=parseInt(a.length,10);for(r=0;r<s;r++){var o={};o.alttext=a[r].alttext;o.tooltipidx=a[r].tooltipidx;t.addSortingTextLookup(r+"",o)}}}this.determineBasicAreaData=function(e,s){if(!sap.zen.CrosstabTextCache||sap.zen.CrosstabTextCache&&!sap.zen.CrosstabTextCache.defaultProvided){w()}T=e;if(T.rootcause&&T.rootcause==="bookmark"){t.getPropertyBag().setBookmarkProcessing(true)}if(!T.rows){D(T);P();t.setHasData(false)}else{t.setHasData(true);if(s||T.changed){b(T.texts);E={};S={};f=T.fixedcolheaders;u=T.fixedrowheaders;if(!T.pixelscrolling){t.setHCutOff(false);t.setVCutOff(false);C=T.totaldatacols;p=T.totaldatarows}else{t.setHCutOff(T.totaldatacols>T.sentdatacols);t.setVCutOff(T.totaldatarows>T.sentdatarows);C=T.sentdatacols;p=T.sentdatarows}if(!f||!u){n.setRowCnt(0);n.setColCnt(0);if(!u){d.setRowCnt(0);d.setColCnt(0);if(f){l.setRowCnt(f);l.setColCnt(C)}}else if(!f){l.setRowCnt(0);l.setColCnt(0);if(u){d.setRowCnt(p);d.setColCnt(u)}}}else{n.setRowCnt(f);n.setColCnt(u);d.setRowCnt(p);d.setColCnt(u);l.setRowCnt(f);l.setColCnt(C)}c.setRowCnt(p);c.setColCnt(C);t.setTotalRows(f+p);t.setTotalCols(u+C);t.setOnSelectCommand(T.onselectcommand);t.getPropertyBag().setDisplayExceptions(T.displayexceptions);t.getPropertyBag().setEnableColResize(T.enablecolresize);t.setScrollNotifyCommand(T.scrollnotifier);t.setUpdateColWidthCommand(T.updatecolwidthcmd);A(e);var o=new r(t,u,f,C,p);t.setCellApi(o)}H();if(!(t.getPropertyBag().isMobileMode()||t.getPropertyBag().isTestMobileMode())){if(T.transferdatacommand){t.setTransferDataCommand(T.transferdatacommand)}else{t.setTransferDataCommand(null)}if(T.callvaluehelpcommand){t.setCallValueHelpCommand(T.callvaluehelpcommand)}if(T.newlinescnt){t.setNewLinesCnt(T.newlinescnt)}if(T.newlinespos){t.setNewLinesPos(T.newlinespos)}}if(T.contextmenucmd){t.getPropertyBag().setContextMenuCommand(T.contextmenucmd);t.createContextMenu()}if(T.headerscrolling&&T.headerscrolling==true){t.setHeaderScrollingConfigured(true);if(T.userheaderresize){t.setUserHeaderResizeAllowed(T.userheaderresize)}if(T.userheaderwidthcommand){t.setUserHeaderWidthCommand(T.userheaderwidthcommand)}if(T.headerwidth){t.getPropertyBag().setMaxHeaderWidth(T.headerwidth)}else{t.getPropertyBag().setMaxHeaderWidth(0)}if(T.headerwidthcurrent){t.getPropertyBag().setUserHeaderWidth(T.headerwidthcurrent)}else{t.getPropertyBag().setUserHeaderWidth(0)}}else{t.setHeaderScrollingConfigured(false);t.setUserHeaderResizeAllowed(false);t.setUserHeaderWidthCommand(null);t.getPropertyBag().setMaxHeaderWidth(0);t.getPropertyBag().setUserHeaderWidth(0)}if(T.selectionmode){t.setSelectionProperties(T.selectionmode,T.selectionspace,T.disablehovering,T.singleonselectevent)}var i=t.getSelectionHandler();if(i){i.setSelection(T.selection)}if(T.headerinfo){t.initHeaderInfo(T.headerinfo)}if(T.repeattxt&&T.repeattxt===true){t.getPropertyBag().setRepeatTexts(true)}else{t.getPropertyBag().setRepeatTexts(false)}if(T.dragdropcommands){t.getPropertyBag().setDragDropEnabled(true);t.setDragDropCommands(T.dragdropcommands)}else{t.getPropertyBag().setDragDropEnabled(false)}if(T.zebra){t.getPropertyBag().setZebraMode(T.zebra)}else{t.getPropertyBag().setZebraMode(a.ZEBRA_FULL)}}};function A(e){var t=e.usercolwidths;if(t){for(var a=0;a<t.length;a++){var r=t[a];var s=r.colid;if(isNaN(r.colwidth)){continue}var o=Math.max(0,parseInt(r.colwidth,10));var i=false;if(r.ignore!==undefined){i=r.ignore}if(s==="*"){if(f&&u){l.setColUserWidth(s,o,i);c.setColUserWidth(s,o,i);n.setColUserWidth(s,o,i);d.setColUserWidth(s,o,i)}else{if(!u){l.setColUserWidth(s,o,i)}else if(!f){d.setColUserWidth(s,o,i)}c.setColUserWidth(s,o,i)}}else{if(f&&u){if(s>=u){l.setColUserWidth(s-u,o,i);c.setColUserWidth(s-u,o,i)}else{n.setColUserWidth(s,o,i);d.setColUserWidth(s,o,i)}}else{if(!u){l.setColUserWidth(s,o,i);c.setColUserWidth(s,o,i)}else if(!f){if(s>=u){c.setColUserWidth(s-u,o,i)}else{d.setColUserWidth(s,o,i)}}}}}}}function H(){var e=t.getRenderEngine().getCrossRequestManager();if(e){if(T.clienthpos!==undefined&&T.clientvpos!==undefined&&T.clienthscrolledtoend!==undefined&&T.clientvscrolledtoend!==undefined){if(T.clienthscrolledtoend===true){T.clienthpos=T.totaldatacols-1}if(T.clientvscrolledtoend===true){T.clientvpos=T.totaldatarows-1}if(!e.hasSavedVScrollInfo()&&!e.hasSavedHScrollInfo()){e.setScrollData(parseInt(T.clienthpos,10),T.clienthscrolledtoend,parseInt(T.clientvpos,10),T.clientvscrolledtoend)}}if(T.rootcause){e.setRootCause(T.rootcause);if(T.rootcause==="hierarchy"){e.setHierarchyAction(T.rootcause_hierarchy);e.setIsHierarchyDirectionDown(T.rootcause_hierarchy_directiondown)}e.handleRootCause()}else{if(T.changed===true){e.setScrollData(0,false,0,false)}}var a=false;if(T.rootcause&&t.getPropertyBag().isBookmarkProcessing()){a=true}else{if(!T.dataproviderchanged){if(T.resultsetchanged){if(T.rootcause){a=T.rootcause==="sorting"||T.rootcause==="hierarchy"||T.rootcause==="plan"||T.rootcause==="dragdrop"}}else{a=true}}}if(T.clientheaderhpos&&a){e.setHeaderScrollData({iHPos:parseInt(T.clientheaderhpos,10)})}else{e.setHeaderScrollData({iHPos:0})}}}this.jsonToDataModel=function(e){if(T.rows){v=e.oCrosstabAreasToBeFilled;y=e.iColOffset;x=e.iRowOffset;L();var a=T.rows;for(var r=0,s=a.length;r<s;r++){var o=a[r].row.rowidx;var i=a[r].row.cells;for(var n=0,l=i.length;n<l;n++){var d=i[n].control;var c=d.colidx;U(d,o,c)}}}t.setColHeaderHierarchyLevels(E);t.setRowHeaderHierarchyLevels(S)};function L(){g=v[n.getAreaType()];h=v[d.getAreaType()];m=v[l.getAreaType()]}function D(e){n.setRowCnt(2);n.setColCnt(1);var t=O(n,0,0);t.setText(e.messagetitle);n.insertCell(t,0,0);t=O(n,1,0);t.setText(e.messagetext);n.insertCell(t,1,0)}function P(){var e=t.getSelectionHandler();if(e){e.setSelection(null)}}var U=function(e,t,a){var r=t-1;var s=a-1;if(a>u&&t>f){M(e,r+x,s+y)}else if(g&&a<=u&&t<=f){z(e,r,s)}else if(m&&t<=f&&a>u){I(e,r,s+y)}else if(h&&a<=u&&t>f){W(e,r+x,s)}};function B(e,r){var o=new s;o.setArea(c);o.setRow(e);o.setCol(r);o.addStyle(t.getPropertyBag().isCozyMode()?a.STYLE_DATA_CELL_COZY:a.STYLE_DATA_CELL);return o}var M=function(e,r,s){var o=r-f;var i=s-u;var n=B(o,i);n.setTableRow(r);n.setTableCol(s);N(e,n);if(t.getPropertyBag().getZebraMode()!==a.ZEBRA_OFF){if(o%2===1){n.addStyle(a.STYLE_ALTERNATING)}}c.insertCell(n,o,i)};var z=function(e,t,a){Y(e,n,t,a,t,a)};var W=function(e,t,a){var r=t;if(e.axisidx!==undefined){r=e.axisidx+f}Y(e,d,t-f,a,r,a)};var I=function(e,t,a){var r=a;if(e.axisidx!==undefined){r=e.axisidx+u}Y(e,l,t,a-u,t,r)};function O(e,r,s){var i=new o;i.setArea(e);i.setRow(r);i.setCol(s);i.addStyle(t.getPropertyBag().isCozyMode()?a.STYLE_HEADER_CELL_COZY:a.STYLE_HEADER_CELL);return i}var Y=function(e,a,r,s,o,i){var n=O(a,r,s);n.setTableRow(o);n.setTableCol(i);N(e,n);k(e,n,a);if(t.getPropertyBag().isRtl()&&n.getRow()===t.getDimensionHeaderArea().getRowCnt()-1&&n.getCol()===t.getDimensionHeaderArea().getColCnt()-1){n.setText(sap.zen.crosstab.utils.Utils.swapPivotKeyText(n.getText()))}a.insertCell(n,r,s)};var N=function(e,r){var s=K(e,r);if(s){r.setFormatter(s)}var o=e._v;if(o){var n=sap.zen.crosstab.utils.Utils.prepareStringForRendering(o);r.setText(n.text);r.setNumberOfLineBreaks(n.iNumberOfLineBreaks)}var l=e.exceptionvisualizations;if(l){for(var d in l){if(Object.prototype.hasOwnProperty.call(l,d)){var c=l[d];if(c){i.setExceptionStylesOnCell(r,c.formattype,c.alertlevel)}}}}if(e.isemphasized){r.addStyle(a.STYLE_EMPHASIZED)}if(!(t.getPropertyBag().isMobileMode()||t.getPropertyBag().isTestMobileMode())){if(e.isdataentryenabled){r.addStyle(a.STYLE_DATA_ENTRY_ENABLED);r.setEntryEnabled(true);if(e.unit){r.setUnit(e.unit)}}if(e.hasinvalidvalue){r.addStyle(a.STYLE_INVALID_VALUE)}if(e.hasnewvalue){r.addStyle(a.STYLE_NEW_VALUE)}if(e.islocked){r.addStyle(a.STYLE_LOCKED)}}if(e.isresult){if(r.setResult){r.setResult(e.isresult)}r.addStyle(a.STYLE_TOTAL)}if(e.passivetype){r.setPassiveCellType(e.passivetype)}if(e.additionalstyles){for(var f=0;f<e.additionalstyles.length;f++){r.addStyle(e.additionalstyles[f].style.stylename)}}};var k=function(e,r,s){if(e.rowspan){r.setRowSpan(e.rowspan)}else{r.setRowSpan(1)}if(e.colspan){r.setColSpan(e.colspan)}else{r.setColSpan(1)}if(e.key){r.setMergeKey(e.key)}if(e.sort){r.setSort(e.sort)}if(e.sorttxtidx){r.setSortTextIndex(parseInt(e.sorttxtidx,10))}if(e.sortaction){r.setSortAction(e.sortaction)}if(e.alignment){r.setAlignment(e.alignment)}if(e.memberid){r.setMemberId(e.memberid)}if(e.parentmemberid){r.setParentMemberId(e.parentmemberid)}if(typeof e.level!="undefined"){r.setLevel(e.level);F(s,r,e.level)}else{r.setLevel(-1)}if(e.drillstate){if(e.drillstate!=="A"){r.setDrillState(e.drillstate)}}if(e.hierarchyaction){r.setHierarchyAction(e.hierarchyaction)}if(e.hierarchytooltip){r.setHierarchyTooltip(e.hierarchytooltip)}if(e.nodeAlignment){r.setNodeAlignment(e.nodeAlignment)}if(t.getPropertyBag().getZebraMode()===a.ZEBRA_FULL){if(s.isRowHeaderArea()&&r.getRow()%2===1&&r.getRowSpan()===1){var o=t.getHeaderInfo();if(o){if(r.getCol()+r.getColSpan()-1>=o.getStartColForInnermostDimension()){r.addStyle(a.STYLE_ALTERNATING)}}}}};var F=function(e,t,r){if(e.getAreaType()===a.TYPE_COLUMN_HEADER_AREA){var s=t.getRow();if(E[s]!=undefined){if(E[s]<r){E[s]=r}}else{E[s]=r}}else if(e.getAreaType()===a.TYPE_ROW_HEADER_AREA){var o=t.getCol();if(S[o]!=undefined){if(S[o]<r){S[o]=r}}else{S[o]=r}}};function K(e,t){var a;if(e.valueType){var r=X(e.formatString);var s;if(e.valueType==="Integer"||e.valueType==="Double"){s={groupingEnabled:true,maxFractionDigits:e.decimals,pattern:r,showMeasure:true};if(e.customFormat&&e.customFormat.name){t.setCustomFormat(e.customFormat.name);s.currencyCode=false;s.customCurrencies=s.customCurrencies||{};s.customCurrencies[e.customFormat.name]={symbol:e.customFormat.symbol}}a=sap.ui.core.format.NumberFormat.getCurrencyInstance(s)}else if(e.valueType==="Amount"||e.valueType==="Price"||e.valueType==="Quantity"){s={groupingEnabled:true,maxFractionDigits:e.decimals,pattern:r,showMeasure:true};a=sap.ui.core.format.NumberFormat.getCurrencyInstance(s)}}return a}function X(e){var t;if(e){t=e;var a="#(?![#|"+","+"]).(?=#)";var r=new RegExp(a,"g");e=e.replace(r,"#"+",");a="0(?![0|"+"."+"]).(?=0)";r=new RegExp(a,"g");t=t.replace(r,"0"+".")}return t}};return sap.zen.crosstab.datahandler.JsonDataHandler});
//# sourceMappingURL=JsonDataHandler.js.map