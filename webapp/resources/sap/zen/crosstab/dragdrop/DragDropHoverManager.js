/*!
 * (c) Copyright 2010-2019 SAP SE or an SAP affiliate company.
 */
sap.ui.define(["jquery.sap.global"],function(jQuery){"use strict";jQuery.sap.declare("sap.zen.crosstab.dragdrop.DragDropHoverManager");sap.zen.crosstab.dragdrop.DragDropHoverManager=function(e){var r=this;var a={};var t=null;var l;var o=false;var s;this.init=function(e){l=e};this.getCellFromId=function(e){var r=sap.ui.getCore().getControl(e);return r};this.getCellFromJqCell=function(e){var r=jQuery(e).attr("id");return this.getCellFromId(r)};this.findAllDroppableCells=function(){var r;var a;var t;t=sap.zen.Dispatcher.instance.getDragDropPayload();if(!t){return[]}if(t.oDragDropInfo.bIsMemberDrag){a=t.oDragDropInfo.sAxisName==="ROWS"?e.getRowHeaderAreaDiv():e.getColHeaderAreaDiv()}else{a=e.getDimHeaderAreaDiv()}r=a.find("td .ui-droppable, .ui-droppable-disabled");return r};this.getDropCell=function(e){var a;var t;var l;a=this.findAllDroppableCells();jQuery.each(a,function(a,o){t=o.getBoundingClientRect();if(e.clientX>t.left&&e.clientX<t.right){if(e.clientY>t.top&&e.clientY<t.bottom){l=r.getCellFromJqCell(o);return false}}});return l};this.getCellsForDimensionDrop=function(r){var a;var t;var o;var s=null;a=e.getHeaderInfo().getDimensionInfoByRowCol(r);t=sap.zen.Dispatcher.instance.getDragDropPayload();if(!l.isExternalDropOnNonRemovableStructure(a,t)){o=t.oDragDropInfo;if(o.sDimensionName!==a.sDimensionName&&!sap.zen.Dispatcher.instance.isDragDropCanceled()&&!r.isRevertDrop()){s=e.getHeaderInfo().getCellsWithSameDimension(r)}}return s};this.getCellsForMemberDrop=function(r){var a;var t;var o;a=e.getHeaderInfo().getDimensionInfoForMemberCell(r);t=sap.zen.Dispatcher.instance.getDragDropPayload().oDragDropInfo;if(t.sDimensionName===a.sDimensionName&&!sap.zen.Dispatcher.instance.isDragDropCanceled()&&!r.isRevertDrop()){if(e.getPropertyBag().isRepeatTexts()){o=l.getAllMemberCellsInRowOrCol(r)}else{o=e.getHeaderInfo().getMemberCellsForSameDimension(r)}}return o};this.provideDropCellHoverEffect=function(e){var r;var a;var t;var l;var o;var s;o=sap.zen.Dispatcher.instance.getDragDropPayload();if(!o){return}if(e){if(!o.oDragDropInfo.bIsMemberDrag){r=this.getCellsForDimensionDrop(e)}else{r=this.getCellsForMemberDrop(e)}s=this.getDropCellClassName();if(r){for(a=0;a<r.length;a++){t=r[a];l=jQuery(document.getElementById(t.getId()));l.addClass(s);if(l.hasClass("sapzencrosstab-HeaderCellAlternating")){l.removeClass("sapzencrosstab-HeaderCellAlternating");l.data("bAlternating",true)}l.removeClass("sapzencrosstab-HeaderCellAlternating")}}}};this.cleanupDropCells=function(){var a=r.getDropCellClassName();var t;var l=e.getRenderSizeDiv().find("."+a);jQuery.each(l,function(e,r){t=jQuery(r);t.removeClass(a);if(t.data("bAlternating")===true){t.addClass("sapzencrosstab-HeaderCellAlternating")}})};this.getDropCellClassName=function(){var e=sap.zen.Dispatcher.instance.getDragDropPayload();if(!e){return null}if(e.oDragDropInfo.bIsMemberDrag){return"sapzencrosstab-DropMemberCell"}else{return"sapzencrosstab-DropHeaderCell"}};this.doOnDropCellOver=function(e,a){var o;if(!t){o=jQuery(document.getElementById(e.getId()));if(l.checkMouseInRenderSizeDiv(a)){if(!o.hasClass(r.getDropCellClassName())){r.cleanupDropCells();r.provideDropCellHoverEffect(e)}}else{o.droppable().trigger("mouseout")}}};this.onDropCellOver=function(e){s=r.getCellFromId(e.target.id);s=l.getEffectiveCell(s);r.doOnDropCellOver(s,e)};this.doOnDropCellOut=function(e){var a;if(!t){r.cleanupDropCells();if(e){a=jQuery(document.getElementById(e.getId()));if(!a.hasClass(r.getDropCellClassName())){r.provideDropCellHoverEffect(e)}}}};this.onDropCellOut=function(e){var a=r.getDropCell(e);a=l.getEffectiveCell(a);r.doOnDropCellOut(a)};this.disableDropCell=function(e){var r;if(!a[e.getId()]){r=jQuery(document.getElementById(e.getId()));if(r.hasClass("ui-droppable")){r.droppable("disable");r.removeClass(this.getDropCellClassName());a[e.getId()]=r}}};this.getDisableDimHeaderDropCellsForArea=function(r,a){var t;var l;var o=e.getTableMaxDimHeaderRow();var s=e.getTableMaxDimHeaderCol();var n;var i;var p;p=e.getHeaderInfo().getCellsWithSameDimension(a);if(!p){return[]}if(r==="droparea_above"||r==="droparea_below"){l=a.getTableRow();n=0;while(n<=s){i=e.getTableCellWithColSpan(l,n);if(i){n=n+i.getColSpan();p.push(i)}else{n++}}}else if(r==="droparea_before"||r==="droparea_after"){t=a.getTableCol();n=0;while(n<=o){i=e.getTableCellWithRowSpan(n,t);if(i){n=n+i.getRowSpan();p.push(i)}else{n++}}}return p};this.getDisableMemberDropCellsForArea=function(r,a){var t;var l;var o;var s;var n;var i;var p;var d;var g;var f;t=e.getHeaderInfo().getMemberCellsForSameDimension(a);if((r==="droparea_above"||r==="droparea_below")&&e.hasRowHeaderArea()){l=e.getRowHeaderArea();d=Math.max(a.getRow(),l.getRenderStartRow());i=l.getRenderStartCol();p=i+l.getRenderColCnt()-1;g=i;while(g<=p){f=l.getCellWithRowSpan(d,g);if(f){if(r==="droparea_below"){if(a.getRow()===f.getRow()+f.getRowSpan()-1){t.push(f)}}else{if(a.getRow()===f.getRow()){t.push(f)}}g=g+f.getColSpan()}else{g++}}}else if((r==="droparea_before"||r==="droparea_after")&&e.hasColHeaderArea()){o=e.getColumnHeaderArea();g=Math.max(a.getCol(),o.getRenderStartCol());s=o.getRenderStartRow();n=s+o.getRenderRowCnt()-1;d=s;while(d<=n){f=o.getCellWithColSpan(d,g);if(f){if(r==="droparea_after"){if(a.getCol()===f.getCol()+f.getColSpan()-1){t.push(f)}}else{if(a.getCol()===f.getCol()){t.push(f)}}d=d+f.getRowSpan()}else{d++}}}return t};this.disableDropCellsForArea=function(e,r){var a;var t;var l;var o;o=sap.zen.Dispatcher.instance.getDragDropPayload();if(!o){return}if(o.oDragDropInfo.bIsMemberDrag){a=this.getDisableMemberDropCellsForArea(e,r)}else{a=this.getDisableDimHeaderDropCellsForArea(e,r)}for(l=0;l<a.length;l++){t=a[l];this.disableDropCell(t)}};this.cleanupDropAreas=function(){if(t){jQuery.each(a,function(e,r){if(r.hasClass("ui-droppable-disabled")){r.droppable("enable")}});a={};t=null}};this.onDropAreaOver=function(e){var a;var o;var s;r.cleanupDropAreas();t=jQuery(document.getElementById(e.target.id));if(!l.isOnlyMeasuresMode()){r.cleanupDropCells();a=t.data("xtabcellid");s=l.getDropAreaTypeFromDropAreaId(e.target.id);o=sap.ui.getCore().getControl(a);r.disableDropCellsForArea(s,o)}};this.onDropAreaOut=function(e){var o;if(!l.isOnlyMeasuresMode()){r.cleanupDropCells()}if(t){jQuery.each(a,function(e,r){if(r.hasClass("ui-droppable-disabled")){r.droppable("enable")}});if(!l.isOnlyMeasuresMode()){o=r.getDropCell(e);if(o){r.provideDropCellHoverEffect(o)}}a={};t=null}};this.getCurrentDropArea=function(){return t};this.provideDraggableCellCursor=function(e){e.on("mouseenter",function(){jQuery(this).css("cursor","move");jQuery(this).find("div").not(".sapzencrosstab-HeaderCellDivSortable, .sapzencrosstab-columnResizeHandle, .sapzencrosstab-columnResizeHandleWithSort, .sapzencrosstab-HeaderCellDivHierarchy").css("cursor","move")});e.on("mouseleave",function(){jQuery(this).css("cursor","default");jQuery(this).find("div").not(".sapzencrosstab-HeaderCellDivSortable, .sapzencrosstab-columnResizeHandle, .sapzencrosstab-columnResizeHandleWithSort, .sapzencrosstab-HeaderCellDivHierarchy").css("cursor","default")});e.draggable("option","drag",function(e,a){var t=l.checkMouseInRenderSizeDiv(e);var n;var i;l.setCurrentDragHelper(jQuery(a.helper));if(!t){n=a.helper.find(".sapzencrosstab-HeaderCellAlternating");jQuery.each(n,function(e,r){if(r){jQuery(r).removeClass("sapzencrosstab-HeaderCellAlternating");jQuery(r).addClass("sapzencrosstab-AlternatingDummy")}});jQuery(a.helper).find(".sapzencrosstab-Trashcan").show();if(!o){r.cleanupDropCells();o=true}}else{jQuery(a.helper).find(".sapzencrosstab-Trashcan").hide();n=a.helper.find(".sapzencrosstab-AlternatingDummy");jQuery.each(n,function(e,r){if(r){jQuery(r).addClass("sapzencrosstab-HeaderCellAlternating");jQuery(r).removeClass("sapzencrosstab-AlternatingDummy")}});if(o){if(s){i=l.findCell(jQuery(e.toElement));if(i&&i.getId()===s.getId()){r.doOnDropCellOver(s,e)}}o=false}}})}};return sap.zen.crosstab.dragdrop.DragDropHoverManager});
//# sourceMappingURL=DragDropHoverManager.js.map