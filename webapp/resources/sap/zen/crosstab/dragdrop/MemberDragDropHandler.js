/*!
 * (c) Copyright 2010-2019 SAP SE or an SAP affiliate company.
 */
sap.ui.define(["jquery.sap.global","sap/zen/crosstab/dragdrop/DragDropUtils","sap/zen/crosstab/dragdrop/DragDropAreaRenderer","sap/zen/crosstab/dragdrop/DragDropHoverManager","sap/zen/crosstab/TextConstants","sap/zen/crosstab/utils/Utils"],function(jQuery){"use strict";jQuery.sap.declare("sap.zen.crosstab.dragdrop.MemberDragDropHandler");sap.zen.crosstab.dragdrop.MemberDragDropHandler=function(e,r,t,a,i){var o=this;var l;var n;var s;var g;var f={sIdSuffix:"member_droparea_above",sCssClassName:"sapzencrosstab-rowAboveCellMemberDropArea"};var C={sIdSuffix:"member_droparea_below",sCssClassName:"sapzencrosstab-rowBelowCellMemberDropArea"};var d={sIdSuffix:"member_droparea_before",sCssClassName:"sapzencrosstab-columnBeforeCellMemberDropArea"};var p={sIdSuffix:"member_droparea_after",sCssClassName:"sapzencrosstab-columnAfterCellMemberDropArea"};this.init=function(r){g=e.getPropertyBag().isRepeatTexts();s=r;l=t.getBoundingClientRect(e.getRowHeaderAreaDiv()[0]);n=t.getBoundingClientRect(e.getColHeaderAreaDiv()[0]);this.removeRowHeaderDropAreas();this.enableMemberDragDrop()};this.removeRowHeaderDropAreas=function(){var r;if(!e.getPropertyBag().isPixelScrolling()){r=e.getRenderSizeDiv();r.find(".sapzencrosstab-rowAboveCellMemberDropArea").remove();r.find(".sapzencrosstab-rowBelowCellMemberDropArea").remove();r.find(".sapzencrosstab-columnBeforeCellMemberDropArea").remove();r.find(".sapzencrosstab-columnAfterCellMemberDropArea").remove()}};this.getMemberCellHtml=function(e){var r;var t;var a;var i;r=jQuery(document.getElementById(e.getId()));t=jQuery(document.getElementById(e.getId()+"_cellLayoutDiv"));a=t.outerWidth();i='<td class="'+r.attr("class")+" sapzencrosstab-DragHeaderCell"+'">';i+='<div style="width: '+a+'px">'+e.getText()+"</div></td>";return i};this.createMemberCellDragObject=function(r,a){var i;var o;var l;var n;var s;var g;var f;if(r.getArea().isRowHeaderArea()){o="sapzencrosstab-RowHeaderArea"}else if(r.getArea().isColHeaderArea()){o="sapzencrosstab-ColumnHeaderArea"}i='<table style="z-index: 9999;border-collapse: collapse" class="'+o+'"><tbody>';g=a.length;i+=t.getDeleteDragGhostCellRowHtml(g);if(r.getArea().isRowHeaderArea()){l=a[0];n=jQuery(document.getElementById(l.getId())).outerHeight();i+='<tr style="height: '+n+'px">';for(s=0;s<g;s++){l=a[s];i+=this.getMemberCellHtml(l)}i+="</tr>"}else if(r.getArea().isColHeaderArea()){for(s=0;s<g;s++){l=a[s];n=jQuery(document.getElementById(l.getId())).outerHeight();i+='<tr style="height: '+n+'px">';i+=this.getMemberCellHtml(l);i+="</tr>"}}i+="</tbody></table>";f=jQuery(i);e.setDragAction(true);return f};this.restrictDropIndexLimitsForHierarchyMember=function(r,t,a){var i=e.getRowHeaderArea();var o=e.getColumnHeaderArea();var l;var n;var s;var g=-1;var f=-1;var C=null;var d=null;if(r.getAlignment()==="TOP"||r.getAlignment==="DEFAULT"){if(a==="ROWS"){for(l=t.iMinIndex;l<=t.iMaxIndex;l++){s=i.getCellWithRowSpan(l,r.getCol(),true);if(s&&s.getLevel()===r.getLevel()&&s.getParentMemberId()===r.getParentMemberId()){if(g<0){g=l}else{C=s}}}if(g>-1){t.iMinIndex=g}if(C){t.iMaxIndex=C.getRow()+C.getRowSpan()-1}}else if(a==="COLS"){for(n=t.iMinIndex;n<=t.iMaxIndex;n++){s=o.getCellWithColSpan(r.getRow(),n,true);if(s&&s.getLevel()===r.getLevel()&&s.getParentMemberId()===r.getParentMemberId()){if(g<0){g=n}else{C=s}}}if(g>-1){t.iMinIndex=g}if(C){t.iMaxIndex=C.getCol()+C.getColSpan()-1}}}else{if(a==="ROWS"){for(l=t.iMaxIndex;l>=t.iMinIndex;l--){s=i.getCellWithRowSpan(l,r.getCol(),true);if(s&&s.getLevel()===r.getLevel()&&s.getParentMemberId()===r.getParentMemberId()){if(f<0){f=l}else{d=s}}}if(d){t.iMinIndex=d.getRow()}if(f>-1){t.iMaxIndex=f}}else if(a==="COLS"){for(n=t.iMaxIndex;n>=t.iMinIndex;n--){s=o.getCellWithColSpan(r.getRow(),n,true);if(s&&s.getLevel()===r.getLevel()&&s.getParentMemberId()===r.getParentMemberId()){if(f<0){f=n}else{d=s}}}if(d){t.iMinIndex=d.getCol()}if(f>-1){t.iMaxIndex=f}}}return t};this.filterResultCellsFromDropIndexLimits=function(r,t,a){var i;var o=e.getRowHeaderArea();var l=e.getColumnHeaderArea();var n;var s;if(a==="ROWS"){n=r.iMinIndex;i=o.getCellWithRowSpan(n,t.getCol());if(!i){i=o.getCellWithColSpan(n,t.getCol())}while(i&&i.isResult()&&n<r.iMaxIndex){r.iMinIndex=i.getRow()+i.getRowSpan();n++;i=o.getCellWithColSpan(n,t.getCol())}n=r.iMaxIndex;i=o.getCellWithRowSpan(n,t.getCol());if(!i){i=o.getCellWithColSpan(n,t.getCol())}while(i&&i.isResult()&&n>r.iMinIndex){r.iMaxIndex=i.getRow()-1;n--;i=o.getCellWithColSpan(n,t.getCol())}}else if(a==="COLS"){s=r.iMinIndex;i=l.getCellWithColSpan(t.getRow(),s);if(!i){i=l.getCellWithRowSpan(n,t.getCol())}while(i&&i.isResult()&&s<r.iMaxIndex){r.iMinIndex=i.getCol()+i.getColSpan();s++;i=l.getCellWithRowSpan(t.getRow(),s)}s=r.iMaxIndex;i=l.getCellWithColSpan(t.getRow(),s);if(!i){i=l.getCellWithRowSpan(n,t.getCol())}while(i&&i.isResult()&&n>r.iMinIndex){r.iMaxIndex=i.getCol()-1;s--;i=l.getCellWithRowSpan(t.getRow(),s)}}return r};this.determineDropIndexLimitsFromPeerCell=function(r,t){var a=0;var i;var o;var l;var n;var s={};s.iMinIndex=-1;s.iMaxIndex=-1;if(g&&r.getMergeKey()&&r.getMergeKey().length>0){if(t==="COLS"){l=e.getColHeaderArea();i=l.getRenderStartCol();o=i+l.getRenderColCnt();for(a=i;a<o&&s.iMaxIndex===-1;a++){n=l.getCell(r.getRow(),a);if(n.getMergeKey()===r.getMergeKey()&&s.iMinIndex===-1){s.iMinIndex=a}if(n.getMergeKey()!==r.getMergeKey()&&s.iMinIndex>-1){s.iMaxIndex=a-1}}}else{l=e.getRowHeaderArea();i=l.getRenderStartRow();o=i+l.getRenderRowCnt();for(a=i;a<o&&s.iMaxIndex===-1;a++){n=l.getCell(a,r.getCol());if(n.getMergeKey()===r.getMergeKey()&&s.iMinIndex===-1){s.iMinIndex=a}if(n.getMergeKey()!==r.getMergeKey()&&s.iMinIndex>-1){s.iMaxIndex=a-1}}}if(s.iMaxIndex===-1){s.iMaxIndex=o}}else{if(t==="COLS"){s.iMinIndex=r.getCol();s.iMaxIndex=r.getCol()+r.getColSpan()-1}else{s.iMinIndex=r.getRow();s.iMaxIndex=r.getRow()+r.getRowSpan()-1}}return s};this.findDropIndexLimits=function(r,t){var a={};var i;var o;i=e.getHeaderInfo().findStartIndexOfPreviousDimension(t.sDimensionName,t.sAxisName);if(t.sAxisName==="ROWS"){if(!e.getHeaderInfo().isFirstDimensionOnAxis(t)){o=e.getRowHeaderArea().getCellWithRowSpan(r.getRow(),i);a=this.determineDropIndexLimitsFromPeerCell(o,t.sAxisName)}else{a.iMinIndex=e.getRowHeaderArea().getRenderStartRow();a.iMaxIndex=a.iMinIndex+e.getRowHeaderArea().getRenderRowCnt()-1}}else if(t.sAxisName==="COLS"){if(!e.getHeaderInfo().isFirstDimensionOnAxis(t)){o=e.getColumnHeaderArea().getCellWithColSpan(i,r.getCol());a=this.determineDropIndexLimitsFromPeerCell(o,t.sAxisName)}else{a.iMinIndex=e.getColumnHeaderArea().getRenderStartCol();a.iMaxIndex=a.iMinIndex+e.getColumnHeaderArea().getRenderColCnt()-1}}a=this.filterResultCellsFromDropIndexLimits(a,r,t.sAxisName);if(r.getLevel()>-1){a=this.restrictDropIndexLimitsForHierarchyMember(r,a,t.sAxisName)}return a};this.findPreviousPeerCell=function(r,t,a){var i=e.getRowHeaderArea();var o=e.getColumnHeaderArea();var l;var n;var s;var g=null;if(r.getAlignment()==="TOP"||r.getAlignment==="DEFAULT"){if(t==="ROWS"){for(n=r.getRow();n>=a.iMinIndex&&!g;n--){l=i.getCellWithRowSpan(n,r.getCol(),true);if(l&&l.getId()!==r.getId()&&l.getLevel()===r.getLevel()){g=l}}}else if(t==="COLS"){for(s=r.getCol();s>=a.iMinIndex&&!g;s--){l=o.getCellWithColSpan(r.getRow(),s,true);if(l&&l.getId()!==r.getId()&&l.getLevel()===r.getLevel()){g=l}}}}else{if(t==="ROWS"){for(n=r.getRow();n<=a.iMaxIndex&&!g;n++){l=i.getCellWithRowSpan(n,r.getCol(),true);if(l&&l.getId()!==r.getId()&&l.getLevel()===r.getLevel()){g=l}}}else if(t==="COLS"){for(s=r.getCol();s<=a.iMaxIndex&&!g;s++){l=o.getCellWithColSpan(r.getRow(),s,true);if(l&&l.getId()!==r.getId()&&l.getLevel()===r.getLevel()){g=l}}}}if(g){if(g.getParentMemberId()!==r.getParentMemberId()){g=null}}return g};function c(){var r;var a;var l;var n;var s;var f;var C;var d;var p;l=e.getHeaderInfo();a=i.getCellFromJqCell(this);r=t.getEffectiveCell(a);if(r){t.setCurrentJqDragCell(jQuery(document.getElementById(r.getId())));if(g){n=t.getAllMemberCellsInRowOrCol(r)}else{n=l.getMemberCellsForSameDimension(r)}t.saveRevertCellPosInfo(a,n);s=o.createMemberCellDragObject(r,n);t.setCursorAt(a,s);C=l.getDimensionInfoForMemberCell(r);f=sap.zen.Dispatcher.instance.createDragDropPayload(e.getId());f.oDragDropInfo=t.buildDimensionDragDropInfo(C);p=o.findDropIndexLimits(r,C);f.oDragDropInfo.oDropIndexLimits=p;if(r.getLevel()>-1){f.oDragDropInfo.bIsHierarchyMember=true}f.oDragDropInfo.bIsMemberDrag=true;d=e.getUtils().translateCellCoordinatesForBackend(r);if(d){f.oDragDropInfo.iMemberRow=d.row;f.oDragDropInfo.iMemberCol=d.col}sap.zen.Dispatcher.instance.setDragDropPayload(f)}return s}this.checkBasicMemberDropAccept=function(e,r){if(!e){return false}if(e.oDragDropInfo.sAxisName!==r){return false}if(t.isDragFromOtherCrosstab(e)){return false}if(t.isInterComponentDrag(e)){return false}if(!e.oDragDropInfo.bIsMemberDrag){return false}return true};this.returnFromMemberCellAcceptCheck=function(e,r){e.setRevertDrop(!r);sap.zen.Dispatcher.instance.setDropAccepted(e.getId(),r);return r};this.checkDropLimitsAgainstCells=function(e,r,t,a){var i;var o;if(t.iMinIndex===-1&&t.iMaxIndex===-1){return true}if(t.iMinIndex===t.iMaxIndex){return false}i=true;if(a==="ROWS"){if(e.getRow()===r.getRow()){i=false}else{if(e.getCol()>0){o=r.getRow()+r.getRowSpan()-1;i=t.iMinIndex<=o&&t.iMaxIndex>=o}}}else if(a==="COLS"){if(e.getCol()===r.getCol()){i=false}else{if(e.getRow()>0){o=r.getCol()+r.getColSpan()-1;i=t.iMinIndex<=o&&t.iMaxIndex>=o}}}else{i=false}return i};this.checkMatchingHierarchyLevels=function(e,r){if(r.getLevel()>-1&&e.getLevel()>-1){return r.getLevel()===e.getLevel()&&r.getParentMemberId()===e.getParentMemberId()}return true};function m(r){var a;var l;var n;var s;var g;var f;var C;if(!e.isDragAction()||e.isBlocked()){return false}n=sap.zen.Dispatcher.instance.getDragDropPayload();f=n.oDragDropInfo;a=i.getCellFromJqCell(jQuery(this));a=t.getEffectiveCell(a);C=e.getHeaderInfo().getDimensionInfoForMemberCell(a);if(!o.checkBasicMemberDropAccept(n,C.sAxisName)){return o.returnFromMemberCellAcceptCheck(a,false)}s=n.oDragDropInfo.oDropIndexLimits;l=i.getCellFromJqCell(r);l=t.getEffectiveCell(l);g=o.checkDropLimitsAgainstCells(l,a,s,f.sAxisName);if(!g){return o.returnFromMemberCellAcceptCheck(a,false)}g=o.checkMatchingHierarchyLevels(l,a);if(!g){return o.returnFromMemberCellAcceptCheck(a,false)}return o.returnFromMemberCellAcceptCheck(a,true)}this.returnFromMemberAreaAcceptCheck=function(e,r){e.data("xtabrevertdrop",!r);sap.zen.Dispatcher.instance.setDropAccepted(e.attr("id"),r);return r};this.checkDropAreaDropLimits=function(e,r,t,a,i){var o;var l;if(t.iMinIndex!==t.iMaxIndex&&!i){if(r.isResult()){if(a==="ROWS"){if(r.getRow()+r.getRowSpan()-1===t.iMaxIndex){return false}}else if(a==="COLS"){if(r.getCol()+r.getColSpan()-1===t.iMaxIndex){return false}}}o={iMinIndex:Math.max(0,t.iMinIndex-1),iMaxIndex:t.iMaxIndex}}else{o=t}l=this.checkDropLimitsAgainstCells(e,r,o,a);return l};this.getDropCellFromAnchorCell=function(r,t,a,i){var o=null;if(a==="ROWS"){o=e.getRowHeaderArea().getCellWithColSpan(r.getRow(),t.getCol(),true);if(!o){o=e.getRowHeaderArea().getCellWithRowSpan(r.getRow(),t.getCol(),true)}if(o&&!i){if(r.getRow()+r.getRowSpan()!==o.getRow()+o.getRowSpan()){o=null}}}else if(a==="COLS"){o=e.getColumnHeaderArea().getCellWithRowSpan(t.getRow(),r.getCol(),true);if(!o){o=e.getColumnHeaderArea().getCellWithColSpan(t.getRow(),r.getCol(),true)}if(o&&!i){if(r.getCol()+r.getColSpan()!==o.getCol()+o.getColSpan()){o=null}}}return o};this.checkAreaMoveOnPreviousCell=function(e,r,t,a,i){if(a==="ROWS"){if(r.getRow()===e.getRow()||t.getRow()+t.getRowSpan()===e.getRow()){if(!i){return false}}}else if(a==="COLS"){if(r.getCol()===e.getCol()||t.getCol()+t.getColSpan()===e.getCol()){if(!i){return false}}}return true};this.isDropCellOneBelowOrBeforeBlock=function(e,r,t){var a;if(t==="ROWS"){a=e.getRow()+e.getRowSpan()-1}else if(t==="COLS"){a=e.getCol()+e.getColSpan()-1}return Math.max(0,a)===Math.max(0,r.iMinIndex-1)};this.getNextCell=function(r,t){var a;if(t==="ROWS"){a=e.getRowHeaderArea().getCellWithRowSpan(r.getRow()+r.getRowSpan(),r.getCol())}else if(t==="COLS"){a=e.getColumnHeaderArea().getCellWithColSpan(r.getRow(),r.getCol()+r.getColSpan())}return a};this.checkAreaMoveOnPreviousHierarchyPeerOrBeginOfFollowing=function(e,r,t,a,i){var o;var l;var n=r;if(e.getLevel()>-1&&r.getLevel()>-1){o=this.findPreviousPeerCell(e,a,t);if(o){if(r.getId()===o.getId()){return false}if(a==="ROWS"&&r.getRow()+r.getRowSpan()-1===o.getRow()-1||a==="COLS"&&r.getCol()+r.getColSpan()-1===o.getCol()-1){if(e.getLevel()!==r.getLevel()&&i){return false}}else{if(!this.isDropCellOneBelowOrBeforeBlock(r,t,a)){if(!this.checkMatchingHierarchyLevels(e,r)){return false}}}}else{if(!this.isDropCellOneBelowOrBeforeBlock(r,t,a)){if(!i&&r.getLevel()!==e.getLevel()){l=this.getNextCell(r,a);if(l){o=this.findPreviousPeerCell(l,a,t);if(o&&o.getId()===e.getId()){return false}n=l}}if(!this.checkMatchingHierarchyLevels(e,n)){return false}}}}return true};function v(r){var a;var i;var l;var n;var s;var g;var f;var C;var d;var p;var c;var m;if(!e.isDragAction()||e.isBlocked()){return false}a=sap.zen.Dispatcher.instance.getDragDropPayload();i=jQuery(this);s=t.getDropAreaTypeFromDropAreaId(i.attr("id"));g=s==="droparea_above"||s==="droparea_below"?"ROWS":"COLS";d=s==="droparea_above"||s==="droparea_before";if(!o.checkBasicMemberDropAccept(a,g)){return o.returnFromMemberAreaAcceptCheck(i,false)}n=t.getCrosstabHeaderCellFromDraggable(r);n=t.getEffectiveCell(n);f=n.getArea().isRowHeaderArea()?"ROWS":"COLS";if(f!==g){return o.returnFromMemberAreaAcceptCheck(i,false)}m=sap.ui.getCore().getControl(i.data("xtabcellid"));l=o.getDropCellFromAnchorCell(m,n,f,d);l=t.getEffectiveCell(l);if(!l||l&&l.getId()===n.getId()){return o.returnFromMemberAreaAcceptCheck(i,false)}c=a.oDragDropInfo;p=c.oDropIndexLimits;C=o.checkDropAreaDropLimits(n,l,p,f,d);if(!C){return o.returnFromMemberAreaAcceptCheck(i,false)}C=o.checkAreaMoveOnPreviousCell(n,l,m,f,d);if(!C){return o.returnFromMemberAreaAcceptCheck(i,false)}C=o.checkAreaMoveOnPreviousHierarchyPeerOrBeginOfFollowing(n,l,p,f,d);if(!C){return o.returnFromMemberAreaAcceptCheck(i,false)}return o.returnFromMemberAreaAcceptCheck(i,true)}this.getCommonDropCommand=function(e,r){var t;var a;t=sap.zen.Dispatcher.instance.getDragDropPayload().oDragDropInfo;if(t.sAxisName==="ROWS"){a=e.row}else if(t.sAxisName==="COLS"){a=e.col}r=r.replace("__AXIS__",t.sAxisName);r=r.replace("__ROW__",t.iMemberRow);r=r.replace("__COL__",t.iMemberCol);r=r.replace("__NEW_INDEX__",a);return r};function u(a,l){var n;var s;var g;if(t.checkDropAllowedOnCrosstabElement(a)){n=i.getCellFromJqCell(jQuery(this));n=t.getEffectiveCell(n);s=e.getUtils().translateCellCoordinatesForBackend(n);g=o.getCommonDropCommand(s,r.swapmemberscommand);e.getUtils().executeCommandAction(g);t.resetDragDrop()}else if(!t.checkMouseInRenderSizeDiv(a)){sap.zen.Dispatcher.instance.onUnhandledDrop(a,l)}}function R(a,i){var l;var n;var s;var g;var f;var C;var d;var p;var c;var m=false;if(t.checkDropAllowedOnCrosstabElement(a)){C=sap.zen.Dispatcher.instance.getDragDropPayload().oDragDropInfo;d=C.oDropIndexLimits;p=C.sAxisName;l=sap.ui.getCore().getControl(jQuery(this).data("xtabcellid"));n=t.getCrosstabHeaderCellFromDraggable(jQuery(i.draggable));n=t.getEffectiveCell(n);f=t.getDropAreaTypeFromDropAreaId(jQuery(this).attr("id"));if(f==="droparea_above"||f==="droparea_before"){m=true}s=o.getDropCellFromAnchorCell(l,n,p,m);s=t.getEffectiveCell(s);if(o.isDropCellOneBelowOrBeforeBlock(s,d,p)){m=true;if(p==="ROWS"){s=e.getRowHeaderArea().getCellWithRowSpan(d.iMinIndex,s.getCol())}else if(p==="COLS"){s=e.getColumnHeaderArea().getCellWithColSpan(s.getRow(),d.iMinIndex)}}if(n.getLevel()!==s.getLevel()){s=o.getNextCell(s,p);m=true}g=e.getUtils().translateCellCoordinatesForBackend(s);c=o.getCommonDropCommand(g,r.insertmembercommand);c=c.replace("__INSERT_BEFORE__",m);e.getUtils().executeCommandAction(c);t.resetDragDrop()}else if(!t.checkMouseInRenderSizeDiv(a)){sap.zen.Dispatcher.instance.onUnhandledDrop(a,i)}}this.getLeftOfBeginCellInRowHeader=function(e,r){var a;var i;var o;var l=r;var n;a=r.getCol();o=a;i=r.getRow();if(i<e.getRenderStartRow()+e.getRenderRowCnt()-1){i++}while(l&&o>=0){l=e.getCellWithColSpan(i,o);if(l){r=l;o=l.getCol()-1}}n=t.getBoundingClientRect(document.getElementById(r.getId()));return n.begin};this.getTopOfBeginCellInColHeader=function(e,r){var a;var i;var o;var l=r;var n;a=r.getRow();i=a;o=r.getCol();if(o<e.getRenderStartCol()+e.getRenderColCnt()-1){o++}while(l&&i>=0){l=e.getCellWithRowSpan(i,o);if(l){r=l;i=l.getRow()-1}}n=t.getBoundingClientRect(document.getElementById(r.getId()));return n.top};this.isRowContainsResultCell=function(e,r){var t=0;var a=null;for(t=0;t<e.getColCnt();t++){a=e.getCellWithColSpan(r,t);if(a&&a.isResult()){return true}}return false};this.isColContainsResultCell=function(e,r){var t=0;var a=null;for(t=0;t<e.getRowCnt();t++){a=e.getCellWithRowSpan(t,r);if(a&&a.isResult()){return true}}return false};this.enableRowHeaderCellsAndAreas=function(){var r=0;var i=0;var o=0;var n=0;var d;var p;var I;var h;var D;var M;var x=false;var b=null;var A=false;var w=false;d=e.getRowHeaderArea();if(!e.hasRowHeaderArea()||d&&d.getRenderRowCnt()<2){x=true}if(s){M=s.getTableCol()+s.getColSpan()-1;if(!s.isSplitPivotCell()&&s.sScalingAxis==="ROWS"){M--}}else{M=0}o=d.getRenderStartRow();n=o+d.getRenderRowCnt()-1;for(i=o;i<=n;i++){if(g){A=this.isRowContainsResultCell(d,i)}for(r=0;r<=M;r++){p=d.getCellWithColSpan(i,r);if(!p&&i===o){p=d.getCellWithRowSpan(i,r)}if(p){if(x){b=e.getHeaderInfo().getDimensionInfoByCol(p.getTableCol());if(!b){return}}D=jQuery(document.getElementById(p.getId()));I=t.getBoundingClientRect(D[0]);if(r===M&&!x){if(i===o&&I.top>=l.top){f.iEnd=0;h=a.createAboveDropArea(p,f);t.makeDropAreaDroppable(h,"sapzencrosstab-rowAboveCellMemberDropArea",v,R)}if(I.bottom<=l.bottom){C.iEnd=0;C.iBegin=this.getLeftOfBeginCellInRowHeader(d,p);h=a.createBelowDropArea(p,C);t.makeDropAreaDroppable(h,"sapzencrosstab-rowBelowCellMemberDropArea",v,R)}}if(g){w=A}else{w=p.isResult()}if(!w&&I.top<l.bottom){t.makeCellDraggable(D,c);if(!x){t.makeCellDroppable(D,m,u)}}}}}};this.enableColHeaderCellsAndAreas=function(){var r=0;var i=0;var o=0;var l;var f;var C;var I;var h=0;var D;var M;var x=false;var b=null;var A=false;var w=false;var S={};l=e.getColumnHeaderArea();if(!e.hasColHeaderArea()||l&&l.getRenderColCnt()<2){x=true}if(s){M=s.getTableRow()+s.getRowSpan()-1;if(!s.isSplitPivotCell()&&s.sScalingAxis==="COLS"){M--}}else{M=0}o=l.getRenderStartCol();h=o+l.getRenderColCnt()-1;for(i=0;i<=M;i++){for(r=o;r<=h;r++){if(g){if(typeof S[r]!="undefined"){A=S[r]}else{A=this.isColContainsResultCell(l,r);S[r]=A}}f=l.getCellWithRowSpan(i,r);if(!f&&r===o){f=l.getCellWithColSpan(i,r)}if(f){if(x){b=e.getHeaderInfo().getDimensionInfoByRow(f.getTableRow());if(!b){return}}D=jQuery(document.getElementById(f.getId()));C=t.getBoundingClientRect(D[0]);if(i===M&&!x){if(r===o&&C.begin>=n.begin){d.iBottom=0;I=a.createBeforeDropArea(f,d);t.makeDropAreaDroppable(I,"sapzencrosstab-columnBeforeCellMemberDropArea",v,R)}if(C.end<=n.end){p.iBottom=0;p.iTop=this.getTopOfBeginCellInColHeader(l,f);I=a.createAfterDropArea(f,p);t.makeDropAreaDroppable(I,"sapzencrosstab-columnAfterCellMemberDropArea",v,R)}}if(g){w=A}else{w=f.isResult()}if(!w&&C.begin<n.end){t.makeCellDraggable(D,c);if(!x){t.makeCellDroppable(D,m,u)}}}}}};this.enableMemberDragDrop=function(){this.enableRowHeaderCellsAndAreas();this.enableColHeaderCellsAndAreas()};this.removeMember=function(t,a,i){if(i.bIsMemberDrag&&i.iMemberRow>-1&&i.iMemberCol>-1&&!i.bIsHierarchyMember){var o=r.removemembercommand.replace("__AXIS__",i.sAxisName);o=o.replace("__ROW__",i.iMemberRow);o=o.replace("__COL__",i.iMemberCol);e.getUtils().executeCommandAction(o)}else{sap.zen.Dispatcher.instance.setDragDropCanceled(true)}}};return sap.zen.crosstab.dragdrop.MemberDragDropHandler});
//# sourceMappingURL=MemberDragDropHandler.js.map