/*!
 * (c) Copyright 2010-2019 SAP SE or an SAP affiliate company.
 */
sap.ui.define(["jquery.sap.global","sap/ui/core/Popup","sap/zen/crosstab/TextConstants","sap/zen/crosstab/utils/Utils"],function(jQuery,e,t,n){"use strict";jQuery.sap.declare("sap.zen.crosstab.rendering.ScrollManager");sap.zen.crosstab.rendering.ScrollManager=function(r,o){"use strict";var i=r.getColumnHeaderArea();var l=r.getRowHeaderArea();var a=r.getDimensionHeaderArea();var s=r.getDataArea();var g=o.getMeasuringHelper();var d=0;var u=0;var c=false;var f=false;var p=0;var v=null;var S=null;var h=null;var C=null;var R=new sap.ui.core.Popup;var w=null;if(n.isMainMode()){w=new sap.m.Text}else{w=new sap.ui.commons.TextView;w.setWrapping(false)}R.setContent(w);R.setDurations(125,500);R.setAutoClose(true);R.getContent().addStyleClass("sapzencrosstab-ScrollPopup");var m=(s.getRowCnt()+"").length;var P=(s.getColCnt()+"").length;var H=0;var W=0;var I=false;var b=false;var T=this;this.destroy=function(){R.destroy()};this.setHScrollPos=function(e){u=e};this.setVScrollPos=function(e){d=e};function E(e){var t=0;if(e){t=jQuery(document.getElementById(e.getId())).children("tbody").children("tr").length}return t}function y(){var e=E(l);var t=E(s);var n=e-t;if(n>0){o.beginRendering();o.appendTopRows(s,n);l.setRenderStartRow(s.getRenderStartRow());l.setRenderRowCnt(s.getRenderRowCnt());o.adjustColWidths(a,l);o.adjustColWidths(i,s);o.adjustRowHeights(l,s);o.finishRendering(true)}}function M(e){r.getPageManager().enableTimeout(true);S=null;var t=null;if(!e){t=v}else{t=e.getParameters()}if(t){r.postPlanningValue();var n=r.getHScrollbar();var d=n.getSteps();c=t.newScrollPos===d;u=t.newScrollPos;T.sendClientScrollPosUpdate();var p=t.newScrollPos;if(p!==i.getRenderStartCol()){if(p!==i.getColCnt()){o.beginRendering();o.renderColHeaderArea(p);o.renderDataArea();o.adjustColWidths(i,s);o.adjustRowHeights(l,s);o.adjustRowHeights(a,i);o.finishRendering(true)}var h=g.getAreaWidth(i);var C=g.getUpperRightScrollDivWidth();var w=h<C;var m=i.getRenderColCnt()+i.getRenderStartCol()===i.getColCnt();if(c||w&&m){if(w&&p>0){o.beginRendering();o.appendLeftCols(i,4);o.appendLeftCols(s,4);o.adjustColWidths(i,s);o.adjustRowHeights(l,s);o.adjustRowHeights(a,i);o.finishRendering(true)}if(!c&&t.forward){B(0,true)}j(true)}else{j(false)}}else{if(c){j(true)}}if(f){y();k(true)}if(t.newScrollPos===0){j(false)}}R.close();if(r.isScrollInvalidate()===true&&!r.hasLoadingPages()){r.setInvalidateCalledByScrolling();r.invalidate()}}this.hScrollHandler=function(e,t){if(!I){if(t){M(e)}else{v=e.getParameters();if(S){clearTimeout(S);S=null;D(v.newScrollPos)}S=setTimeout(M,200,null);u=v.newScrollPos}}else{I=false}};function B(e,t){var n=r.getHScrollbar();var o=n.getScrollPosition();var i;if(t){e=n.getSteps();if(r.getPropertyBag().isRtl()&&r.getUtils().isMozilla()){n.setScrollPosition(0);n.setScrollPosition(e)}c=true}if(o!==e){n.setScrollPosition(e);I=true}u=e;i=r.getRenderEngine().getCrossRequestManager();if(i){i.setHScrollInfo(u,c)}}function j(e){T.positionHScrollDiv(e)}this.positionHScrollDiv=function(e){var t=jQuery(document.getElementById(r.getId()+"_upperRight_scrollDiv"));var n=jQuery(document.getElementById(r.getId()+"_lowerRight_scrollDiv"));var o;if(typeof e==="undefined"){e=c}if(r.getPropertyBag().isRtl()){if(jQuery.browser.webkit){o=e?0:n[0].scrollWidth}else if(r.getUtils().isMozilla()){o=e?-n[0].scrollWidth:0}else{o=e?n[0].scrollWidth:0}}else{o=e?n[0].scrollWidth:0}n.scrollLeft(o);t.scrollLeft(o)};this.vScrollHandler=function(e,t){if(!b){if(t){_(e)}else{h=e.getParameters();if(C){clearTimeout(C);C=null;V(h.newScrollPos)}C=setTimeout(_,200,null);d=h.newScrollPos}}else{b=false}};this.sendClientScrollPosUpdate=function(){r.getUtils().sendClientScrollPosUpdate(u,c,d,f)};function D(e){var o=r.getColumnHeaderArea();var i=null;var l=[];for(var a=0;a<1;a++){i=o.getCellWithColSpan(a,e,true);if(i){l.push(i.getUnescapedText())}else{l.push("?")}}var s=r.getPropertyBag().getText(t.COL_TEXT_KEY)+" "+n.padWithZeroes(e+1,P)+"/"+o.getColCnt();if(!W){if(n.isMainMode()){R.getContent().setWrapping(false)}A(s);if(n.isMainMode()){W=jQuery(document.getElementById(R.getContent().getId())).outerWidth()}else{W=jQuery(document.getElementById(R.getContent().getId())).innerWidth()}}if(n.isMainMode()){R.getContent().setMaxLines(l.length+1);R.getContent().setWrapping(true)}s=s+"\n"+l.join("\n");A(s)}function A(t){R.getContent().setProperty("text",t,true);var n=e.Dock;if(W){R.getContent().setWidth(W+"px")}var o=r.getHScrollbar();var i=g.getRenderSizeDivSize().iWidth-g.getAreaWidth(r.getRowHeaderArea());var l=jQuery(document.getElementById(R.getContent().getId())).outerWidth();i=i-l;var a=o.getScrollPosition()/o.getSteps();var s=i*a+" ";R.setPosition(n.BeginBottom,n.BeginTop,document.getElementById(r.getHScrollbar().getId()),s+"-20");if(R.getOpenState()===sap.ui.core.OpenState.CLOSED){R.open(-1)}R.getContent().rerender()}function V(e){var o=r.getRowHeaderArea();var i=null;var l=[];for(var a=0;a<1;a++){i=o.getCellWithRowSpan(e,a,true);if(i){l.push(i.getUnescapedText())}else{l.push("?")}}var s=r.getPropertyBag().getText(t.ROW_TEXT_KEY)+" "+n.padWithZeroes(e+1,m)+"/"+o.getRowCnt();if(!H){if(n.isMainMode()){R.getContent().setWrapping(false)}x(s);if(n.isMainMode()){H=jQuery(document.getElementById(R.getContent().getId())).outerWidth()}else{H=jQuery(document.getElementById(R.getContent().getId())).innerWidth()}}s=s+"\n"+l.join("\n");if(n.isMainMode()){R.getContent().setMaxLines(l.length+1);R.getContent().setWrapping(true)}x(s)}function x(e){R.getContent().setProperty("text",e,true);var t=sap.ui.core.Popup.Dock;var n=r.getVScrollbar();var o=g.getRenderSizeDivSize().iHeight-g.getAreaHeight(r.getColumnHeaderArea());var i=jQuery(document.getElementById(R.getContent().getId())).outerHeight();o=o-i;var l=n.getScrollPosition()/n.getSteps();var a=" "+o*l;R.setPosition(t.EndTop,t.BeginTop,document.getElementById(r.getVScrollbar().getId()),"-20"+a);if(H){R.getContent().setWidth(H+"px")}if(R.getOpenState()===sap.ui.core.OpenState.CLOSED){R.open(-1)}R.getContent().rerender()}function L(e){var t="";var n=1;var r=0;jQuery(document.getElementById(e.getId())).children("tbody").children("tr:last").children("td").each(function(e,o){t=jQuery(o).attr("colspan");if(!t){n=1}else{n=parseInt(t,10)}r=r+n});return r}function z(){var e=L(i);var t=L(s);var n=e-t;if(n>0){o.beginRendering();o.appendLeftCols(s,n);i.setRenderStartCol(s.getRenderStartCol());i.setRenderColCnt(s.getRenderColCnt());o.adjustColWidths(i,s);o.adjustRowHeights(l,s);o.adjustRowHeights(a,i);o.finishRendering(true)}}function _(e){r.getPageManager().enableTimeout(true);C=null;var t=null;if(!e){t=h}else{t=e.getParameters()}if(t){r.postPlanningValue();var n=r.getVScrollbar();var u=n.getSteps();f=t.newScrollPos===u;d=t.newScrollPos;T.sendClientScrollPosUpdate();var p=t.newScrollPos;if(p!==l.getRenderStartRow()){if(p!==l.getRowCnt()){o.beginRendering();o.renderRowHeaderArea(p);o.renderDataArea();o.adjustColWidths(a,l);o.adjustColWidths(i,s);o.adjustRowHeights(l,s);o.finishRendering(true)}var v=g.getAreaHeight(l);var S=g.getLowerScrollDivHeight();var w=v<S;var m=l.getRenderRowCnt()+l.getRenderStartRow()===l.getRowCnt();if(f||w&&m){if(w&&p>0){o.beginRendering();o.appendTopRows(l,2);o.appendTopRows(s,2);o.adjustColWidths(a,l);o.adjustColWidths(i,s);o.adjustRowHeights(l,s);o.finishRendering(true)}if(!f&&t.forward){O(0,true)}k(true)}else{k(false)}}else{if(f){k(true)}}if(t.newScrollPos===0){k(false)}if(c){z();j(true)}}R.close();U()}function U(){var e=r.getRenderEngine().getHeaderScrollManager();if(e){e.moveScrollbars()}}function O(e,t){var n=r.getVScrollbar();var o=n.getScrollPosition();var i;if(t){e=n.getSteps();f=true}if(o!==e){n.setScrollPosition(e);b=true}d=e;i=r.getRenderEngine().getCrossRequestManager();if(i){i.setVScrollInfo(d,f)}}function k(e){T.positionVScrollDiv(e)}this.positionVScrollDiv=function(e){var t=jQuery(document.getElementById(r.getId()+"_lowerRight_scrollDiv"));var n=jQuery(document.getElementById(r.getId()+"_lowerLeft_scrollDiv"));if(typeof e==="undefined"){e=f}p=e?t[0].scrollHeight:0;t.scrollTop(p);n.scrollTop(p)};this.moveScrollbars=function(e,t,n,o){var a=r.getHScrollbar();if(a){if(n!==undefined){c=n}else{c=a.getSteps()<=u&&i.getRenderStartCol()+i.getRenderColCnt()>=i.getColCnt()}if(c){j(true);B(0,true)}else{B(u,false)}}var s=r.getVScrollbar();if(s){if(o!==undefined){f=o}else{f=s.getSteps()<=d&&l.getRenderStartRow()+l.getRenderRowCnt()>=l.getRowCnt()}if(f){O(0,true);k(true)}else{O(d,false)}}};this.commandHScrolledToEnd=function(){c=true};this.commandVScrolledToEnd=function(){f=true};this.isVScrolledToEnd=function(){return f};this.isHScrolledToEnd=function(){return c};this.setVScrolledToEnd=function(e){f=e};this.setHScrolledToEnd=function(e){c=e}};return sap.zen.crosstab.rendering.ScrollManager});
//# sourceMappingURL=ScrollManager.js.map