/*!
 * (c) Copyright 2010-2019 SAP SE or an SAP affiliate company.
 */
sap.ui.define(["jquery.sap.global","sap/zen/crosstab/utils/Utils","sap/zen/crosstab/TextConstants","sap/ui/unified/Menu","sap/ui/commons/Menu","sap/ui/unified/MenuItem","sap/ui/commons/MenuItem","sap/ui/commons/TextView","sap/m/Text","sap/ui/core/Popup"],function(jQuery,e,t,n,i,a,r,o,s,l){"use strict";jQuery.sap.declare("sap.zen.crosstab.TouchHandler");sap.zen.crosstab.TouchHandler=function(g,u){var c=u.getDataArea();var d=u.getRowHeaderArea();var f=u.getColumnHeaderArea();var p=u.getDimensionHeaderArea();var v=0;var h=0;var m=false;var M=false;var b=jQuery(document.getElementById(c.getId()));var E=jQuery(document.getElementById(d.getId()));var T=jQuery(document.getElementById(f.getId()));var C=jQuery(document.getElementById(p.getId()));var S="";var I=null;var y="800";var P=0;var z=0;var B=0;var w=0;var H=0;var D=0;var x=0;var O=0;var R=null;var _=null;var A=2;var X=null;var Y=null;var L=null;var W=false;var N;function U(e){var t=null;var n=0;var i=sap.ui.getCore().getControl(e.target.id);var a=null;var r=null;if(i&&(i.isMobileResize&&i.isMobileResize())){t=i}else{var o=jQuery(e.target).parents("td");if(o){for(n=0;n<o.length;n++){a=jQuery(o[n]);r=a.attr("id");if(r&&r.length>0){i=sap.ui.getCore().getControl(r);if(i&&(i.isMobileResize&&i.isMobileResize())){t=i;break}}}}}return t}function V(e){if(N){var t=e.getParameter("item").oSelectedCell;if(t){N.resizeCol(t,-1)}}}function k(){if(!X){X=sap.ui.getCore().getControl("resizemenu");if(X){X.getItems()[0].destroy();X.destroy()}if(e.isDispatcherAvailable()===true&&sap.zen.Dispatcher.instance.isMainMode()){X=new n("resizemenu",{ariaDescription:"Crosstab Menu",tooltip:"Menu containing crosstab related actions"})}else{X=new i("resizemenu",{ariaDescription:"Crosstab Menu",tooltip:"Menu containing crosstab related actions"})}X.addStyleClass("sapzencrosstab-MenuStyle");var o=null;if(e.isDispatcherAvailable()===true&&sap.zen.Dispatcher.instance.isMainMode()){o=new a("item1",{text:u.getPropertyBag().getText(t.MOBILE_MENUITEM_COLWIDTH_ADJUST_TEXT_KEY)})}else{o=new r("item1",{text:u.getPropertyBag().getText(t.MOBILE_MENUITEM_COLWIDTH_ADJUST_TEXT_KEY)})}o.attachSelect(V);X.addItem(o)}}function K(){B=(c.getRowCnt()+"").length;w=(c.getColCnt()+"").length;R=new l;var t=null;if(e.isDispatcherAvailable()===true&&sap.zen.Dispatcher.instance.isMainMode()){t=new s}else{t=new o}R.setContent(t);R.setDurations(125,500);R.setAutoClose(true);_=R.getContent();_.addStyleClass("sapzencrosstab-ScrollPopup");_.setWrapping(false);var n=l.Dock;R.setPosition(n.CenterCenter,n.CenterCenter,document.getElementById(u.getId()+"_renderSizeDiv"),"0")}function J(){var n=u.getPropertyBag().getText(t.ROW_TEXT_KEY)+": "+e.padWithZeroes(H+1,B)+"/"+d.getRowCnt();var i=u.getPropertyBag().getText(t.COL_TEXT_KEY)+": "+e.padWithZeroes(D+1,w)+"/"+f.getColCnt();var a=n+" "+i;R.getContent().setProperty("text",a,true);R.getContent().rerender()}function Z(t){e.cancelEvent(t);P=0;z=0;H=0;D=0;if(X){X.close()}S=t.currentTarget.getAttribute("id");if(t.originalEvent.touches&&t.originalEvent.touches.length){t=t.originalEvent.touches[0]}else if(t.originalEvent.changedTouches&&t.originalEvent.changedTouches.length){t=t.originalEvent.changedTouches[0]}v=t.pageX;h=t.pageY;m=true;M=false;if(I){window.clearTimeout(I);I=null}I=setTimeout(function(){m=false;M=false;var e=U(t);if(e){k();var n=jQuery(document.getElementById(e.getId()));if(n.length>0){var i=sap.ui.core.Popup.Dock;X.getItems()[0].oSelectedCell=e;X.open(false,n,i.BeginBottom,i.BeginTop,n,0+" "+0,sap.ui.core.Collision.flip)}}},y)}function j(e,t){var n=u.getHorizontalHeaderScrollbar();if(n){O=n.getScrollPosition();D=Math.max(O-e,0);if(t>0){u.scrollHeaderHorizontal(D)}}}function q(t,n,i,a){if(u.getPropertyBag().isPixelScrolling()){if(Y){x=Y.getScrollPosition();H=Math.max(x-n,0)}if(L){O=L.getScrollPosition();D=Math.max(O-t,0)}if(Y&&a>0){u.scrollVertical(H)}if(L&&i>0){u.scrollHorizontal(D)}}else{if(R.getOpenState()===sap.ui.core.OpenState.CLOSED){R.open(-1)}if(Y){if(u.getRenderEngine().isVScrolledToEnd()){if(e.sign(n)>0){P-=e.sign(n)}else{P=0}}else{P-=e.sign(n)}x=d.getRenderStartRow();H=Math.max(Math.floor(P/A)+x,0);H=Math.min(c.getRowCnt()-1,H)}if(L){if(u.getRenderEngine().isHScrolledToEnd()){if(e.sign(t)>0){z-=e.sign(t)}else{z=0}}else{z-=e.sign(t)}O=f.getRenderStartCol();D=Math.max(Math.floor(z/A)+O,0);D=Math.min(c.getColCnt()-1,D)}J()}}function G(t){e.cancelEvent(t);if(m==false){return true}if(t.originalEvent.touches&&t.originalEvent.touches.length){t=t.originalEvent.touches[0]}else if(t.originalEvent.changedTouches&&t.originalEvent.changedTouches.length){t=t.originalEvent.changedTouches[0]}var n=t.pageX;var i=t.pageY;var a=n-v;var r=i-h;var o=Math.abs(r);var s=Math.abs(a);if(o>s&&s<10){a=0;s=0}else if(s>o&&o<10){r=0;o=0}if(a==0&&r==0){M=false;return true}M=true;if(I){window.clearTimeout(I);I=null}Y=u.getVScrollbar();L=u.getHScrollbar();W=false;if(S===d.getId()){W=u.isHeaderHScrolling()&&a!==0;if(!W){a=0;s=0}}else if(S===f.getId()){r=0;o=0}else if(S===p.getId()){W=u.isHeaderHScrolling()&&a!==0;if(!W){a=0;s=0}r=0;o=0}if(W===true){j(a,s)}else{q(a,r,s,o)}v=t.pageX;h=t.pageY;return null}function F(t){e.cancelEvent(t);if(I){window.clearTimeout(I);I=null}if(m==false){return true}if(!M){g.executeOnClickAction(t)}m=false;M=false;if(!W){if(!u.getPropertyBag().isPixelScrolling()){if(R.getOpenState()===sap.ui.core.OpenState.OPEN||R.getOpenState()===sap.ui.core.OpenState.OPENING){R.close()}var n=false;if(H!==x){u.scrollVertical(H);n=true}if(D!==O){u.scrollHorizontal(D);n=true}if(n===true){g.attachEvents()}}P=0;z=0}}this.registerTouchEvents=function(e){K();var t="touchstart";if(u.getPropertyBag().isTestMobileMode()&&!u.getPropertyBag().isMobileMode()){t="mousedown"}b.unbind(t);b.bind(t,Z);E.unbind(t);E.bind(t,Z);T.unbind(t);T.bind(t,Z);C.unbind(t);C.bind(t,Z);t="touchmove";if(u.getPropertyBag().isTestMobileMode()&&!u.getPropertyBag().isMobileMode()){t="mousemove"}e.unbind(t);e.bind(t,G);t="touchend";if(u.getPropertyBag().isTestMobileMode()&&!u.getPropertyBag().isMobileMode()){t="mouseup"}e.unbind(t);e.bind(t,F)};this.setColResizer=function(e){N=e}};return sap.zen.crosstab.TouchHandler});
//# sourceMappingURL=TouchHandler.js.map