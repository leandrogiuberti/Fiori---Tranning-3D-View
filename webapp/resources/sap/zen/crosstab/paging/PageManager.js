/*!
 * (c) Copyright 2010-2019 SAP SE or an SAP affiliate company.
 */
sap.ui.define("sap/zen/crosstab/paging/PageManager",["jquery.sap.global","sap/zen/crosstab/paging/Page","sap/zen/crosstab/paging/PagingConstants","sap/zen/crosstab/paging/RequestHandler","sap/zen/crosstab/paging/CellMerger","sap/zen/crosstab/datahandler/JsonDataHandler"],function(jQuery,e,t,r,a,i){"use strict";jQuery.sap.declare("sap.zen.crosstab.paging.PageManager");sap.zen.crosstab.paging.PageManager=function(n){var s=new i(n);var o=new a(this);var u=null;var l={};var f={};var g=0;var v=0;var c="";var h=0;var d=0;var R=false;var C=[];var p=false;var P=true;var A={};var w={};var T={};var S={};var m={};var y={};var M={};var H={};function b(){D();if(p||P){p=false;P=false;_()}}function _(){var e=n.getDataArea();var t=e.getRenderRowCnt();var r=e.getRenderColCnt();var a=Math.round(r/v)+1;var i=Math.round(t/g)+1;var s=Math.max(1,a*i*2);if(u){u.setMaxQueueRequests(s)}}this.enableTimeout=function(e){if(u){u.enableTimeout(e)}};this.getRequestStackSize=function(){var e=-1;if(u){e=u.getMaxQueueRequests()}return e};this.resizeEvent=function(){p=true;if(u){u.unlimitStack()}};this.checkResponseConsistency=function(e){if(e.pvcheck||e.removeselection){return true}if(g>0&&v>0){return e.tilerows===g&&e.tilecols===v}return true};this.receiveData=function(e){var t=this.checkResponseConsistency(e);if(t){K(e);var r={};r.iRow=h;r.iCol=d;var a=null;var i=z();if(i){a=this.createPage(r);R=true}else{a=this.getPage(r)}if(a){a.receiveData(e,i)}if(n.getPropertyBag().isDebugMode()){var s=a.getPosition();var o=s.iRow+"_"+s.iCol;A[o]={};A[o].component=e}}};function D(){var e=0;var t=null;var r="";for(e=0;e<C.length;e++){t=C[e];if(t){t.removeData();r=t.getPageKey();delete l[r]}}C=[]}n.getRenderEngine().addAfterFinishRenderingHandler(b);this.removeRequest=function(e){C.push(e)};this.getRequestCommandTemplate=function(){return c};this.removeHeaderTileRequest=function(e,r,a){var i=f[e.getAreaType()];if(i){var n=i[r];if(n){var s=jQuery.inArray(a,n.aRequestingPages);if(s!==-1){n.aRequestingPages.splice(s,1);if(n.aRequestingPages.length===0){n.iStatus=t.PAGE_STATUS_UNKNOWN}}}}};this.getHeaderTileInfo=function(e,t){return q(e,t)};this.setHeaderTileInfo=function(e,t,r){var a=N(e);a[t]=r};function N(e){var t=f[e.getAreaType()];if(!t){t={};f[e.getAreaType()]=t}return t}function q(e,r){var a=N(e);var i=a[r];if(!i){i={};i.iStatus=t.PAGE_STATUS_UNKNOWN;i.iRefCnt=0;a[r]=i}return i}this.ensureCellAvailable=function(e,a,i){var n=null;var s=t.PAGE_STATUS_UNKNOWN;var o=false;var l=false;var f=e.getAreaType()+"/"+a+"/"+i;if(!w[f]){var g=E(a,i,e);if(g){if(e.isRowHeaderArea()){s=this.getHeaderTileInfo(e,g.iRow).iStatus;o=true}else if(e.isColHeaderArea()){s=this.getHeaderTileInfo(e,g.iCol).iStatus;o=true}n=this.getPage(g);if(o){if(s===t.PAGE_STATUS_UNKNOWN){l=true}}else{l=!n}if(l){n=this.createPage(g);n.provideLoadingCells(e);if(!u){u=new r(this)}u.sendPageRequest(n)}else{if(n&&n.getStatus()===t.PAGE_STATUS_LOADED||s&&s===t.PAGE_STATUS_LOADED){w[f]=true;U(e,a,i)}}}}};this.reset=function(){l={};f={};R=false;if(u){u.reset()}P=true;A={};w={};T={};S={};m={};y={};M={};H={};g=0;v=0};this.getDataHandler=function(){return s};this.getTileRowCnt=function(){return g};this.getTileColCnt=function(){return v};this.getPageKeyFromPos=function(e){return this.getPageKeyFromRowCol(e.iRow,e.iCol)};this.getPageKeyFromRowCol=function(e,t){return e+"/"+t};this.getPagePosFromKey=function(e){var t={};var r=e.split("/");t.iRow=parseInt(r[0],10);t.iCol=parseInt(r[1],10);return t};this.getCrosstab=function(){return n};this.createPage=function(t){var r=null;var a=this.getPageKeyFromPos(t);if(a){r=new e(t,a,this);l[a]=r}return r};this.getPage=function(e){return this.getPageFromRowCol(e.iRow,e.iCol)};this.getPageFromRowCol=function(e,t){var r=null;var a=this.getPageKeyFromRowCol(e,t);if(a){r=l[a]}return r};this.getCellMerger=function(){return o};function z(){return h===0&&d===0||!R}function K(e){g=e.tilerows;v=e.tilecols;c=e.scrollaction;h=e.v_pos;if(h){h=Math.floor(h/g)}else{h=0}d=e.h_pos;if(d){d=Math.floor(d/v)}else{d=0}}function E(e,t,r){var a={iRow:0,iCol:0};if(r.isRowHeaderArea()){a.iRow=Math.floor(e/g);a.iCol=Math.floor(n.getColumnHeaderArea().getRenderStartCol()/v)}else if(r.isColHeaderArea()){a.iRow=Math.floor(n.getRowHeaderArea().getRenderStartRow()/g);a.iCol=Math.floor(t/v)}else if(r.isDataArea()){a.iRow=Math.floor(e/g);a.iCol=Math.floor(t/v)}return a}this.getReceivedPages=function(){return JSON.stringify(A)};function U(e,t,r){if(e.isRowHeaderArea()){F(T,t,r);F(S,r,t)}else if(e.isColHeaderArea()){F(m,t,r);F(y,r,t)}else if(e.isDataArea()){F(M,t,r);F(H,r,t)}}function F(e,t,r){if(!e[t]){e[t]=[]}e[t].push(r)}function O(e,t){var r=null;if(e.isDataArea()){r=t?M:H}else if(e.isRowHeaderArea()){r=t?T:S}else if(e.isColHeaderArea()){r=t?m:y}return r}this.getLoadedCellColumnsByRow=function(e,t){var r=[];var a=O(e,true);if(a){r=a[t]}return r};this.getLoadedCellRowsByCol=function(e,t){var r=[];var a=O(e,false);if(a){r=a[t]}return r};this.getPages=function(){return l};this.isCellLoaded=function(e,t,r){var a=e.getAreaType()+"/"+t+"/"+r;if(w[a]){return true}return false}};return sap.zen.crosstab.paging.PageManager});
//# sourceMappingURL=PageManager.js.map