/*!
 * (c) Copyright 2010-2019 SAP SE or an SAP affiliate company.
 */
sap.ui.define(["jquery.sap.global","sap/zen/crosstab/rendering/RenderingConstants"],function(jQuery,e){"use strict";jQuery.sap.declare("sap.zen.crosstab.keyboard.CrosstabKeyboardNavHandler");sap.zen.crosstab.keyboard.CrosstabKeyboardNavHandler=function(t,l){var r=-1;var a=-1;var o=-1;var i=-1;var n=0;var s=0;var g=this;var c=false;var f=t.getDataArea();this.reset=function(){this.disableCell(r,a);this.disableCell(o,i);r=-1;a=-1;o=-1;i=-1;n=0;s=0};this.setEnabled=function(e){c=e};this.attachEvents=function(t){if(!c){return}t.off("keydown",this.keyboardNavKeyHandler);t.on("keydown",this.keyboardNavKeyHandler);t.attr("tabindex",e.TABINDEX)};this.getFocusScrollDiv=function(e){var l=null;if(e.getArea().isDataArea()||e.getArea().isColHeaderArea()){l=document.getElementById(t.getId()+"_lowerRight_scrollDiv")}else if(e.getArea().isRowHeaderArea()){l=document.getElementById(t.getId()+"_lowerLeft_scrollDiv")}return l};this.movePixelCellIntoFocus=function(e,l,r,a,o,i){var n=false;var s=t.getUtils().getRtlAwareBoundingClientRect(l);var g=r.width;var c=s.width;var f=r.height;var d=s.height;if(c<g){if(s.end>r.end){var u=t.getHScrollbar().getScrollPosition();t.scrollHorizontal(u+s.end-r.end);n=true}else if(s.begin<r.begin){u=t.getHScrollbar().getScrollPosition();t.scrollHorizontal(u-(r.begin-s.begin));n=true}}if(a||o||i){if(d<f){if(s.bottom>r.bottom){u=t.getVScrollbar().getScrollPosition();t.scrollVertical(u+s.bottom-r.bottom);n=true}else if(s.top<r.top){u=t.getVScrollbar().getScrollPosition();t.scrollVertical(u-(r.top-s.top));n=true}}else{u=t.getVScrollbar().getScrollPosition();t.scrollVertical(u-(r.top-s.top));n=true}}return n};this.moveRowHeaderAreaCellHorizontally=function(e,l){var r=t.getUtils().getRtlAwareBoundingClientRect(document.getElementById(t.getId()+"_lowerLeft_scrollDiv"));var a=t.getUtils().getRtlAwareBoundingClientRect(l);var o=r.width;var i=a.width;var n=t.getHorizontalHeaderScrollbar();if(i<o){if(a.end>r.end){var s=n.getScrollPosition();t.scrollHeaderHorizontal(s+a.end-r.end)}else if(a.begin<r.begin){s=n.getScrollPosition();t.scrollHeaderHorizontal(s-(r.begin-a.begin))}}};this.moveRowColCellIntoFocus=function(e,l,r,a,o,i){var n=false;var s=t.getUtils().getRtlAwareBoundingClientRect(l);var g=r.width;var c=s.width;var f=t.getDataArea().getRenderStartCol();var d=t.getDataArea().getRenderStartRow();var u=t.getDataArea().getRowCnt()-1;if(e.getArea().isDataArea()||e.getArea().isColHeaderArea()){var v=t.getHScrollbar();if(v){if(c<g){if(s.end>r.end){t.scrollHorizontal(f+1);n=true}else if(s.begin<r.begin){t.scrollHorizontal(f-1);n=true}}}}if(t.isHeaderHScrolling()===true&&e.getArea().isRowHeaderArea()){this.moveRowHeaderAreaCellHorizontally(e,l)}if(d===e.getTableRow()-t.getTableFixedColHeaderRowCnt()){return n}if(e.getArea().isDataArea()||e.getArea().isRowHeaderArea()&&a||o||i){var b=t.getVScrollbar();if(b){var C=t.getDataArea().getRenderRowCnt();var R=b.getScrollPosition();var h=e.getTableRow()-t.getTableFixedColHeaderRowCnt();if(h<d){t.scrollVertical(h);n=true}else if(h+e.getRowSpan()>d+C){var w=d+C-e.getRow();var S=e.getRowSpan()-w;var T=Math.max(0,Math.min(R+S+1,u));if(S!==0){t.scrollVertical(T);n=true}d=t.getDataArea().getRenderStartRow();if(d>h){t.scrollVertical(h);n=true}}d=t.getDataArea().getRenderStartRow();if(d===e.getTableRow()-t.getTableFixedColHeaderRowCnt()){return n}if(n){l=document.getElementById(e.getId());s=t.getUtils().getRtlAwareBoundingClientRect(l);R=b.getScrollPosition()}if(s.bottom>r.bottom){while(s.bottom>r.bottom&&R<u){t.scrollVertical(Math.min(R+1,u));R=b.getScrollPosition();l=document.getElementById(e.getId());s=t.getUtils().getRtlAwareBoundingClientRect(l);n=true}}else if(s.top<r.top){t.scrollVertical(Math.max(0,R-1));n=true}}}return n};this.getCellIntoDom=function(e,l,r){var a=0;if(s===0){var o=t.getHScrollbar();if(o&&!r){if(n>0){a=o.getScrollPosition()+l.getColSpan()}else if(n<0){a=e.getTableCol()-t.getTableFixedRowHeaderColCnt()}t.scrollHorizontal(a)}}else if(n==0){var i=t.getVScrollbar();if(i){if(s>0){a=i.getScrollPosition()+l.getRowSpan()}else{if(s<0){a=e.getTableRow()-t.getTableFixedColHeaderRowCnt()}}t.scrollVertical(a)}}};this.getRowLookAheadCell=function(e){var l=null;var a=null;var o=0;var i=0;if(e.getRowSpan()>1){if(n>0){i=e.getTableCol();o=t.getRenderStartCol()+t.getRenderColCnt()+t.getTableFixedRowHeaderColCnt();for(var s=i;s<=o;s++){a=t.getTableCellWithSpans(r,s);if(a.getRowSpan()===1){l=a;break}else{if(l){if(a.getRowSpan()<l.getRowSpan()){l=a}}else{l=a}}}}}else{l=e}return l};this.scrollCellIntoFocus=function(e,l,r,a){var o=e;var i=false;if(!l&&e.getArea().isRowHeaderArea()&&r===true&&t.getVScrollbar()&&!t.isHeaderHScrolling()){if(n>0&&s===0){o=this.getRowLookAheadCell(e)}}if(o!==e){e=o;i=true}var g=this.getFocusScrollDiv(e);if(!g){return false}var c=false;var f=t.getPropertyBag().isPixelScrolling();var d=document.getElementById(e.getId());if(!d&&!f){this.getCellIntoDom(e,a,r)}if(!d){return false}var u=t.getUtils().getRtlAwareBoundingClientRect(g);if(f){c=this.movePixelCellIntoFocus(e,d,u,l,i,r)}else{c=this.moveRowColCellIntoFocus(e,d,u,l,i,r)}return c};this.keyboardNavKeyHandler=function(e){if(r>-1&&a>-1){n=0;s=0;if(e.which===9){n=1}else if(e.which===38){s=-1}else if(e.which===40){s=1}else if(e.which===37){n=-1}else if(e.which===39){n=1}if(n===0&&s===0){return true}else{if(!t.hasLoadingPages()){g.moveCellFocus()}sap.zen.crosstab.utils.Utils.cancelEvent(e);return false}}return true};this.restoreFocusOnCell=function(){if(!c){return}if(r>-1&&a>-1&&!t.hasLoadingPages()){var e=t.getTableCellWithSpans(r,a);if(e&&!e.isLoading()){this.disableCell(o,i);this.navigateToCellAction(e,-1,-1)}}};function d(e,t){var l=t.scrollLeft;var r=t.scrollTop;e.focus();if(t.scrollLeft!==l){t.scrollLeft=l}if(t.scrollTop!==r){t.scrollTop=r}}this.navigateToCellAction=function(e,t,r){var a=null;var o=null;var i=null;var n=null;a=jQuery(document.getElementById(e.getId()));a.addClass("sapzencrosstab-CellFocus");o=jQuery(document.getElementById(e.getId()+"_contentDiv"));n=a.find("#"+jQuery.sap.encodeCSS(e.getId()+"_textContentDiv"));if(!e.isEntryEnabled()){i=this.getFocusScrollDiv(e);if(n.length>0){o=n}if(jQuery.browser.mozilla){d(o,i)}var s=o[0];if(s&&t===-1&&r===-1){sap.zen.crosstab.utils.Utils.selectTextInElement(s)}d(o,i)}else{l.provideInputEnabledCell(e,e.getId(),o,t,r)}};this.navigateFromCellAction=function(e){var t=jQuery(document.getElementById(e.getId()));if(t.length>0){t.removeClass("sapzencrosstab-CellFocus")}var l=t.find("input");l.focusout()};this.focusNewCell=function(e,l,n){if(!c){return false}if(!e){return false}var s=false;if(r>-1&&a>-1){this.disableCell(r,a)}r=e.getTableRow();a=e.getTableCol();o=r;i=a;var g=t.getVScrollbar();var f=t.getHScrollbar();if(g||f){if(g){s=this.scrollCellIntoFocus(e,true,false,null)}}this.navigateToCellAction(e,l,n);return s};this.scrollToCell=function(e){var l=e.getTableRow()-t.getTableFixedColHeaderRowCnt();var r=e.getTableCol()-t.getTableFixedRowHeaderColCnt();var a=l<t.getRenderStartRow()||l>t.getRenderStartRow()+t.getRenderRowCnt();var o=false;if(e.getArea().isDataArea()||e.getArea().isColHeaderArea()){o=r<t.getRenderStartCol()||r>t.getRenderStartCol()+t.getRenderColCnt()}if(t.getVScrollbar()&&a){t.scrollVertical(e.getTableRow()-t.getTableFixedColHeaderRowCnt())}if(t.getHScrollbar()&&e.getArea().isDataArea()&&o){t.scrollHorizontal(e.getTableCol()-t.getTableFixedRowHeaderColCnt())}};this.disableCell=function(e,l){var r=null;if(e>-1&&e>-1){r=t.getTableCellWithSpans(e,l);if(r&&!r.isLoading()){this.navigateFromCellAction(r)}}};this.moveCellFocus=function(){if(!c){return}var e=null;var l=-1;var g=-1;var d=t.getTableRowCnt()-1;var u=t.getTableColCnt()-1;var v=t.getTableFixedColHeaderRowCnt();o=r;i=a;var b=false;var C=false;var R=t.getTableCellWithSpans(o,i);if(R&&!t.hasLoadingPages()){if(n!==0||s!==0){this.scrollToCell(R)}}if(s<0){if(R.getTableRow()===v){return}}else if(s>0){if(R.getTableRow()+R.getRowSpan()-1===d){return}}this.disableCell(R.getTableRow(),R.getTableCol());if(r>-1&&a>-1){if(n===0&&s===0){return}var h=r;var w=a;if(n!==0){if(n>0){w=R.getTableCol()+R.getColSpan()+n-1;if(w>u){if(h<d){h++;w=0;l=0;b=true}else{w=u;h=d}}}else{w=R.getTableCol();w--;if(w>=0){var S=t.getTableCellWithSpans(h,w);if(!S){return}if(S.isLoading()){return}w=S.getTableCol()}else{if(h>v){h--;w=u;l=u;if(h<f.getRenderStartRow()+v){g=h-v}b=true}else{w=0;h=v}}}e=t.getTableCellWithSpans(h,w);if(e.isLoading()){return}if(R){if(R.getArea()!==e.getArea()&&l===-1){l=0}}}else if(s!==0){if(s>0){h=Math.min(R.getTableRow()+R.getRowSpan()+s-1,d)}else if(s<0){h=Math.max(R.getTableRow()+s,v)}e=t.getTableCellWithSpans(h,w);if(e.isLoading()){return}h=e.getTableRow();C=true}r=h;a=w}if(e){if(g>=0){t.scrollVertical(g)}if(l>=0){t.scrollHorizontal(l)}this.scrollCellIntoFocus(e,C,b,R);this.navigateToCellAction(e,-1,-1)}}};return sap.zen.crosstab.keyboard.CrosstabKeyboardNavHandler});
//# sourceMappingURL=CrosstabKeyboardNavHandler.js.map