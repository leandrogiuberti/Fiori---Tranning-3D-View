/*!
 * 
		SAP UI development toolkit for HTML5 (SAPUI5)
		(c) Copyright 2009-2015 SAP SE. All rights reserved
	
 */
sap.ui.define(["sap/ui/core/Control","sap/m/NavContainer","sap/ui/model/resource/ResourceModel","./manageCards/CardsList","sap/insights/CardHelper","sap/ui/core/Lib","sap/ui/core/Core","./utils/InsightsUtils"],function(t,e,i,a,s,r,n,o){"use strict";var d=t.extend("sap.insights.ManageCards",{metadata:{properties:{enableResetAllCards:{type:"boolean",group:"Behavior",defaultValue:false},cardId:{type:"string",group:"Behavior",defaultValue:null}},aggregations:{_navContainer:{type:"sap.m.NavContainer",multiple:false,visibility:"hidden"}}},renderer:{apiVersion:2,render:function(t,e){t.openStart("div",e);t.style("height","100%");t.style("width","100%");t.openEnd();e._oNavContainer.to(e._oNavContainer.getInitialPage());t.renderControl(e.getAggregation("_navContainer"));t.close("div")}}});d.prototype.onAfterRendering=function(){var t;this._oNavContainer.setBusy(true);s.getServiceAsync().then(function(t){return t._getUserAllCardModel()}).then(function(e){t=e;if(!this._cardListPage){this._cardListPage=new a(this.getId()+"cardList",{enableResetAllCards:this.getEnableResetAllCards(),listPress:this._navToDetails.bind(this)});this._cardListPage.setModel(t);this._cardListPage._handleModelChange();t.bindProperty("/cards").attachChange(function(t){this._cardListPage._handleModelChange()}.bind(this));this._oNavContainer.addPage(this._cardListPage)}var i=this.getCardId();if(i){var s=t.getProperty("/cards");var r=s.find(function(t){return t.id===i});if(r){this.loadCardDetails().then(function(){this._oNavContainer.addPage(this._cardDetailControl);var t=JSON.stringify(r);this._cardDetailControl.setProperty("manifest",t,false);this._oNavContainer.to(this._cardDetailControl)}.bind(this))}}else{this._oNavContainer.setInitialPage(this._cardListPage);this._oNavContainer.to(this._cardListPage)}this._oNavContainer.setBusy(false)}.bind(this))};d.prototype.loadCardDetails=function(){return new Promise(async function(t){if(!this._cardDetailControl){await r.load({name:"sap/ui/mdc"});sap.ui.require(["sap/insights/manageCards/CardDetails"],function(e){this._cardDetailControl=new e(this.getId()+"previewPage",{navigate:this.navigateTo.bind(this)});t()}.bind(this))}else{t()}}.bind(this))};d.prototype.init=function(){this._oNavContainer=new e(this.getId()+"--selectionNavCon",{busy:true});this._oNavContainer.setModel(new i({bundle:o.getResourceBundle()}),"i18n");this.setAggregation("_navContainer",this._oNavContainer)};d.prototype.navigateTo=function(t,e){if(!t&&e){this._oNavContainer.to(e)}else{this._oNavContainer.to(this._cardListPage.getId())}};d.prototype._navToDetails=function(t){if(t&&t.getParameter("manifest")){this._oNavContainer.setBusy(true);this.loadCardDetails().then(function(){this._cardDetailControl.setProperty("manifest",t.getParameter("manifest"),false);if(!this._oNavContainer.getPage(this._cardDetailControl.getId())){this._oNavContainer.addPage(this._cardDetailControl)}this._cardDetailControl.oPage.setShowNavButton(true);if(t.getParameter("listRefresh")){this._cardDetailControl._refreshDTSmartForm(t.getParameter("listRefresh"))}this._cardDetailControl.setEditable(false);this._oNavContainer.setBusy(false);this._oNavContainer.to(this._cardDetailControl)}.bind(this))}};d.prototype.clearPage=function(){if(this._cardListPage){this.navigateTo();if(this._cardListPage._oSearchField){this._cardListPage._oSearchField.clear()}if(this._cardListPage._oVisibleFilterSwitch&&this._cardListPage._oVisibleFilterSwitch.getState()){this._cardListPage._oVisibleFilterSwitch.setState(false);this._cardListPage._oVisibleFilterSwitch.fireChange()}}this.setProperty("cardId","")};return d});
//# sourceMappingURL=ManageCards.js.map