/*!
 * 
		SAP UI development toolkit for HTML5 (SAPUI5)
		(c) Copyright 2009-2015 SAP SE. All rights reserved
	
 */
sap.ui.define(["sap/ui/base/Object","sap/insights/CardHelper"],function(i,e){return i.extend("sap.insights.CardProvider",{constructor:function(i,s){e.getServiceAsync().then(function(e){e.getCardsChannel().then(function(e){if(e.isEnabled()){this.channel=e;this.id=i;this.sharedCards=s;this.consumers={};this._registerProvider()}}.bind(this))}.bind(this))},_registerProvider:function(){if(this.channel){return this.channel.registerProvider(this.id,this).then(function(){this.registered=true}.bind(this))}},_unregisterProvider:function(){if(this.channel){return this.channel.unregister(this.id).then(function(){this.registered=false;this.consumers={};this.sharedCards=[]}.bind(this))}},_shareAvailableCards:function(i){var e=this.sharedCards.map(function(i){return{id:i.id,title:i.descriptorContent["sap.card"].header.title,parentAppId:i.descriptorContent["sap.insights"].parentAppId,description:i.descriptorContent["sap.card"].header.subTitle?i.descriptorContent["sap.card"].header.subTitle:""}});this.channel.publishAvailableCards(this.id,e,i)},onConsumerConnected:function(i){if(!this.consumers[i]){this.consumers[i]=true;this._shareAvailableCards(i)}},onConsumerDisconnected:function(i){if(this.consumers[i]){delete this.consumers[i]}},onCardRequested:function(i,e){if(this.consumers[i]){var s=this.sharedCards.find(function(i){return i.id===e});if(s){this.publishCard(this.id,s,i)}}},onViewUpdate:function(i,e){if(this.registered!==i){if(i){this._registerProvider().then(function(){this.sharedCards=e;this._shareAvailableCards()}.bind(this))}else{this._unregisterProvider()}}else{if(this.registered){this.sharedCards=e;this._shareAvailableCards()}}}})});
//# sourceMappingURL=CardProvider.js.map