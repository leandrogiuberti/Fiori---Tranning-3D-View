/*!
 * 
		SAP UI development toolkit for HTML5 (SAPUI5)
		(c) Copyright 2009-2015 SAP SE. All rights reserved
	
 */
sap.ui.define(["../utils/SelectionVariantHelper","sap/fe/navigation/SelectionVariant","sap/m/DynamicDateUtil","sap/ui/comp/util/DateTimeUtil","sap/ui/core/format/DateFormat","../utils/AppConstants","sap/ui/model/odata/v2/ODataModel","sap/ui/core/date/UI5Date","sap/ui/comp/odata/type/StringDate"],function(e,a,t,r,i,n,o,s,u){function l(t,r,i){var n=t.descriptorContent["sap.card"].configuration.parameters;var o=t.descriptorContent["sap.card"]["data"]["request"];var s=false,u={},l={};if(o&&o.batch){s=true;u=o.batch.header||{};l=o.batch.content||{}}var T=t&&n._headerDataUrl,D=t&&n._contentDataUrl;var g=new a;var h=n._relevantODataFilters.value;var E=n._relevantODataParameters.value;var S=f(n);c(n,g,false);p(n,g,false);var y=n._entitySet.value;var A=y;if(E.length){var O={};E.forEach(function(e){O[e]=n[e].type});A+=e.getParameterQueryFromSV(g,O);var I=A;if(I&&Array.isArray(I.match(/%27datetime[a-zA-Z0-9%-:]*[,)%2c]/gm))&&I.match(/%27datetime[a-zA-Z0-9%-:]*[,)%2c]/gm).length){A=d(I)}}if(n._urlSuffix.value){A+=n._urlSuffix.value}var L={};h.forEach(function(e){L[e]=n[e].type});var M=e.getFilterQueryFromSV(g,L);var H=M;if(H&&Array.isArray(H.match(/%27datetime[a-zA-Z0-9%-:]*[,)%2c]/gm))&&H.match(/%27datetime[a-zA-Z0-9%-:]*[,)%2c]/gm).length){M=d(H)}var w="",_="",R="",V="",N={header:"",content:""};if(s){w=m(n,"_header",M,t.descriptorContent["sap.card"].type);_=w?A+"?"+w:A;if(T&&T.value){var P=v(S,_);if(P){u.url="{= extension.formatters.formatHeaderDataUrlForSemanticDate() }";T.value=""}else{T.value=_;if(r){r._headerDataUrl=T.value}}}else if(T){if(r&&!i){T.value=_;r._headerDataUrl=T.value}N.header=_}}if(n._contentDataUrl){R=m(n,"_content",M,t.descriptorContent["sap.card"].type);V=R?A+"?"+R:A;if(n._contentDataUrl.value){var Q=v(S,V);if(Q){if(s){l.url="{= extension.formatters.formatContentDataUrlForSemanticDate() }"}else{o.url="{= extension.formatters.formatContentDataUrlForSemanticDate() }"}D.value=""}else{D.value=V;if(r){r._contentDataUrl=D.value}}}else{if(r&&!i){D.value=V;r._contentDataUrl=D.value}N.content=V;return N}if(i){N.header=_;N.content=V;return N}}}function f(e){var a=e._semanticDateRangeSetting,t=[];if(a){a=JSON.parse(a.value);t=Object.keys(a)||[]}return t}function c(e,t,r,i){var n=f(e);var s=e._relevantODataFilters.value;s.forEach(function(s){var u=new a(e[s].value);var l=u.getSelectOption(s);var f=[];if(l&&l.length){if(n.includes(s)){f=T(l[0],"Filter",e[s].type,r);if(f.length){l[0].Low=f[0];l[0].High=f[1]?f[1]:null;if(l[0].Low&&l[0].High&&l[0].Option!=="BT"){l[0].Option="BT"}t.massAddSelectOption(s,l)}else if(o&&o.prototype.formatValue&&l[0]){l[0].Low=o.prototype.formatValue(l[0].Low,"Edm.DateTime");if(l[0].High){l[0].High=o.prototype.formatValue(l[0].High,"Edm.DateTime")}t.massAddSelectOption(s,l)}}else{if(o&&o.prototype.formatValue&&l[0]&&e[s].type==="datetime"){l[0].Low=o.prototype.formatValue(l[0].Low,"Edm.DateTime");if(l[0].High){l[0].High=o.prototype.formatValue(l[0].High,"Edm.DateTime")}t.massAddSelectOption(s,l)}t.massAddSelectOption(s,l)}if(r&&l.length===1&&l[0].Sign==="I"&&l[0].Option!=="EQ"){delete i.ibnParams[s]}}})}function p(e,a,t,r){var i=f(e);var n=e._relevantODataParameters.value;n.forEach(function(n){var u="";if(e[n].value){if(e[n].value.value||typeof e[n].value.value=="string"){u=e[n].value.value.toString()}else if(e[n].value instanceof Date){u=e[n].value}else{u=e[n].value.toString()}}if(e[n].type==="datetime"&&!i.includes(n)&&!u.includes("datetime")){if(o&&o.prototype.formatValue){u=o.prototype.formatValue(u,"Edm.DateTime");a.addParameter(n,u)}}else if(e[n].type==="datetime"&&i.includes(n)){u=typeof e[n].value==="string"&&Date.parse(e[n].value)?T(s.getInstance(u),"Parameter",e[n].type,t):T(u,"Parameter",e[n].type,t);if(u[0]){a.addParameter(n,u[0])}else{a.addParameter(n,"")}}else{a.addParameter(n,u)}if(t){r.ibnParams[n]=u}})}function v(e,a){var t=e.length?e:[];if(t.length&&a){return t.some(function(e){return a&&a.indexOf(e)>-1})}}function m(e,a,t,r){var i=[];if(t){i.push(t)}if(e[a+"SelectQuery"]&&e[a+"SelectQuery"].value){i.push(e[a+"SelectQuery"].value)}if(e[a+"ExpandQuery"]&&e[a+"ExpandQuery"].value){i.push(e[a+"ExpandQuery"].value)}if(e[a+"SortQuery"]&&e[a+"SortQuery"].value){var n=e[a+"SortQuery"].value;i.push(decodeURI(n)===n?encodeURI(n):n)}if(r==="Table"||r==="List"){i.push("$inlinecount=allpages");i.push("$skip=0&$top=13")}else{if(e[a+"TopQuery"]&&e[a+"TopQuery"].value){i.push(e[a+"TopQuery"].value)}if(e[a+"SkipQuery"]&&e[a+"SkipQuery"].value){i.push(e[a+"SkipQuery"].value)}}return i.length?i.join("&"):null}function d(e){var a=e.match(/%27datetime[a-zA-Z0-9%-:]*[,)%2c]/gm).length;var t=function(){var a=e.match(/%27datetime[a-zA-Z0-9%-:]*[,)%2c]/gm)[0];var t=a;t=t.replace("%27","");var r=t.lastIndexOf("%27");var i=t.substr(0,r)+t.substr(r+3,t.length-1);return i};for(var r=0;r<a;r++){e=e.replace(e.match(/%27datetime[a-zA-Z0-9%-:]*[,)%2c]/gm)[0],t)}return e}function T(e,a,r,i){var o,s=[],l=[],f=false;if(a==="Parameter"){o=e}else if(a==="Filter"){e=typeof e==="string"?JSON.parse(e):e;o=e.Low;if(n.DATE_OPTIONS.SPECIAL_RANGE.includes(o)){s=e.High.split(",")}}var c,p=new u;if(n.DATE_OPTIONS.RANGE_OPTIONS.includes(o)||n.DATE_OPTIONS.SINGLE_OPTIONS.includes(o)){if(a==="Filter"){c=t.toDates({values:s,operator:o});if(r.toLowerCase()==="string"||r.toLowerCase()==="edm.string"){l.push(p.parseValue(c[0].oDate));l.push(p.parseValue(c[1].oDate));return l}else{l.push(c[0].oDate);l.push(c[1].oDate)}}else{c=t.toDates({values:s,operator:o});if(r.toLowerCase()==="string"||r.toLowerCase()==="edm.string"){l.push(p.parseValue(c[0].oDate));return l}l.push(c[0].oDate)}}if(["DATETIMERANGE","FROMDATETIME","TODATETIME","DATETIME"].includes(o)){f=true}if(l.length){l=D(l,!i,f);return l}else if(Date(e)instanceof Date||e instanceof Date||Date.parse(e)){return D([e],!i,f)}else if(r.toLowerCase()==="string"&&p.formatValue(e.Low)){var v=p.formatValue(e.Low);if(v.oDate&&v.oDate instanceof Date){l.push(p.parseValue(v.oDate));if(e.High&&p.formatValue(e.High)&&p.formatValue(e.High).oDate instanceof Date){l.push(p.parseValue(p.formatValue(e.High).oDate))}return l}}return[]}function D(e,a,t){var n;e.forEach(function(o,u){if(o.match){if(o.match(/^(\d{4}-\d{2}-\d{2}T\d{2}:\d{2}:\d{2}.\d{3})Z?$/gm)&&o.match(/^(\d{4}-\d{2}-\d{2}T\d{2}:\d{2}:\d{2}.\d{3})Z?$/gm).length){o=s.getInstance(o)}}o=r.localToUtc(o);if(!t){o=r.normalizeDate(o,true)}if(a){n=i.getDateInstance({pattern:"'datetime'''yyyy-MM-dd'T'HH:mm:ss''",calendarType:"Gregorian"});e[u]=n.format(o,true)}else{var l=i.getDateInstance({pattern:"''yyyy-MM-dd'T'HH:mm:ss.SSS''",calendarType:"Gregorian"});var f=o instanceof Date?o:s.getInstance(o);var c=l.format(f);e[u]=String(c).replace(/'/g,"")}});return e}function g(e,a,r){var i=r;if(e&&a){var n=e.operator;if(n!=="DATE"){return n}else{return e.values[0]}}if(!a){var o=e.operator;var s=e.values;var u="";if(o){switch(o){case"DATE":case"DATERANGE":case"SPECIFICMONTH":case"DATETIMERANGE":case"DATETIME":u="";if(typeof i==="string"){u=i}var l=t.toDates(e);s=l;var f=D(s,false,o==="DATETIMERANGE"||o==="DATETIME");if(!f[1]){f[1]=""}var c={Low:f[0],High:f[1],Option:"BT",Text:u};if(c){c.Text=u;return c}break;case"FROM":case"TO":case"FROMDATETIME":case"TODATETIME":u="";if(typeof i==="string"){u=i}var p=D(s,false,o==="FROMDATETIME"||o==="TODATETIME"),v;v=o==="FROM"||o==="FROMDATETIME"?"GE":"LE";var m={Low:p[0],High:"",Option:v,Text:u};if(m){m.Text=u;return m}break;case"LASTDAYS":case"LASTWEEKS":case"LASTMONTHS":case"LASTQUARTERS":case"LASTYEARS":case"NEXTDAYS":case"NEXTWEEKS":case"NEXTMONTHS":case"NEXTQUARTERS":case"NEXTYEARS":u="";if(typeof i==="string"){u=i}return{Low:o,High:s[0].toString(),Option:"BT",Text:u};case"TODAYFROMTO":u="";if(typeof i==="string"){u=i}var d=s&&s[0];var T=s&&s[1];return{Low:o,High:d.toString()+","+T.toString(),Option:"BT",Text:u};default:u="";if(typeof i==="string"){u=i.substring(0,i.indexOf("(")-1)}return{Low:o,High:null,Option:"EQ",Text:u}}}}}function h(e,t){var r=t.configuration.parameters,i=new a;c(r,i,true,e);p(r,i,true,e);return e}return{processPrivateParams:l,formatSemanticDateTime:T,getDateRangeValue:g,semanticDateProcess:h}});
//# sourceMappingURL=UrlGenerateHelper.js.map