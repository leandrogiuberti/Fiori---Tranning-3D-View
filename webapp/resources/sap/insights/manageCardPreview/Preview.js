/*!
 * 
		SAP UI development toolkit for HTML5 (SAPUI5)
		(c) Copyright 2009-2015 SAP SE. All rights reserved
	
 */
sap.ui.define(["sap/ui/layout/library","sap/ui/core/Control","sap/ui/layout/form/SimpleForm","sap/m/Input","sap/m/Label","sap/m/Title","sap/m/VBox","sap/m/Page","sap/m/FlexBox","sap/m/ScrollContainer","sap/m/Toolbar","sap/m/OverflowToolbar","sap/m/ToolbarSpacer","sap/m/HBox","sap/ui/integration/widgets/Card","sap/m/Panel","sap/m/Button","../utils/DeviceType","../utils/Transformations","sap/ui/Device","sap/m/MessageStrip","../utils/AppConstants","../utils/InsightsUtils"],function(e,t,i,s,a,r,l,o,n,h,d,u,f,g,w,v,p,P,T,C,x,S,D){const{SimpleFormLayout:I}=e.form;var b=t.extend("sap.insights.manageCardPreview.Preview",{metadata:{properties:{manifest:{type:"string",group:"Behavior",defaultValue:""},cardMessageInfo:{type:"object",group:"Appearance",defaultValue:null},transformation:{type:"boolean",group:"Behavior",defaultValue:false},dialogTitle:{type:"string",defaultValue:""}},aggregations:{_page:{type:"sap.m.Page",multiple:false,visibility:"hidden"}},events:{titleCheck:{parameters:{enableButton:{type:"boolean"}}}}},renderer:{apiVersion:2,render:function(e,t){e.openStart("div",t);e.style("height","100%");e.style("width","100%");e.openEnd();e.renderControl(t.getAggregation("_page"));e.close("div")}}});b.prototype.init=function(){this.bInitialPreviewLoad=true;this.i18Bundle=D.getResourceBundle();C.resize.attachHandler(this._adjustLayoutStyles.bind(this));this.oPreviewPageHeader=new u(this.getId()+"--insightCardPreviewPage-header",{});this.oPreviewPageTitle=new r(this.getId()+"--insightCardPreviewTitle",{text:this.i18Bundle.getText("INT_PREVIEW_POPOVER_BUTTON_TITLE"),level:"H1"});this.oPreviewPage=new o(this.getId()+"--insightCardPreviewPage",{showSubHeader:true,backgroundDesign:"List",enableScrolling:false,headerContent:[],content:[],customHeader:[this.oPreviewPageHeader]}).addStyleClass("sapMPageBgStandard");this.setAggregation("_page",this.oPreviewPage);this.createStaticControls();this.oPreviewPageHeader.addContent(this.oPreviewPageTitle);this.oPreviewPageHeader.addContent(new f(this.getId()+"--insightCardPreviewPage-headerSpacer"));this.oPreviewPageHeader.addContent(this.oCardPreviewBtn);this.oPreviewPageHeader.addContent(this.oHideCardPreviewBtn);this.oPreviewPage.addContent(this.oDefaultVBox)};b.prototype.onBeforeRendering=function(){this.bShowCardPreview=false;this.oManifest=this.getManifest();if(this.oManifest){this.oManifest=JSON.parse(this.oManifest)}this.oTitleTextInput.setValue(this.oManifest["sap.card"].header.title);this.oSubTitleTextInput.setValue(this.oManifest["sap.card"].header.subTitle);this._formatTitle(this.oTitleTextInput.getValue());this._adjustLayoutStyles();this.oInsightsPreviewOverflowLayerSD.setVisible(this.oManifest["sap.card"].type==="Analytical"?false:true);this.oInsightsCardOverflowLayer.setVisible(this.oManifest["sap.card"].type==="Analytical"?false:true)};b.prototype.createStaticControls=function(){this.oCardPreviewBtn=new p(this.getId()+"--cardPreviewId",{text:this.i18Bundle.getText("INT_DIALOG_CardPreview"),press:this._callPreview.bind(this),enabled:true});this.oHideCardPreviewBtn=new p(this.getId()+"--hideCardPreviewId",{text:this.i18Bundle.getText("INT_DIALOG_HidePreview"),press:this._callClosePreview.bind(this),enabled:true});this.oDefaultTitle=new r(this.getId()+"--defaultTitle",{text:this.i18Bundle.getText("INT_CARD_TITLEINFO"),level:"H4"}).addStyleClass("sapUiSmallMarginTop");this.oDefaultSubText=new a(this.getId()+"--defaultSubText",{wrapping:true});this.oDefaultInfoVBox=new l(this.getId()+"--defaultInfoVBox",{direction:"Column",items:[this.oDefaultTitle,this.oDefaultSubText]}).addStyleClass("sapUiSmallMarginBegin sapUiSmallMarginEnd");this.oLabelTitle=new a(this.getId()+"--labelTitle",{text:this.i18Bundle.getText("INT_Preview_CARDTITLE"),required:true,labelFor:this.getId()+"--titleTextInput"}).addStyleClass("sapUiTinyMarginTop");this.oTitleTextInput=new s(this.getId()+"--titleTextInput",{change:this._handleTitleChange.bind(this),required:true,ariaLabelledBy:[this.getId()+"--invisibleText",this.getId()+"--defaultTitle",this.getId()+"--defaultSubText",this.getId()+"--labelTitle"]});this.oLabelSubTitle=new a(this.getId()+"--labelSubTitle",{text:this.i18Bundle.getText("INT_Preview_SubTitleTitleField_Label"),required:false,labelFor:"subTitleTextInput"}).addStyleClass("sapUiTinyMarginTop");this.oSubTitleTextInput=new s(this.getId()+"--subTitleTextInput",{change:this._handleSubTitleChange.bind(this)});this.oSimpleForm=new i(this.getId()+"--defaultPreviewForm",{width:"100%",layout:I.ColumnLayout,editable:true,adjustLabelSpan:true,labelSpanXL:12,labelSpanL:12,labelSpanM:12,labelSpanS:12,content:[this.oLabelTitle,this.oTitleTextInput,this.oLabelSubTitle,this.oSubTitleTextInput]});this.oDefaultPreviewFormFlex=new l(this.getId()+"--defaultPreviewFormFlex",{height:"100%",width:"100%",items:[this.oSimpleForm]});this.oDefaultPreviewCardSD=new w(this.getId()+"--defaultPreviewCardSD",{manifestApplied:this._setAriaTextOnManifest.bind(this),width:"19rem",height:"33rem"}).addStyleClass("sapUiTinyMarginBeginEnd");this.oInsightsPreviewOverflowInnerHBoxSD=new g(this.getId()+"--insightsPreviewOverflowInnerHBoxSD",{}).addStyleClass("insightsCardOverflowLayer insightsPreviewCardOverLay insightsPreviewOVPOverLayPositionSD");this.oInsightsPreviewOverflowLayerSD=new g(this.getId()+"--insightsPreviewOverflowLayerSD",{height:"0",items:[this.oInsightsPreviewOverflowInnerHBoxSD]}).addStyleClass("sapMFlexBoxJustifyCenter");this.oDefaultPreviewCardVBox=new l(this.getId()+"--defaultPreviewCardVBox",{width:"100%",height:"100%",alignItems:"Center",backgroundDesign:"Transparent",justifyContent:"SpaceAround",items:[this.oDefaultPreviewCardSD,this.oInsightsPreviewOverflowLayerSD]}).addStyleClass("sapUiSmallMarginTop sapUiTinyMarginBottom");this.oDefaultPreviewScrollSD=new h(this.getId()+"--defaultPreviewScrollSD",{vertical:true,horizontal:false,height:"100%",content:[this.oDefaultPreviewCardVBox]});this.oDefaultPreviewFlexBox=new n(this.getId()+"--defaultPreviewFlexBox",{height:"100%",width:"100%",visible:false,justifyContent:"Center",items:[this.oDefaultPreviewScrollSD]});this.oMessageStrip=new x(this.getId()+"--messageStripId",{showIcon:true,showCloseButton:false}).addStyleClass("sapUiSmallMargin");this.oCardMessageStrip=new l(this.getId()+"--cardMessageId",{items:[this.oMessageStrip]});this.oDefaultFlexBox=new n(this.getId()+"--defaultFlexBox",{height:"100%",direction:"Column",items:[this.oDefaultInfoVBox,this.oCardMessageStrip,this.oDefaultPreviewFormFlex,this.oDefaultPreviewFlexBox]});this.oDefaultPreviewCardText=new r(this.getId()+"--defaultPreviewCardText",{text:this.i18Bundle.getText("INT_DIALOG_TITLE_CardPreview"),textAlign:"Left"}).addStyleClass("sapUiTinyMarginTop");this.oDefaultPreviewHBox=new g(this.getId()+"--defaultPreviewHBox",{width:"100%",justifyContent:"Start",backgroundDesign:"Transparent",items:[this.oDefaultPreviewCardText]}).addStyleClass("sapUiTinyMarginBegin");this.oDefaultPreviewToolBar=new d(this.getId()+"--defaultPreviewToolBar",{width:"100%",height:"2.7rem",style:"Clear",design:"Auto",content:[this.oDefaultPreviewHBox]}).addStyleClass("sapThemeBaseBG");this.oInsightsCardOverflowInnerHBox=new g(this.getId()+"--insightsCardOverflowInnerHBox",{width:"19rem",height:"2rem"}).addStyleClass("insightsCardOverflowLayer insightsCardOverflowTop");this.oDefaultPreviewCardLS=new w(this.getId()+"--defaultPreviewCardLS",{manifestApplied:this._setAriaTextOnManifest.bind(this),width:"19rem",height:"33rem"});this.oInsightsCardOverflowLayer=new g(this.getId()+"--insightsCardOverflowLayer",{height:"0",items:[this.oInsightsCardOverflowInnerHBox]}).addStyleClass("sapMFlexBoxJustifyCenter");this.oDefaultPreviewVBox=new l(this.getId()+"--defaultPreviewVBox",{height:"100%",alignItems:"Center",backgroundDesign:"Transparent",justifyContent:"SpaceAround",items:[this.oDefaultPreviewCardLS,this.oInsightsCardOverflowLayer]});this.oDefaultPreviewPanel=new v(this.getId()+"--defaultPreviewPanel",{expanded:false,height:"100%",backgroundDesign:"Transparent",content:[this.oDefaultPreviewVBox]});this.oDefaultPreviewPanelFlex=new n(this.getId()+"--defaultPreviewPanelFlex",{height:"calc(100% - 2.8rem)",backgroundDesign:"Transparent",justifyContent:"Center",items:[this.oDefaultPreviewPanel]});this.oDefaultPreviewScroll=new h(this.getId()+"--defaultPreviewScroll",{vertical:true,horizontal:false,height:"100%",content:[this.oDefaultPreviewToolBar,this.oDefaultPreviewPanelFlex]});this.oPreviewFlexBox=new n(this.getId()+"--defaultPreviewFlex",{height:"100%",width:"38%",direction:"Column",renderType:"Bare",items:[this.oDefaultPreviewScroll]}).addStyleClass("sapMPageBgStandard");this.oDefaultVBox=new l(this.getId()+"--defaultVBox",{height:"100%",width:"100%",direction:"Row",justifyContent:"SpaceBetween",items:[this.oDefaultFlexBox,this.oPreviewFlexBox]})};b.prototype.setPreviewModeOfCard=function(){var e=P.getDialogBasedDevice()===S.DEVICE_TYPES.Desktop;var t=e?this.oDefaultPreviewCardLS:this.oDefaultPreviewCardSD;if(t&&this.getTransformation()&&(this.oManifest["sap.card"].type==="Table"||this.oManifest["sap.card"].type==="List")){t.setPreviewMode("Abstract")}else{t.setPreviewMode("Off")}};b.prototype._setCardMessageInfo=function(){var e=this.getCardMessageInfo();if(e&&e.text&&e.text.trim()!==""){if(P.getDialogBasedDevice()===S.DEVICE_TYPES.Desktop){this.oCardMessageStrip.setVisible(true)}else{this.oCardMessageStrip.setVisible(this.bShowCardPreview?false:true)}if(this.oMessageStrip){this.oMessageStrip.setText(e.text);this.oMessageStrip.setType(e.type)}}else{e=null;this.oCardMessageStrip.setVisible(false)}};b.prototype._callPreview=function(){this.bShowCardPreview=true;this.oCardPreviewBtn.setVisible(false);this.oHideCardPreviewBtn.setVisible(true);this.oDefaultInfoVBox.setVisible(false);this.oDefaultPreviewFormFlex.setVisible(false);this.oDefaultPreviewFlexBox.setVisible(true);if(P.getDialogBasedDevice()===S.DEVICE_TYPES.Desktop){this.oDefaultPreviewCardLS.refresh()}else{this.oDefaultPreviewCardSD.refresh()}this._setCardMessageInfo()};b.prototype._callClosePreview=function(){this.bShowCardPreview=false;this.oCardPreviewBtn.setVisible(true);this.oHideCardPreviewBtn.setVisible(false);this.oDefaultInfoVBox.setVisible(true);this.oDefaultPreviewFormFlex.setVisible(true);this.oDefaultPreviewFlexBox.setVisible(false);this._setCardMessageInfo()};b.prototype._handleTitleChange=function(e){var t=e.getSource();var i=t.getValue().trim();var s;if(P.getDialogBasedDevice()===S.DEVICE_TYPES.Desktop){s=this.oDefaultPreviewCardLS}else{s=this.oDefaultPreviewCardSD}if(s.getCardHeader()){this.oManifest["sap.card"].header.title=i;this.bInitialPreviewLoad=true}if(i){t.setValueState("None");t.setValueStateText("");this.fireTitleCheck({enableButton:true})}else{t.setValueState("Error");t.setValueStateText(this.i18Bundle.getText("INT_Preview_Title_ValueStateText"));this.fireTitleCheck({enableButton:false})}this.setManifest(JSON.stringify(this.oManifest));s.refresh()};b.prototype._handleSubTitleChange=function(e){var t=e.getSource();var i=t.getValue();var s;if(P.getDialogBasedDevice()===S.DEVICE_TYPES.Desktop){s=this.oDefaultPreviewCardLS}else{s=this.oDefaultPreviewCardSD}if(s.getCardHeader()){this.oManifest["sap.card"].header.subTitle=i;this.bInitialPreviewLoad=true}s.refresh();this.setManifest(JSON.stringify(this.oManifest))};b.prototype._adjustLayoutStyles=function(){if(P.getDialogBasedDevice()!==S.DEVICE_TYPES.Desktop){if(this.bShowCardPreview){this.oDefaultInfoVBox.setVisible(false);this.oDefaultPreviewFormFlex.setVisible(false);this.oDefaultPreviewFlexBox.setVisible(true);this.oCardPreviewBtn.setVisible(false);this.oHideCardPreviewBtn.setVisible(true)}else{this.oDefaultPreviewFlexBox.setVisible(false);this.oDefaultInfoVBox.setVisible(true);this.oDefaultPreviewFormFlex.setVisible(true);this.oCardPreviewBtn.setVisible(true);this.oHideCardPreviewBtn.setVisible(false)}this.oPreviewFlexBox.setVisible(false);this.oDefaultPreviewCardSD.setManifest(this._setCardTypeForColumn(this.oManifest));this.oDefaultPreviewCardSD.refresh();this.oDefaultPreviewFormFlex.setWidth("100%");this.oDefaultFlexBox.setWidth("100%")}else{this.oPreviewFlexBox.setVisible(true);this.oDefaultInfoVBox.setVisible(true);this.oDefaultPreviewFormFlex.setVisible(true);this.oDefaultPreviewFlexBox.setVisible(false);this.oCardPreviewBtn.setVisible(false);this.oHideCardPreviewBtn.setVisible(false);this.oDefaultPreviewFormFlex.setWidth("50%");this.oDefaultFlexBox.setWidth("62%");this.oDefaultPreviewCardLS.setManifest(this._setCardTypeForColumn(this.oManifest));this.oDefaultPreviewCardLS.refresh()}this._setCardMessageInfo();this.oPreviewPage.setTitle(this.getDialogTitle())};b.prototype._setCardTypeForColumn=function(e){if(e["sap.card"].type==="Table"&&this.bInitialPreviewLoad&&this.getTransformation()){var t=T.createTableOptions(e);var i=t.filter(function(e){return e["sap.card"].type==="List"});if(i.length){e=i[0]}this.bInitialPreviewLoad=false}return e};b.prototype._setAriaTextOnManifest=function(e){var t=e.getSource()._ariaText.getText();var i=this.i18Bundle.getText("INT_DIALOG_TITLE_CardPreview");e.getSource()._ariaText.setText(i+t)};b.prototype._formatTitle=function(e){var t=this.oTitleTextInput;if(e&&e.trim()){t.setValueState("None");t.setValueStateText("");this.fireTitleCheck({enableButton:true})}else{t.setValueState("Error");t.setValueStateText(this.i18Bundle.getText("INT_Preview_Title_ValueStateText"));this.fireTitleCheck({enableButton:false})}};return b});
//# sourceMappingURL=Preview.js.map