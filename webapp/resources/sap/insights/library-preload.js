//@ui5-bundle sap/insights/library-preload.js
/*!
 * 
		SAP UI development toolkit for HTML5 (SAPUI5)
		(c) Copyright 2009-2015 SAP SE. All rights reserved
	
 * This extension is for OVP Analytical cards delivered in 2208.
 */
sap.ui.predefine("sap/insights/CardExtension", ["sap/ui/integration/Extension","sap/ui/core/format/NumberFormat","sap/fe/navigation/SelectionVariant","sap/base/Log","sap/ui/core/format/DateFormat","sap/ui/core/library","sap/m/library","sap/ui/integration/util/Utils","sap/m/DynamicDateUtil","sap/fe/navigation/NavError","sap/insights/utils/UrlGenerateHelper","sap/insights/utils/AppConstants","sap/ui/core/date/UI5Date","sap/ui/core/Lib","sap/insights/base/CacheData","sap/insights/utils/InsightsUtils","sap/m/MessageToast","./CardHelper"],function(e,t,r,a,i,n,s,o,f,l,c,u,p,g,m,v,d,h){"use strict";var b=n.ValueState;var S=s.ValueColor;var N={StateValues:{None:"None",Negative:"Error",Critical:"Warning",Positive:"Success"},ColorValues:{None:"Neutral",Negative:"Error",Critical:"Critical",Positive:"Good"}};var O=a.getLogger("sap.insights.CardExtension");var y=m.getInstance();const P="refreshTime";var D=function(e,t){return e&&e.indexOf(t,e.length-t.length)!==-1};var C=function(e,t){var r;if(t){r=t.None;if(e&&e.EnumMember){var a=e.EnumMember;if(D(a,"Negative")){r=t.Negative}else if(D(a,"Critical")){r=t.Critical}else if(D(a,"Positive")){r=t.Positive}}}return r};var I=function(e,t,r,a,i,n,s){var o={};o.EnumMember="None";var f=Number.NEGATIVE_INFINITY;var l=Number.POSITIVE_INFINITY;if(!i&&i!==0&&(r||r===0)){i=r}if(!n&&n!==0&&(a||a===0)){n=a}if(!r&&r!==0){r=f}if(!a&&a!==0){a=l}if(e!==undefined){e=Number(e);if(D(t,"Minimize")||D(t,"Minimizing")){if((n||n===0)&&(a||a===0)){if(e<=parseFloat(n)){o.EnumMember="Positive"}else if(e>parseFloat(a)){o.EnumMember="Negative"}else{o.EnumMember="Critical"}}}else if(D(t,"Maximize")||D(t,"Maximizing")){if((i||i===0)&&(r||r===0)){if(e>=parseFloat(i)){o.EnumMember="Positive"}else if(e<parseFloat(r)){o.EnumMember="Negative"}else{o.EnumMember="Critical"}}}else if(D(t,"Target")){if((n||n===0)&&(a||a===0)&&(i||i===0)&&(r||r===0)){if(e>=parseFloat(i)&&e<=parseFloat(n)){o.EnumMember="Positive"}else if(e<parseFloat(r)||e>parseFloat(a)){o.EnumMember="Negative"}else{o.EnumMember="Critical"}}}}return C(o,s)};var F=function(e,t,r,a){if(!e||!t){return}e=Number(e);if(!a&&e-t>=0){return"Up"}if(!r&&e-t<=0){return"Down"}if(t&&a&&e-t>=a){return"Up"}if(t&&r&&e-t<=r){return"Down"}};var w=function(e,r,a){var i=r||{},n=e;var s=t.getFloatInstance({minFractionDigits:i.NumberOfFractionalDigits,maxFractionDigits:i.NumberOfFractionalDigits,style:"short",showScale:true,shortRefNumber:n});var o=s.format(Number(n)),f=s.getScale()||"";if(!a&&o){var l=o[o.length-1];return l===f?o.slice(0,o.length-1):o}if(a&&i.percentageAvailable){return f+"%"}if(a&&!i.percentageAvailable){return f}return""};var E=function(){var e=this.getCard().getCombinedParameters();return e._headerDataUrl};var M=function(){var e=this.getCard().getCombinedParameters();return e._contentDataUrl};var T=function(e,r,a){var i,n,s;if(isNaN(+e)){return""}if(e==0){s=r}else{s=e}if(a.NumberOfFractionalDigits){n=+a.NumberOfFractionalDigits}if(r){i=r}else if(a.manifestTarget){i=a.manifestTarget}if(!n||n<0){n=0}else if(n>2){n=2}if(i){var o=t.getFloatInstance({minFractionDigits:n,maxFractionDigits:n,style:"short",showScale:true,shortRefNumber:s});return o.format(+i)}};var V=function(e,r,a){var i,n;if(isNaN(+e)){return""}e=+e;if(a.NumberOfFractionalDigits){i=+a.NumberOfFractionalDigits}if(r){n=+r}else if(a.manifestTarget){n=+a.manifestTarget}if(!i||i<0){i=0}else if(i>2){i=2}if(n){var s=(e-n)/n;var o=t.getPercentInstance({style:"short",minFractionDigits:i,maxFractionDigits:i,showScale:true});return o.format(s)}};var x=function(e){var t={};t.EnumMember="None";if(Number(e)===1){t.EnumMember="Negative"}else if(Number(e)===2){t.EnumMember="Critical"}else if(Number(e)===3){t.EnumMember="Positive"}return C(t,N.ColorValues)};var U=function(){var e=arguments[arguments.length-1];var t=1;return I(arguments[0],e.sImprovementDirection,e.bIsDeviationLowBinding?arguments[t++]:e.deviationLow,e.bIsDeviationHighBinding?arguments[t++]:e.deviationHigh,e.bIsToleranceLowBinding?arguments[t++]:e.toleranceLow,e.bIsToleranceHighBinding?arguments[t++]:e.toleranceHigh,e.oCriticalityConfigValues)};var A=function(){var e=arguments[arguments.length-1];var t=1;return F(arguments[0],e.bIsRefValBinding?arguments[t++]:e.referenceValue,e.bIsDownDiffBinding?arguments[t++]:e.downDifference,e.bIsUpDiffBinding?arguments[t++]:e.upDifference)};var R=function(e){var t;var r=arguments[arguments.length-1],a=r&&r.propertyType;switch(a){case"yearmonth":var i=parseInt(e.substr(0,4),10),n=e.substr(4),s=parseInt(n,10)-1;t=p.getInstance(Date.UTC(i,s));break;case"yearquarter":var i=parseInt(e.substr(0,4),10),o=e.substr(4),f=parseInt(o,10)*3-2,s=f-1;t=p.getInstance(Date.UTC(i,s));break;case"yearweek":var i=parseInt(e.substr(0,4),10),l=e.substr(4),c=1+(parseInt(l,10)-1)*7;t=p.getInstance(Date.UTC(i,0,c));break;default:break}return t};var L=function(e,t){if(e){var r=o.parseJsonDateTime(e);return i.getInstance(t).format(p.getInstance(r),t.bUTC)}};var _=function(e){if(e){var r=t.getIntegerInstance({minFractionDigits:0,maxFractionDigits:1,decimalSeparator:".",style:"short"});return r.format(Number(e))}};var H=function(){var e=arguments[0],r=arguments[1],a=Number(arguments[2]),i=arguments[3];var n=t.getCurrencyInstance({style:"short",showMeasure:true,shortRefNumber:e.scaleFactor,minFractionDigits:e.numberOfFractionalDigits,maxFractionDigits:e.numberOfFractionalDigits});var s=n.format(a,i);if(!r){return s}else{var o=arguments[arguments.length-1];return s+" ("+o+")"}};var J=function(e,r,a,i,n){var s;if(e){e.maxFractionDigits=e.numberOfFractionalDigits||0;e.minFractionDigits=e.numberOfFractionalDigits||0;e.style=e.style||"short";e.showScale=e.showScale||true;e.shortRefNumber=e.scaleFactor;s=t.getFloatInstance(e)}var o=[];if(!isNaN(parseFloat(a))&&s){o.push(s.format(a))}else{o.push(a)}if(!isNaN(parseFloat(i))&&s){o.push(s.format(i))}else{o.push(i)}if(!isNaN(parseFloat(n))&&s){o.push(s.format(n))}else{o.push(n)}var f="";if(r&&r.length){r.forEach(function(e){if(typeof e==="number"){f=f+o[e]}else{f=f+e}})}return f};var k=function(e,t){if(t==="state"){switch(String(e)){case"1":case"Error":return b.Error;case"2":case"Warning":return b.Warning;case"3":case"Success":return b.Success;default:return b.None}}if(t==="color"){switch(String(e)){case"1":case"Error":return S.Error;case"2":case"Critical":return S.Critical;case"3":case"Good":return S.Good;default:return S.Neutral}}};var B=function(e,t,r){var a;if(r&&r.indexOf("sap.ui.model.odata.v4.ODataModel")>-1){a=this.getCard().getModel().getProperty("/content/value")||this.getCard().getModel().getProperty("/value")||[]}else{a=this.getCard().getModel().getProperty("/content/d/results")||this.getCard().getModel().getProperty("/d/results")||[]}var i=a.map(function(t){return t[e]});if(i.indexOf("0")===-1){i.push(0)}return Math[t].apply(Math,i)};var j=function(e,t,r){var a=1;var i=2;var n=4;for(var s in e){if(e.hasOwnProperty(s)){var o=e[s];if(o instanceof Date){o=o.toJSON()}else if(Array.isArray(o)||o&&typeof o==="object"){o=JSON.stringify(o)}else if(typeof o==="number"||typeof o==="boolean"){o=o.toString()}if(o===""){if(r&a){O.info("Semantic attribute "+s+" is an empty string and due to the chosen Suppression Behiavour is being ignored.");continue}}if(o===null){if(r&i){throw new O.error("NavigationHandler.INVALID_INPUT")}else{O.warning("Semantic attribute "+s+" is null and ignored for mix in to selection variant");continue}}if(o===undefined){if(r&n){throw new O.error("NavigationHandler.INVALID_INPUT")}else{O.warning("Semantic attribute "+s+" is undefined and ignored for mix in to selection variant");continue}}if(typeof o==="string"||o instanceof String){t.addSelectOption(s,"I","EQ",o)}else{throw new O.error("NavigationHandler.INVALID_INPUT")}}}return t};var G=function(e,t,a){var i=new r(t);var n=new r;if(i.getFilterContextUrl()){n.setFilterContextUrl(i.getFilterContextUrl())}if(i.getParameterContextUrl()){n.setParameterContextUrl(i.getParameterContextUrl())}if(Array.isArray(e)){e.forEach(function(e){j(e,n,a)})}else{j(e,n,a)}var s=i.getParameterNames();var o;for(o=0;o<s.length;o++){if(!n.getSelectOption(s[o])){n.addSelectOption(s[o],"I","EQ",i.getParameter(s[o]))}}var f=i.getSelectOptionsPropertyNames();for(o=0;o<f.length;o++){var l=i.getSelectOption(f[o]);if(!n.getSelectOption(f[o])){for(var c=0;c<l.length;c++){n.addSelectOption(f[o],l[c].Sign,l[c].Option,l[c].Low,l[c].High)}}}return n};function Q(e){if(e){if(e.hasOwnProperty("SelectionVariantID")){delete e.SelectionVariantID}else if(e.hasOwnProperty("PresentationVariantID")){delete e.PresentationVariantID}delete e.Text;delete e.ODataFilterExpression;delete e.Version;delete e.FilterContextUrl;delete e.ParameterContextUrl;return e}return e}var q=function(e){try{if(JSON.parse(e)){return true}}catch(e){return false}};var z=function(e){var t=e&&e.length===1,r=e&&e[0];return t&&r["Option"]==="EQ"&&!r["High"]&&r["Low"]&&r["Sign"]==="I"};function W(e,t){var a=this.getCard().getManifestEntry("sap.card"),i=a&&a.configuration.parameters,n=new r,s=i._relevantODataFilters.value||[];e=e&&JSON.parse(e);var o=e&&e.sensitiveProps,f=a&&a.header.actions[0].parameters.ibnParams,l=a&&a.content.actions[0].parameters.ibnParams;s.forEach(function(e){var t=q(i[e].value);if(t&&!(o&&o[e])){var r=JSON.parse(i[e].value);var a=r.SelectOptions.Ranges;if(a&&a.length){var s=z(a);if(f[e]&&l[e]){if(s){f[e]=a[0].Low;l[e]=a[0].Low}else if(!s){delete l[e];delete f[e];n.massAddSelectOption(e,a)}}else{n.massAddSelectOption(e,a)}}}});if(t){var c=Object.keys(t)||[];for(var u=0;u<c.length;u++){if(o&&o[c[u]]||c[u]==="__metadata"){delete t[c[u]]}}var p=G(t,n&&n.toJSONObject());p=Q(p.toJSONObject());e.selectionVariant=p}if(e&&e.sensitiveProps){delete e.sensitiveProps}return JSON.stringify(e)}var $=function(e){if(typeof e!=="string"){return false}var t=/^(\/)?Date\(\d+\)(\/)?$/;return t.test(e)};var Y=function(e){var t=i.getDateInstance({pattern:"''yyyy-MM-dd'T'HH:mm:ss.SSS'Z'''",calendarType:"Gregorian"});if(e){var r=t.format(e,true);return String(r).replace(/'/g,"")}};var Z=function(e){var t=i.getDateInstance({pattern:"''yyyy-MM-dd'T'HH:mm:ss.SSS''",calendarType:"Gregorian"});var r=e instanceof Date?e:p.getInstance(e);var a=t.format(r);return String(a).replace(/'/g,"")};function K(e,t,r,a,i,n){var s=f.toDates(e)||[];var o=s[0]&&s[0].oDate;var l=s[1]&&s[1].oDate;var c="",u="";if(a["sap:filter-restriction"]==="single-value"){if(t==="datetime"){c=Z(o);if(c&&n&&n.ibnParams){n.ibnParams[r]=c}}else if(t==="string"){c=Y(o);if(c&&n&&n.ibnParams){n.ibnParams[r]=c}}i.massAddSelectOption(r,[{Sign:"I",Option:"EQ",Low:c,High:null}])}else if(a["sap:filter-restriction"]==="interval"){if(t==="datetime"){c=Z(o);u=Z(l);if(c&&u){i.massAddSelectOption(r,[{Sign:"I",Option:"BT",Low:c,High:u}])}}else if(t==="string"){c=Y(o);u=Y(l);if(c&&u){i.massAddSelectOption(r,[{Sign:"I",Option:"BT",Low:c,High:u}])}}}}function X(e){var t={};var a;if(typeof e==="string"){a=new r(e)}else if(typeof e==="object"){a=e}else{throw new l("NavigationHandler.INVALID_INPUT")}var i=a.getSelectOptionsPropertyNames();for(var n=0;n<i.length;n++){var s=a.getSelectOption(i[n]);if(s.length===1&&s[0].Sign==="I"&&s[0].Option==="EQ"){t[i[n]]=s[0].Low}}var o=a.getParameterNames();for(var n=0;n<o.length;n++){var f=a.getParameter(o[n]);t[o[n]]=f}return t}function ee(e,t){var a=this.getCard().getManifestEntry("sap.card"),i=a&&a.configuration.parameters,n=new r,s=i._relevantODataFilters.value||[],o=e&&JSON.parse(e)||{},f=o&&o.parameters,l=f&&f.ibnParams,c=l&&l.sensitiveProps,p=o&&o.sensitiveProps,g=i._semanticDateRangeSetting,m,v=[];if(g){m=JSON.parse(g.value);v=Object.keys(m)||[]}var d={};if(v.length){v.forEach(function(e){var t=i[e]||{};var r=q(t.value)?JSON.parse(t.value):t.value;var a=t.type;var s="";var f=t.description&&JSON.parse(t.description),l=f&&f.operator,g=c&&c[e]||p&&p.includes(e);if(u.DATE_OPTIONS.DATE_LIST.includes(l)&&!g){var v=r&&r.SelectOptions&&r.SelectOptions[0]&&r.SelectOptions[0].Ranges;if(v&&v.length){n.massAddSelectOption(e,v)}else{if(a==="datetime"){s=Z(r)}else if(a==="string"){s=r.toString()}n.massAddSelectOption(e,[{Sign:"I",Option:"EQ",Low:s,High:null}])}}else if(l&&!g){K(f,a,e,m[e],n,o)}})}i._relevantODataParameters.value.forEach(function(e){var t=c&&c[e]||p&&p.includes(e);if(i[e]&&i[e].value&&!v.includes(e)&&!t){if(l){l[e]=i[e].value}else if(o&&o.ibnParams){o.ibnParams[e]=i[e].value}n.massAddSelectOption(e,[{Sign:"I",Option:"EQ",Low:i[e].value,High:null}])}});s.forEach(function(e){var t=q(i[e].value);if(t&&v.indexOf(e)===-1&&(c&&!c[e]||p&&!p.includes(e))){var r=JSON.parse(i[e].value);var a=r.SelectOptions&&r.SelectOptions.Ranges||r.SelectOptions&&r.SelectOptions[0]&&r.SelectOptions[0].Ranges;if(a&&a.length){var s=z(a);if(s){if(l){l[e]=a[0].Low}else if(o&&o.ibnParams){o.ibnParams[e]=a[0].Low}}else{if(l&&l[e]&&!s){delete l[e]}}n.massAddSelectOption(e,a)}}});var h=t||{};var b=Object.keys(h)||[];for(var S=0;S<b.length;S++){if(c&&c[b[S]]||p&&p.includes(b[S])||b[S]==="__metadata"){delete h[b[S]]}}var N=b.filter(function(e){return v.includes(e)});N.forEach(function(e){var t=h[e];if($(t)){var r=n?.getSelectOption(e);if(r?.length&&r[0].Low){h[e]=r[0].Low}}});var O=G(h,n&&n.toJSONObject());var y=X(O);O=Q(O.toJSONObject());if(l&&l.presentationVariant){d["presentationVariant"]=l.presentationVariant}else if(o&&o.ibnParams&&o.ibnParams.presentationVariant){d["presentationVariant"]=o.ibnParams.presentationVariant}if(O.Parameters.length||O.SelectOptions.length){d["selectionVariant"]=O}if(f&&!f.ibnParams){f.ibnParams={}}if(d["selectionVariant"]||d["presentationVariant"]){if(f&&f.ibnParams){f.ibnParams["sap-xapp-state-data"]=JSON.stringify(d)}else if(o&&o.ibnParams){o.ibnParams["sap-xapp-state-data"]=JSON.stringify(d)}}if(l&&l.sensitiveProps){delete l.sensitiveProps}if(o&&o.sensitiveProps){delete o.sensitiveProps}for(var P in y){if(f&&f.ibnParams){f.ibnParams[P]=y[P]}else if(o&&o.ibnParams){o.ibnParams[P]=y[P]}}if(l){delete l.selectionVariant;delete l.presentationVariant}if(o&&o.ibnParams&&o.ibnParams.presentationVariant){delete o.ibnParams.presentationVariant}return o.parameters?o.parameters:o}function te(){var e={descriptorContent:{}};e.descriptorContent=this.getCard().getManifestEntry("/");var t=ie(e,"header");return t}function re(){var e={descriptorContent:{}};e.descriptorContent=this.getCard().getManifestEntry("/");var t=e.descriptorContent["sap.card"]["configuration"]["csrfTokens"]["token1"].data.request.url;var r=ie(e,"content");if(e.descriptorContent["sap.card"]["data"]["request"]&&e.descriptorContent["sap.card"]["data"]["request"]["batch"]){return r}return t+"/"+r}function ae(e,t){if(e&&t){return`${e} (${t})`}else{return e||t||""}}function ie(e,t){var r=c.processPrivateParams(e,null,true);if(t==="header"&&r.header){return r.header}else if(t==="content"&&r.content){return r.content}}function ne(){var e=window["sap-ushell-config"],t=e&&e.ushell,r=t&&t.homeApp;return!!r}function se(e){return e.method==="HEAD"}function oe(e,t){var r=t.getManifest();if(!r["sap.insights"].error){e.text().then(function(e){var t=JSON.parse(JSON.stringify(v.getDataFromRawValue(e)[0])||e);if(t.error&&u.ERROR_CODES.includes(t.error.code)){r["sap.insights"].visible=false;r["sap.insights"].error=true;h.getServiceAsync().then(function(e){e._updateCard(r,true).then(function(){e._getUserVisibleCardModel();d.show(v.getResourceBundle().getText("INT_CARD_RELOAD_ERROR",[r["sap.card"].header.title]))})})}})}}function fe(e,t){const r={};if(t){r["/sap.card/header/dataTimestamp"]=t}if(e.getManifestEntry("sap.card").type==="List"){r["/sap.card/content/item/actionsStrip"]=e.getManifestEntry("sap.card").content.item.actionsStrip||[]}e.setManifestChanges([r])}var le=e.extend("sap.insights.CardExtension",{init:function(){e.prototype.init.apply(this,arguments);e.prototype.setFormatters.apply(this,[{kpiformatter:w,formatHeaderUrl:E.bind(this),formatContentUrl:M.bind(this),returnPercentageChange:V,targetValueFormatter:T,kpiValueCriticality:x,formatValueColor:U,formatTrendIcon:A,formatDateValue:R,addPropertyValueToAppState:W.bind(this),getNavigationContext:ee.bind(this),formatDate:L,formatNumber:J,formatCurrency:H,formatHeaderCount:_,formatCriticality:k,getMinMax:B.bind(this),formatHeaderDataUrlForSemanticDate:te.bind(this),formatContentDataUrlForSemanticDate:re.bind(this),formatWithBrackets:ae.bind(this)}])},loadDependencies:function(){var e=this.getCard(),t=e.getManifestEntry("/sap.card/type"),r=[];if(!ne()){r.push(new Promise(function(e){sap.ui.require(["sap/insights/HandleNonS4Environment"],function(t){t.initialize(this);e()}.bind(this))}.bind(this)))}if(t==="Analytical"){r.push(g.load({name:"sap.viz"}).then(function(){return new Promise(function(e){sap.ui.require(["sap/insights/OVPChartFormatter"],function(t){t.registerCustomFormatters();e()})})}))}return Promise.all(r)}});le.prototype.addFormatters=function(e,t){if(!e||e===""){a.error("Namespace missing.");return this}var r=this.getProperty("formatters");r[e]=t;return this.setFormatters(r)};le.prototype.setFormatters=function(){a.error("Use of setFormatters is prohibited, instead use addFormatters method.");return this};le.prototype._fetchData=function(t,r,a){var i=this._oCard;var n=i.getManifestEntry("sap.app").id;return e.prototype.fetch.call(this,t,r,a).then(function(e){y.setCacheResponse(n,t,e);y.setCacheResponse(n,P,new Date);var r=y.getCacheResponse(n);fe(i,r[P]);oe(e,i);return r[t]}).catch(function(e){var r={error:e.toString()};var a=new Response(JSON.stringify(r),{headers:{"Content-Type":"application/json"}});y.setCacheResponse(n,t,a);y.setCacheResponse(n,P,new Date);var i=y.getCacheResponse(n);return i[t]})};le.prototype.fetch=function(t,r,a){var i=this._oCard;var n=i.getManifest();const s=n["sap.insights"]?.cacheType;if(s==="fetchDataFromHost"||typeof n==="string"){return e.prototype.fetch.call(this,t,r,a)}else{var o=n["sap.app"].id;if(!y){y=m.getInstance()}var f=y.getCacheResponse(o);var l=y.getTempPromise(o);if(!f){f=y.setCacheResponse(o,null,{})}if(!l){l=y.setTempPromise(o,null,{})}if(se(a)){return e.prototype.fetch.call(this,t,r,a)}else if(!f[t]&&!l[t]){l=y.setTempPromise(o,t,this._fetchData(t,r,a));return l[t]}else if(!f[t]&&l[t]){return l[t].then(function(e){oe(e,i);return e})}else{return new Promise(function(e){if(i.getManifestChanges()&&!i.getManifestChanges().length){fe(i,f[P])}oe(f[t],i);e(f[t])})}}};return le});
/*!
 * 
		SAP UI development toolkit for HTML5 (SAPUI5)
		(c) Copyright 2009-2015 SAP SE. All rights reserved
	
 */
sap.ui.predefine("sap/insights/CardHelper", ["sap/base/Log","sap/ui/model/json/JSONModel","sap/insights/CardsChannel","./utils/BatchHelper","./utils/AppConstants","./utils/UrlGenerateHelper","./utils/CardDndConfig","./utils/InsightsUtils","./utils/HttpClient"],function(e,t,r,i,a,n,s,o,d){"use strict";var c=e.getLogger("sap.insights.CardHelper");const u=sap.ui.require("sap/ushell/Container");function l(e){return a.REPO_BASE_URL+a.CARD_ENTITY_NAME+"('"+e+"')"}function h(e,t){if([a.PUT,a.POST].indexOf(t)===-1){C("Method not supported.")}var r=e["sap.app"].id;var i=t===a.PUT?l(r):a.REPO_BASE_URL+a.CARD_ENTITY_NAME;e={descriptorContent:JSON.stringify(e),id:r};var n=JSON.stringify(e);const s=t===a.PUT?d.put(i,n):d.post(i,n);return s.then(function(e){if(e.error||!e.descriptorContent){C("unexpected error")}return JSON.parse(e.descriptorContent)})}function p(e){var t=e.split(".");if(t[0]!=="user"){C("sap.app.id value should start with user.<id>.")}}function f(e){return d.delete(l(e)).then(function(){return e}).catch(function(e){C("Failed to delete card")})}function g(){var e="sap.insights is not enabled for this system.";try{var t=window["sap-ushell-config"];var r=t.apps.insights.enabled;var i=t.ushell.homeApp.component.name;var a=t.ushell.spaces.enabled;if(r&&i&&a){return Promise.resolve(true)}return Promise.reject(new Error(e))}catch(t){return Promise.reject(new Error(e))}}function C(e){c.error(e);throw new Error(e)}function v(e){var t=false;if(e&&e.parameters&&e.parameters.ibnTarget&&e.parameters.ibnTarget.semanticObject&&e.parameters.ibnTarget.action){t=true}if(e&&e.ibnTarget&&e.ibnTarget.semanticObject&&e.ibnTarget.action){t=true}return t}function m(e){var t=false;if(!e["sap.app"]){c.error("Invalid card manifest. sap.app namespace do not exists.");t=true}if(!t&&!e["sap.app"].id){c.error("Invalid card manifest. sap.app.id do not exists.");t=true}if(!t){p(e["sap.app"].id,false)}if(!t&&!e["sap.app"].type){c.error("Invalid card manifest. sap.app.type do not exists.");t=true}if(!t&&e["sap.app"].type.toLowerCase()!=="card"){c.error("Invalid card manifest. invalid value for sap.app.type, expected card.");t=true}if(!t&&!e["sap.card"]){c.error("Invalid card manifest. sap.card namespace do not exists.");t=true}if(!t&&!e["sap.card"].type){c.error("Invalid card manifest. sap.card.type do not exists.");t=true}var r=["Analytical","List","Table"];if(!t&&r.indexOf(e["sap.card"].type)===-1){c.error("Invalid card manifest. Invalid value for sap.card.type. Supported types: "+r);t=true}if(!t&&!e["sap.insights"]){c.error("Invalid card manifest. sap.insights namespace do not exists.");t=true}if(!t&&!e["sap.insights"].parentAppId){c.error("Invalid card manifest. sap.insights.parentAppId do not exists.");t=true}if(!t&&!e["sap.insights"].cardType){c.error("Invalid card manifest. sap.insights.cardType do not exists.");t=true}if(!t&&e["sap.insights"].cardType!=="RT"){c.error("Invalid card manifest. Invalid value for sap.insights.cardType, supported value is RT");t=true}if(!t&&(!e["sap.insights"].versions||!e["sap.insights"].versions.ui5)){c.error("Invalid card manifest. Invalid value for sap.insights version");t=true}if(!t&&e["sap.insights"].templateName==="OVP"){var i,a,n,s=false,d=e["sap.card"].type;if(d==="Analytical"){i=e["sap.card"].content.actions||[];a=e["sap.card"].header.actions||[];i=i.filter(function(e){return e.type==="Navigation"&&e.parameters&&e.parameters.ibnTarget&&e.parameters.ibnTarget.semanticObject&&e.parameters.ibnTarget.action});a=a.filter(function(e){return e.type==="Navigation"&&e.parameters&&e.parameters.ibnTarget&&e.parameters.ibnTarget.semanticObject&&e.parameters.ibnTarget.action});if(i.length>0||a.length>0){s=true}if(e["sap.card"].configuration.parameters.state&&e["sap.card"].configuration.parameters.state.value){n=JSON.parse(e["sap.card"].configuration.parameters.state.value);s=v(n)}}if(d==="List"||d==="Table"){i=(d==="List"?e["sap.card"].content.item.actions:e["sap.card"].content.row.actions)||[];a=e["sap.card"].header.actions||[];i=i.filter(function(e){return e.type==="Navigation"});a=a.filter(function(e){return e.type==="Navigation"});if(i.length>0||a.length>0){var u={},l={};if(e["sap.card"].configuration.parameters.headerState&&e["sap.card"].configuration.parameters.headerState.value){u=JSON.parse(e["sap.card"].configuration.parameters.headerState.value)}if(e["sap.card"].configuration.parameters.lineItemState&&e["sap.card"].configuration.parameters.lineItemState.value){l=JSON.parse(e["sap.card"].configuration.parameters.lineItemState.value)}var h=v(u),f=v(l);s=h||f}}if(!s){c.error("Invalid card manifest. Card should have navigation.");t=true}}if(t){throw new Error(o.getResourceBundle().getText("invalidManifest"))}}var _;var P={localCardCache:{},userCardModel:(new t).setDefaultBindingMode("OneWay"),userVisibleCardModel:(new t).setDefaultBindingMode("OneWay"),parentAppDetailsCache:{},_oViewCache:{},_mergeCard:function(e,t,r){try{if(!r){m(e)}this.userVisibleCardModel.setProperty("/isLoading",true);return h(e,t).then(function(e){this.localCardCache={};this.userVisibleCardModel.setProperty("/isLoading",false);return e}.bind(this)).catch(function(e){this.userVisibleCardModel.setProperty("/isLoading",false);return Promise.reject(e)}.bind(this))}catch(e){return Promise.reject(e)}},_createCard:function(e,t){return this._mergeCard(e,a.POST,t)},_createCards:function(e){var t=this._getValidCardManifests(e);if(t.length>0){return this._updateMultipleCards(this._getCards(t),a.POST)}return Promise.resolve()},_getValidCardManifests:function(e){return e.filter(function(e){try{m(e);return true}catch(e){return false}})},_getCards:function(e){return e.map(function(e){var t=JSON.parse(JSON.stringify(e));return{id:t["sap.app"].id,descriptorContent:JSON.stringify(t)}})},_updateCard:function(e,t){return this._mergeCard(e,a.PUT,t)},_updateCards:function(e){var t=this._getValidCardManifests(e);if(t.length>0){this.userVisibleCardModel.setProperty("/isLoading",true);return this._updateMultipleCards(this._getCards(t),a.PUT).then(function(e){return e}).catch(function(e){return Promise.reject(e)}).finally(function(){this.userVisibleCardModel.setProperty("/isLoading",false)}.bind(this))}return Promise.resolve()},_deleteCard:function(e){try{p(e)}catch(e){return Promise.reject(e)}this.userVisibleCardModel.setProperty("/isLoading",true);return f(e).then(function(e){this.localCardCache={};this.userVisibleCardModel.setProperty("/isLoading",false);var t=this.userCardModel.getProperty("/cards");var r=t.findIndex(function(t){return t.id===e});if(r>-1){t.splice(r,1)}this.userCardModel.setProperty("/cards",t);return e}.bind(this))},_getUserAllCards:function(){if(this.localCardCache&&this.localCardCache.userCards){return Promise.resolve(this.localCardCache.userCards)}var e=a.CARD_READ_URL+"?$orderby=rank";return this._readCard(e).then(function(e){this.localCardCache.userCards=e;return e}.bind(this))},_getUserAllCardModel:function(){return this._getUserAllCards().then(function(e){var t=e.filter(function(e){return e.visibility});this.userCardModel.setProperty("/cards",e);this.userCardModel.setProperty("/cardCount",e.length);this.userCardModel.setProperty("/visibleCardCount",t.length);return this.userCardModel}.bind(this))},_getUserVisibleCards:function(e){if(this.localCardCache.userVisibleCards){return Promise.resolve(this.localCardCache.userVisibleCards)}var t="";var r="";if(e&&e.length){t=a.CARD_READ_URL+"?$filter=visibility eq true and (";var i=e.length-1;e.forEach(function(e,t){r=t!==i?r+"id eq '"+e+"' or ":r+"id eq '"+e+"'"});t=t+r+")"+a.CARD_SELECT_QUERY}else{t=a.CARD_READ_URL+"?$filter=visibility eq true"+a.CARD_SELECT_QUERY}return this._readCard(t).then(function(e){this.localCardCache.userVisibleCards=e;return e}.bind(this))},_getUserVisibleCardModel:function(e){return this._getUserVisibleCards(e).then(function(e){this.userVisibleCardModel.setProperty("/cards",e);this.userVisibleCardModel.setProperty("/cardCount",e.length);this.userVisibleCardModel.setProperty("/isLoading",false);return this.userVisibleCardModel}.bind(this))},_readCard:function(e){if(e&&(!this._fetchPromise||!this._fetchPromise[e])){this._fetchPromise=this._fetchPromise||{};this._fetchPromise[e]=d.get(e).then(function(e){if(e.error){C("Cannot read user's suggested cards.");return}e.value.forEach(function(e){if(e.descriptorContent){e.descriptorContent=JSON.parse(e.descriptorContent)}});return e.value}).catch(function(e){C("Cannot read user's suggested cards.");return Promise.reject(e)}).finally(function(){this._fetchPromise[e]=null;delete this._fetchPromise[e]}.bind(this))}return this._fetchPromise[e]},_refreshUserCards:function(e){this.userVisibleCardModel.setProperty("/isLoading",true);this.userCardModel.setProperty("/isLoading",true);var t=e?{deleteAllCards:"X"}:{};return new Promise(function(e){d.post(a.REPO_BASE_URL+a.CARD_ENTITY_NAME+"/com.sap.gateway.srvd.ui2.insights_cards_repo_srv.v0001.deleteCards?",JSON.stringify(t)).then(function(t){var r=t.value||[];this.iVisCardCount=0;r.forEach(function(e){if(e.descriptorContent){e.descriptorContent=JSON.parse(e.descriptorContent)}if(e.visibility){this.iVisCardCount++}}.bind(this));this.localCardCache={};this.localCardCache.userCards=r;this.userVisibleCardModel.setProperty("/isLoading",false);return this._getUserAllCardModel().then(function(){this.userCardModel.setProperty("/isLoading",false);e()}.bind(this))}.bind(this))}.bind(this))},getParentAppDetails:function(e){if(this.parentAppDetailsCache[e.descriptorContent["sap.app"].id]){return Promise.resolve(this.parentAppDetailsCache[e.descriptorContent["sap.app"].id])}var t={};var r=e.descriptorContent["sap.insights"].parentAppUrl;if(r){return u.getServiceAsync("URLParsing").then(function(i){var a=i.parseShellHash(r);return u.getServiceAsync("CrossApplicationNavigation").then(function(e){return e.isNavigationSupported([{target:{semanticObject:a.semanticObject,action:a.action},params:a.params}])}).then(function(i){if(i[0].supported){t.semanticObject=a.semanticObject;t.action=a.action;t.semanticURL=r;t.title=e.descriptorContent["sap.app"].title;this.parentAppDetailsCache[e.descriptorContent["sap.app"].id]=t;return Promise.resolve(t)}else{return this._getParentApp(e)}}.bind(this))}.bind(this))}else{return this._getParentApp(e)}},_getParentApp:function(e){var t={};return u.getServiceAsync("ClientSideTargetResolution").then(function(r){var i=r._oAdapter._aInbounds||[];var a=i.find(function(t){return t.resolutionResult&&t.resolutionResult.ui5ComponentName===e.descriptorContent["sap.insights"].parentAppId});if(a){t.semanticObject=a.semanticObject;t.action=a.action;t.semanticURL="#"+a.semanticObject+"-"+a.action;if(a?.signature?.parameters){var n=a.signature.parameters["sap-appvar-id"];if(n?.required&&n?.filter?.value){t.semanticURL=t.semanticURL+"?sap-appvar-id="+n.filter.value}}t.title=e.descriptorContent["sap.app"].title;this.parentAppDetailsCache[e.descriptorContent["sap.app"].id]=t}return t}.bind(this))},_updateMultipleCards:function(e,t){try{return i.createMultipartRequest(e,t).then(function(){this.localCardCache={};return Promise.resolve()}.bind(this)).catch(function(e){return Promise.reject(e)})}catch(e){return Promise.reject(e)}},processSemanticDate:function(e,t){return n.semanticDateProcess(e,t)},handleDndCardsRanking:function(e,t,r){return s.updateCardsRanking(e,t,r)},showCardPreview:function(e,t,r,i,a,n,s){return new Promise(function(o,d){try{if(!e){throw new Error("Card manifest is required for preview")}sap.ui.require(["sap/insights/ManagePreview"],function(d){if(!this._oManagePreviewDialog){this._oManagePreviewDialog=new d({transformation:t,cardMessageInfo:r,confirmButtonText:i,dialogTitle:n,manifest:e})}else{this._oManagePreviewDialog.setTransformation(t);this._oManagePreviewDialog.setCardMessageInfo(r);this._oManagePreviewDialog.setConfirmButtonText(i);this._oManagePreviewDialog.setManifest(e);this._removeAllEventListeners(this._oManagePreviewDialog,"onConfirmButtonPress");this._removeAllEventListeners(this._oManagePreviewDialog,"onCloseButtonPress")}if(a){this._oManagePreviewDialog.attachOnConfirmButtonPress(a)}if(s){this._oManagePreviewDialog.attachOnCloseButtonPress(s)}this._oManagePreviewDialog.openPreviewDialog();o(this._oManagePreviewDialog)}.bind(this))}catch(e){c.error(e.message);d(e.message)}}.bind(this))},resetAddCardInnerContent:function(){this._oManageAddInsightsCardWithSearchDialog.resetDialog(true)},fetchAddCardInnerContent:function(e){return new Promise(function(t,r){try{if(this._oManageAddInsightsCardWithSearchDialog&&this._oManageAddInsightsCardWithSearchDialog.getDialogInnerContent()){this._oManageAddInsightsCardWithSearchDialog.resetDialog();t(this._oManageAddInsightsCardWithSearchDialog.getDialogInnerContent())}else{sap.ui.require(["sap/insights/ManageAddCardWithSearch"],function(r){this._oManageAddInsightsCardWithSearchDialog=new r;const i=this._oManageAddInsightsCardWithSearchDialog.getDialogInnerContent();if(e){this._oManageAddInsightsCardWithSearchDialog.attachOnCardGenerated(e)}t(i)}.bind(this))}}catch(e){c.error(e.message);r(e.message)}}.bind(this))},showAddCardWithSearchDialog:function(e){return new Promise(function(t,r){try{sap.ui.require(["sap/insights/ManageAddCardWithSearch"],function(r){if(!this._oManageAddCardWithSearchDialog){this._oManageAddCardWithSearchDialog=new r}else{this._oManageAddCardWithSearchDialog.resetDialog()}if(e){this._oManageAddCardWithSearchDialog.attachOnAddButtonPress(e)}this._oManageAddCardWithSearchDialog.openDialog();t(this._oManageAddCardWithSearchDialog)}.bind(this))}catch(e){c.error(e.message);r(e.message)}}.bind(this))},_removeAllEventListeners:function(e,t){if(e.hasListeners(t)){e.mEventRegistry[t].forEach(function(r){e.detachEvent(t,r.fFunction,r.oListener)})}},getCardsChannel:function(){if(_){return Promise.resolve(_)}else{return new Promise(function(e){_=new r;_.init().then(function(){e(_)})})}}};return{getServiceAsync:function(){return g().then(function(){return P}).catch(function(e){return Promise.reject(e)})}}});
/*!
 * 
		SAP UI development toolkit for HTML5 (SAPUI5)
		(c) Copyright 2009-2015 SAP SE. All rights reserved
	
 */
sap.ui.predefine("sap/insights/CardProvider", ["sap/ui/base/Object","sap/insights/CardHelper"],function(i,e){return i.extend("sap.insights.CardProvider",{constructor:function(i,s){e.getServiceAsync().then(function(e){e.getCardsChannel().then(function(e){if(e.isEnabled()){this.channel=e;this.id=i;this.sharedCards=s;this.consumers={};this._registerProvider()}}.bind(this))}.bind(this))},_registerProvider:function(){if(this.channel){return this.channel.registerProvider(this.id,this).then(function(){this.registered=true}.bind(this))}},_unregisterProvider:function(){if(this.channel){return this.channel.unregister(this.id).then(function(){this.registered=false;this.consumers={};this.sharedCards=[]}.bind(this))}},_shareAvailableCards:function(i){var e=this.sharedCards.map(function(i){return{id:i.id,title:i.descriptorContent["sap.card"].header.title,parentAppId:i.descriptorContent["sap.insights"].parentAppId,description:i.descriptorContent["sap.card"].header.subTitle?i.descriptorContent["sap.card"].header.subTitle:""}});this.channel.publishAvailableCards(this.id,e,i)},onConsumerConnected:function(i){if(!this.consumers[i]){this.consumers[i]=true;this._shareAvailableCards(i)}},onConsumerDisconnected:function(i){if(this.consumers[i]){delete this.consumers[i]}},onCardRequested:function(i,e){if(this.consumers[i]){var s=this.sharedCards.find(function(i){return i.id===e});if(s){this.publishCard(this.id,s,i)}}},onViewUpdate:function(i,e){if(this.registered!==i){if(i){this._registerProvider().then(function(){this.sharedCards=e;this._shareAvailableCards()}.bind(this))}else{this._unregisterProvider()}}else{if(this.registered){this.sharedCards=e;this._shareAvailableCards()}}}})});
/*!
 * 
		SAP UI development toolkit for HTML5 (SAPUI5)
		(c) Copyright 2009-2015 SAP SE. All rights reserved
	
 * POC
 */
sap.ui.predefine("sap/insights/CardsChannel", ["sap/ui/base/Object"],function(e){"use strict";var s="sap-insights";var n="sap-insights";var i={available:"cardsAvailable",requested:"cardRequested",provided:"cardProvided",subscribed:"clientSubscribed",cardCreationRequested:"cardCreationRequested",cardCreated:"cardCreated"};function t(){this.subscribers={};this.onMessage=function(e){if(typeof e.data==="string"){var n=JSON.parse(e.data);if(n.type==="request"){if(n.body.channelId===s&&this.onNewMessage){this.onNewMessage(n.body.clientId,n.body.channelId,n.body.messageName,n.body.data)}else if(this.onSubscriptionChange){if(n.body.messageName==="clientSubscribed"&&!this.subscribers[n.body.clientId]){this.subscribers[n.body.clientId]=true;this.onSubscriptionChange(n.body.messageName,n.body.clientId,n.body.channels)}else if(n.body.messageName==="clientUnsubscribed"&&this.subscribers[n.body.clientId]){delete this.subscribers[n.body.clientId];this.onSubscriptionChange(n.body.messageName,n.body.clientId,n.body.channels)}}}}};this.connect=function(e){return new Promise(function(s){var n=function(e){if(typeof e.data==="string"){var i=JSON.parse(e.data);if(i.body.messageName==="connect"){window.removeEventListener("message",n);s()}}};window.addEventListener("message",n);window.parent.postMessage(JSON.stringify({type:"request",service:"sap.ushell.services.MessageBroker",request_id:Date.now().toString(),body:{channelId:"sap.ushell.MessageBroker",clientId:e,messageName:"connect"}}),"*")})};this.subscribe=function(e,s,n,i){this.onNewMessage=n;this.onSubscriptionChange=i;window.addEventListener("message",this.onMessage.bind(this));window.parent.postMessage(JSON.stringify({type:"request",service:"sap.ushell.services.MessageBroker",request_id:Date.now().toString(),body:{channelId:"sap.ushell.MessageBroker",clientId:e,messageName:"subscribe",subscribedChannels:s}}),"*");return Promise.resolve()};this.publish=function(e,s,n,i,t,r){window.parent.postMessage(JSON.stringify({type:"request",service:"sap.ushell.services.MessageBroker",request_id:n,body:{channelId:e,clientId:s,messageName:i,targetClientIds:t,data:r}}),"*");return Promise.resolve()};this.unsubscribe=function(e,s){delete this.onNewMessage;delete this.onSubscriptionChange;window.addEventListener("message",this.onMessage.bind(this));window.parent.postMessage(JSON.stringify({type:"request",service:"sap.ushell.services.MessageBroker",request_id:Date.now().toString(),body:{channelId:"sap.ushell.MessageBroker",clientId:e,messageName:"unsubscribe",subscribedChannels:s}}),"*");return Promise.resolve()};this.disconnect=function(e){window.removeEventListener("message",this.onMessage.bind(this));window.parent.postMessage(JSON.stringify({type:"request",service:"sap.ushell.services.MessageBroker",request_id:Date.now().toString(),body:{channelId:"sap.ushell.MessageBroker",clientId:e,messageName:"disconnect"}}),"*");return Promise.resolve()}.bind(this)}function r(e,n,t){this.onSubscriptionChange=function(i,t,r){if(e!==t&&r.find(function(e){return e.channelId===s})){if(i==="clientSubscribed"){n.onConsumerConnected(t)}else if(i==="clientUnsubscribed"){n.onConsumerDisconnected(t)}}};this.onNewMessage=function(r,o,a,c){if(o===s){switch(a){case i.subscribed:n.onConsumerConnected(r);break;case i.requested:n.onCardRequested(r,c);break;case i.cardCreationRequested:sap.ui.require(["sap/insights/CardHelper"],function(n){n.getServiceAsync().then(function(n){n._createCard(c.descriptorContent).then(function(o){n._getUserVisibleCardModel();t.publish(s,e,Date.now().toString(),i.cardCreated,[r],o)})})});break;default:break}}};this.register=function(){return t.connect(e).then(function(){return t.subscribe(e,[{channelId:s}],this.onNewMessage,this.onSubscriptionChange)}.bind(this))}}function o(e,n,t){this.onSubscriptionChange=function(r,o,a){if(e!==o&&a.find(function(e){return e.channelId===s})){if(r==="clientSubscribed"){t.publish(s,e,Date.now().toString(),i.subscribed,[o])}else if(r==="clientUnsubscribed"){n.onCardsAvailable(o,[])}}};this.onNewMessage=function(e,t,r,o){if(t===s){switch(r){case i.available:n.onCardsAvailable(e,o);break;case i.provided:n.onCardProvided(e,o);break;case i.cardCreated:n.onCardCreated(e,o);break;default:break}}};this.register=function(){return t.connect(e).then(function(){return t.subscribe(e,[{channelId:s}],this.onNewMessage,this.onSubscriptionChange)}.bind(this))}}var a=e.extend("sap.insights.CardsChannel",{constructor:function(){this.clients={}},isEnabled:function(){return!!this.broker},init:function(){var e;const s=sap.ui.require("sap/ushell/Container");if(s){e=s.getServiceAsync("MessageBroker")}else{e=Promise.resolve(new t)}return e.then(function(e){this.broker=e;if(s){this.registerDefaultProvider()}}.bind(this))},registerDefaultProvider:function(){const e={onConsumerConnected:function(e){},onConsumerDisconnected:function(e){}};this.registerProvider(n,e)},registerProvider:function(e,s){this.clients[e]=new r(e,s,this.broker);return this.clients[e].register()},registerConsumer:function(e,s){this.clients[e]=new o(e,s,this.broker);return this.clients[e].register()},publishAvailableCards:function(e,n,t){if(!t){t="*"}return this.broker.publish(s,e,Date.now().toString(),i.available,[t],n)},requestCard:function(e,n,t){return this.broker.publish(s,e,null,i.requested,[t],n)},requestCardCreation:function(e,n,t){return this.broker.publish(s,e,null,i.cardCreationRequested,[t],n)},publishCard:function(e,n,t){if(!t){t="*"}return this.broker.publish(s,e,null,i.provided,[t],n)},unregister:function(e){return this.broker.unsubscribe(e,[{channelId:s}]).then(function(){delete this.clients[e];return this.broker.disconnect(e)}.bind(this))},destroy:function(){var e=[];for(var s in this.clients){e.push(this.unregister(s))}return Promise.all(e).then(function(){delete this.broker}.bind(this))}});return a});
/*!
 * 
		SAP UI development toolkit for HTML5 (SAPUI5)
		(c) Copyright 2009-2015 SAP SE. All rights reserved
	
 * This code handles S/4 cards in SAP Start and SAP Mobile Start
 */
sap.ui.predefine("sap/insights/HandleNonS4Environment", ["sap/ushell/utils/UrlParsing","sap/base/Log","sap/ui/core/Configuration"],function(a,t,e){"use strict";var r="(runtimeURL)";var n=e.getSAPLogonLanguage();var i=function(){var a="ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789";var t="";var e=new window.Uint32Array(40);window.crypto.getRandomValues(e);var r=function(t){var r=e[t]%a.length;return a[r]};while(t.length<40){t+=r(t.length)}return t};var s=function(t,e){var r=JSON.parse(JSON.stringify(t)),n="",i={};if(r.ibnParams&&r.ibnParams["sap-xapp-state-data"]){delete r.ibnParams["sap-xapp-state-data"]}i={target:r.ibnTarget,params:r.ibnParams};if(e){i.appStateKey=e}n=a.constructShellHash(i);n=encodeURI(n);n="#"+n;return n};var o=function(a){var t;if(a){var e=a.getHostInstance();if(e){t=e.getDestination(r,a)}}if(!t){t=Promise.reject("S/4 runtime destination URL could not be determined!")}return t};var u=async function(a,e){var r=a;if(r.indexOf("?")<0){r+="?"}else{r+="&"}r+="sap-language="+n;try{var i=e?await(e.getHostInstance()?.getContextValue("navigation/flp/defaultQueryParams/value")):null;if(i){i=JSON.parse(i);var s=Object.keys(i);if(s.length){s.forEach(function(a,t){r+="&"+a+"="+i[a]})}}}catch(a){t.error(a)}return r};var p=function(a,e,r){var n={id:e,sessionKey:"",component:"",appName:"",value:r.replaceAll("{","\\{")};return a.request({url:"{{destinations.service}}/sap/opu/odata/UI2/INTEROP/GlobalContainers",method:"POST",parameters:n,headers:{Accept:"application/json","X-CSRF-Token":"{{csrfTokens.token1}}","content-type":"application/json"}}).then(function(a){return}).catch(function(a){t.error("FAILED to save sap-xapp-state-data in S/4")})};var c=async function(a){if(a.getParameter("type")!=="Navigation"){return}var e=this.getCard();var r=a.getParameter("parameters");if(r&&r.url){return}var n=r&&r.ibnParams&&r.ibnParams["sap-xapp-state-data"];var c=n?i():"";var l=s(r,c);if(l){a.preventDefault(true);if(n){await p(e,c,r.ibnParams["sap-xapp-state-data"])}try{var v=await o(this._oCard);if(v){var f=await u(v,this._oCard);f+=l;this.getCard().triggerAction({type:"Navigation",parameters:{url:f,target:"_blank"}})}}catch(a){t.error(a)}}};var l=function(a){a.attachAction(c.bind(a))};return{initialize:l,_:{createAppStateId:i,getIntent:s,getRuntimeDestinationUrl:o,addQueryParameter:u,saveXAppState:p,handleAction:c}}});
/*!
 * 
		SAP UI development toolkit for HTML5 (SAPUI5)
		(c) Copyright 2009-2015 SAP SE. All rights reserved
	
 */
sap.ui.predefine("sap/insights/ManageAddCardWithSearch", ["sap/ui/core/Control","sap/m/Button","sap/m/Dialog","./utils/InsightsUtils","sap/ui/integration/widgets/Card","sap/m/VBox","sap/m/HBox","sap/m/ScrollContainer","./utils/AppConstants","./utils/CardSkeletonManifest","sap/m/MessageToast","sap/base/Log","sap/m/IllustratedMessage","sap/ui/performance/trace/FESRHelper","sap/m/Title","sap/m/Label","sap/m/FlexBox","sap/m/Toolbar","sap/m/TextArea","sap/m/Text","sap/m/MessageStrip","sap/ui/core/Icon","sap/m/MessageBox","sap/m/Token","sap/m/Tokenizer","sap/m/IllustratedMessageSize","sap/m/IllustratedMessageType","sap/m/FormattedText","sap/m/ToggleButton","sap/m/library","sap/ui/core/library"],function(e,t,s,a,i,n,r,o,l,d,g,u,h,p,c,f,m,T,B,y,x,_,S,C,b,v,w,I,E,M,A){"use strict";var D=M.FlexWrap;var R=A.ValueState;var U=JSON.parse(JSON.stringify(d));var P=JSON.parse(JSON.stringify(d));var O=e.extend("sap.insights.ManageAddCardWithSearch",{renderer:null,metadata:{events:{onAddButtonPress:{parameters:{manifest:{type:"string"}}},onCardGenerated:{parameters:{manifest:{type:"string"}}}},aggregations:{_queryDialog:{type:"sap.m.Dialog",multiple:false,visibility:"hidden"}}}});O.prototype.init=function(){this.i18Bundle=a.getResourceBundle();this._createStaticControls();this._getQueryDialog()};O.prototype._getQueryDialog=function(){if(!this.getAggregation("_queryDialog")){var e=new s({title:this.i18Bundle.getText("addToInsights"),content:[this._getOuterVbox()],showHeader:true,contentHeight:"41.1rem",contentWidth:"59.3rem",verticalScrolling:false,horizontalScrolling:false,afterClose:this.resetDialog.bind(this,true),escapeHandler:this.closeDialog.bind(this),afterOpen:this.afterOpenDialog.bind(this),beginButton:this._getAddButton(),endButton:this._getCancelButton()});this.setAggregation("_queryDialog",e,true)}return this.getAggregation("_queryDialog")};O.prototype._createStaticControls=function(){var e={};e.searchedCard=new i(this.getId()+"--searchedCard",{manifest:U,manifestApplied:this._setAriaTextOnManifest.bind(this),width:"20.18rem",height:"29rem",previewMode:"Abstract",visible:true});e.placeholder=new i(this.getId()+"--placeholderCard",{manifest:P,manifestReady:this._onManifestReady.bind(this),width:"20.18rem",height:"27.5rem",previewMode:"Off",visible:false}).addStyleClass("sapUiTinyMarginTopBottom");e.oAddButton=new t(this.getId()+"--addButton",{text:this.i18Bundle.getText("INT_DIALOG_Ok"),press:this.addCard.bind(this),type:"Emphasized",enabled:false});p.setSemanticStepname(e.oAddButton,"press",l.FESR_AIGENERATE_ADD_CARD);e.oCancelButton=new t(this.getId()+"--cancelButton",{text:this.i18Bundle.getText("cancelButton"),press:this.closeDialog.bind(this)});p.setSemanticStepname(e.oCancelButton,"press",l.FESR_AIGENERATE_CANCEL);e.oThumbsUpButton=new E(this.getId()+"--thumbsUp",{icon:"sap-icon://thumb-up",type:"Transparent",tooltip:this.i18Bundle.getText("thumbsUpButton"),pressed:false,press:this._sendFeedback.bind(this,"thumbsUp")});p.setSemanticStepname(e.oThumbsUpButton,"press",l.FESR_AIGENERATE_THUMBSUP);e.oThumbsDownButton=new E(this.getId()+"--thumbsDown",{icon:"sap-icon://thumb-down",type:"Transparent",tooltip:this.i18Bundle.getText("thumbsDownButton"),pressed:false,press:this._sendFeedback.bind(this,"thumbsDown")}).addStyleClass("sapUiTinyMarginBegin");p.setSemanticStepname(e.oThumbsDownButton,"press",l.FESR_AIGENERATE_THUMBSDOWN);e.messageStripHbox=this._createMessageStripHBox();e.messageStripHbox.addItem(e.oThumbsUpButton);e.messageStripHbox.addItem(e.oThumbsDownButton);e.oNoCardMessage=new h(this.getId()+"--editInsightNoInsightsCardsMsg",{illustrationSize:v.Medium,illustrationType:w.NoEntries,description:" "}).addStyleClass("sapFIllustratedMessageAlign sapFFrequentIllustratedMessageAlign");e.noCardBox=new n(this.getId()+"--illusCardVbox",{alignItems:"Center",height:"100%",renderType:"Bare",justifyContent:"Center",items:[e.oNoCardMessage],visible:false}).addStyleClass("aiErrorPadding");var s=new y(this.getId()+"--label",{text:this.i18Bundle.getText("typed_text_label"),wrapping:true}).addStyleClass("sapUiSmallMarginBeginEnd sapUiSmallMarginTop");const a=500;e.oTextBox=new B(this.getId()+"--textBox",{width:"calc(100% - 2rem)",height:"7rem",placeholder:this.i18Bundle.getText("SAMPLE_QUERY_MSG")+" "+this.i18Bundle.getText("SAMPLE_QUERY_TEXT"),maxLength:a,showExceededText:true,liveChange:this.onChange.bind(this)}).addStyleClass("sapUiNoMarginBottom sapUiSmallMarginBeginEnd sapUiTinyMarginTop");e.oTextBox.attachBrowserEvent("keydown",function(t){if(t.keyCode===13&&e.oRegenerateButton.getEnabled()){this._onSearch()}}.bind(this));e.oRegenerateButton=new t(this.getId()+"--searchButton",{type:"Default",icon:"sap-icon://ai",text:this.i18Bundle.getText("GO"),press:this._onSearch.bind(this),enabled:false}).addStyleClass("sapUiSmallMarginBegin");p.setSemanticStepname(e.oRegenerateButton,"press",l.FESR_AIGENERATE_CARD);e.oClearButton=new t(this.getId()+"--clearButton",{type:"Transparent",text:this.i18Bundle.getText("Clear"),enabled:false,press:this._onClear.bind(this)}).addStyleClass("sapUiTinyMarginBegin sapUiSmallMarginEnd");p.setSemanticStepname(e.oClearButton,"press",l.FESR_AIGENERATE_CLEARALL);var d=new r(this.getId()+"--buttonHBox",{width:"100%",alignItems:"End",renderType:"Bare",justifyContent:"End",items:[e.oRegenerateButton,e.oClearButton]}).addStyleClass("sapUiTinyMarginTop");var g=new _(this.getId()+"--helpIcon",{src:"sap-icon://sys-help",size:"0.875rem",height:"0.875rem",color:"Neutral"});var u=new f(this.getId()+"--sampleQueryLabel",{text:this.i18Bundle.getText("SAMPLE_QUERY")}).addStyleClass("sapUiTinyMarginBegin");var S=new r(this.getId()+"--queryHbox",{width:"calc(100% - 1rem)",justifyContent:"Start",backgroundDesign:"Transparent",renderType:"Bare",alignItems:"Center",items:[g,u]}).addStyleClass("sapUiSmallMarginBegin sapUiMediumMarginTop");e.oFilterHBox=new n(this.getId()+"--filterHBox",{width:"calc(100% - 1rem)",alignItems:"Start",justifyContent:"Start",renderType:"Bare",items:[new f({text:this.i18Bundle.getText("INT_TOKEN_INFO"),showColon:true,wrapping:true}).addStyleClass("sapUiSmallMarginBegin"),new b({editable:false,renderMode:"Narrow",width:"calc(100%)",visible:true}).addStyleClass("sapUiTinyMarginTop sapUi-Std-PaddingS sapUiSmallMarginBegin customPaddingToken")],visible:false}).addStyleClass("sapUiTinyMarginTop");var C=e.oFilterHBox.getItems()?.[1];if(C){var I="mouse";document.addEventListener("keydown",function(){I="keyboard"});C.attachRenderModeChange(function(){var e=C.getDomRef()?.contains(document.activeElement);var t=I==="keyboard"&&e?"Loose":"Narrow";C.setRenderMode(t)})}var M=new m(this.getId()+"--defaultPreviewFormFlex",{height:"100%",width:"50%",direction:"Column",renderType:"Bare",items:[s,e.oTextBox,d,e.oFilterHBox,S,this._createSampleQueryListBox()]});var A=new c(this.getId()+"--defaultPreviewCardText",{text:this.i18Bundle.getText("INT_DIALOG_TITLE_CardPreview"),textAlign:"Left",titleStyle:"H3"}).addStyleClass("sapUiSmallMarginTop customCardsPreviewTitle");var D=new r(this.getId()+"--defaultPreviewHBox",{width:"100%",height:"100%",justifyContent:"Start",backgroundDesign:"Transparent",renderType:"Bare",items:[A]}).addStyleClass("sapUiTinyMarginBegin");var R=new T(this.getId()+"--defaultPreviewToolBar",{width:"100%",height:"2rem",style:"Clear",design:"Auto",content:[D]}).addStyleClass("sapThemeBaseBG");var O=new r(this.getId()+"--insightsCardOverflowInnerHBox",{width:"20.18rem",height:"2rem"}).addStyleClass("insightsCardOverflowLayer insightsCardOverflowTop");e.oInsightsCardOverflowLayer=new r(this.getId()+"--insightsCardOverflowLayer",{height:"0",visible:false,items:[O]}).addStyleClass("sapMFlexBoxJustifyCenter");var L=new n(this.getId()+"--defaultPreviewVBox",{height:"100%",alignItems:"Center",backgroundDesign:"Transparent",justifyContent:"SpaceAround",items:[e.searchedCard,e.placeholder,e.oInsightsCardOverflowLayer,e.messageStripHbox]});var N=new n(this.getId()+"--defaultPreviewInnerVBox",{height:"100%",backgroundDesign:"Transparent",justifyContent:"Center",items:[L]}).addStyleClass("sapUiTinyMarginTop sapUiSmallMarginBeginEnd");e.oDefaultPreviewPanelFlex=new m(this.getId()+"--defaultPreviewPanelFlex",{height:"100%",backgroundDesign:"Transparent",renderType:"Bare",justifyContent:"Center",items:[N]}).addStyleClass("sapUiSmallMarginTop");var F=new x(this.getId()+"--noHeaderNavigationStrip",{text:this.i18Bundle.getText("NO_HEADER_NAVIGATION_MSG"),showIcon:true,showCloseButton:false});e.noHeaderNavigationBox=new r(this.getId()+"--noHeaderNavigationBox",{alignItems:"Center",renderType:"Bare",width:"calc(100% - 2rem)",height:"3rem",visible:false,justifyContent:"Start",backgroundDesign:"Transparent",items:[F]}).addStyleClass("sapUiSmallMarginBeginEnd sapUiTinyMarginTopBottom");var k=new x(this.getId()+"--busyMessageStrip",{text:this.i18Bundle.getText("CARD_GENERATE_MSG"),showIcon:true,showCloseButton:false});e.busyMessageBox=new r(this.getId()+"--busyMessageBox",{alignItems:"Center",renderType:"Bare",width:"calc(100% - 2rem)",height:"3rem",visible:false,justifyContent:"Start",backgroundDesign:"Transparent",items:[k]}).addStyleClass("sapUiSmallMarginBeginEnd sapUiSmallMarginTop");var H=new o(this.getId()+"--defaultPreviewScroll",{vertical:true,horizontal:false,height:"100%",content:[R,e.noHeaderNavigationBox,e.busyMessageBox,e.oDefaultPreviewPanelFlex,e.noCardBox]});var V=new m(this.getId()+"--defaultPreviewFlex",{height:"100%",width:"50%",direction:"Column",renderType:"Bare",items:[H]}).addStyleClass("sapMPageBgStandard");e.oDefaultVBox=new n(this.getId()+"--defaultVBox",{height:"100%",width:"100%",direction:"Row",justifyContent:"SpaceBetween",items:[M,V]});this._setAccessMethods(e)};O.prototype._generateAIPolicyText=function(){const e=this.i18Bundle.getText("createdWithAI");return this.i18Bundle.getText("aiPolicyText",[e])};O.prototype._sendFeedback=function(e){const t={thumbsUp:this._getThumbsUpButton(),thumbsDown:this._getThumbsDownButton()};Object.values(t).forEach(function(e){e.setPressed(false)});if(t[e]){t[e].setPressed(true)}g.show(this.i18Bundle.getText("feedBackSent"))};O.prototype._createMessageStripHBox=function(){var e=this._generateAIPolicyText();var t=new f(this.getId()+"--createdwithAI",{text:e}).addStyleClass("sapUiTinyMarginEnd");var s=new r(this.getId()+"--messageHBox",{alignItems:"Baseline",renderType:"Bare",width:"auto",visible:false,height:"auto",justifyContent:"Start",backgroundDesign:"Transparent",wrap:D.Wrap,items:[t]}).addStyleClass("sapUiTinyMarginTop sapUiSmallMarginBegin");return s};O.prototype._setQueryItem=function(e,t){var s=function(e){return e+". "};var a=new f(this.getId()+"--queryItem"+e,{text:s(e),wrapping:true}).addStyleClass("aiDialogText sapUiTinyMarginEnd");var i=new f(this.getId()+"--queryListItem"+e,{showColon:false,text:this.i18Bundle.getText(t),wrapping:true}).addStyleClass("aiDialogText");var n=new r(this.getId()+"--queryListBox"+e,{items:[a,i]}).addStyleClass("sapUiTinyMarginTop");return n};O.prototype._createSampleQueryListBox=function(){var e=new n(this.getId()+"--sampleQueryListBox",{alignItems:"Start",justifyContent:"Start",backgroundDesign:"Transparent",renderType:"Bare",items:[this._setQueryItem(1,"QUERY_LIST_ITEM1"),this._setQueryItem(2,"QUERY_LIST_ITEM2"),this._setQueryItem(3,"QUERY_LIST_ITEM3")]}).addStyleClass("sapUiSmallMarginBeginEnd");return e};O.prototype.getDialogInnerContent=function(){return this._getOuterVbox()};O.prototype._setAccessMethods=function(e){this._getSearchedCard=function(){return e&&e.searchedCard};this._getThumbsUpButton=function(){return e&&e.oThumbsUpButton};this._getThumbsDownButton=function(){return e&&e.oThumbsDownButton};this._getPlaceholder=function(){return e&&e.placeholder};this._getAddButton=function(){return e&&e.oAddButton};this._getCancelButton=function(){return e&&e.oCancelButton};this._enableFocusAddButton=function(t){if(e&&e.oAddButton){e.oAddButton.setEnabled(t);if(t){setTimeout(function(){e.oAddButton.focus()},0)}}};this._getTextBox=function(){return e&&e.oTextBox};this._setMessageStripOverflowVisibility=function(t){if(e&&e.messageStripHbox&&e.oInsightsCardOverflowLayer){e.messageStripHbox.setVisible(t);e.oInsightsCardOverflowLayer.setVisible(t)}};this._getNoCardMessage=function(){return e&&e.oNoCardMessage};this._getDefaultPreviewPanelFlex=function(){return e&&e.oDefaultPreviewPanelFlex};this.noHeaderNavigationBox=function(t){e.noHeaderNavigationBox.setVisible(t)};this._toggleCardBox=function(t){e.oDefaultPreviewPanelFlex.setVisible(t);e.noCardBox.setVisible(!t)};this._toggleButtonAndText=function(t){e.oTextBox.setEnabled(t);this._toggleStyleClass(t);e.busyMessageBox.setVisible(!t);e.oRegenerateButton.setEnabled(t);e.oThumbsUpButton.setPressed(!t);e.oThumbsDownButton.setPressed(!t);this._enableClearButton(t)};this._toggleStyleClass=function(t){if(t){if(!e.oDefaultPreviewPanelFlex.hasStyleClass("sapUiSmallMarginTop")){e.oDefaultPreviewPanelFlex.addStyleClass("sapUiSmallMarginTop")}}else{e.oDefaultPreviewPanelFlex.removeStyleClass("sapUiSmallMarginTop")}};this._enableClearButton=function(t){e.oClearButton.setEnabled(t)};this._enableRegenerateButton=function(t){e.oRegenerateButton.setEnabled(t)};this._getOuterVbox=function(){return e&&e.oDefaultVBox};this._getFilterHBox=function(){return e&&e.oFilterHBox}};O.prototype._onClear=function(){this.resetDialog(true);g.show(this.i18Bundle.getText("Query_Deleted"));this.fireOnCardGenerated({});this._getTextBox().focus()};O.prototype.addCard=function(){var e=this._getSearchedCard()&&this._getSearchedCard().getManifest();this.getAggregation("_queryDialog").setBusy(true);sap.ui.require(["sap/insights/CardHelper"],function(t){t.getServiceAsync().then(function(t){t._createCard(e).then(function(e){this.getAggregation("_queryDialog").setBusy(false);g.show(this.i18Bundle.getText("Card_Created"));this.closeDialog();if(!e["sap.insights"].visible){S.information(this.i18Bundle.getText("INT_CARD_LIMIT_MESSAGEBOX"),{styleClass:"msgBoxAlign"})}if(this.hasListeners("onAddButtonPress")){this.fireOnAddButtonPress()}}.bind(this))}.bind(this)).catch(function(e){this.getAggregation("_queryDialog").setBusy(false);u.error(e.message);g.show(e.message)}.bind(this))}.bind(this))};O.prototype.closeDialog=function(){this.noHeaderNavigationBox(false);this._getQueryDialog().close()};O.prototype.openDialog=function(){this._getQueryDialog().open()};O.prototype.afterOpenDialog=function(){this._getTextBox().focus()};O.prototype._setAriaTextOnManifest=function(e){var t=e.getSource()._ariaText.getText();var s=this.i18Bundle.getText("INT_DIALOG_TITLE_CardPreview");e.getSource()._ariaText.setText(s+t);var a=e.getSource().getManifest()["sap.app"];if(a&&!(a.title===U["sap.app"].title)){e.getSource().setPreviewMode("Off")}};O.prototype._onManifestReady=function(e){var t=e.getSource();t.showLoadingPlaceholders()};O.prototype._setTextBoxValueState=function(e,t=""){const s=this._getTextBox();s.setValueState(e);s.setValueStateText(t?this.i18Bundle.getText(t):"")};O.prototype._getValueState=function(e){const t=2;const s=500;const a={valueState:R.None,messageKey:undefined};if(e<t){a.valueState=R.Information;a.messageKey="minLengthRequired"}else if(e>s){a.valueState=R.Warning;a.messageKey="maxLengthExceeded"}return a};O.prototype.onChange=function(){const e=this._getTextBox().getValue()?.trim()||"";const t=e.length;const s=t>=2&&t<=500;this._enableClearButton(true);this._enableRegenerateButton(s);if(t===0){this.resetDialog();return}const a=this._getValueState(t);this._setTextBoxValueState(a.valueState,a.messageKey)};O.prototype._onSearch=function(){var e=this._getTextBox().getValue();var t=this._getSearchedCard();if(e&&e.trim().length){this._startGenerate=true;this.resetDialog();t.setVisible(false);this._getPlaceholder().setVisible(true);this._getCancelButton().focus();this._toggleButtonAndText(false);var s={UserInput:e};fetch(l.AI_INSIGHTCARD_BASEURL,{method:"HEAD",headers:{"X-CSRF-Token":"Fetch"}}).then(function(e){var t=e.headers.get("X-CSRF-Token");return fetch(l.ADD_AI_INSIGHTCARD_COMPLETEURL,{method:l.POST,headers:{"X-CSRF-Token":t,"content-type":"application/json;odata.metadata=minimal;charset=utf-8"},body:JSON.stringify(s)})}).then(function(e){if(!e.ok){return e.json().then(function(e){return Promise.reject({message:e.message||e.error.message})})}return e.json()}).then(function(e){this._handleSearchSuccess(t,e)}.bind(this)).catch(function(e){this._handleSearchError(t,e)}.bind(this))}else{this._getTextBox().focus()}};O.prototype._handleSearchSuccess=function(e,t){if(this._startGenerate){this._toggleButtonAndText(true);var s="";if(t&&t.CardManifest){s=JSON.parse(t.CardManifest);var a=s["sap.insights"];var i=t.ApplicationInformation;if(a&&i&&i.SemanticObject&&i.SemanticAction){var n="#"+i.SemanticObject+"-"+i.SemanticAction;a["parentAppUrl"]=n}if(!s["sap.app"]||!s["sap.app"].dataSources){this.noHeaderNavigationBox(true)}}if(s){this._getPlaceholder().setVisible(false);e.setVisible(true);e.setManifest(s);this.fireOnCardGenerated(s);this._enableFocusAddButton(true);this._setMessageStripOverflowVisibility(true);this._toggleCardBox(true);var r=this._getFilterHBox();if(t.FilterTokens){var o=this._processFilterTokens(t.FilterTokens);o.forEach(function(e,t){if(e){var s=new C({text:e,key:t,editable:false}).addStyleClass("customTokenLineHeight");r.getItems()?.[1]?.addToken(s)}});this._addTokenArias()}}this._startGenerate=false}};O.prototype._processFilterTokens=function(e){var t=[];if(e){var s=e.filters||[];var a=e.orders||[];const i=e.appwithlabel?.applabel??this.i18Bundle.getText("APP_LABEL");const n=e.appwithlabel?.name??e.app?.name;if(n){t.push(`${i}: ${n}`)}const r=e.topwithlabel?.toplabel??this.i18Bundle.getText("TOP_LABEL");const o=e.topwithlabel?.value??e.top;if(o){t.push(`${r}: ${o}`)}s.forEach(function(e){const s=e.propertylabel||e.name;const a=this._formatFilterToken(e.operator,s,e.values);if(a&&!t.includes(a)){t.push(a)}}.bind(this));a.forEach(function(e){t.push(e.propertylabel+": "+(e.operatorlabel||e.operator))})}return t};O.prototype._formatFilterToken=function(e,t,s){var a=s[0].value.replace(/^'|'$/g,"");var i=s[1]?.value?.replace(/^'|'$/g,"");const n={eq:"",ne:"!=",gt:">",ge:">=",lt:"<",le:"<="};if(n[e]!==undefined){return`${t}: ${n[e]} ${a}`}const r={startswith:`${t}: ${a}*`,notstartswith:`${t}: !(${a}*)`,endswith:`${t}: *${a}`,notendswith:`${t}: !(*${a})`,contains:`${t}: *${a}*`,notcontains:`${t}: !(*${a}*)`,bt:`${t}: (${a}...${i})`,nb:`${t}: !(${a}...${i})`};return r[e]||`${t}: ${a}`};O.prototype._handleSearchError=function(e,t){if(this._startGenerate){this._toggleButtonAndText(true);u.error(t.message);this._getPlaceholder().setVisible(false);var s=/\((\d{2})\d*\)\s*(.*)/;var a=t.message.match(s);var i="",n="";if(a){i=a[1]}n=t.message;var r=this.setErrorMessage(i,n);var o=this._getNoCardMessage();o.setTitle(r.title);o.setDescription(r.description);o.setIllustrationType(r.type);this._toggleCardBox(false);setTimeout(()=>{var e=o.getDomRef();e.tabIndex=0;e.focus()},0);this._startGenerate=false}else{this._getTextBox().focus()}};O.prototype._addTokenArias=function(){var e=this._getFilterHBox();var t=e.getItems()?.[1];var s=t&&t.getTokens();if(s&&s.length){e.setVisible(true);s.forEach(function(e){t.addAriaDescribedBy(e.getId())})}};O.prototype.setErrorMessage=function(e,t){var s={type1:"sapIllus-UnableToLoad",type2:"sapIllus-NoSearchResults",type3:"sapIllus-NoData",type4:"sapIllus-UnableToUpload"};var a={type:"",title:"",description:t};switch(e){case"10":a.type=s.type1;a.title=this.i18Bundle.getText("ERRORCODE_TITLE1");break;case"20":a.type=s.type2;a.title=this.i18Bundle.getText("ERRORCODE_TITLE2");break;case"30":a.type=s.type3;a.title=this.i18Bundle.getText("ERRORCODE_TITLE3");break;case"40":a.type=s.type4;a.title=this.i18Bundle.getText("ERRORCODE_TITLE4");break;default:a.type=s.type4;a.title=this.i18Bundle.getText("ERRORCODE_TITLE");break}return a};O.prototype.resetDialog=function(e){if(e){this._getTextBox().setValue("");this._getNoCardMessage().setDescription(" ");this._toggleButtonAndText(true);this._startGenerate=false}this.noHeaderNavigationBox(false);this._getPlaceholder().setVisible(false);this._getSearchedCard().setVisible(true);var t=this._getFilterHBox();t.getItems()?.[1]?.removeAllAriaDescribedBy();t.getItems()?.[1]?.removeAllTokens();t.setVisible(false);this._setMessageStripOverflowVisibility(false);const s={"/sap.card/header/dataTimestamp":""};var a=this._getSearchedCard();a.setManifestChanges([s]);a.setManifest(U);a.setPreviewMode("Abstract");this._toggleCardBox(true);this._enableFocusAddButton(false);this._enableClearButton(false);this._enableRegenerateButton(false);this._setTextBoxValueState(R.None,"")};return O});
/*!
 * 
		SAP UI development toolkit for HTML5 (SAPUI5)
		(c) Copyright 2009-2015 SAP SE. All rights reserved
	
 */
sap.ui.predefine("sap/insights/ManageCards", ["sap/ui/core/Control","sap/m/NavContainer","sap/ui/model/resource/ResourceModel","./manageCards/CardsList","sap/insights/CardHelper","sap/ui/core/Lib","sap/ui/core/Core","./utils/InsightsUtils"],function(t,e,i,a,s,r,n,o){"use strict";var d=t.extend("sap.insights.ManageCards",{metadata:{properties:{enableResetAllCards:{type:"boolean",group:"Behavior",defaultValue:false},cardId:{type:"string",group:"Behavior",defaultValue:null}},aggregations:{_navContainer:{type:"sap.m.NavContainer",multiple:false,visibility:"hidden"}}},renderer:{apiVersion:2,render:function(t,e){t.openStart("div",e);t.style("height","100%");t.style("width","100%");t.openEnd();e._oNavContainer.to(e._oNavContainer.getInitialPage());t.renderControl(e.getAggregation("_navContainer"));t.close("div")}}});d.prototype.onAfterRendering=function(){var t;this._oNavContainer.setBusy(true);s.getServiceAsync().then(function(t){return t._getUserAllCardModel()}).then(function(e){t=e;if(!this._cardListPage){this._cardListPage=new a(this.getId()+"cardList",{enableResetAllCards:this.getEnableResetAllCards(),listPress:this._navToDetails.bind(this)});this._cardListPage.setModel(t);this._cardListPage._handleModelChange();t.bindProperty("/cards").attachChange(function(t){this._cardListPage._handleModelChange()}.bind(this));this._oNavContainer.addPage(this._cardListPage)}var i=this.getCardId();if(i){var s=t.getProperty("/cards");var r=s.find(function(t){return t.id===i});if(r){this.loadCardDetails().then(function(){this._oNavContainer.addPage(this._cardDetailControl);var t=JSON.stringify(r);this._cardDetailControl.setProperty("manifest",t,false);this._oNavContainer.to(this._cardDetailControl)}.bind(this))}}else{this._oNavContainer.setInitialPage(this._cardListPage);this._oNavContainer.to(this._cardListPage)}this._oNavContainer.setBusy(false)}.bind(this))};d.prototype.loadCardDetails=function(){return new Promise(async function(t){if(!this._cardDetailControl){await r.load({name:"sap/ui/mdc"});sap.ui.require(["sap/insights/manageCards/CardDetails"],function(e){this._cardDetailControl=new e(this.getId()+"previewPage",{navigate:this.navigateTo.bind(this)});t()}.bind(this))}else{t()}}.bind(this))};d.prototype.init=function(){this._oNavContainer=new e(this.getId()+"--selectionNavCon",{busy:true});this._oNavContainer.setModel(new i({bundle:o.getResourceBundle()}),"i18n");this.setAggregation("_navContainer",this._oNavContainer)};d.prototype.navigateTo=function(t,e){if(!t&&e){this._oNavContainer.to(e)}else{this._oNavContainer.to(this._cardListPage.getId())}};d.prototype._navToDetails=function(t){if(t&&t.getParameter("manifest")){this._oNavContainer.setBusy(true);this.loadCardDetails().then(function(){this._cardDetailControl.setProperty("manifest",t.getParameter("manifest"),false);if(!this._oNavContainer.getPage(this._cardDetailControl.getId())){this._oNavContainer.addPage(this._cardDetailControl)}this._cardDetailControl.oPage.setShowNavButton(true);if(t.getParameter("listRefresh")){this._cardDetailControl._refreshDTSmartForm(t.getParameter("listRefresh"))}this._cardDetailControl.setEditable(false);this._oNavContainer.setBusy(false);this._oNavContainer.to(this._cardDetailControl)}.bind(this))}};d.prototype.clearPage=function(){if(this._cardListPage){this.navigateTo();if(this._cardListPage._oSearchField){this._cardListPage._oSearchField.clear()}if(this._cardListPage._oVisibleFilterSwitch&&this._cardListPage._oVisibleFilterSwitch.getState()){this._cardListPage._oVisibleFilterSwitch.setState(false);this._cardListPage._oVisibleFilterSwitch.fireChange()}}this.setProperty("cardId","")};return d});
/*!
 * 
		SAP UI development toolkit for HTML5 (SAPUI5)
		(c) Copyright 2009-2015 SAP SE. All rights reserved
	
 */
sap.ui.predefine("sap/insights/ManagePreview", ["sap/ui/core/Control","sap/m/NavContainer","sap/insights/CardHelper","sap/insights/manageCardPreview/Preview","sap/insights/manageCardPreview/ColumnListPreview","sap/insights/manageCardPreview/HouseOfCards","sap/m/Button","sap/m/Dialog","sap/ui/model/resource/ResourceModel","./utils/CardPreviewManager","sap/m/MessageToast","sap/m/MessageBox","./utils/DeviceType","sap/base/Log","sap/insights/utils/AppConstants","sap/ui/performance/trace/FESRHelper","sap/ui/core/InvisibleText","./utils/InsightsUtils"],function(e,t,i,s,o,a,n,r,l,h,u,g,_,C,f,d,P,v){"use strict";var T=C.getLogger("sap.insights.ManagePreview");var w=e.extend("sap.insights.ManagePreview",{renderer:null,metadata:{properties:{manifest:{type:"object",group:"Behavior",defaultValue:null},transformation:{type:"boolean",group:"Behavior",defaultValue:false},cardMessageInfo:{type:"object",group:"Appearance",defaultValue:null},confirmButtonText:{type:"string",group:"Appearance",defaultValue:""},dialogTitle:{type:"string",group:"Appearance",defaultValue:""}},aggregations:{_manageDialog:{type:"sap.m.Dialog",multiple:false,visibility:"hidden"}},events:{onConfirmButtonPress:{parameters:{manifest:{type:"string"}}},onCloseButtonPress:{}}}});w.prototype.init=function(){this.i18Bundle=v.getResourceBundle();this.oInvisibleText=new P(this.getId()+"--invisibleText");this._createStaticControls();this._oNavContainer=new t(this.getId()+"selectionNavCon");this._oManageDialog=new r(this.getId()+"--insightsListDialog",{contentHeight:"42.8rem",contentWidth:"65.6rem",verticalScrolling:false,horizontalScrolling:false,resizable:false,draggable:true,showHeader:false,afterClose:this._afterCloseDialog.bind(this),content:[this._oNavContainer,this.oInvisibleText],buttons:[this.oBackButton,this.oAddButton,this.oNextButton,this.oCancelButton],ariaLabelledBy:[this.getId()+"--invisibleText"]}).addStyleClass("sapContrastPlus dialogScrollPadding")};w.prototype._afterCloseDialog=function(){this.oManifest={};this._oPreviewPage.setManifest({});this._oPreviewPage.setCardMessageInfo(null);this._oPreviewPage.bInitialPreviewLoad=true;this.setConfirmButtonText(null);if(this.getTransformation()){if(this._oColumnListPreview){this._oColumnListPreview.bShowPreview=false;this._oColumnListPreview.bDialogOpen=false;this._oColumnListPreview.oConfCard={};this._oColumnListPreview.oOrgCard={};if(this._oColumnListPreview.oColumnSearch){this._oColumnListPreview.oColumnSearch.setValue("")}}if(this._oHouseOfCards){this._oHouseOfCards.oConfCard={};this._oHouseOfCards._innerHocModel.setData({oSelected:{},aCards:[],aPreviewCards:[1,2,3],aAllowedChartTypes:[],sOriginalChartType:"",selectedPath:""})}}};w.prototype.setConfirmButtonText=function(e){this.setProperty("confirmButtonText",e);this.oAddButton.setText(e)};w.prototype._createStaticControls=function(){this.oBackButton=new n(this.getId()+"--backButton",{text:this.i18Bundle.getText("INT_DIALOG_BACK"),press:this._onNavBack.bind(this)});this.oAddButton=new n(this.getId()+"--addButton",{text:this.getConfirmButtonText()?this.getConfirmButtonText():this.i18Bundle.getText("INT_DIALOG_Ok"),press:this._save.bind(this),type:"Emphasized",enabled:true});d.setSemanticStepname(this.oAddButton,"press",f.FESR_STEP_NAME);this.oNextBtnInvisibleText=new P(this.getId()+"--nextInvisibleText");this.oNextBtnInvisibleText=this.i18Bundle.getText("INT_DIALOG_NEXT");this.oNextButton=new n(this.getId()+"--nextButton",{text:this.i18Bundle.getText("INT_DIALOG_NEXT"),press:this._callNextPage.bind(this),type:"Emphasized",enabled:false,ariaLabelledBy:[this.getId()+"--nextInvisibleText"]});this.oCancelButton=new n(this.getId()+"--cancelButton",{text:this.i18Bundle.getText("INT_DIALOG_CANCEL"),press:this._closeDialog.bind(this)})};w.prototype._setEnableButton=function(e){if(this.getTransformation()&&!this.bColumnPage){this.oNextButton.setEnabled(e.getParameter("enableButton"))}else{this.oAddButton.setEnabled(e.getParameter("enableButton"))}};w.prototype.openPreviewDialog=function(){this.oManifest=this.getManifest();this.oBackButton.setVisible(false);var e=this.getConfirmButtonText()?this.getConfirmButtonText():this.i18Bundle.getText("INT_DIALOG_Ok");this.oAddButton.setText(e);this._showPreview(this.oManifest);if(this.getTransformation()){this.oAddButton.setVisible(false);this.oNextButton.setVisible(true)}else{this.oAddButton.setVisible(true);this.oNextButton.setVisible(false)}};w.prototype._createColumnListDialog=function(){if(!this._oColumnListPreview){this._oColumnListPreview=new o({enableAddButton:this._setEnableButton.bind(this)})}this._oColumnListPreview.setManifest(this._oPreviewPage.getManifest());if(this.getDialogTitle()){this._oColumnListPreview.setDialogTitle(this.getDialogTitle())}else{this._oColumnListPreview.setDialogTitle(this.hasListeners("onConfirmButtonPress")?this.i18Bundle.getText("INT_PREVIEW_POPOVER_BUTTON_TITLE_COLMANAGER"):this.i18Bundle.getText("INT_PREVIEW_POPOVER_BUTTON_TITLE"))}this._oNavContainer.addPage(this._oColumnListPreview);this._oNavContainer.to(this._oColumnListPreview);if(_.getDialogBasedDevice()===f.DEVICE_TYPES.Desktop){this._oColumnListPreview.oPreviewCard.setPreviewMode(this._oColumnListPreview.iVisibleColumnCount>0?"Off":"Abstract");this._oColumnListPreview._refreshShowPreview()}else{this._oColumnListPreview.oPreviewColCardSD.setPreviewMode(this._oColumnListPreview.iVisibleColumnCount>0?"Off":"Abstract")}};w.prototype._createHocDialog=function(){if(!this._oHouseOfCards){this._oHouseOfCards=new a({})}this._oHouseOfCards.setManifest(this._oPreviewPage.getManifest());if(this.getDialogTitle()){this._oHouseOfCards.setDialogTitle(this.getDialogTitle())}else{this._oHouseOfCards.setDialogTitle(this.hasListeners("onConfirmButtonPress")?this.i18Bundle.getText("INT_PREVIEW_POPOVER_BUTTON_TITLE_COLMANAGER"):this.i18Bundle.getText("INT_PREVIEW_POPOVER_BUTTON_TITLE"))}};w.prototype._save=function(e){var t=JSON.parse(this._oPreviewPage.getManifest());if(this._oColumnListPreview&&Object.entries(this._oColumnListPreview.oConfCard).length){t=this._oColumnListPreview.oConfCard}else if(this._oHouseOfCards&&Object.entries(this._oHouseOfCards.oConfCard).length){t=this._oHouseOfCards.oConfCard}var s=h.insertActionsManifest(t,this.oManifest);if(this.hasListeners("onConfirmButtonPress")){this.fireOnConfirmButtonPress({manifest:s});this._closeDialog()}else if(t["sap.card"].header.title){var o=t["sap.insights"].visible;t["sap.insights"].visible=true;this._oManageDialog.setBusy(true);i.getServiceAsync().then(function(e){e._createCard(s).then(function(e){this._oManageDialog.setBusy(false);this._closeDialog();if(o){u.show(this.i18Bundle.getText("Card_Created"))}else{g.information(this.i18Bundle.getText("INT_CARD_LIMIT_MESSAGEBOX"),{styleClass:"msgBoxAlign"})}}.bind(this)).catch(function(e){if(e&&e.message==="/UI2/INSIGHTS_MSG/007"){g.error(this.i18Bundle.getText("INT_CARD_MAXLIMIT"))}else{u.show(e.message)}this._oManageDialog.setBusy(false);this._closeDialog()}.bind(this))}.bind(this))}else{this._oNavContainer.to(this._oPreviewPage);this._oPreviewPage.oTitleTextInput.focus()}};w.prototype._callNextPage=function(){try{var e=JSON.parse(this._oPreviewPage.getManifest());if(e&&this._oPreviewPage.oTitleTextInput.getValue().trim()){var t=e["sap.card"];if(t.type==="Table"||t.type==="List"){var i=_.getDialogBasedDevice()===f.DEVICE_TYPES.Desktop;this._createColumnListDialog();var s=i?this._oColumnListPreview.oColumnSegButton:this._oColumnListPreview.oSdColumnSegButton;if(!s.getSelectedKey()){s.setSelectedKey("list")}this._oColumnListPreview.oColumnSearch.setValue("");this._oColumnListPreview._onColumnSearch();this.bColumnPage=true;this.oNextButton.setVisible(false);this.oAddButton.setVisible(true);this.oBackButton.setVisible(true);this._oColumnListPreview.oColumnSearch.focus()}else if(t.type==="Analytical"){this._createHocDialog();this._oHouseOfCards.showHouseOfCardsDialog();this._oHouseOfCards.getChartTypeSearch().setValue("");this._oHouseOfCards._onChartTypeSearch();this._oNavContainer.addPage(this._oHouseOfCards);this._oNavContainer.to(this._oHouseOfCards);this.oNextButton.setVisible(false);this.oAddButton.setVisible(true);this.oBackButton.setVisible(true);this.oAddButton.setEnabled(true)}else{this._oColumnListPreview._callPreview(e)}}}catch(e){T.error(e.message);u.show(e.message);throw new Error(e)}};w.prototype._callPreviewPage=function(e){if(this._oColumnListPreview){this._oColumnListPreview.bShowPreview=false}if(this._oNavContainer&&this._oPreviewPage){this._oPreviewPage.bShowCardPreview=false;this._oPreviewPage._adjustLayoutStyles();var t=this._oPreviewPage.oTitleTextInput;if(e){if(e["sap.card"].header.title&&e["sap.card"].header.title.trim()){this.oNextButton.setEnabled(true);t.setValueState("None");t.setValueStateText("")}else{this.oNextButton.setEnabled(false);t.setValueState("Error");t.setValueStateText(this.i18Bundle.getText("INT_Preview_Title_ValueStateText"))}}this.bColumnPage=false;this._oNavContainer.to(this._oPreviewPage);var i=_.getDialogBasedDevice()===f.DEVICE_TYPES.Desktop;var s=i?this._oPreviewPage.oDefaultPreviewCardLS:this._oPreviewPage.oDefaultPreviewCardSD;if(s&&(e["sap.card"].type==="Table"||e["sap.card"].type==="List")){if(this._oColumnListPreview&&this._oColumnListPreview.iVisibleColumnCount>0){s.setPreviewMode("Off")}else{s.setPreviewMode("Abstract")}}this._oPreviewPage.setManifest(JSON.stringify(e));this.oBackButton.setVisible(false);this.oAddButton.setVisible(false);this.oNextButton.setVisible(true)}};w.prototype._closeDialog=function(){this.fireOnCloseButtonPress();this._oColumnListPreview?.resetSelectCountData();this._oManageDialog.close()};w.prototype._onNavBack=function(){if(this._oColumnListPreview&&this._oColumnListPreview.oConfCard&&Object.entries(this._oColumnListPreview.oConfCard).length){var e=this._oColumnListPreview.oConfCard["sap.card"];if(e.type==="Table"||e.type==="List"){this._callPreviewPage(this._oColumnListPreview.oConfCard);this._oPreviewPage.oTitleTextInput.focus()}}else if(this._oHouseOfCards&&this._oHouseOfCards.oConfCard&&Object.entries(this._oHouseOfCards.oConfCard).length){this._callPreviewPage(this._oHouseOfCards.oConfCard)}};w.prototype.clearManifestChanges=function(){if(this._oPreviewPage){this._oPreviewPage.oDefaultPreviewCardSD.setManifestChanges(null);this._oPreviewPage.oDefaultPreviewCardLS.setManifestChanges(null)}if(this._oColumnListPreview){this._oColumnListPreview.oPreviewColCardSD.setManifestChanges(null);this._oColumnListPreview.oPreviewCard.setManifestChanges(null)}if(this._oHouseOfCards){this._oHouseOfCards._oPreviewCardHoCSD.setManifestChanges(null);this._oHouseOfCards._oPreviewCardHoC.setManifestChanges(null)}};w.prototype._showPreview=function(e){return i.getServiceAsync().then(function(t){return t._getUserAllCards().then(function(t){var i=t.filter(function(e){return e.visibility});if(i.length<10){e["sap.insights"].visible=true}var o=e?JSON.parse(JSON.stringify(e)):"";o=h.getCardPreviewManifest(e);if(!this._oPreviewPage){this._oPreviewPage=new s(this.getId()+"idPreviewPage",{cardMessageInfo:this.getCardMessageInfo(),transformation:this.getTransformation(),titleCheck:this._setEnableButton.bind(this)})}else{this.clearManifestChanges();this._oPreviewPage.setCardMessageInfo(this.getCardMessageInfo());this._oPreviewPage.setTransformation(this.getTransformation())}this._oPreviewPage.setManifest(JSON.stringify(o));if(this.getDialogTitle()){this._oPreviewPage.setDialogTitle(this.getDialogTitle())}else{this._oPreviewPage.setDialogTitle(this.hasListeners("onConfirmButtonPress")?this.i18Bundle.getText("INT_PREVIEW_POPOVER_BUTTON_TITLE_COLMANAGER"):this.i18Bundle.getText("INT_PREVIEW_POPOVER_BUTTON_TITLE"))}this.oInvisibleText.setText(this._oPreviewPage.getDialogTitle());this._oNavContainer.addPage(this._oPreviewPage);this._oNavContainer.to(this._oPreviewPage);this.bColumnPage=false;var a=this._oPreviewPage.oTitleTextInput;a.setValueState("None");this._oManageDialog.open();this._oPreviewPage.setPreviewModeOfCard();if(this.hasListeners("onConfirmButtonPress")){this._oPreviewPage.oDefaultSubText.setText(this.i18Bundle.getText("INT_CARD_SUBTITLE"))}else{this._oPreviewPage.oDefaultSubText.setText(this.i18Bundle.getText("INT_CARD_SUBTITLE")+"\n"+this.i18Bundle.getText("INT_CARD_LIMIT_SUBTITLE"))}return Promise.resolve()}.bind(this))}.bind(this)).catch(function(e){T.error(e.message);return Promise.reject(e)})};return w});
/*!
 * 
		SAP UI development toolkit for HTML5 (SAPUI5)
		(c) Copyright 2009-2015 SAP SE. All rights reserved
	
 * This extension is for OVP cards delivered in 2203 onwards.
 */
sap.ui.predefine("sap/insights/OVPCardExtension", ["sap/ui/integration/Extension","sap/ui/core/format/NumberFormat","sap/fe/navigation/SelectionVariant","sap/base/Log","sap/ui/core/format/DateFormat","sap/ui/core/library","sap/m/library","./OVPChartFormatter","sap/ui/integration/util/Utils","sap/m/DynamicDateUtil","sap/ui/core/date/UI5Date"],function(e,t,r,a,i,n,o,s,l,f,u){"use strict";var c=o.ValueColor,g=n.ValueState;var m={StateValues:{None:"None",Negative:"Error",Critical:"Warning",Positive:"Success"},ColorValues:{None:"Neutral",Negative:"Error",Critical:"Critical",Positive:"Good"}};var v=a.getLogger("sap.insights.OVPCardExtension");var p=function(e,t){return e&&e.indexOf(t,e.length-t.length)!==-1};var d=function(e,t){var r;if(t){r=t.None;if(e&&e.EnumMember){var a=e.EnumMember;if(p(a,"Negative")){r=t.Negative}else if(p(a,"Critical")){r=t.Critical}else if(p(a,"Positive")){r=t.Positive}}}return r};var b=function(e,t,r,a,i,n,o){var s={};s.EnumMember="None";var l=Number.NEGATIVE_INFINITY;var f=Number.POSITIVE_INFINITY;if(!i&&i!==0&&(r||r===0)){i=r}if(!n&&n!==0&&(a||a===0)){n=a}if(!r&&r!==0){r=l}if(!a&&a!==0){a=f}if(e!==undefined){e=Number(e);if(p(t,"Minimize")||p(t,"Minimizing")){if((n||n===0)&&(a||a===0)){if(e<=parseFloat(n)){s.EnumMember="Positive"}else if(e>parseFloat(a)){s.EnumMember="Negative"}else{s.EnumMember="Critical"}}}else if(p(t,"Maximize")||p(t,"Maximizing")){if((i||i===0)&&(r||r===0)){if(e>=parseFloat(i)){s.EnumMember="Positive"}else if(e<parseFloat(r)){s.EnumMember="Negative"}else{s.EnumMember="Critical"}}}else if(p(t,"Target")){if((n||n===0)&&(a||a===0)&&(i||i===0)&&(r||r===0)){if(e>=parseFloat(i)&&e<=parseFloat(n)){s.EnumMember="Positive"}else if(e<parseFloat(r)||e>parseFloat(a)){s.EnumMember="Negative"}else{s.EnumMember="Critical"}}}}return d(s,o)};var h=function(e,t,r,a){if(!e||!t){return}e=Number(e);if(!a&&e-t>=0){return"Up"}if(!r&&e-t<=0){return"Down"}if(t&&a&&e-t>=a){return"Up"}if(t&&r&&e-t<=r){return"Down"}};var N=function(e,r,a){var i=r||{},n=e;var o=t.getFloatInstance({minFractionDigits:i.NumberOfFractionalDigits,maxFractionDigits:i.NumberOfFractionalDigits,style:"short",showScale:true,shortRefNumber:n});var s=o.format(Number(n)),l=o.getScale()||"";if(!a&&s){var f=s[s.length-1];return f===l?s.slice(0,s.length-1):s}if(a&&i.percentageAvailable){return l+"%"}if(a&&!i.percentageAvailable){return l}return""};var S=function(){var e=this.getCard().getCombinedParameters();return e._headerDataUrl};var D=function(){var e=this.getCard().getCombinedParameters();return e._contentDataUrl};var I=function(e,r,a){var i,n,o;if(isNaN(+e)){return""}if(e==0){o=r}else{o=e}if(a.NumberOfFractionalDigits){n=+a.NumberOfFractionalDigits}if(r){i=r}else if(a.manifestTarget){i=a.manifestTarget}if(!n||n<0){n=0}else if(n>2){n=2}if(i){var s=t.getFloatInstance({minFractionDigits:n,maxFractionDigits:n,style:"short",showScale:true,shortRefNumber:o});return s.format(+i)}};var y=function(e,r,a){var i,n;if(isNaN(+e)){return""}e=+e;if(a.NumberOfFractionalDigits){i=+a.NumberOfFractionalDigits}if(r){n=+r}else if(a.manifestTarget){n=+a.manifestTarget}if(!i||i<0){i=0}else if(i>2){i=2}if(n){var o=(e-n)/n;var s=t.getPercentInstance({style:"short",minFractionDigits:i,maxFractionDigits:i,showScale:true});return s.format(o)}};var O=function(e){var t={};t.EnumMember="None";if(Number(e)===1){t.EnumMember="Negative"}else if(Number(e)===2){t.EnumMember="Critical"}else if(Number(e)===3){t.EnumMember="Positive"}return d(t,m.ColorValues)};var F=function(){var e=arguments[arguments.length-1];var t=1;return b(arguments[0],e.sImprovementDirection,e.bIsDeviationLowBinding?arguments[t++]:e.deviationLow,e.bIsDeviationHighBinding?arguments[t++]:e.deviationHigh,e.bIsToleranceLowBinding?arguments[t++]:e.toleranceLow,e.bIsToleranceHighBinding?arguments[t++]:e.toleranceHigh,e.oCriticalityConfigValues)};var C=function(){var e=arguments[arguments.length-1];var t=1;return h(arguments[0],e.bIsRefValBinding?arguments[t++]:e.referenceValue,e.bIsDownDiffBinding?arguments[t++]:e.downDifference,e.bIsUpDiffBinding?arguments[t++]:e.upDifference)};var P=function(e){var t;var r=arguments[arguments.length-1],a=r&&r.propertyType;switch(a){case"yearmonth":var i=parseInt(e.substr(0,4),10),n=e.substr(4),o=parseInt(n,10)-1;t=u.getInstance(Date.UTC(i,o));break;case"yearquarter":var i=parseInt(e.substr(0,4),10),s=e.substr(4),l=parseInt(s,10)*3-2,o=l-1;t=u.getInstance(Date.UTC(i,o));break;case"yearweek":var i=parseInt(e.substr(0,4),10),f=e.substr(4),c=1+(parseInt(f,10)-1)*7;t=u.getInstance(Date.UTC(i,0,c));break;default:break}return t};var E=function(e,t){var r=l.parseJsonDateTime(e);return i.getInstance(t).format(u.getInstance(r),t.bUTC)};var w=function(e,r,a,i){var n;if(e){e.maxFractionDigits=e.numberOfFractionalDigits||0;e.minFractionDigits=e.numberOfFractionalDigits||0;e.style=e.style||"short";e.showScale=e.showScale||true;e.shortRefNumber=e.scaleFactor;n=t.getFloatInstance(e)}var o=[];if(!isNaN(parseFloat(a))&&n){o.push(n.format(a))}else{o.push(a)}if(!isNaN(parseFloat(i))&&n){o.push(n.format(i))}else{o.push(i)}var s="";if(r&&r.length){r.forEach(function(e){if(typeof e==="number"){s=s+o[e]}else{s=s+e}})}return s};var V=function(e,t){if(t==="state"){switch(String(e)){case"1":case"Error":return g.Error;case"2":case"Warning":return g.Warning;case"3":case"Success":return g.Success;case"4":case"Information":return g.Information;default:return g.None}}if(t==="color"){switch(String(e)){case"1":case"Error":return c.Error;case"2":case"Critical":return c.Critical;case"3":case"Good":return c.Good;case"4":case"Neutral":return c.Neutral;default:return c.None}}};var M=function(e,t){var r=this.getCard().getModel().getProperty("/content/d/results")||this.getCard().getModel().getProperty("/d/results")||[];return Math[t].apply(Math,r.map(function(t){return t[e]}))};var T=function(e,t,r){var a=1;var i=2;var n=4;for(var o in e){if(e.hasOwnProperty(o)){var s=e[o];if(s instanceof Date){s=s.toJSON()}else if(Array.isArray(s)||s&&typeof s==="object"){s=JSON.stringify(s)}else if(typeof s==="number"||typeof s==="boolean"){s=s.toString()}if(s===""){if(r&a){v.info("Semantic attribute "+o+" is an empty string and due to the chosen Suppression Behiavour is being ignored.");continue}}if(s===null){if(r&i){throw new v.error("NavigationHandler.INVALID_INPUT")}else{v.warning("Semantic attribute "+o+" is null and ignored for mix in to selection variant");continue}}if(s===undefined){if(r&n){throw new v.error("NavigationHandler.INVALID_INPUT")}else{v.warning("Semantic attribute "+o+" is undefined and ignored for mix in to selection variant");continue}}if(typeof s==="string"||s instanceof String){t.addSelectOption(o,"I","EQ",s)}else{throw new v.error("NavigationHandler.INVALID_INPUT")}}}return t};var x=function(e,t,a){var i=new r(t);var n=new r;if(i.getFilterContextUrl()){n.setFilterContextUrl(i.getFilterContextUrl())}if(i.getParameterContextUrl()){n.setParameterContextUrl(i.getParameterContextUrl())}if(Array.isArray(e)){e.forEach(function(e){T(e,n,a)})}else{T(e,n,a)}var o=i.getParameterNames();var s;for(s=0;s<o.length;s++){if(!n.getSelectOption(o[s])){n.addSelectOption(o[s],"I","EQ",i.getParameter(o[s]))}}var l=i.getSelectOptionsPropertyNames();for(s=0;s<l.length;s++){var f=i.getSelectOption(l[s]);if(!n.getSelectOption(l[s])){for(var u=0;u<f.length;u++){n.addSelectOption(l[s],f[u].Sign,f[u].Option,f[u].Low,f[u].High)}}}return n};function U(e){if(e){if(e.hasOwnProperty("SelectionVariantID")){delete e.SelectionVariantID}else if(e.hasOwnProperty("PresentationVariantID")){delete e.PresentationVariantID}delete e.Text;delete e.ODataFilterExpression;delete e.Version;delete e.FilterContextUrl;delete e.ParameterContextUrl;return e}return e}var H=function(e){try{if(JSON.parse(e)){return true}}catch(e){return false}};var A=function(e){var t=e&&e.length===1,r=e&&e[0];return t&&r["Option"]==="EQ"&&!r["High"]&&r["Low"]&&r["Sign"]==="I"};var L=function(e){var t=i.getDateInstance({pattern:"''yyyy-MM-dd'T'HH:mm:ss.SSS'Z'''",calendarType:"Gregorian"});if(e){var r=t.format(e,true);return String(r).replace(/'/g,"")}};var _=function(e){var t=i.getDateInstance({pattern:"''yyyy-MM-dd'T'HH:mm:ss.SSS''",calendarType:"Gregorian"});var r=e instanceof Date?e:u.getInstance(e);var a=t.format(r);return String(a).replace(/'/g,"")};var J=function(e,t,r){var a=[];if(e.operation==="DATE"&&e.value1){a=f.toDates({values:[e.value1],operator:e.operation})||[]}else{a=f.toDates({values:[],operator:e.operation})||[]}var i=a[0]&&a[0].oDate;var n=a[1]&&a[1].oDate;var o="",s="";if(e["sap:filter-restriction"]==="single-value"){if(e.type==="Edm.DateTime"&&i instanceof Date){o=_(i);if(o){t.massAddSelectOption(r,[{Sign:"I",Option:e.operator,Low:o,High:null}])}}else if(e.type==="Edm.String"){o=L(i);if(o){t.massAddSelectOption(r,[{Sign:"I",Option:e.operator,Low:o,High:null}])}}}else if(e["sap:filter-restriction"]==="interval"){if(e.type==="Edm.DateTime"){if(i instanceof Date){o=_(i)}if(n instanceof Date){s=_(n)}if(o&&s){t.massAddSelectOption(r,[{Sign:"I",Option:e.operator,Low:o,High:s}])}}else if(e.type==="Edm.String"){if(i instanceof Date){o=L(i)}if(n instanceof Date){s=L(n)}if(o&&s){t.massAddSelectOption(r,[{Sign:"I",Option:e.operator,Low:o,High:s}])}}}};function k(e,t){var a=this.getEventingParent().getManifest()["sap.card"],i=a&&a.configuration.parameters,n=new r,o=i._relevantODataFilters.value||[],s=i._mandatoryODataParameters.value||[],e=e&&JSON.parse(e)||{},l=e.parameters||{},f=l.ibnParams||{},u=f.sensitiveProps||{};var c={};s.forEach(function(e){var t=H(i[e].value);if(t&&!u[e]){var r=JSON.parse(i[e].value);if(r&&r.operation){J(r,n,e)}}});o.forEach(function(e){var t=H(i[e].value);if(t&&!u[e]){var r=JSON.parse(i[e].value);if(r&&r.operation){J(r,n,e)}else{var a=r.SelectOptions.Ranges||r.SelectOptions&&r.SelectOptions[0]&&r.SelectOptions[0].Ranges;if(a&&a.length){var o=A(a);if(o){f[e]=a[0].Low}else{if(f[e]&&!o){delete f[e]}n.massAddSelectOption(e,a)}}}}});var g=t||{};var m=Object.keys(g)||[];for(var v=0;v<m.length;v++){if(u&&u[m[v]]||m[v]==="__metadata"){delete g[m[v]]}}var p=x(g,n&&n.toJSONObject());p=U(p.toJSONObject());if(f.presentationVariant){c["presentationVariant"]=f.presentationVariant}if(p.Parameters.length||p.SelectOptions.length){c["selectionVariant"]=p}if(!l.ibnParams){l.ibnParams={}}if(c["selectionVariant"]||c["presentationVariant"]){l.ibnParams["sap-xapp-state-data"]=JSON.stringify(c)}if(f&&f.sensitiveProps){delete f.sensitiveProps}delete f.selectionVariant;delete f.presentationVariant;return e}return e.extend("sap.insights.CardExtension",{init:function(){e.prototype.init.apply(this,arguments);s.registerCustomFormatters();this.setFormatters({kpiformatter:N,formatHeaderUrl:S.bind(this),formatContentUrl:D.bind(this),returnPercentageChange:y,targetValueFormatter:I,kpiValueCriticality:O,formatValueColor:F,formatTrendIcon:C,formatDateValue:P,addPropertyValueToAppState:k.bind(this),formatDate:E,formatNumber:w,formatCriticality:V,getMinMax:M.bind(this)})}})});
/*!
 * 
		SAP UI development toolkit for HTML5 (SAPUI5)
		(c) Copyright 2009-2015 SAP SE. All rights reserved
	
 */
sap.ui.predefine("sap/insights/OVPChartFormatter", ["sap/viz/library","sap/viz/ui5/format/ChartFormatter","sap/viz/ui5/api/env/Format","sap/ui/core/format/NumberFormat","sap/ui/core/format/DateFormat","sap/ui/core/date/UI5Date"],function(t,e,r,a,n,i){"use strict";var o=10;var s=[{prefix:"CURR",fn:f},{prefix:"axisFormatter",fn:u},{prefix:"0.0%",fn:m}];var c=["YearMonthDay","YearMonth","MMM","YearQuarter","Quarter","YearWeek","Week"];function f(t,e){var r;if(t===-1){r=a.getCurrencyInstance({style:"short",currencyCode:false})}else{r=a.getCurrencyInstance({style:"short",currencyCode:false,minFractionDigits:t,maxFractionDigits:t})}return r.format(Number(e))}function u(t,e){var r;if(t===-1){r=a.getFloatInstance({style:"short"})}else{r=a.getFloatInstance({style:"short",minFractionDigits:t,maxFractionDigits:t?t:1})}return r.format(Number(e))}function m(t,e){var r;if(t===-1){r=a.getPercentInstance({style:"short",minFractionDigits:1,maxFractionDigits:1})}else{r=a.getPercentInstance({style:"short",minFractionDigits:t,maxFractionDigits:t})}return r.format(Number(e))}function g(t,e){if(e.constructor===Date){var r=n.getDateTimeInstance({pattern:t});if(t==="YearMonthDay"){r=n.getDateInstance({style:"medium"})}if(t==="YearMonth"||t==="MMM"){r=n.getDateTimeInstance({format:"MMM"})}if(t==="YearQuarter"||t==="Quarter"){r=n.getDateTimeInstance({format:"QQQ"})}if(t==="YearWeek"||t==="Week"){r=n.getDateTimeInstance({format:"www"})}e=r.format(i.getInstance(e),true)}return e}return{registerCustomFormatters:function(){var t=e.getInstance();var a=[];s.forEach(function(t){a.push({name:t.prefix,fn:t.fn.bind(null,2)});for(var e=-1;e<=o;e++){var r="/"+e+"/";a.push({name:t.prefix+r,fn:t.fn.bind(null,e)})}});c.forEach(function(t){a.push({name:t,fn:g.bind(null,t)})});a.forEach(function(e){t.registerCustomFormatter(e.name,e.fn)});r.numericFormatter(t)}}});
/*!
 * 
		SAP UI development toolkit for HTML5 (SAPUI5)
		(c) Copyright 2009-2015 SAP SE. All rights reserved
	
 */
sap.ui.predefine("sap/insights/base/CacheData", ["sap/ui/base/Object"],function(e){"use strict";var t={};var r={};var n=e.extend("sap.insights.base.CacheData",{});function i(e,t,r,n){if(!t){return new Error("Please provide valid card ID.")}if(e[t]&&r){e[t][r]=n}else{e[t]=n}return e[t]}n.prototype.getCacheResponse=function(e){if(e){return t[e]}return t};n.prototype.setCacheResponse=function(e,r,n){return i(t,e,r,n)};n.prototype.getTempPromise=function(e){if(e){return r[e]}return r};n.prototype.setTempPromise=function(e,t,n){return i(r,e,t,n)};n.prototype.clearCache=function(e){if(e){t[e]=r[e]={}}else{t=r={}}};var o;return{getInstance:function(){if(!o){o=new n}return o}}});
/*!
 * 
		SAP UI development toolkit for HTML5 (SAPUI5)
		(c) Copyright 2009-2015 SAP SE. All rights reserved
	
 * This extension is for OVP Analytical cards delivered in 2208.
 */
sap.ui.predefine("sap/insights/base/InMemoryCachingHost", ["sap/ui/integration/Host","sap/insights/base/CacheData"],function(e,t){"use strict";var s=t.getInstance();var n="refreshTime";return e.extend("sap.insights.InMemoryCachingHost",{_fetchData:function(t,a,i,r){var c=r.getManifestEntry("sap.app").id;return e.prototype.fetch.call(this,t,a,i).then(function(e){s.setCacheResponse(c,t,e);s.setCacheResponse(c,n,new Date);var a=s.getCacheResponse(c);const i={"/sap.card/header/dataTimestamp":a[n]};if(r.getManifestEntry("sap.card").type==="List"){i["/sap.card/content/item/actionsStrip"]=r.getManifestEntry("sap.card").content.item.actionsStrip||[]}r.setManifestChanges([i]);return a[t]}).catch(function(e){var a={error:e.toString()};var i=new Response(JSON.stringify(a),{headers:{"Content-Type":"application/json"}});s.setCacheResponse(c,t,i);s.setCacheResponse(c,n,new Date);var r=s.getCacheResponse(c);return r[t]})},_isCSRFFetchCall:function(e){return e.method==="HEAD"},fetch:function(t,n,a,i){var r=i.getManifestEntry("sap.app").id;var c=s.getCacheResponse(r);var p=s.getTempPromise(r);if(!c){c=s.setCacheResponse(r,null,{})}if(!p){p=s.setTempPromise(r,null,{})}if(this._isCSRFFetchCall(a)){return e.prototype.fetch.call(this,t,n,a)}else if(!c[t]&&!p[t]){p=s.setTempPromise(r,t,this._fetchData(t,n,a,i));return p[t]}else if(!c[t]&&p[t]){return p[t]}else{return new Promise(function(e){if(i.getManifestChanges()&&!i.getManifestChanges().length){const e={"/sap.card/header/dataTimestamp":c["refreshTime"]};if(i.getManifestEntry("sap.card").type==="List"){e["/sap.card/content/item/actionsStrip"]=i.getManifestEntry("sap.card").content.item.actionsStrip||[]}i.setManifestChanges([e])}e(c[t])})}}})});
/*!
 * 
		SAP UI development toolkit for HTML5 (SAPUI5)
		(c) Copyright 2009-2015 SAP SE. All rights reserved
	
 * POC
 */
sap.ui.predefine("sap/insights/channels/ContextChannel", ["sap/ui/base/Object"],function(n){"use strict";var e=n.extend("sap.insights.channels.ContextChannel",{constructor:function(){this.providers=[]},init:function(){return new Promise(function(n,e){const t=sap.ui.require("sap/ushell/Container");if(t){t.getServiceAsync("MessageBroker").then(function(e){this.broker=e;n(this)}.bind(this))}else{e("S/CUBE is not yet supported")}}.bind(this))},registerProvider:function(n){this.providers.push(n)},unregisterProvider:function(n){const e=this.providers.indexOf(n);this.providers.splice(e,1)},getContext:function(){if(this.providers.length>0){const n=this.providers[this.providers.length-1].getContext();return n.then(function(n){return this.withAppInfo(n)}.bind(this))}else{return this.withAppInfo({})}},withAppInfo:function(n){return this.getAppInfo().then(function(e){if(e&&n){n["nw.core.flp.shell"]={appInfo:e}}return n}).catch(function(){return n})},getAppInfo:function(){return new Promise(function(n){const e=sap.ui.require("sap/ushell/Container");if(e){e.getServiceAsync("AppLifeCycle").then(function(n){if(n&&n.getCurrentApplication){return n.getCurrentApplication().getAllAppInfo()}return undefined}).then(function(e){n(e)}).catch(function(){n()})}else{n()}})}});var t;return{getInstance:function(){if(!t){t=new e;return t.init()}else{return Promise.resolve(t)}}}});
/*!
 * 
		SAP UI development toolkit for HTML5 (SAPUI5)
		(c) Copyright 2009-2015 SAP SE. All rights reserved
	
 */
sap.ui.predefine("sap/insights/library", ["sap/ui/core/Lib","sap/f/library","sap/m/library","sap/ui/core/library"],function(s){"use strict";var e=s.init({apiVersion:2,name:"sap.insights",dependencies:["sap.m","sap.f","sap.ui.core"],types:[],interfaces:[],controls:["sap.insights.ManageCards"],elements:[],version:"1.141.0",extensions:{}});return e});
/*!
 * 
		SAP UI development toolkit for HTML5 (SAPUI5)
		(c) Copyright 2009-2015 SAP SE. All rights reserved
	
 */
sap.ui.predefine("sap/insights/manageCardPreview/ColumnListPreview", ["sap/ui/core/Control","sap/ui/core/Core","sap/m/Label","sap/m/Title","sap/m/Text","sap/m/VBox","sap/m/Page","sap/m/FlexBox","sap/m/ScrollContainer","sap/m/Toolbar","sap/m/OverflowToolbar","sap/m/ToolbarSpacer","sap/m/HBox","sap/ui/integration/widgets/Card","sap/m/Panel","sap/m/Button","../utils/CardPreviewManager","../utils/DeviceType","sap/ui/Device","sap/m/Table","sap/m/SearchField","sap/m/Column","sap/ui/core/dnd/DragInfo","sap/ui/core/dnd/DropInfo","sap/ui/core/Icon","sap/m/ColumnListItem","sap/m/CheckBox","sap/m/ObjectIdentifier","sap/m/SegmentedButton","sap/m/SegmentedButtonItem","../utils/Transformations","sap/ui/model/Filter","sap/ui/model/FilterOperator","sap/ui/model/json/JSONModel","../utils/AppConstants","sap/ui/core/Element","../utils/InsightsUtils"],function(e,t,i,s,o,n,a,r,l,d,h,C,u,g,m,p,c,f,w,v,b,P,I,S,T,B,x,y,D,_,V,E,L,O,M,A,F){var k=e.extend("sap.insights.manageCardPreview.ColumnListPreview",{metadata:{properties:{manifest:{type:"string",group:"Behavior",defaultValue:""},dialogTitle:{type:"string",defaultValue:""}},aggregations:{_page:{type:"sap.m.Page",multiple:false,visibility:"hidden"}},events:{enableAddButton:{parameters:{enableButton:{type:"boolean"}}}}},renderer:{apiVersion:2,render:function(e,t){e.openStart("div",t);e.style("height","100%");e.style("width","100%");e.openEnd();e.renderControl(t.getAggregation("_page"));e.close("div")}}});k.prototype.init=function(){this.i18Bundle=F.getResourceBundle();this._innerModel=new O;this._iDroppedIndex=null;this._selectDefaultColumns=true;this.setModel(this._innerModel);w.resize.attachHandler(this._adjustLayoutStyles.bind(this));this.oCardColumnPageHeader=new h(this.getId()+"--insightCardColumnPage-header",{});this.oCardColumnPageTitle=new s(this.getId()+"--insightCardPreviewTitle",{text:this.i18Bundle.getText("INT_PREVIEW_POPOVER_BUTTON_TITLE"),level:"H1"});this.oCardColumnPage=new a(this.getId()+"--insightCardColumnPage",{showSubHeader:true,backgroundDesign:"List",enableScrolling:false,headerContent:[],content:[],customHeader:[this.oCardColumnPageHeader]});this.setAggregation("_page",this.oCardColumnPage);this.createStaticControls();this.oCardColumnPageHeader.addContent(this.oCardColumnPageTitle);this.oCardColumnPageHeader.addContent(new C(this.getId()+"--insightCardColumnPage-headerSpacer"));this.oCardColumnPageHeader.addContent(this.oCardPreviewBtn);this.oCardColumnPageHeader.addContent(this.oHideCardPreviewBtn);this.oCardColumnPage.addContent(this.oFlexContainerColumnContent)};k.prototype.onBeforeRendering=function(){this.oManifest=this.getManifest();if(this.oManifest){this.oManifest=JSON.parse(this.oManifest)}this._initConfigureCard(this.oManifest);if(this._selectDefaultColumns){const e=V.getDefaultColumns(this.oConfCard);if(e.length){this.oConfCard=V.selectColumnsForListCard(this.oConfCard,e);this.iVisibleColumnCount=e.length;this._innerModel.setProperty("/visibleColumnCount",this.iVisibleColumnCount);const t=this._findIdentifierTitle(this.cardColumn);this.oConfCard["sap.card"].content.item.attributes=t;this._selectDefaultColumns=false}}this._adjustLayoutStyles();this.oInsightsColCardLayer.setVisible(this.oManifest["sap.card"].type==="Analytical"?false:true);this.oInsightsColCardLayerSD.setVisible(this.oManifest["sap.card"].type==="Analytical"?false:true)};k.prototype.createStaticControls=function(){this.oCardPreviewBtn=new p(this.getId()+"--cardPreviewId",{text:this.i18Bundle.getText("INT_DIALOG_CardPreview"),press:this._callPreview.bind(this),enabled:true});this.oHideCardPreviewBtn=new p(this.getId()+"--hideCardPreviewId",{text:this.i18Bundle.getText("INT_DIALOG_HidePreview"),press:this._callClosePreview.bind(this),enabled:true});this.oDefaultTitle=new s(this.getId()+"--defaultTitle",{text:this.i18Bundle.getText("INT_COLUMN_TITLE"),level:"H4"});this.oDefaultSubText=new o(this.getId()+"--defaultSubText",{text:this.i18Bundle.getText("INT_COLUMN_SUBTITLE")});this.oInsightsColumnEditVBox=new n(this.getId()+"--insightsColumnEditVBox",{direction:"Column",items:[this.oDefaultTitle,this.oDefaultSubText]}).addStyleClass("sapUiSmallMarginBegin sapUiSmallMarginTop sapUiTinyMarginBottom");this.oColumnSearch=new b(this.getId()+"--columnSearch",{placeholder:this.i18Bundle.getText("INT_COL_SEARCH"),liveChange:this._onColumnSearch.bind(this),ariaLabelledBy:[this.getId()+"--defaultTitle",this.getId()+"--defaultSubText"]}).addStyleClass("sapUiTinyMarginBottom");this.oColumnSearchVBox=new n(this.getId()+"--columnSearchVBox",{renderType:"Bare",items:[this.oColumnSearch]});this.oEditColumnsTableCheckBox=new P(this.getId()+"--editColumnsTableCheckBox",{hAlign:"Center"});this.oEditColumnsName=new P(this.getId()+"--editColumnsName",{});this.oColumnDrag=new I(this.getId()+"--idColumnDrag",{groupName:"editColumns",sourceAggregation:"items",enabled:false});this.oColumnDrop=new S(this.getId()+"--idColumnDrop",{groupName:"editColumns",targetAggregation:"items",dropPosition:"On",drop:this._onColumnDrop.bind(this),enabled:false});this.oInsightsCardsEditColumnsListTable=new v(this.getId()+"--insightsCardsEditColumnsListTable",{fixedLayout:"true",columns:[this.oEditColumnsTableCheckBox,this.oEditColumnsName],dragDropConfig:[this.oColumnDrag,this.oColumnDrop],updateFinished:function(){if(this._iDroppedIndex&&this._iDroppedIndex>=0){this.oInsightsCardsEditColumnsListTable.getItems()[this._iDroppedIndex].focus()}}.bind(this)}).addStyleClass("sapContrastPlus");this.oInsightsCardsEditColumnsListTable.attachEvent("updateFinished",()=>{this.oInsightsCardsEditColumnsListTable.getItems().forEach(e=>{e.getCells()[0].getItems()[1].setEnabled(false)})});this.oInsightsCardsEditColumnsListTable.attachBrowserEvent("keydown",this._attachDndHandler.bind(this,this.oInsightsCardsEditColumnsListTable,this._onColumnDrop.bind(this)));this.oEditColumnsScrollContainer=new l(this.getId()+"--idEditColumnsScrollContainer",{vertical:true,horizontal:false,height:"90%",width:"100%",content:[this.oInsightsCardsEditColumnsListTable]});this.oInsightsColumnEditFlexBox=new r(this.getId()+"--insightsColumnEditFlexBox",{height:"92%",width:"95%",direction:"Column",renderType:"Bare",items:[this.oColumnSearchVBox,this.oEditColumnsScrollContainer]}).addStyleClass("sapUiSmallMarginBegin sapUiSmallMarginEnd");this.oLabelColLayout=new i(this.getId()+"--labelColLayout",{text:this.i18Bundle.getText("INT_COL_LAYOUT")});this.oListViewSD=new _(this.getId()+"--idListViewSD",{icon:"sap-icon://list",key:"List"});this.oTableViewSD=new _(this.getId()+"--idTableViewSD",{icon:"sap-icon://table-view",key:"Table"});this.oSdColumnSegButton=new D(this.getId()+"--sdColumnSegButton",{width:"3.75rem",selectionChange:this._onSegmentedSelectionChange.bind(this),tooltip:this.i18Bundle.getText("INT_LAYOUT_TOOLTIP"),items:[this.oListViewSD,this.oTableViewSD]});this.oPreviewVBoxSD=new n(this.getId()+"--previewVBoxSD",{direction:"Column",height:"4rem",backgroundDesign:"Solid",items:[this.oLabelColLayout,this.oSdColumnSegButton]}).addStyleClass("sapUiSmallMarginBegin sapUiTinyMarginTop");this.oPreviewColCardSD=new g(this.getId()+"--previewColCardSD",{manifestApplied:this._setPreviewCardAriaText.bind(this,this.i18Bundle.getText("INT_DIALOG_TITLE_CardPreview")),width:"19rem",height:"32rem"}).addStyleClass("sapUiTinyMarginBeginEnd sapUiTinyMarginTopBottom");this.oInsightsColOverflowInnerHBoxSD=new u(this.getId()+"--insightsColOverflowInnerHBoxSD",{}).addStyleClass("insightsCardOverflowLayer insightsPreviewCardOverLay insightsColOverLayPositionSD");this.oInsightsColCardLayerSD=new u(this.getId()+"--insightsColCardLayerSD",{height:"0",items:[this.oInsightsColOverflowInnerHBoxSD]}).addStyleClass("sapMFlexBoxJustifyCenter");this.oColCardsScrollSD=new l(this.getId()+"--colCardsScrollSD",{vertical:true,horizontal:false,height:"100%",content:[this.oPreviewColCardSD,this.oInsightsColCardLayerSD]});this.oPreviewColCardVBox=new n(this.getId()+"--previewColCardVBox",{width:"100%",height:"calc(100% - 4rem)",alignItems:"Center",backgroundDesign:"Solid",justifyContent:"SpaceAround",items:[this.oColCardsScrollSD]});this.oPreviewColCardFlex=new r(this.getId()+"--previewColCardFlex",{direction:"Column",height:"100%",width:"100%",items:[this.oPreviewVBoxSD,this.oPreviewColCardVBox]});this.oEditColumnInsightsCardsFlex=new r(this.getId()+"--editColumnInsightsCardsFlex",{height:"100%",width:"62%",direction:"Column",items:[this.oInsightsColumnEditVBox,this.oInsightsColumnEditFlexBox,this.oPreviewColCardFlex]});this.oInsightPreviewText=new s(this.getId()+"--insightPreviewText",{text:this.i18Bundle.getText("INT_DIALOG_TITLE_CardPreview"),textAlign:"Left"}).addStyleClass("sapUiTinyMarginTop sapUiSmallMarginEnd");this.oListViewLD=new _(this.getId()+"--idListViewLD",{icon:"sap-icon://list",key:"List"});this.oTableViewLD=new _(this.getId()+"--idTableViewLD",{icon:"sap-icon://table-view",key:"Table"});this.oColumnSegButton=new D(this.getId()+"--columnSegButton",{width:"3.75rem",selectionChange:this._onSegmentedSelectionChange.bind(this),tooltip:this.i18Bundle.getText("INT_LAYOUT_TOOLTIP"),items:[this.oListViewLD,this.oTableViewLD],ariaLabelledBy:[this.getId()+"--insightPreviewText",this.getId()+"--columnSegButton"]});this.oPreviewTextHBox=new u(this.getId()+"--idPreviewTextHBox",{width:"100%",justifyContent:"Start",backgroundDesign:"Transparent",renderType:"Bare",items:[this.oInsightPreviewText,this.oColumnSegButton]});this.oPreviewPanelToolBar=new d(this.getId()+"--previewPanelToolBar",{style:"Clear",design:"Auto",content:[this.oPreviewTextHBox]}).addStyleClass("sapThemeBaseBG");this.oPreviewCard=new g(this.getId()+"--previewCard",{manifestApplied:this._setPreviewCardAriaText.bind(this,this.i18Bundle.getText("INT_DIALOG_TITLE_CardPreview")),stateChanged:this._onCardRender.bind(this),width:"19rem",height:"35rem"}).addStyleClass("sapMFlexBoxJustifyCenter");this.oInsightsColOverflowInnerHBox=new u(this.getId()+"--insightsColOverflowInnerHBox",{}).addStyleClass("insightsCardOverflowLayer insightsPreviewCardOverLay insightsColOverLayPositionLS");this.oInsightsColCardLayer=new u(this.getId()+"--insightsColCardLayer",{height:"0",items:[this.oInsightsColOverflowInnerHBox]}).addStyleClass("insightsCardOverflowLayer insightsPreviewCardOverLay");this.oCardsPreviewVBox=new n(this.getId()+"--idCardsPreviewVBox",{height:"100%",alignItems:"Center",backgroundDesign:"Transparent",justifyContent:"SpaceAround",items:[this.oPreviewCard,this.oInsightsColCardLayer]});this.oPreviewPanelContainer=new m(this.getId()+"--previewPanelContainer",{expanded:false,height:"100%",backgroundDesign:"Transparent",headerToolbar:[this.oPreviewPanelToolBar],content:[this.oCardsPreviewVBox]});this.oColCardsScroll=new l(this.getId()+"--colCardsScroll",{vertical:true,horizontal:false,height:"100%",content:[this.oPreviewPanelContainer]});this.oColumnPreviewCardFlexbox=new r(this.getId()+"--columnPreviewCardFlexbox",{direction:"Column",width:"38%",height:"100%",renderType:"Bare",items:[this.oColCardsScroll]}).addStyleClass("sapMPageBgStandard");this.oFlexContainerColumnContent=new n(this.getId()+"--flexContainerColumnContent",{height:"100%",width:"100%",direction:"Row",justifyContent:"SpaceBetween",items:[this.oEditColumnInsightsCardsFlex,this.oColumnPreviewCardFlexbox]})};k.prototype._onCardRender=function(){this.oInsightsCardsEditColumnsListTable.getItems().forEach(e=>{e.getCells()[0].getItems()[1].setEnabled(true)});this.oColumnDrag.setEnabled(true);this.oColumnDrop.setEnabled(true)};k.prototype.resetSelectCountData=function(){this._selectDefaultColumns=true;this.iVisibleColumnCount=0;this._innerModel.setProperty("/visibleColumnCount",this.iVisibleColumnCount)};k.prototype._setPreviewCardAriaText=function(e,t){var i=t.getSource()._ariaText.getText();var s=this.i18Bundle.getText(e);t.getSource()._ariaText.setText(s+i)};k.prototype._callPreview=function(){var e,t;t=f.getDialogBasedDevice()!==M.DEVICE_TYPES.Desktop;if(t){this.bShowPreview=true;this.oCardPreviewBtn.setVisible(false);this.oHideCardPreviewBtn.setVisible(true);this.oPreviewColCardVBox.setVisible(true);this.oPreviewColCardFlex.setVisible(true);this.oInsightsColumnEditFlexBox.setVisible(false);this.oColumnPreviewCardFlexbox.setVisible(false);this.oInsightsColumnEditVBox.setVisible(false);e=t?this.oPreviewColCardSD:this.oPreviewCard}if(e){e.refresh()}};k.prototype._callClosePreview=function(){this.bShowPreview=false;this.oHideCardPreviewBtn.setVisible(false);this.oCardPreviewBtn.setVisible(true);this.oPreviewColCardFlex.setVisible(false);this.oInsightsColumnEditFlexBox.setVisible(true);this.oColumnPreviewCardFlexbox.setVisible(false);this.oInsightsColumnEditVBox.setVisible(true)};k.prototype._onColumnSearch=function(e){var t="";if(e){t=e.getSource().getValue()}var i=new E("title",L.Contains,t);var s=[];s.push(i);var o=this.oInsightsCardsEditColumnsListTable;var n=o.getBinding("items");n.filter(s,"Application")};k.prototype._refreshShowPreview=function(){this.bShowPreview=true;var e=f.getDialogBasedDevice()===M.DEVICE_TYPES.Desktop;var t=e?this.oPreviewCard:this.oPreviewColCardSD;if(t){t.refresh()}};k.prototype._onColumnDrop=function(e){var t=e.getParameter?e.getParameter("dropPosition"):e.dropPosition,i=e.getParameter?e.getParameter("draggedControl"):e.draggedControl,s=e.getParameter?e.getParameter("droppedControl"):e.droppedControl,o=i.getBindingContextPath().split("/"),n=Number(o[2]),a=s.getBindingContextPath().split("/"),r=Number(a[2]),l=this.cardColumn;if(t==="Before"&&n===r-1){r--}else if(t==="After"&&n===r+1){r++}if(n!==r){if(t==="Before"&&n<r){r--}else if(t==="After"&&n>r){r++}var d=l.splice(n,1)[0];l.splice(r,0,d);this.cardColumn=l;this._innerModel.setProperty("/cardColumn",this.cardColumn);var h=this.cardColumn.filter(function(e){return!e.identifier});if(this.oConfCard["sap.card"]&&this.oConfCard["sap.card"].content&&this.oConfCard["sap.card"].content.item){this.oConfCard["sap.card"].content.item.attributes=h}var C=f.getDialogBasedDevice()===M.DEVICE_TYPES.Desktop;var u=C?this.oPreviewCard:this.oPreviewColCardSD;if(u){u.setManifest(this.oConfCard)}if(f.getDialogBasedDevice()===M.DEVICE_TYPES.Desktop){this._refreshShowPreview()}}};k.prototype._handleColumnVisibilityToggle=function(e){var t=e.getSource();this.sColumnPath=t.getBindingContext().getPath();var i=this._innerModel.getProperty(this.sColumnPath);var s=t.getSelected();i["visible"]=s;var o=this.iVisibleColumnCount;this.iVisibleColumnCount=s?o+1:o-1;if(this.oConfCard["sap.card"].content.row){this.oConfCard["sap.card"].content.row.columns=this.cardColumn}else{var n=this._findIdentifierTitle(this.cardColumn);if(i.identifier&&this.oConfCard["sap.card"].content&&this.oConfCard["sap.card"].content.item){if(s){this.oConfCard["sap.card"].content.item.title=this._oListTitle}else{delete this.oConfCard["sap.card"].content.item.title}}this.oConfCard["sap.card"].content.item.attributes=n}this._innerModel.setProperty("/visibleColumnCount",this.iVisibleColumnCount);if(this.iVisibleColumnCount>0){this.fireEnableAddButton({enableButton:true})}else{this.fireEnableAddButton({enableButton:false})}if(f.getDialogBasedDevice()===M.DEVICE_TYPES.Desktop){this.oPreviewCard.setPreviewMode(this.iVisibleColumnCount>0?"Off":"Abstract");this._refreshShowPreview()}else{this.oPreviewColCardSD.setPreviewMode(this.iVisibleColumnCount>0?"Off":"Abstract")}};k.prototype._onSegmentedSelectionChange=function(){var e=f.getDialogBasedDevice()===M.DEVICE_TYPES.Desktop?this.oColumnSegButton:this.oSdColumnSegButton,t=e.getSelectedKey();if(t==="Table"){if(this.oConfCard["sap.card"].content&&this.oConfCard["sap.card"].content.item&&this._oListTitle){if(this.oConfCard["sap.card"].content.item.title){delete this.oConfCard["sap.card"].content.item.title}this.oConfCard["sap.card"].content.item.attributes=this.cardColumn}var i=V.createListOptions(this.oConfCard);var s=i.filter(function(e){if(e){return e["sap.card"].type==="Table"}});if(s.length){this.oConfCard=s[0];var o=s[0]["sap.card"].content.row.columns;this.cardColumn=o}}else if(t==="List"){var n=V.createTableOptions(this.oConfCard);var a=n.filter(function(e){if(e){return e["sap.card"].type==="List"}});if(a.length){this.oConfCard=a[0];this.cardColumn=a[0]["sap.card"].content.item.attributes}var r=this._findIdentifierTitle(this.cardColumn);if(this.oConfCard["sap.card"].content&&this.oConfCard["sap.card"].content.item){this.oConfCard["sap.card"].content.item.attributes=r;this.oConfCard["sap.card"].content.item.title=this._oListTitle&&this._oListTitle.visible?this._oListTitle:null}}this._innerModel.setProperty("/cardColumn",this.cardColumn);var l=f.getDialogBasedDevice()===M.DEVICE_TYPES.Desktop;var d=l?this.oPreviewCard:this.oPreviewColCardSD;if(d){d.setManifest(this.oConfCard)}};k.prototype._setCardColumnValue=function(e){var t=e["sap.card"];if(t.type==="Table"){var i;i=t.content.row.columns;this.cardColumn=i;var s=i.map(function(e){e["visible"]=e["visible"]?e["visible"]:false;return e}).filter(function(e){return e.visible});this.iVisibleColumnCount=s.length;this._innerModel.setProperty("/visibleColumnCount",this.iVisibleColumnCount);var o=V.createTableOptions(this.oConfCard);var n=o.filter(function(e){return e["sap.card"].type==="List"});if(n.length){this.oConfCard=n[0];var a=n[0]["sap.card"].content.item.attributes;this.cardColumn=a}this._innerModel.setProperty("/cardColumn",this.cardColumn);this.oInsightsCardsEditColumnsListTable.bindAggregation("items",{path:"/cardColumn",factory:this._generateTableColumnsTemplate.bind(this)})}};k.prototype._generateTableColumnsTemplate=function(){var e=new B({});var t=new y({title:"{title}",tooltip:"{title}"}).addStyleClass("sapUiNoPadding");var i=new u({items:[new T({src:"sap-icon://BusinessSuiteInAppSymbols/icon-grip"}).addStyleClass("compositeDndIcon"),new x({selected:"{= ${visible} ? true : false}",enabled:"{= !(!${visible} && (${/visibleColumnCount} > 2)) ? true : false}",select:this._handleColumnVisibilityToggle.bind(this),ariaLabelledBy:[t.getId()]})]}).addStyleClass("sapUiNoPadding");e.addCell(i);e.addCell(t);return e};k.prototype._adjustLayoutStyles=function(){if(f.getDialogBasedDevice()!==M.DEVICE_TYPES.Desktop){this.bDesktop=false;if(this.bShowPreview===true){this.oCardPreviewBtn.setVisible(false);this.oHideCardPreviewBtn.setVisible(true);this.oPreviewColCardFlex.setVisible(true);this.oInsightsColumnEditFlexBox.setVisible(false);this.oInsightsColumnEditVBox.setVisible(false)}else{this.oCardPreviewBtn.setVisible(true);this.oHideCardPreviewBtn.setVisible(false);this.oPreviewColCardFlex.setVisible(false);this.oInsightsColumnEditFlexBox.setVisible(true);this.oInsightsColumnEditVBox.setVisible(true);this.oEditColumnInsightsCardsFlex.setWidth("100%")}this.oColumnPreviewCardFlexbox.setVisible(false);this.oPreviewColCardSD.setManifest(this.oConfCard);this.oColumnSearch.setWidth("90%");this.oEditColumnsTableCheckBox.setWidth("20%");this.oEditColumnsName.setWidth("80%");this.oSdColumnSegButton.setSelectedKey(this.oConfCard["sap.card"].type);this.oPreviewColCardSD.refresh()}else{this.bDesktop=true;this.oColumnSearch.setWidth("100%");this.oEditColumnsTableCheckBox.setWidth("10%");this.oEditColumnsName.setWidth("90%");this.oPreviewCard.setManifest(this.oConfCard);this.oColumnSegButton.setSelectedKey(this.oConfCard["sap.card"].type);this.oCardPreviewBtn.setVisible(false);this.oHideCardPreviewBtn.setVisible(false);this.oPreviewColCardFlex.setVisible(false);this.oInsightsColumnEditVBox.setVisible(true);this.oInsightsColumnEditFlexBox.setVisible(true);this.oColumnPreviewCardFlexbox.setVisible(true);this.oPreviewCard.refresh()}var e=!this.bDesktop&&this.bShowPreview;this.oPreviewColCardVBox.setVisible(e?true:false);this.oPreviewColCardFlex.setVisible(e?true:false);this.oCardColumnPage.setTitle(this.getDialogTitle())};k.prototype._initConfigureCard=function(e){var t=e,i;var s=A.getElementById("myhomeSettingsView--INSIGHTS_CARDS");this.oOrgCard=t;i=JSON.parse(JSON.stringify(t));i=c.getCardPreviewManifest(i);this.oConfCard=i;this.iVisibleColumnCount=this.iVisibleColumnCount?this.iVisibleColumnCount:0;if(i){var o=i["sap.card"];if(o.type==="Table"){var n=f.getDialogBasedDevice()===M.DEVICE_TYPES.Desktop?this.oColumnSegButton:this.oSdColumnSegButton;n.setSelectedKey(this.oManifest["sap.card"].type);this._setCardColumnValue(i,s)}}};k.prototype._attachDndHandler=function(e,i,s){var o=s.metaKey||s.ctrlKey;if(o&&(s.key==="ArrowUp"||s.key==="ArrowDown")){s.preventDefault();var n=s.key==="ArrowUp"?"Before":"After";var a=e.getItems();var r=t.getCurrentFocusedControlId();var l=a.findIndex(e=>e.getId()===r);if(l>=0&&l<a.length){var d=s.key==="ArrowDown"?l+1:l-1;if(d>=0&&d<a.length){var h=a[l];var C=a[d];var s={draggedControl:h,droppedControl:C,dropPosition:n};this._iDroppedIndex=d;i(s)}a.forEach(function(e,t){e.tabIndex=t===d?0:-1})}}};k.prototype._findIdentifierTitle=function(e){var t=[];t=e.filter(e=>{if(e.identifier){this._oListTitle=e}return!e.identifier});return t};return k});
/*!
 * 
		SAP UI development toolkit for HTML5 (SAPUI5)
		(c) Copyright 2009-2015 SAP SE. All rights reserved
	
 */
sap.ui.predefine("sap/insights/manageCardPreview/HouseOfCards", ["sap/ui/core/Control","sap/ui/core/Item","sap/ui/core/Icon","sap/m/Title","sap/m/Text","sap/m/VBox","sap/m/Page","sap/m/FlexBox","sap/m/ComboBox","sap/m/ScrollContainer","sap/m/Toolbar","sap/m/OverflowToolbar","sap/m/ToolbarSpacer","sap/m/HBox","sap/m/Panel","sap/m/Button","sap/m/Table","sap/m/Column","sap/m/ColumnListItem","sap/m/ObjectIdentifier","sap/m/SearchField","sap/ui/Device","sap/ui/integration/widgets/Card","sap/ui/model/Filter","sap/ui/model/FilterOperator","sap/ui/model/json/JSONModel","sap/ui/model/resource/ResourceModel","../utils/CardPreviewManager","../utils/DeviceType","../utils/AppConstants","../utils/Transformations","../utils/InsightsUtils"],function(e,t,i,o,r,a,s,n,h,l,d,c,C,p,g,_,f,u,y,v,w,T,P,m,S,H,b,x,M,B,I,D){var V=e.extend("sap.insights.manageCardPreview.HouseOfCards",{metadata:{properties:{manifest:{type:"string",group:"Behavior",defaultValue:""},dialogTitle:{type:"string",defaultValue:""}},aggregations:{_page:{type:"sap.m.Page",multiple:false,visibility:"hidden"}}},renderer:{apiVersion:2,render:function(e,t){e.openStart("div",t);e.style("height","100%");e.style("width","100%");e.openEnd();e.renderControl(t.getAggregation("_page"));e.close("div")}}});V.prototype.init=function(){this.i18Bundle=D.getResourceBundle();this._innerHocModel=new H;if(this._bDesktop){this._bShowPreview=true}else{this._bShowPreview=false}this._createHocFlex();T.resize.attachHandler(this._adjustLayoutStyles.bind(this));this.oCardColumnPageTitle=new o(this.getId()+"--insightHouseOfCardTitle",{text:this.i18Bundle.getText("INT_PREVIEW_POPOVER_BUTTON_TITLE"),level:"H1"});this._oPreviewButton=new _({text:this.i18Bundle.getText("INT_DIALOG_CardPreview"),press:this._callPreview.bind(this)});this._oHidePreviewButton=new _({text:this.i18Bundle.getText("INT_DIALOG_HidePreview"),press:this._callClosePreview.bind(this)});this.oHOCPageHeader=new c(this.getId()+"--insightHouseOfCard-header",{content:[this.oCardColumnPageTitle,new C(this.getId()+"--insightHouseOfCard-headerSpacer"),this._oPreviewButton,this._oHidePreviewButton]});var e=M.getDialogBasedDevice();this._bDesktop=e===B.DEVICE_TYPES.Desktop;this.oParentPage=new s(this.getId()+"--insightHouseOfCardPage",{showSubHeader:true,backgroundDesign:"List",enableScrolling:false,content:[new a(this.getId()+"--hocbox1",{height:"100%",width:"100%",direction:"Row",justifyContent:"SpaceBetween",items:[this._oHocflexbox1,this._oHocflexbox2]})],customHeader:[this.oHOCPageHeader]});this._innerHocModel.setData({oSelected:{},aCards:[],aPreviewCards:[1,2,3],aAllowedChartTypes:[],sOriginalChartType:"",selectedPath:""});this.oConfCard=null;this.oParentPage.setModel(this._innerHocModel,"hocModel");this.setAggregation("_page",this.oParentPage)};V.prototype.onBeforeRendering=function(){this._oManifest=this.getManifest();if(this._oManifest){this._oManifest=JSON.parse(this._oManifest)}this.oConfCard=this._oManifest;this._innerHocModel.setProperty("/oSelected",this._oManifest);this._oHocChartCombo.bindAggregation("items",{path:"hocModel>/aPreviewCards",template:new t({key:"{hocModel>sap.card/content/chartType}",text:{parts:[{path:"hocModel>sap.card/content/chartType"},{value:"title"}],formatter:this._setChartDetail}})});this._oCardsTypeTable.bindAggregation("items",{path:"hocModel>/aPreviewCards",template:new y({type:"Active",selected:"{= ${hocModel>sap.card/content/chartType} ===   ${hocModel>/oSelected/sap.card/content/chartType} ? true : false}",cells:[new p({items:[new i({src:{parts:[{path:"hocModel>sap.card/content/chartType"},{value:"icon"}],formatter:this._setChartDetail}})]}).addStyleClass("sapUiNoPadding"),new v({title:{parts:[{path:"hocModel>sap.card/content/chartType"},{value:"title"}],formatter:this._setChartDetail},tooltip:"{hocModel>sap.card/content/chartType}"}).addStyleClass("sapUiNoPadding")]})});this._oCardContainer.bindAggregation("items",{path:"hocModel>/aPreviewCards",template:new P({width:"17rem",height:"29.5rem",manifest:"{= ${hocModel>}}",host:"HouseOfCardsHost",manifestReady:this._onCardRender.bind(this)}).addStyleClass("sapUiSmallMarginBegin sapUiTinyMarginTopBottom")});this._adjustLayoutStyles()};V.prototype._createHocFlex=function(){this._oCardContainer=new a("CardContainer",{fitContainer:true,alignItems:"Start",justifyContent:"Start",renderType:"Bare",alignContent:"Start",wrap:"Wrap",width:"100%",direction:"Row"});this._oHoCScrollContainer=new l("idHoCScrollContainer",{vertical:true,horizontal:false,height:"100%",width:"100%",content:[this._oCardContainer]});this._oHocChartCombo=new h("hocChartCombo",{ariaLabelledBy:"previewChartInfoTitle previewChartInfoSubTitle hocChartCombo",maxWidth:"33%",selectionChange:this._onSelectionChange.bind(this)}).addStyleClass("sapUiSmallMarginBegin sapUiTinyMarginTopBottom");this._oCardContainerFlex=new n(this.getId()+"--cardContainerFlex",{renderType:"Bare",height:"100%",direction:"Column",items:[new a("chartSelectVBox",{direction:"Column",items:[new o("previewChartInfoTitle",{text:this.i18Bundle.getText("INT_CHART_TITLE"),level:"H4"}).addStyleClass("sapUiSmallMarginTop"),new r("previewChartInfoSubTitle",{text:this.i18Bundle.getText("INT_CHART_SUBTITLE")})]}).addStyleClass("sapUiSmallMarginBegin"),new n("hocflexbox3",{height:"calc(100% - 4rem)",width:"100%",visible:this._bDesktop,direction:"Column",renderType:"Bare",items:[this._oHocChartCombo,this._oHoCScrollContainer]})]});this._oCardsTypeTable=new f("insightsCardsTypeTable",{width:"90%",fixedLayout:true,mode:"SingleSelectMaster",itemPress:this._onChartTypePress.bind(this),columns:[new u("chartIconColumn",{hAlign:"Center",width:"10%"}),new u("chartTypeNameColumn",{width:"90%"})]}).addStyleClass("sapContrastPlus sapUiSmallMarginBeginEnd");this._oChartTypeSearch=new w("chartTypeSearch",{ariaLabelledBy:"previewChartInfoTitle previewChartInfoSubTitle chartTypeSearch",placeholder:this.i18Bundle.getText("INT_CHART_SEARCH"),width:"90%",liveChange:this._onChartTypeSearch.bind(this)}).addStyleClass("sapUiSmallMarginBegin");this._oPreviewPanelCardContainer=new n("previewPanelCardContainer",{height:"100%",width:"100%",direction:"Column",renderType:"Bare",items:[this._oChartTypeSearch,new l("insightsCardsTypeScroll",{vertical:true,horizontal:false,height:"94%",width:"100%",content:[this._oCardsTypeTable]}).addStyleClass("sapUiTinyMarginTop")]});this._oPreviewCardHoCSD=new P("previewCardHoCSD",{manifest:"{hocModel>/oSelected}",width:"19rem",height:"33rem"}).addStyleClass("sapUiTinyMarginBeginEnd");this._oPreviewCardHoCVBox=new a("previewCardHoCVBox",{height:"100%",width:"100%",alignItems:"Center",backgroundDesign:"Solid",items:[this._oPreviewCardHoCSD]}).addStyleClass("sapUiSmallMarginTop sapUiTinyMarginBottom");this._oPanelFlexHoC=new n("panelFlexHoC",{height:"100%",width:"100%",renderType:"Bare",justifyContent:"Center",items:[new l("hoCCardsScrollSD",{vertical:true,horizontal:false,height:"100%",content:[this._oPreviewCardHoCVBox]})]});this._oPanelFlexCard=new n(this.getId()+"--panelFlexCard",{width:"100%",height:"calc(100% - 3rem)",direction:"Column",renderType:"Bare",items:[this._oPreviewPanelCardContainer,this._oPanelFlexHoC]});this._oPreviewCardHoC=new P("previewCardHoC",{manifest:"{ path: 'hocModel>/oSelected', mode: 'TwoWay' }",manifestApplied:this._setPreviewCardAriaText.bind(this),host:"HouseOfCardsHost",width:"19rem",height:"33rem"});var e=new g("hocPreviewPanelContainer",{expanded:false,height:"100%",backgroundDesign:"Transparent",headerToolbar:[new d("hocPreviewToolBar",{width:"100%",height:"2.7rem",style:"Clear",design:"Auto",content:[new p("hocPreviewCardTextHBox",{width:"100%",justifyContent:"Start",backgroundDesign:"Transparent",items:[new o("hocInsightPreviewCardText",{text:this.i18Bundle.getText("INT_DIALOG_TITLE_CardPreview"),textAlign:"Left"}).addStyleClass("sapUiTinyMarginTop")]})]}).addStyleClass("sapThemeBaseBG")],content:[new a("hocCardsPreviewVBox1",{height:"calc(100% - 2.8rem)",alignItems:"Center",backgroundDesign:"Transparent",justifyContent:"SpaceAround",items:[this._oPreviewCardHoC]})]});this._oHocflexbox1=new n(this.getId()+"--hocflexbox1",{height:"100%",width:"100%",direction:"Column",justifyContent:"Center",items:[this._oCardContainerFlex,this._oPanelFlexCard]});this._oHocflexbox2=new n("hocflexbox2",{direction:"Column",width:"38%",height:"100%",renderType:"Bare",fitContainer:true,items:[new l("hoCCardsScroll",{vertical:true,horizontal:false,height:"100%",content:[e]})]}).addStyleClass("sapMPageBgStandard")};V.prototype._onChartTypeSearch=function(e){var t="";if(e){t=e.getSource().getValue()}var i=new m("sap.card/content/chartType",S.Contains,t);var o=[];o.push(i);var r=this._oCardsTypeTable.getBinding("items");if(r){r.filter(o,"Application")}};V.prototype._setChartDetail=function(e,t){var i=B.CHART_TYPE_DETAILS;if(t==="icon"&&e){return i[e]?i[e].icon:i["default"].icon}if(t==="title"&&e){return i[e]?i[e].title:e.replaceAll("_"," ")}};V.prototype._setPreviewCardAriaText=function(e){var t=e.getSource()._ariaText.getText();var i=this.i18Bundle.getText("INT_DIALOG_TITLE_CardPreview");e.getSource()._ariaText.setText(i+t)};V.prototype._onSelectionChange=function(e){var t=e.getParameters();var i=t.selectedItem;var o=i&&i.getBindingContext("hocModel").getPath();this._onClickFunction(null,o)};V.prototype._onCardLoadFailure=function(e){var t=this._oManifest["sap.card"].content.chartType;var i=e.getManifest()["sap.card"].content.chartType;if(i!==t){var o=this._oCardContainer.removeItem(e.sId);if(o){o.destroy()}}};V.prototype._onCardStateChanged=function(e){var t=e.getAggregation("_content")&&e.getAggregation("_content").getAggregation("_content");if(t&&t.attachRenderComplete){t.attachRenderComplete(function(t){var i=t.getSource()._errorType;if(i){var o=this._oCardContainer.removeItem(e.sId);if(o){o.destroy()}}}.bind(this))}var i=e.getManifest()["sap.card"].content.chartType;var o=this._innerHocModel.getProperty("/sOriginalChartType");if(!x.hasVizData(e)&&i!==o){var r=this._innerHocModel.getProperty("/aPreviewCards");var a=r.findIndex(function(e){return e["sap.card"].content.chartType===i});if(a>-1){var s=this._oCardContainer.removeItem(a);if(s){s.destroy()}r.splice(a,1);this._innerHocModel.setProperty("/aPreviewCards",r)}}};V.prototype._callPreview=function(){var e=this._bDesktop?this._oPreviewCardHoC:this._oPreviewCardHoCSD;this._bShowPreview=true;if(e){e.refresh()}this._adjustLayoutStyles()};V.prototype._callClosePreview=function(){this._bShowPreview=false;this._adjustLayoutStyles()};V.prototype._setFocusOnElement=function(){if(this._bDesktop){this._oHocChartCombo.focus()}else{this._oChartTypeSearch.focus()}};V.prototype._onCardRender=function(e){var t=e.getSource();t.attachManifestApplied(function(e){var t=e.getSource();var i=this._oCardContainer.getItems();i.forEach(function(e){if(e.getBindingContext("hocModel")){var i=e.getBindingContext("hocModel").getPath();if(this._innerHocModel.getProperty("/selectedPath")===i&&e.sId===t.sId){e.addStyleClass("sapThemeHighlight-asBorderColor");e.focus()}}}.bind(this));if(t.getCardHeader()){var o=t.getCardHeader();o.addStyleClass("sapFCardHeaderToolbarFocused")}t.attachEvent("_error",this._onCardLoadFailure.bind(this,t));t.attachEvent("stateChanged",this._onCardStateChanged.bind(this,t))}.bind(this));var i=t.getDomRef();i.removeEventListener("click",this._onClickFunction.bind(this,t));i.addEventListener("click",this._onClickFunction.bind(this,t),{capture:true})};V.prototype._onClickFunction=function(e,t){var i;var o=this._oCardContainer.getItems();var r=this._innerHocModel.getProperty("/selectedPath");o.forEach(function(o){if(o.getBindingContext("hocModel")){var a=o.getBindingContext("hocModel").getPath();if(t&&!e&&a===t){e=o}if(a===r&&r!==t){i=o}}});if(this._oCardContainer.getItems()[0].hasStyleClass("sapThemeHighlight-asBorderColor")){this._oCardContainer.getItems()[0].removeStyleClass("sapThemeHighlight-asBorderColor")}else if(i){i.removeStyleClass("sapThemeHighlight-asBorderColor")}if(e){setTimeout(function(){e.addStyleClass("sapThemeHighlight-asBorderColor")},0);this._oHoCScrollContainer.scrollToElement(e);this._oHocChartCombo.focus();var a=e.getBindingContext("hocModel").getPath();this._innerHocModel.setProperty("/selectedPath",a);var s=a.split("/");var n=s[s.length-1];var h=this._innerHocModel.getProperty("/aCards/"+n);this._innerHocModel.setProperty("/oSelected",e.getManifest());if(this.oConfCard){this.oConfCard=h;this._oPreviewCardHoC.refresh()}this._oHocChartCombo.setSelectedKey(e.getManifest()["sap.card"].content.chartType)}};V.prototype._onChartTypePress=function(e){var t=e.getParameter("listItem");if(t.getBindingContext("hocModel")){var i=t.getBindingContext("hocModel").getPath();var o=this._innerHocModel.getProperty(i);var r;var a=this._oCardContainer.getItems();var s=this._innerHocModel.getProperty("/selectedPath");a.forEach(function(e){if(e.getBindingContext("hocModel")){var t=e.getBindingContext("hocModel").getPath();if(t===s&&s!==i){r=e}}});if(r){r.removeStyleClass("sapThemeHighlight-asBorderColor")}this._innerHocModel.setProperty("/oSelected",o);this._innerHocModel.setProperty("/selectedPath",i);var n=i.split("/");var h=n[n.length-1];var l=this._innerHocModel.getProperty("/aCards/"+h);if(this.oConfCard){this.oConfCard=l;this._oPreviewCardHoCSD.refresh()}this._oHocChartCombo.setSelectedKey(o["sap.card"].content.chartType)}};V.prototype.showHouseOfCardsDialog=function(){var e=this.getManifest();if(e){e=JSON.parse(e)}this._oManifest=e;if(this._bDesktop){this._bShowPreview=true}else{this._bShowPreview=false}if(!Object.keys(this._innerHocModel.getProperty("/oSelected")).length){this._innerHocModel.setProperty("/selectedPath","");if(this._oChartTypeSearch){this._oChartTypeSearch.setValue("");this._onChartTypeSearch()}this._createHouseOfCards()}else if(this._innerHocModel.getProperty("/selectedPath")){this._setBorderStyleSelectedCard(this._innerHocModel.getProperty("/selectedPath"))}};V.prototype._setBorderStyleSelectedCard=function(e){var t=this._oCardContainer.getItems();var i;t.forEach(function(t){if(t.getBindingContext("hocModel")){var o=t.getBindingContext("hocModel").getPath();if(e&&!i&&o===e){i=t}}});if(i){setTimeout(function(){i.addStyleClass("sapThemeHighlight-asBorderColor")},0);i.focus()}};V.prototype.getChartTypeSearch=function(){return this._oChartTypeSearch};V.prototype._createHouseOfCards=function(){var e=this._oManifest;var t=e["sap.card"].content.chartType;this._innerHocModel.setProperty("/sOriginalChartType",t);this._innerHocModel.setProperty("/aCards",[]);this._innerHocModel.setProperty("/aPreviewCards",[]);var i=JSON.parse(JSON.stringify(e));var o=i["sap.card"];var r=this._oCardContainer.getMetadata().getDefaultAggregation();var a=[],s=[];var n;this._oCardContainer.removeAllAggregation(r.name);if(o.type==="Analytical"){var h=e["sap.insights"].allowedChartTypes;var l=[];if(h){this._innerHocModel.setProperty("/aAllowedChartTypes",h);l=h.map(function(e){return e.key});var d=l.filter(function(e){return!!e});if(d.length===0){l=h.map(function(e){return e.chart})}}a=I.transformAnalyticalManifest(i,l)}a=a.filter(function(e){return!!e});if(a.length===0){a.push(i)}else{var c=a.findIndex(function(e){return e["sap.card"].content.chartType===t});a.splice(c,1);a.unshift(i)}a.forEach(function(e){var t=JSON.parse(JSON.stringify(e));var i=x.getCardPreviewManifest(t);s.push(i)});this._innerHocModel.setProperty("/aCards",a);this._innerHocModel.setProperty("/aPreviewCards",s);if(!this._innerHocModel.getProperty("/selectedPath")){this._oHoCScrollContainer.scrollTo(0);this._oChartTypeSearch.setValue("");this._onChartTypeSearch()}if(!this._innerHocModel.getProperty("/oSelected")||Object.keys(this._innerHocModel.getProperty("/oSelected")).length===0){this._innerHocModel.setProperty("/oSelected",s[0]);if(this.oConfCard){this.oConfCard=a[0]}this._innerHocModel.setProperty("/selectedPath","/aPreviewCards/0")}else{n=this._innerHocModel.getProperty("/oSelected");n["sap.card"].header.title=this.oConfCard["sap.card"].header.title;n["sap.card"].header.subTitle=this.oConfCard["sap.card"].header.subTitle;this._oPreviewCardHoC.refresh()}n=this._innerHocModel.getProperty("/oSelected");this._oHocChartCombo.setSelectedKey(n["sap.card"].content.chartType)};V.prototype._adjustLayoutStyles=function(){var e=M.getDialogBasedDevice();this._bDesktop=e===B.DEVICE_TYPES.Desktop;if(this._bDesktop){this._oPreviewButton.setVisible(false);this._oHidePreviewButton.setVisible(false);this._oCardContainerFlex.setVisible(true);this._oPanelFlexCard.setVisible(false);this._oPanelFlexHoC.setVisible(false);this._oPreviewPanelCardContainer.setVisible(false);this._oPreviewPanelCardContainer.setVisible(false);this._oHocflexbox1.setWidth(this._bShowPreview?"62%":"100%");this._oPreviewCardHoCVBox.setVisible(false);this._oCardsTypeTable.getColumns()[0].setWidth("10%");this._oCardsTypeTable.getColumns()[1].setWidth("90%");this._oHocflexbox2.setVisible(true);this._oCardContainerFlex.getItems()[1].setVisible(true);this._oHoCScrollContainer.setVisible(true)}else{this._oPreviewButton.setVisible(!this._bShowPreview);this._oHidePreviewButton.setVisible(this._bShowPreview);this._oCardContainerFlex.setVisible(!this._bShowPreview);this._oCardContainerFlex.setHeight(!this._bShowPreview?"4rem":"100%");this._oPanelFlexCard.setVisible(true);this._oPanelFlexHoC.setVisible(true);this._oPreviewPanelCardContainer.setVisible(!this._bShowPreview);this._oPreviewCardHoCVBox.setVisible(this._bShowPreview);this._oHocflexbox1.setWidth("100%");this._oCardsTypeTable.getColumns()[0].setWidth("20%");this._oCardsTypeTable.getColumns()[1].setWidth("80%");this._oHocflexbox2.setVisible(false);this._oCardContainerFlex.getItems()[1].setVisible(false)}this._setFocusOnElement();this.oParentPage.setTitle(this.getDialogTitle())};return V});
/*!
 * 
		SAP UI development toolkit for HTML5 (SAPUI5)
		(c) Copyright 2009-2015 SAP SE. All rights reserved
	
 */
sap.ui.predefine("sap/insights/manageCardPreview/Preview", ["sap/ui/layout/library","sap/ui/core/Control","sap/ui/layout/form/SimpleForm","sap/m/Input","sap/m/Label","sap/m/Title","sap/m/VBox","sap/m/Page","sap/m/FlexBox","sap/m/ScrollContainer","sap/m/Toolbar","sap/m/OverflowToolbar","sap/m/ToolbarSpacer","sap/m/HBox","sap/ui/integration/widgets/Card","sap/m/Panel","sap/m/Button","../utils/DeviceType","../utils/Transformations","sap/ui/Device","sap/m/MessageStrip","../utils/AppConstants","../utils/InsightsUtils"],function(e,t,i,s,a,r,l,o,n,h,d,u,f,g,w,v,p,P,T,C,x,S,D){const{SimpleFormLayout:I}=e.form;var b=t.extend("sap.insights.manageCardPreview.Preview",{metadata:{properties:{manifest:{type:"string",group:"Behavior",defaultValue:""},cardMessageInfo:{type:"object",group:"Appearance",defaultValue:null},transformation:{type:"boolean",group:"Behavior",defaultValue:false},dialogTitle:{type:"string",defaultValue:""}},aggregations:{_page:{type:"sap.m.Page",multiple:false,visibility:"hidden"}},events:{titleCheck:{parameters:{enableButton:{type:"boolean"}}}}},renderer:{apiVersion:2,render:function(e,t){e.openStart("div",t);e.style("height","100%");e.style("width","100%");e.openEnd();e.renderControl(t.getAggregation("_page"));e.close("div")}}});b.prototype.init=function(){this.bInitialPreviewLoad=true;this.i18Bundle=D.getResourceBundle();C.resize.attachHandler(this._adjustLayoutStyles.bind(this));this.oPreviewPageHeader=new u(this.getId()+"--insightCardPreviewPage-header",{});this.oPreviewPageTitle=new r(this.getId()+"--insightCardPreviewTitle",{text:this.i18Bundle.getText("INT_PREVIEW_POPOVER_BUTTON_TITLE"),level:"H1"});this.oPreviewPage=new o(this.getId()+"--insightCardPreviewPage",{showSubHeader:true,backgroundDesign:"List",enableScrolling:false,headerContent:[],content:[],customHeader:[this.oPreviewPageHeader]}).addStyleClass("sapMPageBgStandard");this.setAggregation("_page",this.oPreviewPage);this.createStaticControls();this.oPreviewPageHeader.addContent(this.oPreviewPageTitle);this.oPreviewPageHeader.addContent(new f(this.getId()+"--insightCardPreviewPage-headerSpacer"));this.oPreviewPageHeader.addContent(this.oCardPreviewBtn);this.oPreviewPageHeader.addContent(this.oHideCardPreviewBtn);this.oPreviewPage.addContent(this.oDefaultVBox)};b.prototype.onBeforeRendering=function(){this.bShowCardPreview=false;this.oManifest=this.getManifest();if(this.oManifest){this.oManifest=JSON.parse(this.oManifest)}this.oTitleTextInput.setValue(this.oManifest["sap.card"].header.title);this.oSubTitleTextInput.setValue(this.oManifest["sap.card"].header.subTitle);this._formatTitle(this.oTitleTextInput.getValue());this._adjustLayoutStyles();this.oInsightsPreviewOverflowLayerSD.setVisible(this.oManifest["sap.card"].type==="Analytical"?false:true);this.oInsightsCardOverflowLayer.setVisible(this.oManifest["sap.card"].type==="Analytical"?false:true)};b.prototype.createStaticControls=function(){this.oCardPreviewBtn=new p(this.getId()+"--cardPreviewId",{text:this.i18Bundle.getText("INT_DIALOG_CardPreview"),press:this._callPreview.bind(this),enabled:true});this.oHideCardPreviewBtn=new p(this.getId()+"--hideCardPreviewId",{text:this.i18Bundle.getText("INT_DIALOG_HidePreview"),press:this._callClosePreview.bind(this),enabled:true});this.oDefaultTitle=new r(this.getId()+"--defaultTitle",{text:this.i18Bundle.getText("INT_CARD_TITLEINFO"),level:"H4"}).addStyleClass("sapUiSmallMarginTop");this.oDefaultSubText=new a(this.getId()+"--defaultSubText",{wrapping:true});this.oDefaultInfoVBox=new l(this.getId()+"--defaultInfoVBox",{direction:"Column",items:[this.oDefaultTitle,this.oDefaultSubText]}).addStyleClass("sapUiSmallMarginBegin sapUiSmallMarginEnd");this.oLabelTitle=new a(this.getId()+"--labelTitle",{text:this.i18Bundle.getText("INT_Preview_CARDTITLE"),required:true,labelFor:this.getId()+"--titleTextInput"}).addStyleClass("sapUiTinyMarginTop");this.oTitleTextInput=new s(this.getId()+"--titleTextInput",{change:this._handleTitleChange.bind(this),required:true,ariaLabelledBy:[this.getId()+"--invisibleText",this.getId()+"--defaultTitle",this.getId()+"--defaultSubText",this.getId()+"--labelTitle"]});this.oLabelSubTitle=new a(this.getId()+"--labelSubTitle",{text:this.i18Bundle.getText("INT_Preview_SubTitleTitleField_Label"),required:false,labelFor:"subTitleTextInput"}).addStyleClass("sapUiTinyMarginTop");this.oSubTitleTextInput=new s(this.getId()+"--subTitleTextInput",{change:this._handleSubTitleChange.bind(this)});this.oSimpleForm=new i(this.getId()+"--defaultPreviewForm",{width:"100%",layout:I.ColumnLayout,editable:true,adjustLabelSpan:true,labelSpanXL:12,labelSpanL:12,labelSpanM:12,labelSpanS:12,content:[this.oLabelTitle,this.oTitleTextInput,this.oLabelSubTitle,this.oSubTitleTextInput]});this.oDefaultPreviewFormFlex=new l(this.getId()+"--defaultPreviewFormFlex",{height:"100%",width:"100%",items:[this.oSimpleForm]});this.oDefaultPreviewCardSD=new w(this.getId()+"--defaultPreviewCardSD",{manifestApplied:this._setAriaTextOnManifest.bind(this),width:"19rem",height:"33rem"}).addStyleClass("sapUiTinyMarginBeginEnd");this.oInsightsPreviewOverflowInnerHBoxSD=new g(this.getId()+"--insightsPreviewOverflowInnerHBoxSD",{}).addStyleClass("insightsCardOverflowLayer insightsPreviewCardOverLay insightsPreviewOVPOverLayPositionSD");this.oInsightsPreviewOverflowLayerSD=new g(this.getId()+"--insightsPreviewOverflowLayerSD",{height:"0",items:[this.oInsightsPreviewOverflowInnerHBoxSD]}).addStyleClass("sapMFlexBoxJustifyCenter");this.oDefaultPreviewCardVBox=new l(this.getId()+"--defaultPreviewCardVBox",{width:"100%",height:"100%",alignItems:"Center",backgroundDesign:"Transparent",justifyContent:"SpaceAround",items:[this.oDefaultPreviewCardSD,this.oInsightsPreviewOverflowLayerSD]}).addStyleClass("sapUiSmallMarginTop sapUiTinyMarginBottom");this.oDefaultPreviewScrollSD=new h(this.getId()+"--defaultPreviewScrollSD",{vertical:true,horizontal:false,height:"100%",content:[this.oDefaultPreviewCardVBox]});this.oDefaultPreviewFlexBox=new n(this.getId()+"--defaultPreviewFlexBox",{height:"100%",width:"100%",visible:false,justifyContent:"Center",items:[this.oDefaultPreviewScrollSD]});this.oMessageStrip=new x(this.getId()+"--messageStripId",{showIcon:true,showCloseButton:false}).addStyleClass("sapUiSmallMargin");this.oCardMessageStrip=new l(this.getId()+"--cardMessageId",{items:[this.oMessageStrip]});this.oDefaultFlexBox=new n(this.getId()+"--defaultFlexBox",{height:"100%",direction:"Column",items:[this.oDefaultInfoVBox,this.oCardMessageStrip,this.oDefaultPreviewFormFlex,this.oDefaultPreviewFlexBox]});this.oDefaultPreviewCardText=new r(this.getId()+"--defaultPreviewCardText",{text:this.i18Bundle.getText("INT_DIALOG_TITLE_CardPreview"),textAlign:"Left"}).addStyleClass("sapUiTinyMarginTop");this.oDefaultPreviewHBox=new g(this.getId()+"--defaultPreviewHBox",{width:"100%",justifyContent:"Start",backgroundDesign:"Transparent",items:[this.oDefaultPreviewCardText]}).addStyleClass("sapUiTinyMarginBegin");this.oDefaultPreviewToolBar=new d(this.getId()+"--defaultPreviewToolBar",{width:"100%",height:"2.7rem",style:"Clear",design:"Auto",content:[this.oDefaultPreviewHBox]}).addStyleClass("sapThemeBaseBG");this.oInsightsCardOverflowInnerHBox=new g(this.getId()+"--insightsCardOverflowInnerHBox",{width:"19rem",height:"2rem"}).addStyleClass("insightsCardOverflowLayer insightsCardOverflowTop");this.oDefaultPreviewCardLS=new w(this.getId()+"--defaultPreviewCardLS",{manifestApplied:this._setAriaTextOnManifest.bind(this),width:"19rem",height:"33rem"});this.oInsightsCardOverflowLayer=new g(this.getId()+"--insightsCardOverflowLayer",{height:"0",items:[this.oInsightsCardOverflowInnerHBox]}).addStyleClass("sapMFlexBoxJustifyCenter");this.oDefaultPreviewVBox=new l(this.getId()+"--defaultPreviewVBox",{height:"100%",alignItems:"Center",backgroundDesign:"Transparent",justifyContent:"SpaceAround",items:[this.oDefaultPreviewCardLS,this.oInsightsCardOverflowLayer]});this.oDefaultPreviewPanel=new v(this.getId()+"--defaultPreviewPanel",{expanded:false,height:"100%",backgroundDesign:"Transparent",content:[this.oDefaultPreviewVBox]});this.oDefaultPreviewPanelFlex=new n(this.getId()+"--defaultPreviewPanelFlex",{height:"calc(100% - 2.8rem)",backgroundDesign:"Transparent",justifyContent:"Center",items:[this.oDefaultPreviewPanel]});this.oDefaultPreviewScroll=new h(this.getId()+"--defaultPreviewScroll",{vertical:true,horizontal:false,height:"100%",content:[this.oDefaultPreviewToolBar,this.oDefaultPreviewPanelFlex]});this.oPreviewFlexBox=new n(this.getId()+"--defaultPreviewFlex",{height:"100%",width:"38%",direction:"Column",renderType:"Bare",items:[this.oDefaultPreviewScroll]}).addStyleClass("sapMPageBgStandard");this.oDefaultVBox=new l(this.getId()+"--defaultVBox",{height:"100%",width:"100%",direction:"Row",justifyContent:"SpaceBetween",items:[this.oDefaultFlexBox,this.oPreviewFlexBox]})};b.prototype.setPreviewModeOfCard=function(){var e=P.getDialogBasedDevice()===S.DEVICE_TYPES.Desktop;var t=e?this.oDefaultPreviewCardLS:this.oDefaultPreviewCardSD;if(t&&this.getTransformation()&&(this.oManifest["sap.card"].type==="Table"||this.oManifest["sap.card"].type==="List")){t.setPreviewMode("Abstract")}else{t.setPreviewMode("Off")}};b.prototype._setCardMessageInfo=function(){var e=this.getCardMessageInfo();if(e&&e.text&&e.text.trim()!==""){if(P.getDialogBasedDevice()===S.DEVICE_TYPES.Desktop){this.oCardMessageStrip.setVisible(true)}else{this.oCardMessageStrip.setVisible(this.bShowCardPreview?false:true)}if(this.oMessageStrip){this.oMessageStrip.setText(e.text);this.oMessageStrip.setType(e.type)}}else{e=null;this.oCardMessageStrip.setVisible(false)}};b.prototype._callPreview=function(){this.bShowCardPreview=true;this.oCardPreviewBtn.setVisible(false);this.oHideCardPreviewBtn.setVisible(true);this.oDefaultInfoVBox.setVisible(false);this.oDefaultPreviewFormFlex.setVisible(false);this.oDefaultPreviewFlexBox.setVisible(true);if(P.getDialogBasedDevice()===S.DEVICE_TYPES.Desktop){this.oDefaultPreviewCardLS.refresh()}else{this.oDefaultPreviewCardSD.refresh()}this._setCardMessageInfo()};b.prototype._callClosePreview=function(){this.bShowCardPreview=false;this.oCardPreviewBtn.setVisible(true);this.oHideCardPreviewBtn.setVisible(false);this.oDefaultInfoVBox.setVisible(true);this.oDefaultPreviewFormFlex.setVisible(true);this.oDefaultPreviewFlexBox.setVisible(false);this._setCardMessageInfo()};b.prototype._handleTitleChange=function(e){var t=e.getSource();var i=t.getValue().trim();var s;if(P.getDialogBasedDevice()===S.DEVICE_TYPES.Desktop){s=this.oDefaultPreviewCardLS}else{s=this.oDefaultPreviewCardSD}if(s.getCardHeader()){this.oManifest["sap.card"].header.title=i;this.bInitialPreviewLoad=true}if(i){t.setValueState("None");t.setValueStateText("");this.fireTitleCheck({enableButton:true})}else{t.setValueState("Error");t.setValueStateText(this.i18Bundle.getText("INT_Preview_Title_ValueStateText"));this.fireTitleCheck({enableButton:false})}this.setManifest(JSON.stringify(this.oManifest));s.refresh()};b.prototype._handleSubTitleChange=function(e){var t=e.getSource();var i=t.getValue();var s;if(P.getDialogBasedDevice()===S.DEVICE_TYPES.Desktop){s=this.oDefaultPreviewCardLS}else{s=this.oDefaultPreviewCardSD}if(s.getCardHeader()){this.oManifest["sap.card"].header.subTitle=i;this.bInitialPreviewLoad=true}s.refresh();this.setManifest(JSON.stringify(this.oManifest))};b.prototype._adjustLayoutStyles=function(){if(P.getDialogBasedDevice()!==S.DEVICE_TYPES.Desktop){if(this.bShowCardPreview){this.oDefaultInfoVBox.setVisible(false);this.oDefaultPreviewFormFlex.setVisible(false);this.oDefaultPreviewFlexBox.setVisible(true);this.oCardPreviewBtn.setVisible(false);this.oHideCardPreviewBtn.setVisible(true)}else{this.oDefaultPreviewFlexBox.setVisible(false);this.oDefaultInfoVBox.setVisible(true);this.oDefaultPreviewFormFlex.setVisible(true);this.oCardPreviewBtn.setVisible(true);this.oHideCardPreviewBtn.setVisible(false)}this.oPreviewFlexBox.setVisible(false);this.oDefaultPreviewCardSD.setManifest(this._setCardTypeForColumn(this.oManifest));this.oDefaultPreviewCardSD.refresh();this.oDefaultPreviewFormFlex.setWidth("100%");this.oDefaultFlexBox.setWidth("100%")}else{this.oPreviewFlexBox.setVisible(true);this.oDefaultInfoVBox.setVisible(true);this.oDefaultPreviewFormFlex.setVisible(true);this.oDefaultPreviewFlexBox.setVisible(false);this.oCardPreviewBtn.setVisible(false);this.oHideCardPreviewBtn.setVisible(false);this.oDefaultPreviewFormFlex.setWidth("50%");this.oDefaultFlexBox.setWidth("62%");this.oDefaultPreviewCardLS.setManifest(this._setCardTypeForColumn(this.oManifest));this.oDefaultPreviewCardLS.refresh()}this._setCardMessageInfo();this.oPreviewPage.setTitle(this.getDialogTitle())};b.prototype._setCardTypeForColumn=function(e){if(e["sap.card"].type==="Table"&&this.bInitialPreviewLoad&&this.getTransformation()){var t=T.createTableOptions(e);var i=t.filter(function(e){return e["sap.card"].type==="List"});if(i.length){e=i[0]}this.bInitialPreviewLoad=false}return e};b.prototype._setAriaTextOnManifest=function(e){var t=e.getSource()._ariaText.getText();var i=this.i18Bundle.getText("INT_DIALOG_TITLE_CardPreview");e.getSource()._ariaText.setText(i+t)};b.prototype._formatTitle=function(e){var t=this.oTitleTextInput;if(e&&e.trim()){t.setValueState("None");t.setValueStateText("");this.fireTitleCheck({enableButton:true})}else{t.setValueState("Error");t.setValueStateText(this.i18Bundle.getText("INT_Preview_Title_ValueStateText"));this.fireTitleCheck({enableButton:false})}};return b});
/*!
 * 
		SAP UI development toolkit for HTML5 (SAPUI5)
		(c) Copyright 2009-2015 SAP SE. All rights reserved
	
 */
sap.ui.predefine("sap/insights/manageCards/CardDetails", ["sap/ui/core/Control","sap/m/FlexBox","sap/m/VBox","sap/m/HBox","sap/m/ScrollContainer","sap/m/Title","sap/ui/integration/widgets/Card","sap/ui/layout/Grid","../utils/AppConstants","sap/m/Link","sap/m/Label","sap/insights/CardHelper","../utils/oDataModelProvider","sap/ui/core/CustomData","../utils/MetadataAnalyser","../utils/V4MetadataAnalyser","sap/m/Token","sap/ui/core/date/UI5Date","../utils/UrlGenerateHelper","../utils/SelectionVariantHelper","sap/fe/navigation/SelectionVariant","sap/ui/core/IconPool","sap/base/util/deepClone","sap/ui/comp/util/DateTimeUtil","sap/ui/layout/form/SimpleForm","sap/m/Toolbar","sap/m/Input","sap/m/DynamicDateRange","sap/m/Button","sap/m/Page","../utils/CardPreviewManager","sap/base/Log","sap/m/MessageToast","sap/m/MessageBox","sap/ui/mdc/MultiValueField","sap/ui/mdc/field/MultiValueFieldItem","sap/m/Text","sap/ui/model/json/JSONModel","sap/ui/core/Element","sap/ui/core/Lib","sap/ui/performance/trace/FESRHelper","../utils/InsightsUtils","sap/ui/core/InvisibleText","sap/insights/base/CacheData"],function(e,t,i,a,r,s,n,o,l,d,p,h,u,g,c,f,m,v,C,y,S,b,I,T,x,F,P,_,w,D,E,B,V,A,M,O,k,L,N,U,G,R,K,H){"use strict";var J=e.extend("sap.insights.manageCards.CardDetails",{metadata:{properties:{manifest:{type:"string",defaultValue:null,group:"Data",bindable:true,invalidate:true},editable:{type:"boolean",group:"Behavior",defaultValue:false,invalidate:true},width:{type:"sap.ui.core.CSSSize",group:"Dimension",defaultValue:"100%"},height:{type:"sap.ui.core.CSSSize",group:"Dimension",defaultValue:"100%"}},aggregations:{_page:{type:"sap.m.Page",multiple:false,visibility:"hidden"}},events:{navigate:{allowPreventDefault:true,parameters:{}}}},renderer:{apiVersion:2,render:function(e,t){e.openStart("div",t);e.style("height",t.getHeight());e.style("width",t.getWidth());e.openEnd();e.renderControl(t.getAggregation("_page"));e.close("div");return}}});J.prototype.init=function(){h.getServiceAsync().then(function(e){this.oCardHelperServiceInstance=e;e._getUserAllCards().then(function(e){this.aCards=e}.bind(this))}.bind(this));this.parentAppUrl=null;this.oLogger=B.getLogger("sap.insights.manageCards.CardDetails");this.i18Bundle=R.getResourceBundle();this.inMemoryCacheInstance=H.getInstance();this.oFlexBox=new t(this.getId()+"idCardsPreviewFlex",{height:"100%",direction:"Column"}).addStyleClass("sapUiTinyMarginBeginEnd");this.oInvisibleText=new K(this.getId()+"--ariaText");this.oInnerDeleteButton=new sap.m.Button({text:this.i18Bundle.getText("delete"),press:this._handleCardDeleteConfirm.bind(this),ariaLabelledBy:[this.oInvisibleText]});this._createStaticControls();this.oPage=new D({id:this.getId()+"insightCardPage",headerContent:[this.oInvisibleText,this.oInnerDeleteButton],content:this.oFlexBox,showNavButton:true,navButtonPress:this._navigateToList.bind(this),titleLevel:"H3"});this.oSmartFormMap={};this.oDraftCardParams={};this.setAggregation("_page",this.oPage)};J.prototype._createStaticControls=function(){this.oPreviewTitle=new s(this.getId()+"--previewTitle",{text:this.i18Bundle.getText("preview"),titleStyle:"H4"}).addStyleClass("sapUiSmallMargin");this.oCard=new n(this.getId()+"--previewCard",{width:"17rem",height:"23.5rem",manifest:this.getManifest()?this.getManifest():"",visible:true,manifestReady:this._setCopyVisible.bind(this),manifestApplied:this._setPreviewCardAriaText.bind(this,"preview")});this.oOverflowInnerHBox=new a(this.getId()+"--insightsPreviewOverflowInnerHBox").addStyleClass("insightsCardOverflowLayer insightsCardOverflowTop insightsPreviewOverLaySize");this.oOverFlowHBox=new a(this.getId()+"insightsPreviewOverflowLayer",{height:"0",items:[this.oOverflowInnerHBox]}).addStyleClass("sapMFlexBoxJustifyCenter");this.oPreviewVBox=new i(this.getId()+"--idCardsPreviewVBox",{alignItems:"Center",justifyContent:"Center",items:[this.oCard,this.oOverFlowHBox]});this.oSmartFormFlex=new t(this.getId()+"--smartFormFlex",{justifyContent:"Center",direction:"Column",visible:false,items:[]}).addStyleClass("sapUiTinyMarginTop");this.oOtherTitle=new s(this.getId()+"--otherSectionTitle",{text:this.i18Bundle.getText("otherSectionTitle"),titleStyle:"H4"}).addStyleClass("sapUiSmallMargin");this.oTitleVBox=new i(this.getId()+"--otherSectionTitleVBox",{width:"100%",items:[this.oOtherTitle]});this.parentLink=new d(this.getId()+"--parentAppLink",{ariaLabelledBy:this.getId()+"--parentAppLabel",press:this._navigateToParentApp.bind(this),wrapping:true});this.parentAppLabel=new p(this.getId()+"--parentAppLabel",{text:this.i18Bundle.getText("parentApp")});this.parentLinkVBox=new i(this.getId()+"--parentAppLinkVBox",{width:"100%",items:[this.parentLink]}).addStyleClass("sapUiSmallMarginEnd");this.appLabelVBox=new i(this.getId()+"--parentAppLabelVBox",{width:"100%",alignItems:"End",items:[this.parentAppLabel]}).addStyleClass("sapUiSmallMarginEnd");this.parentAppGrid=new o(this.getId()+"--parentAppLinkGrid",{width:"100%",vSpacing:0,hSpacing:1,position:"Left",defaultSpan:"XL4 L4 M4 S6",defaultIndent:"XL0 L0 M0 S0",content:[this.appLabelVBox,this.parentLinkVBox]});this.otherSection=new a(this.getId()+"--otherSectionHBox",{direction:"Column",items:[this.oTitleVBox,this.parentAppGrid]});this.outerMainVBox=new i(this.getId()+"--idPreviewOuterVBox",{height:"100%",width:"100%",items:[this.oPreviewTitle,this.oPreviewVBox,this.oSmartFormFlex,this.otherSection]});this.scrollContainer=new r(this.getId()+"--idCardsPreviewContainer",{vertical:true,horizontal:false,height:"100%",content:[this.outerMainVBox]})};J.prototype._createCopyStaticControls=function(){this.oDetailsTitle=new s(this.getId()+"--detailsTitle",{text:this.i18Bundle.getText("editDetails"),titleStyle:"H5"}).addStyleClass("sapUiSmallMarginBegin sapUiSmallMarginEnd sapUiSmallMarginTop");this.oCopyTitleLabel=new p(this.getId()+"--copyCardsEditTitleLabel",{text:this.i18Bundle.getText("title"),required:true});this.oCopyTitleInput=new P(this.getId()+"--copyCardsEditTitleField",{change:this._handleCardsInputChange.bind(this)});this.oCopySubLabel=new p(this.getId()+"--copyCardsEditSubTitleLabel",{text:this.i18Bundle.getText("subTitle")});this.oCopySubInput=new P(this.getId()+"--copyCardsEditSubTitleField",{change:this._handleCardsInputChange.bind(this)});this._oCopyForm=new x(this.getId()+"--copyCardsEditDetailsForm",{layout:"ColumnLayout",backgroundDesign:"Transparent",width:"100%",editable:true,content:[this.oCopyTitleLabel,this.oCopyTitleInput,this.oCopySubLabel,this.oCopySubInput]}).addStyleClass("sapContrastPlus sapUiSmallMarginEnd sapUiSmallMarginBegin");this.outerCopyFormVBox=new i(this.getId()+"--idCopyFormVBox",{height:"100%",width:"100%",items:[this.oDetailsTitle,this._oCopyForm]});this.oDynDate=new _(this.getId()+"--hiddenDDR",{hideInput:true});this.oDynDateFilter=new _(this.getId()+"--hiddenFilterDDR",{hideInput:true});this.oCopyPreviewTitle=new s(this.getId()+"--copyCardPreviewTitle",{text:this.i18Bundle.getText("preview"),titleStyle:"H5"}).addStyleClass("sapUiSmallMarginTop sapUiSmallMarginBegin");this.oRefreshButton=new w(this.getId()+"--copyCardPreviewRefreshButton",{type:"Transparent",text:this.i18Bundle.getText("refresh"),press:this._handleCardPreviewPress.bind(this)});this.oCopyHbox=new a(this.getId()+"--copyCardPreviewHBox",{alignItems:"Center",justifyContent:"SpaceBetween",width:"100%",items:[this.oCopyPreviewTitle,this.oRefreshButton]});this.oCopyCard=new n(this.getId()+"--copyCardPreview",{manifestApplied:this._setPreviewCardAriaText.bind(this,"preview"),width:"17rem",height:"23.5rem"});this.oCopyInnerOverflow=new a(this.getId()+"--insightsCopyOverflowInnerHBox").addStyleClass("insightsCardOverflowLayer insightsCardOverflowTop insightsPreviewOverLaySize");this.oCopyOverflow=new a(this.getId()+"--insightsCopyOverflowLayer",{height:"0",items:[this.oCopyInnerOverflow]}).addStyleClass("sapMFlexBoxJustifyCenter");this.oCopyPreviewVBox=new i(this.getId()+"--copyCardsPreviewVBox",{alignItems:"Center",items:[this.oCopyCard,this.oCopyOverflow]}).addStyleClass("sapUiMediumMarginBottom");this.oCopyVBox=new i(this.getId()+"--copyCardPreviewVBoxWrapper",{backgroundDesign:"Transparent",height:"100%",width:"100%",items:[this.oCopyHbox,this.oCopyPreviewVBox]}).addStyleClass("sapUiMediumMarginTop")};J.prototype._generateCardId=function(e){function t(e){var i=e[e.length-1];var a=new Date(parseInt(i)).getTime()>0;if(a){e.pop();return t(e)}return e}var i=t(e.split("."));i.push(Date.now());return i.join(".")};J.prototype._handleCardSavePress=function(){var e=this.oSmartFormFlex,t=e&&e.getItems()[0];if(t&&!t.getSmartFields().some(function(e){return e.checkClientError({handleSuccess:true})})){if(this.oCopyCardManifest.descriptorContent["sap.card"].header.title){this.oPage.setBusy(true);var i=this.oActualManifest;var a=this.oCopyCardManifest;var r=this.oCopyCardManifest.descriptorContent["sap.app"].id;var s=this.aCards||[];this.oDraftCardParams[r]={};a=this._mergeDraftParamsIncard(a);var n=s.filter(function(e){return e.visibility});a.descriptorContent["sap.insights"].visible=n.length<10?true:false;a.visibility=n.length<10?true:false;a.descriptorContent["sap.insights"].parentAppId=i.descriptorContent["sap.insights"].parentAppId;a.descriptorContent["sap.insights"].isDtCardCopy=false;a.descriptorContent["sap.ui5"].componentName=r;var o=false;if(a.descriptorContent["sap.card"]&&a.descriptorContent["sap.card"].extension&&a.descriptorContent["sap.card"].extension==="module:sap/insights/OVPCardExtension"){o=true}h.getServiceAsync().then(function(e){e._createCard(a.descriptorContent,o).then(function(){var t=i.descriptorContent["sap.card"].header.title;var a=this.i18Bundle.getText("copyCardSuccessMsg",[t]);V.show(a);this.oPage.setShowNavButton(true);e._getUserAllCardModel().then(function(e){this.aCards=e.getProperty("/cards")}.bind(this));this._navigateToList()}.bind(this)).catch(function(e){if(e&&e.message==="/UI2/INSIGHTS_MSG/007"){A.error(this.i18Bundle.getText("INT_CARD_MAXLIMIT"))}else{V.show(e.message)}}.bind(this)).finally(function(){this.oPage.setBusy(false)}.bind(this))}.bind(this))}}else{this.oLogger.error(this.i18Bundle.getText("cardCopyErrorMsg"))}};J.prototype._setEditable=function(e){this.oFlexBox.removeAllItems();var t;var i=this.oActualManifest.descriptorContent["sap.app"];var a=i&&i.dataSources;var r=a&&a.filterService;if(r&&r.settings&&r.settings.odataVersion===l.ODATA_VERSION_4){t=true}if(e&&!t){if(!this.oCopyVBox){this._createCopyStaticControls()}this.oInnerSaveBtn.setVisible(true);this.oInnerCancelBtn.setVisible(true);this.oInnerDeleteButton.setVisible(false);this.oInnerCopyBtn.setVisible(false);this.oFlexBox.addItem(this.oCopyTitle);this.oFlexBox.addItem(this.outerCopyFormVBox);this.oFlexBox.addItem(this.oSmartFormFlex);this.oFlexBox.addItem(this.oDynDate);this.oFlexBox.addItem(this.oDynDateFilter);this.oFlexBox.addItem(this.oCopyVBox)}else{this.oInnerDeleteButton.setVisible(true);if(this.oInnerSaveBtn){this.oInnerSaveBtn.setVisible(false);this.oInnerCancelBtn.setVisible(false)}if(this.outerMainVBox.indexOfItem(this.oSmartFormFlex)=="-1"){this.outerMainVBox.insertItem(this.oSmartFormFlex,2)}if(this.oInnerCopyBtn){if(!t){this.oInnerCopyBtn.setVisible(true)}else{this.oInnerCopyBtn.setVisible(false)}}this.oFlexBox.addItem(this.scrollContainer)}};J.prototype._setManifest=function(e){if(this.getEditable()){this.oCopyPreview=E.getCardPreviewManifest(e.descriptorContent);var t=this.oCopyPreview["sap.app"].id;var i=this._generateCardId(t);this.oCopyCardManifest.descriptorContent["sap.app"].id=i;this.oCopyPreview["sap.app"].id=i;this.oCopyCard.setManifest(this.oCopyPreview);if(this.oDraftCardParams){this.oDraftCardParams[i]={}}}else{this.oPreviewManifest=E.getCardPreviewManifest(e.descriptorContent);this.oPage.setTitle(e.descriptorContent["sap.card"].header.title);this.oInvisibleText.setText(this.oPage.getTitle());this.oCard.setManifest(this.oPreviewManifest)}if(e.descriptorContent["sap.app"].id!==this.currentCardId||this.getEditable()||this.bValueUpdate||this.listRefreshed){var a=this.getEditable()?this.oCopyOverflow:this.oOverFlowHBox;if(e.descriptorContent["sap.card"]["type"]==="Analytical"){a.setVisible(false)}else{a.setVisible(true)}this.listRefreshed=false;this._setSmartFormForCardEdit();this.currentCardId=e.descriptorContent["sap.app"].id}};J.prototype._navigateToList=function(){this._navigateCancel();this.fireNavigate()};J.prototype._setCopyVisible=function(){var e=this.oPreviewManifest;this.oSmartFormFlex.setVisible(false);if(e){var t=e["sap.app"].dataSources;var i=t&&t.filterService;var a=i&&i.uri;var r=i&&i.settings;if(a&&r){this.oSmartFormFlex.setVisible(true)}if(a&&r&&e["sap.insights"].isDtCardCopy&&!e["sap.insights"].error){if(!this.oInnerCopyBtn){this.oInnerCopyBtn=new sap.m.Button({text:this.i18Bundle.getText("copy"),press:this._navigateToCopyCard.bind(this),visible:true});this.oPage.insertHeaderContent(this.oInnerCopyBtn,1);G.setSemanticStepname(this.oInnerCopyBtn,"press","copyCardPress")}this.oInnerCopyBtn.setVisible(true)}else if(this.oInnerCopyBtn){this.oInnerCopyBtn.setVisible(false)}}};J.prototype._navigateCancel=function(){var e;if(this.oSmartFormFlex.getItems()[0]&&this.oSmartFormFlex.getItems()[0].isA("sap.ui.comp.smartform.SmartForm")&&this.oSmartFormFlex.getItems()[0].getEditable()){e=this.oSmartFormFlex.getItems()[0].check().length}if(this.bValueUpdate&&e){this.oSmartFormFlex.removeAllItems();this.setProperty("editable",false)}else{this.setProperty("editable",false);if(this.oSmartFormFlex.getItems()[0]){this.oSmartFormFlex.getItems()[0].setEditable(false)}}this.oPage.setShowNavButton(true)};J.prototype.onBeforeRendering=function(){if(this.getManifest()){this.oActualManifest=JSON.parse(this.getManifest());this._setManifest(this.oActualManifest);this._updateParentDetails(this.oActualManifest)}this.oCard.refresh();if(this.getEditable()){this._setEditable(true)}else{this._setEditable(false)}};J.prototype._setPreviewCardAriaText=function(e,t){var i=t.getSource()._ariaText.getText();var a=this.i18Bundle.getText(e);t.getSource()._ariaText.setText(a+i)};J.prototype._navigateToCopyCard=function(){this.oPage.setShowNavButton(false);if(!this.oCopyVBox){this._createCopyStaticControls()}if(!this.oInnerCancelBtn&&!this.oInnerSaveBtn){this.oInnerCancelBtn=new sap.m.Button({text:this.i18Bundle.getText("cancelButton"),press:this._navigateCancel.bind(this)});this.oInnerSaveBtn=new sap.m.Button({text:this.i18Bundle.getText("save"),press:this._handleCardSavePress.bind(this)});G.setSemanticStepname(this.oInnerSaveBtn,"press","saveCopyPress");this.oPage.insertHeaderContent(this.oInnerSaveBtn,2);this.oPage.insertHeaderContent(this.oInnerCancelBtn,3)}this.setEditable(true);this.bValueUpdate=false;this.oCopyCardManifest=JSON.parse(JSON.stringify(this.oActualManifest));this.oCopyPreview=JSON.parse(JSON.stringify(this.oPreviewManifest));this.oCopyCard.setManifest(this.oCopyPreview);this.oCopyTitleInput.setValue(this.oCopyCardManifest.descriptorContent["sap.card"].header.title);this.oCopySubInput.setValue(this.oCopyCardManifest.descriptorContent["sap.card"].header.subTitle);this.oPage.setTitle(this.i18Bundle.getText("copyCard"))};J.prototype._handleCardsInputChange=function(e){var t=e.getSource(),i=t.getValue(),a=t.getId();if(a&&a.includes("copyCardsEditTitleField")){if(!i){t.setValueState("Error")}else{t.setValueState("None")}this.oCopyCardManifest.descriptorContent["sap.card"].header.title=i}else if(a&&a.includes("copyCardsEditSubTitleField")){this.oCopyCardManifest.descriptorContent["sap.card"].header.subTitle=i}};J.prototype._handleCardPreviewPress=function(){if(this.oCopyCardManifest.descriptorContent["sap.card"].header.title){var e=this._mergeDraftParamsIncard(this.oCopyCardManifest);var t=this.oCopyCardManifest.descriptorContent["sap.app"].id;this.oCopyPreview=E.getCardPreviewManifest(e.descriptorContent);this.oCopyCard.setManifest(this.oCopyPreview);this.inMemoryCacheInstance.clearCache(t);this.oCopyCard.refresh()}};J.prototype._setSmartFormForCardEdit=function(){if(this.oActualManifest.descriptorContent&&this.oActualManifest.descriptorContent&&this.oActualManifest.descriptorContent["sap.app"]){var e=this.oActualManifest.descriptorContent["sap.app"];var t=e&&e.dataSources;var i=t&&t.filterService;if(i&&i.settings&&i.settings.odataVersion===l.ODATA_VERSION_2){var a=this.oActualManifest.descriptorContent["sap.app"].id,r=this.oSmartFormMap[a]&&!this.getEditable()&&!this.bValueUpdate?Promise.resolve(this.oSmartFormMap[a]):this._createSmartFormForCardEdit(this.oActualManifest.descriptorContent,this.getEditable());r.then(function(e){if(this.getEditable()){e.setEditable(true)}else{e.setEditable(false)}var t=this.oSmartFormFlex;t.removeAllItems();var i=this.oActualManifest.descriptorContent["sap.app"].dataSources;u.getOdataModel(i).then(function(i){var a=i&&i.loaded;var r=false;if(e.getGroups()&&e.getGroups().length&&e.getGroups()[0].getGroupElements()){r=e.getGroups()[0].getGroupElements().some(function(e){return e.getElements().some(function(e){return e.getVisible()})})}if(e.getAggregation("content").getFormContainers().length&&a&&r){e.setVisible(true);setTimeout(function(){var i=e.getAggregation("content").getLayout();if(i){i.setBackgroundDesign("Transparent")}t.addItem(e)},0)}else{this._setFilterTextForNoData(e,a,true);t.addItem(e)}}.bind(this))}.bind(this))}else if(i&&i.settings&&i.settings.odataVersion===l.ODATA_VERSION_4){this._createSimpleForm(this.oActualManifest.descriptorContent)}}};J.prototype._createSimpleForm=function(e){u.getOdataModel(this._search(e,"/sap.app/dataSources")).then(function(t){var i=this.oSmartFormFlex,a=e,r=t.oData,n=this._search(a,"/sap.app/id"),o=function(e){return new k({text:e,textAlign:"Center"})};i.removeAllItems();this._oSimpleForm=this._oSimpleForm||{};var l={onAfterRendering:function(){if(this._oSimpleForm[n].getAggregation("form").getLayout()&&this._oSimpleForm[n].getAggregation("form").getLayout().setBackgroundDesign){this._oSimpleForm[n].getAggregation("form").getLayout().setBackgroundDesign("Transparent");this._oSimpleForm[n].fireEvent("Rendered")}}.bind(this)};var d=function(){this._oSimpleForm[n].removeEventDelegate(l)};if(!this._oSimpleForm[n]){this._oSimpleForm[n]=new x({layout:"ColumnLayout",editable:false,toolbar:new F({style:"Clear",content:[new s({text:this.i18Bundle.getText("filterBy"),titleStyle:"H4"})]}).addStyleClass("sapThemeBaseBG-asBackgroundColor")});this._oSimpleForm[n].addEventDelegate(l);if(t.loaded){Promise.all([this._fetchRelevantFilters(a,r),this._fetchParameterizedFilters(a,r)]).then(function(e){var t=e[0],a=e[1];if(t.length||a.length){a.concat(t).forEach(function(e){this._oSimpleForm[n].addContent(new sap.m.Label({text:e.name}));this._oSimpleForm[n].addContent(this._generateMultiValueField(e.tokens))}.bind(this))}else{this._oSimpleForm[n].addContent(o(this.i18Bundle.getText("noFilterMsg")))}this._oSimpleForm[n].attachEventOnce("Rendered",null,d.bind(this),this._oSimpleForm[n]);i.addItem(this._oSimpleForm[n])}.bind(this))}else{this._oSimpleForm[n].addContent(o(this.i18Bundle.getText("noFilterLoaded")));this._oSimpleForm[n].attachEventOnce("Rendered",null,d.bind(this),this._oSimpleForm[n]);i.addItem(this._oSimpleForm[n])}}else{this._oSimpleForm[n].addEventDelegate(l);this._oSimpleForm[n].attachEventOnce("Rendered",null,d.bind(this),this._oSimpleForm[n]);i.addItem(this._oSimpleForm[n])}}.bind(this))};J.prototype._fetchParameterizedFilters=function(e,t){var i=this._search(e,"/sap.card/configuration/parameters"),a=this._search(i,"/_relevantODataParameters/value")||[];return a.reduce(function(a,r){return a.then(function(a){return f.getAnnotations(t,e,r,["@com.sap.vocabularies.Common.v1.Label","@com.sap.vocabularies.UI.v1.Hidden"]).then(function(e){var t=e[0],s=e[1],n=i[r].value,o=i[r].label;if(n&&!s){a.push({name:t||r,tokens:[new m({key:n,text:o?o:n})]})}return Promise.resolve(a)})})},Promise.resolve([]))};J.prototype._fetchRelevantFilters=function(e,t){var i=this._search(e,"/sap.card/configuration/parameters"),a=this._search(i,"/_relevantODataFilters/value")||[];return a.reduce(function(a,r){return a.then(function(a){return f.getAnnotations(t,e,r,["@com.sap.vocabularies.Common.v1.Label","@com.sap.vocabularies.UI.v1.Hidden"]).then(function(e){var t=e[0],s=e[1],n=i[r].value,o=new S(n),l=o.getSelectOption(r);if(l.length&&!s){var d=y.getTokenFromSelectOptions(l,r);a.push({name:t||r,tokens:d})}return Promise.resolve(a)})})},Promise.resolve([]))};J.prototype._generateMultiValueField=function(e){var t=new L(e.map(function(e){return{key:e.getKey(),name:e.getText()}}));var i=new M({editMode:"Display",display:"Description",width:"100%",items:{path:"/",template:new O({description:"{name}",key:"{key}"})}});i.setModel(t);return i};J.prototype._search=function(e,t){return t?t.split("/").reduce(function(e,t){return e&&t?e[t]:e},e):undefined};J.prototype._handleCardDeleteConfirm=function(){A.show(this.i18Bundle.getText("deleteCardMsg"),{icon:A.Icon.WARNING,title:this.i18Bundle.getText("delete"),actions:[A.Action.DELETE,A.Action.CANCEL],emphasizedAction:A.Action.DELETE,onClose:function(e){if(e===A.Action.DELETE){this._handleCardDelete(this.currentCardPreviewPath)}}.bind(this)})};J.prototype._handleCardDelete=function(){this.oPage.setBusy(true);var e=this.oActualManifest;var t=e.descriptorContent["sap.app"].id;var i=e.descriptorContent["sap.card"].header.title;this.oCardHelperServiceInstance._deleteCard(t).then(function(){var e=this.aCards.filter(function(e){return e.descriptorContent["sap.app"].id!==t});this.aCards=e;this.oPage.setBusy(false);V.show(this.i18Bundle.getText("deleteCardSuccess",[i]));this.fireNavigate()}.bind(this)).catch(function(e){this.oPage.setBusy(false);V.show(e.message)}.bind(this))};J.prototype._setFilterTextForNoData=function(e,t,i){U.load({name:"sap.ui.comp"}).then(function(){sap.ui.require(["sap/ui/comp/smartform/Group","sap/ui/comp/smartform/GroupElement","sap/ui/comp/smartform/Layout"],function(a,r,s){e.removeAllGroups();var n=new a;var o=new r;var l=new k({text:t?this.i18Bundle.getText("noFilterMsg"):this.i18Bundle.getText("noFilterLoaded"),textAlign:"Center"});o.addElement(l);n.addGroupElement(o);e.setLayout(new s);e.addGroup(n);if(i){e.getAggregation("content").getLayout().setBackgroundDesign("Transparent")}}.bind(this))}.bind(this))};J.prototype._mergeDraftParamsIncard=function(e){var t=e.descriptorContent["sap.card"].configuration.parameters;var i=e.descriptorContent["sap.app"].id;var a=this.oDraftCardParams[i];Object.keys(a).forEach(function(e){if(a[e]){if(t[e]){if(t[e].type==="datetime"&&typeof t[e].value==="string"&&t[e].value.includes("operation")){var i=JSON.parse(t[e].value);i.operation=a[e];t[e].value=JSON.stringify(i)}else{t[e].value=a[e].value?a[e].value:a[e];if(a[e].label){t[e].label=a[e].label}t[e].description=a[e].description}}else if(e.indexOf("P_")===0&&t[e.replace("P_","")]){a[e.replace("P_","")]=a[e].replace("P_","");t[e.replace("P_","")].value=a[e].replace("P_","");delete a[e]}}});C.processPrivateParams(e,a);Object.keys(t).forEach(function(e){var i=t[e].value;if(t[e].type==="datetime"&&typeof i==="string"&&i.includes("datetime")){i=i.split("datetime");i=i[i.length-1];i=i.replace(/["']/g,"");t[e].value=i}});return e};J.prototype._getOptionsForDynamicDate=function(e,t){var i;if(e[t]["sap:filter-restriction"]==="single-value"){i=l.DATE_OPTIONS.SINGLE_OPTIONS}else if(e[t]["sap:filter-restriction"]==="interval"){i=l.DATE_OPTIONS.RANGE_OPTIONS;i=i.concat(l.DATE_OPTIONS.SINGLE_OPTIONS)}if(e&&e[t].exclude){i=i.filter(function(i){return!e[t].selectedValues.includes(i)})}return i};J.prototype._attachInitialiseToGroupElement=function(e){if(e.getFields()&&e.getFields().length){e.getFields()[0].attachInitialise(function(){if(e.getFields().length&&e.getLabelControl()&&!e.getLabelControl().getText()){var t=e.getFields()[0].getBindingPath("value");if(t&&e.getFields()[0].getVisible()){e.getFields()[0].setTextLabel(t)}}})}};J.prototype._createSmartFormForCardEdit=function(e){return new Promise(function(t){Promise.all([U.load({name:"sap.ui.comp"}),U.load({name:"sap.m"})]).then(function(){sap.ui.require(["sap/ui/comp/smartmultiinput/SmartMultiInput","sap/ui/comp/smartform/SmartForm","sap/ui/comp/smartform/Group","sap/ui/comp/smartform/GroupElement","sap/ui/comp/smartform/Layout","sap/m/Title","sap/m/Toolbar"],function(i,a,r,s,n,o,l){var d=e;var p=d["sap.card"].configuration.parameters;var h=d["sap.insights"].filterEntitySet;var f=p&&p._entitySet.value;var b=d["sap.app"].dataSources;u.getOdataModel(b).then(function(e){var u=e&&e.loaded;var b={layout:new n({labelSpanS:6}),customToolbar:new l({content:[new o({text:this.i18Bundle.getText("filterBy"),titleStyle:"H4"})],style:"Clear"})};var I=new a(b);var T=new r;var x=[],F=[],P=[],_=[],w,D,E=[];if(p){x=p._mandatoryODataParameters.value||[];F=p._mandatoryODataFilters.value||[];P=p._relevantODataParameters.value||[];_=p._relevantODataFilters.value||[];D=p._semanticDateRangeSetting;if(D){w=JSON.parse(D.value);E=Object.keys(w)||[]}}I.attachEditToggled(function(e){var t=e.getParameters().editable;var i=e.getSource().getGroups()&&e.getSource().getGroups().length?e.getSource().getGroups()[0]:null;if(t&&i){i.getGroupElements().forEach(function(e){e.getFields().forEach(function(e){e.attachInnerControlsCreated(function(e){var t=e.getSource(),i=t.getBindingPath("value");if((x.includes(i)||F.includes(i))&&t.getProperty("editable")){t.setMandatory(true)}else if(t.getMandatory()){t.setMandatory(false)}t.checkClientError()})})})}});var B=function(e,t){if(t){var i=new g({key:"date",value:t});e.insertCustomData(i)}};var V=e&&c.getParameterisedEntitySetByEntitySet(e.oData,h);var A=V?c.getPropertyNamesOfEntitySet(e.oData,V):[];if(u){if(P.length){P.forEach(function(t){var a=V;var r=true;if(A.indexOf(t)===-1){a=f;r=false}var n=c.isValueListWithFixedValues(e.oData,a,t);var o=c.isDate(e.oData,a,t);var l=E.includes(t);var d=new s;var h=new i({entitySet:a,value:"{"+t+"}",editable:r,visible:r,singleTokenMode:true,supportRanges:false,innerControlsCreated:this._handleVisibilityChange.bind(this,l,true)});if(n){h.attachInnerControlsCreated(function(e){var t=e.getSource();if(t.getMode()==="edit"){var i=t.getInnerControls();if(Array.isArray(i)&&i.length){var a=t.getAggregation("initialTokens");if(t.getSingleTokenMode()){var r=i[0],s=Array.isArray(a)&&a.length?a[0]:null;if(r.setForceSelection){r.setForceSelection(false);if(s){r.setSelectedKey(s.getKey())}else{r.setSelectedItem(null)}}}else{var n=i[0];if(Array.isArray(a)&&a.length){n.setSelectedKeys(a.map(function(e){return e.getKey()}))}}if(t.getMandatory()){t.checkClientError()}}}});h.checkClientError=function(){return this._checkClientError(h)}.bind(this);h.attachSelectionChange(this._handleParameterSelectionChange.bind(this))}else{if(l){h.addStyleClass("semanticDateInsight")}h.attachTokenUpdate(this._handleParameterTokenUpdate.bind(this,null,l))}var u=p[t].value;var g=p[t].label;if(u){var y=new m({key:u,text:g?g:u});if(o){if(!E.includes(t)){B(y,v.getInstance(u))}else{if(w&&this.getEditable()){var S=this._getOptionsForDynamicDate(w,t);var b=this.oDynDate;b.setStandardOptions(S)}u=C.formatSemanticDateTime(u,"Parameter",p[t].type)[0];B(y,u)}}if(n&&h.getInnerControls().length){var I=h.getInnerControls()[0];I.setSelectedKey(y.getKey())}h.addAggregation("initialTokens",y)}if(u&&h.getVisible()){d.addElement(h);T.addGroupElement(d)}else if(this.getEditable()&&h.getVisible()){d.addElement(h);T.addGroupElement(d)}this._attachInitialiseToGroupElement(d)}.bind(this))}var M=c.getPropertyNamesOfEntitySet(e.oData,h);_.forEach(function(t){var a=t;if(!(a==="DisplayCurrency"&&P.indexOf("P_DisplayCurrency")>-1)){var r=h;var n=true;if(M.indexOf(a)===-1){var o="P_"+a;if(A.indexOf(o)>-1){r=V;a=o}else{r=f;n=false}}var l=c.isValueListWithFixedValues(e.oData,r,a);var d=c.isDate(e.oData,r,a);var u=E.includes(a);var g=new s;var m;if(a.indexOf("P_")===0){m=true}else{m=c.getPropertyFilterRestrictionByEntitySet(e.oData,r,a)}var b=new i({entitySet:r,value:"{"+a+"}",editable:n,visible:n,supportRanges:!m,singleTokenMode:m,innerControlsCreated:this._handleVisibilityChange.bind(this,u,false)});if(l){b.attachInnerControlsCreated(function(e){var t=e.getSource();if(t.getMode()==="edit"){var i=t.getInnerControls();if(Array.isArray(i)&&i.length){var a=t.getAggregation("initialTokens");if(t.getSingleTokenMode()){var r=i[0],s=Array.isArray(a)&&a.length?a[0]:null;if(r.setForceSelection){r.setForceSelection(false);if(s){r.setSelectedKey(s.getKey())}else{r.setSelectedItem(null)}}}else{var n=i[0];if(Array.isArray(a)&&a.length){n.setSelectedKeys(a.map(function(e){return e.getKey()}))}}if(t.getMandatory()){t.checkClientError()}}}});b.checkClientError=function(){return this._checkClientError(b)}.bind(this);b.attachSelectionChange(this._handleFilterSelectionChange.bind(this))}else{if(u){b.setSingleTokenMode(true);b.addStyleClass("semanticDateInsight")}b.attachTokenUpdate(this._handleFilterTokenUpdate.bind(this,null,u))}var I=new S(p[t].value);var x=I.getSelectOption(t);if(x&&x.length){var F=[],_=[];F=y.getTokenFromSelectOptions(x,t);F.forEach(function(e,i){if(d){if(!E.includes(t)){B(e,v.getInstance(e.getKey()))}else{if(w&&this.getEditable()){var a=this._getOptionsForDynamicDate(w,t);var r=this.oDynDateFilter;r.setStandardOptions(a)}_=C.formatSemanticDateTime(x[i],"Filter",p[t].type);_.forEach(function(t){B(e,t)})}}if(l&&b.getInnerControls().length){var s=b.getInnerControls()[0];s.setSelectedKey(e.getKey())}b.addAggregation("initialTokens",e)}.bind(this));g.addElement(b);T.addGroupElement(g)}else if(this.getEditable()){g.addElement(b);T.addGroupElement(g)}this._attachInitialiseToGroupElement(g)}}.bind(this))}if(T.getAggregation("formElements")&&T.getAggregation("formElements").length){I.addGroup(T)}var O=d["sap.app"].id;if(u){I.setModel(e.oData)}this.oSmartFormMap[O]=I;this.bValueUpdate=false;t(I)}.bind(this))}.bind(this))}.bind(this))}.bind(this))};J.prototype._handleParameterSelectionChange=function(e){var t=e.getParameter("selectedItem");var i=e.getSource(),a="";var r={value:"",label:"",description:""};if(t){i.setValueState("None");a=t.getText()?t.getText():t.getKey();r.value=t.getKey();r.label=a}i.removeAllAggregation("initialTokens");i.addAggregation("initialTokens",new m({key:r.value,text:r.label}));var s=e.getSource().getBinding("value").getPath();var n=this.oActualManifest.descriptorContent["sap.app"].id;this.oDraftCardParams[n][s]=r;this.bValueUpdate=true};J.prototype._checkClientError=function(e){var t=e.getSingleTokenMode()&&e.getInnerControls()[0]?!e.getInnerControls()[0].getSelectedKey():!e.getInnerControls()[0].getSelectedKeys().length,i=e.getMandatory()&&t;e.setValueState(i?"Error":"None");return i};J.prototype._refreshDTSmartForm=function(e){e.forEach(function(e){if(this.oSmartFormMap&&this.oSmartFormMap[e]){this.oSmartFormMap[e]=null}}.bind(this));this.listRefreshed=true};J.prototype._handleParameterTokenUpdate=function(e,t,i){var a=e?e:i.getSource();if(a.getMandatory()){a.checkClientError()}var r=a.getBinding("value").sPath;var s=a.getTokens();var n=this.oActualManifest.descriptorContent["sap.app"].id;var o={value:"",label:"",description:""};var d=a.getModel();var p=c.isDate(d,a.getEntitySet(),r);var h,u;if(t&&(!s.length||e)){u=this.oDynDate;this.bValueApplied=true;u.attachEventOnce("change",null,this._onSemanticParameterDateChange.bind(this,r,a),u);u.openBy(a.getDomRef())}if(s.length){o.label=s[0].getText()?s[0].getText():s[0].getKey();if(t&&!u){u=this.oDynDate}if(u&&u._parseValue){h=u._parseValue(s[0].getKey());if(h){u.setValue(h);o.value=C.getDateRangeValue(h,true);o.description=JSON.stringify(h);var g;if(r&&h){g=this._getLabelForField(e,"Parameter")}var f="";var m=h.operator==="DATE";if(g&&typeof g==="string"){f=g.substring(0,g.indexOf("(")-1);if(!f&&m){f=g}}o.label=f?f:h.operator}else{o.value=s[0].getKey();if(Date.parse(o.value)){o.value=v.getInstance(o.value)}o.description=u.getValue()?JSON.stringify(u.getValue()):"";var y=this.oActualManifest.descriptorContent["sap.card"].configuration.parameters;if(!u.getValue()&&y[r]&&y[r].description){var S;o.description=y[r].description;S=JSON.parse(o.description);if(l.DATE_OPTIONS.DATE_LIST.includes(S.operator)){S.values[0]=v.getInstance(S.values[0]);o.value=typeof s[0].getKey()==="string"?v.getInstance(s[0].getKey()):s[0].getKey()}u.setValue(S)}else{u.setValue(u.getValue())}}}else{h=a._parseValue&&a._parseValue(s[0].getKey());if(p&&h){h=a.getModel().formatValue(h,a.getDataType());o.value=h}else if(h){o.value=h}else{h=s[0].getKey();o.value=h}}}this.oDraftCardParams[n][r]=o;this.bValueUpdate=true};J.prototype._handleFilterTokenUpdate=function(e,t,i){var a=e?e:i.getSource();if(a.getMandatory()){a.checkClientError()}var r=a.getBinding("value").sPath;var s=a.getTokens();var n=this.oCopyCardManifest.descriptorContent;var o=n["sap.app"].id;var d=a.getModel();var p=c.isDate(d,a.getEntitySet(),r);var h,u="",g,f={value:"",label:"",description:""};g=n["sap.card"].configuration.parameters;if(t&&(!s.length||e)){h=this.oDynDateFilter;h.attachEventOnce("change",null,this._onSemanticFilterDateChange.bind(this,r,a),h);this.bValueApplied=true;h.openBy(a.getDomRef());if(!s.length){f.value=y.getEmptySVStringforProperty(r)}else{u=h._parseValue(s[0].getKey());if(u){h.setValue(u)}else{f.description=h.getValue()?JSON.stringify(h.getValue()):"";if(!h.getValue()&&g[r]&&g[r].description){var m;f.description=g[r].description;f.value=g[r].value;m=JSON.parse(f.description);m.values.forEach(function(e,t){if(l.DATE_OPTIONS.DATE_LIST.includes(m.operator)){var i=v.getInstance(e);if(e.match&&!(e.match(/^(\d{4}-\d{2}-\d{2}T\d{2}:\d{2}:\d{2}.\d{3})Z$/gm)&&e.match(/^(\d{4}-\d{2}-\d{2}T\d{2}:\d{2}:\d{2}.\d{3})Z$/gm).length)){m.values[t]=T.utcToLocal(i);if(!["DATETIMERANGE","FROMDATETIME","TODATETIME","DATETIME"].includes(m.operator)){m.values[t]=T.normalizeDate(m.values[t],true)}}else{m.values[t]=i}}});h.setValue(m)}else{h.setValue(h.getValue())}}}}else if(s.length){var C=new S;var b=[];var I="";s.forEach(function(e){I="";if(e.data("selectOption")){var t=e.data("selectOption");if(!t.Text){t.Text=e.getText?e.getText():null}b.push(t)}else if(e.data("range")){var i=e.data("range");var s=y.getSelectOptionFromRange(i,e.getText());b.push(s)}else if(p){var n=d.formatValue(e.getKey(),"Edm.DateTime");C.addSelectOption(r,"I","EQ",n,null,n)}else if(a._parseValue){var o=a._parseValue(e.getKey());I=e.getText()?e.getText():e.getKey();C.addSelectOption(r,"I","EQ",o,null,I)}else{I=e.getText()?e.getText():e.getKey();C.addSelectOption(r,"I","EQ",e.getKey(),null,I)}});C.massAddSelectOption(r,b);f.value=C.toJSONString()}else{f.value=y.getEmptySVStringforProperty(r)}this.oDraftCardParams[o][r]=f.value?f:this.oDraftCardParams[o][r];this.bValueUpdate=true};J.prototype._handleVisibilityChange=function(e,t,i){var a=i.getSource();var r=this.oSmartFormFlex;var s=r&&r.getItems()[0];var n=false;if(e&&a.getMode()==="edit"){var o=t?this.oDynDate:this.oDynDateFilter;o.setValue(null);var l=a.getBinding("value").sPath;var d=a.getInnerControls();if(d.length){var p=d[0];a.setShowValueHelp(false);a.setShowSuggestion(false);if(!N.getElementById(p.getId()+"-dynamicDateIcon")){p.addEndIcon({id:p.getId()+"-dynamicDateIcon",src:b.getIconURI("check-availability"),press:t?this._handleParameterTokenUpdate.bind(this,a,true):this._handleFilterTokenUpdate.bind(this,a,true)});p.attachLiveChange(function(){this.bValueApplied=true;p.setValue("");o.attachEventOnce("change",null,t?this._onSemanticParameterDateChange.bind(this,l,a):this._onSemanticFilterDateChange.bind(this,l,a),o);o.openBy(a.getDomRef())}.bind(this))}}}setTimeout(function(){if(s){var e=s.getGroups()&&s.getGroups().length?s.getGroups()[0]:null;var t=e&&e.getGroupElements();if(t&&t.length){t.forEach(function(t){var i=t.getFields();i.forEach(function(e){if(!this.getEditable()&&e.getId()===a.getId()&&(e.getTokens&&e.getTokens().length===0)){t.removeField(e)}if(t.getVisible()&&e.getVisible()&&e.getTokens&&e.getTokens().length){n=true}}.bind(this));if(!t.getFields().length){e.removeGroupElement(t)}}.bind(this))}}if(!n&&r&&!this.getEditable()){r.removeAllItems();this._setFilterTextForNoData(s,true,false);r.addItem(s)}}.bind(this),0)};J.prototype._handleFilterSelectionChange=function(e){var t=e.getParameters();var i=e.getSource().getBinding("value").getPath();var a=this.oActualManifest.descriptorContent;var r=a["sap.app"].id;var s=e.getSource();var n=new S;var o="",l={value:"",label:"",description:""};if(t.selectedItem){s.setValueState("None");var d=e.getParameter("selectedItem");if(d){o=d.getText()?d.getText():d.getKey();s.removeAllAggregation("initialTokens");s.addAggregation("initialTokens",new m({key:d.getKey(),text:o}));n.addSelectOption(i,"I","EQ",d.getKey(),null,o);l.value=n.toJSONString()}else{l.value=y.getEmptySVStringforProperty(i)}}else{var p=e.getSource().getInnerControls()[0].getSelectedItems();if(p.length){s.setValueState("None");s.removeAllAggregation("initialTokens");p.forEach(function(e){o=e.getText()?e.getText():e.getKey();s.addAggregation("initialTokens",new m({key:e.getKey(),text:o}));n.addSelectOption(i,"I","EQ",e.getKey(),null,o)});l.value=n.toJSONString()}else{l.value=y.getEmptySVStringforProperty(i)}}this.oDraftCardParams[r][i]=l;this.bValueUpdate=true};J.prototype._onSemanticParameterDateChange=function(e,t,i){if(this.bValueApplied){var a=i.getParameter("value");var r=t.getInnerControls()[0];var s=this.oActualManifest.descriptorContent;var n=s["sap.app"].id;var o;if(e&&a){o=this._getLabelForField(t,"Parameter")}var l="";var d=a.operator==="DATE";if(o&&typeof o==="string"){l=o.substring(0,o.indexOf("(")-1);if(!l&&d){l=o}}if(!this.oDraftCardParams[n][e]){this.oDraftCardParams[n][e]={}}this.oDraftCardParams[n][e].value=d?a.values[0]:a.operator;this.oDraftCardParams[n][e].label=d?a.values[0]:a.operator;this.oDraftCardParams[n][e].description=JSON.stringify(a);r.setTokens([]);if(l){this.oDraftCardParams[n][e].label=l}var p=new m({key:this.oDraftCardParams[n][e].value,text:this.oDraftCardParams[n][e].label});r.setTokens([p]);var h=i.getParameter("valid");t.setValueState(h?"None":"Error");this.bValueApplied=false;this.bValueUpdate=true}};J.prototype._onSemanticFilterDateChange=function(e,t,i){if(this.bValueApplied){var a=t.getInnerControls()[0];var r=i.getParameter("value");var s;if(e&&r){s=this._getLabelForField(t,"Filter")}var n=I(r);var o=C.getDateRangeValue(n,false,s);var l=this.oActualManifest.descriptorContent;var d=l["sap.app"].id;var p=new S;if(!o.High){o.High=""}if(!this.oDraftCardParams[d][e]){this.oDraftCardParams[d][e]={}}p.addSelectOption(e,"I",o.Option,o.Low,o.High,o.Text);this.oDraftCardParams[d][e].value=p.toJSONString();this.oDraftCardParams[d][e].description=JSON.stringify(n);a.setTokens([]);var h=y.getTokenFromSelectOptions(p.getSelectOption(e),e);a.setTokens(h);var u=i.getParameter("valid");t.setValueState(u?"None":"Error");this.bValueApplied=false;this.bValueUpdate=true}};J.prototype._getLabelForField=function(e,t){var i=t==="Parameter"?this.oDynDate:this.oDynDateFilter;var a=i.getIdForLabel()||"";a=a.substring(0,a.lastIndexOf("-"));if(a){var r=N.getElementById(a);return r&&r.getValue()}else if(i&&i.getProperty("value")){return i.getProperty("value")}else if(e&&typeof e.getTokens==="function"){var s=e.getTokens()||[],n=s.map(function(e){return e.getText()});return{type:"filters",value:n}}};J.prototype._updateParentDetails=function(e){return h.getServiceAsync().then(function(t){t.getParentAppDetails(e).then(function(e){if(this._getIsNavigationEnabled(e)){this.parentLink.setText(e.title);this.otherSection.setVisible(true);this.parentAppUrl=e.semanticURL}else{this.otherSection.setVisible(false)}}.bind(this))}.bind(this))};J.prototype._navigateToParentApp=function(){var e=this.parentAppUrl;const t=sap.ui.require("sap/ushell/Container");t.getServiceAsync("CrossApplicationNavigation").then(function(t){t.toExternal({target:{shellHash:e}});this.fireNavigate()}.bind(this))};J.prototype._getIsNavigationEnabled=function(e){const t=sap.ui.require("sap/ushell/Container");return t.getServiceAsync("CrossApplicationNavigation").then(function(t){return t.isNavigationSupported([{target:{semanticObject:e.semanticObject,action:e.action}}])}).then(function(e){return e[0].supported||false})};return J});
/*!
 * 
		SAP UI development toolkit for HTML5 (SAPUI5)
		(c) Copyright 2009-2015 SAP SE. All rights reserved
	
 */
sap.ui.predefine("sap/insights/manageCards/CardsList", ["sap/base/Log","sap/ui/core/Core","sap/ui/core/Control","sap/ui/core/Icon","sap/ui/core/dnd/DragDropInfo","sap/ui/model/Filter","sap/ui/model/FilterOperator","sap/ui/integration/widgets/Card","sap/m/MessageStrip","sap/m/FlexBox","sap/m/HBox","sap/m/VBox","sap/m/Text","sap/m/Button","sap/m/ToggleButton","sap/m/Title","sap/m/SearchField","sap/m/ScrollContainer","sap/m/Table","sap/m/Column","sap/m/ColumnListItem","sap/m/Link","sap/m/MessageBox","sap/m/FormattedText","sap/m/MessageToast","sap/m/Popover","sap/m/Page","sap/m/Label","sap/m/Switch","../CardHelper","sap/m/IllustratedMessage","../utils/CardPreviewManager","../utils/DeviceType","../utils/AppConstants","sap/ui/performance/trace/FESRHelper","../utils/CardDndConfig","../utils/InsightsUtils","sap/f/GridContainer","sap/f/GridContainerSettings","sap/m/IllustratedMessageSize","sap/m/IllustratedMessageType"],function(e,t,i,s,a,r,n,o,l,d,h,g,p,u,C,c,f,m,x,b,y,B,T,v,w,I,_,S,P,M,V,F,A,H,L,R,D,E,k,N,U){"use strict";var W=e.getLogger("sap.insights.manageCards.CardsList");var O;var j;var z=i.extend("sap.insights.manageCards.CardsList",{metadata:{properties:{enableResetAllCards:{type:"boolean",group:"Behavior",defaultValue:false},_count:{type:"int",group:"Appearance",defaultValue:0},_visibleCount:{type:"int",group:"Appearance",defaultValue:0},_dtCards:{type:"array",group:"Appearance",defaultValue:[]}},aggregations:{_page:{type:"sap.m.Page",multiple:false,visibility:"hidden"}},events:{listPress:{allowPreventDefault:true,parameters:{manifest:"string",listRefresh:"array"}}}},renderer:{apiVersion:2,render:function(e,t){e.openStart("div",t);e.style("height","100%");e.style("width","100%");e.openEnd();e.renderControl(t.getAggregation("_page"));e.close("div");return}}});z.prototype.init=function(){this._oWrapperFlexBox=new d(this.getId()+"--flexContainerCardsContent",{alignItems:"Start",justifyContent:"Start",height:"100%",width:"100%",direction:"Column",busy:"{/isLoading}"}).addStyleClass("flexContainerCards");this.i18Bundle=D.getResourceBundle();var e=new _(this.getId()+"--insightCardPage",{title:this.i18Bundle.getText("insightsCards"),showHeader:true,backgroundDesign:"List",enableScrolling:false,content:this._oWrapperFlexBox,titleLevel:"H3"});this.setAggregation("_page",e)};z.prototype._handleModelChange=function(){if(this.getModel()){var e=this.getModel().getProperty("/cards");if(e.length>0){this._setHeaderStaticControls();this._setProperties();this._createTableContent();if(this.oNoCardVBox){this.oNoCardVBox.setVisible(false)}}else{this._createNoCardContent()}}};z.prototype._setHeaderStaticControls=function(){if(!this.oMessageStrip){this.oMessageStrip=new l(this.getId()+"--insightMaxCardMsg",{text:this.i18Bundle.getText("insightMaxCardText"),type:"Warning",showIcon:true});this.oTextMessage=new p(this.getId()+"--insightCardText",{text:this.i18Bundle.getText("insightCardTabText"),textAlign:"Begin",width:"100%"}).addStyleClass("sapUiSmallMarginTop");this.oMessageVBox=new g(this.getId()+"--insightCardMessageVBox",{alignItems:"Start",width:"calc(100% - 2rem)",items:[this.oMessageStrip,this.oTextMessage]}).addStyleClass("sapUiSmallMarginTop sapUiSmallMarginBegin");this.oCardListHeaderHBox=new h(this.getId()+"--insightCardListHeaderVBox",{width:"calc(100% - 2rem)",alignItems:"Center"}).addStyleClass("sapUiSmallMarginTop sapUiSmallMarginBegin insightsCardTitleFlex");this.oCardCountTitle=new c(this.getId()+"--availableInsightsCardsTitle",{titleStyle:"H4"});this.oCardListHeaderHBox.addItem(this.oCardCountTitle);var e=new h(this.getId()+"--insightCardSearchHBox",{width:"100%",justifyContent:"End"});var t=new h(this.getId()+"--insightCardVisFilterHBox",{width:"50%",alignItems:"Center",justifyContent:"End"});t.addItem(new S(this.getId()+"--showVisibleOnlyLabel",{text:this.i18Bundle.getText("cardsVisibleFilter")}));this._oVisibleFilterSwitch=new P(this.getId()+"--insightCardSwitchBtn",{customTextOn:" ",customTextOff:" ",ariaLabelledBy:[this.getId()+"--availableInsightsCardsTitle",this.getId()+"--showVisibleOnlyLabel"],change:this._handleVisibleFilterChange.bind(this)}).addStyleClass("sapUiSmallMarginBegin sapUiSmallMarginEnd");L.setSemanticStepname(this._oVisibleFilterSwitch,"change","visibleFilterSwitch");t.addItem(this._oVisibleFilterSwitch);e.addItem(t);this._oSearchField=new f(this.getId()+"--insightCardSearch",{liveChange:this._onCardSearch.bind(this),width:"100%"});e.addItem(this._oSearchField);this.oCardListHeaderHBox.addItem(e);this._oWrapperFlexBox.addItem(this.oMessageVBox);this._oWrapperFlexBox.addItem(this.oCardListHeaderHBox)}else{this.oMessageVBox.setVisible(true);this.oCardListHeaderHBox.setVisible(true)}};z.prototype._applyFilters=function(e,t){var i;var s=[];if(t){i=new r("visibility",n.EQ,true);s.push(i)}if(this._oSearchField.getValue()){i=new r("descriptorContent/sap.card/header/title",n.Contains,e);s.push(i)}var a=this._oTable.getBinding("items");a.filter(s,"Application")};z.prototype._handleVisibleFilterChange=function(e){var t=e.getSource().getState();this._applyFilters(this._oSearchField.getValue(),t)};z.prototype._createResetBox=function(){if(!this.oRefreshHBox){this.oRefreshHBox=new h(this.getId()+"--insightCardMessageHBox",{alignItems:"Center"});this.oRefreshHBox.addItem(new p(this.getId()+"--insightsRefreshText",{text:this.i18Bundle.getText("refreshText")}));this.oRefreshBtn=new u(this.getId()+"--insightsRefreshIcon",{tooltip:this.i18Bundle.getText("refresh"),icon:"sap-icon://refresh",type:"Transparent",press:this._refreshCardList.bind(this),ariaLabelledBy:[this.getId()+"--insightsRefreshText"]});this.oRefreshHBox.addItem(this.oRefreshBtn);L.setSemanticStepname(this.oRefreshBtn,"press","refreshCards");this.oMessageVBox.addItem(this.oRefreshHBox)}else{this.oRefreshHBox.setVisible(true)}};z.prototype._setProperties=function(){var e=this.getModel().getProperty("/cards");this.setProperty("_count",e.length);var t=e.filter(function(e){return e.descriptorContent["sap.insights"].isDtCardCopy});this.setProperty("_dtCards",t);var i=e.filter(function(e){return e.visibility});this.setProperty("_visibleCount",i.length);this.bEnableResetAll=this.getEnableResetAllCards();if(this.getProperty("_visibleCount")>9){this.oMessageStrip.setVisible(true);this.oTextMessage.setVisible(false)}else{this.oTextMessage.setVisible(true);this.oMessageStrip.setVisible(false)}this.oCardCountTitle.addStyleClass("editInsightsTitleFontSize");this.oCardCountTitle.setText(this.i18Bundle.getText("availableCards")+" ("+this.getProperty("_visibleCount")+"/"+this.getProperty("_count")+")");if(this.bEnableResetAll||this.getProperty("_dtCards").length>0){this._createResetBox()}else if(this.oRefreshHBox){this.oRefreshHBox.setVisible(false)}if(this._oTable){this._oTable.updateAggregation("items")}};z.prototype._createNoCardContent=function(){if(!this.oNoCardVBox){var e=new V(this.getId()+"--editInsightNoInsightsCardsMsg",{illustrationSize:N.Auto,illustrationType:U.NoEntries,title:this.i18Bundle.getText("editInsightsEmptyCardTitle"),description:this.i18Bundle.getText("editInsightsEmptyCardSubTitle")}).addStyleClass("sapFIllustratedMessageAlign sapFFrequentIllustratedMessageAlign sapUiMargin-24Top");var t=new m(this.getId()+"--idNoCardCardsScrollContainer",{vertical:true,horizontal:false,height:"100%",width:"100%",content:[e]});this.oNoCardVBox=new g(this.getId()+"--idNoCardVBox",{height:"100%",width:"100%",items:[t]});this._oWrapperFlexBox.addItem(this.oNoCardVBox)}else{this.oNoCardVBox.setVisible(true)}if(this.oCardListHeaderHBox){this.oCardListHeaderHBox.setVisible(false)}if(this.oMessageVBox){this.oMessageVBox.setVisible(false)}if(this.oTableFlexBox){this.oTableFlexBox.setVisible(false)}};z.prototype._handleTableItemsChange=function(e){if(e&&e.getParameters()&&e.getParameters().reason!=="filter"){this._handleModelChange()}};z.prototype._createTableContent=function(){if(!this.oTableFlexBox){this.oTableFlexBox=new d(this.getId()+"--editInsightsCardsFlex",{alignItems:"Start",justifyContent:"Start",height:"100%",width:"calc(100% - 2rem)",direction:"Row"}).addStyleClass("sapUiSmallMarginBegin sapUiSmallMarginTop flexContainerCards");this.oTableVBox=new g(this.getId()+"--insightsCardsVBox",{height:"100%",width:"100%",justifyContent:"Start",direction:"Column"});this.oScrollContainer=new m(this.getId()+"--idCardsScrollContainer",{vertical:true,horizontal:false,height:"100%",width:"100%",content:this._createTable()});this.oTableVBox.addItem(this.oScrollContainer);this.oTableFlexBox.addItem(this.oTableVBox);this._oWrapperFlexBox.addItem(this.oTableFlexBox);this._oTable.getBinding("items").attachChange(this._handleTableItemsChange.bind(this))}else{this.oTableFlexBox.setVisible(true)}};z.prototype._onCardSearch=function(e,t){var i=e?e.getSource().getValue():t;this._applyFilters(i,this._oVisibleFilterSwitch.getState())};z.prototype._createTable=function(){if(!this._oTable){this._oTable=new x(this.getId()+"--insightsCardsListTable",{columns:[new b(this.getId()+"--idTableDnDIconColumn",{hAlign:"Center",width:A.getDialogBasedDevice()!==H.DEVICE_TYPES.Mobile?"5%":"7%"}),new b(this.getId()+"--idSectionTitleColumn",{width:A.getDialogBasedDevice()!==H.DEVICE_TYPES.Mobile?"85%":"76%"}),new b(this.getId()+"--idSectionVisColumn",{width:A.getDialogBasedDevice()!==H.DEVICE_TYPES.Mobile?"10%":"17%"})],updateFinished:function(){if(O>=0){this.getItems()[O].focus()}if(j){var e=this.getItems().findIndex(function(e){return e.getBindingContextPath()===j});if(e>=0){this.getItems()[e].getCells()[2].getItems()[0].focus()}}}}).addStyleClass("sapContrastPlus");this._oTable.bindAggregation("items",{path:"/cards",length:100,factory:this._generateTableColumnsTemplate.bind(this)});this._oTable.addDragDropConfig(new a({sourceAggregation:"items",targetAggregation:"items",drop:this._handleDrop.bind(this)}));this._oTable.attachBrowserEvent("keydown",this._attachDndHandler.bind(this,this._oTable,this._handleDrop.bind(this)))}return this._oTable};z.prototype._generateTableColumnsTemplate=function(){var e=new y({press:this._handleCardListItemPress.bind(this),type:"Navigation",ariaLabelledBy:[this.getId()+"--availableInsightsCardsTitle"]}).addStyleClass("insightsListItem insightsListMargin");var t=new h({items:[new s({src:"sap-icon://BusinessSuiteInAppSymbols/icon-grip"}).addStyleClass("insightsDndIcon")]});var i=new g({items:[new B({text:"{descriptorContent/sap.card/header/title}",wrapping:true,press:this._showCardPreviewPopover.bind(this)}),new h({visible:"{= ${descriptorContent/sap.card/header/subTitle} ? true : false }",items:[new p({text:"{descriptorContent/sap.card/header/subTitle}"})]}).addStyleClass("cardsSubTitleMargin")]}).addStyleClass("cardsTitlePadding");var a=new h({items:[new C({type:{path:"visibility",formatter:function(e){return e==true?"Emphasized":"Default"}},pressed:{path:"visibility",mode:"TwoWay",formatter:function(e){return!e}},enabled:{path:"descriptorContent/sap.insights",mode:"TwoWay",formatter:function(e){if(e.visible==false&&this.getProperty("_visibleCount")>=10||e.error){return false}return true}.bind(this)},press:this._handleCardVisibilityToggle.bind(this),icon:"sap-icon://show",tooltip:{path:"visibility",formatter:function(e){return e==true?this.i18Bundle.getText("hideBtn"):this.i18Bundle.getText("showBtn")}.bind(this)}})]});e.addCell(t);e.addCell(i);e.addCell(a);return e};z.prototype._refreshCardList=function(){var e;if(this.bEnableResetAll){e=this.i18Bundle.getText("deleteAllCardsMsg")}else{var t=this.getProperty("_dtCards");var i="<p>"+this.i18Bundle.getText("refreshAllCards")+"</p>";i+="<ul>";t.forEach(function(e){i+='<li class="sapUiTinyMarginBottom">'+e.descriptorContent["sap.card"].header.title+"</li>"});i+="</ul>";e=new v({htmlText:i})}T.show(e,{icon:T.Icon.WARNING,title:this.i18Bundle.getText("refresh"),actions:[T.Action.OK,T.Action.CANCEL],emphasizedAction:T.Action.OK,onClose:function(e){if(e===T.Action.OK){M.getServiceAsync().then(function(e){return e._refreshUserCards(this.bEnableResetAll).then(function(){this.cardListRefreshed=true;return this._handleModelChange()}.bind(this))}.bind(this))}}.bind(this)})};z.prototype._handleCardListItemPress=function(e,t){if(e){this.currentCardPreviewPath=e.getSource().getBindingContextPath()}else if(t){this.currentCardPreviewPath=t.getBindingContextPath()}var i=this.getModel().getProperty(this.currentCardPreviewPath);var s=this.getProperty("_dtCards");if(this.cardListRefreshed&&s.length){this.fireListPress({manifest:JSON.stringify(i),listRefresh:s.map(e=>e.descriptorContent["sap.app"]["id"])})}else{this.fireListPress({manifest:JSON.stringify(i)})}this.cardListRefreshed=false};z.prototype._handleCardVisibilityToggle=function(e){this._oWrapperFlexBox.setBusy(true);var t=e.getSource();j=t.getBindingContext().sPath;var i=t.getBindingContext().getPath();var s=this.getModel().getProperty(i);var a=!s.visibility;s.visibility=a;s.descriptorContent["sap.insights"].visible=a;M.getServiceAsync().then(function(e){e._updateCard(s.descriptorContent,true).then(function(){this._oWrapperFlexBox.setBusy(false);this._handleModelChange();if(this._oTable){this._oTable.updateAggregation("items");this._applyFilters(this._oSearchField.getValue(),this._oVisibleFilterSwitch.getState())}return}.bind(this)).catch(function(e){this._oWrapperFlexBox.setBusy(false);w.show(e.message);W.error(e.message)}.bind(this))}.bind(this))};z.prototype._showCardPreviewPopover=function(e){var t=this.getModel();var i=e.getSource().getParent().getBindingContext().getPath();var s=t.getProperty(i);var a=e.getSource();var r=new g({alignItems:"Center",justifyContent:"Center",renderType:"Bare"}).addStyleClass("sapUiSmallMargin");var n=new o({manifest:F.getCardPreviewManifest(s.descriptorContent),width:"17rem",height:"23.5rem"});var l=new E({snapToRow:true,containerQuery:true,inlineBlockLayout:true,allowDenseFill:false,items:[new g({width:"17rem",height:"100%",alignItems:"Center",justifyContent:"Center",items:[n]})],layout:new k({rowSize:"23.5rem",columnSize:"17rem"})});r.addItem(l);var d=new I({title:this.i18Bundle.getText("preview"),placement:"VerticalPreferredBottom",showHeader:true}).addStyleClass("sapContrastPlus previewPopoverBackground");d.addContent(r);d.openBy(a)};z.prototype._handleDrop=function(e){var t=e.getParameter?e.getParameter("draggedControl"):e.draggedControl,i=t.getParent().indexOfItem(t),s=e.getParameter?e.getParameter("droppedControl"):e.droppedControl,a=t.getParent().indexOfItem(s);if(i!==a){var r=this._oTable.getItems()[i].getBindingContext().getObject().rank,n=this._oTable.getItems()[a].getBindingContext().getObject().rank,o=this.getModel().getProperty("/cards");var l=o.findIndex(function(e){return e.rank===r});var d=o.findIndex(function(e){return e.rank===n});var h=R.updateCardsRanking(l,d,o);try{this._oWrapperFlexBox.setBusy(true);M.getServiceAsync().then(function(e){e._updateMultipleCards(h,"PUT").then(function(){var e=this.getModel().getProperty("/cards");e[l].descriptorContent["sap.insights"].ranking=e[l].rank;e=e.sort(function(e,t){if(e.rank<t.rank){return-1}return 1});this.getModel().setProperty("/cards",e);this._oWrapperFlexBox.setBusy(false)}.bind(this))}.bind(this))}catch(e){this._oWrapperFlexBox.setBusy(false);W.error(e.message)}}O=a};z.prototype._attachDndHandler=function(e,i,s){var a=s.metaKey||s.ctrlKey;if(a&&(s.key==="ArrowUp"||s.key==="ArrowDown")){s.preventDefault();var r=s.key==="ArrowUp"?"Before":"After";var n=e.getItems();var o=t.getCurrentFocusedControlId();var l=n.findIndex(e=>e.getId()===o);if(l>=0&&l<n.length){var d=s.key==="ArrowDown"?l+1:l-1;if(d>=0&&d<n.length){var h=n[l];var g=n[d];var p={draggedControl:h,droppedControl:g,dropPosition:r};O=d;i(p)}n.forEach(function(e,t){e.tabIndex=t===d?0:-1})}}};return z});
/*!
 * 
		SAP UI development toolkit for HTML5 (SAPUI5)
		(c) Copyright 2009-2015 SAP SE. All rights reserved
	
 */
sap.ui.predefine("sap/insights/utils/AppConstants", [],function(){"use strict";var t="/sap/opu/odata4/ui2/insights_srv/srvd/ui2/";var a="INSIGHTS_CARDS";var i="/sap/opu/odata4/sap/aiu_ui_prompt/srvd/sap/aiu_ui_prompt/0001/";return{DATE_OPTIONS:{SINGLE_OPTIONS:["DATE","YESTERDAY","TOMORROW","TODAY","FIRSTDAYWEEK","LASTDAYWEEK","FIRSTDAYMONTH","LASTDAYMONTH","FIRSTDAYQUARTER","LASTDAYQUARTER","FIRSTDAYYEAR","LASTDAYYEAR"],RANGE_OPTIONS:["THISWEEK","LASTWEEK","NEXTWEEK","THISMONTH","LASTMONTH","NEXTMONTH","THISQUARTER","LASTQUARTER","NEXTQUARTER","QUARTER1","QUARTER2","QUARTER3","QUARTER4","THISYEAR","LASTYEAR","NEXTYEAR","YEARTODATE","DATETOYEAR","DATERANGE","DATETIMERANGE","FROM","FROMDATETIME","LASTDAYS","LASTMONTHS","LASTQUARTERS","LASTWEEKS","LASTYEARS","NEXTDAYS","NEXTMONTHS","NEXTQUARTERS","NEXTWEEKS","NEXTYEARS","SPECIFICMONTH","TO","TODATETIME","TODAYFROMTO"],DATE_LIST:["DATE","DATERANGE","DATETIME","DATETIMERANGE","FROM","TO","FROMDATETIME","TODATETIME","SPECIFICMONTH"],SPECIAL_RANGE:["LASTDAYS","LASTMONTHS","LASTQUARTERS","LASTWEEKS","LASTYEARS","NEXTDAYS","NEXTMONTHS","NEXTQUARTERS","NEXTWEEKS","NEXTYEARS","TODAYFROMTO"]},DEVICE_TYPES:{Desktop:"Desktop",Tablet:"Tablet",Mobile:"Mobile"},CHART_TYPE_DETAILS:{bar:{icon:"sap-icon://horizontal-bar-chart",title:"Bar Chart"},column:{icon:"sap-icon://vertical-bar-chart",title:"Column Chart"},dual_column:{icon:"sap-icon://vertical-bar-chart",title:"Dual Column Chart"},dual_bar:{icon:"sap-icon://horizontal-bar-chart",title:"Dual Bar Chart"},stacked_bar:{icon:"sap-icon://full-stacked-chart",title:"Stacked Bar Chart"},stacked_column:{icon:"sap-icon://vertical-stacked-chart",title:"Stacked Column Chart"},line:{icon:"sap-icon://line-chart",title:"Line Chart"},dual_line:{icon:"sap-icon://line-chart",title:"Dual Line Chart"},combination:{icon:"sap-icon://business-objects-experience",title:"Combination Chart"},bullet:{icon:"sap-icon://horizontal-bullet-chart",title:"Bullet Chart"},time_bullet:{icon:"sap-icon://horizontal-bullet-chart",title:"Time Bullet Chart"},bubble:{icon:"sap-icon://product",title:"Bubble Chart"},time_bubble:{icon:"sap-icon://product",title:"Time Bubble Chart"},pie:{icon:"sap-icon://pie-chart",title:"Pie Chart"},donut:{icon:"sap-icon://donut-chart",title:"Donut Chart"},timeseries_column:{icon:"sap-icon://vertical-bar-chart",title:"TimeSeries Column Chart"},timeseries_line:{icon:"sap-icon://line-chart",title:"TimeSeries Line Chart"},timeseries_scatter:{icon:"sap-icon://scatter-chart",title:"TimeSeries Scatter Chart"},timeseries_bubble:{icon:"sap-icon://product",title:"TimeSeries Bubble Chart"},timeseries_stacked_column:{icon:"sap-icon://vertical-stacked-chart",title:"TimeSeries Stacked Column Chart"},timeseries_100_stacked_column:{icon:"sap-icon://full-stacked-column-chart",title:"TimeSeries 100% Stacked Column Chart"},timeseries_bullet:{icon:"sap-icon://horizontal-bullet-chart",title:"TimeSeries Bullet Chart"},timeseries_waterfall:{icon:"sap-icon://vertical-waterfall-chart",title:"TimeSeries Waterfall Chart"},timeseries_stacked_combination:{icon:"sap-icon://business-objects-experience",title:"Timeseries Stacked Combination Chart"},scatter:{icon:"sap-icon://scatter-chart",title:"Scatter Plot"},vertical_bullet:{icon:"sap-icon://vertical-bullet-chart",title:"Vertical Bullet Chart"},dual_stacked_bar:{icon:"sap-icon://full-stacked-chart",title:"Dual Stacked Bar Chart"},"100_stacked_bar":{icon:"sap-icon://full-stacked-chart",title:"100% Stacked Bar Chart"},"100_dual_stacked_bar":{icon:"sap-icon://full-stacked-chart",title:"100% Dual Stacked Bar Chart"},dual_stacked_column:{icon:"sap-icon://vertical-stacked-chart",title:"Dual Stacked Column Chart"},"100_stacked_column":{icon:"sap-icon://full-stacked-column-chart",title:"100% Stacked Column Chart"},"100_dual_stacked_column":{icon:"sap-icon://vertical-stacked-chart",title:"100% Dual Stacked Column Chart"},stacked_combination:{icon:"sap-icon://business-objects-experience",title:"Stacked Combination Chart"},horizontal_stacked_combination:{icon:"sap-icon://business-objects-experience",title:"Horizontal Stacked Combination Chart"},dual_stacked_combination:{icon:"sap-icon://business-objects-experience",title:"Dual Stacked Combination Chart"},dual_horizontal_stacked_combination:{icon:"sap-icon://business-objects-experience",title:"Dual Horizontal Stacked Combination Chart"},heatmap:{icon:"sap-icon://heatmap-chart",title:"Heat Map"},waterfall:{icon:"sap-icon://vertical-waterfall-chart",title:"Waterfall Chart"},horizontal_waterfall:{icon:"sap-icon://horizontal-waterfall-chart",title:"Horizontal Waterfall Chart"},treemap:{icon:"sap-icon://product",title:"Tree Map"},area:{icon:"sap-icon://product",title:"Area Chart"},radar:{icon:"sap-icon://product",title:"Radar Chart"},dual_combination:{icon:"sap-icon://business-objects-experience",title:"Dual Combination Chart"},dual_horizontal_combination:{icon:"sap-icon://business-objects-experience",title:"Dual Horizontal Combination Chart"},default:{icon:"sap-icon://product"}},ERROR_CODES:["/IWBEP/CM_MGW_RT/003","/IWBEP/CM_MGW_RT/004","/IWBEP/CM_MGW_RT/005","/IWBEP/CM_MGW_RT/006"],ODATA_VERSION_2:"2.0",ODATA_VERSION_4:"4.0",BASE_URL:t,REPO_BASE_URL:t+"insights_cards_repo_srv/0001/",CARD_ENTITY_NAME:a,CARD_READ_URL:t+"insights_cards_read_srv/0001/"+a,CARD_SELECT_QUERY:"&$select=descriptorContent,visibility,rank&$orderby=rank&$skip=0&$top=10",HEAD:"HEAD",GET:"GET",POST:"POST",PUT:"PUT",DELETE:"DELETE",FESR_STEP_NAME:"INS:AddCard",AI_INSIGHTCARD_BASEURL:i,ADD_AI_INSIGHTCARD_COMPLETEURL:i+"InsightsCard/com.sap.gateway.srvd.aiu_ui_prompt.v0001.GenerateCardFromUserInput?",FESR_AIGENERATE_CARD:"INS:GenAICard",FESR_AIGENERATE_ADD_CARD:"INS:AddAICard",FESR_AIGENERATE_CLEARALL:"INS:ClearAICard",FESR_AIGENERATE_CANCEL:"INS:CancelAICard",FESR_AIGENERATE_THUMBSUP:"ai:cards:thumbsUp",FESR_AIGENERATE_THUMBSDOWN:"ai:cards:thumbsDown"}});
/*!
 * 
		SAP UI development toolkit for HTML5 (SAPUI5)
		(c) Copyright 2009-2015 SAP SE. All rights reserved
	
 */
sap.ui.predefine("sap/insights/utils/BatchHelper", ["sap/ui/base/Object","sap/base/Log","./AppConstants","./InsightsUtils"],function(t,e,n,r){"use strict";var s=t.extend("sap.insights.utils.BatchHelper",{});var a=e.getLogger("sap.insights.utils.BatchHelper");var i;function o(t,e){var r="INSIGHTS_CARDS";this.url=e==="POST"?r:r+"('"+t.id+"')";this.mOptions={};this.batchRequests=[];this.payload=t;this.boundary="batch_id_"+Date.now()+"_01";this.mOptions.headers={};this.mOptions.method=e||n.PUT;this.mOptions.headers["content-type"]="multipart/mixed;boundary="+this.boundary;this.mOptions.headers["X-CSRF-Token"]=i;return this}function h(){return fetch(n.REPO_BASE_URL,{method:"HEAD",headers:{"X-CSRF-Token":"Fetch"}}).then(function(t){var e=t.headers.get("X-CSRF-Token");if(t.ok&&e){return e}var n=r.getResourceBundle().getText("tokenFetchError");a.error(n);throw new Error(n)})}o.prototype.addRequest=function(t){this.batchRequests.push(t)};o.prototype._constructBody=function(){var t="--"+this.boundary;var e="\r\n";var n="Content-Type:application/http"+e+"Content-Transfer-Encoding:binary"+e;var r="changeset_001";var s="--"+r;var a="Content-Type: multipart/mixed; boundary="+r+e;var i=t+e+a;i+=e+s;for(var o=0;o<this.batchRequests.length;o++){var h=this.batchRequests[o];i+=e+n;i+="Content-ID: "+(o+1)+e+e;i+=h.mOptions.method+" "+h.url+" HTTP/1.1 "+e;i+="sap-context-accept: header"+e+"Content-Type:application/json"+e+e;i+=JSON.stringify(this.batchRequests[o].payload)+e+e;i+=s;if(o===this.batchRequests.length-1){i+="--"+e;i+=t+"--"}}return i};s.createMultipartRequest=function(t,e){return h().then(function(n){this.url="/sap/opu/odata4/ui2/insights_srv/srvd/ui2/insights_cards_repo_srv/0001/$batch";this.batchRequests=[];var r;i=n;for(var s=0;s<t.length;s++){var a=t[s];var h=new o(a,e);if(!r){r=h}r.addRequest(h)}return this.fetchData(r)}.bind(this))};s.fetchData=function(t){t.mOptions.body=t._constructBody();t.mOptions.method="POST";return fetch(this.url,t.mOptions).then(function(t){if(t.ok===false){throw new Error}return t.text()}).then(function(t){return r.getDataFromRawValue(t)})};return s});
/*!
 * 
		SAP UI development toolkit for HTML5 (SAPUI5)
		(c) Copyright 2009-2015 SAP SE. All rights reserved
	
 */
sap.ui.predefine("sap/insights/utils/CardDndConfig", ["../utils/CardRanking"],function(r){"use strict";function n(n,t,e){if(n<t){return r.reorder(e,n,t+1)}return r.reorder(e,n,t)}function t(r,t,e){var i=n(r,t,e);i=i.map(function(r){var n=JSON.parse(JSON.stringify(r));var t=n.descriptorContent["sap.app"].id;n.descriptorContent["sap.insights"].ranking=n.rank;n.descriptorContent=JSON.stringify(n.descriptorContent);return{id:t,descriptorContent:n.descriptorContent}});return i}return{updateCardsRanking:t}});
/*!
 * 
		SAP UI development toolkit for HTML5 (SAPUI5)
		(c) Copyright 2009-2015 SAP SE. All rights reserved
	
 */
sap.ui.predefine("sap/insights/utils/CardPreviewManager", [],function(){function t(t){return t&&Array.isArray(t)&&t.length}function a(a){var e=JSON.parse(JSON.stringify(a));var n=e["sap.card"].type;if(t(e["sap.card"].header.actions)){e["sap.card"].header.actions=[];delete e["sap.card"].header.actions}if(n==="Analytical"&&t(e["sap.card"].content.actions)){e["sap.card"].content.actions=[];delete e["sap.card"].content.actions}else if(n==="List"&&t(e["sap.card"].content.item.actions)){e["sap.card"].content.item.actions=[];delete e["sap.card"].content.item.actions}else if(n==="Table"&&t(e["sap.card"].content.row.actions)){e["sap.card"].content.row.actions=[];delete e["sap.card"].content.row.actions}return e}function e(a,e){var n=JSON.parse(JSON.stringify(e)),c=JSON.parse(JSON.stringify(a));var r=c["sap.card"].type,i=n["sap.card"].type;if(t(n["sap.card"].header.actions)){c["sap.card"].header["actions"]=n["sap.card"].header.actions}if(r==="Analytical"&&t(n["sap.card"].content.actions)){c["sap.card"].content.actions=n["sap.card"].content.actions}else if(r===i){if(r==="List"&&t(n["sap.card"].content.item.actions)){c["sap.card"].content.item.actions=n["sap.card"].content.item.actions}else if(r==="Table"&&t(n["sap.card"].content.row.actions)){c["sap.card"].content.row.actions=n["sap.card"].content.row.actions}}else if(i==="List"&&t(n["sap.card"].content.item.actions)){c["sap.card"].content.row.actions=n["sap.card"].content.item.actions}else{c["sap.card"].content.item.actions=n["sap.card"].content.row.actions}return c}function n(t){if(t.getAggregation("_content")&&t.getAggregation("_content").getAggregation("_content")&&t.getAggregation("_content").getAggregation("_content")._getVizDataset){if(t.getAggregation("_content").getAggregation("_content")._errorType){return false}var a=t.getAggregation("_content").getAggregation("_content")._getVizDataset();var e=a&&a._FlatTableD&&a._FlatTableD._data&&Array.isArray(a._FlatTableD._data)&&a._FlatTableD._data.length;if(e){return true}}return false}return{getCardPreviewManifest:a,hasVizData:n,insertActionsManifest:e}});
/*!
 * 
		SAP UI development toolkit for HTML5 (SAPUI5)
		(c) Copyright 2009-2015 SAP SE. All rights reserved
	
 */
sap.ui.predefine("sap/insights/utils/CardRanking", ["./BatchHelper"],function(r){"use strict";function n(r,n){if(!r){r="!"}if(!n){n="~"}return String.fromCharCode(Math.floor((r.charCodeAt(0)+n.charCodeAt(0))/2))}function e(r,e){if(!r){r="!"}if(!e){e="~"}if(r>=e){throw new Error("Second Argument should be greater than the first one")}var t="";var a=r.length>e.length?r.length:e.length;for(var o=0;o<a;o++){t+=n(r[o],e[o])}if(t===r){return t+"0"}else if(t>=e){throw new Error("No Mid possible between "+r+" and "+e)}return t}function t(r){var n=r.length;var e=0;for(var t=0;t<n;t++){e+=r.charCodeAt(t)*Math.pow(10,n-t-1)}return e}function a(r,n){return Math.abs(t(r)-t(n))}function o(r,n,t){var i=[];var f=a(r[n-1].rank,r[n].rank);var u=a(r[t].rank,r[t+1].rank);var h,c,d;if(f>u){h=n-1;d=c=n}else{d=h=t;c=t+1}try{r[d].rank=e(r[h].rank,r[c].rank)}catch(n){i=i.concat(o(r,h,c));r[d].rank=e(r[h].rank,r[c].rank)}i.push(r[d]);return i}function i(r,n,t){var a=[],i=r[n],f=t-1,u=t,h=r[f],c=r[u],d=h?h.rank:undefined,k=c?c.rank:undefined;try{i.rank=e(d,k)}catch(n){a=a.concat(o(r,f,u));i.rank=e(d,k)}a.push(i);return a}return{reorder:i}});
/*!
 * 
		SAP UI development toolkit for HTML5 (SAPUI5)
		(c) Copyright 2009-2015 SAP SE. All rights reserved
	
 */
sap.ui.predefine("sap/insights/utils/CardSkeletonManifest", [],function(){"use strict";return{_version:"1.20.0","sap.app":{id:"card.explorer.integration.hostContext",type:"card",title:"Sample of an Object Card",subTitle:"Sample of an Object Card",applicationVersion:{version:"1.0.0"},shortTitle:"A short title for this card",info:"Additional information about this card",description:"A long description for this card",tags:{keywords:["host","Context","Card","Sample"]}},"sap.card":{type:"Object",header:{type:"Numeric",title:"{data}",subTitle:"{data}",icon:{src:"{data}",size:"XS"},dataTimestamp:"",unitOfMeasurement:"{data}",mainIndicator:{number:"{data}",unit:"{data}",trend:"{data}"},details:"{data}"},content:{maxItems:"15",item:{title:"{data}",description:"{data}"}}}}});
/*!
 * 
		SAP UI development toolkit for HTML5 (SAPUI5)
		(c) Copyright 2009-2015 SAP SE. All rights reserved
	
 */
sap.ui.predefine("sap/insights/utils/DeviceType", ["sap/ui/base/Object","sap/ui/Device","./AppConstants"],function(e,i,t){"use strict";var s={phone:240,tablet:600,desktop:1024,xxsmall:240,xsmall:320,small:480,medium:560,large:768,xlarge:960,xxlarge:1120,xxxlarge:1440};var a=e.extend("sap.insights.utils.DeviceType",{});a.getDeviceType=function(){var e;if(i.resize.width>=s.xsmall&&i.resize.width<s.tablet){e=t.DEVICE_TYPES.Mobile}else if(i.resize.width>=s.tablet&&i.resize.width<s.desktop){e=t.DEVICE_TYPES.Tablet}else{e=t.DEVICE_TYPES.Desktop}return e};a.getDialogBasedDevice=function(){var e;if(i.resize.width<1024){e=t.DEVICE_TYPES.Mobile}else{e=t.DEVICE_TYPES.Desktop}return e};a.getDeviceWidth=function(){return i.resize.width};return a});
/*!
 * 
		SAP UI development toolkit for HTML5 (SAPUI5)
		(c) Copyright 2009-2015 SAP SE. All rights reserved
	
 */
sap.ui.predefine("sap/insights/utils/HttpClient", ["./AppConstants"],function(e){"use strict";const t={};t._fetchCSRFToken=function(){return this._executeRequest(e.REPO_BASE_URL,e.HEAD,{})};t.delete=function(t){return this._executeRequest(t,e.DELETE,{})};t.get=function(t){return this._executeRequest(t,e.GET,{})};t.put=function(t,n){return this._executeRequest(t,e.PUT,{},n)};t.post=function(t,n){return this._executeRequest(t,e.POST,{},n)};t._executeRequest=async function(n,s,r,u){let o;if(s!==e.GET&&s!==e.HEAD){o=await t._fetchCSRFToken()}return new Promise((t,i)=>{const a=new XMLHttpRequest;const c={...r};if(s===e.HEAD){c["X-CSRF-Token"]="Fetch"}if(s!==e.GET&&s!==e.HEAD){c["X-CSRF-Token"]=o}if(s===e.POST||s===e.PUT){c["content-type"]="application/json;odata.metadata=minimal;charset=utf-8"}a.open(s,n,true);Object.keys(c).forEach(e=>{a.setRequestHeader(e,c[e])});a.onreadystatechange=this._onReadyStateChange.bind(this,a,s,t,i);if(u){a.send(u)}else{a.send()}})};t._onReadyStateChange=(t,n,s,r)=>{if(t.readyState===4){if(t.status>=200&&t.status<300){if(n===e.HEAD){const e=t.getResponseHeader("x-csrf-token");if(e){s(e)}else{r("No CSRF token found in response header")}}else if(n===e.DELETE){s()}s(JSON.parse(t.responseText))}else{r({error:t?.error||true,message:"unexpected error"})}}};return t},true);
/*!
 * 
		SAP UI development toolkit for HTML5 (SAPUI5)
		(c) Copyright 2009-2015 SAP SE. All rights reserved
	
 */
sap.ui.predefine("sap/insights/utils/InsightsUtils", ["sap/ui/core/Lib"],function(n){"use strict";return{getResourceBundle:function(){if(!this.i18nBundle){this.i18nBundle=n.getResourceBundleFor("sap.insights")}return this.i18nBundle},getDataFromRawValue:function(n){var e=[];var t=[];var i=[];try{t=n.split("\r\n")}catch(n){throw new Error}t.forEach(function(n){if(n!==""){i.push(n)}});var r="";for(var u=1;u<i.length-1;u++){r=i[u].includes("Content-Type: ")?i[u].split("Content-Type: ")[1]:r;if(i[u+1].includes(i[0])){if(r==="application/json"){i[u]=JSON.parse(i[u]);e.push(i[u])}else{e.push(i[u])}}}return e}}});
/*!
 * 
		SAP UI development toolkit for HTML5 (SAPUI5)
		(c) Copyright 2009-2015 SAP SE. All rights reserved
	
 */
sap.ui.predefine("sap/insights/utils/MetadataAnalyser", [],function(){"use strict";return{getPropertyNamesOfEntitySet:function(t,e){if(!t||!t.getMetaModel){return[]}var a=t.getMetaModel();var r=a.getODataEntitySet(e);var n=[];if(r){var i=a.getODataEntityType(r.entityType);i.property.forEach(function(t){n.push(t.name)})}return n},getParameterisedEntitySetByEntitySet:function(t,e){if(!t||!t.getMetaModel){return}var a=t.getMetaModel();var r=a.getODataEntitySet(e);if(r){var n=a.getODataEntityType(r.entityType);var i=n.navigationProperty;if(!i){return}var o=i.filter(function(t){var e=a.getODataAssociationEnd(n,t.name);var r=a.getODataEntityType(e.type);return r["sap:semantics"]==="parameters"&&r.key});if(o&&o.length){return a.getODataAssociationSetEnd(n,o[0].name).entitySet}}return},getPropertyFilterRestrictionByEntitySet:function(t,e,a){if(!t||!t.getMetaModel){return false}var r=t.getMetaModel();var n=r.getODataEntitySet(e);if(n){var i=r.getODataEntityType(n.entityType);var o;o=i.property.find(function(t){return t.name===a});if(o&&o["sap:filter-restriction"]&&o["sap:filter-restriction"]==="single-value"){return true}}return false},isDate:function(t,e,a){if(!t||!t.getMetaModel){return false}var r=t.getMetaModel(),n=r.getODataEntitySet(e);if(!n){return false}var i=r.getODataEntityType(n.entityType),o=i.property.find(function(t){return t.name===a});return o&&o.type==="Edm.DateTime"},isValueListWithFixedValues:function(t,e,a){if(!t||!t.getMetaModel){return false}var r=t.getMetaModel(),n=r.getODataEntitySet(e),i,o;if(n){var u=r.getODataEntityType(n.entityType),y=u.property.find(function(t){return t.name===a}),f="com.sap.vocabularies.Common.v1.ValueList",s="com.sap.vocabularies.Common.v1.ValueListWithFixedValues",l=y&&y[f],p=y&&y[s],g=y&&y["sap:value-list"];i=l&&g==="fixed-values";o=!!p&&p.Bool==="true"}return i||o||false}}});
/*!
 * 
		SAP UI development toolkit for HTML5 (SAPUI5)
		(c) Copyright 2009-2015 SAP SE. All rights reserved
	
 */
sap.ui.predefine("sap/insights/utils/SelectionVariantHelper", ["sap/base/security/encodeURL","sap/m/Token","sap/ui/core/CustomData","sap/fe/navigation/SelectionVariant"],function(e,a,t,r){"use strict";var n=function(e){return"("+e+")"};var o=function(e,a,t){var r="or";var o=a;if(t==="E"){o=["not",n(a)].join(" ");r="and"}if(e===""){return o}return[e,r,o].join(" ")};var i=function(e,a){if(a==="number"){return e+"m"}if(!(a==="integer"||a==="boolean"||a==="datetime")){return"'"+e+"'"}return e};var u=function(e,a,t,r){var u="";a.forEach(function(a){var s;switch(a.Option){case"BT":s=n([e,"ge",i(a.Low,r),"and",e,"le",i(a.High,r)].join(" "));break;case"CP":if(a.Low.match(/^[*]\\*(.*)\\*[*]$/)){a.Low=a.Low.slice(1,-1)}s="substringof("+i(a.Low,r)+","+e+")";break;default:s=[e,a.Option.toLowerCase(),i(a.Low,r)].join(" ");break}u=o(u,s,t)});return u};var s=function(e,a,t){var r=[],o=[];a.forEach(function(e){if(e.Sign==="I"){if(e.Option==="NE"){o.push(e)}else{r.push(e)}}else{if(e.Option==="NE"){r.push(e)}else{o.push(e)}}});var i=u(e,r,"I",t);var s=[];if(i){s.push(n(i))}var c=u(e,o,"E",t);if(c){s.push(n(c))}return s.join(" and ")};var c=function(a,t){var r=[];a.getSelectOptionsPropertyNames().forEach(function(e){r.push(s(e,a.getSelectOption(e),t[e]))});return r.length?"$filter="+e(r.join(" and ")):null};var f=function(a,t){var r="";a.getParameterNames().forEach(function(e){if(r!==""){r+=","}r+=e+"=";var n=a.getParameter(e);r+=i(n,t[e])});return r===""?null:n(e(r))};var v=function(e){var a=e.Option;switch(e.Option){case"CP":var t=e.Low;var r=t.indexOf("*")===0;var n=t.indexOf("*",1)===t.length-1;if(r&&!n){a="StartsWith"}else if(!r&&n){a="EndsWith"}else if(r&&n){a="Contains"}break;case"EQ":if(e.Low===""){a="Empty"}break}return a};var w=function(e,a){return new t({key:"range",value:{exclude:e.Sign==="E",keyField:a,operation:v(e),value1:e.Option==="CP"?e.Low.replace(/\*/g,""):e.Low,value2:e.High}})};var l=function(e,r){var o=[];var i=0;e.forEach(function(e){var u="";var s="";switch(e.Option){case"BT":u+=e.Low+" .. "+e.High;s="range_"+i++;break;case"CP":u+=e.Low;s="range_"+i++;break;case"EQ":if(e.Low===""){u+="<EMPTY>";s="<EMPTY>"}else{u+=e.Text?e.Text:e.Low;s=e.Low}break;case"NE":u+="!"+e.Low;s="range_"+i++;break;case"GT":u+=">"+e.Low;s="range_"+i++;break;case"GE":u+=">="+e.Low;s="range_"+i++;break;case"LT":u+="<"+e.Low;s="range_"+i++;break;case"LE":u+="<="+e.Low;s="range_"+i++;break}if(e.Sign==="E"){u="!"+n(u)}var c=new a({key:s,text:e.Text?e.Text:u});if(s!==e.Low){c.addCustomData(w(e,r))}c.addCustomData(new t({key:"selectOption",value:e}));o.push(c)});return o};var p=function(){var e=new r;return e.toJSONString()};var L=function(e){switch(e.Option){case"BT":e.Text+=e.Low+" .. "+e.High;break;case"EQ":if(e.Low===""){e.Text+="<EMPTY>"}else{e.Text+=e.Low}break;case"NE":e.Text+="!"+e.Low;break;case"GT":e.Text+=">"+e.Low;break;case"GE":e.Text+=">="+e.Low;break;case"LT":e.Text+="<"+e.Low;break;case"LE":e.Text+="<="+e.Low;break;default:e.Text+=e.Low;break}return e.Text};var g=function(e,a){var t={Sign:e.exclude?"E":"I",Option:e.operation,Low:e.value1.toString(),High:e.value2?e.value2.toString():"",Text:a?a:""};switch(e.operation){case"Contains":t.Option="CP";if(e.value1){t.Low="*"+e.value1+"*"}break;case"StartsWith":t.Option="CP";if(e.value1){t.Low=e.value1+"*"}break;case"EndsWith":t.Option="CP";if(e.value1){t.Low="*"+e.value1}break;case"Empty":t.Option="EQ";t.Low="";break}if(!t.Text){t.Text=L(t)}return t};return{getFilterQueryFromSV:c,getParameterQueryFromSV:f,getTokenFromSelectOptions:l,getEmptySVStringforProperty:p,getSelectOptionFromRange:g}});
/*!
 * 
		SAP UI development toolkit for HTML5 (SAPUI5)
		(c) Copyright 2009-2015 SAP SE. All rights reserved
	
 */
sap.ui.predefine("sap/insights/utils/Transformations", ["sap/ui/base/BindingParser"],function(e){var t=function(t){var r=e.complexParser(t);return r.path||r.parts&&r.parts[0].path};var r={bar_series:["bar","column","line","bullet","stacked_bar","stacked_column","vertical_bullet","100_stacked_bar","100_stacked_column","waterfall","horizontal_waterfall","area","radar"],pie_series:["pie","donut"]};var a={bar_series:r["bar_series"].concat("combination","stacked_combination","horizontal_stacked_combination"),pie_series:r["pie_series"],dual_series:["dual_bar","dual_column","dual_line","dual_stacked_bar","dual_stacked_column","dual_combination","dual_horizontal_combination","dual_stacked_combination","dual_horizontal_stacked_combination","100_dual_stacked_bar","100_dual_stacked_column"],scatter_series:["scatter"],heatmap_series:["heatmap"],bubble_series:["bubble"]};var n=function(e){var t=e.content.measures.length;return t>1?a:r};var i=function(e,t){var r=null;var a=Object.keys(t);a.forEach(function(a){if(t[a].includes(e)){r=a}});return r};var s=function(e,t){var r=[];t.forEach(function(t){var a=JSON.parse(e);var n=a["sap.card"];var i=n.content;i.chartType=t;r.push(a)});return r};var u=function(e,t){var r=JSON.parse(e);var a=r["sap.card"];var n=a.content;if(n.chartProperties&&n.chartProperties.legend){n.chartProperties.legend["visible"]=false}n.feeds=[{uid:"categoryAxis",type:"Dimension",values:n.dimensions.map(function(e){return e.label||e.name})},{uid:"valueAxis",type:"Measure",values:n.measures.map(function(e){return e.label||e.name})}];return s(JSON.stringify(r),t)};var l=function(e,t){var r=JSON.parse(e);var a=r["sap.card"];var n=a.content;if(n.chartProperties&&n.chartProperties.legend){n.chartProperties.legend["visible"]=true}n.feeds=[{uid:"size",type:"Measure",values:n.measures.map(function(e){return e.label||e.name})},{uid:"color",type:"Dimension",values:n.dimensions.map(function(e){return e.label||e.name})}];return s(JSON.stringify(r),t)};var c=function(e,t){var r=JSON.parse(e);var a=r["sap.card"];var n=a.content;if(n.chartProperties&&n.chartProperties.legend){n.chartProperties.legend["visible"]=false}n.feeds=[{uid:"categoryAxis",type:"Dimension",values:n.dimensions.map(function(e){return e.label||e.name})}].concat(n.measures.map(function(e,t){return{uid:"valueAxis"+(t===0?"":t+1),type:"Measure",values:[e.label||e.name]}}));return s(JSON.stringify(r),t)};var o=function(e,t){var r=JSON.parse(e);var a=r["sap.card"];var n=a.content;if(n.chartProperties&&n.chartProperties.legend){n.chartProperties.legend["visible"]=false}n.feeds=[{uid:"color",type:"Dimension",values:n.dimensions.map(function(e){return e.label||e.name})}].concat(n.measures.map(function(e,t){var r="valueAxis";if(t!==0){if(t===1){r="valueAxis2"}else{if(t!==n.measures.length-1){r=r+(t+1)}if(t===n.measures.length-1){r="bubbleWidth"}}}return{uid:r,type:"Measure",values:[e.label||e.name]}}));return s(JSON.stringify(r),t)};var f=function(e,t){var r=JSON.parse(e);var a=r["sap.card"];var n=a.content;if(n.chartProperties&&n.chartProperties.legend){n.chartProperties.legend["visible"]=true}n.feeds=[{uid:"color",type:"Measure",values:[n.measures[0].name||n.measures[0].label]},{uid:"categoryAxis",type:"Dimension",values:n.dimensions.map(function(e){return e.name||e.label})}];return s(JSON.stringify(r),t)};var d=function(e,t){var r=JSON.parse(e);var a=r["sap.card"];var n=a.content;if(n.measures.length<3){return null}if(n.chartProperties&&n.chartProperties.legend){n.chartProperties.legend["visible"]=true}n.feeds=[{uid:"color",type:"Dimension",values:[n.dimensions[0].name||n.dimensions[0].label]},{uid:"valueAxis",type:"Measure",values:[n.measures[0].name||n.measures[0].label]},{uid:"valueAxis2",type:"Measure",values:[n.measures[1].name||n.measures[1].label]},{uid:"bubbleWidth",type:"Measure",values:[n.measures[2].name||n.measures[2].label]}];return s(JSON.stringify(r),t)};var p=function(e,t,r){switch(t){case"bar_series":return u(e,r);case"pie_series":return l(e,r);case"dual_series":return c(e,r);case"scatter_series":return o(e,r);case"heatmap_series":return f(e,r);case"bubble_series":return d(e,r);default:return null}};function v(e,t){var r=n(e["sap.card"]);var a=e["sap.card"].content.chartType;var u=JSON.stringify(e);var l=[];var c=Object.keys(r);if(t&&Array.isArray(t)&&t.length){t.forEach(function(e){var t=i(e,r);if(t){l=l.concat(p(u,t,[e]))}else{l.push(null)}})}else{if(e["sap.card"].data){e["sap.card"].data.request["timeout"]=1e5}c.forEach(function(e){var t=r[e];if(t.includes(a)){l=l.concat(s(u,t))}else{l=l.concat(p(u,e,t))}})}return l}var h=[function e(t){return t},function e(t){var r=t["sap.card"].content.item;if(r.chart){if(!r.info&&r.chart.displayValue){r.info={value:r.chart.displayValue};if(r.chart.color){r.info.state=r.chart.color}}delete r.chart;return t}return null},function e(t){var r=t["sap.card"].content.item;if(r.info){delete r.info;return t}return null},function e(t){var r=t["sap.card"].content.item;if(r.attributes&&r.attributes.length>0){delete r.attributes;delete r.attributesLayoutType;return t}return null},function e(r){var a=r["sap.card"].content.item;if(a.info){r["sap.card"].content.group={title:a.info.value,order:{path:t(a.info.value),dir:"DESC"}};delete a.info;return r}return null},function e(r){var a=r["sap.card"].content.item;if(a.attributes&&a.attributes.length>0){r["sap.card"].content.group={title:a.attributes[0].value,order:{path:t(a.attributes[0].value),dir:"DESC"}};delete a.attributes;delete a.attributesLayoutType;return r}return null},function e(t){var r=t["sap.card"].content;var a=r.item;var n=[];var i=[];if(a.title){n.push(a.title.value?a.title:{value:a.title})}if(a.actions&&a.actions.length){i=i.concat(a.actions)}if(a.chart&&a.chart.displayValue){n.push({value:a.chart.displayValue});if(a.chart.color){n[n.length-1].state=a.chart.color}}if(a.attributes&&a.attributes.length>0){n=n.concat(a.attributes)}if(a.info){n.push(a.info)}if(n.length>0){r.row={columns:n};if(i.length>0){r.row["actions"]=i}if(a.highlight){r.row["highlight"]=a.highlight;if(a.highlightText){r.row["highlightText"]=a.highlightText}}delete r.item;t["sap.card"].type="Table";return t}return null}];function m(e,t){var r=JSON.stringify(e);return t.map(function(e){var t=JSON.parse(r);return e(t)})}function b(e){return m(e,h)}var g=[function e(t){return t},function e(t){var r=t["sap.card"].content;var a={attributesLayoutType:"OneColumn"};var n=r.row.columns||[];if(n.length>0){if(r.row.highlight){a.highlight=r.row.highlight;if(r.row.highlightText){a.highlightText=r.row.highlightText}}n.forEach(function(e,t){a.attributes=a.attributes||[];a.attributes.push(e)});if(r.row.actions&&r.row.actions.length){a["actions"]=r.row.actions}t["sap.card"].type="List";r.item=a;delete r.row;return t}return null}];function _(e){return m(e,g)}var y=[function e(t){var r=t["sap.card"].content;var a=r.data;var n=r.dimensions||[];var i=r.measures||[];var s=n.map(function(e){return{title:e.label,value:e.displayValue||e.value}});s=s.concat(i.map(function(e){return{title:e.label,value:e.value}}));if(s.length>0){t["sap.card"].type="Table";t["sap.card"].content={data:a,row:{columns:s}};return t}return null}];function O(e){return m(e,y)}function P(e,t){if(e["sap.card"].type==="List"){const r=e["sap.card"].content.item.attributes;r.forEach(e=>{if(t.includes(e.title)){e.visible=true}});const a=r.findIndex(e=>e.identifier);const n=r[a];if(n?.visible===true){e["sap.card"].content.item.title=n}}return e}function S(e){if(!e){return[]}const t=e["sap.card"].content?.item?.attributes?.some(e=>e.visible);if(t){return[]}return e["sap.card"].content?.item?.attributes?.map(e=>e.title).slice(0,3)||[]}return{transformAnalyticalManifest:v,createListOptions:b,createTableOptions:_,createChartToListOrTableOptions:O,selectColumnsForListCard:P,getDefaultColumns:S}});
/*!
 * 
		SAP UI development toolkit for HTML5 (SAPUI5)
		(c) Copyright 2009-2015 SAP SE. All rights reserved
	
 */
sap.ui.predefine("sap/insights/utils/UrlGenerateHelper", ["../utils/SelectionVariantHelper","sap/fe/navigation/SelectionVariant","sap/m/DynamicDateUtil","sap/ui/comp/util/DateTimeUtil","sap/ui/core/format/DateFormat","../utils/AppConstants","sap/ui/model/odata/v2/ODataModel","sap/ui/core/date/UI5Date","sap/ui/comp/odata/type/StringDate"],function(e,a,t,r,i,n,o,s,u){function l(t,r,i){var n=t.descriptorContent["sap.card"].configuration.parameters;var o=t.descriptorContent["sap.card"]["data"]["request"];var s=false,u={},l={};if(o&&o.batch){s=true;u=o.batch.header||{};l=o.batch.content||{}}var T=t&&n._headerDataUrl,D=t&&n._contentDataUrl;var g=new a;var h=n._relevantODataFilters.value;var E=n._relevantODataParameters.value;var S=f(n);c(n,g,false);p(n,g,false);var y=n._entitySet.value;var A=y;if(E.length){var O={};E.forEach(function(e){O[e]=n[e].type});A+=e.getParameterQueryFromSV(g,O);var I=A;if(I&&Array.isArray(I.match(/%27datetime[a-zA-Z0-9%-:]*[,)%2c]/gm))&&I.match(/%27datetime[a-zA-Z0-9%-:]*[,)%2c]/gm).length){A=d(I)}}if(n._urlSuffix.value){A+=n._urlSuffix.value}var L={};h.forEach(function(e){L[e]=n[e].type});var M=e.getFilterQueryFromSV(g,L);var H=M;if(H&&Array.isArray(H.match(/%27datetime[a-zA-Z0-9%-:]*[,)%2c]/gm))&&H.match(/%27datetime[a-zA-Z0-9%-:]*[,)%2c]/gm).length){M=d(H)}var w="",_="",R="",V="",N={header:"",content:""};if(s){w=m(n,"_header",M,t.descriptorContent["sap.card"].type);_=w?A+"?"+w:A;if(T&&T.value){var P=v(S,_);if(P){u.url="{= extension.formatters.formatHeaderDataUrlForSemanticDate() }";T.value=""}else{T.value=_;if(r){r._headerDataUrl=T.value}}}else if(T){if(r&&!i){T.value=_;r._headerDataUrl=T.value}N.header=_}}if(n._contentDataUrl){R=m(n,"_content",M,t.descriptorContent["sap.card"].type);V=R?A+"?"+R:A;if(n._contentDataUrl.value){var Q=v(S,V);if(Q){if(s){l.url="{= extension.formatters.formatContentDataUrlForSemanticDate() }"}else{o.url="{= extension.formatters.formatContentDataUrlForSemanticDate() }"}D.value=""}else{D.value=V;if(r){r._contentDataUrl=D.value}}}else{if(r&&!i){D.value=V;r._contentDataUrl=D.value}N.content=V;return N}if(i){N.header=_;N.content=V;return N}}}function f(e){var a=e._semanticDateRangeSetting,t=[];if(a){a=JSON.parse(a.value);t=Object.keys(a)||[]}return t}function c(e,t,r,i){var n=f(e);var s=e._relevantODataFilters.value;s.forEach(function(s){var u=new a(e[s].value);var l=u.getSelectOption(s);var f=[];if(l&&l.length){if(n.includes(s)){f=T(l[0],"Filter",e[s].type,r);if(f.length){l[0].Low=f[0];l[0].High=f[1]?f[1]:null;if(l[0].Low&&l[0].High&&l[0].Option!=="BT"){l[0].Option="BT"}t.massAddSelectOption(s,l)}else if(o&&o.prototype.formatValue&&l[0]){l[0].Low=o.prototype.formatValue(l[0].Low,"Edm.DateTime");if(l[0].High){l[0].High=o.prototype.formatValue(l[0].High,"Edm.DateTime")}t.massAddSelectOption(s,l)}}else{if(o&&o.prototype.formatValue&&l[0]&&e[s].type==="datetime"){l[0].Low=o.prototype.formatValue(l[0].Low,"Edm.DateTime");if(l[0].High){l[0].High=o.prototype.formatValue(l[0].High,"Edm.DateTime")}t.massAddSelectOption(s,l)}t.massAddSelectOption(s,l)}if(r&&l.length===1&&l[0].Sign==="I"&&l[0].Option!=="EQ"){delete i.ibnParams[s]}}})}function p(e,a,t,r){var i=f(e);var n=e._relevantODataParameters.value;n.forEach(function(n){var u="";if(e[n].value){if(e[n].value.value||typeof e[n].value.value=="string"){u=e[n].value.value.toString()}else if(e[n].value instanceof Date){u=e[n].value}else{u=e[n].value.toString()}}if(e[n].type==="datetime"&&!i.includes(n)&&!u.includes("datetime")){if(o&&o.prototype.formatValue){u=o.prototype.formatValue(u,"Edm.DateTime");a.addParameter(n,u)}}else if(e[n].type==="datetime"&&i.includes(n)){u=typeof e[n].value==="string"&&Date.parse(e[n].value)?T(s.getInstance(u),"Parameter",e[n].type,t):T(u,"Parameter",e[n].type,t);if(u[0]){a.addParameter(n,u[0])}else{a.addParameter(n,"")}}else{a.addParameter(n,u)}if(t){r.ibnParams[n]=u}})}function v(e,a){var t=e.length?e:[];if(t.length&&a){return t.some(function(e){return a&&a.indexOf(e)>-1})}}function m(e,a,t,r){var i=[];if(t){i.push(t)}if(e[a+"SelectQuery"]&&e[a+"SelectQuery"].value){i.push(e[a+"SelectQuery"].value)}if(e[a+"ExpandQuery"]&&e[a+"ExpandQuery"].value){i.push(e[a+"ExpandQuery"].value)}if(e[a+"SortQuery"]&&e[a+"SortQuery"].value){var n=e[a+"SortQuery"].value;i.push(decodeURI(n)===n?encodeURI(n):n)}if(r==="Table"||r==="List"){i.push("$inlinecount=allpages");i.push("$skip=0&$top=13")}else{if(e[a+"TopQuery"]&&e[a+"TopQuery"].value){i.push(e[a+"TopQuery"].value)}if(e[a+"SkipQuery"]&&e[a+"SkipQuery"].value){i.push(e[a+"SkipQuery"].value)}}return i.length?i.join("&"):null}function d(e){var a=e.match(/%27datetime[a-zA-Z0-9%-:]*[,)%2c]/gm).length;var t=function(){var a=e.match(/%27datetime[a-zA-Z0-9%-:]*[,)%2c]/gm)[0];var t=a;t=t.replace("%27","");var r=t.lastIndexOf("%27");var i=t.substr(0,r)+t.substr(r+3,t.length-1);return i};for(var r=0;r<a;r++){e=e.replace(e.match(/%27datetime[a-zA-Z0-9%-:]*[,)%2c]/gm)[0],t)}return e}function T(e,a,r,i){var o,s=[],l=[],f=false;if(a==="Parameter"){o=e}else if(a==="Filter"){e=typeof e==="string"?JSON.parse(e):e;o=e.Low;if(n.DATE_OPTIONS.SPECIAL_RANGE.includes(o)){s=e.High.split(",")}}var c,p=new u;if(n.DATE_OPTIONS.RANGE_OPTIONS.includes(o)||n.DATE_OPTIONS.SINGLE_OPTIONS.includes(o)){if(a==="Filter"){c=t.toDates({values:s,operator:o});if(r.toLowerCase()==="string"||r.toLowerCase()==="edm.string"){l.push(p.parseValue(c[0].oDate));l.push(p.parseValue(c[1].oDate));return l}else{l.push(c[0].oDate);l.push(c[1].oDate)}}else{c=t.toDates({values:s,operator:o});if(r.toLowerCase()==="string"||r.toLowerCase()==="edm.string"){l.push(p.parseValue(c[0].oDate));return l}l.push(c[0].oDate)}}if(["DATETIMERANGE","FROMDATETIME","TODATETIME","DATETIME"].includes(o)){f=true}if(l.length){l=D(l,!i,f);return l}else if(Date(e)instanceof Date||e instanceof Date||Date.parse(e)){return D([e],!i,f)}else if(r.toLowerCase()==="string"&&p.formatValue(e.Low)){var v=p.formatValue(e.Low);if(v.oDate&&v.oDate instanceof Date){l.push(p.parseValue(v.oDate));if(e.High&&p.formatValue(e.High)&&p.formatValue(e.High).oDate instanceof Date){l.push(p.parseValue(p.formatValue(e.High).oDate))}return l}}return[]}function D(e,a,t){var n;e.forEach(function(o,u){if(o.match){if(o.match(/^(\d{4}-\d{2}-\d{2}T\d{2}:\d{2}:\d{2}.\d{3})Z?$/gm)&&o.match(/^(\d{4}-\d{2}-\d{2}T\d{2}:\d{2}:\d{2}.\d{3})Z?$/gm).length){o=s.getInstance(o)}}o=r.localToUtc(o);if(!t){o=r.normalizeDate(o,true)}if(a){n=i.getDateInstance({pattern:"'datetime'''yyyy-MM-dd'T'HH:mm:ss''",calendarType:"Gregorian"});e[u]=n.format(o,true)}else{var l=i.getDateInstance({pattern:"''yyyy-MM-dd'T'HH:mm:ss.SSS''",calendarType:"Gregorian"});var f=o instanceof Date?o:s.getInstance(o);var c=l.format(f);e[u]=String(c).replace(/'/g,"")}});return e}function g(e,a,r){var i=r;if(e&&a){var n=e.operator;if(n!=="DATE"){return n}else{return e.values[0]}}if(!a){var o=e.operator;var s=e.values;var u="";if(o){switch(o){case"DATE":case"DATERANGE":case"SPECIFICMONTH":case"DATETIMERANGE":case"DATETIME":u="";if(typeof i==="string"){u=i}var l=t.toDates(e);s=l;var f=D(s,false,o==="DATETIMERANGE"||o==="DATETIME");if(!f[1]){f[1]=""}var c={Low:f[0],High:f[1],Option:"BT",Text:u};if(c){c.Text=u;return c}break;case"FROM":case"TO":case"FROMDATETIME":case"TODATETIME":u="";if(typeof i==="string"){u=i}var p=D(s,false,o==="FROMDATETIME"||o==="TODATETIME"),v;v=o==="FROM"||o==="FROMDATETIME"?"GE":"LE";var m={Low:p[0],High:"",Option:v,Text:u};if(m){m.Text=u;return m}break;case"LASTDAYS":case"LASTWEEKS":case"LASTMONTHS":case"LASTQUARTERS":case"LASTYEARS":case"NEXTDAYS":case"NEXTWEEKS":case"NEXTMONTHS":case"NEXTQUARTERS":case"NEXTYEARS":u="";if(typeof i==="string"){u=i}return{Low:o,High:s[0].toString(),Option:"BT",Text:u};case"TODAYFROMTO":u="";if(typeof i==="string"){u=i}var d=s&&s[0];var T=s&&s[1];return{Low:o,High:d.toString()+","+T.toString(),Option:"BT",Text:u};default:u="";if(typeof i==="string"){u=i.substring(0,i.indexOf("(")-1)}return{Low:o,High:null,Option:"EQ",Text:u}}}}}function h(e,t){var r=t.configuration.parameters,i=new a;c(r,i,true,e);p(r,i,true,e);return e}return{processPrivateParams:l,formatSemanticDateTime:T,getDateRangeValue:g,semanticDateProcess:h}});
/*!
 * 
		SAP UI development toolkit for HTML5 (SAPUI5)
		(c) Copyright 2009-2015 SAP SE. All rights reserved
	
 */
sap.ui.predefine("sap/insights/utils/V4MetadataAnalyser", [],function(){"use strict";return{_search:function(t,e){return e?e.split("/").reduce(function(t,e){return t&&e?t[e]:t},t):undefined},getAnnotations:function(t,e,n,r){return this._fetchEntitySetName(t,e,n).then(function(e){return Promise.all(r.map(function(r){return this.getMetadataProperty(t,e,n,r)}.bind(this)))}.bind(this))},_fetchEntitySetName:function(t,e,n){var r=this._search(e,"/sap.card/configuration/parameters/_entitySet/value"),i=this._search(e,"/sap.card/configuration/parameters/_relevantODataParameters/value"),a=this._search(e,"/sap.insights/filterEntitySet"),s="";return this.getMetadataProperty(t,r).then(function(e){if(e){if(Object.keys(e).includes(n)){s=r}else if(!i.includes(n)){s=a}else{var u=this._search(e,"/Parameters/$Type"),c=u.split("."),h=c[c.length-1];return this.getMetadataProperty(t,h).then(function(t){return Object.keys(t).includes(n)?h:a})}}return s}.bind(this))},getMetadataProperty:function(t,e,n,r){if(!t||!t.getMetaModel){return false}return t.getMetaModel().requestObject("/"+e+"/"+(n||"")+(r||""))}}});
/*!
 * 
		SAP UI development toolkit for HTML5 (SAPUI5)
		(c) Copyright 2009-2015 SAP SE. All rights reserved
	
 */
sap.ui.predefine("sap/insights/utils/oDataModelProvider", ["sap/ui/model/odata/v2/ODataModel","sap/ui/model/odata/v4/ODataModel","./AppConstants"],function(e,t,n){var a={};function i(a){var i=a.filterService;var r=i&&i.uri;var o=i&&i.settings;var s=[];if(o){if(o.annotations&&o.annotations.length){o.annotations.forEach(function(e){var t=a[e];var n=t.uri;s.push(n)})}if(o.odataVersion===n.ODATA_VERSION_2){return new e(r,{annotationURI:s,loadAnnotationsJoined:true})}else if(o.odataVersion===n.ODATA_VERSION_4){return new t({serviceUrl:r,annotationURI:s})}}}function r(e){var t=e.filterService;var r=t&&t.uri;var o=t&&t.settings;var s=i(e);a[r]={oData:s,loaded:undefined};if(o.odataVersion===n.ODATA_VERSION_2){return new Promise(function(e){if(s){s.attachMetadataLoaded(function(t){return t.getSource().getMetaModel().loaded().then(function(){a[r].loaded=true;e(a[r])})});s.attachMetadataFailed(function(){a[r].loaded=false;e(a[r])})}else{e(a[r])}})}else if(o.odataVersion===n.ODATA_VERSION_4){return new Promise(function(e){s.getMetaModel().requestData().then(function(){a[r].loaded=true}).catch(function(){a[r].loaded=false}).finally(function(){e(a[r])})})}}function o(e){if(e.filterService&&e.filterService.uri){var t=e.filterService,i=e.filterService.uri;if(a[i]){return Promise.resolve(a[i])}else if(t.settings&&t.settings.odataVersion===n.ODATA_VERSION_2){return r(e)}else if(t.settings&&t.settings.odataVersion===n.ODATA_VERSION_4){return r(e)}}else{return Promise.resolve(undefined)}}return{getOdataModel:o}});
sap.ui.require.preload({
	"sap/insights/manifest.json":'{"_version":"1.21.0","sap.app":{"id":"sap.insights","type":"library","embeds":[],"applicationVersion":{"version":"1.141.0"},"title":"SAP UI library: sap.insights","description":"SAP UI library: sap.insights","ach":"CA-FLP-EXT-INS","resources":"resources.json","offline":true},"sap.ui":{"technology":"UI5","supportedThemes":["base","sap_belize","sap_belize_base","sap_belize_hcb","sap_belize_hcw","sap_belize_plus","sap_bluecrystal","sap_bluecrystal_base","sap_fiori_3","sap_fiori_3_dark","sap_fiori_3_hcb","sap_fiori_3_hcw","sap_hcb","sap_horizon","sap_horizon_dark","sap_horizon_hcb","sap_horizon_hcw"]},"sap.ui5":{"dependencies":{"minUI5Version":"1.141","libs":{"sap.ui.core":{"minVersion":"1.141.0"},"sap.viz":{"minVersion":"1.141.0","lazy":true},"sap.m":{"minVersion":"1.141.0"},"sap.ui.integration":{"minVersion":"1.141.0","lazy":true},"sap.f":{"minVersion":"1.141.0"},"sap.ui.layout":{"minVersion":"1.141.0","lazy":true}}},"library":{"i18n":{"bundleUrl":"messagebundle.properties","supportedLocales":["","ar","bg","ca","cnr","cs","cy","da","de","el","en","en-GB","en-US-sappsd","en-US-saprigi","en-US-saptrc","es","es-MX","et","fi","fr","fr-CA","hi","hr","hu","id","it","iw","ja","kk","ko","lt","lv","mk","ms","nl","no","pl","pt","pt-PT","ro","ru","sh","sk","sl","sr","sv","th","tr","uk","vi","zh-CN","zh-TW"]},"content":{"controls":["sap.insights.ManageCards"],"elements":[],"types":[],"interfaces":[]}}}}'
});
//# sourceMappingURL=library-preload.js.map
