/*!
 * 
		SAP UI development toolkit for HTML5 (SAPUI5)
		(c) Copyright 2009-2015 SAP SE. All rights reserved
	
 * This code handles S/4 cards in SAP Start and SAP Mobile Start
 */
sap.ui.define(["sap/ushell/utils/UrlParsing","sap/base/Log","sap/ui/core/Configuration"],function(a,t,e){"use strict";var r="(runtimeURL)";var n=e.getSAPLogonLanguage();var i=function(){var a="ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789";var t="";var e=new window.Uint32Array(40);window.crypto.getRandomValues(e);var r=function(t){var r=e[t]%a.length;return a[r]};while(t.length<40){t+=r(t.length)}return t};var s=function(t,e){var r=JSON.parse(JSON.stringify(t)),n="",i={};if(r.ibnParams&&r.ibnParams["sap-xapp-state-data"]){delete r.ibnParams["sap-xapp-state-data"]}i={target:r.ibnTarget,params:r.ibnParams};if(e){i.appStateKey=e}n=a.constructShellHash(i);n=encodeURI(n);n="#"+n;return n};var o=function(a){var t;if(a){var e=a.getHostInstance();if(e){t=e.getDestination(r,a)}}if(!t){t=Promise.reject("S/4 runtime destination URL could not be determined!")}return t};var u=async function(a,e){var r=a;if(r.indexOf("?")<0){r+="?"}else{r+="&"}r+="sap-language="+n;try{var i=e?await(e.getHostInstance()?.getContextValue("navigation/flp/defaultQueryParams/value")):null;if(i){i=JSON.parse(i);var s=Object.keys(i);if(s.length){s.forEach(function(a,t){r+="&"+a+"="+i[a]})}}}catch(a){t.error(a)}return r};var p=function(a,e,r){var n={id:e,sessionKey:"",component:"",appName:"",value:r.replaceAll("{","\\{")};return a.request({url:"{{destinations.service}}/sap/opu/odata/UI2/INTEROP/GlobalContainers",method:"POST",parameters:n,headers:{Accept:"application/json","X-CSRF-Token":"{{csrfTokens.token1}}","content-type":"application/json"}}).then(function(a){return}).catch(function(a){t.error("FAILED to save sap-xapp-state-data in S/4")})};var c=async function(a){if(a.getParameter("type")!=="Navigation"){return}var e=this.getCard();var r=a.getParameter("parameters");if(r&&r.url){return}var n=r&&r.ibnParams&&r.ibnParams["sap-xapp-state-data"];var c=n?i():"";var l=s(r,c);if(l){a.preventDefault(true);if(n){await p(e,c,r.ibnParams["sap-xapp-state-data"])}try{var v=await o(this._oCard);if(v){var f=await u(v,this._oCard);f+=l;this.getCard().triggerAction({type:"Navigation",parameters:{url:f,target:"_blank"}})}}catch(a){t.error(a)}}};var l=function(a){a.attachAction(c.bind(a))};return{initialize:l,_:{createAppStateId:i,getIntent:s,getRuntimeDestinationUrl:o,addQueryParameter:u,saveXAppState:p,handleAction:c}}});
//# sourceMappingURL=HandleNonS4Environment.js.map