/*!
 * OpenUI5
 * (c) Copyright 2025 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["sap/base/assert","sap/base/future","sap/base/Log","sap/base/i18n/LanguageFallback","sap/base/i18n/Localization","sap/base/strings/formatMessage","sap/base/util/Properties","sap/base/util/merge"],function(e,r,t,n,a,o,s,i){"use strict";var l={en_US_saptrc:"1Q",en_US_sappsd:"2Q",en_US_saprigi:"3Q"};var u="en";const c={_oCache:new Map,_oUrlResolutionCache:new Map,_getResolvedUrl(e){const r=document.baseURI+"|"+e;let t=this._oUrlResolutionCache.get(r);if(!t){t=new URL(e,document.baseURI).href;this._oUrlResolutionCache.set(r,t)}return t},_delete(e){this._oCache.delete(e)},_load(e){return s.create(e)},get(e,r,t){let n=this._getResolvedUrl(e);if(r.headers){n+="|"+JSON.stringify(r.headers)}let a=this._oCache.get(n);if(a){if(t){return Promise.resolve(a)}else if(!(a instanceof Promise)){return a}}a=this._load(r);if(a instanceof Promise){a.then(e=>{if(e){this._oCache.set(n,e)}else{this._delete(n)}}).catch(e=>{this._delete(n);throw e})}if(a){this._oCache.set(n,a)}return a}};function f(e){var r;r=a.getLanguage();r=n.normalize(r);return r||e}var h=/^((?:[^?#]*\/)?[^\/?#]*)(\.[^.\/?#]+)((?:\?([^#]*))?(?:#(.*))?)$/;var p=[".properties",".hdbtextbundle"];const d=new Map;function g(e){if(d.has(e)){return d.get(e)}var r=h.exec(e);if(!r||p.indexOf(r[2])<0){throw new Error("resource URL '"+e+"' has unknown type (should be one of "+p.join(",")+")")}const t={url:e,prefix:r[1],ext:r[2],query:r[4],hash:r[5]||"",suffix:r[2]+(r[3]||"")};d.set(e,t);return t}function b(e,t,o,s,i,l,c){this.sLocale=n.normalize(t)||f(l===undefined?u:l);this.oUrlInfo=g(e);this.bIncludeInfo=o;this.bAsync=s;this.aCustomBundles=[];this.aPropertyFiles=[];this.aPropertyOrigins=[];this.aLocales=[];this._aFallbackLocales=n.calculate(this.sLocale,i||a.getSupportedLanguages(),l," of the bundle '"+this.oUrlInfo.url+"'",c);if(s){return m(this).then(()=>this,e=>{r.errorThrows(e.message);return this})}_(this)}b.prototype._enhance=function(e){if(e instanceof b){this.aCustomBundles.push(e)}else{t.error("Custom resource bundle is either undefined or not an instanceof sap/base/i18n/ResourceBundle. Therefore this custom resource bundle will be ignored!")}};b.prototype.getText=function(r,t,n){var a=this._getTextFromProperties(r,t);if(a!=null){return a}a=this._getTextFromFallback(r,t);if(a!=null){return a}if(n){return undefined}else{e(false,"could not find any translatable text for key '"+r+"' in bundle file(s): '"+this.aPropertyOrigins.join("', '")+"'");return this._formatValue(r,r,t)}};b.prototype._formatValue=function(e,t,n){if(typeof e==="string"){if(n!==undefined&&!Array.isArray(n)){r.errorThrows("sap/base/i18n/ResourceBundle: value for parameter 'aArgs' is not of type array")}if(n){e=o(e,n)}if(this.bIncludeInfo){e=new String(e);e.originInfo={source:"Resource Bundle",url:this.oUrlInfo.url,locale:this.sLocale,key:t}}}return e};b.prototype._getTextFromFallback=function(e,r){var t,n;for(n=this.aCustomBundles.length-1;n>=0;n--){t=this.aCustomBundles[n]._getTextFromFallback(e,r);if(t!=null){return t}}while(typeof t!=="string"&&this._aFallbackLocales.length){var a=_(this);if(a){t=a.getProperty(e);if(typeof t==="string"){return this._formatValue(t,e,r)}}}return null};b.prototype._getTextFromProperties=function(e,r){var t=null,n;for(n=this.aCustomBundles.length-1;n>=0;n--){t=this.aCustomBundles[n]._getTextFromProperties(e,r);if(t!=null){return t}}for(n=0;n<this.aPropertyFiles.length;n++){t=this.aPropertyFiles[n].getProperty(e);if(typeof t==="string"){return this._formatValue(t,e,r)}}return null};b.prototype.hasText=function(e){return this.aPropertyFiles.length>0&&typeof this.aPropertyFiles[0].getProperty(e)==="string"};b.prototype._recreate=function(){if(!this._mCreateFactoryParams){var e=new Error("ResourceBundle instance can't be recreated as it has not been created by the ResourceBundle.create factory.");if(this.bAsync){return Promise.reject(e)}else{throw e}}else{return b.create(this._mCreateFactoryParams)}};function m(e){if(e._aFallbackLocales.length){return y(e,true).then(function(r){return r||m(e)})}return Promise.resolve(null)}function _(e){while(e._aFallbackLocales.length){var r=y(e,false);if(r){return r}}return null}function y(e,r){var t=e._aFallbackLocales.shift();if(t!=null){var a=e.oUrlInfo,o,s;if(a.ext===".hdbtextbundle"){if(l[t]){o=a.prefix+a.suffix+"?"+(a.query?a.query+"&":"")+"sap-language="+l[t]+(a.hash?"#"+a.hash:"")}else{o=a.url}s={"Accept-Language":n.convertLocaleToBCP47(t)||"*"}}else{o=t?a.prefix+"_"+t+a.suffix:a.url}var i={url:o,headers:s,async:!!r,returnNullIfMissing:true};const f=c.get(o,i,i.async);var u=function(r){if(r){e.aPropertyFiles.push(r);e.aPropertyOrigins.push(o);e.aLocales.push(t)}return r};return r?f.then(u):u(f)}return r?Promise.resolve(null):null}b._getUrl=function(e,r){var t=e;if(r){r=r.replace(/\./g,"/");t=sap.ui.require.toUrl(r)+".properties"}return t};function v(e,r,t,n,a,o,s){if(!r){return[]}var i=[];r.forEach(function(r){if(r.fallbackLocale===undefined){r.fallbackLocale=o}if(r.supportedLocales===undefined){r.supportedLocales=s}var l=b._getUrl(r.bundleUrl,r.bundleName);var u=new b(l,t,n,a,r.supportedLocales,r.fallbackLocale);i.push(u);if(r.terminologies){i=i.concat(L(e,r.terminologies,t,n,a))}});return i}function L(e,r,t,n,a){if(!e){return[]}e=e.filter(function(e){return r.hasOwnProperty(e)});e.reverse();return e.map(function(e){var o=r[e];var s=b._getUrl(o.bundleUrl,o.bundleName);var i=o.supportedLocales;return new b(s,t,n,a,i,null,true)})}b.create=function(e){var r=i({},e);e=i({url:"",includeInfo:false},e);if(e.bundleUrl||e.bundleName){e.url=e.url||b._getUrl(e.bundleUrl,e.bundleName)}e=b._enrichBundleConfig(e);var t=new b(e.url,e.locale,e.includeInfo,!!e.async,e.supportedLocales,e.fallbackLocale);if(t instanceof Promise){t=t.then(function(e){e._mCreateFactoryParams=r;return e})}else{t._mCreateFactoryParams=r}var n=[];if(e.terminologies){n=n.concat(L(e.activeTerminologies,e.terminologies,e.locale,e.includeInfo,!!e.async))}if(e.enhanceWith){n=n.concat(v(e.activeTerminologies,e.enhanceWith,e.locale,e.includeInfo,!!e.async,e.fallbackLocale,e.supportedLocales))}if(n.length){if(t instanceof Promise){t=t.then(function(e){return Promise.all(n).then(function(r){r.forEach(e._enhance,e)}).then(function(){return e})})}else{n.forEach(t._enhance,t)}}return t};b._enrichBundleConfig=function(e){return e};b._getFallbackLocales=n.getFallbackLocales;b._getPropertiesCache=function(){return c._oCache};return b});
//# sourceMappingURL=ResourceBundle.js.map