/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)
 *  * (c) Copyright 2009-2025 SAP SE. All rights reserved
 */
"use strict";sap.ui.define(["sap/m/Button","sap/m/ComboBox","sap/m/CustomListItem","sap/m/HBox","sap/m/Input","sap/m/List","sap/m/Text","sap/m/VBox","sap/ui/core/Control","sap/ui/core/Element","sap/ui/core/ListItem","sap/ui/core/library","sap/ui/model/Filter","sap/ui/model/Sorter","sap/ui/model/json/JSONModel","../../helpers/IntegrationCardHelper"],function(t,e,i,n,a,o,s,r,l,c,g,d,p,y,u,h){"use strict";const C=d["ValueState"];const m=h["getPreviewItems"];const f=l.extend("sap.cards.ap.generator.app.controls.CriticalityEditor",{renderer:{apiVersion:2,render:function(t,e){if(e.getType()==="COMPACT"){e.addButton.setVisible(false)}t.openStart("div",e);t.openEnd();t.renderControl(e.list);t.renderControl(e.addButton);t.close("div")}},metadata:{properties:{type:"string",selectionKeys:{type:"object",defaultValue:{}},navigationSelectionKeys:{type:"object",defaultValue:{}},items:{type:"object",defaultValue:{}}},aggregations:{list:{type:"sap.m.List",multiple:false,visibility:"hidden"}},events:{change:{parameters:{value:{type:"object"},isCalcuationType:{type:"boolean"},selectedItem:{type:"object"}}},selectionChange:{parameters:{value:{type:"int"}}}}},constructor:function t(e){l.prototype.constructor.call(this,e);this.setCriticalityModel()},init:function i(){this.list=new o({showSeparators:"Inner",showNoData:false});this.propertyComboBox=new e({valueState:"{= ${valueState} }",valueStateText:"{= ${valueStateText} }",selectionChange:t=>{this.handleComboBoxEvents.call(this,t,false)},width:"100%",change:t=>{const e=t.getSource();const i=e.getBindingContext();const n=i?.getPath()||"";const a=this.getModel();const o=a.getProperty(n);this.fireEvent("change",{value:this.getItems(),selectedItem:o,isCalcuationType:a.getProperty(n)?.activeCalculation||false})}});this._idNavigationComboBox=new e({visible:"{= !!${isNavigationForId} }",width:"100%",valueState:"{= ${navigationValueState} }",valueStateText:"{= ${navigationValueStateText} }",change:()=>{this.fireEvent("change",{value:this.getItems()})},selectionChange:t=>{this.handleComboBoxEvents.call(this,t,true)}}).addStyleClass("sapUiTinyMarginBegin");this.separatorColon=new s({text:":"}).addStyleClass("sapUiTinyMarginTop sapUiTinyMarginBeginEnd");this.criticalityComboBox=new e({width:"100%",change:t=>{const e=t.getSource();const i=e.getBindingContext();const n=i?.getPath()||"";const a=this.getModel();const o=t.getSource().getSelectedKey();if(this.getType()==="COMPACT"){const t="/configuration/advancedFormattingOptions/sourceCriticalityProperty/0/activeCalculation";a.setProperty(t,String(i?.getObject("hostCriticality"))==="Calculation");a.setProperty("/configuration/advancedFormattingOptions/selectedKeyCriticality",o)}else{a.getProperty(n).activeCalculation=String(i?.getObject("criticality"))==="Calculation";a.setProperty("/configuration/advancedFormattingOptions/sourceCriticalityProperty/0/hostCriticality",o)}const s=o?true:false;a.setProperty("/configuration/advancedFormattingOptions/isCriticalityApplied",s);this.fireEvent("change",{value:this.getItems(),isCalcuationType:this.getModel()?.getProperty(n)?.activeCalculation||false})}});this.criticalityCalculator=new r({visible:"{= !!${activeCalculation} }",items:[new n({justifyContent:"SpaceAround",items:[new s({textAlign:"End",width:"150px",text:"{i18n>CRITICALITY_CONTROL_TOL_RANGE}"}).addStyleClass("sapUiTinyMarginTop"),new a({value:"{toleranceRangeLowValue}",placeholder:"{i18n>CRITICALITY_CONTROL_LOW}",width:"80px"}).addStyleClass("sapUiTinyMarginBeginEnd"),new a({value:"{toleranceRangeHighValue}",placeholder:"{i18n>CRITICALITY_CONTROL_HIGH}",width:"80px"}).addStyleClass("sapUiTinyMarginBeginEnd")]}),new n({justifyContent:"SpaceAround",items:[new s({textAlign:"End",width:"150px",text:"{i18n>CRITICALITY_CONTROL_DEV_RANGE}"}).addStyleClass("sapUiTinyMarginTop"),new a({value:"{deviationRangeLowValue}",placeholder:"{i18n>CRITICALITY_CONTROL_LOW}",width:"80px"}).addStyleClass("sapUiTinyMarginBeginEnd"),new a({value:"{deviationRangeHighValue}",placeholder:"{i18n>CRITICALITY_CONTROL_HIGH}",width:"80px"}).addStyleClass("sapUiTinyMarginBeginEnd")]}),new n({justifyContent:"SpaceAround",items:[new s({textAlign:"End",width:"150px",text:"{i18n>CRITICALITY_CONTROL_IMP_DIRECTION}"}).addStyleClass("sapUiTinyMarginTop"),new e({value:"{improvementDirection}",width:"176px",items:[new g({key:"{i18n>CRITICALITY_CONTROL_MINIMIZE}",text:"Minimize"}),new g({key:"{i18n>CRITICALITY_CONTROL_TARGET}",text:"Target"}),new g({key:"{i18n>CRITICALITY_CONTROL_MAXIMIZE}",text:"Maximize"})]}).addStyleClass("sapUiTinyMarginBeginEnd")]}),new n({justifyContent:"End",items:[new t({text:"{i18n>CRITICALITY_CONTROL_APPLY}",width:"176px",type:"Ghost",press:t=>{const e=t.getSource();const i=e.getBindingContext();const n=i.getPath()||"";this.fireEvent("change",{value:this.getItems(),isCalcuationType:this.getModel()?.getProperty(n)?.activeCalculation||false})}}).addStyleClass("sapUiTinyMarginBeginEnd")]})]}).addStyleClass("sapUiTinyMarginBottom");this.addButton=new t({icon:"sap-icon://add",type:"Transparent",press:this.onAddButtonClicked.bind(this)});this.deleteButton=new t({icon:"sap-icon://delete",type:"Transparent",press:this.onDeleteButtonClicked.bind(this)})},onAfterRendering:function t(){const e=JSON.parse(JSON.stringify(this.getSelectionKeys()));const i=this.getModel("i18n")?.getObject("CRITICALITY_CONTROL_SELECT_PROP");const n=this.getModel("i18n")?.getObject("CRITICALITY_CONTROL_SELECT_OTHERS");e.forEach(t=>{const e=this.setSelectionKeysMap.name;const a=this.setSelectionKeysMap.label;t.category=this.isPotentialCriticality(t)?i:n;t.name=`{${t[e]}}`;t.label=String(t[a])});const a=e.concat(this.staticCriticality);const o=this.criticalityComboBox.getModel("internal");o.setData(a,true);o.refresh()},setSelectionKeys:function t(e){this.setAggregation("list",this.list);this.setProperty("selectionKeys",e);this.setProperty("navigationSelectionKeys",e);this.setSelectionKeysMap=this.getBindingInfo("selectionKeys").parameters;const i=this.getBindingPath("navigationSelectionKeys")||"";this.propertyFilter=new p({path:this.setSelectionKeysMap.name});this.propertyComboBox.bindAggregation("items",{path:i,sorter:[new y("category",true,true),new y("label",false)],length:500,filters:this.propertyFilter,factory:()=>new g({key:"{"+this.setSelectionKeysMap.name+"}",text:"{"+this.setSelectionKeysMap.label+"}"})});this._idNavigationComboBox.bindAggregation("items",{path:"navigationalPropertiesForId/",sorter:new y("label",false),length:500,factory:function(){return new g({key:"{name}",text:"{labelWithValue}"})}});this.criticalityComboBox.setModel(this.getCriticalityModel(),"internal");this.criticalityComboBox.bindAggregation("items",{path:"internal>/",sorter:[new y("category",true,true),new y("label",false)],length:500,factory:function(){return new g({key:"{internal>name}",text:"{internal>label}"})}})},getCriticalityModel:function t(){return new u(this.staticCriticality)},setItems:function t(e){this.setProperty("items",e,true);this.itemsMap=this.getBindingInfo("items").parameters;this.criticalityComboBox.bindProperty("selectedKey",this.itemsMap.value);this._idNavigationComboBox.bindProperty("selectedKey",{path:"navigationKeyForId"});if(this.getType()==="COMPACT"){this.criticalityComboBox.setWidth("300px");const t=this.criticalityCalculator.getItems().length;if(t>0){this.criticalityCalculator.getItems()[t-1].setVisible(false)}}this.propertyComboBox.bindProperty("selectedKey",this.itemsMap.name);const a=this.getBindingPath("items")??"";this.list.bindItems({path:a,template:new i({content:[new n({justifyContent:"SpaceAround",renderType:"Bare",items:this.getType()==="COMPACT"?[this.criticalityComboBox]:[this.propertyComboBox,this._idNavigationComboBox,this.separatorColon,this.criticalityComboBox,this.deleteButton]}),new n({justifyContent:this.getType()==="COMPACT"?"Start":"SpaceAround",items:[this.criticalityCalculator]})]})})},handleComboBoxEvents:function t(e,i=false){const n=e.getParameter("id");const a=c.getElementById(n);let o=a.getSelectedKey();const s=e.getSource();const r=s.getBindingContext();const l=r?.getPath()||"";const g=this.getModel();const d=g.getProperty(l);const p=g.getProperty("/configuration/navigationProperty")||[];const y=this.hasNavigationProperty(p,d?.name);if(!i){d.navigationKeyForId=""}if(y){d.propertyKeyForId=o;const t=p.filter(t=>t.name===d?.name);d.navigationalPropertiesForId=t?.[0]?.properties||[];d.isNavigationForId=d.navigationalPropertiesForId.length>0}else{d.isNavigationForId=false}if(i&&o!==""){o=`${d.name}/${o}`}const u=m(g);const h=!u.includes(o);this.setValueStateForModel(g,o,h);g.refresh();return d},_getInternalModel:function t(){let e=this.getModel("internal");if(!e){e=new u({});this.setModel(e,"internal")}return e},getItems:function t(){const e=this.getBindingPath("items")||"";return this.getModel().getProperty(e)},onAddButtonClicked:function t(){const e=this.getModel();const i=this.getBindingPath("items")||"";if(e){let t=e.getProperty(i);if(!t){t=[]}t.push({});e.refresh()}},onDeleteButtonClicked:function t(e){let i=this.getBindingPath("items");const n=this.getModel();const a=n.getProperty("/configuration/advancedFormattingOptions/sourceCriticalityProperty/0/name")||"";const o=n.getProperty("/configuration/mainIndicatorOptions/criticality")||[];let s;if(this.getType()==="COMPACT"){if(a){const t=o.findIndex(t=>t?.name===a);if(t!==-1){s=`/configuration/mainIndicatorOptions/criticality/${t}`;n.setProperty("/configuration/advancedFormattingOptions/sourceCriticalityProperty",[]);i="/configuration/mainIndicatorOptions/criticality"}}}else{const t=e.getSource();const i=t.getBindingContext();s=i.getPath()||"";const o=n.getProperty(s)&&n.getProperty(s).name;if(o===a){n.setProperty("/configuration/advancedFormattingOptions/sourceCriticalityProperty",[])}}if(s&&i){n.getProperty(i).splice(s.slice(s.length-1),1);n.refresh();this.fireEvent("change",{value:this.getItems()})}},isPotentialCriticality:function t(e){switch(e.type){case"Edm.Date":case"Edm.Boolean":case"Edm.Guid":case"Edm.DateTimeOffset":return false;case"Edm.Decimal":case"Edm.Byte":case"Edm.Int32":if(typeof e.value==="number"&&e.value>-2&&e.value<6){return true}return false;case"Edm.String":switch(e.value){case null:case"-1":case"0":case"1":case"2":case"3":case"4":case"5":case"Positive":case"Negative":case"Neutral":case"Critical":case"VeryNegative":case"VeryPositive":case"Information":return true;default:return false}default:return false}},setCriticalityModel:function t(){const e=this.getModel("i18n")?.getObject("CRITICALITY_CONTROL_SELECT_CRITICALITY");this.staticCriticality=[{name:"Neutral",label:"Neutral",category:e},{name:"Good",label:"Positive",category:e},{name:"Critical",label:"Critical",category:e},{name:"Error",label:"Negative",category:e},{name:"Calculation",label:"Create Calculation",category:"Calculation:"}]},hasNavigationProperty:function t(e,i){return e.length>0&&e.some(t=>t.name===i)},setValueStateForModel:function t(e,i,n){const a=e.getProperty("/configuration/mainIndicatorOptions/criticality")||[];const o=this.getModel("i18n");const s=o.getObject("UNSELECTED_ITEM");a.forEach((t,a)=>{const o=t.navigationKeyForId?`${t.name}/${t.navigationKeyForId}`:t.name;let r=false;if(t.isNavigationForId&&t.navigationKeyForId){r=true}if(n&&i===o){if(t.valueState===C.None||t.valueState===undefined){e.setProperty(`/configuration/mainIndicatorOptions/criticality/${a}/valueState`,C.Information);e.setProperty(`/configuration/mainIndicatorOptions/criticality/${a}/valueStateText`,s)}if(r){e.setProperty(`/configuration/mainIndicatorOptions/criticality/${a}/navigationValueState`,C.Information);e.setProperty(`/configuration/mainIndicatorOptions/criticality/${a}/navigationValueStateText`,s)}}else if(!n&&i===o){if(t.valueState===C.Information){e.setProperty(`/configuration/mainIndicatorOptions/criticality/${a}/valueState`,C.None);e.setProperty(`/configuration/mainIndicatorOptions/criticality/${a}/valueStateText`,"")}if(r){e.setProperty(`/configuration/mainIndicatorOptions/criticality/${a}/navigationValueState`,C.None);e.setProperty(`/configuration/mainIndicatorOptions/criticality/${a}/navigationValueStateText`,"")}}})}});return f});
//# sourceMappingURL=CriticalityEditor-dbg.js.map