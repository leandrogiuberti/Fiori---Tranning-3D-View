/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)
 *  * (c) Copyright 2009-2025 SAP SE. All rights reserved
 */
"use strict";sap.ui.define(["sap/m/Button","sap/m/ComboBox","sap/m/CustomListItem","sap/m/HBox","sap/m/List","sap/m/Text","sap/ui/core/Control","sap/ui/core/Element","sap/ui/core/ListItem","sap/ui/core/library","sap/ui/model/Sorter","sap/ui/model/json/JSONModel","../../config/TextArrangementOptions","../../helpers/IntegrationCardHelper"],function(t,e,n,o,i,a,r,s,g,l,c,p,u,d){"use strict";const h=l["ValueState"];const m=u["TEXTARRANGEMENT_OPTIONS"];const y=d["getPreviewItems"];const f=r.extend("sap.cards.ap.generator.app.controls.ArrangementsEditor",{renderer:{apiVersion:2,render:function(t,e){t.openStart("div",e);t.openEnd();t.renderControl(e._list);t.renderControl(e._addButton);t.close("div")}},metadata:{properties:{mode:"string",selectionKeys:{type:"object",defaultValue:{}},navigationSelectionKeys:{type:"object",defaultValue:{}},items:{type:"object",defaultValue:{}}},aggregations:{_list:{type:"sap.m.List",multiple:false,visibility:"hidden"}},events:{change:{parameters:{value:{type:"int"}}},selectionChange:{parameters:{value:{type:"int"}}}}},constructor:function t(e){r.prototype.constructor.call(this,e)},init:function n(){const o=this;this._list=new i({showNoData:false});this._propertyComboBox=new e({width:"100%",valueState:"{= ${valueState} }",valueStateText:"{= ${valueStateText} }",selectionChange:function(t){o.handleComboBoxEvents(t,o,false,true)},change:function(t){const e=t.getSource();const n=e.getBindingContext();const i=n?.getPath()||"";const a=o.getModel();const r=a.getProperty(i);const s=true;o.fireEvent("change",{value:o.getItems(),selectedItem:r,textArrangementChanged:s})}});this._separatorColon=new a({text:":"}).addStyleClass("sapUiTinyMarginTop sapUiTinyMarginBeginEnd");this._idNavigationComboBox=new e({width:"100%",visible:"{= !!${isNavigationForId} }",valueState:"{= ${navigationValueState} }",valueStateText:"{= ${navigationValueStateText} }",change:function(){o.fireEvent("change",{value:o.getItems()})},selectionChange:function(t){o.handleComboBoxEvents(t,o,true)}}).addStyleClass("sapUiTinyMarginBegin");this._uomComboBox=new e({width:"100%",change:function(t){const e=t.getSource();const n=e.getBindingContext();const i=n?.getPath()||"";const a=o.getModel();const r=a.getProperty(i);o.fireEvent("change",{value:o.getItems(),selectedItem:r})},selectionChange:function(t){o.handleComboBoxEvents(t,o)}});this._descriptionNavigationComboBox=new e({width:"100%",visible:"{= !!${isNavigationForDescription} }",change:function(){o.fireEvent("change",{value:o.getItems()})},selectionChange:function(t){o.handleComboBoxEvents(t,o,true)}}).addStyleClass("sapUiTinyMarginBegin");this._separatorColonText=new a({text:":"}).addStyleClass("sapUiTinyMarginTop sapUiTinyMarginBeginEnd");this._textArrangementComboBox=new e({width:"100%",change:function(){o.fireEvent("change",{type:"text",value:o.getItems()})},selectionChange:function(t){const e=t.getParameter("id");const n=s.getElementById(e);const i=n.getSelectedKey();const a=t.getSource();const r=a.getBindingContext();const g=r?.getPath()||"";const l=o.getModel();const c=l.getProperty(g);c.textArrangement=`${i}`;l.refresh()}});this._deleteButton=new t({icon:"sap-icon://delete",type:"Transparent",press:this._onDeleteButtonClicked.bind(this)});this._addButton=new t({icon:"sap-icon://add",type:"Transparent",press:this._onAddButtonClicked.bind(this)})},onAfterRendering:function t(){const e=JSON.parse(JSON.stringify(this.getSelectionKeys()));const n=this._setSelectionKeysMap.name??"";const o=this._setSelectionKeysMap.label;const i=this._setSelectionKeysMap.textArrangement??"";e.forEach(t=>{t.name=t[n];t.label=t[o];t.textArrangement=t[i]});const a=this._textArrangementComboBox.getModel("internal");const r=this.getModel("i18n");m.forEach(t=>{t.label=r.getObject(t.label)});a.setData(m,true);a.refresh()},setSelectionKeys:function t(e){const n=this;n.setAggregation("_list",n._list);this.setProperty("selectionKeys",e);this.setProperty("navigationSelectionKeys",e);this._setSelectionKeysMap=this.getBindingInfo("selectionKeys").parameters;const o=this.getBindingPath("navigationSelectionKeys")||"";this._propertyComboBox.bindAggregation("items",{path:o,sorter:[new c("category",true,true),new c("label",false)],length:500,factory:function(){return new g({key:"{"+n._setSelectionKeysMap.name+"}",text:"{"+n._setSelectionKeysMap.label+"}"})}});this._uomComboBox.bindAggregation("items",{path:o,sorter:[new c("category",true,true),new c("label",false)],length:500,factory:function(){return new g({key:"{"+n._setSelectionKeysMap.name+"}",text:"{"+n._setSelectionKeysMap.label+"}"})}});n._idNavigationComboBox.bindAggregation("items",{path:"navigationalPropertiesForId/",sorter:new c("label",false),length:500,factory:function(){return new g({key:"{name}",text:"{labelWithValue}"})}});n._descriptionNavigationComboBox.bindAggregation("items",{path:"navigationalPropertiesForDescription/",sorter:new c("label",false),length:500,factory:function(){return new g({key:"{name}",text:"{labelWithValue}"})}});this._textArrangementComboBox.setModel(this._getTextArrangementModel(),"internal");this._textArrangementComboBox.bindAggregation("items",{path:"internal>/",factory:function(){return new g({key:"{internal>name}",text:"{internal>label}"})}})},setItems:function t(e){this.setProperty("items",e,true);this._propertyComboBox.bindProperty("selectedKey",{path:"propertyKeyForId"});this._idNavigationComboBox.bindProperty("selectedKey",{path:"navigationKeyForId"});this._uomComboBox.bindProperty("selectedKey",{path:"propertyKeyForDescription"});this._descriptionNavigationComboBox.bindProperty("selectedKey",{path:"navigationKeyForDescription"});this._textArrangementComboBox.bindProperty("selectedKey",{path:"arrangementType"});const i=this.getBindingPath("items")??"";this._list.bindItems({path:i,template:new n({content:[new o({renderType:"Bare",justifyContent:"SpaceAround",items:[this._propertyComboBox,this._idNavigationComboBox,this._separatorColon,this._uomComboBox,this.getMode()!=="uom"&&this._separatorColonText,this.getMode()!=="uom"&&this._descriptionNavigationComboBox,this.getMode()!=="uom"&&this._separatorColonText,this.getMode()!=="uom"&&this._textArrangementComboBox,this._deleteButton],width:"100%",alignItems:"Start",fitContainer:true})]})})},_getInternalModel:function t(){if(!this.getModel("internal")){const t=new p({});this.setModel(t,"internal")}return this.getModel("internal")},getItems:function t(){const e=this.getBindingPath("items")||"";return this.getModel().getProperty(e)},getSelectedItem:function t(){const e=this.getBindingPath("items")||"";return this.getModel().getProperty(e)},_getTextArrangementModel:function t(){return new p(m)},_onAddButtonClicked:function t(){const e=this.getModel();const n=this.getBindingPath("items")||"";if(e){let t=e.getProperty(n);if(!t){t=[]}t.push({});e.refresh()}},_onDeleteButtonClicked:function t(e){const n=e.getSource();const o=n.getBindingContext().getPath();const i=this.getBindingPath("items")||"";const a=this.getModel();const r=a.getProperty(i);r&&r.splice(o.slice(o.length-1),1);a.refresh();this.fireEvent("change",{value:this.getItems()})},handleComboBoxEvents:function t(e,n,o=false,i=false){const a=e.getParameter("id");const r=s.getElementById(a);let g=r.getSelectedKey();const l=e.getSource();const c=l.getBindingContext();const p=c?.getPath()||"";const u=r.getValue();const d=n.getModel();const h=d.getProperty(p);const m=n.getModel("i18n");const f=d.getProperty("/configuration/navigationProperty")||[];const v=this.hasNavigationProperty(f,h.propertyKeyForDescription);h.name=this.getGroupName(h,o,i);let x="";if(h.navigationKeyForDescription){x=`/${h.navigationKeyForDescription}`}if(h.isNavigationForId){g=h.name}const S=v?`${h.propertyKeyForDescription}${x}`:h.propertyKeyForDescription;const b=h.name===S;if(!b){h.value=this.getGroupValue(h,o,i,g,f)}const C=y(d);const B=g!==S&&!C.includes(h.name);this.updateControlState(r,u,g,b,m,n,B);this.setValueStateForModel(d,m,g,c,n,B);d.refresh();return h},getGroupName:function t(e,n,o){if(n){return e.navigationKeyForId?`${e.propertyKeyForId}/${e.navigationKeyForId}`:`${e.propertyKeyForId}`}if(o){return`${e.propertyKeyForId}`}return e.navigationKeyForId?`${e.propertyKeyForId}/${e.navigationKeyForId}`:`${e.propertyKeyForId}`},getGroupValue:function t(e,n,o,i,a){const{propertyKeyForId:r,propertyKeyForDescription:s,navigationKeyForDescription:g}=e;if(n){return g?`${s}/${g}`:s}if(o){const t=this.hasNavigationProperty(a,r);if(g){return t?`${r}`:`${s}/${g}`}return t?r:s}return s||i},updateControlState:function t(e,n,o,i,a,r,s){if(!o&&n){e.setValueState(h.Error);e.setValueStateText(a.getObject("INVALID_SELECTION"));r.errorFlag=true}else if(i){e.setValueState(h.Error);e.setValueStateText(a.getObject("SAME_SELECTION"));r.errorFlag=true}else if(s&&n){e.setValueState(h.Information);e.setValueStateText(a.getObject("UNSELECTED_ITEM"));r.errorFlag=false}else{r.errorFlag=false;e.setValueState(h.None);e.setValueStateText("")}},hasNavigationProperty:function t(e,n){return e.length>0&&e.some(t=>t.name===n)},setValueStateForModel:function t(e,n,o,i,a,r){const s=n.getObject("UNSELECTED_ITEM");["unitOfMeasures","textArrangements"].forEach(t=>{if(i?.getPath()?.includes(t)){const n=e.getProperty(`/configuration/advancedFormattingOptions/${t}`)??[];n.forEach((n,i)=>{let g=false;if(n.isNavigationForId&&n.navigationKeyForId){g=true}if(!a.errorFlag&&r&&o===n.name){if(n.valueState===h.None||n.valueState===undefined){e.setProperty(`/configuration/advancedFormattingOptions/${t}/${i}/valueState`,h.Information);e.setProperty(`/configuration/advancedFormattingOptions/${t}/${i}/valueStateText`,s)}if(g&&(n.navigationValueState===h.None||n.navigationValueState===undefined)){e.setProperty(`/configuration/advancedFormattingOptions/${t}/${i}/navigationValueState`,h.Information);e.setProperty(`/configuration/advancedFormattingOptions/${t}/${i}/navigationValueStateText`,s)}}else if(!a.errorFlag&&!r&&o===n.name){if(n.valueState===h.Information){e.setProperty(`/configuration/advancedFormattingOptions/${t}/${i}/valueState`,h.None);e.setProperty(`/configuration/advancedFormattingOptions/${t}/${i}/valueStateText`,"")}if(g&&n.navigationValueState===h.Information){e.setProperty(`/configuration/advancedFormattingOptions/${t}/${i}/navigationValueState`,h.None);e.setProperty(`/configuration/advancedFormattingOptions/${t}/${i}/navigationValueStateText`,"")}}})}})}});return f});
//# sourceMappingURL=ArrangementsEditor.js.map