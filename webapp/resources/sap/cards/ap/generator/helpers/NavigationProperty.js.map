{"version":3,"file":"NavigationProperty.js","names":["sap","ui","define","___odata_ODataUtils","___pages_Application","___Batch","___Formatter","___PropertyExpression","getNavigationPropertiesWithLabel","rootComponent","navigationProperty","path","model","getModel","entitySet","serviceUrl","odataModel","Application","getInstance","fetchDetails","bODataV4","ODataModelVersion","V4","navigationPropertyInfo","getNavigationPropertyInfoFromEntity","selectedNavigationProperty","find","property","name","Promise","resolve","propertiesWithLabel","navigationPropertyData","properties","queryParams","navigationProperties","fetchDataAsync","createUrlParameters","then","data","undefined","forEach","propertyValue","labelWithValue","formatPropertyDropdownValues","label","e","reject","resolvePropertyPathFromExpression","updateNavigationPropertiesWithLabel","navigationEntityName","getNavigationPropertyInfo","textArrangement","_temp3","_temp","isNavigationForId","navigationEntitySet","propertyKeyForId","navigationalPropertiesForId","navigationPropertyInfoForId","push","_temp2","isNavigationForDescription","propertyKeyForDescription","navigationalPropertiesForDescription","navigationPropertyInfoForDesc","getNavigationPropertyInfoGroups","item","cardManifest","propertyPath","value","includes","replace","split","navigationalProperties","isNavigationEnabled","isEnabled","__exports","__esModule"],"sources":["NavigationProperty.ts"],"sourcesContent":["/*!\n * SAP UI development toolkit for HTML5 (SAPUI5)\n *  * (c) Copyright 2009-2025 SAP SE. All rights reserved\n */\nimport Component from \"sap/ui/core/Component\";\nimport { CardManifest } from \"sap/ui/integration/widgets/Card\";\nimport V2ODataModel from \"sap/ui/model/odata/v2/ODataModel\";\nimport V4ODataModel from \"sap/ui/model/odata/v4/ODataModel\";\nimport type { ArrangementOptions } from \"../app/controls/ArrangementsEditor\";\nimport type { PropertyInfo } from \"../odata/ODataTypes\";\nimport { fetchDataAsync, getNavigationPropertyInfoFromEntity } from \"../odata/ODataUtils\";\nimport { Application, ODataModelVersion } from \"../pages/Application\";\nimport type { GroupItem, NavigationParameter, Property } from \"../types/PropertyTypes\";\nimport { QueryParameters, createUrlParameters } from \"./Batch\";\nimport { formatPropertyDropdownValues } from \"./Formatter\";\nimport { resolvePropertyPathFromExpression } from \"./PropertyExpression\";\n\ntype Model = V2ODataModel | V4ODataModel;\n\n/**\n * Fetches the navigation properties with label for a single Navigation property\n * @param rootComponent\n * @param navigationProperty - Name of the navigation property\n * @param path\n */\nexport async function getNavigationPropertiesWithLabel(rootComponent: Component, navigationProperty: string, path: string) {\n\tconst model = rootComponent.getModel() as Model;\n\tconst { entitySet, serviceUrl, odataModel } = Application.getInstance().fetchDetails();\n\tconst bODataV4 = odataModel === ODataModelVersion.V4;\n\tconst navigationPropertyInfo = getNavigationPropertyInfoFromEntity(model, entitySet);\n\tconst selectedNavigationProperty = navigationPropertyInfo.find((property) => property.name === navigationProperty);\n\n\tif (!selectedNavigationProperty) {\n\t\treturn {\n\t\t\tpropertiesWithLabel: [],\n\t\t\tnavigationPropertyData: {}\n\t\t};\n\t}\n\n\tconst properties = selectedNavigationProperty.properties || [];\n\tconst queryParams: QueryParameters = {\n\t\tproperties: [],\n\t\tnavigationProperties: [\n\t\t\t{\n\t\t\t\tname: selectedNavigationProperty.name,\n\t\t\t\tproperties: []\n\t\t\t}\n\t\t]\n\t};\n\n\tconst data = await fetchDataAsync(serviceUrl, path, bODataV4, createUrlParameters(queryParams));\n\n\tif (data[selectedNavigationProperty.name] !== undefined && data[selectedNavigationProperty.name] !== null) {\n\t\tproperties.forEach((property) => {\n\t\t\tconst name = data[selectedNavigationProperty.name] as Record<string, unknown>;\n\t\t\tif (name[property.name] !== undefined && name[property.name] !== null) {\n\t\t\t\tconst propertyValue = name[property.name] as string;\n\t\t\t\tproperty.labelWithValue = formatPropertyDropdownValues(property as PropertyInfo, propertyValue);\n\t\t\t} else {\n\t\t\t\tproperty.labelWithValue = `${property.label} (<empty>)`;\n\t\t\t}\n\t\t});\n\t}\n\n\treturn {\n\t\tpropertiesWithLabel: properties,\n\t\tnavigationPropertyData: data\n\t};\n}\n\n/**\n * Updates the navigation properties with the provided labels.\n *\n * @param {NavigationParameter[]} navigationProperties - The array of navigation parameters to be updated.\n * @param {string} navigationEntityName - The name of the navigation entity to be updated.\n * @param {Property[]} propertiesWithLabel - The array of properties with labels to update the navigation entity with.\n */\nexport function updateNavigationPropertiesWithLabel(\n\tnavigationProperties: NavigationParameter[],\n\tnavigationEntityName: string,\n\tpropertiesWithLabel: Property[]\n) {\n\tconst navigationProperty = navigationProperties.find((property) => property.name === navigationEntityName);\n\tif (!navigationProperty) {\n\t\treturn;\n\t}\n\n\tnavigationProperty.properties = [...propertiesWithLabel];\n}\n\nexport const getNavigationPropertyInfo = async function (\n\ttextArrangement: ArrangementOptions,\n\tnavigationProperty: NavigationParameter[],\n\tpath: string\n) {\n\tconst { rootComponent } = Application.getInstance().fetchDetails();\n\tconst navigationPropertyInfo = [];\n\tif (textArrangement.isNavigationForDescription) {\n\t\tconst navigationEntitySet = textArrangement.propertyKeyForDescription;\n\t\tconst { propertiesWithLabel, navigationPropertyData } = await getNavigationPropertiesWithLabel(\n\t\t\trootComponent,\n\t\t\tnavigationEntitySet,\n\t\t\tpath\n\t\t);\n\t\ttextArrangement.navigationalPropertiesForDescription = propertiesWithLabel;\n\t\tupdateNavigationPropertiesWithLabel(navigationProperty, navigationEntitySet, textArrangement.navigationalPropertiesForDescription);\n\t\tconst navigationPropertyInfoForDesc = {\n\t\t\tnavigationEntitySet,\n\t\t\tnavigationPropertyData\n\t\t};\n\t\tnavigationPropertyInfo.push(navigationPropertyInfoForDesc);\n\t}\n\tif (textArrangement.isNavigationForId) {\n\t\tconst navigationEntitySet = textArrangement.propertyKeyForId as string;\n\t\tconst { propertiesWithLabel, navigationPropertyData } = await getNavigationPropertiesWithLabel(\n\t\t\trootComponent,\n\t\t\tnavigationEntitySet,\n\t\t\tpath\n\t\t);\n\t\ttextArrangement.navigationalPropertiesForId = propertiesWithLabel;\n\t\tupdateNavigationPropertiesWithLabel(navigationProperty, navigationEntitySet, textArrangement.navigationalPropertiesForId);\n\t\tconst navigationPropertyInfoForId = {\n\t\t\tnavigationEntitySet,\n\t\t\tnavigationPropertyData\n\t\t};\n\t\tnavigationPropertyInfo.push(navigationPropertyInfoForId);\n\t}\n\treturn navigationPropertyInfo;\n};\n\nexport const getNavigationPropertyInfoGroups = async function (\n\titem: GroupItem,\n\tnavigationProperty: NavigationParameter[],\n\tpath: string,\n\tcardManifest: Record<string, unknown>\n) {\n\tconst { rootComponent } = Application.getInstance().fetchDetails();\n\n\tconst propertyPath = resolvePropertyPathFromExpression(item.value, cardManifest as CardManifest);\n\tif (propertyPath?.includes(\"/\")) {\n\t\tconst [navigationEntitySet, property] = propertyPath.replace(/[{}]/g, \"\").split(\"/\");\n\t\tconst { propertiesWithLabel, navigationPropertyData } = await getNavigationPropertiesWithLabel(\n\t\t\trootComponent,\n\t\t\tnavigationEntitySet,\n\t\t\tpath\n\t\t);\n\t\titem.navigationalProperties = propertiesWithLabel;\n\t\titem.isNavigationEnabled = true;\n\t\titem.isEnabled = true;\n\t\titem.navigationProperty = property;\n\n\t\tif (item.navigationalProperties) {\n\t\t\tupdateNavigationPropertiesWithLabel(navigationProperty, navigationEntitySet, item.navigationalProperties);\n\t\t}\n\n\t\treturn {\n\t\t\tnavigationEntitySet,\n\t\t\tnavigationPropertyData\n\t\t};\n\t}\n};\n"],"mappings":"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","ignoreList":[]}