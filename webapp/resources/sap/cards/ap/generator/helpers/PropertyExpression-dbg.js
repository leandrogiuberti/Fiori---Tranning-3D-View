/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)
 *  * (c) Copyright 2009-2025 SAP SE. All rights reserved
 */
"use strict";sap.ui.define(["sap/base/Log","sap/ui/base/BindingParser","../config/FormatterOptions","../utils/CommonUtils","./Formatter"],function(t,e,r,n,s){"use strict";const i=r["getFormatterConfiguration"];const o=n["extractValueWithoutBooleanExprBinding"];const a=n["getDialogModel"];const c=n["hasBooleanBindingExpression"];const f=s["createFormatterExpression"];function p(t=""){return t.startsWith("{")}function l(t=""){return t.startsWith("{{")&&t.endsWith("}}")}function u(t=""){return t.startsWith("{=")&&t.endsWith("}")&&(t.includes("format.")||t.includes("extension.formatters."))}function m(t,e=[]){const r=e.find(function(e){return e.property===t||"{"+e.property+"}"===t});if(r){return f(r)}return t}function g(t,e){const r=a();const n=h(r,t);const{unitOfMeasures:s,textArrangements:i,propertyValueFormatters:o}=e;const c=t.startsWith("{");t=t.replace(/[{}]/g,"");const f=s.find(function(e){return e.name===t});let p=f?.value?.replace(/[{}]/g,"");const l=i.find(e=>{if(e.value&&e.textArrangement){return e.name===t}});let u=l?.value?.replace(/[{}]/g,"");let g=false;let x=false;let $=false;const b=t;t=t&&m(t,o);if(t!==b){g=true}const F=f&&m(p??"",o);if(p!==F){x=true}const P=u&&m(u,o);if(u!==P){$=true}let O="";const E=h(r,u??"");const T=h(r,p??"");if(l||f&&p){if(n){t=d(t).slice(1,-1)}if(E){u=d(u??"").slice(1,-1)}if(T){p=d(p??"").slice(1,-1)}}if(f&&l){switch(l.textArrangement){case"TextLast":O+=g?`{= ${t}}`:`{${t}}`;O+=x?` {= ${F}}`:` {${p}}`;O=y(O,g,x,T);O+=$?` ({= ${P}})`:` ({${u}})`;break;case"TextFirst":O=$?`{= ${P}} (`:`{${u}} (`;O+=g?`{= ${t}}`:`{${t}}`;O+=x?` {= ${F}}`:` {${p}}`;const e=O.indexOf(" (");const r=y(O.slice(e+2),g,x,T);O=O.slice(0,e+2)+r;O+=")";break;case"TextSeparate":O+=g?`{= ${t}}`:`{${t}}`;O+=x?` {= ${F}}`:` {${p}}`;O=y(O,g,x,T);break;case"TextOnly":O+=$?`{= ${P}}`:`{${u}}`;break;default:break}return O}else if(f&&p){O=g?`{= ${t}}`:`{${t}}`;if(!F?.startsWith("format.unit(")){O+=x?` {= ${F}}`:` {${p}}`}return y(O,g,x,T)}else if(l){switch(l.textArrangement){case"TextLast":O+=g?`{= ${t}}`:`{${t}}`;O+=$?` ({= ${P}})`:` ({${u}})`;break;case"TextFirst":O=$?`{= ${P}}`:`{${u}}`;O+=g?` ({= ${t}})`:` ({${t}})`;break;case"TextSeparate":O+=g?`{= ${t}}`:`{${t}}`;break;case"TextOnly":O=$?`{= ${P}}`:`{${u}}`;break;default:break}return O}if(n){return d(t)}return c?g?`{= ${t}}`:`{${t}}`:t}function h(t,e){const r=t?.getProperty("/configuration/properties");e=e.replace(/[{}]/g,"");const n=(t,e)=>t?.find(t=>t.name===e);const s=n(r,e);if(s){return s.type==="Edm.Boolean"}if(e.includes("/")){const r=e.split("/");const s=r[0];const i=r[1];const o=t?.getProperty("/configuration/navigationProperty");const a=n(o,s);const c=a?.properties;if(c&&Array.isArray(c)){const t=n(c,i);return t.type==="Edm.Boolean"}}return false}function d(t){const e=`{= \${${t}} === true ? '{{parameters._yesText}}' : '{{parameters._noText}}'}`;return e}function y(t,e,r,n){const s=n?t.split(" {= "):t.split(" ");let i="",o="";if(s.length===2){i=s[0];o=s[1]}if(e){const e=t.startsWith("{= format.float(");const s=t.startsWith("{= format.unit(");if((e||s)&&!r){const r=t.indexOf("} {");let s=t.slice(0,r+1);let i=t.slice(r+2);if(n){i=i.slice(4,-1)}s=s.replace("format.float(","format.unit(");const o=s.split(", ");if(o.length===2){return e?s.replace(", {",", $"+i+", {"):o[0].concat(", $"+i+")}")}else if(o.length===3){return i?o[0].concat(", $"+i+", ").concat(o[2]):s}return t}return t}if(n){return"{= format.unit($"+i+", "+o.slice(0,-1)+")}"}else{return"{= format.unit($"+i+", $"+o+")}"}}function x(t){return $(t).replace(/[{}]/g,"")}function $(t){const e=t.includes("} {");return e?t.substring(0,t.indexOf("} {")+1):t}function b(t){const e=["{=","{","(","${"];const r=["}",")"];const n=[];let s=0,i="",o=false;for(let a=0;a<t.length;a++){if(o){o=false;continue}if(e.includes(t[a])){if(t[a]==="{"&&t[a+1]==="="){i+="{=";o=true}else{i+=t[a]}s++}else if(r.includes(t[a])){i+=t[a];s--}else{i+=t[a]}if(s===0){if(i.trim().length!==0){n.push(i)}i=""}}return n}function F(t,e){const r=O(e);const n=b(t);let s=-1;const i=[];const a=[];n.forEach((t,e)=>{const r=t.trim().startsWith("(")&&t.trim().endsWith(")");if(r){s=e;const r=u(t.slice(1,-1));if(r){a.push(t.slice(1,-1))}t=r?E(t.slice(1,-1)).propertyPath:t.slice(1,-1);t="({"+t+"})"}else if(u(t)){a.push(t);t="{"+E(t).propertyPath+"}"}i.push(t)});if(s>-1){let t=i.slice(0,s).concat(i.slice(s+1)).join(" ");const e=i.slice(s,s+1)[0];let n="";if(c(e)){n=o(e)}else{n=e.trim().replace(/[({})]/g,"")}const f=r.find(t=>n===t.name);if(f&&f.arrangementType==="TextFirst"){t=t.replace(f.value,f.name)}return{propertyPath:t,formatterExpression:a}}else{const e=x(t);const n=r.find(t=>e===t.value);if(n&&n.arrangementType==="TextOnly"){return{propertyPath:`{${n.name}}`,formatterExpression:a}}}return{propertyPath:t,formatterExpression:a}}function P(t="",e){let{propertyPath:r}=F(t,e);const n=p(t)||u(t);if(c(r)){r=o(r)}if(p(r)&&!u(r)){r=x(r)}if(p(r)&&u(r)){const t=$(r);const e=T(t);r=e.property||""}return n?`{${r}}`:r}function O(t){const e=t["sap.card"].configuration?.parameters?._propertyFormatting;if(!e){return[]}const r=[];Object.keys(e).forEach(t=>{const n=e[t].arrangements.text;const s=Object.keys(n).find(t=>n[t])||"TextLast";let i=n.path;let o=false;let a=false;let c="";let f="";let p="";if(t.includes("/")){c=t.split("/")[0];f=t.split("/")[1];o=true}if(i?.includes("/")){i=n.path.split("/")[0];p=n.path.split("/")[1];a=true}r.push({name:t,arrangementType:s,value:n.path,propertyKeyForDescription:i,propertyKeyForId:t.includes("/")?c:t,textArrangement:s,isNavigationForId:o,isNavigationForDescription:a,navigationKeyForId:f,navigationKeyForDescription:p,navigationalPropertiesForDescription:[],navigationalPropertiesForId:[]})});return r}function E(r=""){const n=i();const s=r.split("{=")[1]?.split("(")[0]?.trim();if(!s){return{formatterName:"",propertyPath:"",parameters:[]}}const o=n.find(t=>t.formatterName===s);const a=e.complexParser(r);const c=a?.parts[0].path;const f="${"+c+"}";const p=[];let l=r;l=r.trim().replace("{=","");l=l.substring(0,l.lastIndexOf("}"));l=l.replace(`${s}(`,"");l=l.substring(0,l.lastIndexOf(")"));let u=l.replace(`${f}`,"").trim();const m=u.length>0;if(m){const e=o?.parameters||[];for(const r of e){if(r.type==="object"){const e=u.indexOf("{");const r=u.indexOf("}");const n=u.substring(e,r+1);u=u.substring(r+1);try{p.push(JSON.parse(n))}catch{t.error("Error in parsing the formatter options")}}if(r.type==="string"){const t=u.indexOf(",");u=u.substring(t+1);let e=u.indexOf(",");let r;if(e!==-1){r=u.substring(0,e).trim()}else{e=u.indexOf("}");r=u.substring(0,e+1).trim()}u=u.substring(e+1);p.push(r.replace(/['"]+/g,""))}}}return{formatterName:s,propertyPath:c,parameters:p}}function T(t){const e=i();const r=E(t);const n={...e.find(t=>t.formatterName===r.formatterName)};n.property=r.propertyPath;if(!n.parameters?.length){return n}const s=n.parameters.length;for(let t=0;t<s;t++){const e=r.parameters;if(n.parameters[t].type==="object"&&typeof e[t]==="object"){v(n,e,t)}if(n.parameters[t].type==="string"&&typeof e[t]==="string"){n.parameters[t].value=e[t]}}return n}function v(t,e,r){const n=t.parameters[r].properties;n?.forEach(t=>{if(t.type==="boolean"){t["selected"]=e[r][t.name]}else if(t.type==="enum"){t["selectedKey"]=e[r][t.name]}else{t["value"]=typeof e==="object"?e[r][t.name]:e[r]}})}var W={__esModule:true};W.isExpression=p;W.isI18nExpression=l;W.hasFormatter=u;W.getArrangements=g;W.getExpressionBindingForBooleanTypes=d;W.extractPathWithoutUOM=x;W.extractPathExpressionWithoutUOM=$;W.getExpressionParts=b;W.extractPropertyConfigurationWithoutTextArrangement=F;W.resolvePropertyPathFromExpression=P;W.getTextArrangementFromCardManifest=O;W.parseFormatterExpression=E;W.updateAndGetSelectedFormatters=T;return W});
//# sourceMappingURL=PropertyExpression-dbg.js.map