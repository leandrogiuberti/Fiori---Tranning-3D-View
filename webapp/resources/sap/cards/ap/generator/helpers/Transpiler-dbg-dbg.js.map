{"version":3,"file":"Transpiler-dbg-dbg.js","names":["sap","ui","define","sap_cards_ap_common_adaptiveCards_AdaptiveCardRenderer","sap_cards_ap_transpiler_cardTranspiler_Transpile","CoreElement","___pages_Application","___utils_CommonUtils","getAdaptiveCardForRendering","convertIntegrationCardToAdaptive","Application","checkForDateType","getFormattedDateValue","propertyValue","Date","isNaN","getTime","toISOString","date","transpileIntegrationCardToAdaptive","oDialogModel","oCard","getElementById","oManifest","getManifest","keyParameters","getProperty","appIntent","variantParameter","navigationURI","getInstance","fetchDetails","oAdaptiveCardManifest","adaptiveCardData","Object","assign","properties","forEach","property","isDate","name","formattedDateValue","iterateObject","$data","sHostConfig","getSelectedItem","getBindingContext","renderedCard","adaptiveCardPreview","document","querySelector","setTimeout","innerHTML","updateEmptyStrings","appendChild","nodeList","querySelectorAll","nodeArray","Array","from","node","textContent","includes","key","hasOwnProperty","processKey","value","__edmType","__exports","__esModule"],"sources":["Transpiler.ts"],"sourcesContent":["/*!\n * SAP UI development toolkit for HTML5 (SAPUI5)\n *  * (c) Copyright 2009-2025 SAP SE. All rights reserved\n */\nimport { getAdaptiveCardForRendering } from \"sap/cards/ap/common/adaptiveCards/AdaptiveCardRenderer\";\nimport { convertIntegrationCardToAdaptive } from \"sap/cards/ap/transpiler/cardTranspiler/Transpile\";\nimport CoreElement from \"sap/ui/core/Element\";\nimport Card, { CardManifest } from \"sap/ui/integration/widgets/Card\";\nimport JSONModel from \"sap/ui/model/json/JSONModel\";\nimport { Application } from \"../pages/Application\";\nimport { checkForDateType } from \"../utils/CommonUtils\";\n\ntype AdaptiveCardData = {\n\t[key: string]: string | DateObject;\n};\n\ntype DateObject = {\n\t__edmType: string;\n\t[key: string]: unknown;\n};\n\nfunction getFormattedDateValue(propertyValue: string | Date | object) {\n\tif (typeof propertyValue === \"object\" && propertyValue instanceof Date && !isNaN(propertyValue.getTime())) {\n\t\treturn propertyValue.toISOString();\n\t} else if (typeof propertyValue === \"string\") {\n\t\tconst date = new Date(propertyValue);\n\t\treturn isNaN(date.getTime()) ? \"\" : date.toISOString();\n\t}\n}\n\n/**\n * Transpiles an Integration Card into an Adaptive Card.\n *\n * @param {JSONModel} oDialogModel - The Integration Card to transpile.\n * @returns {AdaptiveCard} The resulting Adaptive Card.\n * @throws {TranspilationError} If the Integration Card cannot be transpiled.\n */\nexport function transpileIntegrationCardToAdaptive(oDialogModel: JSONModel) {\n\tconst oCard = CoreElement.getElementById(\"cardGeneratorDialog--cardPreview\") as Card;\n\tconst oManifest = oCard.getManifest() as CardManifest;\n\tconst keyParameters = oDialogModel.getProperty(\"/configuration/keyParameters\") ?? [];\n\tlet appIntent = oDialogModel.getProperty(\"/configuration/appIntent\");\n\tconst { variantParameter, navigationURI } = Application.getInstance().fetchDetails();\n\tappIntent = variantParameter ? `${appIntent}?sap-appvar-id=${variantParameter}` : appIntent;\n\tconst oAdaptiveCardManifest = convertIntegrationCardToAdaptive(oManifest, appIntent, keyParameters, navigationURI);\n\tconst adaptiveCardData = Object.assign({}, oDialogModel.getProperty(\"/configuration/$data\"));\n\tconst properties = oDialogModel.getProperty(\"/configuration/properties\");\n\tproperties.forEach(function (property: { isDate: boolean; name: string }) {\n\t\tif (property?.isDate && adaptiveCardData[property.name]) {\n\t\t\tconst propertyValue = adaptiveCardData[property.name];\n\t\t\tconst formattedDateValue = getFormattedDateValue(propertyValue);\n\t\t\tadaptiveCardData[property.name] = formattedDateValue ? formattedDateValue : propertyValue;\n\t\t}\n\t});\n\n\titerateObject(adaptiveCardData);\n\n\toAdaptiveCardManifest.$data = adaptiveCardData;\n\tconst sHostConfig = (CoreElement.getElementById(\"cardGeneratorDialog--preview-select\") as any)\n\t\t.getSelectedItem()\n\t\t.getBindingContext(\"previewOptions\")\n\t\t.getProperty(\"hostConfig\");\n\n\tlet renderedCard: HTMLElement | undefined;\n\tif (sHostConfig) {\n\t\trenderedCard = getAdaptiveCardForRendering(sHostConfig, oAdaptiveCardManifest);\n\t}\n\tconst adaptiveCardPreview = document.querySelector(\"#adaptiveCardPreview\");\n\n\tif (adaptiveCardPreview && renderedCard) {\n\t\tsetTimeout(function () {\n\t\t\tadaptiveCardPreview.innerHTML = \"\";\n\t\t\tupdateEmptyStrings(renderedCard);\n\t\t\tadaptiveCardPreview.appendChild(renderedCard);\n\t\t});\n\t}\n}\n\n/**\n * Function to update &minus; strings in the rendered card textblock to '-'\n * as JS Engine will not understand &minus; and will not render it to '-'.\n *\n * @param renderedCard\n */\nfunction updateEmptyStrings(renderedCard: HTMLElement): void {\n\tconst nodeList = renderedCard.querySelectorAll(\".ac-textBlock\");\n\tconst nodeArray = Array.from(nodeList);\n\tnodeArray.forEach((node) => {\n\t\tif (node.textContent?.includes(\"&minus;\")) {\n\t\t\tnode.textContent = \"-\";\n\t\t}\n\t});\n}\n\n/**\n * Iterates over the properties of the given adaptive card data object and processes each key.\n *\n * @param {AdaptiveCardData} adaptiveCardData - The adaptive card data object to iterate over.\n * @returns {void}\n */\nfunction iterateObject(adaptiveCardData: AdaptiveCardData): void {\n\tfor (const key in adaptiveCardData) {\n\t\tif (adaptiveCardData.hasOwnProperty(key)) {\n\t\t\tprocessKey(adaptiveCardData, key);\n\t\t}\n\t}\n}\n\n/**\n * Processes a key in the adaptive card data object. If the value associated with the key is an object\n * and has a valid EDM type, it converts the value to an ISO string if possible. It also recursively\n * iterates over the object if the value is an object.\n *\n * @param {AdaptiveCardData} adaptiveCardData - The adaptive card data object containing the key to process.\n * @param {string} key - The key in the adaptive card data object to process.\n */\nfunction processKey(adaptiveCardData: AdaptiveCardData, key: string): void {\n\tconst value = adaptiveCardData[key];\n\tif (typeof value === \"object\" && value !== null) {\n\t\tif (checkForDateType(value?.__edmType)) {\n\t\t\tconst formattedDateValue = getFormattedDateValue(value);\n\t\t\tadaptiveCardData[key] = formattedDateValue ? formattedDateValue : value;\n\t\t}\n\t\titerateObject(value as AdaptiveCardData);\n\t}\n}\n"],"mappings":"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","ignoreList":[]}