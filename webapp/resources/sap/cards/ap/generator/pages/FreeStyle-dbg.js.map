{"version":3,"file":"FreeStyle-dbg.js","names":["sap","ui","define","Log","sap_cards_ap_common_helpers_ApplicationInfo","sap_cards_ap_common_odata_ODataUtils","sap_cards_ap_generator_odata_ODataUtils","JSONModel","V2ODataModel","V4ODataModel","___Application","_catch","body","recover","result","e","then","AppType","getApplicationFloorplan","getEntitySetWithContextURLs","getEntityNames","getPropertyReference","Application","FreeStyle","constructor","rootComponent","super","floorplan","appComponent","this","_rootComponent","entitySetFromManifest","getManifestEntry","serviceDetails","getServiceDetails","entityDetails","getEntityDetails","serviceURL","length","name","freeStyleDialogModel","isServiceDetailsView","currentService","entitySet","entities","entitySetWithObjectContext","entitySetWithObjectContextList","isApplyServiceDetailsEnabled","isContextPathChanged","isEntityPathChanged","validateCardGeneration","serviceUrl","fetchDetails","getEntityRelatedInfo","getProperty","createInstance","instance","dataSources","ui5Models","Object","values","map","dataSource","uri","filter","undefined","labelWithValue","model","getModel","entityNames","entityName","propertyRef","entity","fetchDataForObjectContext","_this","sFormattedUrl","_temp3","Promise","resolve","reject","read","success","oData","error","oError","_temp2","_temp","context","bindContext","requestObject","updateObjectContextFreeStyleModel","_this2","_temp5","_temp4","setProperty","getFreeStyleModelForDialog","__exports","__esModule"],"sources":["FreeStyle.ts"],"sourcesContent":["/*!\n * SAP UI development toolkit for HTML5 (SAPUI5)\n *  * (c) Copyright 2009-2025 SAP SE. All rights reserved\n */\nimport Log from \"sap/base/Log\";\nimport { AppType, getApplicationFloorplan } from \"sap/cards/ap/common/helpers/ApplicationInfo\";\nimport { getEntitySetWithContextURLs } from \"sap/cards/ap/common/odata/ODataUtils\";\nimport type { Model } from \"sap/cards/ap/generator/odata/ODataTypes\";\nimport { getEntityNames, getPropertyReference } from \"sap/cards/ap/generator/odata/ODataUtils\";\nimport type Component from \"sap/ui/core/Component\";\nimport JSONModel from \"sap/ui/model/json/JSONModel\";\nimport V2ODataModel from \"sap/ui/model/odata/v2/ODataModel\";\nimport V4ODataModel from \"sap/ui/model/odata/v4/ODataModel\";\nimport { Application } from \"./Application\";\n\nexport type ServiceDetails = {\n\tname: string;\n\tlabelWithValue: string;\n};\n\nexport type EntityDetails = {\n\tname: string;\n\tlabelWithValue: string;\n};\n\nexport type EntitySetWithContext = {\n\tname: string;\n\tlabelWithValue: string;\n};\n\n/**\n * Class for Object Page Application Info\n * Extends Application\n * implements the abstract function of the parent class validateCardGeneration, getEntityRelatedInfo, createInstance\n */\nexport class FreeStyle extends Application {\n\tfreeStyleDialogModel: JSONModel;\n\n\t/**\n\t * Constructor for ObjectPage class\n\t *\n\t * @param rootComponent The root component of the application.\n\t */\n\tconstructor(rootComponent: Component) {\n\t\tsuper(rootComponent);\n\t\tApplication.floorplan = \"FreeStyle\";\n\t\tconst appComponent = this._rootComponent;\n\t\tconst entitySetFromManifest = appComponent.getManifestEntry(\"/sap.cards.ap/embeds/ObjectPage/default\");\n\t\tconst serviceDetails = this.getServiceDetails();\n\t\tconst entityDetails = this.getEntityDetails();\n\t\tconst serviceURL = serviceDetails.length ? serviceDetails[0].name : \"\";\n\n\t\tthis.freeStyleDialogModel = new JSONModel({\n\t\t\tisServiceDetailsView: true,\n\t\t\tserviceDetails: serviceDetails,\n\t\t\tcurrentService: serviceURL,\n\t\t\tentitySet: entitySetFromManifest ? entitySetFromManifest : \"\",\n\t\t\tentities: entityDetails,\n\t\t\tentitySetWithObjectContext: \"\",\n\t\t\tentitySetWithObjectContextList: [],\n\t\t\tisApplyServiceDetailsEnabled: false,\n\t\t\tisContextPathChanged: false,\n\t\t\tisEntityPathChanged: false\n\t\t});\n\t}\n\n\t/**\n\t * Function to validate the card generation\n\t *\n\t * @returns boolean\n\t */\n\tpublic validateCardGeneration(): boolean {\n\t\tconst { serviceUrl } = this.fetchDetails();\n\t\tif (!serviceUrl) {\n\t\t\treturn false;\n\t\t}\n\n\t\treturn getApplicationFloorplan(this._rootComponent) === AppType.FreeStyle;\n\t}\n\n\t/**\n\t * Function to get the entity related information i.e. eentitySet and entitySetWithObjectContext\n\t *\n\t * @returns object\n\t */\n\tpublic getEntityRelatedInfo() {\n\t\treturn {\n\t\t\tentitySet: this.freeStyleDialogModel.getProperty(\"/entitySet\"),\n\t\t\tentitySetWithObjectContext: this.freeStyleDialogModel.getProperty(\"/entitySetWithObjectContext\")\n\t\t};\n\t}\n\n\t/**\n\t * Function to create instance of Application\n\t *\n\t * @param rootComponent The root component of the application\n\t * @returns Application\n\t */\n\tpublic static createInstance(rootComponent: Component): Application {\n\t\tif (!Application.instance) {\n\t\t\tApplication.instance = new FreeStyle(rootComponent);\n\t\t}\n\t\treturn Application.instance;\n\t}\n\n\t/**\n\t * Retrieves service details from the application's manifest.\n\t *\n\t * This function iterates over the UI5 models and matches them with the data sources to extract the service URLs.\n\t * It returns an array of service details, each containing the name and labelWithValue properties.\n\t *\n\t * @returns {ServiceDetails[]} An array of service details, each containing the name and labelWithValue properties.\n\t */\n\tprivate getServiceDetails(): ServiceDetails[] {\n\t\tconst appComponent = this._rootComponent;\n\t\tconst dataSources = appComponent.getManifestEntry(\"/sap.app/dataSources\");\n\t\tconst ui5Models: Record<string, any>[] = appComponent.getManifestEntry(\"/sap.ui5/models\");\n\n\t\treturn Object.values(ui5Models)\n\t\t\t.map(({ dataSource }) => dataSources[dataSource]?.uri)\n\t\t\t.filter((uri): uri is string => uri !== undefined)\n\t\t\t.map((uri) => ({\n\t\t\t\tname: uri,\n\t\t\t\tlabelWithValue: uri\n\t\t\t}));\n\t}\n\n\t/**\n\t * Retrieves the entity details from the model.\n\t *\n\t * @returns {EntityDetails[]} An array of entity details, each containing the name and labelWithValue properties.\n\t * @private\n\t */\n\tprivate getEntityDetails(): EntityDetails[] {\n\t\tconst model = this._rootComponent.getModel() as Model;\n\t\tconst entityNames = getEntityNames(model);\n\n\t\treturn entityNames\n\t\t\t.map((entityName) => {\n\t\t\t\tconst propertyRef = getPropertyReference(model, entityName);\n\t\t\t\treturn propertyRef.length > 0 ? { name: entityName, labelWithValue: entityName } : null;\n\t\t\t})\n\t\t\t.filter((entity): entity is EntityDetails => entity !== null);\n\t}\n\n\t/**\n\t * Fetches data for a given entity set with context.\n\t *\n\t * @param {string} entitySetWithObjectContext - The entity set with context to fetch data for.\n\t * @returns {Promise<void>} A promise that resolves when the data fetching is complete.\n\t */\n\tasync fetchDataForObjectContext(entitySetWithObjectContext: string): Promise<void> {\n\t\tconst model = this._rootComponent.getModel() as Model;\n\t\tconst sFormattedUrl = `/${entitySetWithObjectContext}`;\n\n\t\tif (model instanceof V2ODataModel) {\n\t\t\tawait new Promise((resolve, reject) => {\n\t\t\t\tmodel.read(sFormattedUrl, {\n\t\t\t\t\tsuccess: (oData: Record<string, any>[]) => {\n\t\t\t\t\t\tresolve(oData);\n\t\t\t\t\t},\n\t\t\t\t\terror: (oError: any) => {\n\t\t\t\t\t\tLog.error(\"Error fetching data for object context for OData V2 model\");\n\t\t\t\t\t\treject(oError);\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t});\n\t\t} else if (model instanceof V4ODataModel) {\n\t\t\ttry {\n\t\t\t\tconst context = model.bindContext(sFormattedUrl);\n\t\t\t\tawait context.requestObject();\n\t\t\t} catch (err) {\n\t\t\t\tLog.error(\"Error fetching data for object context for OData V4 model\");\n\t\t\t}\n\t\t}\n\t}\n\n\t/**\n\t * Updates the FreeStyle model with context information for the selected service and entity set.\n\t *\n\t * @returns {Promise<void>} A promise that resolves when the model update is complete.\n\t */\n\tasync updateObjectContextFreeStyleModel(): Promise<void> {\n\t\tconst serviceUrl = this.freeStyleDialogModel.getProperty(\"/currentService\");\n\t\tconst entitySet = this.freeStyleDialogModel.getProperty(\"/entitySet\");\n\t\tconst model = this._rootComponent.getModel() as Model;\n\n\t\tif (serviceUrl && entitySet) {\n\t\t\tconst entitySetWithObjectContextList = await getEntitySetWithContextURLs(serviceUrl, entitySet, model);\n\t\t\tconst entitySetWithObjectContext = entitySetWithObjectContextList?.length ? entitySetWithObjectContextList[0].name : \"\";\n\n\t\t\tif (entitySetWithObjectContext) {\n\t\t\t\tawait this.fetchDataForObjectContext(entitySetWithObjectContext);\n\t\t\t\tthis.freeStyleDialogModel.setProperty(\"/entitySetWithObjectContext\", entitySetWithObjectContext);\n\t\t\t\tthis.freeStyleDialogModel.setProperty(\"/entitySetWithObjectContextList\", entitySetWithObjectContextList);\n\t\t\t\tthis.freeStyleDialogModel.setProperty(\"/isApplyServiceDetailsEnabled\", true);\n\t\t\t}\n\t\t}\n\t}\n\n\tpublic getFreeStyleModelForDialog() {\n\t\treturn this.freeStyleDialogModel;\n\t}\n}\n"],"mappings":"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","ignoreList":[]}