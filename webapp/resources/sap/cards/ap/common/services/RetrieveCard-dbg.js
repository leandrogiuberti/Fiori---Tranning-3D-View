/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)
 *  * (c) Copyright 2009-2025 SAP SE. All rights reserved
 */
"use strict";sap.ui.define(["sap/cards/ap/transpiler/cardTranspiler/Transpile","sap/fe/navigation/SelectionVariant","../helpers/ApplicationInfo","../helpers/I18nHelper","../odata/ODataUtils","../semanticCard/CardFactory"],function(e,t,n,r,a,s){"use strict";function o(e,t){try{var n=e()}catch(e){return t(e)}if(n&&n.then){return n.then(void 0,t)}return n}const i=e["convertIntegrationCardToAdaptive"];const c=n["AppType"];const u=n["ApplicationInfo"];const d=n["ODataModelVersion"];const f=r["resolvei18nTextsForIntegrationCard"];const l=a["fetchFileContent"];const p=s["GenerateSemanticCard"];const m=s["createSemanticCardFactory"];var h=function(e){e["INTEGRATION"]="integration";e["ADAPTIVE"]="adaptive";return e}(h||{});const P=(e,t,n)=>{const r=e===h.INTEGRATION?"manifest.json":"adaptive-manifest.json";const a=n["sap.cards.ap"];if(a===undefined||Object.keys(a).length===0){return""}const s=a["embeds"]["ObjectPage"];if(s===undefined||Object.keys(s["manifests"]).length===0){return""}const o=s["manifests"][t||s.default][0];const i=o.localUri.endsWith("/")?o.localUri:o.localUri+"/";return"/"+i+r};const y=e=>{if(e.hasOwnProperty("SelectionVariantID")){delete e.SelectionVariantID}else if(e.hasOwnProperty("PresentationVariantID")){delete e.PresentationVariantID}delete e.Text;delete e.ODataFilterExpression;delete e.Version;delete e.FilterContextUrl;delete e.ParameterContextUrl;return e};const g=function(e){return Promise.resolve(o(function(){return Promise.resolve(l(e,"json"))},function(){return null}))};function v(e,t,n){if(n){return t}return e.endsWith("/")?`${e.slice(0,-1)}${t}`:`${e}${t}`}const O=function(e,t,n=false){try{function r(){const e=P(s||h.INTEGRATION,a,o);if(e.length===0){return Promise.reject("No cards available for this application")}const t=v(c,e,n);return g(t)}const{entitySet:a,cardType:s}=t;let o=e.getManifest();const i=o["sap.platform.abap"];const c=i?.uri??"";const u=function(){if(n){return Promise.resolve(g("/manifest.json")).then(function(e){o=e})}}();return Promise.resolve(u&&u.then?u.then(r):r(u))}catch(d){return Promise.reject(d)}};const T=function(e,n){try{const{semanticObject:r,action:a,variantParameter:s,contextParametersKeyValue:o}=n;const i=e["sap.card"]["header"];const c={};const u=new t;o.forEach(({key:e,value:t})=>{c[e]=t;u.addSelectOption(e,"I","EQ",t)});if(s){c["sap-appvar-id"]=s}c["sap-xapp-state-data"]=JSON.stringify({selectionVariant:y(u.toJSONObject())});i.actions=[{type:"Navigation",parameters:{ibnTarget:{semanticObject:r,action:a},ibnParams:c}}];return Promise.resolve()}catch(e){return Promise.reject(e)}};const j=(e,t=false)=>{const n=e.getManifest();return!(!n["sap.cards.ap"]&&!t)};function I(e){const t=window.location?.search;if(!t){return false}const n=new URLSearchParams(t);const r=n.get("generateSemanticCard");if(r===p.Always){return true}if(r===p.Lean){return!j(e)}return false}const b=function(e,t={isDesignMode:false,entitySet:"",keyParameters:{}}){try{return Promise.resolve(u.getInstance(e).fetchDetails(t)).then(function(e){const{entitySetWithObjectContext:t,appType:n,contextParameters:r}=e;return n===c.FreeStyle&&!t?[]:r.split(",").map(e=>{const[t,n]=e.split("=");const r=n.replace(/guid|datetimeoffset|datetime|'*/g,"");return{key:t,formattedValue:r}})})}catch(e){return Promise.reject(e)}};const A=function(e,t){const n=e.getManifest();const r=n["sap.cards.ap"]?.embeds.ObjectPage;if(r&&Object.keys(r["manifests"]).length>0){const e=r?.["default"];const n=e&&r["manifests"][e]?.[0]?.hideActions||false;const a=t?.["sap.card"]?.configuration?.parameters;if(n&&a?._adaptiveFooterActionParameters){delete a["_adaptiveFooterActionParameters"]}if(n&&a?.footerActionParameters){delete a["footerActionParameters"]}if(n&&t?.["sap.card"]?.footer){delete t["sap.card"]["footer"]}}};function S(e,t){const n=e["sap.card"].header.data;const r=t?"/header/":"/header/d/";if(n?.path){n.path=r}}const C=function(e,t){try{if(!t.entitySet||!t.keyParameters||Object.keys(t.keyParameters).length===0){return Promise.reject("Failed to share the card : Missing required parameters either entitySet or keyParameters")}return Promise.resolve(N(e,t))}catch(e){return Promise.reject(e)}};const N=function(e,t){try{let n=false;function r(r){if(n)return r;const a=t?.isDesignMode??false;const s={isDesignMode:a,entitySet:t.entitySet??"",keyParameters:t.keyParameters??{}};return Promise.resolve(u.getInstance(e).fetchDetails(s)).then(function(n){const{componentName:r,entitySet:o,context:c,resourceBundle:u,semanticObject:l,action:p,odataModel:m,variantParameter:P,navigationURI:y}=n;const g={cardType:h.INTEGRATION,componentName:r,entitySet:o,context:c};return Promise.resolve(O(e,g,a)).then(function(r){return!r||Object.keys(r).length===0?Promise.reject("No cards available for this application"):Promise.resolve(b(e,s)).then(function(a){if(t?.hideActions??true){A(e,r)}const s=t?.cardType||h.INTEGRATION;if(s===h.INTEGRATION){function o(){const e=m===d.V4;S(r,e);return f(r,u)}r["sap.card"]["data"]["request"]["headers"]["Accept-Language"]??="{{parameters.LOCALE}}";const c=r["sap.card"].configuration.parameters;const v=r["sap.card"]["data"];const O=v["request"]["batch"]["content"]["url"];if(O.includes("{{parameters.contextParameters}}")){r["sap.card"]["configuration"]["parameters"]["contextParameters"]={type:"string",value:g.context}}a.forEach(e=>{if(c[e.key]!==undefined){c[e.key]["value"]=e.formattedValue}});const j=function(){if(t?.includeActions??true){return Promise.resolve(T(r,n)).then(function(){})}}();return j&&j.then?j.then(o):o(j)}else{const I=f(r,u);const b=P?`${l}-${p}?sap-appvar-id=${P}`:`${l}-${p}`;return i(I,b,a,y)}})})})}const a=function(){if(I(e)){const r=m(e,{cardType:t?.cardType});return Promise.resolve(r.generateObjectCard()).then(function(e){n=true;return e})}}();return Promise.resolve(a&&a.then?a.then(r):r(a))}catch(s){return Promise.reject(s)}};var k={__esModule:true};k.CardTypes=h;k.getCardPath=P;k.fetchManifest=g;k._getObjectPageCardManifest=O;k.addActionsToCardHeader=T;k.isSemanticCardGeneration=I;k.getKeyParameters=b;k.updateHeaderDataPath=S;k.getCardManifestForPreview=C;k.getObjectPageCardManifestForPreview=N;return k});
//# sourceMappingURL=RetrieveCard-dbg.js.map