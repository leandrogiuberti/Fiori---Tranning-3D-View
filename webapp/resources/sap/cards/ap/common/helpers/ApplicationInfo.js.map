{"version":3,"file":"ApplicationInfo.js","names":["sap","ui","define","ResourceBundle","___odata_ODataUtils","createContextParameter","getEntitySetWithObjectContext","unquoteAndDecode","ODataModelVersion","AppType","getApplicationFloorplan","appComponent","isV2FioriElementsApp","getManifestEntry","ObjectPage","sapUI5Config","appTargets","routing","targets","appTargetKeys","Object","keys","fioriElementsApp","some","key","target","name","FreeStyle","ApplicationInfo","constructor","rootComponent","this","_rootComponent","appInfo","getInstance","instance","fetchDetails","fetchOptions","_exit","_this","_temp9","_result","_temp7","entitySetWithObjectContext","_temp6","contextParameters","Promise","resolve","i18nModel","getResourceBundle","then","resourceBundle","_temp5","odataModel","appModel","entitySet","context","componentName","semanticObject","action","appType","navigationURI","variantParameter","contextParametersKeyValue","length","getContextParametersKeyValue","_temp4","isDesignMode","i18nBundleUrl","oUrlInfo","url","timeStamp","Date","now","create","async","_ResourceBundle$creat","isODataV4","V4","getManifest","id","getModel","hash","window","hasher","getHash","hashPartial","split","includes","path","startsWith","slice","searchParams","URLSearchParams","get","index","indexOf","entitySetObjectPage","substring","isA","V2","_temp3","_temp8","_temp2","_this$appInfo","_temp","e","reject","map","param","value","cleanedValue","trim","_resetInstance","__exports","__esModule"],"sources":["ApplicationInfo.ts"],"sourcesContent":["/*!\n * SAP UI development toolkit for HTML5 (SAPUI5)\n *  * (c) Copyright 2009-2025 SAP SE. All rights reserved\n */\nimport ResourceBundle from \"sap/base/i18n/ResourceBundle\";\nimport Component from \"sap/ui/core/Component\";\nimport { default as V2ODataModel } from \"sap/ui/model/odata/v2/ODataModel\";\nimport { default as V4ODataModel } from \"sap/ui/model/odata/v4/ODataModel\";\nimport ResourceModel from \"sap/ui/model/resource/ResourceModel\";\nimport { createContextParameter, getEntitySetWithObjectContext, unquoteAndDecode } from \"../odata/ODataUtils\";\nimport type { FreeStyleFetchOptions, ObjectPageFetchOptions } from \"../types/CommonTypes\";\n\nexport enum ODataModelVersion {\n\tV2 = \"V2\",\n\tV4 = \"V4\"\n}\n\nexport enum AppType {\n\tFreeStyle = \"FreeStyle\",\n\tObjectPage = \"ObjectPage\"\n}\n\ntype ODataModel = V2ODataModel | V4ODataModel;\n\nexport type App = {\n\tappModel: ODataModel;\n\todataModel: ODataModelVersion;\n\tentitySet: string;\n\tcontext: string;\n\tentitySetWithObjectContext: string;\n\tcomponentName: string;\n\tresourceBundle: ResourceBundle;\n\tsemanticObject: string;\n\taction: string;\n\tappType: string;\n\tcontextParameters: string;\n\tnavigationURI: string | null;\n\tvariantParameter: string | null;\n\tcontextParametersKeyValue: Array<{ key: string; value: string }>;\n};\n\ntype ResourceBundleWithURL = ResourceBundle & { oUrlInfo: { url: string } };\n\ntype ManifestContentSapCardsAP = {\n\tembeds: {\n\t\tObjectPage?: {\n\t\t\tdefault: string;\n\t\t\tmanifests: {\n\t\t\t\t[key: string]: Array<{\n\t\t\t\t\tlocalUri: string;\n\t\t\t\t\thideActions: boolean;\n\t\t\t\t}>;\n\t\t\t};\n\t\t};\n\t};\n};\n\nexport type AppManifest = {\n\t\"sap.app\": {\n\t\tid: string;\n\t};\n\t\"sap.ui5\": {};\n\t\"sap.ui\": {};\n\t\"sap.fe\"?: {};\n\t\"sap.platform.abap\"?: {\n\t\turi: string;\n\t};\n\t\"sap.cards.ap\"?: ManifestContentSapCardsAP;\n};\n\n/**\n * Determines the application floorplan type based on the manifest entries of the provided app component.\n *\n * @param {Component} appComponent - The application component containing the manifest entries.\n * @returns {string} The floorplan type, either \"ObjectPage\" or \"FreeStyle\".\n */\nexport function getApplicationFloorplan(appComponent: Component): string {\n\tconst isV2FioriElementsApp = appComponent.getManifestEntry(\"sap.ui.generic.app\");\n\n\tif (isV2FioriElementsApp) {\n\t\treturn AppType.ObjectPage;\n\t}\n\n\tconst sapUI5Config = appComponent.getManifestEntry(\"sap.ui5\");\n\tconst appTargets = sapUI5Config?.routing?.targets;\n\n\tif (appTargets) {\n\t\tconst appTargetKeys = Object.keys(appTargets);\n\t\tconst fioriElementsApp = appTargetKeys.some((key) => {\n\t\t\tconst target = appTargets[key];\n\t\t\treturn target.name === \"sap.fe.templates.ObjectPage\" || target.name === \"sap.fe.templates.ListReport\";\n\t\t});\n\n\t\treturn fioriElementsApp ? AppType.ObjectPage : AppType.FreeStyle;\n\t}\n\n\treturn AppType.FreeStyle;\n}\n\nexport class ApplicationInfo {\n\tstatic instance: ApplicationInfo | null;\n\tappInfo: App | null;\n\t_rootComponent: Component;\n\n\tconstructor(rootComponent: Component) {\n\t\tthis._rootComponent = rootComponent;\n\t\tthis.appInfo = null;\n\t}\n\n\tpublic static getInstance(rootComponent: Component): ApplicationInfo {\n\t\tif (!ApplicationInfo.instance) {\n\t\t\tApplicationInfo.instance = new ApplicationInfo(rootComponent);\n\t\t}\n\t\treturn ApplicationInfo.instance;\n\t}\n\n\tpublic async fetchDetails(fetchOptions?: ObjectPageFetchOptions) {\n\t\tconst appType = getApplicationFloorplan(this._rootComponent);\n\t\t// Reuse cached appInfo without re-parsing hash if possible\n\t\tif (this.appInfo !== null && ApplicationInfo.instance !== null) {\n\t\t\tconst hash = window.hasher.getHash();\n\t\t\tconst path =\n\t\t\t\t(appType === AppType.FreeStyle\n\t\t\t\t\t? await getEntitySetWithObjectContext(this._rootComponent, fetchOptions as FreeStyleFetchOptions)\n\t\t\t\t\t: hash.split(\"&/\")[1]) || \"\";\n\t\t\tif (this.appInfo.entitySetWithObjectContext && path.includes(this.appInfo.entitySetWithObjectContext)) {\n\t\t\t\treturn this.appInfo;\n\t\t\t}\n\t\t}\n\n\t\tconst isDesignMode = fetchOptions?.isDesignMode || false;\n\t\tconst componentName = (this._rootComponent.getManifest() as AppManifest)[\"sap.app\"].id;\n\t\tconst appModel = this._rootComponent.getModel() as ODataModel;\n\t\tconst hash = window.hasher.getHash();\n\t\tconst [hashPartial] = hash.split(\"&/\");\n\t\tconst [semanticObject, action] = hashPartial.includes(\"?\") ? hashPartial.split(\"?\")[0].split(\"-\") : hashPartial.split(\"-\");\n\n\t\tlet path = hash.split(\"&/\")[1] || \"\";\n\t\tconst navigationURI = appType === AppType.FreeStyle ? path : null;\n\t\tpath = path.includes(\"/\") ? path.split(\"/\")[0] : path;\n\t\tpath = path.startsWith(\"/\") ? path.slice(1) : path;\n\t\tpath = path.includes(\"?\") ? path.split(\"?\")[0] : path;\n\n\t\tconst searchParams = new URLSearchParams(hash.split(\"?\")[1]);\n\t\tconst variantParameter = searchParams.get(\"sap-appvar-id\");\n\t\tconst index = path.indexOf(\"(\");\n\t\tconst entitySetObjectPage = index > -1 ? path.substring(0, index) : path;\n\t\tconst entitySet = appType === AppType.FreeStyle ? (fetchOptions as FreeStyleFetchOptions).entitySet : entitySetObjectPage;\n\t\tconst context = index > -1 ? path.substring(index + 1, path.indexOf(\")\")) : \"\";\n\t\tconst odataModel = appModel.isA<V4ODataModel>(\"sap.ui.model.odata.v4.ODataModel\") ? ODataModelVersion.V4 : ODataModelVersion.V2;\n\t\tconst i18nModel = (this._rootComponent.getModel(\"i18n\") || this._rootComponent.getModel(\"@i18n\")) as ResourceModel;\n\t\tconst entitySetWithObjectContext =\n\t\t\tappType === AppType.FreeStyle\n\t\t\t\t? await getEntitySetWithObjectContext(this._rootComponent, fetchOptions as FreeStyleFetchOptions)\n\t\t\t\t: path;\n\t\tconst isODataV4 = odataModel === ODataModelVersion.V4;\n\t\tconst contextParameters = entitySetWithObjectContext\n\t\t\t? await createContextParameter(entitySetWithObjectContext, appModel, isODataV4)\n\t\t\t: \"\";\n\t\tlet resourceBundle = await i18nModel.getResourceBundle();\n\n\t\tif (isDesignMode) {\n\t\t\t/* Refreshing or destroying the i18nModel does not fetch the latest values because of caching.\n\t\t\tFor cache busting, we are appending a unique identifier to the i18nBundleUrl to fetch the latest i18n values everytime dialog is opened. */\n\t\t\tconst i18nBundleUrl = (resourceBundle as ResourceBundleWithURL)?.oUrlInfo?.url;\n\t\t\tconst timeStamp = Date.now();\n\n\t\t\tresourceBundle = await ResourceBundle.create({\n\t\t\t\turl: `${i18nBundleUrl}?v=${timeStamp}`,\n\t\t\t\tasync: true\n\t\t\t});\n\t\t}\n\n\t\tthis.appInfo = {\n\t\t\todataModel,\n\t\t\tappModel,\n\t\t\tentitySet,\n\t\t\tentitySetWithObjectContext,\n\t\t\tcontext,\n\t\t\tcomponentName,\n\t\t\tresourceBundle,\n\t\t\tsemanticObject,\n\t\t\taction,\n\t\t\tappType,\n\t\t\tcontextParameters,\n\t\t\tnavigationURI,\n\t\t\tvariantParameter,\n\t\t\tcontextParametersKeyValue: contextParameters.length ? this.getContextParametersKeyValue(contextParameters) : []\n\t\t};\n\n\t\treturn this.appInfo;\n\t}\n\n\t/**\n\t * Parses a context parameter string into an array of key-value objects.\n\t *\n\t * The context parameter string should be in the format: \"key1=value1,key2=value2,...\".\n\t * Each value is decoded and unquoted using `unquoteAndDecode`.\n\t *\n\t * @param {string} contextParameters - The context parameter string to parse.\n\t * @returns {Array<{ key: string; value: string }>} An array of objects with `key` and `value` properties.\n\t */\n\tprivate getContextParametersKeyValue(contextParameters: string): Array<{ key: string; value: string }> {\n\t\treturn contextParameters.split(\",\").map((param) => {\n\t\t\tconst [key, value] = param.split(\"=\");\n\t\t\tconst cleanedValue = unquoteAndDecode(value);\n\t\t\treturn { key: key.trim(), value: cleanedValue };\n\t\t});\n\t}\n\n\t/**\n\t * for testing purposes only\n\t */\n\t_resetInstance() {\n\t\tApplicationInfo.instance = null;\n\t}\n}\n"],"mappings":"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","ignoreList":[]}