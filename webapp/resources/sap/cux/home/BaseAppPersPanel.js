/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)
 *  * (c) Copyright 2009-2025 SAP SE. All rights reserved
 */
sap.ui.define(["sap/ui/core/EventBus","./BaseAppPanel","./Group","./utils/CommonUtils","./utils/Constants","./utils/DataFormatUtils","./utils/PersonalisationUtils","./utils/UshellPersonalizer"],function(e,t,n,o,r,s,i,a){"use strict";function c(e){return e&&e.__esModule&&typeof e.default!=="undefined"?e.default:e}const u=c(t);const p=c(n);const l=o["getPageManagerInstance"];const g=r["DEFAULT_APP_ICON"];const f=r["DEFAULT_BG_COLOR"];const d=r["FALLBACK_ICON"];const P=r["MYHOME_PAGE_ID"];const h=s["getLeanURL"];const I=c(i);const m=c(a);const _=u.extend("sap.cux.home.BaseAppPersPanel",{metadata:{library:"sap.cux.home",properties:{persContainerId:{type:"string",group:"Misc",defaultValue:"",visibility:"hidden"}}},constructor:function e(t,n){u.prototype.constructor.call(this,t,n);this.firstLoad=true},init:function t(){u.prototype.init.call(this);this._eventBus=e.getInstance();this._eventBus.subscribe("pageChannel","pageUpdated",()=>{void this.applyPersonalization(!this.firstLoad)},this)},_getPersonalizer:function e(){try{const e=this;const t=e._getPersContainerId();if(!t){throw new Error("No Container ID Provided for personalisation!")}return Promise.resolve(m?.getInstance(t,I.getOwnerComponent(e)))}catch(e){return Promise.reject(e)}},getPersonalization:function e(){try{const e=this;return Promise.resolve(e._getPersonalizer()).then(function(e){return Promise.resolve(e?.read()).then(function(e){return e||{}})})}catch(e){return Promise.reject(e)}},setPersonalization:function e(t){try{const e=this;return Promise.resolve(e._getPersonalizer()).then(function(e){return Promise.resolve(e.write(t)).then(function(){})})}catch(e){return Promise.reject(e)}},_getAppPersonalization:function e(){try{const e=this;return Promise.resolve(e.getPersonalization()).then(function(e){return e?.favoriteApps||[]})}catch(e){return Promise.reject(e)}},setFavAppsPersonalization:function e(t){try{const e=this;return Promise.resolve(e.getPersonalization()).then(function(n){const o=function(){if(n){n.favoriteApps=t;return Promise.resolve(e.setPersonalization(n)).then(function(){})}}();if(o&&o.then)return o.then(function(){})})}catch(e){return Promise.reject(e)}},applyPersonalization:function e(t=false){try{const e=this;let n=e.fetchTileVisualization();return Promise.resolve(e._applyTilesPersonalization(n,undefined,t)).then(function(){if(e.firstLoad){e.firstLoad=false}})}catch(e){return Promise.reject(e)}},_applyTilesPersonalization:function e(t,n,o=false){try{const e=this;return Promise.resolve(Promise.all([e._getAppPersonalization(),e._getFavPages()])).then(function([r,s]){return Promise.resolve(e.appManagerInstance._getAllFavPageApps(s,o)).then(function(o){const s=e.getAggregation("groups")||[];const i=n?e._getGroup(n)?.getApps()||[]:e.getApps()||[];for(const a of t){const t=e._getItem(a,s,i);const{color:c,icon:u}=e._getItemPersonalization(t,r,o,n);if(c){t?.setProperty("bgColor",c,true);a.setBackgroundColor(c)}if(u){t?.setProperty("icon",u,true);a.setTileIcon(u)}}})})}catch(e){return Promise.reject(e)}},_getItem:function e(t,n,o){const r=t.data("groupId");if(r){return n.find(e=>e.getGroupId()===r)}else{return o.find(e=>h(e.getUrl())===t.getUrl())}},_getItemPersonalization:function e(t,n,o,r){let s="";let i="";if(!t)return{color:s,icon:i};if(t instanceof p){const e=n?.find(e=>e.isSection&&e.sectionId===t.getGroupId());s=e?.BGColor}else{const e=t;const a=[e.getUrl()];const c=e.data("oldAppId");if(c){a.push(c)}const u=e.getVizId();const p=r?n?.find(e=>!e.isSection&&e.sectionId===r&&e.appId&&a.includes(e.appId)):n?.find(e=>this?.getMetadata().getName()==="sap.cux.home.FavAppPanel"?e.isRecentlyAddedApp&&e.appId&&a.includes(e.appId):e.appId&&a.includes(e.appId));const l=o.find(e=>e.vizId===u||e.appId&&a.includes(e.appId));const g=p?.BGColor||l?.BGColor||f().key;const d=this?.getMetadata().getName();s=typeof g==="object"?g.key:g;i=d==="sap.cux.home.FavAppPanel"||d==="sap.cux.home.SpacePanel"?this._getFavAppIcon(e,l?.icon):this.getAppIcon()}return{color:s,icon:i}},_getFavPages:function e(){try{const e=this;return Promise.resolve(e._getPageManagerInstance().getFavoritePages()).then(function(e){return e.concat({pageId:P,BGColor:f().key})})}catch(e){return Promise.reject(e)}},getAppIcon:function e(){return g},_getFavAppIcon:function e(t,n){return n||t?.getIcon()||d},_getPageManagerInstance:function e(){this._pageManagerInstance=this._pageManagerInstance||l(this);return this._pageManagerInstance},_getPersContainerId:function e(){let t=this.getProperty("persContainerId");if(!t){t=I.getPersContainerId(this)}return t}});return _});
//# sourceMappingURL=BaseAppPersPanel.js.map