/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)
 *  * (c) Copyright 2009-2025 SAP SE. All rights reserved
 */
sap.ui.define(["sap/base/Log","sap/m/Button","sap/m/Column","sap/m/ColumnListItem","sap/m/FlexBox","sap/m/HBox","sap/m/MessageBox","sap/m/MessageToast","sap/m/ObjectIdentifier","sap/m/ScrollContainer","sap/m/SearchField","sap/m/Switch","sap/m/Table","sap/m/Text","sap/m/Title","sap/m/VBox","sap/ui/core/Element","sap/ui/core/Icon","./BaseSettingsPanel","./TilesPanel","./utils/Accessibility","./utils/AppManager","./utils/Constants","./utils/DragDropUtils"],function(t,e,i,n,s,a,r,o,l,p,d,h,c,g,u,_,I,m,w,f,T,x,C,S){"use strict";function B(t){return t&&t.__esModule&&typeof t.default!=="undefined"?t.default:t}function v(t,e){try{var i=t()}catch(t){return e(t)}if(i&&i.then){return i.then(void 0,e)}return i}const y=B(w);function $(t,e){try{var i=t()}catch(t){return e(true,t)}if(i&&i.then){return i.then(e.bind(null,false),e.bind(null,true))}return e(false,i)}const M=f["DisplayFormat"];const A=T["getInvisibleText"];const b=B(x);const P=C["MYHOME_PAGE_ID"];const z=C["SETTINGS_PANELS_KEYS"];const F=S["focusDraggedItem"];const D=y.extend("sap.cux.home.InsightsTilesSettingsPanel",{init:function t(){y.prototype.init.call(this);this._controlMap=new Map;this.setProperty("key",z.INSIGHTS_TILES);this.setProperty("title",this._i18nBundle.getText("insightsTiles"));this.setProperty("icon","sap-icon://manager-insight");this.appManagerInstance=b.getInstance();this._allInsightsApps=[];this._wrapperId=`${this.getId()}-tilesSettingsWrapper`;this._controlMap.set(this._wrapperId,new s(this._wrapperId,{alignItems:"Start",justifyContent:"Start",height:"100%",width:"100%",direction:"Column"}).addStyleClass("flexContainerCards"));this.addAggregation("content",this._controlMap.get(this._wrapperId));this._showMessageStrip();this._showToolbar();this._showTilesList();this.attachPanelNavigated(()=>{this._controlMap.get(`${this._wrapperId}--searchField`).setValue("");void this.appManagerInstance.fetchInsightApps(true,this._i18nBundle.getText("insights")).then(t=>{this._allInsightsApps=t;this._controlMap.get(`${this._wrapperId}--title`).setText(`${this._i18nBundle.getText("insightsTilesTitle")} (${this._allInsightsApps.length})`);this._createTableRows(this._allInsightsApps)})})},_showMessageStrip:function t(){const e=new _(`${this._wrapperId}--msgStripContainer`,{width:"calc(100% - 2rem)"}).addStyleClass("sapUiSmallMarginTop sapUiSmallMarginBegin");e.addItem(new g(`${this._wrapperId}--msgStripText`,{text:this._i18nBundle.getText("insightAppsTabText")}));this._getWrapperFlexBox().addItem(e)},_showToolbar:function t(){this._controlMap.set(`${this._wrapperId}--title`,new u(`${this._wrapperId}--title`,{text:`${this._i18nBundle.getText("insightsTilesTitle")} (${this._allInsightsApps.length})`,titleStyle:"H3",width:"100%"}).addStyleClass("tilesFontChange"));const e=A(`${this.getId()}--TileTitleText`,this._i18nBundle.getText("insightsTiles"));this._controlMap.set(`${this._wrapperId}--searchField`,new d(`${this._wrapperId}--pagesListSearch`,{liveChange:t=>this._onTilesSearch(t),width:"100%",ariaLabelledBy:[e.getId(),this._wrapperId+"--msgStripText",this._wrapperId+"--title"]}).addStyleClass("sapUiTinyMarginTop"));const i=new a(`${this._wrapperId}--titleContainer`,{alignItems:"Center",justifyContent:"SpaceBetween",width:"100%"});i.addItem(this._controlMap.get(`${this._wrapperId}--title`));i.addItem(e);const n=new _(`${this._wrapperId}--toolbarContainer`,{width:"calc(100% - 2rem)",items:[i,this._controlMap.get(`${this._wrapperId}--searchField`)]}).addStyleClass("sapUiSmallMarginTop sapUiSmallMarginBegin");this._getWrapperFlexBox().addItem(n)},_onTilesSearch:function t(e){const i=e.getSource().getValue().toLowerCase();const n=this._allInsightsApps.filter(t=>t.visualization?.title?.toLowerCase().includes(i));this._createTableRows(n)},_showTilesList:function t(){this._createTableWithContainer();this._createTableRows(this._allInsightsApps)},_createTableWithContainer:function t(){const e=new c(`${this._wrapperId}-table`,{columns:[new i(`${this._wrapperId}-table-dndIcon`,{hAlign:"Center",width:"6%"}),new i(`${this._wrapperId}-table-title`,{width:"94%"})]}).addStyleClass("sapContrastPlus");const n=A(`${this._wrapperId}-dndAria`,this._i18nBundle.getText("keyPressAriaText"));this.addDragDropConfigTo(e,t=>void this._handleTilesDrop(t));this._controlMap.set(`${this._wrapperId}-table`,e);const a=new p(`${this._wrapperId}-scrollContainer`,{vertical:true,horizontal:false,height:"100%",width:"100%",content:[this._controlMap.get(`${this._wrapperId}-table`)]});const r=new _(`${this._wrapperId}-containerVBox`,{height:"100%",width:"100%",justifyContent:"Start",direction:"Column",items:[n,a]});const o=new s(`${this._wrapperId}-containerFlexBox`,{alignItems:"Start",justifyContent:"Start",height:"100%",width:"calc(100% - 2rem)",direction:"Row",items:[r]}).addStyleClass("sapUiSmallMarginBegin sapUiSmallMarginTop flexContainerCards");this._getWrapperFlexBox().addItem(o)},_handleTilesDrop:function t(e){try{const i=this;function n(){F(d,o)}const s=e.getParameter?.("draggedControl")||e.draggedControl,a=s.getParent()?.indexOfItem(s),r=e.getParameter?.("droppedControl")||e.droppedControl,o=s.getParent()?.indexOfItem(r),l=s.data("persConfig"),p=r.data("persConfig"),d=i._controlMap.get(`${i._wrapperId}-table`);const h=function(){if(a!==o){i._getWrapperFlexBox().setBusy(true);const t={pageId:P,sourceSectionIndex:l.sectionIndex,sourceVisualizationIndex:l.visualizationIndex,targetSectionIndex:p.sectionIndex,targetVisualizationIndex:p.visualizationIndex};return Promise.resolve(i.appManagerInstance.moveVisualization(t)).then(function(){return Promise.resolve(i.appManagerInstance.fetchInsightApps(true,i._i18nBundle.getText("insights"))).then(function(t){i._allInsightsApps=t;i._createTableRows(i._allInsightsApps);return Promise.resolve(i._getTilePanel().refreshData()).then(function(){i._getWrapperFlexBox().setBusy(false)})})})}}();return Promise.resolve(h&&h.then?h.then(n):n(h))}catch(c){return Promise.reject(c)}},_createTableRows:function t(e){const i=this._controlMap.get(`${this._wrapperId}-table`);i.removeAllItems();let n=e;const s=this._controlMap.get(`${this._wrapperId}--searchField`).getValue();if(s){n=this._allInsightsApps.filter(t=>t.visualization?.title?.toLowerCase().includes(s))}n.forEach((t,e)=>{i.addItem(this._createColumnListItem(t,e))})},_createColumnListItem:function t(i,s){const r=`insightsTiles-${s}-listItem`;const o=I.getElementById(r);if(o){o.destroy()}const p=new n({id:r,type:"Inactive",ariaLabelledBy:[r,`${this._wrapperId}-dndAria`]}).addStyleClass("insightsListItem insightsListMargin manageSectionsTable");p.addCell(new a(`${r}-DndHBox`,{items:[new m(`${r}-DndIcon`,{src:"sap-icon://BusinessSuiteInAppSymbols/icon-grip"}).addStyleClass("tilesDndIcon")]}));const d=i.visualization?.supportedDisplayFormats||"";let c;if((i.isCount||i.isSmartBusinessTile)&&d.length>1&&d.indexOf(M.Standard)>-1&&d.indexOf(M.StandardWide)>-1){c=new a({id:`${r}-convertSwitchContainer`,alignItems:"Center",items:[new g({id:`${r}-switchAppSizeLabel`,text:this._i18nBundle.getText("wide"),wrapping:false}),new h({id:`${r}-convertSwitch`,state:i.visualization?.displayFormatHint!==M.Standard,change:()=>void this._onConvertTilePress(i),customTextOn:" ",customTextOff:" ",tooltip:i.visualization?.displayFormatHint===M.Standard?this._i18nBundle.getText("ConvertToWideTile"):this._i18nBundle.getText("ConvertToTile")})]})}const u=new e({id:`${r}-deleteAppBtn`,type:"Transparent",icon:"sap-icon://decline",press:()=>this._onDeleteApp(i),tooltip:this._i18nBundle.getText("removeFromInsights")});const _=new a({id:`${r}-buttonsWrapper`,alignItems:"Center"}).addStyleClass("sapUiSmallMarginEnd");if(c){_.addItem(c)}_.addItem(u);p.addCell(new a({id:`${r}-cell`,alignItems:"Center",justifyContent:"SpaceBetween",items:[new l({id:`${r}-cellItem`,title:i.visualization?.title,text:i.visualization?.subtitle,tooltip:i.visualization?.title}).addStyleClass("objectIdentifierMargin"),_]}));p.data("persConfig",i.persConfig);return p},_onConvertTilePress:function t(e){try{const t=this;const i=e.visualization?.displayFormatHint,n={pageId:P,sourceSectionIndex:e.persConfig?.sectionIndex,sourceVisualizationIndex:e.persConfig?.visualizationIndex,oVisualizationData:{displayFormatHint:i===M.Standard?M.StandardWide:M.Standard}};t._getWrapperFlexBox().setBusy(true);return Promise.resolve(t.appManagerInstance.updateVisualizations(n)).then(function(){return Promise.resolve(t._getTilePanel().refreshData()).then(function(){if(e.visualization){e.visualization.displayFormatHint=n.oVisualizationData.displayFormatHint}t._getWrapperFlexBox().setBusy(false)})})}catch(t){return Promise.reject(t)}},_onDeleteApp:function t(e){r.show(this._i18nBundle.getText("remove_tile_confirmation_title",[e.title]),{id:"removeTileConfirmation",styleClass:"msgBoxWidth",icon:r.Icon.QUESTION,title:this._i18nBundle.getText("remove"),actions:[this._i18nBundle.getText("remove"),r.Action.CANCEL],emphasizedAction:this._i18nBundle.getText("remove"),onClose:t=>this._handleDeleteApp(t,e)})},_handleDeleteApp:function e(i,n){try{const e=this;const s=function(){if(i===e._i18nBundle.getText("remove")){e._getWrapperFlexBox().setBusy(true);const i=$(function(){return v(function(){return Promise.resolve(e.appManagerInstance.removeVisualizations({sectionId:n.persConfig?.sectionId,vizIds:[n.visualization?.id]})).then(function(){o.show(e._i18nBundle.getText("appRemovedInsights"));return Promise.resolve(e.appManagerInstance.fetchInsightApps(true,e._i18nBundle.getText("insights"))).then(function(t){e._allInsightsApps=t;e._controlMap.get(`${e._wrapperId}--title`).setText(`${e._i18nBundle.getText("insightsTilesTitle")} (${e._allInsightsApps.length})`);e._createTableRows(e._allInsightsApps);return Promise.resolve(e._getTilePanel().refreshData()).then(function(){})})})},function(i){t.error(i);o.show(e._i18nBundle.getText("unableToRemoveInsightsApp"))})},function(t,i){e._getWrapperFlexBox().setBusy(false);if(t)throw i;return i});if(i&&i.then)return i.then(function(){})}}();return Promise.resolve(s&&s.then?s.then(function(){}):void 0)}catch(t){return Promise.reject(t)}},_getWrapperFlexBox:function t(){return this._controlMap.get(this._wrapperId)},_getTilePanel:function t(){return this._getPanel()}});return D});
//# sourceMappingURL=InsightsTilesSettingsPanel.js.map