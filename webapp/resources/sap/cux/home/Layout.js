/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)
 *  * (c) Copyright 2009-2025 SAP SE. All rights reserved
 */
sap.ui.define(["sap/base/Log","sap/ui/core/Element","sap/ushell/api/S4MyHome","sap/ushell/Container","./AdvancedSettingsPanel","./BaseLayout","./BaseLayoutRenderer","./ContentAdditionDialog","./InsightsCardsSettingsPanel","./InsightsTilesSettingsPanel","./KeyUserLayoutSettingsPanel","./KeyUserNewsPagesSettingsPanel","./KeyUserSettingsDialog","./LayoutSettingsPanel","./NewsAndPagesContainer","./NewsSettingsPanel","./NoDataContainer","./PagePanel","./PageSettingsPanel","./SettingsDialog","./ToDosContainer","./utils/Constants","./utils/DataFormatUtils","./utils/PerformanceUtils","./utils/PersonalisationUtils"],function(t,e,n,s,i,o,a,r,c,l,g,u,f,h,d,P,p,S,y,m,_,D,A,b,v){"use strict";function C(t){return t&&t.__esModule&&typeof t.default!=="undefined"?t.default:t}const w=typeof Symbol!=="undefined"?Symbol.iterator||(Symbol.iterator=Symbol("Symbol.iterator")):"@@iterator";function I(t,e,n){if(!t.s){if(n instanceof k){if(n.s){if(e&1){e=n.s}n=n.v}else{n.o=I.bind(null,t,e);return}}if(n&&n.then){n.then(I.bind(null,t,e),I.bind(null,t,2));return}t.s=e;t.v=n;const s=t.o;if(s){s(t)}}}const k=function(){function t(){}t.prototype.then=function(e,n){const s=new t;const i=this.s;if(i){const t=i&1?e:n;if(t){try{I(s,1,t(this.v))}catch(t){I(s,2,t)}return s}else{return this}}this.o=function(t){try{const i=t.v;if(t.s&1){I(s,1,e?e(i):i)}else if(n){I(s,1,n(i))}else{I(s,2,i)}}catch(t){I(s,2,t)}};return s};return t}();function N(t){return t instanceof k&&t.s&1}function U(t,e,n){var s=-1,i,o;function a(r){try{while(++s<t.length&&(!n||!n())){r=e(s);if(r&&r.then){if(N(r)){r=r.v}else{r.then(a,o||(o=I.bind(null,i=new k,2)));return}}}if(i){I(i,1,r)}else{i=r}}catch(t){I(i||(i=new k),2,t)}}a();return i}const x=C(i);function E(t,e,n){if(typeof t[w]==="function"){var s=t[w](),i,o,a;function g(t){try{while(!(i=s.next()).done&&(!n||!n())){t=e(i.value);if(t&&t.then){if(N(t)){t=t.v}else{t.then(g,a||(a=I.bind(null,o=new k,2)));return}}}if(o){I(o,1,t)}else{o=t}}catch(t){I(o||(o=new k),2,t)}}g();if(s.return){var r=function(t){try{if(!i.done){s.return()}}catch(t){}return t};if(o&&o.then){return o.then(r,function(t){throw r(t)})}r()}return o}if(!("length"in t)){throw new TypeError("Object is not iterable")}var c=[];for(var l=0;l<t.length;l++){c.push(t[l])}return U(c,function(t){return e(c[t])},n)}const T=C(o);function L(t,e){try{var n=t()}catch(t){return e(t)}if(n&&n.then){return n.then(void 0,e)}return n}const O=C(a);const B=C(r);const $=C(c);const V=C(l);const j=C(g);const H=C(u);const M=C(f);const K=C(h);const R=C(d);const F=C(P);const G=C(p);const Y=C(S);const q=C(y);const z=C(m);const J=C(_);const Q=D["SETTINGS_PANELS_KEYS"];const W=A["recycleId"];const X=b["setupPerformanceTracking"];const Z=C(v);const tt=T.extend("sap.cux.home.Layout",{renderer:O,metadata:{designtime:"sap/cux/home/designtime/Layout.designtime"},constructor:function t(e,n){T.prototype.constructor.call(this,e,n);this._shellUserActions=[];this._isDefaultSettingsDialog=false;this._customNoDataContainerPresent=true},init:function t(){T.prototype.init.call(this);this.setProperty("enableSettings",true);this.setProperty("enableFullScreen",true)},_addUserActions:function e(){try{const e=this;return Promise.resolve(L(function(){const t=function(){if(e.getVisible()&&!e._userActionsAdded){e._userActionsAdded=true;const t=[{icon:"sap-icon://edit",text:e._i18nBundle.getText("myHomeSettings"),tooltip:e._i18nBundle.getText("myHomeSettings"),press:()=>{void e.openSettingsDialog()}}];return Promise.resolve(s.getServiceAsync("Extension")).then(function(s){function i(){const t=t=>{const n=t.getParameter("isMyHomeRoute");e._shellUserActions.forEach(function(t){if(n){t.showOnHome()}else{t.hideOnHome()}})};n.attachRouteMatched({},t,e)}const o=E(t,function(t){return Promise.resolve(s.createUserAction(t,{controlType:"sap.ushell.ui.launchpad.ActionItem"})).then(function(t){t.showOnHome();e._shellUserActions.push(t)})});return o&&o.then?o.then(i):i(o)})}}();if(t&&t.then)return t.then(function(){})},function(e){t.warning("Unable to add User Actions",e instanceof Error?e.message:"")}))}catch(t){return Promise.reject(t)}},openSettingsDialog:function t(e="",n){try{const t=this;const s=t.getAggregation("settingsDialog");if(s.getPanels().length!==t._getSettingsPanels().length){t._addPanelsToSettingsDialog()}return Promise.resolve(t._calculateSectionsState()).then(function(){T.prototype.openSettingsDialog.call(t,e,n)})}catch(t){return Promise.reject(t)}},closeSettingsDialog:function t(){const e=this.getAggregation("settingsDialog");e?.close()},onBeforeRendering:function t(e){try{const t=this;T.prototype.onBeforeRendering.call(t,e);t._setupSettingsDialog();t._setupContentAdditionDialog();const n=t.getProperty("persContainerId");if(n){Z.setPersContainerId(n)}t.getNoDataContainer();if(!t._aOrderedSections){setTimeout(t._prepareLayoutData.bind(t))}t._setupKeyUserSettingsDialog();return Promise.resolve(X(t)).then(function(){return Promise.resolve(t._addUserActions()).then(function(){})})}catch(t){return Promise.reject(t)}},_setupSettingsDialog:function t(){const e=[];(this.getItems()||[]).forEach(t=>{t.setAssociation("layout",this);t.getContent().forEach(t=>{e.push(t);const n=t.getProperty("enableSettings");t.setProperty("enableSettings",n!==undefined?n:true)})});const n=this.getProperty("enableSettings");const s=this.getAggregation("settingsDialog");if(!s){this._isDefaultSettingsDialog=true;if(n){const t=this._getDefaultSettingsDialog(e);this.setSettingsDialog(t)}}},_getDefaultSettingsDialog:function t(e){const n=new z(`${this.getId()}-settings-dialog`);e.forEach(t=>{const e=this._getDefaultSettingsPanel(t);if(e){n.addPanel(e)}});const s=this._sortPanels(n.getPanels());n.removeAllPanels();s.forEach(t=>n.addPanel(t));n.insertPanel(this._getLayoutSettingsPanel(),0);n.addPanel(this._getAdvancedSettingsPanel());return n},_getDefaultSettingsPanel:function t(e){let n;const s=e.getMetadata().getName();switch(s){case"sap.cux.home.NewsPanel":n=new F(`${e.getId()}-news-settings`);break;case"sap.cux.home.PagePanel":n=new q(`${e.getId()}-page-settings`);break;case"sap.cux.home.TilesPanel":n=new V(`${e.getId()}-tiles-settings`);break;case"sap.cux.home.CardsPanel":n=new $(`${e.getId()}-cards-settings`);break;default:break}n?.setAssociation("panel",e);return n},_addPanelsToSettingsDialog:function t(){const e=this.getAggregation("settingsDialog");const n=this._sortPanels(e.getPanels());e.removeAllPanels();n.forEach(t=>e.addPanel(t));if(this._isDefaultSettingsDialog){const t=e.getPanels();const n=this._getLayoutSettingsPanel();const s=this._getAdvancedSettingsPanel();if(t.indexOf(n)!==0){e.insertPanel(n,0)}if(t.indexOf(s)!==t.length-1){e.addPanel(s)}}this._addSettingsPanel(e.getPanels(),true)},_sortPanels:function t(e){return Object.keys(Q).map(t=>e.find(e=>e?.getProperty("key")===t)).filter(Boolean)},_getAdvancedSettingsPanel:function t(){if(!this._advancedSettingsPanel){this._advancedSettingsPanel=new x(`${this.getId()}-advanced-settings`);this._advancedSettingsPanel.setAssociation("panel",this)}return this._advancedSettingsPanel},_getLayoutSettingsPanel:function t(){if(!this._layoutSettingsPanel){this._layoutSettingsPanel=new K(`${this.getId()}-layout-settings`);this._layoutSettingsPanel.setAssociation("panel",this)}return this._layoutSettingsPanel},getNoDataContainer:function t(){if(!this._noDataContainer){this._noDataContainer=this.getItems().find(t=>t instanceof G);if(!this._noDataContainer){this._customNoDataContainerPresent=false;this._noDataContainer=new G(W(`${this.getId()}-noDataContainer`))}this._noDataContainer.setVisible(false)}return this._noDataContainer},_prepareLayoutData:function t(){let n=false;const s=this.getProperty("expanded");const i=this._aOrderedSections?.map(t=>e.getElementById(t.completeId))||[];const o=s&&i.length?i:this.getItems();const a=[];o.forEach(t=>{if(t!==this.getNoDataContainer()){const e=t.getId();let s=t.getProperty("title");if(!s){s=t.getTooltip()}const i=t.getVisible();const o=t.getCustomSettings();a.push({completeId:e,sContainerType:t.getMetadata().getName(),blocked:false,visible:t.getProperty("visible"),title:o.title||s,text:o.text});if(i){n=true}}});this._aOrderedSections=a;if(!this.getProperty("expanded")){this.setNoDataContainerVisibility(!n)}},setNoDataContainerVisibility:function t(e){const n=this.getNoDataContainer();n?.setVisible(e);if(!this._customNoDataContainerPresent){if(e){this.insertItem(n,0)}else{this.removeItem(n)}}},_calculateSectionsState:function t(){try{const t=this;const e=t.getAggregation("settingsDialog");const n=e.getPanels();t._isCustomNews=false;n.forEach(e=>{if(e instanceof F){t._isCustomNews=true}if(e instanceof x){e.resetImportModel(true)}});return Promise.resolve(t.setSectionDetails()).then(function(){})}catch(t){return Promise.reject(t)}},setSectionDetails:function t(){try{const t=this;const e=t.getItems();const n=E(e,function(e){function n(){t._aOrderedSections?.forEach(t=>{if(t.completeId===i){t.blocked=s;t.visible=e.getVisible()}})}let s=false;const i=e.getId();const o=function(){if(e instanceof R&&e.getVisible()){function n(t){s=t}const i=e.getContent();const o=i.length;return o?Promise.resolve(t.checkPagesBlocked(i)).then(n):n(false)}else if(e instanceof J){s=t.checkToDoBlocked(e)}}();return o&&o.then?o.then(n):n(o)});return Promise.resolve(n&&n.then?n.then(function(){}):void 0)}catch(t){return Promise.reject(t)}},checkPagesBlocked:function t(e){try{const n=this;function s(){return!n._pagesAvailable&&!n._isCustomNews?true:false}const i=E(e,function(t){const e=function(){if(t instanceof Y){return Promise.resolve(t.getUserAvailablePages()).then(function(t){n._pagesAvailable=t.length>0})}}();if(e&&e.then)return e.then(function(){})});return Promise.resolve(i&&i.then?i.then(s):s(i))}catch(o){return Promise.reject(o)}},checkToDoBlocked:function t(e){if(!e.getVisible()){const t=e.getContent();if(t.length===0){this._toDoAccessible=false;return true}}return false},_setupKeyUserSettingsDialog:function t(){const e=this.getAggregation("keyUserSettingsDialog");if(!e){const t=new M(`${this.getId()}-keyUser-settings-dialog`);const e=new j(`${this.getId()}-keyUser-layout-settings`);e.setAssociation("panel",this);t.addPanel(e);(this.getItems()||[]).forEach(e=>{if(e instanceof R){const n=new H(`${this.getId()}-keyUser-news-pages-settings`);n.setAssociation("panel",e.getContent()?.[0]);t.addPanel(n)}});this.setAggregation("keyUserSettingsDialog",t)}},getpagesAvailable:function t(){return this._pagesAvailable},isToDoAccessible:function t(){return this._toDoAccessible},customNewAvailable:function t(){return this._isCustomNews},getSections:function t(){return this._aOrderedSections},setSections:function t(e){this._aOrderedSections=e},resetSections:function t(){this._prepareLayoutData()},_setupContentAdditionDialog:function t(){let e=this.getAggregation("contentAdditionDialog");if(!e){e=new B(`${this.getId()}-content-addition-dialog`);this.setAggregation("contentAdditionDialog",e)}}});return tt});
//# sourceMappingURL=Layout.js.map