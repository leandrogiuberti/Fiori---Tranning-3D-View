/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)
 *  * (c) Copyright 2009-2025 SAP SE. All rights reserved
 */
sap.ui.define(["sap/base/Log","sap/f/GridContainer","sap/f/GridContainerSettings","sap/m/Button","sap/m/Dialog","sap/m/IllustratedMessageSize","sap/m/IllustratedMessageType","sap/m/library","sap/m/Link","sap/m/MessageStrip","sap/m/MessageToast","sap/m/ScrollContainer","sap/m/Text","sap/m/Title","sap/m/VBox","sap/ui/core/Element","sap/ui/core/EventBus","./BaseAppPersPanel","./MenuItem","./utils/Constants","./utils/Device","./utils/FESRUtil","./utils/HttpHelper"],function(e,t,n,s,i,o,r,a,c,l,d,p,u,h,g,m,f,_,A,T,y,S,v){"use strict";function C(e){return e&&e.__esModule&&typeof e.default!=="undefined"?e.default:e}const R=typeof Symbol!=="undefined"?Symbol.iterator||(Symbol.iterator=Symbol("Symbol.iterator")):"@@iterator";function M(e,t,n){if(!e.s){if(n instanceof x){if(n.s){if(t&1){t=n.s}n=n.v}else{n.o=M.bind(null,e,t);return}}if(n&&n.then){n.then(M.bind(null,e,t),M.bind(null,e,2));return}e.s=t;e.v=n;const s=e.o;if(s){s(e)}}}const x=function(){function e(){}e.prototype.then=function(t,n){const s=new e;const i=this.s;if(i){const e=i&1?t:n;if(e){try{M(s,1,e(this.v))}catch(e){M(s,2,e)}return s}else{return this}}this.o=function(e){try{const i=e.v;if(e.s&1){M(s,1,t?t(i):i)}else if(n){M(s,1,n(i))}else{M(s,2,i)}}catch(e){M(s,2,e)}};return s};return e}();function B(e){return e instanceof x&&e.s&1}function P(e,t,n){var s=-1,i,o;function r(a){try{while(++s<e.length&&(!n||!n())){a=t(s);if(a&&a.then){if(B(a)){a=a.v}else{a.then(r,o||(o=M.bind(null,i=new x,2)));return}}}if(i){M(i,1,a)}else{i=a}}catch(e){M(i||(i=new x),2,e)}}r();return i}const b=a["BackgroundDesign"];function $(e,t,n){if(typeof e[R]==="function"){var s=e[R](),i,o,r;function d(e){try{while(!(i=s.next()).done&&(!n||!n())){e=t(i.value);if(e&&e.then){if(B(e)){e=e.v}else{e.then(d,r||(r=M.bind(null,o=new x,2)));return}}}if(o){M(o,1,e)}else{o=e}}catch(e){M(o||(o=new x),2,e)}}d();if(s.return){var a=function(e){try{if(!i.done){s.return()}}catch(e){}return e};if(o&&o.then){return o.then(a,function(e){throw a(e)})}a()}return o}if(!("length"in e)){throw new TypeError("Object is not iterable")}var c=[];for(var l=0;l<e.length;l++){c.push(e[l])}return P(c,function(e){return t(c[e])},n)}const I=C(_);function w(e,t){try{var n=e()}catch(e){return t(e)}if(n&&n.then){return n.then(void 0,t)}return n}const D=C(A);function E(e,t){try{var n=e()}catch(e){return t(true,e)}if(n&&n.then){return n.then(t.bind(null,false),t.bind(null,true))}return t(false,n)}const U=T["REPO_BASE_URL"];const H=T["SETTINGS_PANELS_KEYS"];const j=y["DeviceType"];const F=S["addFESRId"];const z=C(v);const V={USER_PREFERENCE_SRVC_URL:`${U}UserPreference`,KEY:"recommendedApps"};const L=I.extend("sap.cux.home.RecommendedAppPanel",{metadata:{library:"sap.cux.home",defaultAggregation:"apps",aggregations:{apps:{type:"sap.cux.home.App",singularName:"app",multiple:true,visibility:"hidden"}}},constructor:function e(t,n){I.prototype.constructor.call(this,t,n);this._selectedApps=[];this.setSupported(false)},init:function e(){I.prototype.init.call(this);this.setProperty("key",V.KEY);this.setProperty("title",this._i18nBundle.getText("recommendedAppsTab"));this.setProperty("tooltip",this._i18nBundle.getText("recommendedAppsTab"));const t=f.getInstance();t.subscribe("importChannel","recommendationSettingChanged",(e,t,n)=>{const s=n.showRecommendation;this.fireSupported({isSupported:s})});this._createAddToFavouritesMenuItem()},_createAddToFavouritesMenuItem:function e(){const t=new D(`${this.getId()}-addtofavouritesmenuitem`,{title:this._i18nBundle.getText("addToFavoritesRecommended"),icon:"sap-icon://add-favorite",press:this._openAddRecommendedDialog.bind(this),visible:false});F(t,"addToFavouritesMenuItem");this.insertAggregation("menuItems",t,0)},_openAddRecommendedDialog:function e(){const t=`${this.getId()}-addRecommendedDialog-appsPage`;const n=this._generateAddRecommendedDialog(t);n.open()},_generateAddRecommendedDialog:function e(t){if(!this._controlMap.get(t)){this._createAddRecommendedDialogControls(t)}const n=this._generateAppsScrollContainer()?.getContent()?.[0];n.destroyAggregation("items");this._selectedApps=[...this.getApps()];const s=this._selectedApps.map(e=>this._createAppTile(e));this._setAggregation(n,s);this._updateSelectedAppCount();const i=this._controlMap.get(t);return i},_createAddRecommendedDialogControls:function e(t){const n=this;this._selectedApps=[...this.getApps()];this._controlMap.set(`${t}-mainTitle`,new h({id:`${t}-mainTitle`,text:this._i18nBundle.getText("addToFavoritesRecommended")}));this._controlMap.set(`${t}-headerContainer-count`,new u({id:`${t}-headerContainer-count`}));this._controlMap.set(`${t}-selectedAppsTitle`,new h({id:`${t}-selectedAppsTitle`,text:`${this._i18nBundle.getText("recommendedAppsTab")} (0 ${this._i18nBundle.getText("selected")})`,level:"H3"}));this._controlMap.set(`${t}-subtitleText`,new u({id:`${t}-subtitleText`,text:this._i18nBundle.getText("selectAtLeastOneApp")}));const o=new s({id:`${t}-addBtn`,text:this._i18nBundle.getText("addButton"),type:"Emphasized",press:function(){try{return Promise.resolve(n._addSelectedApps()).then(function(){n._closeAddRecommendedDialog(t)})}catch(e){return Promise.reject(e)}},enabled:this._selectedApps.length>0});const r=new s({id:`${t}-cancelBtn`,text:this._i18nBundle.getText("cancelBtn"),press:()=>this._closeAddRecommendedDialog(t)});const a=this._controlMap.get(`${t}-mainTitle`).getText();this._controlMap.set(t,new i(t,{title:a,content:[new g({id:`${t}-headerContainer`,items:[this._controlMap.get(`${t}-selectedAppsTitle`),this._controlMap.get(`${t}-subtitleText`)],justifyContent:"Start",alignItems:"Start"}).addStyleClass("sapUiSmallMarginTop sapUiSmallMarginBeginEnd sapUiTinyMarginBottom"),this._generateAppsScrollContainer()],contentHeight:"25rem",contentWidth:"41.75rem",buttons:[o,r],escapeHandler:()=>this._closeAddRecommendedDialog(t)}).addStyleClass("sapCuxRecommendedAppsDialog sapContrastPlus"))},_createAppTile:function e(t){const n=t.clone();const s=this.getParent()._getAppTile(n);s.addStyleClass("sapCuxHighlightApp");n._onPress=e=>this._highlightApp(e,n);return s},_generateAppsScrollContainer:function e(){const s=`${this.getId()}-addRecommendedDialog-appsPage-scrollContainer`;if(!this._controlMap.get(s)){this._controlMap.set(`${s}-apps`,new t({id:`${s}-apps`,layout:new n(`${s}-apps-containerSettings`,{columnSize:"19rem",gap:"0.5rem"})}).addStyleClass("sapCuxAppsGridContainerPadding"));this._controlMap.set(s,new p(s,{id:s,vertical:true,visible:true,height:"20rem",content:[this._controlMap.get(`${s}-apps`)]}).addStyleClass("sapUiSmallMarginBeginEnd sapUiTinyMarginTop"))}return this._controlMap.get(s)},_updateAddButtonState:function e(){const t=`${this.getId()}-addRecommendedDialog-appsPage`;const n=m.getElementById(`${t}-addBtn`);if(n){n.setEnabled(this._selectedApps.length>0)}},_closeAddRecommendedDialog:function e(t){this.toggleAppTileHighlight(true);const n=this._controlMap.get(t);if(n){n.close()}this._resetAddRecommendedDialog()},toggleAppTileHighlight:function e(t){const n=this._generateAppsScrollContainer();const s=n.getContent()[0];if(s){s.getItems().forEach(e=>{if(e){if(t){e.addStyleClass("sapCuxHighlightApp")}else{if(e.hasStyleClass("sapCuxHighlightApp")){e.removeStyleClass("sapCuxHighlightApp")}}}})}},_resetAddRecommendedDialog:function e(){this._selectedApps=[...this.getApps()];this._updateSelectedAppCount();this._updateAddButtonState()},_addSelectedApps:function t(){try{const t=this;t.setBusy(true);return Promise.resolve(E(function(){return w(function(){function e(){return Promise.resolve((t.getParent?.())._refreshAllPanels()).then(function(){const e=t._i18nBundle.getText("moveRecommendedMessage");d.show(e)})}const n=$(t._selectedApps,function(e){const n=e.getVizId?.();const s=function(){if(n){return Promise.resolve(t.appManagerInstance.addVisualization(n)).then(function(){})}}();if(s&&s.then)return s.then(function(){})});return n&&n.then?n.then(e):e(n)},function(t){e.error(t)})},function(e,n){t.setBusy(false);t._selectedApps=[];t._closeAddRecommendedDialog(`${t.getId()}-addRecommendedDialog-appsPage`);if(e)throw n;return n}))}catch(e){return Promise.reject(e)}},_highlightApp:function e(t,n){const s=t.getSource();const i=!s.hasStyleClass("sapCuxHighlightApp");this._selectedApps=this._selectedApps||[];if(i){this._selectedApps.push(n)}else{this._selectedApps.splice(this._selectedApps.findIndex(e=>n.getUrl()===e.getUrl()),1)}s.toggleStyleClass("sapCuxHighlightApp",i);this._updateSelectedAppCount();this._updateAddButtonState()},_updateSelectedAppCount:function e(){const t=`${this.getId()}-addRecommendedDialog-appsPage`;const n=this._controlMap.get(`${t}-selectedAppsTitle`);const s=this._selectedApps.length;n.setText(`${this._i18nBundle.getText("recommendedAppsTab")} (${s} ${this._i18nBundle.getText("selected")})`)},_generateWrapper:function e(){const t=`${this.getId()}-recommendedPanelWrapper`;if(!this._controlMap.get(t)){this._controlMap.set(t,new g(t,{items:[this._generateMessageStrip(),I.prototype._generateWrapper.call(this)],backgroundDesign:b.Transparent}))}return this._controlMap.get(t)},loadApps:function e(){try{const e=this;if(e.getDeviceType()===j.Mobile){return Promise.resolve()}return Promise.resolve(e.appManagerInstance.getRecommendedVisualizations(true)).then(function(t){e.destroyAggregation("apps",true);t=t.map((t,n)=>({...t,menuItems:e._getActions(n)}));const n=e.generateApps(t);let s=[];s=e.fetchTileVisualization(s);return Promise.resolve(e.prepareAppsBeforeLoad(n,s)).then(function(){e.setApps(n);const t=m.getElementById(`${e.getId()}-addtofavouritesmenuitem`);if(t){t.setVisible(n.length>0)}})})}catch(e){return Promise.reject(e)}},_generateMessageStrip:function e(){const t=`${this.getId()}-messageStrip`;if(!this._controlMap.get(t)){this._controlMap.set(t,new l(t,{text:this._i18nBundle.getText("recommendationMessageStrip"),showIcon:true,showCloseButton:true,link:new c(`${t}-settings`,{text:this._i18nBundle.getText("settings"),press:()=>this.getParent()?._getLayout()?.openSettingsDialog(H.ADVANCED)}).addStyleClass("sapUiNoMargin")}).addStyleClass("sapUiNoMarginBegin sapUiTinyMarginBottom"))}return this._controlMap.get(t)},_getActions:function e(t){const n=new D(`${this.getKey()}--addToFavoritesItem--${t}`,{title:this._i18nBundle.getText("addToFavorites"),icon:"sap-icon://add-favorite",press:e=>{void this._addAppToFavorites(e)}});F(n,"acceptRecommendation");const s=new D(`${this.getKey()}--notRelevantItem--${t}`,{title:this._i18nBundle.getText("notRelevantRecommendation"),icon:"sap-icon://decline",press:e=>{void this._rejectRecommendation(e)}});F(s,"rejectRecommendation");const i=[n,s];return i},_rejectRecommendation:function t(n){try{const t=this;t.setBusy(true);const s=E(function(){return w(function(){const e=n.getSource();const s=e.getParent();const i=s.getTitle();return Promise.resolve(t.appManagerInstance.getRecommendedVisualizations()).then(function(e){const n=e.find(e=>e.url===s.getUrl());const o=n?.fioriId;const r=function(){if(o){const e={AppId:o,Decision:1};return Promise.resolve(z.Post(V.USER_PREFERENCE_SRVC_URL,e)).then(function(){return Promise.resolve(t.refresh()).then(function(){const e=t._i18nBundle.getText("rejectRecommendationMsg",[i]);d.show(e)})})}}();if(r&&r.then)return r.then(function(){})})},function(t){e.error(t)})},function(e,n){t.setBusy(false);if(e)throw n;return n});return Promise.resolve(s&&s.then?s.then(function(){}):void 0)}catch(e){return Promise.reject(e)}},_isRecommendationEnabled:function e(){try{const e=this;return Promise.resolve(e.getPersonalization()).then(function(e){return e?.showRecommendation??true})}catch(e){return Promise.reject(e)}},_enableRecommendationTab:function e(){try{const e=this;return Promise.resolve(e._isRecommendationEnabled()).then(function(t){e.setSupported(t);e.fireSupported({isSupported:t})})}catch(e){return Promise.reject(e)}},generateIllustratedMessage:function e(){const t=I.prototype.generateIllustratedMessage.call(this);t.setIllustrationSize(o.ExtraSmall);t.setIllustrationType(r.NoData);t.setTitle(this._i18nBundle.getText("noRecommendationsTitle"));t.setDescription(this._i18nBundle.getText("noRecommendationsDescription"));t.addAdditionalContent(new s({text:this._i18nBundle.getText("settings"),tooltip:this._i18nBundle.getText("settings"),press:()=>this.getParent()?._getLayout()?.openSettingsDialog(H.ADVANCED),type:"Emphasized"}));t.addStyleClass("sapUiTinyMarginTop");return t}});return L});
//# sourceMappingURL=RecommendedAppPanel.js.map