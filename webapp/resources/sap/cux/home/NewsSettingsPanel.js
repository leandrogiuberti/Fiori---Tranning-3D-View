/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)
 *  * (c) Copyright 2009-2025 SAP SE. All rights reserved
 */
sap.ui.define(["sap/m/CheckBox","sap/m/CustomListItem","sap/m/HBox","sap/m/Label","sap/m/List","sap/m/Switch","sap/m/Text","sap/m/Title","sap/m/VBox","sap/ui/core/CustomData","./BaseSettingsPanel","./library","./utils/Accessibility","./utils/Constants","./utils/FESRUtil","./utils/PersonalisationUtils","./utils/UshellPersonalizer"],function(e,t,s,i,n,o,a,r,l,d,u,c,h,w,g,m,S){"use strict";function f(e){return e&&e.__esModule&&typeof e.default!=="undefined"?e.default:e}const N=f(u);const p=c["NewsType"];const C=h["getInvisibleText"];const F=w["SETTINGS_PANELS_KEYS"];const P=g["addFESRSemanticStepName"];const T=g["FESR_EVENTS"];const I=f(m);const x=f(S);const y=N.extend("sap.cux.home.NewsSettingsPanel",{init:function e(){N.prototype.init.call(this);this.setProperty("key",F.NEWS);this.setProperty("title",this._i18nBundle.getText("news"));this.setProperty("icon","sap-icon://newspaper");this.addAggregation("content",this.getContent());this.attachPanelNavigated(()=>{void this.loadNewsFeedSettings()});this.aFavNewsFeed=[]},getContent:function e(){const t=this.setHeader();const s=this.setTitleMessage();const i=new l(this.getId()+"--idNewsPageOuterVBoX",{alignItems:"Start",justifyContent:"SpaceBetween",items:[t,s,this.setNewsList()]});return i},getPersonalization:function e(){try{const t=this;function s(){return t.oPersonalizer}const i=function(){if(!t.oPersonalizer){return Promise.resolve(x.getInstance(I.getPersContainerId(t._getPanel()),I.getOwnerComponent(t._getPanel()))).then(function(e){t.oPersonalizer=e})}}();return Promise.resolve(i&&i.then?i.then(s):s(i))}catch(n){return Promise.reject(n)}},setHeader:function e(){this.headerText=new a(this.getId()+"--idCustNewsFeedSettingsText",{text:this._i18nBundle.getText("newsFeedSettingsText")});const t=new l(this.getId()+"--idCustNewsFeedSettingsTextContainer",{alignItems:"Start",justifyContent:"SpaceBetween",items:[this.headerText]}).addStyleClass("sapUiSmallMarginTop sapUiSmallMarginBegin");return t},setTitleMessage:function e(){this.title=new r(this.getId()+"--idCustNewsFeedSettignsTitle",{text:this._i18nBundle.getText("newsFeedSettingsHeading"),titleStyle:"H3"});const t=new s(this.getId()+"--idCustNewsFeedSettingsTitleContainer",{alignItems:"Center",justifyContent:"SpaceBetween",items:[this.title]});const i=new l(this.getId()+"--idCustNewsFeedSettingsTitleVBox",{alignItems:"Start",justifyContent:"SpaceBetween",items:[t]}).addStyleClass("sapUiSmallMarginTop sapUiSmallMarginBegin");return i},setNewsList:function e(){const t=new i(this.getId()+"--idShowAllCustNewsSwitchLabel",{text:this._i18nBundle.getText("showAllPreparationRequiredSwitchLabel")});this.oShowSwitch=new o(`${this.getId()}-showSwitch`,{customTextOn:" ",customTextOff:" ",change:()=>{void this.saveNewsFeedSettings()},state:false,ariaLabelledBy:[`${this.getId()}--idShowAllCustNewsSwitchLabel`]});P(this.oShowSwitch,T.CHANGE,"showPrepRequire");this.oCustNewsSwitchContainer=new s(this.getId()+"--idShowAllCustNewsSwitchContainer",{alignItems:"Center",items:[t,this.oShowSwitch],width:"94%"}).addStyleClass("sapUiSmallMarginTop");const a=new l(this.getId()+"--idShowAllCustNewsSwitchVBox",{items:[this.oCustNewsSwitchContainer],width:"94%"}).addStyleClass("sapUiSmallMarginTop");const r=C(`${this.getId()}--newsTitleText`,this._i18nBundle.getText("newsTitle"));this.oList=new n(this.getId()+"--idCustNewsFeedList",{ariaLabelledBy:[r.getId(),`${this.getId()}--idCustNewsFeedSettingsText`,`${this.getId()}--idCustNewsFeedSettignsTitle`]});const d=new l(this.getId()+"--idCustNewsFeedListContainer",{direction:"Column",items:[this.oList,a,r],width:"96%"}).addStyleClass("sapUiSmallMarginTop sapUiSmallMarginBegin");return d},isCSVFileFormat:function e(t){return t.split(".").pop()?.toLowerCase()==="csv"},saveNewsFeedSettings:function e(){try{const e=this;const t=[];const s=[];const i=e.oNewsPanel?.getNewsType();const n=i===p.Default;const o=e.oNewsPanel.getProperty("customFileName");const a=e.oNewsPanel.getCustomFeedKey();e.oList.getItems().forEach(i=>{const o=i.getAggregation("content");const a=o[0];const[r,l]=a.getItems();const d=r.getSelected();if(n){const t=e.getDefaultGroupId(a);if(!d&&t){s.push(t)}}else if(d){t.push(l.getText())}});return Promise.resolve(e.getPersonalization()).then(function(i){return Promise.resolve(i.read()).then(function(r){if(n){r.defaultNewsFeed={items:s}}else{r.favNewsFeed={items:t,showAllPreparationRequired:e.isCSVFileFormat(o)?false:e.oShowSwitch.getState()}}return Promise.resolve(i.write(r)).then(function(){if(!n){e.oShowSwitch.setState(r.favNewsFeed?.showAllPreparationRequired)}return Promise.resolve(e.oNewsPanel.setCustomNewsFeed(n?"":a)).then(function(){})})})})}catch(e){return Promise.reject(e)}},getDefaultGroupId:function e(t){const s=t.getCustomData();return s?.length?s[0].getValue():""},setItems:function i(n){this.oList.destroyAggregation("items",true);const o=this.oNewsPanel?.getNewsType();let r=o===p.Default;(n||[]).forEach((i,n)=>{let o=new s({id:`${this.getId()}--idCustNewsFeedItemContent--${n}`,alignItems:"Center",items:[new e(`${this.getId()}--custNewsFeedItemCheckBox--${n}`,{select:()=>{void this.saveNewsFeedSettings()},selected:i.selected,enabled:!i.disabled}),new a(`${this.getId()}--custNewsFeedItemText--${n}`,{text:i.title})],width:"100%"});if(r){o.addCustomData(new d({key:"newsGroupId",value:i.group_id}))}const l=new t({id:`${this.getId()}--idCustNewsFeedItem--${n}`,content:[o]});this.oList.addItem(l)})},loadNewsFeedSettings:function e(){try{const e=this;e.oNewsPanel=e._getPanel();const t=e.oNewsPanel.getCustomFeedKey();const s=e.oNewsPanel?.getNewsType();const i=s===p.Default;const n=e.oNewsPanel.getProperty("customFileName");if(e.isCSVFileFormat(n)||i){e.oCustNewsSwitchContainer.setVisible(false)}return Promise.resolve(e.getPersonalization()).then(function(s){return Promise.resolve(s.read()).then(function(s){const n=i?s?.["defaultNewsFeed"]:s?.["favNewsFeed"];const o=n?.showAllPreparationRequired??!n;return Promise.resolve(e.oNewsPanel.getCustomOrDefaultNewsFeed(i?"":t,false)).then(function(t){if(i){return e._handleDefaultNewsFeed(t,n)}else{return e._handleCustomNewsFeed(t,n,o)}})})})}catch(e){return Promise.reject(e)}},_handleDefaultNewsFeed:function e(t,s){this.headerText.setText(this._i18nBundle.getText("defaultNewsSettingsText"));this.title.setText(this._i18nBundle.getText("defaultNewsSettingsHeading"));const i=this.oNewsPanel.getMandatoryDefaultNewsFeed();this.deselectedDefaultFeeds=s?.items||[];if(!t||t.length===0){return}t=t.map(e=>{const t=e.group_id?this.deselectedDefaultFeeds.includes(e.group_id):false;e.selected=!s?true:!t;if(i.includes(e.group_id??"")){e.selected=true;e.disabled=true}return e});this.setItems(t);this.oShowSwitch.setState(false);return t},_handleCustomNewsFeed:function e(t,s,i){this.headerText.setText(this._i18nBundle.getText("newsFeedSettingsText"));this.title.setText(this._i18nBundle.getText("newsFeedSettingsHeading"));if(!t||t.length===0){return}const n=s?.items||t;t=t.map(e=>{const t=n.includes(e.title);e.selected=!s?true:t;return e});this.aFavNewsFeed=t;this.setItems(this.aFavNewsFeed);this.oShowSwitch.setState(!!i);return t},isSupported:function e(){try{const e=this;const t=e._getPanel();if(!t||!(t?.getParent()).getProperty("newsFeedVisibility")){return Promise.resolve(false)}return Promise.resolve((t.getNewsType()===p.Custom||t.getNewsType()===p.Default)&&!t.isNoUpdatesNewsFeed())}catch(e){return Promise.reject(e)}}});return y});
//# sourceMappingURL=NewsSettingsPanel.js.map