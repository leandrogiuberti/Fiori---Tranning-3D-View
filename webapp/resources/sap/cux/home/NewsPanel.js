/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)
 *  * (c) Copyright 2009-2025 SAP SE. All rights reserved
 */
sap.ui.define(["sap/base/Log","sap/m/GenericTile","sap/m/SlideTile","sap/m/library","sap/ui/core/EventBus","sap/ui/core/format/DateFormat","sap/ui/model/xml/XMLModel","sap/ushell/Container","./BaseLayout","./BaseNewsPanel","./MenuItem","./NewsGroup","./NewsItem","./library","./utils/Constants","./utils/DataFormatUtils","./utils/Device","./utils/FESRUtil","./utils/HttpHelper","./utils/PersonalisationUtils","./utils/UshellPersonalizer"],function(e,t,n,r,s,i,o,a,l,u,c,f,d,h,g,p,m,w,N,y,P){"use strict";function F(e){return e&&e.__esModule&&typeof e.default!=="undefined"?e.default:e}function v(e,t,n){if(!e.s){if(n instanceof _){if(n.s){if(t&1){t=n.s}n=n.v}else{n.o=v.bind(null,e,t);return}}if(n&&n.then){n.then(v.bind(null,e,t),v.bind(null,e,2));return}e.s=t;e.v=n;const r=e.o;if(r){r(e)}}}const T=r["Priority"];const _=function(){function e(){}e.prototype.then=function(t,n){const r=new e;const s=this.s;if(s){const e=s&1?t:n;if(e){try{v(r,1,e(this.v))}catch(e){v(r,2,e)}return r}else{return this}}this.o=function(e){try{const s=e.v;if(e.s&1){v(r,1,t?t(s):s)}else if(n){v(r,1,n(s))}else{v(r,2,s)}}catch(e){v(r,2,e)}};return r};return e}();function b(e){return e instanceof _&&e.s&1}function E(e,t,n){var r;for(;;){var s=e();if(b(s)){s=s.v}if(!s){return i}if(s.then){r=0;break}var i=n();if(i&&i.then){if(b(i)){i=i.s}else{r=1;break}}if(t){var o=t();if(o&&o.then&&!b(o)){r=2;break}}}var a=new _;var l=v.bind(null,a,2);(r===0?s.then(c):r===1?i.then(u):o.then(f)).then(void 0,l);return a;function u(r){i=r;do{if(t){o=t();if(o&&o.then&&!b(o)){o.then(f).then(void 0,l);return}}s=e();if(!s||b(s)&&!s.v){v(a,1,i);return}if(s.then){s.then(c).then(void 0,l);return}i=n();if(b(i)){i=i.v}}while(!i||!i.then);i.then(u).then(void 0,l)}function c(e){if(e){i=n();if(i&&i.then){i.then(u).then(void 0,l)}else{u(i)}}else{v(a,1,i)}}function f(){if(s=e()){if(s.then){s.then(c).then(void 0,l)}else{c(s)}}else{v(a,1,i)}}}const D=F(l);function M(e,t){try{var n=e()}catch(e){return t(e)}if(n&&n.then){return n.then(void 0,t)}return n}const U=F(u);const C=F(c);const S=F(f);const I=F(d);const A=h["NewsType"];const L=g["DEFAULT_NEWS_PLACEHOLDER"];const V=g["DEFAULT_NEWS_URL"];const R=p["recycleId"];const x=m["DeviceType"];const O=w["addFESRId"];const j=F(N);const B=F(y);const $=F(P);const q="/sap/opu/odata4/ui2/insights_srv/srvd/ui2/",k=q+"insights_read_srv/0001/"+"NEWS_FEED",G=q+"insights_read_srv/0001/"+"NewsFeedColumnTranslation",J=7,W={LargeDesktop:"17rem",XLargeDesktop:"17rem",Desktop:"17rem",Tablet:"14rem",Mobile:"11rem"},X=function(e,t){return Array.from({length:t},function(t,n){return e+"/"+(n+1)+".jpg"})};const K={TITLE:"LineOfBusiness",LINK:"WhatsNewDocument",VALIDITY:"ValidAsOf",PREPARATION_REQUIRED:"PreparationRequired",EXCLUDE_FIELDS:["ChangeId","LineNumber","LineOfBusiness","SolutionArea","Title","Description","Type","ValidAsOf","WhatsNewDocument","Link"],IMAGE_URL:"sap/cux/home/img/CustomNewsFeed/",FESR_STEP_NAME:"custNewsSlide-press",EMPTY_DATA_ERROR_CODE:"NODATA"},z={"Application Platform and Infrastructure":X("ApplicationPlatformandInfrastructure",3),"Asset Management":X("AssetManagement",3),"Cross Applications":X("CrossApplications",3),Finance:X("Finance",3),Manufacturing:X("Manufacturing",3),"R&D / Engineering":X("RnDandEngineering",3),Sales:X("Sales",3),"Sourcing and Procurement":X("SourcingandProcurement",3),"Supply Chain":X("SupplyChain",3),default:["default.jpg"]};const H=U.extend("sap.cux.home.NewsPanel",{metadata:{library:"sap.cux.home",properties:{url:{type:"string",group:"Misc",defaultValue:"",visibility:"public"},type:{type:"sap.cux.home.NewsType",group:"Misc",visibility:"hidden",defaultValue:A.Default},customFeedKey:{type:"string",group:"Misc",defaultValue:"",visibility:"public"},customFileName:{type:"string",group:"Misc",defaultValue:""},newsAvailable:{type:"boolean",group:"Misc",defaultValue:true,visibility:"hidden"},supportedFileFormats:{type:"FileFormat[]",group:"Misc",defaultValue:["xlsx"],visibility:"hidden"}},aggregations:{newsGroup:{type:"sap.cux.home.NewsGroup",singularName:"newsGroup",multiple:true,visibility:"hidden"}}},constructor:function e(t,n){U.prototype.constructor.call(this,t,n);this._defaultNewsPromise=null;this._noUpdatesNewsFeed=false;this.customNewsFeedCache=new Map},init:function e(){U.prototype.init.call(this);const r=this.getDeviceType();this.oNewsTile=new n(this.getId()+"--idNewsSlide",{displayTime:2e4,width:"100%",height:W[r],tiles:[new t(this.getId()+"--placeholder",{state:"Loading",mode:"ArticleMode",frameType:"Stretch"})]}).addStyleClass("newsTileMaxWidth sapUiSmallMarginTop");O(this.oNewsTile,"newsSlidePress");this.getNewsWrapper().addContent(this.oNewsTile);this.getNewsWrapper().addStyleClass("newsWrapper");this.setProperty("title",this._i18nBundle.getText("newsTitle"));this._eventBus=s.getInstance();this.oManageMenuItem=new C(`${this.getId()}-manageNews`,{title:this._i18nBundle.getText("mngNews"),icon:"sap-icon://edit",press:this.handleEditNews.bind(this),visible:this.setManageNewsItemVisibility()});this.addAggregation("menuItems",this.oManageMenuItem);O(this.oManageMenuItem,"manageNews")},getData:function e(){try{let t=false;const n=this;function r(e){if(t)return e;n.fireEvent("loaded");n.adjustLayout()}let s=n.getUrl();let i=n.getProperty("type")===A.Custom;let o=n.getProperty("type")===A.Default;let a=n.getProperty("type")===A.NewsUrl;n.mandatoryNewsFeed=[];if(n.fetchedFeedUrl&&n.fetchedFeedUrl===s){return Promise.resolve()}const l=n.getParent().getIsEndUserChange();const u=function(){if(l.isEndUser){return Promise.resolve(fetch(s)).then(function(e){if(!e.ok){throw new Error(`HTTP error! status: ${e.status}`)}const t=e.headers.get("content-type");const r=function(){if(t&&t.includes("application/json")){return Promise.resolve(e.json()).then(function(e){n._endUserResponse=e;return Promise.resolve(n.setNewsFeedFromUrl(n._endUserResponse?.value)).then(function(){})})}else{l.newsType=A.NewsUrl;return Promise.resolve(n.initializeXmlModel(s)).then(function(e){n.oNewsModel=e;n.oNewsTile.setModel(n.oNewsModel);n.oManageMenuItem.setVisible(false)})}}();if(r&&r.then)return r.then(function(){})})}else{function e(){const e=function(){if(o){n.bNewsLoad=n.bNewsLoad||false;return Promise.resolve(n.setDefaultNews()).then(function(){})}else{const e=function(){if(s&&a){return Promise.resolve(n.initializeXmlModel(s)).then(function(e){n.oNewsModel=e;n.oNewsTile.setModel(n.oNewsModel);n.oManageMenuItem.setVisible(false)})}else{const e=function(){if(i){n.bNewsLoad=n.bNewsLoad||false;n.oManageMenuItem.setVisible(true);const e=n.getCustomFeedKey();const t=function(){if(e){return Promise.resolve(n.setCustomNewsFeed(e)).then(function(){})}else{n.handleFeedError()}}();if(t&&t.then)return t.then(function(){})}else{n.handleFeedError()}}();if(e&&e.then)return e.then(function(){})}}();if(e&&e.then)return e.then(function(){})}}();if(e&&e.then)return e.then(function(){})}const t=function(){if(!n.persDataNewsFeed){return Promise.resolve(n.setPersDataNewsFeed(o)).then(function(){})}}();return t&&t.then?t.then(e):e(t)}}();return Promise.resolve(u&&u.then?u.then(r):r(u))}catch(c){return Promise.reject(c)}},setDefaultNews:function e(){try{const e=this;let t=e.getUrl();const n=e.getParent().getIsEndUserChange().isEndUser;e.defaultUrl=n?t:V;e.fetchedFeedUrl=e.defaultUrl;e.setProperty("newsAvailable",true);e.generateErrorMessage().setVisible(false);e.setVisible(true);e.oManageMenuItem.setVisible(true);e.setManageNewsItemVisibility(true);return Promise.resolve(e.setCustomNewsFeed("")).then(function(){})}catch(e){return Promise.reject(e)}},setManageNewsItemVisibility:function e(t=true){if(this.isParentBaseLayout()&&this.oManageMenuItem){this.oManageMenuItem.setVisible(t);return t}this.oManageMenuItem?.setVisible(false);return false},isParentBaseLayout:function e(){const t=this.getParent();const n=t?._getLayout();return!!(n&&n instanceof D)},setPressEnabledForNewsGroup:function e(t=[]){const n=this.getAggregation("newsGroup");if(!Array.isArray(n))return;const r={};const s={};(this._defaultNewsResponse.value||[]).forEach(e=>{if(e?.description&&e.description.trim().length>0){e.description=this.removeInlineStylesFromDescription(e.description)}if(e?.group_id){const t=e._group_to_article||[];let n=false;t.forEach(e=>{if(e?.description&&e.description.trim().length>0){e.description=this.removeInlineStylesFromDescription(e.description);n=true}});r[e.group_id]=t;s[e.group_id]=n}});const i={};n.filter(e=>e instanceof S).forEach(e=>{const t=this.getCurrentNewsGroup(e.getId())?.group_id;if(t){i[t]=e}});t.forEach(e=>{if(!e.group_id)return;const t=i[e.group_id];if(t&&!s[e.group_id]){t.getTile()?.setProperty("pressEnabled",false)}})},removeInlineStylesFromDescription:function e(t){return t.replace(/\s*style\s*=\s*(['"])[\s\S]*?\1/gi,"")},getCurrentNewsGroup:function e(t){const n=this._defaultNewsResponse?.value;const r=t.split("-newsgroup-");const s=r.length>1?r[1]:null;if(!s||!n){return undefined}return s==="placeholderNews"?n[0]:n.find(e=>e.group_id===s)},getCustomFeedKey:function e(){return this.getProperty("customFeedKey")},getUrl:function e(){return this.getProperty("url")},initializeXmlModel:function e(t){try{const e=this;const n=e.getParent();return Promise.resolve(new Promise(r=>{const s=new o(t);e.fetchedFeedUrl=t;s.setDefaultBindingMode("OneWay");s.attachRequestCompleted(t=>{void function(){try{if(!e.bNewsLoad){n?.panelLoadedFn("News",{loaded:true,count:J});e.bNewsLoad=true}const i=t.getSource().getData();return Promise.resolve(e.loadNewsFeed(i,0)).then(function(){e._eventBus.publish("KeyUserChanges","newsFeedLoadFailed",{showError:false,date:new Date});r(s)})}catch(e){return Promise.reject(e)}}()});s.attachRequestFailed(()=>{e.handleFeedError();if(!e.bNewsLoad){n?.panelLoadedFn("News",{loaded:false,count:0});e.bNewsLoad=true}e._eventBus.publish("KeyUserChanges","newsFeedLoadFailed",{showError:true,date:new Date});r(s)})}))}catch(e){return Promise.reject(e)}},loadNewsFeed:function e(t,n){try{const r=this;function s(){if(!!t?.querySelector("rss")&&!!t?.querySelector("item")){i={path:"/channel/item/",length:n||J}}else if(!!t?.querySelector("atom")&&!!t?.querySelector("entry")){i={path:"/entry/",length:n||J}}else if((!!t?.querySelector("customFeed")||!!t?.querySelector("defaultFeed"))&&!!t?.querySelector("item")){r.destroyAggregation("newsGroup");i={path:"/item/",length:n||J}}else{r.handleFeedError();return}r.bindNewsTile(r.oNewsTile,i)}let i;const o=function(){if(!t?.querySelector("customFeed")&&!t?.querySelector("defaultFeed")){return Promise.resolve(r.extractAllImageUrls(t,n||J)).then(function(){})}}();return Promise.resolve(o&&o.then?o.then(s):s(o))}catch(a){return Promise.reject(a)}},handleFeedError:function e(){if(this.getNewsType()===A.Custom||this.getNewsType()===A.Default){this.generateErrorMessage().setVisible(true);if(!this.isParentBaseLayout()){this.setManageNewsButtonVisibility(false)}this.oNewsTile.setVisible(false)}else{this.setVisible(false);this.setProperty("newsAvailable",false);this.oManageMenuItem.setVisible(false)}},setURL:function e(t){try{const e=this;e.setProperty("type",A.NewsUrl);e.setProperty("newsAvailable",true);e.generateErrorMessage().setVisible(false);e.setVisible(true);e.oNewsTile.setVisible(true);e.setProperty("url",t);return Promise.resolve(e.getData()).then(function(){})}catch(e){return Promise.reject(e)}},adjustLayout:function e(){const t=this.getDeviceType();this.oNewsTile.setHeight(W[t]);if(t===x.Mobile){this.generateErrorMessage().setWidth("100%");this.oNewsTile.removeStyleClass("sapUiSmallMarginTop")}else{this.oNewsTile.addStyleClass("sapUiSmallMarginTop")}},bindNewsTile:function e(t,n){if(n){t.bindAggregation("tiles",{path:n.path,length:n.length,templateShareable:false,factory:(e,t)=>{const n=t.getObject();let r;if(n.getElementsByTagName("link").length>0){r=new I(R(`${e}-news-item`),{url:String(this.getPropertyValue(n,"link")??""),title:String(this.getPropertyValue(n,"title")??""),subTitle:String(this.getPropertyValue(n,"description")??""),imageUrl:String(this.getPropertyValue(n,"imageUrl")??""),footer:this.formatDate(String(this.getPropertyValue(n,"pubDate")??""))});this.addAggregation("newsItems",r,true)}else{let t=this.getPropertyValue(n,"group_id")??"";let s=t&&t.trim()?`${e}-newsgroup-${t}`:`${e}-newsgroup`;let i=this.getPropertyValue(n,"subTitle")??"";r=new S(R(s),{title:String(this.getPropertyValue(n,"title")??""),subTitle:i||this._i18nBundle.getText("newsFeedDescription"),imageUrl:String(this.getPropertyValue(n,"imageUrl")??""),footer:String(this.getPropertyValue(n,"footer")??""),priority:this.getPropertyValue(n,"priority"),priorityText:String(this.getPropertyValue(n,"priorityText")??"")});this.addAggregation("newsGroup",r,true)}return r.getTile()}})}},getPropertyValue:function e(t,n){return t.getElementsByTagName(n)?.[0]?.textContent},extractAllImageUrls:function e(t,n){try{const e=this;let r=0;const s=E(function(){return r<n},function(){return r++},function(){const n=t?.getElementsByTagName("item")[r];return Promise.resolve(e.extractImage(String(n.getElementsByTagName("link")[0].textContent??""))).then(function(e){const r=t.createElement("imageUrl");r.textContent=e;n.appendChild(r)})});return Promise.resolve(s&&s.then?s.then(function(){}):void 0)}catch(e){return Promise.reject(e)}},formatDate:function e(t){const n=i.getDateTimeInstance({style:"medium",relative:true,relativeStyle:"short"});return n.format(new Date(t))},getPersDataNewsFeed:function e(){return this.persDataNewsFeed},extractImage:function e(t){const n=()=>{const e=sap.ui.require.toUrl("sap/cux/home/img");this.image=this.image?this.image+1:1;this.image=this.image<9?this.image:1;return`${e}/${this.image}.jpg`};return fetch(t).then(e=>e.text()).then(e=>{const t=e.match(/<meta[^>]*property=["']og:image["'][^>]*content=["']([^"']+)["'][^>]*>/i);return Array.isArray(t)&&t[1]?t[1]:n()}).catch(n)},getNewsType:function e(){return this.getParent()?.getIsEndUserChange?.()?.newsType||this.getProperty("type")},isCSVFileFormat:function e(t){return t.split(".").pop()?.toLowerCase()==="csv"},setPersDataNewsFeed:function e(t){try{const e=this;return Promise.resolve(e._getUserPersonalization()).then(function(n){return Promise.resolve(n?.read()).then(function(n){e.persDataNewsFeed=t?n?.defaultNewsFeed:n?.favNewsFeed})})}catch(e){return Promise.reject(e)}},setNewsFeedFromUrl:function e(t){try{const e=this;const n=t?.[0];const r=function(){if(n&&"group_id"in n&&"title"in n){e.getParent().getIsEndUserChange().newsType=A.Default;return Promise.resolve(e.setDefaultNews()).then(function(){})}else{const t=function(){if(n&&"LineOfBusiness"in n){e.getParent().getIsEndUserChange().newsType=A.Custom;e.oManageMenuItem.setVisible(true);return Promise.resolve(e.setCustomNewsFeed("")).then(function(){})}else{e.handleFeedError()}}();if(t&&t.then)return t.then(function(){})}}();return Promise.resolve(r&&r.then?r.then(function(){}):void 0)}catch(e){return Promise.reject(e)}},setCustomNewsFeed:function t(n){try{const t=this;return Promise.resolve(M(function(){t.oNewsTile.setVisible(true);t.generateErrorMessage().setVisible(false);const e=t.getNewsType();const r=e===A.Default;return Promise.resolve(t.setPersDataNewsFeed(r)).then(function(){const e=t.getProperty("customFileName");const s=t.isCSVFileFormat(e)?false:t.persDataNewsFeed?.showAllPreparationRequired??true;if(t.isCSVFileFormat(e)){K.EXCLUDE_FIELDS.push("PreparationRequired")}const i=r?true:s;return Promise.resolve(t.getCustomOrDefaultNewsFeed(n||"",i)).then(function(e){if(e.length===0){throw new Error("Error: No news feed available")}const s=t.persDataNewsFeed?.items;const i=s?.length===0;if(!r&&i){t.getParent()?.panelLoadedFn("News",{loaded:true,count:0});throw new Error("Error: No fav news feed available")}if(s?.length){e=e.filter(e=>{if(r){return!s.includes(e.group_id)||t.mandatoryNewsFeed.includes(e.group_id)}else{return s.includes(e.title)}});if(e.length===0){t.getParent()?.panelLoadedFn("News",{loaded:true,count:0});throw new Error("Error: No news feed available after filtering")}}return Promise.resolve(t.loadCustomNewsFeed(e,n?"customFeed":"defaultFeed")).then(function(){if(r){t.fetchedFeedUrl=t.defaultUrl;t.setPressEnabledForNewsGroup(e)}else{t.fetchedFeedUrl=""}})})})},function(n){e.error(n);t.handleFeedError()}))}catch(e){return Promise.reject(e)}},filterMandatoryNews:function e(t){return t.filter(({mandatory_text:e,mandatory:t})=>e?.toUpperCase()==="TRUE"||t?.toUpperCase()==="X")},markGroupsWithCriticalArticles:function e(t){for(const e of t){const t=e._group_to_article?.find(e=>e.priority==="1");if(t){e.priority=t.priority;e.priorityText=t.priorityText}}},getDefaultNewsFeedDetails:function e(t){let n=JSON.parse(JSON.stringify(t.value||[]));const r=[];const s={};this.mandatoryNewsFeed=[];if(n?.length>0){this.mandatoryNewsFeed=this.filterMandatoryNews(n).map(e=>e.group_id||"");this.markGroupsWithCriticalArticles(n);for(const e of n){const t=e.title;let n="";if(!s[t]){n=e.subTitle||e.description||"";r.push({title:t,footer:e?.footer_text,imageUrl:this.getDefaultFeedImage(e),group_id:e.group_id,subTitle:n,priority:e?.priority=="1"?T.Medium:T.None,priorityText:e?.priority=="1"?this._i18nBundle.getText("criticalNews"):""});s[t]=t}}}return r},getMandatoryDefaultNewsFeed:function e(){return this.mandatoryNewsFeed||[]},getDefaultNewsResponse:function e(){if(this._defaultNewsResponse){return Promise.resolve(this._defaultNewsResponse)}if(!this._defaultNewsPromise){this._defaultNewsPromise=this.fetchDefaultNews()}return this._defaultNewsPromise},getNoUpdatesPlaceholder:function e(){const t=this._i18nBundle.getText("placeholderNewsTitle");const n=this._i18nBundle.getText("placeholderNewsDescription");const r={...L,value:L.value.map(e=>({...e,title:t,description:n,_group_to_article:e._group_to_article.map(e=>({...e,title:t,description:""}))}))};return r},isNoUpdatesNewsFeed:function e(){return this._noUpdatesNewsFeed},fetchDefaultNews:function t(){try{const t=this;return Promise.resolve(M(function(){return Promise.resolve(a.getServiceAsync("Navigation")).then(function(e){return Promise.resolve(e.isNavigationSupported([{target:{semanticObject:"NewsArticle",action:"display"}}])).then(function([{supported:e}]){let n=false;function r(r){if(n)return r;if(!e||!t._defaultNewsResponse?.value?.length){t._defaultNewsResponse=t.getNoUpdatesPlaceholder();t._noUpdatesNewsFeed=true;t.oManageMenuItem.setVisible(false)}return t._defaultNewsResponse}const s=function(){if(e){return function(){if(t._endUserResponse){t._defaultNewsResponse=t._endUserResponse}else{return Promise.resolve(fetch(t.defaultUrl||V)).then(function(e){if(!e.ok){throw new Error(`HTTP error! status: ${e.status}`)}return Promise.resolve(e.json()).then(function(e){t._defaultNewsResponse=e})})}}()}}();return s&&s.then?s.then(r):r(s)})})},function(n){t._defaultNewsPromise=null;e.error(n);throw n}))}catch(e){return Promise.reject(e)}},getCustomOrDefaultNewsFeed:function e(t,n){try{const e=this;const r=e.getNewsType();const s=r===A.Default;if(s){return Promise.resolve(e.getDefaultNewsResponse()).then(function(){let t=e.getDefaultNewsFeedDetails(e._defaultNewsResponse);return t})}else{return Promise.resolve(e.getCustomFeedData(t,n))}}catch(e){return Promise.reject(e)}},getCustomFeedData:function t(n,r){try{const t=this;return Promise.resolve(M(function(){let e;const s=t.getParent().getIsEndUserChange().isEndUser;e=s?t.getUrl():t.getNewsFeedDetailsUrl({changeId:n,showAllPreparationRequired:r});if(!t.customNewsFeedCache.has(e)){t.customNewsFeedCache.set(e,t.getAuthNewsFeed(e))}return Promise.resolve(t.customNewsFeedCache.get(e)).then(function(e){const n=e;const r={};const s=[];if(n?.length>0){n.forEach(e=>{const n=e[K.TITLE];if(!r[n.value]){s.push({title:n.value,footer:e[K.VALIDITY]?.value,imageUrl:t.getCustomFeedImage(n.value)});r[n.value]=n.value}})}return s})},function(t){e.error(t);throw new Error(t)}))}catch(e){return Promise.reject(e)}},getNewsFeedDetailsUrl:function e(t){let n=k+"?$filter=ChangeId eq "+"'"+t.changeId+"'";const r=this.getProperty("customFileName");if(!this.isCSVFileFormat(r)&&t.showAllPreparationRequired){n=n+" and PreparationRequired eq true"}return n+"&$top=999"},getAuthNewsFeed:function t(n,r){try{const t=this;return Promise.resolve(M(function(){return Promise.resolve(Promise.all([t.getAllAvailableApps(),t.getNewsFeedDetails(n,r)])).then(function([e,n]){return e.length===0?n:t.arrangeNewsFeeds(n,e)})},function(t){e.error(t)}))}catch(e){return Promise.reject(e)}},arrangeNewsFeeds:function e(t,n){const r=[];t.forEach(e=>{if(e.Category.value!=="App"||!e.ImpactedArtifacts.value){r.push(e)}else{const t=e.ImpactedArtifacts.value.split("\n");for(let s of t){const t=s;if(t&&this.isAuthFeed(n,s)){r.push(e);break}}}});return r},isAuthFeed:function e(t,n){const r="|";if(n.includes(r)){const e=n.split(r);const s=(e[e.length-1]||"").trim();if(s){const e=t.findIndex(e=>s===e?.signature?.parameters["sap-fiori-id"]?.defaultValue?.value);return e>-1}}return true},getAllAvailableApps:function t(){try{return Promise.resolve(M(function(){return Promise.resolve(a.getServiceAsync("ClientSideTargetResolution")).then(function(e){return e?._oAdapter._aInbounds||[]})},function(t){if(t instanceof Error){e.error(t.message)}return[]}))}catch(e){return Promise.reject(e)}},getNewsFeedDetails:function e(t,n){try{let r=false;const s=this;function i(e){if(r)return e;const i=e=>e.replace(/([a-z0-9])([A-Z])/g,"$1 $2");return Promise.resolve(Promise.all([s._endUserResponse?Promise.resolve(s._endUserResponse):j.GetJSON(t),s.getTranslatedText(s.getCustomFeedKey())])).then(function([e,t]){let r=JSON.parse(JSON.stringify(e.value||[]));const o=JSON.parse(JSON.stringify(t.value||[]));r=s.filterNewsOnTitle(r,n);return r.map(e=>{const t=Object.keys(e);const n=[];t.forEach(t=>{const r=o.find(e=>e?.ColumnName?.toUpperCase()===t.toUpperCase());const s=r?.TranslatedName||i(t);e[t]={label:s,value:e[t]};if(!K.EXCLUDE_FIELDS.includes(t)){n.push(e[t])}});e.Link={label:s._i18nBundle.getText("readMoreLink"),value:e[K.LINK],text:"Link"};e.expanded=r.length===1;e.expandFields=n;return e})})}const o=function(){if(s.customNewsFeedCache.has(t)){return Promise.resolve(s.customNewsFeedCache.get(t)).then(function(e){const t=s.filterNewsOnTitle(e,n);r=true;return t})}}();return Promise.resolve(o&&o.then?o.then(i):i(o))}catch(a){return Promise.reject(a)}},filterNewsOnTitle:function e(t,n){if(n){return t.filter(e=>e.LineOfBusiness.value===n)}return t},getTranslatedText:function t(n){try{const e=G+"?$filter=Changeid eq '"+n+"'";if(!this.customNewsFeedCache.has(e)){this.customNewsFeedCache.set(e,j.GetJSON(e))}return this.customNewsFeedCache.get(e)}catch(t){if(t instanceof Error){e.error(t.message)}return[]}},loadCustomNewsFeed:function e(t,n){try{const e=this;const r=e.parseJsonToXml(JSON.parse(JSON.stringify(t)),n);const s=e.getParent();if(!e.oNewsModel){e.oNewsModel=new o(r);if(!e.bNewsLoad){s?.panelLoadedFn("News",{loaded:true,count:J});e.bNewsLoad=true}e.oNewsTile.setModel(e.oNewsModel)}else{e.oNewsTile.unbindAggregation("tiles",false);e.oNewsTile.destroyAggregation("tiles");e.oNewsModel.setData(r)}return Promise.resolve(e.loadNewsFeed(r,t.length)).then(function(){})}catch(e){return Promise.reject(e)}},parseJsonToXml:function e(t,n){const r=e=>e.map(e=>({item:e}));const s=e=>{let t="";let n;for(n in e){const r=e[n];if(r){if(typeof r==="object"){t+=`<${n}>${s(r)}</${n}>`}else{t+=`<${n}>${r}</${n}>`}}}return t.replace(/<\/?\d+>/g,"")};const i=JSON.parse(JSON.stringify(r(t)));let o="<?xml version='1.0' encoding='UTF-8'?>";const a=n;o+=`<${a}>`;o+=s(i);o+=`</${a}>`;o=o.replaceAll("&","&amp;");const l=new DOMParser;return l.parseFromString(o,"text/xml")},getCustomFeedImage:function e(t){const n=sap.ui.require.toUrl(K.IMAGE_URL);let r=n+z.default[0];const s=z[t]||[];let i=0;if(s.length>0){const e=new window.Uint32Array(1);window.crypto.getRandomValues(e);i=e[0]%3;r=n+s[i]}return r},getDefaultFeedImage:function e(t){const n=t?.bg_image_id;const r=t?._group_to_image;const s=()=>{const e=sap.ui.require.toUrl("sap/cux/home/img");const t=Math.floor(Math.random()*15)+1;return`${e}/${t}.jpg`};if(!r||r?.image_id!==n||!r?.bg_image){return s()}let i=r?.mime_type;const o=r?.bg_image;if(i==="application/octet-stream"){i="image/jpeg"}if(!this.isValidBase64(o)){const e=this.base64UrlToBase64(o);return`data:${i};base64,${e}`}return`data:${i};base64,${o}`},base64UrlToBase64:function e(t){let n=t?.replace(/_/g,"/").replace(/-/g,"+");while(n.length%4!==0){n+="="}return n},isValidBase64:function e(t){if(!t||t.length===0){return false}const n=/^[A-Za-z0-9+/]*={0,2}$/;if(!n.test(t)){return false}if(t.length%4!==0){return false}if(t.includes("=")){const e=t.indexOf("=");const n=t.lastIndexOf("=");if(e!==t.length-(t.length-e)){return false}if(t.length-e>2){return false}if(e!==n&&n!==e+1){return false}}return true},_getUserPersonalization:function e(){const t=B.getPersContainerId(this);const n=B.getOwnerComponent(this);return $.getInstance(t,n)}});return H});
//# sourceMappingURL=NewsPanel.js.map