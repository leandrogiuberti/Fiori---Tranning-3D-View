/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)
 *  * (c) Copyright 2009-2025 SAP SE. All rights reserved
 */
sap.ui.define(["sap/m/CustomListItem","sap/m/HBox","sap/m/List","sap/m/Panel","sap/m/SearchField","sap/m/Text","sap/m/Title","sap/m/ToggleButton","sap/m/Toolbar","sap/m/ToolbarSpacer","sap/m/VBox","./BaseSettingsPanel","./utils/Accessibility","./utils/Constants","./utils/DataFormatUtils","./utils/PageManager","./utils/PersonalisationUtils"],function(e,t,s,a,i,n,o,r,l,g,c,d,h,p,u,P,S){"use strict";function m(e){return e&&e.__esModule&&typeof e.default!=="undefined"?e.default:e}const f=m(d);const I=h["getInvisibleText"];const _=p["PAGE_SELECTION_LIMIT"];const x=p["SETTINGS_PANELS_KEYS"];const B=u["recycleId"];const T=m(P);const w=m(S);const y=f.extend("sap.cux.home.PageSettingsPanel",{constructor:function e(){f.prototype.constructor.apply(this,arguments);this._initialNavigation=true},init:function e(){f.prototype.init.call(this);this.setProperty("key",x.PAGES);this.setProperty("title",this._i18nBundle.getText("pages"));this.setProperty("icon","sap-icon://course-book");this.oWrapperVBox=new c(`${this.getId()}--pageSettingsWrapper`,{width:"100%"}).addStyleClass("sapUiNoPadding sapUiNoMarginEnd");this.addAggregation("content",this.oWrapperVBox);this.attachPanelNavigated(()=>{void this.onPanelNavigated()})},onPanelNavigated:function e(){try{const t=this;function s(){if(t.oSearchField?.getValue()){t.oSearchField.setValue("");t.sSearchQuery="";t._renderPages(t.aSpaces)}}const a=function(){if(t._initialNavigation){t._initialNavigation=false;return Promise.resolve(t._initializePanel()).then(function(){})}}();return Promise.resolve(a&&a.then?a.then(s):s(a))}catch(i){return Promise.reject(i)}},_initializePanel:function e(){try{const e=this;if(!e.PageManagerInstance){e.PageManagerInstance=T.getInstance(w.getPersContainerId(e._getPanel()),w.getOwnerComponent(e._getPanel()))}return Promise.resolve(e.PageManagerInstance.fetchAllAvailablePages()).then(function(t){e.aAllPages=t;return Promise.resolve(e.PageManagerInstance.getFavoritePages()).then(function(t){e.aFavPages=t;return Promise.resolve(e.PageManagerInstance.fetchAllAvailableSpaces()).then(function(t){e.aSpaces=t;e._showMessageStrip();e._showToolbar();e._showPagesList()})})})}catch(e){return Promise.reject(e)}},_showMessageStrip:function e(){const t=new c(`${this.getId()}--msgStripContainer`,{width:"100%"}).addStyleClass("sapUiNoPadding sapUiNoMarginEnd");this.oMessage=new n(`${this.getId()}--msgStripText`).addStyleClass("sapUiSmallMargin");this._seHeaderMessage();t.addItem(this.oMessage);this.oWrapperVBox.addItem(t)},_setInvisibleSubHeaderText:function e(){const t=this.aFavPages.length>=_?this._i18nBundle.getText("myInterestwarning"):this._i18nBundle.getText("myInterestinfo");const s=I(this.getId()+"--pageSubHeaderText",t);return s},_seHeaderMessage:function e(){this.oMessage.setText(this.aFavPages.length>=_?this._i18nBundle.getText("myInterestwarning"):this._i18nBundle.getText("myInterestinfo"))},_showToolbar:function e(){const t=I(this.getId()+"--pageTitleText",this._i18nBundle.getText("pages"));const s=this._setInvisibleSubHeaderText();const a=new o(`${this.getId()}--pagesListTitle`,{text:this._i18nBundle.getText("pageGroupHeader"),level:"H3"}).addStyleClass("sapUiSmallMarginBottom");this.oSearchField=new i(`${this.getId()}--pagesListSearch`,{liveChange:e=>this._onPagesSearch(e),width:"13.75rem",ariaLabelledBy:[t.getId(),s.getId(),a.getId()]}).addStyleClass("sapUiSmallMarginBottom pagesListSearch");const n=new l(`${this.getId()}--pagesListToolbar`,{width:"calc(100% - 2rem)",height:"3rem",design:"Solid",content:[a,new g(`${this.getId()}--pagesHeaderToolbarSpacer`),this.oSearchField,t,s]}).addStyleClass("sapUiSmallMarginBegin pagesToolbarNoPadding");this.oWrapperVBox.addItem(n)},_showPagesList:function e(){this.oPagesListVBox=new c(`${this.getId()}--pagesListVBox`,{width:"calc(100% - 2rem)"}).addStyleClass("sapUiSmallMarginBegin");this._renderPages(this.aSpaces);this.oWrapperVBox.addItem(this.oPagesListVBox)},_createPagesList:function s(a,i,o){const l=new n({text:a.label});const g=new r(B(`${this.getId()}-toggle-${i}--${o}`),{tooltip:a.selected?this._i18nBundle.getText("hideBtn"):this._i18nBundle.getText("showBtn"),icon:"sap-icon://show",type:"Emphasized",pressed:!a.selected,enabled:a.selected||this.aFavPages.length<_,press:e=>void this._pageSelectHandler(a.id,e)});const c=new t(B(`${this.getId()}--customListBox--${i}--${o}`),{justifyContent:"SpaceBetween",alignItems:"Center",items:[l,g]});const d=new e(B(`${this.getId()}--customList--${i}--${o}`),{content:[c]}).addStyleClass("pagesPanelItem");return d},_renderPages:function e(i){const o=this.oPagesListVBox.getParent()?.getParent();const r=o?.getDomRef()?.childNodes[1];const l=r?.scrollTop||0;this.oPagesListVBox.removeAllItems();if(!i.length){if(!this.oNoDataHBox){this.oNoDataHBox=new t(`${this.getId()}--noSpacePageHBox`,{height:"3rem",justifyContent:"Center",alignItems:"Center",items:[new n(`${this.getId()}--noSpacePageItem`,{text:this._i18nBundle.getText("noData")})]}).addStyleClass("pagesBottomBorder");this.oWrapperVBox.addItem(this.oNoDataHBox)}this.oNoDataHBox.setVisible(true)}else if(this.oNoDataHBox){this.oNoDataHBox.setVisible(false)}i.forEach((e,t)=>{const i=[];e.children.forEach((e,s)=>{e.selected=this.aFavPages.find(t=>t.pageId===e.id)?true:false;i.push(this._createPagesList(e,t,s))});const n=this._createHeaderToolbar(e,t);const o=new a(B(`${this.getId()}--panel--${t}`),{expandable:true,expanded:true,width:"auto",headerToolbar:n,content:new s(B(`${this.getId()}--panelContent--${t}`),{items:i})}).addStyleClass("pagesPanel");this.oPagesListVBox.addItem(o)});if(l>=0&&o){setTimeout(()=>{o.scrollTo(l)},0)}},_createHeaderToolbar:function e(t,s){const a=new o(B(`${this.getId()}--headerTitle--${s}`),{wrapping:true,width:"auto",text:t.label,level:"H4"}).addStyleClass("dialogPanelTitle");const i=new l(B(`${this.getId()}--headerToolBar--${s}`),{design:"Solid",content:[a]});return i},_pageSelectHandler:function e(t,s){try{const e=this;const a=!s.getSource().getPressed();const i=e.aAllPages.find(e=>e.pageId===t);if(!i){return Promise.resolve(false)}if(a){e.aFavPages.push(i)}else{const s=e.aFavPages.findIndex(e=>e.pageId===t);e.aFavPages.splice(s,1)}e._seHeaderMessage();return Promise.resolve(e.PageManagerInstance.getFavPages(e.aFavPages,true)).then(function(){let t;if(e.sSearchQuery?.length){t=e._filterSpacesPages()}e._renderPages(t||e.aSpaces);void e._getPanel().getData()})}catch(e){return Promise.reject(e)}},_onPagesSearch:function e(t){this.sSearchQuery=t.getSource().getValue().toLowerCase();const s=this._filterSpacesPages();this._renderPages(s)},_filterSpacesPages:function e(){const t=[];this.aSpaces.forEach(e=>{const s=[];const a=e.label;e.children.forEach(e=>{if(e.label?.toLowerCase().includes(this.sSearchQuery)||a?.toLowerCase().includes(this.sSearchQuery)){s.push(e)}});if(s.length){t.push({...e,children:s})}});return t}});return y});
//# sourceMappingURL=PageSettingsPanel.js.map