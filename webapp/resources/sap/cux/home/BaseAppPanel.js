/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)
 *  * (c) Copyright 2009-2025 SAP SE. All rights reserved
 */
sap.ui.define(["sap/base/Log","sap/f/GridContainer","sap/f/GridContainerSettings","sap/m/HeaderContainer","sap/m/IllustratedMessage","sap/m/IllustratedMessageSize","sap/m/MessageToast","sap/m/VBox","sap/m/library","sap/ushell/Config","sap/ushell/Container","./App","./BasePanel","./Group","./utils/AppManager","./utils/DataFormatUtils","./utils/Device"],function(t,e,i,r,s,n,a,o,p,l,u,c,h,g,d,f,_){"use strict";function y(t){return t&&t.__esModule&&typeof t.default!=="undefined"?t.default:t}function A(t,e){try{var i=t()}catch(t){return e(t)}if(i&&i.then){return i.then(void 0,e)}return i}const m=p["BackgroundDesign"];function v(t,e){try{var i=t()}catch(t){return e(true,t)}if(i&&i.then){return i.then(e.bind(null,false),e.bind(null,true))}return e(false,i)}const I=y(c);const b=y(h);const M=y(g);const C=y(d);const z=f["getLeanURL"];const P=f["recycleId"];const W=_["DeviceType"];const V=b.extend("sap.cux.home.BaseAppPanel",{metadata:{library:"sap.cux.home",defaultAggregation:"apps",aggregations:{content:{multiple:true,singularName:"content",visibility:"hidden"},apps:{type:"sap.cux.home.App",singularName:"app",multiple:true}},events:{persistDialog:{},supported:{parameters:{isSupported:{type:"boolean"}}}},properties:{tileWidth:{type:"float",group:"Misc",defaultValue:304,visibility:"hidden"}}},constructor:function t(e,i){b.prototype.constructor.call(this,e,i);this._isDirty=true;this._isMobileDirty=true;this._isLoaded=false;this._isSupported=true;this._setAggregation=function(t,e=[],i="items"){e.forEach(e=>{t.addAggregation(i,e,true)})}},init:function t(){b.prototype.init.call(this);this.appManagerInstance=C.getInstance();this._controlMap=new Map;this._appsPanelWrapper=this._generateWrapper();this.addContent(this._appsPanelWrapper)},_generateWrapper:function t(){if(!this._appsPanelWrapper){this._appsPanelWrapper=new o(`${this.getId()}-appsPanelWrapper`,{items:[this._generateDesktopAppsWrapper(),this._generateMobileAppsWrapper(),this._generateErrorMessage()],width:"100%"}).addStyleClass("sapCuxAppsPanel sapCuxAppsPanelWrapper")}return this._appsPanelWrapper},_generateDesktopAppsWrapper:function t(){const e=`${this.getId()}-desktopAppsWrapper`;if(!this._controlMap.get(e)){this._controlMap.set(e,new o({id:`${this.getId()}-desktopAppsWrapper`,items:[this._generateAppsWrapper()],visible:this.getDeviceType()!==W.Mobile,backgroundDesign:m.Solid}).addStyleClass("sapCuxAppsPanel sapCuxAppsContainerBorder"))}return this._controlMap.get(e)},_generateAppsWrapper:function t(){if(!this._appsWrapper){this._appsWrapper=new e({id:`${this.getId()}-appsWrapper`,layout:new i(`${this.getId()}-appsWrapperLayout`,{columnSize:`${this.getProperty("tileWidth")/16}rem`,rowSize:"4.375rem",gap:"0.5rem"})})}return this._appsWrapper},_generateMobileAppsWrapper:function t(){if(!this._mobileAppsWrapper){this._mobileAppsWrapper=new r({id:`${this.getId()}-mobileAppsWrapper`,gridLayout:true,showDividers:false,height:"23.5rem",content:[],visible:this.getDeviceType()===W.Mobile}).addStyleClass("sapUiMargin-26Bottom")}return this._mobileAppsWrapper},_generateErrorMessage:function t(){if(!this._errorCard){this._errorCard=new o(`${this.getId()}-errorCard`,{wrap:"Wrap",backgroundDesign:"Solid",items:[this.generateIllustratedMessage()],visible:this.getApps().length===0,justifyContent:"Center"}).addStyleClass("sapCuxAppsPanel")}return this._errorCard},generateApps:function t(e){return e.map((t,e)=>{const i=t.persConfig?.sectionId;const r=t.persConfig?.isDefaultSection;const s=i&&!r?P(`${this.getKey()}-groupApp-${e}`):P(`${this.getKey()}-app-${e}`);const n=new I(s,{title:t.title,subTitle:t.subtitle,bgColor:typeof t.BGColor==="object"?t.BGColor.key:t.BGColor,icon:t.icon,url:t.url,vizId:t.vizId||t.visualization?.vizId,status:t.status});if(t.oldAppId){n.data("oldAppId",t.oldAppId)}t.menuItems?.forEach(t=>{n.addAggregation("menuItems",t,true)});return n})},setApps:function t(e){e.forEach(t=>{this.addAggregation("apps",t,true)})},fetchTileVisualization:function t(e=[]){if(this.getDeviceType()===W.Mobile){const t=this._generateMobileAppsWrapper()?.getContent()||[];for(const i of t){e=e.concat(i?.getContent()||[])}}else{e=this._generateAppsWrapper()?.getItems()||[]}return e},convertActivitiesToVisualizations:function t(e){try{const t=this;return Promise.resolve(Promise.all([t._getAllAvailableVisualizations(),u.getServiceAsync("URLParsing")])).then(function([i,r]){const s=e.filter(t=>t.appType==="Application").map(t=>{t.orgAppId=t.appId;t.appId=t.url;return t});const n=s.map(e=>t._convertToVisualization(e,i,r)).filter(t=>t!==undefined);return Promise.resolve(t._updateVisualizationAvailability(n))})}catch(t){return Promise.reject(t)}},_getAllAvailableVisualizations:function t(){try{const e=this;function i(){return e._allAvailableVisualizations}const r=function(){if(!e._allAvailableVisualizations){return Promise.resolve(e.appManagerInstance._getCatalogApps()).then(function(t){e._allAvailableVisualizations=t.reduce((t,e)=>t.concat(e.visualizations||[]),[])})}}();return Promise.resolve(r&&r.then?r.then(i):i(r))}catch(s){return Promise.reject(s)}},_updateVisualizationAvailability:function t(e){try{const t=this;return Promise.resolve(t.appManagerInstance.fetchFavVizs(true,true)).then(function(t){e.forEach(e=>{e.addedInFavorites=t.some(t=>t.oldAppId===e.orgAppId)});return e})}catch(t){return Promise.reject(t)}},_updateActivityInfo:function t(e,i){this._catalogVisualizationCache=this._catalogVisualizationCache||new Map;e.targetURL=i.targetURL;e.vizId=i.vizId;this._catalogVisualizationCache.set(e.orgAppId,i);return e},prepareAppsBeforeLoad:function t(e,i){return Promise.resolve({apps:e,tiles:i})},_findBestMatchingVisualization:function t(e,i,r){const s=i.find(t=>t.targetURL===e.url);if(s){return this._updateActivityInfo(e,s)}else{const t=new Map;const s=[];i.forEach(e=>{const i=e.targetURL;if(!t.get(i)){const n={viz:e,params:r.parseShellHash(e.targetURL).params,prio:0};t.set(i,n);s.push(n)}});const n=s.filter(t=>this._filterMatchingVisualization(e,t,r));if(n.length){n.sort((t,e)=>t.prio-e.prio);return this._updateActivityInfo(e,n[0].viz)}}},_filterMatchingVisualization:function t(e,i,r){const s=r.parseShellHash(e.url);const n=s.params;const a=Object.keys(n);const o=i.params;const p=Object.keys(o).filter(t=>t!=="allItems");if(p.length===a.length){const t=a.every(t=>p.includes(t)&&o[t][0]===n[t][0]);if(t){i.prio=1;return true}return false}else if(!p.length){i.prio=Object.keys(i.params).length?2:3;return true}return false},_convertToVisualization:function t(e,i,r){this._catalogVisualizationCache=this._catalogVisualizationCache||new Map;const s=this._catalogVisualizationCache.get(e.orgAppId);if(s){return this._updateActivityInfo(e,s)}else{const t=i.filter(t=>t.vizId&&`#${t.target?.semanticObject}-${t.target?.action}`===e.orgAppId);if(t.length>1){return this._findBestMatchingVisualization(e,t,r)}else if(t.length===1){return this._updateActivityInfo(e,t[0])}}},_addAppToFavorites:function e(i){try{const e=this;e.setBusy(true);return Promise.resolve(v(function(){return A(function(){const t=i.getSource();const r=t.getParent();const s=r.getVizId?.();const n=function(){if(s){return Promise.resolve(e.appManagerInstance.addVisualization(s)).then(function(){return Promise.resolve((e.getParent?.())._refreshAllPanels()).then(function(){const t=e._i18nBundle.getText("appMovedToFavorites",[r.getTitle()]);a.show(t)})})}}();if(n&&n.then)return n.then(function(){})},function(e){t.error(e)})},function(t,i){e.setBusy(false);if(t)throw i;return i}))}catch(t){return Promise.reject(t)}},isLoaded:function t(){return this._isLoaded},setLoaded:function t(e){this._isLoaded=e},isDirty:function t(){return this._isDirty},setDesktopViewDirty:function t(e){this._isDirty=e},isMobileDirty:function t(){return this._isMobileDirty},setMobileViewDirty:function t(e){this._isMobileDirty=e},setBusy:function t(e){const i=this._generateAppsWrapper();i.setBusy(e)},_getGroup:function t(e){const i=this.getAggregation("groups")||[];return i.find(t=>t.getGroupId()===e)},isSupported:function t(){return this._isSupported},setSupported:function t(e){this._isSupported=e},_attachUserActivityTracking:function t(){if(l.last("/core/shell/enableRecentActivity")){l.on("/core/shell/model/enableTrackingActivity").do(t=>{this.setSupported(t);this.fireSupported({isSupported:t})})}},refresh:function t(){try{const t=this;return Promise.resolve(t.getParent().refreshPanel(t)).then(function(){})}catch(t){return Promise.reject(t)}},generateIllustratedMessage:function t(){if(!this._errorMessage){this._errorMessage=new s(`${this.getId()}-errorMessage`,{illustrationSize:n.Base,title:this._i18nBundle.getText("noAppsTitle"),description:this._i18nBundle.getText("noData")}).addStyleClass("appsSectionMessageCard")}return this._errorMessage},_applyUngroupedTileColor:function t(e,i){const r=this.fetchTileVisualization();const s=e instanceof M?e.getGroupId():null;const n=r.findIndex(t=>s?t.data("groupId")===s:t.getUrl()===z(e.getUrl()));r[n]?.setBackgroundColor(i)},exit:function t(){this._controlMap.forEach(t=>{t.destroy()})}});return V});
//# sourceMappingURL=BaseAppPanel.js.map