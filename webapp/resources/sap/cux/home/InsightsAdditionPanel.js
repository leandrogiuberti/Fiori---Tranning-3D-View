/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)
 *  * (c) Copyright 2009-2025 SAP SE. All rights reserved
 */
sap.ui.define(["sap/base/Log","sap/insights/CardHelper","sap/m/Button","sap/m/library","sap/m/MessageBox","sap/m/MessageToast","sap/m/VBox","./BaseSettingsPanel","./CardsPanel","./InsightsContainer","./utils/Constants","./utils/FeatureUtils","./utils/FESRUtil"],function(t,e,n,s,r,o,i,a,d,c,u,l,h){"use strict";function f(t){return t&&t.__esModule&&typeof t.default!=="undefined"?t.default:t}function g(t,e){try{var n=t()}catch(t){return e(t)}if(n&&n.then){return n.then(void 0,e)}return n}const p=s["BackgroundDesign"];function C(t,e){try{var n=t()}catch(t){return e(true,t)}if(n&&n.then){return n.then(e.bind(null,false),e.bind(null,true))}return e(false,n)}const P=s["ButtonType"];const m=f(a);const _=f(d);const A=f(c);const B=u["CONTENT_ADDITION_PANEL_TYPES"];const I=u["FEATURE_TOGGLES"];const S=u["FESR_IDS"];const E=l["isNavigationSupportedForFeature"];const v=h["addFESRSemanticStepName"];const y=h["FESR_EVENTS"];const D=m.extend("sap.cux.home.InsightsAdditionPanel",{init:function t(){m.prototype.init.call(this);this.setProperty("key",B.AI_INSIGHTS_CARDS);this.setProperty("title",this._i18nBundle.getText("insightsCards"));this.addCardsButton=new n(`${this.getId()}-add-cards-btn`,{text:this._i18nBundle.getText("addFromInsightsDialogBtn"),type:P.Emphasized,enabled:false,press:this.onPressAddCards.bind(this)});v(this.addCardsButton,y.PRESS,S.ADD_AI_CARD);this.addActionButton(this.addCardsButton);void this._setupContent();this.attachEvent("onDialogClose",this.resetAddCardInnerContent.bind(this))},enableAddButton:function t(e){this.addCardsButton.setEnabled(e)},_setupContent:function e(){try{const e=this;const n=g(function(){return Promise.resolve(e._fetchAddCardDialogContent()).then(function(t){if(t){const n=new i(`${e.getId()}-wrapperVBox`,{items:t,backgroundDesign:p.Solid,height:"100%"});e.addAggregation("content",n)}})},function(e){t.error(e.message)});return Promise.resolve(n&&n.then?n.then(function(){}):void 0)}catch(t){return Promise.reject(t)}},_fetchAddCardDialogContent:function t(){try{const t=this;return Promise.resolve(e.getServiceAsync()).then(function(e){t.cardHelperInstance=e;return t.cardHelperInstance.fetchAddCardInnerContent(e=>{t._latestGeneratedManifest=e.getParameters();const n=Object.keys(t._latestGeneratedManifest).length>1;t.enableAddButton(n)})})}catch(t){return Promise.reject(t)}},getInsightsContainer:function t(){const e=this.getParent()?.getParent();return e.getContent().find(t=>t instanceof A)},isSupported:function t(){try{const e=this;function n(){if(!e.isPanelSupported){e.removeActionButton(e.addCardsButton);const t=e.getParent();t.removePanel(e);t.updateActionButtons()}return e.isPanelSupported}const s={target:{semanticObject:"IntelligentPrompt",action:"personalize"}};const r=function(){if(e.isPanelSupported===undefined){e.isPanelSupported=false;return Promise.resolve(E(I.AI_GENERATED_CARD,s)).then(function(t){e.isPanelSupported=t})}}();return Promise.resolve(r&&r.then?r.then(n):n(r))}catch(o){return Promise.reject(o)}},_fetchCardsPanel:function t(){return this.getInsightsContainer()?.getContent().find(t=>t instanceof _)},onPressAddCards:function e(){try{const e=this;const n=e.getParent();const s=C(function(){return g(function(){n.setBusy(true);return Promise.resolve(e.cardHelperInstance._createCard(e._latestGeneratedManifest)).then(function(t){const s=t["sap.card"]?.header?.title;o.show(e._i18nBundle.getText("Card_Created",[s]));n.close();if(!t?.["sap.insights"]?.visible){r.information(e._i18nBundle.getText("INT_CARD_LIMIT_MESSAGEBOX"),{styleClass:"msgBoxAlign"})}const i=e._fetchCardsPanel();return Promise.resolve(i?.refreshData()).then(function(){})})},function(e){t.error(e.message)})},function(t,e){n.setBusy(false);if(t)throw e;return e});return Promise.resolve(s&&s.then?s.then(function(){}):void 0)}catch(t){return Promise.reject(t)}},resetAddCardInnerContent:function t(){this.cardHelperInstance?.resetAddCardInnerContent();this.enableAddButton(false)}});return D});
//# sourceMappingURL=InsightsAdditionPanel.js.map