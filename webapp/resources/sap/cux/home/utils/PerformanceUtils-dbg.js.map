{"version":3,"file":"PerformanceUtils-dbg.js","names":["sap","ui","define","Container","EventHub","utils","setupPerformanceTracking","layout","setupTracking","Promise","resolve","containers","getItems","forEach","container","getContent","panel","attachEventOnce","containerName","getMetadata","getName","heroElement","availableElements","filter","availableElement","control","getVisible","name","_temp2","markHomePageEnd","then","e","reject","visibleElements","layoutElement","find","markHomePageStart","_temp","length","isHomeApp","_isHomeApp2","recordElementLoadEnd","homePageLoadEndMarker","emit","_isHomeApp","recordElementLoadStart","homePageLoadStartMarker","getServiceAsync","getCurrentApplication","homePage","UIElements","Object","keys","map","elementName","startMarked","endMarked","findUIElement","setPerformanceMark","markName","bUseUniqueMark","bUseLastMark","recordElementLoad","customMarkName","isStartMaker","element","marker","controlFlag","__exports","__esModule"],"sources":["PerformanceUtils.ts"],"sourcesContent":["/*!\n * SAP UI development toolkit for HTML5 (SAPUI5)\n *  * (c) Copyright 2009-2025 SAP SE. All rights reserved\n */\nimport Container from \"sap/ushell/Container\";\nimport EventHub from \"sap/ushell/EventHub\";\nimport AppLifeCycle from \"sap/ushell/services/AppLifeCycle\";\nimport utils from \"sap/ushell/utils\";\nimport BaseContainer from \"../BaseContainer\";\nimport Layout from \"../Layout\";\n\ntype ElementInfo = {\n\tname: keyof typeof UIElements;\n\tstartMarked: boolean;\n\tendMarked: boolean;\n\tcontrol?: Layout | BaseContainer;\n};\n\nconst layoutElement = \"sap.cux.home.Layout\";\nconst homePageLoadStartMarker = \"FLP-TTI-Homepage-Custom-Start\";\nconst homePageLoadEndMarker = \"FLP-TTI-Homepage-Custom\";\nlet setupTracking = false;\n\n/**\n * An object representing the UI elements and their corresponding marker names.\n *\n */\nexport const UIElements = {\n\t\"sap.cux.home.AppsContainer\": \"Apps\",\n\t\"sap.cux.home.InsightsContainer\": \"Insights\",\n\t\"sap.cux.home.NewsAndPagesContainer\": \"News\",\n\t\"sap.cux.home.ToDosContainer\": \"ToDos\",\n\t[layoutElement]: \"Layout\"\n};\n\nlet availableElements: ElementInfo[] = Object.keys(UIElements).map((elementName) => ({\n\tname: elementName as keyof typeof UIElements,\n\tstartMarked: false,\n\tendMarked: false\n}));\n\n/**\n * Checks if the current application is the home app.\n *\n * @returns {Promise<boolean>} - A promise that resolves to true if the current application is the home app, otherwise false.\n */\nasync function isHomeApp(): Promise<boolean> {\n\tconst container = await Container.getServiceAsync<AppLifeCycle>(\"AppLifeCycle\");\n\treturn container.getCurrentApplication()?.homePage as boolean;\n}\n\n/**\n * Records the start of the homepage load.\n *\n * @returns {Promise<void>} - A promise that resolves when the start of the homepage load is recorded.\n */\nasync function markHomePageStart(): Promise<void> {\n\tif (await isHomeApp()) {\n\t\trecordElementLoadStart(layoutElement, homePageLoadStartMarker);\n\t}\n}\n\n/**\n * Records the end of the homepage load.\n *\n * @returns {Promise<void>} - A promise that resolves when the end of the homepage load is recorded.\n */\nasync function markHomePageEnd(): Promise<void> {\n\tif (await isHomeApp()) {\n\t\trecordElementLoadEnd(layoutElement, homePageLoadEndMarker);\n\t\tEventHub.emit(\"CustomHomeRendered\");\n\t}\n}\n\n/**\n * Finds the UI element information by container name.\n *\n * @param {keyof typeof UIElements} containerName - The name of the container.\n * @returns {ElementInfo | undefined} - The element information if found, otherwise undefined.\n */\nfunction findUIElement(containerName: keyof typeof UIElements): ElementInfo | undefined {\n\treturn availableElements.find((heroElement) => heroElement.name === containerName);\n}\n\n/**\n * Sets a performance mark with the given name.\n *\n * @param {string} markName - The name of the performance mark.\n */\nfunction setPerformanceMark(markName: string): void {\n\tutils.setPerformanceMark(markName, {\n\t\tbUseUniqueMark: true,\n\t\tbUseLastMark: true\n\t});\n}\n\n/**\n * Records the load of an element.\n *\n * @param {keyof typeof UIElements} containerName - The name of the container.\n * @param {string} [customMarkName] - The custom mark name.\n * @param {boolean} [isStartMaker] - Indicates if it is a start marker.\n */\nfunction recordElementLoad(containerName: keyof typeof UIElements, customMarkName?: string, isStartMaker?: boolean): void {\n\tconst element = findUIElement(containerName);\n\tconst marker = isStartMaker ? \"Start\" : \"End\";\n\tconst controlFlag = isStartMaker ? \"startMarked\" : \"endMarked\";\n\n\tif (element && !element[controlFlag] && element.control?.getVisible()) {\n\t\telement[controlFlag] = true;\n\t\tsetPerformanceMark(customMarkName || `FLP-Homepage-Section-${marker}[${UIElements[containerName]}]`);\n\t}\n}\n\n/**\n * Sets up performance tracking for the given layout.\n *\n * @param {Layout} layout - The layout object containing the UI elements.\n */\nexport async function setupPerformanceTracking(layout: Layout): Promise<void> {\n\tif (!layout || setupTracking) return;\n\n\tconst containers = layout.getItems();\n\tcontainers.forEach((container) => {\n\t\tcontainer.getContent().forEach((panel) => {\n\t\t\tpanel.attachEventOnce(\"loaded\", async () => {\n\t\t\t\tconst containerName = container.getMetadata().getName();\n\t\t\t\tconst heroElement = availableElements.filter((availableElement) => availableElement.control?.getVisible())[0].name;\n\n\t\t\t\t// If the hero element is loaded, mark the end of the homepage load\n\t\t\t\tif (containerName === heroElement) {\n\t\t\t\t\tawait markHomePageEnd();\n\t\t\t\t}\n\t\t\t});\n\t\t});\n\t});\n\n\tconst visibleElements = availableElements.filter((availableElement) => {\n\t\tavailableElement.control =\n\t\t\tavailableElement.name === layoutElement\n\t\t\t\t? layout\n\t\t\t\t: containers.find((container) => container.getMetadata().getName() === availableElement.name);\n\t\treturn availableElement.control?.getVisible();\n\t});\n\n\t// record homepage start\n\tsetupTracking = true;\n\tawait markHomePageStart();\n\n\t// record homepage end in case of no visible elements except layout\n\tif (visibleElements.length === 1) {\n\t\tawait markHomePageEnd();\n\t}\n}\n\n/**\n * Records the start of the element load.\n *\n * @param {keyof typeof UIElements} containerName - The name of the container.\n * @param {string} [customMarkName] - The custom mark name.\n */\nexport function recordElementLoadStart(containerName: keyof typeof UIElements, customMarkName?: string): void {\n\trecordElementLoad(containerName, customMarkName, true);\n}\n\n/**\n * Records the end of the element load.\n *\n * @param {keyof typeof UIElements} containerName - The name of the container.\n * @param {string} [customMarkName] - The custom mark name.\n */\nexport function recordElementLoadEnd(containerName: keyof typeof UIElements, customMarkName?: string): void {\n\trecordElementLoad(containerName, customMarkName, false);\n}\n"],"mappings":"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","ignoreList":[]}