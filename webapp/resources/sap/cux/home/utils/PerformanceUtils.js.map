{"version":3,"file":"PerformanceUtils.js","names":["sap","ui","define","Container","EventHub","utils","setupPerformanceTracking","layout","setupTracking","Promise","resolve","containers","getItems","forEach","container","getContent","panel","attachEventOnce","containerName","getMetadata","getName","heroElement","availableElements","filter","availableElement","control","getVisible","name","_temp2","markHomePageEnd","then","e","reject","visibleElements","layoutElement","find","markHomePageStart","_temp","length","isHomeApp","_isHomeApp2","recordElementLoadEnd","homePageLoadEndMarker","emit","_isHomeApp","recordElementLoadStart","homePageLoadStartMarker","getServiceAsync","getCurrentApplication","homePage","UIElements","Object","keys","map","elementName","startMarked","endMarked","findUIElement","setPerformanceMark","markName","bUseUniqueMark","bUseLastMark","recordElementLoad","customMarkName","isStartMaker","element","marker","controlFlag","__exports","__esModule"],"sources":["PerformanceUtils.ts"],"sourcesContent":["/*!\n * SAP UI development toolkit for HTML5 (SAPUI5)\n *  * (c) Copyright 2009-2025 SAP SE. All rights reserved\n */\nimport Container from \"sap/ushell/Container\";\nimport EventHub from \"sap/ushell/EventHub\";\nimport AppLifeCycle from \"sap/ushell/services/AppLifeCycle\";\nimport utils from \"sap/ushell/utils\";\nimport BaseContainer from \"../BaseContainer\";\nimport Layout from \"../Layout\";\n\ntype ElementInfo = {\n\tname: keyof typeof UIElements;\n\tstartMarked: boolean;\n\tendMarked: boolean;\n\tcontrol?: Layout | BaseContainer;\n};\n\nconst layoutElement = \"sap.cux.home.Layout\";\nconst homePageLoadStartMarker = \"FLP-TTI-Homepage-Custom-Start\";\nconst homePageLoadEndMarker = \"FLP-TTI-Homepage-Custom\";\nlet setupTracking = false;\n\n/**\n * An object representing the UI elements and their corresponding marker names.\n *\n */\nexport const UIElements = {\n\t\"sap.cux.home.AppsContainer\": \"Apps\",\n\t\"sap.cux.home.InsightsContainer\": \"Insights\",\n\t\"sap.cux.home.NewsAndPagesContainer\": \"News\",\n\t\"sap.cux.home.ToDosContainer\": \"ToDos\",\n\t[layoutElement]: \"Layout\"\n};\n\nlet availableElements: ElementInfo[] = Object.keys(UIElements).map((elementName) => ({\n\tname: elementName as keyof typeof UIElements,\n\tstartMarked: false,\n\tendMarked: false\n}));\n\n/**\n * Checks if the current application is the home app.\n *\n * @returns {Promise<boolean>} - A promise that resolves to true if the current application is the home app, otherwise false.\n */\nasync function isHomeApp(): Promise<boolean> {\n\tconst container = await Container.getServiceAsync<AppLifeCycle>(\"AppLifeCycle\");\n\treturn container.getCurrentApplication()?.homePage as boolean;\n}\n\n/**\n * Records the start of the homepage load.\n *\n * @returns {Promise<void>} - A promise that resolves when the start of the homepage load is recorded.\n */\nasync function markHomePageStart(): Promise<void> {\n\tif (await isHomeApp()) {\n\t\trecordElementLoadStart(layoutElement, homePageLoadStartMarker);\n\t}\n}\n\n/**\n * Records the end of the homepage load.\n *\n * @returns {Promise<void>} - A promise that resolves when the end of the homepage load is recorded.\n */\nasync function markHomePageEnd(): Promise<void> {\n\tif (await isHomeApp()) {\n\t\trecordElementLoadEnd(layoutElement, homePageLoadEndMarker);\n\t\tEventHub.emit(\"CustomHomeRendered\");\n\t}\n}\n\n/**\n * Finds the UI element information by container name.\n *\n * @param {keyof typeof UIElements} containerName - The name of the container.\n * @returns {ElementInfo | undefined} - The element information if found, otherwise undefined.\n */\nfunction findUIElement(containerName: keyof typeof UIElements): ElementInfo | undefined {\n\treturn availableElements.find((heroElement) => heroElement.name === containerName);\n}\n\n/**\n * Sets a performance mark with the given name.\n *\n * @param {string} markName - The name of the performance mark.\n */\nfunction setPerformanceMark(markName: string): void {\n\tutils.setPerformanceMark(markName, {\n\t\tbUseUniqueMark: true,\n\t\tbUseLastMark: true\n\t});\n}\n\n/**\n * Records the load of an element.\n *\n * @param {keyof typeof UIElements} containerName - The name of the container.\n * @param {string} [customMarkName] - The custom mark name.\n * @param {boolean} [isStartMaker] - Indicates if it is a start marker.\n */\nfunction recordElementLoad(containerName: keyof typeof UIElements, customMarkName?: string, isStartMaker?: boolean): void {\n\tconst element = findUIElement(containerName);\n\tconst marker = isStartMaker ? \"Start\" : \"End\";\n\tconst controlFlag = isStartMaker ? \"startMarked\" : \"endMarked\";\n\n\tif (element && !element[controlFlag] && element.control?.getVisible()) {\n\t\telement[controlFlag] = true;\n\t\tsetPerformanceMark(customMarkName || `FLP-Homepage-Section-${marker}[${UIElements[containerName]}]`);\n\t}\n}\n\n/**\n * Sets up performance tracking for the given layout.\n *\n * @param {Layout} layout - The layout object containing the UI elements.\n */\nexport async function setupPerformanceTracking(layout: Layout): Promise<void> {\n\tif (!layout || setupTracking) return;\n\n\tconst containers = layout.getItems();\n\tcontainers.forEach((container) => {\n\t\tcontainer.getContent().forEach((panel) => {\n\t\t\tpanel.attachEventOnce(\"loaded\", async () => {\n\t\t\t\tconst containerName = container.getMetadata().getName();\n\t\t\t\tconst heroElement = availableElements.filter((availableElement) => availableElement.control?.getVisible())[0].name;\n\n\t\t\t\t// If the hero element is loaded, mark the end of the homepage load\n\t\t\t\tif (containerName === heroElement) {\n\t\t\t\t\tawait markHomePageEnd();\n\t\t\t\t}\n\t\t\t});\n\t\t});\n\t});\n\n\tconst visibleElements = availableElements.filter((availableElement) => {\n\t\tavailableElement.control =\n\t\t\tavailableElement.name === layoutElement\n\t\t\t\t? layout\n\t\t\t\t: containers.find((container) => container.getMetadata().getName() === availableElement.name);\n\t\treturn availableElement.control?.getVisible();\n\t});\n\n\t// record homepage start\n\tsetupTracking = true;\n\tawait markHomePageStart();\n\n\t// record homepage end in case of no visible elements except layout\n\tif (visibleElements.length === 1) {\n\t\tawait markHomePageEnd();\n\t}\n}\n\n/**\n * Records the start of the element load.\n *\n * @param {keyof typeof UIElements} containerName - The name of the container.\n * @param {string} [customMarkName] - The custom mark name.\n */\nexport function recordElementLoadStart(containerName: keyof typeof UIElements, customMarkName?: string): void {\n\trecordElementLoad(containerName, customMarkName, true);\n}\n\n/**\n * Records the end of the element load.\n *\n * @param {keyof typeof UIElements} containerName - The name of the container.\n * @param {string} [customMarkName] - The custom mark name.\n */\nexport function recordElementLoadEnd(containerName: keyof typeof UIElements, customMarkName?: string): void {\n\trecordElementLoad(containerName, customMarkName, false);\n}\n"],"mappings":"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","ignoreList":[]}