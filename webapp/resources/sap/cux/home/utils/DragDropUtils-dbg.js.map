{"version":3,"file":"DragDropUtils-dbg.js","names":["sap","ui","define","GridContainer","FlexBox","Table","Event","Element","sap_ui_core_library","attachKeyboardHandler","event","disablenavigation","callback","draggedControl","closestTo","target","firstElementChild","container","getParent","isMetaKey","metaKey","ctrlKey","items","getItems","currentIndex","findIndex","item","document","activeElement","getDomRef","setTabIndexForItems","map","includes","key","Promise","resolve","preventDefault","stopPropagation","currentItemIndex","indexOfItem","reverseItems","reverse","index","_areItemsInSameRow","_getClosestElementYIndex","data","length","droppedControl","_temp3","_temp2","focusDraggedItem","dragDropEvent","dropPosition","dnd","RelativeDropPosition","Before","After","_temp","then","e","reject","item1","item2","getBoundingClientRect","top","dropItemIndex","draggedItemDomRef","aWrapperItemsDomRef","$","children","each","iIndex","oWrapperItem","classList","contains","push","setAttribute","focus","keyCode","fnElementPositionX","element","x","fnElementPositionY","y","minIndex","minDistance","Number","MAX_SAFE_INTEGER","forEach","currentDist","Math","sqrt","pow","isAllowed","aItems","tabIndex","__exports","__esModule"],"sources":["DragDropUtils.ts"],"sourcesContent":["/*!\n * SAP UI development toolkit for HTML5 (SAPUI5)\n *  * (c) Copyright 2009-2025 SAP SE. All rights reserved\n */\n\nimport GridContainer from \"sap/f/GridContainer\";\nimport FlexBox from \"sap/m/FlexBox\";\nimport HeaderContainer from \"sap/m/HeaderContainer\";\nimport Table from \"sap/m/Table\";\nimport Event from \"sap/ui/base/Event\";\nimport Control from \"sap/ui/core/Control\";\nimport Element from \"sap/ui/core/Element\";\nimport { dnd } from \"sap/ui/core/library\";\n\n/**\n * Handles keyboard events for navigation and drag and drop functionality.\n * @param {KeyboardEvent} event - The keyboard event object.\n * @param {boolean} disablenavigation - Whether navigation is allowed.\n * @param {Function} callback - The callback function to execute when a drag and drop event occurs.\n * @returns {Promise<void>} A Promise that resolves when the handling is complete.\n */\n\nexport async function attachKeyboardHandler(\n\tevent: KeyboardEvent,\n\tdisablenavigation: boolean,\n\tcallback?: (dragDropEvent: Event) => Promise<void> | void\n) {\n\tconst draggedControl = Element.closestTo((event.target as HTMLElement).firstElementChild as HTMLElement) as Control;\n\tconst container = draggedControl.getParent() as GridContainer | FlexBox;\n\tconst isMetaKey = event.metaKey || event.ctrlKey;\n\tconst items = container.getItems();\n\tconst currentIndex = items.findIndex((item) => document.activeElement === item.getDomRef());\n\tsetTabIndexForItems(\n\t\titems.map((item) => item.getDomRef() as HTMLElement),\n\t\tcurrentIndex\n\t);\n\n\tif (\n\t\t!draggedControl ||\n\t\t!container ||\n\t\t!(disablenavigation && [\"ArrowRight\", \"ArrowLeft\", \"ArrowUp\", \"ArrowDown\", \"Home\", \"End\"].includes(event.key))\n\t) {\n\t\treturn;\n\t}\n\n\tevent.preventDefault();\n\tevent.stopPropagation();\n\n\tlet currentItemIndex = container.indexOfItem(draggedControl);\n\tconst reverseItems = [...items].reverse();\n\tconst getDomRef = (index: number): HTMLElement | null => items[index]?.getDomRef() as HTMLElement | null;\n\tswitch (event.key) {\n\t\tcase \"ArrowRight\":\n\t\t\tif (_areItemsInSameRow(getDomRef(currentItemIndex), getDomRef(currentItemIndex + 1))) {\n\t\t\t\tcurrentItemIndex++;\n\t\t\t}\n\t\t\tbreak;\n\t\tcase \"ArrowLeft\":\n\t\t\tif (_areItemsInSameRow(getDomRef(currentItemIndex), getDomRef(currentItemIndex - 1))) {\n\t\t\t\tcurrentItemIndex--;\n\t\t\t}\n\t\t\tbreak;\n\t\tcase \"ArrowUp\":\n\t\tcase \"ArrowDown\":\n\t\t\tcurrentItemIndex = _getClosestElementYIndex(container, currentItemIndex, event.key);\n\t\t\tbreak;\n\t\tcase \"Home\":\n\t\t\tcurrentItemIndex = draggedControl.data(\"groupId\")\n\t\t\t\t? items.findIndex((item) => item.data(\"groupId\"))\n\t\t\t\t: items.findIndex((item) => !item.data(\"groupId\"));\n\t\t\tbreak;\n\t\tcase \"End\":\n\t\t\tcurrentItemIndex =\n\t\t\t\titems.length -\n\t\t\t\t1 -\n\t\t\t\t(draggedControl.data(\"groupId\")\n\t\t\t\t\t? reverseItems.findIndex((item) => item.data(\"groupId\"))\n\t\t\t\t\t: reverseItems.findIndex((item) => !item.data(\"groupId\")));\n\t\t\tbreak;\n\t}\n\tconst droppedControl = currentItemIndex > -1 && currentItemIndex < items.length ? items[currentItemIndex] : null;\n\tif (draggedControl && droppedControl) {\n\t\tconst dragDropEvent = new Event(\"keyboardDragDropEvent\", container, {\n\t\t\tdraggedControl,\n\t\t\tdroppedControl,\n\t\t\tdropPosition: [\"ArrowLeft\", \"ArrowUp\", \"Home\"].includes(event.key)\n\t\t\t\t? dnd.RelativeDropPosition.Before\n\t\t\t\t: dnd.RelativeDropPosition.After\n\t\t});\n\t\tsetTabIndexForItems(\n\t\t\titems.map((item) => item.getDomRef() as HTMLElement),\n\t\t\tcurrentItemIndex\n\t\t);\n\t\tif (callback && isMetaKey) {\n\t\t\tawait callback(dragDropEvent);\n\t\t}\n\t\tfocusDraggedItem(container, currentItemIndex);\n\t}\n}\n\n/**\n * Checks if two items are in the same row based on their top positions.\n *\n * @private\n * @param {HTMLElement | null} item1 - The first item's DOM reference.\n * @param {HTMLElement | null} item2 - The second item's DOM reference.\n * @returns {boolean} True if both items are in the same row, otherwise false.\n */\nfunction _areItemsInSameRow(item1: HTMLElement | null, item2: HTMLElement | null): boolean {\n\tif (!item1 || !item2) {\n\t\treturn false;\n\t}\n\treturn item1.getBoundingClientRect().top === item2.getBoundingClientRect().top;\n}\n\n/**\n * Gathers all DOM elements representing individual tiles in the grid container\n * that have the \"sapFGridContainerItemWrapper\" class, stores them in an array,\n * and then focuses the DOM element corresponding to the card that was just moved\n * during a drag-and-drop operation by setting its \"tabindex\" to \"0\" for\n * accessibility and navigation purposes.\n * @param {GridContainer | FlexBox} container - The container containing the items.\n * @param {number} dropItemIndex - The index of the item to focus after drag-and-drop.\n */\nexport const focusDraggedItem = (container: GridContainer | HeaderContainer | FlexBox | Table, dropItemIndex: number): void => {\n\tlet draggedItemDomRef: HTMLElement | null = null;\n\tif (container instanceof GridContainer) {\n\t\tconst aWrapperItemsDomRef: HTMLElement[] = [];\n\t\tcontainer\n\t\t\t.$(\"listUl\")\n\t\t\t.children()\n\t\t\t.each(function (iIndex, oWrapperItem) {\n\t\t\t\tif (oWrapperItem.classList.contains(\"sapFGridContainerItemWrapper\")) {\n\t\t\t\t\taWrapperItemsDomRef.push(oWrapperItem);\n\t\t\t\t}\n\t\t\t});\n\t\tdraggedItemDomRef = aWrapperItemsDomRef[dropItemIndex];\n\t} else if (container instanceof FlexBox || container instanceof Table) {\n\t\tdraggedItemDomRef = container.getItems()[dropItemIndex].getDomRef() as HTMLElement;\n\t}\n\tif (draggedItemDomRef) {\n\t\tdraggedItemDomRef.setAttribute(\"tabindex\", \"0\");\n\t\tdraggedItemDomRef.focus();\n\t}\n};\n\n/**\n * Gets the index of the closest element in the Y direction within a grid container.\n * @param {GridContainer | FlexBox} container - The container (either GridContainer or FlexBox).\n * @param {number} currentIndex - The index of the current element.\n * @param {string} keyCode - The key code representing the direction (ArrowUp or ArrowDown).\n * @returns {number} The index of the closest element in the Y direction.\n */\n\nconst _getClosestElementYIndex = (container: GridContainer | FlexBox, currentIndex: number, keyCode: string) => {\n\tconst fnElementPositionX = function (element: HTMLElement) {\n\t\treturn element.getBoundingClientRect().x;\n\t};\n\n\tconst fnElementPositionY = function (element: HTMLElement) {\n\t\treturn element.getBoundingClientRect().y;\n\t};\n\n\tlet minIndex = currentIndex;\n\tlet minDistance = Number.MAX_SAFE_INTEGER;\n\tconst items = container.getItems().map((item) => item.getDomRef()) as HTMLElement[];\n\titems.forEach(function (item, index) {\n\t\tconst currentDist = Math.sqrt(\n\t\t\tMath.pow(fnElementPositionX(items[currentIndex]) - fnElementPositionX(item), 2) +\n\t\t\t\tMath.pow(fnElementPositionY(items[currentIndex]) - fnElementPositionY(item), 2)\n\t\t);\n\t\tconst isAllowed = (keyCode === \"ArrowDown\" && index > currentIndex) || (keyCode === \"ArrowUp\" && index < currentIndex);\n\t\tif (isAllowed && currentDist < minDistance && fnElementPositionY(item) !== fnElementPositionY(items[currentIndex])) {\n\t\t\tminDistance = currentDist;\n\t\t\tminIndex = index;\n\t\t}\n\t});\n\treturn minIndex;\n};\n\nconst setTabIndexForItems = (aItems: HTMLElement[], currentIndex: number) => {\n\taItems.forEach((x, index) => {\n\t\tx.tabIndex = index === currentIndex ? 0 : -1;\n\t});\n};\n"],"mappings":"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","ignoreList":[]}