{"version":3,"file":"AppManager.js","names":["sap","ui","define","Log","ResourceBundle","VersionInfo","BaseObject","ODataModelV2","Config","Container","___AnalyticalCardSkeleton","___Constants","___DataFormatUtils","__HttpHelper","__RecommendedCardUtil","_interopRequireDefault","obj","__esModule","default","_iteratorSymbol","Symbol","iterator","_settle","pact","state","value","s","_Pact","v","o","bind","then","observer","prototype","onFulfilled","onRejected","result","this","callback","e","_this","_isSettledPact","thenable","_forTo","array","body","check","i","reject","_cycle","length","AnalyticalCardSkeleton","_forOf","target","step","next","done","return","_fixup","TypeError","values","push","COLUMN_LENGTH","_catch","recover","DEFAULT_BG_COLOR","FALLBACK_ICON","MYHOME_PAGE_ID","MYHOME_SPACE_ID","MYINSIGHT_SECTION_ID","RECOMMENDATION_SRVC_URL","RECOMMENDED_CARD_LIMIT","createBookMarkData","getLeanURL","HttpHelper","RecommendedCardUtil","CONSTANTS","MUST_INCLUDE_RECOMMEDED_APPS","_parseSBParameters","oParam","oParsedParams","JSON","parse","oError","error","Error","message","String","undefined","_getTileProperties","vizConfigFLP","oTileProperties","_instantiationData","chip","configuration","oConfig","tileConfiguration","oTileConfig","TILE_PROPERTIES","_getAppId","sAppId","semanticObject","action","semanticAction","_getTargetUrl","sTargetURL","evaluationId","_isSmartBusinessTile","oVisualization","vizType","startsWith","_getAppTitleSubTitle","oApp","oAppTileInfo","bags","sb_tileProperties","texts","title","subtitle","description","_linkDuplicateVizs","aVizs","forEach","oDuplicateViz","filter","oViz","appId","visualization","id","persConfig","sectionIndex","duplicateApps","_isGUIVisualization","parameters","_isMustIncludeRecommendation","recViz","fioriId","includes","_isVisualizationAlreadyAdded","favoriteVisualizations","some","favViz","AppManager","aRequestQueue","bInsightsSectionPresent","vizDataModified","_oVizCacheData","_favPageVisualizations","componentData","fioriAppData","constructor","super","recommendedUtilInstance","getInstance","Instance","_fetchRequestFromQueue","bForceRefresh","pageId","Promise","resolve","getServiceAsync","oSpaceContentService","oPageLoadPromise","oRequestedPage","find","oRequest","getPage","pageLoadPromise","_fetchDynamicVizs","fetchFavVizs","aFavApps","oDynApp","isCount","isSmartBusinessTile","_getSections","_this2","oPage","aSections","sections","iRecentAppSectionIndex","findIndex","oSection","_temp2","_temp","_oMoveAppsPromise","moveSection","_fetchPageVizs","_this3","oVizInstantiationService","iSectionIndex","visualizations","iVisualizationIndex","vizConfig","oVizInfo","oldAppId","targetURL","url","leanURL","BGColor","key","isFav","isSection","icon","icons","indicatorDataSource","path","contentProviderId","instantiateVisualization","setActive","vizInstance","sectionTitle","sectionId","visualizationIndex","isDefaultSection","isPresetSection","preset","_copyDynamicVizs","_this4","aDynamicVizs","all","map","oDynViz","addVisualization","vizId","bPreventGrouping","_this5","aMyHomeVizs","aVisibleFavVizs","_filterDuplicateVizs","_addGroupInformation","fetchInsightApps","sSectionTitle","_this6","_temp5","fnFetchInsightsApps","_temp4","insightsSectionIndex","_temp3","last","addSection","sectionProperties","visualizationId","spaceContentService","removeVisualizations","vizIds","_this7","_temp7","targetSection","_temp6","deleteVisualization","updateVisualizations","sourceSectionIndex","sourceVisualizationIndex","oVisualizationData","updateVisualization","createInsightSection","_exit","_this8","_temp9","_result","_temp8","iMyInsightSectionIndex","_this8$addSection","visible","mProperties","getSectionVisualizations","forceRefresh","_this9","aApps","apps","addBookMark","bookmark","moveConfig","_this0","oBookmarkService","getContentNodes","aContentNodes","oMyHomeSpace","contentNode","children","addBookmark","moveVisualization","getVisualization","_this1","sectionVisualizations","sectionVisualization","_this10","targetSectionIndex","targetVisualizationIndex","aVisibleFavoriteVizs","bReturnDuplicateVizs","iVizIndex","iFirstIndex","oTempApp","aFavoriteVizs","aRecentVizs","oExistingSection","index","badge","toString","oPagesService","iPageIndex","getPageIndex","isURLParamEnabled","param","urlParams","URLSearchParams","window","location","search","get","toLowerCase","_getRecommenedFioriIds","_exit2","_this11","_temp1","_result3","recommendedFioriIds","_temp0","GetJSON","_HttpHelper$GetJSON","response","app_id","_Promise$resolve","_getCatalogApps","_exit3","_this12","_temp12","_result4","catalogAppData","_temp11","SearchableContent","getApps","includeAppsWithoutVisualizations","_this12$catalogAppDat","_temp10","isAddCardToInsightsHidden","page","component","settings","tableSettings","addCardtoInsightsHidden","_checkValidManifests","manifest","dataSources","hasRequiredDataSource","mainService","pages","Array","isArray","_isListReport","pageValues","Object","_getOdataModel","oManifest","datasource","annotationUrls","annotations","name","uri","Boolean","oDataModel","annotationURI","loadAnnotationsJoined","attachMetadataLoaded","attachMetadataFailed","_getEntitySet","entitySet","loadI18n","manifestUrl","_this13","_temp14","_RBManifestMap","absoluteUrl","i18nBundleUrl","URL","href","_temp13","create","bundleUrl","async","terminologies","oResourceBundle","getI18nValueOrDefaultString","sValue","oRB","sPath","substring","getText","_getAnalyticalCardManifest","stringify","getProcessedManifest","metaModel","manifestObj","parentApp","versionInfo","_this14","_temp17","_createCardManifest","cardInput","suppressRowNavigation","mainEntitySetName","mainEntitySet","getODataEntitySet","lineItemDetails","getLineItemDetails","lineItem","entitySetName","entityType","getODataEntityType","lrSettings","hasMandatoryProperties","property","parameterDetails","_getParametersisedEntitySetParams","paramEntitySet","_getManifestCardData","columns","headerInfo","cardTitle","TypeNamePlural","_temp16","i18n","appTitle","_temp15","i18nResourceBundle","fetchMetaModels","validManifests","_this15","odataPromises","_this15$_getOdataMode","getMetaModel","combineManifestsAndMetaModels","aMetaModel","reduce","combined","processManifests","combinedDetails","aCSTR","_this16","item","resolutionResult","ui5ComponentName","processAppList","aList","aAppComponentIds","aComponent","list","oComponent","oData","matchingData","entry","_getCardManifest","_this17","getFioriAppData","aCatalog","aFioriData","load","_VersionInfo$load","flat","processedList","fetchManifests","manifests","cards","card","appIdList","fioriData","catalogData","appPromises","_exit4","aApp","_temp18","catalog","applicationDependencies","fetch","json","_response$json","_url$manifest","_result6","results","_removeDuplicateCards","aCards","oCardDict","aResult","oCard","sCardTitle","descriptorContent","header","getRecommenedCards","_this18","aAppIds","aManifests","aRecManifests","slice","aRecommendedCards","rec","getRecommendedVisualizations","_this19","_temp21","_recommendedVisualizations","_temp20","_temp19","finalRecommendations","mustIncludeRecommendations","_getVisualizationsByFioriIds","recommendedVisualizations","concat","_getInboundApps","service","_oAdapter","_aInbounds","_this20","_temp23","_temp22","keys","inbounds","oItem","signature","defaultValue","componentId","semanticData","combinedData","fioriIds","_this21","visitedVisualizations","Map","catalogApps","authorizedApps","inbound","app","matchingVizualizations","catalogApp","guiVisualizations","matchingVizualization","nonGuiVisualizations","recommendedVisualization","has","set","_getAllFavPageApps","shouldReload","_exit5","_this22","_temp25","_result7","_temp24","loadedPages","pageIDs","pageIds","shouldLoadMissingApps","every","_this22$_favPageVisua","_loadAllPageVisualizations","_this22$_loadAllPageV","_this22$_favPageVisua2","shouldFetchDistinctApps","_this23","getBgColor","favPageVisualizations","loadPages","aPages","section","oVizApp","_this24"],"sources":["AppManager.ts"],"sourcesContent":["/*!\n * SAP UI development toolkit for HTML5 (SAPUI5)\n *  * (c) Copyright 2009-2025 SAP SE. All rights reserved\n */\n\nimport Log from \"sap/base/Log\";\nimport ResourceBundle from \"sap/base/i18n/ResourceBundle\";\nimport VersionInfo from \"sap/ui/VersionInfo\";\nimport BaseObject from \"sap/ui/base/Object\";\nimport ODataMetaModel, { Property } from \"sap/ui/model/odata/ODataMetaModel\";\nimport ODataModelV2 from \"sap/ui/model/odata/v2/ODataModel\";\nimport Config from \"sap/ushell/Config\";\nimport Container from \"sap/ushell/Container\";\nimport Bookmark from \"sap/ushell/services/BookmarkV2\";\nimport ClientSideTargetResolution from \"sap/ushell/services/ClientSideTargetResolution\";\nimport SearchableContent, { AppData } from \"sap/ushell/services/SearchableContent\";\nimport SpaceContent from \"sap/ushell/services/SpaceContent\";\nimport VisualizationInstantiation from \"sap/ushell/services/VisualizationInstantiation\";\nimport {\n\tICustomVisualization,\n\tICustomVizInstance,\n\tIParseSBParameters,\n\tISection,\n\tISectionAndVisualization,\n\tIVisualization\n} from \"../interface/AppsInterface\";\nimport {\n\tIAppInfo,\n\tIAppInfoData,\n\tIAppManifest,\n\tICard,\n\tICardDetails,\n\tICardManifest,\n\tIEntitySet,\n\tIEntityType,\n\tIHeaderInfo,\n\tIPageType,\n\tIVersionInfo,\n\tPageRecord\n} from \"../interface/CardsInterface\";\nimport { IPage } from \"../interface/PageSpaceInterface\";\nimport { AnalyticalCardSkeleton } from \"./AnalyticalCardSkeleton\";\nimport {\n\tCOLUMN_LENGTH,\n\tDEFAULT_BG_COLOR,\n\tFALLBACK_ICON,\n\tMYHOME_PAGE_ID,\n\tMYHOME_SPACE_ID,\n\tMYINSIGHT_SECTION_ID,\n\tRECOMMENDATION_SRVC_URL,\n\tRECOMMENDED_CARD_LIMIT\n} from \"./Constants\";\nimport { createBookMarkData, getLeanURL } from \"./DataFormatUtils\";\nimport HttpHelper from \"./HttpHelper\";\nimport RecommendedCardUtil from \"./RecommendedCardUtil\";\n\nconst CONSTANTS = {\n\tMUST_INCLUDE_RECOMMEDED_APPS: [\"F0862\", \"F1823\"] //My Inbox and Manage Timesheet apps\n};\n\ninterface ICombinedManifestDetails {\n\tmanifest: IValidManifest;\n\tmetaModel: ODataMetaModel;\n}\n\ninterface IValidManifest {\n\turl: string;\n\tmanifest: IAppManifest;\n}\n\nexport interface IMoveConfig {\n\tsourceSectionIndex: number;\n\tsourceVisualizationIndex: number;\n\ttargetSectionIndex: number;\n\ttargetVisualizationIndex: number;\n}\n\nconst _parseSBParameters = (oParam: object | string | undefined): IParseSBParameters | undefined => {\n\tlet oParsedParams: IParseSBParameters | undefined = {};\n\tif (oParam) {\n\t\tif (typeof oParam === \"object\") {\n\t\t\toParsedParams = oParam;\n\t\t} else {\n\t\t\ttry {\n\t\t\t\toParsedParams = JSON.parse(oParam) as object;\n\t\t\t} catch (oError) {\n\t\t\t\tLog.error(oError instanceof Error ? oError.message : String(oError));\n\t\t\t\toParsedParams = undefined;\n\t\t\t}\n\t\t}\n\t}\n\treturn oParsedParams;\n};\n\nconst _getTileProperties = (vizConfigFLP?: IVisualization): IParseSBParameters | undefined => {\n\tlet oTileProperties: IParseSBParameters | undefined = {};\n\tif (vizConfigFLP?._instantiationData?.chip?.configuration) {\n\t\tconst oConfig: IParseSBParameters | undefined = _parseSBParameters(vizConfigFLP._instantiationData.chip.configuration);\n\t\tif (oConfig?.tileConfiguration) {\n\t\t\tconst oTileConfig: IParseSBParameters | undefined = _parseSBParameters(oConfig.tileConfiguration);\n\t\t\tif (oTileConfig) {\n\t\t\t\toTileProperties = _parseSBParameters(oTileConfig.TILE_PROPERTIES);\n\t\t\t}\n\t\t}\n\t}\n\treturn oTileProperties;\n};\n\nconst _getAppId = (vizConfigFLP: IVisualization | undefined): string => {\n\tlet sAppId = \"\";\n\tlet oTileProperties: IParseSBParameters | undefined = {};\n\tif (vizConfigFLP?.target?.semanticObject && vizConfigFLP?.target?.action) {\n\t\tsAppId = `#${vizConfigFLP.target.semanticObject}-${vizConfigFLP.target.action}`;\n\t} else if (vizConfigFLP?._instantiationData?.chip?.configuration) {\n\t\toTileProperties = _getTileProperties(vizConfigFLP);\n\t\tif (oTileProperties?.semanticObject && oTileProperties?.semanticAction) {\n\t\t\tsAppId = `#${oTileProperties?.semanticObject}-${oTileProperties?.semanticAction}`;\n\t\t}\n\t}\n\treturn sAppId;\n};\n\nconst _getTargetUrl = (vizConfigFLP: IVisualization | undefined) => {\n\tlet sTargetURL = _getAppId(vizConfigFLP) || \"\";\n\tconst oTileProperties = _getTileProperties(vizConfigFLP);\n\tif (oTileProperties?.evaluationId) {\n\t\tsTargetURL += \"?EvaluationId=\" + oTileProperties.evaluationId;\n\t}\n\treturn sTargetURL;\n};\n\nconst _isSmartBusinessTile = (oVisualization: IVisualization): boolean => {\n\treturn oVisualization.vizType?.startsWith(\"X-SAP-UI2-CHIP:SSB\");\n};\n\n// get App Title in case of value not present at root level\nconst _getAppTitleSubTitle = (oApp: IVisualization, vizConfigFLP: IVisualization): { title: string; subtitle: string } => {\n\tconst oAppTileInfo = vizConfigFLP?._instantiationData?.chip?.bags?.sb_tileProperties?.texts;\n\treturn {\n\t\ttitle: oApp.title ? oApp.title : oAppTileInfo?.title || \"\",\n\t\tsubtitle: oApp.subtitle ? oApp.subtitle : oAppTileInfo?.description || \"\"\n\t};\n};\n\n/**\n * Link Duplicate Visualizations to a single visualization\n *\n * @param {object[]} aVizs - array of visualizations\n * @returns {object[]} arry of visualizations after linking duplicate visualizations\n * @private\n */\nconst _linkDuplicateVizs = (aVizs: ICustomVisualization[]) => {\n\taVizs.forEach((oDuplicateViz) => {\n\t\taVizs\n\t\t\t.filter(\n\t\t\t\t(oViz) =>\n\t\t\t\t\toViz.appId === oDuplicateViz.appId &&\n\t\t\t\t\toViz?.visualization?.id !== oDuplicateViz?.visualization?.id &&\n\t\t\t\t\toViz.persConfig?.sectionIndex === oDuplicateViz.persConfig?.sectionIndex\n\t\t\t)\n\t\t\t.forEach((oViz) => {\n\t\t\t\toViz?.persConfig?.duplicateApps?.push(oDuplicateViz);\n\t\t\t});\n\t});\n\n\treturn aVizs;\n};\n\nconst _isGUIVisualization = (visualization: AppData) => {\n\treturn visualization?.target?.parameters?.[\"sap-ui-tech-hint\"]?.value?.value === \"GUI\";\n};\n\nconst _isMustIncludeRecommendation = (recViz: ICustomVisualization) => {\n\treturn recViz.fioriId && CONSTANTS.MUST_INCLUDE_RECOMMEDED_APPS.includes(recViz.fioriId);\n};\n\nconst _isVisualizationAlreadyAdded = (visualization: ICustomVisualization, favoriteVisualizations: ICustomVisualization[]) => {\n\treturn !favoriteVisualizations.some(\n\t\t(favViz) =>\n\t\t\tfavViz.visualization?.target?.semanticObject === visualization.visualization?.target?.semanticObject &&\n\t\t\tfavViz.visualization?.target?.action === visualization.visualization?.target?.action\n\t);\n};\n\n/**\n *\n * @class Provides the AppManager Class used for fetch and process user apps.\n *\n * @extends sap.ui.BaseObject\n *\n * @author SAP SE\n * @version 0.0.1\n * @since 1.121.0\n * @private\n *\n * @alias sap.cux.home.util.AppManager\n */\n\nexport default class AppManager extends BaseObject {\n\tprivate aRequestQueue: { pageId: string; pageLoadPromise: Promise<IPage> }[] = [];\n\tprivate _oMoveAppsPromise!: Promise<void>;\n\tprivate bInsightsSectionPresent: boolean = false;\n\tpublic insightsSectionIndex!: number;\n\tstatic Instance: AppManager;\n\tprivate recommendedFioriIds!: string[];\n\tprivate versionInfo!: IVersionInfo;\n\tprivate _RBManifestMap!: Record<string, ResourceBundle>;\n\tprivate _recommendedVisualizations!: ICustomVisualization[];\n\tprivate vizDataModified: boolean = false;\n\tprivate _oVizCacheData: { [key: string]: ICustomVizInstance } = {};\n\tprivate _favPageVisualizations: ICustomVisualization[] = [];\n\tprivate componentData: IAppInfo = {};\n\tprivate fioriAppData: IAppInfo = {};\n\tprivate recommendedUtilInstance: RecommendedCardUtil;\n\tprivate catalogAppData!: Promise<AppData[]> | undefined;\n\n\tprivate constructor() {\n\t\tsuper();\n\t\tthis.recommendedUtilInstance = RecommendedCardUtil.getInstance();\n\t}\n\n\tstatic getInstance() {\n\t\tif (!AppManager.Instance) {\n\t\t\tAppManager.Instance = new AppManager();\n\t\t}\n\t\treturn AppManager.Instance;\n\t}\n\t/**\n\t * Returns page load promise from the request queue if it exists, adds it to the queue if it doesn't\n\t *\n\t * @param {string} sPageId - page id\n\t * @param {boolean} bForceRefresh - force reload of data if true\n\t * @returns {Promise} - returns a promise which resolves with the requested page data\n\t * @private\n\t */\n\tprivate async _fetchRequestFromQueue(bForceRefresh: boolean, pageId: string = MYHOME_PAGE_ID): Promise<IPage> {\n\t\tconst oSpaceContentService = await Container.getServiceAsync<SpaceContent>(\"SpaceContent\");\n\t\tlet oPageLoadPromise: Promise<IPage>;\n\t\tthis.aRequestQueue = this.aRequestQueue || [];\n\n\t\t//Check if request already exists in the queue, if not add it\n\t\tconst oRequestedPage = this.aRequestQueue.find((oRequest) => oRequest.pageId === pageId);\n\t\tif (!oRequestedPage || bForceRefresh === true || this.vizDataModified === true) {\n\t\t\tthis.vizDataModified = false;\n\t\t\toPageLoadPromise = oSpaceContentService.getPage(pageId);\n\t\t\tif (oRequestedPage) {\n\t\t\t\toRequestedPage.pageLoadPromise = oPageLoadPromise;\n\t\t\t} else {\n\t\t\t\tthis.aRequestQueue.push({\n\t\t\t\t\tpageId: pageId,\n\t\t\t\t\tpageLoadPromise: oPageLoadPromise\n\t\t\t\t});\n\t\t\t}\n\t\t} else {\n\t\t\toPageLoadPromise = oRequestedPage.pageLoadPromise;\n\t\t}\n\n\t\treturn oPageLoadPromise;\n\t}\n\t/**\n\t * Returns all dynamic visualizations present in MyHome page\n\t *\n\t * @param {boolean} bForceRefresh - force reload of visualizations data\n\t * @returns {Promise} - resolves to array of all dynamic visualizations in MyHome page\n\t * @private\n\t */\n\tprivate _fetchDynamicVizs(bForceRefresh: boolean) {\n\t\treturn this.fetchFavVizs(bForceRefresh, true).then((aFavApps: ICustomVisualization[]) =>\n\t\t\taFavApps.filter((oDynApp) => oDynApp.isCount || oDynApp.isSmartBusinessTile)\n\t\t);\n\t}\n\t/**\n\t * Returns all the sections that are available in the MyHome page\n\t *\n\t * @param {boolean} bForceRefresh - force reload of visualizations data\n\t * @returns {Promise} - resolves to array of all sections available in MyHome page\n\t * @private\n\t */\n\tpublic async _getSections(bForceRefresh: boolean = false, pageId: string = MYHOME_PAGE_ID): Promise<ISection[]> {\n\t\tconst oPage: IPage = await this._fetchRequestFromQueue(bForceRefresh, pageId);\n\t\tconst aSections = (oPage && oPage.sections) || [],\n\t\t\tiRecentAppSectionIndex: number = aSections.findIndex((oSection) => oSection.default);\n\t\tif (iRecentAppSectionIndex > 0) {\n\t\t\tif (this._oMoveAppsPromise === undefined) {\n\t\t\t\tthis._oMoveAppsPromise = this.moveSection(iRecentAppSectionIndex, 0);\n\t\t\t\tawait this._oMoveAppsPromise;\n\t\t\t}\n\t\t\treturn this._getSections(true);\n\t\t} else {\n\t\t\treturn aSections;\n\t\t}\n\t}\n\t/**\n\t * Models and returns all visualizations available in MyHome page\n\t *\n\t * @param {bool} bForceRefresh - force reload of visualizations data\n\t * @returns {Promise} - resolves to array of all apps available in MyHome page\n\t * @private\n\t */\n\tprivate async _fetchPageVizs(bForceRefresh: boolean, pageId: string = MYHOME_PAGE_ID): Promise<ICustomVisualization[]> {\n\t\tconst aVizs: ICustomVisualization[] = [];\n\t\tthis._oVizCacheData = this._oVizCacheData || {};\n\t\tconst aSections = await this._getSections(bForceRefresh, pageId);\n\t\tconst oVizInstantiationService = await Container.getServiceAsync<VisualizationInstantiation>(\"VisualizationInstantiation\");\n\t\taSections.forEach((oSection: ISection, iSectionIndex: number) => {\n\t\t\toSection?.visualizations?.forEach((oVisualization: IVisualization, iVisualizationIndex: number) => {\n\t\t\t\tconst vizConfig = oVisualization.vizConfig,\n\t\t\t\t\toVizInfo = vizConfig?.[\"sap.app\"] || ({ title: \"?\" } as IVisualization),\n\t\t\t\t\toViz = {} as ICustomVisualization;\n\n\t\t\t\toViz.oldAppId = _getAppId(vizConfig?.[\"sap.flp\"]);\n\t\t\t\toViz.appId = oVisualization?.targetURL; // Using targetURL as unique identifier as in certian scenario vizConfig can be empty.\n\t\t\t\toViz.url = oVisualization?.targetURL;\n\t\t\t\tif (!oViz.url && _isSmartBusinessTile(oVisualization)) {\n\t\t\t\t\toViz.url = _getTargetUrl(vizConfig?.[\"sap.flp\"]);\n\t\t\t\t}\n\t\t\t\toViz.leanURL = getLeanURL(oViz.url);\n\t\t\t\toViz.title = oVisualization?.title || _getAppTitleSubTitle(oVizInfo, oVisualization)?.title;\n\t\t\t\toViz.subtitle = oVisualization.subtitle || _getAppTitleSubTitle(oVizInfo, oVisualization).subtitle;\n\t\t\t\toViz.BGColor = DEFAULT_BG_COLOR().key;\n\t\t\t\toViz.isFav = true;\n\t\t\t\toViz.isSection = false;\n\t\t\t\toViz.pageId = pageId;\n\t\t\t\toViz.icon = vizConfig?.[\"sap.ui\"]?.icons?.icon || FALLBACK_ICON;\n\t\t\t\tif (oVisualization?.indicatorDataSource) {\n\t\t\t\t\toViz.isCount = true;\n\t\t\t\t\toViz.indicatorDataSource = oVisualization.indicatorDataSource.path;\n\t\t\t\t\toViz.contentProviderId = oVisualization.contentProviderId;\n\t\t\t\t}\n\t\t\t\toViz.isSmartBusinessTile = _isSmartBusinessTile(oVisualization);\n\t\t\t\tif (oViz.isSmartBusinessTile) {\n\t\t\t\t\tif (!this._oVizCacheData[oViz.appId]) {\n\t\t\t\t\t\tthis._oVizCacheData[oViz.appId] = oVizInstantiationService.instantiateVisualization(\n\t\t\t\t\t\t\toVisualization\n\t\t\t\t\t\t) as ICustomVizInstance;\n\t\t\t\t\t\tthis._oVizCacheData[oViz.appId].setActive(true);\n\t\t\t\t\t}\n\t\t\t\t\toViz.vizInstance = this._oVizCacheData[oViz.appId];\n\t\t\t\t}\n\t\t\t\t// Add FLP Personalization Config\n\t\t\t\toViz.persConfig = {\n\t\t\t\t\tpageId: MYHOME_PAGE_ID,\n\t\t\t\t\tsectionTitle: oSection.title,\n\t\t\t\t\tsectionId: oSection.id,\n\t\t\t\t\tsectionIndex: iSectionIndex,\n\t\t\t\t\tvisualizationIndex: iVisualizationIndex,\n\t\t\t\t\tisDefaultSection: oSection.default,\n\t\t\t\t\tisPresetSection: oSection.preset,\n\t\t\t\t\tduplicateApps: []\n\t\t\t\t};\n\t\t\t\toViz.visualization = oVisualization;\n\t\t\t\t// Title and Subtitle in visualization are required in Insights Dialog.\n\t\t\t\toViz.visualization.title = oViz.title;\n\t\t\t\toViz.visualization.subtitle = oViz.subtitle;\n\t\t\t\taVizs.push(oViz);\n\t\t\t});\n\t\t});\n\t\treturn aVizs;\n\t}\n\t/**\n\t * Copies all Dynamic visualizations to Insights section\n\t *\n\t * @returns {Promise} - resolves to void and copy all the visualizations\n\t * @private\n\t */\n\tprivate async _copyDynamicVizs() {\n\t\tconst aDynamicVizs: ICustomVisualization[] = await this._fetchDynamicVizs(true);\n\t\treturn Promise.all(\n\t\t\taDynamicVizs.map((oDynViz: ICustomVisualization) => {\n\t\t\t\treturn this.addVisualization(oDynViz.visualization!.vizId, MYINSIGHT_SECTION_ID);\n\t\t\t})\n\t\t);\n\t}\n\t/**\n\t * Returns a list of all favorite vizualizations in MyHome page\n\t *\n\t * @param {boolean} bForceRefresh - force reload of vizualizations data\n\t * @param {boolean} bPreventGrouping - prevent vizualizations grouping\n\t * @returns {Promise} - resolves to array of favourite vizualizations in MyHome page\n\t * @private\n\t */\n\tpublic async fetchFavVizs(\n\t\tbForceRefresh: boolean,\n\t\tbPreventGrouping?: boolean,\n\t\tpageId: string = MYHOME_PAGE_ID\n\t): Promise<ISectionAndVisualization[]> {\n\t\tconst aMyHomeVizs = await this._fetchPageVizs(bForceRefresh, pageId);\n\t\tconst aVisibleFavVizs = aMyHomeVizs.filter(\n\t\t\t(oViz) => oViz.persConfig && oViz.persConfig.sectionId !== MYINSIGHT_SECTION_ID && oViz.url && oViz.title\n\t\t);\n\n\t\tif (bPreventGrouping) {\n\t\t\treturn this._filterDuplicateVizs(_linkDuplicateVizs(aVisibleFavVizs), false);\n\t\t} else {\n\t\t\treturn this._addGroupInformation(aVisibleFavVizs);\n\t\t}\n\t}\n\t/**\n\t * Returns all vizualizations present in the Insights Section\n\t *\n\t * @param {boolean} bForceRefresh - force reload insights vizualizations data\n\t * @param {string} sSectionTitle - optional, title of insights section to be used while creating insights section\n\t * @returns {Promise} - resolves to an array with all vizualizations in Insights section\n\t */\n\tpublic async fetchInsightApps(bForceRefresh: boolean, sSectionTitle: string) {\n\t\tconst fnFetchInsightsApps = async () => {\n\t\t\tconst aVizs = await this._fetchPageVizs(bForceRefresh);\n\t\t\treturn aVizs.filter((oViz) => oViz.persConfig?.sectionId === MYINSIGHT_SECTION_ID && oViz.url && oViz.title);\n\t\t};\n\n\t\tif (!this.bInsightsSectionPresent) {\n\t\t\tconst aSections: ISection[] = await this._getSections(bForceRefresh);\n\t\t\tthis.insightsSectionIndex = aSections.findIndex(function (oSection) {\n\t\t\t\treturn oSection.id === MYINSIGHT_SECTION_ID;\n\t\t\t});\n\n\t\t\tif (\n\t\t\t\tthis.insightsSectionIndex === -1 &&\n\t\t\t\t(Config.last(\"/core/shell/enablePersonalization\") || Config.last(\"/core/catalog/enabled\")) &&\n\t\t\t\tthis.bInsightsSectionPresent === false\n\t\t\t) {\n\t\t\t\tthis.bInsightsSectionPresent = true;\n\t\t\t\tawait this.addSection({\n\t\t\t\t\tsectionIndex: aSections?.length,\n\t\t\t\t\tsectionProperties: {\n\t\t\t\t\t\tid: MYINSIGHT_SECTION_ID,\n\t\t\t\t\t\ttitle: sSectionTitle\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t\tawait this._copyDynamicVizs();\n\t\t\t} else {\n\t\t\t\tthis.bInsightsSectionPresent = true;\n\t\t\t}\n\t\t}\n\n\t\treturn await fnFetchInsightsApps();\n\t}\n\n\t/**\n\t * Add visualization to a particular section\n\t *\n\t * @param {string} visualizationId - The id of the visualization to add.\n\t * @param {string} sectionId - The id of the section the visualization should be added to (optional parameter)\n\t * @returns {Promise} resolves to void after adding app to a section\n\t * @private\n\t */\n\tpublic async addVisualization(visualizationId: string, sectionId: string | undefined = undefined): Promise<void> {\n\t\tconst spaceContentService = await Container.getServiceAsync<SpaceContent>(\"SpaceContent\");\n\t\tawait spaceContentService.addVisualization(MYHOME_PAGE_ID, sectionId, visualizationId);\n\t}\n\n\t/**\n\t * @param {object} mProperties - map of properties\n\t * @param {string} mProperties.sectionId - section id from which visualizations should be removed\n\t * @param {object[]} mProperties.appIds - array of url of visualizations that has to be deleted\n\t * @param {boolean} mProperties.ignoreDuplicateApps - if true doesn't remove the duplicate apps, else removes the duplicate apps as well\n\t * @private\n\t * @returns {Promise} resolves after all visualizations are deleted\n\t */\n\tpublic async removeVisualizations({ sectionId, vizIds }: { sectionId: string; vizIds: string[] }) {\n\t\tconst spaceContentService = await Container.getServiceAsync<SpaceContent>(\"SpaceContent\");\n\t\tfor (const vizId of vizIds) {\n\t\t\tconst sections = await this._getSections(true);\n\t\t\tconst sectionIndex = sections.findIndex((oSection) => oSection.id === sectionId);\n\t\t\tconst targetSection = sectionIndex > -1 ? sections[sectionIndex] : null;\n\t\t\tconst visualizationIndex = targetSection?.visualizations?.findIndex((oVisualization) => oVisualization.id === vizId) ?? -1;\n\t\t\tif (visualizationIndex > -1) {\n\t\t\t\tawait spaceContentService.deleteVisualization(MYHOME_PAGE_ID, sectionIndex, visualizationIndex);\n\t\t\t}\n\t\t}\n\t}\n\n\t/**\n\t * @param {object} mProperties - map of properties\n\t * @param {string} mProperties.pageId - page id from which visualizations should be updated\n\t * @param {object[]} mProperties.sourceSectionIndex - section index in which visualization that has to be updated\n\t * @param {boolean} mProperties.sourceVisualizationIndex - visualization index in the which should be updated\n\t * @param {boolean} mProperties.oVisualizationData - visualization data which will be updated for the vizualisation\n\t * @private\n\t * @returns {Promise} resolves to void\n\t */\n\tpublic async updateVisualizations({\n\t\tpageId,\n\t\tsourceSectionIndex,\n\t\tsourceVisualizationIndex,\n\t\toVisualizationData\n\t}: {\n\t\tpageId: string;\n\t\tsourceSectionIndex: number;\n\t\tsourceVisualizationIndex: number;\n\t\toVisualizationData: { displayFormatHint: string };\n\t}) {\n\t\tconst spaceContentService = await Container.getServiceAsync<SpaceContent>(\"SpaceContent\");\n\t\treturn spaceContentService.updateVisualization(pageId, sourceSectionIndex, sourceVisualizationIndex, oVisualizationData);\n\t}\n\n\t/**\n\t * Create Insight Section if not already present\n\t *\n\t * @param {string} sSectionTitle - optional, section title\n\t * @returns {Promise} - resolves to insight section created\n\t */\n\tpublic async createInsightSection(sSectionTitle: string) {\n\t\tif (!this.bInsightsSectionPresent) {\n\t\t\tconst aSections = await this._getSections();\n\t\t\tconst iMyInsightSectionIndex = aSections.findIndex(function (oSection) {\n\t\t\t\treturn oSection.id === MYINSIGHT_SECTION_ID;\n\t\t\t});\n\n\t\t\t//check if myinsight section exists, if not create one\n\t\t\tif (\n\t\t\t\tiMyInsightSectionIndex === -1 &&\n\t\t\t\t(Config.last(\"/core/shell/enablePersonalization\") || Config.last(\"/core/catalog/enabled\"))\n\t\t\t) {\n\t\t\t\treturn this.addSection({\n\t\t\t\t\tsectionIndex: aSections.length,\n\t\t\t\t\tsectionProperties: {\n\t\t\t\t\t\tid: MYINSIGHT_SECTION_ID,\n\t\t\t\t\t\ttitle: sSectionTitle,\n\t\t\t\t\t\tvisible: true\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\n\t\treturn Promise.resolve();\n\t}\n\n\t/**\n\t * Adds a section\n\t *\n\t * @param {object} mProperties - map of properties\n\t * @param {string} mProperties.sectionIndex - section index\n\t * @param {object} mProperties.sectionProperties - section properties\n\t * @returns {Promise} resolves to void and creates the section\n\t * @private\n\t */\n\tpublic async addSection(mProperties: ISection) {\n\t\tconst { sectionIndex, sectionProperties } = mProperties;\n\t\tconst oSpaceContentService = await Container.getServiceAsync<SpaceContent>(\"SpaceContent\");\n\t\tawait oSpaceContentService.addSection(MYHOME_PAGE_ID, sectionIndex, {\n\t\t\t...sectionProperties,\n\t\t\tvisible: true\n\t\t});\n\t}\n\n\t/**\n\t * Returns visualizations for a given section\n\t * @param {string} sectionId - section id\n\t * @param {boolean} [forceRefresh=false] - force reload of data if true\n\t * @returns {Promise} resolves to array of visualizations\n\t * @private\n\t */\n\tpublic async getSectionVisualizations(\n\t\tsectionId?: string,\n\t\tforceRefresh = false,\n\t\tpageId: string = MYHOME_PAGE_ID\n\t): Promise<ICustomVisualization[]> {\n\t\tconst aApps: ISectionAndVisualization[] = await this.fetchFavVizs(forceRefresh, false, pageId);\n\t\tif (sectionId) {\n\t\t\treturn aApps.find((oViz) => oViz.isSection && oViz.id === sectionId)?.apps || [];\n\t\t} else {\n\t\t\treturn aApps.filter((oViz) => !oViz.isSection); //return recently added apps\n\t\t}\n\t}\n\n\t/**\n\t * Adds a bookmark.\n\t * @private\n\t * @param {Object} bookmark - The bookmark data object.\n\t * @returns {Promise<void>} - A Promise that resolves once the bookmark is added.\n\t */\n\tpublic async addBookMark(bookmark: IVisualization, moveConfig?: IMoveConfig) {\n\t\tconst oBookmarkService: Bookmark = await Container.getServiceAsync(\"BookmarkV2\");\n\t\tconst aContentNodes = await oBookmarkService.getContentNodes();\n\t\tconst oMyHomeSpace = aContentNodes.find((contentNode) => contentNode.id === MYHOME_SPACE_ID);\n\t\tconst contentNode = oMyHomeSpace?.children?.find((contentNode) => contentNode.id === MYHOME_PAGE_ID);\n\t\tawait oBookmarkService.addBookmark(createBookMarkData(bookmark), contentNode);\n\t\tif (moveConfig) {\n\t\t\treturn this.moveVisualization(moveConfig);\n\t\t}\n\t\treturn Promise.resolve();\n\t}\n\n\t/**\n\t * Retrieves the visualization with the specified appId within the specified section.\n\t * @param {string} appId - appId of the visualization for.\n\t * @param {string} sectionId - The ID of the section containing the visualization.\n\t * @param {boolean} [forceRefresh=false] - Whether to force a refresh of the section's cache.\n\t * @returns {Promise<object|null>} A promise that resolves with the visualization object if found, or null if not found.\n\t * @private\n\t */\n\tpublic async getVisualization(appId: string, sectionId?: string, forceRefresh = false) {\n\t\tconst sectionVisualizations = await this.getSectionVisualizations(sectionId, forceRefresh);\n\t\treturn sectionVisualizations.find((sectionVisualization) => sectionVisualization.appId === appId);\n\t}\n\n\t/**\n\t * Moves a visualization from source section to target section.\n\t * @param {object} moveConfig - Configuration object containing details for moving the visualization.\n\t * @param {number} moveConfig.sourceSectionIndex - Index of the source section.\n\t * @param {number} moveConfig.sourceVisualizationIndex - Index of the visualization within the source section.\n\t * @param {number} moveConfig.targetSectionIndex - Index of the target section.\n\t * @param {number} moveConfig.targetVisualizationIndex - Index at which the visualization will be placed within the target section.\n\t * @returns {Promise<void>} A promise that resolves to void after the move operation.\n\t * @private\n\t */\n\tpublic async moveVisualization(moveConfig: {\n\t\tsourceSectionIndex: number;\n\t\tsourceVisualizationIndex: number;\n\t\ttargetSectionIndex: number;\n\t\ttargetVisualizationIndex: number;\n\t}) {\n\t\tconst spaceContentService = await Container.getServiceAsync<SpaceContent>(\"SpaceContent\");\n\t\tthis.vizDataModified = true;\n\t\treturn spaceContentService.moveVisualization(\n\t\t\tMYHOME_PAGE_ID,\n\t\t\tmoveConfig.sourceSectionIndex,\n\t\t\tmoveConfig.sourceVisualizationIndex,\n\t\t\tmoveConfig.targetSectionIndex,\n\t\t\tmoveConfig.targetVisualizationIndex\n\t\t);\n\t}\n\n\t/**\n\t * Filters out duplicate visualizations from a list of all visualizations\n\t *\n\t * @param {object[]} aVisibleFavoriteVizs - array containing list of all visualizations\n\t * @param {boolean} bReturnDuplicateVizs - flag when set to true, returns only the duplicate apps\n\t * @returns {object[]} filtered array of vizualisations\n\t * @private\n\t */\n\tpublic _filterDuplicateVizs(aVisibleFavoriteVizs: ICustomVisualization[], bReturnDuplicateVizs: boolean) {\n\t\treturn aVisibleFavoriteVizs.filter((oViz, iVizIndex, aVizs) => {\n\t\t\tconst iFirstIndex = aVizs.findIndex((oTempApp) => oTempApp.appId === oViz.appId);\n\t\t\treturn bReturnDuplicateVizs ? iFirstIndex !== iVizIndex : iFirstIndex === iVizIndex;\n\t\t});\n\t}\n\n\t/**\n\t * Add Grouping Information to visualizations list, and return concatenated list.\n\t *\n\t * @param {object[]} aFavoriteVizs - list of all favorite visualizations\n\t * @returns {object[]} - concatenated list contaning grouping information as well\n\t * @private\n\t */\n\tprivate _addGroupInformation(aFavoriteVizs: ICustomVisualization[]) {\n\t\tconst aRecentVizs: ICustomVisualization[] = [],\n\t\t\taSections: ISection[] = [];\n\t\tlet oExistingSection: ISection | undefined;\n\n\t\t_linkDuplicateVizs(aFavoriteVizs).forEach((oViz) => {\n\t\t\tif (oViz.persConfig?.isDefaultSection) {\n\t\t\t\taRecentVizs.push(oViz);\n\t\t\t} else {\n\t\t\t\toExistingSection = aSections.find((oSection) => oSection.isSection && oSection.id === oViz.persConfig?.sectionId);\n\n\t\t\t\tif (!oExistingSection) {\n\t\t\t\t\taSections.push({\n\t\t\t\t\t\tid: oViz.persConfig?.sectionId,\n\t\t\t\t\t\tindex: oViz.persConfig?.sectionIndex,\n\t\t\t\t\t\ttitle: oViz.persConfig?.sectionTitle || \"\",\n\t\t\t\t\t\tbadge: \"1\",\n\t\t\t\t\t\tBGColor: DEFAULT_BG_COLOR().key,\n\t\t\t\t\t\ticon: \"sap-icon://folder-full\",\n\t\t\t\t\t\tisSection: true,\n\t\t\t\t\t\tpageId: oViz.pageId,\n\t\t\t\t\t\tisPresetSection: oViz.persConfig?.isPresetSection,\n\t\t\t\t\t\tapps: [oViz]\n\t\t\t\t\t});\n\t\t\t\t} else {\n\t\t\t\t\toExistingSection.apps?.push(oViz);\n\t\t\t\t\toExistingSection.badge = oExistingSection.apps?.length.toString();\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\n\t\t//filter out duplicate apps only from recent apps list\n\t\treturn [...aSections, ...this._filterDuplicateVizs(aRecentVizs, false)];\n\t}\n\n\t/**\n\t * Move a section within a page\n\t *\n\t * @param {number} sourceSectionIndex - source index (previous index of the section in the page before move)\n\t * @param {number} targetSectionIndex - target index (desired index of the section in the page after move)\n\t * @returns {Promise} resolves to void  and moves the section to desired index within the page\n\t * @private\n\t */\n\tpublic async moveSection(sourceSectionIndex: number, targetSectionIndex: number): Promise<void> {\n\t\treturn Container.getServiceAsync(\"Pages\").then(function (oPagesService: {\n\t\t\tgetPageIndex: (id: string) => number;\n\t\t\tmoveSection: (index: number, sourceIndex: number, targetIndex: number) => void;\n\t\t}) {\n\t\t\tconst iPageIndex: number = oPagesService.getPageIndex(MYHOME_PAGE_ID);\n\t\t\treturn oPagesService.moveSection(iPageIndex, sourceSectionIndex, targetSectionIndex);\n\t\t} as () => void);\n\t}\n\n\t/**\n\t * Checks if a specific URL parameter is enabled (set to \"true\").\n\t *\n\t * @param {string} param - The name of the URL parameter to check.\n\t * @returns {boolean} `true` if the URL parameter exists and is set to \"true\" (case-insensitive), otherwise `false`.\n\t */\n\tpublic isURLParamEnabled(param: string): boolean {\n\t\tconst urlParams = new URLSearchParams(window.location.search);\n\t\treturn urlParams?.get(param)?.toLowerCase() === \"true\" || false;\n\t}\n\n\t/**\n\t * Fetch Recommended Fiori IDs\n\t *\n\t * @returns {Promise} resolves to array of recommended fiori ids\n\t * @private\n\t */\n\tprivate async _getRecommenedFioriIds(bForceRefresh: boolean = false): Promise<string[]> {\n\t\tif (!this.recommendedFioriIds || bForceRefresh) {\n\t\t\ttry {\n\t\t\t\tconst response = (await HttpHelper.GetJSON(RECOMMENDATION_SRVC_URL)) as {\n\t\t\t\t\terror: { message: string };\n\t\t\t\t\tvalue: Array<{ app_id: string }>;\n\t\t\t\t};\n\t\t\t\tthis.recommendedFioriIds =\n\t\t\t\t\tresponse?.value?.map((oApp) => {\n\t\t\t\t\t\treturn oApp.app_id;\n\t\t\t\t\t}) || [];\n\t\t\t} catch (error) {\n\t\t\t\tLog.error(\"Unable to load recommendations: \" + (error as Error).message);\n\t\t\t\treturn Promise.resolve([]);\n\t\t\t}\n\t\t}\n\t\treturn this.recommendedFioriIds;\n\t}\n\n\t/**\n\t * Fetch Catalog Apps\n\t *\n\t * @returns {Promise} resolves to array of Catalog Apps\n\t * @private\n\t */\n\tpublic async _getCatalogApps() {\n\t\tif (!this.catalogAppData) {\n\t\t\ttry {\n\t\t\t\tconst SearchableContent = await Container.getServiceAsync<SearchableContent>(\"SearchableContent\");\n\t\t\t\tthis.catalogAppData = SearchableContent.getApps({ includeAppsWithoutVisualizations: false });\n\t\t\t\treturn this.catalogAppData;\n\t\t\t} catch (error) {\n\t\t\t\tthis.catalogAppData = undefined;\n\t\t\t\tLog.error(error instanceof Error ? \"Error while fetching catalog apps:\" + error.message : String(error));\n\t\t\t\treturn [];\n\t\t\t}\n\t\t}\n\t\treturn Promise.resolve(this.catalogAppData);\n\t}\n\n\t/**\n\t * Checks whether page settings contains addCardtoInsightsHidden\n\t * @param {object} page - page object\n\t * @returns {boolean} returns boolean\n\t * @private\n\t */\n\tprivate isAddCardToInsightsHidden(page?: IPageType) {\n\t\treturn page?.component?.settings?.tableSettings?.addCardtoInsightsHidden;\n\t}\n\n\t/**\n\t * check Valid Manifests\n\t *\n\t * @returns {boolean} returns boolean\n\t * @private\n\t */\n\n\tprivate _checkValidManifests(manifest: IAppManifest): boolean {\n\t\tconst dataSources = manifest[\"sap.app\"]?.dataSources;\n\n\t\t// Ensure dataSources has the correct structure for `mainService`\n\t\tconst hasRequiredDataSource = manifest[\"sap.ui.generic.app\"] && dataSources?.mainService;\n\n\t\tif (!hasRequiredDataSource) {\n\t\t\treturn false;\n\t\t}\n\n\t\tconst pages = manifest[\"sap.ui.generic.app\"]?.pages;\n\t\t// if its not list report component or if listreport page settings has\n\t\t// isAddCardToInsightsHidden as true, then do not recommend the card\n\t\tif (Array.isArray(pages)) {\n\t\t\treturn this.recommendedUtilInstance._isListReport(pages[0]) && !this.isAddCardToInsightsHidden(pages[0]);\n\t\t}\n\n\t\tconst pageValues = Object.values(pages as PageRecord);\n\t\tif (pageValues.length > 0) {\n\t\t\treturn pageValues.some((page) => {\n\t\t\t\treturn (\n\t\t\t\t\ttypeof page === \"object\" && this.recommendedUtilInstance._isListReport(page) && !this.isAddCardToInsightsHidden(page)\n\t\t\t\t);\n\t\t\t});\n\t\t}\n\t\treturn false;\n\t}\n\n\t/**\n\t * Get OData Model\n\t *\n\t * @param {object} manifest - manifest object\n\t * @returns {ODataModelV2} returns OData Model\n\t * @private\n\t */\n\tprivate _getOdataModel(oManifest: IAppManifest): Promise<ODataModelV2> {\n\t\treturn new Promise(function (resolve) {\n\t\t\tconst datasource = oManifest?.[\"sap.app\"]?.dataSources;\n\t\t\tconst mainService = datasource?.mainService;\n\t\t\tlet annotationUrls: string[] = (mainService?.settings?.annotations || [])\n\t\t\t\t.map((name: string) => datasource?.[name]?.uri || \"\")\n\t\t\t\t.filter(Boolean);\n\n\t\t\tconst oDataModel = new ODataModelV2(mainService?.uri as string, {\n\t\t\t\tannotationURI: annotationUrls,\n\t\t\t\tloadAnnotationsJoined: true\n\t\t\t});\n\t\t\toDataModel.attachMetadataLoaded(() => {\n\t\t\t\tresolve(oDataModel);\n\t\t\t});\n\t\t\toDataModel.attachMetadataFailed(() => {\n\t\t\t\tresolve(oDataModel);\n\t\t\t});\n\t\t});\n\t}\n\n\t/**\n\t * Get Entity Set\n\t *\n\t * @param {object} manifest - manifest object\n\t * @returns {string} returns entity set\n\t * @private\n\t */\n\tprivate _getEntitySet(manifest: IAppManifest): string | undefined {\n\t\tconst pages = manifest[\"sap.ui.generic.app\"]?.pages;\n\t\tif (Array.isArray(pages)) {\n\t\t\treturn pages[0].entitySet;\n\t\t} else if (pages) {\n\t\t\tfor (const key in pages) {\n\t\t\t\tconst oApp = pages[key] as IPageType;\n\t\t\t\tif (this.recommendedUtilInstance._isListReport(oApp)) {\n\t\t\t\t\treturn oApp.entitySet;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\treturn undefined;\n\t}\n\n\t/**\n\t * Load I18n\n\t *\n\t * @param {object} manifest - manifest object\n\t * @param {string} manifestUrl - manifest url\n\t * @returns {object} returns resource bundle\n\t * @private\n\t */\n\tprivate async loadI18n(manifest: IAppManifest, manifestUrl: string) {\n\t\t// construct abslute url for properties file relative to manifest url\n\t\tconst i18nBundleUrl = manifest?.[\"sap.app\"]?.[\"i18n\"]?.[\"bundleUrl\"] as string;\n\t\tconst absoluteUrl = new URL(i18nBundleUrl, manifestUrl).href;\n\t\tthis._RBManifestMap = this._RBManifestMap || {};\n\t\tif (!this._RBManifestMap[absoluteUrl]) {\n\t\t\tconst oResourceBundle = await ResourceBundle.create({\n\t\t\t\t// specify url of the base .properties file\n\t\t\t\tbundleUrl: absoluteUrl,\n\t\t\t\tasync: true,\n\t\t\t\tterminologies: manifest[\"sap.app\"]?.[\"i18n\"]?.[\"terminologies\"]\n\t\t\t});\n\t\t\tthis._RBManifestMap[absoluteUrl] = oResourceBundle;\n\t\t}\n\t\treturn this._RBManifestMap[absoluteUrl];\n\t}\n\n\t/**\n\t * Get I18n Value Or Default String\n\t *\n\t * @param {string} sValue - value\n\t * @param {object} oResourceBundle - resource bundle object\n\t * @returns {string} returns string\n\t * @private\n\t */\n\tprivate getI18nValueOrDefaultString(sValue: string, oRB: ResourceBundle) {\n\t\tlet sPath = \"\";\n\t\tif (sValue && sValue.startsWith(\"{{\")) {\n\t\t\tsPath = sValue.substring(2, sValue.length - 2);\n\t\t} else if (sValue && sValue.startsWith(\"{\")) {\n\t\t\tsPath = sValue.substring(1, sValue.length - 1);\n\t\t}\n\t\treturn sPath ? oRB.getText(sPath) : sValue;\n\t}\n\n\t/**\n\t * Retrieves a copy of the analytical card manifest.\n\t *\n\t *\n\t * @private\n\t * @returns {ICardManifest} A copy of the analytical card manifest.\n\t */\n\tpublic _getAnalyticalCardManifest() {\n\t\treturn JSON.parse(JSON.stringify(AnalyticalCardSkeleton)) as ICardManifest;\n\t}\n\n\t/**\n\t * Processes the app manifest and generates a recommended card manifest if the app meets the required conditions.\n\t *\n\t * @param {ODataMetaModel} metaModel - The OData meta model containing metadata about entities and properties.\n\t * @param {IValidManifest} manifestObj - An object containing the app manifest and its URL.\n\t * @param {AppInfoData | undefined} parentApp - The parent app information, if available.\n\t * @param {IVersionInfo} versionInfo - The version and build timestamp of the app.\n\t * @returns {Promise<ICardManifest | undefined>} A promise that resolves to the generated card manifest if the app is eligible,\n\t * or `undefined` if the app does not meet the required conditions.\n\t * @private\n\t */\n\tprivate async getProcessedManifest(\n\t\tmetaModel: ODataMetaModel,\n\t\tmanifestObj: IValidManifest,\n\t\tparentApp: IAppInfoData | undefined,\n\t\tversionInfo: IVersionInfo\n\t): Promise<ICardManifest | undefined> {\n\t\ttry {\n\t\t\tconst manifest = manifestObj.manifest;\n\t\t\tconst mainEntitySetName = this._getEntitySet(manifest);\n\t\t\tif (!mainEntitySetName) {\n\t\t\t\treturn undefined;\n\t\t\t}\n\n\t\t\tconst mainEntitySet = metaModel.getODataEntitySet(mainEntitySetName) as IEntitySet;\n\t\t\tconst lineItemDetails = this.recommendedUtilInstance.getLineItemDetails(metaModel, manifest, mainEntitySetName);\n\n\t\t\tif (!lineItemDetails?.lineItem) {\n\t\t\t\treturn undefined;\n\t\t\t}\n\n\t\t\tconst entitySetName = lineItemDetails.entitySet || mainEntitySetName;\n\t\t\tconst entitySet = (\n\t\t\t\tentitySetName === mainEntitySetName ? mainEntitySet : metaModel.getODataEntitySet(entitySetName)\n\t\t\t) as IEntitySet;\n\t\t\tconst entityType = metaModel.getODataEntityType(entitySet.entityType) as IEntityType;\n\t\t\tconst suppressRowNavigation = lineItemDetails?.lrSettings?.[\"bSupressCardRowNavigation\"];\n\n\t\t\t// Check for mandatory properties\n\t\t\tif (this.recommendedUtilInstance.hasMandatoryProperties(entitySet, entityType?.property)) {\n\t\t\t\treturn undefined;\n\t\t\t}\n\n\t\t\t// Check for parameterized entity sets\n\t\t\tconst parameterDetails = this.recommendedUtilInstance._getParametersisedEntitySetParams(metaModel, entitySetName, true);\n\t\t\tif (parameterDetails?.entitySetName && parameterDetails?.parameters?.length) {\n\t\t\t\tconst paramEntitySet = metaModel.getODataEntitySet(parameterDetails.entitySetName) as IEntitySet;\n\t\t\t\tif (this.recommendedUtilInstance.hasMandatoryProperties(paramEntitySet, parameterDetails.parameters as Property[])) {\n\t\t\t\t\treturn undefined;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tconst cardInput = this.recommendedUtilInstance._getManifestCardData(manifest, lineItemDetails, parentApp!, metaModel);\n\n\t\t\t// Ensure the card has at least 3 columns\n\t\t\tif (cardInput.columns.length < COLUMN_LENGTH) {\n\t\t\t\treturn undefined;\n\t\t\t}\n\n\t\t\t// Resolve card title\n\t\t\tconst headerInfo = lineItemDetails?.headerInfo as IHeaderInfo;\n\t\t\tconst cardTitle = headerInfo.TypeNamePlural?.String || \"\";\n\t\t\tcardInput.cardTitle = cardTitle || cardInput.cardTitle;\n\n\t\t\t// Resolve i18n title if necessary\n\t\t\tif (!cardTitle && manifest[\"sap.app\"]?.i18n) {\n\t\t\t\tconst i18nBundleUrl = manifest[\"sap.app\"].i18n.bundleUrl;\n\t\t\t\tconst appTitle = manifest[\"sap.app\"].title;\n\t\t\t\tif (i18nBundleUrl && (appTitle.startsWith(\"i18n>\") || appTitle.startsWith(\"{\"))) {\n\t\t\t\t\tconst i18nResourceBundle = await this.loadI18n(manifest, manifestObj.url);\n\t\t\t\t\tcardInput.cardTitle = this.getI18nValueOrDefaultString(cardInput.cardTitle!, i18nResourceBundle);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn this.recommendedUtilInstance._createCardManifest(cardInput, versionInfo, manifest, suppressRowNavigation);\n\t\t} catch (oError: unknown) {\n\t\t\tLog.error(\"Error while processing manifest\", oError instanceof Error ? oError.message : String(oError));\n\t\t\treturn undefined;\n\t\t}\n\t}\n\n\t/**\n\t * Fetches the OData meta models for a given list of valid manifests.\n\t * @param {IValidManifest[]} validManifests - An array of valid manifest objects\n\t * @returns {Promise<(ODataMetaModel | undefined)[]>} A promise that resolves to an array of OData meta models.\n\t * Each element corresponds to a manifest in the input array, and may be `undefined` if the meta model could not be fetched.\n\t * @private\n\t */\n\tprivate async fetchMetaModels(validManifests: IValidManifest[]): Promise<(ODataMetaModel | undefined)[]> {\n\t\tconst odataPromises = validManifests.map(async (manifestObj) => {\n\t\t\ttry {\n\t\t\t\treturn (await this._getOdataModel(manifestObj.manifest))?.getMetaModel();\n\t\t\t} catch (oError: unknown) {\n\t\t\t\tLog.error(\"Error while fetching metamodel\", oError instanceof Error ? oError.message : String(oError));\n\t\t\t\treturn undefined;\n\t\t\t}\n\t\t});\n\n\t\treturn await Promise.all(odataPromises);\n\t}\n\n\t/**\n\t * Combines the valid manifests with their corresponding OData meta models.\n\t * @param {IValidManifest[]} validManifests - An array of valid manifest objects\n\t * @param {ODataMetaModel[]} aMetaModel - An array of OData meta models\n\t * @returns {ICombinedManifestDetails[]} An array of objects containing the manifest and the corresponding meta model.\n\t * @private\n\t */\n\tprivate combineManifestsAndMetaModels(\n\t\tvalidManifests: IValidManifest[],\n\t\taMetaModel: (ODataMetaModel | undefined)[]\n\t): ICombinedManifestDetails[] {\n\t\treturn validManifests.reduce<ICombinedManifestDetails[]>((combined, manifestObj, index) => {\n\t\t\tconst metaModel = aMetaModel[index];\n\t\t\tif (metaModel) {\n\t\t\t\tcombined.push({ manifest: manifestObj, metaModel });\n\t\t\t}\n\t\t\treturn combined;\n\t\t}, []);\n\t}\n\n\t/**\n\t * Process the manifest and meta model to get the card manifest\n\t * @param {ICombinedManifestDetails[]} combinedDetails - An array of objects containing the manifest and the corresponding meta model.\n\t * @param {IAppInfoData[]} aCSTR - An array of app info data\n\t * @returns {Promise<(ICardManifest | undefined)[]>} A promise that resolves to an array of recommended card manifests.\n\t * @private\n\t */\n\tprivate async processManifests(\n\t\tcombinedDetails: ICombinedManifestDetails[],\n\t\taCSTR: IAppInfoData[]\n\t): Promise<(ICardManifest | undefined)[]> {\n\t\treturn Promise.all(\n\t\t\tcombinedDetails.map((item) => {\n\t\t\t\tconst parentApp = aCSTR.find((oApp) => oApp.resolutionResult?.ui5ComponentName === item.manifest.manifest?.[\"sap.app\"]?.id);\n\t\t\t\treturn this.getProcessedManifest(item.metaModel, item.manifest, parentApp, this.versionInfo);\n\t\t\t})\n\t\t);\n\t}\n\n\t/**\n\t * Processes the app list to generate a list of Fiori IDs.\n\t *\n\t * If `aList` is not provided, it uses `aAppComponentIds` and `aComponent` to generate the list of Fiori IDs.\n\t * It matches the `semanticObject` and `action` of each component in `aAppComponentIds` with the entries in `aComponent`.\n\t * If a match is found, the corresponding `fioriId` is added to the list.\n\t *\n\t * @param {string[]} [aList] - An optional array of Fiori IDs to return directly.\n\t * @param {ICardDetails[]} [aAppComponentIds] - An array of app component details to process.\n\t * @param {IAppInfo} [aComponent] - A mapping of component IDs to their corresponding data entries.\n\t * @returns {string[]} - A list of Fiori IDs.\n\t */\n\tprivate processAppList(aList?: string[], aAppComponentIds?: ICardDetails[], aComponent?: IAppInfo): string[] {\n\t\tif (!aList && aAppComponentIds && aAppComponentIds.length) {\n\t\t\treturn aAppComponentIds.reduce((list, oComponent) => {\n\t\t\t\tconst oData: IAppInfoData[] = aComponent?.[oComponent.id] || [];\n\t\t\t\tconst matchingData = oData.find(\n\t\t\t\t\t(entry) => entry.semanticObject === oComponent.target?.semanticObject && entry.action === oComponent.target?.action\n\t\t\t\t);\n\n\t\t\t\treturn matchingData ? [...list, matchingData.fioriId!] : list;\n\t\t\t}, [] as string[]);\n\t\t}\n\t\treturn aList || [];\n\t}\n\n\t/**\n\t * Fetch Card Mainfest\n\t *\n\t * @param {string[]} aAppIds - array of app ids\n\t * @returns {Promise} resolves to array of card manifest\n\t * @private\n\t */\n\tpublic async _getCardManifest(aList?: string[], aAppComponentIds?: ICardDetails[]): Promise<ICardManifest[]> {\n\t\ttry {\n\t\t\tconst [aCatalog, aFioriData] = await Promise.all([this._getCatalogApps(), this.getFioriAppData()]);\n\t\t\tthis.versionInfo = (await VersionInfo.load()) as IVersionInfo;\n\n\t\t\tconst aCSTR: IAppInfoData[] = Object.values(aFioriData).flat();\n\t\t\tconst aComponent = this.componentData;\n\t\t\t// in case of replacing old recommended cards fioriIds are not available hence make use of componnetname\n\t\t\t// and semanticobject and action to find fioriId, and populate aList to recreate recommended card again\n\t\t\tconst processedList = this.processAppList(aList, aAppComponentIds, aComponent);\n\n\t\t\tconst manifests = await this.fetchManifests(processedList, aFioriData, aCatalog);\n\t\t\tconst validManifests = manifests.filter((manifestObj) => this._checkValidManifests(manifestObj.manifest));\n\n\t\t\tconst aMetaModel = await this.fetchMetaModels(validManifests);\n\t\t\tconst combinedDetails = this.combineManifestsAndMetaModels(validManifests, aMetaModel);\n\n\t\t\tconst cards = await this.processManifests(combinedDetails, aCSTR);\n\t\t\treturn cards.filter((card) => card !== undefined);\n\t\t} catch (oError: unknown) {\n\t\t\tLog.error(\"Error while fetching card manifest\", oError instanceof Error ? oError.message : String(oError));\n\t\t\treturn [];\n\t\t}\n\t}\n\n\t/**\n\t * Fetch the app manifest for the given app ids\n\t * @param {string[]} appIdList - array of app ids\n\t * @param {AppInfo} fioriData - fiori data\n\t * @param {AppData[]} catalogData - catalog data\n\t * @returns {Promise} resolves to array of manifests\n\t * @private\n\t */\n\tprivate async fetchManifests(appIdList: string[], fioriData: IAppInfo, catalogData: AppData[]): Promise<IValidManifest[]> {\n\t\ttry {\n\t\t\tconst appPromises = appIdList.map(async (appId) => {\n\t\t\t\tconst aApp: IAppInfoData[] = fioriData[appId] || [];\n\t\t\t\tfor (const oApp of aApp) {\n\t\t\t\t\tconst oViz = catalogData.find(\n\t\t\t\t\t\t(catalog) => oApp.semanticObject === catalog.target?.semanticObject && oApp.action === catalog.target?.action\n\t\t\t\t\t);\n\t\t\t\t\tconst manifestUrl = oApp?.resolutionResult?.applicationDependencies?.manifest;\n\t\t\t\t\tif (oViz && manifestUrl) {\n\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\tconst response = await fetch(manifestUrl);\n\t\t\t\t\t\t\tconst manifest = (await response.json()) as IAppManifest;\n\t\t\t\t\t\t\treturn { url: response.url, manifest };\n\t\t\t\t\t\t} catch (error: unknown) {\n\t\t\t\t\t\t\tLog.error(\"Error while fetching manifest\", error instanceof Error ? error.message : String(error));\n\t\t\t\t\t\t\treturn undefined;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\t// No valid manifest found in this appId's entries\n\t\t\t\treturn undefined;\n\t\t\t});\n\t\t\tconst results = await Promise.all(appPromises);\n\t\t\treturn results.filter((manifest): manifest is IValidManifest => manifest !== undefined);\n\t\t} catch (oError) {\n\t\t\tLog.error(\"Error while processing manifests\", oError instanceof Error ? oError.message : String(oError));\n\t\t\treturn [];\n\t\t}\n\t}\n\n\t/**\n\t * Remove Duplicate Cards\n\t *\n\t * @param {object[]} aCards - array of cards\n\t * @returns {object[]} returns array of cards\n\t * @private\n\t */\n\tprivate _removeDuplicateCards(aCards: ICard[]): ICard[] {\n\t\tconst oCardDict: Record<string, boolean> = {};\n\t\tconst aResult: ICard[] = [];\n\t\taCards.forEach((oCard) => {\n\t\t\tconst sCardTitle = oCard?.descriptorContent?.[\"sap.card\"]?.header?.title || \"\";\n\t\t\tif (!oCardDict[sCardTitle]) {\n\t\t\t\taResult.push(oCard);\n\t\t\t\toCardDict[sCardTitle] = true;\n\t\t\t}\n\t\t});\n\t\treturn aResult;\n\t}\n\n\t/**\n\t * Fetch Recommended Cards\n\t *\n\t * @returns {Promise<ICard[] | []> } resolves to array of recommended cards\n\t * @private\n\t */\n\tpublic async getRecommenedCards(): Promise<ICard[] | []> {\n\t\ttry {\n\t\t\tconst aAppIds = await this._getRecommenedFioriIds();\n\t\t\tconst aManifests = await this._getCardManifest(aAppIds);\n\t\t\tconst aRecManifests = aManifests?.slice(0, RECOMMENDED_CARD_LIMIT);\n\t\t\tconst aRecommendedCards = aRecManifests?.map((manifest) => {\n\t\t\t\tlet id;\n\t\t\t\tif (manifest?.[\"sap.card\"]) {\n\t\t\t\t\tmanifest[\"sap.card\"].rec = true;\n\t\t\t\t\tid = manifest[\"sap.app\"]?.id;\n\t\t\t\t}\n\t\t\t\treturn {\n\t\t\t\t\tid,\n\t\t\t\t\tdescriptorContent: manifest\n\t\t\t\t};\n\t\t\t});\n\t\t\treturn this._removeDuplicateCards(aRecommendedCards as ICard[]);\n\t\t} catch (error) {\n\t\t\tLog.error(\"Error while fetching recommended cards:\", error instanceof Error ? error.message : String(error));\n\t\t\treturn [];\n\t\t}\n\t}\n\n\t/**\n\t * Retrieves a list of recommended visualizations for the user.\n\t *\n\t * The final list is composed of up to 10 recommendations, with must-include visualizations prioritized.\n\t * If no recommended visualizations are available or if an error occurs, it returns an empty array.\n\t *\n\t * @private\n\t * @async\n\t * @param {boolean} [forceRefresh=false] - If `true`, forces a refresh of the recommended visualizations\n\t *                                         regardless of whether they are cached.\n\t * @returns {Promise<ICustomVisualization[]>} A promise that resolves to an array of recommended visualizations.\n\t *                                            The array is limited to 10 visualizations, including must-include recommendations.\n\t */\n\tpublic async getRecommendedVisualizations(forceRefresh: boolean = false) {\n\t\tif (!this._recommendedVisualizations || forceRefresh) {\n\t\t\tconst recommendedFioriIds = await this._getRecommenedFioriIds(forceRefresh);\n\t\t\tif (recommendedFioriIds.length) {\n\t\t\t\tlet finalRecommendations: ICustomVisualization[] = [];\n\t\t\t\tlet mustIncludeRecommendations: ICustomVisualization[] = [];\n\t\t\t\tlet [recommendedVisualizations, favoriteVisualizations] = await Promise.all([\n\t\t\t\t\tthis._getVisualizationsByFioriIds(recommendedFioriIds),\n\t\t\t\t\tthis._fetchPageVizs(forceRefresh)\n\t\t\t\t]);\n\t\t\t\t//filter out recommendations that are already added\n\t\t\t\trecommendedVisualizations = recommendedVisualizations.filter((recViz) =>\n\t\t\t\t\t_isVisualizationAlreadyAdded(recViz, favoriteVisualizations)\n\t\t\t\t);\n\t\t\t\trecommendedVisualizations.forEach((recViz) => {\n\t\t\t\t\tif (_isMustIncludeRecommendation(recViz)) {\n\t\t\t\t\t\tmustIncludeRecommendations.push(recViz);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tfinalRecommendations.push(recViz);\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t\t//return only 10 recommended apps along with 'MyInbox' and 'Manage My Timesheet' if user has access to these apps.\n\t\t\t\tthis._recommendedVisualizations = finalRecommendations\n\t\t\t\t\t.slice(0, 10 - mustIncludeRecommendations.length)\n\t\t\t\t\t.concat(mustIncludeRecommendations);\n\t\t\t} else {\n\t\t\t\tthis._recommendedVisualizations = [];\n\t\t\t}\n\t\t}\n\t\treturn this._recommendedVisualizations;\n\t}\n\n\t/**\n\t * Asynchronously retrieves the list of inbound applications from the SAP Fiori client-side target resolution service.\n\t *\n\t * @private\n\t * @async\n\t * @returns {Promise<Array>} A promise that resolves to an array of inbound applications.\n\t *                            If an error occurs or the inbound applications are not available, it resolves to an empty array.\n\t */\n\tprivate async _getInboundApps() {\n\t\ttry {\n\t\t\tconst service = await Container.getServiceAsync<ClientSideTargetResolution>(\"ClientSideTargetResolution\");\n\t\t\treturn service?._oAdapter?._aInbounds || [];\n\t\t} catch (error) {\n\t\t\tLog.error(\"Error while fetching inbound apps: \" + (error as Error).message);\n\t\t\treturn [];\n\t\t}\n\t}\n\n\t/**\n\t * Retrieves Fiori app data and stores it in the `fioriAppData` and `componentData` properties.\n\t *\n\t * This method fetches inbound applications using the `_getInboundApps` method and processes them to extract\n\t * Fiori app IDs (`sap-fiori-id`) and their associated semantic data. It also maps UI5 component names to their\n\t * corresponding Fiori app IDs for later use.\n\t *\n\t * @returns {Promise<IAppInfo>} A promise that resolves to an object containing Fiori app data\n\t * @private\n\t */\n\tprivate async getFioriAppData(): Promise<IAppInfo> {\n\t\ttry {\n\t\t\tif (!Object.keys(this.componentData).length) {\n\t\t\t\tthis.componentData = {};\n\t\t\t\tthis.fioriAppData = {};\n\t\t\t\tconst inbounds = await this._getInboundApps();\n\t\t\t\tinbounds.forEach((oItem) => {\n\t\t\t\t\tconst fioriId = oItem?.signature?.parameters?.[\"sap-fiori-id\"]?.defaultValue?.value;\n\t\t\t\t\tconst componentId = oItem?.resolutionResult?.ui5ComponentName;\n\t\t\t\t\tif (fioriId) {\n\t\t\t\t\t\tconst semanticData: IAppInfoData = {\n\t\t\t\t\t\t\taction: oItem.action,\n\t\t\t\t\t\t\tsemanticObject: oItem.semanticObject,\n\t\t\t\t\t\t\tresolutionResult: oItem.resolutionResult\n\t\t\t\t\t\t};\n\t\t\t\t\t\tthis.fioriAppData[fioriId] = this.fioriAppData[fioriId] || [];\n\t\t\t\t\t\tthis.fioriAppData[fioriId].push(semanticData);\n\n\t\t\t\t\t\t// store data along with fioriId in componentData, this can be used later to find the\n\t\t\t\t\t\t// fioriId for those apps when only ui5ComponentName is known\n\t\t\t\t\t\tif (componentId) {\n\t\t\t\t\t\t\tconst combinedData: IAppInfoData = { ...semanticData, fioriId };\n\n\t\t\t\t\t\t\tthis.componentData[componentId] = this.componentData[componentId] || [];\n\t\t\t\t\t\t\tthis.componentData[componentId].push(combinedData);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\t\t\treturn this.fioriAppData;\n\t\t} catch (oError) {\n\t\t\tLog.error(oError instanceof Error ? oError.message : String(oError));\n\t\t\treturn {};\n\t\t}\n\t}\n\n\t/**\n\t * Retrieves visualizations based on a list of Fiori IDs.\n\t *\n\t * This function processes the given Fiori IDs to find associated visualizations. It does so by fetching\n\t * inbound applications and catalog apps, then matching the Fiori IDs to filter out and gather relevant visualizations.\n\t * The function distinguishes between GUI and non-GUI visualizations, prioritizing non-GUI visualizations if both types are found.\n\t * It also ensures that each visualization is unique based on its URL and title, avoiding duplicates.\n\t *\n\t * @private\n\t * @async\n\t * @param {string[]} fioriIds - An array of Fiori IDs to search for visualizations.\n\t * @returns {Promise<ICustomVisualization[]>} A promise that resolves to an array of unique visualizations associated with the provided Fiori IDs.\n\t */\n\tprivate async _getVisualizationsByFioriIds(fioriIds: string[]) {\n\t\tconst visualizations: ICustomVisualization[] = [];\n\t\tconst visitedVisualizations: Map<string, boolean> = new Map<string, boolean>();\n\t\tconst [inbounds, catalogApps] = await Promise.all([this._getInboundApps(), this._getCatalogApps()]);\n\t\tfioriIds.forEach((fioriId) => {\n\t\t\t// get all inbounds with the fiori id\n\t\t\tconst authorizedApps = inbounds.filter(function (inbound) {\n\t\t\t\treturn inbound?.signature.parameters[\"sap-fiori-id\"]?.defaultValue?.value === fioriId;\n\t\t\t});\n\t\t\tauthorizedApps.forEach((app) => {\n\t\t\t\t//filter apps that matched semantic object action\n\t\t\t\tlet matchingVizualizations = catalogApps.filter((catalogApp) => {\n\t\t\t\t\treturn catalogApp?.target?.semanticObject === app.semanticObject && catalogApp.target.action === app.action;\n\t\t\t\t});\n\n\t\t\t\tconst guiVisualizations = matchingVizualizations.filter((matchingVizualization) =>\n\t\t\t\t\t_isGUIVisualization(matchingVizualization)\n\t\t\t\t);\n\t\t\t\tconst nonGuiVisualizations = matchingVizualizations.filter(\n\t\t\t\t\t(matchingVizualization) => !_isGUIVisualization(matchingVizualization)\n\t\t\t\t);\n\t\t\t\t//if both gui and non-gui visualizations exists, then consider only non-gui visualizations for recommendation.\n\t\t\t\tif (guiVisualizations.length > 0 && nonGuiVisualizations.length > 0) {\n\t\t\t\t\tmatchingVizualizations = [...nonGuiVisualizations];\n\t\t\t\t}\n\n\t\t\t\tmatchingVizualizations.forEach((matchingVizualization) => {\n\t\t\t\t\tlet visualization = matchingVizualization.visualizations[0];\n\t\t\t\t\tlet recommendedVisualization: ICustomVisualization = {\n\t\t\t\t\t\ttitle: visualization.title,\n\t\t\t\t\t\tsubtitle: visualization.subtitle,\n\t\t\t\t\t\ticon: visualization.icon,\n\t\t\t\t\t\turl: visualization.targetURL,\n\t\t\t\t\t\tvizId: visualization.vizId,\n\t\t\t\t\t\tfioriId: fioriId,\n\t\t\t\t\t\tvisualization: visualization\n\t\t\t\t\t};\n\t\t\t\t\t//if app with same url or title already recommended, then don't consider it.\n\t\t\t\t\tif (\n\t\t\t\t\t\t!visitedVisualizations.has(recommendedVisualization.url!) ||\n\t\t\t\t\t\t!visitedVisualizations.has(recommendedVisualization.title!)\n\t\t\t\t\t) {\n\t\t\t\t\t\tvisitedVisualizations.set(recommendedVisualization.url!, true);\n\t\t\t\t\t\tvisitedVisualizations.set(recommendedVisualization.title!, true);\n\t\t\t\t\t\tvisualizations.push(recommendedVisualization);\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t});\n\t\t});\n\t\treturn visualizations;\n\t}\n\n\t/**\n\t * Retrieves visualizations for all favorite pages based on the provided parameters.\n\t * @param {Array} pages - An array of favorite pages.\n\t * @param {boolean} shouldReload - A flag indicating whether to reload page visualizations.\n\t * @returns {Promise<ICustomVisualization[]>} A promise that resolves with an array of favorite page visualizations.\n\t * @private\n\t */\n\tpublic async _getAllFavPageApps(pages: IPage[], shouldReload?: boolean): Promise<ICustomVisualization[]> {\n\t\ttry {\n\t\t\tif (pages) {\n\t\t\t\tthis._favPageVisualizations = this._favPageVisualizations || [];\n\t\t\t\t//Check to ensure that missing visualization data is loaded, if any\n\t\t\t\tconst loadedPages = this._favPageVisualizations.reduce((pageIDs: string[], visualization) => {\n\t\t\t\t\tif (visualization.pageId && !pageIDs.includes(visualization.pageId)) {\n\t\t\t\t\t\tpageIDs.push(visualization.pageId);\n\t\t\t\t\t}\n\t\t\t\t\treturn pageIDs;\n\t\t\t\t}, []);\n\t\t\t\tconst pageIds = pages.map((page) => page.pageId);\n\t\t\t\tconst shouldLoadMissingApps = loadedPages.length === 0 || !loadedPages.every((pageId) => pageIds.includes(pageId));\n\t\t\t\tif (!shouldReload && !shouldLoadMissingApps) {\n\t\t\t\t\treturn this._favPageVisualizations;\n\t\t\t\t} else {\n\t\t\t\t\tthis._favPageVisualizations = await this._loadAllPageVisualizations(pages, shouldReload);\n\t\t\t\t\treturn this._favPageVisualizations;\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn [];\n\t\t} catch (error) {\n\t\t\tLog.error(error as string);\n\t\t\treturn [];\n\t\t}\n\t}\n\n\t/**\n\t * Loads visualizations for all specified pages.\n\t * @param {Array} pages - An array of pages.\n\t * @param {boolean} [shouldFetchDistinctApps=false] - A flag indicating whether to fetch distinct pages.\n\t * @returns {Promise<ICustomVisualization[]>} A promise that resolves with an array of page visualizations.\n\t * @private\n\t */\n\tprivate async _loadAllPageVisualizations(\n\t\tpages: IPage[],\n\t\tforceRefresh = false,\n\t\tshouldFetchDistinctApps = false\n\t): Promise<ICustomVisualization[]> {\n\t\tconst getBgColor = (pageId: string | undefined) => {\n\t\t\treturn pages.find((page) => page.pageId === pageId)?.BGColor ?? DEFAULT_BG_COLOR().key;\n\t\t};\n\n\t\ttry {\n\t\t\tconst favPageVisualizations: ICustomVisualization[] = [];\n\t\t\tconst aPages = await this.loadPages(pages, forceRefresh);\n\n\t\t\tfor (const page of aPages) {\n\t\t\t\tconst sections = page?.sections || [];\n\t\t\t\tfor (const section of sections) {\n\t\t\t\t\tconst visualizations = section.visualizations || [];\n\t\t\t\t\tfor (const visualization of visualizations) {\n\t\t\t\t\t\tconst app = {\n\t\t\t\t\t\t\tappId: visualization.targetURL,\n\t\t\t\t\t\t\tvizId: visualization.vizId,\n\t\t\t\t\t\t\ticon: visualization.icon,\n\t\t\t\t\t\t\tBGColor: getBgColor(page.id) as string,\n\t\t\t\t\t\t\tpageId: page.id\n\t\t\t\t\t\t};\n\t\t\t\t\t\tif (!shouldFetchDistinctApps || !favPageVisualizations.some((oVizApp) => oVizApp.appId === app.appId)) {\n\t\t\t\t\t\t\tfavPageVisualizations.push(app);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn favPageVisualizations;\n\t\t} catch (error) {\n\t\t\tLog.error(error as string);\n\t\t\treturn [];\n\t\t}\n\t}\n\t/**\n\t * Fetches page data for the specified pages.\n\t * @param {Array} pages - An array of pages.\n\t * @param {boolean} forceRefresh - If true, forces a refresh of the page data.\n\t * @returns {Promise<IPage>} A promise that resolves to the fetched page data.\n\t * @private\n\t */\n\tprivate async loadPages(pages: IPage[], forceRefresh: boolean = false): Promise<IPage[]> {\n\t\treturn await Promise.all(pages.map((page) => this._fetchRequestFromQueue(forceRefresh, page.pageId)));\n\t}\n}\n"],"mappings":";;;;AAAAA,IAAAC,GAAAC,OAAA,qRAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,GAAA,sBAAAC,EAAAC,GAAA,OAAAA,KAAAC,mBAAAD,EAAAE,UAAA,YAAAF,EAAAE,QAAAF,CAAA,OAoKaG,SAAuCC,SAAW,YAAeA,OAAOC,WAAaD,OAAOC,SAAWD,OAAO,oBAAuB,aA7H3I,SAASE,EAAQC,EAAMC,EAAOC,GACpC,IAAKF,EAAKG,EAAG,CACZ,GAAID,aAAiBE,EAAO,CAC3B,GAAIF,EAAMC,EAAG,CACZ,GAAIF,EAAQ,EAAG,CACdA,EAAQC,EAAMC,CACf,CACAD,EAAQA,EAAMG,CACf,KAAO,CACNH,EAAMI,EAAIP,EAAQQ,KAAK,KAAMP,EAAMC,GACnC,MACD,CACD,CACA,GAAIC,GAASA,EAAMM,KAAM,CACxBN,EAAMM,KAAKT,EAAQQ,KAAK,KAAMP,EAAMC,GAAQF,EAAQQ,KAAK,KAAMP,EAAM,IACrE,MACD,CACAA,EAAKG,EAAIF,EACTD,EAAKK,EAAIH,EACT,MAAMO,EAAWT,EAAKM,EACtB,GAAIG,EAAU,CACbA,EAAST,EACV,CACD,CACD,CAAC,MA9DYI,EAAsB,WAClC,SAAAA,IAAkB,CAClBA,EAAMM,UAAUF,KAAO,SAASG,EAAaC,GAC5C,MAAMC,EAAS,IAAAT,EACf,MAAMH,EAAQa,KAAKX,EACnB,GAAIF,EAAO,CACV,MAAMc,EAAWd,EAAQ,EAAIU,EAAcC,EAC3C,GAAIG,EAAU,CACb,IACChB,EAAQc,EAAQ,EAAGE,EAASD,KAAKT,GAClC,CAAE,MAAOW,GACRjB,EAAQc,EAAQ,EAAGG,EACpB,CACA,OAAOH,CACR,KAAO,CACN,OAAOC,IACR,CACD,CACAA,KAAKR,EAAI,SAASW,GACjB,IACC,MAAMf,EAAQe,EAAMZ,EACpB,GAAIY,EAAMd,EAAI,EAAG,CAChBJ,EAAQc,EAAQ,EAAGF,EAAcA,EAAYT,GAASA,EACvD,MAAO,GAAIU,EAAY,CACtBb,EAAQc,EAAQ,EAAGD,EAAWV,GAC/B,KAAO,CACNH,EAAQc,EAAQ,EAAGX,EACpB,CACD,CAAE,MAAOc,GACRjB,EAAQc,EAAQ,EAAGG,EACpB,CACD,EACA,OAAOH,CACR,EACA,OAAAT,CACD,CAnCmC,GAgE5B,SAASc,EAAeC,GAC9B,OAAOA,aAAoBf,GAASe,EAAShB,EAAI,CAClD,CA+CO,SAASiB,EAAOC,EAAOC,EAAMC,GACnC,IAAIC,GAAK,EAAGxB,EAAMyB,EAClB,SAASC,EAAOb,GACf,IACC,QAASW,EAAIH,EAAMM,UAAYJ,IAAUA,KAAU,CAClDV,EAASS,EAAKE,GACd,GAAIX,GAAUA,EAAOL,KAAM,CAC1B,GAAIU,EAAeL,GAAS,CAC3BA,EAASA,EAAOR,CACjB,KAAO,CACNQ,EAAOL,KAAKkB,EAAQD,IAAWA,EAAS1B,EAAQQ,KAAK,KAAMP,EAAO,IAAII,EAAS,KAC/E,MACD,CACD,CACD,CACA,GAAIJ,EAAM,CACTD,EAAQC,EAAM,EAAGa,EAClB,KAAO,CACNb,EAAOa,CACR,CACD,CAAE,MAAOG,GACRjB,EAAQC,IAASA,EAAO,IAAII,GAAU,EAAGY,EAC1C,CACD,CACAU,IACA,OAAO1B,CACR,CAAC,MAnGQ4B,EAAsBzC,EAAA,0BA+HxB,SAAS0C,EAAOC,EAAQR,EAAMC,GACpC,UAAWO,EAAOlC,KAAqB,WAAY,CAClD,IAAIE,EAAWgC,EAAOlC,KAAoBmC,EAAM/B,EAAMyB,EACtD,SAASC,EAAOb,GACf,IACC,QAASkB,EAAOjC,EAASkC,QAAQC,QAAUV,IAAUA,KAAU,CAC9DV,EAASS,EAAKS,EAAK7B,OACnB,GAAIW,GAAUA,EAAOL,KAAM,CAC1B,GAAIU,EAAeL,GAAS,CAC3BA,EAASA,EAAOR,CACjB,KAAO,CACNQ,EAAOL,KAAKkB,EAAQD,IAAWA,EAAS1B,EAAQQ,KAAK,KAAMP,EAAO,IAAII,EAAS,KAC/E,MACD,CACD,CACD,CACA,GAAIJ,EAAM,CACTD,EAAQC,EAAM,EAAGa,EAClB,KAAO,CACNb,EAAOa,CACR,CACD,CAAE,MAAOG,GACRjB,EAAQC,IAASA,EAAO,IAAII,GAAU,EAAGY,EAC1C,CACD,CACAU,IACA,GAAI5B,EAASoC,OAAQ,CACpB,IAAIC,EAAS,SAASjC,GACrB,IACC,IAAK6B,EAAKE,KAAM,CACfnC,EAASoC,QACV,CACD,CAAE,MAAMlB,GACR,CACA,OAAOd,CACR,EACA,GAAIF,GAAQA,EAAKQ,KAAM,CACtB,OAAOR,EAAKQ,KAAK2B,EAAQ,SAASnB,GACjC,MAAMmB,EAAOnB,EACd,EACD,CACAmB,GACD,CACA,OAAOnC,CACR,CAEA,KAAM,WAAY8B,GAAS,CAC1B,MAAM,IAAIM,UAAU,yBACrB,CAEA,IAAIC,EAAS,GACb,IAAK,IAAIb,EAAI,EAAGA,EAAIM,EAAOH,OAAQH,IAAK,CACvCa,EAAOC,KAAKR,EAAON,GACpB,CACA,OAAOJ,EAAOiB,EAAQ,SAASb,GAAK,OAAOF,EAAKe,EAAOb,GAAK,EAAGD,EAChE,CAAC,MApLAgB,EAAanD,EAAA,iBAugBP,SAASoD,EAAOlB,EAAMmB,GAC5B,IACC,IAAI5B,EAASS,GACd,CAAE,MAAMN,GACP,OAAOyB,EAAQzB,EAChB,CACA,GAAIH,GAAUA,EAAOL,KAAM,CAC1B,OAAOK,EAAOL,UAAU,EAAGiC,EAC5B,CACA,OAAO5B,CACR,CAAC,MAhhBA6B,EAAgBtD,EAAA,0BAChBuD,EAAavD,EAAA,uBACbwD,EAAcxD,EAAA,wBACdyD,EAAezD,EAAA,yBACf0D,EAAoB1D,EAAA,8BACpB2D,EAAuB3D,EAAA,iCACvB4D,EAAsB5D,EAAA,gCAEd6D,EAAkB5D,EAAA,4BAAE6D,EAAU7D,EAAA,oBAChC8D,EAAU3D,EAAAF,GAAA,MACV8D,EAAmB5D,EAAAD,GAE1B,MAAM8D,EAAY,CACjBC,6BAA8B,CAAC,QAAS,UAoBzC,MAAMC,EAAsBC,IAC3B,IAAIC,EAAgD,CAAC,EACrD,GAAID,EAAQ,CACX,UAAWA,IAAW,SAAU,CAC/BC,EAAgBD,CACjB,KAAO,CACN,IACCC,EAAgBC,KAAKC,MAAMH,EAC5B,CAAE,MAAOI,GACRhF,EAAIiF,MAAMD,aAAkBE,MAAQF,EAAOG,QAAUC,OAAOJ,IAC5DH,EAAgBQ,SACjB,CACD,CACD,CACA,OAAOR,GAGR,MAAMS,EAAsBC,IAC3B,IAAIC,EAAkD,CAAC,EACvD,GAAID,GAAcE,oBAAoBC,MAAMC,cAAe,CAC1D,MAAMC,EAA0CjB,EAAmBY,EAAaE,mBAAmBC,KAAKC,eACxG,GAAIC,GAASC,kBAAmB,CAC/B,MAAMC,EAA8CnB,EAAmBiB,EAAQC,mBAC/E,GAAIC,EAAa,CAChBN,EAAkBb,EAAmBmB,EAAYC,gBAClD,CACD,CACD,CACA,OAAOP,GAGR,MAAMQ,EAAaT,IAClB,IAAIU,EAAS,GACb,IAAIT,EAAkD,CAAC,EACvD,GAAID,GAAcrC,QAAQgD,gBAAkBX,GAAcrC,QAAQiD,OAAQ,CACzEF,EAAS,IAAIV,EAAarC,OAAOgD,kBAAkBX,EAAarC,OAAOiD,QACxE,MAAO,GAAIZ,GAAcE,oBAAoBC,MAAMC,cAAe,CACjEH,EAAkBF,EAAmBC,GACrC,GAAIC,GAAiBU,gBAAkBV,GAAiBY,eAAgB,CACvEH,EAAS,IAAIT,GAAiBU,kBAAkBV,GAAiBY,gBAClE,CACD,CACA,OAAOH,GAGR,MAAMI,EAAiBd,IACtB,IAAIe,EAAaN,EAAUT,IAAiB,GAC5C,MAAMC,EAAkBF,EAAmBC,GAC3C,GAAIC,GAAiBe,aAAc,CAClCD,GAAc,iBAAmBd,EAAgBe,YAClD,CACA,OAAOD,GAGR,MAAME,EAAwBC,GACtBA,EAAeC,SAASC,WAAW,sBAI3C,MAAMC,EAAuBA,CAACC,EAAsBtB,KACnD,MAAMuB,EAAevB,GAAcE,oBAAoBC,MAAMqB,MAAMC,mBAAmBC,MACtF,MAAO,CACNC,MAAOL,EAAKK,MAAQL,EAAKK,MAAQJ,GAAcI,OAAS,GACxDC,SAAUN,EAAKM,SAAWN,EAAKM,SAAWL,GAAcM,aAAe,KAWzE,MAAMC,EAAsBC,IAC3BA,EAAMC,QAASC,IACdF,EACEG,OACCC,GACAA,EAAKC,QAAUH,EAAcG,OAC7BD,GAAME,eAAeC,KAAOL,GAAeI,eAAeC,IAC1DH,EAAKI,YAAYC,eAAiBP,EAAcM,YAAYC,cAE7DR,QAASG,IACTA,GAAMI,YAAYE,eAAetE,KAAK8D,OAIzC,OAAOF,GAGR,MAAMW,EAAuBL,GACrBA,GAAe1E,QAAQgF,aAAa,qBAAqB5G,OAAOA,QAAU,MAGlF,MAAM6G,EAAgCC,GAC9BA,EAAOC,SAAW5D,EAAUC,6BAA6B4D,SAASF,EAAOC,SAGjF,MAAME,EAA+BA,CAACX,EAAqCY,KAClEA,EAAuBC,KAC7BC,GACAA,EAAOd,eAAe1E,QAAQgD,iBAAmB0B,EAAcA,eAAe1E,QAAQgD,gBACtFwC,EAAOd,eAAe1E,QAAQiD,SAAWyB,EAAcA,eAAe1E,QAAQiD,QAkBlE,MAAMwC,UAAmBxI,EAC/ByI,cAAuE,GAEvEC,wBAAmC,MAOnCC,gBAA2B,MAC3BC,eAAwD,CAAC,EACzDC,uBAAiD,GACjDC,cAA0B,CAAC,EAC3BC,aAAyB,CAAC,EAI1BC,cACPC,QACAlH,KAAKmH,wBAA0B7E,EAAoB8E,aACpD,CAEA,kBAAOA,GACN,IAAKX,EAAWY,SAAU,CACzBZ,EAAWY,SAAW,IAAIZ,CAC3B,CACA,OAAOA,EAAWY,QACnB,CAScC,uBAAuBC,EAAwBC,EAAiB1F,GAAc,IAAkB,MAAA3B,EAG7GH,KAAI,OAAAyH,QAAAC,QAF+BtJ,EAAUuJ,gBAA8B,iBAAejI,KAAA,SAApFkI,GACN,IAAIC,EACJ1H,EAAKuG,cAAgBvG,EAAKuG,eAAiB,GAG3C,MAAMoB,EAAiB3H,EAAKuG,cAAcqB,KAAMC,GAAaA,EAASR,SAAWA,GACjF,IAAKM,GAAkBP,IAAkB,MAAQpH,EAAKyG,kBAAoB,KAAM,CAC/EzG,EAAKyG,gBAAkB,MACvBiB,EAAmBD,EAAqBK,QAAQT,GAChD,GAAIM,EAAgB,CACnBA,EAAeI,gBAAkBL,CAClC,KAAO,CACN1H,EAAKuG,cAAclF,KAAK,CACvBgG,OAAQA,EACRU,gBAAiBL,GAEnB,CACD,KAAO,CACNA,EAAmBC,EAAeI,eACnC,CAEA,OAAOL,CAAiB,EACzB,CAAC,MAAA3H,GAAA,OAAAuH,QAAA9G,OAAAT,EAAA,EAQOiI,kBAAkBZ,GACzB,OAAOvH,KAAKoI,aAAab,EAAe,MAAM7H,KAAM2I,GACnDA,EAAS9C,OAAQ+C,GAAYA,EAAQC,SAAWD,EAAQE,qBAE1D,CAQaC,aAAalB,EAAyB,MAAOC,EAAiB1F,GAAc,IAAuB,MAAA4G,EACpF1I,KAAI,OAAAyH,QAAAC,QAAJgB,EAAKpB,uBAAuBC,EAAeC,IAAO9H,KAAA,SAAvEiJ,GACN,MAAMC,EAAaD,GAASA,EAAME,UAAa,GAC9CC,EAAiCF,EAAUG,UAAWC,GAAaA,EAASnK,SAAS,GAClFiK,EAAyB,EAAC,UAAAG,IAK7B,OAAOP,EAAKD,aAAa,KAAM,OAAAS,EAAA,cAJ3BR,EAAKS,oBAAsBhG,UAAS,CACvCuF,EAAKS,kBAAoBT,EAAKU,YAAYN,EAAwB,GAAG,OAAArB,QAAAC,QAC/DgB,EAAKS,mBAAiBzJ,KAAA,eAEE,GAFF,OAAAwJ,KAAAxJ,KAAAwJ,EAAAxJ,KAAAuJ,KAAAC,EAAA,MAI7B,OAAON,CAAU,GAEnB,CAAC,MAAA1I,GAAA,OAAAuH,QAAA9G,OAAAT,EAAA,EAQamJ,eAAe9B,EAAwBC,EAAiB1F,GAAc,IAAmC,MAAAwH,EAEtHtJ,KADA,MAAMoF,EAAgC,GACtCkE,EAAKzC,eAAiByC,EAAKzC,gBAAkB,CAAC,EAAE,OAAAY,QAAAC,QACxB4B,EAAKb,aAAalB,EAAeC,IAAO9H,KAAA,SAA1DkJ,GAAS,OAAAnB,QAAAC,QACwBtJ,EAAUuJ,gBAA4C,+BAA6BjI,KAAA,SAApH6J,GACNX,EAAUvD,QAAQ,CAAC2D,EAAoBQ,KACtCR,GAAUS,gBAAgBpE,QAAQ,CAACd,EAAgCmF,KAClE,MAAMC,EAAYpF,EAAeoF,UAChCC,EAAWD,IAAY,YAAe,CAAE3E,MAAO,KAC/CQ,EAAO,CAAC,EAETA,EAAKqE,SAAW/F,EAAU6F,IAAY,YACtCnE,EAAKC,MAAQlB,GAAgBuF,UAC7BtE,EAAKuE,IAAMxF,GAAgBuF,UAC3B,IAAKtE,EAAKuE,KAAOzF,EAAqBC,GAAiB,CACtDiB,EAAKuE,IAAM5F,EAAcwF,IAAY,WACtC,CACAnE,EAAKwE,QAAU5H,EAAWoD,EAAKuE,KAC/BvE,EAAKR,MAAQT,GAAgBS,OAASN,EAAqBkF,EAAUrF,IAAiBS,MACtFQ,EAAKP,SAAWV,EAAeU,UAAYP,EAAqBkF,EAAUrF,GAAgBU,SAC1FO,EAAKyE,QAAUrI,IAAmBsI,IAClC1E,EAAK2E,MAAQ,KACb3E,EAAK4E,UAAY,MACjB5E,EAAKgC,OAASA,EACdhC,EAAK6E,KAAOV,IAAY,WAAWW,OAAOD,MAAQxI,EAClD,GAAI0C,GAAgBgG,oBAAqB,CACxC/E,EAAK+C,QAAU,KACf/C,EAAK+E,oBAAsBhG,EAAegG,oBAAoBC,KAC9DhF,EAAKiF,kBAAoBlG,EAAekG,iBACzC,CACAjF,EAAKgD,oBAAsBlE,EAAqBC,GAChD,GAAIiB,EAAKgD,oBAAqB,CAC7B,IAAKc,EAAKzC,eAAerB,EAAKC,OAAQ,CACrC6D,EAAKzC,eAAerB,EAAKC,OAAS8D,EAAyBmB,yBAC1DnG,GAED+E,EAAKzC,eAAerB,EAAKC,OAAOkF,UAAU,KAC3C,CACAnF,EAAKoF,YAActB,EAAKzC,eAAerB,EAAKC,MAC7C,CAEAD,EAAKI,WAAa,CACjB4B,OAAQ1F,EACR+I,aAAc7B,EAAShE,MACvB8F,UAAW9B,EAASrD,GACpBE,aAAc2D,EACduB,mBAAoBrB,EACpBsB,iBAAkBhC,EAASnK,QAC3BoM,gBAAiBjC,EAASkC,OAC1BpF,cAAe,IAEhBN,EAAKE,cAAgBnB,EAErBiB,EAAKE,cAAcV,MAAQQ,EAAKR,MAChCQ,EAAKE,cAAcT,SAAWO,EAAKP,SACnCG,EAAM5D,KAAKgE,OAGb,OAAOJ,CAAM,IACd,CAAC,MAAAlF,GAAA,OAAAuH,QAAA9G,OAAAT,EAAA,EAOaiL,mBAAgB,IAAG,MAAAC,EACmBpL,KAAI,OAAAyH,QAAAC,QAAJ0D,EAAKjD,kBAAkB,OAAKzI,KAAA,SAAzE2L,GACN,OAAO5D,QAAQ6D,IACdD,EAAaE,IAAKC,GACVJ,EAAKK,iBAAiBD,EAAQ9F,cAAegG,MAAO1J,IAE3D,EACH,CAAC,MAAA9B,GAAA,OAAAuH,QAAA9G,OAAAT,EAAA,EASYkI,aACZb,EACAoE,EACAnE,EAAiB1F,GAAc,IACO,MAAA8J,EACZ5L,KAAI,OAAAyH,QAAAC,QAAJkE,EAAKvC,eAAe9B,EAAeC,IAAO9H,KAAA,SAA9DmM,GACN,MAAMC,EAAkBD,EAAYtG,OAClCC,GAASA,EAAKI,YAAcJ,EAAKI,WAAWkF,YAAc9I,GAAwBwD,EAAKuE,KAAOvE,EAAKR,OACnG,GAEE2G,EAAgB,CACnB,OAAOC,EAAKG,qBAAqB5G,EAAmB2G,GAAkB,MAAO,MAE7E,OAAOF,EAAKI,qBAAqBF,EAAiB,GAEpD,CAAC,MAAA5L,GAAA,OAAAuH,QAAA9G,OAAAT,EAAA,EAQY+L,iBAAiB1E,EAAwB2E,GAAqB,IAAE,MAAAC,EAEvDnM,KAAI,SAAAoM,IAAA,OAAA3E,QAAAC,QA6BZ2E,IAAqB,CA9BlC,MAAMA,EAAmB,eAAe,OAAA5E,QAAAC,QACnByE,EAAK9C,eAAe9B,IAAc7H,KAAA,SAAhD0F,GACN,OAAOA,EAAMG,OAAQC,GAASA,EAAKI,YAAYkF,YAAc9I,GAAwBwD,EAAKuE,KAAOvE,EAAKR,MAAO,EAC9G,CAAC,MAAA9E,GAAA,OAAAuH,QAAA9G,OAAAT,EAAA,GAAC,MAAAoM,EAAA,eAEGH,EAAKxF,wBAAuB,QAAAc,QAAAC,QACIyE,EAAK1D,aAAalB,IAAc7H,KAAA,SAA9DkJ,GACNuD,EAAKI,qBAAuB3D,EAAUG,UAAU,SAAUC,GACzD,OAAOA,EAASrD,KAAO3D,CACxB,GAAG,MAAAwK,EAAA,cAGFL,EAAKI,wBAA0B,IAC9BpO,EAAOsO,KAAK,sCAAwCtO,EAAOsO,KAAK,2BACjEN,EAAKxF,0BAA4B,MAAK,CAEtCwF,EAAKxF,wBAA0B,KAAK,OAAAc,QAAAC,QAC9ByE,EAAKO,WAAW,CACrB7G,aAAc+C,GAAW/H,OACzB8L,kBAAmB,CAClBhH,GAAI3D,EACJgD,MAAOkH,MAEPxM,KAAA,kBAAA+H,QAAAC,QACIyE,EAAKhB,oBAAkBzL,KAAA,qBAE7ByM,EAAKxF,wBAA0B,IAAK,EAjBlC,GAiBkC,GAAA6F,KAAA9M,KAAA,OAAA8M,EAAA9M,KAAA,iBAvBpC,GAuBoC,OAAA+H,QAAAC,QAAA4E,KAAA5M,KAAA4M,EAAA5M,KAAA0M,KAAAE,GAKvC,CAAC,MAAApM,GAAA,OAAAuH,QAAA9G,OAAAT,EAAA,EAUYuL,iBAAiBmB,EAAyB9B,EAAgC3H,WAAS,IAAiB,OAAAsE,QAAAC,QAC9EtJ,EAAUuJ,gBAA8B,iBAAejI,KAAA,SAAnFmN,GAAmB,OAAApF,QAAAC,QACnBmF,EAAoBpB,iBAAiB3J,EAAgBgJ,EAAW8B,IAAgBlN,KAAA,eACvF,CAAC,MAAAQ,GAAA,OAAAuH,QAAA9G,OAAAT,EAAA,EAUY4M,sBAAqBhC,UAAEA,EAASiC,OAAEA,IAAiD,IAAE,MAAAC,EAGzEhN,KAAI,OAAAyH,QAAAC,QAFMtJ,EAAUuJ,gBAA8B,iBAAejI,KAAA,SAAnFmN,GAAmB,MAAAI,EAAAlM,EACLgM,EAAM,SAAfrB,GAAiB,OAAAjE,QAAAC,QACJsF,EAAKvE,aAAa,OAAK/I,KAAA,SAAxCmJ,GACN,MAAMhD,EAAegD,EAASE,UAAWC,GAAaA,EAASrD,KAAOmF,GACtE,MAAMoC,EAAgBrH,GAAgB,EAAIgD,EAAShD,GAAgB,KACnE,MAAMkF,EAAqBmC,GAAezD,gBAAgBV,UAAWxE,GAAmBA,EAAeoB,KAAO+F,KAAW,EAAE,MAAAyB,EAAA,cACvHpC,GAAsB,EAAC,QAAAtD,QAAAC,QACpBmF,EAAoBO,oBAAoBtL,EAAgB+D,EAAckF,IAAmBrL,KAAA,eAF2B,GAE3B,GAAAyN,KAAAzN,KAAA,OAAAyN,EAAAzN,KAAA,eAEjG,GAAC,GAAAuN,KAAAvN,KAAA,OAAAuN,EAAAvN,KAAA,eACF,CAAC,MAAAQ,GAAA,OAAAuH,QAAA9G,OAAAT,EAAA,EAWYmN,sBAAqB7F,OACjCA,EAAM8F,mBACNA,EAAkBC,yBAClBA,EAAwBC,mBACxBA,IAMA,IAAE,OAAA/F,QAAAC,QACgCtJ,EAAUuJ,gBAA8B,iBAAejI,KAAA,SAAnFmN,GACN,OAAOA,EAAoBY,oBAAoBjG,EAAQ8F,EAAoBC,EAA0BC,EAAoB,EAC1H,CAAC,MAAAtN,GAAA,OAAAuH,QAAA9G,OAAAT,EAAA,EAQYwN,qBAAqBxB,GAAqB,IAAE,IAAAyB,EAAA,YAAAC,EACnD5N,KAAI,SAAA6N,EAAAC,GAAA,OAAAH,EAAAG,EAsBFrG,QAAQC,SAAS,OAAAqG,EAAA,eAtBnBH,EAAKjH,wBAAuB,QAAAc,QAAAC,QACRkG,EAAKnF,gBAAc/I,KAAA,SAArCkJ,GACN,MAAMoF,EAAyBpF,EAAUG,UAAU,SAAUC,GAC5D,OAAOA,EAASrD,KAAO3D,CACxB,GAEA,GAECgM,KAA4B,IAC3B7P,EAAOsO,KAAK,sCAAwCtO,EAAOsO,KAAK,0BAAyB,OAAAwB,EAEnFL,EAAKlB,WAAW,CACtB7G,aAAc+C,EAAU/H,OACxB8L,kBAAmB,CAClBhH,GAAI3D,EACJgD,MAAOkH,EACPgC,QAAS,QAETP,EAAA,YAAAM,CAAA,KAIoB,GAJpB,OAAAxG,QAAAC,QAAAqG,KAAArO,KAAAqO,EAAArO,KAAAmO,KAAAE,GAKL,CAAC,MAAA7N,GAAA,OAAAuH,QAAA9G,OAAAT,EAAA,EAWYwM,WAAWyB,GAAqB,IAC5C,MAAMtI,aAAEA,EAAY8G,kBAAEA,GAAsBwB,EAAY,OAAA1G,QAAAC,QACrBtJ,EAAUuJ,gBAA8B,iBAAejI,KAAA,SAApFkI,GAAoB,OAAAH,QAAAC,QACpBE,EAAqB8E,WAAW5K,EAAgB+D,EAAc,IAChE8G,EACHuB,QAAS,QACRxO,KAAA,eACH,CAAC,MAAAQ,GAAA,OAAAuH,QAAA9G,OAAAT,EAAA,EASYkO,yBACZtD,EACAuD,EAAe,MACf7G,EAAiB1F,GAAc,IACG,MAAAwM,EACctO,KAAI,OAAAyH,QAAAC,QAAJ4G,EAAKlG,aAAaiG,EAAc,MAAO7G,IAAO9H,KAAA,SAAxF6O,GAAiC,GACnCzD,EAAS,CACZ,OAAOyD,EAAMxG,KAAMvC,GAASA,EAAK4E,WAAa5E,EAAKG,KAAOmF,IAAY0D,MAAQ,EAAG,MAEjF,OAAOD,EAAMhJ,OAAQC,IAAUA,EAAK4E,UAAY,GAElD,CAAC,MAAAlK,GAAA,OAAAuH,QAAA9G,OAAAT,EAAA,EAQYuO,YAAYC,EAA0BC,GAAwB,IAAE,MAAAC,EAOpE5O,KAAI,OAAAyH,QAAAC,QAN6BtJ,EAAUuJ,gBAAgB,eAAajI,KAAA,SAA1EmP,GAA0B,OAAApH,QAAAC,QACJmH,EAAiBC,mBAAiBpP,KAAA,SAAxDqP,GACN,MAAMC,EAAeD,EAAchH,KAAMkH,GAAgBA,EAAYtJ,KAAO5D,GAC5E,MAAMkN,EAAcD,GAAcE,UAAUnH,KAAMkH,GAAgBA,EAAYtJ,KAAO7D,GAAgB,OAAA2F,QAAAC,QAC/FmH,EAAiBM,YAAYhN,EAAmBuM,GAAWO,IAAYvP,KAAA,kBACzEiP,EACIC,EAAKQ,kBAAkBT,GAExBlH,QAAQC,SAAS,MACzB,CAAC,MAAAxH,GAAA,OAAAuH,QAAA9G,OAAAT,EAAA,EAUYmP,iBAAiB5J,EAAeqF,EAAoBuD,EAAe,OAAK,IAAE,MAAAiB,EAClDtP,KAAI,OAAAyH,QAAAC,QAAJ4H,EAAKlB,yBAAyBtD,EAAWuD,IAAa3O,KAAA,SAApF6P,GACN,OAAOA,EAAsBxH,KAAMyH,GAAyBA,EAAqB/J,QAAUA,EAAO,EACnG,CAAC,MAAAvF,GAAA,OAAAuH,QAAA9G,OAAAT,EAAA,EAYYkP,kBAAkBT,GAK9B,IAAE,MAAAc,EAEFzP,KAAI,OAAAyH,QAAAC,QAD8BtJ,EAAUuJ,gBAA8B,iBAAejI,KAAA,SAAnFmN,GACN4C,EAAK7I,gBAAkB,KACvB,OAAOiG,EAAoBuC,kBAC1BtN,EACA6M,EAAWrB,mBACXqB,EAAWpB,yBACXoB,EAAWe,mBACXf,EAAWgB,yBACV,EACH,CAAC,MAAAzP,GAAA,OAAAuH,QAAA9G,OAAAT,EAAA,EAUM6L,qBAAqB6D,EAA8CC,GACzE,OAAOD,EAAqBrK,OAAO,CAACC,EAAMsK,EAAW1K,KACpD,MAAM2K,EAAc3K,EAAM2D,UAAWiH,GAAaA,EAASvK,QAAUD,EAAKC,OAC1E,OAAOoK,EAAuBE,IAAgBD,EAAYC,IAAgBD,GAE5E,CASQ9D,qBAAqBiE,GAC5B,MAAMC,EAAsC,GAC3CtH,EAAwB,GACzB,IAAIuH,EAEJhL,EAAmB8K,GAAe5K,QAASG,IAC1C,GAAIA,EAAKI,YAAYoF,iBAAkB,CACtCkF,EAAY1O,KAAKgE,EAClB,KAAO,CACN2K,EAAmBvH,EAAUb,KAAMiB,GAAaA,EAASoB,WAAapB,EAASrD,KAAOH,EAAKI,YAAYkF,WAEvG,IAAKqF,EAAkB,CACtBvH,EAAUpH,KAAK,CACdmE,GAAIH,EAAKI,YAAYkF,UACrBsF,MAAO5K,EAAKI,YAAYC,aACxBb,MAAOQ,EAAKI,YAAYiF,cAAgB,GACxCwF,MAAO,IACPpG,QAASrI,IAAmBsI,IAC5BG,KAAM,yBACND,UAAW,KACX5C,OAAQhC,EAAKgC,OACbyD,gBAAiBzF,EAAKI,YAAYqF,gBAClCuD,KAAM,CAAChJ,IAET,KAAO,CACN2K,EAAiB3B,MAAMhN,KAAKgE,GAC5B2K,EAAiBE,MAAQF,EAAiB3B,MAAM3N,OAAOyP,UACxD,CACD,IAID,MAAO,IAAI1H,KAAc5I,KAAK+L,qBAAqBmE,EAAa,OACjE,CAUa9G,YAAYkE,EAA4BoC,GAA0B,IAC9E,OAAAjI,QAAAC,QAAOtJ,EAAUuJ,gBAAgB,SAASjI,KAAK,SAAU6Q,GAIxD,MAAMC,EAAqBD,EAAcE,aAAa3O,GACtD,OAAOyO,EAAcnH,YAAYoH,EAAYlD,EAAoBoC,EAClE,GACD,CAAC,MAAAxP,GAAA,OAAAuH,QAAA9G,OAAAT,EAAA,EAQMwQ,kBAAkBC,GACxB,MAAMC,EAAY,IAAIC,gBAAgBC,OAAOC,SAASC,QACtD,OAAOJ,GAAWK,IAAIN,IAAQO,gBAAkB,QAAU,KAC3D,CAQcC,uBAAuB5J,EAAyB,OAAK,IAAqB,IAAA6J,EAAA,YAAAC,EAClFrR,KAAI,SAAAsR,EAAAC,GAAA,OAAAH,EAAAG,EAeFF,EAAKG,mBAAmB,OAAAC,EAAA,eAf1BJ,EAAKG,qBAAuBjK,EAAa,QAAA7F,EAAA,WACzC,OAAA+F,QAAAC,QACqBrF,EAAWqP,QAAQzP,IAAwBvC,KAAA,SAAAiS,GAAnE,MAAMC,EAAQD,EAIdN,EAAKG,oBACJI,GAAUxS,OAAOmM,IAAK5G,GACdA,EAAKkN,SACP,EAAG,EACX,EAAC,SAAQ9O,GACRjF,EAAIiF,MAAM,mCAAsCA,EAAgBE,SAAS,MAAA6O,EAClErK,QAAQC,QAAQ,IAAG0J,EAAA,YAAAU,CAC3B,EAAC,EAE6B,GAF7B,OAAArK,QAAAC,QAAA+J,KAAA/R,KAAA+R,EAAA/R,KAAA4R,KAAAG,GAGH,CAAC,MAAAvR,GAAA,OAAAuH,QAAA9G,OAAAT,EAAA,EAQY6R,kBAAe,IAAG,IAAAC,EAAA,YAAAC,EACzBjS,KAAI,SAAAkS,EAAAC,GAAA,OAAAH,EAAAG,EAWF1K,QAAQC,QAAQuK,EAAKG,eAAe,OAAAC,EAAA,eAXtCJ,EAAKG,eAAc,QAAA1Q,EAAA,WACnB,OAAA+F,QAAAC,QAC6BtJ,EAAUuJ,gBAAmC,sBAAoBjI,KAAA,SAA3F4S,GACNL,EAAKG,eAAiBE,EAAkBC,QAAQ,CAAEC,iCAAkC,QAAS,MAAAC,EACtFR,EAAKG,eAAcJ,EAAA,YAAAS,CAAA,EAC3B,EAAC,SAAQ1P,GACRkP,EAAKG,eAAiBjP,UACtBrF,EAAIiF,MAAMA,aAAiBC,MAAQ,qCAAuCD,EAAME,QAAUC,OAAOH,IAAQ,MAAA2P,EAClG,GAAEV,EAAA,YAAAU,CACV,EAAC,EAEyC,GAFzC,OAAAjL,QAAAC,QAAA2K,KAAA3S,KAAA2S,EAAA3S,KAAAwS,KAAAG,GAGH,CAAC,MAAAnS,GAAA,OAAAuH,QAAA9G,OAAAT,EAAA,EAQOyS,0BAA0BC,GACjC,OAAOA,GAAMC,WAAWC,UAAUC,eAAeC,uBAClD,CASQC,qBAAqBC,GAC5B,MAAMC,EAAcD,EAAS,YAAYC,YAGzC,MAAMC,EAAwBF,EAAS,uBAAyBC,GAAaE,YAE7E,IAAKD,EAAuB,CAC3B,OAAO,KACR,CAEA,MAAME,EAAQJ,EAAS,uBAAuBI,MAG9C,GAAIC,MAAMC,QAAQF,GAAQ,CACzB,OAAOtT,KAAKmH,wBAAwBsM,cAAcH,EAAM,MAAQtT,KAAK2S,0BAA0BW,EAAM,GACtG,CAEA,MAAMI,EAAaC,OAAOpS,OAAO+R,GACjC,GAAII,EAAW7S,OAAS,EAAG,CAC1B,OAAO6S,EAAWnN,KAAMqM,UAEfA,IAAS,UAAY5S,KAAKmH,wBAAwBsM,cAAcb,KAAU5S,KAAK2S,0BAA0BC,GAGnH,CACA,OAAO,KACR,CASQgB,eAAeC,GACtB,OAAO,IAAIpM,QAAQ,SAAUC,GAC5B,MAAMoM,EAAaD,IAAY,YAAYV,YAC3C,MAAME,EAAcS,GAAYT,YAChC,IAAIU,GAA4BV,GAAaP,UAAUkB,aAAe,IACpEzI,IAAK0I,GAAiBH,IAAaG,IAAOC,KAAO,IACjD3O,OAAO4O,SAET,MAAMC,EAAa,IAAIlW,EAAamV,GAAaa,IAAe,CAC/DG,cAAeN,EACfO,sBAAuB,OAExBF,EAAWG,qBAAqB,KAC/B7M,EAAQ0M,KAETA,EAAWI,qBAAqB,KAC/B9M,EAAQ0M,IAEV,EACD,CASQK,cAAcvB,GACrB,MAAMI,EAAQJ,EAAS,uBAAuBI,MAC9C,GAAIC,MAAMC,QAAQF,GAAQ,CACzB,OAAOA,EAAM,GAAGoB,SACjB,MAAO,GAAIpB,EAAO,CACjB,IAAK,MAAMpJ,KAAOoJ,EAAO,CACxB,MAAM3O,EAAO2O,EAAMpJ,GACnB,GAAIlK,KAAKmH,wBAAwBsM,cAAc9O,GAAO,CACrD,OAAOA,EAAK+P,SACb,CACD,CACD,CACA,OAAOvR,SACR,CAUcwR,SAASzB,EAAwB0B,GAAmB,IAAE,MAAAC,EAInE7U,KAAI,SAAA8U,IAUJ,OAAOD,EAAKE,eAAeC,EAAa,CAZxC,MAAMC,EAAgB/B,IAAW,aAAa,UAAU,aACxD,MAAM8B,EAAc,IAAIE,IAAID,EAAeL,GAAaO,KACxDN,EAAKE,eAAiBF,EAAKE,gBAAkB,CAAC,EAAE,MAAAK,EAAA,eAC3CP,EAAKE,eAAeC,GAAY,QAAAvN,QAAAC,QACN3J,EAAesX,OAAO,CAEnDC,UAAWN,EACXO,MAAO,KACPC,cAAetC,EAAS,aAAa,UAAU,oBAC9CxT,KAAA,SALI+V,GAMNZ,EAAKE,eAAeC,GAAeS,CAAgB,IARJ,GAQI,OAAAhO,QAAAC,QAAA0N,KAAA1V,KAAA0V,EAAA1V,KAAAoV,KAAAM,GAGrD,CAAC,MAAAlV,GAAA,OAAAuH,QAAA9G,OAAAT,EAAA,EAUOwV,4BAA4BC,EAAgBC,GACnD,IAAIC,EAAQ,GACZ,GAAIF,GAAUA,EAAOlR,WAAW,MAAO,CACtCoR,EAAQF,EAAOG,UAAU,EAAGH,EAAO9U,OAAS,EAC7C,MAAO,GAAI8U,GAAUA,EAAOlR,WAAW,KAAM,CAC5CoR,EAAQF,EAAOG,UAAU,EAAGH,EAAO9U,OAAS,EAC7C,CACA,OAAOgV,EAAQD,EAAIG,QAAQF,GAASF,CACrC,CASOK,6BACN,OAAOpT,KAAKC,MAAMD,KAAKqT,UAAUnV,GAClC,CAacoV,qBACbC,EACAC,EACAC,EACAC,GAAyB,IACY,MAAAC,EAGVvW,KAAI,OAAAyH,QAAAC,QAAAhG,EAAA,WAF3B,SAAA8U,IAyDH,OAAOD,EAAKpP,wBAAwBsP,oBAAoBC,EAAWJ,EAAapD,EAAUyD,EAAuB,CAxDjH,MAAMzD,EAAWkD,EAAYlD,SAC7B,MAAM0D,EAAoBL,EAAK9B,cAAcvB,GAC7C,IAAK0D,EAAmB,CACvB,OAAOzT,SACR,CAEA,MAAM0T,EAAgBV,EAAUW,kBAAkBF,GAClD,MAAMG,EAAkBR,EAAKpP,wBAAwB6P,mBAAmBb,EAAWjD,EAAU0D,GAE7F,IAAKG,GAAiBE,SAAU,CAC/B,OAAO9T,SACR,CAEA,MAAM+T,EAAgBH,EAAgBrC,WAAakC,EACnD,MAAMlC,EACLwC,IAAkBN,EAAoBC,EAAgBV,EAAUW,kBAAkBI,GAEnF,MAAMC,EAAahB,EAAUiB,mBAAmB1C,EAAUyC,YAC1D,MAAMR,EAAwBI,GAAiBM,aAAa,6BAG5D,GAAId,EAAKpP,wBAAwBmQ,uBAAuB5C,EAAWyC,GAAYI,UAAW,CACzF,OAAOpU,SACR,CAGA,MAAMqU,EAAmBjB,EAAKpP,wBAAwBsQ,kCAAkCtB,EAAWe,EAAe,MAClH,GAAIM,GAAkBN,eAAiBM,GAAkBxR,YAAYnF,OAAQ,CAC5E,MAAM6W,EAAiBvB,EAAUW,kBAAkBU,EAAiBN,eACpE,GAAIX,EAAKpP,wBAAwBmQ,uBAAuBI,EAAgBF,EAAiBxR,YAA2B,CACnH,OAAO7C,SACR,CACD,CAEA,MAAMuT,EAAYH,EAAKpP,wBAAwBwQ,qBAAqBzE,EAAU6D,EAAiBV,EAAYF,GAG3G,GAAIO,EAAUkB,QAAQ/W,OAASY,EAAe,CAC7C,OAAO0B,SACR,CAGA,MAAM0U,EAAad,GAAiBc,WACpC,MAAMC,EAAYD,EAAWE,gBAAgB7U,QAAU,GACvDwT,EAAUoB,UAAYA,GAAapB,EAAUoB,UAE7C,MAAAE,EAAA,eACKF,GAAa5E,EAAS,YAAY+E,KAAI,CAC1C,MAAMhD,EAAgB/B,EAAS,WAAW+E,KAAK3C,UAC/C,MAAM4C,EAAWhF,EAAS,WAAWlO,MAAM,MAAAmT,EAAA,cACvClD,IAAkBiD,EAASzT,WAAW,UAAYyT,EAASzT,WAAW,MAAK,QAAAgD,QAAAC,QAC7C6O,EAAK5B,SAASzB,EAAUkD,EAAYrM,MAAIrK,KAAA,SAAnE0Y,GACN1B,EAAUoB,UAAYvB,EAAKb,4BAA4BgB,EAAUoB,UAAYM,EAAoB,IAHvD,GAGuD,GAAAD,KAAAzY,KAAA,OAAAyY,EAAAzY,KAAA,eANnG,GAMmG,OAAAsY,KAAAtY,KAAAsY,EAAAtY,KAAA8W,KAAAwB,EAKpG,EAAC,SAAQlV,GACRhF,EAAIiF,MAAM,kCAAmCD,aAAkBE,MAAQF,EAAOG,QAAUC,OAAOJ,IAC/F,OAAOK,SACR,GACD,CAAC,MAAAjD,GAAA,OAAAuH,QAAA9G,OAAAT,EAAA,EASamY,gBAAgBC,GAAgC,IAA2C,MAAAC,EAGxFvY,KAFhB,MAAMwY,EAAgBF,EAAe/M,IAAG,SAAQ6K,GAAW,IAAK,OAAA3O,QAAAC,QAAAhG,EAAA,WAC3D,OAAA+F,QAAAC,QACW6Q,EAAK3E,eAAewC,EAAYlD,WAASxT,KAAA,SAAA+Y,GAAvD,OAAOA,GAAmDC,cAAe,EAC1E,EAAC,SAAQ5V,GACRhF,EAAIiF,MAAM,iCAAkCD,aAAkBE,MAAQF,EAAOG,QAAUC,OAAOJ,IAC9F,OAAOK,SACR,GACD,CAAC,MAAAjD,GAAA,OAAAuH,QAAA9G,OAAAT,EAAA,IAAE,OAAAuH,QAAAC,QAEUD,QAAQ6D,IAAIkN,GAC1B,CAAC,MAAAtY,GAAA,OAAAuH,QAAA9G,OAAAT,EAAA,EASOyY,8BACPL,EACAM,GAEA,OAAON,EAAeO,OAAmC,CAACC,EAAU1C,EAAahG,KAChF,MAAM+F,EAAYyC,EAAWxI,GAC7B,GAAI+F,EAAW,CACd2C,EAAStX,KAAK,CAAE0R,SAAUkD,EAAaD,aACxC,CACA,OAAO2C,GACL,GACJ,CAScC,iBACbC,EACAC,GAAqB,IACoB,MAAAC,EAIhClZ,KAHT,OAAOyH,QAAQ6D,IACd0N,EAAgBzN,IAAK4N,IACpB,MAAM9C,EAAY4C,EAAMlR,KAAMpD,GAASA,EAAKyU,kBAAkBC,mBAAqBF,EAAKjG,SAASA,WAAW,YAAYvN,IACxH,OAAOuT,EAAKhD,qBAAqBiD,EAAKhD,UAAWgD,EAAKjG,SAAUmD,EAAW6C,EAAK5C,eAGnF,CAAC,MAAApW,GAAA,OAAAuH,QAAA9G,OAAAT,EAAA,EAcOoZ,eAAeC,EAAkBC,EAAmCC,GAC3E,IAAKF,GAASC,GAAoBA,EAAiB3Y,OAAQ,CAC1D,OAAO2Y,EAAiBX,OAAO,CAACa,EAAMC,KACrC,MAAMC,EAAwBH,IAAaE,EAAWhU,KAAO,GAC7D,MAAMkU,EAAeD,EAAM7R,KACzB+R,GAAUA,EAAM9V,iBAAmB2V,EAAW3Y,QAAQgD,gBAAkB8V,EAAM7V,SAAW0V,EAAW3Y,QAAQiD,QAG9G,OAAO4V,EAAe,IAAIH,EAAMG,EAAa1T,SAAYuT,GACvD,GACJ,CACA,OAAOH,GAAS,EACjB,CASaQ,iBAAiBR,EAAkBC,GAAiC,IAA4B,MAAAQ,EAEzDha,KAAI,OAAAyH,QAAAC,QAAAhG,EAAA,WADnD,OAAA+F,QAAAC,QACkCD,QAAQ6D,IAAI,CAAC0O,EAAKjI,kBAAmBiI,EAAKC,qBAAmBva,KAAA,UAA3Fwa,EAAUC,IAAW,OAAA1S,QAAAC,QACF1J,EAAYoc,QAAM1a,KAAA,SAAA2a,GAA5CL,EAAK1D,YAAW+D,EAEhB,MAAMpB,EAAwBtF,OAAOpS,OAAO4Y,GAAYG,OACxD,MAAMb,EAAaO,EAAKjT,cAGxB,MAAMwT,EAAgBP,EAAKV,eAAeC,EAAOC,EAAkBC,GAAY,OAAAhS,QAAAC,QAEvDsS,EAAKQ,eAAeD,EAAeJ,EAAYD,IAASxa,KAAA,SAA1E+a,GACN,MAAMnC,EAAiBmC,EAAUlV,OAAQ6Q,GAAgB4D,EAAK/G,qBAAqBmD,EAAYlD,WAAW,OAAAzL,QAAAC,QAEjFsS,EAAK3B,gBAAgBC,IAAe5Y,KAAA,SAAvDkZ,GACN,MAAMI,EAAkBgB,EAAKrB,8BAA8BL,EAAgBM,GAAY,OAAAnR,QAAAC,QAEnEsS,EAAKjB,iBAAiBC,EAAiBC,IAAMvZ,KAAA,SAA3Dgb,GACN,OAAOA,EAAMnV,OAAQoV,GAASA,IAASxX,UAAW,UACnD,EAAC,SAAQL,GACRhF,EAAIiF,MAAM,qCAAsCD,aAAkBE,MAAQF,EAAOG,QAAUC,OAAOJ,IAClG,MAAO,EACR,GACD,CAAC,MAAA5C,GAAA,OAAAuH,QAAA9G,OAAAT,EAAA,EAUasa,eAAeI,EAAqBC,EAAqBC,GAAsB,IAA6B,OAAArT,QAAAC,QAAAhG,EAAA,WAExH,MAAMqZ,EAAcH,EAAUrP,IAAG,SAAQ9F,GAAK,IAAK,IAAAuV,EAAA,MAClD,MAAMC,EAAuBJ,EAAUpV,IAAU,GAAG,MAAAyV,EAAAna,EACjCka,EAAI,SAAZtW,GACV,MAAMa,EAAOsV,EAAY/S,KACvBoT,GAAYxW,EAAKX,iBAAmBmX,EAAQna,QAAQgD,gBAAkBW,EAAKV,SAAWkX,EAAQna,QAAQiD,QAExG,MAAM2Q,EAAcjQ,GAAMyU,kBAAkBgC,yBAAyBlI,SAAS,qBAC1E1N,GAAQoP,EAAW,QAAAlT,EAAA,WAClB,OAAA+F,QAAAC,QACoB2T,MAAMzG,IAAYlV,KAAA,SAAnCkS,GAAQ,OAAAnK,QAAAC,QACUkK,EAAS0J,QAAM5b,KAAA,SAAA6b,GAAvC,MAAMrI,EAAQqI,EAA2C,MAAAC,EAClD,CAAEzR,IAAK6H,EAAS7H,IAAKmJ,YAAU8H,EAAA,YAAAQ,CAAA,IACvC,EAAC,SAAQzY,GACRjF,EAAIiF,MAAM,gCAAiCA,aAAiBC,MAAQD,EAAME,QAAUC,OAAOH,IAAQiY,EAAA,YAC5F7X,SACR,EAAC,EAT4E,EAW/E,EAAC,kBAAA6X,CAAA,UAAAvT,QAAAC,QAAAwT,KAAAxb,KAAAwb,EAAAxb,KAAA,SAAA+b,GAAA,OAAAT,EAAAS,EAEMtY,SAAS,GAAA6X,EAAAE,EAAT/X,UACR,CAAC,MAAAjD,GAAA,OAAAuH,QAAA9G,OAAAT,EAAA,IAAE,OAAAuH,QAAAC,QACmBD,QAAQ6D,IAAIyP,IAAYrb,KAAA,SAAxCgc,GACN,OAAOA,EAAQnW,OAAQ2N,GAAyCA,IAAa/P,UAAW,EACzF,EAAC,SAAQL,GACRhF,EAAIiF,MAAM,mCAAoCD,aAAkBE,MAAQF,EAAOG,QAAUC,OAAOJ,IAChG,MAAO,EACR,GACD,CAAC,MAAA5C,GAAA,OAAAuH,QAAA9G,OAAAT,EAAA,EASOyb,sBAAsBC,GAC7B,MAAMC,EAAqC,CAAC,EAC5C,MAAMC,EAAmB,GACzBF,EAAOvW,QAAS0W,IACf,MAAMC,EAAaD,GAAOE,oBAAoB,aAAaC,QAAQlX,OAAS,GAC5E,IAAK6W,EAAUG,GAAa,CAC3BF,EAAQta,KAAKua,GACbF,EAAUG,GAAc,IACzB,IAED,OAAOF,CACR,CAQaK,qBAAkB,IAA0B,MAAAC,EAEjCpc,KAAI,OAAAyH,QAAAC,QAAAhG,EAAA,WADvB,OAAA+F,QAAAC,QACmB0U,EAAKjL,0BAAwBzR,KAAA,SAA7C2c,GAAO,OAAA5U,QAAAC,QACY0U,EAAKrC,iBAAiBsC,IAAQ3c,KAAA,SAAjD4c,GACN,MAAMC,EAAgBD,GAAYE,MAAM,EAAGta,GAC3C,MAAMua,EAAoBF,GAAehR,IAAK2H,IAC7C,IAAIvN,EACJ,GAAIuN,IAAW,YAAa,CAC3BA,EAAS,YAAYwJ,IAAM,KAC3B/W,EAAKuN,EAAS,YAAYvN,EAC3B,CACA,MAAO,CACNA,KACAsW,kBAAmB/I,KAGrB,OAAOkJ,EAAKT,sBAAsBc,EAA8B,IACjE,EAAC,SAAQ1Z,GACRjF,EAAIiF,MAAM,0CAA2CA,aAAiBC,MAAQD,EAAME,QAAUC,OAAOH,IACrG,MAAO,EACR,GACD,CAAC,MAAA7C,GAAA,OAAAuH,QAAA9G,OAAAT,EAAA,EAeYyc,6BAA6BtO,EAAwB,OAAK,IAAE,MAAAuO,EACnE5c,KAAI,SAAA6c,IA4BT,OAAOD,EAAKE,0BAA2B,OAAAC,EAAA,eA5BlCH,EAAKE,4BAA8BzO,EAAY,QAAA5G,QAAAC,QACjBkV,EAAKzL,uBAAuB9C,IAAa3O,KAAA,SAArE8R,GAAmB,MAAAwL,EAAA,cACrBxL,EAAoB3Q,OAAM,CAC7B,IAAIoc,EAA+C,GACnD,IAAIC,EAAqD,GAAG,OAAAzV,QAAAC,QACID,QAAQ6D,IAAI,CAC3EsR,EAAKO,6BAA6B3L,GAClCoL,EAAKvT,eAAegF,MACnB3O,KAAA,UAHG0d,EAA2B9W,IAKhC8W,EAA4BA,EAA0B7X,OAAQW,GAC7DG,EAA6BH,EAAQI,IAEtC8W,EAA0B/X,QAASa,IAClC,GAAID,EAA6BC,GAAS,CACzCgX,EAA2B1b,KAAK0E,EACjC,KAAO,CACN+W,EAAqBzb,KAAK0E,EAC3B,IAGD0W,EAAKE,2BAA6BG,EAChCT,MAAM,EAAG,GAAKU,EAA2Brc,QACzCwc,OAAOH,EAA4B,QAErCN,EAAKE,2BAA6B,EAAG,EAxBb,GAwBa,GAAAE,KAAAtd,KAAA,OAAAsd,EAAAtd,KAAA,iBAGA,GAHA,OAAA+H,QAAAC,QAAAqV,KAAArd,KAAAqd,EAAArd,KAAAmd,KAAAE,GAIxC,CAAC,MAAA7c,GAAA,OAAAuH,QAAA9G,OAAAT,EAAA,EAUaod,kBAAe,IAAG,OAAA7V,QAAAC,QAAAhG,EAAA,WAC3B,OAAA+F,QAAAC,QACmBtJ,EAAUuJ,gBAA4C,+BAA6BjI,KAAA,SAAnG6d,GACN,OAAOA,GAASC,WAAWC,YAAc,EAAG,EAC7C,EAAC,SAAQ1a,GACRjF,EAAIiF,MAAM,sCAAyCA,EAAgBE,SACnE,MAAO,EACR,GACD,CAAC,MAAA/C,GAAA,OAAAuH,QAAA9G,OAAAT,EAAA,EAYa+Z,kBAAe,IAAsB,MAAAyD,EAEhC1d,KAAI,OAAAyH,QAAAC,QAAAhG,EAAA,WADlB,SAAAic,IA4BH,OAAOD,EAAK1W,YAAa,OAAA4W,EAAA,eA3BpBjK,OAAOkK,KAAKH,EAAK3W,eAAelG,OAAM,CAC1C6c,EAAK3W,cAAgB,CAAC,EACtB2W,EAAK1W,aAAe,CAAC,EAAE,OAAAS,QAAAC,QACAgW,EAAKJ,mBAAiB5d,KAAA,SAAvCoe,GACNA,EAASzY,QAAS0Y,IACjB,MAAM5X,EAAU4X,GAAOC,WAAWhY,aAAa,iBAAiBiY,cAAc7e,MAC9E,MAAM8e,EAAcH,GAAO3E,kBAAkBC,iBAC7C,GAAIlT,EAAS,CACZ,MAAMgY,EAA6B,CAClCla,OAAQ8Z,EAAM9Z,OACdD,eAAgB+Z,EAAM/Z,eACtBoV,iBAAkB2E,EAAM3E,kBAEzBsE,EAAK1W,aAAab,GAAWuX,EAAK1W,aAAab,IAAY,GAC3DuX,EAAK1W,aAAab,GAAS3E,KAAK2c,GAIhC,GAAID,EAAa,CAChB,MAAME,EAA6B,IAAKD,EAAchY,WAEtDuX,EAAK3W,cAAcmX,GAAeR,EAAK3W,cAAcmX,IAAgB,GACrER,EAAK3W,cAAcmX,GAAa1c,KAAK4c,EACtC,CACD,GACE,IAEqB,GAFrB,OAAAR,KAAAle,KAAAke,EAAAle,KAAAie,KAAAC,EAGL,EAAC,SAAQ9a,GACRhF,EAAIiF,MAAMD,aAAkBE,MAAQF,EAAOG,QAAUC,OAAOJ,IAC5D,MAAO,CAAC,CACT,GACD,CAAC,MAAA5C,GAAA,OAAAuH,QAAA9G,OAAAT,EAAA,EAeaid,6BAA6BkB,GAAkB,IAAE,MAAAC,EAGXte,KAFnD,MAAMyJ,EAAyC,GAC/C,MAAM8U,EAA8C,IAAIC,IAAuB,OAAA/W,QAAAC,QACzCD,QAAQ6D,IAAI,CAACgT,EAAKhB,kBAAmBgB,EAAKvM,qBAAmBrS,KAAA,UAA5Foe,EAAUW,IACjBJ,EAAShZ,QAASc,IAEjB,MAAMuY,EAAiBZ,EAASvY,OAAO,SAAUoZ,GAChD,OAAOA,GAASX,UAAUhY,WAAW,iBAAiBiY,cAAc7e,QAAU+G,CAC/E,GACAuY,EAAerZ,QAASuZ,IAEvB,IAAIC,EAAyBJ,EAAYlZ,OAAQuZ,GACzCA,GAAY9d,QAAQgD,iBAAmB4a,EAAI5a,gBAAkB8a,EAAW9d,OAAOiD,SAAW2a,EAAI3a,QAGtG,MAAM8a,EAAoBF,EAAuBtZ,OAAQyZ,GACxDjZ,EAAoBiZ,IAErB,MAAMC,EAAuBJ,EAAuBtZ,OAClDyZ,IAA2BjZ,EAAoBiZ,IAGjD,GAAID,EAAkBle,OAAS,GAAKoe,EAAqBpe,OAAS,EAAG,CACpEge,EAAyB,IAAII,EAC9B,CAEAJ,EAAuBxZ,QAAS2Z,IAC/B,IAAItZ,EAAgBsZ,EAAsBvV,eAAe,GACzD,IAAIyV,EAAiD,CACpDla,MAAOU,EAAcV,MACrBC,SAAUS,EAAcT,SACxBoF,KAAM3E,EAAc2E,KACpBN,IAAKrE,EAAcoE,UACnB4B,MAAOhG,EAAcgG,MACrBvF,QAASA,EACTT,cAAeA,GAGhB,IACE6Y,EAAsBY,IAAID,EAAyBnV,OACnDwU,EAAsBY,IAAID,EAAyBla,OACnD,CACDuZ,EAAsBa,IAAIF,EAAyBnV,IAAM,MACzDwU,EAAsBa,IAAIF,EAAyBla,MAAQ,MAC3DyE,EAAejI,KAAK0d,EACrB,QAIH,OAAOzV,CAAe,EACvB,CAAC,MAAAvJ,GAAA,OAAAuH,QAAA9G,OAAAT,EAAA,EASYmf,mBAAmB/L,EAAgBgM,GAAsB,IAAmC,IAAAC,EAAA,YAAAC,EAGtGxf,KAAI,OAAAyH,QAAAC,QAAAhG,EAAA,WAFF,SAAA+d,EAAAC,GAAA,OAAAH,EAAAG,EAmBI,EAAE,OAAAC,EAAA,cAlBLrM,EAAK,CACRkM,EAAK1Y,uBAAyB0Y,EAAK1Y,wBAA0B,GAE7D,MAAM8Y,EAAcJ,EAAK1Y,uBAAuB+R,OAAO,CAACgH,EAAmBna,KAC1E,GAAIA,EAAc8B,SAAWqY,EAAQzZ,SAASV,EAAc8B,QAAS,CACpEqY,EAAQre,KAAKkE,EAAc8B,OAC5B,CACA,OAAOqY,GACL,IACH,MAAMC,EAAUxM,EAAM/H,IAAKqH,GAASA,EAAKpL,QACzC,MAAMuY,EAAwBH,EAAY/e,SAAW,IAAM+e,EAAYI,MAAOxY,GAAWsY,EAAQ1Z,SAASoB,IAAS,IAC9G8X,IAAiBS,EAAqB,OAAAE,EACnCT,EAAK1Y,uBAAsByY,EAAA,YAAAU,CAAA,aAAAxY,QAAAC,QAEE8X,EAAKU,2BAA2B5M,EAAOgM,IAAa5f,KAAA,SAAAygB,GAAxFX,EAAK1Y,uBAAsBqZ,EAA8D,MAAAC,EAClFZ,EAAK1Y,uBAAsByY,EAAA,YAAAa,CAAA,KAG3B,GAH2B,OAAAT,KAAAjgB,KAAAigB,EAAAjgB,KAAA+f,KAAAE,EAIrC,EAAC,SAAQ5c,GACRjF,EAAIiF,MAAMA,GACV,MAAO,EACR,GACD,CAAC,MAAA7C,GAAA,OAAAuH,QAAA9G,OAAAT,EAAA,EASaggB,2BACb5M,EACAjF,EAAe,MACfgS,EAA0B,OAAK,IACG,MAAAC,EAOZtgB,KANtB,MAAMugB,EAAc/Y,GACZ8L,EAAMvL,KAAM6K,GAASA,EAAKpL,SAAWA,IAASyC,SAAWrI,IAAmBsI,IAClF,OAAAzC,QAAAC,QAAAhG,EAAA,WAGD,MAAM8e,EAAgD,GAAG,OAAA/Y,QAAAC,QACpC4Y,EAAKG,UAAUnN,EAAOjF,IAAa3O,KAAA,SAAlDghB,GAEN,IAAK,MAAM9N,KAAQ8N,EAAQ,CAC1B,MAAM7X,EAAW+J,GAAM/J,UAAY,GACnC,IAAK,MAAM8X,KAAW9X,EAAU,CAC/B,MAAMY,EAAiBkX,EAAQlX,gBAAkB,GACjD,IAAK,MAAM/D,KAAiB+D,EAAgB,CAC3C,MAAMmV,EAAM,CACXnZ,MAAOC,EAAcoE,UACrB4B,MAAOhG,EAAcgG,MACrBrB,KAAM3E,EAAc2E,KACpBJ,QAASsW,EAAW3N,EAAKjN,IACzB6B,OAAQoL,EAAKjN,IAEd,IAAK0a,IAA4BG,EAAsBja,KAAMqa,GAAYA,EAAQnb,QAAUmZ,EAAInZ,OAAQ,CACtG+a,EAAsBhf,KAAKod,EAC5B,CACD,CACD,CACD,CACA,OAAO4B,CAAsB,EAC9B,EAAC,SAAQzd,GACRjF,EAAIiF,MAAMA,GACV,MAAO,EACR,GACD,CAAC,MAAA7C,GAAA,OAAAuH,QAAA9G,OAAAT,EAAA,EAQaugB,UAAUnN,EAAgBjF,EAAwB,OAAK,IAAoB,MAAAwS,EAC3C7gB,KAAI,OAAAyH,QAAAC,QAApCD,QAAQ6D,IAAIgI,EAAM/H,IAAKqH,GAASiO,EAAKvZ,uBAAuB+G,EAAcuE,EAAKpL,UAC7F,CAAC,MAAAtH,GAAA,OAAAuH,QAAA9G,OAAAT,EAAA,GACD,OAAAuG,CAAA","ignoreList":[]}