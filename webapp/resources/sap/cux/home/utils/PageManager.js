/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)
 *  * (c) Copyright 2009-2025 SAP SE. All rights reserved
 */
sap.ui.define(["sap/ui/base/Object","sap/ui/core/EventBus","sap/ushell/Config","sap/ushell/Container","./ColorUtils","./Constants","./PagesIconsConstants","./UshellPersonalizer"],function(e,o,n,t,r,s,a,i){"use strict";function c(e){return e&&e.__esModule&&typeof e.default!=="undefined"?e.default:e}const l=c(r);const u=s["CUSTOM_SPACEID"];const f=s["DEFAULT_BG_COLOR"];const P=s["FALLBACK_ICON"];const g=s["fnFetchLegendColor"];const h=s["MYHOME_SPACE_ID"];const d=s["PAGE_SELECTION_LIMIT"];const p=a["PAGES"];const v=a["SPACES"];const C=c(i);const I=e.extend("sap.cux.home.utils.PageManager",{constructor:function n(t,r){e.prototype.constructor.call(this);this.colorUtils=l;this.persContainerId=t;this.oOwnerComponent=r;this._eventBus=o.getInstance()},_getPersonalization:function e(){return C.getInstance(this.persContainerId,this.oOwnerComponent)},fetchAllAvailableSpaces:function e(){try{const e=this;if(e._aSpaces){return Promise.resolve(e._aSpaces)}return Promise.resolve(t.getServiceAsync("BookmarkV2")).then(function(o){return Promise.resolve(o.getContentNodes()).then(function(o){const n=o;e._aSpaces=n.filter(e=>e.id!==h);e._aSpaces.forEach(function(e){e.BGColor=f();e.applyColorToAllPages=false});return e._aSpaces})})}catch(e){return Promise.reject(e)}},fetchAllAvailablePages:function e(o=false){try{const e=this;if(e._aPages){return Promise.resolve(e._aPages)}return Promise.resolve(e.fetchAllAvailableSpaces()).then(function(n){e._aPages=[];n.forEach(n=>{if(Array.isArray(n.children)){n.children.forEach(t=>{if(!o||o&&!e._aPages.find(e=>e.id===t.id)){e._aPages.push({title:t.label,icon:P,isIconLoaded:false,pageId:t.id,spaceId:n.id,spaceTitle:n.label,url:"#Launchpad-openFLPPage?pageId="+t.id+"&spaceId="+n.id})}})}});return e._aPages})}catch(e){return Promise.reject(e)}},hasCustomSpace:function e(){try{const e=this;return Promise.resolve(e.fetchAllAvailableSpaces()).then(function(e){return e.some(e=>e.id===u)})}catch(e){return Promise.reject(e)}},_getDefaultPages:function e(o){const n=o.slice(0,d)||[];return this.getFavPages(n)},_getIconForPage:function e(o){let n=p.find(e=>o.pageId?.includes(e.id));if(!n){n=v.find(e=>o.spaceId?.includes(e.id))}o.icon=n?.icon||P;o.isIconLoaded=true},_applyIconsForFavPages:function e(o){const n=o.filter(e=>!e.isIconLoaded);n.forEach(e=>{this._getIconForPage(e)})},getFavPages:function e(o,n=false){try{const t=this;function r(){if(o.length){t._applyIconsForFavPages(o)}return o}o.forEach(e=>{e.selected=true;if(!e.BGColor){e.BGColor=t.colorUtils.getFreeColor()}else{t.colorUtils.addColor(e.BGColor)}});const s=function(){if(n){function e(){return Promise.resolve(t.oPersonalizer.read()).then(function(e){if(!e)e={favouritePages:[]};e.favouritePages=o;return Promise.resolve(t.oPersonalizer.write(e)).then(function(){t._eventBus.publish("pageChannel","pageUpdated")})})}const r=function(){if(!t.oPersonalizer){return Promise.resolve(t._getPersonalization()).then(function(e){t.oPersonalizer=e})}}();return r&&r.then?r.then(e):e(r)}}();return Promise.resolve(s&&s.then?s.then(r):r(s))}catch(a){return Promise.reject(a)}},getFavoritePages:function e(o=false){const t=encodeURIComponent(n.last("/core/spaces/enabled"));if(!t){return Promise.resolve([])}if(this.aFavPages&&!o){return Promise.resolve(this.aFavPages)}if(this.oGetFavPagesPromise===undefined){this.oGetFavPagesPromise=this._getFavPages(o)}return this.oGetFavPagesPromise},_getFavPages:function e(o){try{const e=this;return Promise.resolve(e._getPersonalization()).then(function(n){e.oPersonalizer=n;return Promise.resolve(e.oPersonalizer.read()).then(function(n){const t=n?.favouritePages;return Promise.resolve(e.fetchAllAvailablePages(true)).then(function(r){function s(){return e.aFavPages}const a=function(){if(!t){return Promise.resolve(e._getDefaultPages(r)).then(function(o){e.aFavPages=o})}else{let s=[],a;t?.forEach(e=>{a=r.find(function(o){return o.pageId===e.pageId});if(a){a.BGColor=e.BGColor;s.push(a)}});s=s.slice(0,d);const i=function(){if(s.length||!t?.length){return Promise.resolve(e.getFavPages(s,s.length!==t?.length||o)).then(function(o){e.aFavPages=o})}else{const o=function(){if(!s.length&&t.length){n.favouritePages=[];return Promise.resolve(e.oPersonalizer.write(n)).then(function(){return Promise.resolve(e._getDefaultPages(r)).then(function(o){e.aFavPages=o})})}}();if(o&&o.then)return o.then(function(){})}}();if(i&&i.then)return i.then(function(){})}}();return a&&a.then?a.then(s):s(a)})})})}catch(e){return Promise.reject(e)}},applyColorPersonalizations:function e(o){try{const n=this;function t(){return Promise.resolve(n.fetchAllAvailableSpaces()).then(function(e){o.forEach(o=>{const t=!!o.pageId;const r=e?.find(e=>e.id===o.spaceId);const s=r?.children.find(e=>e.id===o.pageId);const a=n.aFavPages.find(e=>e.pageId===o.pageId);const i=n._aPages?.find(e=>e.pageId===o.pageId);if(!t&&r){const e=g(o.BGColor);r.BGColor=e;r.applyColorToAllPages=o.applyColorToAllPages;r.isSpacePersonalization=true;r.children.forEach(e=>{const t=n.aFavPages.find(o=>o.pageId===e.id);if(t){const n=t.isPagePersonalization?t.oldColor:f();t.BGColor=r.applyColorToAllPages?o.BGColor:n;e.BGColor=t.BGColor}else{e.BGColor=r.applyColorToAllPages?o.BGColor:f();n._aPages.forEach(o=>{if(o.spaceId===r.id){o.BGColor=e.BGColor}})}})}else if(s){const e=r?.applyColorToAllPages?{...r.BGColor}:g(o.BGColor);if(a){a.isPagePersonalization=true;a.BGColor=e;a.oldColor=g(o.BGColor)}s.isPagePersonalization=true;s.BGColor=e;s.oldColor=g(o.BGColor);if(i){i.isPagePersonalization=true;i.BGColor=e;i.oldColor=g(o.BGColor)}}});n._eventBus.publish("pageChannel","pageUpdated")})}if(!o?.length){return Promise.resolve()}const r=function(){if(!n.aFavPages){return Promise.resolve(n.getFavoritePages()).then(function(){})}}();return Promise.resolve(r&&r.then?r.then(t):t(r))}catch(s){return Promise.reject(s)}},applyIconPersonalizations:function e(o){try{const n=this;function t(){return Promise.resolve(n.fetchAllAvailableSpaces()).then(function(e){o.forEach(o=>{const t=!!o.pageId;const r=e?.find(e=>e.id===o.spaceId);if(!t){if(r){r.icon=o.icon;r.isSpaceIconPersonalization=true;r.children.forEach(e=>{if(!e.isPageIconPersonalization){const o=n.aFavPages.find(o=>o.pageId===e.id);if(o){o.icon=r.icon||P;e.icon=r.icon||P}}})}}else{const e=r?.children.find(e=>e.id===o.pageId);const t=n.aFavPages.find(e=>e.pageId===o.pageId);if(e&&t){t.isPageIconPersonalization=true;e.isPageIconPersonalization=true;t.icon=o.icon;e.icon=o.icon;t.oldIcon=o.oldIcon;e.oldIcon=o.oldIcon}}});n._eventBus.publish("pageChannel","pageUpdated")})}if(!o?.length){return Promise.resolve()}const r=function(){if(!n.aFavPages){return Promise.resolve(n._getFavPages(false)).then(function(){})}}();return Promise.resolve(r&&r.then?r.then(t):t(r))}catch(s){return Promise.reject(s)}}});I.oCacheInstances={};I.getInstance=function e(o,n){if(I.oCacheInstances[o]){return I.oCacheInstances[o]}const t=new I(o,n);I.oCacheInstances[o]=t;return t};return I});
//# sourceMappingURL=PageManager.js.map