/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)
 *  * (c) Copyright 2009-2025 SAP SE. All rights reserved
 */
sap.ui.define(["sap/base/i18n/Formatting","sap/base/Log","sap/base/security/encodeURL","sap/base/strings/formatMessage","sap/base/util/deepExtend","sap/ui/base/Object","sap/ui/core/library","../interface/CardsInterface","./Constants","./DataFormatUtils"],function(t,e,a,i,n,r,s,o,l,c){"use strict";const p=o["UIAnnotations"];const u=l["TABLE_TYPES"];const d=c["sortCollectionByImportance"];const f=3;const h=s.ValueState;var g=function(t){t["DataField"]="com.sap.vocabularies.UI.v1.DataField";t["Importance"]="com.sap.vocabularies.UI.v1.Importance";t["DataFieldWithNavigationPath"]="com.sap.vocabularies.UI.v1.DataFieldWithNavigationPath";t["DataFieldWithIntentBasedNavigation"]="com.sap.vocabularies.UI.v1.DataFieldWithIntentBasedNavigation";t["DataFieldForIntentBasedNavigation"]="com.sap.vocabularies.UI.v1.DataFieldForIntentBasedNavigation";t["Chart"]="@com.sap.vocabularies.UI.v1.Chart";t["FieldGroup"]="@com.sap.vocabularies.UI.v1.FieldGroup";t["DataPoint"]="@com.sap.vocabularies.UI.v1.DataPoint";t["Contact"]="@com.sap.vocabularies.Communication.v1.Contact";t["DataFieldForAction"]="com.sap.vocabularies.UI.v1.DataFieldForAction";t["DataFieldForAnnotation"]="com.sap.vocabularies.UI.v1.DataFieldForAnnotation";t["DataFieldWithUrl"]="com.sap.vocabularies.UI.v1.DataFieldWithUrl";t["CriticalityRepresentationTypeWithoutIcon"]="com.sap.vocabularies.UI.v1.CriticalityRepresentationType/WithoutIcon";t["FieldControlHiddenType"]="com.sap.vocabularies.Common.v1.FieldControlType/Hidden";return t}(g||{});var y=function(t){t["DataFieldWithNavigationPath"]="DataFieldWithNavigationPath";t["DataFieldWithIntentBasedNavigation"]="DataFieldWithIntentBasedNavigation";t["DataFieldForIntentBasedNavigation"]="DataFieldForIntentBasedNavigation";t["DataFieldForAction"]="DataFieldForAction";t["DataFieldForAnnotation"]="DataFieldForAnnotation";return t}(y||{});class m extends r{static getInstance(){if(!m.Instance){m.Instance=new m}return m.Instance}getLineItemDetails(t,e,a){const i=t.getODataEntitySet(a);const n=this.getLineItemFromVariant(t,i.entityType);const r=n.lineItem;const s=e["sap.ui.generic.app"]?.pages;const o=this.getSettingsForPage(s);if(!o.quickVariantSelectionX){return this.createDefaultLineItemDetails(t,n,o,a,r)}const l=o.quickVariantSelectionX.variants||{};const{firstAvailableKey:c,sEntitySet:p,oVariant:u}=this.findFirstNonSmartChartVariant(t,l,a);if(u.isSmartChart){return this.createDefaultLineItemDetails(t,n,o,a,r)}delete o.requestAtLeastFields;const d=this.getNormalizedTableSettings(t,o,a);const f=t?.getODataEntitySet(p);const h=this.getLineItemFromVariant(t,f.entityType,u.annotationPath?.split("#")[1]);const g=h.lineItem;const y=h.presentationVariant;o.requestAtLeastFields=y?.RequestAtLeast?.length?y.RequestAtLeast:this._getRequestAtLeastFields(y);u.tableSettings=this.getNormalizedTableSettings(t,{...u,tableSettings:u.tableSettings||d},p);this.validateResponsiveTable(o,u,c);delete o.tableSettings;o.isResponsiveTable=o.isResponsiveTable===undefined||o.isResponsiveTable;const m={quickVariant:u,lrSettings:o,lineItem:g,entitySet:p,headerInfo:u?.tableSettings?.headerInfo||""};return g?m:this.createDefaultLineItemDetails(t,n,o,a,r)}findFirstNonSmartChartVariant(t,e,a){let i=null;let n=a;let r={};for(const s in e){if(!Object.prototype.hasOwnProperty.call(e,s))continue;r=e[s];n=r.entitySet||a;const o=t.getODataEntitySet(n);if(o){r.isSmartChart=this.checkIfSmartChart(t,n,r);if(!r.isSmartChart){i=s;break}}else{r.isSmartChart=true}}return{firstAvailableKey:i,sEntitySet:n,oVariant:r}}validateResponsiveTable(t,a,i){const n=a.tableSettings?.type===u.RESPONSIVE;if(t.isResponsiveTable===undefined){t.isResponsiveTable=n}else if(t.isResponsiveTable!==n){e.error(`Variant with key ${i} resulted in invalid Table Type combination.`)}}createDefaultLineItemDetails(t,e,a,i,n){a.tableSettings=this.getNormalizedTableSettings(t,a,i);a.isResponsiveTable=a.tableSettings.type===u.RESPONSIVE;if(e?.presentationVariant?.RequestAtLeast?.length){a.requestAtLeastFields=e.presentationVariant.RequestAtLeast}return{quickVariant:{},lrSettings:a,lineItem:n,entitySet:i,headerInfo:a?.tableSettings?.headerInfo||""}}getLineItemFromVariant(t,e,a){const i=this.getAnnotation(t,e,p.UISelectionPresentationVariant,a);let n;if(i?.PresentationVariant){n=this.getPresentationVariant(t,e,i.PresentationVariant)}else{n=this.getAnnotation(t,e,p.UIPresentationVariant,a)}const r=n?this.getLineItem(t,e,n):null;const s=r?.lineItem||this.getAnnotation(t,e,p.UILineItem,"");return{presentationVariant:n,lineItem:s,qualifierPath:r?.annotationPath||""}}getAnnotation(t,e,a,i){const n=`${a}${i?`#${i}`:""}`;const r=t.getODataEntityType(e);return r?.[n]}getPresentationVariant(t,e,a){const i=a?.PresentationVariant;if(i?.Path){return this.getObject(t,e,i.Path)}return i}getLineItem(t,e,a){let i=a.Visualizations?.find(function(t){return t.AnnotationPath?.includes(p.UILineItem)});return i?{lineItem:this.getObject(t,e,i.AnnotationPath),annotationPath:i.AnnotationPath,sQualifier:i.AnnotationPath?.split("#")[1]}:null}_getRelevantColumnPaths(t){t=Array.isArray(t)?t:[];const e=new Set;const a=new Set;t.forEach(t=>{if(t){const i=t["leadingProperty"];const n=t["additionalProperty"];const r=t["navigationProperty"];if(i){e.add(i)}this.extractPathAndInsertToSet(n,e);this.extractPathAndInsertToSet(r,a)}});return{select:Array.from(e),expand:Array.from(a)}}extractPathAndInsertToSet(t,e){t?.split(",").forEach(t=>{if(t){e.add(t)}})}extractAndExpandNavigationProperty(t,e,a,i){const n={};for(const r of e){let e=r.lastIndexOf("/");let s;if(e<0){if(!this.getNavigationProperty(t,r,i,n)){continue}s=r}else{s=r.substring(0,e)}if(!a.includes(s)){a.push(s)}}}getNavigationProperty(t,e,a,i){let n=i?.[t];if(!n){n={};i[t]=n;const e=a.getODataEntitySet(t);if(e){const t=a.getODataEntityType(e.entityType);if(t){const e=t.navigationProperty||[];e.forEach(t=>{const e=t.name;n[e]=t})}}}return n?.[e]||undefined}_addNecessaryFields(t,e,a){let i=a.getODataEntitySet(e.entitySet);let n=a.getODataEntityType(i.entityType);let r=[];if(t.length>0){if(e.lineItem&&typeof e.lineItem!=="string"){e.lineItem.forEach(t=>{if(t.RecordType===g.DataFieldWithIntentBasedNavigation||t.RecordType===g.DataFieldWithNavigationPath){const e=this.getDataFieldsWithNavigation(t,a,n);if(e?.length){r=r.concat(e)}}})}this.getFieldControlsPath(t,a,n,r)}r.forEach(e=>{this.ensureSelectionProperty(e,t)})}getFieldControlsPath(t,e,a,i){t.forEach(t=>{if(t){let n=e.getODataProperty(a,t)||{};if(p.CommonFieldControl in n){let t=n[p.CommonFieldControl];if(t?.Path){i.push(t.Path)}}}})}getDataFieldsWithNavigation(t,e,a){const i=[];const n=t.Value?.Path;if(n){const t=e.getODataProperty(a,n);const r=t?.[p.CommonText]?.Path;const s=t?.["sap:text"];i.push(s||r||n)}if(t.SemanticObject?.Path){i.push(t.SemanticObject.Path)}if(t.Action?.Path){i.push(t.Action.Path)}return i}getParameters(t,e,a,i){let n=i.select||[];let r=i.expand||[];let s=t?.lrSettings?.requestAtLeastFields||[];if(s.length>0){n=this._ensureSelectionProperties(n,s)}this._handleMandatorySelectionFields(a,n,e);this._addNecessaryFields(n,t,e);this.extractAndExpandNavigationProperty(a,n,r,e);return{expand:r.join(",")||undefined,select:n.join(",")||undefined}}_ensureSelectionProperties(t,e){for(const a of e){if(typeof a==="object"&&a?.PropertyPath&&!t.includes(a.PropertyPath)){t.push(a.PropertyPath)}}return t}_handleMandatorySelectionFields(t,e,a){const i=a.getODataEntitySet(t,false);const n=a.getODataEntityType(i.entityType,false);n.key.propertyRef.forEach(t=>{this.ensureSelectionProperty(t.name,e)})}ensureSelectionProperty(t,e){t?.split(",").forEach(function(t){if(t&&!e.includes(t)){e.push(t)}})}_createCardManifest(t,e,a,i){let n=a["sap.ui"];let r=a["sap.app"];let s=0;if(r?.["crossNavigation"]){delete r["crossNavigation"]}if(r){Object.assign(r,{type:"card",id:`user.${t.id}.${Date.now()}`,title:t.cardTitle||"",subTitle:t.subTitle})}let o={"sap.ui":n,"sap.app":this.createManifestSapApp(r),"sap.card":this.createManifestSapCard(a,t),"sap.ui5":this.createSapui5()};const l=o?.["sap.card"]?.content;t.columns.slice(0,f).forEach(t=>{const e=this._getAttributeValue(t);if(t.identifier&&l?.item){l.item.title={value:e,identifier:true}}else if(l?.item?.attributes){l.item.attributes[s]={value:e,visible:true,...t.state&&{state:t.state,showStateIcon:t.showStateIcon}};s++}});if(i&&l?.item){l.item.actions=[]}return{...o,"sap.insights":{parentAppId:t.id,cardType:"RT",versions:{ui5:`${e.version}-${e.buildTimestamp}`},visible:true}}}_getAttributeValue(e){let a=!e.value.startsWith("{")?"{= extension.formatters.stringFormatter(${"+e.path+"}) }":e.value;if(e.type==="Edm.Date"||e.type==="Edm.DateTime"){const i=JSON.stringify({pattern:t.getDatePattern("short")});a="{=${"+e.path+"}?format.dateTime(${"+e.path+"}, "+i+") : ''}"}return a}createManifestSapApp(t){const e=n({},t);if(e?.dataSources?.mainService){e.dataSources["filterService"]=e.dataSources.mainService;if(e.dataSources["filterService"]?.settings){e.dataSources["filterService"].settings["odataVersion"]="2.0"}}return e}createManifestSapCard(t,e){const a=t["sap.app"]?.dataSources;const i=a?.mainService?.uri;const n=e.entitySet;const r="__count";const s={text:"{= ${"+r+"} === '0' ? '' : ${"+r+"} }"};let o={type:"List"};o["configuration"]=this.createManifestSapCardConfig(i||"",n);o["data"]=this.createManifestSapCardData(i||"",e.url);o["header"]={title:e.cardTitle,subTitle:"",actions:[],status:s,data:{path:"/content/d"}};o["extension"]="module:sap/insights/CardExtension";o["content"]={data:{path:"/content/d/results"},maxItems:5,item:{actions:[],attributesLayoutType:"OneColumn",attributes:[]}};this.addCardActions(o,e.semanticObject,e.action);return o}addCardActions(t,e,a){let i={ibnTarget:{semanticObject:e,action:a},sensitiveProps:[],ibnParams:{}};let n=[{type:"Navigation",parameters:"{= extension.formatters.getNavigationContext(${parameters>/headerState/value})}"}];let r=JSON.parse(JSON.stringify(i));let s=[{type:"Navigation",parameters:"{= extension.formatters.getNavigationContext(${parameters>/contentState/value}, ${})}"}];if(t.configuration?.parameters){t.configuration.parameters.headerState={value:JSON.stringify(i)};t.configuration.parameters.contentState={value:JSON.stringify(r)}}if(t.header){t.header.actions=n}if(t?.content?.item){t.content.item.actions=s}}createManifestSapCardConfig(t,e){const a={parameters:{_relevantODataFilters:{value:[]},_relevantODataParameters:{value:[]},_entitySet:{value:e},_urlSuffix:{value:"/Results"}},destinations:{service:{name:"(default)",defaultUrl:"/"}},csrfTokens:{token1:{data:{request:{url:"{{destinations.service}}"+t,method:"HEAD",headers:{"X-CSRF-Token":"Fetch"}}}}}};return a}createSapui5(){return{_version:"1.1.0",contentDensities:{compact:true,cozy:true},dependencies:{libs:{"sap.insights":{lazy:false}}}}}createManifestSapCardData(t,e){const a={content:{method:"GET",url:e,headers:{Accept:"application/json"}}};const i={request:{url:"{{destinations.service}}"+t+"/$batch",method:"POST",headers:{"X-CSRF-Token":"{{csrfTokens.token1}}"},batch:a}};return i}_getManifestCardData(t,e,a,i){const n=t["sap.app"];const r=n?.dataSources;const s=r?.mainService?.uri||"";const o=e.lineItem;const l=e.entitySet;const c=i.getODataEntitySet(l);const u=i.getODataEntityType(c?.entityType);const f=`${s.replace(/\/$/,"")}/${l}`;const h=o?.map(t=>this._getColumnDetail(l,i,t)).filter(t=>t!==undefined);const g=this._getRelevantColumnPaths(h);const y=this.getParameters(e,i,l,g);const m=this.createCustomParams(y);const S=m?`${f}?$top=5&skip=0&${m}&$inlinecount=allpages`:`${f}?$top=5&skip=0`;const P=d(h).map(t=>({path:t?.path,type:t?.type,value:t?.value,identifier:t?.identifier,state:t?.state,showStateIcon:t?.showStateIcon})).slice(0,4);return{cardTitle:t?.["sap.app"]?.title,subTitle:u[p.CommonLabel]?`Top 5 ${u[p.CommonLabel].String}`:"",url:S,semanticObject:a?.semanticObject||"",action:a?.action||"",id:t?.["sap.app"]?.id,columns:P,entitySet:l}}_getColumnDetail(t,e,a){let i;let n=e.getODataEntitySet(t);let r=e.getODataEntityType(n.entityType);if(a.Value?.Path){i=e.getODataProperty(r,a.Value.Path);let t=i[p.UIHidden];if(t?.Bool==="true"||t?.Bool===true){return undefined}if(this.isPropertyHidden(a)||!i||Object.keys(i).length===0){return undefined}}let s=this.createP13N(n,i,a,e);s=s.replace(/\\/g,"");let o=s?JSON.parse(s):{};if(!this.isSupportedColumn(o,a,e,n)){return undefined}if(i){o=this.getColumnObjectDetails(o,i,r,a);if(a?.[g.Importance]!==undefined){const t=a[g.Importance];o.importance=t}}return o}getColumnObjectDetails(t,e,a,i){let n=e[p.CommonText]?.Path||"";n="{"+n+"}";let r=e.name?"{"+e.name+"}":"";let s="";const o=a[p.CommonSemanticKey];const l=!!o&&o.some(function(t){return t.PropertyPath===e.name});let c=false;let u=undefined;if((i?.Criticality&&i?.Value?.Path)===e.name){u=i;c=true}if(e[p.MeasuresISOCurrency]?.Path){r=r.concat(" "+"{"+s+e[p.MeasuresISOCurrency]?.Path+"}")}if(e[p.MeasuresUnit]?.Path){r=r.concat(" "+"{"+s+e[p.MeasuresUnit]?.Path+"}")}if(e[p.CommonText]?.Path){let i=e[p.CommonText]?.[p.UITextArrangement];if(!i){i=a[p.UITextArrangement]}this._setColumnTextValue(i,t,n,r)}else{t["value"]=r;if(l){t["identifier"]=l}}if(c){t["state"]=this.buildExpressionForCriticalityColor(u);t["showStateIcon"]=u?.CriticalityRepresentation?.EnumMember!==g.CriticalityRepresentationTypeWithoutIcon||true}t["path"]=e[p.CommonText]?.Path||e.name;t["type"]=e.type;return t}buildExpressionForCriticalityColor(t){let a=h.None;let n;let r=t?.Criticality;let s=function(t){t["Negative"]="com.sap.vocabularies.UI.v1.CriticalityType/Negative";t["Critical"]="com.sap.vocabularies.UI.v1.CriticalityType/Critical";t["Positive"]="com.sap.vocabularies.UI.v1.CriticalityType/Positive";return t}({});if(r){n="'{'= ({0} === ''"+s.Negative+"'') || ({0} === ''1'') || ({0} === 1) ? ''"+h.Error+"'' : "+"({0} === ''"+s.Critical+"'') || ({0} === ''2'') || ({0} === 2) ? ''"+h.Warning+"'' : "+"({0} === ''"+s.Positive+"'') || ({0} === ''3'') || ({0} === 3) ? ''"+h.Success+"'' : "+"''"+h.None+"'' '}'";if(r?.Path){const t="${"+r.Path+"}";a=i(n,[t])}else if(r?.EnumMember){const t="'"+r.EnumMember+"'";a=i(n,[t])}else{e.warning("Case not supported, returning the default sap.ui.core.ValueState.None")}}else{e.warning("Case not supported, returning the default sap.ui.core.ValueState.None")}return a}_setColumnTextValue(t,e,a,i){let n=function(t){t["TextOnly"]="TextOnly";t["TextLast"]="TextLast";t["TextSeparate"]="TextSeparate";return t}({});const r=t?.EnumMember?.split("/")[1];let s;switch(r){case n.TextOnly:s=`{= $${a} === '' ? '' : $${a} }`;break;case n.TextLast:s=`{= $${i} === '' ? '' : $${i} }`+`{= $${a} === '' ? '' : ' (' + ($${a}) + ')' }`;break;case n.TextSeparate:s=`{= $${i} === '' ? '' : $${i} }`;break;default:s=`{= $${a} === '' ? '' : $${a} }`+`{= $${i} === '' ? '' : ' (' + ($${i}) + ')' }`;break}e["value"]=s}_getRequestAtLeastFields(t){return t&&Array.isArray(t.requestAtLeastFields)?t.requestAtLeastFields:[]}createCustomParams(t){const e=[];if(t?.expand){e.push("$expand="+a(t["expand"]))}if(t?.select){e.push("$select="+a(t["select"]))}return e.join("&")}getObject(t,e,a){if(a[0]!=="/"){a=t.getODataEntityType(e,true)+"/"+a}return t.getObject(a.replace(/@/g,""))}_isListReport(t){return t?.component?.name==="sap.suite.ui.generic.template.ListReport"}getSettingsForPage(t){if(!t){return{}}let e={};if(Array.isArray(t)&&this._isListReport(t[0])){const a=t[0];if(a?.component){const t=a.component;e=t?.settings||{};e.bSupressCardRowNavigation=this.shouldSuppressCardRowNavigation(a)}}else if(Object.keys(t).length){const a=Object.keys(t).find(e=>this._isListReport(t[e]));if(a){const i=t[a];if(i?.component){const t=i.component;e=t?.settings??{};e.bSupressCardRowNavigation=this.shouldSuppressCardRowNavigation(i)}}}return e}shouldSuppressCardRowNavigation(t){if(t.pages){if(Array.isArray(t.pages)){if(t.pages.length===0||t.pages[0]?.navigation){return true}}else{const e=Object.keys(t.pages);if(e.length===0||e.length&&t.pages[e[0]]?.navigation){return true}}}else{return true}if(t?.component?.settings?.quickVariantSelectionX){return true}return false}getNormalizedTableSettings(t,e,a){const i=n({},e);if(i&&!i.tableType){if(i.gridTable){i.tableType=u.GRID}else if(i.treeTable){i.tableType=u.TREE}}i.tableSettings=i.tableSettings||{};i.tableSettings.type=i.tableSettings.type||i.tableType;const r=t.getODataEntitySet(a);const s=t.getODataEntityType(r.entityType);if(i.tableSettings.type!==u.STANDARD_LIST&&i.tableSettings.type!==u.OBJECT_LIST&&a){i.tableSettings.type=i.tableSettings.type||(s[p.SapSemantics]==="aggregate"?u.ANALYTICAL:u.RESPONSIVE);if(i.tableSettings.type===u.ANALYTICAL&&!(s[p.SapSemantics]==="aggregate")){i.tableSettings.type=u.GRID}}if(s[p.UIHeaderInfo]){i.tableSettings.headerInfo=s[p.UIHeaderInfo]}delete i.gridTable;delete i.treeTable;delete i.tableType;return i.tableSettings}checkIfSmartChart(t,e,a){let i=t.getODataEntitySet(e);let n=t.getODataEntityType(i.entityType);let r,s,o;s=a.annotationPath;o=s?n[s]:undefined;if(o?.PresentationVariant){if(o.PresentationVariant.Visualizations){r=o.PresentationVariant.Visualizations[0].AnnotationPath}else if(o.PresentationVariant.Path){let t=o.PresentationVariant.Path.split("@")[1];let e=t&&n[t];r=e?e?.Visualizations?.[0].AnnotationPath:""}}else if(o?.Visualizations){r=o.Visualizations[0].AnnotationPath}return!!((r??"").indexOf(p.UIChart)>-1)}hasMandatoryProperties(t,e){if(t?.["Org.OData.Capabilities.V1.FilterRestrictions"]?.["RequiredProperties"]?.length){return true}else if(e?.length){return e.some(t=>Object.keys(t).length&&(t["sap:parameter"]==="mandatory"||t["sap:required-in-filter"]==="true"))}return false}_getParametersisedEntitySetParams(t,e,a){if(!t){throw new Error("OData Model needs to be passed as an argument")}const i={entitySetName:null,parameters:[],navPropertyName:null};const n=t.getODataEntitySet(e);const r=t.getODataEntityType(n.entityType);const s=r.navigationProperty;if(!s){return i}s.forEach(function(e){const s=t.getODataAssociationEnd(r,e.name);const o=s&&t.getODataEntityType(s.type);if(o?.[p.SapSemantics]!=="parameters"||!o.key){return false}i.entitySetName=t.getODataAssociationSetEnd(r,e.name)?.entitySet;for(let t of o.key.propertyRef){if(a){const e=o.property;for(let a of e){if(a.name===t.name){i.parameters.push(a)}}}else{i.parameters.push(t.name)}}const l=o.navigationProperty;const c=l?.some(function(e){const a=t.getODataAssociationEnd(o,e?.name)?.type;i.navPropertyName=a===n.entityType?e?.name:null;return i.navPropertyName});return c&&i.navPropertyName&&i.entitySetName});return i}isPropertyHidden(t){let e=t[p.CommonFieldControl];let a=t[p.UIHidden];if(e?.EnumMember===g.FieldControlHiddenType){return true}if(a){if(Object.prototype.hasOwnProperty.call(a,"Bool")){return a?.Bool==="true"}else if(Object.prototype.hasOwnProperty.call(a,"Path")){return false}else{return true}}return false}createP13N(t,e,a,i){let n="";let r=[];let s="";let o=a?.RecordType;let l=a?.Value;let c=l?.Path||"";if(o===g.DataField||o===g.DataFieldForAnnotation||o===g.DataFieldWithUrl){if(c){let e=this.createP13NColumnKey(a);n='\\{"columnKey":"'+e+'", "leadingProperty":"'+c;s=this.getNavigationPrefixPath(i,t,c)}else if(l?.Apply?.Name==="odata.concat"){l?.Apply?.Parameters.forEach(function(t){if(t.Type==="Path"){if(!n){n='\\{"columnKey":"'+t?.Value+'", "leadingProperty":"'+t?.Value}else{r.push(t.Value)}}})}n+=this.processAdditionalProperties(e,a,s,r);if(o===g.DataFieldWithUrl&&a?.Url){this.processDataFieldWithUrl(a,r)}if(n&&r.length){n+='", "additionalProperty":"'+r.join()}if(n){n+='"\\}'}}return n}processDataFieldWithUrl(t,e){const a=t.Url;if(a?.Apply?.Parameters){a.Apply.Parameters.forEach(t=>{if(t.Type==="LabeledElement"&&t.Value?.Path){e.push(t.Value.Path)}})}if(a?.Path){e.push(a.Path)}}createP13NColumnKey(t){let e="",a="template",i="::";let n=t.RecordType;let r=t?.Value;let s=t.SemanticObject?.String||"";let o=t.Action?.String||"";let l=r?.Path||"";let c="",p=null;let u=function(t){return a+i+t.join(i)};switch(n){case g.DataField:e=l;break;case g.DataFieldWithIntentBasedNavigation:e=u([y.DataFieldWithIntentBasedNavigation,s,o,l]);break;case g.DataFieldWithNavigationPath:e=u([y.DataFieldWithNavigationPath,l]);break;case g.DataFieldForIntentBasedNavigation:e=u([y.DataFieldForIntentBasedNavigation,s,o]);break;case g.DataFieldForAction:e=u([y.DataFieldForAction,o]);break;case g.DataFieldForAnnotation:c=t.Target?.AnnotationPath;p=c&&(c.indexOf(g.Contact)>=0||c.indexOf(g.DataPoint)>=0||c.indexOf(g.FieldGroup)>=0||c.indexOf(g.Chart)>=0);if(p){e=u([y.DataFieldForAnnotation,c]);e=e.replace("@","")}break;default:e="";break}return e}getNavigationPrefixPath(t,e,a){let i="";if(t){let n=t.getODataEntityType(e.entityType);if(n){i=this._getNavigationPrefix(t,n,a);if(i){i+="/"}}}return i}_getNavigationPrefix(t,e,a){let i="";let n=a.split("/");if(n.length>1){for(let a=0;a<n.length-1;a++){let r=t.getODataAssociationEnd(e,n[a]);if(!r){return i}if(r){e=t.getODataEntityType(r.type);i+=(i?"/":"")+n[a]}}}return i}processAdditionalProperties(t,e,a,i){let n="";if(t?.type==="Edm.DateTime"&&t?.["sap:display-format"]==="Date"){n+='", "type":"date'}else if(t?.type==="Edm.String"){n+='", "type":"string'}if(e?.Criticality?.Path){i.push(e?.Criticality.Path)}let r=t?.[p.CommonText];if(r?.Path){i.push(a+r?.Path)}const s=t?t[p.MeasuresISOCurrency]||t[p.MeasuresUnit]:null;if(s?.Path){i.push(s.Path);n+='", "unit":"'+s.Path}if(t?.[p.CommonFieldControl]?.Path){i.push(a+t[p.CommonFieldControl].Path)}return n}isSupportedColumn(t,e,a,i){let n=e.RecordType;if(n===g.DataFieldForAnnotation||n===g.DataFieldForAction||n===g.DataFieldForIntentBasedNavigation||!t){return false}let r=a.getODataEntityType(i.entityType);let s=a.getODataProperty(r,t.leadingProperty);let o=t.columnKey;if(this.checkMultiplicityForDataFieldAssociation(a,i,e)||o&&(o.indexOf(y.DataFieldForAnnotation)>-1||o.indexOf(y.DataFieldForAction)>-1||o.indexOf(y.DataFieldForIntentBasedNavigation)>-1||s?.[p.UIIsImageURL]?.Bool==="true")){return false}return true}checkMultiplicityForDataFieldAssociation(t,e,a){if(a?.Value?.Path){let i=a.Value.Path;let n=t&&t.getODataEntityType(e.entityType);let r;if(!(i.indexOf("/")>-1)||!n){return false}while(i.indexOf("/")>-1){let e=i.split("/")[0];i=i.split("/").slice(1).join("/");n=t.getODataEntityType(r?.type)||n;r=t.getODataAssociationEnd(n,e)}if(r&&r.multiplicity==="*"){return true}}return false}}m.FieldTypes=y;return m});
//# sourceMappingURL=RecommendedCardUtil.js.map