/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)
 *  * (c) Copyright 2009-2025 SAP SE. All rights reserved
 */
sap.ui.define(["sap/base/Log","sap/m/GenericTile","sap/m/Panel","sap/m/library","sap/ui/core/EventBus","sap/ui/core/theming/Parameters","sap/ushell/api/S4MyHome","./BaseAppPersPanel","./BaseContainer","./Group","./RecommendedAppPanel","./utils/DataFormatUtils","./utils/Device","./utils/placeholder/AppsPlaceholder"],function(e,t,n,s,o,i,r,a,c,l,p,g,u,h){"use strict";function d(e){return e&&e.__esModule&&typeof e.default!=="undefined"?e.default:e}function f(e,t){try{var n=e()}catch(e){return t(e)}if(n&&n.then){return n.then(void 0,t)}return n}const y=s["BackgroundDesign"];const m=s["FrameType"];const _=s["GenericTileMode"];const P=s["GenericTileScope"];const T=s["TileSizeBehavior"];const b=d(a);const A=d(c);const C=d(l);const D=d(p);const v=g["getLeanURL"];const M=u["calculateCardWidth"];const S=u["DeviceType"];const I=u["fetchElementProperties"];const w=h["getAppsPlaceholder"];const E=()=>{const e="sapLegendColor9";return{key:e,value:i.get({name:e}),assigned:false}};const V={PLACEHOLDER_ITEMS_COUNT:5,MIN_TILE_WIDTH:304,MAX_TILE_WIDTH:456};const L=A.extend("sap.cux.home.AppsContainer",{metadata:{events:{appsLoaded:{parameters:{apps:{type:"sap.cux.home.App[]"},tiles:{type:"sap.m.GenericTile[]"}}}}},renderer:{...A.renderer,apiVersion:2},constructor:function e(t,n){A.prototype.constructor.call(this,t,n);this._isInitialRender=true},init:function e(){A.prototype.init.call(this);this.setProperty("title",this._i18nBundle?.getText("appsTitle"));const t=o.getInstance();t.subscribe("importChannel","recommendationSettingChanged",(e,t,n)=>{const s=n.showRecommendation;if(!s){const e=this.getContent()?.[0];this.setProperty("selectedKey",e?.getProperty("key"))}});this.setProperty("enableLazyLoad",false);this.addStyleClass("sapCuxAppsContainer");this.addCustomSetting("text",this._i18nBundle.getText("myAppMsg"));this._attachRouteChangeEvent()},_attachRouteChangeEvent:function t(){const n=this;const s=function(e){try{const t=e.getParameter("isMyHomeRoute");const s=function(){if(t){const e=function(){if(n._appSwitched){n._appSwitched=false;n.showPersistedDialog();return Promise.resolve(n.load()).then(function(){})}}();if(e&&e.then)return e.then(function(){})}else{n._setPanelsDirty();n._appSwitched=true}}();return Promise.resolve(s&&s.then?s.then(function(){}):void 0)}catch(e){return Promise.reject(e)}};try{r.attachRouteMatched({},s,this)}catch(t){e.warning("Unable to attach route change handler",t instanceof Error?t.message:String(t))}},onBeforeRendering:function e(){if(this._isInitialRender){this._isInitialRender=false;this._attachPanelSupportedEvent()}this.adjustLayout();A.prototype.onBeforeRendering.call(this);this._removeUnsupportedPanels()},onAfterRendering:function e(){try{const e=this;A.prototype.onAfterRendering.call(e);return Promise.resolve(e._activateRecommendationTabPanel()).then(function(){})}catch(e){return Promise.reject(e)}},load:function e(){try{const e=this;const t=e.getPanels();return Promise.resolve(Promise.all(t.map(t=>e._setApps(t)))).then(function(){})}catch(e){return Promise.reject(e)}},getPanels:function e(){const t=this.getDeviceType()===S.Mobile;return t?this.getContent():[this._getSelectedPanel()]},showPersistedDialog:function e(){const t=this.getPanels();for(const e of t){e.firePersistDialog()}},_setPanelsDirty:function e(){const t=this.getContent();for(const e of t){e.setDesktopViewDirty(true);e.setMobileViewDirty(true)}},_generatePlaceholder:function e(t){if(!t.isLoaded()){t.destroyAggregation("apps",true);const e=t.generateApps(new Array(V.PLACEHOLDER_ITEMS_COUNT).fill({status:"Loading"}));t.setApps(e);this._updatePanelContent(t)}},_setApps:function t(n){try{const t=this;const s=f(function(){function e(){n.fireEvent("loaded")}const s=function(){if(n.isDirty()&&n.isMobileDirty()){t._generatePlaceholder(n);return Promise.resolve(n.loadApps?.()).then(function(){if(t.getDeviceType()===S.Mobile){n.setMobileViewDirty(false)}else{n.setDesktopViewDirty(false)}n.setLoaded(true);t._updatePanelContent(n);if(n instanceof b){void n.applyPersonalization(true)}let e=[];let s=n.getApps();e=n.fetchTileVisualization(e);t.fireEvent("appsLoaded",{apps:s,tiles:e})})}}();return s&&s.then?s.then(e):e(s)},function(s){t.showErrorCard(n);e.error(`Error setting apps for panel: ${n.getTitle()}`,s instanceof Error?s.message:String(s))});return Promise.resolve(s&&s.then?s.then(function(){}):void 0)}catch(e){return Promise.reject(e)}},_updatePanelContent:function e(t){const n=t.getApps()||[];const s=t.getAggregation("groups")||[];const o=this.getDeviceType()===S.Mobile;const i=o?t._generateMobileAppsWrapper():t._generateAppsWrapper();const r=o?"content":"items";i.destroyAggregation(r);let a=o?this._generateMobileCards([...s,...n],t.getId()):this._generateTiles([...s,...n]);this._addWrapperContent(i,a,r);this._updatePanelContentVisibility(t)},_updatePanelContentVisibility:function e(t){const n=t.getApps()||[];const s=t.getAggregation("groups")||[];const o=this.getDeviceType()===S.Mobile;const i=t._generateDesktopAppsWrapper();const r=t._generateMobileAppsWrapper();const a=t._generateErrorMessage();const c=[...n,...s].length!==0;i.setVisible(c&&!o);r.setVisible(c&&o);r.getParent().setWidth(o&&c?"100%":"auto");a.setVisible(!c)},_getAppTile:function e(n){const s=this.getDeviceType()===S.Mobile;const o=n.getAggregation("menuItems")||[];const i=s?`${n.getId()}-mobile-tile`:`${n.getId()}-tile`;return new t(i,{scope:o.length&&!s?P.ActionMore:P.Display,state:n.getStatus(),mode:_.IconMode,sizeBehavior:T.Small,header:n.getTitle(),backgroundColor:n.getBgColor()||E()?.key,tileIcon:n.getIcon(),url:v(n.getUrl()),frameType:m.TwoByHalf,renderOnThemeChange:true,dropAreaOffset:4,subheader:n.getSubTitle(),press:e=>n._onPress(e),width:s?"15rem":"100%"}).addStyleClass("tileLayout sapMGTTwoByHalf")},_getGroupTile:function e(n){const s=this.getDeviceType()===S.Mobile;const o=n.getAggregation("menuItems")||[];const i=s?`${n.getId()}-mobile-tile`:`${n.getId()}-tile`;return new t(i,{scope:o.length&&!s?P.ActionMore:P.Display,state:n.getStatus(),mode:_.IconMode,sizeBehavior:T.Small,header:n.getTitle(),backgroundColor:n.getBgColor()||E()?.key,tileIcon:n.getIcon(),frameType:m.TwoByHalf,renderOnThemeChange:true,dropAreaOffset:4,tileBadge:n.getNumber(),press:e=>n._onPress(e),width:s?"15rem":"100%"}).addStyleClass("tileLayout sapMGTTwoByHalf").data("groupId",n.getGroupId())},_onPanelSelect:function e(t){try{const e=this;A.prototype._onPanelSelect.call(e,t);const n=e._getSelectedPanel();return Promise.resolve(e._setApps(n)).then(function(){})}catch(e){return Promise.reject(e)}},_refreshAllPanels:function e(){try{const e=this;e._setPanelsDirty();return Promise.resolve(e._setApps(e._getSelectedPanel())).then(function(){})}catch(e){return Promise.reject(e)}},refreshPanel:function e(t){try{const e=this;t.setMobileViewDirty(true);t.setDesktopViewDirty(true);return Promise.resolve(e._setApps(t)).then(function(){})}catch(e){return Promise.reject(e)}},_toggleTabView:function e(){if(this.getDeviceType()!==S.Mobile){const e=this.getContent();const t=e.filter(e=>e.isSupported());const n=this._getInnerControl();n?.toggleStyleClass("sapUiITBHide",t.length===1)}},_onPanelSupported:function e(t,n){const s=n.getParameter("isSupported");t.setSupported(s);this._togglePanelVisibility(t,s);this._toggleTabView()},_togglePanelVisibility:function e(t,n){const s=this._getInnerControl();const o=s?.getItems()||[];const i=o.find(e=>e.getKey()===t.getKey());i?.setVisible(n)},_removeUnsupportedPanels:function e(){const t=this.getContent();const n=t.filter(e=>!e.isSupported());for(const e of n){this._togglePanelVisibility(e,false)}this._toggleTabView()},_attachPanelSupportedEvent:function e(){const t=this.getContent();for(const e of t){if(!e.hasListeners("supported")){e.attachSupported(this._onPanelSupported.bind(this,e))}}},_activateRecommendationTabPanel:function e(){try{const e=this;const t=e.getContent();const n=e.getDeviceType()===S.Mobile;const s=t?t.find(e=>e instanceof D):null;const o=function(){if(s instanceof D&&!n){return Promise.resolve(s._enableRecommendationTab()).then(function(){})}else{s?.setSupported(false)}}();return Promise.resolve(o&&o.then?o.then(function(){}):void 0)}catch(e){return Promise.reject(e)}},setTileWidth:function e(t){const n=V.MIN_TILE_WIDTH;const s=V.MAX_TILE_WIDTH;const o=t._generateAppsWrapper()?.getDomRef();if(!o)return;const i=I(o,["width","padding-left","padding-right","margin-left","margin-right"]);const r=Object.values(i).slice(1).reduce((e,t)=>e-t,i["width"]);const a=t.getApps()||[];const c=t.getAggregation("groups")||[];const l=a.length+c.length;if(l===0||r<=0)return;const p={containerWidth:r,totalCards:l,minWidth:n,maxWidth:s,gap:8,skipDeviceCheck:true};const g=M(p);t.setProperty("tileWidth",g);t._generateAppsWrapper().getLayout().setProperty("columnSize",`${g/16}rem`)},adjustLayout:function e(){const t=this.getDeviceType()===S.Mobile;const n=this._getSelectedPanel();this.setTileWidth(n);this.toggleActionButtons(!t);const s=this.getContent();s.forEach(e=>{if(!e.isDirty()&&!e.isMobileDirty()){this._updatePanelContentVisibility(e)}else if(e.isDirty()!==e.isMobileDirty()){if(t){e.setMobileViewDirty(false)}else{e.setDesktopViewDirty(false)}this._updatePanelContent(e)}});this._removeUnsupportedPanels()},_generateMobileCards:function e(t,s){const o=[];for(let e=0;e<t.length;e+=7){const i=t.slice(e,e+7);const r=new n(`${s}--${e}`,{backgroundDesign:y.Solid,height:"23.5rem",width:"17rem",content:this._generateTiles(i)}).addStyleClass("sapUiMobileAppsCard appPanelBorder myAppMFBContent");o.push(r)}return o},_generateTiles:function e(t){return t.map(e=>e instanceof C?this._getGroupTile(e):this._getAppTile(e))},_addWrapperContent:function e(t,n,s){t.destroyAggregation(s);n.forEach(e=>{t.addAggregation(s,e)})},showErrorCard:function e(t){const n=t._generateErrorMessage();const s=t._generateDesktopAppsWrapper();const o=t._generateMobileAppsWrapper();s?.setVisible(false);o?.setVisible(false);n?.setVisible(true)},getGenericPlaceholderContent:function e(){return w()}});return L});
//# sourceMappingURL=AppsContainer.js.map