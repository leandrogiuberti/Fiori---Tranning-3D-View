/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)
 *  * (c) Copyright 2009-2025 SAP SE. All rights reserved
 */
sap.ui.define(["sap/base/Log","sap/m/Button","sap/m/Column","sap/m/ColumnListItem","sap/m/HBox","sap/m/MessageBox","sap/m/ObjectIdentifier","sap/m/Table","sap/m/Text","sap/m/ToggleButton","sap/m/VBox","sap/ui/core/Element","sap/ui/core/Icon","sap/ui/core/Lib","sap/ui/model/json/JSONModel","./BaseSettingsPanel","./flexibility/Layout.flexibility","./utils/Accessibility","./utils/Constants","./utils/DragDropUtils","./utils/PersonalisationUtils"],function(e,t,n,s,i,o,a,r,l,c,d,u,g,h,m,p,_,f,y,I,S){"use strict";function C(e){return e&&e.__esModule&&typeof e.default!=="undefined"?e.default:e}const x=C(p);const T=_["CHANGE_TYPES"];const E=f["getInvisibleText"];const P=y["SETTINGS_PANELS_KEYS"];const B=I["focusDraggedItem"];const b=C(S);const L=x.extend("sap.cux.home.LayoutSettingsPanel",{metadata:{library:"sap.cux.home"},constructor:function e(t,n){x.prototype.constructor.call(this,t,n);this._isCollapseHandlerAttached=false},init:function e(){x.prototype.init.call(this);this.setProperty("key",P.LAYOUT);this.setProperty("title",this._i18nBundle.getText("layout"));this.setProperty("icon","sap-icon://grid");this._resetActionButton=new t({id:`${this.getId()}-layoutResetBtn`,text:this._i18nBundle.getText("resetButton"),press:()=>this.resetMyhomeSettings()});this.addActionButton(this._resetActionButton);this.addAggregation("content",this._getContent());this.attachPanelNavigated(()=>void this._loadSections());this._manageSectionsChanges=[]},createShowHideChangeFile:function e(t){try{const e=this;const n=t.getSource();const s=!n.getPressed();const i=n.getBindingContext()?.getObject();i.visible=s;e._getPanel().getSections().find(e=>e.completeId===i.completeId).visible=s;const o=s?T.UNHIDE:T.HIDE;const a=u.getElementById(i.completeId);e._manageSectionsChanges.push({selectorElement:a,changeSpecificData:{changeType:o}});return Promise.resolve(e._saveManageSectionsDialog()).then(function(){setTimeout(()=>a.adjustLayout());if(!s){e._switchToCollapsedViewIfRequired([a])}})}catch(e){return Promise.reject(e)}},_switchToCollapsedViewIfRequired:function e(t){const n=this._getPanel();const s=n.getProperty("expanded");const i=t.filter(e=>n._getCurrentExpandedElementName()===e.getProperty("fullScreenName"));if(s){n.toggleFullScreen(i[0]._getSelectedPanel())}},_loadSections:function e(){try{const e=this;const t=e._getPanel();return Promise.resolve(t._calculateSectionsState()).then(function(){e._orderedSections=JSON.parse(JSON.stringify(t.getSections()));e._orderedSections.forEach(t=>{if(t.sContainerType==="sap.cux.home.InsightsContainer"&&!t.title){t.title=String(e._i18nBundle?.getText("insights"))}});e._controlModel=new m(e._orderedSections);e._layoutTable.setModel(e._controlModel);e._layoutTable.bindItems({path:"/",factory:t=>{if(!e._dndInvisibleText||e._dndInvisibleText.isDestroyed()){e._dndInvisibleText=E(e.getId()+"--layoutDndText",e._i18nBundle.getText("keyPressAriaText"))}return new s(`${t}--columnListItem`,{type:"Inactive",cells:[new i(`${t}--columnListHBox`,{alignItems:"Center",items:[new g(`${t}--columnListIcon`,{src:"sap-icon://vertical-grip"}).addStyleClass("sapUiSmallMarginEnd"),new i(`${t}--columnListItemHBox`,{justifyContent:"SpaceBetween",alignItems:"Center",width:"100%",items:[new a(`${t}--columnListObjectIdentifier`,{title:"{title}",text:"{text}",tooltip:"{title}"}),new c(`${t}--layoutSettingstoggleButton`,{tooltip:"{= ${visible} ? '"+e._i18nBundle.getText("hideBtn")+"' : '"+e._i18nBundle.getText("showBtn")+"' }",icon:"sap-icon://show",type:"Emphasized",enabled:"{= !${blocked}}",press:t=>{void e.createShowHideChangeFile(t)},pressed:"{= !${visible}}",ariaLabelledBy:["selectLabel"]}).addStyleClass("sapUiTinyMarginEnd sapUiTinyMarginTop")]}),e._dndInvisibleText],width:"100%"})],ariaLabelledBy:[e._dndInvisibleText.getId()]}).addStyleClass("insightsListItem insightsListMargin")}});if(!e._isCollapseHandlerAttached){e._isCollapseHandlerAttached=true;t.attachEvent("onCollapse",()=>e._rearrangeLayoutIfRequired())}})}catch(e){return Promise.reject(e)}},_rearrangeLayoutIfRequired:function e(){const t=this._getPanel();const n=t.getItems();if(Array.isArray(this._allLayoutElements)&&n.length===this._allLayoutElements.length){const e=n.some((e,t)=>e.getId()!==this._allLayoutElements[t].getId());if(e){t.removeAllItems();this._allLayoutElements.forEach(e=>{t.addItem(e)})}}},_getContent:function e(){const t=this._setHeaderIntro();const n=this.setLayoutTable();const s=E(this.getId()+"--titleText",this._i18nBundle.getText("layout"));const i=new d(this.getId()+"--idNewsPageOuterVBoX",{alignItems:"Start",justifyContent:"SpaceBetween",renderType:"Bare",items:[s,t,n]});[s,t].forEach(e=>{this._resetActionButton.addAriaLabelledBy(e.getId())});return i},_setHeaderIntro:function e(){const t=new l(this.getId()+"--idCustLayoutText",{text:this._i18nBundle.getText("layoutIntroMsg")});const n=new d(this.getId()+"--idLayoutIntroText",{backgroundDesign:"Solid",alignItems:"Start",justifyContent:"SpaceBetween",items:[t],renderType:"Bare"}).addStyleClass("sapUiSmallMargin");return n},setLayoutTable:function e(){if(!this._layoutTable){this._layoutTable=new r(this.getId()+"--idManageSectionsTable",{width:"calc(100% - 2rem)",items:[],columns:[new n(this.getId()+"--idSectionTitleColumn",{width:"100%"})]}).addStyleClass("sapContrastPlus sapUiSmallMarginBeginEnd sapUiTinyMarginBottom");this.addDragDropConfigTo(this._layoutTable,e=>void this.onDropManageSections(e))}return this._layoutTable},_saveManageSectionsDialog:function e(){try{const e=this;return Promise.resolve(e._persistUserChanges({changes:e._manageSectionsChanges,appComponent:b.getOwnerComponent(e._getPanel())}).then(()=>{const t=e._layoutTable.getModel();t.refresh();e._controlModel.refresh()}).finally(()=>{e._manageSectionsChanges=[]}))}catch(e){return Promise.reject(e)}},_persistUserChanges:function t(n){return h.load({name:"sap.ui.fl"}).then(function(){return new Promise(function(t,s){sap.ui.require(["sap/ui/fl/write/api/ControlPersonalizationWriteAPI"],function(i){i.add({changes:n.changes,ignoreVariantManagement:true}).then(function(e){return t(i.save({selector:{appComponent:n.appComponent},changes:e}))}).catch(function(t){if(t instanceof Error){e.error("Unable to Save User Change: "+t.message);return s(t)}})})})})},_getActualIndex:function e(t){const n=this._getPanel();this._allLayoutElements=this._allLayoutElements||[...n.getItems()];const s=n.getProperty("expanded");const i=n._getCurrentExpandedElement();if(s&&i){if(!this._allLayoutElements.some(e=>e.getId()===i.targetContainer.getId())){this._allLayoutElements.splice(i.index,0,i.targetContainer)}}return this._allLayoutElements.findIndex(e=>e.getId()===t)},_rearrangeLayoutElements:function e(t,n){const s=this._allLayoutElements.splice(t,1)[0];this._allLayoutElements.splice(n,0,s);const i=this._getPanel();const o=i.getProperty("expanded");const a=i._getCurrentExpandedElement();if(o&&a){const e=a.sourceElements.values().next().value;i.updateFullScreenElement(e,{index:this._allLayoutElements.indexOf(a.targetContainer)})}},onDropManageSections:function e(t){try{const n=this;function s(){B(n._layoutTable,c)}const i=n._getPanel();const o=i.getId();const a=t.getParameter?.("draggedControl")||t.draggedControl;const r=a.getParent()?.indexOfItem(a);const l=t.getParameter?.("droppedControl")||t.droppedControl;const c=a.getParent()?.indexOfItem(l);const d=function(){if(r!==c){const e=n._orderedSections;const t=a.getBindingContext()?.getObject();const s=l.getBindingContext()?.getObject();const d=n._getActualIndex(t.completeId);const g=n._getActualIndex(s.completeId);n._rearrangeLayoutElements(d,g);e.splice(r,1);e.splice(c,0,t);i.setSections(e);n._manageSectionsChanges.push({selectorElement:i,changeSpecificData:{changeType:T.MOVE,movedElements:[{id:t.completeId,sourceIndex:d,targetIndex:g}],source:{id:o,aggregation:"items"},target:{id:o,aggregation:"items"}}});return Promise.resolve(n._saveManageSectionsDialog()).then(function(){const e=u.getElementById(t.completeId);const i=u.getElementById(s.completeId);n._switchToCollapsedViewIfRequired([e,i])})}}();return Promise.resolve(d&&d.then?d.then(s):s(d))}catch(g){return Promise.reject(g)}},resetMyhomeSettings:function e(){const t=this;o.show(this._i18nBundle.getText("reset_cards_confirmation_msg"),{id:"resetCardsConfirmation",icon:o.Icon.QUESTION,title:this._i18nBundle.getText("reset_cards_confirmation_title"),actions:[this._i18nBundle.getText("reset_cards_button"),o.Action.CANCEL],onClose:function(e){try{const n=function(){if(e===t._i18nBundle.getText("reset_cards_button")){const e=[];for(let n of t._orderedSections){const t=u.getElementById(n.completeId);e.push(t)}e.push(t._getPanel());return Promise.resolve(h.load({name:"sap.ui.fl"}).then(()=>{sap.ui.require(["sap/ui/fl/write/api/ControlPersonalizationWriteAPI"],n=>{void n.reset({selectors:e,changeTypes:[T.MOVE,T.UNHIDE,T.HIDE]}).finally(()=>{const e=t._getPanel();e.resetSections();e.closeSettingsDialog()})})})).then(function(){})}}();return Promise.resolve(n&&n.then?n.then(function(){}):void 0)}catch(e){return Promise.reject(e)}}})}});return L});
//# sourceMappingURL=LayoutSettingsPanel.js.map