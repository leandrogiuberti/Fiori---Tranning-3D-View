/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)
 *  * (c) Copyright 2009-2025 SAP SE. All rights reserved
 */
sap.ui.define(["sap/base/Log","sap/f/GridContainer","sap/f/GridContainerSettings","sap/m/Button","sap/m/ColorPalette","sap/m/ColorPalettePopover","sap/m/CustomListItem","sap/m/Dialog","sap/m/HBox","sap/m/IllustratedMessage","sap/m/IllustratedMessageSize","sap/m/IllustratedMessageType","sap/m/Input","sap/m/Label","sap/m/List","sap/m/MessageBox","sap/m/MessageStrip","sap/m/MessageToast","sap/m/NavContainer","sap/m/ObjectIdentifier","sap/m/Page","sap/m/Popover","sap/m/ScrollContainer","sap/m/SearchField","sap/m/StandardListItem","sap/m/Text","sap/m/Title","sap/m/Toolbar","sap/m/ToolbarSpacer","sap/m/VBox","sap/m/library","sap/ui/base/Event","sap/ui/core/Element","sap/ui/core/EventBus","sap/ui/core/Icon","sap/ui/core/library","sap/ui/core/message/MessageType","sap/ui/core/theming/Parameters","sap/ui/layout/form/SimpleForm","sap/ui/layout/library","sap/ushell/Config","sap/ushell/Container","sap/ushell/components/pages/MyHomeImport","sap/ushell/components/pages/controller/PageRuntime.controller","./BaseApp","./BaseAppPersPanel","./Group","./MenuItem","./RecommendedAppPanel","./utils/Accessibility","./utils/Constants","./utils/DataFormatUtils","./utils/Device","./utils/FESRUtil","./utils/InsightsUtils"],function(e,t,n,o,i,s,r,a,l,c,p,u,d,g,h,f,m,_,I,v,P,A,C,M,y,G,B,x,D,T,S,$,b,z,w,E,F,N,V,U,R,j,L,H,k,O,K,W,X,Y,q,J,Q,Z,ee){"use strict";function te(e){return e&&e.__esModule&&typeof e.default!=="undefined"?e.default:e}const ne=typeof Symbol!=="undefined"?Symbol.iterator||(Symbol.iterator=Symbol("Symbol.iterator")):"@@iterator";function oe(e,t,n){if(!e.s){if(n instanceof ie){if(n.s){if(t&1){t=n.s}n=n.v}else{n.o=oe.bind(null,e,t);return}}if(n&&n.then){n.then(oe.bind(null,e,t),oe.bind(null,e,2));return}e.s=t;e.v=n;const o=e.o;if(o){o(e)}}}const ie=function(){function e(){}e.prototype.then=function(t,n){const o=new e;const i=this.s;if(i){const e=i&1?t:n;if(e){try{oe(o,1,e(this.v))}catch(e){oe(o,2,e)}return o}else{return this}}this.o=function(e){try{const i=e.v;if(e.s&1){oe(o,1,t?t(i):i)}else if(n){oe(o,1,n(i))}else{oe(o,2,i)}}catch(e){oe(o,2,e)}};return o};return e}();function se(e){return e instanceof ie&&e.s&1}function re(e,t,n){var o=-1,i,s;function r(a){try{while(++o<e.length&&(!n||!n())){a=t(o);if(a&&a.then){if(se(a)){a=a.v}else{a.then(r,s||(s=oe.bind(null,i=new ie,2)));return}}}if(i){oe(i,1,a)}else{i=a}}catch(e){oe(i||(i=new ie),2,e)}}r();return i}const ae=S["ButtonType"];function le(e,t,n){if(typeof e[ne]==="function"){var o=e[ne](),i,s,r;function p(e){try{while(!(i=o.next()).done&&(!n||!n())){e=t(i.value);if(e&&e.then){if(se(e)){e=e.v}else{e.then(p,r||(r=oe.bind(null,s=new ie,2)));return}}}if(s){oe(s,1,e)}else{s=e}}catch(e){oe(s||(s=new ie),2,e)}}p();if(o.return){var a=function(e){try{if(!i.done){o.return()}}catch(e){}return e};if(s&&s.then){return s.then(a,function(e){throw a(e)})}a()}return s}if(!("length"in e)){throw new TypeError("Object is not iterable")}var l=[];for(var c=0;c<e.length;c++){l.push(e[c])}return re(l,function(e){return t(l[e])},n)}const ce=S["ListType"];function pe(e,t){try{var n=e()}catch(e){return t(e)}if(n&&n.then){return n.then(void 0,t)}return n}const ue=S["PlacementType"];function de(e,t){try{var n=e()}catch(e){return t(true,e)}if(n&&n.then){return n.then(t.bind(null,false),t.bind(null,true))}return t(false,n)}const ge=E["dnd"];const he=U["form"];const fe=k["ActionsPopover"];const me=te(O);const _e=te(K);const Ie=te(W);const ve=te(X);const Pe=Y["checkPanelExists"];const Ae=Y["getInvisibleText"];const Ce=q["DEFAULT_BG_COLOR"];const Me=q["END_USER_COLORS"];const ye=q["MYAPPS_SECTION_ID"];const Ge=q["MYHOME_PAGE_ID"];const Be=J["getLeanURL"];const xe=J["recycleId"];const De=Q["DeviceType"];const Te=Z["addFESRId"];const Se=Z["addFESRSemanticStepName"];const $e=ee["sortMenuItems"];const be=()=>R.last("/core/shell/enablePersonalization")||R.last("/core/catalog/enabled");var ze=function(e){e["CREATE_GROUP"]="createGrpMenuBtn";e["ADD_APPS"]="addAppsMenuBtn";e["ADD_FROM_INSIGHTS"]="addInsightsMenuBtn";return e}(ze||{});const we="sap.cux.home.TilesPanel";const Ee="sap.cux.home.InsightsContainer";const Fe=[ze.CREATE_GROUP,ze.ADD_APPS,ze.ADD_FROM_INSIGHTS,"settings"];const Ne=me.extend("sap.cux.home.FavAppPanel",{metadata:{library:"sap.cux.home",defaultAggregation:"apps",aggregations:{apps:{type:"sap.cux.home.App",singularName:"app",multiple:true,visibility:"hidden"},groups:{type:"sap.cux.home.Group",singularName:"group",multiple:true,visibility:"hidden"}}},constructor:function e(t,n){me.prototype.constructor.call(this,t,n);this._selectedApps=[];this._isInitialLoad=true;this._updateAppColorPersonalization=(e,t)=>{const{visualization:n,color:o}=t;const{appId:i,oldAppId:s,persConfig:r}=n;const a=r?.sectionId;const l=r?.isDefaultSection;const c=this._getPersonalizationIndex(e,{appId:i,oldAppId:s,sectionId:a,isRecentlyAddedApp:l});if(c>-1){e[c].BGColor=o}else{e.push({BGColor:o,sectionId:a,isRecentlyAddedApp:l,appId:i,isSection:false})}}},init:function e(){const t=this,n=this;me.prototype.init.call(this);this.setProperty("key","favApps");this.setProperty("title",this._i18nBundle.getText("favoritesTab"));this.setProperty("tooltip",this._i18nBundle.getText("favAppsInfo"));void this._createActionButtons();this._createHeaderMenuItems();const o=this._generateAppsWrapper();if(o){this.addDragDropConfigTo(o,e=>this._onFavItemDrop(e),e=>this._handleKeyboardMoveApp(e),ge.DropPosition.OnOrBetween)}this.oEventBus=z.getInstance();this.oEventBus.subscribe("importChannel","appsImport",function(e,n,o){try{const e=o?.apps||[];const n=o?.groupInfo||[];return Promise.resolve(t.addAppsAndSections(e,n)).then(function(){t._importdone();return Promise.resolve(t.getParent()._refreshAllPanels()).then(function(){})})}catch(e){return Promise.reject(e)}},this);this.oEventBus.subscribe("importChannel","resetImported",function(){try{return Promise.resolve(n.setImportButtonVisibility(true)).then(function(){})}catch(e){return Promise.reject(e)}},this);this.attachPersistDialog(()=>{if(this._selectedGroupId){void this._showGroupDetailDialog(this._selectedGroupId)}});document.addEventListener("click",e=>this._resetCutElement(e));document.addEventListener("keydown",e=>this._resetCutElement(e))},_importdone:function e(){const t={status:true};this.oEventBus.publish("importChannel","appsImported",t)},addAppsAndSections:function e(t,n){try{const e=this;let o=[];return Promise.resolve(e._getAppPersonalization()).then(function(i){function s(){return Promise.resolve(e.setFavAppsPersonalization(i)).then(function(){return o.reduce((e,t)=>e.then(()=>t()),Promise.resolve()).then(()=>e.updateDefaultSectionPersonalization(i))})}const r=le(t,function(t){const s=t.visualizations;const r=function(){if(s?.length){function r(){const o=e.filterPersonalizations(n,t);i=i.concat(o)}const a=function(){if(t.default||t.id===ye){o.push(()=>t.default?e.addSectionViz(s):e.addSectionViz(s,ye))}else{return Promise.resolve(e.appManagerInstance._getSections(true)).then(function(n){const i=n.findIndex(e=>e.id===t.id);if(i>-1){o.push(()=>e.addSectionViz(s,t.id))}else{o.push(()=>e.appManagerInstance.addSection({sectionIndex:n.length,sectionProperties:{id:t.id,title:t.title,visible:true,visualizations:s}}))}})}}();return a&&a.then?a.then(r):r(a)}}();if(r&&r.then)return r.then(function(){})});return r&&r.then?r.then(s):s(r)})}catch(e){return Promise.reject(e)}},filterPersonalizations:function e(t,n,o){const i=t.reduce(function(e,t){if(t.sectionId===n.id){const i=n.visualizations;const s=i?.find(e=>e.targetURL===t.appId);if(s||t.isSection){t.sectionId=o||n.id;e.push(t)}}return e},[]);return i},updateDefaultSectionPersonalization:function e(t){try{const e=this;return Promise.resolve(e.appManagerInstance._getSections(true)).then(function(e){let n=e.find(e=>e.default);if(n){t.forEach(e=>{if(e.isRecentlyAddedApp){e.sectionId=n.id}})}return t})}catch(e){return Promise.reject(e)}},addSectionViz:function e(t,n){try{const e=this;return Promise.resolve(t.reduce((t,o)=>t.then(function(){try{let t=false;function i(i){return t?i:e._addVisualization({visualization:o},n)}const s=function(){if(o.isBookmark&&n){return Promise.resolve(e.appManagerInstance._getSections()).then(function(i){const s=i.find(e=>e.default);const r=i.find(e=>e.id===n);if(s&&r){const a={sourceSectionIndex:i.indexOf(s),sourceVisualizationIndex:s.visualizations.length,targetSectionIndex:i.indexOf(r),targetVisualizationIndex:r.visualizations.length};const l=e._addVisualization({visualization:o},n,a);t=true;return l}})}}();return Promise.resolve(s&&s.then?s.then(i):i(s))}catch(r){return Promise.reject(r)}}),Promise.resolve()))}catch(e){return Promise.reject(e)}},loadApps:function e(){try{const e=this;return Promise.resolve(e.appManagerInstance.fetchFavVizs(true,false)).then(function(t){function n(){if(Pe(l,Ee,we)){e._createAddFromInsTilesMenuItem(ze.ADD_FROM_INSIGHTS)}l._updateContainerHeader(l)}const o=e.getDeviceType()===De.Mobile;e.destroyAggregation("groups",true);const i=t.filter(e=>e.isSection).map(t=>({...t,menuItems:e._getGroupActions(t)}));const s=e._generateGroups(i);e._setGroups(s);e.destroyAggregation("apps",true);const r=t.filter(e=>!e.isSection).map((t,n)=>({...t,menuItems:e._getAppActions(undefined,n,t)}));const a=e.generateApps(r);e.setApps(a);if(e._selectedGroupId){void e._setGroupDetailDialogApps(e._selectedGroupId)}const l=e.getParent();l.toggleMenuListItem(e._createGroupMenuItem,e.getApps().length>0);const c=function(){if(!o){return Promise.resolve(e._switchToRecommendedIfNoFavApps(a,s)).then(function(){})}}();return c&&c.then?c.then(n):n(c)})}catch(e){return Promise.reject(e)}},_switchToRecommendedIfNoFavApps:function e(t,n){try{const o=this;function i(){o._isInitialLoad=false}const s=o.getParent();const r=s.getContent();const a=r?r.find(e=>e instanceof ve):null;const l=function(){if(o._isInitialLoad&&[...t,...n].length===0&&a?.isSupported()){s.setProperty?.("selectedKey","recommendedApps");return Promise.resolve(s.refreshPanel(a)).then(function(){})}}();return Promise.resolve(l&&l.then?l.then(i):i(l))}catch(c){return Promise.reject(c)}},_createAddFromInsTilesMenuItem:function e(t){const n=`${this.getId()}-${t}`;if(!this._controlMap.get(n)){const e=new Ie(n,{title:this._i18nBundle.getText("addFromInsights"),icon:"sap-icon://duplicate",press:()=>void this._handleAddFromInsights()});Te(e,"staticTilesDialog");this._menuItems.push(e);this.addAggregation("menuItems",e);this._sortMenuItems(Fe);this._controlMap.set(n,e)}return this._controlMap.get(n)},_sortMenuItems:function e(t){const n=this.getAggregation("menuItems");let o=$e(t,n);this.removeAllAggregation("menuItems");o?.forEach(e=>this.addAggregation("menuItems",e))},_generateGroups:function e(t){return t.map((e,t)=>{const n=typeof e.BGColor==="object"&&"key"in e.BGColor?e.BGColor.key:e.BGColor;const o=new _e(`${this.getId()}-group-${t}`,{title:e.title,bgColor:n,status:e.status,icon:e.icon,number:e.badge,groupId:e.id,press:this._handleGroupPress.bind(this)});e.menuItems?.forEach(e=>{o.addAggregation("menuItems",e)});return o})},_setGroups:function e(t){t.forEach(e=>{this.addAggregation("groups",e,true)})},_getAppActions:function e(t,n,o){const i=t?.getGroupId();const s=o?.persConfig?.isDefaultSection;const r=!i;const a=[];const l=new Ie({id:i&&!s?xe(`_${i}--selectColorGroupAppMenuItem--${n}`):xe(`_${this.getKey()}--selectColorAppMenuItem--${n}`),title:this._i18nBundle.getText("selectColor"),type:ce.Navigation,press:this._openColorPopover.bind(this)});a.push(l);Te(l,"changeColor");if(this._getAllowedMoveGroups(i)?.length>=1){const e=new Ie({id:i&&!s?xe(`_${i}--moveToGroupAppMenuItem--${n}`):xe(`_${this.getKey()}--moveToMenuItem--${n}`),title:this._i18nBundle.getText("moveTo"),type:ce.Navigation,press:e=>this._openMoveToGroupPopover(e,t)});a.push(e);Te(e,"moveToGroup")}if(r){const e=new Ie(xe(`${this.getKey()}--createGroupMenuItem--${n}`),{title:this._i18nBundle.getText("createGroup"),press:e=>{const t=e.getSource();const n=t.getParent();this._selectedApps=[n];this._openCreateGroupDialog()}});a.push(e);Te(e,"createGroupDialog")}const c=new Ie({id:i&&!s?xe(`_${i}--removeFromMyHomeGroupAppMenuItem--${n}`):xe(`_${this.getKey()}--removeFromMyHomeMenuItem--${n}`),title:this._i18nBundle.getText("removeFromMyHome"),press:e=>{const n=e.getSource();const o=n.getParent();this._handleRemove(o,t)}});a.push(c);Te(c,"removeFromMyHome");if(!r){const e=new Ie({id:xe(`${this.getKey()}--removeFromGroupMenuItem--${n}`),title:this._i18nBundle.getText("removeFromGroup"),press:e=>{const t=e.getSource();const n=t.getParent();void this._handleMoveToGroup(n,i)}});a.push(e);Te(e,"ungroupApp")}return a},_getGroupActions:function e(t){const n=new Ie(`id-${t.id}-renameGroup`,{title:this._i18nBundle.getText("renameGroup"),press:this._onRenameGroup.bind(this)});Te(n,"renameGroup");const o=new Ie(`id-${t.id}-selectColor`,{title:this._i18nBundle.getText("selectColor"),type:ce.Navigation,press:this._openColorPopover.bind(this)});Te(o,"changeColor");const i=new Ie(`id-${t.id}-removeAllApps`,{title:this._i18nBundle.getText("removeAllApps"),press:this._handleUngroupApps.bind(this,t)});Te(i,"removeAllApps");const s=[n,o,i];if(!t.isPresetSection){const e=new Ie(`id-${t.id}-delete`,{title:this._i18nBundle.getText("delete"),press:this._onDeleteGroup.bind(this)});Te(e,"deleteGroup");s.push(e)}return s},_createActionButtons:function e(){try{const e=this;if(!e._actionButtons){e._actionButtons=[];if(be()){const t=new o(`${e.getId()}-addAppsBtn`,{icon:"sap-icon://action",tooltip:e._i18nBundle.getText("addAppsTooltip"),text:e._i18nBundle.getText("addApps"),press:()=>{void e.navigateToAppFinder()}});Te(t,"addAppsBtn");e._actionButtons.push(t)}}e._actionButtons.forEach(t=>{e.addAggregation("actionButtons",t)});return Promise.resolve(e._validateAppsMigration()).then(function(t){if(t){e._createImportButton()}})}catch(e){return Promise.reject(e)}},_createImportButton:function e(){if(!this._importButton){this._importButton=new o(`${this.getId()}-importAppsBtn`,{tooltip:this._i18nBundle.getText("importAppsNow"),text:this._i18nBundle.getText("importAppsNow"),press:this._openImportAppsDialog.bind(this)});Te(this._importButton,"importAppsDialog");this._actionButtons.push(this._importButton);this.insertAggregation("actionButtons",this._importButton,0)}return this._importButton},setImportButtonVisibility:function e(t){try{const e=this;return Promise.resolve(L.setImportEnabled(t)).then(function(){e._createImportButton().setVisible(t)})}catch(e){return Promise.reject(e)}},_createHeaderMenuItems:function e(){if(!this._menuItems){this._createGroupMenuItem=new Ie(`${this.getId()}-${ze.CREATE_GROUP}`,{title:this._i18nBundle.getText("createGroup"),icon:"sap-icon://add",press:()=>this._openCreateGroupDialog()});this._menuItems=[this._createGroupMenuItem];if(be()){this._menuItems.push(new Ie(`${this.getId()}-${ze.ADD_APPS}`,{title:this._i18nBundle.getText("addApps"),icon:"sap-icon://action",press:()=>{void this.navigateToAppFinder()}}))}Te(this._createGroupMenuItem,"createGroupDialog");const e=this._menuItems.find(e=>e.getId()===`${this.getId()}-${ze.ADD_APPS}`);if(e){Te(e,"appsAppFinder")}this._menuItems.forEach(e=>{this.addAggregation("menuItems",e,true)});this._sortMenuItems(Fe)}},_getDragDropInfo:function e(t,n){try{const e=this;const o=t.getParameter?.("draggedControl"),i=t.getParameter?.("droppedControl"),s=t.getParameter?.("dropPosition"),r=o.getParent(),a=r.indexOfItem(o),l=r.indexOfItem(i),c=e._getTileItem(o,n),p=e._getTileItem(i,n);const u={dragItem:c,dropItem:p,dropPosition:s,dropControl:r,dragItemIndex:a,dropItemIndex:l};const d=function(){if(a!==l){const t=function(){if(!(c instanceof _e)&&!(p instanceof _e)){return Promise.resolve(e._adjustAppDragDropInfo(u,n)).then(function(){})}else{const t=function(){if(c instanceof _e){return Promise.resolve(e._adjustGroupDragDropInfo(u)).then(function(){})}}();if(t&&t.then)return t.then(function(){})}}();if(t&&t.then)return t.then(function(){})}}();return Promise.resolve(d&&d.then?d.then(function(){return u}):u)}catch(e){return Promise.reject(e)}},_adjustAppDragDropInfo:function e(t,n){try{const e=this;let o=false;const i=t.dragItem;const s=t.dropItem;return Promise.resolve(Promise.all([e.appManagerInstance.getVisualization(i.getUrl(),n),e.appManagerInstance.getVisualization(s.getUrl(),n)])).then(function([i,s]){if(t.dropPosition===ge.RelativeDropPosition.Before){if(t.dragItemIndex===t.dropItemIndex-1){t.dropItemIndex--}if(t.dragItemIndex<t.dropItemIndex&&i?.persConfig?.sectionIndex===s?.persConfig?.sectionIndex){t.dropItemIndex--;o=true}}else if(t.dropPosition===ge.RelativeDropPosition.After){if(t.dragItemIndex===t.dropItemIndex+1){t.dropItemIndex++}if(t.dragItemIndex>t.dropItemIndex&&i?.persConfig?.sectionIndex===s?.persConfig?.sectionIndex){t.dropItemIndex++;o=true}}if(o){const o=t.dropControl.getItems()[t.dropItemIndex];const i=e._getTileItem(o,n);if(i){t.dropItem=i}}})}catch(e){return Promise.reject(e)}},_getTileItem:function e(t,n){const o=t.data("groupId");if(o){return this._getGroup(o)}else{const e=n?this._getGroup(n):null;const o=e?e.getApps():this.getApps();return o.find(e=>Be(e.getUrl())===t.getUrl())}},_adjustGroupDragDropInfo:function e(t){try{const e=this;return Promise.resolve(e.appManagerInstance._getSections()).then(function(n){let o;t.dragItemIndex=n.findIndex(e=>e.id===t.dragItem.getGroupId());if(!(t.dropItem instanceof _e)){const n=e.getAggregation("groups").length;t.dropItemIndex=t.dropPosition===ge.RelativeDropPosition.Before&&t.dropItemIndex===n&&t.dragItemIndex!==n?n+1:t.dragItemIndex}else{o=n.findIndex(e=>e.id===t.dropItem.getGroupId());t.dropItemIndex=o}if(t.dropPosition===ge.RelativeDropPosition.Before&&t.dragItemIndex===t.dropItemIndex-1){t.dropItemIndex--}else if(t.dropPosition===ge.RelativeDropPosition.After&&(t.dragItemIndex!==t.dropItemIndex||o&&t.dropItemIndex>=o)){t.dropItemIndex++}})}catch(e){return Promise.reject(e)}},_onFavItemDrop:function e(t,n){try{const e=this;const o=t.getParameter?.("draggedControl");return Promise.resolve(e._getDragDropInfo(t,n)).then(function(t){function i(){o.removeStyleClass("sapMGTPressActive")}const{dragItemIndex:s,dropItemIndex:r,dropPosition:a,dragItem:l,dropItem:c}=t;if(s===r)return;const p=function(){if(a===ge.RelativeDropPosition.On){return Promise.resolve(e._handleOnItemDrop(l,c)).then(function(){void e.refresh()})}else{const o=function(){if(a===ge.RelativeDropPosition.After||a===ge.RelativeDropPosition.Before){e._setBusy(true);return Promise.resolve(e._handleItemsReorder(t,n)).then(function(){return Promise.resolve(e.refresh()).then(function(){if(n){void e._setGroupDetailDialogApps(n)}e._setBusy(false)})})}}();if(o&&o.then)return o.then(function(){})}}();return p&&p.then?p.then(i):i(p)})}catch(e){return Promise.reject(e)}},_handleOnItemDrop:function e(t,n){try{const e=this;if(t instanceof _e)return Promise.resolve();const o=function(){if(!(n instanceof _e)){const o=t;const i=n;e._selectedApps=[o,i];e._openCreateGroupDialog(true)}else{const o=n.getGroupId();e._setBusy(true);return Promise.resolve(e._handleMoveToGroup(t,undefined,o)).then(function(){e._setBusy(false)})}}();return Promise.resolve(o&&o.then?o.then(function(){}):void 0)}catch(e){return Promise.reject(e)}},_handleItemsReorder:function e(t,n){try{const e=this;const{dragItem:o,dropItem:i,dragItemIndex:s,dropItemIndex:r}=t;const a=o.getMetadata()?.getName()==="sap.cux.home.Group";const l=i.getMetadata()?.getName()==="sap.cux.home.Group";const c=function(){if(!a&&!l){const t=o;const s=i;return Promise.resolve(Promise.all([e.appManagerInstance.getVisualization(t.getUrl(),n),e.appManagerInstance.getVisualization(s.getUrl(),n)])).then(function([t,n]){return Promise.resolve(e.appManagerInstance.moveVisualization({sourceSectionIndex:t?.persConfig?.sectionIndex,sourceVisualizationIndex:t?.persConfig?.visualizationIndex,targetSectionIndex:n?.persConfig?.sectionIndex,targetVisualizationIndex:n?.persConfig?.visualizationIndex})).then(function(){})})}else{const t=function(){if(a&&l){return Promise.resolve(e.appManagerInstance.moveSection(s,r)).then(function(){})}}();if(t&&t.then)return t.then(function(){})}}();return Promise.resolve(c&&c.then?c.then(function(){}):void 0)}catch(e){return Promise.reject(e)}},navigateToAppFinder:function e(t){try{return Promise.resolve(j.getServiceAsync("Navigation")).then(function(e){const n={pageID:Ge};if(t){n.sectionID=t}return Promise.resolve(e.navigate({target:{shellHash:`Shell-appfinder?&/catalog/${JSON.stringify(n)}`}})).then(function(){})})}catch(e){return Promise.reject(e)}},_validateAppsMigration:function t(){try{return Promise.resolve(pe(function(){return Promise.resolve(L.isImportEnabled())},function(t){e.warning(t instanceof Error?t.message:"Error while checking if import apps is enabled");return false}))}catch(e){return Promise.reject(e)}},_openImportAppsDialog:function e(){const t=new H;t.onImportDialogPress()},_openCreateGroupDialog:function e(t=false){const n=this._generateCreateGroupDialog(t);const o=this._controlMap.get(`${this.getId()}-createGroupDialog-appsPage-scrollContainer-apps`);o.destroyItems();const i=[...this.getApps()].map(e=>{const t=e.clone();t._onPress=e=>this._highlightApp(e,t);return this.getParent()._getAppTile(t)});this._setAggregation(o,i);let s=this.getApps();this.getParent().fireEvent("appsLoaded",{apps:s,tiles:i});this._updateSelectedAppCount();n.open()},_closeCreateGroupDialog:function e(){const t=this._generateCreateGroupDialog();t?.close();this._resetCreateGroupDialog()},_resetCreateGroupDialog:function e(){const t=this._generateCreateGroupNavContainer();const n=this._controlMap.get(`${this.getId()}-createGroupDialog-mainPage-form-groupName-input`);const o=this._controlMap.get(`${this.getId()}-createGroupDialog-appsPage-search`);n.setValue("");t.to(t.getInitialPage());this._selectedApps=[];o.setValue("");this._setNoAppsSelectedError(false);this._selectedGroupColor=undefined},_generateCreateGroupDialog:function e(t=true){const n=`${this.getId()}-createGroupDialog`;const i=this._generateCreateGroupNavContainer();const s=e=>{const t=this._controlMap.get(`${n}-nextBtn`);const o=this._controlMap.get(`${n}-backBtn`);const s=this._controlMap.get(`${n}-createBtn`);const r=i.indexOfPage(i.getCurrentPage());t.setVisible(r!==i.getPages().length-1&&!e);o.setVisible(r!==0&&!e);s.setVisible(r===i.getPages().length-1||e)};if(!this._controlMap.get(n)){this._controlMap.set(`${n}-nextBtn`,new o({id:`${n}-nextBtn`,text:this._i18nBundle.getText("nextButton"),press:()=>{if(this._validateGroupName()){i.to(this._generateCreateGroupAppsPage());s(t);this._highlightSelectedApps()}},type:"Emphasized"}));const e=this._controlMap.get(`${n}-nextBtn`);Se(e,"press","createGroupNextBtn");this._controlMap.set(`${n}-backBtn`,new o({id:`${n}-backBtn`,text:this._i18nBundle.getText("backButton"),press:()=>{i.back();s(t)}}));const r=this._controlMap.get(`${n}-backBtn`);Se(r,"press","createGroupBackBtn");this._controlMap.set(`${n}-createBtn`,new o({id:`${n}-createBtn`,text:this._i18nBundle.getText("createButton"),press:()=>{void this._onPressGroupCreate()},type:"Emphasized"}));const l=this._controlMap.get(`${n}-createBtn`);Se(l,"press","addCreateGroup");this._controlMap.set(n,new a(n,{title:this._i18nBundle.getText("createGroup"),content:i,escapeHandler:this._closeCreateGroupDialog.bind(this),contentHeight:"25rem",contentWidth:"41.75rem",buttons:[e,r,l,new o({id:`${n}-cancelBtn`,text:this._i18nBundle.getText("cancelBtn"),press:this._closeCreateGroupDialog.bind(this)})]}).addStyleClass("sapCuxCreateGroupDialog sapContrastPlus"))}s(t);return this._controlMap.get(n)},_highlightApp:function e(t,n){const o=t.getSource(),i=!o.hasStyleClass("sapCuxHighlightApp"),s=this._generateAppsScrollContainer();this._selectedApps=this._selectedApps||[];if(i){this._selectedApps.push(n)}else{this._selectedApps.splice(this._selectedApps.findIndex(e=>n.getUrl()===e.getUrl()),1)}this._updateSelectedAppCount();o.toggleStyleClass("sapCuxHighlightApp",i);this._setNoAppsSelectedError(this._selectedApps.length<1);s.setHeight(this._selectedApps.length<1?"15.3rem":"17.5rem")},_generateAppsScrollContainer:function e(){const o=`${this.getId()}-createGroupDialog-appsPage-scrollContainer`;if(!this._controlMap.get(o)){this._controlMap.set(`${o}-apps`,new t({id:`${o}-apps`,layout:new n(`${o}--appsContainerSettings`,{columnSize:"19rem",gap:"0.5rem"})}).addStyleClass("sapCuxAppsGridContainerPadding"));this._controlMap.set(o,new C(o,{id:o,vertical:true,visible:true,height:"17.5rem",content:[this._controlMap.get(`${o}-apps`)]}).addStyleClass("sapUiSmallMarginBeginEnd"))}return this._controlMap.get(o)},_updateSelectedAppCount:function e(){const t=this._controlMap.get(`${this.getId()}-createGroupDialog-appsPage-headerContainer-count`);t.setText(this._i18nBundle.getText("selectedAppsCount",[this._selectedApps?.length||this._i18nBundle.getText("noAppSelected")]))},_generateCreateGroupNavContainer:function e(){const t=`${this.getId()}-createGroupDialog-wrapper`;if(!this._controlMap.get(t)){this._controlMap.set(t,new I(t,{initialPage:`${this.getId()}-createGroupDialog-mainPage`,pages:[this._generateCreateGroupMainPage(),this._generateCreateGroupAppsPage()]}))}return this._controlMap.get(t)},_generateCreateGroupMainPage:function e(){const t=`${this.getId()}-createGroupDialog-mainPage`;if(!this._controlMap.get(t)){this._controlMap.set(`${t}-form-groupName-input`,new d({id:`${t}-form-groupName-input`,width:"13.75rem",required:true,liveChange:this._validateGroupName.bind(this)}));this._controlMap.set(t,new P({id:t,showHeader:false,enableScrolling:false,backgroundDesign:"List",content:[new T({id:`${t}-headerContainer`,items:[new B({id:`${t}-title`,text:this._i18nBundle.getText("settings")}),new G({id:`${t}-description`,text:this._i18nBundle.getText("settingsDescription")})]}).addStyleClass("sapUiSmallMarginTop sapUiSmallMarginBeginEnd sapUiTinyMarginBottom"),new V(`${t}-form`,{layout:he.SimpleFormLayout.ResponsiveGridLayout,labelSpanS:4,labelSpanM:4,content:[new g({id:`${t}-form-groupName-label`,text:this._i18nBundle.getText("groupNameLbl")}).addStyleClass("sapUiTinyMarginTop"),this._controlMap.get(`${t}-form-groupName-input`),new g({id:`${t}-form-groupColor-label`,text:this._i18nBundle.getText("groupColorLbl")}).addStyleClass("sapUiTinyMarginTop"),new i(`${t}-form-groupColor-pallet`,{colors:Me().map(e=>e.value),colorSelect:this._onColorSelect.bind(this)}).addStyleClass("adjustSelectedColorPalette")]}).addStyleClass("sapUiMediumMarginTop")]}))}return this._controlMap.get(t)},_generateCreateGroupAppsPage:function e(){const t=`${this.getId()}-createGroupDialog-appsPage`;if(!this._controlMap.get(t)){this._controlMap.set(`${t}-search`,new M({id:`${t}-search`,liveChange:this._onCreateAppSearch.bind(this)}).addStyleClass("sapUiTinyMarginTopBottom"));this._controlMap.set(`${t}-errorMessageStrip`,new m(`${t}-errorMessageStrip`,{id:`${t}-errorMessageStrip`,type:F.Error,showIcon:true,text:this._i18nBundle.getText("selectionErrorMessage"),visible:false}));this._controlMap.set(`${t}-headerContainer-count`,new G({id:`${t}-headerContainer-count`}));this._controlMap.set(t,new P(t,{showHeader:false,backgroundDesign:"List",enableScrolling:false,content:[new T(`${t}-headerContainer`,{items:[new l(`${t}-headerContainer-titleCount`,{id:`${t}-headerContainer-titleCount`,items:[new B({id:`${t}-headerContainer-title`,text:this._i18nBundle.getText("selectedAppsTitle")}).addStyleClass("sapUiTinyMarginEnd"),this._controlMap.get(`${t}-headerContainer-count`)]}),new G({id:`${t}-description`,text:this._i18nBundle.getText("appsSelectionDescription")}).addStyleClass("sapUiTinyMarginBottom"),this._controlMap.get(`${t}-search`),this._controlMap.get(`${t}-errorMessageStrip`)]}).addStyleClass("sapUiSmallMarginTop sapUiSmallMarginBeginEnd sapUiTinyMarginBottom"),this._generateAppsScrollContainer(),this._generateCreateGroupErrorMsg()]}))}return this._controlMap.get(t)},_generateCreateGroupErrorMsg:function e(){const t=`${this.getId()}-createGroupDialog-appsPage-noFilterApps`;if(!this._controlMap.get(t)){this._controlMap.set(t,new c({id:t,illustrationSize:p.Base,title:this._i18nBundle.getText("noSearchedAppTitle"),description:this._i18nBundle.getText("noSearchedAppDes"),visible:false}).addStyleClass("sapUiLargeMarginTop"))}return this._controlMap.get(t)},_onColorSelect:function e(t){this._selectedGroupColor=this._getLegendColor(t.getParameter("value")).key},_getLegendColor:function e(t){return Me().find(e=>e.value===t)||Ce()},_setNoAppsSelectedError:function e(t){const n=this._controlMap.get(`${this.getId()}-createGroupDialog-appsPage-errorMessageStrip`);n.setVisible(t)},_validateGroupName:function e(){const t=this._controlMap.get(`${this.getId()}-createGroupDialog-mainPage-form-groupName-input`);const n=t.getValue().trim();t.setValueState(n?"None":"Error");t.setValueStateText(n?"":this._i18nBundle.getText("invalidGroupName"));return n?true:false},_highlightSelectedApps:function e(){const t=this._selectedApps||[];const n=this._controlMap.get(`${this.getId()}-createGroupDialog-appsPage-scrollContainer-apps`);const o=n.getItems()||[];o.forEach(e=>{e.toggleStyleClass("sapCuxHighlightApp",t.some(t=>Be(t.getUrl())===e.getUrl()))})},_onCreateAppSearch:function e(t){const n=this._controlMap.get(`${this.getId()}-createGroupDialog-appsPage-scrollContainer-apps`),o=t.getSource().getValue(),i=n.getItems()||[],s=new RegExp(o,"i");i.forEach(e=>{e.setVisible(s.test(e.getHeader()))});const r=i.filter(e=>e.getVisible());const a=r.length>0;this._generateAppsScrollContainer()?.setVisible(a);this._generateCreateGroupErrorMsg()?.setVisible(!a)},_onPressGroupCreate:function t(){try{const t=this;const n=t._controlMap.get(`${t.getId()}-createGroupDialog-mainPage-form-groupName-input`);const o=function(){if(t._validateGroupName()){const o=function(){if(t._selectedApps?.length){t._setBusy(true);const o=de(function(){return pe(function(){return Promise.resolve(t._createGroup({selectedApps:t._selectedApps,groupName:n.getValue(),groupColor:t._getGroupColor()})).then(function(){return Promise.resolve(t.refresh()).then(function(){_.show(t._i18nBundle.getText("newGroupCreated"),{of:t._controlMap.get(`${t.getId()}-createGroupDialog`),offset:"0 80"});const e=t.getAggregation("groups")||[];void t._showGroupDetailDialog(e[0]?.getGroupId())})})},function(n){e.error(n);_.show(t._i18nBundle.getText("unableToCreateGroup"))})},function(e,n){t._setBusy(false);t._closeCreateGroupDialog();if(e)throw n;return n});if(o&&o.then)return o.then(function(){})}else{t._setNoAppsSelectedError(true)}}();if(o&&o.then)return o.then(function(){})}}();return Promise.resolve(o&&o.then?o.then(function(){}):void 0)}catch(e){return Promise.reject(e)}},_createGroup:function e(t){try{const e=this;const{selectedApps:n,groupName:o,groupColor:i}=t;return Promise.resolve(e.appManagerInstance.getSectionVisualizations()).then(function(t){const s=n.reduce((e,n)=>{const o=t.find(e=>e.url===n.getUrl());if(o){e.push(o)}return e},[]);const r=s[0].persConfig.sectionId;return Promise.resolve(e.appManagerInstance.addSection({sectionIndex:1,sectionProperties:{title:o||e._i18nBundle.getText("newGroup"),visible:true,visualizations:s.map(e=>e.visualization)}})).then(function(){const t=s.reduce((e,t)=>{if(t.visualization?.id){const n=(t.persConfig?.duplicateApps||[]).map(e=>e.visualization?.id);e=e.concat([t.visualization?.id],n)}return e},[]);return Promise.resolve(e.appManagerInstance.removeVisualizations({sectionId:r,vizIds:t})).then(function(){return Promise.resolve(e.appManagerInstance._getSections(true)).then(function(t){const n=t.find(e=>e.default);const o=t[n?1:0]?.id;return Promise.resolve(e._updateAppPersonalization(s.map(e=>({visualization:e,targetGroupId:o})))).then(function(){return Promise.resolve(e._updateGroupPersonalization(o,i)).then(function(){})})})})})})}catch(e){return Promise.reject(e)}},_getGroupColor:function e(){const t=Ce().key;const n=this._selectedApps[0];const o=this._selectedApps.some(e=>e.getBgColor()!==n.getBgColor());return this._selectedGroupColor||(o?t:n.getBgColor())},_openColorPopover:function e(t){const n=`${this.getId()}-colorPopover`,o=Me().map(e=>e.value);const i=t.getSource();this._currentItem=i.getParent();let r=this._controlMap.get(n);if(!r){r=new s(n,{id:n,colors:o,showDefaultColorButton:false,showMoreColorsButton:false,showRecentColorsSection:false,colorSelect:e=>{fe._closeActionsPopover();const t=e.getParameter("value");void this._handleColorSelect(this._currentItem,t)}}).addStyleClass("sapContrastPlus");r._oPopover.setPlacement(ue.HorizontalPreferredRight);this._controlMap.set(n,r)}r.openBy(t.getParameter("listItem"))},_handleColorSelect:function e(t,n){try{const o=this;function i(){o.oEventBus.publish("appsChannel","favAppColorChanged",{item:t,color:n})}const s=o._getLegendColor(n).key;t.setProperty("bgColor",s,true);const r=t instanceof _e?t.getGroupId():null;const a=!r&&t.getParent()instanceof _e;if(a){o._refreshGroupDetailDialog(t,false)}else{o._applyUngroupedTileColor(t,n);o.oEventBus.publish("appsChannel","favAppColorChanged",{item:t,color:n})}const l=function(){if(r){void o._updateGroupPersonalization(r,s);const e=o._controlMap.get(`${o.getId()}-detailDialog-toolbar-color`);e?.setColor(n)}else{const e=t;const n=a?e.getParent().getGroupId():undefined;return Promise.resolve(o.appManagerInstance.getVisualization(e.getUrl(),n)).then(function(e){if(e){void o._updateAppPersonalization([{visualization:e,color:s}])}})}}();return Promise.resolve(l&&l.then?l.then(i):i(l))}catch(c){return Promise.reject(c)}},_getAllowedMoveGroups:function e(t){let n=this.getAggregation("groups")||[];if(t){n=n.filter(e=>e.getGroupId()!==t)}return n},_setBusy:function e(t){[this._generateGroupDetailDialog(),this._generateCreateGroupDialog(),this._generateAddFromInsightsDialog()].forEach(e=>{e.setBusy(t)});me.prototype.setBusy.call(this,t)},_openMoveToGroupPopover:function e(t,n){const o=`${this.getId()}-moveToGroupPopover`,i=t?.getSource(),s=i?.getParent(),r=n?.getGroupId();let a=this._controlMap.get(`${o}-list`),l=this._controlMap.get(o);if(!l){a=new h({id:`${o}-list`,itemPress:()=>fe._closeActionsPopover()});this._controlMap.set(`${o}-list`,a);l=new A({id:o,showHeader:false,placement:ue.HorizontalPreferredRight,content:[a]}).addStyleClass("sapContrastPlus");this._controlMap.set(o,l)}a.removeAllItems();this._getAllowedMoveGroups(r).forEach((e,t)=>a.addItem(new y(xe(`${this.getId()}-moveTo-${s.getId()}-${t}`),{title:e.getTitle(),type:"Active",press:()=>{void this._handleMoveToGroup(s,r,e.getGroupId())}})));l.openBy(t.getParameter("listItem"))},_handleRemove:function t(n,o){const i=this;const s=o?.getApps()?.length===1;let r=this._i18nBundle.getText("removeAppMessage",[n.getTitle()]),a=this._i18nBundle.getText("remove"),l=this._i18nBundle.getText("remove"),c=f.Icon.QUESTION;if(s){r=this._i18nBundle.getText("removeFromMyHomeMessage",[n.getTitle()]);a=this._i18nBundle.getText("delete");l=this._i18nBundle.getText("delete");c=f.Icon.WARNING}f.show(r,{icon:c,title:a,actions:[l,f.Action.CANCEL],emphasizedAction:l,onClose:function(t){try{const r=function(){if(t===l){i._setBusy(true);const t=de(function(){return pe(function(){return Promise.resolve(i._removeApp(n,o)).then(function(){if(s){i._closeGroupDetailDialog()}else if(o){i._refreshGroupDetailDialog(n)}return Promise.resolve(i.getParent()._refreshAllPanels()).then(function(){_.show(i._i18nBundle.getText("appRemoved"))})})},function(t){e.error(t);_.show(i._i18nBundle.getText("unableToRemoveApp"))})},function(e,t){i._setBusy(false);if(e)throw t;return t});if(t&&t.then)return t.then(function(){})}}();return Promise.resolve(r&&r.then?r.then(function(){}):void 0)}catch(e){return Promise.reject(e)}}})},_removeApp:function e(t,n){try{const e=this;const o=n?.getApps()?.length===1,i=n?.getGroupId(),s=t.getUrl();return Promise.resolve(e.appManagerInstance.getVisualization(s,i)).then(function(t){const n=function(){if(o){return Promise.resolve(e._deleteGroup(i)).then(function(){})}else{let n=[t?.visualization?.id];if(!i){n=n.concat(t?.persConfig?.duplicateApps?.map(e=>e.visualization?.id))}const o=function(){if(t?.persConfig?.sectionId&&n.length>0){return Promise.resolve(e.appManagerInstance.removeVisualizations({sectionId:t.persConfig.sectionId,vizIds:n})).then(function(){void e._deletePersonalization({appId:s,oldAppId:t?.oldAppId,sectionId:t?.persConfig?.sectionId,isRecentlyAddedApp:t?.persConfig?.isDefaultSection})})}}();if(o&&o.then)return o.then(function(){})}}();if(n&&n.then)return n.then(function(){})})}catch(e){return Promise.reject(e)}},_handleMoveToGroup:function e(t,n,o){try{const e=this;const i=n?e._getGroup(n):undefined,s=i?.getApps()?.length===1;const r=function(){if(s){const i=e._i18nBundle.getText("moveAppMessage",[t.getTitle()]);const s=e._i18nBundle.getText("delete");f.show(i,{icon:f.Icon.WARNING,title:s,actions:[s,f.Action.CANCEL],emphasizedAction:s,onClose:i=>{if(i===s){void e._moveAppAndHandleGroupChanges(t,n,o)}}})}else{return Promise.resolve(e._moveAppAndHandleGroupChanges(t,n,o)).then(function(){})}}();return Promise.resolve(r&&r.then?r.then(function(){}):void 0)}catch(e){return Promise.reject(e)}},_moveAppAndHandleGroupChanges:function t(n,o,i){try{const t=this;const s=o?t._getGroup(o):null,r=i?t._getGroup(i):null,a=r?.getTitle(),l=s?.getApps()?.length===1;const c=de(function(){return pe(function(){t._setBusy(true);return Promise.resolve(t._moveAppToGroup(n,o,i)).then(function(){function e(){const e=a?t._i18nBundle.getText("appMoved",[a]):t._i18nBundle.getText("appUngrouped");_.show(e);return Promise.resolve(t.refresh()).then(function(){})}const i=function(){if(l){return Promise.resolve(t._deleteGroup(o)).then(function(){t._closeGroupDetailDialog()})}else if(o){t._refreshGroupDetailDialog(n)}}();return i&&i.then?i.then(e):e(i)})},function(t){e.error(t)})},function(e,n){t._setBusy(false);if(e)throw n;return n});return Promise.resolve(c&&c.then?c.then(function(){}):void 0)}catch(e){return Promise.reject(e)}},_refreshGroupDetailDialog:function e(t,n=true){const o=this._controlMap.get(`${this.getId()}-detailDialog-apps`);const i=o.getItems();const s=t.getParent();if(!s){return}const r=s.getApps();if(n){const e=r.findIndex(e=>e.getUrl()===t.getUrl());if(e>-1){r[e].destroy(true);i[e].destroy(true)}}else{r.forEach((e,n)=>{if(e.getUrl()===t.getUrl()){e.setProperty("bgColor",t.getBgColor(),true);i[n].setBackgroundColor(t.getBgColor())}})}},_moveAppToGroup:function e(t,n,o){try{const e=this;const i=t.getUrl();return Promise.resolve(Promise.all([e.appManagerInstance.getSectionVisualizations(n),e.appManagerInstance._getSections()])).then(function([t,s]){const r=t.find(e=>e.url===i),a=r?.persConfig?.visualizationIndex??-1,l=r?.persConfig?.sectionIndex;const c=!o;const p=!n;const u=s.findIndex(e=>!o?e.default:e.id===o);const d=function(){if(r){function t(){return Promise.resolve(e.appManagerInstance._getSections(true)).then(function(t){const n=t.find(e=>e.default);return Promise.resolve(e._updateAppPersonalization([{visualization:r,targetGroupId:o??n?.id,isTargetGroupDefault:c}])).then(function(){})})}const n=function(){if(c){return Promise.resolve(e._moveAppToDefaultGroup(r)).then(function(){})}else{function t(){return Promise.resolve(e.appManagerInstance.moveVisualization({sourceSectionIndex:l,sourceVisualizationIndex:a,targetSectionIndex:u,targetVisualizationIndex:-1})).then(function(){})}const n=function(){if(p){return Promise.resolve(e._removeDuplicateVisualizations(r)).then(function(){})}}();return n&&n.then?n.then(t):t(n)}}();return n&&n.then?n.then(t):t(n)}}();if(d&&d.then)return d.then(function(){})})}catch(e){return Promise.reject(e)}},_moveAppToDefaultGroup:function e(t){try{const e=this;return Promise.resolve(e._addVisualization(t)).then(function(){const n=function(){if(t.persConfig?.sectionId&&t.visualization?.id){return Promise.resolve(e.appManagerInstance.removeVisualizations({sectionId:t.persConfig?.sectionId,vizIds:[t.visualization?.id]})).then(function(){})}}();if(n&&n.then)return n.then(function(){})})}catch(e){return Promise.reject(e)}},_removeDuplicateVisualizations:function e(t){try{const e=this;const n=t?.persConfig?.duplicateApps?.map(e=>e.visualization?.id)||[];const o=function(){if(t.persConfig?.sectionId&&n.length>0){return Promise.resolve(e.appManagerInstance.removeVisualizations({sectionId:t.persConfig?.sectionId,vizIds:n})).then(function(){})}}();return Promise.resolve(o&&o.then?o.then(function(){}):void 0)}catch(e){return Promise.reject(e)}},_onRenameGroup:function e(t){const n=t.getSource()?.getParent();void this._showGroupDetailDialog(n.getGroupId(),true)},_handleUngroupApps:function e(t){const n=this._i18nBundle.getText("ungroupAppsMessage",[t.title]),o=this._i18nBundle.getText("delete"),i=this._i18nBundle.getText("delete");f.show(n,{icon:f.Icon.WARNING,title:o,actions:[i,f.Action.CANCEL],emphasizedAction:i,onClose:e=>{if(e===i){void this._ungroupApps(t.id)}}})},_onDeleteGroup:function e(t){const n=this;const o=t.getSource()?.getParent(),i=this._i18nBundle.getText("deleteGroupMessage",[o.getTitle()]),s=this._i18nBundle.getText("delete"),r=this._i18nBundle.getText("delete"),a=this._i18nBundle.getText("moveApps");f.show(i,{icon:f.Icon.WARNING,title:s,actions:[r,this._i18nBundle.getText("moveApps"),f.Action.CANCEL],emphasizedAction:r,onClose:function(e){try{const t=function(){if(e===r){n._setBusy(true);return Promise.resolve(n._deleteGroup(o.getGroupId())).then(function(){_.show(n._i18nBundle.getText("groupDeleted"));void n.refresh();n._closeGroupDetailDialog();n._setBusy(false)})}else if(e===a){void n._ungroupApps(o.getGroupId())}}();return Promise.resolve(t&&t.then?t.then(function(){}):void 0)}catch(e){return Promise.reject(e)}}})},_ungroupApps:function t(n){try{const t=this;t._setBusy(true);const o=de(function(){return pe(function(){return Promise.resolve(t.appManagerInstance.getSectionVisualizations(n)).then(function(e){return Promise.resolve(t.appManagerInstance._getSections()).then(function(o){const i=o.find(e=>e.id===n);return Promise.resolve(Promise.all(e.map(e=>t._addVisualization(e)))).then(function(){return Promise.resolve(t.appManagerInstance._getSections(true)).then(function(o){const s=o.find(e=>e.default);return Promise.resolve(t._updateAppPersonalization(e.map(e=>({visualization:e,targetGroupId:s?.id,isTargetGroupDefault:true})))).then(function(){function o(){_.show(t._i18nBundle.getText("appsUngrouped")??"");return Promise.resolve(t.refresh()).then(function(){})}const s=function(){if(i?.preset){return Promise.resolve(t.appManagerInstance.removeVisualizations({sectionId:n,vizIds:e.map(e=>e.visualization?.id)})).then(function(){})}else{return Promise.resolve(t._deleteGroup(n)).then(function(){})}}();return s&&s.then?s.then(o):o(s)})})})})})},function(n){e.error(n);_.show(t._i18nBundle.getText("unableToUngroupApps")??"")})},function(e,n){t._setBusy(false);t._closeGroupDetailDialog();if(e)throw n;return n});return Promise.resolve(o&&o.then?o.then(function(){}):void 0)}catch(e){return Promise.reject(e)}},_showGroupDetailDialog:function e(t,n=false){try{const e=this;const o=e._getGroup(t);if(!o){return Promise.resolve()}e._selectedGroupId=t;const i=e._generateGroupDetailDialog();const s=e._controlMap.get(`${e.getId()}-detailDialog-toolbar-color`);s.setColor(N.get({name:o.getBgColor()}));return Promise.resolve(e._setGroupDetailDialogApps(t)).then(function(){i.open();e._setGroupNameControl(o.getTitle(),n)})}catch(e){return Promise.reject(e)}},_setGroupDetailDialogApps:function e(t){try{const e=this;const n=e._getGroup(t);const o=function(){if(n){return Promise.resolve(e.appManagerInstance.getSectionVisualizations(t,false)).then(function(o){n.destroyAggregation("apps",true);o=o.map((t,o)=>({...t,menuItems:e._getAppActions(n,o,t)}));const i=e.generateApps(o);const s=e._controlMap.get(`${e.getId()}-detailDialog-apps`);e._setAggregation(n,i,"apps");s.destroyItems();e._setAggregation(s,n.getApps().map(t=>e.getParent()._getAppTile(t)));e._applyGroupedAppsPersonalization(t);e._dispatchAppsLoadedEvent(i)})}}();return Promise.resolve(o&&o.then?o.then(function(){}):void 0)}catch(e){return Promise.reject(e)}},_applyGroupedAppsPersonalization:function e(t){const n=this._controlMap.get(`${this.getId()}-detailDialog-apps`);const o=n?.getItems()||[];void this._applyTilesPersonalization(o,t)},_dispatchAppsLoadedEvent:function e(t){const n=this._controlMap.get(`${this.getId()}-detailDialog-apps`);const o=n?.getItems()||[];this.getParent().fireEvent("appsLoaded",{apps:t,tiles:o})},_generateGroupDetailDialog:function e(){const i=`${this.getId()}-detailDialog`;if(!this._controlMap.get(i)){this._controlMap.set(`${i}-toolbar-color`,new w({id:`${i}-toolbar-color`,src:"sap-icon://color-fill",size:"1.25rem"}).addStyleClass("sapUiTinyMarginEnd"));this._controlMap.set(`${i}-toolbar-title`,new B({id:`${i}-toolbar-title`,visible:true}));const e=Ae(`${i}-toolbar-renameTitle`,this._i18nBundle.getText("renameGroup"));this._controlMap.set(`${i}-toolbar-renameTitle`,e);const s=new d({id:`${i}-toolbar-title-edit`,width:"13.75rem",visible:false,ariaLabelledBy:[`${i}-toolbar-renameTitle`]});this._controlMap.set(`${i}-toolbar-title-edit`,s);s.onsapfocusleave=()=>{void this._onGroupEditName(s.getValue())};const r=new t({id:`${i}-apps`,layout:new n(`${i}-appsLayout`,{columnSize:"19rem",gap:"0.5rem"})}).addStyleClass("sapCuxAppsContainerBorder sapCuxAppsDetailContainerPadding");this.addDragDropConfigTo(r,e=>this._onFavItemDrop(e,this._selectedGroupId));this._controlMap.set(`${i}-apps`,r);this._controlMap.set(`${i}-addAppsBtn`,new o(`${i}-addAppsBtn`,{text:this._i18nBundle.getText("addApps"),icon:"sap-icon://action",visible:be(),press:()=>{const e=this._selectedGroupId;this._closeGroupDetailDialog();this._selectedGroupId=e;void this.navigateToAppFinder(e)}}));this._controlMap.set(i,new a(i,{content:this._controlMap.get(`${i}-apps`),contentWidth:"60.75rem",endButton:new o({id:`${i}-groupDetailCloseBtn`,text:this._i18nBundle.getText("XBUT_CLOSE"),press:this._closeGroupDetailDialog.bind(this)}),escapeHandler:this._closeGroupDetailDialog.bind(this),customHeader:new x(`${this.getId()}-toolbar`,{content:[this._controlMap.get(`${i}-toolbar-color`),this._controlMap.get(`${i}-toolbar-title`),this._controlMap.get(`${i}-toolbar-title-edit`),this._controlMap.get(`${i}-toolbar-renameTitle`),new D({id:`${this.getId()}-toolbarSpacer`}),this._controlMap.get(`${i}-addAppsBtn`),new o({id:"overflowBtn",icon:"sap-icon://overflow",type:"Transparent",press:e=>{const t=e.getSource();const n=this._selectedGroupId?this._getGroup(this._selectedGroupId):null;const o=n?.getAggregation("menuItems");const i=fe.get(o);i.openBy(t)}})]})}).addStyleClass("sapCuxGroupDetailDialog"))}return this._controlMap.get(i)},_closeGroupDetailDialog:function e(){const t=this._controlMap.get(`${this.getId()}-detailDialog`);const n=this._getGroup(this._selectedGroupId);n?.destroyApps();this._selectedGroupId=undefined;t?.close()},_onGroupEditName:function e(t){try{const n=this;function o(){n._setGroupNameControl(t,false);n._setBusy(false)}n._setBusy(true);const i=n._selectedGroupId,s=n._getGroup(i),r=s?.getTitle();const a=function(){if(t&&t!==r){return Promise.resolve(n._renameGroup(i,t)).then(function(){s?.setProperty("title",t,true);void n.refresh();_.show(n._i18nBundle.getText("groupNameChanged")||"")})}}();return Promise.resolve(a&&a.then?a.then(o):o(a))}catch(l){return Promise.reject(l)}},_renameGroup:function e(t,n){try{return Promise.resolve(j.getServiceAsync("Pages")).then(function(e){const o=e.getPageIndex(Ge),i=e.getModel().getProperty(`/pages/${o}/sections/`),s=i.findIndex(e=>e.id===t);const r=function(){if(s>-1){return Promise.resolve(e.renameSection(o,s,n)).then(function(){})}}();if(r&&r.then)return r.then(function(){})})}catch(e){return Promise.reject(e)}},_setGroupNameControl:function e(t,n){const o=this._controlMap.get(`${this.getId()}-detailDialog`);const i=this._controlMap.get(`${this.getId()}-detailDialog-toolbar-title`);const s=this._controlMap.get(`${this.getId()}-detailDialog-toolbar-title-edit`);s.setValue(t);i.setText(t);s?.setVisible(n);i?.setVisible(!n);if(n){o.setInitialFocus(s)}},_generateAddFromInsightsDialog:function e(){const t=`${this.getId()}-addFromInsightsDialog`;const n=()=>{const e=this._getSelectedInsights();this._controlMap.get(`${t}-addBtn`).setEnabled(e.length>0)};if(!this._controlMap.get(t)){const e=(e,t)=>{const n=new o(e,{icon:"sap-icon://action",text:this._i18nBundle.getText("appFinderBtn"),press:()=>{this._closeAddFromInsightsDialog();void this.navigateToAppFinder()},visible:be(),type:t||ae.Default});Se(n,"press","appsAppFinder");return n};this._controlMap.set(`${t}-list`,new h({id:`${t}-list`,mode:"MultiSelect",selectionChange:n}));this._controlMap.set(`${t}-addBtn`,new o({id:`${t}-addBtn`,text:this._i18nBundle.getText("addFromInsightsDialogBtn"),type:"Emphasized",press:()=>{void this._addFromInsights()},enabled:false}));const i=this._controlMap.get(`${t}-addBtn`);Se(i,"press","addStaticTiles");this._controlMap.set(`${t}-errorMessage`,new c({id:`${t}-errorMessage`,illustrationSize:p.Base,title:this._i18nBundle.getText("noAppsTitle"),description:this._i18nBundle.getText("noDataMsgInsightTiles"),visible:true}).addStyleClass("sapUiLargeMarginTop"));this._controlMap.set(t,new a(t,{title:this._i18nBundle.getText("addFromInsights"),content:[new g({id:`${t}-label`,text:this._i18nBundle.getText("addFromInsightsDialogLabel"),wrapping:true}).addStyleClass("sapMTitleAlign sapUiTinyMarginTopBottom sapUiSmallMarginBeginEnd"),new l({id:`${t}-textContainer`,justifyContent:"SpaceBetween",alignItems:"Center",items:[new B({id:`${t}-text`,text:this._i18nBundle.getText("addFromInsightsDialogTitle")}),e(`${t}-addAppsBtn`,ae.Transparent)]}).addStyleClass("sapUiTinyMarginTop dialogHeader sapUiSmallMarginBeginEnd"),this._controlMap.get(`${t}-list`),this._controlMap.get(`${t}-errorMessage`)],contentWidth:"42.75rem",contentHeight:"32.5rem",endButton:new o({id:`${t}-addFromInsightsCloseBtn`,text:this._i18nBundle.getText("XBUT_CLOSE"),press:this._closeAddFromInsightsDialog.bind(this)}),escapeHandler:this._closeAddFromInsightsDialog.bind(this),buttons:[this._controlMap.get(`${t}-addBtn`),new o({id:`${t}-cancelBtn`,text:this._i18nBundle.getText("cancelBtn"),press:this._closeAddFromInsightsDialog.bind(this)})]}).addStyleClass("sapContrastPlus sapCuxAddFromInsightsDialog"))}n();return this._controlMap.get(t)},_handleAddFromInsights:function e(){try{const e=this;return Promise.resolve(e._getInsightTilesToAdd()).then(function(t){const n=e._generateAddFromInsightsDialog();e._controlMap.get(`${e.getId()}-addFromInsightsDialog-errorMessage`)?.setVisible(t.length===0);e._generateInsightListItems(t);n.open()})}catch(e){return Promise.reject(e)}},_generateInsightListItems:function e(t){const n=this._controlMap.get(`${this.getId()}-addFromInsightsDialog-list`);if(t.length){n.destroyItems();const e=t.map((e,t)=>{const n=typeof e.BGColor==="object"&&"key"in e.BGColor?e.BGColor.key:e.BGColor;return new r({id:`${this.getId()}-addFromInsightsDialog-listItem-${t}`,content:[new l({id:`${this.getId()}-addFromInsightsDialog-listItem-${t}-content`,alignItems:"Center",items:[new w({id:`${this.getId()}-addFromInsightsDialog-listItem-${t}-content-icon`,src:e.icon,backgroundColor:this._getLegendColor(n||"").value,color:"white",width:"2.25rem",height:"2.25rem",size:"1.25rem"}).addStyleClass("sapUiRoundedBorder sapUiTinyMargin"),new v({id:`${this.getId()}-addFromInsightsDialog-listItem-${t}-content-identifier`,title:e.title,text:e.subtitle,tooltip:e.title}).addStyleClass("sapUiTinyMargin")]})]}).addStyleClass("sapUiContentPadding").data("vizId",e.visualization?.vizId)});this._setAggregation(n,e)}n?.setVisible(t.length!==0)},_getInsightTilesToAdd:function e(){try{const e=this;return Promise.resolve(Promise.all([e.appManagerInstance.fetchInsightApps(true,e._i18nBundle.getText("insights")),e.appManagerInstance.fetchFavVizs(false,true)])).then(function([t,n]){const o=t.reduce((e,t)=>{if(!t.isCount&&!t.isSmartBusinessTile){const o=n.findIndex(e=>e.visualization?.vizId===t.visualization?.vizId||e.appId===t.appId);if(o===-1){e.push(t)}}return e},[]);return e.appManagerInstance._filterDuplicateVizs(o,false)})}catch(e){return Promise.reject(e)}},_closeAddFromInsightsDialog:function e(){const t=this._generateAddFromInsightsDialog();const n=this._controlMap.get(`${this.getId()}-addFromInsightsDialog-list`);n.removeSelections();t?.close()},_getSelectedInsights:function e(){const t=this._controlMap.get(`${this.getId()}-addFromInsightsDialog-list`);return t.getSelectedItems()||[]},_addFromInsights:function e(){try{const t=this;function n(){t._closeAddFromInsightsDialog();_.show(t._i18nBundle.getText(o.length===1?"addFromInsightTileSuccess":"addFromInsightTilesSuccess",[o.length]));return Promise.resolve(t.getParent()._refreshAllPanels()).then(function(){t._setBusy(false)})}t._setBusy(true);const o=t._getSelectedInsights();const i=le(o,function(e){return Promise.resolve(t.appManagerInstance.addVisualization(e.data("vizId"))).then(function(){})});return Promise.resolve(i&&i.then?i.then(n):n(i))}catch(s){return Promise.reject(s)}},_updateAppPersonalization:function e(t){try{const e=this;return Promise.resolve(e._getAppPersonalization()).then(function(n){for(const o of t){const{visualization:t}=o;const{persConfig:i}=t;const s=i?.sectionId;const r=o.targetGroupId??s;if(s!==r){e._updateMoveAppPersonalization(n,o)}else{e._updateAppColorPersonalization(n,o)}}return Promise.resolve(e.setFavAppsPersonalization(n)).then(function(){})})}catch(e){return Promise.reject(e)}},_updateMoveAppPersonalization:function e(t,n){const{visualization:o,isTargetGroupDefault:i}=n;const{appId:s,oldAppId:r,persConfig:a}=o;const l=a?.sectionId;const c=a?.isDefaultSection;const p=a?.duplicateApps||[];const u=n.targetGroupId??l;const d=this._getPersonalizationIndex(t,{appId:s,oldAppId:r,sectionId:l,isRecentlyAddedApp:c});if(d>-1){const e={...t[d],sectionId:u,isRecentlyAddedApp:i,isSection:false};if(p.length===0){t.splice(d,1)}const n=this._getPersonalizationIndex(t,{appId:s,oldAppId:r,sectionId:u,isRecentlyAddedApp:i});if(n>-1){t.splice(n,1)}t.push(e)}},_updateGroupPersonalization:function e(t,n){try{const e=this;return Promise.resolve(e._getAppPersonalization()).then(function(o){const i=e._getPersonalizationIndex(o,{isSection:true,sectionId:t});const s={BGColor:n,isSection:true,sectionId:t,isRecentlyAddedApp:false};if(i>-1){o[i]=s}else{o.push(s)}return Promise.resolve(e.setFavAppsPersonalization(o)).then(function(){})})}catch(e){return Promise.reject(e)}},_getPersonalizationIndex:function e(t,n){const{appId:o,oldAppId:i,sectionId:s,isSection:r,isRecentlyAddedApp:a}=n;return t.findIndex(e=>{if(r){return e.sectionId===s&&e.isSection}else{return a?(e.appId===o||e.appId===i)&&e.isRecentlyAddedApp:(e.appId===o||e.appId===i)&&e.sectionId===s}})},_addVisualization:function e(t,n,o){if(t.visualization){return t.visualization.isBookmark?this.appManagerInstance.addBookMark(t.visualization,o):this.appManagerInstance.addVisualization(t.visualization.vizId,n)}return Promise.reject(new Error("No visualization provided to add"))},_deleteGroup:function e(t){try{const e=this;return Promise.resolve(j.getServiceAsync("Pages")).then(function(n){const o=n.getPageIndex(Ge),i=n.getModel().getProperty(`/pages/${o}/sections/`),s=i.findIndex(e=>e.id===t);const r=function(){if(s>-1){return Promise.resolve(n.deleteSection(o,s)).then(function(){void e._deletePersonalization({sectionId:t,isSection:true})})}}();if(r&&r.then)return r.then(function(){})})}catch(e){return Promise.reject(e)}},_deletePersonalization:function e(t){try{const e=this;const{isSection:n,sectionId:o}=t;return Promise.resolve(e._getAppPersonalization()).then(function(i){if(!n){const n=e._getPersonalizationIndex(i,t);if(n>-1){i.splice(n,1)}}else{i=i.filter(e=>e.sectionId!==o)}void e.setFavAppsPersonalization(i)})}catch(e){return Promise.reject(e)}},_handleGroupPress:function e(t){const n=t.getParameter("groupId");if(n){void this._showGroupDetailDialog(n)}},_handleKeyboardMoveApp:function e(t,n){try{const e=this;const o=b.closestTo(t.target.firstElementChild);const i=o.getParent();const s=function(){if(t.metaKey||t.ctrlKey){if(t.key==="x"&&!o.data("groupId")&&!e._cutApp&&!n){o.$().css("opacity",.6);o._oMoreIcon.setEnabled(false);e._cutApp=o}const s=function(){if(t.key==="v"&&e._cutApp&&!n){const t=new $("keyboardDragDropEvent",i,{draggedControl:e._cutApp,droppedControl:o,dropPosition:ge.RelativeDropPosition.On});return Promise.resolve(e._onFavItemDrop(t)).then(function(){e._cutApp=undefined})}}();if(s&&s.then)return s.then(function(){})}}();return Promise.resolve(s&&s.then?s.then(function(){}):void 0)}catch(e){return Promise.reject(e)}},_resetCutElement:function e(t){const n=this._generateAppsWrapper().getId();if(!t.target.id.includes(n)){this._cutApp?.$().css("opacity","");this._cutApp=undefined}},generateIllustratedMessage:function e(){const t=me.prototype.generateIllustratedMessage.call(this);t.setDescription(this._i18nBundle.getText("noFavAppsDescription"));t.setIllustrationSize(p.ExtraSmall);t.setIllustrationType(u.AddingColumns);t.addAdditionalContent(new o(`${this.getId()}-errorMessage-addApps`,{text:this._i18nBundle.getText("addApps"),tooltip:this._i18nBundle.getText("addAppsTooltip"),icon:"sap-icon://action",visible:be(),press:()=>{void this.navigateToAppFinder()},type:"Emphasized"}));t.addStyleClass("sapUiTinyMarginTop");return t}});Ne.favouritesMenuItems=ze;return Ne});
//# sourceMappingURL=FavAppPanel.js.map