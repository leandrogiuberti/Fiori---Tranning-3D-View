/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)
 *  * (c) Copyright 2009-2025 SAP SE. All rights reserved
 */
sap.ui.define(["sap/m/Column","sap/m/ColumnListItem","sap/m/HBox","sap/m/ObjectIdentifier","sap/m/Table","sap/m/ToggleButton","sap/ui/core/CustomData","sap/ui/core/Element","sap/ui/core/Icon","./BaseSettingsPanel","./flexibility/Layout.flexibility","./utils/Constants","./utils/DataFormatUtils","./utils/DragDropUtils"],function(t,e,n,s,a,i,o,l,c,r,d,g,u,m){"use strict";function h(t){return t&&t.__esModule&&typeof t.default!=="undefined"?t.default:t}const p=h(r);const y=d["CHANGE_TYPES"];const I=g["KEYUSER_SETTINGS_PANELS_KEYS"];const C=u["recycleId"];const S=m["focusDraggedItem"];const f=p.extend("sap.cux.home.KeyUserLayoutSettingsPanel",{metadata:{library:"sap.cux.home"},init:function t(){p.prototype.init.call(this);this.setProperty("key",I.LAYOUT);this.setProperty("title",this._i18nBundle.getText("editModeTitle"));this.addAggregation("content",this.getContent());this.attachPanelNavigated(()=>{const t=this._getPanel();t.resetSections();void this.loadSections()})},getContent:function e(){if(!this.layoutTable){this.layoutTable=new a(this.getId()+"--idLayoutSettingsTable",{width:"calc(100% - 2rem)",items:[],columns:[new t(this.getId()+"--idSectionTitleColumn",{width:"100%"})]}).addStyleClass("layoutSettingsTable sapContrastPlus sapUiSmallMarginBegin");this.addDragDropConfigTo(this.layoutTable,t=>this.onDropLayoutSettings(t))}return this.layoutTable},loadSections:function t(){try{const t=this;const a=t._getPanel();return Promise.resolve(a._calculateSectionsState()).then(function(){t.orderedSections=a.getSections()||[];const l=t.getParent();t.layoutTable.removeAllItems();t.orderedSections.forEach((a,r)=>{t.layoutTable.addItem(new e(C(`${t.getId()}--layoutSettingsColumnListItem--${r}`),{type:t.getParent()?.hasDetailsPage?.(a.completeId)?"Navigation":"Inactive",cells:[new n(C(`${t.getId()}--layoutColumnListHBox--${r}`),{alignItems:"Center",items:[new c(C(`${t.getId()}--layoutColumnListItemIcon--${r}`),{src:"sap-icon://vertical-grip"}).addStyleClass("sapUiSmallMarginEnd"),new n(C(`${t.getId()}--layoutColumnListItemHBox--${r}`),{justifyContent:"SpaceBetween",alignItems:"Center",width:"100%",items:[new s(C(`${t.getId()}--layoutColumnListObjectIdentifier--${r}`),{title:a.title,text:a.text,tooltip:a.title}),new i(C(`${t.getId()}--layoutColumnListToggleButton--${r}`),{tooltip:a.visible?t._i18nBundle.getText("hideBtn"):t._i18nBundle.getText("showBtn"),icon:"sap-icon://show",type:"Emphasized",enabled:!a.blocked,press:e=>t.createShowHideChangeFile(e,a),pressed:!a.visible,ariaLabelledBy:["selectLabel"]}).addStyleClass("sapUiTinyMarginEnd sapUiTinyMarginTop")]}).addStyleClass("sapUiTinyMarginBegin")],width:"100%"})],press:()=>l?.navigateToPage?.(l.getDetailsPage(a.completeId)),customData:new o(C(`${t.getId()}--custom-data--${r}`),{key:"sectionObject",value:a})})).addStyleClass("insightsListItem insightsListMargin")})})}catch(t){return Promise.reject(t)}},onDropLayoutSettings:function t(e){const n=this._getPanel();const s=n.getId();const a=e.getParameter?.("draggedControl")||e.draggedControl;const i=a.getParent()?.indexOfItem(a);const o=e.getParameter?.("droppedControl")||e.droppedControl;const l=a.getParent()?.indexOfItem(o);if(i!==l){const t=this.orderedSections;const e=a.data("sectionObject");const c=o.data("sectionObject");const r=this._getActualIndex(e.completeId);const d=this._getActualIndex(c.completeId);this._rearrangeLayoutElements(r,d);t.splice(i,1);t.splice(l,0,e);n.setSections(t);this.addKeyUserChanges({selectorControl:n,changeSpecificData:{changeType:y.MOVE,content:{movedElements:[{id:e.completeId,sourceIndex:r,targetIndex:d}],source:{id:s,aggregation:"items"},target:{id:s,aggregation:"items"}}}});void this.loadSections()}S(this.layoutTable,l)},_getActualIndex:function t(e){const n=this._getPanel();this._allLayoutElements=this._allLayoutElements||[...n.getItems()];const s=n.getProperty("expanded");const a=n._getCurrentExpandedElement();if(s&&a){if(!this._allLayoutElements.some(t=>t.getId()===a.targetContainer.getId())){this._allLayoutElements.splice(n.indexOfItem(a.targetContainer),0,a.targetContainer)}}return this._allLayoutElements.findIndex(t=>t.getId()===e)},_rearrangeLayoutElements:function t(e,n){const s=this._allLayoutElements.splice(e,1)[0];this._allLayoutElements.splice(n,0,s)},createShowHideChangeFile:function t(e,n){const s=!e.getParameter("pressed");const a=this.getKeyUserChanges();const i=s?y.UNHIDE:y.HIDE;const o=a.find(t=>t.selectorControl.getId()===n.completeId);if(o){o.changeSpecificData.changeType=i}else{this.addKeyUserChanges({selectorControl:l.getElementById(n.completeId),changeSpecificData:{changeType:i}})}}});return f});
//# sourceMappingURL=KeyUserLayoutSettingsPanel.js.map