/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)
 *  * (c) Copyright 2009-2025 SAP SE. All rights reserved
 */
sap.ui.define(["sap/base/Log","sap/base/util/deepEqual","sap/m/library","sap/m/Page","sap/ui/core/Element","sap/ui/core/Lib","sap/ui/core/routing/HashChanger","sap/ushell/api/S4MyHome","./BaseLayoutRenderer","./BasePanel","./library","./utils/Device"],function(e,t,n,i,s,o,r,l,a,c,g,u){"use strict";function d(e){return e&&e.__esModule&&typeof e.default!=="undefined"?e.default:e}const h=n["PageBackgroundDesign"];const p=d(a);const f=d(c);const m=g["OrientationType"];const _=u["DeviceType"];const y=u["calculateDeviceType"];const S=i.extend("sap.cux.home.BaseLayout",{renderer:p,metadata:{library:"sap.cux.home",properties:{enableSettings:{type:"boolean",group:"Misc",visibility:"hidden"},enableFullScreen:{type:"boolean",group:"Misc",visibility:"hidden"},expanded:{type:"boolean",group:"Misc",defaultValue:false,visibility:"hidden"},settingsDialogPersisted:{type:"boolean",group:"Misc",defaultValue:false,visibility:"hidden"},contentAdditionDialogPersisted:{type:"boolean",group:"Misc",defaultValue:false,visibility:"hidden"},showHeader:{type:"boolean",group:"Appearance",defaultValue:true,visibility:"hidden"},showFooter:{type:"boolean",group:"Appearance",defaultValue:false,visibility:"hidden"},busy:{type:"boolean",defaultValue:false,visibility:"hidden"},backgroundDesign:{type:"sap.m.PageBackgroundDesign",group:"Appearance",defaultValue:h.Transparent,visibility:"hidden"},persContainerId:{type:"string",defaultValue:"",visibility:"public"}},defaultAggregation:"items",aggregations:{items:{type:"sap.cux.home.BaseContainer",singularName:"item",multiple:true},settingsDialog:{type:"sap.cux.home.BaseSettingsDialog",singularName:"settingsDialog",multiple:false},keyUserSettingsDialog:{type:"sap.cux.home.BaseSettingsDialog",singularName:"keyUserSettingsDialog",multiple:false},contentAdditionDialog:{type:"sap.cux.home.BaseSettingsDialog",singularName:"contentAdditionDialog",multiple:false,visibility:"hidden"},fullScreenContainer:{type:"sap.m.Page",singularName:"fullScreenContainer",multiple:false,visibility:"hidden"}},events:{onCollapse:{}}},constructor:function e(t,n){i.prototype.constructor.call(this,t,n)},init:function e(){i.prototype.init.call(this);this._settingsPanels=[];this._elementConfigs=new Map;this._i18nBundle=o.getResourceBundleFor("sap.cux.home.i18n");this._slideDurationInSeconds=1;this._fullScreenContainer=new i(`${this.getId()}-fullScreen-container`,{backgroundDesign:"Transparent",showHeader:false});this.setAggregation("fullScreenContainer",this._fullScreenContainer)},onBeforeRendering:function e(t){i.prototype.onBeforeRendering.call(this,t);this._toggleHeaderVisibility();if(!this._attachRouteMatched){l.attachRouteMatched({},this.openPersistedDialogs.bind(this));this._attachRouteMatched=true}if(this.getProperty("enableFullScreen")){document.body.style.setProperty("--sapUiSlideDuration",`${this._slideDurationInSeconds}s`)}},openPersistedDialogs:function e(t){if(t.getParameter("isMyHomeRoute")){if(this.getProperty("settingsDialogPersisted")){const e=this.getAggregation("settingsDialog")?.getProperty("selectedKey");this.openSettingsDialog(e);this.setProperty("settingsDialogPersisted",false,true)}if(this.getProperty("contentAdditionDialogPersisted")){const e=this.getAggregation("contentAdditionDialog")?.getProperty("selectedKey");this.openContentAdditionDialog(e);this.setProperty("contentAdditionDialogPersisted",false,true)}}},_toggleHeaderVisibility:function e(){const t=this.getCustomHeader();const n=t?.getVisible()||this.getHeaderContent().length>0;this.setProperty("showHeader",n,true)},onAfterRendering:function e(){if(this.getProperty("enableFullScreen")){if(!this._layoutLoaded){this._layoutLoaded=true;setTimeout(()=>{this._hashChanger=new r;this._loadFullScreenFromHash(this._hashChanger.getHash()||"");const[e]=this._hashChanger.getHash().split("?");window.addEventListener?.("hashchange",()=>{const t=window.location.hash.substring(1);if(t.includes?.(e)){this._loadFullScreenFromHash(t,true)}})})}}},getContent:function e(){return this.getItems()},_getURLParams:function e(t){const n=t?.includes("?")?t.substring(t.indexOf("?")+1):"";return new URLSearchParams(n)},_loadFullScreenFromHash:function e(t,n=false){const i=this.getProperty("enableFullScreen");const s=this._getURLParams(t);const o=s.get("expanded")||"";const r=this._elementConfigs.get(o);const l=r?.targetContainer.getVisible()||false;const a=y()===_.Mobile;if(i&&r&&!a&&l){if(this._currentExpandedElement&&this._currentExpandedElement.fullScreenName!==o){this._toggleFullScreenForElement(r,n)}else if(!this._currentExpandedElement){this._toggleFullScreenForElement(r)}else if(s.has("expanded")){document.getElementById(`${this.getId()}-layout-container`)?.classList.add("slide")}}else{if(this._currentExpandedElement){this._toggleFullScreenForElement(this._currentExpandedElement)}else{if(s.has("expanded")){const e=this._removeURLParam(t,"expanded");this._hashChanger?.replaceHash(e,"Backwards")}}}},_toggleFullScreenForElement:function e(t,n=false){setTimeout(()=>this.toggleFullScreen(t.sourceElements.values().next().value,n))},openSettingsDialog:function e(t="",n={}){const i=this.getAggregation("settingsDialog");i?.setProperty("selectedKey",t);i?.setProperty("context",n);i?.open()},openContentAdditionDialog:function e(t=""){const n=this.getAggregation("contentAdditionDialog");n?.setProperty("selectedKey",t);n?.open()},setSettingsDialog:function e(t){const n=this.getProperty("enableSettings");if(n){const e=t?.getPanels();e?.forEach(e=>{this._addSettingsPanel(e)})}this.setAggregation("settingsDialog",t);return this},_addSettingsPanel:function e(t,n){if(t){if(n){this._settingsPanels=t}else{this._settingsPanels.push(t)}}},_getSettingsPanels:function e(){return this._settingsPanels},_extractElementConfig:function e(t){const n=t;const i=n instanceof f;const s=i?n.getParent():n;const o=i&&s.getProperty("orientation")===m.SideBySide;const r=(o?s:n).getProperty("fullScreenName");const l=(new Set).add(n);return{fullScreenName:r,sourceElements:l,targetContainer:s,index:this.indexOfItem(s),key:i?n.getKey():""}},registerFullScreenElement:function e(t){const n=this._extractElementConfig(t);const{fullScreenName:i}=n;if(i&&!this.getProperty("expanded")){if(this._elementConfigs.get(i)){const e=(this._elementConfigs.get(i)?.sourceElements||new Set).add(t);this._elementConfigs.set(i,{...n,sourceElements:e})}else{this._elementConfigs.set(i,n)}}},deregisterFullScreenElement:function e(t){const{fullScreenName:n}=this._extractElementConfig(t);if(n&&!this.getProperty("expanded")){this._elementConfigs.delete(n)}},updateFullScreenElement:function e(t,n){const i=this._extractElementConfig(t);const{fullScreenName:s}=i;if(s&&!this.getProperty("expanded")){const e={...this._elementConfigs.get(s),...n};this._elementConfigs.set(s,e)}},_addURLParam:function e(t,n,i){const s=this._getURLParams(t);s.set(n,i);return`${t.split("?")[0]}?${s.toString()}`},_removeURLParam:function e(t,n){const i=this._getURLParams(t);i.delete(n);return i.toString()?`${t.split("?")[0]}?${i.toString()}`:t.split("?")[0]},toggleFullScreen:function n(i,s=false){const o=i instanceof f&&i.getParent()?.getProperty("orientation")===m.SideBySide;const r=(o?i.getParent():i)?.getProperty("fullScreenName");const l=this._elementConfigs.get(r);const a=s||this._checkToggleRequirements(l);if(l&&a){const{targetContainer:e}=l;const n=this._hashChanger?.getHash()||"";const o=e.indexOfAggregation("content",i);const a=e.getProperty("orientation")===m.SideBySide;let c=this.getProperty("expanded");e._detachResizeHandler();if(!s){this.setProperty("expanded",!this.getProperty("expanded"),true);c=this.getProperty("expanded");this._placeClonedElement(e,c,o);document.getElementById(`${this.getId()}-layout-container`)?.classList.toggle("slide",c)}this._toggleFullScreenButtonText(i,c);if(c){this._previousExpandedElement=this._currentExpandedElement;this._currentExpandedElement=l}else{delete this._currentExpandedElement}setTimeout(()=>{if(c){if(!a){e.setProperty("selectedKey",i.getProperty("key"))}const s=!t(this._previousExpandedElement?.targetContainer,e);this._adjustPreviousExpandedElementIfRequired(s);this._modifyContainer(e,o);this._currentExpandedElement=l;const c=this._addURLParam(n,"expanded",r);this._hashChanger?.setHash(c);this._focusFullScreenButton(i);i.fireEvent("onExpand")}else{this._domSnapshot?.remove();this.insertItem(e,l.index);if(!a){this._toggleInnerPanelVisibility(e,true)}delete this._currentExpandedElement;const t=this._removeURLParam(n,"expanded");this._hashChanger?.setHash(t);this._resetScrollPosition(i);this.fireEvent("onCollapse")}e._attachResizeHandler()},s?0:this._slideDurationInSeconds*1e3)}else{e.warning(`Element with ID: ${i?.getId()} not registered for full screen`)}},_modifyContainer:function e(n,i){const s=n.getProperty("orientation")===m.SideBySide;const o=!t(this._previousExpandedElement?.targetContainer,n);if(!this._previousExpandedElement||o){this._getFullScreenContainer().removeAllContent();this._sourceElementClone?.remove();this._getFullScreenContainer().addContent(n)}if(!s){this._toggleInnerPanelVisibility(n,false,i)}},_checkToggleRequirements:function e(t){const n=this.getProperty("expanded");let i=true;if(n){const e=t?.fullScreenName;i=this._currentExpandedElement?.fullScreenName===e}return i},_adjustPreviousExpandedElementIfRequired:function e(t){if(this._previousExpandedElement){const e=this._previousExpandedElement.sourceElements.values().next().value;this._toggleFullScreenButtonText(e,false);if(t){this.insertItem(this._previousExpandedElement.targetContainer,this._previousExpandedElement.index);this._scrollPosition=0;if(this._previousExpandedElement.targetContainer.getProperty("orientation")!==m.SideBySide){this._toggleInnerPanelVisibility(this._previousExpandedElement.targetContainer,true)}}}},_resetScrollPosition:function e(t){setTimeout(()=>{s.getElementById(`${t.getAssociation("fullScreenButton",null)}-btn`)?.focus();const e=this._getSectionRef(this);if(e!==undefined){e.scrollTop=this._scrollPosition}})},_toggleInnerPanelVisibility:function e(t,n,i){t.getContent()?.forEach((e,t)=>{e.setVisible(t===i?!n:n)})},_toggleFullScreenButtonText:function e(t,n){const i=t instanceof f;const s=i?t.getParent():t;const o=i&&s.getProperty("orientation")===m.SideBySide;const r=e=>{const t=this._getFullScreenButton(e);t.setProperty("text",this._i18nBundle.getText(n?"collapse":"expand"),true);const i=this._getFullScreenMenuItem(e);i.setProperty("title",this._i18nBundle.getText(n?"collapse":"expand"),true)};if(o){s.getContent()?.forEach(r)}else{r(t)}s._updateContainerHeader(o?s:t)},_focusFullScreenButton:function e(t){setTimeout(()=>{s.getElementById(`${t.getAssociation("fullScreenButton",null)}-btn`)?.focus()})},_getFullScreenButton:function e(t){return s.getElementById(t.getAssociation("fullScreenButton",null))},_getFullScreenMenuItem:function e(t){return s.getElementById(t.getAssociation("fullScreenMenuItem",null))},_getFullScreenContainer:function e(){return this.getAggregation("fullScreenContainer")},_getSectionRef:function e(t){const n=this.getProperty("showHeader")&&t!==this._getFullScreenContainer()?1:0;return t.getDomRef()?.childNodes[n]},_placeClonedElement:function e(t,n,i){this._scrollPosition=n?this._getSectionRef(this)?.scrollTop:this._scrollPosition;this._domSnapshot=n?this.getDomRef()?.cloneNode(true).cloneNode(true):this._domSnapshot;const s=t.getProperty("orientation")===m.SideBySide;const o=s?t:t._getInnerControl()?.getItems()[i]||t;const r=o.getDomRef()||t.getDomRef();this._sourceElementClone=n?r?.cloneNode(true):this._sourceElementClone;const l=n?this._getSectionRef(this._getFullScreenContainer()):this.getDomRef();if(l){setTimeout(()=>{l.innerHTML="";l.append(n?this._sourceElementClone:this._domSnapshot)})}},_getCurrentExpandedElementName:function e(){return this._getCurrentExpandedElement()?.fullScreenName},_getCurrentExpandedElement:function e(){const t=this._getURLParams(this._hashChanger?.getHash()||"").has("expanded");if(t){return this._currentExpandedElement}}});return S});
//# sourceMappingURL=BaseLayout.js.map