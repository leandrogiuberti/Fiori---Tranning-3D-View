/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)
 *  * (c) Copyright 2009-2025 SAP SE. All rights reserved
 */
sap.ui.define(["sap/m/Button","sap/m/ColorPalette","sap/m/Dialog","sap/m/FlexBox","sap/m/FlexItemData","sap/m/HBox","sap/m/Label","sap/m/List","sap/m/ScrollContainer","sap/m/SearchField","sap/m/StandardListItem","sap/m/Switch","sap/m/Text","sap/m/Title","sap/m/VBox","sap/ui/core/EventBus","sap/ui/core/Icon","sap/ui/core/theming/Parameters","sap/ui/model/Filter","sap/ui/model/FilterOperator","sap/ui/model/json/JSONModel","sap/ui/table/Column","sap/ui/table/TreeTable","./BaseSettingsPanel","./flexibility/Layout.flexibility","./utils/Constants","./utils/IconList","./utils/PageManager","./utils/PersonalisationUtils"],function(e,t,o,s,n,a,i,l,r,c,d,h,g,p,C,u,P,y,I,S,f,m,w,B,T,x,M,b,k){"use strict";function _(e){return e&&e.__esModule&&typeof e.default!=="undefined"?e.default:e}const A=_(B);const $=T["CHANGE_TYPES"];const L=x["DEFAULT_BG_COLOR"];const G=x["END_USER_COLORS"];const v=x["FALLBACK_ICON"];const D=x["KEYUSER_SETTINGS_PANELS_KEYS"];const O=M["ICONS"];const E=_(b);const U=_(k);const z=A.extend("sap.cux.home.KeyUserPagesSettingsPanel",{constructor:function e(){A.prototype.constructor.apply(this,arguments);this.keyuserSpaceColorChanges=[];this.keyuserPageColorChanges=[];this.keyuserSpaceIconChanges=[];this.keyuserPageIconChanges=[]},metadata:{library:"sap.cux.home"},init:function e(){A.prototype.init.call(this);this.controlMap=new Map;this.controlModel=new f({spaces:[],selectedSpacePage:{},iconList:[]});this.setProperty("key",D.PAGES);this.setProperty("title",this._i18nBundle.getText("editPages"));this._eventBus=u.getInstance();this.addAggregation("content",this.getContent());this.attachPanelNavigated(()=>this.loadSettings())},getContent:function t(){const s=`${this.getId()}-keyUserPagesSettingsDialog`;if(!this.controlMap.get(s)){const t=new o(s,{title:this._i18nBundle.getText("editPages"),contentWidth:"47rem",contentHeight:"90%",verticalScrolling:false,endButton:new e(`${this.getId()}-keyUserPagesSettingsCloseButton`,{text:this._i18nBundle.getText("Close"),press:this._handleDialogClose.bind(this),type:"Transparent"})}).addStyleClass("sapContrastPlus");this.controlMap.set(s,t);this.addDialogContent()}return this.controlMap.get(s)},loadSettings:function e(){if(!this.pageManagerInstance){this.pageManagerInstance=E.getInstance(U.getPersContainerId(this._getPanel()),U.getOwnerComponent(this._getPanel()))}void this.prepareSpacesPagesData();this.prepareIconList()},addDialogContent:function e(){const t=this.controlMap.get(`${this.getId()}-keyUserPagesSettingsDialog`);const o=new s(`${this.getId()}-wrapperFlexBox`,{alignItems:"Start",justifyContent:"Start",height:"100%",width:"100%",direction:"Row"});o.setModel(this.controlModel);o.addItem(this.getSpacePagesListItems());o.addItem(this.getDetailsView());t.addContent(o)},getSpacePagesListItems:function e(){const t=new s(`${this.getId()}-spacePagesFlexBox`,{direction:"Column",alignItems:"Start",height:"100%",width:"24rem",justifyContent:"Start"}).addStyleClass("spacePagesFlexBox");const o=new p(`${this.getId()}-spacePagesTitle`,{text:this._i18nBundle.getText("pageGroupHeader"),titleStyle:"H4"}).addStyleClass("sapUiSmallMarginBottom");t.addItem(o);const i=new C(`${this.getId()}-treeTableWrapper`,{height:"100%"});const l=`${this.getId()}-spacePagesTreeTable`;const r=new w(l,{selectionMode:"Single",selectionBehavior:"RowOnly",rows:"{path:'/spaces', parameters: {arrayNames:['children'], numberOfExpandedLevels: 1}}",id:"idEditIntrestTreeTable",groupHeaderProperty:"label",columnHeaderVisible:false,rowMode:"Auto",rowSelectionChange:this.handleTreeTableRowSelection.bind(this),width:"22rem",layoutData:new n(`${l}--layoutData`,{growFactor:1}),columns:[new m(`${l}--treeTableColumn`,{template:new a(`${l}--treeTableTemplateBox`,{alignItems:"Center",justifyContent:"SpaceBetween",width:"100%",items:[new g(`${l}--treeTableItemText`,{text:"{label}"}),new a(`${l}--treeTableColumnItemBox`,{alignItems:"Center",items:[new P(`${l}--treeTableItemIcon`,{tooltip:"{label}",src:"{icon}",backgroundColor:"{BGColor/value}",width:"2.5rem",height:"2.5rem",size:"1.5rem",color:"white"}).addStyleClass("sapUiTinyMargin")]})]})})]}).addStyleClass("spacePageTable");this.controlMap.set(l,r);i.addItem(r);t.addItem(i);return t},getDetailsView:function e(){const t=new s(`${this.getId()}-personalisationDetailsWrapperFlex`,{height:"100%",width:"23rem",direction:"Column",visible:"{= ${/spaces/length} === 0 ? false : true}"}).addStyleClass("personalisationDetailsWrapperFlex");t.addItem(this.getColorPalette());t.addItem(this.getIconList());return t},getColorPalette:function e(){const o=new C(`${this.getId()}-colorPaletteWrapperVBox`,{width:"100%"}).addStyleClass("sapUiSmallMarginBottom");const s=new p(`${this.getId()}-colorPaletteTitle`,{text:"{/selectedSpacePage/label}",titleStyle:"H4"});o.addItem(s);const n=new i(`${this.getId()}-colorPaletteSpacePageLabel`,{wrapping:true,text:"{= ${/selectedSpacePage/type} === 'Space' ? '"+this._i18nBundle.getText("space")+"' : '"+this._i18nBundle.getText("page")+"' }"}).addStyleClass("personalisationDetailsLabel");o.addItem(n);const l=new C(`${this.getId()}-colorPaletteVBox`,{width:"100%"}).addStyleClass("sapUiMargin-26Top");o.addItem(l);const r=new i(`${this.getId()}-colorPaletteLabel`,{wrapping:true,design:"Bold",text:this._i18nBundle.getText("selectColor")}).addStyleClass("personalisationDetailsLabel");l.addItem(r);const c=new t(`${this.getId()}-colorPalette`,{colors:G().map(e=>e.value),colorSelect:this._handleColorSelect.bind(this)}).addStyleClass("sapContrastPlus sapUiTinyMarginBottom");this.controlMap.set(`${this.getId()}-colorPalette`,c);l.addItem(c);const d=new a(`${this.getId()}-switchWrapperHBox`,{alignItems:"Center",justifyContent:"SpaceBetween",height:"2rem",width:"100%"});o.addItem(d);const u=new g(`${this.getId()}-switchText`,{text:this._i18nBundle.getText("editPagesColorMessage")});d.addItem(u);const P=new a(`${this.getId()}-switchHBox`,{alignItems:"Center"});d.addItem(P);const y=`${this.getId()}-Switch`;const I=new h(y,{state:"{ path: '/selectedSpacePage/applyColorToAllPages', mode: 'TwoWay' }",change:this._handleSwitchChange.bind(this),enabled:"{= ${/selectedSpacePage/spaceId} ? false : true }",customTextOn:" ",customTextOff:" "});this.controlMap.set(y,I);P.addItem(I);return o},getIconList:function e(){const t=new C(`${this.getId()}-iconListWrapperVBox`,{width:"100%",height:"calc(100% - 15rem)"});const o=new i(`${this.getId()}-iconListLabel`,{wrapping:true,design:"Bold",text:this._i18nBundle.getText("icon")}).addStyleClass("personalisationDetailsLabel");t.addItem(o);const s=`${this.getId()}-iconListSearchField`;const n=new c(s,{width:"100%",liveChange:this.handleIconSearch.bind(this)});this.controlMap.set(s,n);t.addItem(n);const a=new r(`${this.getId()}-iconListScrollContainer`,{vertical:true,horizontal:false,height:"95%"});t.addItem(a);const h=`${this.getId()}-iconList`;const g=new l(h,{items:{path:"/iconList",template:new d(`${this.getId()}-iconStandardListItem`,{title:"{title}",icon:"{icon}",type:"Active",press:e=>this._handleIconSelect(e.getSource()),iconDensityAware:false,iconInset:false})}});this.controlMap.set(h,g);a.addContent(g);return t},prepareSpacesPagesData:function e(){try{const e=this;return Promise.resolve(e.pageManagerInstance.fetchAllAvailableSpaces()).then(function(t){if(!Array.isArray(t)){return}t.forEach(t=>{t.BGColor=t.BGColor?e.refreshColor(t.BGColor):L();t.isSpacePersonalization=t.BGColor||t.icon?true:false;t.icon=t.icon||v;t.persistedApplyColorToAllPages=t.applyColorToAllPages;t.children.forEach(o=>{if(t.applyColorToAllPages){o.BGColor=e.refreshColor(t.BGColor);o.oldColor=o.isPagePersonalization?e.refreshColor(o.oldColor):L()}else{o.BGColor=o.BGColor?e.refreshColor(o.BGColor):L()}o.spaceId=t.id;o.personalizationState=o.isPagePersonalization;o.iconPersonalizationState=o.isPageIconPersonalization;o.icon=o.icon||t.icon||v})});e.controlModel.setProperty("/spaces",t);const o=e.controlMap.get(`${e.getId()}-spacePagesTreeTable`);const s=o.getSelectedIndices();if(!s.includes(0)){o.setSelectedIndex(0)}})}catch(e){return Promise.reject(e)}},refreshColor:function e(t){const o={...t};o.value=y.get({name:t.key});return o},handleTreeTableRowSelection:function e(t){const o=t.getParameter("rowContext");const s=o?.getObject();const n=this.controlModel.getProperty("/selectedSpacePage");const a=this.controlMap.get(`${this.getId()}-colorPalette`);const i=this.controlMap.get(`${this.getId()}-iconListSearchField`);const l=this.controlMap.get(`${this.getId()}-iconList`);const r=this.controlMap.get(`${this.getId()}-Switch`);let c=undefined;let d=a.getBlocked();if(s.type==="Page"){const e=o.getPath();const t=e.replace(/\/children\/\d*/,"");c=this.controlModel.getProperty(t)}d=n?.type===s.type&&n?.id===s.id?!d:false;a.setBlocked(d?true:c?.applyColorToAllPages);i.setBlocked(d);l.setBlocked(d);r.setBlocked(d);this.controlModel.setProperty("/selectedSpacePage",s);this.selectedContext=o},prepareIconList:function e(){const t=this.controlModel.getProperty("/iconList");if(!t.length){let e;const t=[];Object.keys(O).forEach(o=>{Object.keys(O[o].icons).forEach(function(s){switch(o){case"SAP-icons":e="sap-icon://"+s;break;case"SAP-icons-TNT":e="sap-icon://"+o+"/"+s;break;case"BusinessSuiteInAppSymbols":e="sap-icon://"+o+"/icon-"+s;break}t.push({title:s,icon:e,tags:O[o].icons[s].concat([s]).toString(),categoryId:o})})});this.controlModel.setProperty("/iconList",t)}},handleIconSearch:function e(t){const o=t.getSource().getValue();const s=[];if(o&&o.length>0){s.push(new I("tags",S.Contains,o))}const n=this.controlMap.get(`${this.getId()}-iconList`);const a=n.getBinding("items");a?.filter(s)},_handleColorSelect:function e(t,o){const s=t?.getParameter("value")||o||"";const n=this.selectedContext.getObject();const a=!n.spaceId;const i=this._convertColorToLegend(s);const l=n?.BGColor?.key;if(a){const e=n;const t=this.keyuserSpaceColorChanges.find(t=>t.spaceId===e.id);if(t){t.BGColor=i;t.applyColorToAllPages=e.applyColorToAllPages;t.oldApplyColorToAllPages=e.persistedApplyColorToAllPages}else{this.keyuserSpaceColorChanges.push({spaceId:e.id,BGColor:i,oldColor:l,applyColorToAllPages:e.applyColorToAllPages,oldApplyColorToAllPages:e.persistedApplyColorToAllPages})}if(e.applyColorToAllPages){this._applyInnerPageColoring(e,i,s,true)}this.controlModel.setProperty("BGColor/key",i,this.selectedContext);this.controlModel.setProperty("BGColor/value",s,this.selectedContext);this.controlModel.setProperty("isSpacePersonalization",true,this.selectedContext)}else{const e=n;const t=this.keyuserPageColorChanges.find(t=>t.pageId===e.id);const o=this.controlModel.getProperty("/spaces").find(t=>t.id===e.spaceId);const a=o?.isSpacePersonalization;const r=this.keyuserSpaceColorChanges.find(e=>e.spaceId===o?.id);if(t){t.BGColor=i}else{this.keyuserPageColorChanges.push({pageId:e.id,spaceId:e.spaceId,BGColor:i,oldColor:a&&!e.isPagePersonalization?r?.oldColor:l})}this.controlModel.setProperty("BGColor/key",i,this.selectedContext);this.controlModel.setProperty("BGColor/value",s,this.selectedContext);this.controlModel.setProperty("isPagePersonalization",true,this.selectedContext)}},_handleIconSelect:function e(t){const o=t.getIcon();const s=this.selectedContext.getObject();const n=!s.spaceId;if(n){const e=s;const t=this.keyuserSpaceIconChanges.find(t=>t.spaceId===e.id);if(t){t.icon=o}else{this.keyuserSpaceIconChanges.push({spaceId:e.id,icon:o,oldIcon:e.icon})}const n=this._getInnerPages(e).filter(e=>!e.page.isPageIconPersonalization);n.forEach(e=>{this.controlModel.setProperty(e.bindingPath+"/icon",o)});this.controlModel.setProperty("icon",o,this.selectedContext);this.controlModel.setProperty("isSpaceIconPersonalization",true,this.selectedContext)}else{const e=s;const t=this.keyuserPageIconChanges.find(t=>t.pageId===e.id);const n=this.controlModel.getProperty("/spaces").find(t=>t.id===e.spaceId);const a=n?.isSpaceIconPersonalization;const i=this.keyuserSpaceIconChanges.find(e=>e.spaceId===n?.id);if(t){t.icon=o}else{this.keyuserPageIconChanges.push({pageId:e.id,spaceId:e.spaceId,icon:o,oldIcon:a&&!e.isPageIconPersonalization?i?.oldIcon:s.icon})}this.controlModel.setProperty("icon",o,this.selectedContext);this.controlModel.setProperty("isPageIconPersonalization",true,this.selectedContext)}},_convertColorToLegend:function e(t){let o=G().find(function(e){return e.value===t});return o?o.key:L().key},_handleSwitchChange:function e(t){const o=this.selectedContext.getObject();const s=t.getParameter("state");const n=this.keyuserSpaceColorChanges.find(e=>e.spaceId===o.id);if(n){n.applyColorToAllPages=o.applyColorToAllPages}else{this._handleColorSelect(null,o.BGColor?.value)}const a=s?o.BGColor?.key:L().key;const i=s?o.BGColor?.value:L().value;this._applyInnerPageColoring(o,a,i,s)},_applyInnerPageColoring:function e(t,o,s,n){const a=this._getInnerPages(t);a.forEach(e=>{if(!n&&e.page.isPagePersonalization){const t=this.keyuserPageColorChanges.find(function(t){return t.pageId===e.page.id});if(t){const o=t.BGColor;this.controlModel.setProperty(e.bindingPath+"/BGColor/key",o);this.controlModel.setProperty(e.bindingPath+"/BGColor/value",y.get({name:o}))}else{this.controlModel.setProperty(e.bindingPath+"/BGColor/key",e.page.oldColor?.key);this.controlModel.setProperty(e.bindingPath+"/BGColor/value",e.page.oldColor?.value)}}else{this.controlModel.setProperty(e.bindingPath+"/BGColor/key",o);this.controlModel.setProperty(e.bindingPath+"/BGColor/value",s)}})},_getInnerPages:function e(t){return t.children.map((e,t)=>({page:e,bindingPath:this.selectedContext.getPath()+"/children/"+t}))},_mergeKeyUserChanges:function e(){const t=this._getPanel();const o=t.getParent();const s=o.getParent();if(this.keyuserSpaceColorChanges.length){const e={selectorControl:s,changeSpecificData:{changeType:$.SPACE_COLOR,content:[...this.keyuserSpaceColorChanges]}};this.addKeyUserChanges(e)}if(this.keyuserPageColorChanges.length){const e={selectorControl:s,changeSpecificData:{changeType:$.PAGE_COLOR,content:[...this.keyuserPageColorChanges]}};this.addKeyUserChanges(e)}if(this.keyuserSpaceIconChanges.length){const e={selectorControl:s,changeSpecificData:{changeType:$.SPACE_ICON,content:[...this.keyuserSpaceIconChanges]}};this.addKeyUserChanges(e)}if(this.keyuserPageIconChanges.length){const e={selectorControl:s,changeSpecificData:{changeType:$.PAGE_ICON,content:[...this.keyuserPageIconChanges]}};this.addKeyUserChanges(e)}},_handleDialogClose:function e(){this._mergeKeyUserChanges();this._eventBus.publish("KeyUserChanges","addNewsPagesChanges",{changes:this.getKeyUserChanges()});const t=`${this.getId()}-keyUserPagesSettingsDialog`;this.controlMap.get(t).close()}});return z});
//# sourceMappingURL=KeyUserPagesSettingsPanel.js.map