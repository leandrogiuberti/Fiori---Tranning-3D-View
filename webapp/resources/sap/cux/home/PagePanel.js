/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)
 *  * (c) Copyright 2009-2025 SAP SE. All rights reserved
 */
sap.ui.define(["sap/m/Button","sap/m/FlexBox","sap/m/GenericTile","sap/m/IllustratedMessage","sap/m/IllustratedMessageSize","sap/m/IllustratedMessageType","sap/m/VBox","sap/m/library","sap/ui/core/EventBus","./BasePagePanel","./MenuItem","./Page","./utils/CommonUtils","./utils/Constants","./utils/DataFormatUtils","./utils/Device","./utils/DragDropUtils","./utils/FESRUtil","./utils/PersonalisationUtils","./utils/UshellPersonalizer"],function(e,t,a,s,o,n,i,r,l,g,d,p,c,h,u,P,m,f,x,I){"use strict";function v(e){return e&&e.__esModule&&typeof e.default!=="undefined"?e.default:e}const y=r["LoadState"];const _=v(g);const B=v(d);const C=v(p);const F=c["getPageManagerInstance"];const W=h["PAGE_SELECTION_LIMIT"];const T=h["SETTINGS_PANELS_KEYS"];const D=u["recycleId"];const M=P["DeviceType"];const b=m["attachKeyboardHandler"];const S=m["focusDraggedItem"];const E=f["addFESRId"];const A=f["addFESRSemanticStepName"];const w=v(x);const L=v(I);const N={Mobile:{maxWidth:37.5,minWidth:8},Tablet:{maxWidth:60,minWidth:10.625},Desktop:{maxWidth:18.75,minWidth:7},LargeDesktop:{maxWidth:18.75,minWidth:7},XLargeDesktop:{maxWidth:18.75,minWidth:7},smallTabletMinWidth:8};const z=3;const O=8;const k=4;const R=t.extend("sap.cux.home.CustomFlexBox",{renderer:{apiVersion:2},metadata:{library:"sap.cux.home",aggregations:{items:{type:"sap.ui.core.Control",multiple:true,singularName:"item",dnd:{draggable:true,droppable:true}}}},constructor:function e(a,s){t.prototype.constructor.call(this,a,s)}});const $=_.extend("sap.cux.home.PagePanel",{metadata:{library:"sap.cux.home",properties:{title:{type:"string",group:"Misc",visibility:"hidden"},key:{type:"string",group:"Misc",visibility:"hidden"}},aggregations:{pages:{type:"sap.cux.home.Page",singularName:"page",multiple:true,visibility:"hidden"}}},constructor:function e(t,a){_.prototype.constructor.call(this,t,a)},init:function e(){const t=this;_.prototype.init.call(this);this._oWrapperFlexBox=new R(`${this.getId()}-pageWrapper`,{justifyContent:"Start",height:"100%",width:"100%",direction:"Row",renderType:"Bare",wrap:"Wrap",items:this.getPlaceholderPageTiles()}).addStyleClass("pagesFlexGap sapCuxPagesWrapper");if(this.getDeviceType()!==M.Mobile){this._oWrapperFlexBox.addStyleClass("sapUiSmallMarginTop")}this._pageWrapper=new i(`${this.getId()}-pageContentWrapper`,{items:[this._oWrapperFlexBox]});this.addContent(this._pageWrapper);this.setProperty("title",this._i18nBundle.getText("pageTitle"));const a=new B(`${this.getId()}-managePages`,{title:this._i18nBundle.getText("mngPage"),icon:"sap-icon://edit",press:()=>this._handleEditPages()});this.addAggregation("menuItems",a);E(a,"managePages");this.oEventBus=l.getInstance();this.oEventBus.subscribe("importChannel","favPagesImport",function(e,a,s){try{t.aFavPages=s;return Promise.resolve(t.writeFavPagesIntoPers(t.aFavPages)).then(function(){t._getInnerControls();t._importdone()})}catch(e){return Promise.reject(e)}},this);this.oEventBus.subscribe("pageChannel","pageUpdated",()=>{void this.getData(true)},this)},_importdone:function e(){const t={status:true};this.oEventBus.publish("importChannel","favPagesImported",t)},getData:function e(t=false){try{const a=this;function s(){a.fireEvent("loaded");return a.oPagePromise}const o=function(){if(a.oPagePromise===undefined||a.oPagePromise===null||t){a.oPagePromise=a._getPageManagerInstance().getFavoritePages();return Promise.resolve(a.oPagePromise).then(function(e){a.aFavPages=e;a._getInnerControls();a.oPagePromise=null})}}();return Promise.resolve(o&&o.then?o.then(s):s(o))}catch(n){return Promise.reject(n)}},_handleEditPages:function e(){const t=this.getParent();t?._getLayout().openSettingsDialog(T.PAGES)},getPlaceholderPageTiles:function e(){const t=new Array(W).fill(y.Loading);const s=t.map((e,t)=>new a(D(`${this.getId()}--${t}`),{sizeBehavior:"Responsive",state:e,frameType:"OneByOne",mode:"IconMode",visible:true,renderOnThemeChange:true,ariaRole:"listitem",dropAreaOffset:8}).addStyleClass("cuxPagesPlaceholder"));return s},attachResizeHandler:function e(t,a,s){try{const e=this.aFavPages?.length,o=this.getDeviceType();let n=a;if((o===M.Desktop||o===M.LargeDesktop||o===M.XLargeDesktop)&&t){n=a/2}if(!n){return}let i,r,l,g=n/16;const d=1;s.setWidth("100%");if(e>0){const n=this.calculatePagesPerRow(e,t);if(n){const e=N[o].maxWidth;let t=N[o].minWidth;if(o===M.Tablet&&a<736){t=N.smallTabletMinWidth}i=(g-(n-1)*d)/n;i=Math.min(i,e);i=Math.max(i,t);l=`${i}rem`;r=`${n*i+(n-1)*d}rem`}else{l="auto";r="100%"}this._setPropertyValues({hBoxWidth:r,pagesTileWidth:l});s.setWidth(r)}}catch(e){if(e instanceof Error){}}},getUserAvailablePages:function e(){try{const e=this;return Promise.resolve(e._getPageManagerInstance().fetchAllAvailablePages())}catch(e){return Promise.reject(e)}},calculatePagesPerRow:function e(t,a){let s=0;const o=this.getDeviceType();if(o===M.Desktop||o===M.LargeDesktop||o===M.XLargeDesktop){if(a){s=Math.ceil(t>=O?k:t/2)}else{s=t}}else if(o===M.Mobile){s=t<=z?1:2}else if(o===M.Tablet){s=t<=k?t:Math.ceil(t/2)}return s},_getInnerControls:function e(){const t=[];this.oInnerControls=[];const s=this.getParent();if(this.aFavPages){this.aFavPages.forEach((e,a)=>{t.push(new C(D(`${this.getId()}-favPage-${a}`),{title:e.title,subTitle:e.title===e.spaceTitle?"":e.spaceTitle,icon:e.icon,bgColor:e.BGColor,pageId:e.pageId,spaceId:e.spaceId,spaceTitle:e.spaceTitle,url:"#Launchpad-openFLPPage?pageId="+e.pageId+"&spaceId="+e.spaceId}))});t.forEach((e,t)=>{this.oInnerControls.push(new a(D(`${e.getId()}--genericTile--${t}`),{header:e.getTitle(),subheader:e.getSubTitle(),press:()=>void e.onPageTilePress(e),sizeBehavior:"Responsive",state:"Loaded",frameType:"OneByOne",mode:"IconMode",backgroundColor:e.getBgColor(),tileIcon:e.getIcon(),visible:true,renderOnThemeChange:true,ariaRole:"listitem",dropAreaOffset:8,url:e.getProperty("url")}).addStyleClass("sapCuxPageTile"));this.addAggregation("pages",e,true)});this._oWrapperFlexBox.setAlignItems(this.aFavPages.length==1?"Start":"Center");const e=this._oWrapperFlexBox.getDragDropConfig();if(this.aFavPages.length){s?.panelLoadedFn("Page",{loaded:true,count:this.aFavPages.length});this._setFavPagesContent();if(!e?.length)this.addDragDropConfigTo(this._oWrapperFlexBox,e=>void this._handlePageDnd(e),function(e){try{return Promise.resolve(b(e,true)).then(function(){})}catch(e){return Promise.reject(e)}})}else{this._oWrapperFlexBox.removeAllDragDropConfig();e.forEach(e=>{e.destroy()});s?.panelLoadedFn("Page",{loaded:true,count:0});this._setNoPageContent()}}else{s?.panelLoadedFn("Page",{loaded:false,count:0});this.removeAggregation("content",this._oWrapperFlexBox)}},_setFavPagesContent:function e(){this._oWrapperFlexBox.removeAllItems();this._oWrapperFlexBox.removeStyleClass("pagesFlexBox");this.oInnerControls.forEach(e=>{this._oWrapperFlexBox.addItem(e)})},_createNoPageContent:function t(){if(!this._oIllusMsg){this._oIllusMsg=new s(this.getId()+"--idNoPages",{illustrationSize:o.Small,illustrationType:n.NoSavedItems,title:this._i18nBundle.getText("noDataPageTitle"),description:this._i18nBundle.getText("noPageDescription")}).addStyleClass("myHomeIllustratedMsg myHomeIllustratedMessageAlign");this.oAddPageBtn=new e(this.getId()+"--idAddPageBtn",{text:this._i18nBundle.getText("addPage"),tooltip:this._i18nBundle.getText("addPage"),type:"Emphasized",press:()=>this._handleEditPages()});A(this.oAddPageBtn,"press","addPages")}},_setNoPageContent:function e(){if(!this.oWrapperNoPageVBox){this.oWrapperNoPageVBox=new i(D(`${this.getId()}--wrapperNoPageVBox`),{width:"100%",height:"17rem",backgroundDesign:"Solid",justifyContent:"Center"}).addStyleClass("sapUiRoundedBorder noCardsBorder");this._createNoPageContent();this._oIllusMsg.addAdditionalContent(this.oAddPageBtn);this.oWrapperNoPageVBox.addItem(this._oIllusMsg)}this._oWrapperFlexBox.removeAllItems();this._oWrapperFlexBox.addStyleClass("pagesFlexBox");this._oWrapperFlexBox.addItem(this.oWrapperNoPageVBox)},_setPropertyValues:function e(t){const a=Object.keys(t);a.forEach(e=>{if(e==="hBoxWidth"){this._oWrapperFlexBox.setProperty("width",t[e])}else if(e==="pagesTileWidth"&&this.oInnerControls.length){this.oInnerControls.forEach(function(a){a.setProperty("width",t[e])})}})},_handlePageDnd:function e(t){try{const e=this;const a=t.getParameter?.("dropPosition"),s=t?.getParameter?.("draggedControl"),o=t.getParameter("droppedControl"),n=s.getParent()?.indexOfItem(s);let i=s.getParent()?.indexOfItem(o);if(a==="Before"&&n===i-1){i--}else if(a==="After"&&n===i+1){i++}const r=function(){if(n!==i){return Promise.resolve(e._DragnDropPages(n,i,a)).then(function(){})}}();return Promise.resolve(r&&r.then?r.then(function(){}):void 0)}catch(e){return Promise.reject(e)}},_DragnDropPages:function e(t,a,s){try{const e=this;if(s==="Before"&&t<a){a--}else if(s==="After"&&t>a){a++}const o=e.aFavPages.splice(t,1)[0];e.aFavPages.splice(a,0,o);e.updateTileOrder(t,a);return Promise.resolve(e.writeFavPagesIntoPers(e.aFavPages)).then(function(){S(e._oWrapperFlexBox,a)})}catch(e){return Promise.reject(e)}},updateTileOrder:function e(t,a){const[s]=this.oInnerControls.splice(t,1);this.oInnerControls.splice(a,0,s);this._oWrapperFlexBox.removeAllItems();this.oInnerControls.forEach(e=>{this._oWrapperFlexBox.addItem(e)})},writeFavPagesIntoPers:function e(t){try{const a=this;function s(){return Promise.resolve(a.oPersonalizer.read()).then(function(e){if(!e)e={favouritePages:[]};e.favouritePages=t;return Promise.resolve(a.oPersonalizer.write(e)).then(function(){})})}const o=function(){if(a.oPersonalizer===undefined){return Promise.resolve(L.getInstance(w.getPersContainerId(a),w.getOwnerComponent(a))).then(function(e){a.oPersonalizer=e})}}();return Promise.resolve(o&&o.then?o.then(s):s(o))}catch(n){return Promise.reject(n)}},applyColorPersonalizations:function e(t){void this._getPageManagerInstance()?.applyColorPersonalizations(t)},applyIconPersonalizations:function e(t){void this._getPageManagerInstance()?.applyIconPersonalizations(t)},_getPageManagerInstance:function e(){this.pageManagerInstance=this.pageManagerInstance||F(this);return this.pageManagerInstance},getPageWrapper:function e(){return this._oWrapperFlexBox}});return $});
//# sourceMappingURL=PagePanel.js.map