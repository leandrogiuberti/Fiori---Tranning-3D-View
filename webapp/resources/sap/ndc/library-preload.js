//@ui5-bundle sap/ndc/library-preload.js
/*!
 * SAPUI5
 * (c) Copyright 2025 SAP SE. All rights reserved.
 */
sap.ui.predefine("sap/ndc/BarcodeScannerButton", ["./BarcodeScanner","./BarcodeScannerButtonRenderer","./library","sap/m/Button","sap/ui/core/Control","sap/ui/model/resource/ResourceModel"],function(e,t,a,i,n,o){"use strict";var r=n.extend("sap.ndc.BarcodeScannerButton",{metadata:{library:"sap.ndc",properties:{provideFallback:{type:"boolean",defaultValue:true},width:{type:"sap.ui.core.CSSSize",defaultValue:null},dialogTitle:{type:"string",defaultValue:null},preferFrontCamera:{type:"boolean",defaultValue:false},frameRate:{type:"float"},zoom:{type:"float"},keepCameraScan:{type:"boolean",defaultValue:false},disableBarcodeInputDialog:{type:"boolean",defaultValue:false}},aggregations:{_btn:{type:"sap.m.Button",multiple:false,visibility:"hidden"}},events:{scanSuccess:{parameters:{text:{type:"string"},format:{type:"string"},cancelled:{type:"boolean"}}},scanFail:{},inputLiveUpdate:{parameters:{newValue:{type:"string"}}}}},renderer:t});var s;r.prototype.init=function(){s=new o({bundleName:"sap.ndc.messagebundle"});this.setAggregation("_btn",new i({icon:"sap-icon://bar-code",tooltip:s.getProperty("BARCODE_SCANNER_BUTTON_TOOLTIP"),press:this._onBtnPressed.bind(this),width:"100%"}));var t=e.getStatusModel();this.setModel(t,"status")};r.prototype._onBtnPressed=function(t){var a=this.getAggregation("_btn");e.setFocusedInstanceId(a.sId);e.scan(this._onScanSuccess.bind(this),this._onScanFail.bind(this),this._onInputLiveUpdate.bind(this),this.getProperty("dialogTitle"),this.getProperty("preferFrontCamera"),this.getProperty("frameRate"),this.getProperty("zoom"),this.getProperty("keepCameraScan"),this.getProperty("disableBarcodeInputDialog"))};r.prototype._onScanSuccess=function(e){this.fireScanSuccess(e)};r.prototype._onScanFail=function(e){this.fireScanFail(e)};r.prototype._onInputLiveUpdate=function(e){this.fireInputLiveUpdate(e)};r.prototype.setProvideFallback=function(e){var t=this.getProvideFallback();var a;e=!!e;if(t!==e){this.setProperty("provideFallback",e);a=this.getAggregation("_btn");if(e){a.unbindProperty("visible");a.setVisible(true)}else{a.bindProperty("visible","status>/available")}}return this};r.prototype._setTooltip=function(){var e=this.getTooltip_AsString();this.getAggregation("_btn").setTooltip(e)};return r});
/*!
 * SAPUI5
 * (c) Copyright 2025 SAP SE. All rights reserved.
 */
sap.ui.predefine("sap/ndc/BarcodeScannerButtonRenderer", [],function(){"use strict";var e={apiVersion:2};e.render=function(e,n){n._setTooltip();e.openStart("span",n);e.style("display","inline-block");e.style("width",n.getWidth());e.openEnd();e.renderControl(n.getAggregation("_btn"));e.close("span")};return e},true);
/*!
 * SAPUI5
 * (c) Copyright 2025 SAP SE. All rights reserved.
 */
sap.ui.predefine("sap/ndc/BarcodeScannerUIContainer", ["sap/ui/core/Control","sap/m/Avatar"],function(e,a){"use strict";var t=e.extend("sap.ndc.BarcodeScannerUIContainer",{metadata:{properties:{prefixId:"string"},aggregations:{_oCloseButton:{type:"sap.ui.core.Control",multiple:false,visibility:"hidden"},_oFlashLightButton:{type:"sap.ui.core.Control",multiple:false,visibility:"hidden"},_oControlFlexBox:{type:"sap.ui.core.Control",multiple:false,visibility:"hidden"}}},renderer:{apiVersion:2,render:function(e,a){e.openStart("div",a);e.class("sapNdcRTCDialogVideo");e.openEnd();e.openStart("video",a.getId()+"-video");e.attr("autoplay","autoplay");e.attr("webkit-playsinline","webkit-playsinline");e.attr("playsinline","playsinline");e.class("sapNdcRTCDialogVideoContainer");e.openEnd();e.close("video");e.close("div");e.openStart("div",a.getId()+"-overlay");e.class("sapNdcRTCDialogOverlay");e.openEnd();e.openStart("div",a.getId()+"-overlay-box");e.class("sapNdcRTCDialogOverlayBox");e.openEnd();e.openStart("div",a.getId()+"-overlay-line");e.class("sapNdcRTCDialogOverlayLine");e.openEnd();e.close("div");e.close("div");e.close("div");if(Array.isArray(a._aBarcodeAvatars)){for(var t=0;t<a._aBarcodeAvatars.length;t++){if(a._aBarcodeAvatars[t]){e.renderControl(a._aBarcodeAvatars[t])}}}e.openStart("input",a.getId()+"-image");e.attr("hidden",true);e.attr("type","file");e.attr("accept","image/*");e.openEnd();e.close("input");e.openStart("canvas",a.getId()+"-image-canvas");e.attr("hidden",true);e.style("position","absolute");e.style("background-color","white");e.class("sapNdcRTCDialogImageCanvas");e.openEnd();e.close("canvas");e.renderControl(a.getAggregation("_oCloseButton"));e.renderControl(a.getAggregation("_oFlashLightButton"));e.renderControl(a.getAggregation("_oControlFlexBox"))}}});t.prototype.prepareBarcodeAvatars=function(e){e=e||1;this._aBarcodeAvatars=[];for(var t=0;t<e;t++){var o=new a({src:"sap-icon://arrow-right",tooltip:this.oResourceModel.getResourceBundle().getText("BARCODE_DIALOG_SCAN_RESULT_BUTTON_TOOLTIP",[t+1]),press:function(e){var a=e.getSource();var t=a.getCustomData();if(t.length===2){var o=t[0].getValue();var r=t[1].getValue();r(o)}}}).addStyleClass("sapNdcRTCDialogBarcodeAvatar");this._aBarcodeAvatars.push(o)}};t.prototype.destroy=function(){if(Array.isArray(this._aBarcodeAvatars)){for(var a=0;a<this._aBarcodeAvatars.length;a++){var t=this._aBarcodeAvatars[a];if(t){t.destroy()}}}e.prototype.destroy.apply(this,arguments)};return t});
/*!
 * SAPUI5
 * (c) Copyright 2025 SAP SE. All rights reserved.
 */
sap.ui.predefine("sap/ndc/library", ["sap/m/library","sap/ui/core/Core","sap/ui/core/library"],function(){"use strict";var e=sap.ui.getCore().initLibrary({name:"sap.ndc",apiVersion:2,dependencies:["sap.ui.core","sap.m"],types:[],interfaces:[],controls:["sap.ndc.BarcodeScannerButton","sap.ndc.BarcodeScannerUIContainer"],elements:[],noLibraryCSS:true,version:"1.141.1"});return e});
sap.ui.require.preload({
	"sap/ndc/BarcodeScanner.js":function(){
/*!
 * SAPUI5
 * (c) Copyright 2025 SAP SE. All rights reserved.
 */
sap.ui.loader.config({shim:{"sap/ndc/thirdparty/zxingcpp/zxing_reader":{amd:true,exports:"ZXing"}}});sap.ui.define(["sap/base/Log","sap/ui/model/json/JSONModel","sap/ui/model/BindingMode","sap/ui/model/resource/ResourceModel","sap/m/Input","sap/m/Label","sap/m/Button","sap/m/Dialog","sap/m/FlexBox","sap/m/BusyDialog","sap/ui/dom/includeStylesheet","./BarcodeScannerUIContainer","sap/m/MessageToast","sap/m/library","sap/ui/base/Event","sap/ui/base/EventProvider","sap/ui/Device","sap/ui/thirdparty/jquery","sap/base/util/deepClone","sap/m/Avatar","sap/ui/core/CustomData","sap/m/MessageBox","sap/m/_thirdparty/purify","sap/ndc/thirdparty/zxingcpp/zxing_reader"],function(e,a,t,n,r,i,o,s,c,l,d,u,f,g,p,h,y,jQuery,m,v,P,S,b,B){"use strict";document.addEventListener("settingsDone",Se);document.addEventListener("SettingCompleted",Se);document.addEventListener("mockSettingsDone",Se);d({url:sap.ui.require.toUrl("sap/ndc/css/sapNdcBarcodeScanner.css")});var C={},D,E,I,A,w,T,R,x,_,O,k={Initial:"Initial",Loading:"Loading",Available:"Available",UnAvailable:"UnAvailable"},L=new a({scannerAPI:"unknown",available:false,config:{defaultConstraints:{audio:false,video:{facingMode:"environment"}},deviceId:undefined,preferFrontCamera:false,enableGS1Header:false},scanDialog:{title:"",onLiveUpdate:null,barcodeOverlaySetup:false,scanningStartTime:0,keepCameraScan:false,isDecodePaused:false,disableBarcodeInputDialog:false},busyDialog:null,callBackHandler:{onFnFail:null,onFnSuccess:null,callBackFromSetPhysicalScan:false,fnBluetoothScan:null},devices:{mainCamera:undefined,needCheck:true,all:[],front:[],back:[]},apis:{ZebraEnterpriseBrowser:{key:"ZebraEnterpriseBrowser",description:"Zebra Enterprise Browser",status:k.Initial,enableBarcodeState:"init",enableZebraBarcodeRetryCount:6},Cordova:{key:"Cordova",description:"Cordova",status:k.Initial,scannerAPI:null},ZXingCPP:{key:"ZXingCPP",description:"WebAssembly build (using Emcripten) of zxing-cpp",status:k.Initial,instance:null,scannerAPI:null,multiScan:{enabled:false,maxBarcodeNumber:10,showPauseButton:false,pauseIfHasResult:false,stopIfOnlyHasOneResult:false}},BluetoothScanner:{key:"BluetoothScanner",description:"Bluetooth Barcode Scanner",status:k.UnAvailable,resultBuffer:[],resultMinLength:2,scanningKeyMaxLength:1,scanningLastKey:null,triggerOneTime:false,timeOutForDetection:null,handleFocusedElement:false,focusedElementInstance:"",focusedElementValue:"",focusedElementSelectionStart:null,focusedElementSelectionEnd:null,focusedCurrentWindow:false,scanningMode:"TimeInterval",intervalForDetection:80,maxPrefixSuffixScanningTime:5e3,prefix:"$",suffix:"#",prefixFound:false,suffixFound:false,prefixString:"",suffixString:"",prefixStartDate:null,replaceGS1Separator:false,replaceCharacterBuffer:"",GS1FunctionKey:"altKey",GS1Code:undefined,GS1ReplacementCharacter:undefined}},bReady:true}),F=new a({scannerAPI:"unknown",available:false,deviceId:undefined,devices:[],apis:{ZebraEnterpriseBrowser:{key:"ZebraEnterpriseBrowser",status:k.Initial},Cordova:{key:"Cordova",status:k.Initial},ZXingCPP:{key:"ZXingCPP",status:k.Initial,multiScan:{enabled:false,maxBarcodeNumber:10,showPauseButton:false,pauseIfHasResult:false,stopIfOnlyHasOneResult:false}},BluetoothScanner:{key:"BluetoothScanner",status:k.UnAvailable}}}).setDefaultBindingMode(t.OneWay),M=new n({bundleName:"sap.ndc.messagebundle"});function Z(e){return L.getProperty("/apis/"+e+"/")}function N(a,t,n){if(!a||!Z(a)){e.error("BarcodeScanner.updateScannerAPI: scanner API '"+a+"' is not a valid status code, stop update scanner API. Please check!");return}var r="/apis/"+a+"/";if(t){if(k[t]){L.setProperty(r+"status",t);F.setProperty(r+"status",t)}else{e.error("BarcodeScanner.updateScannerAPI: scanner API status '"+t+"' is not a valid status code, please check!")}}if(typeof n==="boolean"&&n&&a!=="BluetoothScanner"){L.setProperty("/scannerAPI",a);F.setProperty("/scannerAPI",a)}L.checkUpdate(true);F.checkUpdate(true)}function G(e,a){N(e,k.Available,a)}function H(a,t){L.setProperty("/apis/"+a+"/instance",null);L.setProperty("/apis/"+a+"/scannerAPI",null);if(a==="BluetoothScanner"){L.setProperty("/callBackHandler/fnBluetoothScan",null)}N(a,k.UnAvailable);if(t){e.debug("Update the related data when API is set to unavailable");var n=L.getProperty("/apis");var r="unknown";for(var i in n){if(n[i].status===k.Available||n[i].status===k.Initial){r=i;break}}G(r,true)}}function X(){return L.getProperty("/scannerAPI")}function U(e){if(e==="unknown"){L.setProperty("/scannerAPI",e);F.setProperty("/scannerAPI",e)}else{N(e,undefined,true)}}function W(a,t){if(!a||!Z(a)){e.error("BarcodeScanner.checkScannerAPIStatus: scanner API '"+a+"' doesn't exist. Please check!");return false}var n=L.getProperty("/apis/"+a+"/status");return t===n}function K(e){return W(e,k.Available)}function z(e){return W(e,k.UnAvailable)}function V(){L.setProperty("/available",false);F.setProperty("/available",false);j()}function j(){H("ZXingCPP");e.debug("BarcodeScanner.disableZXingCPP: Set status of Feature scanner APIs (ZXingCPP) to unavailable!")}function Y(){try{var a=cordova.plugins.barcodeScanner;if(a){L.setProperty("/apis/Cordova/scannerAPI",a);G("Cordova");if(X()==="unknown"){U("Cordova")}e.debug("BarcodeScanner.initScannerAPIs: Cordova BarcodeScanner plugin is available!");j()}else{e.debug("BarcodeScanner.initScannerAPIs: Cordova BarcodeScanner plugin is unavailable!");H("Cordova");q()}}catch(a){e.debug("BarcodeScanner.initScannerAPIs: Cordova BarcodeScanner plugin is unavailable!");H("Cordova");q()}}function q(){jQuery(document).ready(function(){if(ae()){te()}});$()}function J(a){e.error(a);e.warning("BarcodeScanner.loadZXingCPPFailed: no feature scanner API available now.");V();L.checkUpdate(true)}function $(){L.setProperty("/apis/ZXingCPP/instance",B);if(X()==="unknown"){U("ZXingCPP")}e.debug("BarcodeScanner.initialZXingCPPAPI: ZXingCPP API is Initial!");N("ZXingCPP",k.Initial)}function Q(a,t){var n=new l({title:M.getProperty("BARCODE_DIALOG_BUSY_TITLE"),text:M.getProperty("BARCODE_DIALOG_BUSY_TEXT_ZXINGCPP")});n.open();N("ZXingCPP",k.Loading);var r={locateFile:function(e,a){return ee(e,a,"zxingcpp")}};var i=L.getProperty("/apis/ZXingCPP/instance");i(r).then(function(t){L.setProperty("/apis/ZXingCPP/scannerAPI",t);e.debug("BarcodeScanner.loadZXingCPPInstance: wasm lib instance of ZXingCPP is available!");G("ZXingCPP");if(X()==="unknown"){U("ZXingCPP")}e.debug("BarcodeScanner.loadZXingCPPInstance: ZXingCPP API is available!");n.close();a()},function(e){J("BarcodeScanner.loadZXingCPPInstance: can not load wasm lib instance of ZXingCPP.\n"+e);n.close();t()})}function ee(e,a,t){if(!a||a===""){return sap.ui.require.toUrl("sap/ndc/thirdparty/"+t+"/")+e}return a+e}function ae(){return!!(window&&window.navigator&&window.navigator.mediaDevices&&window.navigator.mediaDevices.enumerateDevices)}function te(){e.debug("BarcodeScanner.getDeviceCameras: start to get device cameras");window.navigator.mediaDevices.enumerateDevices().then(function(a){var t=L.getProperty("/devices");var n=0;a.forEach(function(a){if(a.kind==="videoinput"){n++;var r={deviceId:a.deviceId,groupId:a.groupId,kind:a.kind,label:a.label};if(r.label&&r.label!==""){if(r.label.indexOf("0, facing back")>0){e.debug("BarcodeScanner.getDeviceCameras: has a camera with label contains '0, facing back', set it as main camera.");t.needCheck=false;t.mainCamera=r}if(r.label.indexOf("back")>0){t.back.push(r)}else if(r.label.indexOf("front")>0){t.front.push(r)}}else{r.label="Camera "+n}t.all.push(r)}});if(!t.mainCamera){if(t.back.length===1){e.debug("BarcodeScanner.getDeviceCameras: has only one camera which label contains 'back', set it as main camera.");t.mainCamera=m(t.back[0]);t.needCheck=false}else if(t.all.length===1){e.debug("BarcodeScanner.getDeviceCameras: has only one camera, set it as main camera.");t.mainCamera=m(t.all[0]);t.needCheck=false}}L.setProperty("/devices",t);re()}).catch(function(a){L.setProperty("/devices/needCheck",false);e.error("BarcodeScanner.getDeviceCameras: Can not get device cameras.\nError Message: "+a)})}function ne(a,t){var n=m(a);var r=function(){if(n.length===0){L.setProperty("/devices/needCheck",false);re();e.debug("BarcodeScanner.findMainCamera: can not find the main camera.");t()}else{var i=n.length-1;var o=n[i];var s=m(L.getProperty("/config/defaultConstraints"));s.video.deviceId={exact:o.deviceId};var c=_e();s.video=Object.assign(s.video,c);window.navigator.mediaDevices.getUserMedia(s).then(function(t){var s=typeof t.stop==="function"?t:t.getTracks()[0];ie(s).then(function(){a[i].hasFlashLight=true;L.setProperty("/devices/mainCamera",a[i]);L.setProperty("/devices/needCheck",false);re();e.debug("BarcodeScanner.findMainCamera: the main camera is "+o.deviceId);E&&E.getModel().setProperty("/hasFlashLight",true);L.setProperty("/scanDialog/hasFlashLight",true);e.debug("BarcodeScanner.findMainCamera: enable flashlight");D=t;if(D){we()}else{E&&E.getModel().setProperty("/isNoScanner",true);be(M.getResourceBundle().getText("BARCODE_DIALOG_CAMERA_STREAM_ERROR_MSG"))}},function(){a[i].hasFlashLight=false;s.stop();e.debug("BarcodeScanner.findMainCamera: "+o.deviceId+" is not the main camera, check the next camera");n.pop();r()})}).catch(function(a){e.debug("BarcodeScanner.findMainCamera: getUserMedia() failed.\nError Message: "+a);if(L.getProperty("/config/defaultConstraints/video/zoom")!==undefined){e.debug("BarcodeScanner.findMainCamera: getUserMedia() failed maybe caused by unsupported constraint 'zoom', delete it and try again.");delete L.getProperty("/config/defaultConstraints/video").zoom}else{n.pop()}r()})}};r()}function re(){e.debug("BarcodeScanner.updateDevicesInStatusModel: update the devices in status model");var a=m(L.getProperty("/devices/all"));F.setProperty("/devices",a)}function ie(a){if(!("ImageCapture"in window)){return new Promise(function(a,t){e.debug("BarcodeScanner.checkFlashLight: Device does not support image capture");t()})}else if(!a){return new Promise(function(a,t){e.debug("BarcodeScanner.checkFlashLight: Camera is not opened");t()})}else{var t=new ImageCapture(a);return new Promise(function(a,n){t.getPhotoCapabilities().then(function(t){if(t.fillLightMode&&t.fillLightMode.includes("flash")){e.debug("BarcodeScanner.checkFlashLight: Camera supports flashlight");a()}else{e.debug("BarcodeScanner.checkFlashLight: Camera doesn't support flashlight");n()}}).catch(function(a){e.debug("BarcodeScanner.checkFlashLight: Camera not started or not available.\nError Message: "+a);n()})})}}function oe(){if(!L.getProperty("/scanDialog/hasFlashLight")){e.error("BarcodeScanner.toggleFlashLight: No flashlight currently");return}var a=L.getProperty("/scanDialog/flashLightOn");var t=!a?"Open":"Close";A.applyConstraints({advanced:[{torch:!a}]}).then(function(){L.setProperty("/scanDialog/flashLightOn",!a);e.debug("BarcodeScanner.toggleFlashLight: "+t+" flashlight of camera success.")}).catch(function(a){var n="BARCODE_DIALOG_"+t.toUpperCase()+"_FLASHLIGHT_ERROR_MSG";f.show(M.getResourceBundle().getText(n),{duration:1e3});e.error("BarcodeScanner.toggleFlashLight: "+t+" flashlight of camera failed.\nError Message: "+a)})}function se(){var e=L.getProperty("/scanDialog/flashLightOn");if(e){oe()}if(R){ce(false);return R.click()}}function ce(a){var t=typeof a==="boolean"?a:L.getProperty("/scanDialog/isDecodePaused");if(t){e.debug("BarcodeScanner.toggleCameraScanning: start camera");Fe();L.setProperty("/scanDialog/isDecodePaused",false);E&&E.getModel().setProperty("/isDecodePaused",false);if(x){x.hidden=true}if(A&&A.readyState==="live"){A.stop()}Ce(false)}else{e.debug("BarcodeScanner.toggleCameraScanning: pause camera");le()}}function le(){E.getModel().setProperty("/hasFlashLight",false);if(y.os.ios||y.os.macintosh){var e=y.orientation["portrait"]?"portrait":"landscape";L.setProperty("/scanDialog/pausedOrientation",e)}if(w){w.pause()}if(_){_.hidden=true}L.setProperty("/scanDialog/isDecodePaused",true);E&&E.getModel().setProperty("/isDecodePaused",true)}function de(){var e=R.files[0];if(e){Fe();fe(e)}}function ue(){if(!L.getProperty("/apis/ZXingCPP/multiScan/showPauseButton")){ce(true)}}function fe(e){var a=new l({title:M.getProperty("BARCODE_DIALOG_SCAN_IMAGE_BUSY_TITLE")});a.open();L.setProperty("/busyDialog",a);L.setProperty("/scanDialog/scanningStartTime",Date.now());var t=new FileReader;t.onload=function(e){pe(e.target.result).then(function(a){ge(a,e.target.result)},function(){a.close();C.closeScanDialog();f.show(M.getResourceBundle().getText("BARCODE_DIALOG_SCAN_IMAGE_COMPRESS_FAILED_MSG"),{duration:1e3})})};t.onerror=function(){C.closeScanDialog();a.close();f.show(M.getResourceBundle().getText("BARCODE_DIALOG_SCAN_IMAGE_LOAD_FAILED_MSG"),{duration:1e3})};t.readAsDataURL(e)}function ge(a,t){e.debug("BarcodeScanner.decodeImageData: start to decode the image data");var n=true;var r=a;if(!a&&t){n=false;r=t;e.debug("BarcodeScanner.decodeImageData: image data is not compressed")}var i;var o=L.getProperty("/apis/ZXingCPP/scannerAPI");try{i=o._malloc(r.length);o.HEAPU8.set(r,i)}catch(a){e.info("BarcodeScanner.decodeImageData: zxing.HEAPU8 error: "+a)}var s=L.getProperty("/apis/ZXingCPP/multiScan");var c=s.enabled?s.maxBarcodeNumber:1;var l=o.readBarcodesFromImage(i,r.length,true,"",c);o._free(i);var d=L.getProperty("/busyDialog");var u=function(){if(d){d.close();L.setProperty("/busyDialog",null)}f.show(M.getResourceBundle().getText("BARCODE_DIALOG_SCAN_IMAGE_ERROR_MSG"),{duration:1e3});if(!L.getProperty("/apis/ZXingCPP/multiScan/showPauseButton")){ce(true)}};var g=l.size();if(g===1){e.debug("BarcodeScanner.decodeImageData: decode successful");if(d){d.close();L.setProperty("/busyDialog",null)}var p=l.get(0);ke(p)}else if(g>1){e.debug("BarcodeScanner.decodeImageData: decode successful");if(d){d.close();L.setProperty("/busyDialog",null)}if(x){x.hidden=false}var h=32768;var y=[];for(var m=0;m<r.length;m+=h){y.push(String.fromCharCode.apply(null,r.subarray(m,m+h)))}y=y.join("");var v="data:image/jpeg;base64,"+window.btoa(y);he(v).then(function(e){Le(l,true,e)})}else if(n&&t){e.debug("BarcodeScanner.decodeImageData: decode compressed image data failed");S.confirm(M.getResourceBundle().getText("BARCODE_DIALOG_SCAN_WITH_ORIGINAL_IMAGE_CONFIRM_MSG"),{onClose:function(e){if(e===S.Action.CANCEL){u();return}pe(t,false).then(function(e){ge(null,e)},function(){d.close();C.closeScanDialog();f.show(M.getResourceBundle().getText("BARCODE_DIALOG_SCAN_IMAGE_COMPRESS_FAILED_MSG"),{duration:1e3})})}})}else{u()}}function pe(a,t){var n=1080,r="image/jpeg";t=typeof t==="boolean"?t:true;return new Promise(function(i,o){var s=new Image;s.onload=function(){var a=this.width,o=this.height,c=document.createElement("canvas"),l=c.getContext("2d"),d=a,u=o;if(t){if(a<=o&&a>n){d=n;u=Math.round(o*(n/a))}else if(a>=o&&o>n){u=n;d=Math.round(a*(n/o))}e.debug("BarcodeScanner.getImageData: Compress image data")}c.width=d;c.height=u;e.debug("BarcodeScanner.getImageData: Canvas width is "+d+"; the Height is "+u);l.drawImage(s,0,0,d,u);var f=c.toDataURL(r);f=f.split(",")[1];f=window.atob(f);var g=new Uint8Array(f.length);for(var p=0;p<f.length;p++){g[p]=f.charCodeAt(p)}i(g)};s.onerror=function(){o()};s.src=a})}function he(e,a){return new Promise(function(t,n){if(a){ye(x.oImage,t)}else{var r=new Image;r.onload=function(){x.oImage=r;ye(r,t)};r.onerror=function(){x.oImage=null;n()};r.src=e}})}function ye(a,t){var n=a.width,r=a.height,i=n,o=r,s=x.getContext("2d"),c=I.getDomRef().clientWidth,l=I.getDomRef().clientHeight;s.clearRect(0,0,c,l);if(n>c||r>l){if(n/r>c/l){i=c;o=Math.round(c*(r/n))}else{o=l;i=Math.round(l*(n/r))}}e.debug("Compress image data. The width is "+i+"; the Height is "+o);x.width=c;x.height=l;var d=(c-i)/2;var u=(l-o)/2;s.drawImage(a,d,u,i,o);var f=Math.round(i*100/n)/100;var g={left:d,top:u,imageScaleRate:f};t(g)}function me(){return!!(window&&window.navigator&&window.navigator.mediaDevices&&window.navigator.mediaDevices.getUserMedia)}function ve(){try{if(self!=top&&typeof cordova==="undefined"){window.cordova=top.cordova}}catch(a){e.info("BarcodeScanner.checkCordovaInIframe: cordova is unavailable in cross-origin iframe")}}function Pe(){try{if(self!=top&&(typeof EB==="undefined"||typeof window.Rho==="undefined")){if(typeof top.EB!=="undefined"||typeof top.Rho!=="undefined"){window.EB=top.EB;window.Rho=top.Rho}}if(typeof EB!=="undefined"&&typeof EB.Barcode!=="undefined"){G("ZebraEnterpriseBrowser",true);e.debug("BarcodeScanner.initZebraEB: Zebra Enterprise Browser plugin is available!")}else{H("ZebraEnterpriseBrowser");e.debug("BarcodeScanner.initZebraEB: Zebra Enterprise Browser plugin is unavailable!")}}catch(a){e.info("BarcodeScanner.initZebraEB: EB and Rho are unavailable")}}function Se(){ve();L.setProperty("/available",true);F.setProperty("/available",true);if(y.os.android){jQuery(document).ready(function(){Pe();He()})}else{H("ZebraEnterpriseBrowser");e.debug("BarcodeScanner.init: Not Android device, Zebra Enterprise Browser plugin is unavailable!")}if(sap.Settings&&typeof sap.Settings.isFeatureEnabled==="function"){sap.Settings.isFeatureEnabled("cordova.plugins.barcodeScanner",function(a){if(a){Y()}else{V();e.warning("BarcodeScanner.init: Feature disabled in sap.Settings");Y()}},function(){e.warning("BarcodeScanner.init: Feature check failed");Y()})}else{if(sap.Settings===undefined){e.debug("BarcodeScanner.init: No sap.Settings. No feature vector available.")}else{e.warning("BarcodeScanner.init: Feature vector (sap.Settings.isFeatureEnabled) is unavailable")}Y()}}function be(a){if(a){e.warning("BarcodeScanner.openBarcodeInputDialog: isNoScanner. Message: "+a);var t=M.getResourceBundle().getText("BARCODE_DIALOG_CAMERA_OTHER_ERROR_MSG",[a]);if(a.name){var n="BARCODE_DIALOG_CAMERA_"+a.name.toUpperCase()+"_ERROR_MSG";t=M.getResourceBundle().getText(n)}f.show(t,{duration:1e3})}var s=L.getProperty("/scanDialog/disableBarcodeInputDialog");if(s){C.closeScanDialog()}else{E.setShowHeader(true);E.destroyContent();E.setTitle("");E.setStretch(false);E.setContentHeight("auto");if(_){_.hidden=true}E.removeStyleClass("sapUiNoContentPadding");E.setTitle(L.getProperty("/scanDialog/title"));var c=new i(E.getId()+"-txt_barcode",{text:"{i18n>BARCODE_DIALOG_MSG}",visible:"{/isNoScanner}"});E.addContent(c);var l=new r(E.getId()+"-inp_barcode",{value:"{/barcode}",valueLiveUpdate:true,ariaLabelledBy:c.getId(),liveChange:function(e){var a=L.getProperty("/scanDialog/onLiveUpdate");if(typeof a==="function"){a({newValue:e.getParameter("newValue")})}},placeholder:"{i18n>BARCODE_DIALOG_PLACEHOLDER}"});E.addContent(l);var d=g.ButtonType;E.setBeginButton(new o(E.getId()+"-btn_barcode_ok",{type:d.Emphasized,text:"{i18n>BARCODE_DIALOG_OK}",press:function(e){var a=L.getProperty("/callBackHandler/onFnSuccess");if(typeof a==="function"){var t="unknown";if(L.getProperty("/scanDialog/scanningStartTime")>0){var n=Date.now();t=n-L.getProperty("/scanDialog/scanningStartTime")}a({text:E.getModel().getProperty("/barcode"),scanningTime:t,cancelled:false})}C.closeScanDialog()}}));E.setEndButton(new o({text:"{i18n>BARCODE_DIALOG_CANCEL}",press:function(){C.closeScanDialog()}}));E.setBusy(false)}}function Be(){if(!L.getProperty("/config/preferFrontCamera")){delete L.getProperty("/config/defaultConstraints/video").facingMode;var a=L.getProperty("/devices");if(!L.getProperty("/config/deviceId")&&!a.mainCamera&&!y.os.ios&&!y.os.macintosh&&a.needCheck&&a.all.length>1){var t=a.back.length>1?a.back:a.all;var n=a.back.length>1?"back":"all";e.debug("BarcodeScanner.openCorrectCamera: start to find the main camera in "+n+" camera list.");ne(t,Ce);return}}Ce()}function Ce(a){e.debug("BarcodeScanner.openCamera: start to open camera");L.setProperty("/scanDialog/pausedOrientation",undefined);var t=false;if(L.getProperty("/config/deviceId")){delete L.getProperty("/config/defaultConstraints/video").facingMode;L.setProperty("/config/defaultConstraints/video/deviceId",{exact:L.getProperty("/config/deviceId")})}else if(L.getProperty("/config/preferFrontCamera")){L.setProperty("/config/defaultConstraints/video/facingMode","user");delete L.getProperty("/config/defaultConstraints/video").deviceId}else{var n=L.getProperty("/devices");if(n.mainCamera&&n.mainCamera.deviceId!==""){t=true;L.setProperty("/config/defaultConstraints/video/deviceId",{exact:n.mainCamera.deviceId})}else{L.setProperty("/config/defaultConstraints/video/facingMode","environment")}}var r=m(L.getProperty("/config/defaultConstraints"));var i=_e();r.video=Object.assign(r.video,i);window.navigator.mediaDevices.getUserMedia(r).then(function(e){D=e;if(y.os.ios){L.setProperty("/scanDialog/hasFlashLight",false);E&&E.getModel().setProperty("/hasFlashLight",false)}else{if(t&&typeof n.mainCamera.hasFlashLight==="boolean"){L.setProperty("/scanDialog/hasFlashLight",n.mainCamera.hasFlashLight);E&&E.getModel().setProperty("/hasFlashLight",n.mainCamera.hasFlashLight)}else{var r=typeof e.stop==="function"?e:e.getTracks()[0];ie(r).then(function(){L.setProperty("/scanDialog/hasFlashLight",true);if(t){n.mainCamera.hasFlashLight=true}E&&E.getModel().setProperty("/hasFlashLight",true)},function(){L.setProperty("/scanDialog/hasFlashLight",false);if(t){n.mainCamera.hasFlashLight=false}E&&E.getModel().setProperty("/hasFlashLight",false)})}}if(D){we(a)}else{E&&E.getModel().setProperty("/isNoScanner",true);be(M.getResourceBundle().getText("BARCODE_DIALOG_CAMERA_STREAM_ERROR_MSG"))}}).catch(function(a){e.debug("BarcodeScanner.openCamera: getUserMedia() failed.\nError Message: "+a);if(L.getProperty("/config/defaultConstraints/video/zoom")!==undefined){e.debug("BarcodeScanner.openCamera: getUserMedia() failed maybe caused by unsupported constraint 'zoom', delete it and try again.");delete L.getProperty("/config/defaultConstraints/video").zoom;Ce()}else{E&&E.getModel().setProperty("/isNoScanner",true);be(a)}})}function De(){L.checkUpdate(true);var e;if(!E||E&&E.getContent().length===0){e=new a({hasFlashLight:L.getProperty("/scanDialog/hasFlashLight")&&!y.os.ios,isDecodePaused:L.getProperty("/scanDialog/isDecodePaused"),showPauseButton:L.getProperty("/apis/ZXingCPP/multiScan/enabled")&&L.getProperty("/apis/ZXingCPP/multiScan/showPauseButton")});E=new s("sapNdcBarcodeScannerDialog",{icon:"sap-icon://bar-code",title:M.getProperty("BARCODE_DIALOG_SCANNING_TITLE"),stretch:true,horizontalScrolling:false,verticalScrolling:false,afterClose:function(){Ge();if(E){E.destroyContent();E.destroy()}E=null;if(typeof O==="object"){jQuery(O).focus();jQuery(O).on("blur",Je)}}});E.setEscapeHandler(function(a){C.closeScanDialog();var t=L.getProperty("/callBackHandler/onFnSuccess");if(typeof t==="function"){t({text:e.getProperty("/barcode"),cancelled:true})}a.resolve()});E.setModel(e);E.setModel(M,"i18n")}E.addStyleClass("sapUiNoContentPadding");E.setBusy(true);if(K("ZXingCPP")&&me()){E.attachAfterOpen(function(){document.body.style.setProperty("--sapNdcRTCDialogVideoHeight",I.getDomRef().clientHeight+"px");document.body.style.setProperty("--sapNdcRTCDialogVideoWidth",I.getDomRef().clientWidth+"px");Be()});E.setShowHeader(false);E.destroyContent();_=undefined;w=undefined;T=undefined;R=undefined;x=undefined;var t=L.getProperty("/apis/ZXingCPP/multiScan");var n=t.enabled?t.maxBarcodeNumber:1;I=new u;I.oResourceModel=M;I.prepareBarcodeAvatars(n);I.setAggregation("_oCloseButton",new v({src:"sap-icon://decline",backgroundColor:"Transparent",tooltip:M.getResourceBundle().getText("BARCODE_DIALOG_STOP_SCANNING_BUTTON_TOOLTIP"),press:function(){E.getModel().setProperty("/isNoScanner",false);Ge();be()}}).addStyleClass("sapNdcRTCDialogButton").addStyleClass("closeButton"));I.setAggregation("_oFlashLightButton",new v({src:"sap-icon://lightbulb",visible:"{/hasFlashLight}",backgroundColor:"Transparent",tooltip:{path:"/flashLightOn",formatter:function(e){var a="";if(!e){a="BARCODE_DIALOG_SELECT_FLASHLIGHT_BUTTON_TOOLTIP_OPEN"}else{a="BARCODE_DIALOG_SELECT_FLASHLIGHT_BUTTON_TOOLTIP_CLOSE"}return M.getResourceBundle().getText(a)}},press:function(){oe()}}).addStyleClass("sapNdcRTCDialogButton").addStyleClass("flashLightButton"));var r=new c({alignItems:"Start",justifyContent:"SpaceBetween",items:[new v({visible:"{/showPauseButton}",backgroundColor:"Transparent",src:{path:"/isDecodePaused",formatter:function(e){if(e){return"sap-icon://media-play"}else{return"sap-icon://media-pause"}}},tooltip:{path:"/isDecodePaused",formatter:function(e){if(e){return M.getResourceBundle().getText("BARCODE_DIALOG_SCAN_BUTTON_TOOLTIP_START")}else{return M.getResourceBundle().getText("BARCODE_DIALOG_SCAN_BUTTON_TOOLTIP_PAUSE")}}},press:function(){ce()}}).addStyleClass("sapNdcRTCDialogControlButton"),new v({src:"sap-icon://picture",backgroundColor:"Transparent",tooltip:M.getResourceBundle().getText("BARCODE_DIALOG_SELECT_IMAGE_BUTTON_TOOLTIP"),press:function(){se()}}).addStyleClass("sapNdcRTCDialogControlButton")]});if(L.getProperty("/apis/ZXingCPP/multiScan/showPauseButton")){r.addStyleClass("sapNdcRTCDialogControlFlexBoxWithPauseButton")}else{r.addStyleClass("sapNdcRTCDialogControlFlexBoxWithoutPauseButton")}I.setAggregation("_oControlFlexBox",r);E.addContent(I);E.setContentWidth("100%");E.setContentHeight("100%");E.addStyleClass("sapUiNoContentPadding");E.setBusy(true);L.setProperty("/scanDialog/barcodeOverlaySetup",false)}else{if(L.getProperty("/available")){E.getModel().setProperty("/isNoScanner",false)}else{E.getModel().setProperty("/isNoScanner",true)}be()}E.open()}function Ee(){L.setProperty("/bReady",true);L.setProperty("/callBackHandler/callBackFromSetPhysicalScan",false);EB.Barcode.triggerType=EB.Barcode.SOFT_ONCE;EB.Barcode.start()}function Ie(){var a;if(L.getProperty("/config/preferFrontCamera")){a={preferFrontCamera:true}}L.getProperty("/apis/Cordova/scannerAPI").scan(function(e){if(e.cancelled==="false"||!e.cancelled){e.cancelled=false;var a=L.getProperty("/callBackHandler/onFnSuccess");if(typeof a==="function"){a(e)}}else{De()}L.setProperty("/bReady",true)},function(a){e.error("BarcodeScanner.scanWithCordova: Barcode scanning failed.");L.setProperty("/bReady",true);var t=L.getProperty("/callBackHandler/onFnFail");if(typeof t==="function"){if(typeof a==="string"){var n=a;a={text:n};e.debug("BarcodeScanner.scanWithCordova: Change the type of oEvent from string to object")}t(a)}},a)}function Ae(){var a=L.getProperty("/apis/ZXingCPP/instance");var t=L.getProperty("/busyDialog");if(!a&&W("ZXingCPP",k.Loading)&&t){t.open();e.debug("BarcodeScanner.scanWithZXingCPP: zxing_reader file is loading.");setTimeout(function(){Ae()},0)}else if(W("ZXingCPP",k.Initial)){e.debug("BarcodeScanner.scanWithZXingCPP: ZXingCPP instances is not loaded, start to load them.");Q(De,function(){if(K("ZebraEnterpriseBrowser")){U("ZebraEnterpriseBrowser");e.debug("BarcodeScanner.scanWithZXingCPP: Zebra is available, set the current scanner API to Zebra.")}else{U("unknown");e.warning("BarcodeScanner.scanWithZXingCPP: Zebra is unavailable too, set the current scanner API to unknown.")}De()})}else{e.debug("BarcodeScanner.scanWithZXingCPP: open scan dialog.");De()}}function we(a){E.setBusy(false);if(!w){w=I?I.getDomRef("video"):undefined}if(!R){R=I?I.getDomRef("image"):undefined;if(R){R.addEventListener("change",de);R.addEventListener("cancel",ue)}}if(!x){x=I?I.getDomRef("image-canvas"):undefined}try{w.srcObject=D;w.play().then(function(){Ne();if(y.support.orientation&&a!==false){y.orientation.attachHandler(xe)}e.debug("BarcodeScanner.playbackVideoAndDecode: video screen size "+w.videoHeight+"X"+w.videoWidth);A=typeof D.stop==="function"?D:D.getTracks()[0];var t=A.getSettings();e.debug("BarcodeScanner.playbackVideoAndDecode: video screen frameRate is "+t.frameRate+", zoom is "+t.zoom);Te()})}catch(a){e.debug("BarcodeScanner.playbackVideoAndDecode is failed. error: "+a)}}function Te(){e.debug("BarcodeScanner.decodeWithZXingCPP: start to decode");if(!w||!w.srcObject){e.debug("BarcodeScanner.decodeWithZXingCPP: video dom doesn't exist, stop decoding");return}if(L.getProperty("/scanDialog/isDecodePaused")){e.debug("BarcodeScanner.decodeWithZXingCPP: camera is paused, stop decoding");return}try{if(L.getProperty("/scanDialog/barcodeOverlaySetup")){Fe()}if(!T){T=I?document.createElement("canvas"):undefined}if(!T){e.debug("BarcodeScanner.decodeWithZXingCPP: canvas dom doesn't exist, stop decoding");return}var a=T.getContext("2d",{willReadFrequently:true});var t=w.videoWidth;var n=w.videoHeight;T.width=t;T.height=n;a.drawImage(w,0,0,t,n);var r=a.getImageData(0,0,t,n);var i=r.data;var o;var s=L.getProperty("/apis/ZXingCPP/scannerAPI");try{o=s._malloc(i.length);s.HEAPU8.set(i,o)}catch(a){e.error("BarcodeScanner.decodeWithZXingCPP: zxing.HEAPU8 error: "+a)}var c=L.getProperty("/apis/ZXingCPP/multiScan");var l=c.enabled?c.maxBarcodeNumber:1;var d=s.readBarcodesFromPixmap(o,t,n,true,"",l);s._free(o);var u=d.size();if(c.enabled&&u>0){e.debug("BarcodeScanner.decodeWithZXingCPP: decode successful");var f=!c.showPauseButton&&c.pauseIfHasResult;var g=f&&c.stopIfOnlyHasOneResult;if(g&&u===1){var p=d.get(0);Re(p);ke(p)}else{Le(d,f)}}else if(u===1){e.debug("BarcodeScanner.decodeWithZXingCPP: decode successful");var p=d.get(0);Re(p);ke(p)}else{if(L.getProperty("/scanDialog/barcodeOverlaySetup")){Fe()}setTimeout(Te,0)}}catch(a){e.debug("BarcodeScanner: err1: "+a)}}function Re(e,a,t){t=Object.assign({left:0,top:0,imageScaleRate:1},t);a=a||0;var n=0,r=0,i,o;if(I&&Array.isArray(I._aBarcodeAvatars)){i=I._aBarcodeAvatars[a]}if(i){i.oBarcode=e;o=i.getDomRef()}if(o){if(!L.getProperty("/scanDialog/barcodeOverlaySetup")){L.setProperty("/scanDialog/barcodeOverlaySetup",true)}if(e.position){e.resultPoints=[e.position.topLeft,e.position.topRight,e.position.bottomRight,e.position.bottomLeft]}if(e.resultPoints&&e.resultPoints.length>0){var s=e.resultPoints.length;for(var c=0;c<s;c++){r+=e.resultPoints[c].x;n+=e.resultPoints[c].y}r=r*t.imageScaleRate/s;n=n*t.imageScaleRate/s}if(x&&!x.hidden){r+=t.left;n+=t.top}else if(L.getProperty("/scanDialog/isDecodePaused")){r+=t.left;n+=t.top}else{var l=I.getDomRef().clientWidth/w.videoWidth;var d=I.getDomRef().clientHeight/w.videoHeight;n=n*d;r=r*l}o.style.visibility="visible";o.style.left="calc("+r+"px - 1.5rem)";o.style.top="calc("+n+"px - 1.5rem)"}}function xe(a,t){t=typeof t==="boolean"?t:true;if(t&&(y.os.ios||y.os.macintosh)){setTimeout(function(){e.debug("BarcodeScanner.orientationChangeListener: reposition and resize the dialog on iOS devices first");E._positionDialog();e.debug("BarcodeScanner.orientationChangeListener: call orientationChangeListener again");xe(a,false)},500);return}var n=a.landscape?"landscape":"portrait";e.debug("BarcodeScanner.orientationChangeListener: device orientation changed to "+n);if(_){_.hidden=true}if(x&&x.oImage&&!x.hidden){setTimeout(function(){document.body.style.setProperty("--sapNdcRTCDialogVideoHeight",I.getDomRef().clientHeight+"px");document.body.style.setProperty("--sapNdcRTCDialogVideoWidth",I.getDomRef().clientWidth+"px");he(undefined,true).then(Ze)},500)}else if(L.getProperty("/scanDialog/isDecodePaused")){setTimeout(function(){var e=I.getDomRef().clientWidth,a=I.getDomRef().clientHeight;document.body.style.setProperty("--sapNdcRTCDialogVideoHeight",a+"px");document.body.style.setProperty("--sapNdcRTCDialogVideoWidth",e+"px");var t=false;if(y.os.ios||y.os.macintosh){var n=y.orientation["portrait"]?"portrait":"landscape";var r=L.getProperty("/scanDialog/pausedOrientation");if(n!==r){t=true}}var i=t?w.videoHeight:w.videoWidth,o=t?w.videoWidth:w.videoHeight,s=i,c=o;if(i>e||o>a){if(i/o>e/a){s=e;c=Math.round(e*(o/i))}else{c=a;s=Math.round(a*(i/o))}}var l=(e-s)/2;var d=(a-c)/2;var u=Math.round(s*100/i)/100;var f={left:l,top:d,imageScaleRate:u};Ze(f)},500)}else{E.setBusy(true);Ge(false);setTimeout(function(){document.body.style.setProperty("--sapNdcRTCDialogVideoHeight",I.getDomRef().clientHeight+"px");document.body.style.setProperty("--sapNdcRTCDialogVideoWidth",I.getDomRef().clientWidth+"px");Ce(false)},500)}}function _e(){var e=I.getDomRef().clientHeight,a=I.getDomRef().clientWidth,t=1920,n=1440;if(e>a){n=Math.trunc(1920*a/e)}else{n=Math.trunc(1920*e/a)}return{width:{ideal:t},height:{ideal:n}}}function Oe(e,a){a=a||0;var t;if(I&&Array.isArray(I._aBarcodeAvatars)){t=I._aBarcodeAvatars[a]}if(t){t.removeAllCustomData();t.addCustomData(new P({key:"barcode",value:e}));t.addCustomData(new P({key:"press",value:function(e){ke(e)}}))}}function ke(e){var a=L.getProperty("/callBackHandler/onFnSuccess");if(typeof a==="function"){e.scanningTime="unknown";if(L.getProperty("/scanDialog/scanningStartTime")>0){var t=Date.now();e.scanningTime=t-L.getProperty("/scanDialog/scanningStartTime")}if(L.getProperty("/config/enableGS1Header")){e.text=e.symbologyIdentifier+e.text}if(typeof e.cancelled!=="boolean"){e.cancelled=false}a(e)}C.closeScanDialog()}function Le(e,a,t){var n=e.size();for(var r=0;r<n;r++){var i=e.get(r);Re(i,r,t);Oe(i,r)}if(a){ce(false)}else{setTimeout(Te,0)}}function Fe(){var e=L.getProperty("/apis/ZXingCPP/multiScan");var a=e.enabled?e.maxBarcodeNumber:1;for(var t=0;t<a;t++){Me(t)}}function Me(e){e=e||0;var a,t;if(I&&Array.isArray(I._aBarcodeAvatars)){a=I._aBarcodeAvatars[e]}if(a){a.oBarcode=undefined;t=a.getDomRef()}if(t){t.hidden=true;t.style.visibility="hidden";t.style.top=0;t.style.left=0}}function Ze(e){var a=L.getProperty("/apis/ZXingCPP/multiScan");var t=a.enabled?a.maxBarcodeNumber:1;if(I&&Array.isArray(I._aBarcodeAvatars)){for(var n=0;n<t;n++){var r=I._aBarcodeAvatars[n];if(r&&r.oBarcode){var i=r.getDomRef();if(i&&i.style.visibility==="visible"){Re(r.oBarcode,n,e)}}}}}function Ne(){e.debug("BarcodeScanner.scanFrame: start to set up overlay dom");if(!E||!w||!w.videoHeight||!w.videoWidth){e.debug("BarcodeScanner.scanFrame: scan dialog or video screen is closed, stop set up");return}var a=.15;if(!_&&I){_=I.getDomRef("overlay")}if(_){_.hidden=false;var t=I.getDomRef().clientWidth,n=I.getDomRef().clientHeight;var r=t*(1-2*a);var i=n*(1-2*a);if(r<=i){i=r*(1-2*a)}var o=I.getDomRef("overlay-box");if(o){o.style.width=r+"px";o.style.height=i+"px";_.style.width=t+"px";_.style.height=n+"px"}}}function Ge(e){if(I&&e!==false){I.destroy()}if(A){A.stop();A=undefined}if(D){D=undefined}if(y.support.orientation&&e!==false){y.orientation.detachHandler(xe)}if(w&&w.srcObject){w.srcObject=undefined}}function He(){L.checkUpdate(true);var a=L.getProperty("/apis/ZebraEnterpriseBrowser/enableZebraBarcodeRetryCount");var t=L.getProperty("/apis/ZebraEnterpriseBrowser/enableBarcodeState");if(X()==="ZebraEnterpriseBrowser"&&K("ZebraEnterpriseBrowser")&&t!==true){var n=function(a){if(a["data"]==""||a["time"]==""){var t=L.getProperty("/callBackHandler/onFnFail");if(typeof t==="function"){var n={text:"Zebra Scan failed",resultStatus:"Error"};if(L.getProperty("/callBackHandler/callBackFromSetPhysicalScan")){n=new p("scanFailEvent",new h,n)}t(n)}e.error("BarcodeScanner.zebraEBScanEnable: Zebra Enterprise Browser Scan Failed")}else{e.debug("BarcodeScanner.zebraEBScanEnable: Zebra EB Scan Result: "+a.data+"; Scan Json: "+JSON.stringify(a));var r=L.getProperty("/callBackHandler/onFnSuccess");if(typeof r==="function"){var i="unknown";if(L.getProperty("/scanDialog/scanningStartTime")>0){var o=Date.now();i=o-L.getProperty("/scanDialog/scanningStartTime")}var s={text:a.data,format:a.source,resultStatus:"Success",scanningTime:i,cancelled:false};if(L.getProperty("/callBackHandler/callBackFromSetPhysicalScan")){s=new p("scanSuccessEvent",new h,s)}r(s);L.setProperty("/scanDialog/scanningStartTime",0)}}};if(L.getProperty("/config/enableGS1Header")){EB.Barcode.codeIdType=EB.Barcode.CODEIDTYPE_AIM}else{EB.Barcode.codeIdType=EB.Barcode.CODEIDTYPE_NONE}EB.Barcode.enable({},n);L.setProperty("/apis/ZebraEnterpriseBrowser/enableBarcodeState",true);e.debug("BarcodeScanner.zebraEBScanEnable: try to enable EB Barcode in ("+(6-a)+") times")}else if(a>1&&t==="init"){a--;L.setProperty("/apis/ZebraEnterpriseBrowser/enableZebraBarcodeRetryCount",a);Pe();setTimeout(He,500)}else{e.debug("BarcodeScanner.zebraEBScanEnable: The scanner API is not ZebraEnterpriseBrowser or cannot been enabled.")}}function Xe(){var e=L.getProperty("/scanDialog/keepCameraScan");var a=false;if(K("ZebraEnterpriseBrowser")&&(!e||typeof e!=="boolean")){a=true}return a}function Ue(a){var t=L.getProperty("/apis/BluetoothScanner/");if(a.key==="Unidentified"&&t.replaceGS1Separator){var n=a.keyCode||a.which;var r=String.fromCharCode(n);a.key=r;e.debug("The unidentified oEvent.key is replaced by (keyCode:"+n+"|keyCharacter:"+r)}if(t.resultBuffer.length>5e3){e.error("Key Buffer contains "+t.resultBuffer.length+" characters");var i={resultBuffer:[]};C.enableBluetoothBarcodeScanner(null,i)}else if(L.getProperty("/bReady")&&K("BluetoothScanner")){if(t.scanningMode==="TimeInterval"){We(a,t)}else if(t.scanningMode==="PrefixSuffix"){Ke(a,t)}}L.setProperty("/apis/BluetoothScanner/",t)}function We(a,t){e.debug("The detectScanViaTimeInterval() is calling.");var n={key:a.key,timestamp:Date.now(),deltaTime:Number.MAX_VALUE};var r=n;if(t.resultBuffer[t.resultBuffer.length-1]!==undefined){r=t.resultBuffer[t.resultBuffer.length-1]}n.deltaTime=n.timestamp-r.timestamp;e.debug("jKey.deltaTime: "+n.deltaTime+"; key: "+n.key+"(AltKey:"+a.altKey+";CtrlKey:"+a.ctrlKey+";Which:"+a.which+"); oldLastKey:"+r.key);if(n.deltaTime>t.intervalForDetection){e.debug("jKey(key:"+n.key+").deltaTime("+n.deltaTime+") > "+t.intervalForDetection);if(n.key.length<=t.scanningKeyMaxLength){n.deltaTime=0;t.scanningLastKey=n;e.debug("addKeyToResultBuffer(): the Last key is saved.")}Ye()}else{if(n.key.length<=t.scanningKeyMaxLength){t.resultBuffer.push(n);if(t.replaceGS1Separator){t=je(a,t)}}else if(t.resultBuffer.length>0){t.resultBuffer[t.resultBuffer.length-1].timestamp=n.timestamp}if(t.timeOutForDetection){clearTimeout(t.timeOutForDetection)}e.debug("The waiting time of Bluetooth Scanner Schedule must be more than the intervalForDetection("+t.intervalForDetection+"). The default value is 50 ms and the added value is 20 ms.");t.timeOutForDetection=setTimeout(Ye,t.intervalForDetection+20);if(t.handleFocusedElement&&t.resultBuffer.length<3){qe()}}}function Ke(a,t){e.debug("The detectScanViaPrefixSuffix() is calling.");var n={key:a.key,timestamp:Date.now(),deltaTime:Number.MAX_VALUE};if(n.key.length<=t.scanningKeyMaxLength){if(t.resultBuffer.length>0){if(n.timestamp-t.resultBuffer[0].timestamp>t.maxPrefixSuffixScanningTime){e.debug("detectScanViaPrefixSuffix(): The scan time to long");var r={resultBuffer:[]};C.enableBluetoothBarcodeScanner(null,r)}else if(Ve(n,t)){e.debug("detectScanViaPrefixSuffix(): The suffix("+t.suffix+") is matched.");if(t.handleFocusedElement){e.debug("Stop the event of suffix last character to trigger");a.preventDefault()}Ye()}else{t.resultBuffer.push(n);if(t.replaceGS1Separator){t=je(a,t)}}}else{ze(n,t)}}}function ze(e,a){var t=a.prefixString+e.key;a.prefixFound=false;if(t===a.prefix){e.key=t;if(a.prefixStartDate){e.timestamp=a.prefixStartDate}a.resultBuffer.push(e);a.prefixString="";a.prefixStartDate=null;a.prefixFound=true;if(a.handleFocusedElement){qe()}}else if(a.prefix.indexOf(t)===0){if(a.prefixString.length===0){a.prefixStartDate=e.timestamp}a.prefixString=t}else{a.prefixString="";a.prefixStartDate=null;a.resultBuffer.length=0}return a.prefixFound}function Ve(a,t){var n=t.suffixString+a.key;t.suffixFound=false;if(n===t.suffix){var r=t.resultBuffer.length-t.suffix.length+1;t.resultBuffer.splice(r);t.resultBuffer.splice(0,1);t.suffixString="";t.suffixFound=true;if(t.handleFocusedElement){e.debug("The value of focusedElementInstance:"+t.focusedElementInstance.value);qe()}}else if(n.length<t.suffix.length){t.suffixString=n}else{t.suffixString=n.substr(1)}return t.suffixFound}function je(a,t){e.debug("The replaceGS1Codes() is calling. The GS1 will be replaced by specified characters.");if(a[t.GS1FunctionKey]){var n=t.resultBuffer;var r=t.GS1Code;if(r===undefined||r===null){if(t.GS1FunctionKey==="altKey"){r="0029"}else if(t.GS1FunctionKey==="ctrlKey"){r="]"}}if(t.replaceCharacterBuffer.length===0){t.replaceCharacterBuffer=a.key}else if(t.replaceCharacterBuffer.length>0){if(t.replaceCharacterBuffer.length<r.length){t.replaceCharacterBuffer+=a.key}else{var i=t.replaceCharacterBuffer.length-r.length+1;e.debug("The replaceCharacterBuffer: "+t.replaceCharacterBuffer+"; oStart: "+i+"; oGS1Code: "+r);t.replaceCharacterBuffer=t.replaceCharacterBuffer.slice(i)+a.key;e.debug("The replaceCharacterBuffer is changed to "+t.replaceCharacterBuffer)}}var o=false;if(t.GS1FunctionKey==="altKey"&&t.replaceCharacterBuffer.length>0&&!isNaN(t.replaceCharacterBuffer)&&!isNaN(r)){o=Number(t.replaceCharacterBuffer)===Number(r)}else{o=t.replaceCharacterBuffer===r}if(t.replaceCharacterBuffer.length>0){e.debug("replacementData - Code: "+t.GS1Code+"; Buffer:"+t.replaceCharacterBuffer+"; Function Key:"+t.GS1FunctionKey)}if(o){var s=n[n.length-1];if(t.GS1ReplacementCharacter!==undefined){s.key=t.GS1ReplacementCharacter}else{s.key=String.fromCharCode("29")}var c=t.replaceCharacterBuffer.length;n.splice(n.length-c,c,s);e.debug("replaceGS1Codes(): Replace ("+t.GS1FunctionKey+" + "+t.replaceCharacterBuffer+") by ("+s.key+")");t.replaceCharacterBuffer=""}}else{e.debug("This function key("+t.GS1FunctionKey+") of Event is false.")}return t}function Ye(){var a=L.getProperty("/apis/BluetoothScanner/");e.debug("Call getScannedCharacterFromBuffer(). The length is "+a.resultBuffer.length);var t="";if(a.scanningMode==="TimeInterval"&&a.resultBuffer.length>=a.resultMinLength||a.scanningMode==="PrefixSuffix"&&a.suffixFound){a.resultBuffer.forEach(function(e){t+=e.key});var n=L.getProperty("/callBackHandler/fnBluetoothScan");if(typeof n==="function"){var r=0;if(a.resultBuffer.length>0){r=Date.now()-a.resultBuffer[0].timestamp}r=r>0?r:"unknown";var i={text:t,format:"bluetoothScanner",resultStatus:"Success",scanningTime:r,cancelled:false};i=new p("bluetoothScanSuccessEvent",new h,i);if(a.triggerOneTime){C.disableBluetoothBarcodeScanner()}n(i);L.setProperty("/scanDialog/scanningStartTime",0);e.debug("Result is: "+t)}if(a.handleFocusedElement){qe()}}else{e.debug("The length of input string is less than "+a.resultMinLength)}a.resultBuffer.length=0;a.prefixFound=false;a.suffixFound=false;if(a.focusedElementInstance){e.debug("Value of focusedElementInstance: "+a.focusedElementInstance.value)}if(a.scanningLastKey){a.resultBuffer.push(a.scanningLastKey);e.debug("Re-push the scanningLastKey("+a.scanningLastKey.key+") into the buffer.");a.scanningLastKey=null;if(a.handleFocusedElement){qe()}}else{e.debug("Clear the data of focused element");a.focusedElementValue="";a.focusedElementInstance=""}if(a.timeOutForDetection){clearTimeout(a.timeOutForDetection)}L.setProperty("/apis/BluetoothScanner/",a)}function qe(){var a=jQuery(":focus")[0];var t=L.getProperty("/apis/BluetoothScanner/");e.debug("Calling the focusedElementHandler()");if(a){if(t.scanningMode==="TimeInterval"&&t.resultBuffer.length===2||t.scanningMode==="PrefixSuffix"&&t.suffixFound){e.debug("For the focused element, the focal point will be removed and data will be reset.");t.focusedElementInstance=a;if(jQuery(a).is("input, textarea")){a.value=b.sanitize(t.focusedElementValue);e.debug("This focused element is the input or text area element. The value is "+a.value);if(a.setSelectionRange&&t.focusedElementSelectionStart!==null&&t.focusedElementSelectionEnd!==null){e.debug("Reset the caret of the focused element");a.setSelectionRange(t.focusedElementSelectionStart,t.focusedElementSelectionEnd)}t.focusedElementValue="";t.focusedElementSelectionStart=null;t.focusedElementSelectionEnd=null}jQuery(a).blur()}else if(t.resultBuffer.length===1&&jQuery(a).is("input, textarea")){e.debug("Store the data of focused input or textarea element. ElementValue: "+a.value+"; SelectionStart: "+a.selectionStart+"; SelectionEnd: "+a.selectionEnd);t.focusedElementInstance=a;t.focusedElementValue=b.sanitize(a.value);t.focusedElementSelectionStart=a.selectionStart;t.focusedElementSelectionEnd=a.selectionEnd;if(t.scanningMode==="PrefixSuffix"){e.debug("The scanning mode is PrefixSuffix");var n=t.prefix.substr(0,t.prefix.length-1);var r=a.value.lastIndexOf(n);if(r!==-1){t.focusedElementValue=t.focusedElementValue.substr(0,r)+t.focusedElementValue.substr(r+n.length);t.focusedElementSelectionStart=t.focusedElementSelectionStart-n.length;t.focusedElementSelectionEnd=t.focusedElementSelectionEnd-n.length;e.debug("The focusedElementHandler():prefixStart:"+r+";Value"+a.value+";New Value:"+t.focusedElementValue+";PrefixSub:"+n)}}if(t.scanningLastKey){e.debug("The function focusedElementHandler() will clear the info about the LastKey: "+t.scanningLastKey.key);t.scanningLastKey=null}}}else if(typeof t.focusedElementInstance==="object"){e.debug("Re-focused this element. The value is "+t.focusedElementInstance.value);jQuery(t.focusedElementInstance).focus();t.focusedElementInstance=""}else{e.debug("There is not the focused element.")}L.setProperty("/apis/BluetoothScanner/",t)}function Je(){e.debug("The custom Blur handler is called");if(typeof O==="object"){O.focus();jQuery(O).off("blur",Je)}}C.scan=function(a,t,n,r,i,o,s,c,l){if(!L.getProperty("/bReady")){e.error("BarcodeScanner.scan: Barcode scanning is already in progress.");return}e.debug("BarcodeScanner.scan: start to scan barcode.");L.setProperty("/bReady",false);if(typeof a==="function"){L.setProperty("/callBackHandler/onFnSuccess",a)}else{L.setProperty("/callBackHandler/onFnSuccess",null)}if(typeof t==="function"){L.setProperty("/callBackHandler/onFnFail",t)}else{L.setProperty("/callBackHandler/onFnFail",null)}if(typeof n==="function"){L.setProperty("/scanDialog/onLiveUpdate",n)}else{L.setProperty("/scanDialog/onLiveUpdate",null)}if(typeof r==="string"&&r!=null&&r.trim()!=""){L.setProperty("/scanDialog/title",r)}else{L.setProperty("/scanDialog/title",M.getProperty("BARCODE_DIALOG_TITLE"))}L.setProperty("/scanDialog/scanningStartTime",Date.now());L.setProperty("/config/preferFrontCamera",i);if(L.getProperty("/config/defaultConstraints/video/frameRate")!==undefined){delete L.getProperty("/config/defaultConstraints/video").frameRate}if(typeof o==="number"&&o>0){L.setProperty("/config/defaultConstraints/video/frameRate",o)}else if(typeof o!=="undefined"){f.show(M.getResourceBundle().getText("BARCODE_DIALOG_CAMERA_UPDATE_PARAMETER_ERROR_MSG",["frameRate"]),{duration:1e3})}if(L.getProperty("/config/defaultConstraints/video/zoom")!==undefined){delete L.getProperty("/config/defaultConstraints/video").zoom}if(typeof s==="number"&&s>0){L.setProperty("/config/defaultConstraints/video/zoom",s)}else if(typeof s!=="undefined"){f.show(M.getResourceBundle().getText("BARCODE_DIALOG_CAMERA_UPDATE_PARAMETER_ERROR_MSG",["zoom"]),{duration:1e3})}L.setProperty("/scanDialog/keepCameraScan",c);L.setProperty("/scanDialog/disableBarcodeInputDialog",l);L.checkUpdate(true);if(Xe()){e.debug("BarcodeScanner.scan: Zebra EB is available, use it to scan barcode.");Ee()}else if(K("Cordova")){e.debug("BarcodeScanner.scan: Cordova is available, use it to scan barcode.");Ie()}else{e.debug("BarcodeScanner.scan: both of Zebra EB and Cordova are NOT available, use ZXingCPP to scan barcode.");Ae()}};C.closeScanDialog=function(){if(E){E.close();E.fireAfterClose();L.setProperty("/scanDialog/scanningStartTime",0);L.setProperty("/scanDialog/onLiveUpdate",null);L.setProperty("/scanDialog/isDecodePaused",false)}L.setProperty("/bReady",true);L.checkUpdate(true)};C.getStatusModel=function(){return F};C.getScanAPIInfo=function(){return X()};C.setScanAPIInfo=function(a){if(!a){e.error("BarcodeScanner.setScanAPIInfo: scannerAPI is undefined.");return false}if(X()!==a){var t=L.getProperty("/apis/"+a);if(!t){e.error("BarcodeScanner.scan: The scanner API '"+a+"' doesn't exist, will use current scanner API '"+L.getProperty("/apis/"+X()+"/description")+"' to scan the barcode.");return false}else if(a==="ZXingCPP"){if(z(a)){e.error("BarcodeScanner.scan: The scanner API '"+a+"' is unavailable, will use current scanner API '"+L.getProperty("/apis/"+X()+"/description")+"' to scan the barcode.");return false}else{e.debug("BarcodeScanner.scan: Switch to scanner API '"+a+"' to scan the barcode.");U(a);return true}}else if(!K(a)){e.error("BarcodeScanner.scan: The scanner API '"+a+"' is unavailable, will use current scanner API '"+L.getProperty("/apis/"+X()+"/description")+"' to scan the barcode.");return false}else{e.debug("BarcodeScanner.scan: Switch to scanner API '"+a+"' to scan the barcode.");U(a);return true}}else{e.debug("BarcodeScanner.setScanAPIInfo: '"+a+"' is already current scanner API. It need not to be changed.");return true}};C.setPhysicalScan=function(a){if(typeof a==="function"){L.setProperty("/callBackHandler/callBackFromSetPhysicalScan",true);L.setProperty("/callBackHandler/onFnSuccess",a);L.setProperty("/callBackHandler/onFnFail",a);if(y.os.android){jQuery(document).on("visibilitychange",function(){if(document.visibilityState==="visible"){Pe();He()}})}else{H("ZebraEnterpriseBrowser");e.debug("BarcodeScanner.setPhysicalScan: Not Android device, Zebra Enterprise Browser plugin is unavailable!")}}else{e.debug("setPhysicalScan is failed.")}};C.setConfig=function(a){if(typeof a==="object"&&Object.keys(a).length>0){var t=L.getProperty("/config");for(var n in a){if(n==="multiScan"){if(typeof a.multiScan!=="object"){e.error("The config value for parameter 'multiScan' is not an object, please check!");continue}var r=Object.assign({},L.getProperty("/apis/ZXingCPP/multiScan"),a.multiScan);L.setProperty("/apis/ZXingCPP/multiScan",r);F.setProperty("/apis/ZXingCPP/multiScan",m(r));delete t.multiScan}else if(t.hasOwnProperty(n)){t[n]=a[n];if(Xe()&&n==="enableGS1Header"){L.setProperty("/apis/ZebraEnterpriseBrowser/enableBarcodeState",false);EB.Barcode.disable(He)}if(n==="deviceId"){F.setProperty("/"+n,a[n])}e.debug("The parameter("+n+") has been changed.")}else{e.error("The parameter("+n+") is unavailable.")}}L.setProperty("/config",t);F.checkUpdate()}else{e.error("The options are not available.")}};C.enableBluetoothBarcodeScanner=function(a,t){var n=true;if(typeof a==="function"){L.setProperty("/callBackHandler/fnBluetoothScan",a);jQuery(document).off("keydown",Ue);jQuery(document).on("keydown",Ue);G("BluetoothScanner",true)}else{e.debug("enableBluetoothBarcodeScanner: callback function is not available.");n=false}if(t&&typeof t==="object"&&Object.keys(t).length>0){var r=L.getProperty("/apis/BluetoothScanner");for(var i in t){if(r.hasOwnProperty(i)){e.debug("Clear the temp data about Bluetooth Scanner");r.resultBuffer.length=0;r.scanningLastKey=null;r.focusedElementValue="";r.focusedElementInstance="";r.focusedElementSelectionStart=null;r.focusedElementSelectionEnd=null;r.replaceCharacterBuffer="";r.suffixString="";r.prefixString="";r.prefixStartDate=null;r.prefixFound=false;r.suffixFound=false;if(r.timeOutForDetection){clearTimeout(r.timeOutForDetection)}if(i==="intervalForDetection"||i==="maxPrefixSuffixScanningTime"||i==="resultMinLength"||i==="scanningKeyMaxLength"){if(typeof t[i]==="number"){setTimeout(Ye,0);e.debug("The parameter ("+i+") will be updated.")}else{e.error("The value of "+i+" is not a valid number.");n=false}}r[i]=t[i];e.debug("The parameter("+i+") has been changed.")}else{e.error("The parameter("+i+") is not exist.");n=false}}L.setProperty("/apis/BluetoothScanner/",r)}else{e.debug("enableBluetoothBarcodeScanner: The settings are not available.");n=false}if(self!=top&&L.getProperty("/apis/BluetoothScanner/focusedCurrentWindow")){window.focus();e.debug("Current window is focused for bluetooth scanner.")}return n};C.disableBluetoothBarcodeScanner=function(){jQuery(document).off("keydown",Ue);H("BluetoothScanner",true)};C.setFocusedInstanceId=function(a){var t=false;O=jQuery.sap.byId(a);if(O[0]){t=true;e.debug("The sId has been successful set, and the instance of the focused SAP UI5 element is now available.")}else{O=undefined;e.warning("The sId is not available.")}return t};Se();return C},true);
},
	"sap/ndc/manifest.json":'{"_version":"1.21.0","sap.app":{"id":"sap.ndc","type":"library","embeds":[],"applicationVersion":{"version":"1.141.1"},"title":"SAPUI5 library with controls with native device capabilities.","description":"SAPUI5 library with controls with native device capabilities.","ach":"MOB-SDK-UI5","resources":"resources.json","offline":true,"openSourceComponents":[{"name":"zxing-cpp/zxing-cpp","packagedWithMySelf":true,"version":"2.3.0"}]},"sap.ui":{"technology":"UI5","supportedThemes":[]},"sap.ui5":{"dependencies":{"minUI5Version":"1.141","libs":{"sap.ui.core":{"minVersion":"1.141.1"},"sap.m":{"minVersion":"1.141.1"}}},"library":{"i18n":{"bundleUrl":"messagebundle.properties","supportedLocales":["","ar","bg","ca","cnr","cs","cy","da","de","el","en","en-GB","en-US-sappsd","en-US-saprigi","en-US-saptrc","es","es-MX","et","fi","fr","fr-CA","hi","hr","hu","id","it","iw","ja","kk","ko","lt","lv","mk","ms","nl","no","pl","pt","pt-PT","ro","ru","sh","sk","sl","sr","sv","th","tr","uk","vi","zh-CN","zh-TW"]},"css":false,"content":{"controls":["sap.ndc.BarcodeScannerButton","sap.ndc.BarcodeScannerUIContainer"],"elements":[],"types":[],"interfaces":[]}}}}'
});
//# sourceMappingURL=library-preload.js.map
