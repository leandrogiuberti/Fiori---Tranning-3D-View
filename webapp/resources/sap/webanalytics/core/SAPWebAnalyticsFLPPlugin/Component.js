/*!
 * SAPUI5

		(c) Copyright 2009-2020 SAP SE. All rights reserved
	
 */
sap.ui.define(["sap/ui/core/Component","sap/ui/model/resource/ResourceModel","sap/ui/thirdparty/jquery"],function(e,n,jQuery){"use strict";var a=e.extend("sap.webanalytics.core.SAPWebAnalyticsFLPPlugin.Component",{metadata:{manifest:"json",i18n:"./i18n/i18n.properties",includes:["./css/style.css"]},init:function(){var e=this.getComponentData().config;var a="",t="",i="",s="",o="",r="",w="",d="",l="";a=e.SWA_PUB_TOKEN;t=e.SWA_BASE_URL;s=e.ANON_TRK_ON_DENY;o=e.SWA_CONSENT_LANGUAGE;r=e.SWA_CONSENT_STYLE;w=e.SWA_PRIVACY_LINK;d=e.SWA_APP_NAME;l=e.COOKIE_STATEMENT;if(e.SWA_USER==="true")i=sap.ushell.Container.getUser().getEmail();if(a!==""&&t!==""){var u=[a,t,i,s,o,r,w,d,l];this.setModel(new n({bundleName:"sap.webanalytics.core.SAPWebAnalyticsFLPPlugin.i18n.i18n"}),"i18n");this.loadSWAObject(u);this.loadConsentTextOnDemand();this._subscribeEvents();this.loadWebGUI()}},_subscribeEvents:function(){sap.ui.getCore().getEventBus().subscribe("sap.ushell","appOpened",this.appOpened,this)},appOpened:function(e,n,a){if(a.navigationMode=="newWindow"){window.swa.pageTitle=a.text}window.swa.trackLoad();window.swa.pageTitle=""},loadConsentTextOnDemand:function(){var e=this;var n=this._getRenderer();var a={title:e.getModel("i18n").getProperty("CUSTOM_CONSENT_OPTION"),icon:"sap-icon://approvals",value:function(){return jQuery.Deferred().resolve("")},content:function(){var n=e.createContent(window.swa.isConsentBannerEnabled());return jQuery.Deferred().resolve(n)},onSave:function(){if(window.swa.isConsentBannerEnabled()){if(window.swaConsentDecision===undefined)window.swaConsentDecision=window.sap.ui.getCore().getControl("swaConsentCheckBox").getSelected();if(window.swa.anonymousTrackingConsent&&window.swaConsentDecision){window.swa.saveConsentDecision(true)}else if(!window.swaConsentDecision&&window.swa.anonymousTrackingConsent){window.swa.saveConsentDecision(false)}else if(!window.swa.anonymousTrackingConsent&&window.swaConsentDecision&&!window.swa.getTrackingStatus()){window.swa.saveConsentDecision(true)}else if(!window.swa.anonymousTrackingConsent&&!window.swaConsentDecision&&window.swa.getTrackingStatus()){window.swa.saveConsentDecision(false)}}return jQuery.Deferred().resolve("")},onCancel:function(){if(window.swa.isConsentBannerEnabled()){if(window.swa.getTrackingStatus()===true)sap.ui.getCore().getControl("swaConsentCheckBox").setSelected(true);else sap.ui.getCore().getControl("swaConsentCheckBox").setSelected(false)}}};n.then(function(e){e.addUserPreferencesEntry(a)},true,false,[sap.ushell.renderers.fiori2.RendererExtensions.LaunchpadState.Home])},createContent:function(e){var n=new sap.m.Page("swaConsent",{content:"",showHeader:false});if(!e){var a=new sap.m.HBox("status",{});var t=new sap.m.Label("trackStatus",{text:window.swa.trackingStatusText});t.addStyleClass("statusLabel");a.addItem(t);var i=window.swa.getTrackingStatus()===false?window.swa.trackOffStatus:window.swa.getTrackingStatus()===true?window.swa.trackOnStatus:window.swa.trackAnonymousStatus;var s=new sap.m.Text("swaStatusText",{text:i});s.addStyleClass("trackStatus");a.addItem(s);n.addContent(a)}else{var o=window.swa.anonymousTrackingConsent?window.swa.anonymousConsentText:window.swa.consentOptInText;var r="";var w="";if(window.swa.appName!==null&&window.swa.appName!==undefined&&window.swa.appName!==""){r=window.swa.appBannerSuffixText!=null&&window.swa.appBannerSuffixText!=undefined?window.swa.appBannerSuffixText.replace("{appName}",window.swa.appName):"";if(window.swa.privacyLink===null||window.swa.privacyLink===""||window.swa.privacyLink===undefined){r=r.replace("{privacyLink}","")}else{r=r.replace("{privacyLink}",window.swa.privacyLinkText)}if(window.swa.cookieStatementLink!==null&&window.swa.cookieStatementLink!==undefined)w=window.swa.appBannerPrefixText.replace("{cookieStatementLink}"," <a href="+window.swa.cookieStatementLink+">"+window.swa.cookieStatementText+"</a>");if(window.swa.anonymousTrackingConsent)o=window.swa.appBannerPrefixText!=null&&window.swa.appBannerPrefixText!=undefined?w.replace("{appName}",window.swa.appName)+window.swa.appBannerOptinAnonymisedtext+r.replace("{appName}",window.swa.appName):"";else o=window.swa.appBannerPrefixText!=null&&window.swa.appBannerPrefixText!=undefined?w.replace("{appName}",window.swa.appName)+window.swa.appBannerOptInText.replace("{appName}",window.swa.appName)+" "+r.replace("{appName}",window.swa.appName):""}if(o.indexOf("<a")!==-1)o=o.substring(0,o.indexOf("<a")-1);var d=new sap.m.Text("swaConsentOptInOutText",{text:o});n.addContent(d);d.addStyleClass("text");if(window.swa.privacyLink!==null){var l=new sap.m.Link("swaPrivacyLink",{href:window.swa.privacyLink,target:"_blank",text:window.swa.privacyLinkText});l.addStyleClass("link");n.addContent(l)}var u=new sap.m.CheckBox("swaConsentCheckBox",{text:window.swa.consentAllowButton,select:this.onConsentChange,selected:window.swa.getTrackingStatus()===true?true:false});u.addStyleClass("checkBox");n.addContent(u)}return n},onConsentChange:function(e){window.swaConsentDecision=e.getSource().getSelected()?true:false},_getRenderer:function(){var e=this,n=new jQuery.Deferred,a;e._oShellContainer=jQuery.sap.getObject("sap.ushell.Container");if(!e._oShellContainer){n.reject("Illegal state: shell container not available; this component must be executed in a unified shell runtime context.")}else{a=e._oShellContainer.getRenderer();if(a){n.resolve(a)}else{e._onRendererCreated=function(e){a=e.getParameter("renderer");if(a){n.resolve(a)}else{n.reject("Illegal state: shell renderer not available after recieving 'rendererLoaded' event.")}};e._oShellContainer.attachRendererCreatedEvent(e._onRendererCreated)}}return n.promise()},loadSWAObject:function(e){window.swa={pubToken:e[0],baseUrl:e[1],subSiteId:this.setSubSiteId,owner:e[2],anonymousTrackingConsent:e[3]==="true"?1:0,custom1:{ref:this.getCustomAttributes(e[2])[0]},custom2:{ref:this.getCustomAttributes(e[2])[1]},custom3:{ref:this.getCustomAttributes(e[2])[2]},custom4:{ref:this.getCustomAttributes(e[2])[3]},custom5:{ref:this.getCustomAttributes(e[2])[4]},dataAnonymiseCallback:this.anonymiseCallBack};if(e[4]!==""&&e[4]!==undefined)window.swa.consentFormLanguage=e[4];if(e[5]!==""&&e[5]!==undefined)window.swa.consentStyle=e[5];if(e[6]!==""&&e[6]!==undefined)window.swa.privacyLink=e[6];if(e[7]!==""&&e[7]!==undefined)window.swa.appName=e[7];window.swa.cookieStatementLink=e[8];window.swa.disableRouteMatched=true;var n=document,a=n.createElement("script"),t=n.getElementsByTagName("script")[0];a.type="text/javascript";a.defer=true;a.async=true;a.src=sap.ui.require.toUrl("sap/webanalytics/core/tracker/js/track.js");t.parentNode.insertBefore(a,t);window.onhashchange=function(){var e=window.location.hash;var n=e.toLowerCase();var a=n.indexOf("shell-home")>=0||n.indexOf("launchpad-openflppage")>=0||n.indexOf("shell-appfinder")>=0;if(a){if(n.indexOf("shell-appfinder")>=0)window.swa.pageTitle="App Finder";window.swa.trackLoad();window.swa.pageTitle=""}}},anonymiseCallBack:function(){var e={};if(window.swa.pageTitle!=undefined&&window.swa.pageTitle!="")e.pageTitle=window.swa.pageTitle;return e},getCustomAttributes:function(e){var n=[];if(typeof sap!=="undefined"){if(e!=="")n[0]=sap.ushell.Container.getUser().getId();else n[0]="";n[1]=sap.ushell.Container.getLogonSystem().getClient();n[2]=sap.ushell.Container.getLogonSystem().getName();n[3]=sap.ushell.services.AppConfiguration.getCurrentApplication()!==null?sap.ushell.services.AppConfiguration.getCurrentApplication().inboundPermanentKey:"";n[4]=sap.ushell.services.AppConfiguration.getCurrentApplication()!==null?sap.ushell.services.AppConfiguration.getCurrentApplication().ui5ComponentName:""}return n},loadWebGUI:function(){var e=sap.ui.require.toUrl("sap/webanalytics/core/tracker/js/track.js");if(window.addEventListener){window.addEventListener("message",function(n){var a=JSON.parse(n.data);if(a.service==="sap.its.readyToListen"&&a.type==="announce"){var t=escape(window.parent.document.cookie);var i={type:"request",service:"sap.its.trackSWA",pubToken:window.swa.pubToken,owner:window.swa.owner,baseUrl:window.swa.baseUrl,trackAnonymous:window.swa.anonymousTrackingConsent,message:"Response from SWA",isConsentGiven:true,cookieVal:t,trackingResourceUrl:e};n.source.postMessage(JSON.stringify(i),n.origin)}})}},setSubSiteId:function(){var e="";if(window.location.href.substring(window.location.href.indexOf("#"))!==-1){e=window.location.href.substring(window.location.href.indexOf("#")+1)}if(e.indexOf("&")!==-1){e=e.substring(0,e.indexOf("&"))}return e!==""?e:undefined}});return a});
//# sourceMappingURL=Component.js.map