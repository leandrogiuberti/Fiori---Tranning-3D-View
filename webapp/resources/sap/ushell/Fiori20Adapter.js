// Copyright (c) 2009-2025 SAP SE, All Rights Reserved
sap.ui.define(["sap/ui/base/Object","sap/ui/core/Component","sap/ui/core/UIComponent","sap/ui/core/ComponentHooks","sap/ui/model/resource/ResourceModel","sap/m/Fiori20Adapter","sap/ui/thirdparty/hasher","sap/base/util/extend","sap/ushell/utils/CallbackQueue"],(e,t,i,n,o,r,s,a,c)=>{"use strict";n.onUIComponentInstanceDestroy.register(e=>{if(e._fioriAdapter){e._fioriAdapter.destroy()}if(e._oShellUIService){e._oShellUIService.destroy()}});const h=e.extend("AppInfo",{constructor:function(t){e.call(this);this._oComponent=t},getDefaultTitle:async function(){const e=this._oComponent.getManifestEntry("sap.app");if(e&&e.title){const t=e.title;if(this._isLocalizationKey(t)){const i=e.i18n||"i18n/i18n.properties";return this._getLocalized(t,i)}return t}const t=this._oComponent.getManifestEntry("sap.ui5");if(t?.config?.resourceBundle&&t.config.titleResource){const e=t.config.titleResource;const i=t.config.resourceBundle;return this._getLocalized(e,i)}},_getLocalized:async function(e,t){const i=new o({async:true,bundleUrl:`${sap.ui.require.toUrl(this._oComponent.getMetadata().getComponentName())}/${t}`});const n=await i.getResourceBundle();return n.getText(e.replace(/^{{/,"").replace(/}}$/,""))},_isLocalizationKey:function(e){return e.indexOf("{{")===0&&e.indexOf("}}")>0}});const l=e.extend("HeaderInfo",{constructor:function(t,i,n){e.call(this);this._oConfig=i;this._oAppInfo=n;this._oShellUIService=t._oShellUIService;this._aHierarchy=[];this._pInit=this._oAppInfo.getDefaultTitle().then(e=>{this._sDefaultTitle=e})},registerView:async function(e,t){if(this._oConfig.bMoveTitle===true){if(!e.oTitleInfo&&e.oSubTitleInfo){e.oTitleInfo=e.oSubTitleInfo}this._oCurrentViewInfo=e;const i=e.oTitleInfo?e.oTitleInfo.text:undefined;if(i!==this._oShellUIService.getTitle()){try{this._oShellUIService.setTitle(i)}catch{}}await this._updateHierarchy(e,t)}this._setBackNavigation(e.oBackButton,e.oAdaptOptions)},_setBackNavigation:function(e,t){if(t&&t.bHideBackButton===false){return}let i;if(e){i=e.firePress.bind(e)}this._oShellUIService.setBackNavigation(i)},_updateHierarchy:async function(e,t){if(this._oConfig.bHierarchy===false){return}await this._pInit;if(!e){return}let i=true;for(let n=this._aHierarchy.length-1;n>=0;n--){let o=this._aHierarchy[n];const r=o.id===e.sViewId;const s=o.intent===t;if(r||s){i=false;o=this._updateHierarchyEntry(o,e);this._aHierarchy[n]=o;this._aHierarchy=this._aHierarchy.slice(0,n+1);if(r){o.intent=t}break}}if(i){const i=this._createHierarchyEntry(e,t);this._aHierarchy.push(i)}const n=[];for(let e=this._aHierarchy.length-2;e>=0;e--){n.push(this._aHierarchy[e])}try{this._oShellUIService.setHierarchy(this._deleteUndefinedProperties(n))}catch{}},_createHierarchyEntry:function(e,t){return{id:e.sViewId,title:e.oTitleInfo?e.oTitleInfo.text:this._sDefaultTitle,subtitle:e.oSubTitleInfo?e.oSubTitleInfo.text:undefined,intent:t}},_updateHierarchyEntry:function(e,t){e.id=t.sViewId;e.title=t.oTitleInfo?t.oTitleInfo.text:this._sDefaultTitle;e.subtitle=t.oSubTitleInfo?t.oSubTitleInfo.text:undefined;return e},_deleteUndefinedProperties:function(e){e.forEach(e=>{for(const t in e){if(e.hasOwnProperty(t)&&!e[t]&&t!=="title"){delete e[t]}}});return e}});const f=e.extend("sap.ushell.Fiori20Adapter",{constructor:function(t,i){e.call(this);this._oComponent=t;this._oConfig=i;this._oHeaderInfo=new l(t,i,new h(t));if(r){r.attachViewChange(this._onViewChange,this)}this._oViewChangeQueue=new c},init:function(){if(!r){return}const e=a({},this._oConfig);r.traverse(this._oComponent.getAggregation("rootControl"),e)},destroy:function(){if(r){r.detachViewChange(this._onViewChange,this)}},_onViewChange:async function(e){const t=`#${s.getHash()}`;await this._oViewChangeQueue.push(async()=>{await this._oHeaderInfo.registerView(e.getParameters(),t)})}});f.applyTo=function(e,n,o,r){let s=e instanceof i?e:t.getOwnerComponentFor(e);if(!s){s=n}if(!s){return}s._oShellUIService=r;if(!s._fioriAdapter){s._fioriAdapter=new f(s,o);s._fioriAdapter.init()}};return f});
//# sourceMappingURL=Fiori20Adapter.js.map