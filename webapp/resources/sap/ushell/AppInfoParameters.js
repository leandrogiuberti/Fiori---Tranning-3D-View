// Copyright (c) 2009-2025 SAP SE, All Rights Reserved
sap.ui.define(["sap/base/Log","sap/ushell/services/AppConfiguration","sap/ui/thirdparty/hasher","sap/base/util/deepClone","sap/base/util/isPlainObject","sap/base/util/restricted/_curry","sap/base/util/restricted/_zipObject","sap/ui/VersionInfo","sap/ushell/Container"],(t,e,r,a,n,i,s,o,p)=>{"use strict";const u="LAUNCHPAD";const c=["productName","theme","appIntent","url"];const l=["productName","theme","languageTag","appIntent","technicalAppComponentId","appId","appVersion","appSupportInfo","appFrameworkVersion","appFrameworkId","title","applicationParams","shellFrameworkVersion","url","abap.transaction"];class h{#t={theme:this.#e.bind(this,"User.env.sap-theme-NWBC"),languageTag:this.#e.bind(this,"User.env.sap-languagebcp47"),appIntent:this.#r.bind(this),appFrameworkId:this.#a.bind(this),appFrameworkVersion:this.#n.bind(this),appSupportInfo:this.#i.bind(this),technicalAppComponentId:this.#s.bind(this),appId:this.#o.bind(this),appVersion:this.#p.bind(this),productName:i(this.#u.bind(this))("productName"),applicationParams:this.#c.bind(this),url:this.#l.bind(this),"abap.transaction":this.#h.bind(this)};#m={};#f={};#d(t){let e=t.applicationType;if(e==="TR"){e="GUI"}return e}#g(){return e.getCurrentApplication()?.appCapabilities||{}}async#n(e){const r=this.#d(e);if(r==="UI5"){try{const t=await o.load();return`${t.version||""} (${t.buildTimestamp||""})`||""}catch(e){t.error("VersionInfo could not be loaded",e)}}}async#p(t){const e=t.componentInstance;if(e){const t=e.getManifestEntry("/sap.app/applicationVersion/version");return t}}async#i(t){const[e]=await t.getTechnicalParameter("sap-ach")||[];if(e){return e}return this.#g().appSupportInfo}async#s(t){const r=this.#d(t);const a=e.getMetadata();if(r==="UI5"){const e=t.componentInstance;if(e){let t=e.getManifestEntry("/sap.ui5/componentName");if(!t){t=e.getMetadata().getComponentName()}return t}return a.technicalName}if(r==="URL"){const t=e.getCurrentApplication();if(t.appCapabilities.technicalAppComponentId){return t.appCapabilities.technicalAppComponentId}}if(r==="GUI"){return(a.technicalName||"").replace(/ .*/,"").replace(/^\*/,"")}if(r==="WDA"||r==="NWBC"){return a.technicalName}}async#o(t){const[e]=await t.getTechnicalParameter("sap-fiori-id")||[];if(t.homePage){if(e){if(e!==""){return`${u} (${e})`}return u}return u}else if(e){return e}return this.#g().appId||t.inboundPermanentKey}async#e(t){const e=await p.getServiceAsync("ReferenceResolver");const r=await e.resolveReferences([t]);return r[t]}async#a(t){const r=e.getCurrentApplication();let a=this.#d(t);if(a==="URL"){a=r.appCapabilities&&r.appCapabilities.appFrameworkId}const n={NWBC:"WDA",TR:"GUI"};return n[a]||a}async#u(t,e){const r=await e.getSystemContext();return r.getProperty(t)}async#r(){const t=r.getHash();if(!t){throw new Error("Could not identify current application hash")}return t}async#c(t,e){let r={};if(e?.getCurrentAppTargetResolution?.().extendedInfo){r=e.getCurrentAppTargetResolution().extendedInfo.appParams}return r}async getAllAppInfo(t,e,r,a){const n={};const i=Object.keys(this.#t);const s=Object.keys(this.#m);const o=Array.from(new Set([...i,...s]));try{const r=await this.#A(o,e,a);for(const e in r){if(t){n[e]=r[e]}else{n[e]={value:r[e]}}}}catch{}const p=Object.keys(this.#f);try{const r=await this.#A(p,e,a);for(const e in r){if(t){n[e]=r[e].value}else{n[e]=r[e]}}}catch{}return n}async getInfo(t,e,r){if(!e){throw new Error("Parameter application missing")}return this.#A(["appFrameworkId"],e,r).then(()=>this.#A(t,e,r))}async#A(e,r,a){const n=e.map(async e=>{if(l.includes(e)){if(Object.hasOwn(this.#m,e)){return this.#m[e]}if(Object.hasOwn(this.#t,e)){return this.#t[e](r,a)}t.error(`value for parameter '${e}' is not set.`);return}if(Object.hasOwn(this.#f,e)){if(true){const t=this.#f[e];if(t.migrated){return t.value}}return this.#f[e]}if(e.includes(".")){return this.#u(e,r,a)}t.error(`'${e}' is not a valid app info parameter`)});return Promise.allSettled(n).then(t=>{for(let e=0;e<t.length;e++){if(t[e].status==="fulfilled"){t[e]=t[e].value}else{t[e]=undefined}}return s(e,t)})}setCustomAttributes(e){if(e===undefined||Object.keys(e).length===0){this.flush();return}let r=a(e);if(r.info&&Object.keys(r).length===1){t.error("The old interface for setting custom attributes is deprecated and will be removed in future.");r=r.info}const i={};for(const e in r){if(e==="customProperties"){continue}if(c.includes(e)){t.error(`Attribute '${e}' is restricted and will be ignored.`);continue}if(!l.includes(e)){if(true){t.error(`Attribute '${e}' is not supported and will be moved to customProperties instead. This migration will be removed in future.`);i[e]={value:r[e],showInAbout:false,migrated:true};continue}t.error(`Attribute '${e}' is not supported and will be ignored. It should be moved to the customProperties instead.`);continue}const a=r[e];if(typeof a!=="string"){t.error(`Attribute value for '${e}' is not a string and will be ignored.`);continue}this.#m[e]=a}const s={...i,...r.customProperties};for(const e in s){let r=s[e];if(l.includes(e)){this.#m[e]=r;continue}if(!n(r)){t.error(`Custom attribute '${e}' does not have the correct format. This property will be ignored in future.`);r={value:r,showInAbout:false,migrated:true}}if(!this.#b(e,r)){continue}this.#f[e]=r}}#b(e,r){if(!n(r)){t.error(`Custom attribute '${e}' does not have the correct format and will be ignored.`);return false}if(r.showInAbout===false){return true}r.showInAbout=true;if(!r.label){t.error(`Custom attribute '${e}' has no label and will be ignored.`);return false}return true}#l(){return p.getFLPUrl(true)}#h(t,e){return e?.getCurrentAppTargetResolution?.().appInfo?.["abap.transaction"]}store(t={}){t.appInfoParameters={appParameters:a(this.#m),customAppParameters:a(this.#f)}}restore(t={}){const{appParameters:e,customAppParameters:r}=t.appInfoParameters||{};this.#m=e?a(e):{};this.#f=r?a(r):{}}flush(){this.#m={};this.#f={}}}return new h},false);
//# sourceMappingURL=AppInfoParameters.js.map