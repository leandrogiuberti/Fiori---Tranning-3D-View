// Copyright (c) 2009-2025 SAP SE, All Rights Reserved
function _migrateV2ServiceConfig(e){"use strict";const t=sap.ui.require("sap/base/util/ObjectPath");[{from:"services.Bookmark",to:"services.BookmarkV2"},{from:"services.CrossApplicationNavigation",to:"services.Navigation"},{from:"services.Notifications",to:"services.NotificationsV2"},{from:"services.Personalization",to:"services.PersonalizationV2"},{from:"services.LaunchPage",to:"services.FlpLaunchPage"},{from:"services.ShellNavigation",to:"services.ShellNavigationInternal"},{from:"services.NavTargetResolution",to:"services.NavTargetResolutionInternal"}].forEach(s=>{const i=s.from.split(".")[1];const a=t.get(s.from,e);const n=t.get(s.to,e);if(a&&!n){const n={...a};if(n.module===`sap.ushell.services.${i}`){delete n.module}t.set(s.to,n,e)}})}function prepareUshellConfig(){"use strict";const e=sap.ui.require("sap/base/util/ObjectPath");let t={};const s=document.querySelector("meta[name='sap.ushellConfig.ui5appruntime']");if(s){t=JSON.parse(s.content)}const i=new URLSearchParams(window.location.search);if(i.has("sap-spaces")&&i.get("sap-spaces")==="true"){e.set("ushell.spaces.enabled",true,t)}if(i.has("sap-personalization")&&i.get("sap-personalization")==="false"){e.set("renderers.fiori2.componentData.config.enablePersonalization",false,t)}window["sap-ushell-config"]=t;_migrateV2ServiceConfig(window["sap-ushell-config"])}function prepareModules(){"use strict";sap.ui.require(["sap/ui/core/BusyIndicator"],e=>{try{if(apprtBIdiv){document.body.classList.remove("apprtBIbg");apprtBIdiv.parentNode.removeChild(apprtBIdiv);apprtBIstyle.parentNode.removeChild(apprtBIstyle)}e.show(0)}catch{e.show(0)}});if(document.URL.indexOf("ui5appruntime")>0){sap.ui.define("sap/ushell/URLTemplateProcessor",[],()=>({}));sap.ui.define("sap/ushell/ApplicationType/wdaResolution",[],()=>({}));sap.ui.define("sap/ushell/ApplicationType/guiResolution",[],()=>({}));if(document.URL.indexOf("sap-ui-app-id=")>0){sap.ui.define("sap/ushell/ApplicationType",[],()=>({URL:{type:"URL"},WDA:{type:"WDA"},TR:{type:"TR"},NWBC:{type:"NWBC"},WCF:{type:"WCF"},SAPUI5:{type:"SAPUI5"}}))}sap.ui.define("sap/ushell/components/applicationIntegration/AppLifeCycle",[],()=>({}));sap.ui.define("sap/ushell/appIntegration/AppLifeCycle",[],()=>({}));sap.ui.define("sap/ushell/services/appstate/WindowAdapter",[],()=>function(){});sap.ui.define("sap/ushell/services/appstate/SequentializingAdapter",[],()=>function(){});sap.ui.define("sap/ushell/services/appstate/Sequentializer",[],()=>function(){});sap.ui.define("sap/ushell/services/Configuration",[],()=>{function e(){this.attachSizeBehaviorUpdate=function(){};this.hasNoAdapter=true}e.hasNoAdapter=true;return e});sap.ui.define("sap/ushell/services/PluginManager/Extensions",[],()=>function(){});sap.ui.define("sap/ushell/services/MessageBroker/MessageBrokerEngine",[],()=>function(){});sap.ui.define("sap/ushell/bootstrap/common/common.load.core-min",[],()=>({loaded:false,load:function(e){}}))}}prepareUshellConfig();prepareModules();sap.ui.define(["sap/base/i18n/Formatting","sap/base/i18n/Localization","sap/base/Log","sap/base/util/ObjectPath","sap/base/util/deepExtend","sap/base/util/isEmptyObject","sap/m/library","sap/ui/core/BusyIndicator","sap/ui/core/ComponentContainer","sap/ui/core/Lib","sap/ui/core/routing/History","sap/ui/thirdparty/hasher","sap/ui/thirdparty/jquery","sap/ui/thirdparty/URI","sap/ushell/appRuntime/ui5/AppCommunicationMgr","sap/ushell/appRuntime/ui5/performance/FesrEnhancer","sap/ushell/appRuntime/ui5/renderers/fiori2/AccessKeysAgent","sap/ushell/appRuntime/ui5/services/AppConfiguration","sap/ushell/appRuntime/ui5/services/AppLifeCycleAgent","sap/ushell/appRuntime/ui5/services/ShellUIService","sap/ushell/appRuntime/ui5/SessionHandlerAgent","sap/ushell/EventHub","sap/ushell/iconfonts","sap/ushell/UI5ComponentType","sap/ushell/ui5service/UserStatus","sap/ushell/utils/UrlParsing","sap/ushell/utils/WindowUtils","sap/ushell/appRuntime/ui5/AppRuntimeContext","sap/ushell/renderer/utils","sap/ushell/appRuntime/ui5/renderers/fiori2/Renderer"],(e,t,s,i,a,n,p,r,o,l,u,c,jQuery,h,d,m,f,g,y,v,R,A,C,b,I,P,S,U,w,L)=>{"use strict";const H=p.URLHelper;m.init();let F;let N;const T=(new h).search(true);let E=false;let k;let D=false;let M=false;let O=false;let B=false;let _;function x(){return{services:{CrossApplicationNavigation:{module:"sap.ushell.appRuntime.ui5.services.CrossApplicationNavigation",adapter:{module:"sap.ushell.appRuntime.ui5.services.adapters.EmptyAdapter"}},Navigation:{module:"sap.ushell.appRuntime.ui5.services.Navigation",adapter:{module:"sap.ushell.appRuntime.ui5.services.adapters.EmptyAdapter"}},NavTargetResolution:{module:"sap.ushell.appRuntime.ui5.services.NavTargetResolution",adapter:{module:"sap.ushell.appRuntime.ui5.services.adapters.EmptyAdapter"}},NavTargetResolutionInternal:{module:"sap.ushell.appRuntime.ui5.services.NavTargetResolutionInternal",adapter:{module:"sap.ushell.appRuntime.ui5.services.adapters.EmptyAdapter"}},ShellNavigation:{module:"sap.ushell.appRuntime.ui5.services.ShellNavigation",adapter:{module:"sap.ushell.appRuntime.ui5.services.adapters.EmptyAdapter"}},ShellNavigationInternal:{module:"sap.ushell.appRuntime.ui5.services.ShellNavigationInternal",adapter:{module:"sap.ushell.appRuntime.ui5.services.adapters.EmptyAdapter"}},ClientSideTargetResolution:{adapter:{module:"sap.ushell.appRuntime.ui5.services.adapters.EmptyAdapter"}},AppConfiguration:{module:"sap.ushell.appRuntime.ui5.services.AppConfiguration"},Bookmark:{module:"sap.ushell.appRuntime.ui5.services.Bookmark",adapter:{module:"sap.ushell.appRuntime.ui5.services.adapters.EmptyAdapter"}},BookmarkV2:{module:"sap.ushell.appRuntime.ui5.services.BookmarkV2",adapter:{module:"sap.ushell.appRuntime.ui5.services.adapters.EmptyAdapter"}},Extension:{module:"sap.ushell.appRuntime.ui5.services.Extension"},FrameBoundExtension:{module:"sap.ushell.appRuntime.ui5.services.FrameBoundExtension"},LaunchPage:{module:"sap.ushell.appRuntime.ui5.services.LaunchPage",adapter:{module:"sap.ushell.appRuntime.ui5.services.adapters.EmptyAdapter"}},FlpLaunchPage:{module:"sap.ushell.appRuntime.ui5.services.FlpLaunchPage"},UserInfo:{module:"sap.ushell.appRuntime.ui5.services.UserInfo",adapter:{module:"sap.ushell.appRuntime.ui5.services.adapters.EmptyAdapter"}},UserDefaultParameters:{module:"sap.ushell.appRuntime.ui5.services.UserDefaultParameters",adapter:{module:"sap.ushell.appRuntime.ui5.services.adapters.EmptyAdapter"}},AppState:{module:"sap.ushell.appRuntime.ui5.services.AppState",adapter:{module:"sap.ushell.appRuntime.ui5.services.adapters.EmptyAdapter"}},AppLifeCycle:{module:"sap.ushell.appRuntime.ui5.services.AppLifeCycle",adapter:{module:"sap.ushell.appRuntime.ui5.services.adapters.EmptyAdapter"}},PluginManager:{config:{isBlueBox:true}},CommonDataModel:{module:"sap.ushell.appRuntime.ui5.services.CommonDataModel",adapter:{module:"sap.ushell.appRuntime.ui5.services.adapters.EmptyAdapter"}},ReferenceResolver:{module:"sap.ushell.appRuntime.ui5.services.ReferenceResolver"},MessageBroker:{module:"sap.ushell.appRuntime.ui5.services.MessageBroker"},Ui5ComponentLoader:{config:{loadDefaultDependencies:false}},Container:{adapter:{config:{userProfile:{defaults:{setThemePermitted:true}}}}}},ushell:{customPreload:{enabled:false}}}}function W(){this.main=function(){let e=Promise.resolve();const t=F._getURI();jQuery("body").css("height","100%").css("width","100%");d.init(true);this.getPageConfig(t);F.setModulePaths();const i=F.loadAdditionalLibs();if(t.hasOwnProperty("sap-remote-intent")){e=d.postMessageToFLP("sap.ushell.services.UserInfo.getLocaleData",undefined,undefined,3e3,{})}U.setAppLifeCycleAgent(y);y.expandSapIntentParams(F._getURI()).then(t=>{let a;let n;if(t.hasOwnProperty("sap-remote-intent")===true){U.setIsScube(true);n=t["sap-remote-intent"];if(n===undefined){s.error("Application cannot be opened. 'sAppIntent' is undefined")}U.setRemoteSystemId(t["sap-remote-system"]);F.adjustIframeURL()}else{a=t["sap-ui-app-id"]}F.init();const p=new Promise(e=>{sap.ui.require(["sap/ushell/appRuntime/ui5/services/UserInfo"],e)});i.push(F.initServicesContainer());Promise.all(i).then(()=>{F.initPostMessages();if(U.getIsScube()===true){N.getServiceAsync("CommonDataModel")}Promise.all([F.getAppInfo(a,n),p,e]).then(e=>{const s=e[0].oResolvedHashFragment;const i=e[0].oParsedHash;const p=e[2]||{};F._setUI5LocaleAttributes(p);R.init();f.init();F._setInitialAppRoute();F.createApplication(a,t,s,n,i).then(e=>{F.renderApplication(e)})})})})};this._setUI5LocaleAttributes=function(s){if(Object.keys(s).length>0){if(s.calendarType){e.setCalendarType(s.calendarType)}if(s.dateFormatShort){e.setDatePattern("short",s.dateFormatShort)}if(s.dateFormatMedium){e.setDatePattern("medium",s.dateFormatMedium)}if(s.numberFormatGroup){e.setNumberSymbol("group",s.numberFormatGroup)}if(s.numberFormatDecimal){e.setNumberSymbol("decimal",s.numberFormatDecimal)}if(s.timeFormatShort){e.setTimePattern("short",s.timeFormatShort)}if(s.timeFormatMedium){e.setTimePattern("medium",s.timeFormatMedium)}if(s.calendarMapping){e.setCustomIslamicCalendarData(s.calendarMapping)}if(s.timeZone){t.setTimezone(s.timeZone)}if(s.currencyFormats){e.setCustomCurrencies(s.currencyFormats)}}};this._setInitialAppRoute=function(){const e=P.parseShellHash(c.getHash());if(e&&e.appSpecificRoute&&e.appSpecificRoute.length>0){d.postMessageToFLP("sap.ushell.services.CrossApplicationNavigation.setInnerAppRoute",{appSpecificRoute:e.appSpecificRoute})}};this._getURI=function(){return(new h).query(true)};this.init=function(){C.registerFiori2IconFont();B=this._getURIParams()["sap-manifest-width"];g.setFullWidthFromManifest(B)};this.initPostMessages=function(){const e={"sap.ushell.appRuntime.hashChange":{async handler(e,t){const s=e.sHash;if(typeof s==="string"){const e=P.parseShellHash(s);const t=P.parseShellHash(c.getHash());if(e&&t&&e.semanticObject===t.semanticObject&&e.action===t.action){c.replaceHash(s)}}}},"sap.ushell.appRuntime.innerAppRouteChange":{async handler(e,t){const s=e.oHash?.fullHash;if(typeof s==="string"){c.replaceHash(s)}}},"sap.ushell.appRuntime.setDirtyFlag":{async handler(e,t){const s=e.bIsDirty;if(s!==N.getDirtyFlag()){N.setDirtyFlag(s)}}},"sap.ushell.appRuntime.getDirtyFlag":{async handler(e,t){return N.getDirtyFlag()}},"sap.ushell.appRuntime.themeChange":{async handler(e,t){const s=e.currentThemeId;N.getUser().setTheme(s)}},"sap.ushell.appRuntime.buttonClick":{async handler(e,t){L.handleHeaderButtonClick(e.buttonId)}},"sap.ushell.appRuntime.executeLogoutFunctions":{async handler(e,t){await N.executeAsyncAndSyncLogoutFunctions()}},"sap.ushell.appRuntime.uiDensityChange":{async handler(e,t){const s=e.isTouch;jQuery("body").toggleClass("sapUiSizeCompact",s==="0").toggleClass("sapUiSizeCozy",s==="1")}},"sap.ushell.appRuntime.handleDirtyStateProvider":{async handler(e,t){return N.handleDirtyStateProvider(e.oNavigationContext)}},"sap.ushell.services.MessageBroker._execute":{async handler(e,t){const s=await N.getServiceAsync("MessageBroker");await s.handleMessage(e)}}};Object.keys(e).forEach(t=>{d.setRequestHandler(t,e[t].handler)})};this.handleLinkElementOpen=function(e,t){try{if(t.isDefaultPrevented&&t.isDefaultPrevented()===true){return}const s=t.target;if(s&&s.tagName==="A"&&s.href&&s.href.indexOf("#")>0){if(s.target==="_blank"){const i=s.href.split("#");if(i[0].length===0||i[0]===document.URL.split("#")[0]){F.rebuildNewAppUrl(s.href,e).then(e=>{S.openURL(e)});t.preventDefault()}}else if(s.target===undefined||s.target===""||s.target==="_top"||s.target==="_self"){const e=s.href.split("#");const i=document.URL.split("#");if(e[0]===i[0]){const s=e[1]&&e[1].split("&/");const a=i[1]&&i[1].split("&/");if(typeof s[0]==="string"&&typeof a[0]==="string"&&s[0]!==a[0]){N.getServiceAsync("Navigation").then(t=>{t.navigate({target:{shellHash:e[1]}})});t.preventDefault()}}}}}catch(e){}};this.rebuildNewAppUrl=async function(e,t){const s=e.split("#");if(s[0].length===0||s[0]===document.URL.split("#")[0]){if(U.getIsScube()){const e=await U.checkIntentsConversionForScube([{intent:`#${s[1]}`}]);return t+e[0].intent}return`${t}#${s[1]}`}return e};this.getPageConfig=function(e){window["sap-ushell-config"]=a({},x(),window["sap-ushell-config"]);if(e.hasOwnProperty("sap-remote-intent")){const e=window["sap-ushell-config"].bootstrapPlugins;if(e&&e.hasOwnProperty("WAPluginAgent")&&e.WAPluginAgent.hasOwnProperty("config")){delete e.WAPluginAgent.config["sap-plugin-agent"]}}};this.setModulePaths=function(){if(window["sap-ushell-config"].modulePaths){const e=Object.keys(window["sap-ushell-config"].modulePaths);let t;for(const s in e){t=e[s];(function(e){const t={};t[e.replace(/\./g,"/")]=window["sap-ushell-config"].modulePaths[e];sap.ui.loader.config({paths:t})})(t)}}};this.loadAdditionalLibs=function(){const e=i.get("ui5.libs",window["sap-ushell-config"])||{};const t=[];Object.keys(e).forEach(s=>{if(e[s]===true){t.push(l.load(s))}});return t};this.adjustIframeURL=function(){};this.initServicesContainer=function(){return new Promise(e=>{sap.ui.require(["sap/ushell/appRuntime/ui5/services/Container"],t=>{N=t;N.init("apprt",{apprt:"sap.ushell.appRuntime.ui5.services.adapters"}).then(()=>{N.getFLPUrlAsync().then(e=>{jQuery(document).on("click.appruntime",F.handleLinkElementOpen.bind(F,e));jQuery(document).on("keydown.appruntime",t=>{if(t.code==="Enter"){return F.handleLinkElementOpen(e,t)}})});N.getServiceAsync("ShellNavigationInternal").then(t=>{_=t;_.init(()=>{});F._enableHistoryEntryReplacedDetection();e()})})})})};this._enableHistoryEntryReplacedDetection=function(){this._fnOriginalSetHash=c.setHash;this._fnOriginalReplaceHash=c.replaceHash;c.setHash=function(){if(c.disableCFLPUpdate===true){return this._fnOriginalSetHash.apply(c,arguments)}if(U.checkDataLossAndContinue()){return this._fnOriginalSetHash.apply(c,arguments)}}.bind(this);c.replaceHash=function(){if(c.disableCFLPUpdate===true){return this._fnOriginalReplaceHash.apply(c,arguments)}if(U.checkDataLossAndContinue()){return this._fnOriginalReplaceHash.apply(c,arguments)}}.bind(this)};this._getURIParams=function(){return T};this.getAppInfo=function(e,t){let s;let i;let a;if(e){s=window["sap-ushell-config"].ui5appruntime.config.appIndex.data;i=window["sap-ushell-config"].ui5appruntime.config.appIndex.module;a=window["sap-ushell-config"].ui5appruntime.config.appIndex.enableCache}return new Promise(p=>{if(e&&s&&!n(s)){y.init(i,F.createApplication.bind(F),F.renderApplication.bind(F),a,e,s);p({oResolvedHashFragment:s})}else{y.init(i,F.createApplication.bind(F),F.renderApplication.bind(F),a);y.getAppInfo(e,document.URL,t).then(p)}})};this.setHashChangedCallback=function(){if(M===true){return}c.changed.add(this._treatHashChanged.bind(this),this);M=true};this._treatHashChanged=async function(e,t){if(c.disableCFLPUpdate===true){return}if(e&&typeof e==="string"&&e.length>0){if(t&&typeof t==="string"&&t.length>0){const s=P.compareHashes(e,t);if(!s.sameIntent||!s.sameParameters){N.getServiceAsync("Navigation").then(t=>{t.navigate({target:{shellHash:e}})});return}}d.postMessageToFLP("sap.ushell.appRuntime.hashChange",{newHash:e,direction:u.getInstance().getDirection()})}};this.createApplication=function(e,t,i,a,n){const p=P.getHash(window.location.href);return new Promise(r=>{let l="";if(t.hasOwnProperty("sap-history-dir")){l=t["sap-history-dir"];_.hashChanger.fireEvent("hashReplaced",{hash:_.hashChanger.getHash(),direction:l});s.debug("AppRuntime.createApplication :: Informed by the FLP, to change the History direction "+`property in the Iframe to: ${l}`)}const u=new o({id:`${U.getIsScube()===true?a:e}-content`,width:"100%",height:"100%"});u.addStyleClass("sapAppRuntimeBaseStyle");let c="0";if(T.hasOwnProperty("sap-touch")){c=T["sap-touch"];if(c!=="0"&&c!=="1"){c="0"}}jQuery("body").toggleClass("sapUiSizeCompact",c==="0").toggleClass("sapUiSizeCozy",c==="1");if(O===false){const e=new v({scopeObject:u,scopeType:"component"});e.setBackNavigation();new I({scopeObject:u,scopeType:"component"});y.setShellUIService(e);w.init();O=true}(U.getIsScube()?Promise.resolve(""):y.getApplicationParameters(t)).then(s=>{i.url+=s;F.setHashChangedCallback();Promise.all([N.getServiceAsync("Ui5ComponentLoader"),N.getServiceAsync("AppLifeCycle")]).then(s=>{const o=s[0];const l=s[1];if(i.asyncHints&&Array.isArray(i.asyncHints.libs)){i.asyncHints.libs=i.asyncHints.libs.filter(e=>e.name!=="sap.ushell")}let c;let h;if(U.getIsScube()===true){c=i;h=n}else{c={ui5ComponentName:e,applicationDependencies:i,url:i.url};h=P.parseShellHash(p)}o.createComponent(c,h,[],b.Application).then(e=>{let s;if(U.getIsScube()===true){try{if(p&&p.indexOf("Shell-startIntent")===0){s=e.componentHandle.getInstance().getManifestEntry("/sap.app/title");if(typeof s==="string"){setTimeout(()=>{d.postMessageToFLP("sap.ushell.services.ShellUIService.setTitle",{sTitle:s})},2e3)}}}catch(e){}}u.setComponent(e.componentHandle.getInstance());m.setAppShortId(e.componentHandle);l.prepareCurrentAppObject("UI5",e.componentHandle.getInstance(),false,undefined);F.getCurrentAppInfo(l,t,c,s);F.considerChangingTheDefaultFullWidthVal(e);F.overrideUrlHelperFuncs();r({oComponentContainer:u,oResolutionResultWithComponentHandle:e,sAppIntent:a||"",ui5ComponentName:c.ui5ComponentName})})})})})};this.getCurrentAppInfo=function(e,t,s,i){const a=["appFrameworkVersion","appVersion"];if(!t["sap-startup-params"]||t["sap-startup-params"].indexOf("sap-fiori-id")===-1){a.push("appId")}if(!t["sap-startup-params"]||t["sap-startup-params"].indexOf("sap-ach")===-1){a.push("appSupportInfo")}const n=e.getCurrentApplication();n.getInfo(a).then(e=>{for(const t in e){if(e[t]===undefined||e[t]===""){delete e[t]}}e.appFrameworkId="UI5";e.technicalAppComponentId=s.ui5ComponentName;if(typeof i==="string"){e.appTitle=i}y.setCurrentAppAttributes(e);setTimeout(()=>{d.postMessageToFLP("sap.ushell.services.AppLifeCycle.updateCurrentAppInfo",{info:e})},500)})};this.considerChangingTheDefaultFullWidthVal=function(e){if(B===true||B==="true"){A.emit("appWidthChange",false)}const t=e.componentHandle.getInstance();const s=t.getMetadata();if(s){const e=t.getManifestEntry("/sap.ui/fullWidth");const s=t.getManifestEntry("/sap.ui5/config/fullWidth");if(e===true||e==="true"||s===true||s==="true"){A.emit("appWidthChange",true)}else if(e===false||e==="false"||s===false||s==="false"){A.emit("appWidthChange",false)}}};this.overrideUrlHelperFuncs=function(){if(E===true){return}E=true;if(H){H.triggerEmail=function(e,t,s,i,a){d.postMessageToFLP("sap.ushell.services.ShellUIService.sendEmail",{sTo:e,sSubject:t,sBody:s,sCc:i,sBcc:a,sIFrameURL:document.URL,bSetAppStateToPublic:true})};k=H.redirect;H.redirect=function(e,t){if(e&&t===true&&e.indexOf("#")>=0){N.getFLPUrlAsync().then(s=>{F.rebuildNewAppUrl(e,s).then(e=>{k.call(H,e,t)})})}else{k.call(H,e,t)}}}};function p(e){e.registerPlugins({RTAPluginAgent:{component:"sap.ushell.appRuntime.ui5.plugins.rtaAgent",url:sap.ui.require.toUrl("sap/ushell/appRuntime/ui5/plugins/rtaAgent"),config:{"sap-plugin-agent":true}}})}function W(e){e.registerPlugins({WAPluginAgent:{component:"sap.ushell.appRuntime.ui5.plugins.scriptAgent",url:sap.ui.require.toUrl("sap/ushell/appRuntime/ui5/plugins/scriptAgent"),config:{"sap-plugin-agent":true,scube:false}}})}this.loadPlugins=function(){if(D===true){return}D=true;N.getServiceAsync("PluginManager").then(e=>{p(e);if(U.getIsScube()===false){W(e)}e.loadPlugins("RendererExtensions")})};this.renderApplication=function(e){e.oComponentContainer.placeAt("content");r.hide();setTimeout(()=>{if(e.oResolutionResultWithComponentHandle.componentHandle.getInstance().active){e.oResolutionResultWithComponentHandle.componentHandle.getInstance().active()}F.loadPlugins()},0);y.setCurrentApp(e.oComponentContainer,e.sAppIntent,e.ui5ComponentName)}}const j=new W;j._prepareUshellConfig=prepareUshellConfig;F=j;j.main();return j});
//# sourceMappingURL=AppRuntime.js.map