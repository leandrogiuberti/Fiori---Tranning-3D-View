// Copyright (c) 2009-2025 SAP SE, All Rights Reserved
sap.ui.define(["sap/ushell/appRuntime/ui5/services/Container","sap/ushell/appRuntime/ui5/AppCommunicationMgr","sap/ui/thirdparty/URI","sap/base/Log"],(e,t,n,s)=>{"use strict";function i(){this.init=function(){const e={"sap.ushell.sessionHandler.beforeApplicationHide":{async handler(e,t){}},"sap.ushell.sessionHandler.afterApplicationShow":{async handler(e,t){}},"sap.ushell.sessionHandler.logout":{async handler(e,t){return this.handleLogoutEvent()}},"sap.ushell.sessionHandler.extendSessionEvent":{async handler(e,t){return this.handleExtendSessionEvent()}}};Object.keys(e).forEach(n=>{t.setRequestHandler(n,e[n].handler)});this.attachUserEvents();this.userActivityHandler()};this.handleLogoutEvent=function(){return new Promise((t,n)=>{this.detachUserEvents();e.getFLPUrlAsync(true).then(s=>{if(this.isSameDomain(s,document.URL)===false){e.logout().then(t).catch(n)}else{t()}})})};this.isSameDomain=function(e,t){let i;let r;let a=false;if(e===undefined||t===undefined){return false}try{i=new n(e);r=new n(t);if(i.origin()===r.origin()){a=true}}catch(n){s.error(`Check for same domain of iframe and FLP failed: ${e} ${t}`,n,"sap.ushell.appRuntime.ui5.SessionHandlerAgent")}return a};this.handleExtendSessionEvent=function(){e.sessionKeepAlive();return Promise.resolve()};this.attachUserEvents=function(){document.addEventListener("mousedown",this.userActivityHandler);document.addEventListener("mousemove",this.userActivityHandler);document.addEventListener("keyup",this.userActivityHandler);document.addEventListener("touchstart",this.userActivityHandler)};this.detachUserEvents=function(){document.removeEventListener("mousedown",this.userActivityHandler);document.removeEventListener("mousemove",this.userActivityHandler);document.removeEventListener("keyup",this.userActivityHandler);document.removeEventListener("touchstart",this.userActivityHandler)};this.userActivityHandler=function(e){if(this.oUserActivityTimer!==undefined){return}this.oUserActivityTimer=setTimeout(()=>{t.postMessageToFLP("sap.ushell.sessionHandler.notifyUserActive",{});this.oUserActivityTimer=undefined},1e4)}}return new i});
//# sourceMappingURL=SessionHandlerAgent.js.map