// Copyright (c) 2009-2025 SAP SE, All Rights Reserved
sap.ui.define(["sap/base/Log","sap/base/i18n/Formatting","sap/base/util/deepExtend","sap/base/util/ObjectPath","sap/ui/thirdparty/jquery","sap/ushell/User"],(e,t,s,o,jQuery,r)=>{"use strict";function i(i,n,a){let u;let l;let d;let c;let p;let f;function m(e){if(e.sapDateFormat){t.setABAPDateFormat(e.sapDateFormat)}if(e.sapDateCalendarCustomizing){t.setCustomIslamicCalendarData(e.sapDateCalendarCustomizing)}if(e.sapNumberFormat){t.setABAPNumberFormat(e.sapNumberFormat)}if(e.sapTimeFormat){t.setABAPTimeFormat(e.sapTimeFormat)}if(typeof e.currencyFormats==="object"){t.addCustomCurrencies(e.currencyFormats)}}this.load=function(){l=o.get("config.systemProperties.logoutUrl",a);d=o.get("config.systemProperties.logoutMethod",a)||"GET";c=o.get("config.systemProperties.csrfTokenUrl",a);p=o.get("config.systemProperties.sessionKeepAlive.url",a);f=o.get("config.systemProperties.sessionKeepAlive.method",a);const e=s({id:""},o.get("config.userProfile.defaults",a));u=new r(e);m(e);return(new jQuery.Deferred).resolve().promise()};this.getSystem=function(){return i};this.getUser=function(){return u};this._getLogoutUrl=function(){return l};this._setWindowLocation=function(e){window.location.href=e};this.logout=function(){const t=new jQuery.Deferred;const s=this;if(d==="POST"){e.info("performing logout from system via POST",undefined,"sap.ushell.appRuntime.ui5.services.adapters.ContainerAdapter::logout");jQuery.ajax({type:"HEAD",url:c,headers:{"X-CSRF-Token":"Fetch"},success:function(o,r,i){jQuery.ajax({type:"POST",url:l,headers:{"X-CSRF-Token":i.getResponseHeader("X-CSRF-Token")},success:function(e){s._setWindowLocation(e);t.resolve()},error:function(){e.error("Logging out via POST failed",undefined,"sap.ushell.appRuntime.ui5.services.adapters.ContainerAdapter::logout");t.resolve()}})},error:function(){e.error(`fetching X-CSRF-Token for logout via POST failed for system: ${i.getAlias()}`,undefined,"sap.ushell.appRuntime.ui5.services.adapters.ContainerAdapter::logout");t.resolve()}})}else{try{if(typeof l==="string"&&l.length>0){this._logoutViaHiddenIFrame(t,l);setTimeout(t.resolve,4e3)}else{t.resolve()}}catch(s){e.error(`logout from iframe ${document.URL} failed`,s,"sap.ushell.appRuntime.ui5.SessionHandlerAgent");t.resolve()}}return t.promise()};this._logoutViaHiddenIFrame=function(e,t){const s=document.createElement("iframe");const o=t.replace(/"/g,'\\"');window.addEventListener("message",s=>{if((s.data&&s.data.url)===t){e.resolve()}});s.style.visibility="hidden";s.setAttribute("src",t);function r(){this.contentWindow.parent.postMessage({url:o,request_id:"dummy-logout-id"},"*")}s.addEventListener("load",r);s.addEventListener("error",r);document.body.appendChild(s)};this.sessionKeepAlive=function(){if(typeof p==="string"&&p.length>0&&typeof f==="string"&&f.length>0){const t=new XMLHttpRequest;t.open(f,p,true);t.onreadystatechange=function(){if(this.readyState===4){e.debug("Server session was extended")}};t.send()}}}return i},true);
//# sourceMappingURL=ContainerAdapter.js.map