// Copyright (c) 2009-2025 SAP SE, All Rights Reserved
sap.ui.define(["sap/base/Log","sap/ui/core/Component","sap/ui/core/EventBus","sap/ui/fl/initial/api/InitialFlexAPI","sap/ushell/api/RTA","sap/ushell/appRuntime/ui5/plugins/baseRta/AppLifeCycleUtils","sap/ushell/appRuntime/ui5/plugins/baseRta/CheckConditions","sap/ushell/appRuntime/ui5/plugins/baseRta/Trigger"],(e,t,i,n,s,r,a,o)=>{"use strict";let u;function p(){return{sComponentName:"sap.ushell.appRuntime.ui5.plugins.rtaAgent",layer:"CUSTOMER",developerMode:false}}function l(e){return new Promise((t,i)=>{u.postMessageToFlp("user.postapi.rtaPlugin","switchToolbarVisibility",{visible:e}).done(t).fail(i)})}function h(){return new Promise((e,t)=>{u.postMessageToFlp("user.postapi.rtaPlugin","activatePlugin").done(e).fail(t)})}function g(){return a.checkUI5App().then(e=>{if(e){u.postMessageToFlp("user.postapi.rtaPlugin","showAdaptUI").fail(e=>{throw new Error(e)})}})}function d(){u.postMessageToFlp("user.postapi.rtaPlugin","hideAdaptUI").fail(e=>{throw new Error(e)})}function c(){this.oTrigger.triggerStopRta(true,true)}return t.extend("sap.ushell.appRuntime.ui5.plugins.rtaAgent.Component",{metadata:{manifest:"json"},init:function(){this.mConfig=p();this._oPluginPromise=Promise.resolve();u=this.getComponentData().oPostMessageInterface;n.isKeyUser().then(e=>{if(e){return h()}return Promise.reject()}).then(()=>{this.mConfig.i18n=this.getModel("i18n").getResourceBundle();this.mConfig.onStartHandler=this._onStartHandler.bind(this);this.mConfig.onErrorHandler=this._onErrorHandler.bind(this);this.mConfig.onStopHandler=this._onStopHandler.bind(this);this.oTrigger=new o(this.mConfig);return this.oTrigger.getInitPromise()}).then(()=>{this._registerPostMessages();return this._restartRtaIfRequired()}).then(()=>r.getAppLifeCycleService()).then(e=>{e.attachAppLoaded(this._onAppLoaded,this)}).then(g).catch(t=>{if(t){e.error(t)}})},getPluginPromise:function(){return this._oPluginPromise},_registerPostMessages:function(){u.registerPostMessageAPIs({"user.postapi.rtaPlugin":{inCalls:{startUIAdaptation:{executeServiceCallFn:async function(){i.getInstance().subscribe("sap.ushell","appClosed",c.bind(this));s.addTopHeaderPlaceHolder();await this.oTrigger.triggerStartRta(this);return u.createPostMessageResult(this.oTrigger.sStatus)}.bind(this)}},outCalls:{activatePlugin:{},showAdaptUI:{}}}})},_restartRtaIfRequired:function(){return a.checkUI5App().then(e=>{if(e){if(a.checkRestartRTA(this.mConfig.layer)){return l(false).then(()=>{s.addTopHeaderPlaceHolder();return this.oTrigger.triggerStartRta(this)})}}return undefined})},_onAppLoaded:async function(){const e=await a.checkUI5App();if(e){await this._restartRtaIfRequired();return g()}return d()},_onStopHandler:function(){this._exitAdaptation()},_onStartHandler:function(){},_onErrorHandler:function(){this._exitAdaptation()},_exitAdaptation:function(){i.getInstance().unsubscribe("sap.ushell","appClosed",c.bind(this));l(true);this.oTrigger.exitRta();s.removeTopHeaderPlaceHolder()},exit:function(){i.getInstance().unsubscribe("sap.ushell","appClosed",c.bind(this));l(true);this._oPluginPromise=this._oPluginPromise.then(r.getAppLifeCycleService.bind(r)).then(e=>{e.detachAppLoaded(this._onAppLoaded,this)})}})});
//# sourceMappingURL=Component.js.map