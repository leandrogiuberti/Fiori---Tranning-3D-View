// Copyright (c) 2009-2025 SAP SE, All Rights Reserved
sap.ui.define(["sap/base/Log","sap/ui/integration/Host","sap/ui/model/json/JSONModel","sap/ushell/Container","sap/ushell/EventHub","sap/ui/model/resource/ResourceModel","./DestinationResolver","sap/m/IllustratedMessageType","sap/m/IllustratedMessageSize"],(e,t,r,o,n,a,s,i,l)=>{"use strict";return function(e,c){const g=new t(e,c);g._oHostContext=null;g._oHostContextModel=null;g._destinationResolver=new s;g._mUnresolvedDestinations=new WeakMap;g.setResolveDestination(async(e,t)=>{if(!e||!t){throw new Error("No destination name or card instance given.")}return g._destinationResolver.resolveCardDestination(e,t).catch(r=>{const o=r.details?.reason;g._mUnresolvedDestinations.set(t,{error:o,destinationName:e})})});g.attachCardStateChanged(async e=>{const t=e.getParameter("card");const r=t.getBlockingMessage();if(r?.type==="Error"&&g._mUnresolvedDestinations.has(t)){r.illustrationType=i.UnableToLoad;r.illustrationSize=l.ExtraSmall;const e=await g._getBundle();switch(g._mUnresolvedDestinations.get(t)?.error){case s.ERROR_CODES.NO_DESTINATION_FOUND:r.title=e.getText("WorkPage.Host.DestinationResolver.Error.NoDestinationFound.Title",[g._mUnresolvedDestinations.get(t)?.destinationName||""]);r.description=e.getText("WorkPage.Host.DestinationResolver.Error.NoDestinationFound.Description",[t.getReferenceId()]);break;case s.ERROR_CODES.COULD_NOT_RETRIEVE_DESTINATIONS:r.title=e.getText("WorkPage.Host.DestinationResolver.Error.CouldNotRetrieveDestinations.Title",[g._mUnresolvedDestinations.get(t)?.destinationName]);r.description=e.getText("WorkPage.Host.DestinationResolver.Error.CouldNotRetrieveDestinations.Description");break;case s.ERROR_CODES.NO_CARD_OR_DESTINATION_NAME:r.title=e.getText("WorkPage.Host.DestinationResolver.Error.NoCardOrDestinationName.Title");r.description=e.getText("WorkPage.Host.DestinationResolver.Error.NoCardOrDestinationName.Description");break;case s.ERROR_CODES.RESOLVED_URL_EMPTY:r.title=e.getText("WorkPage.Host.DestinationResolver.Error.ResolvedUrlEmpty.Title",[g._mUnresolvedDestinations.get(t)?.destinationName]);r.description=e.getText("WorkPage.Host.DestinationResolver.Error.ResolvedUrlEmpty.Description",[t.getReferenceId()]);break;default:r.title=e.getText("WorkPage.Host.DestinationResolver.Error.Generic.Title",[g._mUnresolvedDestinations.get(t)?.destinationName]);r.description=e.getText("WorkPage.Host.DestinationResolver.Error.Generic.Description",[g._mUnresolvedDestinations.get(t)?.error])}t.showBlockingMessage(r);g._mUnresolvedDestinations.delete(t)}});g.attachCardInitialized(e=>{const t=e.getParameter("card");if(t&&t.isA&&t.isA("sap.ui.integration.widgets.Card")){n.emit("UITracer.trace",{source:"Card",reason:"Init",data:{cardId:t.getManifestEntry("/sap.app/id"),providerId:t.getReferenceId()}})}});g._setContainer=function(e){this.oContainer=e};g._setNavigationDisabled=function(e){this._bNavigationDisabled=!!e};g._executeNavigation=function(e){const t=e.getParameter("parameters");const r=e.getParameter("card");if(e.getParameter("type")!=="Navigation"||this._bNavigationDisabled){return Promise.resolve()}if(t&&t.hasOwnProperty("url")){n.emit("UITracer.trace",{reason:"LaunchApp",source:"Card",data:{cardId:r.getManifestEntry("/sap.app/id"),providerId:r.getReferenceId(),targetUrl:t.url}});return Promise.resolve()}e.preventDefault(true);return this.oContainer.getServiceAsync("Navigation").then(e=>{const o={};if(t.hasOwnProperty("ibnTarget")){o.target=t.ibnTarget}if(t.hasOwnProperty("ibnParams")){o.params=t.ibnParams}if(t.hasOwnProperty("ibnAppSpecificRoute")){o.appSpecificRoute=t.ibnAppSpecificRoute}n.emit("UITracer.trace",{reason:"LaunchApp",source:"Card",data:{cardId:r.getManifestEntry("/sap.app/id"),providerId:r.getReferenceId(),targetUrl:`#${o.target.semanticObject}-${o.target.action}`}});return e.navigate(o)})};g.attachAction(g._executeNavigation.bind(g));g.fetch=function(e,r,o,a){if(a&&a.isA&&a.isA("sap.ui.integration.widgets.Card")){return t.prototype.fetch.apply(this,arguments).then(t=>{n.emit("UITracer.trace",{source:"Card",reason:"FetchData",data:{cardId:a.getManifestEntry("/sap.app/id"),providerId:a.getReferenceId(),targetUrl:e,status:t.status}});return t})}return t.prototype.fetch.apply(this,arguments)};g.getContextValue=async function(e){if(!e){throw new Error("Invalid context path")}if(e.charAt(0)==="/"){return g.getContextValue(e.substring(1))}return g.getContext().then(()=>g._oHostContextModel.getProperty(`/${e}/value`))};g.getContext=async function(){if(!g._oHostContext){try{const e=await o.getServiceAsync("UserInfo");try{const t=await g._getBundle();g._oHostContext=g._applyHostContext(e,t)}catch(t){g._oHostContext=g._applyHostContext(e)}}catch(e){g._oHostContext={}}}return Promise.resolve(g._oHostContext)};g._getBundle=function(){if(!this._oResourceBundle){this._oResourceBundle=new a({bundleName:"sap.ushell.utils.workpage.resources.resources",async:true}).getResourceBundle()}return this._oResourceBundle};g._applyHostContext=function(e,t){if(!t){t={getText:function(e){return e}}}g._oHostContext={"sap.workzone":{label:t.getText("WorkPage.Host.Context.WorkZone.Label"),currentUser:{label:t.getText("WorkPage.Host.Context.WorkZone.CurrentUser.Label"),id:{label:t.getText("WorkPage.Host.Context.WorkZone.CurrentUser.Id.Label"),type:"string",tags:["technical"],placeholder:t.getText("WorkPage.Host.Context.WorkZone.CurrentUser.Id.Placeholder"),description:t.getText("WorkPage.Host.Context.WorkZone.CurrentUser.Id.Desc"),value:e.getId()},name:{label:t.getText("WorkPage.Host.Context.WorkZone.CurrentUser.Name.Label"),type:"string",placeholder:t.getText("WorkPage.Host.Context.WorkZone.CurrentUser.Name.Placeholder"),description:t.getText("WorkPage.Host.Context.WorkZone.CurrentUser.Name.Desc"),value:e.getFullName()},firstName:{label:t.getText("WorkPage.Host.Context.WorkZone.CurrentUser.FirstName.Label"),type:"string",placeholder:t.getText("WorkPage.Host.Context.WorkZone.CurrentUser.FirstName.Placeholder"),description:t.getText("WorkPage.Host.Context.WorkZone.CurrentUser.FirstName.Desc"),value:e.getFirstName()},lastName:{label:t.getText("WorkPage.Host.Context.WorkZone.CurrentUser.LastName.Label"),type:"string",placeholder:t.getText("WorkPage.Host.Context.WorkZone.CurrentUser.LastName.Placeholder"),description:t.getText("WorkPage.Host.Context.WorkZone.CurrentUser.LastName.Desc"),value:e.getLastName()},email:{label:t.getText("WorkPage.Host.Context.WorkZone.CurrentUser.Email.Label"),type:"string",placeholder:t.getText("WorkPage.Host.Context.WorkZone.CurrentUser.Email.Placeholder"),description:t.getText("WorkPage.Host.Context.WorkZone.CurrentUser.Email.Desc"),value:e.getEmail()}}}};g._oHostContextModel=new r(g._oHostContext);return g._oHostContext};return g}});
//# sourceMappingURL=WorkPageHost.js.map