// Copyright (c) 2009-2025 SAP SE, All Rights Reserved
sap.ui.define(["sap/m/library","sap/m/StandardListItem","sap/ui/core/EventBus","sap/ui/core/mvc/Controller","sap/ui/Device","sap/ui/model/json/JSONModel","sap/ui/performance/Measurement","sap/ushell/Config","sap/ushell/library","sap/ushell/renderer/allMyApps/AllMyAppsManager","sap/ushell/resources","sap/ushell/utils/WindowUtils","sap/ushell/EventHub","sap/ushell/state/ShellModel","sap/ushell/Container","sap/ushell/renderers/fiori2/allMyApps/AllMyAppsManager"],(e,t,s,i,l,n,o,a,r,p,d,g,h,c,u,M)=>{"use strict";const A=e.ListType;const y=r.AllMyAppsState;const f=r.AllMyAppsProviderType;const L=r.AppTitleState;let m=false;return i.extend("sap.ushell.renderer.allMyApps.AllMyApps",{iNumberOfProviders:0,onInit:function(){this.bFirstLoadOfAllMyApps=true;const e=new n;const t=this.getView();const i=s.getInstance();e.setSizeLimit(1e4);e.setProperty("/AppsData",[]);e.setProperty("/catalogEnabled",a.last("/core/catalog/enabled"));t.setModel(d.i18nModel,"i18n");t.setModel(e,"allMyAppsModel");if(!this._fnResizeHandler){this._fnResizeHandler=this._adjustItemNavigationColumns.bind(this);window.addEventListener("resize",this._fnResizeHandler)}i.subscribe("launchpad","allMyAppsFirstCatalogLoaded",this.updateMasterFocusAndDetailsContext,this);i.subscribe("launchpad","allMyAppsFirstCatalogLoaded",this.onDetailLoad,this);i.subscribe("launchpad","allMyAppsMasterLoaded",this.onMasterLoad,this);i.subscribe("launchpad","allMyAppsNoCatalogsLoaded",this.onNoCatalogsLoaded,this)},_getConfigModel:function(){return c.getConfigModel()},onExit:function(){const e=s.getInstance();if(this._fnResizeHandler){window.removeEventListener("resize",this._fnResizeHandler);delete this._fnResizeHandler}const t=this.getView();const i=t&&t.byId("oItemsContainerlist");const l=i&&i.getDomRef();if(this._fnFocusInHandler&&l){l.removeEventListener("focusin",this._fnFocusInHandler);delete this._fnFocusInHandler}e.unsubscribe("launchpad","allMyAppsFirstCatalogLoaded",this.updateMasterFocusAndDetailsContext);e.unsubscribe("launchpad","allMyAppsFirstCatalogLoaded",this.onDetailLoad,this);e.unsubscribe("launchpad","allMyAppsMasterLoaded",this.onMasterLoad,this);e.unsubscribe("launchpad","allMyAppsNoCatalogsLoaded",this.onNoCatalogsLoaded,this)},_adjustItemNavigationColumns:function(){const e=this.getView();const t=e&&e.byId("oItemsContainerlist");const s=t&&t.getItemNavigation();const i=t&&t.getItems();if(s&&i.length>1){const e=i[0].getDomRef();const t=i[1].getDomRef();if(e&&t){const i=e.getBoundingClientRect().y===t.getBoundingClientRect().y;s.setColumns(i?2:1)}}},onBeforeRendering:function(){const e=this.getView();const t=e&&e.byId("oItemsContainerlist");const s=t&&t.getDomRef();if(this._fnFocusInHandler&&s){s.removeEventListener("focusin",this._fnFocusInHandler);delete this._fnFocusInHandler}},onAfterRendering:function(){return new Promise((e,t)=>{const s=this;const i=this.getView();const n=i.getModel("allMyAppsModel");const o=this._getSplitApp();const a=i.byId("sapUshellAllMyAppsMasterPage");const r=i.byId("sapUshellAllMyAppsDetailsPage");if(!this.bAfterInitialLoading){if(a){a.setBusy(true)}if(r){r.setBusy(true)}o.toMaster(this.createId("sapUshellAllMyAppsMasterPage"),"show");if(!l.system.phone){o.toDetail("sapUshellAllMyAppsDetailsPage","show")}}if(this.bFirstLoadOfAllMyApps){n.setProperty("/AppsData",[])}else{const e=n.getProperty("/AppsData");n.setProperty("/AppsData",e)}const p=i.byId("oItemsContainerlist");const d=p&&p.getDomRef();if(!this._fnFocusInHandler&&d){this._fnFocusInHandler=this._adjustItemNavigationColumns.bind(this);d.addEventListener("focusin",this._fnFocusInHandler)}setTimeout(()=>{s._getAllMyAppsManager().loadAppsData(n,s._getPopoverObject(),s.bFirstLoadOfAllMyApps);s._isSingleDataSource().then(t=>{m=t;s.switchToInitialState();s.bFirstLoadOfAllMyApps=false;e()})},0)})},switchToInitialState:function(){const e=this._getDataSourceList();return this._isSingleDataSource().then(t=>{if(t){this._getConfigModel().setProperty("/allMyAppsMasterLevel",y.FirstLevelSpread);e.bindItems("allMyAppsModel>/AppsData/0/groups",this._getMasterListItemTemplate)}else{this._getConfigModel().setProperty("/allMyAppsMasterLevel",y.FirstLevel);e.bindItems("allMyAppsModel>/AppsData",this._getMasterListItemTemplate())}if(l.system.phone){this._getSplitApp().toMaster(this.createId("sapUshellAllMyAppsMasterPage"),"show")}e.invalidate();this.updateMasterFocusAndDetailsContext(undefined,undefined,{bFirstCatalogLoadedEvent:true});this._getPopoverHeaderLabel().setText(d.i18n.getText("allMyApps_headerTitle"));this.updateHeaderButtonsState()})},handleSwitchToMasterAreaOnPhone:function(){const e=this._getDataSourcesSelectedPath();const t=e.split("/");this._getSplitApp().toMaster(this.createId("sapUshellAllMyAppsMasterPage"),"show");return this._isSingleDataSource().then(e=>{if(e){this._getConfigModel().setProperty("/allMyAppsMasterLevel",y.FirstLevelSpread)}else if(t.length===3){this._getConfigModel().setProperty("/allMyAppsMasterLevel",y.FirstLevel)}else{this._getConfigModel().setProperty("/allMyAppsMasterLevel",y.SecondLevel)}this.updateHeaderButtonsState()})},handleMasterListItemPress:function(e){this.lastPressedMasterItem=e.getParameter("listItem");const t=this._getClickedDataSourceItemPath(this.lastPressedMasterItem);const s=this.getView();const i=s.getModel("allMyAppsModel");const l=i.getProperty(`${t}/type`);const n=this._getConfigModel().getProperty("/allMyAppsMasterLevel");const o=this._getCustomPanel();const a=this._getCustomPanelLabel();const r=this._getCustomPanelLink();const p=l===f.CATALOG;let d;if(p||n===y.FirstLevelSpread||n===y.SecondLevel){d=this.handleMasterListItemPressToDetails(t)}else{d=this.handleMasterListItemPressToSecondLevel(t)}o.setBindingContext(d,"allMyAppsModel");a.setBindingContext(d,"allMyAppsModel");if(r&&r.getVisible&&r.getVisible()){r.setBindingContext(d,"allMyAppsModel")}},handleMasterListItemPressToSecondLevel:function(e){const t=this.getView();const s=t.getModel("allMyAppsModel");const i=s.getProperty(`${e}/type`);const n=s.getProperty(`${e}/title`);const o=this._getSplitApp();const a=this._getDataSourceList();if(!l.system.phone){o.toDetail(this.createId("sapUshellAllMyAppsDetailsPage"))}a.bindItems(`allMyAppsModel>${e}/groups`,this._getMasterListItemTemplate());this._getConfigModel().setProperty("/allMyAppsMasterLevel",y.SecondLevel);const r=this._setBindingContext(`${e}/groups/0`,t.byId("oItemsContainerlist"));a.invalidate();a.setSelectedItem(a.getItems()[0]);const p=a.getSelectedItem();if(p){p.focus()}if(i===f.HOME){this._getPopoverHeaderLabel().setText(d.i18n.getText("allMyApps_homeEntryTitle"))}else if(i===f.EXTERNAL){this._getPopoverHeaderLabel().setText(n)}this._getDetailsHeaderLabel().setText(s.getProperty(`${e}/groups/0/title`));this.updateHeaderButtonsState();return r},handleMasterListItemPressToDetails:function(e){const t=this.getView();const s=t.getModel("allMyAppsModel");const i=this._setBindingContext(e,t.byId("oItemsContainerlist"));this._getDetailsHeaderLabel().setText(s.getProperty(`${e}/title`));if(l.system.phone){this._getSplitApp().toDetail(this.createId("sapUshellAllMyAppsDetailsPage"));this._getConfigModel().setProperty("/allMyAppsMasterLevel",y.Details)}this.updateHeaderButtonsState();return i},onMasterLoad:function(){const e=this.getView();const t=this._getPopoverHeaderBackButton();this.bAfterInitialLoading=true;e.byId("sapUshellAllMyAppsMasterPage").setBusy(false);t.focus();this._isSingleDataSource().then(e=>{m=e;this.updateMasterFocusAndDetailsContext(undefined,undefined,{bFirstCatalogLoadedEvent:false})})},onDetailLoad:function(){const e=this.getView();const t=e.byId("sapUshellAllMyAppsDetailsPage");t.setBusy(false);this.bAfterInitialLoading=true;if(!l.system.phone){this._getSplitApp().toDetail(this.createId("sapUshellAllMyAppsDetailsPage"),"show")}},onNoCatalogsLoaded:function(){const e=this.getView();const t=e.byId("sapUshellAllMyAppsDetailsPage");t.setBusy(false);this.bAfterInitialLoading=true;if(!l.system.phone&&!m){this._getSplitApp().toDetail(this.createId("sapUshellAllMyAppsEmptyDetailsPage"),"show")}else if(!l.system.phone&&m){this._getSplitApp().toDetail(this.createId("sapUshellAllMyAppsDetailsPage"))}},updateMasterFocusAndDetailsContext:function(e,t,s){const i=this.getView();const l=i.getModel("allMyAppsModel");const n=this._getInitialFirstLevelSelectionIndex();const a=this._getDataSourceList();const r=this._getCustomPanelLabel();const p=this._getCustomPanelLink();let d;let g;if(m===true){d=l.createBindingContext("/AppsData/0/groups/0");g=l.getProperty(d.getPath())}else{d=l.createBindingContext(`/AppsData/${n}`);g=l.getProperty(d.getPath())}i.byId("oItemsContainerlist").setBindingContext(d,"allMyAppsModel");r.setBindingContext(d,"allMyAppsModel");i.byId("sapUshellAllMyAppsCustomPanel").setBindingContext(d,"allMyAppsModel");if(p.getVisible()){p.setBindingContext(d,"allMyAppsModel")}if(g!==undefined){this._getDetailsHeaderLabel().setText(g.title)}if(s.bFirstCatalogLoadedEvent===true){a.invalidate()}if(s.bFirstCatalogLoadedEvent===false&&n===0){this.onNoCatalogsLoaded()}a.setSelectedItem(a.getItems()[n]);const h=a.getSelectedItem();if(h){setTimeout(()=>{h.focus()},0)}if(s.bFirstCatalogLoadedEvent){o.end("FLP:ShellAppTitle.onClick");o.end("FLP:ShellNavMenu.footerClick")}},handleCustomPanelLinkPress:function(e){const t=this.getView();const s=t.byId("sapUshellAllMyAppsCustomPanelLink");const i=s.getVisible()?s.getBindingContext("allMyAppsModel").getObject():{};if(i.handlePress){i.handlePress(e.getSource(),i)}},updateHeaderButtonsState:function(){this._getShellAppTitleToggleListButton().setVisible(this.getToggleListButtonVisible());this._getPopoverHeaderBackButton().setVisible(this.getBackButtonVisible())},getToggleListButtonVisible:function(){const e=this.getCurrentState();const t=l.media.getCurrentRange(l.media.RANGESETS.SAP_STANDARD).name==="Phone";const s=(t||l.system.phone)&&e===y.Details;return s},getBackButtonVisible:function(){const e=this._getConfigModel().getProperty("/shellAppTitleState");if(e!==L.AllMyAppsOnly){return true}const t=this.getCurrentState();return t===y.SecondLevel||t===y.Details},onAppItemClick:function(e){const t=this.getView().getModel("allMyAppsModel");const s=e.getSource().getBindingContext("allMyAppsModel").getPath();const i=t.getProperty(`${s}/url`);if(i){h.emit("UITracer.trace",{reason:"LaunchApp",source:"Tile",data:{targetUrl:i}});if(i[0]==="#"){hasher.setHash(i);setTimeout(()=>{this.getView().getParent().close()},50)}else{g.openURL(i,"_blank")}}},getCurrentState:function(){return this._getConfigModel().getProperty("/allMyAppsMasterLevel")},_isSingleDataSource:function(){return u.getServiceAsync("AllMyApps").then(e=>{if(e.isCatalogAppsEnabled()){return false}if(!e.isExternalProviderAppsEnabled()&&e.isHomePageAppsEnabled()){return true}return e.isExternalProviderAppsEnabled()&&Object.keys(e.getDataProviders()).length===1&&!e.isHomePageAppsEnabled()})},_getInitialFirstLevelSelectionIndex:function(){const e=this.getView();const t=e.getModel("allMyAppsModel");const s=t.getProperty("/AppsData");for(let e=0;e<s.length;e++){const t=s[e];if(t.type===f.CATALOG){return e}}return 0},_getPopoverHeaderBackButton:function(){if(!this._oPopoverHeaderBackButton){this._oPopoverHeaderBackButton=this._getPopoverHeaderContent(0)}return this._oPopoverHeaderBackButton},_getShellAppTitleToggleListButton:function(){if(!this._oShellAppTitleToggleListButton){this._oShellAppTitleToggleListButton=this._getPopoverHeaderContent(1)}return this._oShellAppTitleToggleListButton},_getPopoverHeaderContent:function(e){const t=this._getPopoverObject().getCustomHeader();const s=t.getContentLeft();const i=s[e];return i},_getPopoverHeaderLabel:function(){const e=this._getPopoverObject().getCustomHeader();const t=e.getContentMiddle();return t[0]},_getPopoverObject:function(){return this.getView().getParent()},_getDetailsHeaderLabel:function(){return this.getView().byId("sapUshellAllMyAppsDetailsHeaderLabel")},_setBindingContext:function(e,t){const s=this.getView().getModel("allMyAppsModel");const i=s.createBindingContext(e);t.setBindingContext(i,"allMyAppsModel");return i},_getClickedDataSourceItemPath:function(e){return e.getBindingContext("allMyAppsModel").getPath()},_getAllMyAppsManager:function(){return p},_getDataSourcesSelectedPath:function(){return this.lastPressedMasterItem.getBindingContextPath()},getControllerName:function(){return"sap.ushell.renderer.allMyApps.AllMyApps"},formatListItemType:function(e,t){const s=l.system.phone||t===y.FirstLevel&&e!==f.CATALOG;return s?A.Navigation:A.Active},_getMasterListItemTemplate:function(){if(!this.oTemplate){this.oTemplate=new t({type:{parts:["allMyAppsModel>type","/allMyAppsMasterLevel"],formatter:this.formatListItemType},title:"{allMyAppsModel>title}",wrapping:true})}return this.oTemplate},_getSplitApp:function(){return this.getView().byId("sapUshellAllMyAppsMasterDetail")},_getDataSourceList:function(){return this.getView().byId("sapUshellAllMyAppsDataSourcesList")},_getCustomPanel:function(){return this.getView().byId("sapUshellAllMyAppsCustomPanel")},_getCustomPanelLabel:function(){return this.getView().byId("sapUshellAllMyAppsCustomPanelLabel")},_getCustomPanelLink:function(){return this.getView().byId("sapUshellAllMyAppsCustomPanelLink")}})});
//# sourceMappingURL=AllMyApps.controller.js.map