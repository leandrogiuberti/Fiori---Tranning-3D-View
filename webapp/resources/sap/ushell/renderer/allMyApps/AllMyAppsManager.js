// Copyright (c) 2009-2025 SAP SE, All Rights Reserved
sap.ui.define(["sap/ui/core/EventBus","sap/ui/thirdparty/hasher","sap/ui/thirdparty/jquery","sap/ushell/resources","sap/ushell/library","sap/ushell/Container"],(t,e,jQuery,s,o,i)=>{"use strict";const a=o.AllMyAppsProviderType;function r(){}r.prototype.loadAppsData=function(e,s,o){return i.getServiceAsync("AllMyApps").then(i=>{this.oPopover=s;if(!i.isEnabled()){return}this.iNumberOfProviders=0;this.oModel=e;if(i.isHomePageAppsEnabled()){this._handleGroupsData()}if(i.isExternalProviderAppsEnabled()){this._handleExternalProvidersData(e)}if(i.isCatalogAppsEnabled()){this._handleCatalogs(o)}if(!i.isCatalogAppsEnabled()||i.isCatalogAppsEnabled()&&o){const e=t.getInstance();e.publish("launchpad","allMyAppsMasterLoaded")}})};r.prototype._handleGroupsData=function(){const t=this._getGroupsData();const e={title:s.i18n.getText("allMyApps_homeEntryTitle")};let o;return new Promise((e,s)=>{t.done(e).fail(s)}).then(t=>{e.groups=t;e.type=a.HOME;if(t.length===0){return}o=this.oModel.getProperty("/AppsData");if(o){const t=this._getIndexByType(o,e.type);if(t!==undefined){o[t]=e}else{o.unshift(e)}}this.oModel.setProperty("/AppsData",o);this.iNumberOfProviders+=1})};r.prototype._getIndexByType=function(t,e){if(t.length<=0){return 0}for(let s=0;s<t.length;s++){if(t[s].type===e){return s}}};r.prototype._getGroupsData=function(){const t=new jQuery.Deferred;i.getServiceAsync("FlpLaunchPage").then(t=>Promise.all([t.getDefaultGroup(),t.getGroups()])).then(t=>{this.oDefaultGroup=t[0];const e=t[1];const s=[];e.forEach(t=>{s.push(this._getFormattedGroup(t))});return Promise.all(s)}).then(e=>{const s=e.filter(t=>t&&(t.apps.length>0||t.numberCustomTiles>0));t.resolve(s)});return t.promise()};r.prototype._getFormattedGroup=function(t){let e;let o;let a;return i.getServiceAsync("FlpLaunchPage").then(i=>{if(i.isGroupVisible(t)===false){return}if(i.getGroupId(t)===i.getGroupId(this.oDefaultGroup)){o=s.i18n.getText("my_group")}else{o=i.getGroupTitle(t)}e={};e.title=o;e.apps=[];a=i.getGroupTiles(t);return this._getFormattedGroupApps(a)}).then(t=>{if(!t){return}e.apps=t.aFormattedApps;e.numberCustomTiles=t.iNumberOfCustomTiles;if(t.iNumberOfCustomTiles===1){e.sCustomLabel=s.i18n.getText("allMyApps_customStringSingle");e.sCustomLink=s.i18n.getText("allMyApps_customLinkHomePageSingle")}else{e.sCustomLabel=s.i18n.getText("allMyApps_customString",[t.iNumberOfCustomTiles]);e.sCustomLink=s.i18n.getText("allMyApps_customLinkHomePage")}e.handlePress=this._onHandleGroupPress;return e})};r.prototype._getFormattedGroupApps=function(t){const e=[];let s=0;return i.getServiceAsync("FlpLaunchPage").then(o=>{const i=[];t.forEach(t=>{if(o.isTileIntentSupported(t)){const o=this._getAppEntityFromTile(t).then(t=>{if(t){e.push(t)}else{s++}});i.push(o)}});return Promise.all(i)}).then(()=>({iNumberOfCustomTiles:s,aFormattedApps:e}))};r.prototype._onHandleGroupPress=function(s,o){e.setHash("#Shell-home");this.oPopover.close();const i=t.getInstance();i.subscribe("launchpad","dashboardModelContentLoaded",()=>{i.publish("launchpad","scrollToGroupByName",{groupName:o.title,isInEditTitle:false})},this);i.publish("launchpad","scrollToGroupByName",{groupName:o.title,isInEditTitle:false})};r.prototype._handleExternalProvidersData=function(){const e=this;return i.getServiceAsync("AllMyApps").then(s=>{const o=s.getDataProviders();const i=Object.keys(o);let r;let l;let n;let p;let u;let g;if(i.length>0){for(u=0;u<i.length;u++){r=i[u];l=o[r];n=l.getTitle();p={};p.title=n;g=l.getData();g.done(function(s){if(s&&s.length>0){this.groups=s;this.type=a.EXTERNAL;e.oModel.setProperty(`/AppsData/${e.iNumberOfProviders}`,this);e.iNumberOfProviders+=1;const o=t.getInstance();o.publish("launchpad","allMyAppsMasterLoaded")}}.bind(p))}}})};r.prototype._handleNotFirstCatalogsLoad=function(){const e=this.oModel.getProperty("/AppsData");const s=a.CATALOG;if(e.length&&e[e.length-1].type===s){this.bFirstCatalogLoaded=true;t.getInstance().publish("launchpad","allMyAppsFirstCatalogLoaded",{bFirstCatalogLoadedEvent:true})}};r.prototype._handleCatalogs=function(t){if(!t){this._handleNotFirstCatalogsLoad();return Promise.resolve()}this.bFirstCatalogLoaded=false;this.aPromises=[];return i.getServiceAsync("FlpLaunchPage").then(t=>{t.getCatalogs().done(()=>{jQuery.when.apply(jQuery,this.aPromises).then(this._onDoneLoadingCatalogs.bind(this))}).fail(()=>{this._onGetCatalogsFail(s.i18n.getText("fail_to_load_catalog_msg"))}).progress(this._addCatalogToModel.bind(this))})};r.prototype._addCatalogToModel=function(o){let r;let l={apps:[],numberCustomTiles:0,type:null};let n;const p=[i.getServiceAsync("FlpLaunchPage")];if(this._oAddCatalogToModelPromise){p.push(this._oAddCatalogToModelPromise)}this._oAddCatalogToModelPromise=Promise.all(p).then(t=>{r=t[0];l.type=a.CATALOG;const e=r.getCatalogTiles(o);this.aPromises.push(e);return e}).then(t=>{if(t.length===0){return}const e=r.getCatalogTitle(o);const s=this.oModel.getProperty("/AppsData");for(n=0;n<s.length;n++){if(s[n].type===a.CATALOG&&s[n].title===e){l=s[n];break}}l.title=r.getCatalogTitle(o);return this._getFormattedGroupApps(t)}).then(o=>{if(!o){return}Array.prototype.push.apply(l.apps,o.aFormattedApps);l.numberCustomTiles=o.iNumberOfCustomTiles;if(l.numberCustomTiles===1){l.sCustomLabel=s.i18n.getText("allMyApps_customStringSingle");l.sCustomLink=s.i18n.getText("allMyApps_customLinkAppFinderSingle")}else{l.sCustomLabel=s.i18n.getText("allMyApps_customString",[l.numberCustomTiles]);l.sCustomLink=s.i18n.getText("allMyApps_customLinkAppFinder")}l.handlePress=function(t,s){this.oPopover.close();e.setHash(`#Shell-home&/appFinder/catalog/${JSON.stringify({catalogSelector:s.title,tileFilter:"",tagFilter:"[]",targetGroup:""})}`)}.bind(this);if(l.apps.length>0||l.numberCustomTiles>0){this.oModel.setProperty(`/AppsData/${n}`,l);if(this.bFirstCatalogLoaded===false){t.getInstance().publish("launchpad","allMyAppsFirstCatalogLoaded",{bFirstCatalogLoadedEvent:true});this.bFirstCatalogLoaded=true}this.iNumberOfProviders+=1}});return this._oAddCatalogToModelPromise};r.prototype._onGetCatalogsFail=function(t){return i.getServiceAsync("MessageInternal").then(e=>{e.info(t)})};r.prototype._onDoneLoadingCatalogs=function(){const e=this.oModel.getProperty("/AppsData");e.sort((t,e)=>{const s=t.title.toUpperCase();const o=e.title.toUpperCase();if(s<o){return-1}if(s>o){return 1}return 0});this.oModel.setProperty("/AppsData",e);const s=t.getInstance();if(!this.bFirstCatalogLoaded){s.publish("launchpad","allMyAppsNoCatalogsLoaded")}};r.prototype._getAppEntityFromTile=function(t){return i.getServiceAsync("FlpLaunchPage").then(e=>{let s;const o=e.getCatalogTilePreviewTitle(t);const i=e.getCatalogTilePreviewSubtitle(t);const a=e.getCatalogTileTargetURL(t);if(a&&(o||i)){s={};s.url=a;if(o){s.title=o;s.subTitle=i}else{s.title=i}return s}})};return new r});
//# sourceMappingURL=AllMyAppsManager.js.map