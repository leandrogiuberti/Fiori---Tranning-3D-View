// Copyright (c) 2009-2025 SAP SE, All Rights Reserved
sap.ui.define(["sap/m/library","sap/ui/core/Element","sap/ui/core/mvc/Controller","sap/ui/Device","sap/ui/model/json/JSONModel","sap/ui/thirdparty/hasher","sap/ushell/api/NewExperience","sap/ushell/Config","sap/ushell/EventHub","sap/ushell/library","sap/ushell/ui/shell/OverflowListItem","sap/ushell/Container","sap/ushell/state/modules/BackNavigation","sap/ushell/state/ShellModel","sap/ushell/state/StateManager"],(e,t,n,a,s,i,o,r,l,d,h,m,f,u,c)=>{"use strict";const p=e.ListType;const E=d.FloatingNumberType;const g=c.LaunchpadState;const I=c.Operation;const v="endItemsOverflowBtn";return n.extend("sap.ushell.renderer.shellHeader.ShellHeader",{onInit:function(){this.aDoables=[];this.aDoables.push(l.on("navigateBack").do(this.pressNavBackButton.bind(this)));this.aDoables.push(l.on("showEndItemOverflow").do(this.pressEndItemsOverflow.bind(this)));this.aDoables.push(l.on("navigateFromShellApplicationNavigationMenu").do(this.navigateFromShellApplicationNavigationMenu.bind(this)));this.aDoables.push(l.on("setHeaderCentralAreaElement").do(this._handleSetHeaderCentralAreaElement.bind(this)));this.aDoables.push(r.on("/core/shellHeader/homeUri").do(this._updateHomeUri.bind(this)));this._updateHomeUri(r.last("/core/shellHeader/homeUri"));this.aDoables.push(l.on("updateHeaderOverflowState").do(this._handleHeadEndItemsOverflow.bind(this)));a.media.attachHandler(this._handleHeadEndItemsOverflow,this,a.media.RANGESETS.SAP_STANDARD);this.oHeadEndBinding=u.getModel().bindList("/header/headEndItems");this.oHeadEndBinding.attachChange(this._handleHeadEndItemsOverflow,this);o.attachActiveChanged(this._handleHeadEndItemsOverflow,this)},_handleSetHeaderCentralAreaElement:function(e){const{id:t,currentState:n,states:a}=e;if(n){c.updateCurrentState("header.centralAreaElement",I.Set,t)}else if(Array.isArray(a)){c.updateBaseStates(a,"header.centralAreaElement",I.Set,t)}else{c.updateAllBaseStates("header.centralAreaElement",I.Set,t)}},_addHeadEndItem:function(e,t,n){this._updateHeadEndItems(e,I.Add,t,n)},_removeHeadEndItem:function(e,t,n){this._updateHeadEndItems(e,I.Remove,t,n)},_updateHeadEndItems:function(e,t,n,a){if(n){c.updateCurrentState("header.headEndItems",t,e)}else if(Array.isArray(a)&&a.length>0){c.updateBaseStates(a,"header.headEndItems",t,e)}else{c.updateAllBaseStates("header.headEndItems",t,e)}},_handleHeadEndItemsOverflow:function(){const e=u.getModel().getProperty("/header/headEndItems");const n=e.indexOf(v)>-1;const s=a.media.getCurrentRange(a.media.RANGESETS.SAP_STANDARD).name;if(s==="Phone"&&(o.isActive()||!n&&e.length>2)){this._addHeadEndItem(v,false,[g.Home,g.App]);this._moveNewExperienceToOverflow()}else if(s!=="Phone"&&n){const e=t.getElementById("headEndItemsOverflow");if(e){if(o.isActive()){const e=o.getOverflowItemControl();e.getParent()?.removeItem?.(e)}e.destroy()}this._removeHeadEndItem(v,false,[g.Home,g.App]);this._moveNewExperienceToShellHeader()}},_moveNewExperienceToOverflow:function(){if(o.isActive()){this._addHeadEndItem(o.getOverflowItemId(),false,[g.Home,g.App])}o.showInOverflow()},_moveNewExperienceToShellHeader:function(){if(o.isActive()){this._removeHeadEndItem(o.getOverflowItemId(),false,[g.Home,g.App])}o.showInShellHeader()},_updateHomeUri:function(e){const n=t.getElementById("shell-header");if(n){n.setHomeUri(e)}},pressNavBackButton:async function(){l.emit("showUserActionsMenu",false);f.navigateBack()},pressEndItemsOverflow:function(e){let n=t.getElementById("headEndItemsOverflow");const a=t.getElementById(e);let i=Promise.resolve();let o;if(!a){return}if(!n){i=new Promise((e,t)=>{sap.ui.require(["sap/ui/core/Fragment"],n=>{n.load({name:"sap.ushell.renderer.HeadEndItemsOverflowPopover",type:"XML",controller:this}).then(e).catch(t)},t)}).then(e=>{n=e;const a=t.getElementById("headEndItemsOverflowList");a.enhanceAccessibilityState=function(e,t){if(!e.isA("sap.ushell.ui.shell.OverflowListItem")){return t}if(e.getFloatingNumberType()!==E.None){t.describedby=e._oAriaDescribedbyText.getId()}return t};o=new s({headEndItems:u.getModel().getProperty("/header/headEndItems")});n.setModel(o)})}i.then(()=>{if(n.isOpen()){n.close()}else{if(t.getElementById("shellNotificationsPopover")){l.emit("showNotifications",false)}n.openBy(a)}})},headEndItemsOverflowItemFactory:function(e,n){if(o.isActive()&&n.getObject()===o.getOverflowItemId()){return o.getOverflowItemControl()}const a=t.getElementById(n.getObject());const s=a.getBindingPath("floatingNumber");const i=a.getText();const r=a.getTooltip();const l=new h({id:`${e}-${a.getId()}`,icon:a.getIcon(),iconInset:true,tooltip:r!==i?r:null,title:i,type:p.Active,floatingNumber:s?{path:s}:undefined,floatingNumberMaxValue:a.getFloatingNumberMaxValue(),floatingNumberType:a.getFloatingNumberType(),visible:a.getVisible(),press:function(){if(a){a.firePress();const e=a.getTarget();if(e){m.getServiceAsync("Navigation").then(t=>{t.navigate({target:{shellHash:e}})})}}const e=t.getElementById("headEndItemsOverflow");if(e.isOpen()){e.close()}}});if(a._oAriaLabel){l.addAriaLabelledBy(a._oAriaLabel)}if(s){l.setModel(a.getModel())}return l},destroyHeadEndItemsOverflow:function(e){if(o.isActive()){const e=o.getOverflowItemControl();e.getParent()?.removeItem?.(e)}e.getSource().destroy()},isHeadEndItemInOverflow:function(e){return e!=="ENDITEMSOVERFLOWBTN"&&!this.isHeadEndItemNotInOverflow(e)},isHeadEndItemNotInOverflow:function(e){const t=this.isHeadEndItemOverflow();const n=a.media.getCurrentRange(a.media.RANGESETS.SAP_STANDARD).name;if(e==="ENDITEMSOVERFLOWBTN"){return t}if(!t){return true}if(["USERACTIONSMENUHEADERBUTTON","BACKBTN"].indexOf(e)>-1){return true}if(n==="Phone"){return false}if(["SF","FLOATINGCONTAINERBUTTON"].indexOf(e)>-1){return true}if(n==="Desktop"&&e==="COPILOTBTN"){return true}return false},isHeadEndItemOverflow:function(){let e=0;let n;const s=u.getModel().getProperty("/header/headEndItems");if(s.indexOf("endItemsOverflowBtn")===-1){return false}const i=a.media.getCurrentRange(a.media.RANGESETS.SAP_STANDARD).name;let o=3;if(i==="Phone"){o=1}for(let a=0;a<s.length;a++){n=t.getElementById(s[a]);if(n&&n.getVisible()){e++}}if(t.getElementById("endItemsOverflowBtn").getVisible()){return e>o+1}return e>o},navigateFromShellApplicationNavigationMenu:function(e){if(i.getHash()!==e.substr(1)){l.emit("centerViewPort",Date.now());i.setHash(e)}const n=t.getElementById("shellAppTitle");if(n){n.close()}},onExit:function(){this.aDoables.forEach(e=>{e.off()});this.oHeadEndBinding.destroy();o.detachActiveChanged(this._handleHeadEndItemsOverflow,this)}})});
//# sourceMappingURL=ShellHeader.controller.js.map