// Copyright (c) 2009-2025 SAP SE, All Rights Reserved
sap.ui.define(["sap/ui/base/EventProvider","sap/ui/Device","sap/ui/core/Element","sap/ui/thirdparty/hasher","sap/ushell/Config","sap/ushell/EventHub","sap/ushell/resources","sap/ushell/state/StateManager","sap/ushell/Container","sap/ushell/state/ShellModel"],(e,t,n,s,o,i,r,l,a,c)=>{"use strict";const u=l.LaunchpadState;const d=l.ShellMode;const{Default:h,Headerless:f,Minimal:p}=d;const y=e.extend("sap.ushell.renderer.AccessKeysHandler",{constructor:function(){e.apply(this,arguments);i.on("AppRendered").do(this.appOpenedHandler.bind(this));this.bFocusOnShell=true;this.bFocusPassedToExternalHandlerFirstTime=true;this.isFocusHandledByAnotherHandler=false;this.fnExternalKeysHandler=null;this.sLastExternalKeysHandlerUrl=null;this.fnExternalShortcuts=null;this.bForwardNavigation=true;this.aShortcutsDescriptions=[]}});y.prototype.init=function(){this.oConfigModel=c.getConfigModel();document.addEventListener("keydown",e=>{if(e.keyCode===16){return}this.bForwardNavigation=!e.shiftKey;if(e.key==="Tab"||e.key==="F6"){setTimeout(()=>{this._handleEventUsingExternalKeysHandler(e)},0)}else{this._handleEventUsingExternalKeysHandler(e)}const t=l.getShellMode();const n=l.getLaunchpadState();if(t!==f){let s=false;if(n===u.Home){s=l.isLegacyHome()}else{s=[h,p].includes(t)}this.handleShortcuts(e,s)}if(this.fnExternalShortcuts){this.fnExternalShortcuts(e)}},true);this._cancelHelpEvent=this._cancelHelpEvent.bind(this)};y.prototype.appOpenedHandler=function(){const e=s.getHash();if(e!==this.sLastExternalKeysHandlerUrl){this.fnExternalKeysHandler=null}this.sLastExternalKeysHandlerUrl=e};y.prototype._focusItemInOverflowPopover=function(e,t){const s=n.getElementById("headEndItemsOverflow");if(s&&s.isOpen()){if(s.getContent().length){this._focusItemInPopover(e,s.getContent()[0].getItems())}}else if(t<10){const n=window.document.getElementById("endItemsOverflowBtn");if(n){n.click();const s=this;window.setTimeout(()=>{s._focusItemInOverflowPopover(e,++t)},300)}}};y.prototype._focusItemInUserMenu=function(e,t){const s=n.getElementById("sapUshellUserActionsMenuPopover");if(s&&s.isOpen()){if(s.getContent().length){this._focusItemInPopover(e,s.getContent()[0].getItems())}}else if(t<10){const n=this;i.emit("showUserActionsMenu",Date.now());window.setTimeout(()=>{n._focusItemInUserMenu(e,++t)},300)}};y.prototype._focusItemInPopover=function(e,t){for(let n=0;n<t.length;n++){const s=t[n].getId().split("-");if(s[s.length-1]===e){t[n].getDomRef().focus();return}}};y.prototype._handleAccessOverviewKey=function(e){const n=this.oConfigModel.getProperty("/searchAvailable");const s=this.oConfigModel.getProperty("/personalization");const i=o.last("/core/catalog/enabled");const l=o.last("/core/shell/model/enableNotifications");let a=[];a=a.concat(this.aShortcutsDescriptions);let c;let u;if(t.os.macintosh){c=r.i18n.getText("OptionKey");u=r.i18n.getText("CommandKey")}else{c=r.i18n.getText("AltKey");u=r.i18n.getText("ControlKey")}if(window.document.getElementById("shell-header")){if(i&&e){a.push({text:`${c} + A`,description:r.i18n.getText("hotkeyFocusOnAppFinderButton")})}if(n){a.push({text:`${c} + F`,description:r.i18n.getText("hotkeyFocusOnSearchButton")})}a.push({text:`${c} + H`,description:r.i18n.getText("hotkeyHomePage")});a.push({text:`${c} + M`,description:r.i18n.getText("hotkeyFocusOnUserActionMenu")});if(l){a.push({text:`${c} + N`,description:r.i18n.getText("hotkeyFocusOnNotifications")})}if(e){a.push({text:`${c} + S`,description:r.i18n.getText("hotkeyFocusOnSettingsButton")});a.push({text:`${r.i18n.getText("ControlKey")} + ${r.i18n.getText("CommaKey")}`,description:r.i18n.getText("hotkeyOpenSettings")})}if(s&&i){a.push({text:`${r.i18n.getText("ControlKey")} + ${r.i18n.getText("EnterKey")}`,description:r.i18n.getText("hotkeyExitEditing")})}if(n){a.push({text:`${u} + ${r.i18n.getText("ShiftKey")} + F`,description:r.i18n.getText("hotkeyFocusOnSearchField")})}}sap.ui.require(["sap/m/Label","sap/m/MessageBox","sap/m/Text","sap/m/VBox"],(e,t,n,s)=>{const o=new s;a.forEach(t=>{o.addItem(new e({text:t.description}));o.addItem(new n({text:t.text}).addStyleClass("sapUiSmallMarginBottom"))});t.show(o,{id:"hotKeysGlossary",title:r.i18n.getText("hotKeysGlossary"),styleClass:"sapContrastPlus"})})};y.prototype._focusAppFinderButton=function(){if(!o.last("/core/catalog/enabled")){return}if(this._isFocusInDialog()){return}if(o.last("/core/shellBar/enabled")){n.getElementById("shell-header").setFocusToAppFinderButton();return}const e=window.document.getElementById("openCatalogBtn");if(e){e.focus();return}const t=a.getRendererInternal("fiori2").getShellConfig();if(t.moveAppFinderActionToShellHeader){this._focusItemInOverflowPopover("openCatalogBtn",0);return}this._focusItemInUserMenu("openCatalogBtn",0)};y.prototype._focusSettingsButton=function(){if(this._isFocusInDialog()){return}const e=window.document.getElementById("userSettingsBtn");if(e){e.focus();return}const t=a.getRendererInternal("fiori2").getShellConfig();if(t.moveUserSettingsActionToShellHeader){this._focusItemInOverflowPopover("userSettingsBtn",0);return}this._focusItemInUserMenu("userSettingsBtn",0)};y.prototype._blockBrowserDefault=function(e){return new Promise(n=>{if(t.browser.name==="ie"){let t=window.document.getElementById("shell-header");if(t){t.setAttribute("accesskey",e.key);window.setTimeout(()=>{t=window.document.getElementById("shell-header");if(t){t.removeAttribute("accesskey");n()}},0)}}else{n()}e.preventDefault()})};y.prototype._handleAltShortcutKeys=function(e,t){const s=n.getElementById("shell-header");const r=n.getElementById("sapUshellUserActionsMenuPopover");const l=n.getElementById("shellNotificationsPopover");if(this._isFocusInInput()){return}if(s){if(t){if(e.keyCode===65){this._blockBrowserDefault(e).then(this._focusAppFinderButton.bind(this))}else if(e.keyCode===83){this._blockBrowserDefault(e).then(this._focusSettingsButton.bind(this))}}if(e.keyCode===70){this._blockBrowserDefault(e).then(()=>{if(this._isFocusInDialog()){return}const e=window.document.getElementById("sf");const t=window.document.getElementById("searchFieldInShell-button");if(e){e.focus()}else if(t){t.focus()}else{this._focusItemInOverflowPopover("sf",0)}})}else if(e.keyCode===72){this._blockBrowserDefault(e).then(()=>{if(this._isFocusInDialog()){return}if(o.last("/core/shellBar/enabled")){s.setFocusToLogo()}else{const e=document.getElementById("shell-header-logo");if(e){e.focus()}}})}else if(e.keyCode===77){this._blockBrowserDefault(e).then(()=>{if(this._isFocusInDialog()){return}if(!(r&&r.isOpen())){i.emit("showUserActionsMenu",Date.now())}})}else if(e.keyCode===78){this._blockBrowserDefault(e).then(()=>{if(this._isFocusInDialog()){return}if(!(l&&l.isOpen())){i.emit("showNotifications",Date.now())}})}}};y.prototype._handleCtrlShortcutKeys=function(e,t){if(e.shiftKey){if(e.keyCode===70){if(this._isFocusInDialog()){return}const t=n.getElementById("sf");if(t){if(o.last("/core/shellBar/enabled")){t.fireClick()}else{t.firePress()}e.preventDefault();e.stopPropagation()}}}else if(e.keyCode===188&&t){if(this._isFocusInDialog()){return}const t=n.getElementById("userSettingsBtn");if(t&&!this._isFocusInATable()){t.firePress();e.preventDefault();e.stopPropagation()}}else if(e.keyCode===112){if(this._isFocusInDialog()){return}this._handleAccessOverviewKey(t)}else if(e.keyCode===83){if(this._isFocusInDialog()){return}const t=window.document.getElementById("appFinderSearch-I");if(t){t.focus();e.preventDefault();e.stopPropagation()}}else if(e.keyCode===13){if(this._isFocusInDialog()){return}if(o.last("/core/spaces/enabled")){this.fireEvent("editModeDone")}else{const t=n.getElementById("sapUshellDashboardFooterDoneBtn");if(t&&t.getDomRef()){t.firePress();e.preventDefault();e.stopPropagation()}}}};y.prototype.handleShortcuts=function(e,n){if(t.os.macintosh&&e.metaKey&&e.shiftKey&&e.keyCode===70){const t=window.document.getElementById("sf");if(t){t.firePress();e.preventDefault();e.stopPropagation()}e.preventDefault()}else if(e.altKey&&!e.shiftKey&&!e.ctrlKey){this._handleAltShortcutKeys(e,n)}else if(e.ctrlKey&&!e.altKey){this._handleCtrlShortcutKeys(e,n)}};y.prototype.registerAppKeysHandler=function(e){this.fnExternalKeysHandler=e;this.sLastExternalKeysHandlerUrl=s.getHash()};y.prototype.resetAppKeysHandler=function(){this.fnExternalKeysHandler=null};y.prototype.getAppKeysHandler=function(){return this.fnExternalKeysHandler};y.prototype.registerAppShortcuts=function(e,t){this.fnExternalShortcuts=e;this.aShortcutsDescriptions=t};y.prototype._handleFocusBackToMe=function(e,t){this.bFocusOnShell=true;let s;if(t){s=window.document.getElementById(t)}else{this.fromOutside=true;if(e){e.preventDefault();this.bForwardNavigation=!e.shiftKey||e.key==="F6"}const t=n.getElementById("shell-header");if(t&&!o.last("/core/shellBar/enabled")){t.setFocusOnShellHeader(!this.bForwardNavigation);this.fromOutside=false}}if(s){s.focus();this.fromOutside=false}this.bFocusPassedToExternalHandlerFirstTime=true};y.prototype.setIsFocusHandledByAnotherHandler=function(e){this.isFocusHandledByAnotherHandler=e};y.prototype.sendFocusBackToShell=function(e){let t;let n;if(typeof e==="string"){n=e}else if(typeof e==="object"){t=e}this._handleFocusBackToMe(t,n)};y.prototype._handleEventUsingExternalKeysHandler=function(e){if(!this.bFocusOnShell&&!this.isFocusHandledByAnotherHandler){if(typeof this.fnExternalKeysHandler==="function"){this.fnExternalKeysHandler(e,this.bFocusPassedToExternalHandlerFirstTime);this.bFocusPassedToExternalHandlerFirstTime=false}}this.setIsFocusHandledByAnotherHandler(false)};y.prototype._cancelHelpEvent=function(e){e.preventDefault();document.removeEventListener("help",this._cancelHelpEvent)};y.prototype._isFocusInInput=function(){const e=(document.activeElement||{}).tagName;return e==="INPUT"||e==="TEXTAREA"};y.prototype._isFocusInDialog=function(){let e=document.activeElement;for(;e!==document.body;e=e.parentNode){if(e.classList.contains("sapMDialog")){return true}}return false};y.prototype._isFocusInATable=function(){let e=document.activeElement;let t;for(;e!==document.body;e=e.parentNode){t=e.classList;if(t.contains("sapUiCompSmartTable")||t.contains("sapUiMdcTable")||t.contains("sapMListTbl")||t.contains("sapUiTable")){return true}}return false};return new y});
//# sourceMappingURL=AccessKeysHandler.js.map