// Copyright (c) 2009-2025 SAP SE, All Rights Reserved
sap.ui.define(["sap/ushell/utils/HttpClient","sap/ui/thirdparty/jquery","sap/base/Log","sap/base/util/ObjectPath","sap/ushell/Container"],(e,jQuery,t,r,a)=>{"use strict";function s(e,t,r){this.sBaseServicePath="/sap/opu/odata/UI2/INTEROP/";this.oConfig={};if(r&&r.userBaseServicePath!==undefined){this.oConfig.sBaseServicePath=r.userBaseServicePath}else{this.oConfig.sBaseServicePath=this.sBaseServicePath}this.oConfig.oHttpClientConfig={"sap-language":a.getUser().getLanguage(),"sap-client":a.getLogonSystem().getClient(),"sap-statistics":true,headers:{Accept:"application/json"},data:{}};this._mSystems={}}s.prototype.loadParameterValue=function(e,t){const r=new jQuery.Deferred;const a=this._isValidParameterName(e);if(a){this._getUserDefaultParameterContainer(t).done(t=>{const a=t.find(t=>t.id===e);if(a!==undefined){const e=JSON.parse(a.value);r.resolve(e)}else{r.reject(new Error(`Parameter does not exist: ${e}`))}}).fail(e=>{r.reject(e)})}else{r.reject(new Error(`Illegal Parameter Key. Parameter must be less than 40 characters and [A-Za-z0-9.-_]+ :"${e}"`))}return r.promise()};s.prototype._createRequest=function(e){return{data:{PersContainerItems:e,appName:"",category:"P",component:"",id:"sap.ushell.UserDefaultParameter"},headers:{"content-type":"application/json",accept:"application/json"}}};s.prototype.saveParameterValue=function(e,t,r){const a=new jQuery.Deferred;const s=this._isValidParameterName(e);if(s){const s=this._getXHttpWrapper(r);this._getUserDefaultParameterContainer(r).done(r=>{const n=r.findIndex(t=>t.id===e);if(n>-1){r[n].value=JSON.stringify(t)}else{const a={category:"I",containerCategory:"P",containerId:"sap.ushell.UserDefaultParameter",id:e,value:JSON.stringify(t)};r.push(a)}s.post("PersContainers",this._createRequest(r)).then(a.resolve).catch(a.reject)}).fail(a.reject)}else{a.reject(new Error(`Illegal Parameter Key. Parameter must be less than 40 characters and [A-Za-z0-9.-_]+ :"${e}"`))}return a.promise()};s.prototype.deleteParameter=function(e,t){const r=new jQuery.Deferred;const a=this._isValidParameterName(e);if(a){const a=this._getXHttpWrapper(t);this._getUserDefaultParameterContainer(t).done(t=>{const s=t.findIndex(t=>t.id===e);if(s>-1){t.splice(s,1);a.post("PersContainers",this._createRequest(t)).then(r.resolve).catch(r.reject)}else{r.resolve()}}).fail(r.reject)}else{r.reject(new Error(`Illegal Parameter Key. Parameter must be less than 40 characters and [A-Za-z0-9.-_]+ :"${e}"`))}return r.promise()};s.prototype.getStoredParameterNames=function(e){const t=new jQuery.Deferred;this._getUserDefaultParameterContainer(e).done(e=>{const r=e.map(e=>e.id);r.sort();t.resolve(r)}).fail(e=>{t.reject(e)});return t.promise()};s.prototype._getXHttpWrapper=function(t){if(!this._mSystems[t.id]){this._mSystems[t.id]={}}if(!this._mSystems[t.id].oHttpWrapper){const r=t.getFullyQualifiedXhrUrl(this.oConfig.sBaseServicePath);this._mSystems[t.id].oHttpWrapper=new e(r,this.oConfig.oHttpClientConfig)}return this._mSystems[t.id].oHttpWrapper};s.prototype._isValidParameterName=function(e){const r=!!(typeof e==="string"&&e.length<=40&&/^[A-Za-z0-9.-_]+$/.exec(e));if(!r){t.error(`Illegal Parameter Key. Parameter must be less than 40 characters and [A-Za-z0-9.-_]+ :"${e}"`)}return r};s.prototype._getUserDefaultParameterContainer=function(e){const a=new jQuery.Deferred;let s;try{s=this._getXHttpWrapper(e)}catch(e){a.reject(e);return a.promise()}const n=this._mSystems[e.id];if(!n.oContainerCache){n.oContainerCache=a;const e=s.get("PersContainers(category='P',id='sap.ushell.UserDefaultParameter')?$expand=PersContainerItems");e.then(e=>{n.bDataReceived=true;const t=e.responseText?JSON.parse(e.responseText):{};const a=r.get("d.PersContainerItems.results",t)||[];n.oContainerCache.resolve(a)}).catch(e=>{if(e.details?.status===404){n.oContainerCache.resolve([])}else{t.error("Server error:",e);n.oContainerCache.reject(e)}})}return n.oContainerCache.promise()};return s},false);
//# sourceMappingURL=UserDefaultParameterPersistenceAdapter.js.map