// Copyright (c) 2009-2025 SAP SE, All Rights Reserved
sap.ui.define(["sap/ushell/adapters/cdm/_LaunchPage/readHome","sap/ushell/adapters/cdm/_LaunchPage/modifyHome","sap/ushell/adapters/cdm/_LaunchPage/readCatalogs","sap/m/GenericTile","sap/m/library","sap/ui/core/ComponentContainer","sap/ushell/adapters/cdm/_LaunchPage/uri.transform","sap/ushell/Config","sap/ushell/EventHub","sap/ushell/navigationMode","sap/ushell/resources","sap/ushell/utils","sap/ushell/utils/utilsCdm","sap/ushell/utils/WindowUtils","sap/ushell/utils/UrlParsing","sap/ushell/components/tiles/utils","sap/base/util/Version","sap/ui/model/json/JSONModel","sap/ui/thirdparty/jquery","sap/base/util/deepExtend","sap/base/util/isPlainObject","sap/base/util/isEmptyObject","sap/base/util/ObjectPath","sap/base/Log","sap/ushell/UI5ComponentType","sap/ushell/EventHub","sap/ushell/Container","sap/ushell/utils/LaunchpadError"],(e,t,i,o,r,n,s,l,a,u,c,d,p,f,h,g,m,T,jQuery,v,R,_,b,S,C,y,I,w)=>{"use strict";const D=r.GenericTileMode;const j=S.getLogger("sap/ushell/adapters/cdm/LaunchPageAdapter");const L=S.Level;function G(r,G,k){let F;const O="sap.ushell.components.tiles.cdm.applauncher";const P="sap.ushell.components.tiles.cdm.applauncherdynamic";this._mResolvedTiles={};this._mCatalogTilePromises={};this._mFailedResolvedCatalogTiles={};this._mFailedResolvedTiles={};Promise.all([I.getServiceAsync("URLParsing"),I.getServiceAsync("CommonDataModel")]).then(e=>{this.oURLParsingService=e[0];this.oCDMService=e[1]});this.getCdmVersionsSupported=function(){return{min:m("0"),max:m("2.0.0")}};this.isSiteSupported=function(e){if(e._version&&m(e._version).compareTo(this.getCdmVersionsSupported().max)>0){S.fatal("Invalid CDM site version: Only sites up to version 2.0.0 are supported");return false}return true};this.TileType={Tile:"tile",Link:"link"};this.getGroups=function(){const e=new jQuery.Deferred;this._assureLoaded().done(t=>{d.setPerformanceMark("FLP - homepage groups processed");e.resolve(t)}).fail(()=>{e.resolve([])});return e.promise()};this._getTileFromHashInContextOfSite=function(e,t,i){const o=new jQuery.Deferred;let r=t[i];if(!r){r=e(i);t[i]=r}r.done(e=>{const t={tileIntent:i,tileResolutionResult:e};o.resolve(t)}).fail(e=>{S.error(`Hash '${i}' could not be resolved to a tile.`,e);o.reject(e)});return o.promise()};this._getTileFromHash=function(e){const t=new jQuery.Deferred;I.getServiceAsync("ClientSideTargetResolution").then(i=>{function o(...e){const t=new jQuery.Deferred;i.resolveTileIntent(...e).then(e=>{t.resolve(e)}).catch(e=>{t.reject(e)});return t.promise()}this._getTileFromHashInContextOfSite(o,this._mCatalogTilePromises,e).done(t.resolve).fail(t.reject)});return t.promise()};this._getTileForUrl=function(e){const t=e.indicatorDataSource?"#Shell-dynamicTile":"#Shell-staticTile";return{tileIntent:"#",tileResolutionResult:{tileComponentLoadInfo:t,isCustomTile:false}}};this._assureGroupItemsResolved=function(e,t){const i=[];let o;let r;if(e.payload&&e.payload.tiles){o=this._assureGroupTilesResolved(e.payload.tiles,t);Array.prototype.push.apply(i,o)}if(e.payload&&e.payload.links){r=this._assureGroupLinksResolved(e.payload.links,t);Array.prototype.push.apply(i,r)}return i};this._assureGroupTilesResolved=function(e,t){return(e||[]).map(function(e,i){return this._resolveGroupTile(e,t).then(e=>{e.isLink=false;return e})},this)};this._assureGroupLinksResolved=function(e,t){return(e||[]).map(function(e){return this._resolveGroupTile(e,t).then(e=>{e.isLink=true;return e})},this)};this._resolveGroupTile=function(e,t){const i=this._mResolvedTiles;const o=this._mFailedResolvedTiles;let r;function n(t){i[e.id]=t;if(o[e.id]){delete o[e.id]}return t}function s(e){const t=e.target;return t&&t.semanticObject==="Shell"&&t.action==="launchURL"}if(i[e.id]){return(new jQuery.Deferred).resolve(i[e.id]).promise()}if(e.target&&e.target.url){r=jQuery.when(this._getTileForUrl(e))}else if(e.isBookmark){r=this._resolveTileByIntent(e,t)}else if(s(e)){r=this._resolveTileByIntent(e,t)}else{r=this._resolveTileByAppId(e,t)}r.done(e=>{n(e)}).fail(t=>{if(t instanceof w){o[e.id]={logLevel:t.details?.logLevel||L.ERROR,message:t.message}}else{o[e.id]={logLevel:L.ERROR,message:t.toString()}}});return r};this._resolveTileByAppId=function(e,t){function i(e,t){const i=new w(t,{logLevel:e});return(new jQuery.Deferred).reject(i).promise()}if(!R(e)){return i(L.ERROR,"Cannot resolve tile: oTile must be an object")}if(!R(t)){return i(L.ERROR,"Cannot resolve tile: oSite must be an object")}const o=e.appId||e.appIDHint;if(!o){return i(L.ERROR,["Cannot resolve tile '",e.id,"': either appId or appIDHint must be specified"].join(""))}const r=t.applications&&t.applications[o];if(!r){return i(L.INFO,["Tile '",e.id,"' filtered from result: no app found for appId '",o,"' (dangling app reference)"].join(""))}const n=this._getFirstInbound(r);if(!n){return i(L.ERROR,["Cannot resolve tile '",e.id,"': app '",o,"' has no navigation inbound"].join(""))}const s=p.mapOne(n.key,n.inbound,r);const a=s.resolutionResult.applicationType;const c=s.resolutionResult.additionalInformation;const d=l.last("/core/navigation/enableInPlaceForClassicUIs");const f=d?d[a]:false;const h=s.tileResolutionResult;h.navigationMode=u.computeNavigationModeForHomepageTiles(a,c,f);h.isLink=false;if(!this._isFormFactorSupported(h)){return i(L.INFO,["Tile '",e.id,"' filtered from result: form factor not supported"].join(""))}const g=this._toHashFromInbound(n.inbound);return jQuery.when({tileResolutionResult:h,tileIntent:g})};this._isFormFactorSupported=function(t){const i=d.getFormFactor();return e.supportsFormFactor(t,i)};this._getFirstInbound=function(e){const t=Object.keys(e["sap.app"].crossNavigation.inbounds).shift();const i=e["sap.app"].crossNavigation.inbounds[t];return{key:t,inbound:i}};this._resolveTileByIntent=function(e,t){const i=this._prepareTileHash(e);return this._getTileFromHash(i)};this._prepareTileHash=function(e){const t={};let i;let o;if(this._isCatalogTile(e)){return e.tileIntent}if(this._isGroupTile(e)&&e.target){o=e.target.parameters||[];o.forEach(e=>{if(e.name&&e.value){t[e.name]=[e.value]}});i={target:{semanticObject:e.target.semanticObject,action:e.target.action},params:t,appSpecificRoute:e.target.appSpecificRoute};return`#${h.constructShellHash(i)}`}return undefined};this._allPromisesDone=function(e){const t=new jQuery.Deferred;let i;if(e.length===0){t.resolve([])}else{const o=e.map(e=>{i=new jQuery.Deferred;e.always(i.resolve.bind(i));return i.promise()});jQuery.when.apply(this,o).done(function(){const e=Array.prototype.slice.call(arguments);t.resolve(e)})}return t.promise()};this._assureLoaded=function(){const i=this;if(this._assureLoadedDeferred){return this._assureLoadedDeferred.promise()}const o=new jQuery.Deferred;this._assureLoadedDeferred=o;I.getServiceAsync("CommonDataModel").then(o=>{o.getSite().done(o=>{if(!i.isSiteSupported(o)){throw new Error("Invalid CDM site version: Check configuration of launchpage adapter and version of FLP site")}let r=[];let n=e.getGroupsArrayFromSite(o);let s=e.getDefaultGroup(n);if(!s){s=t.createDefaultGroup(d.generateUniqueId(e.getGroupIdsFromSite(o)));o=t.addGroupToSite(o,s,0);n=e.getGroupsArrayFromSite(o)}F=s;n.forEach(e=>{r=i._assureGroupItemsResolved(e,o).concat(r)});i._allPromisesDone(r).done(()=>{i._assureLoadedDeferred.resolve(n);delete i._assureLoadedDeferred;i._logTileResolutionFailures(i._mFailedResolvedTiles)})}).fail(e=>{S.error("Delivering homepage groups failed",e);i._assureLoadedDeferred.resolve([]);delete i._assureLoadedDeferred})});return o.promise()};this._logTileResolutionFailures=function(e){const t={};if(!e){return}Object.keys(L).filter(e=>{const t=L[e];return t>=L.FATAL&&t<=L.ALL}).forEach(e=>{t[L[e]]=""});Object.keys(e).forEach(i=>{const o=e[i];if(o.logLevel){t[o.logLevel]=t[o.logLevel].concat(o.message).concat("\n")}});if(t[L.FATAL]){j.fatal(t[L.FATAL])}if(t[L.ERROR]){j.error(t[L.ERROR])}if(t[L.WARNING]){j.warning(t[L.WARNING])}if(t[L.INFO]){j.info(t[L.INFO])}if(t[L.DEBUG]){j.debug(t[L.DEBUG])}if(t[L.TRACE]){j.trace(t[L.TRACE])}};this.getDefaultGroup=function(){const e=new jQuery.Deferred;let t;if(!F){t=this._assureLoaded()}if(t){t.done(()=>{e.resolve(F)}).fail(t=>{S.error("Failed to access default group.",t);e.reject(t)})}else{e.resolve(F)}return e.promise()};this._isValidTitle=function(e){if(typeof e!=="string"||!e){return false}return true};this._isGroupPreset=function(t){return e.isGroupPreset(t)};this._isGroupLocked=function(t){return e.isGroupLocked(t)};this.addGroup=function(i){const o=new jQuery.Deferred;const r=this.oCDMService;let n;const s=this;if(!this._isValidTitle(i)){return o.reject(new Error("No valid group title")).promise()}const l=`Failed to add the group with title '${i}' to the homepage. `;r.getSite().done(l=>{n=d.generateUniqueId(e.getGroupIdsFromSite(l));t.addGroupToSite(l,t.createEmptyGroup(n,i));r.save().done(()=>{delete s._assureLoadedDeferred;o.resolve(l.groups[n],n)}).fail(e=>{o.reject(e)})}).fail(e=>{S.error(l,e);o.reject(e)});return o.promise()};this.getGroupTitle=function(t){return e.getGroupTitle(t)};this.setGroupTitle=function(i,o){const r=this;const n=new jQuery.Deferred;const s=this.oCDMService;if(typeof i!=="object"||!e.getGroupId(i)){return n.reject(new Error("Unexpected group value")).promise()}if(!r._isValidTitle(o)){return n.reject(new Error("Unexpected oGroup title value")).promise()}const l=`Failed to set new title for group with id '${e.getGroupId(i)}'. `;const a=e.getGroupTitle(i);s.getSite().done(e=>{if(i){t.setGroupTitle(i,o)}s.save().done(()=>{n.resolve()}).fail(e=>{S.error("Failed to update the group title",e);n.reject(e,a)})}).fail(e=>{S.error(l,e);n.reject(e,a)});return n.promise()};this.getGroupId=function(t){return e.getGroupId(t)};this.hideGroups=function(i){const o=new jQuery.Deferred;const r=this.oCDMService;let n;if(i&&Array.isArray(i)){n="Failed to hide group. ";r.getSite().done(n=>{e.getGroupsArrayFromSite(n).forEach(o=>{t.setGroupVisibility(o,i&&Array.prototype.indexOf.call(i,e.getGroupId(o))===-1)});r.save().done(()=>{o.resolve()}).fail(e=>{S.error("Hiding of groups did not work as expected",e);o.reject(e)})}).fail(e=>{S.error(n,e);o.reject(e)})}else{o.reject(new Error("Invalid input parameter aHiddenGroupIds. Please pass a valid input parameter."))}return o.promise()};this.isGroupVisible=function(t){return e.isGroupVisible(t)};this.moveGroup=function(i,o){const r=new jQuery.Deferred;const n=this.oCDMService;if(!i||!e.getGroupId(i)||o<0){return r.reject(new Error("Unable to move groups - invalid parameters")).promise()}const s=`Failed to move group with id '${i.identification.id}'. `;n.getSite().done(s=>{const l=e.getGroupIdsFromSite(s);const a=e.getGroupId(i);if(!l){return r.reject(new Error("groupsOrder not found - abort operation of adding a group.")).promise()}else if(l.indexOf(a)===o){return r.resolve()}const u=d.moveElementInsideOfArray(l,l.indexOf(a),o);if(!u){return r.reject(new Error("invalid move group operation - abort.")).promise()}t.setGroupsOrder(s,u);n.save().done(()=>{r.resolve()}).fail(e=>{r.reject(e)});return undefined}).fail(e=>{S.error(s,e);r.reject(e)});return r.promise()};this.removeGroup=function(i){const o=new jQuery.Deferred;const r=this.oCDMService;if(typeof i!=="object"){return o.reject(new Error("invalid group parameter")).promise()}const n=e.getGroupId(i);if(!n){return o.reject(new Error("group without id given")).promise()}const s=`Failed to remove group with id '${n}'. `;r.getSite().done(e=>{t.removeGroupFromSite(e,i);r.save().done(()=>{o.resolve()}).fail(e=>{o.reject(e)})}).fail(e=>{S.error(s,e);o.reject(e)});return o.promise()};this.resetGroup=function(i){const o=new jQuery.Deferred;const r=this.oCDMService;const n=[];const s=this;let l;let a;if(typeof i==="object"&&e.getGroupId(i)){a=e.getGroupId(i);l=`Failed to reset group with id '${a}'. `;r.getSite().done(l=>{v(n,e.getGroupsArrayFromSite(l));if(s.isGroupRemovable(i)===false){r.getGroupFromOriginalSite(a).done(i=>{if(typeof l==="object"&&e.getGroupFromSite(l,a)){t.overwriteGroup(l,i,a)}r.save().done(()=>{o.resolve(i)}).fail(e=>{S.error("Group could not be reset",e);o.reject(e,n)})}).fail(e=>{S.error("Group could not be reset",e);o.reject(e,n)})}else{o.reject(new Error("Group could not be reset as it was created by the user"),n)}}).fail(e=>{S.error(l,e);o.reject(e,[])})}return o.promise()};this.getTileTitle=function(t){return e.getTileTitle(this._mResolvedTiles,t)};this.getTileSubtitle=function(t){return e.getTileSubtitle(this._mResolvedTiles,t)};this.getTileIcon=function(t){return e.getTileIcon(this._mResolvedTiles,t)};this.getTileInfo=function(t){return e.getTileInfo(this._mResolvedTiles,t)};this.getTileIndicatorDataSource=function(e){const t=this._mResolvedTiles[e.id];const i={};if(e.indicatorDataSource){i.indicatorDataSource=v({},e.indicatorDataSource);if(e.dataSource){i.dataSource=v({},e.dataSource)}return i}if(!t){return i}const o=t.tileResolutionResult;if(o.indicatorDataSource){i.indicatorDataSource=v({},o.indicatorDataSource);if(o.indicatorDataSource.hasOwnProperty("dataSource")){const e=o.indicatorDataSource.dataSource;const r=o.dataSources;if(r&&r.hasOwnProperty(e)){i.dataSource=v({},r[e])}else{S.warning(`datasource referenced but not found for tile: ${t.tileIntent}`)}}if(d.getMember(o,"runtimeInformation.componentProperties.url")){const e=d.getMember(i,"indicatorDataSource.path");const t=d.getMember(i,"dataSource.uri");const r=d.getMember(o,"runtimeInformation.componentProperties.url");const n=s(e,t,r,this.getWindowLocationHref());if(!n.error){if(e){i.indicatorDataSource.path=n.uri}if(t){i.dataSource.uri=n.uriParent}}}}return i};this.getWindowLocationHref=function(){return window.location.href};this.isGroupRemovable=function(e){return!this._isGroupPreset(e)};this.isGroupLocked=function(e){return this._isGroupLocked(e)};this.getGroupTiles=function(t){return e.getGroupTiles(t).concat(e.getGroupLinks(t))};this.getLinkTiles=function(t){return e.getGroupLinks(t)};this.getTileType=function(t){if(e.isLink(this._mResolvedTiles,t)){return this.TileType.Link}return this.TileType.Tile};this.getTileId=function(t){return e.getTileId(t)};this.getTileSize=function(t){return e.getTileSize(this._mResolvedTiles,t)||"1x1"};this.getTileTarget=function(t){let i;const o=e.getTileId(t);const r=this._mResolvedTiles[o];let n;if(t.target&&t.target.url){return t.target.url}if(r&&r.tileResolutionResult){i=r.tileResolutionResult;if(i.isCustomTile!==true){return r.tileIntent}if(i&&typeof i.targetOutbound==="object"){n=this._toHashFromOutbound(i.targetOutbound);if(n){return n}}}S.warning(`Could not find a target for Tile with id '${o}'`,"sap.ushell.adapters.cdm.LaunchPageAdapter");return""};this.isLinkPersonalizationSupported=function(e){return true};this.isTileIntentSupported=function(e){return this._mFailedResolvedTiles[e.id]===undefined};this.isTileIntentSupportedAsync=function(e){return Promise.resolve(this.isTileIntentSupported(e))};this._notifyTileAboutRefresh=function(e){if(typeof e.tileRefresh==="function"){e.tileRefresh()}};this.refreshTile=function(e){const t=this._mResolvedTiles[e.id];if(t){if(t.tileComponent){this._notifyTileAboutRefresh(t.tileComponent)}}};this._notifyTileAboutVisibility=function(e,t,i){if(typeof e.tileSetVisible==="function"&&i!==t){e.tileSetVisible(t)}};this.setTileVisible=function(e,t){const i=this._mResolvedTiles[e.id];if(i){if(i.tileComponent){this._notifyTileAboutVisibility(i.tileComponent,t,i.visibility)}i.visibility=t}};this.getTileView=function(e){const t=this;return new jQuery.Deferred(i=>t._getTileView(e,false).then(e=>{i.resolve(e)}).catch(t=>{S.error(`Tile with ID '${e.id}' could not be initialized`,t,e.tileType);i.reject(t)})).promise()};this._getTileUiComponentContainerSync=function(e,t,i){const r=this;let s;let l;let a;let u={};if(i===true){s=r._createTileComponentData(e,true,t)}else{s=r._createTileComponentData(e,false,t)}const d=t.tileResolutionResult;if(t.isLink){l=d.navigationMode;return r._createLinkInstance(e,i,l,o,c)}if(typeof d.tileComponentLoadInfo==="string"){if(s.properties.indicatorDataSource&&s.properties.indicatorDataSource.path){u.name="sap.ushell.components.tiles.cdm.applauncherdynamic"}else{u.name="sap.ushell.components.tiles.cdm.applauncher"}}else if(typeof d.tileComponentLoadInfo==="object"&&d.tileComponentLoadInfo!==null){u=d.tileComponentLoadInfo.componentProperties||{};u.name=d.tileComponentLoadInfo.componentName}u.componentData=s;if(u.manifest){u.componentData.properties=u.componentData.properties||{};u.componentData.properties.manifest=u.manifest}if(u.name){u.async=false;try{a=sap.ui.component(u)}catch(e){S.error(`${e.message}\n-- An error occurred while instantiating `+`the tile component for ${u.name}`,e.stack?e.stack:"","sap.ushell.adapters.cdm.LaunchPageAdapter");return null}const t=new n({component:a,height:"100%"});if(!i){r._mResolvedTiles[e.id].tileComponent=a}return t}return null};this._getTileUiComponentContainer=function(e,t,i){const r=this;let s;let l;let u;let d;const p=new jQuery.Deferred;if(i===true){s=r._createTileComponentData(e,true,t)}else{s=r._createTileComponentData(e,false,t)}const f=t.tileResolutionResult;if(t.isLink){l=f.navigationMode;p.resolve(r._createLinkInstance(e,i,l,o,c));return p.promise()}const h=this._createTileComponentProperties(s,f.tileComponentLoadInfo);if(!h.name){return p.reject(new Error(`Cannot find name of tile component for tile with id: '${e.id}'`)).promise()}if(h.manifest){s.properties=s.properties||{};s.properties.manifest=h.manifest}const g=this.isCustomTile(h.name);function m(t){let o;u=t.componentHandle.getInstance();d=new n({component:u,height:"100%"});if(!i){o=r._mResolvedTiles[e.id];o.tileComponent=u;if(typeof o.visibility==="boolean"){r._notifyTileAboutVisibility(u,o.visibility)}}return d}function T(e){const t=new jQuery.Deferred;e.createComponent({loadCoreExt:g,loadDefaultDependencies:false,componentData:s,url:h.url,applicationConfiguration:{},reservedParameters:{},applicationDependencies:h,ui5ComponentName:h.name},{},[],C.Visualization).then(e=>{const i=m(e);t.resolve(i)}).catch(e=>{t.reject(e)});return t.promise()}function v(){const e={componentData:s,url:h.url,name:h.name,async:false};u=sap.ui.component(e);const t={componentHandle:{getInstance:function(){return u}}};return m(t)}if(g){a.once("CoreResourcesComplementLoaded").do(()=>{I.getServiceAsync("Ui5ComponentLoader").then(e=>{T(e).done(e=>{p.resolve(e)}).fail(e=>{p.reject(e)})})})}else{const e=v();p.resolve(e)}return p.promise()};this._createTileComponentProperties=function(e,t){let i={};if(typeof t==="string"){if(e.properties.indicatorDataSource&&e.properties.indicatorDataSource.path){i.name=P}else{i.name=O}return i}if(typeof t==="object"&&t!==null){i=t.componentProperties||{};i.name=t.componentName}return i};this._getTileView=function(e){let t;const i=new jQuery.Deferred;if(typeof e!=="object"||!e.id){t=`Invalid input parameter passed to _getTileView: ${e}`;S.error(t);return i.reject(new Error(t)).promise()}const o=this._mResolvedTiles[e.id];if(o){return this._getTileUiComponentContainer(e,o,false)}t=`No resolved tile found for tile ID: ${e.id}`;S.error(t);return i.reject(new Error(t)).promise()};this._getCatalogTileView=function(e){if(typeof e!=="object"){throw new Error(e)}return this._getTileUiComponentContainerSync(e,e,true)};this._getCatalogTileViewControl=function(e){const t=new jQuery.Deferred;if(typeof e!=="object"){const i=`Invalid input parameter passed to _getCatalogTileView: ${e}`;S.error(i);return t.reject(new Error(i)).promise()}return this._getTileUiComponentContainer(e,e,true)};this._createTileComponentData=function(e,t,i){const o=t?this.getCatalogTileTitle(e):this.getTileTitle(e);const r=t?this.getCatalogTilePreviewSubtitle(e):this.getTileSubtitle(e);const n=t?this.getCatalogTilePreviewIcon(e):this.getTileIcon(e);const s=t?this.getCatalogTilePreviewInfo(e):this.getTileInfo(e);const l=t?this.getCatalogTileTargetURL(e):this.getTileTarget(e);const a=this.getTileIndicatorDataSource(e);const u={properties:{},startupParameters:{}};if(i.tileResolutionResult.isCustomTile===true&&i.tileResolutionResult.startupParameters){u.startupParameters=i.tileResolutionResult.startupParameters}if(o){u.properties.title=o}if(s){u.properties.info=s}if(r){u.properties.subtitle=r}if(n){u.properties.icon=n}if(l){u.properties.targetURL=l}if(a.indicatorDataSource){u.properties.indicatorDataSource=a.indicatorDataSource;if(a.dataSource){u.properties.dataSource=a.dataSource}}if(i.tileResolutionResult){u.properties.navigationMode=i.tileResolutionResult.navigationMode}return u};this._createLinkInstance=function(e,t,i,o,r){let n;let s;const l=this.getTileSubtitle(e);const a=o;if(t===true){n=this.getCatalogTileTitle(e)}else{n=this.getTileTitle(e)}const u=new a({mode:D.LineMode,subheader:l,header:n,url:f.getLeanURL(this.getTileTarget(e)),press:function(t){this._genericTilePressHandler(e,t)}.bind(this)});if(i){s=r.i18n.getText(`${i}NavigationMode`);u.setAriaLabel(`${s} ${n} ${l}`)}this._mResolvedTiles[e.id].linkTileControl=u;return u};this._genericTilePressHandler=function(e,t){let i;if(t.getSource().getScope&&t.getSource().getScope()==="Display"){i=this.getTileTarget(e);y.emit("UITracer.trace",{reason:"LaunchApp",source:"Tile",data:{targetUrl:i}});if(i){if(i[0]==="#"){hasher.setHash(i)}else{f.openURL(i,"_blank")}}}};function E(e){return Object.keys(e).map(t=>{const i=e[t]&&e[t][0];return{name:t,value:i||""}})}function A(e){const t={semanticObject:e.semanticObject,action:e.action,parameters:E(e.params)};if(e.appSpecificRoute){t.appSpecificRoute=e.appSpecificRoute}return t}this._addTileToSite=function(e,t,i,o){const r=this;const n=new jQuery.Deferred;const s=h.parseShellHash(i.properties.targetURL);const l={id:r.getTileId(i),target:{semanticObject:s.semanticObject,action:s.action,parameters:E(s.params)}};e.groups[t.identification.id].payload.tiles.push(l);o.save().done(()=>{n.resolve(l)}).fail(e=>{n.reject(e)});return n.promise()};function M(e,t,i){t=v({},t);if(i){e.target=i}if(t.title||t.title===""){e.title=t.title}if(t.icon||t.icon===""){e.icon=t.icon}if(t.subtitle||t.subtitle===""){e.subTitle=t.subtitle}if(t.info||t.info===""){e.info=t.info}if(t.dataSource){e.dataSource={};v(e.dataSource,t.dataSource)}if(t.serviceUrl||t.serviceUrl===""){e.indicatorDataSource={path:t.serviceUrl}}if(e.indicatorDataSource&&(t.serviceRefreshInterval||t.serviceRefreshInterval===0)){e.indicatorDataSource.refresh=t.serviceRefreshInterval}}function H(e,t){const i={id:d.generateUniqueId([])};M(i,e,t);return i}function U(e,t){const i=H(e,t);i.isBookmark=true;return i}this.addTile=function(e,t){const i=new jQuery.Deferred;const o=this.oCDMService;if(!t){t=F}const r=H();r.appId=e.tileResolutionResult.appId;this._mResolvedTiles[r.id]={tileIntent:e.tileIntent,tileResolutionResult:e.tileResolutionResult,isLink:false};o.getSite().done(e=>{e.groups[t.identification.id].payload.tiles.push(r);o.save().done(()=>{i.resolve(r)}).fail(e=>{i.reject(e)})}).fail(e=>{S.error(`Failed to add tile with id '${r.id}' to group with id '${t.identification.id}'. `,e);i.reject(e)});return i.promise()};this.removeTile=function(e,t,i){const o=this.oCDMService;const r=new jQuery.Deferred;const n=this;if(!e||typeof e!=="object"||!e.identification||!e.identification.id||!t||typeof t!=="object"||!t.id){return r.reject(new Error("Failed to remove tile. No valid input parameters passed to removeTile method."),{}).promise()}const s=`Failed to remove tile with id '${t.id}' from group with id '${e.identification.id}'. `;o.getSite().done(l=>{let a;i=+i;try{a=l.groups[e.identification.id].payload}catch(t){S.error(s,t);r.reject(t,l.groups[e.identification.id])}const u=n.getTileType(t)===n.TileType.Link?"links":"tiles";if(n.getTileType(t)===n.TileType.Link){i-=a.tiles.length}if(i>=0){a[u].splice(i,1)}else{a[u]=a[u].filter(e=>e.id!==t.id)}o.save().done(()=>{r.resolve()}).fail(t=>{S.error("Failed to remove tile",t);r.reject(t,l.groups[e.identification.id])})}).fail(e=>{S.error(s,e);r.reject(e,{})});return r.promise()};this.moveTile=function(e,t,i,o,r,n){const s=new jQuery.Deferred;const l=this.oCDMService;const a=this;if(!e||_(e)||t===undefined||t<0||i===undefined||i<0||!o||!o.identification||!o.identification.id||!r||!r.identification||!r.identification.id){return s.reject(new Error("Invalid input parameters")).promise()}const u=`Failed to move tile with id '${e.id}'. `;l.getSite().done(c=>{let d;const p=a.getTileType(e)===a.TileType.Link?"links":"tiles";if(!n){n=a._mResolvedTiles[e.id].isLink?"link":"tile"}const f=n==="link"?"links":"tiles";if(p!==f&&a._mResolvedTiles[e.id]){a._mResolvedTiles[e.id].isLink=n==="link"}if(f==="links"){i-=c.groups[r.identification.id].payload.tiles.length}if(p==="links"){t-=c.groups[o.identification.id].payload.tiles.length}if(o.identification.id===r.identification.id){if(t!==i||p!==f){d=c.groups[r.identification.id].payload;d[p].splice(t,1);d[f].splice(i,0,e)}else{return s.resolve(e).promise()}}else{c.groups[o.identification.id].payload[p].splice(t,1);c.groups[r.identification.id].payload[f].splice(i,0,e)}l.save().done(()=>{s.resolve(e)}).fail(e=>{S.error(u,e);s.reject(e)});return undefined}).fail(e=>{S.error(u,e);s.reject(e)});return s.promise()};this._compareCatalogs=function(e,t){if(e.identification.id>t.identification.id){return 1}return-1};this.getCatalogs=function(){const e=this;const t=new jQuery.Deferred;const i=[];function o(e,t,i,o){const r=e.catalogs[t];i.push(r);o.notify(r)}I.getServiceAsync("CommonDataModel").then(r=>{r.getSite().done(r=>{Object.keys(r.catalogs).forEach(e=>{o(r,e,i,t)});t.resolve(i.sort(e._compareCatalogs))})}).catch(t.reject);return t.promise()};this._isStartableInbound=function(e){const t=["Shell-plugin","Shell-bootConfig"];if(!e.semanticObject||!e.action){return false}if(t.indexOf(`${e.semanticObject}-${e.action}`)>-1){return false}if(!b.get("signature.parameters",e)){return true}const i=Object.keys(e.signature.parameters).every(t=>!e.signature.parameters[t].filter||(!!e.signature.parameters[t].launcherValue||t==="sap-external-url"));return i};this._isHiddenInbound=function(e){return!!e.hideLauncher};this._toHashFromInbound=function(e){const t=p.toHashFromInbound(e);if(!t){return undefined}return`#${t}`};this._getExternalUrlFromInbound=function(e){return b.get("signature.parameters.sap-external-url.launcherValue.value",e)||null};this._toHashFromOutbound=function(e){const t=p.toHashFromOutbound(e);if(!t){return undefined}return`#${t}`};this._isCustomTile=function(e){if(d.getMember(e,"sap|flp.type")==="tile"){return true}return false};function V(e,t){const i=this;const o=new jQuery.Deferred;setTimeout(()=>{const r=(e.payload&&e.payload.appDescriptors||[]).reduce((e,o)=>{const r=t.applications[o.id];let n;let s;let a;let c;let d;let f;let h;if(!r){return e}const g=i._getMember(r,"sap|app.crossNavigation.inbounds");if(!g||Object.keys(g).length===0){return e}const m=Object.keys(g)[0];const T=g[m];if(i._isStartableInbound(T)&&!i._isHiddenInbound(T)){const t=p.mapOne(m,T,r);if(!t||!t.tileResolutionResult){return e}c=t.resolutionResult.applicationType;h=l.last("/core/navigation/enableInPlaceForClassicUIs");f=h?h[c]:false;d=t.resolutionResult.additionalInformation;t.tileResolutionResult.navigationMode=u.computeNavigationModeForHomepageTiles(c,d,f);s=t.tileResolutionResult;n=i._toHashFromInbound(T);a={id:n,tileIntent:n,tileResolutionResult:s,isCatalogTile:true};e.push(a)}return e},[]);o.resolve(r)},0);return o.promise()}this.getCatalogTiles=function(e){const t=this;const i=new jQuery.Deferred;if(typeof e!=="object"||e===null){return i.reject(new Error(`Invalid input parameter '${e}' passed to getCatalogTiles.`)).promise()}t.oCDMService.getSite().done(o=>{V.call(t,e,o).done(i.resolve).fail(i.reject)}).fail(e=>{S.error("Failed to get site",e);i.reject(e)});return i.promise()};this.isCustomTile=function(e){return!(e===O||e===P)};this.getCatalogError=function(e){if(e.error){return e.error}return undefined};this.getCatalogId=function(e){return i.getCatalogId(e)};this.getCatalogTitle=function(e){return i.getCatalogTitle(e)};this._isGroupTile=function(t){return e.isGroupTile(t)};this._isCatalogTile=function(e){return!!(e&&e.isCatalogTile)};this._isFailedGroupTile=function(t){return!!(t&&this._mFailedResolvedTiles&&this._mFailedResolvedTiles[e.getTileId(t)])};this._isFailedCatalogTile=function(t){return!!(t&&this._mFailedResolvedCatalogTiles&&this._mFailedResolvedCatalogTiles[e.getTileId(t)])};this.getCatalogTileId=function(t){if(this._isGroupTile(t)){if(this._isFailedGroupTile(t)){return undefined}if(t.isBookmark&&b.get("target.url",t)){return t.target.url}return(this._mResolvedTiles[e.getTileId(t)]||{}).tileIntent}if(this._isCatalogTile(t)){return t.id}return undefined};this.getCatalogTileTitle=function(e){if(this._isGroupTile(e)){if(this._isFailedGroupTile(e)){return""}return this._mResolvedTiles[e.id].tileResolutionResult.title}if(this._isCatalogTile(e)){if(this._isFailedCatalogTile(e)){return undefined}return e.tileResolutionResult.title}return undefined};this.getCatalogTileSize=function(e){return e.tileResolutionResult.size||"1x1"};this.getCatalogTileView=function(e){return this._getCatalogTileView(e)};this.getCatalogTileViewControl=function(e){return this._getCatalogTileViewControl(e)};this.getCatalogTileTargetURL=function(e){if(!e){throw new Error("The given tile is falsy")}if(this._isCatalogTile(e)){if(e.tileResolutionResult&&e.tileResolutionResult.isCustomTile){if(!e.tileResolutionResult.targetOutbound){return""}return this._toHashFromOutbound(e.tileResolutionResult.targetOutbound)}return e.tileIntent||""}return this.getTileTarget(e)};this.getCatalogTilePreviewTitle=function(e){if(this._isGroupTile(e)){return this.getTileTitle(e)}return e.tileResolutionResult&&e.tileResolutionResult.title||""};this.getCatalogTilePreviewSubtitle=function(e){if(this._isGroupTile(e)){return this.getTileSubtitle(e)}return e.tileResolutionResult&&e.tileResolutionResult.subTitle||""};this.getCatalogTilePreviewIcon=function(e){if(this._isGroupTile(e)){return this.getTileIcon(e)}return e.tileResolutionResult&&e.tileResolutionResult.icon||""};this.getCatalogTilePreviewInfo=function(e){if(this._isGroupTile(e)){return this.getTileInfo(e)}return e.tileResolutionResult&&e.tileResolutionResult.info||""};this.getCatalogTileKeywords=function(e){const t=[];let i=e;if(!i){S.error("Could not find the Tile","sap.ushell.adapters.cdm.LaunchPageAdapter");return t}if(this._mResolvedTiles&&this._mResolvedTiles[e.id]){i=this._mResolvedTiles[e.id]}if(i&&i.tileResolutionResult&&i.tileResolutionResult.title){t.push(i.tileResolutionResult.title)}if(i&&i.tileResolutionResult&&i.tileResolutionResult.subTitle){t.push(i.tileResolutionResult.subTitle)}return t};function $(e){return{url:e}}function x(e){return e.map(e=>e.name+e.value).sort().join()}function N(e,t){let i;let o;e=e||[];t=t||[];if(e.length===t.length){i=x(e);o=x(t);return i===o}return false}function B(e,t){if(e&&t){if(e.url){return e.url===t.url}return e.semanticObject===t.semanticObject&&e.action===t.action&&N(e.parameters,t.parameters)&&e.appSpecificRoute===t.appSpecificRoute}return e===t}this._visitBookmarks=function(e,t){const i=this.oCDMService;let o;const r=h.parseShellHash(e);if(r){o=A(r)}else{o=$(e)}return i.getSite().then(e=>{const i=e.groups;const r=Object.keys(i).filter(e=>!i[e].payload.locked).map(e=>i[e].payload.tiles.filter(e=>e.isBookmark&&B(o,e.target))).reduce((e,t)=>{Array.prototype.push.apply(e,t);return e},[]);if(!t){return r.length}return jQuery.when(r.map(t)).then(()=>r.length)})};this.addBookmark=function(e,t){const i=this;return new jQuery.Deferred(o=>{const r=i.oCDMService;jQuery.when(t||i.getDefaultGroup(),r.getSite()).done((t,n)=>{let s;const l=h.parseShellHash(e.url);let a;let u=false;if(!l){s=$(e.url);u=true}else{s=A(l)}const c=U(e,s);if(u){a=new jQuery.Deferred;a.resolve(i._getTileForUrl(c))}else{a=i._getTileFromHash(e.url)}a.done(e=>{e.isLink=false;i._mResolvedTiles[c.id]=e;n.groups[t.identification.id].payload.tiles.push(c);r.save().done(()=>{o.resolve(c)}).fail(e=>{o.reject(e)})}).fail(e=>{S.error("Bookmark creation failed because:",e);o.reject(e)})}).fail(e=>{o.reject(e)})}).promise()};this.countBookmarks=function(e){return this._visitBookmarks(e)};this.updateBookmarks=function(e,t){const i=this.oCDMService;const o=this._mResolvedTiles;function r(i){return new jQuery.Deferred(r=>{let n;let s;let l;let a=false;const u={};if(t.url||t.url===""){n=h.parseShellHash(t.url);if(!n){s=$(t.url)}else{s=A(n)}}if(i.icon!==t.icon){u.icon=t.icon;a=true}if(i.title!==t.title){u.title=t.title;a=true}if(i.subTitle!==t.subtitle){u.subtitle=t.subtitle;a=true}if(t.url&&e!==t.url){u.targetURL=t.url;a=true}if(i.info!==t.info){u.info=t.info;a=true}M(i,t,s);if(a&&o[i.id]){l=o[i.id].tileComponent;if(l){l.tileSetVisualProperties(u)}}r.resolve(i)}).promise()}return this._visitBookmarks(e,r).then(e=>i.save().then(()=>e))};this.deleteBookmarks=function(e){const t=this.oCDMService;const i=h.parseShellHash(e);let o;if(i){o=A(i)}else{o=$(e)}return t.getSite().then(e=>{const i=e.groups;const r=Object.keys(i).map(e=>{const t=i[e].payload;let r=0;t.tiles=t.tiles.filter(e=>{if(e.isBookmark&&B(o,e.target)){++r;return false}return true});return r}).reduce((e,t)=>{e+=t;return e},0);return t.save().then(()=>r)})};this.onCatalogTileAdded=function(e){};this._onTileSettingsSave=function(e,t){const i=new jQuery.Deferred;if(!e||!e.id||!t){return i.reject(new Error("Invalid tile or settings view")).promise()}const o=t.oTitleInput.getValue();const r=t.oSubTitleInput.getValue();const n=t.oInfoInput.getValue();const s=this.getTileTitle(e);const l=this.getTileInfo(e);const a=this.getTileSubtitle(e);if(s===o&&a===r&&l===n){return i.resolve().promise()}const u={};if(s!==o){u.title=o;e.title=o}if(a!==r){u.subtitle=r;e.subTitle=r}if(l!==n){u.info=n;e.info=n}if(this._mResolvedTiles[e.id].tileComponent){this._mResolvedTiles[e.id].tileComponent.tileSetVisualProperties(u)}else if(this._mResolvedTiles[e.id].linkTileControl){if(u.title){this._mResolvedTiles[e.id].linkTileControl.setHeader(u.title)}if(u.subtitle){this._mResolvedTiles[e.id].linkTileControl.setSubheader(u.subtitle)}if(u.title||u.subtitle){this._mResolvedTiles[e.id].linkTileControl.rerender()}}I.getServiceAsync("CommonDataModel").then(e=>{e.save().fail(e=>{S.error("Could not save personalization changes:",e);i.reject(e)}).done(()=>{i.resolve()})});return i.promise()};this.getTileActions=function(e){const t=[];let i;let o;if(this._isGroupTile(e)&&!this._isFailedGroupTile(e)){o=new T({config:{display_title_text:this.getTileTitle(e),display_subtitle_text:this.getTileSubtitle(e),display_info_text:this.getTileInfo(e)}});i=g.getTileSettingsAction(o,this._onTileSettingsSave.bind(this,e),this.getTileType(e));t.push(i)}return t}}G.prototype._getMember=function(e,t){return d.getMember(e,t)};return G},false);
//# sourceMappingURL=LaunchPageAdapter.js.map