// Copyright (c) 2009-2025 SAP SE, All Rights Reserved
sap.ui.define(["sap/base/Log","sap/base/i18n/Formatting","sap/ui/core/Locale","sap/ui/core/LocaleData","sap/ui/core/format/DateFormat","sap/ui/core/mvc/Controller","sap/ui/model/json/JSONModel","sap/ui/performance/Measurement","sap/ushell/Container","sap/ui/core/format/NumberFormat","sap/base/i18n/Localization","sap/ushell/resources"],(e,t,a,n,s,g,o,r,i,u,l,c)=>{"use strict";return g.extend("sap.ushell.adapters.cdm.Settings.UserLanguageAndRegion.UserLanguageAndRegion",{onInit:function(){this.oUser=i.getUser();const e=new a(t.getLanguageTag());const n=i.getRendererInternal("fiori2").getShellConfig().enableSetLanguage||false;const s=this.oUser.isLanguagePersonalized();const{sTimeFormat:g,sExampleDate:r,sDecimalFormat:u,sWorkWeek:l,sTimeZone:c}=this._getParsedLocaleProperties(e);const d=new o({languageList:null,selectedLanguage:this.oUser.getLanguage(),selectedLanguageText:this.oUser.getLanguageText(),selectedDateFormat:r,selectedTimeFormat:g,selectedDecimalFormat:u,selectedTimeZone:c,isLanguagePersonalized:s,selectedWorkWeek:l});if(n){this.getView().setBusy(true);this._loadLanguagesList().then(e=>{if(e?.length>1){d.setProperty("/languageList",e);if(!s){const t=e.some(e=>e.key==="default");if(t){d.setProperty("/selectedLanguage","default")}}}this.getView().setBusy(false)})}this.oView.setModel(d)},_loadLanguagesList:function(){r.start("FLP:UserLanguageAndRegion._getLanguagesList","_getLanguagesList","FLP");return i.getServiceAsync("UserInfo").then(t=>new Promise(a=>{r.start("FLP:UserLanguageAndRegion._getLanguagesList","_getLanguagesList","FLP");t.getLanguageList().done(e=>{r.end("FLP:UserLanguageAndRegion._getLanguagesList");a(e)}).fail(t=>{r.end("FLP:UserLanguageAndRegion._getLanguagesList");e.error("Failed to load language list.",t,"sap.ushell.components.ushell.settings.UserLanguageAndRegion.UserLanguageAndRegion.controller");a(null)})}))},_resetLanguage:function(){const e=this.oUser.getLanguage();const t=this.getView().getModel();const a=t.getData();const n=a.isLanguagePersonalized?e:"default";t.setProperty("/selectedLanguage",n);this._updateTextFields(n)},onCancel:function(){const e=this.getView().getModel();const t=e.getData();const a=t.languageList;if(a&&a.length>0){this._resetLanguage()}},onSaveSuccess:function(t){const a={refresh:true};e.debug("[000] onSaveSuccess: oUser.resetChangedPropertyLanguage:","UserLanguageAndRegion.controller");t.resetChangedProperty("language");a.obsoleteUrlParams=["sap-language"];a.clearSapUserContextCookie=true;return a},onSave:function(t){const a=this.oUser;const n=this.getView().getModel().getData();const s=n.selectedLanguage;const g=a.getLanguage();const o=s&&s!==(n.isLanguagePersonalized?g:"default");const r=n.languageList&&n.languageList.length>0&&o;e.debug("[000] UserLanguageAndRegion:onSave:bUpdateLanguage:",r,"UserLanguageAndRegion.controller");if(r){e.debug("[000] UserLanguageAndRegion:onSave:UserInfo: oUser.setLanguage:",s,"UserLanguageAndRegion.controller");a.setLanguage(s);return t().then(()=>{e.debug("[000] onSave:fnUpdateUserPreferences","UserLanguageAndRegion.controller");return this.onSaveSuccess(a)}).catch(t=>{e.debug("[000] onSave:catch:errorMessage",t,"UserLanguageAndRegion.controller");a.setLanguage(g);a.resetChangedProperty("language");this._updateTextFields(g);e.error("Failed to save Language and Region Settings",t,"sap.ushell.adapters.cdm.Settings.cdmUserLanguageRegion.UserLanguageAndRegion.controller");throw t})}this._resetLanguage();return Promise.resolve()},_handleLanguageSelectChange:function(e){const t=e.getSource().getSelectedKey();if(t){this._updateTextFields(t)}},_updateTextFields:function(e){t.setLanguageTag(e);const n=new a(e);const{sTimeFormat:s,sExampleDate:g,sDecimalFormat:o,sWorkWeek:r,sTimeZone:i}=this._getParsedLocaleProperties(n);const u=this.getView().getModel();u.setProperty("/selectedTimeFormat",s);u.setProperty("/selectedDateFormat",g);u.setProperty("/selectedDecimalFormat",o);u.setProperty("/selectedWorkWeek",r);u.setProperty("/selectedTimeZone",i)},_getParsedLocaleProperties:function(e){const t=n.getInstance(e);const a=t.getDatePattern("medium");const g=t.getTimePattern("medium");const o=s.getDateInstance({pattern:a});const r=t.getDecimalPattern();const i=u.getInstance({pattern:r});const d=t.getWeekendStart();const L=t.getWeekendEnd();const m=t.getDaysStandAlone("wide").filter((e,t)=>t!==d&&t!==L);return{sTimeFormat:g.indexOf("H")===-1?c.i18n.getText("fld12h"):c.i18n.getText("fld24h"),sExampleDate:o.format(new Date),sDecimalFormat:i.format(1000.2),sWorkWeek:`${m[0]} - ${m[m.length-1]}`,sTimeZone:l.getTimezone()}}})});
//# sourceMappingURL=UserLanguageAndRegion.controller.js.map