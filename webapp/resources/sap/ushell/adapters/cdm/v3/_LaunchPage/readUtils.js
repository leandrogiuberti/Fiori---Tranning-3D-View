// Copyright (c) 2009-2025 SAP SE, All Rights Reserved
sap.ui.define(["sap/ushell/adapters/cdm/v3/_LaunchPage/readVisualizations","sap/ushell/adapters/cdm/v3/_LaunchPage/readApplications","sap/ushell/adapters/cdm/v3/_LaunchPage/readHome","sap/ushell/adapters/cdm/v3/utilsCdm","sap/ushell/Config","sap/ushell/Container","sap/base/util/deepClone","sap/base/util/isPlainObject","sap/base/util/ObjectPath","sap/base/util/deepExtend","sap/base/util/isEmptyObject","sap/ushell/library"],(t,a,e,i,n,o,r,s,c,u,d,l)=>{"use strict";const p={};const g=l.DisplayFormat;const m={};p.getVizData=async function(n,o,s){if(o.isBookmark&&o.url){o=r(o);o.subTitle=o.subtitle;o.target=i.toTargetFromHash(o.url)}const c=this.getCdmParts(n,o);const d=c&&c[1]||{};const l=c&&c[3]||{};const p=t.get(n,e.getTileVizId(o))||{};const g={id:e.getTileId(o),vizId:e.getTileVizId(o)||"",vizType:o.vizType||t.getTypeId(p)||"",vizConfig:u({},d,o.vizConfig),title:t.getTitle(c)||"",subtitle:t.getSubTitle(c)||"",icon:t.getIcon(c)||"",keywords:t.getKeywords(c)||[],info:t.getInfo(c)||"",target:o.target||t.getTarget(p)||{},indicatorDataSource:this._getIndicatorDataSource(o,p,s),isBookmark:o.isBookmark||false,contentProviderId:o.contentProviderId||a.getContentProviderId(l)||"",displayFormatHint:o.displayFormatHint,numberUnit:t.getNumberUnit(c),_instantiationData:t.getInstantiationData(p)};g.target=this.harmonizeTarget(g.target);g.targetURL=i.toHashFromVizData(g,n.applications);g.contentProviderLabel=await this.getContentProviderLabel(g.contentProviderId);if(g.indicatorDataSource){if(g.indicatorDataSource.dataSource){g.dataSource=t.getDataSource(c,g.indicatorDataSource.dataSource)}else if(o.isBookmark&&o.dataSource){g.dataSource=o.dataSource}}if(o.isBookmark){this._addBookmarkInstantiationData(g,n)}if(!g._instantiationData||!Object.keys(g._instantiationData)){g._instantiationData={platform:"CDM",vizType:t.getType(n,g.vizType)}}this._evaluateDisplayFormat(g,n);return g};p.getContentProviderLabel=function(t){if(Object.hasOwn(m,t)){return m[t]}m[t]=new Promise(async a=>{try{const e=await o.getServiceAsync("ClientSideTargetResolution");const i=await e.getSystemContext(t);a(i?.label)}catch(e){a(t)}});return m[t]};p._getIndicatorDataSource=function(a,e,i){if(a.indicatorDataSource&&a.indicatorDataSource.path){if(a.contentProviderId&&i){a.indicatorDataSource.path=i.getFullyQualifiedXhrUrl(a.indicatorDataSource.path)}return a.indicatorDataSource}return t.getIndicatorDataSource(e)};p.getVizRef=function(t){const a={id:t.id,vizId:t.vizId,title:t.title,subTitle:t.subtitle,icon:t.icon,keywords:t.keywords,info:t.info,target:t.target,indicatorDataSource:t.indicatorDataSource,dataSource:t.dataSource,contentProviderId:t.contentProviderId,displayFormatHint:t.displayFormatHint,numberUnit:t.numberUnit};if(a.indicatorDataSource&&a.indicatorDataSource.originalPath){a.indicatorDataSource.path=a.indicatorDataSource.originalPath;delete a.indicatorDataSource.originalPath}if(t.isBookmark){a.isBookmark=t.isBookmark;if(t.vizConfig!==undefined&&!d(t.vizConfig)){a.vizType=t.vizType;if(t.cdmVizType){a.vizType=t.cdmVizType}a.vizConfig=t.vizConfig}}return a};p.getCdmParts=function(i,n){const o=t.get(i,e.getTileVizId(n))||{};const r=t.getConfig(o);const s=t.getAppDescriptor(i,t.getAppId(o));const c=a.getInbound(s,t.getInboundId(o));return[n,r,c,s]};p.harmonizeTarget=function(t){const a=t.parameters;let e={};if(!a){return t}if(Array.isArray(a)){a.forEach(t=>{if(e[t.name]){if(!Array.isArray(e[t.name].value.value)){e[t.name].value.value=[e[t.name].value.value]}e[t.name].value.value.push(t.value)}else{e[t.name]={value:{value:t.value,format:"plain"}}}})}else{e=Object.keys(a).reduce((t,e)=>{if(!a[e].value||!a[e].value.hasOwnProperty("value")){a[e]={value:a[e]}}return{...t,[e]:a[e]}},{})}t.parameters=e;return t};p._evaluateDisplayFormat=function(a,e){const i=a.displayFormatHint;const n=t.getType(e,a.vizType);const o=t.getTileSize(n);const r=o==="1x2"?g.StandardWide:g.Standard;const s=[r,g.Compact];a.supportedDisplayFormats=t.getSupportedDisplayFormats(n)||s;const c=t.getDefaultDisplayFormat(n)||r;if(a.supportedDisplayFormats.indexOf(i)===-1){a.displayFormatHint=c}};p._addBookmarkInstantiationData=function(a,e){if(a.vizType){const i=t.getType(e,a.vizType);const n=c.get(["sap.app","type"],i||{});if(i&&n!=="chipVizType"){a._instantiationData={platform:"CDM",vizType:i}}else{const e=t.getChipConfigFromVizReference(a);a._instantiationData={platform:"ABAP",chip:r(e),simplifiedChipFormat:true};a.cdmVizType=a.vizType;a.vizType=e.chipId}}else if(a.indicatorDataSource&&a.indicatorDataSource.path){a.vizType="sap.ushell.DynamicAppLauncher"}else{a.vizType="sap.ushell.StaticAppLauncher"}};p.getBookmarkVizTypeIds=function(a){const e=["sap.ushell.StaticAppLauncher","sap.ushell.DynamicAppLauncher"];const i=a.vizType;if(i&&!e.includes(i)){e.push(i)}const n=t.getChipConfigFromVizReference(a);const o=n&&n.chipId;if(o&&!e.includes(o)){e.push(o)}return e};return p});
//# sourceMappingURL=readUtils.js.map