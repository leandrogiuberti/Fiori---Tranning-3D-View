// Copyright (c) 2009-2025 SAP SE, All Rights Reserved
sap.ui.define(["sap/ushell/utils","sap/ushell/adapters/cdm/v3/_LaunchPage/readVisualizations","sap/base/util/deepExtend","sap/base/util/isEmptyObject","sap/base/util/ObjectPath","sap/base/util/merge","sap/base/util/deepEqual","sap/ushell/adapters/cdm/v3/_LaunchPage/readApplications","sap/ushell/utils/UrlParsing","sap/base/Log"],(e,t,i,a,s,r,n,o,p,u)=>{"use strict";const c={};c.getMember=function(t,i){return e.getMember(t,i)};c.getNestedObjectProperty=function(t,i,a){return e.getNestedObjectProperty(t,i,a)};c.mapOne=function(e,s,n,p,u,c){let l=false;s=i({},s);n=i({},n);p=i({},p);u=i({},u);p=p||{};u=u||{};const m={};m.semanticObject=this.getMember(s,"semanticObject");m.action=this.getMember(s,"action");const f=t.getConfig(p);m.title=t.getTitle([undefined,f,s,n]);m.info=t.getInfo([undefined,f,s,n]);m.icon=t.getIcon([undefined,f,s,n]);m.subTitle=t.getSubTitle([undefined,f,s,n]);m.shortTitle=t.getShortTitle([undefined,f,s,n]);m.keywords=t.getKeywords([undefined,f,s,n]);m.numberUnit=t.getNumberUnit([undefined,f,undefined,undefined]);m.deviceTypes=this.getMember(n,"sap|ui.deviceTypes")||{};["desktop","tablet","phone"].forEach(e=>{if(Object.prototype.hasOwnProperty.call(this.getMember(s,"deviceTypes")||{},e)){m.deviceTypes[e]=s.deviceTypes[e]}if(!Object.prototype.hasOwnProperty.call(m.deviceTypes,e)){m.deviceTypes[e]=true}m.deviceTypes[e]=!!m.deviceTypes[e]});m.signature=this.getMember(s,"signature")||{};m.signature.parameters=this.getMember(m,"signature.parameters")||{};m.signature.additionalParameters=this.getMember(s,"signature.additionalParameters")||"allowed";const d=this.getMember(m,"signature.parameters.sap-hide-intent-link");if(d&&d.hasOwnProperty("defaultValue")){m.hideIntentLink=d.defaultValue.value==="true"}if(d&&!d.required&&d.hasOwnProperty("defaultValue")){delete m.signature.parameters["sap-hide-intent-link"]}const h=this.getMember(n,"sap|platform|runtime");m.resolutionResult=i({},h);if(h){m.resolutionResult["sap.platform.runtime"]=i({},h)}if(this.getMember(n,"sap|ui.technology")==="GUI"){m.resolutionResult["sap.gui"]=this.getMember(n,"sap|gui")}if(this.getMember(n,"sap|ui.technology")==="WDA"){m.resolutionResult["sap.wda"]=this.getMember(n,"sap|wda")}if(this.getMember(n,"sap|ui.technology")==="URL"){if(n["sap.url"]){m.resolutionResult["sap.platform.runtime"]=m.resolutionResult["sap.platform.runtime"]||{};m.resolutionResult.url=n["sap.url"].uri;m.resolutionResult["sap.platform.runtime"].url=n["sap.url"].uri}else if(h&&h.uri){m.resolutionResult["sap.platform.runtime"].url=h.uri;m.resolutionResult.url=h.uri}}if(!m.resolutionResult["sap.ui"]){m.resolutionResult["sap.ui"]={}}m.resolutionResult["sap.ui"].technology=this.getMember(n,"sap|ui.technology");m.resolutionResult.applicationType=this._formatApplicationType(m.resolutionResult,n);m.resolutionResult.systemAlias=m.resolutionResult.systemAlias||this.getMember(s,"systemAlias");m.resolutionResult.systemAliasSemantics="apply";m.resolutionResult.text=m.title;m.resolutionResult.appId=this.getMember(n,"sap|app.id");let g;let b;const y=this.getMember(p,"vizConfig.sap|flp.indicatorDataSource");let M={};if(!a(u)){const e=this.getMember(u,"sap|app.type");if(e==="card"){l=true;M=r({},u,p.vizConfig)}else{M.componentName=this.getMember(u,"sap|ui5.componentName");const e=this.getMember(u,"sap|platform|runtime.componentProperties");if(e){M.componentProperties=e}if(this.getMember(u,"sap|platform|runtime.includeManifest")){M.componentProperties=M.componentProperties||{};M.componentProperties.manifest=r({},u,p.vizConfig);delete M.componentProperties.manifest["sap.platform.runtime"]}}}if(this.getMember(n,"sap|app.type")==="plugin"||this.getMember(n,"sap|flp.type")==="plugin"){return undefined}const O=this.getNestedObjectProperty([f,n,u],"sap|flp.tileSize");const v=this.getNestedObjectProperty([f,n,u],"sap|app.description");if(this.getMember(n,"sap|ui.technology")==="GUI"&&this.getMember(n,"sap|gui.transaction")){g=this.getMember(n,"sap|gui.transaction")}if(this.getMember(n,"sap|ui.technology")==="WDA"&&this.getMember(n,"sap|wda.applicationId")){g=this.getMember(n,"sap|wda.applicationId")}const R=this.getNestedObjectProperty([f,n,u],"sap|app.dataSources");if(this.getMember(n,"sap|app.id")){b=this.getMember(n,"sap|app.id")}const T=o.getContentProviderId(n)||"";m.tileResolutionResult={appId:b,title:m.title,subTitle:m.subTitle,icon:m.icon,size:O,info:m.info,keywords:m.keywords,tileComponentLoadInfo:M,indicatorDataSource:y,dataSources:R,description:v,runtimeInformation:h,technicalInformation:g,deviceTypes:m.deviceTypes,isCard:l,contentProviderId:T,numberUnit:m.numberUnit};const P=this.getMember(n,"sap|integration.urlTemplateId");const j=this.getTemplatePayloadFromSite(P,c);if(j){m.templateContext={payload:j,site:c,siteAppSection:n}}return m};c.getTemplatePayloadFromSite=function(e,t){if(!t||typeof e!=="string"){return null}const i=e.replace(/[.]/g,"|");return this.getMember(t.urlTemplates,`${i}.payload`)};c._formatApplicationType=function(e,t){const i=e.applicationType;if(i){return i}const a=this.getMember(t,"sap|platform|runtime.componentProperties.name")||this.getMember(t,"sap|ui5.componentName");if(this.getMember(t,"sap|flp.appType")==="UI5"||this.getMember(t,"sap|ui.technology")==="UI5"){e.applicationType="SAPUI5";e.additionalInformation=`SAPUI5.Component=${a}`;e.url=this.getMember(t,"sap|platform|runtime.componentProperties.url");e.applicationDependencies=this.getMember(t,"sap|platform|runtime.componentProperties");return"SAPUI5"}if(this.getMember(t,"sap|ui.technology")==="GUI"){e.applicationType="TR";e["sap.gui"]=this.getMember(t,"sap|gui");e.systemAlias=this.getMember(t,"sap|app.destination.name");return"TR"}if(this.getMember(t,"sap|ui.technology")==="WDA"){e.applicationType="WDA";e["sap.wda"]=this.getMember(t,"sap|wda");e.systemAlias=this.getMember(t,"sap|app.destination.name");return"WDA"}if(this.getMember(t,"sap|ui.technology")==="URL"){e.applicationType="URL";e.systemAlias=this.getMember(t,"sap|app.destination.name")}return"URL"};c.formatSite=function(e){const t=this;if(!e){return[]}const i=[];try{const a=Object.keys(e.applications||{}).sort();a.forEach(a=>{try{const s=e.applications[a];const r=this.getMember(s,"sap|app.crossNavigation.inbounds");if(r){const a=Object.keys(r).sort();a.forEach(a=>{const n=r[a];const p=t.mapOne(a,n,s,undefined,undefined,e);if(p){p.contentProviderId=o.getContentProviderId(s)||"";i.push(p)}})}}catch(e){u.error(`Error in application ${a}:`,e)}})}catch(e){u.error("FormatSite failed",e);return[]}return i};c.toHashFromInbound=function(e,t){const i={target:{semanticObject:e.semanticObject,action:e.action},params:{}};if(t){i.params["sap-ui-app-id-hint"]=t}const a=s.get("signature.parameters",e)||{};Object.keys(a).forEach(e=>{if(a[e].filter&&Object.prototype.hasOwnProperty.call(a[e].filter,"value")&&(a[e].filter.format===undefined||a[e].filter.format==="plain")){i.params[e]=[a[e].filter.value]}if(a[e].launcherValue&&Object.prototype.hasOwnProperty.call(a[e].launcherValue,"value")&&(a[e].launcherValue.format===undefined||a[e].launcherValue.format==="plain")){i.params[e]=[a[e].launcherValue.value]}});const r=p.constructShellHash(i);if(!r){return undefined}return r};c.toHashFromOutbound=function(e){const t={target:{semanticObject:e.semanticObject,action:e.action},params:{}};const i=e.parameters||{};Object.keys(i).forEach(e=>{if(i.hasOwnProperty(e)&&typeof i[e].value==="object"){t.params[e]=[i[e].value.value]}});const a=p.constructShellHash(t);if(!a){return undefined}return a};c.toHashFromVizData=function(e,t){if(!e.target){return undefined}const i=e.target;if(i.type==="URL"){return i.url}const a=i.appId;const s=i.inboundId;let r;if(a&&s){const e=o.getInboundTarget(t,a,s);r={};if(e){r.semanticObject=e.semanticObject;r.action=e.action;r.parameters=i.parameters||{};r.parameters["sap-ui-app-id-hint"]={value:{value:a,format:"plain"}};r.appSpecificRoute=i.appSpecificRoute||""}}else if(i.semanticObject&&i.action){r=i}return c.toHashFromTarget(r)};c.toHashFromTargetIntent=function(e,t){try{if(t.type==="URL"){return t.url}const i={};i.semanticObject=e.semanticObject;i.action=e.action;i.parameters=t.parameters||{};i.parameters["sap-ui-app-id-hint"]={value:{value:e.businessAppId,format:"plain"}};i.appSpecificRoute=t.appSpecificRoute||"";return c.toHashFromTarget(i)}catch(e){return undefined}};c.toHashFromTarget=function(e){try{const t={};const i=s.get("parameters",e)||{};Object.keys(i).forEach(e=>{t[e]=Array.isArray(i[e].value.value)?i[e].value.value:[i[e].value.value]});const a={target:{semanticObject:e.semanticObject,action:e.action},params:t,appSpecificRoute:e.appSpecificRoute};return`#${p.constructShellHash(a)}`}catch(e){return undefined}};c.toTargetFromHash=function(e){let t=p.parseShellHash(e);if(t!==undefined){const e=t.params||{};if(Object.keys(e).length>0){t.parameters=[];Object.keys(e).forEach(i=>{const a=Array.isArray(e[i])?e[i]:[e[i]];a.forEach(e=>{const a={name:i,value:e};t.parameters.push(a)})})}delete t.params}else{t={type:"URL",url:e}}return t};c.isSameTarget=function(e,t){let i;if(e.type!==t.type){return false}if(e.type==="URL"){i=e.url===t.url}else{i=e.semanticObject===t.semanticObject&&e.action===t.action&&e.appSpecificRoute===t.appSpecificRoute&&n(e.parameters,t.parameters)}return i};return c});
//# sourceMappingURL=utilsCdm.js.map