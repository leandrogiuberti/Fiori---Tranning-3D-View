// Copyright (c) 2009-2025 SAP SE, All Rights Reserved
sap.ui.define(["sap/ushell/adapters/cdm/v3/_LaunchPage/readHome","sap/ushell/adapters/cdm/_LaunchPage/modifyHome","sap/ushell/adapters/cdm/v3/_LaunchPage/readCatalogs","sap/m/library","sap/ushell/utils","sap/ushell/utils/WindowUtils","sap/ushell/utils/UrlParsing","sap/ushell/adapters/cdm/v3/utilsCdm","sap/ushell/components/tiles/utils","sap/ushell/adapters/cdm/v3/AdapterBase","sap/ushell/adapters/cdm/v3/_LaunchPage/readVisualizations","sap/ushell/adapters/cdm/v3/_LaunchPage/readApplications","sap/ushell/navigationMode","sap/ushell/Config","sap/ui/model/json/JSONModel","sap/ui/thirdparty/jquery","sap/base/util/deepExtend","sap/base/util/isEmptyObject","sap/base/util/ObjectPath","sap/base/Log","sap/ushell/EventHub","sap/ushell/Container"],(e,t,i,r,o,n,s,l,a,u,c,d,f,p,h,jQuery,g,m,v,T,b,y)=>{"use strict";const R=r.GenericTileMode;const S="sap.ushell.components.tiles.cdm.applauncher";const C="sap.ushell.components.tiles.cdm.applauncherdynamic";function _(r,_,w){u.call(this,r,_,w);this.oCDMServicePromise=y.getServiceAsync("CommonDataModel");Promise.all([y.getServiceAsync("URLParsing"),this.oCDMServicePromise]).then(e=>{this.oURLParsingService=e[0];this.oCDMService=e[1]});this._getTileFromHashInContextOfSite=function(e,t,i){const r=new jQuery.Deferred;let o=t[i];if(!o){o=e(i);t[i]=o}o.done(e=>{const t={tileIntent:i,tileResolutionResult:e};r.resolve(t)}).fail(e=>{T.error(`Hash '${i}' could not be resolved to a tile.`,e);r.reject(e)});return r.promise()};this._getTileFromHash=function(e){const t=new jQuery.Deferred;y.getServiceAsync("ClientSideTargetResolution").then(i=>{function r(...e){const t=new jQuery.Deferred;i.resolveTileIntent(...e).then(e=>{t.resolve(e)}).catch(e=>{t.reject(e)});return t.promise()}this._getTileFromHashInContextOfSite(r,this._mCatalogTilePromises,e).done(t.resolve).fail(t.reject)});return t.promise()};this._getTileForUrl=function(e){const t={componentName:e.indicatorDataSource?C:S};return{tileIntent:"#",tileResolutionResult:{tileComponentLoadInfo:t,isCustomTile:false}}};this._prepareTileHash=function(e){const t={};if(this._isCatalogTile(e)){return e.tileIntent}if(this._isGroupTile(e)&&e.target){const i=e.target.parameters||[];i.forEach(e=>{if(e.name&&e.value){t[e.name]=[e.value]}});const r={target:{semanticObject:e.target.semanticObject,action:e.target.action},params:t,appSpecificRoute:e.target.appSpecificRoute};return`#${s.constructShellHash(r)}`}return undefined};this.getDefaultGroup=function(){const e=new jQuery.Deferred;let t;const i=this;if(!this._oDefaultGroup){t=this._ensureLoaded()}if(t){t.then(()=>{e.resolve(i._oDefaultGroup)}).catch(t=>{T.error("Failed to access default group.",t);e.reject(t)})}else{e.resolve(i._oDefaultGroup)}return e.promise()};this.addGroup=function(i){const r=new jQuery.Deferred;let n;const s=this;if(!this._isValidTitle(i)){return r.reject(new Error("No valid group title")).promise()}const l=`Failed to add the group with title '${i}' to the homepage. `;this.oCDMService.getSite().done(l=>{n=o.generateUniqueId(e.getGroupIdsFromSite(l));t.addGroupToSite(l,t.createEmptyGroup(n,i));s.oCDMService.save().done(()=>{delete s._ensureLoadedDeferred;r.resolve(l.groups[n],n)}).fail(e=>{r.reject(e)})}).fail(e=>{T.error(l,e);r.reject(e)});return r.promise()};this.setGroupTitle=function(i,r){const o=this;const n=new jQuery.Deferred;if(typeof i!=="object"||!e.getGroupId(i)){return n.reject(new Error("Unexpected group value")).promise()}if(!o._isValidTitle(r)){return n.reject(new Error("Unexpected oGroup title value")).promise()}const s=`Failed to set new title for group with id '${e.getGroupId(i)}'. `;const l=e.getGroupTitle(i);this.oCDMService.getSite().done(e=>{if(i){t.setGroupTitle(i,r)}o.oCDMService.save().done(()=>{n.resolve()}).fail(e=>{T.error("Failed to set new title for group",e);n.reject(e,l)})}).fail(e=>{T.error(s,e);n.reject(e,l)});return n.promise()};this.hideGroups=function(i){const r=new jQuery.Deferred;const o=this.oCDMService;if(i&&Array.isArray(i)){const n="Failed to hide group. ";o.getSite().done(n=>{e.getGroupsArrayFromSite(n).forEach(r=>{const o=Array.prototype.indexOf.call(i,e.getGroupId(r))===-1;t.setGroupVisibility(r,o)});o.save().done(()=>{r.resolve()}).fail(e=>{T.error("Hiding of groups did not work as expected",e);r.reject(e)})}).fail(e=>{T.error(n,e);r.reject(e)})}else{r.reject(new Error("Invalid input parameter aHiddenGroupIds. Please pass a valid input parameter."))}return r.promise()};this.moveGroup=function(i,r){const n=new jQuery.Deferred;const s=this.oCDMService;if(!i||!e.getGroupId(i)||r<0){return n.reject(new Error("Unable to move groups - invalid parameters")).promise()}const l=`Failed to move group with id '${i.identification.id}'. `;s.getSite().done(l=>{const a=e.getGroupIdsFromSite(l);const u=e.getGroupId(i);if(!a){return n.reject(new Error("groupsOrder not found - abort operation of adding a group."))}if(a.indexOf(u)===r){return n.resolve()}const c=o.moveElementInsideOfArray(a,a.indexOf(u),r);if(!c){return n.reject(new Error("invalid move group operation - abort."))}t.setGroupsOrder(l,c);s.save().done(()=>{n.resolve()}).fail(e=>{n.reject(e)});return undefined}).fail(e=>{T.error(l,e);n.reject(e)});return n.promise()};this.removeGroup=function(i){const r=new jQuery.Deferred;const o=this.oCDMService;if(typeof i!=="object"){return r.reject(new Error("invalid group parameter")).promise()}const n=e.getGroupId(i);if(!n){return r.reject(new Error("group without id given")).promise()}const s=`Failed to remove group with id '${n}'. `;o.getSite().done(e=>{t.removeGroupFromSite(e,i);o.save().done(()=>{r.resolve()}).fail(e=>{r.reject(e)})}).fail(e=>{T.error(s,e);r.reject(e)});return r.promise()};this.resetGroup=function(i){const r=new jQuery.Deferred;const o=this.oCDMService;const n=[];const s=this;if(typeof i==="object"&&e.getGroupId(i)){const l=e.getGroupId(i);const a=`Failed to reset group with id '${l}'. `;o.getSite().done(a=>{g(n,e.getGroupsArrayFromSite(a));if(s.isGroupRemovable(i)===false){o.getGroupFromOriginalSite(l).done(i=>{if(typeof a==="object"&&e.getGroupFromSite(a,l)){t.overwriteGroup(a,i,l)}o.save().done(()=>{r.resolve(i)}).fail(e=>{T.error("Group could not be reset",e);r.reject(e,n)})}).fail(e=>{T.error("Group could not be reset",e);r.reject(e,n)})}else{r.reject(new Error("Group could not be reset as it was created by the user"),n)}}).fail(e=>{T.error(a,e);r.reject(e,[])})}return r.promise()};this.getLinkTiles=function(t){return e.getGroupLinks(t)};this.isLinkPersonalizationSupported=function(){return true};this._notifyTileAboutRefresh=function(e){if(typeof e.tileRefresh==="function"){e.tileRefresh()}};this.refreshTile=function(e){const t=this._mResolvedTiles[e.id];if(t){if(t.tileComponent){this._notifyTileAboutRefresh(t.tileComponent)}}};this._notifyTileAboutVisibility=function(e,t,i){if(typeof e.tileSetVisible==="function"&&i!==t){e.tileSetVisible(t)}};this.getTileView=function(e){const t=this;return new jQuery.Deferred(i=>t._getTileView(e,false).then(e=>{i.resolve(e)}).catch(t=>{T.error(`Tile with ID '${e.id}' of type '${e.tileType}' could not be initialized`,t);i.reject(t)})).promise()};this._getCatalogTileViewControl=function(e){const t=new jQuery.Deferred;if(typeof e!=="object"){const i=`Invalid input parameter passed to _getCatalogTileView: ${e}`;T.error(i);return t.reject(new Error(i)).promise()}return this._getTileUiComponentContainer(e,e,true)};this._createLinkInstance=function(e,t,i,r,o){let s;const l=this.getTileSubtitle(e);const a=r;if(t===true){s=this.getCatalogTileTitle(e)}else{s=this.getTileTitle(e)}const u=new a({mode:R.LineMode,subheader:l,header:s,url:n.getLeanURL(this.getTileTarget(e)),press:function(t){this._genericTilePressHandler(e,t)}.bind(this)});if(i){const e=o.i18n.getText(`${i}NavigationMode`);u.setAriaLabel(`${e} ${s} ${l}`)}this._mResolvedTiles[e.id].linkTileControl=u;return u};this._genericTilePressHandler=function(e,t){let i;if(t.getSource().getScope&&t.getSource().getScope()==="Display"){i=this.getTileTarget(e);if(i){b.emit("UITracer.trace",{reason:"LaunchApp",source:"Tile",data:{targetUrl:i}});if(i[0]==="#"){hasher.setHash(i)}else{n.openURL(i,"_blank")}}}};function k(e,t,i){t=g({},t);if(i){e.target=i}if(t.title||t.title===""){e.title=t.title}if(t.icon||t.icon===""){e.icon=t.icon}if(t.subtitle||t.subtitle===""){e.subTitle=t.subtitle}if(t.info||t.info===""){e.info=t.info}if(t.numberUnit||t.numberUnit===""){e.numberUnit=t.numberUnit}if(t.dataSource){e.dataSource={type:t.dataSource.type,settings:{odataVersion:v.get(["dataSource","settings","odataVersion"],t)}}}if(t.serviceUrl){e.indicatorDataSource={path:t.serviceUrl}}if(e.indicatorDataSource&&(t.serviceRefreshInterval||t.serviceRefreshInterval===0)){e.indicatorDataSource.refresh=t.serviceRefreshInterval}if(t.vizConfig){e.vizConfig=t.vizConfig}}function I(e,t){const i={id:o.generateUniqueId([])};k(i,e,t);return i}this.addTile=function(e,t){const i=new jQuery.Deferred;const r=this.oCDMService;if(!t){t=this._oDefaultGroup}const o=I();o.vizId=e.vizId;this._mResolvedTiles[o.id]={tileIntent:e.tileIntent,tileResolutionResult:e.tileResolutionResult,isLink:false};r.getSite().done(e=>{e.groups[t.identification.id].payload.tiles.push(o);r.save().done(()=>{i.resolve(o)}).fail(e=>{i.reject(e)})}).fail(e=>{T.error(`Failed to add tile with id '${o.id}' to group with id '${t.identification.id}'. `,e);i.reject(e)});return i.promise()};this.removeTile=function(e,t,i){const r=this.oCDMService;const o=new jQuery.Deferred;const n=this;if(!e||typeof e!=="object"||!e.identification||!e.identification.id||!t||typeof t!=="object"||!t.id){return o.reject(new Error("Failed to remove tile. No valid input parameters passed to removeTile method."),{}).promise()}const s=`Failed to remove tile with id '${t.id}' from group with id '${e.identification.id}'. `;r.getSite().done(l=>{let a;i=+i;try{a=l.groups[e.identification.id].payload}catch(t){T.error(s,t);o.reject(t,l.groups[e.identification.id])}const u=n.getTileType(t)===n.TileType.Link?"links":"tiles";if(n.getTileType(t)===n.TileType.Link){i-=a.tiles.length}if(i>=0){a[u].splice(i,1)}else{a[u]=a[u].filter(e=>e.id!==t.id)}r.save().done(()=>{o.resolve()}).fail(t=>{T.error(s,t);o.reject(t,l.groups[e.identification.id])})}).fail(e=>{T.error(s,e);o.reject(e,{})});return o.promise()};this.moveTile=function(e,t,i,r,o,n){const s=new jQuery.Deferred;const l=this.oCDMService;const a=this;if(!e||m(e)||t===undefined||t<0||i===undefined||i<0||!r||!r.identification||!r.identification.id||!o||!o.identification||!o.identification.id){return s.reject(new Error("Invalid input parameters")).promise()}const u=`Failed to move tile with id '${e.id}'. `;l.getSite().done(c=>{const d=a.getTileType(e)===a.TileType.Link?"links":"tiles";if(!n){n=a._mResolvedTiles[e.id].isLink?"link":"tile"}const f=n==="link"?"links":"tiles";if(d!==f&&a._mResolvedTiles[e.id]){a._mResolvedTiles[e.id].isLink=n==="link"}if(f==="links"){i-=c.groups[o.identification.id].payload.tiles.length}if(d==="links"){t-=c.groups[r.identification.id].payload.tiles.length}if(r.identification.id===o.identification.id){if(t!==i||d!==f){const r=c.groups[o.identification.id].payload;r[d].splice(t,1);r[f].splice(i,0,e)}else{return s.resolve(e).promise()}}else{c.groups[r.identification.id].payload[d].splice(t,1);c.groups[o.identification.id].payload[f].splice(i,0,e)}l.save().done(()=>{s.resolve(e)}).fail(e=>{T.error(u,e);s.reject(e)});return undefined}).fail(e=>{T.error(u,e);s.reject(e)});return s.promise()};this._compareCatalogs=function(e,t){return(e.identification.title||"").toLowerCase()>(t.identification.title||"").toLowerCase()?1:-1};this.getCatalogs=function(){const e=this;const t=new jQuery.Deferred;const i=[];function r(e,t,i,r){const o=e.catalogs[t];i.push(o);r.notify(o)}y.getServiceAsync("CommonDataModel").then(o=>{o.getSite().done(o=>{Object.keys(o.catalogs).forEach(e=>{r(o,e,i,t)});t.resolve(i.sort(e._compareCatalogs))})});return t.promise()};this._isStartableInbound=function(e){if(!e.semanticObject||!e.action){return false}const t=["Shell-plugin","Shell-bootConfig"];if(t.indexOf(`${e.semanticObject}-${e.action}`)>-1){return false}return true};this._isStartableVisualization=function(e,t){const i=v.get("signature.parameters",t);if(!i){return true}const r=v.get("parameters",c.getTarget(e));return Object.keys(i).every(e=>{const t=i[e];if(e==="sap-external-url"){return true}if(!t.filter||t.filter.format!=="plain"){return true}const o=t.filter.value;const n=v.get([e,"value","value"],r);if(o!==n){return false}return true})};this._isHiddenInbound=function(e){return!!e.hideLauncher};this._toHashFromInbound=function(e){const t=l.toHashFromInbound(e);if(!t){return undefined}return`#${t}`};this._getExternalUrlFromInbound=function(e){return v.get("signature.parameters.sap-external-url.launcherValue.value",e)||null};this._toHashFromOutbound=function(e){const t=l.toHashFromOutbound(e);if(!t){return undefined}return`#${t}`};function j(t,i){const r=this;const n=new jQuery.Deferred;setTimeout(()=>{const s=(t.payload&&t.payload.viz||[]).reduce((n,s)=>{let a;let u;let h;let g;let m;let v;let T;let b;let y;let R;let S;let C;if(!s){return n}const _=c.get(i,s);if(!_){return n}const w=c.getTypeId(_);const k=c.getType(i,w);const I=c.getAppId(_);if(I){a=c.getAppDescriptor(i,I);if(!a){return n}u=e.getInbound(a,c.getTarget(_).inboundId);if(!u){return n}if(!r._isStartableInbound(u.inbound)||!r._isStartableVisualization(_,u.inbound)||r._isHiddenInbound(u.inbound)){return n}g=l.mapOne(u.key,u.inbound,a,_,k,i);if(!g||!g.tileResolutionResult){return n}b=g.resolutionResult.applicationType;y=g.resolutionResult.additionalInformation;S=p.last("/core/navigation/enableInPlaceForClassicUIs");R=S?S[b]:false;m=f.computeNavigationModeForHomepageTiles(b,y,R);v=c.getOutbound(_,u.inbound);h=r._toHashFromOutbound(v);C=d.getTechnicalAttributes(a)}else{const e=c.getConfig(_);if(e===undefined){return n}g=l.mapOne(undefined,undefined,undefined,_,k,i);if(o.getMember(e,"sap|flp.target.type")==="URL"){T=o.getMember(e,"sap|flp.target.url")}}const j=g.tileResolutionResult;j.navigationMode=m;j.technicalAttributes=C;if(!r._isFormFactorSupported(j)){return n}if(t.contentProviderId){T=r._getMember(a,"sap|app.crossNavigation.inbounds.Shell-launchURL.signature.parameters.sap-external-url.launcherValue.value")}const D={id:s,vizId:s,tileIntent:T||h,tileResolutionResult:j,isCatalogTile:true};if(t.contentProviderId&&T){D.contentProviderId=t.contentProviderId;D.externalUrl=T}n.push(D);return n},[]);n.resolve(s)},0);return n.promise()}this.getCatalogTiles=function(e){const t=this;const i=new jQuery.Deferred;if(typeof e!=="object"||e===null){return i.reject(new Error(`Invalid input parameter '${e}' passed to getCatalogTiles.`)).promise()}this.oCDMServicePromise.then(r=>{r.getSite().done(r=>{j.call(t,e,r).done(i.resolve).fail(i.reject)}).fail(e=>{T.error("Failed to get site:",e);i.reject(e)})});return i.promise()};this.getCatalogError=function(e){if(e.error){return e.error}return undefined};this.getCatalogId=function(e){return i.getId(e)};this.getCatalogTitle=function(e){return i.getTitle(e)};this._isFailedCatalogTile=function(t){return!!(t&&this._mFailedResolvedCatalogTiles&&this._mFailedResolvedCatalogTiles[e.getTileId(t)])};this.getCatalogTileTitle=function(e){if(this._isGroupTile(e)){if(this._isFailedGroupTile(e)){return""}return this._mResolvedTiles[e.id].tileResolutionResult.title}if(this._isCatalogTile(e)){if(this._isFailedCatalogTile(e)){return undefined}return e.tileResolutionResult.title}return undefined};this.getCatalogTileContentProviderId=function(e){return e.tileResolutionResult.contentProviderId||""};this.getCatalogTileSize=function(e){return e.tileResolutionResult.size||"1x1"};this.getCatalogTileViewControl=function(e){return this._getCatalogTileViewControl(e)};this.getCatalogTilePreviewSubtitle=function(e){if(this._isGroupTile(e)){return this.getTileSubtitle(e)}return e.tileResolutionResult&&e.tileResolutionResult.subTitle||""};this.getCatalogTilePreviewIcon=function(e){if(this._isGroupTile(e)){return this.getTileIcon(e)}return e.tileResolutionResult&&e.tileResolutionResult.icon||""};this.getCatalogTilePreviewInfo=function(e){if(this._isGroupTile(e)){return this.getTileInfo(e)}return e.tileResolutionResult&&e.tileResolutionResult.info||""};this.getCatalogTilePreviewIndicatorDataSource=function(e){return e.tileResolutionResult&&e.tileResolutionResult.indicatorDataSource};this.getCatalogTileKeywords=function(e){const t=[];let i=e;if(!i){T.error("Could not find the Tile","sap.ushell.adapters.cdm.LaunchPageAdapter");return t}if(this._mResolvedTiles&&this._mResolvedTiles[e.id]){i=this._mResolvedTiles[e.id]}if(i&&i.tileResolutionResult&&Array.isArray(i.tileResolutionResult.keywords)){Array.prototype.push.apply(t,i.tileResolutionResult.keywords)}if(i&&i.tileResolutionResult&&i.tileResolutionResult.title){t.push(i.tileResolutionResult.title)}if(i&&i.tileResolutionResult&&i.tileResolutionResult.subTitle){t.push(i.tileResolutionResult.subTitle)}return t};this.getCatalogTileTechnicalAttributes=function(e){const t=[];let i=e;if(!i){T.error("Could not find the Tile","sap.ushell.adapters.cdm.LaunchPageAdapter");return[]}if(this._mResolvedTiles&&this._mResolvedTiles[e.id]){i=this._mResolvedTiles[e.id]}if(i&&i.tileResolutionResult&&Array.isArray(i.tileResolutionResult.technicalAttributes)){Array.prototype.push.apply(t,i.tileResolutionResult.technicalAttributes)}return t};function D(e){return Object.keys(e).map(t=>{const i=e[t]&&e[t][0];return{name:t,value:i||""}})}function G(e){const t={semanticObject:e.semanticObject,action:e.action,parameters:D(e.params)};if(e.appSpecificRoute){t.appSpecificRoute=e.appSpecificRoute}return t}function P(e){return{url:e}}function F(e){return e.map(e=>e.name+e.value).sort().join()}function A(e,t){e=e||[];t=t||[];if(e.length===t.length){const i=F(e);const r=F(t);return i===r}return false}function L(e,t){if(e&&t){if(e.url){return e.url===t.url}return e.semanticObject===t.semanticObject&&e.action===t.action&&A(e.parameters,t.parameters)&&e.appSpecificRoute===t.appSpecificRoute}return e===t}this._visitBookmarks=function(e,t,i,r){let o;const n=s.parseShellHash(e);if(n){o=G(n)}else{o=P(e)}return this.oCDMService.getSite().then(e=>{const n=e.groups;const s=Object.keys(n).filter(e=>!n[e].payload.locked).map(e=>n[e].payload.tiles.filter(e=>e.isBookmark&&e.vizType===i&&(e.contentProvider||"")===(r||"")&&L(o,e.target))).reduce((e,t)=>{Array.prototype.push.apply(e,t);return e},[]);if(!t){return s.length}return jQuery.when(s.map(t)).then(()=>s.length)})};function M(e,t,i){const r=I(e,t);r.isBookmark=true;if(i){r.contentProvider=i}return r}this.addBookmark=function(e,t,i){const r=this;return new jQuery.Deferred(o=>{const n=r.oCDMService;jQuery.when(t||r.getDefaultGroup(),n.getSite()).done((t,l)=>{let a;const u=s.parseShellHash(e.url);let c;let d=false;if(!u){a=P(e.url);d=true}else{a=G(u)}const f=M(e,a,i);if(d){c=new jQuery.Deferred;c.resolve(r._getTileForUrl(f))}else{c=r._getTileFromHash(e.url)}c.done(e=>{e.isLink=false;r._mResolvedTiles[f.id]=e;l.groups[t.identification.id].payload.tiles.push(f);n.save().done(()=>{o.resolve(f)}).fail(e=>{o.reject(e)})}).fail(e=>{T.error("Bookmark creation failed:",e);o.reject(e)})}).fail(e=>{o.reject(e)})}).promise()};this.addCustomBookmark=function(e,t,i){const r=new jQuery.Deferred;Promise.all([y.getServiceAsync("URLParsing"),y.getServiceAsync("CommonDataModel")]).then(n=>{const s=n[0];const l=n[1];jQuery.when(t||this.getDefaultGroup(),l.getSite()).done((t,n)=>{const a=s.parseShellHash(e.url);const u=a===undefined;const c=u?P(e.url):G(a);const d={id:o.generateUniqueId([]),vizType:e.vizType,title:e.title,subTitle:e.subtitle,icon:e.icon,info:e.info,numberUnit:e.numberUnit,target:c,indicatorDataSource:{path:e.serviceUrl,refresh:e.serviceRefreshInterval},vizConfig:e.vizConfig,isBookmark:true};if(i){d.contentProvider=i}this._resolveTileByVizId(d,n).done(e=>{e.isLink=false;this._mResolvedTiles[d.id]=e;n.groups[t.identification.id].payload.tiles.push(d);l.save().done(()=>{r.resolve(d)}).fail(r.reject)}).fail(e=>{T.error("Bookmark creation failed:",e);r.reject(e)})}).fail(r.reject)});return r.promise()};this.countBookmarks=function(e,t){return this._visitBookmarks(e,undefined,undefined,t)};this.countCustomBookmarks=async function(e){if(!e.vizType){throw new Error("countCustomBookmarks: Required parameter is missing: oIdentifier.vizType")}return new Promise((t,i)=>{this._visitBookmarks(e.url,undefined,e.vizType,e.contentProviderId).done(t).fail(i)})};this.updateBookmarks=function(e,t,i,r){const o=this.oCDMService;const n=this._mResolvedTiles;function l(i){return new jQuery.Deferred(r=>{let o;let l=false;const a={};if(t.url||t.url===""){const e=s.parseShellHash(t.url);if(!e){o=P(t.url)}else{o=G(e)}}if(i.icon!==t.icon){a.icon=t.icon;l=true}if(i.title!==t.title){a.title=t.title;l=true}if(i.subTitle!==t.subtitle){a.subtitle=t.subtitle;l=true}if(t.url&&e!==t.url){a.targetURL=t.url;l=true}if(i.info!==t.info){a.info=t.info;l=true}k(i,t,o);if(l&&n[i.id]){const e=n[i.id].tileComponent;if(e){e.tileSetVisualProperties(a)}}r.resolve(i)}).promise()}return this._visitBookmarks(e,l,i,r).then(e=>o.save().then(()=>e))};this.updateCustomBookmarks=async function(e,t){if(!e.vizType){throw new Error("updateCustomBookmarks: Required parameter is missing: oIdentifier.vizType")}if(t.title===""){throw new Error("updateCustomBookmarks: The bookmark title cannot be an empty string")}if(t.url===""){throw new Error("updateCustomBookmarks: The bookmark url cannot be an empty string")}return new Promise((i,r)=>{this.updateBookmarks(e.url,t,e.vizType,e.contentProviderId).done(i).fail(r)})};this.deleteBookmarks=function(e,t,i){const r=this.oCDMService;const o=s.parseShellHash(e);let n;if(o){n=G(o)}else{n=P(e)}return r.getSite().then(e=>{const o=e.groups;const s=Object.keys(o).map(e=>{const r=o[e].payload;let s=0;r.tiles=r.tiles.filter(e=>{if(e.isBookmark&&e.vizType===t&&(e.contentProvider||"")===(i||"")&&L(n,e.target)){++s;return false}return true});return s}).reduce((e,t)=>{e+=t;return e},0);return r.save().then(()=>s)})};this.deleteCustomBookmarks=async function(e){if(!e.vizType){throw new Error("deleteCustomBookmarks: Required parameter is missing: oIdentifier.vizType")}return new Promise((t,i)=>{this.deleteBookmarks(e.url,e.vizType,e.contentProviderId).done(t).fail(i)})};this.onCatalogTileAdded=function(e){};this._onTileSettingsSave=function(e,t){const i=new jQuery.Deferred;if(!e||!e.id||!t){return i.reject(new Error("Invalid tile or settings view")).promise()}const r=t.oTitleInput.getValue();const o=t.oSubTitleInput.getValue();const n=t.oInfoInput.getValue();const s=this.getTileTitle(e);const l=this.getTileInfo(e);const a=this.getTileSubtitle(e);if(s===r&&a===o&&l===n){return i.resolve().promise()}const u={};if(s!==r){u.title=r;e.title=r}if(a!==o){u.subtitle=o;e.subTitle=o}if(l!==n){u.info=n;e.info=n}if(this._mResolvedTiles[e.id].tileComponent){this._mResolvedTiles[e.id].tileComponent.tileSetVisualProperties(u)}else if(this._mResolvedTiles[e.id].linkTileControl){if(u.title){this._mResolvedTiles[e.id].linkTileControl.setHeader(u.title)}if(u.subtitle){this._mResolvedTiles[e.id].linkTileControl.setSubheader(u.subtitle)}if(u.title||u.subtitle){this._mResolvedTiles[e.id].linkTileControl.invalidate()}}y.getServiceAsync("CommonDataModel").then(e=>{e.save().fail(e=>{T.error("Could not save personalization changes:",e);i.reject(e)}).done(()=>{i.resolve()})});return i.promise()};this.getTileActions=function(e){const t=[];if(this._isGroupTile(e)&&!this._isFailedGroupTile(e)){const i=new h({config:{display_title_text:this.getTileTitle(e),display_subtitle_text:this.getTileSubtitle(e),display_info_text:this.getTileInfo(e)}});const r=a.getTileSettingsAction(i,this._onTileSettingsSave.bind(this,e),this.getTileType(e));t.push(r)}return t};this._getSiteData=function(){const e=new Promise((e,t)=>{y.getServiceAsync("CommonDataModel").then(i=>{i.getSite().done(e).fail(t)})});return e};this._addDefaultGroup=function(i,r){let n=e.getDefaultGroup(i);if(!n){n=t.createDefaultGroup(o.generateUniqueId(e.getGroupIdsFromSite(r)));r=t.addGroupToSite(r,n,0);i=e.getGroupsArrayFromSite(r)}this._oDefaultGroup=n;return i}}_.prototype=u.prototype;return _});
//# sourceMappingURL=FlpLaunchPageAdapter.js.map