// Copyright (c) 2009-2025 SAP SE, All Rights Reserved
sap.ui.define(["sap/base/Log","sap/base/i18n/Localization","sap/ushell/components/tiles/utils","sap/ushell/Config","sap/ushell/library","sap/ushell/utils/HttpClient","sap/ushell/utils/workpage/WorkPageService"],(t,e,n,i,s,a,o)=>{"use strict";const r=s.ContentNodeType;const u="sap.ushell.adapters.cep.MenuAdapter";const p={Workpage:"workpage",Visualization:"visualization"};const l={workpage:"workpage",page:"page"};const c={Menu:"FLP menu",ContentNodes:"content nodes"};function d(e,n,i){if(i&&i.config&&i.config.serviceUrl&&i.config.siteId){this.httpClient=new a;this.serviceUrl=i.config.serviceUrl;this.siteId=i.config.siteId;this.oWorkPageService=new o;this.oSiteDataPromise=this._doRequest(this.serviceUrl,this.siteId);this.oVizDataPromise=this._loadVisualizations()}else{t.error("Invalid configuration provided.","",u)}}d.prototype._loadVisualizations=async function(){const t=await this._getVisualizationIds();if(t.length>0){const e={filter:[{id:{in:t}}]};return this.oWorkPageService.loadVisualizations(e,true)}};d.prototype.isMenuEnabled=function(){if(!i.last("/core/menu/enabled")){return Promise.resolve(false)}return this.getMenuEntries().then(t=>t.length>0)};d.prototype.isSideNavigationEnabled=async function(){if(!i.last("/core/sideNavigation/enabled")){return false}const t=await this.getMenuEntries();return t.length>0};d.prototype.getMenuEntries=async function(){const[t,e]=await Promise.all([this._getMenu(),this._getVisualizations()]);return this._buildMenuEntries(t,e)};d.prototype.getContentNodes=async function(){const t=await this._getMenu();return this._buildContentNodes(t)};d.prototype._getVisualizationIds=async function(){const e=new Set;const n=await this._getMenu();n.forEach(n=>{if(!Array.isArray(n?.subMenu)){t.warning(`Menu entry ${n.id} does not contain a sub menu array for site-id: ${this.siteId}, ${u}`);return}n.subMenu.forEach(t=>{if(t.type===p.Visualization&&t.id){e.add(t.id)}})});return[...e]};d.prototype._buildMenuEntries=function(t,e){return t.filter(this._isSpaceNotEmpty.bind(null,c.Menu)).map(t=>{const n=this._buildMenuEntry(t,e);const i=[];t.subMenu.forEach(n=>{n.spaceid=t.id;const s=this._buildMenuEntry(n,e);i.push(s)});if(i.length>1){n.menuEntries=i}return n})};d.prototype._buildMenuEntry=function(e,i){let s=e;let a=e.title;let o=e.icon;let r="Page-";let l="Launchpad";let c="openFLPPage";let d="pageId";let g=e.id;if(Array.isArray(e?.subMenu)&&e.subMenu.length>0){s=e.subMenu[0];r="Space-";g=s.id;if(e.subMenu.length===1&&s.type===p.Visualization){a=s.title;o=s.icon}}const h=i.find(t=>t.id===s?.id);if(h&&h!==undefined){r="App-";d="sap-ui-app-id-hint";if(h.targetAppIntent){g=h.targetAppIntent.businessAppId;l=h.targetAppIntent.semanticObject;c=h.targetAppIntent.action}else{t.warning(`Visualization ${h.id} does not contain a targetAppIntent for site-id: ${this.siteId}, ${u}`)}}if(!n.isIconURIValid(o)){o=undefined}return{title:a,"help-id":r+e.id,description:"",icon:o,type:"IBN",target:{semanticObject:l,action:c,parameters:[{name:"spaceId",value:e.spaceid||e.id},{name:d,value:g}],innerAppRoute:undefined},menuEntries:[]}};d.prototype._buildContentNodes=function(t){return t.filter(this._isSpaceNotEmpty.bind(null,c.ContentNodes)).map(t=>({id:t.id,label:t.title||t.id,type:r.Space,isContainer:false,children:t.subMenu.map(t=>{const e=t.type===p.Workpage;return{id:t.id,label:t.title||t.id,type:e?r.Page:r.Visualization,isContainer:t?.pageType===l.page,children:[]}})}))};d.prototype.isWorkPage=async function(t){const e=await this._getMenu();const n=e.flatMap(t=>t.subMenu||[]).filter(t=>t.pageType===l.workpage&&t.type===p.Workpage).find(e=>e.id===t);return!!n};d.prototype._doRequest=function(n,s){let a=`{\n            menu(siteId: "${s}")\n        }`;a=a.replace(/\n/g,"").replace(/ /g,"");const o={"Content-Type":"application/json",Accept:"application/json","Accept-Language":e.getLanguageTag().toString()};if(i.last("/core/site/sapCdmVersion")){o["sap-cdm-content-version"]=i.last("/core/site/sapCdmVersion")}return this.httpClient.get(`${n}?query=${encodeURIComponent(a)}`,{headers:o}).then(e=>{if(e.status<200||e.status>=300){t.error(e.responseText,"",u);throw new Error(`HTTP request to GraphQL service failed with status: ${e.status} - ${e.statusText}`)}return JSON.parse(e.responseText||"{}")}).then(t=>{try{t.data.menu=t.data.menu.filter(t=>t.id!=="default_space")}catch{}return t})};d.prototype._getMenu=async function(){const e=await this.oSiteDataPromise;if(Array.isArray(e?.data?.menu)&&e.data.menu.length>0){return e.data.menu}t.warning(`No menu found for site-id: ${this.siteId}`,"",u);return[]};d.prototype._getVisualizations=async function(){const e=await this.oVizDataPromise;if(Array.isArray(e?.visualizations?.nodes)&&e.visualizations.nodes.length>0){return e.visualizations.nodes}t.info(`No visualizations found for site-id: ${this.siteId}`,"",u);return[]};d.prototype._isSpaceNotEmpty=function(e,n){if(!(Array.isArray(n?.subMenu)&&n.subMenu.length>0)||!n.subMenu?.some(t=>Object.keys(t).length>0)){t.warning(`FLP space ${n.id} without sub menu content omitted in ${e}.`,"",u);return false}return true};return d});
//# sourceMappingURL=MenuAdapter.js.map