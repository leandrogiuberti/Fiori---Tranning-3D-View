// Copyright (c) 2009-2025 SAP SE, All Rights Reserved
sap.ui.define(["sap/base/Log","sap/base/i18n/Localization","sap/base/util/deepExtend","sap/base/util/ObjectPath","sap/m/GenericTile","sap/m/ImageContent","sap/m/library","sap/m/NumericContent","sap/m/TileContent","sap/ui/core/ComponentContainer","sap/ui/core/Component","sap/ui/core/library","sap/ui/core/mvc/View","sap/ui/Device","sap/ui/model/resource/ResourceModel","sap/ui/thirdparty/datajs","sap/ui/thirdparty/hasher","sap/ui/thirdparty/jquery","sap/ushell/Config","sap/ushell/library","sap/ushell/resources","sap/ushell/utils","sap/ushell/utils/WindowUtils","sap/ushell/EventHub","sap/ushell/Container"],(e,t,i,r,s,n,o,l,a,p,u,c,d,f,h,T,g,jQuery,m,w,y,v,b,L,C)=>{"use strict";const _=c.mvc.ViewType;const R=o.GenericTileMode;const U=w.AppType;function P(e){const t={};t[e.namespace.replace(/\./g,"/")]=e.path||".";sap.ui.loader.config({paths:t})}function k(t,i){if(t.tileType!=="sap.ushell.ui.tile.DynamicTile"||!t.properties||!t.properties.serviceUrl){return}if(t.intervalTimer){window.clearInterval(t.intervalTimer);t.intervalTimer=undefined}if(i){let i=t.serviceRefreshInterval;if(i){i=i*1e3}else{i=1e4}t.intervalTimer=window.setInterval(()=>{T.read(`${t.properties.serviceUrl}?id=${t.id}&t=${(new Date).getTime()}`,()=>{e.debug(`Dynamic tile service call succeed for tile ${t.id}`)},i=>{e.debug(`Dynamic tile service call failed for tile ${t.id}, error message:${i.message}`)})},v.sanitizeTimeoutDelay(i))}}function I(o,c,T){const w=i([],T.config.groups);const v=0;const S=10;const z=10;const D=10;let G;const F={};for(let e=0;e<w.length;e++){if(w[e].isDefaultGroup===true){G=w[e];break}}if(!G&&w.length>0){G=w[0];G.isDefaultGroup=true}this.translationBundle=y.i18n;this.TileType={Tile:"tile",Link:"link",Card:"card"};let B;this.oResourceBundlePromise=Promise.resolve();if(T.config.pathToLocalizedContentResources){const e=new h({async:true,bundleUrl:T.config.pathToLocalizedContentResources,bundleLocale:t.getLanguage()});this.oResourceBundlePromise=e.getResourceBundle();this.oResourceBundlePromise.then(e=>{B=e})}function V(e){if(B){return B.getText(e)}return e}const j=T.config.catalogs||[];this.oResourceBundlePromise.then(()=>{j.forEach(e=>{if(B){e.title=V(e.title)}e.tiles.forEach(e=>{e.getTitle=()=>e.title;e.getChip=()=>({getBaseChipId:()=>e.chipId})})});w.forEach(e=>{if(B){e.title=V(e.title)}e.tiles.forEach(e=>{k(e,true)})})});function A(){return 100*Math.random()<v}function M(){return 100*Math.random()<S}function N(){return z+D*Math.random()}function E(e,t){let i;for(i=0;i<e.tiles.length;i=i+1){if(t.id===e.tiles[i].id){return i}}return-1}function H(e,t){let i;for(i=0;i<e.length;i=i+1){if(t.id===e[i].id){return i}}return-1}function $(e){const t=new jQuery.Deferred;window.setTimeout(()=>{t.resolve(e)},N());return t.promise()}this.getGroups=function(){const e=new jQuery.Deferred;window.setTimeout(async()=>{await this.oResourceBundlePromise;e.resolve(w.slice(0))},N());return e.promise()};this.getDefaultGroup=function(){const e=new jQuery.Deferred;e.resolve(G);return e.promise()};this.addGroup=function(e){const t=new jQuery.Deferred;const i=A();window.setTimeout(async()=>{await this.oResourceBundlePromise;if(!i){const i={id:`group_${w.length}`,title:e,tiles:[]};w.push(i);t.resolve(i)}else{this.getGroups().done(t.reject).fail(t.reject)}},N());return t.promise()};this.getGroupTitle=function(e){return e.title};this.setGroupTitle=function(e,t){const i=new jQuery.Deferred;const r=A();window.setTimeout(()=>{if(!r){e.title=t;i.resolve()}else{$(e).done(e=>{i.reject(new Error("Failed to set group title"),e.title)}).fail(i.reject)}},N());return i.promise()};this.getGroupId=function(e){return e.id};this.hideGroups=function(e){const t=new jQuery.Deferred;this.oResourceBundlePromise.then(()=>{if(e&&w){for(let t=0;t<w.length;t++){if(e.indexOf(w[t].id)!==-1){w[t].isVisible=false}else{w[t].isVisible=true}}}t.resolve()});return t.promise()};this.isGroupVisible=function(e){return e&&(e.isVisible===undefined?true:e.isVisible)};this.moveGroup=function(e,t){const i=new jQuery.Deferred;const r=A();window.setTimeout(async()=>{await this.oResourceBundlePromise;if(!r){w.splice(t,0,w.splice(H(w,e),1)[0]);i.resolve()}else{this.getGroups().done(i.reject).fail(i.reject)}},N());return i.promise()};this.removeGroup=function(e){const t=new jQuery.Deferred;const i=A();window.setTimeout(async()=>{await this.oResourceBundlePromise;if(!i){w.splice(H(w,e),1);e.tiles.forEach(e=>{k(e,false)});t.resolve()}else{this.getGroups().done(t.reject).fail(t.reject)}},N());return t.promise()};this.resetGroup=function(e){const t=new jQuery.Deferred;const r=A();window.setTimeout(async()=>{await this.oResourceBundlePromise;if(!r){e.tiles.forEach(e=>{k(e,false)});e=i({},T.config.groups[H(T.config.groups,e)]);w.splice(H(w,e),1,e);e.tiles.forEach(e=>{k(e,true)});t.resolve(e)}else{this.getGroups().done(t.reject).fail(t.reject)}},N());return t.promise()};this.isGroupRemovable=function(e){return e&&!e.isPreset};this.isGroupLocked=function(e){return e.isGroupLocked};this.isGroupFeatured=function(e){return e.isFeatured};this.getGroupTiles=function(e){return e.tiles};this.getLinkTiles=function(e){return e.links};this.getTileTitle=function(e){return e.title};this.getTileType=function(e){if(e.isLink){return this.TileType.Link}if(e.isCard){return this.TileType.Card}return this.TileType.Tile};this.getTileId=function(e){return e.id};this.getTileSize=function(e){return e.size};this.getTileTarget=function(e){let t;if(e.properties){t=e.properties.href||e.properties.targetURL}return e.target_url||t||""};this.isTileIntentSupported=function(e){if(e&&e.formFactor){let t;const i=e.formFactor;const r=f.system;if(r.desktop){t="Desktop"}else if(r.tablet){t="Tablet"}else if(r.phone){t="Phone"}if(i.indexOf(t)===-1){return false}}return true};this.isTileIntentSupportedAsync=function(e){return Promise.resolve(this.isTileIntentSupported(e))};this.isLinkPersonalizationSupported=function(e){if(e){return e.isLinkPersonalizationSupported}return true};this.getTileView=function(e){const t=new jQuery.Deferred;const i=A();if(M()){window.setTimeout(()=>{if(!i){this._getTileView(e).done(t.resolve)}else{t.reject(new Error("Failed to get tile view"))}},N())}else if(!i){this._getTileView(e).done(t.resolve)}else{t.reject(new Error("Failed to get tile view"))}return t.promise()};this._getTileView=function(e){let t="unknown error";const i=this.getTileType(e)==="link";const r=new jQuery.Deferred;Promise.resolve().then(async()=>{await this._translateTileProperties(e);if(e.namespace&&e.path&&e.moduleType){P(e);if(e.moduleType==="UIComponent"){u.create({componentData:{properties:e.properties},name:e.moduleName}).then(e=>{const t=new p({component:e,height:"100%",width:"100%"});r.resolve(t)})}else{d.create({viewName:e.moduleName,type:_[e.moduleType],viewData:{properties:e.properties},height:"100%"}).then(r.resolve)}return}else if(e.tileType){const n=i?"Link":e.tileType;if(n){try{this._createTileInstance(e,n).done(e=>{this._handleTilePress(e);this._applyDynamicTileInfoState(e);r.resolve(e)})}catch(t){r.resolve(new s({header:t&&`${t.name}: ${t.message}`||this.translationBundle.getText("failedTileCreationMsg"),frameType:this._parseTileSizeToGenericTileFormat(e.size)}))}return}t=`TileType: ${e.tileType} not found!`}else{t="No TileType defined!"}r.resolve(new s({header:t,frameType:this._parseTileSizeToGenericTileFormat(e.size)}))});return r.promise()};this._getCatalogTileViewAsync=function(e){const t=new jQuery.Deferred;Promise.resolve().then(async()=>{let i;let r="unknown error";const n=this.getTileType(e)==="link";await this._translateTileProperties(e);if(e.namespace&&e.path&&e.moduleType){P(e);if(e.moduleType==="UIComponent"){u.create({componentData:{properties:e.properties},name:e.moduleName}).then(e=>{const i=new p({component:e,height:"100%",width:"100%"});t.resolve(i)})}else{d.create({viewName:e.moduleName,type:_[e.moduleType],viewData:{properties:e.properties},height:"100%"}).then(t.resolve)}return}else if(e.tileType){const o=n?"Link":e.tileType;if(o){try{i=this._createCatalogTileInstanceAsync(e,o);i.done(e=>{this._handleTilePress(e);this._applyDynamicTileInfoState(e);t.resolve(e)})}catch(i){t.resolve(new s({header:i&&`${i.name}: ${i.message}`||this.translationBundle.getText("failedTileCreationMsg"),frameType:this._parseTileSizeToGenericTileFormat(e.size)}))}return}r=`TileType: ${e.tileType} not found!`}r="No TileType defined!";t.resolve(new s({header:r,frameType:this._parseTileSizeToGenericTileFormat(e.size)}))});return t.promise()};this._createTileInstance=function(e,t){let i;const n=new jQuery.Deferred;const o=this._getImageContent({src:e.properties.icon});o.addStyleClass("sapUshellFullWidth");switch(t){case"sap.ushell.ui.tile.DynamicTile":i=new s({header:e.properties.title,subheader:e.properties.subtitle,frameType:this._parseTileSizeToGenericTileFormat(e.size),url:b.getLeanURL(e.properties.targetURL),tileContent:new a({frameType:this._parseTileSizeToGenericTileFormat(e.size),footer:e.properties.info,unit:e.properties.numberUnit,content:new l({scale:e.properties.numberFactor,value:e.properties.numberValue,truncateValueTo:5,indicator:e.properties.stateArrow,valueColor:this._parseTileValueColor(e.properties.numberState),icon:e.properties.icon,width:"100%"})}),press:this._genericTilePressHandler.bind(this,e)});F[e.id]=i;n.resolve(i);break;case"sap.ushell.ui.tile.StaticTile":i=new s({mode:e.mode||(e.properties.icon?R.ContentMode:R.HeaderMode),header:e.properties.title,subheader:e.properties.subtitle,frameType:this._parseTileSizeToGenericTileFormat(e.size),url:b.getLeanURL(e.properties.targetURL),tileContent:new a({frameType:this._parseTileSizeToGenericTileFormat(e.size),footer:e.properties.info,content:o}),press:this._genericTilePressHandler.bind(this,e)});F[e.id]=i;n.resolve(i);break;case"Link":i=new s({mode:R.LineMode,subheader:e.properties.subtitle,header:e.properties.title,url:b.getLeanURL(e.properties.targetURL,e.properties.href),press:t=>{this._genericTilePressHandler(e,t)}});F[e.id]=i;n.resolve(i);break;default:const t=e.tileType.replace(/\./g,"/");sap.ui.require([t],()=>{const t=r.get(e.tileType);i=new t(e.properties||{});F[e.id]=i;n.resolve(i)})}return n.promise()};this.getCardManifest=function(e){const t=JSON.parse(JSON.stringify(e.manifest));return t};this._createCatalogTileInstanceAsync=function(e,t){const i=new jQuery.Deferred;let r;const n=this._getImageContent({src:e.properties.icon});n.addStyleClass("sapUshellFullWidth");switch(t){case"sap.ushell.ui.tile.DynamicTile":r=new s({header:e.properties.title,subheader:e.properties.subtitle,frameType:this._parseTileSizeToGenericTileFormat(e.size),url:b.getLeanURL(e.properties.targetURL),tileContent:new a({frameType:this._parseTileSizeToGenericTileFormat(e.size),footer:e.properties.info,unit:e.properties.numberUnit,content:new l({scale:e.properties.numberFactor,value:e.properties.numberValue,truncateValueTo:5,indicator:e.properties.stateArrow,valueColor:this._parseTileValueColor(e.properties.numberState),icon:e.properties.icon,width:"100%"})}),press:t=>{this._genericTilePressHandler(e,t)}});break;case"sap.ushell.ui.tile.StaticTile":r=new s({mode:e.mode||(e.properties.icon?R.ContentMode:R.HeaderMode),header:e.properties.title,subheader:e.properties.subtitle,frameType:this._parseTileSizeToGenericTileFormat(e.size),url:b.getLeanURL(e.properties.targetURL),tileContent:new a({frameType:this._parseTileSizeToGenericTileFormat(e.size),footer:e.properties.info,content:n}),press:t=>{this._genericTilePressHandler(e,t)}});break;case"Link":r=new s({mode:R.LineMode,subheader:e.properties.subtitle,header:e.properties.title,url:b.getLeanURL(e.properties.targetURL,e.properties.href),press:t=>{this._genericTilePressHandler(e,t)}});break;default:t=e.tileType&&e.tileType.replace(/\./g,"/");sap.ui.require([t],t=>{r=new t(e.properties||{});i.resolve(r)})}i.resolve(r);return i.promise()};this._createCatalogTileInstance=function(t,i){let n;let o;let p;const u=this._getImageContent({src:t.properties.icon});u.addStyleClass("sapUshellFullWidth");switch(i){case"sap.ushell.ui.tile.DynamicTile":n=new s({header:t.properties.title,subheader:t.properties.subtitle,frameType:this._parseTileSizeToGenericTileFormat(t.size),url:b.getLeanURL(t.properties.targetURL),tileContent:new a({frameType:this._parseTileSizeToGenericTileFormat(t.size),footer:t.properties.info,unit:t.properties.numberUnit,content:new l({scale:t.properties.numberFactor,value:t.properties.numberValue,truncateValueTo:5,indicator:t.properties.stateArrow,valueColor:this._parseTileValueColor(t.properties.numberState),icon:t.properties.icon,width:"100%"})}),press:e=>{this._genericTilePressHandler(t,e)}});break;case"sap.ushell.ui.tile.StaticTile":n=new s({mode:t.mode||(t.properties.icon?R.ContentMode:R.HeaderMode),header:t.properties.title,subheader:t.properties.subtitle,frameType:this._parseTileSizeToGenericTileFormat(t.size),url:b.getLeanURL(t.properties.targetURL),tileContent:new a({frameType:this._parseTileSizeToGenericTileFormat(t.size),footer:t.properties.info,content:u}),press:e=>{this._genericTilePressHandler(t,e)}});break;case"Link":n=new s({mode:R.LineMode,subheader:t.properties.subtitle,header:t.properties.title,url:b.getLeanURL(t.properties.targetURL,t.properties.href),press:e=>{this._genericTilePressHandler(t,e)}});break;default:o=t.tileType.replace(/\./g,"/");p=sap.ui.require(o);if(!p){if(!r.get(t.tileType)){e.warning(`FLP: local LaunchPageAdapter. The resource is used before being loaded: ${o}`);sap.ui.requireSync(o)}p=r.get(t.tileType)}n=new p(t.properties||{})}return n};this._genericTilePressHandler=function(e,t){if(t.getSource().getScope&&t.getSource().getScope()==="Display"){if(e.properties.targetURL){L.emit("UITracer.trace",{reason:"LaunchApp",source:"Tile",data:{targetUrl:e.properties.targetURL}});if(e.properties.targetURL[0]==="#"){g.setHash(e.properties.targetURL)}else{const t=m.last("/core/shell/enableRecentActivity")&&m.last("/core/shell/enableRecentActivityLogging");if(t){const t={title:e.properties.title,appType:U.URL,url:e.properties.targetURL,appId:e.properties.targetURL};C.getRendererInternal("fiori2").logRecentActivity(t)}b.openURL(e.properties.targetURL,"_blank")}}}};this._parseTileSizeToGenericTileFormat=function(e){return e==="1x2"?"TwoByOne":"OneByOne"};this._parseTileValueColor=function(e){if(e==="Positive"){return"Good"}if(e==="Negative"){return"Critical"}return e};this._applyDynamicTileInfoState=function(e){const t=e.onAfterRendering;e.onAfterRendering=()=>{if(t){t.apply(e,arguments)}const i=e.getModel();if(!i){return}const r=i.getProperty("/data/display_info_state");const s=e.getDomRef();const n=s.getElementsByClassName("sapMTileCntFtrTxt")[0];switch(r){case"Negative":n.classList.add("sapUshellTileFooterInfoNegative");break;case"Neutral":n.classList.add("sapUshellTileFooterInfoNeutral");break;case"Positive":n.classList.add("sapUshellTileFooterInfoPositive");break;case"Critical":n.classList.add("sapUshellTileFooterInfoCritical");break;default:return}}};this._handleTilePress=function(e){if(typeof e.attachPress==="function"){e.attachPress(()=>{if(typeof e.getTargetURL==="function"){const t=e.getTargetURL();L.emit("UITracer.trace",{reason:"LaunchApp",source:"Tile",data:{targetUrl:t}});if(t){if(t[0]==="#"){g.setHash(t)}else{b.openURL(t,"_blank")}}}})}};this._translateTileProperties=async function(e){await this.oResourceBundlePromise;if(this.translationBundle&&B&&!e._isTranslated){const t=e.properties;const i=e.keywords;t.title=V(t.title);t.subtitle=V(t.subtitle);t.info=V(t.info);if(i){for(let e=0;e<i.length;e++){i[e]=V(i[e])}}e._isTranslated=true}};this.refreshTile=function(){};this.setTileVisible=function(e,t){k(e,t)};this.addTile=function(e,t){if(!t){t=G}const r=new jQuery.Deferred;const s=A();window.setTimeout(()=>{if(!s){const s=i({title:"A new tile was added",size:"1x1"},e,{id:`tile_0${e.chipId}`});t.tiles.push(s);k(s,true);r.resolve(s)}else{this.getGroups().done(r.reject).fail(r.reject)}},N());return r.promise()};this.removeTile=function(e,t){const i=new jQuery.Deferred;const r=A();window.setTimeout(()=>{if(!r){e.tiles.splice(E(e,t),1);k(t,false);i.resolve()}else{this.getGroups().done(i.reject).fail(i.reject)}},N());return i.promise()};this.moveTile=function(e,t,i,r,s,n){const o=new jQuery.Deferred;const l=A();window.setTimeout(()=>{if(!l){if(s===undefined){s=r}e.isLink=n?n===this.TileType.Link:e.isLink;r.tiles.splice(t,1);s.tiles.splice(i,0,e);o.resolve(e)}else{this.getGroups().done(o.reject).fail(o.reject)}},N());return o.promise()};this.getTile=function(){const e=new jQuery.Deferred;return e.promise()};this.getCatalogs=function(){const e=new jQuery.Deferred;this.oResourceBundlePromise.then(()=>{j.forEach(t=>{window.setTimeout(()=>{e.notify(t)},300)});window.setTimeout(()=>{e.resolve(j)},1500)});return e.promise()};this.isCatalogsValid=function(){return true};this.getCatalogError=function(){return};this.getCatalogId=function(e){return e.id};this.getCatalogTitle=function(e){return e.title};this.getCatalogTiles=function(e){const t=new jQuery.Deferred;window.setTimeout(()=>{t.resolve(e.tiles)},N());return t.promise()};this.getCatalogTileId=function(e){if(e.chipId){return e.chipId}return"UnknownCatalogTileId"};this.getStableCatalogTileId=function(e){if(e.referenceChipId){return e.referenceChipId}if(e.chipId){return e.chipId}return"UnknownCatalogTileId"};this.getCatalogTileTitle=function(e){return e.title};this.getCatalogTileSize=function(e){return e.size};this.getCatalogTileViewControl=function(e){return this._getCatalogTileViewAsync(e)};this.getCatalogTileTargetURL=function(e){return e.properties&&e.properties.targetURL||null};this.getCatalogTilePreviewTitle=function(e){return e.properties&&e.properties.title||null};this.getCatalogTilePreviewInfo=function(e){return e.properties&&e.properties.info||null};this.getCatalogTilePreviewIndicatorDataSource=function(e){let t;if(e.properties&&e.properties.serviceUrl){t={path:e.properties.serviceUrl,refresh:e.properties.serviceRefreshInterval}}return t};this.getCatalogTilePreviewSubtitle=function(e){return e.properties&&e.properties.subtitle||null};this.getCatalogTilePreviewIcon=function(e){return e.properties&&e.properties.icon||null};this.getCatalogTileKeywords=function(e){return[e.title,e.properties&&e.properties.subtitle,e.properties&&e.properties.info,e.keywords].flat().filter(e=>e)};this.getCatalogTileTags=function(e){return e&&e.tags||[]};this.addBookmark=function(e,t){const i=t||G;const r=new jQuery.Deferred;const s=A();const n=e.title;const o=e.subtitle;const l=e.info;const a=e.url;const p=this.isLinkPersonalizationSupported();window.setTimeout(()=>{if(!s){const e={title:n,size:"1x1",chipId:`tile_0${i.tiles.length}`,tileType:"sap.ushell.ui.tile.StaticTile",id:`tile_0${i.tiles.length}`,isLinkPersonalizationSupported:p,keywords:[],properties:{icon:"sap-icon://time-entry-request",info:l,subtitle:o,title:n,targetURL:a}};i.tiles.push(e);k(e,true);r.resolve(e)}else{this.getGroups().done(r.reject).fail(r.reject)}},N());return r.promise()};this.updateBookmarks=function(e,t){const i=new jQuery.Deferred;let r=0;const s=this.getGroups();s.done(s=>{s.forEach(i=>{i.tiles.forEach(i=>{if(i.properties&&i.properties.targetURL===e){for(const e in t){if(t.hasOwnProperty(e)){i.properties[e]=t[e]}}const e=F[i.id];if(e!==undefined){e.setHeader(i.properties.title);e.setSubheader(i.properties.subtitle)}r++}})});i.resolve(r)});s.fail(e=>{i.reject(e)});return i.promise()};this.deleteBookmarks=function(e){const t=new jQuery.Deferred;this.oResourceBundlePromise.then(()=>{let i=0;let r;let s;for(let t=0;t<w.length;t++){r=w[t];for(let t=r.tiles.length-1;t>=0;t--){s=r.tiles[t];if(s.properties.targetURL===e){r.tiles.splice(t,1);i++}}}t.resolve(i)});return t.promise()};this.countBookmarks=function(e){const t=new jQuery.Deferred;this.oResourceBundlePromise.then(()=>{let i=0;let r;let s;for(let t=0;t<w.length;t++){r=w[t];for(let t=0;t<r.tiles.length;t++){s=r.tiles[t];if(s.properties.targetURL===e){i++}}}t.resolve(i)});return t.promise()};this._getImageContent=function(e){return new n(e)};this.onCatalogTileAdded=function(){};this.getTileActions=function(e){return e&&e.actions||null};I.prototype._getCatalogTileIndex=function(){const e={};return Promise.resolve(e)};this.getCatalogTileNumberUnit=function(e){return e.properties?e.properties.numberUnit:undefined}}return I});
//# sourceMappingURL=FlpLaunchPageAdapter.js.map