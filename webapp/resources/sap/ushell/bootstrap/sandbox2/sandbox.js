// Copyright (c) 2009-2025 SAP SE, All Rights Reserved
const OBJECT_PROTOTYPE_KEYS=Object.getOwnPropertyNames(Object.prototype);sap.ui.define(["sap/base/Log","sap/base/util/ObjectPath","sap/ushell/bootstrap/common/common.util","sap/ushell/utils"],(t,e,i,o)=>{"use strict";const s={_loadJSON:async function(e){function i(){t.error("Failed to load Fiori Launchpad Sandbox configuration",e)}try{const t=await fetch(e,{headers:{"Content-Type":"application/json"}});if(t.ok){const e=await t.json();return e}i()}catch{i()}},mergeConfig:function(t,e,i){if(typeof e!=="object"){return}const o=i?JSON.parse(JSON.stringify(e)):e;Object.entries(o).forEach(([e,i])=>{if(OBJECT_PROTOTYPE_KEYS.includes(e)){return}if(Object.prototype.toString.apply(t[e])==="[object Object]"&&Object.prototype.toString.apply(i)==="[object Object]"){this.mergeConfig(t[e],i,false);return}t[e]=i})},_addAppsToSite:function(t){const o={};function s(t){return t.additionalInformation.replace("SAPUI5.Component=","")}function n(t,e){const i=s(t);const o=t.title||i.split(".").pop();const n=e.split("-");const a={"sap.app":{id:i,title:o,subTitle:t.description||"",ach:"CA-FLP-FE-COR",applicationVersion:{version:"1.0.0"},crossNavigation:{inbounds:{target:{semanticObject:n[0],action:n[1],signature:{parameters:{},additionalParameters:"allowed"}}}},tags:{keywords:o.split(" ")}},"sap.flp":{type:"application"},"sap.ui":{technology:"UI5",icons:{icon:"sap-icon://Fiori2/F0018"},deviceTypes:{desktop:true,tablet:true,phone:true}},"sap.ui5":{componentName:i},"sap.platform.runtime":{componentProperties:{url:t.url}}};return a}function a(t){const e=t.resolutionResult||{};const i=e.ui5ComponentName||s(e);const o=t.title||i.split(".").pop();const n={"sap.app":{id:i,title:o,subTitle:e.description||"",ach:"CA-FLP-FE-COR",applicationVersion:{version:"1.0.0"},crossNavigation:{inbounds:{target:{semanticObject:t.semanticObject,action:t.action,signature:t.signature}}},tags:{keywords:o.split(" ")}},"sap.flp":{type:"application"},"sap.ui":{technology:"UI5",icons:{icon:"sap-icon://Fiori2/F0018"},deviceTypes:t.deviceTypes},"sap.ui5":{componentName:i},"sap.platform.runtime":{componentProperties:{url:e.url}}};return n}function p(t,e){const i=s(t);const o=t.title||i.split(".").pop();const n={vizType:"sap.ushell.StaticAppLauncher",businessApp:i||"sap.ushell.sandbox.BusinessApp",vizConfig:{"sap.app":{title:o,subTitle:t.description||""},"sap.ui":{icons:{icon:t.icon},deviceTypes:{desktop:true,tablet:true,phone:true}},"sap.flp":{target:{type:"URL",url:`#${e}`}}}};return n}const c=t.services.CommonDataModel.adapter.config.siteData;const r=e.get("applications",t)||{};for(const[t,e]of Object.entries(r)){const i=`custom_viz_${t}`;const o=c.pages.page1.payload.sections.APPS;c.applications[t]=n(e,t);c.visualizations[t]=p(e,t);o.layout.vizOrder.push(i);o.viz[i]={id:i,vizId:t}}const l=JSON.parse(JSON.stringify(e.get("services.NavTargetResolutionInternal.adapter.config.applications",t)||{}));e.set("services.NavTargetResolutionInternal.adapter.config.applications",l,o);for(const[t,e]of Object.entries(l)){if(e.additionalInformation){c.applications[t]=n(e,t)}}const u=JSON.parse(JSON.stringify(e.get("services.ClientSideTargetResolution.adapter.config.inbounds",t)||{}));e.set("services.ClientSideTargetResolution.adapter.config.inbounds",u,o);for(const t of Object.values(u)){c.applications[`${t.semanticObject}-${t.action}`]=a(t)}const d=JSON.parse(JSON.stringify(e.get("services.LaunchPage.adapter.config.groups",t)||[]));e.set("services.LaunchPage.adapter.config.groups",d,o);d.forEach((t,e)=>{const i=t.id||`GROUP_${e}`;const o=c.pages.page1;o.payload.layout.sectionOrder.splice(e+1,0,i);o.payload.sections[i]={id:i,title:t.title,layout:{vizOrder:[]},viz:{}};const s=o.payload.sections[i];(t.tiles||[]).forEach((t,e)=>{const o=t.id||`${i}_tile_${e}`;s.layout.vizOrder.push(o);const n=t.formFactor||"Desktop,Tablet,Phone";const a=t.properties||{};const p={vizType:"sap.ushell.StaticAppLauncher",businessApp:"sap.ushell.sandbox.BusinessApp",vizConfig:{"sap.app":{title:t.title||a.title||"",subTitle:a.subtitle||""},"sap.ui":{icons:{icon:a.icon},deviceTypes:{desktop:n.indexOf("Desktop")>-1,tablet:n.indexOf("Tablet")>-1,phone:n.indexOf("Phone")>-1}},"sap.flp":{target:{type:"URL",url:a.targetURL||a.href||"#"}}}};c.visualizations[o]=p;s.viz[o]={id:o,vizId:o}})});delete t.applications;const f=i.getV2ServiceMigrationConfig(o);this.mergeConfig(t,f,true);this.mergeConfig(t,o,true);return t},_applyDefaultUshellConfig:function(t,e){const o=i.getV2ServiceMigrationConfig(t);this.mergeConfig(e,o,true);this.mergeConfig(e,t,true)},_applyDefaultSiteData:function(t,e){const i=e.services.CommonDataModel.adapter.config;i.siteData=t;delete i.siteDataUrl},_applyJsonApplicationConfig:async function(t,e){const o=/\.json/i.test(t)?t:`${t}.json`;const s=await this._loadJSON(o);if(s){const t=i.getV2ServiceMigrationConfig(s);this.mergeConfig(e,t,true);this.mergeConfig(e,s,true)}},_getBootstrapScriptPath:function(){const t=window.document.getElementById("sap-ushell-bootstrap");const e=`${t.src.split("?")[0].split("/").slice(0,-1).join("/")}/`;return e},bootstrap:async function(){const t=new URLSearchParams(window.location.search).getAll("sap-ushell-sandbox-config");const e=this._getBootstrapScriptPath();const s=`${e}./sandbox2/sandboxConfig.json`;const n=`${e}./sandbox2/sandboxSite.json`;if(t.length===0){t.push("/appconfig/fioriSandboxConfig.json");t.push("../appconfig/fioriSandboxConfig.json")}if(!window["sap-ushell-config"]){window["sap-ushell-config"]={}}const a=window["sap-ushell-config"];i.migrateV2ServiceConfig(a);const[p,c]=await Promise.all([this._loadJSON(s),this._loadJSON(n)]);this._applyDefaultUshellConfig(p,a);this._applyDefaultSiteData(c,a);for(const e of t){await this._applyJsonApplicationConfig(e,a)}this._addAppsToSite(a);const r=sap.ui.require.toUrl("sap/ushell/demo");if(r.indexOf("sap/ushell/demoapps")===-1){sap.ui.loader.config({paths:{"sap/ushell/demo":"/ushell/test-resources/sap/ushell/demoapps"}})}if(a.modulePaths){const t=Object.keys(a.modulePaths).reduce((t,e)=>{t[e.replace(/\./g,"/")]=a.modulePaths[e];return t},{});sap.ui.loader.config({paths:t})}const[l]=await o.requireAsync(["sap/ushell/Container"]);return l.init("cdm")}};return s});
//# sourceMappingURL=sandbox.js.map