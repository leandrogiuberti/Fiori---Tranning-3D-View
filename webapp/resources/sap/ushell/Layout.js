// Copyright (c) 2009-2025 SAP SE, All Rights Reserved
sap.ui.define(["sap/base/i18n/Localization","sap/base/util/extend","sap/ui/Device","sap/ui/core/Element","sap/ui/core/EventBus","sap/ui/thirdparty/jquery","sap/ushell/Config","sap/ushell/Container"],(t,e,i,s,n,jQuery,o,r)=>{"use strict";function l(t){this.init(t)}l.prototype={settings:null,tileWidth:0,tileHeight:0,tileMargin:0,curTouchMatrixCords:null,tilesInRow:null,groupsList:null,item:null,matrix:null,tiles:null,collisionLeft:false,startGroup:null,currentGroup:null,endGroup:null,init:function(i){this.curTouchMatrixCords={column:null,row:null};this.endGroup=null;this.groupSwitched=false;this.item=null;this.matrix=null;this.tiles=null;this.collisionLeft=false;this.startArea=null;this.currentArea=null;this.endArea=undefined;this.startGroup=null;this.draggedTileDomRef=null;this.sDragStartGroupModelId=undefined;this.sDragTargetGroupModelId=undefined;this.currentGroup=null;this.groupsList=null;this.allGroups=null;this.settings=this.settings||i;e(this,this.settings);this.tileWidth=this.thisLayout.styleInfo.tileWidth;this.tileHeight=this.thisLayout.styleInfo.tileHeight;this.tileMargin=this.thisLayout.styleInfo.tileMarginWidth;this.aExcludedControlClass=this.aExcludedControlClass||[];this.reorderElementsCallback=this.reorderElementsCallback||function(){};this.rightToLeft=t.getRTL();this.tabBarArrowCollisionRight=false;this.tabBarArrowCollisionLeft=false;this.collidedLinkAreas=[];this.intersectedLink=null;this.aLinksBoundingRects=[];this.intersectedLinkPlaceHolder=undefined;this.isLinkPersonalizationSupported=this.thisLayout.oLaunchPageService?this.thisLayout.oLaunchPageService.isLinkPersonalizationSupported():null;this.isLinkMarkerShown=false;this.bIsTabBarCollision=false},moveDraggable:function(t,e,i){const s=this.getCollisionObject(t,e,i);let n;if(s){this._toggleAnchorItemHighlighting(false);if(s.collidedObjectType!=="TabBar"){this._toggleTabBarOverflowArrows(false);this.thisLayout.setOnTabBarElement(false);this._resetOverFlowButtonElements();this.bIsTabBarCollision=false}else{this.bIsTabBarCollision=true;this._toggleTabBarOverflowArrows(true);this.removePlaceHolders();this._handleTabBarCollision(t,i)}if(this.isLinkPersonalizationSupported&&s.collidedObjectType==="Group-link"){n=this._handleLinkAreaIntersection(s.collidedObject,t,e)}else if(s.collidedObjectType==="Group-tile"){n=this._handleTileAreaIntersection(s.collidedObject,t,e);this._toggleTileCloneHoverOpacity(false)}if(n||this.endAreaChanged){this.handlePlaceHolder(s.collidedObject)}}else{this._removeEmptyLinkAreaMark()}},_toggleAnchorItemHighlighting:function(t){if(this.targetGroup){this.targetGroup.classList.toggle("sapUshellAnchorItemDropCollision",t);this.targetGroup.firstElementChild.classList.toggle("sapUshellAnchorInnerMarker",t)}},removePlaceHolders:function(){this._removeLinkDropMarker();this._removeEmptyLinkAreaMark();this._handleChangedGroup(this.currentGroup)},handlePlaceHolder:function(t){if(this.endArea==="tiles"){if(this.endAreaChanged){this._removeLinkDropMarker()}this.handlePlaceholderChange()}else if(this.endArea==="links"&&this.intersectedLink){this._changeLinkPlaceholder(this.intersectedLink,t);if(this.endAreaChanged){this.handlePlaceholderChange()}}},switchLinkWithClone:function(t){if(t){this.intersectedLinkPlaceHolder=t.getDomRef().cloneNode(true);this.intersectedLinkPlaceHolder.setAttribute("id","sapUshellIntersectedLinkPlaceHolder");t.$().replaceWith(this.intersectedLinkPlaceHolder)}},_removeLinkDropMarker:function(){jQuery("#sapUshellLinkDropMarker").remove();this.isLinkMarkerShown=false},saveLinkBoundingRects:function(t){const e=s.getElementById(t.getAttribute("id"));this.draggedLinkBoundingRects=e.getBoundingRects()},_getMarkerOffset:function(t,e){const i=e.getDomRef().getElementsByClassName("sapUshellLineModeContainer")[0].getBoundingClientRect();const s=i.left;const n=i.top;const o=this.rightToLeft?20:-1;const r=this.rightToLeft?42:21;let l=t[t.length-1].offset.x-s+t[t.length-1].width-o;let a=t[this.rightToLeft?t.length-1:0].offset.x-s-r;let h=t[this.rightToLeft?t.length-1:0].offset.y-n;let u=t[this.rightToLeft?0:t.length-1].offset.y-n;if(document.body.classList.contains("sapUiSizeCompact")){h-=6;u-=6}if(this.rightToLeft){if(i.right-t[t.length-1].offset.x-t[t.length-1].width<16){l=l-8}}else if(a<16){a=0}return{right:l,left:a,topLeft:h,topRight:u}},_changeLinkPlaceholder:function(t,e){const i=this.aLinksBoundingRects[t.link.getId()];const s=i.left;const n=i.topLeft;const o=i.topRight;const r=i.right;if(!e.getDomRef().querySelector("#sapUshellLinkDropMarker")){this._removeLinkDropMarker();const t=e.getDomRef().getElementsByClassName("sapUshellLinksInnerContainer")[0];jQuery(t).prepend(this.LinkDropMarker)}this.LinkDropMarker.style.left=`${t.leftSide?s:r}px`;this.LinkDropMarker.style.top=`${t.leftSide?n:o}px`;this.isLinkMarkerShown=true},showTilePlaceholder:function(t,e,i){const s=this.curTouchMatrixCords.row;const n=this.curTouchMatrixCords.column;this.domRef=this.item.getDomRef()?this.item.getDomRef():this.domRef;this.domRef.style.display="";this.removeExcludedElementsFromMatrix(this.aExcludedControlClass);const o=this.tiles||this.thisLayout.getGroupTiles(this.endGroup).slice(0);if(this.matrix[s]&&typeof this.matrix[s][n]==="object"){this.handleMatrixCollision(o,t,e,i);return}this._handleMoveOutOfBorders(o,t)},removeTilePlaceholder:function(){this.domRef=this.item.getDomRef()||this.domRef;let t=this.thisLayout.getGroupTiles(this.currentGroup);t=t.slice(0);if(this.startArea!=="links"&&t.indexOf(this.item)>-1){t.splice(t.indexOf(this.item),1)}if(!this.domRef.parentNode.contains("sapUshellLinksInnerContainer")){this.domRef.style.display="none"}this.thisLayout.initGroupDragMode(this.endGroup);const e=this.thisLayout.organizeGroup(t);this.thisLayout.renderLayoutGroup(this.currentGroup,e)},handlePlaceholderChange:function(){const t=this.currentGroup;const e=this.endGroup!==this.currentGroup;const i=this.endAreaChanged&&this.endArea==="links";const s=this.thisLayout.isTabBarActive()&&this.groupSwitched;this.tiles=this.thisLayout.getGroupTiles(this.endGroup).slice(0);this.matrix=this.thisLayout.organizeGroup(this.tiles);if(s){this.handleTabBarSwitch(t)}if(e){this._handleChangedGroup(t)}else if(i){this.removeTilePlaceholder()}if(!i){this.showTilePlaceholder(t,e,i)}},handleMatrixCollision:function(t,e,i,s){let n=this.matrix[this.curTouchMatrixCords.row][this.curTouchMatrixCords.column];const o=t.indexOf(n);const r=t.indexOf(this.item);if(this.rightToLeft){this.collisionLeft=!this.collisionLeft}if(r>-1&&r<o){n=t[o+1]}if(n===this.item){if(i||s){t.splice(t.indexOf(this.item),1)}this._handleTileReplace(t,e);return}const l=this.changeTilesOrder(this.item,n,t,this.matrix);if(l&&!this.isLinkMarkerShown){this._handleTileReplace(l,e)}},handleTabBarSwitch:function(t){this._appendTargetGroupDomRefWithDraggedTile();if(!this.item.getDomRef()){this.endGroup.getInnerContainersDomRefs()[0].appendChild(this.draggedTileDomRef)}else{this.endGroup.getInnerContainersDomRefs()[0].appendChild(this.item.getDomRef())}this.currentGroup=this.endGroup;const e=this.thisLayout.getGroupTiles(t);this.thisLayout.initGroupDragMode(this.endGroup);const i=this.thisLayout.organizeGroup(e);this.thisLayout.renderLayoutGroup(t,i)},_handleMoveOutOfBorders:function(t,e){const i=this.findTileToPlaceAfter(this.matrix,t);if(t[i+1]===this.item){return}let s;if(t[i+1]){s=t[i+1]}else if(this.currentGroup.getShowPlaceholder()){s=t[0]}const n=this.changeTilesOrder(this.item,s,t,this.matrix);if(n){this._handleTileReplace(n,e)}},_handleChangedGroup:function(t){let e=this.thisLayout.getGroupTiles(this.currentGroup);if(this.currentGroup===this.startGroup&&(this.startArea==="tiles"||this.intersectedLinkPlaceHolder)){e=e.slice(0);if(e.indexOf(this.item)>-1){e.splice(e.indexOf(this.item),1)}}if(this.startGroup===this.endGroup&&this.startArea==="tiles"){this.tiles.splice(this.tiles.indexOf(this.item),1)}const i=this.item.getDomRef()||this.domRef;if(this.startArea==="links"&&!this.intersectedLinkPlaceHolder){this.switchLinkWithClone(this.item)}if(this.endArea==="tiles"){this.endGroup.getInnerContainersDomRefs()[0].appendChild(i)}if(!i.parentNode.contains("sapUshellLinksInnerContainer")){i.style.display="none"}this.currentGroup=this.endGroup;this.thisLayout.initGroupDragMode(this.endGroup);const s=this.thisLayout.organizeGroup(e);this.thisLayout.renderLayoutGroup(t,s)},_handleTileReplace:function(t,e){this.reorderElementsCallback({currentGroup:e,endGroup:this.endGroup,tiles:t,item:this.item});this.reorderTilesView(t,this.endGroup);this.reorderTilesInDom();this.thisLayout.renderLayoutGroup(this.endGroup,this.matrix)},_getIntersectedLink:function(t,e,i){const s=document.getElementsByClassName("sapUshellLinkTile")[0];if(!s){return}const n=t.getDomRef().querySelector(".sapUshellLineModeContainer").getBoundingClientRect();const o=!document.body.classList.contains("sapUiSizeCompact");let r=Math.floor((i-n.top)/(o?45:31));const l=this.collidedLinkAreas[t.getId()];let a;if(this.rightToLeft){a=Math.floor((n.right-e)/20)}else{a=Math.floor((e-n.left)/20)}if(r<l.length&&l[r]&&a<l[r].length){return l[r][a]}else if(l.length){const e=l.length;if(r>=e){r=e-1}if(!this.collidedLinkAreas[t.getId()][r]){return}a=this.collidedLinkAreas[t.getId()][r].length;return this.collidedLinkAreas[t.getId()][r][a-1]}},_mapGroupLinks:function(t){const e=t.getId();if(!this.collidedLinkAreas[e]||this.bElapseGroupLinksMap){this.bElapseGroupLinksMap=false;const i=t.getLinks();const s=[];let n;let o;let r=0;this.collidedLinkAreas.push(t.getId());i.forEach(e=>{o=this._getLinkBoundingRects(e,t);o.forEach(i=>{if(i.offset.y>n){r++}n=i.offset.y;this._addLinkToHashMap(s,t,i,r,e)})});this.collidedLinkAreas[e]=s}},_getLinkBoundingRects:function(t,e){let i=t.getBoundingRects();if(this.item&&this.item.getId()===t.getId()){i=this.draggedLinkBoundingRects}if(i.length){this.aLinksBoundingRects[t.getId()]=this._getMarkerOffset(i,e)}return i},_addLinkToHashMap:function(t,e,i,s,n){if(!t[s]){t[s]=[]}for(let e=0;e<=(i.width+20)/20;e++){const o={link:n,leftSide:!this.rightToLeft};if(e>(i.width+20)/20/2){o.leftSide=this.rightToLeft}t[s].push(o)}},_isLinkAreaIntersection:function(t,e,i){const s=t.getInnerContainersDomRefs();if(s[1]){return this._isElementCollideByGivenCordinates(s[1],e,i)}return false},_isLinksEquals:function(t,e){if(!t||!e){return false}if(t.link.getId()!==e.link.getId()){return false}return t.link.leftSide===e.link.leftSide},_toggleTileCloneHoverOpacity:function(t){const e=document.getElementsByClassName("sapUshellTile-clone");for(let i=0;i<e.length;++i){e[i].classList.toggle("sapUshellTileDragOpacity",t)}},_handleLinkAreaIntersection:function(t,e,i){if(this.isLinkPersonalizationSupported){this._toggleTileCloneHoverOpacity(true)}this._mapGroupLinks(t);this.matrix=this.matrix||this.thisLayout.organizeGroup(this.thisLayout.getGroupTiles(t));const s=this._getIntersectedLink(t,e,i);let n=false;if(s){n=this._isLinksEquals(this.intersectedLink,s);this.intersectedLink=s}else{this.removeTilePlaceholder()}this._markEmptyLinkArea(t);return n},_markEmptyLinkArea:function(t){if(!t.getLinks().length){const e=t.getDomRef();if(e){const t=e.getElementsByClassName("sapUshellLineModeContainer");for(let e=0;e<t.length;++e){t[e].classList.add("sapUshellEmptyLinkAreaHover")}}}},_removeEmptyLinkAreaMark:function(){const t=document.getElementsByClassName("sapUshellLineModeContainer");for(let e=0;e<t.length;++e){t[e].classList.remove("sapUshellEmptyLinkAreaHover")}},reorderTilesInDom:function(){const t=this.item.getDomRef()?this.item.getDomRef():this.domRef;const e=jQuery(t).index();const i=jQuery(t).closest(".sapUshellTilesContainer-sortable");const s=this.calcDestIndexInGroup();const n=jQuery(this.endGroup.getDomRef()).find(".sapUshellTilesContainer-sortable");let o=n.find(".sapUshellTile");if(this.startArea==="tiles"){i.find(o[e]).remove()}else if(!this.intersectedLinkPlaceHolder){this.switchLinkWithClone(this.item)}if(this.endArea!=="links"){o=n.find(".sapUshellTile");n[0].insertBefore(t,o[s])}},isLinkIntersected:function(){return this.intersectedLink!==undefined},calcDestIndexInGroup:function(){let t;let e=0;let i;let s;let n=false;for(i=0;i<this.matrix.length&&!n;i++){for(s=0;s<this.matrix[i].length;s++){if(this.matrix[i][s]!==undefined){if(this.item.sId!==this.matrix[i][s].sId){if(t!==this.matrix[i][s].sId){t=this.matrix[i][s].sId;e++}}else{n=true;break}}}}return e},layoutStartCallback:function(t){this.init();this.item=s.getElementById(t.getAttribute("id"));this.tilesInRow=this.thisLayout.getTilesInRow();this.groupsList=this.thisLayout.getGroups();this.allGroups=this.thisLayout.getAllGroups();this.startGroup=this.currentGroup=this.item.getParent();this.groupSwitched=false;this.startArea=this.isLinkPersonalizationSupported&&this.item.getMode&&this.item.getMode()==="LineMode"?"links":"tiles";this.currentArea=this.startArea;this.thisLayout.initDragMode();if(this.isLinkPersonalizationSupported){this.LinkDropMarker=this._getLinkDropMarkerElement()}},_getLinkDropMarkerElement:function(){const t=document.createElement("DIV");const e=document.createElement("DIV");const i=document.createElement("DIV");t.setAttribute("id","sapUshellLinkDropMarker");e.setAttribute("id","sapUshellLinkDropMarkerDot");i.setAttribute("id","sapUshellLinkDropMarkerLine");t.appendChild(e);t.appendChild(i);return t},isAreaChanged:function(){return this.currentArea&&this.endArea?this.currentArea!==this.endArea:false},isOriginalAreaChanged:function(){return this.startArea&&this.endArea?this.startArea!==this.endArea:false},_getDestinationIndex:function(t){if(t==="links"){if(this.intersectedLink){let t=this.endGroup.getLinks().indexOf(this.intersectedLink.link);const e=this.endGroup.getLinks().indexOf(this.item);if(this.intersectedLink.leftSide){t=this.rightToLeft?t+1:t-1}if(e<0||e>t){t=this.rightToLeft?t:t+1}return t}return this.endGroup.getLinks().length}return this._getDestinationTileIndex()},layoutEndCallback:function(){this._removeLinkDropMarker();if(this.endArea!=="links"&&!this.tiles){return{tile:this.item}}const t=this._getDragSourceGroup();if(!u.isTabBarActive()||!this.bIsTabBarCollision){this.targetGroup=""}const e=this._getDestGroupObject(this.targetGroup);const i={srcGroup:t,dstGroup:e,dstGroupData:this._getDropTargetGroup(),tile:this.item,dstTileIndex:this._getDestinationIndex(this.endArea),tileMovedFlag:true,srcArea:this.startArea,dstArea:this.bIsTabBarCollision?undefined:this.endArea};return i},_getDestGroupObject:function(t){return t?s.getElementById(t.getAttribute("id")):this.endGroup},_getDragSourceGroup:function(){let t;t=this.startGroup;if(this.thisLayout.isTabBarActive()&&this.groupSwitched===true){t={groupId:this.sDragStartGroupModelId}}return t},_getDropTargetGroup:function(){let t;if(this.thisLayout.isTabBarActive()&&this.thisLayout.isOnTabBarElement()){t={groupId:this.sDragTargetGroupModelId}}else{t=this.endGroup}return t},_getDestinationTileIndex:function(){let t;let e;if(this.thisLayout.isTabBarActive()&&this.thisLayout.isOnTabBarElement()){t=this._getDropTargetGroup().groupId;e=this._getModelGroupById(t);return e.tiles.length}return this.tiles.indexOf(this.item)},compareArrays:function(t,e){if(t.length!==e.length){return false}for(let i=0;i<t.length;i++){if(t[i]!==e[i]){return false}}return true},reorderTilesView:function(t){this.tiles=t;this.matrix=this.thisLayout.organizeGroup(t)},changeTilesOrder:function(t,e,i,s){const n=i.slice(0);const o=n.indexOf(t);let r;let l;let a;if(o>-1){n.splice(o,1)}if(e){n.splice(n.indexOf(e),0,this.item)}else{n.push(t)}if(this.currentGroup===this.endGroup){if(this.compareArrays(i,n)){return false}r=this.thisLayout.organizeGroup(n);l=this.thisLayout.getTilePositionInMatrix(t,s);a=this.thisLayout.getTilePositionInMatrix(t,r);if(l.row===a.row&&l.col===a.col){return false}}this.tiles=n;this.currentGroup=this.endGroup;return n},setMatrix:function(t){this.matrix=t},findTileToPlaceAfter:function(t,e){let i=this.thisLayout.rightToLeft?0:this.curTouchMatrixCords.column;const s=this.thisLayout.rightToLeft?1:-1;let n=0;let o;let r;let l;const a=t[0].length;for(o=this.curTouchMatrixCords.row;o>=0;o--){for(r=i;r>=0&&r<a;r+=s){if(!t[o]||typeof t[o][r]!=="object"){continue}l=e.indexOf(t[o][r]);n=l>n?l:n}i=t[0].length-1}return n||e.length-1},_isElementCollideByGivenCordinates:function(t,e,i){let s=t.getBoundingClientRect();let n=false;let o=false;if(s.height===0&&!t.classList.contains("sapUshellNoLinksAreaPresent")){s=t.parentNode.getBoundingClientRect()}n=s.right>=e&&s.left<=e;o=s.bottom>=i&&s.top<=i;return n&&o},_getMatrixCordinatesOfTouchedTile:function(t,i,s){let n=e({},this.curTouchMatrixCords);const o=t.getInnerContainersDomRefs()[0].getBoundingClientRect();this.matrix=this.matrix||this.thisLayout.organizeGroup(this.thisLayout.getGroupTiles(t));const r=this.rightToLeft?o.right+-1*i:o.left*-1+i;const l=(o.top*-1+s)/(this.tileHeight+this.tileMargin);const a=r/(this.tileWidth+this.tileMargin);n={row:Math.floor(l),column:Math.floor(a)};return n},_getCollidedGroup:function(t,e){for(let i=0;i<this.groupsList.length;i++){const s=this.groupsList[i];const n=s.getInnerContainersDomRefs();if(!n){continue}for(let o=0;o<n.length;o++){if(n[o]&&this._isElementCollideByGivenCordinates(n[o],t,e)){const t=!s.groupHasTiles();for(let e=this.groupsList.length-1;e>=i;e--){if(t){break}if(!this.groupsList[e].groupHasTiles()){const t=this.groupsList[e].getDomRef();if(!t||!t.classList.contains("sapUshellInDragMode")){continue}const i=t.getElementsByClassName("sapUshellInner");for(let t=0;t<i.length;t++){i[t].removeAttribute("style")}}}return s}}}},_handleTileAreaIntersection:function(t,i,s){const n=this._getMatrixCordinatesOfTouchedTile(t,i,s);if(t===this.endGroup&&n.column===this.curTouchMatrixCords.column&&n.row===this.curTouchMatrixCords.row){return false}if(this.rightToLeft){this.collisionLeft=this.curTouchMatrixCords.column-n.column>0}else{this.collisionLeft=n.column-this.curTouchMatrixCords.column>0}if(n.column===this.curTouchMatrixCords.column){this.collisionLeft=false}e(this.curTouchMatrixCords,n);return true},_getGroupCollisionObject:function(t,e){const i=this._getCollidedGroup(t,e);if(!i||i.getIsGroupLocked()){return undefined}const s=this._isLinkAreaIntersection(i,t,e);this.endGroup=i;if(!this.tiles){this.tiles=this.thisLayout.getGroupTiles(this.endGroup).slice(0)}this.endArea=s?"links":"tiles";this.endAreaChanged=this.isAreaChanged();this.currentArea=this.endArea;return{collidedObjectType:s?"Group-link":"Group-tile",collidedObject:i}},getCollisionObject:function(t,e){if(this.thisLayout.oTabBarItemClickTimer){clearTimeout(this.thisLayout.oTabBarItemClickTimer)}if(this.thisLayout.isTabBarActive()&&this._isTabBarCollision(e)){return{collidedObjectType:"TabBar"}}return this._getGroupCollisionObject(t,e)},_isTabBarScrollArea:function(t){const e=jQuery("#anchorNavigationBar").height()||0;const i=jQuery("#anchorNavigationBar").offset();const s=i?i.top:0;const n=e+s;return e>0&&t>n&&t<n+30},_cancelLongDropTimmer:function(){clearTimeout(this.thisLayout.oTabBarItemClickTimer)},_isTabBarCollision:function(t){const e=jQuery("#anchorNavigationBar").height()||0;const i=jQuery("#anchorNavigationBar").offset();const s=i?i.top:0;return t<e+s&&t>s},_handleTabBarCollision:function(t,e){const i=this._getTabBarHoverItem(t,e);if(u.isTabBarActive()){this._toggleTileCloneHoverOpacity(true)}this.lastHighlitedTabItem=i;this.thisLayout.setOnTabBarElement(true);const s=this._handleOverflowCollision(t);if(s){return}if(!i){return}this.targetGroup=i;this.sDragTargetGroupModelId=i.getAttribute("modelGroupId");const o=this._getTabBarGroupIndexByModelId(this.sDragTargetGroupModelId);if(this.thisLayout.oTabBarItemClickTimer){clearTimeout(this.thisLayout.oTabBarItemClickTimer)}const r=this._getModelGroupById(this._getDropTargetGroup().groupId);if(r.isGroupLocked){this._toggleTabBarOverflowArrows(false);this.thisLayout.setOnTabBarElement(false);this._resetOverFlowButtonElements();return}this._toggleAnchorItemHighlighting(true);if(!this.sDragStartGroupModelId){this.sDragStartGroupModelId=this.startGroup.getGroupId()}this.thisLayout.oTabBarItemClickTimer=setTimeout(()=>{const t=this._getSelectedTabBarItem();if(this.lastHighlitedTabItem===t){return}this.draggedTileModelPath=this.item.getBindingContext().getPath();this._prepareDomForDragAndDrop();this.startGroup.removeAggregation("tiles",this.item,true);const e=this.sDragStartGroupModelId===this.sDragTargetGroupModelId;this.item.getBindingContext().oModel.setProperty(`${this.draggedTileModelPath}/draggedInTabBarToSourceGroup`,e);this.groupSwitched=true;n.getInstance().publish("launchpad","switchTabBarItem",{iGroupIndex:o});const i=this.thisLayout.getGroups();this.endGroup=i[0];this.bElapseGroupLinksMap=true},800);if(this.tiles===null&&this.endGroup){this.tiles=this.thisLayout.getGroupTiles(this.endGroup).slice(0)}const l=document.getElementsByClassName("sapUshellTabBarHoverOn");for(let t=l.length-1;t>=0;--t){l[t].classList.remove("sapUshellTabBarHoverOn")}i.classList.add("sapUshellTabBarHoverOn");return true},_prepareDomForDragAndDrop:function(){const t=this.item.getDomRef();if(i.system.tablet){const e=t.cloneNode(true);const i=t.parentNode;this.origItemId=t.getAttribute("id");this.origItemDataSapUi=t.getAttribute("data-sap-ui");t.removeAttribute("id");t.removeAttribute("data-sap-ui");t.style.display="none";e.style.display="none";const s=document.getElementById("dashboardGroups");s.parentNode.appendChild(t);i.appendChild(e);this.draggedTileDomRef=t}else if(!this.draggedTileDomRef){this.draggedTileDomRef=t}},_appendTargetGroupDomRefWithDraggedTile:function(){const t=this.endGroup.getInnerContainerDomRefs()?this.endGroup.getInnerContainerDomRefs()[0]:null;if(!this.item.getDomRef()){if(i.system.tablet){this.draggedTileDomRef.setAttribute("id",this.origItemId);this.draggedTileDomRef.setAttribute("data-sap-ui",this.origItemDataSapUi);this.draggedTileDomRef.style.display=""}if(t){t.appendChild(this.draggedTileDomRef)}}else{if(t){t.appendChild(this.item.getDomRef())}if(i.system.tablet){this.item.getDomRef().style.display=""}}},_getSelectedTabBarItem:function(){return document.getElementsByClassName("sapUshellAnchorItemSelected")[0]},_getTabBarGroupIndexByModelId:function(t){let e;for(let i=0;i<this.allGroups.length;++i){e=this.allGroups[i].groupId;if(t===e){return i}}},_getModelGroupById:function(t){const e=this.thisLayout.getAllGroups();let i;let s;for(let n=0;n<e.length;++n){i=e[n];s=i.groupId;if(s===t){return i}}},_handleOverflowCollision:function(t){const e=s.getElementById("anchorNavigationBar");const i=this._calculateOverflowButtonSideCollision(t);if(i==="right"){if(!this.tabBarArrowCollisionRight){e._scrollToGroupByGroupIndex(e.anchorItems.length-1,5e3);this.tabBarArrowCollisionRight=true}return true}else if(i==="left"){if(!this.tabBarArrowCollisionLeft){e._scrollToGroupByGroupIndex(0,5e3);this.tabBarArrowCollisionLeft=true}return true}this._resetOverFlowButtonElements();return false},_calculateOverflowButtonSideCollision:function(t){const e=jQuery(".sapUshellAnchorRightOverFlowButton");const i=e.offset().left;const s=jQuery(".sapUshellAnchorItemOverFlow");const n=s.offset().left;const o=jQuery(".sapUshellAnchorLeftOverFlowButton");const r=o.offset().left;const l=32;const a=jQuery("#anchorNavigationBar");const h=a.offset().left;if(t>i&&t<n){return"right"}if(t>h&&t<r+l){return"left"}},_resetOverFlowButtonElements:function(){const t=i.system.tablet;const e=jQuery(t?".sapUshellAnchorNavigationBarItemsScroll":".sapUshellAnchorNavigationBarItems");e.stop();this.tabBarArrowCollisionRight=false;this.tabBarArrowCollisionLeft=false},_toggleTabBarOverflowArrows:function(t){const e=document.getElementsByClassName("sapUshellAnchorRightOverFlowButton");const i=document.getElementsByClassName("sapUshellAnchorLeftOverFlowButton");for(let i=0;i<e.length;++i){e[i].classList.toggle("sapUshellTabBarOverflowButton",t)}for(let e=0;e<i.length;++e){i[e].classList.toggle("sapUshellTabBarOverflowButton",t)}},_getTabBarHoverItem:function(t,e){const i=jQuery(".sapUshellAnchorItem:not(.sapUshellShellHidden)").eq(0).offset().left;if(t-i<=0){return}let s=Math.round((t-i)/10);if(s>=e.length){s=e.length-1}const n=e[s];const o=document.getElementsByClassName("sapUshellAnchorItem");return o[n]},removeExcludedElementsFromMatrix:function(t){if(!t.length){return}if(!this.matrix){return}const e=this.matrix.map(e=>e.map(e=>{const i=t.some(t=>e instanceof t);return i?undefined:e}));this.setMatrix(e)},setExcludedControl:function(t){if(t){this.aExcludedControlClass.push(t)}},setReorderTilesCallback:function(t){if(typeof t==="function"){this.reorderElementsCallback=t}}};function a(){}let h;a.prototype={_initDeferred:new Promise(t=>{h=t}),init:function(t){const e=function(){const t=this.container&&this.container.getAttribute("id")||"";if(t.includes("destroyed")){return}const i=this.getStyleInfo(this.container);if(i.tileWidth>0){this.isInited=true;this.reRenderGroupsLayout();this.layoutEngine=new l({thisLayout:this});h();return}setTimeout(e,100)}.bind(this);this.cfg=t||this.cfg;this.minTilesinRow=2;this.container=this.cfg.container||document.getElementById("dashboardGroups");this.oTabBarItemClickTimer=new Date;this.bTabBarModeActive=false;this.bOnTabBarElement=false;const i=r.getServiceAsync("FlpLaunchPage");if(i){i.then(t=>{this.oLaunchPageService=t;e()})}else{e()}n.getInstance().subscribe("launchpad","tabBarChange",this._onTabBarChange,this);return this.getInitPromise()},setOnTabBarElement:function(t){this.bOnTabBarElement=t},isOnTabBarElement:function(){return this.bOnTabBarElement},_onTabBarChange:function(t,e,i){if(i==="tabs"){this.bTabBarModeActive=true}else{this.bTabBarModeActive=false}},tabBarTileDropped:function(){if(this.oTabBarItemClickTimer){clearTimeout(this.oTabBarItemClickTimer)}},getInitPromise:function(){return this._initDeferred},getLayoutEngine:function(){return this.layoutEngine},getStyleInfo:function(t){const e=document.createElement("div");const i=t.getAttribute("id");t=i?document.getElementById(i):t;if(!t){return{}}e.className="sapUshellTile";const s=o.last("/core/home/sizeBehavior");if(s==="Small"){e.classList.add("sapUshellSmall")}e.style.position="absolute";e.style.visibility="hidden";t.appendChild(e);const n=window.getComputedStyle(e);const r=window.getComputedStyle(t);const l={tileMarginHeight:parseFloat(n.marginBottom,10)+parseFloat(n.marginTop,10),tileMarginWidth:parseFloat(n.marginLeft,10)+parseFloat(n.marginRight,10),tileWidth:e.offsetWidth,tileHeight:e.offsetHeight,containerWidth:r.width?parseInt(r.width,10):t.offsetWidth};t.removeChild(e);return l},getGroups:function(){return this.cfg.getGroups()},getAllGroups:function(){return this.cfg.getAllGroups?this.cfg.getAllGroups():[]},isTabBarActive:function(){return this.cfg.isTabBarActive?this.cfg.isTabBarActive():false},getTilesInRow:function(){return this.tilesInRow},setTilesInRow:function(t){this.tilesInRow=t},checkPlaceForTile:function(t,i,s,n,o){if(typeof i[s.y]==="undefined"){i.push(new Array(i[0].length))}if(typeof i[s.y+1]==="undefined"){i.push(new Array(i[0].length))}if(typeof i[s.y][s.x]!=="undefined"){return false}const r=e({},s);if(o||t&&t.getLong&&!t.getLong()){return[r]}const l=[r];if(t&&t.getLong&&t.getLong()){if(s.x+1>=i[0].length||typeof i[r.y][r.x+1]!=="undefined"){return false}l.push({y:r.y,x:r.x+1})}return l},placeTile:function(t,e,i){for(let s=0;s<i.length;s++){e[i[s].y][i[s].x]=t}},getTilePositionInMatrix:function(t,e){for(let i=0;i<e.length;i++){for(let s=0;s<e[i].length;s++){if(e[i][s]===t){return{row:i,col:s}}}}return false},fillRowsInLine:function(t,e,i,s){if(!e.length){return 0}let n;for(let o=0;o<t[0].length&&e.length;o++){n=this.checkPlaceForTile(e[0],t,{x:o,y:i},s);if(n){this.placeTile(e[0],t,n);e.shift()}}},organizeGroup:function(t,e){const i=t.slice(0);let s=[];let n=0;s.push(new Array(e?Math.floor(this.tilesInRow/2):this.tilesInRow));while(i.length){this.fillRowsInLine(s,i,n,e);n++}if(this.rightToLeft){for(let t=0;t<s.length;t++){s[t].reverse()}}s=this.cleanRows(s);return s},cleanRows:function(t){let e=false;for(let i=t.length-1;i>0&&!e;i--){for(let s=0;s<t[i].length&&!e;s++){if(typeof t[i][s]==="object"){e=true}}if(!e){t.pop()}}return t},setGroupsLayout:function(t,e){if(t.getIsGroupLocked()&&e.length>0){const e=t.getDomRef().parentElement;t.getDomRef().style.width="";e.style.width="";e.style.display=""}},calcTilesInRow:function(t,e,i){let s=Math.floor(t/(e+i));s=s<this.minTilesinRow?this.minTilesinRow:s;return s},getGroupTiles:function(t){const e=t.getTiles();if(t.getShowPlaceholder()){e.push(t.oPlusTile)}return e},reRenderGroupsLayout:function(t){if(!this.isInited){return}const e=this.getStyleInfo(this.container);if(!e.tileWidth){return}this.styleInfo=e;this.tilesInRow=this.calcTilesInRow(e.containerWidth,e.tileWidth,e.tileMarginWidth);t=t||this.getGroups();for(let e=0;e<t.length;e++){if(t[e].getDomRef&&!t[e].getDomRef()){continue}const i=this.getGroupTiles(t[e]);const s=this.organizeGroup(i);this.setGroupsLayout(t[e],s)}},initDragMode:function(){this.initGroupDragMode(this.layoutEngine.currentGroup)},endDragMode:function(){const t=this.getGroups();for(let e=0;e<t.length;e++){const i=t[e].getDomRef();if(!i||!i.classList.contains("sapUshellInDragMode")){continue}i.classList.remove("sapUshellInDragMode");const s=this.getGroupTiles(t[e]);for(let t=0;t<s.length;t++){s[t].getDomRef().removeAttribute("style")}const n=i.getElementsByClassName("sapUshellInner");for(let t=0;t<n.length;t++){n[t].removeAttribute("style")}}},initGroupDragMode:function(t){if(t.$().hasClass("sapUshellInDragMode")){return}const e=this.getGroupTiles(t);const i=this.organizeGroup(e);t.$().addClass("sapUshellInDragMode");this.renderLayoutGroup(t,i)},calcTranslate:function(t,e){let i=e*(this.styleInfo.tileWidth+this.styleInfo.tileMarginWidth);const s=t*(this.styleInfo.tileHeight+this.styleInfo.tileMarginHeight);if(this.layoutEngine.rightToLeft){i=-i}return{x:i,y:s}},renderLayoutGroup:function(t,e){let i;this.styleInfo=this.getStyleInfo(this.container);for(let t=0;t<e.length;t++){for(let s=0;s<e[t].length;s++){if(i===e[t][s]){continue}else{i=e[t][s]}if(typeof i==="undefined"){break}}}}};const u=new a;return u});
//# sourceMappingURL=Layout.js.map