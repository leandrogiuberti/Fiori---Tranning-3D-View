// Copyright (c) 2009-2025 SAP SE, All Rights Reserved
sap.ui.define(["sap/ui/core/mvc/View","sap/ui/core/mvc/Controller","sap/ui/thirdparty/jquery","sap/m/MessageToast","sap/ushell/resources","sap/ushell/Container"],(e,t,jQuery,o,s,r)=>{"use strict";let n;return t.extend("sap.ushell.components.appfinder.HierarchyApps",{onInit:function(){const e=this.getView().getViewData().easyAccessSystemsModel;if(e){this.getView().setModel(e,"easyAccessSystems")}n=this.getView().getViewData().CatalogsManager&&this.getView().getViewData().CatalogsManager.getInstance()},getCrumbsData:function(e,t){const o=e.split("/");o.splice(o.length-2,2);const s=[];while(o.length){const e=o.join("/");const r=t.getProperty(`${e}/text`);s.unshift({text:r,path:e});o.splice(o.length-2,2)}return s},_updateAppBoxedWithPinStatuses:function(e){const t=this.getView();if(!e){e=t.layout.getBinding("items").getPath()}const o=t.getModel("easyAccess");const s=o.getProperty(e)?o.getProperty(e):[];this.getView().oVisualizationOrganizerHelper.updateBookmarkCount.call(this,s).then(t=>{o.setProperty(e,t)})},updateBookmarkCount:function(e){return r.getServiceAsync("BookmarkV2").then(t=>{const o=e.map(e=>t.countBookmarks(e.url).then(t=>{e.bookmarkCount=t;return e}));return new Promise(e=>{jQuery.when.apply(jQuery,o).then(function(){const t=Array.prototype.slice.call(arguments);e(t)})})})},updatePageBindings:function(e){this.getView().layout.bindAggregation("items",`easyAccess>${e}/apps`,this.getView().oItemTemplate);this._updateAppBoxedWithPinStatuses(`${e}/apps`);this.getView().breadcrumbs.bindProperty("currentLocationText",`easyAccess>${e}/text`);const t=this.getCrumbsData(e,this.getView().getModel("easyAccess"));this.getView().crumbsModel.setProperty("/crumbs",t);const o=this.getView().getModel("easyAccess").getProperty(`${e}/apps`);this.getView().updateResultSetMessage(o.length,false)},onAppBoxPressed:function(e){if(e.mParameters.srcControl.$().closest(".sapUshellPinButton").length){return}const t=e.getSource().getProperty("url");if(t&&t.indexOf("#")===0){hasher.setHash(t)}},_handleSuccessMessage:function(e,t){let r;const n=t.addToGroups?t.addToGroups.length:0;const a=t.newGroups?t.newGroups.length:0;const i=n+a;if(i===1){let o;if(n===1){o=t.addToGroups[0].title}else{o=t.newGroups[0]}r=s.i18n.getText("appAddedToSingleGroup",[e.text,o])}else{r=s.i18n.getText("appAddedToSeveralGroups",[e.text,i])}if(i>0){o.show(r)}return r},_prepareErrorMessage:function(e,t){let o;let s;let r;let n=0;let a=false;let i;for(const t in e){o=e[t].group;s=e[t].action;if(s==="addBookmark_ToExistingGroup"){n++;if(n===1){r=o.title}}else if(s==="addBookmark_ToNewGroup"){n++;if(n===1){r=o}}else{a=true}}if(a){if(e.length===1){i={messageId:"fail_tile_operation_create_new_group"}}else{i={messageId:"fail_tile_operation_some_actions"}}}else if(e.length===1){i={messageId:"fail_app_operation_add_to_group",parameters:[t,r]}}else{i={messageId:"fail_app_operation_add_to_several_groups",parameters:[t]}}return i},_handleBookmarkAppPopoverResponse:function(e,t){const o=[];t.newGroups.forEach(t=>{o.push(this._createGroupAndAddBookmark(t,e))});t.addToGroups.forEach(t=>{o.push(this._addBookmark(t,e))});return jQuery.when.apply(jQuery,o).then(function(){const o=Array.prototype.slice.call(arguments);this._handlePopoverGroupsActionPromises(e,t,o)}.bind(this))},_handlePopoverGroupsActionPromises:function(e,t,o){const s=o.filter((e,t,o)=>!e.status);if(s.length){const t=this._prepareErrorMessage(s,e.text);n.notifyOnActionFailure(t.messageId,t.parameters);return}this._updateAppBoxedWithPinStatuses();this._handleSuccessMessage(e,t)},_createGroupAndAddBookmark:function(e,t){const o=jQuery.Deferred();let s={};const r=n.createGroup(e);r.done(r=>{const n=this._addBookmark(r.getObject(),t,true);n.done(e=>{o.resolve(e)}).fail(()=>{s={group:e,status:0,action:"addBookmark_ToNewGroup"};o.resolve(s)})}).fail(()=>{s={group:e,status:0,action:"addBookmark_NewGroupCreation"};o.resolve(s)});return o.promise()},_addBookmark:function(e,t,o){const s=jQuery.Deferred();let n={};r.getServiceAsync("BookmarkV2").then(r=>{const a=r.addBookmark({url:t.url,title:t.text,subtitle:t.subtitle,icon:t.icon},e.object);const i=o?"addBookmark_ToNewGroup":"addBookmark_ToExistingGroup";a.then(()=>{n={group:e,status:1,action:i};s.resolve(n)}).catch(()=>{n={group:e,status:0,action:i};s.resolve(n)})});return s.promise()},showSaveAppPopover:function(e){this.getView().oVisualizationOrganizerHelper.onHierarchyAppsPinButtonClick.call(this,e).then(e=>{if(e){this._updateAppBoxedWithPinStatuses()}})},showGroupListPopover:function(t){const o=this.getView().getModel();const s=t.oSource.getParent().getBinding("title").getContext().getObject();const r=t.oSource;if(o.getProperty("/groupContext").path){const e=o.getProperty("/groupContext").path;const t=o.getProperty(e);const r={newGroups:[],addToGroups:[t]};this._handleBookmarkAppPopoverResponse(s,r);return}const n=o.getProperty("/groups").map(e=>({selected:false,initiallySelected:false,oGroup:e}));e.create({viewName:"module:sap/ushell/components/appfinder/GroupListPopoverView",viewData:{enableHideGroups:o.getProperty("/enableHideGroups"),enableHelp:o.getProperty("/enableHelp"),singleGroupSelection:true}}).then(e=>{e.getController().initializeData({groupData:n});const t=e.open(r);t.then(this._handleBookmarkAppPopoverResponse.bind(this,s));this.getView().addDependent(e);return e})},resultTextFormatter:function(e,t){const o=s.i18n;if(e){const s=e.systemName?e.systemName:e.systemId;let r="";if(t){r=o.getText("search_easy_access_results",[t,s])}return r}return""},showMoreResultsVisibilityFormatter:function(e,t){if(e&&e.length<t){return true}return false},showMoreResultsTextFormatter:function(e,t){if(!e||!t){return""}const o=e.length;return s.i18n.getText("EasyAccessSearchResults_ShowMoreResults",[o,t])}})},true);
//# sourceMappingURL=HierarchyApps.controller.js.map