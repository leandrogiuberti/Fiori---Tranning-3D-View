// Copyright (c) 2009-2025 SAP SE, All Rights Reserved
sap.ui.define(["sap/ui/core/mvc/Controller","sap/base/Log","sap/ui/thirdparty/jquery","sap/ui/model/FilterOperator","sap/ui/model/Filter","sap/m/StandardListItem","sap/m/SelectDialog","sap/ui/core/Component","sap/ushell/Container"],(e,t,jQuery,s,i,r,n,o,a)=>{"use strict";return e.extend("sap.ushell.components.appfinder.HierarchyFolders",{onInit:function(){this.oDialog=null;this.getView().setModel(this.getView().getViewData().easyAccessSystemsModel,"easyAccessSystems");this.getView().setModel(this.getView().getViewData().subHeaderModel,"subHeaderModel");this.getSelectedSystem().then(e=>{if(e){this.setSystemSelected(e)}else{this.setSystemSelected(undefined);this.onSystemSelectionPress()}}).catch(()=>{this.setSystemSelected(undefined);this.onSystemSelectionPress()})},onExit:function(){if(this.oDialog){this.destroyDialog()}},onAfterRendering:function(){const e=jQuery(`#${this.getView().getId()}`);e.on("click",()=>{this.exitSearchMode()})},getPersonalizer:function(){if(!this.oPersonalizerPromise){this.oPersonalizerPromise=a.getServiceAsync("PersonalizationV2").then(e=>{const t=o.getOwnerComponentFor(this);const s={keyCategory:e.KeyCategory.FIXED_KEY,writeFrequency:e.WriteFrequency.LOW,clientStorageAllowed:true};const i={container:"appfinder.HierarchyFolders",item:"lastSelectedSystem"};return e.getPersonalizer(i,s,t)})}return this.oPersonalizerPromise},getSelectedSystem:function(){const e=new jQuery.Deferred;const t=this.getView().getModel("easyAccessSystems").getProperty("/systemsList");if(t&&t.length&&t.length===1){const s=t[0];this.setSystemSelectedInPersonalization(s);e.resolve(s)}else{this.getSelectedSystemInPersonalization().then(s=>{if(s){let i=false;for(let r=0;r<t.length;r++){if(t[r].systemName&&t[r].systemName===s.systemName||t[r].systemId===s.systemId){i=true;e.resolve(s)}}if(!i){e.resolve();this.setSystemSelectedInPersonalization()}}else{e.resolve()}})}return e.promise()},setSystemSelected:function(e){this.getView().getModel("easyAccessSystems").setProperty("/systemSelected",e);this.setSystemSelectedInPersonalization(e)},getSelectedSystemInPersonalization:function(){const e=new jQuery.Deferred;this.getPersonalizer().then(s=>{s.getPersData().then(t=>{if(t){e.resolve(t)}else{e.resolve()}}).catch(s=>{t.error("Failed to get selected system from the personalization",s,"sap.ushell.components.appfinder.HierarchyFolders");e.reject(s)})});return e.promise()},setSystemSelectedInPersonalization:function(e){this.getPersonalizer().then(s=>{s.setPersData(e).catch(e=>{t.error("Failed to save selected system in the personalization",e,"sap.ushell.components.appfinder.HierarchyFolders")})})},onSystemSelectionPress:function(){const e=this.getView().getModel("easyAccessSystems").getProperty("/systemsList");if(e&&e.length&&e.length<=1){return}const t=this.createDialog();t.open()},createDialog:function(){const e=this;if(!this.oDialog){this.oDialog=new n({id:"systemSelectionDialog",title:e.getView().translationBundle.getText("easyAccessSelectSystemDialogTitle"),multiSelect:false,contentHeight:"20rem",items:{path:"/systemsList",template:new r({adaptTitleSize:false,title:{parts:["systemName","systemId"],formatter:e.titleFormatter},description:{parts:["systemName","systemId"],formatter:e.descriptionFormatter},selected:{parts:["systemName","systemId"],formatter:e.selectedFormatter.bind(this)}})},confirm:e.systemConfirmHandler.bind(e),search:e.systemSearchHandler.bind(e),cancel:e.destroyDialog.bind(e)});this.oDialog.setModel(this.getView().getModel("easyAccessSystems"))}return this.oDialog},destroyDialog:function(){this.oDialog.destroyItems();this.oDialog.destroy();this.oDialog=null},systemConfirmHandler:function(e){const t=e.getParameters().selectedItem;const s=t.getBindingContext().getObject();this.setSystemSelected(s);this.destroyDialog()},systemSearchHandler:function(e){const t=e.getParameter("value");const r=new i("systemName",s.Contains,t);const n=new i("systemId",s.Contains,t);const o=new i({filters:[n,r],and:false});const a=e.getSource().getBinding("items");a.filter(o)},titleFormatter:function(e,t){return e||t},descriptionFormatter:function(e,t){if(e){return t}return null},selectedFormatter:function(e,t){const s=this.getView().getModel("easyAccessSystems").getProperty("/systemSelected");if(!s){return false}if(e){return s.systemName===e&&s.systemId===t}return s.systemId===t},systemSelectorTextFormatter:function(e){if(e){if(e.systemName){return e.systemName}return e.systemId}return this.getView().translationBundle.getText("easyAccessSelectSystemTextWithoutSystem")},exitSearchMode:function(){const e=this.getView().getModel("subHeaderModel");e.setProperty("/search/searchMode",false);e.refresh(true)}})},true);
//# sourceMappingURL=HierarchyFolders.controller.js.map