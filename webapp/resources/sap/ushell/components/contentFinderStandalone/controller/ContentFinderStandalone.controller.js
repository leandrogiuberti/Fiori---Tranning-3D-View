// Copyright (c) 2009-2025 SAP SE, All Rights Reserved
sap.ui.define(["sap/ui/core/mvc/Controller","sap/ushell/utils/workpage/WorkPageService","sap/ushell/components/contentFinder/CatalogService","sap/ushell/Container","sap/ushell/EventHub","sap/ushell/resources","sap/base/Log","sap/ushell/services/MessageInternal","sap/m/library"],(e,t,n,i,a,o,r,s,l)=>{"use strict";return e.extend("sap.ushell.components.contentFinderStandalone.controller.ContentFinderStandalone",{onInit:function(){this.oWorkPageService=new t;this.oCatalogService=new n;this.pShellUIService=this.getOwnerComponent().getService("ShellUIService");this.oRouter=i.getRendererInternal().getRouter();this.oRouter.getRoute("appfinder").attachMatched(this._handleContentFinderNavigation.bind(this))},getResourceBundle:function(){return this.getOwnerComponent().getResourceBundle()},_handleContentFinderNavigation:async function(){await this._awaitAppLoaded();const e=await this.pShellUIService;e.setTitle(o.i18n.getText("appFinderTitle"))},_awaitAppLoaded:async function(){const e=await i.getServiceAsync("AppLifeCycle");const t=Promise.withResolvers();e.attachAppLoaded(t.resolve);await t.promise;e.detachAppLoaded(t.resolve)},appSearchComponentCreated:async function(e){this.oComponent=e.getParameter("component");a.emit("CenterViewPointContentRendered");this.oComponent.attachVisualizationFilterApplied(null,this._onVisualizationFilterApplied,this);const t=this.oComponent.getSelectedVisualizationFilter();const n=this._transformFilterParams(t);const i=this.oWorkPageService.loadVisualizations(n).then(e=>{this.oComponent.setVisualizationData(e)}).catch(e=>{r.error("ContentFinderStandalone: Visualization data loading failed:",e);this.oComponent.setVisualizationData(undefined,undefined,this._getErrorOnLoadingMessage())});const o=this.setCategoryTree();const s=new URL(location.href);s.searchParams.append("sap-ushell-xx-overwrite-config","/core/workPages/contentFinderStandalone:false");this.oComponent.getUiModel().setProperty("/linkToAppFinder",s.toString());await i;await o},setCategoryTree:async function(){let e;try{e=await this.oCatalogService.getCatalogs()}catch(e){r.error("Catalog fetching failed with:",e);return}let t=[];if(e?.catalogs?.length>0){t=[{id:undefined,title:this.getResourceBundle().getText("ContentFinderStandalone.CategoryTree.Category.AllTiles"),filterIsTitle:true,inactive:false,allowedFilters:["tiles"]},{id:"$$catalogs",title:this.getResourceBundle().getText("ContentFinderStandalone.CategoryTree.Category.Catalogs"),inactive:true,filterIsTitle:false,nodes:e?.catalogs,$count:e?.totalCount,allowedFilters:["tiles"]}]}this.oComponent.setCategoryTree(t)},_onVisualizationFilterApplied:async function(e){const t=this._transformFilterParams(e.getParameters());let n;let i;const a=e.getParameter("categoryId");try{if(a){n=await this.oCatalogService.loadVisualizations(a,t)}else{n=await this.oWorkPageService.loadVisualizations(t)}}catch(e){r.error("ContentFinderStandalone: Visualization data loading failed:",e);const n=Number(t.skip)>0;if(!n){i=this._getErrorOnLoadingMessage()}else{(new s).error(this.getResourceBundle().getText("ContentFinderStandalone.AppSearch.NextPage.Error.Title"))}}this.oComponent.setVisualizationData(n,undefined,i)},_transformFilterParams:function(e){const t=e?.pagination?.top;const n=e?.pagination?.skip;const i=e?.search;const a=e?.types||[];const o=a.length>0?[{in:a}]:[];const r=i?{type:o,descriptor:[{conditions:[{propertyPath:"/sap.app/title",stringFilter:[{containsIgnoreCase:i}]}]},{conditions:[{propertyPath:"/sap.app/subTitle",stringFilter:[{containsIgnoreCase:i}]}]},{conditions:[{propertyPath:"/sap.app/info",stringFilter:[{containsIgnoreCase:i}]}]},{conditions:[{propertyPath:"/sap.fiori/registrationIds",anyFilter:[{conditions:[{stringFilter:[{containsIgnoreCase:i}]}]}]}]}]}:{type:o};return{top:t,skip:n,filter:[r]}},_getErrorOnLoadingMessage:function(){return{type:l.IllustratedMessageType.UnableToLoad,title:this.getResourceBundle().getText("ContentFinderStandalone.AppSearch.Error.LoadingApps.Title"),description:this.getResourceBundle().getText("ContentFinderStandalone.AppSearch.Error.LoadingApps.Details")}}})});
//# sourceMappingURL=ContentFinderStandalone.controller.js.map