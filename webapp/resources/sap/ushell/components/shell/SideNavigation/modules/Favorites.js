// Copyright (c) 2009-2025 SAP SE, All Rights Reserved
sap.ui.define(["sap/m/GenericTile","sap/tnt/NavigationListGroup","sap/tnt/NavigationListItem","sap/ui/core/ComponentContainer","sap/ui/core/CustomData","sap/ui/model/Filter","sap/ui/model/FilterOperator","sap/ui/model/json/JSONModel","sap/ushell/Config","sap/ushell/Container","sap/ushell/components/shell/SideNavigation/modules/NavigationHelper","sap/ui/model/resource/ResourceModel","sap/base/i18n/Localization"],(e,t,i,s,a,o,n,r,l,d,c,u,p)=>{"use strict";class g{#e;#t;#i;#s;#a={};#o;constructor(e){this.#o=new u({bundleUrl:sap.ui.require.toUrl("sap/ushell/components/shell/SideNavigation/resources/resources.properties"),bundleLocale:p.getLanguage(),async:true});this.#e=e;this.#i=new t({text:"{i18n>SideNavigation.Item.Favorites.Title}",enabled:"{viewConfiguration>/enableSideNavigation}",items:{path:"favorites>/",key:"{favorites>id}",factory:this.#n.bind(this)},customData:[new a({key:"help-id",value:"MenuEntry-Favorites",writeToDom:true})]});this.#t=new Promise((e,t)=>{this.#r(e,t)});this.#s=new c}async getRootItem(){return this.#t}async onItemPressed(e){const t=e.getSource().getBindingContext("favorites").getProperty();if(!t.vizType){return}const i=this.#a[t.id];if(i){await i.loaded();this.#l(i.getContent())?.firePress()}else if(t.targetURL&&t.target?.type==="URL"){this.#s.navigate({target:{url:t.targetURL},type:"URL"})}else if(t.targetURL&&t.target?.semanticObject&&t.target?.action){this.#s.navigate({target:{shellHash:t.targetURL},type:"IBN"})}this.#e.closeSideNavigation()}async#r(e,t){const i=await d.getServiceAsync("Pages");const s=l.last("/core/spaces/myHome/myHomePageId");if(!s){t(new Error("MyHome pageId is not defined"));return}const a=await i.loadPage(s);if(!a){t(new Error("MyHome page not loaded"));return}const o=i.getModel();const n=new r([]);o.attachEvent("dataChange",()=>{this.#d(n,s)});this.#i.setModel(n,"favorites");await this.#d(n,s);e(this.#i)}async#d(e,t){const i=await d.getServiceAsync("Pages");const s=await i.loadPage(t);const a=i.getModel();const o=a.getProperty(`${s}/sections`)||[];const n=[];let r;const l=e.getProperty("/");const c=l.reduce((e,t)=>{e[t.id]=t.expanded;return e},{});o.forEach(e=>{if(e.default){r=e;return}const t=e.visualizations;if(t.length>0){this.#c(t);n.push({id:e.id,title:e.title,visualizations:t,expanded:!!c[e.id]})}});const u=(await this.#o.getResourceBundle()).getText("SideNavigation.Item.Favorites.AddApps");n.push({id:"addAppsToFavoritesFolder",title:u,vizType:"sap.ushell.StaticAppLauncher",targetURL:"#Shell-appfinder"});if(r?.visualizations?.length>0){this.#c(r.visualizations);n.splice(0,0,...r.visualizations)}e.setProperty("/",n)}#c(e){d.getServiceAsync("VisualizationInstantiation").then(t=>{e.forEach(e=>{if(e.vizType?.startsWith("X-SAP-UI2-CHIP:SSB")&&!this.#a[e.id]){const i=t.instantiateVisualization(e);i.setActive(true);i.loaded().then(()=>{const t=this.#l(i.getContent())?.getHeader();if(!e.title&&t){const i=this.#i.getModel("favorites");const s=i.getProperty("/");for(let a=0;a<s.length;a++){const o=s[a];if(o.id===e.id){i.setProperty(`/${a}/title`,t);i.setProperty(`/${a}/targetURL`,"")}if(Array.isArray(o.visualizations)){for(let s=0;s<o.visualizations.length;s++){const n=o.visualizations[s];if(n.id===e.id){i.setProperty(`/${a}/visualizations/${s}/title`,t);i.setProperty(`/${a}/visualizations/${s}/targetURL`,"")}}}}}});this.#a[e.id]=i}})})}#l(t){if(!t){return null}if(t instanceof e){return t}else if(t instanceof s){t=t.getComponentInstance().getRootControl()}const i=t.getMetadata();const a=i.getDefaultAggregation()||null;const o=a?a?.name:"content";const n=o?t.getAggregation(o):null;const r=Array.isArray(n)?n[0]:n;if(!r){return null}return this.#l(r)}#n(e){return new i(e,{key:"{favorites>id}",text:"{= !%{favorites>vizType} && %{favorites>title} === '' ? %{i18n>SideNavigation.Item.Favorites.UntitledFolder} : %{favorites>title} }",enabled:"{viewConfiguration>/enableSideNavigation}",expanded:"{favorites>expanded}",icon:"{= !%{favorites>vizType} ? 'sap-icon://folder' : '' }",href:"{favorites>targetURL}",selectable:false,visible:{path:"favorites>visualizations",formatter:e=>e?.some(e=>!!e.title)},items:{path:"favorites>visualizations",template:new i({key:"{favorites>id}",text:"{favorites>title}",enabled:"{viewConfiguration>/enableSideNavigation}",href:"{favorites>targetURL}",selectable:false,press:this.onItemPressed.bind(this)}),filters:new o("title",n.NE,"")},press:this.onItemPressed.bind(this)})}}return g},false);
//# sourceMappingURL=Favorites.js.map