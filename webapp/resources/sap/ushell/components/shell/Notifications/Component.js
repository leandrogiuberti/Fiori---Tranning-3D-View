// Copyright (c) 2009-2025 SAP SE, All Rights Reserved
sap.ui.define(["sap/base/Log","sap/ui/core/Element","sap/ui/core/EventBus","sap/ui/core/IconPool","sap/ui/core/InvisibleText","sap/ui/core/UIComponent","sap/ui/thirdparty/hasher","sap/ui/Device","sap/m/library","sap/m/Popover","sap/ushell/Config","sap/ushell/EventHub","sap/ushell/library","sap/ushell/resources","sap/ushell/utils","sap/ushell/ui/shell/ShellHeadItem","sap/ushell/Container","sap/ushell/state/ShellModel","sap/ui/core/mvc/XMLView","sap/ui/core/Fragment"],(t,e,i,o,n,s,a,r,l,c,h,f,d,u,p,g,N,m,b,v)=>{"use strict";const C=10;const y=l.PlacementType;const I=d.FloatingNumberType;function w(){return e.getElementById("NotificationsCountButton")}function T(){return e.getElementById("shell-header").getNotificationsBtnDomRef()}return s.extend("sap.ushell.components.shell.Notifications.Component",{metadata:{version:"1.141.0",library:"sap.ushell.components.shell.Notifications",dependencies:{libs:["sap.m"]}},createContent:function(){this._aTimeouts=[];this.oRenderer=N.getRendererInternal("fiori2");this.oConfigModel=m.getConfigModel();N.getServiceAsync("NotificationsV2").then(t=>{this.oNotificationsService=t;if(this.oNotificationsService.isEnabled()===true){i.getInstance().subscribe("sap.ushell.services.Notifications","onNewNotifications",this._handleAlerts,this);this.oConfigModel.setProperty("/enableNotifications",true);this.oNotificationsService.init();if(this.oRenderer.getShellConfig().enableNotificationsUI===true){this.oConfigModel.setProperty("/enableNotificationsUI",true);this.oNotificationsService.registerNotificationsUpdateCallback(this._updateCount.bind(this),true)}this._createNotificationButton(this.oConfigModel);f.on("showNotifications").do(this._toggleNotifications.bind(this))}})},_createNotificationButton:function(t){const e=new g({id:"NotificationsCountButton",tooltip:u.i18n.getText("notificationsBtn_title"),icon:o.getIconURI("bell"),text:u.i18n.getText("notificationsBtn_title"),ariaLabel:u.i18n.getText("notificationsBtn_title"),ariaHaspopup:"dialog",enabled:true,selected:false,visible:"{configModel>/enableNotifications}",floatingNumber:"{configModel>/notificationsCount}",floatingNumberMaxValue:r.system.phone?99:999,floatingNumberType:I.Notifications,press:function(){f.emit("showNotifications",Date.now())}});e.setModel(t,"configModel");e.setModel(u.i18nModel,"i18n");this.oRenderer.showHeaderEndItem([e.getId()],false,["home","app"])},_handleAlerts:function(t,e,i){(i||[]).forEach(this.handleNotification.bind(this))},handleNotification:function(t){const e=()=>{if(a.getHash()!==`${t.NavigationTargetObject}-${t.NavigationTargetAction}`){if(t.NavigationTargetObject&&t.NavigationTargetAction){p.toExternalWithParameters(t.NavigationTargetObject,t.NavigationTargetAction,t.NavigationTargetParams)}}this.oNotificationsService.markRead(t.Id)};if(h.last("/core/notifications/enabled")){sap.ui.require(["sap/ushell/gen/ui5/webcomponents/dist/Label","sap/ushell/gen/ui5/webcomponents-fiori/dist/NotificationList","sap/ushell/gen/ui5/webcomponents-fiori/dist/NotificationListItem"],(i,o,n)=>{if(!this._oNotificationsAlertList){this._oNotificationsAlertList=new o({itemClick:e});this._oNotificationsAlertList.addStyleClass("sapUshellNotificationsAlertList");this.oRenderer.addRightFloatingContainerItem({id:this._oNotificationsAlertList.getId()},true,true)}const s=t=>{t.destroy();if(this._oNotificationsAlertList.getItems().length<=0){this.oRenderer.showRightFloatingContainer(false)}};const a=new n({titleText:t.SensitiveText?t.SensitiveText:t.Text,showClose:true,importance:"Important",text:t.SubTitle,read:false,footnotes:[new i({text:t.NotificationTypeDesc}),new i({text:p.formatDate(t.CreatedAt)})],close:t=>{s(t.getSource())}});a.addStyleClass("sapUshellNotificationsAlertListItem");this._oNotificationsAlertList.insertItem(a,0);this.oRenderer.showRightFloatingContainer(true);const r=setTimeout(s.bind(this,a),C*1e3);this._aTimeouts.push(r)})}else{const i=this.oRenderer.addRightFloatingContainerItem({press:e,close:function(){this.oRenderer.removeRightFloatingContainerItem(i.getId(),true)}.bind(this),datetime:u.i18n.getText("notification_arrival_time_now"),title:t.SensitiveText?t.SensitiveText:t.Text,description:t.SubTitle,unread:t.IsRead,priority:"High",hideShowMoreButton:true},true,true);this.oRenderer.showRightFloatingContainer(true);const o=setTimeout(()=>{this.oRenderer.removeRightFloatingContainerItem(i.getId(),true)},C*1e3);this._aTimeouts.push(o)}},_updateCount:function(){this._getPopover().then(e=>{if(!e.isOpen()){this.oNotificationsService.getUnseenNotificationsCount().then(t=>{this.oConfigModel.setProperty("/notificationsCount",parseInt(t,10))}).catch(e=>{t.error("Notifications - call to notificationsService.getCount failed: ",e)})}})},_wrapPopover:function(t,e){const i=new c("shellNotificationsPopover",{showHeader:!!e,customHeader:e,placement:y.Bottom,showArrow:true,content:t,horizontalScrolling:false,beforeOpen:()=>{this._resetCount()},beforeClose:t=>{t.getSource().getContent()[0].invalidate()}});i._oAriaLabelledByText=new n(`${i.getId()}-labelledBy`,{text:u.i18n.getText("NotificationToggleButton.NoNewNotifications")}).toStatic();i.addDependent(i._oAriaLabelledByText);i.addAriaLabelledBy(i._oAriaLabelledByText);i.addStyleClass("sapContrastPlus");return i},_getPopover:function(){if(!this._oNotificationsPopoverPromise){if(h.last("/core/notifications/enabled")){this._oNotificationsPopoverPromise=new Promise((t,e)=>{this.runAsOwner(()=>{b.create({id:this.createId("notificationsListContent"),viewName:"sap.ushell.components.shell.Notifications.NotificationsListPopoverContent",viewData:{notificationsService:this.oNotificationsService}}).then(async e=>{const i=e.getController();const o=await v.load({id:this.createId("notificationsListCustomHeader"),name:"sap.ushell.components.shell.Notifications.NotificationsListPopoverHeader",controller:i});o.setModel(e.getModel("i18n"),"i18n");o.setModel(e.getModel());const n=this._wrapPopover(e,o);n.addStyleClass("sapUshellNotificationsListPopup");n.attachBeforeOpen(()=>{this.oNotificationsService.setUnseenNotificationsCount(0);i.getNextPage(true)});n.setInitialFocus(i.byId("sapUshellNotificationsList"));n.attachAfterClose(this._updateCount.bind(this));t(n)}).catch(e)})})}else{this._oNotificationsPopoverPromise=new Promise((t,e)=>{b.create({id:"notificationsView",viewName:"sap.ushell.components.shell.Notifications.Notifications",viewData:{notificationsService:this.oNotificationsService}}).then(e=>{const i=e.byId("notificationIconTabBar");i.setAriaTexts({headerLabel:u.i18n.getText("Notifications.Popover.IconTabBar.Header.AriaLabel")});const o=e.byId("sapUshellNotificationsListDate");o.enhanceAccessibilityState=function(t,e){e.hidden=true;return e};const n=e.byId("sapUshellNotificationsListPriority");n.enhanceAccessibilityState=function(t,e){e.hidden=true;return e};const s=e.byId("sapUshellNotificationsListType");s.enhanceAccessibilityState=function(t,e){e.hidden=true;return e};const a=this._wrapPopover(e);a.addStyleClass("sapUshellNotificationsPopup");t(a)}).catch(e)})}}return this._oNotificationsPopoverPromise},_toggleNotifications:function(t){this._getPopover().then(i=>{let o;if(h.last("/core/shellBar/enabled")){o=T()}else{o=w();if(!o.$().width()){o=e.getElementById("endItemsOverflowBtn")}}if(i.isOpen()){i.close()}else if(t!==false){this._resetCount();i.openBy(o)}})},_resetCount:function(){this.oConfigModel.setProperty("/notificationsCount",0);this.oNotificationsService.notificationsSeen()},exit:function(){i.getInstance().unsubscribe("sap.ushell.services.Notifications","onNewNotifications",this._handleAlerts,this);if(this.oNotificationsService&&this.oNotificationsService.isEnabled()===true){this.oNotificationsService.destroy()}this.oNotificationsService=null;const t=w();if(t){this.oRenderer.hideHeaderEndItem(t,false);t.destroy()}this.oRenderer=null;let o=e.getElementById("notificationsView");if(o){o.destroy();o=null}this._aTimeouts.forEach(window.clearTimeout)}})});
//# sourceMappingURL=Component.js.map