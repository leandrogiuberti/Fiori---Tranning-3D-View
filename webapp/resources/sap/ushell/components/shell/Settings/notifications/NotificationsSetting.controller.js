// Copyright (c) 2009-2025 SAP SE, All Rights Reserved
sap.ui.define(["sap/ui/core/mvc/Controller","sap/ui/model/json/JSONModel","sap/ushell/Config","sap/base/Log","sap/ushell/resources","sap/base/util/deepClone","sap/ushell/Container"],(e,t,o,i,r,n,s)=>{"use strict";return e.extend("sap.ushell.components.shell.Settings.notifications.NotificationsSetting",{onInit:function(){this._oModel=new t({rows:[],originalRows:[]});const e=this.getView();let o;e.setBusy(true);e.setModel(r.i18nModel,"i18n");s.getServiceAsync("NotificationsV2").then(t=>{this._oNotificationService=t;this._initializeFlags();t.readSettings().then(e=>{o=JSON.parse(e);this._oModel.setProperty("/rows",o.value);this._oModel.setProperty("/originalRows",n(o.value))}).finally(()=>{e.setBusy(false);e.setModel(this._oModel)})})},onAfterRendering:function(){const e=this._oModel.getProperty("/flags");const t=this._oModel.getProperty("/rows");if(t!==undefined){this._oModel.setProperty("/originalRows",n(t))}if(e!==undefined){this._oModel.setProperty("/originalFlags/highPriorityBannerEnabled",e.highPriorityBannerEnabled)}},onCancel:function(){const e=this._oModel.getProperty("/originalFlags");const t=this._oModel.getProperty("/originalRows");this._oModel.setProperty("/flags/highPriorityBannerEnabled",e.highPriorityBannerEnabled);this._oModel.setProperty("/rows",n(t));this._oModel.setProperty("/originalFlags",{});this._oModel.setProperty("/originalRows",[])},onSave:function(){const e=this._oModel.getProperty("/rows");const t=this._oModel.getProperty("/originalRows");let o;let r;const n=[];const s=[];for(let i=0;i<e.length;i++){o=e[i];r=t[i];if(this._notficationSettingsDiffer(o,r)){n.push(o)}}if(this._flagsHaveChanged()){this._handleFlagsSave()}n.forEach(e=>{s.push(this._oNotificationService.saveSettingsEntry(e))});return Promise.all(s).catch(e=>{i.error("Failed to save the notification settings in the notifivation service.",e,"sap.ushell.components.ushell.settings.notifications.NotificationsSetting");throw e})},_flagsHaveChanged:function(){return this._oModel.getProperty("/flags/highPriorityBannerEnabled")!==this._oModel.getProperty("/originalFlags/highPriorityBannerEnabled")},_handleFlagsSave:function(){const e=this._oModel.getProperty("/flags/highPriorityBannerEnabled");this._oModel.setProperty("/originalFlags/highPriorityBannerEnabled",e);this._oNotificationService.setUserSettingsFlags({highPriorityBannerEnabled:e})},_notficationSettingsDiffer:function(e,t){return e.NotificationTypeId!==t.NotificationTypeId||e.PriorityDefault!==t.PriorityDefault||e.DoNotDeliver!==t.DoNotDeliver||e.DoNotDeliverMob!==t.DoNotDeliverMob||e.DoNotDeliverEmail!==t.DoNotDeliverEmail},onSelectMobile:function(e){const t=e.getSource().getBindingContext().getPath();this._oModel.setProperty(`${t}/DoNotDeliverMob`,!e.getParameter("selected"))},onSelectEmail:function(e){const t=e.getSource().getBindingContext().getPath();this._oModel.setProperty(`${t}/DoNotDeliverEmail`,!e.getParameter("selected"))},onSelectHighPriority:function(e){const t=e.getSource().getBindingContext().getPath();if(e.getParameter("selected")){this._oModel.setProperty(`${t}/PriorityDefault`,"HIGH")}else{this._oModel.setProperty(`${t}/PriorityDefault`,"")}},onEnableSwitchChange:function(e){const t=e.getParameter("state");const o=e.getSource().getBindingContext().getPath();this._oModel.setProperty(`${o}/DoNotDeliver`,!t);this._oModel.setProperty(`${o}/DoNotDeliverMob`,true);this._oModel.setProperty(`${o}/DoNotDeliverEmail`,true);this._oModel.setProperty(`${o}/PriorityDefault`,"")},_initializeFlags:function(){const e=this._oNotificationService.getUserSettingsFlags();const t=this._oNotificationService._getNotificationSettingsMobileSupport();const o=this._oNotificationService._getNotificationSettingsEmailSupport();e.then(e=>{this._oModel.setProperty("/flags",{});this._oModel.setProperty("/flags/highPriorityBannerEnabled",e.highPriorityBannerEnabled);this._oModel.setProperty("/flags/mobileNotificationsEnabled",t);this._oModel.setProperty("/flags/emailNotificationsEnabled",o);this._oModel.setProperty("/originalFlags",{});this._oModel.setProperty("/originalFlags/highPriorityBannerEnabled",e.highPriorityBannerEnabled)})}})});
//# sourceMappingURL=NotificationsSetting.controller.js.map