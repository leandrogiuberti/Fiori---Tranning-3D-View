// Copyright (c) 2009-2025 SAP SE, All Rights Reserved
sap.ui.define(["sap/ui/core/mvc/Controller","sap/ui/model/json/JSONModel","sap/ushell/EventHub","sap/ushell/Config","sap/ushell/resources","sap/ushell/utils","sap/base/Log"],(e,s,t,o,r,n,c)=>{"use strict";return e.extend("sap.ushell.components.shell.Settings.spaces.SpacesSetting",{onInit:function(){const e=this.getView().getViewData();this.oUserInfoService=e.UserInfo;const n=this.oUserInfoService.getUser();const c=o.last("/core/spaces/enabled");const a=o.last("/core/homeApp/enabled");const p=o.last("/core/spaces/myHome/enabled");const i=c&&p&&!a;const l=n.getShowMyHome();const d=n.getImportBookmarksFlag();const m=d!=="done"&&d!=="not_required";const h=new s({spaces:{visible:o.last("/core/spaces/configurable"),selected:c},hideEmptySpaces:{visible:c&&o.last("/core/spaces/hideEmptySpaces/enabled"),selected:o.last("/core/spaces/hideEmptySpaces/userEnabled")},showMyHome:{visible:i,selected:l},showMyHomeImport:{visible:i&&l&&m,selected:d==="pending"}});this.getView().setModel(h);this.getView().setModel(r.i18nModel,"i18n");this.oImportBookmarksFlagListener=t.on("importBookmarksFlag").do(this._setMyHomeImportSelected.bind(this))},_setMyHomeImportSelected:function(e){const s=this.getView().getModel();s.setProperty("/showMyHomeImport/selected",e)},onExit:function(){this.oImportBookmarksFlagListener.off()},onSave:async function(e){let s=false;let r=false;const a=[];const p=this.getView().getModel();const i=this.oUserInfoService;const l=i.getUser();const d=o.last("/core/spaces/enabled");const m=p.getProperty("/spaces/selected");const h=o.last("/core/spaces/hideEmptySpaces/userEnabled");const g=p.getProperty("/hideEmptySpaces/selected");const y=l.getShowMyHome();const u=p.getProperty("/showMyHome/selected");const E=l.getImportBookmarksFlag()==="pending";const M=p.getProperty("/showMyHomeImport/selected");if(d!==m){l.setChangedProperties({propertyName:"spacesEnabled",name:"SPACES_ENABLEMENT"},d,m);r=true;s=true}if(y!==u){l.setShowMyHome(u);r=true;s=true}if(E!==M){const e=M?"pending":"dismissed";l.setImportBookmarksFlag(e);r=true;if(!s){t.emit("importBookmarksFlag",M)}}if(h!==g){const e=n.setHideEmptySpacesEnabled(g).catch(e=>{p.setProperty("/hideEmptySpaces/selected",h);throw e});a.push(e)}if(!r&&!a.length){return Promise.resolve()}c.debug("[000] SpacesSetting.controller.save");if(r){const s=new Promise((s,t)=>{e().then(()=>{l.resetChangedProperty("spacesEnabled");l.resetChangedProperty("showMyHome");l.resetChangedProperty("importBookmarks");s()}).catch(e=>{const o=e.message;if(!o.includes("SPACES_ENABLEMENT")&&!o.includes("MYHOME_ENABLEMENT")&&!o.includes("MYHOME_IMPORT_FROM_CLASSIC")){l.resetChangedProperty("spacesEnabled");l.resetChangedProperty("showMyHome");l.resetChangedProperty("importBookmarks");s()}else{p.setProperty("/spaces/selected",d);p.setProperty("/showMyHome/selected",y);l.resetChangedProperty("spacesEnabled");l.resetChangedProperty("showMyHome");l.resetChangedProperty("importBookmarks");t(e)}})});a.push(s)}return Promise.all(a).then(()=>({refresh:s,noHash:true}))},onCancel:function(){const e=this.getView().getModel();e.setProperty("/spaces/selected",o.last("/core/spaces/enabled"));e.setProperty("/showMyHome/selected",this.oUserInfoService.getUser().getShowMyHome());e.setProperty("/hideEmptySpaces/selected",o.last("/core/spaces/hideEmptySpaces/userEnabled"))}})});
//# sourceMappingURL=SpacesSetting.controller.js.map