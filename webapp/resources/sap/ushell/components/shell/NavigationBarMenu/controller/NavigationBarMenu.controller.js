// Copyright (c) 2009-2025 SAP SE, All Rights Reserved
sap.ui.define(["sap/ui/core/InvisibleMessage","sap/ui/core/library","sap/ui/core/mvc/Controller","sap/ui/core/Fragment","sap/ui/model/Filter","sap/ui/model/FilterOperator","sap/ui/model/Sorter","sap/ushell/resources","sap/ushell/utils/WindowUtils","sap/ushell/Config","sap/ushell/Container","sap/ushell/EventHub","sap/ui/model/json/JSONModel"],(e,t,n,s,o,i,a,r,c,p,d,l,u)=>{"use strict";const g=t.dnd.RelativeDropPosition;const h=t.InvisibleMessageMode;return n.extend("sap.ushell.components.shell.NavigationBarMenu.controller.NavigationBarMenu",{onInit:function(){this.pMenuServicePromise=d.getServiceAsync("Menu");this._oInvisibleMessageInstance=e.getInstance();this.oViewConfigurationModel=new u({enableMenuBarNavigation:true,contextMenu:{enableMoveDown:false,enableMoveUp:false,enablePin:false,showMoveUp:false,showMoveDown:false}});this.getView().setModel(this.oViewConfigurationModel,"viewConfiguration");this._oEventHubListener=l.on("enableMenuBarNavigation").do(e=>{this.oViewConfigurationModel.setProperty("/enableMenuBarNavigation",e)});this._bindPinnedSpaces()},onExit:function(){if(this._oInvisibleMessageInstance){this._oInvisibleMessageInstance.destroy()}this._oEventHubListener.off()},_onPinnedSpacesUpdateFinished:function(e){const t=r.i18n.getText("NavigationBarMenu.PinnedSpaces.Title",[e.getParameter("total")||0]);this.byId("PinnedSpacesTreeTitle").setText(t)},_configureContextMenuEnablement:function(e){const t=e.getParameter("listItem");if(!t){return}const n=e.getSource();const s=n.getItems();const o=n.indexOfItem(t);const i=n.getId().includes("PinnedSpaces");const a=t.getBindingContext("spaces");const r=a.getProperty("pinned")!==undefined;this.oViewConfigurationModel.setProperty("/contextMenu/enableMoveUp",i&&o>0);this.oViewConfigurationModel.setProperty("/contextMenu/enableMoveDown",i&&o<s.length-1);this.oViewConfigurationModel.setProperty("/contextMenu/enablePin",r);this.oViewConfigurationModel.setProperty("/contextMenu/showMoveUp",i);this.oViewConfigurationModel.setProperty("/contextMenu/showMoveDown",i);if(!r){e.preventDefault()}},_moveSpaceUp:function(e){if(this._handleSpacesSwap(true)){e.preventDefault();e.stopPropagation?.()}},_moveSpaceDown:function(e){if(this._handleSpacesSwap(false)){e.preventDefault();e.stopPropagation?.()}},handlePinButtonPress:function(e){const t=e.getSource();const n=t.getBindingContext("spaces").getPath();const s=this._getModel();const o=s.getProperty(`${n}/pinned`);if(!o){this._pinSpace(n)}else{this._unpinSpace(n,true)}if(!t.getId().includes("PinnedSpaces")){return}this.byId("AllSpaces").focus();const i=this.byId("PinnedSpaces");const a={onAfterRendering:()=>{i.focus();i.removeEventDelegate(a)}};i.addEventDelegate(a)},unpinAllSpaces:function(){const e=this.byId("PinnedSpaces");const t=e.getModel("spaces").getData();const n=p.last("/core/spaces/myHome/myHomeSpaceId");t.forEach(e=>{if(e.pinned&&e.type!=="separator"&&e.id!==n){e.pinned=false;e.pinnedSortOrder="-1"}});this._savePinnedSpaces()},rearrangePinnedSpaces:function(e){const t=this.oModel||this.getOwnerComponent().getModel("spaces");const n=e.getParameter("draggedControl").getBindingContext("spaces");const s=t.getProperty(n.getPath()).pinnedSortOrder;const o=e.getParameter("droppedControl");const i=o.getBindingContext("spaces");const a=t.getProperty(i.getPath()).pinnedSortOrder;const r=e.getParameter("dropPosition");const c=a+(r===g.After?1:0);this._rearrangePinnedSpaces(s,c,o,r)},_rearrangePinnedSpaces:function(e,t,n,s){this.pMenuServicePromise.then(o=>{o.moveMenuEntry(e,t);const i=this.byId("PinnedSpaces");const a={onAfterRendering:function(){const o=i.getItems();const r=i.indexOfItem(n);let c;if(e<t){c=r-(s===g.Before?1:0)}else{c=r+(s===g.After?1:0)}const p=o[c];if(p){p.focus()}n.removeEventDelegate(a)}};n.addEventDelegate(a);const c=r.i18n.getText("NavigationBarMenu.PinnedSpaces.Moved");this._oInvisibleMessageInstance.announce(c,h.Polite);this._savePinnedSpaces()})},_bindPinnedSpaces:function(){const e=this.byId("PinnedSpaces");if(!this._pCustomTreeItemPromise){this._pCustomTreeItemPromise=s.load({id:this.createId("CustomTreeItemFragment"),type:"XML",async:true,controller:this,name:"sap.ushell.components.shell.NavigationBarMenu.view.CustomTreeItem"}).then(t=>{t.addEventDelegate({onsapdownmodifiers:this._moveSpaceDown.bind(this),onsapupmodifiers:this._moveSpaceUp.bind(this)});e.bindItems({path:"spaces>/",filters:[new o({path:"pinned",operator:i.EQ,value1:true}),new o({path:"type",operator:i.NE,value1:"separator"}),new o({path:"isHomeEntry",operator:i.EQ,value1:false})],sorter:[new a({path:"pinnedSortOrder",descending:false})],parameters:{arrayNames:["menuEntries"]},template:t,templateShareable:false})})}return this._pCustomTreeItemPromise},_handleSpacesSwap:function(e){const t=this.byId("PinnedSpaces");const n=t.getItems();let s;for(let t=0;t<n.length;++t){s=n[t];if(document.activeElement!==s.getFocusDomRef()){continue}const o=s.getBindingContext("spaces");const i=this._getModel();const a=i.getProperty(o.getPath()).pinnedSortOrder;const r=n[e?t-1:t+1];if(!r){return false}const c=r.getBindingContext("spaces");const p=i.getProperty(c.getPath()).pinnedSortOrder;this._rearrangePinnedSpaces(a,e?p:p+1,r,e?g.Before:g.After);return true}},allSpacesFactory:function(e,t){const n=t.getModel().getProperty(t.getPath());const s=n.menuEntries||[];const o=this.byId("AllSpaces").getDependents()[0].clone(e);o.setType("Active");o.attachPress(this.onMenuItemSelection,this);if(s.length<1){o.addStyleClass("sapMTreeItemBaseLeaf")}if(n.type==="separator"||n.isHomeEntry){o.setVisible(false)}return o},_unpinSpace:function(e,t){const n=this._getModel();n.setProperty(`${e}/pinned`,false);n.setProperty(`${e}/pinnedSortOrder`,"-1");if(t){this._savePinnedSpaces()}},_pinSpace:function(e){const t=this.byId("PinnedSpaces").getItems().length;const n=this._getModel();let s=2;if(t>0){const e=this.byId("PinnedSpaces").getItems()[t-1];const o=e.getBindingContextPath("spaces");s=n.getProperty(`${o}/pinnedSortOrder`)+1}n.setProperty(`${e}/pinnedSortOrder`,s);n.setProperty(`${e}/pinned`,true);this._savePinnedSpaces()},_performNavigation:function(e){return d.getServiceAsync("Navigation").then(t=>{const n={};e.parameters.forEach(e=>{if(e.name&&e.value){n[e.name]=[e.value]}});return t.navigate({target:{semanticObject:e.semanticObject,action:e.action},params:n})})},_openURL:function(e){c.openURL(e.url,"_blank")},onMenuItemSelection:async function(e){const t=e.getSource();const n=t.getBindingContextPath("spaces");const s=this._getModel();const o=s.getProperty(n);const i=e.getParameter("id").includes("AllSpaces");if(!i){return}if(t.isLeaf()){if(o.type==="IBN"){return this._performNavigation(o.target)}if(o.type==="URL"){return this._openURL(o.target)}return}},_savePinnedSpaces:function(){const e=this._getModel();this.pMenuServicePromise.then(t=>{e.refresh(true);return t.savePersonalization()})},_getModel:function(){return this.oModel||this.getOwnerComponent().getModel("spaces")}})});
//# sourceMappingURL=NavigationBarMenu.controller.js.map