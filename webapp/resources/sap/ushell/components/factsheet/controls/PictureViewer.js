// Copyright (c) 2009-2025 SAP SE, All Rights Reserved
sap.ui.define(["sap/ui/thirdparty/jquery","sap/m/TileContainer","sap/ui/Device","sap/ushell/components/factsheet/controls/PictureTile","sap/ushell/library","./PictureViewerRenderer"],(jQuery,e,t,i)=>{"use strict";const s=e.extend("sap.ushell.components.factsheet.controls.PictureViewer",{metadata:{deprecated:true,library:"sap.ushell",properties:{tileScaling:{type:"float",group:"Misc",defaultValue:.95},removable:{type:"boolean",group:"Misc",defaultValue:false}},defaultAggregation:"items",aggregations:{items:{type:"sap.ushell.components.factsheet.controls.PictureViewerItem",multiple:true,singularName:"item"}},events:{pictureDeleted:{}}}});s.prototype.init=function(){e.prototype.init.apply(this);this.setEditable(false);if(sap.ui.getCore().isMobile()){jQuery(window).on("tap",this._reset.bind(this));const e=sap.ui.getCore().getStaticAreaRef();this.$blocker=jQuery("<div class='sapCaPVBly sapUiBLy'></div>").css("visibility","hidden");jQuery(e).append(this.$blocker)}if(!sap.ui.getCore().isMobile()){jQuery(window).on("resize",this._resize.bind(this))}this.addStyleClass("sapCaPW");this.addStyleClass("sapCaPWRendering")};s.prototype._resize=function(){if(this._oDragSession){return}setTimeout(()=>{this._applyDimension();this._update(false);delete this._iInitialResizeTimeout},this._iInitialResizeTimeout);this._iInitialResizeTimeout=0};s.prototype.exit=function(){this.$blocker.remove();if(!sap.ui.getCore().isMobile()){jQuery(window).off("resize",this._resize.bind(this))}e.prototype.exit.apply(this);if(!t.system.desktop){jQuery(window).off("tap",this._reset.bind(this))}};s.prototype.setTileScaling=function(e){if(e<0||e>1){e=.75;jQuery.sap.log.error(`Tile Scaling should be a float value between 0 and 1 and not ${e}. Setting it to 0.75 by default.`)}this.setProperty("tileScaling",e)};s.prototype.addItem=function(e){this.insertItem(e,this.getItems().length);return this};s.prototype.insertItem=function(e,t){const s=new i({tileContent:e});s.attachPictureDelete(this._deletePictureRequestHandler.bind(this));this.insertTile(s,t);this.insertAggregation("items",e,t);return this};s.prototype.insertTile=function(t){t.attachPictureDelete(this._deletePictureRequestHandler.bind(this));e.prototype.insertTile.apply(this,arguments)};s.prototype.deleteTile=function(t){e.prototype.deleteTile.apply(this,arguments);t.destroy()};s.prototype.deletePicture=function(e){let t;let i;const s=this.getTiles().length;if(typeof e!=="number"||e<0||e>=s){t=this.getPageFirstTileIndex()}else{t=e}if(t>-1){i=this.getTiles()[t];i.detachPictureDelete(this._deletePictureRequestHandler.bind(this));this.deleteTile(i);this.removeAggregation("items",t,true)}else{jQuery.sap.log.warning(`Cannot find and delete a picture at index : ${e}`)}return this};s.prototype.selectPicture=function(e){const t=this.getTiles().length;if(typeof e!=="number"){e=0}else if(e<0){e=0}else if(e>=t){e=t-1}if(this._bRendered){this.addStyleClass("sapCaPWRendering")}this._selectedIndex=e;return this};s.prototype.setSelectedIndex=function(e){this.selectPicture(e)};s.prototype.getCurrentPictureIndex=function(){return this.getPageFirstTileIndex()};s.prototype._deletePictureRequestHandler=function(e){const t=this.indexOfTile(e.getSource());this.deleteTile(e.getSource());this.firePictureDeleted({index:t})};s.prototype._reset=function(e){const t=this.getCurrentPictureIndex();const i=this.getTiles();if(t>-1&&i&&i.length>t){const s=i[t];if(s){const t=jQuery(e.target);const i=this.$();if(i.length>0&&t.length>0){const e=t.closest(this.$());if(e.length===0){s.switchVisibility(false)}}}}};s.prototype.setRemovable=function(e){this.setProperty("removable",e,true);this.toggleStyleClass("sapCaPWEditable",e)};s.prototype.setEditable=function(){e.prototype.setEditable.call(this,false)};s.prototype._getTileDimension=function(){if(!this._bRendered){return}const e=jQuery.sap.byId(`${this.getId()}-scrl`);const t={width:e.width(),height:e.height()};return t};s.prototype.onBeforeRendering=function(){this.addStyleClass("sapCaPWRendering")};s.prototype.onAfterRendering=function(){const e=this;this._bRendered=true;this._applyDimension();this.$().toggleClass("sapCaPWEditable",this.getRemovable()===true);this._sInitialResizeTimeoutId=setTimeout(()=>{e.addStyleClass("sapCaPWRendering");e._applyPageStartIndex(e._selectedIndex);e._update(false)},this._iInitialResizeTimeout);if(t.system.desktop){const e=this.getTiles()[0];const t=this._iInitialResizeTimeout;if(e){setTimeout(()=>{this._findTile(e.$()).focus()},t)}}};s.prototype._update=function(){e.prototype._update.apply(this,arguments);this.removeStyleClass("sapCaPWRendering");if(sap.ui.getCore().isMobile()){const e=this;const t=this.$blocker;setTimeout(()=>{t.fadeOut(200,()=>{e.css("visibility","hidden").css("z-index",0)})},250)}};s.prototype._applyDimension=function(){const e=this._getContainerDimension();const i=this.getId();const s=this.$();let o=10;const n=60;const l=jQuery.sap.byId(`${i}-cnt`);const r=jQuery.sap.byId(`${i}-pager`).outerHeight();jQuery.sap.byId(`${i}-scrl`).css({width:`${e.outerwidth}px`,height:`${e.outerheight-r}px`});l.css({height:`${e.outerheight-r}px`,visibility:"visible"});s.css("visibility","visible");const a=s.position();const p=l.position();const h=l.outerHeight();if(jQuery.device.is.phone){o=2}else if(t.system.desktop){o=0}jQuery.sap.byId(`${i}-blind`).css({top:`${p.top+o}px`,left:`${p.left+o}px`,width:`${l.outerWidth()-o}px`,height:`${h-o}px`});jQuery.sap.byId(`${i}-rightedge`).css({top:`${a.top+o+n}px`,right:`${o}px`,height:`${h-o-n}px`});jQuery.sap.byId(`${i}-leftedge`).css({top:`${a.top+o+n}px`,left:`${a.left+o}px`,height:`${h-o-n}px`})};s.prototype.showBlockerLayer=function(e){if(sap.ui.getCore().isMobile()){let t=20;jQuery(sap.ui.getCore().getStaticAreaRef()).children().each((e,i)=>{const s=parseInt(jQuery(i).css("z-index"),10);if(!isNaN(s)){t=Math.max(t,s)}});jQuery.sap.log.debug(`blocker layer z-index calculated : ${t}${1}`);this.$blocker.css("z-index",t+1).css("visibility","visible").fadeIn(200,()=>{if(e){e.call()}})}else if(e){e.call()}};return s});
//# sourceMappingURL=PictureViewer.js.map