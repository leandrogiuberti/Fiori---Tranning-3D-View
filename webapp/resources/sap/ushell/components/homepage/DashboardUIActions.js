// Copyright (c) 2009-2025 SAP SE, All Rights Reserved
sap.ui.define(["sap/base/Log","sap/base/util/deepExtend","sap/ui/base/Object","sap/ui/core/Configuration","sap/ui/core/Core","sap/ui/Device","sap/ui/thirdparty/jquery","sap/ushell/Layout"],(e,t,o,s,n,i,jQuery,l)=>{"use strict";const a=o.extend("sap.ushell.components.homepage.DashboardUIActions",{metadata:{publicMethods:["initializeUIActions"]},constructor:function(){this.aTabBarItemsLocation=[];if(a.fnDashboardUIActionsGetter&&a.fnDashboardUIActionsGetter()){return a.fnDashboardUIActionsGetter()}a.fnDashboardUIActionsGetter=function(e){return function(){return e}}(this.getInterface());this.oTileUIActions=undefined;this.oLinkUIActions=undefined;this.oGroupUIActions=undefined;this.oController=undefined;this.UIActionsInitialized=false;n.getEventBus().subscribe("launchpad","actionModeActive",this._enableGroupUIActions,this);n.getEventBus().subscribe("launchpad","actionModeInactive",this._disableGroupUIActions,this)},destroy:function(){n.getEventBus().unsubscribe("launchpad","actionModeActive",this._enableGroupUIActions,this);n.getEventBus().unsubscribe("launchpad","actionModeInactive",this._disableGroupUIActions,this);a.fnDashboardUIActionsGetter=undefined;this.oGroupUIActions=null;this.oTileUIActions=null;this.oLinkUIActions=null},initializeUIActions:function(e){this.oController=e;if(e.getView().getModel().getProperty("/homePageGroupDisplay")==="tabs"){this._fillTabBarItemsArray()}const o=jQuery("#sapUshellDashboardPage").width();const n=e.getView().sDashboardGroupsWrapperId;let i;const l=s.getRTL();const a={containerSelector:"#dashboardGroups",wrapperSelector:n?`#${n}`:undefined,rootSelector:"#mainShell"};const r=t({},a,{switchModeDelay:1e3,isTouch:e.getView().isTouch,isCombi:e.getView().isCombi,debug:false});const c={draggableSelector:".sapUshellLinkTile",placeHolderClass:"sapUshellLinkTile-placeholder",cloneClass:"sapUshellLinkTile-clone",endCallback:this._handleLinkDrop.bind(this),dragCallback:this._handleStartDragTile.bind(this),onBeforeCreateClone:this._onBeforeCreateLinkClone.bind(this),dragAndScrollCallback:this._handleTileDragMove.bind(this),endDragAndScrollCallback:this._handleTileDragAndScrollContinuation.bind(this),moveTolerance:e.getView().isTouch||e.getView().isCombi?10:3,isLayoutEngine:true,disabledDraggableSelector:"sapUshellLockedTile",onDragStartUIHandler:this._markDisableGroups.bind(this),onDragEndUIHandler:this._endUIHandler.bind(this),offsetLeft:l?o:-o,defaultMouseMoveHandler:function(){}};const d={draggableSelector:".sapUshellTile",draggableSelectorExclude:".sapUshellPlusTile",placeHolderClass:"sapUshellTile-placeholder",cloneClass:"sapUshellTile-clone",deltaTop:-44,scrollContainerSelector:undefined,endCallback:this._handleTileDrop.bind(this),dragCallback:this._handleStartDragTile.bind(this),dragAndScrollCallback:this._handleTileDragMove.bind(this),endDragAndScrollCallback:this._handleTileDragAndScrollContinuation.bind(this),moveTolerance:e.getView().isTouch||e.getView().isCombi?10:3,isLayoutEngine:true,disabledDraggableSelector:"sapUshellLockedTile",onDragStartUIHandler:this._markDisableGroups.bind(this),onDragEndUIHandler:this._endUIHandler.bind(this),offsetLeft:l?o:-o,defaultMouseMoveHandler:function(){}};const h={draggableSelector:".sapUshellDashboardGroupsContainerItem:not(.sapUshellDisableDragAndDrop)",draggableSelectorBlocker:".sapUshellTilesContainer-sortable, .sapUshellTileContainerBeforeContent, .sapUshellTileContainerAfterContent",draggableSelectorExclude:".sapUshellHeaderActionButton",placeHolderClass:"sapUshellDashboardGroupsContainerItem-placeholder",cloneClass:"sapUshellDashboardGroupsContainerItem-clone",startCallback:this._handleGroupsUIStart.bind(this),endCallback:this._handleGroupDrop.bind(this),dragCallback:this._handleGroupStartDrag.bind(this),moveTolerance:e.getView().isTouch||e.getView().isCombi?10:.1,isLayoutEngine:false,isVerticalDragOnly:true,draggableElement:".sapUshellTileContainerHeader"};if(e.getView().oDashboardGroupsBox.getGroups().length){if(e.getView().getModel().getProperty("/personalization")){sap.ui.require(["sap/ushell/UIActions"],o=>{sap.ushell.Container.getServiceAsync("FlpLaunchPage").then(s=>{this._disableTileUIActions();this._disableGroupUIActions();this._disableLinkUIActions();this.oTileUIActions=new o(t({},r,d)).enable();this.oGroupUIActions=new o(t({},r,h));if(s.isLinkPersonalizationSupported()){this.oLinkUIActions=new o(t({},r,c)).enable()}i=e.getView().getModel().getProperty("/tileActionModeActive");if(i){this.oGroupUIActions.enable()}})})}}},_enableGroupUIActions:function(){if(this.oGroupUIActions){this.oGroupUIActions.enable()}},disableAllDashboardUiAction:function(){this._disableTileUIActions();this._disableLinkUIActions();this._disableGroupUIActions()},_disableTileUIActions:function(){if(this.oTileUIActions){this.oTileUIActions.disable()}},_disableLinkUIActions:function(){if(this.oLinkUIActions){this.oLinkUIActions.disable()}},_disableGroupUIActions:function(){if(this.oGroupUIActions){this.oGroupUIActions.disable()}},_handleTileDragMove:function(e){if(!e.isScrolling){l.getLayoutEngine().moveDraggable(e.moveX,e.moveY,this.aTabBarItemsLocation)}},_handleTileDragAndScrollContinuation:function(e){const t=jQuery("#anchorNavigationBar").offset();const o=t?t.top:0;if(e<o){l.getLayoutEngine()._cancelLongDropTimmer()}return l.getLayoutEngine()._isTabBarCollision(e)},_fillTabBarItemsArray:function(){const e=document.getElementsByClassName("sapUshellAnchorItem");let t;const o=10;let s=0;let n;const i=[];for(t=0;t<e.length;t++){const o=e[t];const s=o.getBoundingClientRect();i[t]=s.width}for(t=0;t<e.length;t++){const e=i[t];if(e===0){continue}const l=Math.round(e/o);for(n=s;n<s+l;n++){this.aTabBarItemsLocation[n]=t}s=n}},_preventTextSelection:function(){if(window.getSelection){const e=window.getSelection();try{e.removeAllRanges()}catch{}}},_handleStartDragTile:function(e,t){this._preventTextSelection();l.getLayoutEngine().layoutStartCallback(t);l.initDragMode();const o=t.querySelectorAll("a");for(let e=0;e<o.length;e++){o[e].removeAttribute("href")}this.oController._handleDrag(e,t);n.getEventBus().publish("launchpad","sortableStart")},_onBeforeCreateLinkClone:function(e,t){l.getLayoutEngine().saveLinkBoundingRects(t)},_handleLinkDrop:function(e,t,o){const s=jQuery.Deferred();if(l.isTabBarActive()){l.tabBarTileDropped()}if(o&&o.clone){jQuery(o.clone).css({opacity:0})}if(i.desktop){document.body.classList.remove("sapUshellDisableUserSelect")}if(l.getLayoutEngine().isLinkIntersected()||l.getLayoutEngine().isOriginalAreaChanged()){this.oController._handleDrop(e,t).then(()=>{const e=document.getElementById("dashboardGroups");const t=e&&e.getElementsByClassName("sapUshellHidePlusTile");for(let e=0;e<t.length;e++){t[e].classList.remove("sapUshellHidePlusTile")}setTimeout(()=>{s.resolve()},0)})}else{setTimeout(()=>{s.resolve()},0)}return s.promise()},_handleTileDrop:function(e,t,o){if(l.getLayoutEngine().isOriginalAreaChanged()){return this._handleTileToLinkDrop(e,t,o)}return this._handleTileToTileDrop(e,t,o)},_handleTileToLinkDrop:function(e,t,o){return this._handleLinkDrop(e,t,o)},_handleTileToTileDrop:function(e,t,o){let s;function n(e,t){l.endDragMode();const o=document.getElementById("dashboardGroups");const s=o&&o.getElementsByClassName("sapUshellHidePlusTile");for(let e=0;e<s.length;e++){s[e].classList.remove("sapUshellHidePlusTile")}this.oController._handleDrop(this.oController,e,t);if(i.desktop){document.body.classList.remove("sapUshellDisableUserSelect")}}const a=jQuery(".sapUshellTabBarHoverOn");a.removeClass("sapUshellTabBarHoverOn");const r=jQuery(".sapUshellTileDragOpacity");r.removeClass("sapUshellTileDragOpacity");if(l.isTabBarActive()){l.tabBarTileDropped()}let c;if(l.isTabBarActive()&&l.isOnTabBarElement()){if(o&&o.clone){c=jQuery.Deferred();s=jQuery(o.clone);s.css("display","none");setTimeout(()=>{c.resolve();n.call(this,e,t)},0);return c.promise()}n.apply(this,arguments)}if(o&&o.clone){c=jQuery.Deferred();s=jQuery(o.clone);setTimeout(()=>{c.resolve();n.call(this,e,t)},0);return c.promise()}setTimeout(()=>{n.call(this,e,t)},0)},_getTileTopOffset:function(e,t,o){const s=0;let n=s+o;n+=e.closest(".sapUshellDashboardGroupsContainerItem").position().top;n+=t.top;return n},_markDisableGroups:function(){if(this.oController.getView().getModel()){this.oController.getView().getModel().setProperty("/isInDrag",true)}},_endUIHandler:function(){l.endDragMode();if(this.oController.getView().getModel()){this.oController.getView().getModel().setProperty("/isInDrag",false)}},_handleGroupStartDrag:function(t,o){this.oTileUIActions.disable();if(this.oLinkUIActions){this.oLinkUIActions.disable()}const l=jQuery(".sapUshellDashboardGroupsContainerItem-clone");const a=l.find(".sapUshellContainerTitle");const r=a.height();const c=a.width();const d=s.getRTL();if(!i.system.phone){l.find(".sapUshellTileContainerEditMode").offset({top:this.oGroupUIActions.getMove().y-r,left:d?jQuery("#sapUshellDashboardPage").width()+this.oGroupUIActions.getMove().x+c:this.oGroupUIActions.getMove().x-c/2});jQuery(".sapUshellTileContainerBeforeContent").addClass("sapUshellTileContainerHidden")}else{jQuery(".sapUshellTilesContainer-sortable").addClass("sapUshellTileContainerRemoveContent");jQuery(".sapUshellLineModeContainer").addClass("sapUshellTileContainerRemoveContent");jQuery(".sapUshellTileContainerBeforeContent").addClass("sapUshellTileContainerRemoveContent");jQuery(".sapUshellContainerHeaderActions").addClass("sapUshellTileContainerHidden")}jQuery(".sapUshellTileContainerAfterContent").addClass("sapUshellTileContainerRemoveContent");jQuery(o).find(".sapUshellContainerHeaderActions").addClass("sapUshellTileContainerHidden");this.oController.getView().getModel().setProperty("/isInDrag",true);jQuery(o).attr("startPos",jQuery(o).index());e.info(`startPos - ${jQuery(o).index()}`);setTimeout(()=>{n.getEventBus().publish("launchpad","sortableStart")},0);const h=jQuery("#dashboardGroups").offset().top;const p=jQuery(".sapUshellDashboardGroupsContainerItem-placeholder").offset().top;const u=jQuery(".sapUshellDashboardGroupsContainerItem-clone").offset().top;const g=p-h-u;jQuery(".sapUshellDashboardView section").css({scrollTop:g})},_handleGroupsUIStart:function(e,t){jQuery(t).find(".sapUshellTileContainerContent").css("outline-color","transparent")},_handleGroupDrop:function(e,t){const o=n.getEventBus();const s=jQuery(t);const i=jQuery(s.children()[0]).attr("id");const l=n.byId(i);const a=n.byId("dashboardGroups");const r={group:l,groupChanged:false,focus:false};const c=s.index();s.startPos=window.parseInt(s.attr("startPos"),10);a.removeAggregation("groups",l,true);a.insertAggregation("groups",l,c,true);this._handleGroupMoved(e,{item:s});s.removeAttr("startPos");n.getEventBus().publish("launchpad","sortableStop");setTimeout(()=>{jQuery(".sapUshellContainerHeaderActions").removeClass("sapUshellTileContainerHidden");jQuery(".sapUshellTileContainerBeforeContent").removeClass("sapUshellTileContainerHidden");jQuery(".sapUshellTileContainerBeforeContent").removeClass("sapUshellTileContainerRemoveContent");jQuery(".sapUshellTileContainerAfterContent").removeClass("sapUshellTileContainerRemoveContent");jQuery(".sapUshellTilesContainer-sortable").removeClass("sapUshellTileContainerRemoveContent");jQuery(".sapUshellLineModeContainer").removeClass("sapUshellTileContainerRemoveContent")},0);window.setTimeout(o.publish.bind(o,"launchpad","scrollToGroup",r),1);this.oTileUIActions.enable();if(this.oLinkUIActions){this.oLinkUIActions.enable()}},_handleGroupMoved:function(e,t){const o=t.item.startPos;const s=t.item.index();const n=this.oController.getView().getModel();if(s!==-1){this.oController._publishAsync("launchpad","moveGroup",{fromIndex:o,toIndex:s});setTimeout(()=>{n.setProperty("/isInDrag",false)},100)}},_setController:function(e){this.oController=e}});return a});
//# sourceMappingURL=DashboardUIActions.js.map