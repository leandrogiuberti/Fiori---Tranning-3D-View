// Copyright (c) 2009-2025 SAP SE, All Rights Reserved
sap.ui.define(["sap/m/library","sap/ui/core/library","sap/m/Page","sap/m/PageAccessibleLandmarkInfo","sap/ui/core/Component","sap/ui/core/Core","sap/ui/core/mvc/View","sap/ui/Device","sap/ui/model/Filter","sap/ui/model/FilterOperator","sap/ui/thirdparty/jquery","sap/ushell/components/homepage/DashboardGroupsBox","sap/ushell/Config","sap/ushell/EventHub","sap/ushell/resources","sap/ushell/ui/launchpad/AnchorItem","sap/ushell/ui/launchpad/AnchorNavigationBar","sap/ushell/utils","sap/ushell/components/homepage/DashboardContent.controller","sap/ushell/components/homepage/ActionMode"],(e,t,o,i,n,s,a,r,l,h,jQuery,d,c,u,p,g,f,b,m,A)=>{"use strict";const B=t.AccessibleLandmarkRole;return a.extend("sap.ushell.components.homepage.DashboardContent",{createContent:function(e){this.oModel=this.getController().getOwnerComponent().getModel();const t=this.oModel.getProperty("/personalization");const a=this.oModel.getProperty("/enableTileActionsIcon");this.isCombi=r.system.combi;this.isTouch=this.isCombi?false:r.system.phone||r.system.tablet;this.parentComponent=n.getOwnerComponentFor(this);this.addStyleClass("sapUshellDashboardView");this.oRenderer=sap.ushell.Container.getRendererInternal("fiori2");this.bIsHomeIntentRootIntent=b.isFlpHomeIntent(this.oRenderer.getShellConfig().rootIntent);s.getEventBus().subscribe("launchpad","actionModeInactive",this._handleEditModeChange,this);s.getEventBus().subscribe("launchpad","actionModeActive",this._handleEditModeChange,this);s.getEventBus().subscribe("launchpad","contentRefresh",this._onDashboardShown,this);s.getEventBus().subscribe("launchpad","dashboardModelContentLoaded",this._onDashboardShown,this);this.oDoable=u.once("CoreResourcesComplementLoaded").do(()=>{this.oAnchorNavigationBar.setOverflowEnabled(true);if(t||a){A.init(this.oModel)}if(t){this._createFooter();this._createActionModeButton()}});this.oFilterSelectedGroup=new l("isGroupSelected",h.EQ,true);this.oRenderer.getRouter().getRoute("home").attachMatched(this._onHomeNavigation,this);this.oAnchorNavigationBar=this._getAnchorNavigationBar(e);this.oAnchorNavigationBar.setModel(this.oModel);this.oRenderer.setNavigationBar(this.oAnchorNavigationBar);const c=new d;this.oDashboardGroupsBox=c.createGroupsBox(e,this.oModel);this.oPage=new o("sapUshellDashboardPage",{showHeader:false,landmarkInfo:new i({contentRole:B.Region,contentLabel:p.i18n.getText("Dashboard.Page.Content.AriaLabel"),rootRole:B.None}),floatingFooter:true,content:[this.oDashboardGroupsBox]});this.oPage.addEventDelegate({onAfterRendering:function(){const t=this.getDomRef();const o=t.getElementsByTagName("section");jQuery(o[0]).off("scrollstop",e.handleDashboardScroll);jQuery(o[0]).on("scrollstop",e.handleDashboardScroll)}.bind(this)});return this.oPage},getAnchorItemTemplate:function(){const e=this;const t=new g({index:"{index}",title:"{title}",groupId:"{groupId}",defaultGroup:"{isDefaultGroup}",helpId:"{helpId}",selected:false,isGroupRendered:"{isRendered}",visible:{parts:["/tileActionModeActive","isGroupVisible","visibilityModes"],formatter:function(e,t,o){if(!o[e?1:0]){return false}return t||e}},locked:"{isGroupLocked}",isGroupDisabled:{parts:["isGroupLocked","/isInDrag","/homePageGroupDisplay"],formatter:function(e,t,o){return e&&t&&o==="tabs"}},press:function(t){e.oAnchorNavigationBar.handleAnchorItemPress(t)}});t.attachBrowserEvent("focus",function(){this.setNavigationBarItemsVisibility()}.bind(this.oAnchorNavigationBar));return t},_getAnchorNavigationBar:function(e){const t=new f("anchorNavigationBar",{selectedItemIndex:"{/topGroupInViewPortIndex}",itemPress:[function(e){this._handleAnchorItemPress(e)},e],overflowEnabled:false});this._oAnchorNavigationBarDelegatePromise=new Promise((e,o)=>{if(r.system.desktop){sap.ui.require(["sap/ushell/components/ComponentKeysHandler"],o=>{o.getInstance().then(o=>{t.addEventDelegate({onBeforeFastNavigationFocus:function(e){if(jQuery(".sapUshellAnchorItem").is(":visible")){e.preventDefault();o.goToSelectedAnchorNavigationItem()}},onsapenter:function(e){e.srcControl.getDomRef().click()},onsapspace:function(e){e.srcControl.getDomRef().click()},onsaptabnext:function(){if(!s.byId("sapUshellAnchorBarOverflowButton").getVisible()){o.goToLastVisitedTile()}}});e()})})}else{e()}});t.addStyleClass("sapContrastPlus");return t},_actionModeButtonPress:function(){this.oDashboardGroupsBox.getBinding("groups").filter([]);const e=this.oDashboardGroupsBox.getGroups();A.toggleActionMode(this.oModel,"Menu Item",e);this._updateAnchorNavigationBarVisibility();if(this.oModel.getProperty("/homePageGroupDisplay")==="tabs"){if(this.oModel.getProperty("/tileActionModeActive")){const e=this.oModel.getProperty("/groups");let t;for(let o=0;o<e.length;o++){if(e[o].isGroupSelected){t=o;break}}this.getController()._scrollToGroup("launchpad","scrollToGroup",{group:{getGroupId:function(){return e[t].groupId}},groupChanged:false,focus:true})}else{this.getController()._deactivateActionModeInTabsState()}}},_createActionModeButton:function(){const e={id:"ActionModeBtn",text:p.i18n.getText("activateEditMode"),icon:"sap-icon://edit",press:this._actionModeButtonPress.bind(this)};const t=this.oRenderer.getShellConfig().moveEditHomePageActionToShellHeader;if(t){this._createActionModeButtonInHeader(e)}else{this._createActionModeButtonInUserMenu(e)}},_createActionModeButtonInHeader:function(e){let t="sap/ushell/ui/shell/ShellHeadItem";if(c.last("/core/shellBar/enabled")){t="sap/ushell/gen/ui5/webcomponents-fiori/dist/ShellBarItem";if(e.press){e.click=e.press;delete e.press}}sap.ui.require([t],t=>{this.oTileActionsButton=new t(e);if(c.last("/core/extension/enableHelp")){this.oTileActionsButton.addStyleClass("help-id-ActionModeBtn")}if(!this.bIsHomeIntentRootIntent){this.oRenderer.showHeaderEndItem(this.oTileActionsButton.getId(),true)}else{this.oRenderer.showHeaderEndItem(this.oTileActionsButton.getId(),false,["home"])}})},_createActionModeButtonInUserMenu:function(e){const t={controlType:"sap.ushell.ui.launchpad.ActionItem",oControlProperties:e,bIsVisible:true,aStates:["home"]};if(!this.bIsHomeIntentRootIntent){t.aStates=null;t.bCurrentState=true}this.oRenderer.addUserAction(t).done(e=>{this.oTileActionsButton=e;if(c.last("/core/extension/enableHelp")){this.oTileActionsButton.addStyleClass("help-id-ActionModeBtn")}})},_handleEditModeChange:function(){if(this.oTileActionsButton){this.oTileActionsButton.toggleStyleClass("sapUshellActionItemActive")}},_createFooter:function(){sap.ui.require(["sap/m/Bar","sap/m/Button","sap/m/ToolbarSpacer"],(t,o,i)=>{this.oPage.setFooter(new t("sapUshellDashboardFooter",{visible:"{/tileActionModeActive}",contentRight:[new i,new o("sapUshellDashboardFooterDoneBtn",{type:e.ButtonType.Emphasized,text:p.i18n.getText("closeEditMode"),tooltip:p.i18n.getText("exitEditMode"),press:this._actionModeButtonPress.bind(this)})]}))})},_onDashboardShown:function(){const e=this.oRenderer&&this.oRenderer.getCurrentCoreView()==="home";if(e){if(!r.system.phone){this.oRenderer.showRightFloatingContainer(false)}this._updateAnchorNavigationBarVisibility();this.getController().resizeHandler();b.refreshTiles();if(r.system.desktop){const e=document.activeElement?document.activeElement.tagName:"";if(e!=="INPUT"&&e!=="TEXTAREA"){sap.ui.require(["sap/ushell/components/ComponentKeysHandler"],e=>{e.getInstance().then(e=>{e.goToLastVisitedTile()})})}}}},_onHomeNavigation:function(){this._onDashboardShown();if(!this.bIsHomeIntentRootIntent){if(this.oRenderer.getShellConfig().moveEditHomePageActionToShellHeader){this.oRenderer.showHeaderEndItem(this.oTileActionsButton.getId(),true)}else{this.oRenderer.showActionButton(this.oTileActionsButton.getId(),true)}}if(u.last("firstSegmentCompleteLoaded")){u.emit("CloseFesrRecord",Date.now())}},_updateAnchorNavigationBarVisibility:function(){const e=this.oAnchorNavigationBar.getVisible();const t=this.getModel().getObject("/tileActionModeActive");const o=this.getModel().getProperty("/groups").filter(e=>{if(t){return e.isGroupVisible&&e.visibilityModes[1]}return e.isGroupVisible&&e.visibilityModes[0]});const i=o.length>1;this.oAnchorNavigationBar.setVisible(i);if(i&&!e){const e=this.getModel().getProperty("/groups");const t=this.getModel().getProperty("/iSelectedGroup");for(let i=0;i<o.length;i++){if(o[i].getGroupId&&o[i].getGroupId()===e[t].groupId){this.oAnchorNavigationBar.setSelectedItemIndex(i);break}}}},getControllerName:function(){return"sap.ushell.components.homepage.DashboardContent"},exit:function(){a.prototype.exit.apply(this,arguments);if(this.oAnchorNavigationBar){this.oAnchorNavigationBar.destroy()}if(this.oTileActionsButton){this.oTileActionsButton.destroy()}if(this.oDoable){this.oDoable.off()}if(this.oPage){this.oPage.destroy()}s.getEventBus().unsubscribe("launchpad","actionModeInactive",this._handleEditModeChange,this);s.getEventBus().unsubscribe("launchpad","actionModeActive",this._handleEditModeChange,this);s.getEventBus().unsubscribe("launchpad","contentRefresh",this._onDashboardShown,this);s.getEventBus().unsubscribe("launchpad","dashboardModelContentLoaded",this._onDashboardShown,this)}})});
//# sourceMappingURL=DashboardContent.view.js.map