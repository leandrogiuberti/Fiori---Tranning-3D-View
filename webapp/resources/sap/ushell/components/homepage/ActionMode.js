// Copyright (c) 2009-2025 SAP SE, All Rights Reserved
sap.ui.define(["sap/base/Log","sap/m/Button","sap/m/library","sap/m/Popover","sap/m/Text","sap/ui/core/Element","sap/ui/core/EventBus","sap/ushell/components/HomepageManager","sap/ushell/resources","sap/ushell/utils/WindowUtils","sap/ushell/EventHub"],(e,t,o,n,i,s,a,l,r,c,d)=>{"use strict";const p=o.PlacementType;function g(){this.oEventBus=a.getInstance();this.init=function(e){this.oModel=e}}g.prototype._activate=function(){this.oModel.setProperty("/tileActionModeActive",true);this.aOrigHiddenGroupsIds=this.getHomepageManager().getCurrentHiddenGroupIds(this.oModel);const e=s.getElementById("dashboardGroups");e.addLinksToUnselectedGroups();const t=s.getElementById("ActionModeBtn");if(t){t.setText(r.i18n.getText("exitEditMode"));if(t.setSelected){t.setSelected(true)}}this.oEventBus.publish("launchpad","actionModeActive")};g.prototype._deactivate=function(){this.oModel.setProperty("/tileActionModeActive",false);this.oEventBus.publish("launchpad","actionModeInactive",this.aOrigHiddenGroupsIds);const e=s.getElementById("TileActions");if(e!==undefined){e.destroy()}const t=s.getElementById("ActionModeBtn");if(t){t.setText(r.i18n.getText("activateEditMode"));if(t.setSelected){t.setSelected(false)}}};g.prototype.toggleActionMode=function(e,t,o){o=o||[];const n=o.filter(e=>e.getVisible());const i={group:n[e.getProperty("/topGroupInViewPortIndex")]};if(e.getProperty("/tileActionModeActive")){this._deactivate();const e=document.querySelector(".sapUshellTileContainerHeader[tabindex='0']");if(e){const t=e.closest("sapUshellTileContainer");if(t){i.restoreLastFocusedTileContainerById=t.getAttribute("id")}}}else{this._activate()}setTimeout(()=>{this.oEventBus.publish("launchpad","scrollToGroup",i)},0)};g.prototype.activateGroupEditMode=function(e){const t=e.getDomRef().getElementsByClassName("sapUshellTileContainerContent");for(let e=0;e<t.length;e++){t[e].classList.add("sapUshellTileContainerEditMode")}};g.prototype.getHomepageManager=function(){if(!this.oHomepageManager){this.oHomepageManager=l.prototype.getInstance()}return this.oHomepageManager};g.prototype._filterActions=function(e,t){const o=t.getModel();const n=t.getParent().getBindingContext().getPath();if(o.getProperty(`${n}/isGroupLocked`)){["tileSettingsBtn","linkSettingsBtn","ConvertToTile","ConvertToLink","moveTile_action"].forEach(t=>{e=e.filter(e=>e.id!==t)})}if(this.getHomepageManager().getPersonalizableGroups().length<2){e=e.filter(e=>e.id!=="moveTile_action")}return e};g.prototype._openActionsMenu=function(o){const n=o.getSource();const i=n.getBindingContext().getObject().object;let l=this.getHomepageManager().getTileActions(i);l=this._filterActions(l,n);const r=document.getElementsByClassName("sapUshellTileActionLayerDivSelected");for(let e=0;e<r.length;e++){r[e].classList.remove("sapUshellTileActionLayerDivSelected")}const c=n.getDomRef().getElementsByClassName("sapUshellTileActionLayerDiv");for(let e=0;e<c.length;e++){c[e].classList.add("sapUshellTileActionLayerDivSelected")}const d=[];l.forEach(o=>{if(!o.press&&!o.targetURL){e.warning(`Invalid Tile action discarded: ${JSON.stringify(o)}`);return}d.push(new t({text:o.text,icon:o.icon,press:this._handleActionPress.bind(this,o,n)}))});if(d.length===0){this._openNoActionsPopover(o);return}let g=n.getActionSheetIcon?n.getActionSheetIcon():undefined;if(!g){const e=s.getElementById(`${n.getId()}-action-more`);g=e||n}let u=s.getElementById("TileActions");if(!u){sap.ui.require(["sap/m/ActionSheet"],e=>{u=new e("TileActions",{placement:p.VerticalPreferedBottom,afterClose:function(){const e=document.getElementsByClassName("sapUshellTileActionLayerDivSelected");for(let t=0;t<e.length;t++){e[t].classList.remove("sapUshellTileActionLayerDivSelected")}const t=a.getInstance();t.publish("dashboard","actionSheetClose",n)}});this._openActionSheet(u,d,g)})}else{this._openActionSheet(u,d,g)}};g.prototype._openActionSheet=function(e,t=[],o){e.destroyButtons();t.forEach(t=>{e.addButton(t)});e.openBy(o)};g.prototype._openNoActionsPopover=function(e){const t=e.getSource();const o=new i({text:r.i18n.getText("tileHasNoActions")});new n({placement:p.Bottom,showHeader:false,ariaLabelledBy:o.getId(),content:o}).addStyleClass("sapUiContentPadding").openBy(t)};g.prototype._handleActionPress=function(e,t){if(e.press){e.press(t)}else if(e.targetURL){d.emit("UITracer.trace",{reason:"LaunchApp",source:"Tile",data:{targetUrl:e.targetURL}});if(e.targetURL.indexOf("#")===0){hasher.setHash(e.targetURL)}else{c.openURL(e.targetURL,"_blank")}}};return new g},true);
//# sourceMappingURL=ActionMode.js.map