// Copyright (c) 2009-2025 SAP SE, All Rights Reserved
sap.ui.define(["sap/base/Log","sap/base/util/isEmptyObject","sap/base/util/restricted/_zipObject","sap/m/Button","sap/m/GenericTile","sap/ui/base/Object","sap/ui/core/Component","sap/ui/core/Core","sap/ui/core/InvisibleMessage","sap/ui/core/library","sap/ui/Device","sap/ui/model/Filter","sap/ui/model/FilterOperator","sap/ui/performance/Measurement","sap/ushell/library","sap/ushell/components/homepage/ActionMode","sap/ushell/Config","sap/ushell/EventHub","sap/ushell/Layout","sap/ushell/resources","sap/ushell/ui/launchpad/DashboardGroupsContainer","sap/ushell/ui/launchpad/GroupHeaderActions","sap/ushell/ui/launchpad/LinkTileWrapper","sap/ushell/ui/launchpad/PlusTile","sap/ushell/ui/launchpad/Tile","sap/ushell/ui/launchpad/TileContainer","sap/ushell/utils","sap/ushell/utils/UrlParsing"],(e,t,i,n,o,s,r,a,l,u,c,d,p,h,g,f,b,A,G,C,m,v,y,T,P,I,B,M)=>{"use strict";const _=u.InvisibleMessageMode;const w=s.extend("sap.ushell.components.homepage.DashboardGroupsBox",{metadata:{publicMethods:["createGroupsBox"]},constructor:function(){if(w.fnDashboardGroupsBoxGetter){return w.fnDashboardGroupsBoxGetter()}w.fnDashboardGroupsBoxGetter=function(e){return function(){return e}}(this.getInterface());this.oController=undefined;this.oGroupsContainer=undefined;this._oInvisibleMessageInstance=l.getInstance();a.getEventBus().subscribe("launchpad","actionModeActive",this._handleActionModeChange,this);a.getEventBus().subscribe("launchpad","actionModeInactive",this._handleActionModeChange,this);a.getEventBus().subscribe("launchpad","GroupHeaderVisibility",this._updateGroupHeaderVisibility,this);a.getEventBus().subscribe("launchpad","AddTileContainerContent",this._addTileContainersContent,this);return undefined},destroy:function(){a.getEventBus().unsubscribe("launchpad","actionModeActive",this._handleActionModeChange,this);a.getEventBus().unsubscribe("launchpad","actionModeInactive",this._handleActionModeChange,this);a.getEventBus().unsubscribe("launchpad","GroupHeaderVisibility",this._updateGroupHeaderVisibility,this);a.getEventBus().unsubscribe("launchpad","AddTileContainerContent",this._addTileContainersContent,this);if(this.oGroupsContainer){this.oGroupsContainer.destroy()}w.fnDashboardGroupsBoxGetter=undefined;if(this._oHost){this._oHost.destroy()}},calculateFilter:function(){const e=[];let t;const i=this.oModel.getProperty("/homePageGroupDisplay");const n=this.oModel.getProperty("/tileActionModeActive");if(!n){if(i&&i==="tabs"){t=new d("isGroupSelected",p.EQ,true)}else{t=new d("isGroupVisible",p.EQ,true)}e.push(t)}return e},zipPromiseAll:function(e,t){return Promise.all(t).then(t=>i(e,t))},loadCardModuleIfNeeded:function(){if(b.last("/core/home/featuredGroup/enable")){return a.loadLibrary("sap.ui.integration",{async:true}).then(()=>new Promise(e=>{sap.ui.require(["sap/ui/integration/Host","sap/ui/integration/widgets/Card"],(t,i)=>{this.Card=i;this.Host=t;this._oHost=new t({action:this._onCardAction.bind(this)});e()})}))}return Promise.resolve()},createGroupsBox:function(e,i){this.oController=e;const n=this;function o(e){let t;let i;if(e&&(t=e.getDomRef())){i=t.querySelector(".sapUshellPlusTile");if(i){return i}}return null}function s(e){const t=o(e.currentGroup);const i=o(e.endGroup);const s=e.tiles[e.tiles.length-2]===e.item||e.endGroup.getTiles().length===0;if(s){n._hidePlusTile(i)}else{n._showPlusTile(i)}if(e.currentGroup!==e.endGroup){n._showPlusTile(t)}}function r(){G.getLayoutEngine().setExcludedControl(T);G.getLayoutEngine().setReorderTilesCallback.call(G.layoutEngine,s)}function l(){setTimeout(()=>{if(!G.isInited){G.init({getGroups:this.getGroups.bind(this),getAllGroups:n.getAllGroupsFromModel.bind(n),isTabBarActive:n.isTabBarActive.bind(n)}).then(r);c.media.attachHandler(function(){if(!this.bIsDestroyed){G.reRenderGroupsLayout(null)}},this,c.media.RANGESETS.SAP_STANDARD);const i=this.getDomRef();e.getView().sDashboardGroupsWrapperId=!t(i)&&i.parentNode?i.parentNode.id:""}A.emit("CenterViewPointContentRendered");a.getEventBus().publish("launchpad","contentRendered");a.getEventBus().publish("launchpad","contentRefresh");if(this.getBinding("groups")){this.getBinding("groups").filter(n.calculateFilter())}},0)}this.isTabBarActive=function(){return this.oModel.getProperty("/homePageGroupDisplay")==="tabs"};this.oModel=i;const u=this.calculateFilter();this.oGroupsContainer=new m("dashboardGroups",{displayMode:"{/homePageGroupDisplay}",afterRendering:l});this.zipPromiseAll(["launchpadService",""],[sap.ushell.Container.getServiceAsync("FlpLaunchPage"),n.loadCardModuleIfNeeded()]).then(t=>{this.isLinkPersonalizationSupported=t.launchpadService.isLinkPersonalizationSupported();this.oGroupsContainer.bindAggregation("groups",{filters:u,path:"/groups",factory:function(){return n._createTileContainer(e,i)}})});if(c.system.desktop){this.oGroupsContainer.addEventDelegate({onBeforeFastNavigationFocus:function(e){e.preventDefault();sap.ui.require(["sap/ushell/components/ComponentKeysHandler"],e=>{e.getInstance().then(e=>{e.goToLastVisitedTile()})})},onsaptabnext:function(e){const t=document.getElementById("sapUshellFloatingContainerWrapper");const i=t&&!t.classList.contains("sapUshellShellHidden");if(i&&e.originalEvent.srcElement.id!==""){e.preventDefault();a.getEventBus().publish("launchpad","shellFloatingContainerIsAccessible")}}})}return this.oGroupsContainer},getAllGroupsFromModel:function(){return this.oModel.getProperty("/groups")},_createTileContainer:function(e){const t=this;const i=new d("isTileIntentSupported",p.EQ,true);const n=new I({headerText:"{title}",showEmptyLinksArea:{parts:["/tileActionModeActive","links/length","isGroupLocked","/isInDrag","/homePageGroupDisplay"],formatter:function(e,t,i,n,o){if(t){return true}else if(i){return false}return e||n&&o==="tabs"}},showMobileActions:{parts:["/tileActionModeActive"],formatter:function(e){return e&&!this.getDefaultGroup()}},showIcon:{parts:["/isInDrag","/tileActionModeActive"],formatter:function(e,t){return this.getIsGroupLocked()&&(e||t)}},deluminate:{parts:["/isInDrag"],formatter:function(e){return this.getIsGroupLocked()&&e}},transformationError:{parts:["/isInDrag","/draggedTileLinkPersonalizationSupported"],formatter:function(e,t){return e&&!t}},showBackground:"{/tileActionModeActive}",tooltip:"{title}",tileActionModeActive:"{/tileActionModeActive}",enableHelp:b.last("/core/extension/enableHelp"),groupId:"{groupId}",defaultGroup:"{isDefaultGroup}",isLastGroup:"{isLastGroup}",isGroupLocked:"{isGroupLocked}",isGroupSelected:"{isGroupSelected}",showHeader:true,showGroupHeader:"{showGroupHeader}",homePageGroupDisplay:"{/homePageGroupDisplay}",editMode:"{editMode}",supportLinkPersonalization:this.isLinkPersonalizationSupported,titleChange:function(e){a.getEventBus().publish("launchpad","changeGroupTitle",{groupId:e.getSource().getGroupId(),newTitle:e.getParameter("newTitle")})},showEmptyLinksAreaPlaceHolder:{parts:["links/length","/isInDrag","/homePageGroupDisplay"],formatter:function(e,t,i){return t&&i==="tabs"&&!e}},showPlaceholder:{parts:["/tileActionModeActive","tiles/length"],formatter:function(e){return e&&!this.getIsGroupLocked()}},visible:{parts:["/tileActionModeActive","isGroupVisible","visibilityModes"],formatter:function(e,t,i){if(!i[e?1:0]){return false}return t||e}},hidden:{parts:["/tileActionModeActive","isGroupVisible"],formatter:function(e,t){return e&&!t}},links:this._getLinkTemplate(),tiles:{path:"tiles",factory:this._itemFactory.bind(this),filters:[i]},add:function(e){t._handleAddTileToGroup(e)}});return n},_getLinkTemplate:function(){const e=new d("isTileIntentSupported",p.EQ,true);if(!this.isLinkPersonalizationSupported){return{path:"links",templateShareable:true,template:new y({uuid:"{uuid}",tileCatalogId:"{tileCatalogId}",tileCatalogIdStable:"{tileCatalogIdStable}",target:"{target}",isLocked:"{isLocked}",tileActionModeActive:"{/tileActionModeActive}",debugInfo:"{debugInfo}",tileViews:{path:"content",factory:function(e,t){return t.getObject()}},afterRendering:function(e){const t=this.getDomRef().getElementsByTagName("a");for(let e=0;e<t.length;e++){t[e].setAttribute("tabindex",-1)}}}),filters:[e]}}return{path:"links",factory:function(e,t){let i=t.getObject().content[0];if(i&&i.bIsDestroyed){i=i.clone();t.getModel().setProperty(`${t.getPath()}/content/0`,i)}return i},filters:[e]}},_itemFactory:function(e,t){const i=t.getProperty(t.sPath);let n;let o;let s;let r;if(i){if(i.isCard){n=i&&i.content;o=n&&n.length&&n[0];if(o&&o["sap.card"]){r=o}else if(i.manifest){r={"sap.flp":i.manifest&&i.manifest["sap.flp"],"sap.card":{type:"List"}}}else{return this._createErrorTile()}s=new this.Card;s.setHost(this._oHost).setManifest(r)}else{s=this._createTile()}i.controlId=s&&s.getId&&s.getId()}return s},_onCardAction:async function(t){if(t.getParameter("type")!=="Navigation"){return}const i=t.getParameter("parameters");const n=M.parseShellHash(i.url);if(n){t.preventDefault();this._performIntentBasedNavigation(n)}else if(i.openUI){if(i.openUI==="RecentActivities"||i.openUI==="FrequentActivities"){const e=i.openUI==="RecentActivities"?"recentActivityFilter":"frequentlyUsedFilter";const[t]=await B.requireAsync(["sap/ushell/ui/QuickAccess"]);t.openQuickAccessDialog(e)}else{e.error(`Request to open unknown User Interface: '${i.openUI}'`)}t.preventDefault()}else if(i.url===""){t.preventDefault()}else if(b.last("/core/shell/enableRecentActivity")&&b.last("/core/shell/enableRecentActivityLogging")){const e={title:t.getParameter("parameters").title,url:i.url,appType:g.AppType.URL,appId:i.url};sap.ushell.Container.getRendererInternal("fiori2").logRecentActivity(e)}},_performIntentBasedNavigation:function(e){return sap.ushell.Container.getServiceAsync("CrossApplicationNavigation").then(t=>{t.toExternal({target:{semanticObject:e.semanticObject,action:e.action},params:e.params,appSpecificRoute:e.appSpecificRoute})})},_createErrorTile:function(){return new P({tileViews:{path:"content",factory:function(){return new o({state:"Failed"})}}})},_createTile:function(){const e=new P({long:"{long}",isDraggedInTabBarToSourceGroup:"{draggedInTabBarToSourceGroup}",uuid:"{uuid}",tileCatalogId:"{tileCatalogId}",tileCatalogIdStable:"{tileCatalogIdStable}",isCustomTile:"{isCustomTile}",target:"{target}",isLocked:"{isLocked}",navigationMode:"{navigationMode}",tileActionModeActive:"{/tileActionModeActive}",showActionsIcon:"{showActionsIcon}",rgba:"{rgba}",debugInfo:"{debugInfo}",tileViews:{path:"content",factory:function(e,t){return t.getObject()}},coverDivPress:function(e){if(!e.oSource.getBindingContext().getObject().tileIsBeingMoved&&f){f._openActionsMenu(e)}},showActions:function(e){if(f){f._openActionsMenu(e)}},deletePress:[this.oController._dashboardDeleteTileHandler,this.oController],press:[this.oController.dashboardTilePress,this.oController]});const t=a.byId("viewPortContainer");e.addEventDelegate({onclick:function(){h.start("FLP:DashboardGroupsBox.onclick","Click on tile","FLP");h.start("FLP:OpenApplicationonClick","Open Application","FLP");function e(){h.end("FLP:DashboardGroupsBox.onclick");t.detachAfterNavigate(e)}t.attachAfterNavigate(e)}});return e},_updateGroupHeaderVisibility:function(){const e=this.oGroupsContainer.getGroups();const t=this.oModel.getProperty("/tileActionModeActive");const i=this.oController.getView().oAnchorNavigationBar.getVisible();let n;let o=0;for(let t=0;t<e.length;t++){if(e[t].getProperty("visible")){o++;if(n===undefined){n=t}else{e[t].setShowGroupHeader(true)}}}if(n!==undefined){const s=t||o===1&&!i;e[n].setShowGroupHeader(s)}},_handleActionModeChange:function(){const e=this.oModel.getProperty("/tileActionModeActive");if(e){this._addTileContainersContent()}else{G.reRenderGroupsLayout(null)}},_addTileContainersContent:function(){const e=this.oGroupsContainer.getGroups();for(let t=0;t<e.length;t++){const i=e[t];if(!i.getBeforeContent().length){i.addBeforeContent(new n({icon:"sap-icon://add",text:C.i18n.getText("add_group_at"),visible:"{= !${isGroupLocked} && !${isDefaultGroup} && ${/tileActionModeActive}}",enabled:"{= !${/editTitle}}",press:[this._handleAddGroupButtonPress.bind(this)]}).addStyleClass("sapUshellAddGroupButton"))}if(!i.getAfterContent().length){i.addAfterContent(new n({icon:"sap-icon://add",text:C.i18n.getText("add_group_at"),visible:"{= ${isLastGroup} && ${/tileActionModeActive}}",enabled:"{= !${/editTitle}}",press:[this._handleAddGroupButtonPress.bind(this)]}).addStyleClass("sapUshellAddGroupButton"))}if(!i.getHeaderActions().length){i.addHeaderAction(new v({content:this._getHeaderActions(),tileActionModeActive:"{/tileActionModeActive}",isOverflow:"{/isPhoneWidth}"}).addStyleClass("sapUshellOverlayGroupActionPanel"))}}},_handleAddGroupButtonPress:function(e){this.oController._addGroupHandler(e);this._addTileContainersContent()},_getHeaderActions:function(){const e=[];e.push(new n({text:{path:"isGroupVisible",formatter:function(e){return C.i18n.getText(e?"HideGroupBtn":"ShowGroupBtn")}},icon:{path:"isGroupVisible",formatter:function(e){if(c.system.phone){return e?"sap-icon://hide":"sap-icon://show"}return""}},visible:"{= ${/enableHideGroups} && !${isGroupLocked} && !${isDefaultGroup}}",enabled:"{= !${/editTitle}}",press:function(e){const t=e.getSource();const i=t.getBindingContext();const n=i.getModel();const o=i.getPath();const s=n.getProperty(`${o}/isGroupVisible`);const r=a.getLibraryResourceBundle("sap.m");this._oInvisibleMessageInstance.announce([C.i18n.getText(s?"Group.nowBeingHidden":"Group.nowBeingShown"),C.i18n.getText("Section.ButtonLabelChanged"),C.i18n.getText(s?"ShowGroupBtn":"HideGroupBtn"),r.getText("ACC_CTR_TYPE_BUTTON")].join(" "),_.Polite);this.oController._changeGroupVisibility(i)}.bind(this)}).addStyleClass("sapUshellHeaderActionButton"));e.push(new n({text:{path:"removable",formatter:function(e){return C.i18n.getText(e?"DeleteGroupBtn":"ResetGroupBtn")}},icon:{path:"removable",formatter:function(e){if(c.system.phone){return e?"sap-icon://delete":"sap-icon://refresh"}return""}},visible:"{= !${isDefaultGroup}}",enabled:"{= !${/editTitle}}",press:function(e){const t=e.getSource();const i=t.getBindingContext();this.oController._handleGroupDeletion(i)}.bind(this)}).addStyleClass("sapUshellHeaderActionButton"));return e},_handleAddTileToGroup:function(e){if(document.toDetail){document.toDetail()}r.getOwnerComponentFor(this.oController.getView().parentComponent).getRouter().navTo("appfinder",{"innerHash*":`catalog/${JSON.stringify({targetGroup:encodeURIComponent(e.getSource().getBindingContext().sPath)})}`})},_hidePlusTile:function(e){if(e){e.classList.add("sapUshellHidePlusTile")}},_showPlusTile:function(e){if(e){e.classList.remove("sapUshellHidePlusTile")}}});return w});
//# sourceMappingURL=DashboardGroupsBox.js.map