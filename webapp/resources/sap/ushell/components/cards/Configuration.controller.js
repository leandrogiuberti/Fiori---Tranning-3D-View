// Copyright (c) 2009-2025 SAP SE, All Rights Reserved
sap.ui.define(["sap/base/i18n/Localization","sap/ui/core/Locale","sap/ushell/components/cards/ManifestPropertyHelper","sap/ushell/resources","sap/ui/core/mvc/Controller","sap/base/strings/formatMessage","sap/ui/model/json/JSONModel","sap/ui/thirdparty/jquery","sap/base/Log","sap/ushell/utils/LaunchpadError"],(e,t,a,i,n,r,o,jQuery,s,g)=>{"use strict";return n.extend("sap.ushell.components.cards.Configuration",{formatter:r,onInit:function(){const e=this.getView();const t=e.getViewData();const a=t.chipInstance;const n=a.configuration.getParameterValueAsString("cardManifest");let r;if(n){r=this._prepareManifest(n,a)}const s=new o({data:{editorValue:JSON.stringify(r,null,4)||""},config:{originalLanguage:"",sapLogonLanguage:"",displayOriginalLanguageWarning:false,manifestEditorEditable:true}});e.setModel(s);e.setModel(i.i18nModel,"i18n");e.setViewName("sap.ushell.components.cards.Configuration");a.configurationUi.attachSave(this.onSaveConfiguration.bind(this));this._checkOriginalLanguage()},onSaveConfiguration:function(){const e=new jQuery.Deferred;const t=this.getView().getModel();const n=t.getProperty("/data/editorValue");let r;try{r=JSON.parse(n)}catch(t){s.error(i.i18n.getText("configuration.invalidJSONProvided"),t,"card.Configuration.controller");e.reject(t);return e}const o=a.extractCardData(r);this._saveManifestAndTileConfig(o.manifest,o.tileConfiguration).then(this._saveTilePropertiesBag.bind(this,o)).then(this._saveTitle.bind(this,o.bagProperties.display_title_text)).then(this._updateTileModel.bind(this,o)).then(e.resolve).catch(t=>{s.error("save failed",t,"card.Configuration.controller");e.reject(t)});return e.promise()},_saveManifestAndTileConfig:function(e,t){const a=this.getView().getViewData().chipInstance;const i=new Promise((i,n)=>{a.writeConfiguration.setParameterValues({cardManifest:JSON.stringify(e),tileConfiguration:t},i,(e,t)=>{const a=new g(e,{error:e,errorInfo:t});n(a)})});return i},_saveTilePropertiesBag:function(e){const t=this.getView().getViewData().chipInstance;const a=t.bag.getBag("tileProperties");this._fillCardBag(e,a);const i=new Promise((e,t)=>{a.save(e,(e,a)=>{const i=Object.keys(e)[0];t(new g(`Bag save failed: ${e[i]}`,{info:a[i],otherMessages:e,otherInfo:a}))})});return i},_saveTitle:function(e){const t=this.getView().getViewData().chipInstance;const a=new Promise((a,i)=>{if(t.title){t.title.setTitle(e,a,(e,t)=>{const a=new g(e,{error:e,errorInfo:t});i(a)})}else{a()}});return a},_updateTileModel:function(e){const t=this.getView().getModel("tileModel");t.setProperty("/data/display_title_text",e.bagProperties.display_title_text);t.setProperty("/data/display_subtitle_text",e.bagProperties.display_subtitle_text)},_fillCardBag:function(e,t){Object.keys(e.bagProperties).forEach(a=>{if(e.bagProperties[a]){t.setText(a,e.bagProperties[a])}else{t.resetProperty(a)}})},_prepareManifest:function(e,t){const i=JSON.parse(e);const n=a.getCardData(t);return a.mergeCardData(i,n)},_checkOriginalLanguage:function(){let e;let t;if(!this._isOriginalLanguage()){e=this.getView().getModel();t=this._getLanguages();e.setProperty("/config/originalLanguage",t.originalLanguage.toUpperCase());e.setProperty("/config/sapLogonLanguage",t.logonLanguage.toUpperCase());e.setProperty("/config/displayOriginalLanguageWarning",true);e.setProperty("/config/manifestEditorEditable",false)}},_isOriginalLanguage:function(){const e=this._getLanguages();const t=e.originalLanguage.toLowerCase();const a=e.logonLanguage.toLowerCase();const i=e.ui5CoreLanguage.toLowerCase();return t===""||t===a||t===i},_getLanguages:function(){const a=this.oView.getViewData().chipInstance;return{originalLanguage:a.bag.getOriginalLanguage(),logonLanguage:new t(e.getLanguageTag()).getSAPLogonLanguage(),ui5CoreLanguage:e.getLanguage()}}})});
//# sourceMappingURL=Configuration.controller.js.map