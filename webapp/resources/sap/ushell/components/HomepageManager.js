// Copyright (c) 2009-2025 SAP SE, All Rights Reserved
sap.ui.define(["sap/ui/thirdparty/jquery","sap/ui/core/Core","sap/ui/core/Theming","sap/ui/base/Object","sap/ui/Device","sap/ui/model/Filter","sap/ushell/ui/launchpad/TileState","sap/ushell/components/_HomepageManager/PagingManager","sap/ushell/components/_HomepageManager/DashboardLoadingManager","sap/ushell/EventHub","sap/ushell/Config","sap/ushell/utils","sap/ushell/resources","sap/ushell/components/DestroyHelper","sap/ushell/components/GroupsHelper","sap/ushell/components/MessagingHelper","sap/m/GenericTile","sap/m/SelectDialog","sap/m/StandardListItem","sap/ushell/components/_HomepageManager/PersistentPageOperationAdapter","sap/ushell/components/_HomepageManager/TransientPageOperationAdapter","sap/ui/model/FilterOperator","sap/m/library","sap/ui/model/Context","sap/m/MessageToast","sap/base/Log","sap/base/util/extend","sap/ui/performance/Measurement","sap/ushell/Config","sap/ushell/Container"],(jQuery,e,t,o,i,s,n,r,l,a,d,u,p,c,h,g,f,b,m,M,P,T,G,y,_,I,k,w,L,S)=>{"use strict";const v=G.GenericTileScope;const A={PERSONALIZATION:"FLP: Personalization",RENAME_GROUP:"FLP: Rename Group",MOVE_GROUP:"FLP: Move Group",DELETE_GROUP:"FLP: Delete Group",RESET_GROUP:"FLP: Reset Group",DELETE_TILE:"FLP: Delete Tile",ADD_TILE:"FLP: Add Tile",MOVE_TILE:"FLP: Move Tile"};const O=[];let V;const x=o.extend("sap.ushell.components.HomepageManager",{metadata:{publicMethods:["getModel","getDashboardView","loadPersonalizedGroups","resetGroupsOnFailure","addGroupToModel","addTileToGroup","deleteTilesFromGroup"]},analyticsConstants:A,constructor:function(e,o){if(V){if(!V.view){V.setDashboardView(o.view)}return V}this.oServiceLoadingPromise=S.getServiceAsync("FlpLaunchPage").then(e=>{this.oPageBuilderService=e;this.oPageBuilderService.registerTileActionsProvider(this._addFLPActionsToTile.bind(this));this.oPageOperationAdapter=M.getInstance(e);this.bLinkPersonalizationSupported=this.oPageOperationAdapter.isLinkPersonalizationSupported()});t.attachApplied(u.handleTilesVisibility);V=this;this.oModel=o.model;this.oRouter=o.router;this.oDashboardView=o.view;this.oSortableDeferred=new jQuery.Deferred;this.oSortableDeferred.resolve();this.registerEvents();this.tileViewUpdateQueue=[];this.tileViewUpdateTimeoutID=0;this.tileUuid=null;this.bIsGroupsModelLoading=false;this.bIsGroupsRequestPending=false;this.segmentsStore=[];this.bIsFirstSegment=true;this.bIsFirstSegmentViewLoaded=false;this.aGroupsFrame=null;this.iMinNumOfTilesForBlindLoading=this.oModel.getProperty("/optimizeTileLoadingThreshold")||100;this.bIsScrollModeAccordingKPI=false;this.oGroupNotLockedFilter=new s("isGroupLocked",T.EQ,false);this.oDashboardLoadingManager=new l("loadingManager",{oDashboardManager:this});if(this.oRouter){const e=this.oRouter.getTarget("home");e.attachDisplay(e=>{this.oDashboardView=e.getParameter("view")})}let i=d.last("/core/home/enableTransientMode");O.push(d.on("/core/home/enableTransientMode").do(e=>{if(i===e){return}i=e;this._changeMode(e)}));this.oModel.bindProperty("/tileActionModeActive").attachChange(this._changeLinksScope.bind(this));this._aRequestQueue=[];this._bRequestRunning=false;return undefined},_addRequest:function(e){this._aRequestQueue.push(e);if(!this._bRequestRunning){this._bRequestRunning=true;this._aRequestQueue.shift()()}},_checkRequestQueue:function(){if(this._aRequestQueue.length===0){this._bRequestRunning=false}else{this._aRequestQueue.shift()()}},_requestFailed:function(){this._aRequestQueue=[];this._bRequestRunning=false},isBlindLoading:function(){const e=d.last("/core/home/homePageGroupDisplay");if((e===undefined||e==="scroll")&&this.bIsScrollModeAccordingKPI){I.info("isBlindLoading reason IsScrollModeAccordingKPI and IsScrollMode: true");return true}if(this.oModel.getProperty("/tileActionModeActive")){I.info("isBlindLoading reason TileActionModeActive : true");return true}return false},createMoveActionDialog:function(e){const t=new b(e,{title:p.i18n.getText("moveTileDialog_title"),rememberSelections:false,contentWidth:"400px",contentHeight:"auto",confirm:function(t){const o=t.getParameter("selectedContexts");this.publishMoveActionEvents(o,e)}.bind(this),cancel:function(){const e=document.querySelector('.sapUshellTile[tabindex="0"]');if(e){e.focus()}},items:{path:"/groups",template:new m({title:"{title}"})}});return t},publishMoveActionEvents:function(t,o){const s=e.getEventBus();if(t.length){const e=this.tileType==="link"?"links":"tiles";const n=t[0].getObject().groupId;const r={sTileId:this.tileUuid,sToItems:e,sFromItems:e,sTileType:e,toGroupId:t[0].getObject().groupId,toIndex:t[0].getObject()[this.tileType==="link"?"links":"tiles"].length,source:o};if(i.system.desktop){sap.ui.require(["sap/ushell/components/ComponentKeysHandler"],e=>{e.getInstance().then(e=>{r.callBack=e.callbackSetFocus.bind(e);s.publish("launchpad","scrollToGroup",{groupId:n});s.publish("launchpad","movetile",r)})})}else{s.publish("launchpad","scrollToGroup",{groupId:n});s.publish("launchpad","movetile",r)}}},_changeLinksScope:function(e){const t=this;if(this.bLinkPersonalizationSupported){const o=e.getSource().getValue();this.oModel.getProperty("/groups").forEach((e,i)=>{if(!e.isGroupLocked){t._changeGroupLinksScope(e,o?"Actions":"Display")}})}},_changeGroupLinksScope:function(e,t){const o=this;e.links.forEach((e,i)=>{o._changeLinkScope(e.content[0],t)})},_changeLinkScope:function(e,t){let o;if(e.getScope){o=e}else if(e.getContent){o=e.getContent()[0]}if(this.bLinkPersonalizationSupported&&o&&o.setScope){o.setScope(t)}},registerEvents:function(){const t=e.getEventBus();t.subscribe("launchpad","addBookmarkTile",this._createBookmark,this);t.subscribe("launchpad","tabSelected",this.getSegmentTabContentViews,this);t.subscribe("sap.ushell.services.Bookmark","bookmarkTileAdded",this._addBookmarkToModel,this);t.subscribe("sap.ushell.services.Bookmark","catalogTileAdded",this._refreshGroupInModel,this);t.subscribe("sap.ushell.services.Bookmark","bookmarkTileDeleted",this.loadPersonalizedGroups,this);t.subscribe("launchpad","loadDashboardGroups",this.loadPersonalizedGroups,this);t.subscribe("launchpad","createGroupAt",this._createGroupAt,this);t.subscribe("launchpad","deleteGroup",this._deleteGroup,this);t.subscribe("launchpad","resetGroup",this._resetGroup,this);t.subscribe("launchpad","changeGroupTitle",this._changeGroupTitle,this);t.subscribe("launchpad","moveGroup",this._moveGroup,this);t.subscribe("launchpad","deleteTile",this._deleteTile,this);t.subscribe("launchpad","movetile",this._moveTile,this);t.subscribe("launchpad","sortableStart",this._sortableStart,this);t.subscribe("launchpad","sortableStop",this._sortableStop,this);t.subscribe("launchpad","dashboardModelContentLoaded",this._modelLoaded,this);t.subscribe("launchpad","convertTile",this._convertTile,this)},_changeMode:function(e){const t=this.getModel().getProperty("/groups");if(e){this.oPageOperationAdapter=P.getInstance();const e=this.oPageOperationAdapter.transformGroupModel(t);this.getModel().setProperty("/groups",e)}else{this.oPageOperationAdapter=M.getInstance();c.destroyFLPAggregationModels(t);this.getModel().setProperty("/groups",[]);this.loadPersonalizedGroups()}},_addFLPActionsToTile:function(e){const t=[];if(d.last("/core/shell/enablePersonalization")){const o=this.bLinkPersonalizationSupported&&this.oPageOperationAdapter.isLinkPersonalizationSupported(e);t.push(this._getMoveTileAction(e));if(o){t.push(this._getConvertTileAction(e))}}return t},getPersonalizableGroups:function(){const e=this.getModel().getProperty("/groups");return e.filter(e=>!e.isGroupLocked)},_getConvertTileAction:function(t){const o=e.getEventBus();const s=this.oPageOperationAdapter.getTileType(t);const n=s==="tile"?"ConvertToLink":"ConvertToTile";return{id:n,text:p.i18n.getText(n),press:function(e){const t={tile:e};if(i.system.desktop){sap.ui.require(["sap/ushell/components/ComponentKeysHandler"],e=>{e.getInstance().then(e=>{t.callBack=e.callbackSetFocus.bind(e);o.publish("launchpad","convertTile",t)})})}else{o.publish("launchpad","convertTile",t)}}}},_getMoveTileAction:function(e){const t="moveTile_action";return{id:t,text:p.i18n.getText(t),press:function(t){this.tileType=this.oPageOperationAdapter.getTileType(e);const o=this.tileType==="tile";this.tileUuid=this.getModelTileById(this.oPageOperationAdapter.getTileId(e),o?"tiles":"links").uuid;const i=t.getParent().getProperty("groupId");const n=new s("groupId",T.NE,i);const r=function(e){const t=e.getParameter("value");const o=new s("title",T.Contains,t);const i=e.getSource().getBinding("items");i.filter([o,this.oGroupNotLockedFilter,n])}.bind(this);let l=o?this.moveTileDialog:this.moveLinkDialog;if(!l){l=this.createMoveActionDialog(`move${this.tileType}Dialog`);l.setModel(this.oModel);if(o){this.moveTileDialog=l}else{this.moveLinkDialog=l}}else{l.detachSearch(l._searchHandler)}l.getBinding("items").filter([this.oGroupNotLockedFilter,n]);l.attachSearch(r);l._searchHandler=r;l.open()}.bind(this)}},_handleTileAppearanceAnimation:function(e){if(!e){return}const t=["webkit",""];function o(o,i){for(let o=0;o<t.length;o++){i=i.toLowerCase();e.attachBrowserEvent(t[o]+i,t=>{if(t.originalEvent&&t.originalEvent.animationName==="sapUshellTileEntranceAnimation"){e.removeStyleClass("sapUshellTileEntrance")}},false)}}o(e,"AnimationEnd");e.addStyleClass("sapUshellTileEntrance")},destroy:function(){const i=e.getEventBus();i.unsubscribe("launchpad","addBookmarkTile",this._createBookmark,this);i.unsubscribe("launchpad","loadDashboardGroups",this.loadPersonalizedGroups,this);i.unsubscribe("launchpad","createGroupAt",this._createGroupAt,this);i.unsubscribe("launchpad","deleteGroup",this._deleteGroup,this);i.unsubscribe("launchpad","resetGroup",this._resetGroup,this);i.unsubscribe("launchpad","changeGroupTitle",this._changeGroupTitle,this);i.unsubscribe("launchpad","moveGroup",this._moveGroup,this);i.unsubscribe("launchpad","deleteTile",this._deleteTile,this);i.unsubscribe("launchpad","movetile",this._moveTile,this);i.unsubscribe("launchpad","sortableStart",this._sortableStart,this);i.unsubscribe("launchpad","sortableStop",this._sortableStop,this);i.unsubscribe("launchpad","dashboardModelContentLoaded",this._modelLoaded,this);t.detachApplied(u.handleTilesVisibility);O.forEach(e=>{e.off()});M.destroy();P.destroy();V=undefined;o.prototype.destroy.apply(this,arguments)},_sortableStart:function(){this.oSortableDeferred=new jQuery.Deferred},_createBookmark:function(e,t,o){const i=o.group?o.group.object:"";delete o.group;function s(){S.getServiceAsync("BookmarkV2").then(e=>{e.addBookmark(o,i).then(()=>{g.showLocalizedMessage("tile_created_msg")}).catch(e=>{I.error("Failed to add bookmark",e,"sap.ushell.ui.footerbar.AddBookmarkButton");g.showLocalizedError("fail_to_add_tile_msg")}).finally(this._checkRequestQueue.bind(this))})}this._addRequest(s.bind(this))},_addBookmarkToModel:function(e,t,o){const i=o.tile;let s=o.group;if(!o||!i){this.bIsGroupsModelDirty=true;if(!this.bGroupsModelLoadingInProcess){this._handleBookmarkModelUpdate()}return}if(!s){const e=this.getModel().getProperty("/groups");for(let t=0;t<e.length;t++){if(e[t].isDefaultGroup===true){s=e[t].object;break}}}const n=this._getIndexOfGroupByObject(s);const r=this.oModel.getProperty(`/groups/${n}`);const l=this.oPageOperationAdapter.getPreparedTileModel(i,r.isGroupLocked);this.getTileView(l);r.tiles.push(l);r.visibilityModes=u.calcVisibilityModes(r,true);const a=r.tiles.length;this._updateModelWithTileView(n,a);this.oModel.setProperty(`/groups/${n}`,r)},_refreshGroupInModel:function(e,t,o){const i=this;this.oPageOperationAdapter.refreshGroup(o).then(e=>{if(!e){return}const t=i._getIndexOfGroupByObject(e.object);e.visibilityModes=u.calcVisibilityModes(e.object,true);i.oModel.setProperty(`/groups/${t}`,e);if(e.tiles){e.tiles.forEach(e=>{i.getTileView(e)})}})},_sortableStop:function(){this.oSortableDeferred.resolve()},_handleAfterSortable:function(e){return function(){const t=Array.prototype.slice.call(arguments);this.oSortableDeferred.done(()=>{e.apply(null,t)})}.bind(this)},_createGroupAt:function(e,t,o){const i=parseInt(o.location,10);const s=this.oModel.getProperty("/groups");const n=this.oPageOperationAdapter.getPreparedGroupModel(null,false,i===s.length,o);const r=this.oModel;let l;n.index=i;s.splice(i,0,n);for(l=0;l<s.length-1;l++){s[l].isLastGroup=false}for(l=i+1;l<s.length;l++){s[l].index++}r.setProperty("/groups",s)},_getIndexOfGroupByObject:function(e){const t=this.oModel.getProperty("/groups");return this.oPageOperationAdapter.getIndexOfGroup(t,e)},getTileActions:function(e){return this.oPageOperationAdapter.getTileActions(e)},addTileToGroup:function(e,t){const o=`${e}/tiles`;const i=this.oModel.getProperty(e);const s=this.oModel.getProperty(o).length;const n=this.oModel.getProperty(`${e}/isGroupLocked`);const r=this.oModel.getProperty("/personalization");i.tiles[s]=this.oPageOperationAdapter.getPreparedTileModel(t,n);this.getTileView(i.tiles[s]);i.visibilityModes=u.calcVisibilityModes(i,r);this._updateModelWithTileView(i.index,s);this.oModel.setProperty(e,i)},addTilesToGroupByCatalogTileId:function(e,t){const o=e.getBindingContext();for(let e=0;e<t.length;e++){this.addTileToGroupByCatalogTileId(o.sPath,t[e])}},addTileToGroupByCatalogTileId:function(e,t){if(!d.last("/core/home/enableTransientMode")){return}const o=this.oPageOperationAdapter.getTileModelByCatalogTileId(t);if(!o){return}this.oDashboardLoadingManager.setTileResolved(o);const i=this.oModel.getProperty(`${e}/tiles`).length;const s=this.oModel.getProperty(e);s.tiles[i]=o;this.oModel.setProperty(e,s)},_getPathOfTile:function(e){const t=this.oModel.getProperty("/groups");for(let o=0;o<t.length;++o){const i=t[o];const s=i.tiles;const n=i.links;for(let t=0;t<s.length;++t){if(s[t].uuid===e){return`/groups/${o}/tiles/${t}`}}for(let t=0;t<n.length;++t){if(n[t].uuid===e){return`/groups/${o}/links/${t}`}}}return null},_moveInArray:function(e,t,o){if(o>=e.length){let t=o-e.length;while(t--+1){e.push(undefined)}}e.splice(o,0,e.splice(t,1)[0])},_updateGroupIndices:function(e){for(let t=0;t<e.length;t++){e[t].index=t}},_deleteGroup:function(t,o,i){const s=this.oModel;const n=i.groupId;const r=s.getProperty("/groups");const l=h.getIndexOfGroup(r,n);const a=r.length-1===l;const d=a?l-1:l;c.destroyFLPAggregationModel(s.getProperty(`/groups/${l}`));const u=r.splice(l,1)[0];if(a){s.setProperty(`/groups/${d}/isLastGroup`,a)}s.setProperty("/groups",r);this._updateGroupIndices(r);if(d>=0){window.setTimeout(()=>{e.getEventBus().publish("launchpad","scrollToGroup",{groupId:s.getProperty("/groups")[d].groupId})},200)}function p(){this.oPageOperationAdapter.deleteGroup(u).then(()=>{g.showLocalizedMessage("group_deleted_msg",[u.title]);this._checkRequestQueue()}).catch(()=>{this._resetGroupsOnFailure("fail_to_delete_group_msg")})}this._addRequest(p.bind(this))},_resetGroup:function(t,o,i){const s=this;const n=i.groupId;const r=this.oModel;const l=r.getProperty("/groups");const d=h.getIndexOfGroup(l,n);const p=s.oModel.getProperty("/groups/indexOfDefaultGroup")===d;const c=r.getProperty(`/groups/${d}`);r.setProperty(`/groups/${d}/sortable`,false);function f(){s.oPageOperationAdapter.resetGroup(c,p).then(t=>{s._handleAfterSortable((t,o,i)=>{const n=s.oModel.getProperty("/groups");const r=h.getIndexOfGroup(n,t);s._loadGroup(r,i||o);g.showLocalizedMessage("group_reset_msg",[o.title]);s.oModel.setProperty(`/groups/${r}/sortable`,true);const l=e.byId("dashboardGroups").getGroupControlByGroupId(t);const d=l.getBindingContext().getObject().links;if(d&&d.length&&!l.getIsGroupLocked()){s._changeGroupLinksScope(l.getBindingContext().getObject(),s.oModel.getProperty("/tileActionModeActive")?v.Actions:v.Display)}if(l){l.invalidate();a.emit("updateGroups",Date.now());u.handleTilesVisibility()}})(n,c,t);s._checkRequestQueue()}).catch(()=>{s._resetGroupsOnFailure("fail_to_reset_group_msg")})}this._addRequest(f)},_moveGroup:function(e,t,o){if(isNaN(o.fromIndex)){return}let i=o.fromIndex;let s=o.toIndex;const n=this.oModel;let r=n.getProperty("/groups");const l=n.getProperty("/tileActionModeActive");const a=this;if(!l){i=this._adjustFromGroupIndex(i,r)}const d=r[i];const u=d.groupId;if(!l){s=this._adjustToGroupIndex(s,r,u)}const p=r[s];this._moveInArray(r,i,s);this._updateGroupIndices(r);for(let e=0;e<r.length-1;e++){r[e].isLastGroup=false}r[r.length-1].isLastGroup=true;n.setProperty("/groups",r);function c(){r=n.getProperty("/groups");const e=n.getProperty(h.getModelPathOfGroup(r,u));if(!e.object){return}a.oPageOperationAdapter.getOriginalGroupIndex(p,r).then(t=>{const o={iFromIndex:i,iToIndex:s};return a.oPageOperationAdapter.moveGroup(e,t,o)}).then(a._checkRequestQueue.bind(a)).catch(()=>{a._resetGroupsOnFailure("fail_to_move_group_msg")})}this._addRequest(c)},_adjustToGroupIndex:function(e,t,o){let i=0;let s=false;let n;for(n=0;n<t.length&&i<e;n++){if(t[n].isGroupVisible){if(t[n].groupId===o){s=true}else{i++}}}if(s){return n-1}return n},_adjustFromGroupIndex:function(e,t){let o=0;for(let i=0;i<t.length;i++){if(t[i].isGroupVisible){o++}if(o===e+1){return i}}return e},_changeGroupTitle:function(e,t,o){const i=this;const s=o.newTitle;const n=this.oModel.getProperty("/groups");const r=o.groupId;const l=h.getIndexOfGroup(n,r);const a=i.oModel.getProperty("/groups/indexOfDefaultGroup")===l;const d=this.oModel.getProperty(`/groups/${l}`);const u=d.title;this.oModel.setProperty(`/groups/${l}/title`,s);function p(){let e;if(d.isLastGroup){e=i.oPageOperationAdapter.addGroupAt(d,undefined,a)}else{const t=i.oModel.getProperty("/groups")[l+1];e=i.oPageOperationAdapter.getOriginalGroupIndex(t,n).then(e=>i.oPageOperationAdapter.addGroupAt(d,e,a))}e.then(e=>{i._handleAfterSortable((e,t)=>{const o=i.oModel.getProperty("/groups");const s=h.getIndexOfGroup(o,e);const n=o[s];Object.keys(t).forEach(e=>{if(e==="tiles"||e==="links"){return}n[e]=t[e]});i.oModel.refresh();i._checkRequestQueue()})(r,e)}).catch(()=>{i._resetGroupsOnFailure("fail_to_create_group_msg")})}function c(){this.oPageOperationAdapter.renameGroup(d,s,u).then(()=>{i._checkRequestQueue()}).catch(()=>{i._resetGroupsOnFailure("fail_to_rename_group_msg")})}if(!d.object){this._checkRequestQueue();this._addRequest(p.bind(this))}else{this._addRequest(c.bind(this))}},addGroupToModel:function(e){const t=this.oPageOperationAdapter.getPreparedGroupModel(e,false,true,{isRendered:true});const o=this.oModel.getProperty("/groups");const i=o.length;if(i>0){o[i-1].isLastGroup=false}t.index=i;o.push(t);this.oModel.setProperty("/groups/",o);const s=new y(this.oModel,`/groups/${i}`);return s},_deleteTile:function(t,o,s){const n=s.tileId;const r=this.oModel.getProperty("/groups");const l=s.items||"tiles";function a(e,t){this.oPageOperationAdapter.removeTile(e,t).then(this._checkRequestQueue.bind(this)).catch(this._resetGroupsOnFailure.bind(this,"fail_to_remove_tile_msg"))}function d(t,o,i){const s=e.byId("dashboardGroups");const n=s.getGroupControlByGroupId(o.groupId);let r;if(i==="tiles"){if(t+1===o[i].length){r=n.oPlusTile}}else{const e=n.getLinks();if(t+1===e.length){if(e.length===1){r=n.oPlusTile}else{r=e[t-1]}}else{r=e[t+1]}}if(r){sap.ui.require(["sap/ushell/components/ComponentKeysHandler"],e=>{e.getInstance().then(e=>{e.moveScrollDashboard(r.$())})})}}for(let e=0;e<r.length;++e){const t=r[e];for(let o=0;o<t[l].length;++o){const s=t[l][o];if(s.uuid===n){if(i.system.desktop){d(o,t,l)}c.destroyTileModel(this.oModel.getProperty(`/groups/${e}/${l}/${o}`));const s=t[l].splice(o,1)[0];const n=this.oModel.getProperty("/personalization");t.visibilityModes=u.calcVisibilityModes(t,n);this.oModel.setProperty(`/groups/${e}`,t);this._addRequest(a.bind(this,t,s));u.handleTilesVisibility();return}}}},deleteTilesFromGroup:function(e,t){const o=this.oModel.getProperty("/groups");const i=h.getIndexOfGroup(o,e);const s=this.oModel.getProperty(`/groups/${i}`);let n=[];["tiles","links"].forEach(e=>{n=s[e].filter(e=>t.indexOf(e.uuid)<0);s[e]=n});s.visibilityModes=u.calcVisibilityModes(s,true);this.oModel.setProperty(`/groups/${i}`,s)},_getGroupIndex:function(e){const t=this.oModel.getProperty("/groups");const o=this._getNewGroupInfo(t,e);if(o){return o.newGroupIndex}return undefined},_convertTile:function(e,t,o){const i=o.tile?o.tile:o;const s=o.srcGroupId?this._getGroupIndex(o.srcGroupId):undefined;const n=o.srcGroupId?this.oModel.getProperty(`/groups/${s}`):i.getParent().getBindingContext().getObject();const r=i.getBindingContext().sPath.split("/");const l=i.getBindingContext().getObject();const d=r[r.length-2];const c=l.uuid;const h=parseInt(r[r.length-1],10);const g=o.toIndex!==undefined?o.toIndex:undefined;const f=this.oModel.getProperty("/tileActionModeActive");const b=o.toGroupId?this._getGroupIndex(o.toGroupId):n.index;const m=o.toGroupId?this.oModel.getProperty(`/groups/${b}`):n;const M=this;const P=this._getIndexForConvert(d,h,g,n,m);const T={tileIndex:h,groupIndex:s,group:n};function G(){l.tileIsBeingMoved=true;const e=this.oPageOperationAdapter.moveTile(l,P,n,m,d==="links"?"tile":"link");e.then(e=>{M._handleAfterSortable((e,t)=>{const i=M._getPathOfTile(e);const s=t.content;if(i){if(d==="tiles"){M._attachLinkPressHandlers(s);M._changeLinkScope(s,f?"Actions":"Display")}if(n===m){_.show(p.i18n.getText("PageRuntime.Message.VisualizationConverted"))}else{_.show(p.i18n.getText("PageRuntime.Message.VisualizationMovedAndConverted"))}const e={tileIndex:g,groupIndex:b,group:m};const i={tile:l,view:s,type:d,tileObj:t.object};l.tileIsBeingMoved=true;M.replaceTileViewAfterConvert(T,e,i);a.emit("updateGroups",Date.now());u.handleTilesVisibility();if(o.callBack){o.callBack(s)}}})(c,e);M._checkRequestQueue()}).catch(()=>{M._handleAfterSortable(M._resetGroupsOnFailure.bind(M))("fail_to_move_tile_msg")})}this._addRequest(G.bind(this))},replaceTileViewAfterConvert:function(e,t,o){const i=o.tile;const s=i.content;i.tileIsBeingMoved=false;i.content=[o.view];i.object=o.tileObj;i.originalTileId=this.oPageOperationAdapter.getTileId(o.tileObj);e.group[o.type].splice(e.tileIndex,1);if(t.tileIndex!==undefined){t.group[o.type==="tiles"?"links":"tiles"].splice(t.tileIndex,0,i)}else{t.group[o.type==="tiles"?"links":"tiles"].push(i)}this.oModel.setProperty(`/groups/${t.groupIndex}`,t.group);this.oModel.setProperty(`/groups/${e.groupIndex}`,e.group);if(o.type==="links"){this._handleTileAppearanceAnimation(i.content[0].getParent())}else{this._handleTileAppearanceAnimation(i.content[0])}if(s&&s[0]){s[0].destroy()}},_getIndexForConvert:function(e,t,o,i,s){let n;if(e==="tiles"){if(o!==undefined){n=s[e].length+o}else{n=s[e].length+s.links.length}if(i.groupId===s.groupId){n--}}else{n=o||i.tiles.length;t+=i.tiles.length}return{tileIndex:t,newTileIndex:n}},_getIndexForMove:function(e,t,o,i,s){let n;if(e==="tiles"){n=o!==undefined?o:i[e].length}else{if(o!==undefined){n=i.tiles.length+o}else{n=i.tiles.length+i.links.length}t+=s.tiles.length}return{tileIndex:t,newTileIndex:n}},_getTileInfo:function(e,t,o){for(let i=0;i<e.length;++i){const s=e[i];for(let e=0;e<s[o].length;++e){const n=s[o][e];if(n.uuid===t){return{oTile:n,tileIndex:e,oGroup:s,groupIndex:i}}}}return},_getNewGroupInfo:function(e,t){for(let o=0;o<e.length;++o){const i=e[o];if(i.groupId===t){return{oNewGroup:i,newGroupIndex:o}}}return},_moveTile:function(e,t,o){let i=o.toIndex;const s=o.toGroupId;const n=o.sTileId;const r=o.source;const l=o.sTileType==="tiles"||o.sTileType==="tile"?"tile":"link";const d=o.sToItems;const c=o.sFromItems;const h=this.oModel.getProperty("/tileActionModeActive");const g=this.oModel.getProperty("/groups");const f=this._getTileInfo(g,n,c);const b=this._getNewGroupInfo(g,s);const m=this;const M=f.tileIndex===b.oNewGroup.tiles.length-1&&i>=b.oNewGroup.tiles.length;if((f.tileIndex===i||M)&&f.oGroup.groupId===b.oNewGroup.groupId){return}if(f.oGroup.groupId===b.oNewGroup.groupId&&(r==="movetileDialog"||i===null||r==="movelinkDialog")){if(o.callBack&&f.oTile&&f.oTile.content&&f.oTile.content.length){o.callBack(f.oTile.content[0])}return}if(l==="link"){f.oTile.content[0].addStyleClass("sapUshellZeroOpacity")}if(l==="tile"&&d==="tiles"){if(i&&i>b.oNewGroup[d].length){i=b.oNewGroup[d].length}}if(f.oGroup.groupId===s&&d===c){if(i===null||i===undefined){f.oGroup[d].splice(f.tileIndex,1);i=f.oGroup[d].length;f.oGroup[d].push(f.oTile)}else{i=this._adjustTileIndex(i,f.oTile,f.oGroup,d);this._moveInArray(f.oGroup[d],f.tileIndex,i)}this.oModel.setProperty(`/groups/${f.groupIndex}/${d}`,f.oGroup[d])}else{const e=this.oModel.getProperty("/personalization");f.oGroup[c].splice(f.tileIndex,1);f.oGroup.visibilityModes=u.calcVisibilityModes(f.oGroup,e);this.oModel.setProperty(`/groups/${f.groupIndex}/${c}`,f.oGroup[c]);if(i===null||i===undefined){i=b.oNewGroup[d].length;b.oNewGroup[d].push(f.oTile)}else{i=this._adjustTileIndex(i,f.oTile,b.oNewGroup,d);b.oNewGroup[d].splice(i,0,f.oTile)}b.oNewGroup.visibilityModes=u.calcVisibilityModes(b.oNewGroup,e);this.oModel.setProperty(`/groups/${b.newGroupIndex}/${d}`,b.oNewGroup[d])}a.emit("updateGroups",Date.now());u.handleTilesVisibility();function P(){const e=this.oModel.getProperty(`/groups/${f.groupIndex}`);const t=this.oModel.getProperty(`/groups/${b.newGroupIndex}`);const s=this._getIndexForMove(c,f.tileIndex,i,b.oNewGroup,e);f.oTile.tileIsBeingMoved=true;this.oPageOperationAdapter.moveTile(f.oTile,s,e,t,l).then(e=>{const t=m._getPathOfTile(n);if(t){m.oModel.setProperty(`${t}/object`,e.object);m.oModel.setProperty(`${t}/originalTileId`,e.originalTileId);const i=m.oModel.getProperty(`${t}/content`);const s=e.content;if(d==="links"){m._changeLinkScope(s,h?"Actions":"Display");m._attachLinkPressHandlers(s);m._handleTileAppearanceAnimation(s);f.oTile.content=[s];m.oModel.setProperty(t,k({},f.oTile));m.oModel.setProperty(`/groups/${b.newGroupIndex}/${d}`,m.oModel.getProperty(`/groups/${b.newGroupIndex}/${d}`))}else{m.oModel.setProperty(`${t}/content`,[s])}if(i&&i[0]){const e=s.onAfterRendering;s.onAfterRendering=function(){e.apply(this);i[0].destroy();s.onAfterRendering=e}}m.oModel.setProperty(`${t}/tileIsBeingMoved`,false);if(o.callBack){o.callBack(s)}_.show(p.i18n.getText("PageRuntime.Message.VisualizationMoved"))}m._checkRequestQueue()}).catch(()=>{m._resetGroupsOnFailure("fail_to_move_tile_msg")})}this._addRequest(P.bind(this))},_adjustTileIndex:function(e,t,o,i){let s=0;let n=false;let r=0;for(r=0;r<o[i].length&&s<e;r++){if(o[i][r].isTileIntentSupported){if(o[i][r]===t){n=true}else{s++}}}if(n){return r-1}return r},getModel:function(){return this.oModel},getDashboardView:function(){return this.oDashboardView},setDashboardView:function(e){this.oDashboardView=e;return this},setTileVisible:function(e,t){this.oPageOperationAdapter.setTileVisible(e.object,t)},refreshTile:function(e){this.oPageOperationAdapter.refreshTile(e.object)},updateSettings:function(e){this.oModel=e.model||this.oModel;this.oConfig=e.config||this.oConfig;this.oRouter=e.router||this.oRouter;this.oDashboardView=e.view||this.oDashboardView},_resetGroupsOnFailure:function(e,t){this._requestFailed();g.showLocalizedError(e,t);this.bStartLoadRemainSegment=false;this.loadPersonalizedGroups();this.oModel.updateBindings(true)},resetGroupsOnFailure:function(){this._resetGroupsOnFailure.apply(this,arguments)},_bindSegment:function(e,t){for(let o=0;o<t.length;o++){const i=t[o];const s=i.index;const n=e[s];if(n){n.isRendered=true;n.tiles=n.tiles.concat(i.tiles);n.links=n.links.concat(i.links)}}return e},createGroupsModelFrame:function(e,t){const o=[];function i(e){const t=k({},e);t.tiles=[];t.pendingLinks=[];t.links=[];return t}for(let s=0;s<e.length;s++){const n=e[s];o[s]=i(n);o[s].isRendered=false;o[s].visibilityModes=u.calcVisibilityModes(n,t)}return o},_splitGroups:function(e,t){let o=[];let i=0;const s=this.oModel.getProperty("/homePageGroupDisplay")==="tabs";const n=this.oModel.getProperty("/personalization");let r=0;const l=500;for(let a=0;a<e.length;a++){const d=e[a];o.push(d);if(!this.segmentsStore.length){i+=this.PagingManager.getGroupHeight(d,t===a,n)}else{r+=d.tiles.length+d.links.length}if(s&&!this.segmentsStore.length&&i>0){o.loadTilesView=true;this.segmentsStore.push(o);o=[];i=0}if(i>=1||r>=l){this.segmentsStore.push(o);o=[];i=0;r=0}}if(o.length){this.segmentsStore.push(o)}},_processSegment:function(e){const t=this.segmentsStore.shift();if(!t){return e}if(this.isBlindLoading()===false){if(this.oModel.getProperty("/homePageGroupDisplay")!=="tabs"||t.loadTilesView){this.getSegmentContentViews(t)}}e=this._bindSegment(e,t);return e},getSegmentContentViews:function(e){let t;let o;for(let i=0;i<e.length;i++){const s=e[i];for(t=0;t<s.tiles.length;t++){o=s.tiles[t];if(o.isTileIntentSupported){this.getTileView(o)}}for(t=0;t<s.links.length;t++){o=s.links[t];if(o.isTileIntentSupported){this.getTileView(o,s.index)}}}this.bIsFirstSegmentViewLoaded=true},getSegmentTabContentViews:function(e,t,o){let i;let s;const n=o.iSelectedGroup;const r=this.oModel.getProperty(`/groups/${n}`);for(i=0;i<r.tiles.length;i++){s=r.tiles[i];if(s.isTileIntentSupported){this.getTileView(s)}}for(i=0;i<r.links.length;i++){s=r.links[i];if(s.isTileIntentSupported){this.getTileView(s,n)}}},_handleBookmarkModelUpdate:function(){this.bIsGroupsModelDirty=false;this.bGroupsModelLoadingInProcess=true;this.loadPersonalizedGroups()},_modelLoaded:function(){this.bGroupsModelLoadingInProcess=false;if(this.bIsGroupsModelDirty){this._handleBookmarkModelUpdate()}},handleFirstSegmentLoaded:function(){const e=this.oModel.getProperty("/groups");if(this.aGroupsFrame){Array.prototype.push.apply(e,this.aGroupsFrame);this.aGroupsFrame=null}this._initializeAnchorNavigationBar();if(!this.bStartLoadRemainSegment){this._processRemainingSegments()}},_initializeAnchorNavigationBar:function(){const e=V.getDashboardView();const t=e.getAnchorItemTemplate();this.oDashboardView.oAnchorNavigationBar.bindAggregation("groups",{path:"/groups",template:t})},_processRemainingSegments:function(){let t;if(this.segmentsStore.length>0){window.setTimeout(()=>{t=this._processSegment(this.oModel.getProperty("/groups"));this.oModel.setProperty("/groups",t);this.bIsFirstSegment=false;this._processRemainingSegments()},0)}else{this.bIsGroupsModelLoading=false;this._updateModelWithTileView(0,0);u.handleTilesVisibility();e.getEventBus().publish("launchpad","dashboardModelContentLoaded");a.emit("updateGroups",Date.now())}},tabsModeVisibilityChanged:function(){if(this.bIsFirstSegmentViewLoaded===false&&this.oModel.getProperty("/homePageGroupDisplay")==="tabs"){this.oDashboardLoadingManager.manageTilesView();this.bIsFirstSegmentViewLoaded=true;a.emit("firstSegmentCompleteLoaded",true)}},_setGroupModel:function(e){if(this.bIsGroupsModelLoading){I.info("Skip set the group model, because the group model is still loading");return}let t=0;let o;let i=0;let s=0;let n=0;let l=null;let d=[];this.bIsGroupsModelLoading=true;try{i=this.oModel.getProperty("/groups").length}catch{}for(t=e.length;t<i;++t){c.destroyFLPAggregationModel(this.oModel.getProperty(`/groups/${t}`))}if(!this.PagingManager){let e=jQuery("#dashboardGroups").width();if(!e){e=window.innerWidth}let t=jQuery("#sapUshellDashboardPage-cont").height();if(t<100){t=window.innerHeight}this.PagingManager=new r("dashboardPaging",{supportedElements:{tile:{className:"sapUshellTile"},link:{className:"sapUshellLinkTile"}},containerHeight:t,containerWidth:e})}e.forEach(e=>{if(e.isGroupVisible){s+=e.tiles.length}});this.bIsScrollModeAccordingKPI=s>this.iMinNumOfTilesForBlindLoading;this.aGroupsFrame=this.createGroupsModelFrame(e,this.oModel.getProperty("/personalization"));for(t=0;t<this.aGroupsFrame.length;t++){if(this.aGroupsFrame[t].isGroupVisible&&this.aGroupsFrame[t].visibilityModes[0]){if(l===null){l=t;this.aGroupsFrame[t].isGroupSelected=true;this.oModel.setProperty("/iSelectedGroup",t)}n++;if(n>1){this.aGroupsFrame[l].showGroupHeader=false;break}}}this._splitGroups(e,l);const p=this.segmentsStore[0]?this.segmentsStore[0].length:0;const h=this.aGroupsFrame.splice(0,p);w.start("FLP:DashboardManager._processSegment","_processSegment","FLP");d=this._processSegment(h);e.every((e,t)=>{if(e.isDefaultGroup){o=t;return false}return true});d.indexOfDefaultGroup=o;if(this.oModel.getProperty("/homePageGroupDisplay")==="tabs"){const e=this.getDashboardView();if(e){const t=e.oDashboardGroupsBox;const o=t.getBinding("groups");if(o){o.filter([e.oFilterSelectedGroup])}}}w.end("FLP:DashboardManager._processSegment");this.oModel.setProperty("/groups",d);this.aGroupModel=d;if(this.oDashboardView){a.once("firstSegmentCompleteLoaded").do(()=>{u.setPerformanceMark("FLP-TTI-Homepage",{bUseUniqueMark:true})}).do(this.handleFirstSegmentLoaded.bind(this))}else{setTimeout(()=>{Array.prototype.push.apply(this.aGroupModel,this.aGroupsFrame);this.aGroupsFrame=null;this.bStartLoadRemainSegment=true;this._processRemainingSegments()},0)}if(!this.bIsFirstSegmentViewLoaded&&this.isBlindLoading()){this.bIsFirstSegmentViewLoaded=!this._isAtLeastOneTileVisibleInASegment(h)}if(this.bIsFirstSegmentViewLoaded){a.emit("firstSegmentCompleteLoaded",true)}w.end("FLP:DashboardManager.loadGroupsFromArray")},_isAtLeastOneTileVisibleInASegment:function(e){let t;let o;for(let i=0;i<e.length;++i){t=e[i];for(let e=0;e<t.tiles.length;++e){o=t.tiles[e];if(o.isTileIntentSupported){return true}}}return false},getPreparedGroupModel:function(){return this.aGroupModel},_loadGroup:function(e,t){const o=this;const i=`/groups/${e}`;const s=o.oModel.getProperty(i);const n=s.isLastGroup;const r=s.groupId;c.destroyFLPAggregationModel(s);if(r){t.groupId=r}t.isLastGroup=n;t.index=e;t.isRendered=true;this.oModel.setProperty(i,t)},_hasPendingLinks:function(e){for(let t=0;t<e.length;t++){if(e[t].content[0]===undefined){return true}}return false},_addModelToTileViewUpdateQueue:function(e,t){this.tileViewUpdateQueue.push({uuid:e,view:t})},_updateModelWithTileView:function(e,t){const o=this;if(this.tileViewUpdateTimeoutID){clearTimeout(this.tileViewUpdateTimeoutID)}this.tileViewUpdateTimeoutID=window.setTimeout(()=>{o.tileViewUpdateTimeoutID=undefined;o.oSortableDeferred.done(()=>{o._updateModelWithTilesViews(e,t)})},50)},_updateGroupModelWithTilesViews:function(e,t,o,i){const s=t||0;for(let t=s;t<e.length;t=t+1){const s=e[t];for(let e=0;e<this.tileViewUpdateQueue.length;e++){const t=this.tileViewUpdateQueue[e];if(s.uuid===t.uuid){o.push(e);if(t.view){if(i){s.content=[t.view]}else{s.content[0].destroy();s.content=[t.view]}this.oDashboardLoadingManager.setTileResolved(s);const e=this.oPageOperationAdapter.getTileSize(s.object);const o=e!==null&&e==="1x2"||false;if(s.long!==o){s.long=o}}else{s.content[0].setState("Failed")}break}}}},_updateModelWithTilesViews:function(e,t){const o=this.oModel.getProperty("/groups");const i=e||0;const s=[];if(!o||this.tileViewUpdateQueue.length===0){return}for(let e=i;e<o.length;e=e+1){this._updateGroupModelWithTilesViews(o[e].tiles,t,s);if(o[e].links){this._updateGroupModelWithTilesViews(o[e].links,t,s,true);if(o[e].pendingLinks.length>0){if(!o[e].links){o[e].links=[]}o[e].links=o[e].links.concat(o[e].pendingLinks);o[e].pendingLinks=[]}}}const n=[];let r;for(r=0;r<this.tileViewUpdateQueue.length;r++){if(s.indexOf(r)===-1){n.push(this.tileViewUpdateQueue[r])}}this.tileViewUpdateQueue=n;this.oModel.setProperty("/groups",o)},getModelTileById:function(e,t){const o=this.oModel.getProperty("/groups");let i;let s=false;o.every(o=>{o[t].every(t=>{if(t.uuid===e||t.originalTileId===e){i=t;s=true}return!s});return!s});return i},_attachLinkPressHandlers:function(t){const o=e.getEventBus();const i=t.attachPress?t:t.getContent()[0];i.attachPress(function(e){const i=t.getBindingContext().getObject().tileIsBeingMoved;if(!i&&this.getScope&&this.getScope()==="Actions"){switch(e.getParameters().action){case"Press":const i=t.getState?t.getState():"";if(i!=="Failed"){const t=sap.ui.require("sap/ushell/components/homepage/ActionMode");if(t){t._openActionsMenu(e)}else{I.error("Race condition occurred! - sap/ushell/components/homepage/ActionMode was not required in time.")}}break;case"Remove":const s=t.getBindingContext().getObject().uuid;o.publish("launchpad","deleteTile",{tileId:s,items:"links"});break;default:break}}else{o.publish("launchpad","dashboardTileLinkClick")}})},handleDisplayModeChange:function(e){this.oModel.setProperty("/homePageGroupDisplay",e);switch(e){case"scroll":this._handleDisplayModeChangeToScroll();break;case"tabs":this._handleDisplayModeChangeToTabs();break}},_handleDisplayModeChangeToTabs:function(){const e=this.oModel.getProperty("/iSelectedGroup");const t=this.oModel.getProperty("/groups");this.oDashboardLoadingManager.manageTilesView();if(t.length>0){for(let e=0;e<t.length;e++){this.oModel.setProperty(`/groups/${e}/isGroupSelected`,false)}this.oModel.setProperty(`/groups/${e}/isGroupSelected`,true)}},_handleDisplayModeChangeToScroll:function(){if(this.isBlindLoading()){return}const t=this.oModel.getProperty("/groups");let o=[];let i;for(let e=0;e<t.length;e++){const s=t[e];const n=s.tiles||[];for(i=0;i<n.length;i++){const t=n[i];if(t.content.length===0){this.getTileView(t,e)}}o=s.links||[];for(i=0;i<o.length;i++){this.getTileView(o[i],e)}}this.oModel.refresh(false);const s=this.oModel.getProperty("/iSelectedGroup");if(s){setTimeout(()=>{e.getEventBus().publish("launchpad","scrollToGroup",{groupId:t[s].groupId})},100)}},getTileViewsFromArray:function(e){const t=this;if(e.length===0){return}e.forEach(e=>{t.getTileView(e.oTile,e.iGroup)});this.oModel.refresh(false);if(this.bIsFirstSegmentViewLoaded===false){this.bIsFirstSegmentViewLoaded=true;a.emit("firstSegmentCompleteLoaded",true)}},getTileView:function(e,t){const o=this.oPageOperationAdapter.getTileType(e.object);if(this.oDashboardLoadingManager.isTileViewRequestIssued(e)){return}this.oDashboardLoadingManager.setTileInProgress(e);this.oPageOperationAdapter.setTileVisible(e.object,false);if(o==="card"){this._loadCardData(e)}else{this._loadTileData(e,t,o)}},_loadCardData:function(t){const o=e.byId(t.controlId);if(o&&o.setManifest&&this.isBlindLoading()){o.setManifest(t.manifest)}t.content=[t.manifest];this.oDashboardLoadingManager.setTileResolved(t)},getCurrentHiddenGroupIds:function(e){return this.oPageOperationAdapter.getCurrentHiddenGroupIds(e)},_loadTileData:function(e,t,o){const i=this;const s=this.oPageOperationAdapter.getTileView(e);let r;const l=this._addModelToTileViewUpdateQueue;let a;let d=false;const u=e.uuid;let p=false;if(s.state()==="resolved"){p=true}s.done(o=>{if(o.oController&&o.oController.navigationTargetUrl&&!e.isCustomTile){e.target=o.oController.navigationTargetUrl}a=o;if(a.getComponentInstance){w.average("FLP:getComponentInstance","get info for navMode","FLP1");const t=a.getComponentInstance().getComponentData();if(t&&t.properties){e.navigationMode=t.properties.navigationMode}w.end("FLP:getComponentInstance")}i.oDashboardLoadingManager.setTileResolved(e);const s=o.getMode?o.getMode():"ContentMode";if(i.bLinkPersonalizationSupported&&s==="LineMode"){a.setScope(i.oModel.getProperty("/tileActionModeActive")?"Actions":"Display");i._attachLinkPressHandlers(a);if(t>=0){const o=i.oModel.getProperty("/groups");if(o[t]){e.content=[a];r=i.oModel.getProperty(`/groups/${t}/links`);i.oModel.setProperty(`/groups/${t}/links`,[]);i.oModel.setProperty(`/groups/${t}/links`,r)}}}else if(i.isBlindLoading()){if(e.content&&e.content.length>0){e.content[0].destroy()}e.content=[a];if(t>=0&&!p){i.oModel.refresh(false)}}if(i.isBlindLoading()){const t=i.oPageOperationAdapter.getTileSize(e.object);const o=t==="1x2";if(e.long!==o){e.long=o;i.oModel.refresh(false)}}else if(s==="LineMode"){e.content=[a];if(d){r=i.oModel.getProperty(`/groups/${t}/links`);i.oModel.setProperty(`/groups/${t}/links`,[]);i.oModel.setProperty(`/groups/${t}/links`,r)}}else if(e.content.length===0){e.content=[a]}else{l.apply(i,[u,a]);i._updateModelWithTileView(0,0)}});s.fail(()=>{if(i.oPageOperationAdapter.getTileType(e.object)==="link"&&i.bLinkPersonalizationSupported){a=i.oPageOperationAdapter.getFailedLinkView(e);i._attachLinkPressHandlers(a)}else{a=new n({state:"Failed"})}e.content=[a]});if(!a){if(i.oPageOperationAdapter.getTileType(e.object)==="link"){d=true;a=new f({mode:"LineMode"})}else{a=new n}e.content=[a]}},loadLibraryForCardModuleIfNeeded:function(){if(L.last("/core/home/featuredGroup/enable")){return e.loadLibrary("sap.ui.integration",{async:true})}return Promise.resolve()},loadPersonalizedGroups:function(){const e=this;const t=new jQuery.Deferred;if(this.bIsGroupsRequestPending){I.info("loadPersonalizedGroups was skipped because there is already a pending request.");t.reject(new Error("loadPersonalizedGroups was skipped because there is already a pending request."));return t.promise()}this.bIsGroupsRequestPending=true;this.oServiceLoadingPromise.then(e.loadLibraryForCardModuleIfNeeded).then(()=>e.oPageOperationAdapter.getPage()).then(o=>{e._setGroupModel(o);e.bIsGroupsRequestPending=false;t.resolve()}).catch(t=>{I.error("Loading of personalized groups failed.",t,"sap.ushell.components.HomepageManager");g.showLocalizedError("fail_to_load_groups_msg");e.bIsGroupsRequestPending=false});w.start("FLP:DashboardManager.loadPersonalizedGroups","loadPersonalizedGroups","FLP");return t.promise()}});x.prototype.getInstance=function(){return V};return x});
//# sourceMappingURL=HomepageManager.js.map