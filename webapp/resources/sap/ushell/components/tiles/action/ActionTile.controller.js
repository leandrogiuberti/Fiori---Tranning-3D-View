// Copyright (c) 2009-2025 SAP SE, All Rights Reserved
sap.ui.define(["sap/ui/core/mvc/Controller","sap/ushell/components/tiles/utils","sap/ui/model/json/JSONModel","sap/ui/thirdparty/jquery","sap/base/Log","sap/ushell/utils/LaunchpadError"],(t,e,i,jQuery,o,n)=>{"use strict";return t.extend("sap.ushell.components.tiles.action.ActionTile",{onInit:function(){const t=this.getView();const o=t.getViewData();const n=e.getResourceBundleModel();const r=o.chip;const a=e.getActionConfiguration(r);const s=this;function c(t,i){const o=e.getResourceBundle();const n=`${o.getText("configuration.semantic_object")}:\n${t}\n\n${o.getText("configuration.semantic_action")}:\n${i}`;return n}t.setModel(n,"i18n");const g=new i({config:a,displayText:c(a.semantic_object,a.semantic_action)});t.setModel(g);if(r.configurationUi.isEnabled()){r.configurationUi.setAsyncUiProvider(()=>e.getConfigurationUi(s.getView(),"sap.ushell.components.tiles.action.Configuration").then(t=>{r.configurationUi.attachCancel(s.onCancelConfiguration.bind(null,t));r.configurationUi.attachSave(s.onSaveConfiguration.bind(null,t,c));return t}));t.byId("actionTile").setTooltip(e.getResourceBundle().getText("edit_configuration.tooltip"))}},onPress:function(t){const e=this.getView().getViewData().chip;if(e.configurationUi.isEnabled()){e.configurationUi.display()}},onSaveConfiguration:function(t,r){const a=jQuery.Deferred();let s=t.getModel();const c=s.getProperty("/tileModel");const g=t.getViewData().chip;const l=e.checkTMInputOnSaveConfig(t);if(l){a.reject(new Error("mandatory_fields_missing"));return a.promise()}const p=e.getResourceBundle();if(e.tableHasDuplicateParameterNames(s.getProperty("/config/rows"))){a.reject(new Error(p.getText("configuration.signature.uniqueParamMessage.text")))}else if(!e.tableHasInvalidSapPrelaunchOperationValue(s.getProperty("/config/rows"))){const t=JSON.stringify([{type:"split",source:"p1",target:["p2","p3"]},{type:"merge",source:["p4","p5"],target:"p6"}]);a.reject(new Error(p.getText("configuration.signature.invalidSapPrelaunchOperationsMessage.text",[t])))}else{const l=s.getProperty("/config/formFactorConfigDefault")?undefined:e.buildFormFactorsObject(s);const p=e.getMappingSignatureString(s.getProperty("/config/rows"),s.getProperty("/config/isUnknownAllowed"));const u=e.getMappingSignature(s.getProperty("/config/rows"),s.getProperty("/config/isUnknownAllowed"));const f={semantic_object:(s.getProperty("/config/semantic_object")||"").trim(),semantic_action:(s.getProperty("/config/semantic_action")||"").trim(),display_title_text:(s.getProperty("/config/display_title_text")||"").trim(),url:(s.getProperty("/config/url")||"").trim(),ui5_component:(s.getProperty("/config/ui5_component")||"").trim(),navigation_provider:(s.getProperty("/config/navigation_provider")||"").trim(),navigation_provider_role:(s.getProperty("/config/navigation_provider_role")||"").trim(),navigation_provider_instance:(s.getProperty("/config/navigation_provider_instance")||"").trim(),target_application_id:(s.getProperty("/config/target_application_id")||"").trim(),target_application_alias:(s.getProperty("/config/target_application_alias")||"").trim(),transaction:{code:(s.getProperty("/config/transaction/code")||"").trim()},web_dynpro:{application:(s.getProperty("/config/web_dynpro/application")||"").trim(),configuration:(s.getProperty("/config/web_dynpro/configuration")||"").trim()},target_system_alias:(s.getProperty("/config/target_system_alias")||"").trim(),display_info_text:(s.getProperty("/config/display_info_text")||"").trim(),form_factors:l,mapping_signature:p,signature:u};const d=g.bag.getBag("tileProperties");d.setText("display_title_text",f.display_title_text);g.writeConfiguration.setParameterValues({tileConfiguration:JSON.stringify(f)},()=>{const l=e.getActionConfiguration(g,false);const p=e.getActionConfiguration(g,true);s=new i({config:l,tileModel:c});t.setModel(s);c.setData({config:p,displayText:r(p.semantic_object,p.semantic_action)},false);d.save(()=>{o.debug("property bag 'tileProperties' saved successfully");a.resolve()},(t,e)=>{const i=Object.keys(t)[0];const r=new n(`Bag save failed: ${t[i]}`,{info:e[i],otherMessages:t,otherInfo:e});o.error("property bag 'tileProperties' save failed",r,"sap.ushell.components.tiles.action.ActionTile.controller");a.reject(r)})},t=>{o.error(`property bag 'tileProperties' save failed: ${t}`,null,"sap.ushell.components.tiles.action.ActionTile.controller");a.reject(new Error(t))})}return a.promise()},onCancelConfiguration:function(t){const i=t.getViewData();const o=t.getModel();const n=o.getProperty("/tileModel");const r=i.chip;const a=e.getActionConfiguration(r,false);t.getModel().setData({config:a,tileModel:n},false)}})});
//# sourceMappingURL=ActionTile.controller.js.map