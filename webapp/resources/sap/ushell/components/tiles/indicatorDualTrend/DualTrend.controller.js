// Copyright (c) 2009-2025 SAP SE, All Rights Reserved
sap.ui.define(["sap/ui/model/json/JSONModel","sap/suite/ui/microchart/AreaMicroChartPoint","sap/suite/ui/microchart/AreaMicroChartItem","sap/m/library","sap/ui/thirdparty/jquery"],(e,i,t,l,jQuery)=>{"use strict";const a=l.Size;const s=l.ValueColor;const r=l.DeviationIndicator;const o=l.LoadState;sap.ui.controller("tiles.indicatorDualTrend.DualTrend",{logError:function(e){this.oDualTrendView.oGenericTile.setState(o.Failed);this.oDualTrendView.oGenericTile.setState(o.Failed);sap.ushell.components.tiles.indicatorTileUtils.util.logError(e)},formSelectStatement:function(e){const i=Object.keys(e);let t="";for(let l=0;l<i.length;l++){if(e[i[l]]!==undefined&&e.fullyFormedMeasure){t+=`,${e[i[l]]}`}}return t},setThresholdValues:function(){const e=this;try{const i={};i.fullyFormedMeasure=this.DEFINITION_DATA.EVALUATION.COLUMN_NAME;if(this.DEFINITION_DATA.EVALUATION.VALUES_SOURCE=="MEASURE"){switch(this.DEFINITION_DATA.EVALUATION.GOAL_TYPE){case"MI":i.sWarningHigh=sap.ushell.components.tiles.indicatorTileUtils.util.getEvalValueMeasureName(e.oConfig,"WH","MEASURE");i.sCriticalHigh=sap.ushell.components.tiles.indicatorTileUtils.util.getEvalValueMeasureName(e.oConfig,"CH","MEASURE");i.sTarget=sap.ushell.components.tiles.indicatorTileUtils.util.getEvalValueMeasureName(e.oConfig,"TA","MEASURE");i.sTrend=sap.ushell.components.tiles.indicatorTileUtils.util.getEvalValueMeasureName(e.oConfig,"TC","MEASURE");i.fullyFormedMeasure+=e.formSelectStatement(i);break;case"MA":i.sWarningLow=sap.ushell.components.tiles.indicatorTileUtils.util.getEvalValueMeasureName(e.oConfig,"WL","MEASURE");i.sCriticalLow=sap.ushell.components.tiles.indicatorTileUtils.util.getEvalValueMeasureName(e.oConfig,"CL","MEASURE");i.sTarget=sap.ushell.components.tiles.indicatorTileUtils.util.getEvalValueMeasureName(e.oConfig,"TA","MEASURE");i.sTrend=sap.ushell.components.tiles.indicatorTileUtils.util.getEvalValueMeasureName(e.oConfig,"TC","MEASURE");i.fullyFormedMeasure+=e.formSelectStatement(i);break;case"RA":i.sWarningHigh=sap.ushell.components.tiles.indicatorTileUtils.util.getEvalValueMeasureName(e.oConfig,"WH","MEASURE");i.sCriticalHigh=sap.ushell.components.tiles.indicatorTileUtils.util.getEvalValueMeasureName(e.oConfig,"CH","MEASURE");i.sTarget=sap.ushell.components.tiles.indicatorTileUtils.util.getEvalValueMeasureName(e.oConfig,"TA","MEASURE");i.sTrend=sap.ushell.components.tiles.indicatorTileUtils.util.getEvalValueMeasureName(e.oConfig,"TC","MEASURE");i.sWarningLow=sap.ushell.components.tiles.indicatorTileUtils.util.getEvalValueMeasureName(e.oConfig,"WL","MEASURE");i.sCriticalLow=sap.ushell.components.tiles.indicatorTileUtils.util.getEvalValueMeasureName(e.oConfig,"CL","MEASURE");i.fullyFormedMeasure+=e.formSelectStatement(i);break}}else{i.criticalHighValue=sap.ushell.components.tiles.indicatorTileUtils.util.getEvalValueMeasureName(e.oConfig,"CH","FIXED");i.criticalLowValue=sap.ushell.components.tiles.indicatorTileUtils.util.getEvalValueMeasureName(e.oConfig,"CL","FIXED");i.warningHighValue=sap.ushell.components.tiles.indicatorTileUtils.util.getEvalValueMeasureName(e.oConfig,"WH","FIXED");i.warningLowValue=sap.ushell.components.tiles.indicatorTileUtils.util.getEvalValueMeasureName(e.oConfig,"WL","FIXED");i.targetValue=sap.ushell.components.tiles.indicatorTileUtils.util.getEvalValueMeasureName(e.oConfig,"TA","FIXED");i.trendValue=sap.ushell.components.tiles.indicatorTileUtils.util.getEvalValueMeasureName(e.oConfig,"TC","FIXED")}return i}catch(i){e.logError(i)}},getTrendIndicator:function(e,i){const t=this;e=Number(e);try{let t=r.None;if(e>i){t=r.Down}else if(e<i){t=r.Up}return t}catch(e){t.logError(e)}},getTile:function(){return this.oDualTrendView.oGenericTile},getTrendColor:function(e){const i=this;try{const i=this.DEFINITION_DATA.EVALUATION.GOAL_TYPE;let t=s.Neutral;if(i==="MI"){if(e.criticalHighValue&&e.warningHighValue){e.criticalHighValue=Number(e.criticalHighValue);e.warningHighValue=Number(e.warningHighValue);if(this.CALCULATED_KPI_VALUE<e.warningHighValue){t=s.Good}else if(this.CALCULATED_KPI_VALUE<=e.criticalHighValue){t=s.Critical}else{t=s.Error}}}else if(i==="MA"){if(e.criticalLowValue&&e.warningLowValue){e.criticalLowValue=Number(e.criticalLowValue);e.warningLowValue=Number(e.warningLowValue);if(this.CALCULATED_KPI_VALUE<e.criticalLowValue){t=s.Error}else if(this.CALCULATED_KPI_VALUE<=e.warningLowValue){t=s.Critical}else{t=s.Good}}}else if(e.warningLowValue&&e.warningHighValue&&e.criticalLowValue&&e.criticalHighValue){e.criticalHighValue=Number(e.criticalHighValue);e.warningHighValue=Number(e.warningHighValue);e.warningLowValue=Number(e.warningLowValue);e.criticalLowValue=Number(e.criticalLowValue);if(this.CALCULATED_KPI_VALUE<e.criticalLowValue||this.CALCULATED_KPI_VALUE>e.criticalHighValue){t=s.Error}else if(this.CALCULATED_KPI_VALUE>=e.criticalLowValue&&this.CALCULATED_KPI_VALUE<=e.warningLowValue||this.CALCULATED_KPI_VALUE>=e.warningHighValue&&this.CALCULATED_KPI_VALUE<=e.criticalHighValue){t=s.Critical}else{t=s.Good}}return t}catch(e){i.logError(e)}},_updateTileModel:function(e){const i=this.getTile().getModel().getData();jQuery.extend(i,e);this.getTile().getModel().setData(i)},onAfterFinalEvaluation:function(){const e=this;const l=this.DEFINITION_DATA.EVALUATION.ODATA_URL;const a=this.DEFINITION_DATA.EVALUATION.ODATA_ENTITYSET;const s=this.DEFINITION_DATA.EVALUATION.COLUMN_NAME;let r=sap.ushell.components.tiles.indicatorTileUtils.util.prepareFilterStructure(this.DEFINITION_DATA.EVALUATION_FILTERS,this.DEFINITION_DATA.ADDITIONAL_FILTERS);let n=this.DEFINITION_DATA.TILE_PROPERTIES.dimension;if(n==undefined){this.logError();return}const u=this.DEFINITION_DATA.EVALUATION.GOAL_TYPE;const c=this.DEFINITION_DATA.EVALUATION_VALUES;let T;if(this.DEFINITION_DATA.EVALUATION.VALUES_SOURCE=="MEASURE"){let i=s;switch(u){case"MI":e.sWarningHigh=sap.ushell.components.tiles.indicatorTileUtils.util.getEvalValueMeasureName(e.oConfig,"WH","MEASURE");e.sCriticalHigh=sap.ushell.components.tiles.indicatorTileUtils.util.getEvalValueMeasureName(e.oConfig,"CH","MEASURE");e.sTarget=sap.ushell.components.tiles.indicatorTileUtils.util.getEvalValueMeasureName(e.oConfig,"TA","MEASURE");e.sTrend=sap.ushell.components.tiles.indicatorTileUtils.util.getEvalValueMeasureName(e.oConfig,"TC","MEASURE");if(e.sWarningHigh&&e.sCriticalHigh&&e.sTarget){i+=`,${e.sWarningHigh},${e.sCriticalHigh},${e.sTarget}`}break;case"MA":e.sWarningLow=sap.ushell.components.tiles.indicatorTileUtils.util.getEvalValueMeasureName(e.oConfig,"WL","MEASURE");e.sCriticalLow=sap.ushell.components.tiles.indicatorTileUtils.util.getEvalValueMeasureName(e.oConfig,"CL","MEASURE");e.sTarget=sap.ushell.components.tiles.indicatorTileUtils.util.getEvalValueMeasureName(e.oConfig,"TA","MEASURE");e.sTrend=sap.ushell.components.tiles.indicatorTileUtils.util.getEvalValueMeasureName(e.oConfig,"TC","MEASURE");if(e.sWarningLow&&e.sCriticalLow&&e.sTarget){i+=`,${e.sWarningLow},${e.sCriticalLow},${e.sTarget}`}break;case"RA":e.sWarningHigh=sap.ushell.components.tiles.indicatorTileUtils.util.getEvalValueMeasureName(e.oConfig,"WH","MEASURE");e.sCriticalHigh=sap.ushell.components.tiles.indicatorTileUtils.util.getEvalValueMeasureName(e.oConfig,"CH","MEASURE");e.sTarget=sap.ushell.components.tiles.indicatorTileUtils.util.getEvalValueMeasureName(e.oConfig,"TA","MEASURE");e.sTrend=sap.ushell.components.tiles.indicatorTileUtils.util.getEvalValueMeasureName(e.oConfig,"TC","MEASURE");e.sWarningLow=sap.ushell.components.tiles.indicatorTileUtils.util.getEvalValueMeasureName(e.oConfig,"WL","MEASURE");e.sCriticalLow=sap.ushell.components.tiles.indicatorTileUtils.util.getEvalValueMeasureName(e.oConfig,"CL","MEASURE");if(e.sWarningLow&&e.sCriticalLow&&e.sTarget&&e.sWarningHigh&&e.sCriticalHigh){i+=`,${e.sWarningLow},${e.sCriticalLow},${e.sTarget},${e.sWarningHigh},${e.sCriticalHigh}`}break}T=sap.ushell.components.tiles.indicatorTileUtils.util.prepareQueryServiceUri(e.oTileApi.url.addSystemToServiceUrl(l),a,i,n,r)}else{T=sap.ushell.components.tiles.indicatorTileUtils.util.prepareQueryServiceUri(e.oTileApi.url.addSystemToServiceUrl(l),a,s,n,r)}const h=sap.ushell.components.tiles.indicatorTileUtils.cache.getKpivalueById(e.oConfig.TILE_PROPERTIES.id);function E(l,a){const r=[];const o=[];const T=[];const h=[];const E=[];const g=[];let d=l.firstXlabel;let A;let f;let m;let L;let C;let N=l.lastXlabel;const p=Number(l.results[0][s]);const I=Number(l.results[l.results.length-1][s]);let U;for(U in l.results){l.results[U][n]=Number(U);l.results[U][s]=Number(l.results[U][s]);if(e.sWarningHigh){l.results[U][e.sWarningHigh]=Number(l.results[U][e.sWarningHigh])}if(e.sCriticalHigh){l.results[U][e.sCriticalHigh]=Number(l.results[U][e.sCriticalHigh])}if(e.sCriticalLow){l.results[U][e.sCriticalLow]=Number(l.results[U][e.sCriticalLow])}if(e.sWarningLow){l.results[U][e.sWarningLow]=Number(l.results[U][e.sWarningLow])}if(e.sTarget){l.results[U][e.sTarget]=Number(l.results[U][e.sTarget])}if(e.sWarningHigh){T.push(l.results[U][e.sWarningHigh])}if(e.sCriticalHigh){h.push(l.results[U][e.sCriticalHigh])}if(e.sCriticalLow){E.push(l.results[U][e.sCriticalLow])}if(e.sWarningLow){g.push(l.results[U][e.sWarningLow])}r.push(l.results[U][n]);o.push(l.results[U][s])}try{d=sap.ushell.components.tiles.indicatorTileUtils.util.formatOdataObjectToString(d);N=sap.ushell.components.tiles.indicatorTileUtils.util.formatOdataObjectToString(N)}catch(i){e.logError(i)}let V=Number(p);if(e.oConfig.EVALUATION.SCALING==-2){V*=100}const w=Math.min.apply(Math,o);let M=sap.ushell.components.tiles.indicatorTileUtils.util.getLocaleFormattedValue(V,e.oConfig.EVALUATION.SCALING,e.oConfig.EVALUATION.DECIMAL_PRECISION);if(e.oConfig.EVALUATION.SCALING==-2){M+=" %"}const S=M.toString();let D=Number(I);if(e.oConfig.EVALUATION.SCALING==-2){D*=100}const b=Math.max.apply(Math,o);let R=sap.ushell.components.tiles.indicatorTileUtils.util.getLocaleFormattedValue(D,e.oConfig.EVALUATION.SCALING,e.oConfig.EVALUATION.DECIMAL_PRECISION);if(e.oConfig.EVALUATION.SCALING==-2){R+=" %"}const O=R.toString();let H;let _;try{H=sap.ushell.components.tiles.indicatorTileUtils.util.formatOdataObjectToString(Math.min.apply(Math,r));_=sap.ushell.components.tiles.indicatorTileUtils.util.formatOdataObjectToString(Math.max.apply(Math,r))}catch(i){e.logError(i)}if(a=="MEASURE"){if(T.length!=0){e.firstwH=T[H];e.lastwH=T[_]}if(h.length!=0){e.firstcH=h[H];e.lastcH=h[_]}if(E.length!=0){e.firstcL=E[H];e.lastcL=E[_]}if(g.length!=0){e.firstwL=g[H];e.lastwL=g[_]}}const F={width:"100%",height:"100%",unit:e.unit||"",chart:{color:"Neutral",data:l.results},size:"Auto",minXValue:H,maxXValue:_,minYValue:w,maxYValue:b,firstXLabel:{label:`${d}`,color:"Neutral"},lastXLabel:{label:`${N}`,color:"Neutral"},firstYLabel:{label:`${S}`,color:"Neutral"},lastYLabel:{label:`${O}`,color:"Neutral"},minLabel:{},maxLabel:{}};let v;switch(u){case"MA":for(U in c){if(c[U].TYPE=="CL"){F.minThreshold={color:"Error"};v={};v[n]="";v[s]=Number(c[U].FIXED);e.cl=Number(c[U].FIXED);F.minThreshold.data=a=="MEASURE"?l.results:[v];A=a=="MEASURE"?e.sCriticalLow:s}else if(c[U].TYPE=="WL"){F.maxThreshold={color:"Good"};v={};v[n]="";v[s]=Number(c[U].FIXED);F.maxThreshold.data=a=="MEASURE"?l.results:[v];f=a=="MEASURE"?e.sWarningLow:s;e.wl=Number(c[U].FIXED)}else if(c[U].TYPE=="TA"){v={};v[n]="";v[s]=Number(c[U].FIXED);F.target={color:"Neutral"};F.target.data=a=="MEASURE"?l.results:[v];C=a=="MEASURE"?e.sTarget:s}}F.innerMinThreshold={data:[]};F.innerMaxThreshold={data:[]};if(a=="FIXED"){F.firstYLabel.color=p<e.cl?"Error":e.cl<=p&&p<=e.wl?"Critical":p>e.wl?"Good":"Neutral";F.lastYLabel.color=I<e.cl?"Error":e.cl<=I&&I<=e.wl?"Critical":I>e.wl?"Good":"Neutral"}else if(a=="MEASURE"&&e.firstwL&&e.lastwL&&e.firstcL&&e.lastcL){F.firstYLabel.color=p<e.firstcL?"Error":e.firstcL<=p&&p<=e.firstwL?"Critical":p>e.firstwL?"Good":"Neutral";F.lastYLabel.color=I<e.lastcL?"Error":e.lastcL<=I&&I<=e.lastwL?"Critical":I>e.lastwL?"Good":"Neutral"}break;case"MI":for(U in c){if(c[U].TYPE=="CH"){v={};v[n]="";v[s]=Number(c[U].FIXED);e.ch=Number(c[U].FIXED);F.maxThreshold={color:"Error"};F.maxThreshold.data=a=="MEASURE"?l.results:[v];f=a=="MEASURE"?e.sCriticalHigh:s}else if(c[U].TYPE=="WH"){v={};v[n]="";v[s]=Number(c[U].FIXED);e.wh=Number(c[U].FIXED);F.minThreshold={color:"Good"};F.minThreshold.data=a=="MEASURE"?l.results:[v];A=a=="MEASURE"?e.sWarningHigh:s}else if(c[U].TYPE=="TA"){v={};v[n]="";v[s]=Number(c[U].FIXED);F.target={color:"Neutral"};F.target.data=a=="MEASURE"?l.results:[v];C=a=="MEASURE"?e.sTarget:s}}if(a=="FIXED"){F.firstYLabel.color=p>e.ch?"Error":e.wh<=p&&p<=e.ch?"Critical":p<e.wh?"Good":"Neutral";F.lastYLabel.color=I>e.ch?"Error":e.wh<=I&&I<=e.ch?"Critical":I<e.wh?"Good":"Neutral"}else if(a=="MEASURE"&&e.firstwH&&e.lastwH&&e.firstcH&&e.lastcH){F.firstYLabel.color=p>e.firstcH?"Error":e.firstwH<=p&&p<=e.firstcH?"Critical":p<e.firstwH?"Good":"Neutral";F.lastYLabel.color=I>e.lastcH?"Error":e.lastwH<=I&&I<=e.lastcH?"Critical":I<e.lastwH?"Good":"Neutral"}F.innerMaxThreshold={data:[]};F.innerMinThreshold={data:[]};break;case"RA":for(U in c){if(c[U].TYPE=="CH"){v={};v[n]="";v[s]=Number(c[U].FIXED);e.ch=Number(c[U].FIXED);F.maxThreshold={color:"Error"};F.maxThreshold.data=a=="MEASURE"?l.results:[v];f=a=="MEASURE"?e.sCriticalHigh:s}else if(c[U].TYPE=="WH"){v={};v[n]="";v[s]=Number(c[U].FIXED);e.wh=Number(c[U].FIXED);F.innerMaxThreshold={color:"Good"};F.innerMaxThreshold.data=a=="MEASURE"?l.results:[v];L=a=="MEASURE"?e.sWarningHigh:s}else if(c[U].TYPE=="WL"){v={};v[n]="";v[s]=Number(c[U].FIXED);e.wl=Number(c[U].FIXED);F.innerMinThreshold={color:"Good"};F.innerMinThreshold.data=a=="MEASURE"?l.results:[v];m=a=="MEASURE"?e.sWarningLow:s}else if(c[U].TYPE=="CL"){v={};v[n]="";v[s]=Number(c[U].FIXED);e.cl=Number(c[U].FIXED);F.minThreshold={color:"Error"};F.minThreshold.data=a=="MEASURE"?l.results:[v];A=a=="MEASURE"?e.sCriticalLow:s}else if(c[U].TYPE=="TA"){v={};v[n]="";v[s]=Number(c[U].FIXED);F.target={color:"Neutral"};F.target.data=a=="MEASURE"?l.results:[v];C=a=="MEASURE"?e.sTarget:s}}if(a=="FIXED"){F.firstYLabel.color=p>e.ch||p<e.cl?"Error":e.wh<=p&&p<=e.ch||e.cl<=p&&p<=e.wl?"Critical":p>=e.wl&&p<=e.wh?"Good":"Neutral";F.lastYLabel.color=I>e.ch||I<e.cl?"Error":e.wh<=I&&I<=e.ch||e.cl<=I&&I<=e.wl?"Critical":I>=e.wl&&I<=e.wh?"Good":"Neutral"}else if(a=="MEASURE"&&e.firstwL&&e.lastwL&&e.firstcL&&e.lastcL&&e.firstwH&&e.lastwH&&e.firstcH&&e.lastcH){F.firstYLabel.color=p>e.firstcH||p<e.firstcL?"Error":e.firstwH<=p&&p<=e.firstcH||e.firstcL<=p&&p<=e.firstwL?"Critical":p>=e.firstwL&&p<=e.firstwH?"Good":"Neutral";F.lastYLabel.color=I>e.lastcH||I<e.lastcL?"Error":e.lastwH<=I&&I<=e.lastcH||e.lastcL<=I&&I<=e.lastwL?"Critical":I>=e.lastwL&&I<=e.lastwH?"Good":"Neutral"}break}function y(e,l,a){return new t({color:`{/${e}/color}`,points:{path:`/${e}/data`,template:new i({x:`{${l}}`,y:`{${a}}`})}})}e.getTile().getTileContent()[1].getContent().setTarget(y("target",n,C));e.getTile().getTileContent()[1].getContent().setInnerMinThreshold(y("innerMinThreshold",n,m));e.getTile().getTileContent()[1].getContent().setInnerMaxThreshold(y("innerMaxThreshold",n,L));e.getTile().getTileContent()[1].getContent().setMinThreshold(y("minThreshold",n,A));e.getTile().getTileContent()[1].getContent().setMaxThreshold(y("maxThreshold",n,f));e.getTile().getTileContent()[1].getContent().setChart(y("chart",n,s));e._updateTileModel(F)}if(!h){if(T){this.queryUriForTrendChart=T.uri;e.writeData={};try{this.trendChartODataReadRef=T.model.read(T.uri,null,null,true,i=>{if(i&&i.results&&i.results.length){if(T.unit[0]){e.unit=i.results[0][T.unit[0].name];e.writeData.unit=T.unit[0];e.writeData.unit.name=T.unit[0].name}e.queryUriResponseForTrendChart=i;n=sap.ushell.components.tiles.indicatorTileUtils.util.findTextPropertyForDimension(e.oTileApi.url.addSystemToServiceUrl(l),a,n);i.firstXlabel=i.results[0][n];i.lastXlabel=i.results[i.results.length-1][n];e.writeData.data=i;e.writeData.dimensionName=n;sap.ushell.components.tiles.indicatorTileUtils.cache.setKpivalueById(e.oConfig.TILE_PROPERTIES.id,e.writeData);const t=sap.ushell.components.tiles.indicatorTileUtils.util.getNavigationTarget(e.oConfig,e.system);e.oDualTrendView.oGenericTile.$().wrap(`<a href ='${t}'></a>`);e.oDualTrendView.oGenericTile.setState(o.Loaded);E(i,e.DEFINITION_DATA.EVALUATION.VALUES_SOURCE)}else{e.logError("no Response from QueryServiceUri")}},i=>{if(i&&i.response){e.logError("Data call failed")}})}catch(i){e.logError(i)}}else{e.logError()}r=sap.ushell.components.tiles.indicatorTileUtils.util.prepareFilterStructure(e.DEFINITION_DATA.EVALUATION_FILTERS,e.DEFINITION_DATA.ADDITIONAL_FILTERS);T=sap.ushell.components.tiles.indicatorTileUtils.util.prepareQueryServiceUri(e.oTileApi.url.addSystemToServiceUrl(l),a,s,null,r);if(T){e.QUERY_SERVICE_MODEL=T.model;e.queryUriForKpiValue=T.uri;e.numericODataReadRef=e.QUERY_SERVICE_MODEL.read(T.uri,null,null,true,i=>{if(i&&i.results&&i.results.length){let t="";let l=i.results[0][e.DEFINITION_DATA.EVALUATION.COLUMN_NAME];e.writeData.numericData=i;if(e.oConfig.EVALUATION.SCALING==-2){l*=100}t=sap.ushell.components.tiles.indicatorTileUtils.util.getLocaleFormattedValue(Number(l),e.oConfig.EVALUATION.SCALING,e.oConfig.EVALUATION.DECIMAL_PRECISION);if(e.oConfig.EVALUATION.SCALING==-2){e._updateTileModel({scale:"%"})}const a=e.getTrendIndicator(e.setThresholdValues().trendValue,l);e._updateTileModel({value:t.toString(),valueColor:e.getTrendColor(e.setThresholdValues()),indicator:a})}else{fnError.call(e,"no Response from QueryServiceUri")}})}}else{try{if(h.unit!==undefined){e.unit=h.data.results[0][h.unit.name]}e.queryUriResponseForTrendChart=h.data;n=h.dimensionName;const i=h.numericData.results[0][e.DEFINITION_DATA.EVALUATION.COLUMN_NAME];const t=e.getTrendIndicator(e.setThresholdValues().trendValue,h.data.results[0][e.DEFINITION_DATA.EVALUATION.COLUMN_NAME]);const l=sap.ushell.components.tiles.indicatorTileUtils.util.getLocaleFormattedValue(Number(i),e.oConfig.EVALUATION.SCALING,e.oConfig.EVALUATION.DECIMAL_PRECISION);e.oDualTrendView.oGenericTile.setState(o.Loaded);E(h.data,e.DEFINITION_DATA.EVALUATION.VALUES_SOURCE);e._updateTileModel({value:l.toString(),valueColor:e.getTrendColor(e.setThresholdValues()),indicator:t})}catch(i){e.logError(i)}}},flowWithoutDesignTimeCall:function(){this.DEFINITION_DATA=this.oConfig;this._updateTileModel(this.DEFINITION_DATA);if(this.oTileApi.visible.isVisible()&&!this.firstTimeVisible){this.firstTimeVisible=true}this.onAfterFinalEvaluation()},flowWithDesignTimeCall:function(){const e=this;try{const i=sap.ushell.components.tiles.indicatorTileUtils.cache.getEvaluationById(this.oConfig.EVALUATION.ID);if(i){e.oConfig.EVALUATION_FILTERS=i.EVALUATION_FILTERS;e.flowWithoutDesignTimeCall()}else{sap.ushell.components.tiles.indicatorTileUtils.util.getFilterFromRunTimeService(this.oConfig,i=>{e.oConfig.EVALUATION_FILTERS=i;sap.ushell.components.tiles.indicatorTileUtils.cache.setEvaluationById(e.oConfig.TILE_PROPERTIES.id,e.oConfig);e.flowWithoutDesignTimeCall()})}}catch(e){this.logError(e)}},refreshHandler:function(e){if(!e.firstTimeVisible){if(Number(this.oTileApi.configuration.getParameterValueAsString("isSufficient"))){e.flowWithoutDesignTimeCall()}else{e.flowWithDesignTimeCall()}}},visibleHandler:function(e){if(!e){this.firstTimeVisible=false;sap.ushell.components.tiles.indicatorTileUtils.util.abortPendingODataCalls(this.trendChartODataReadRef)}if(e){this.refreshHandler(this)}},setTextInTile:function(){const e=this;this._updateTileModel({header:e.oTileApi.preview.getTitle()||sap.ushell.components.tiles.indicatorTileUtils.util.getChipTitle(e.oConfig),subheader:e.oTileApi.preview.getDescription()||sap.ushell.components.tiles.indicatorTileUtils.util.getChipSubTitle(e.oConfig)})},onInit:function(){const e=this;this.firstTimeVisible=false;this.oDualTrendView=this.getView();this.oViewData=this.oDualTrendView.getViewData();this.oTileApi=this.oViewData.chip;if(this.oTileApi.visible){this.oTileApi.visible.attachVisible(this.visibleHandler.bind(this))}this.system=this.oTileApi.url.getApplicationSystem();this.oDualTrendView.oGenericTile.setState(o.Loading);if(this.oTileApi.preview.isEnabled()){this.setTextInTile();this._updateTileModel({value:8888,size:a.Auto,frameType:"TwoByOne",state:o.Loading,valueColor:s.Error,indicator:r.None,title:"Liquidity Structure",footer:"Current Quarter",description:"Apr 1st 2013 (B$)",width:"100%",height:"100%",chart:{color:"Good",data:[{day:0,balance:0},{day:30,balance:20},{day:60,balance:20},{day:100,balance:80}]},target:{color:"Error",data:[{day:0,balance:0},{day:30,balance:30},{day:60,balance:40},{day:100,balance:90}]},maxThreshold:{color:"Good",data:[{day:0,balance:0},{day:30,balance:40},{day:60,balance:50},{day:100,balance:100}]},innerMaxThreshold:{color:"Error",data:[]},innerMinThreshold:{color:"Neutral",data:[]},minThreshold:{color:"Error",data:[{day:0,balance:0},{day:30,balance:20},{day:60,balance:30},{day:100,balance:70}]},minXValue:0,maxXValue:100,minYValue:0,maxYValue:100,firstXLabel:{label:"June 123",color:"Error"},lastXLabel:{label:"June 30",color:"Error"},firstYLabel:{label:"0M",color:"Good"},lastYLabel:{label:"80M",color:"Critical"},minLabel:{},maxLabel:{}});this.oDualTrendView.oGenericTile.setState(o.Loaded)}else{try{sap.ushell.components.tiles.indicatorTileUtils.util.getParsedChip(this.oTileApi.configuration.getParameterValueAsString("tileConfiguration"),i=>{e.oConfig=i;e.setTextInTile();e.oDualTrendView.oGenericTile.attachPress(()=>{sap.ushell.components.tiles.indicatorTileUtils.util.abortPendingODataCalls(e.trendChartODataReadRef);sap.ushell.components.tiles.indicatorTileUtils.cache.setKpivalueById(e.oConfig.TILE_PROPERTIES.id,null);window.location.hash=sap.ushell.components.tiles.indicatorTileUtils.util.getNavigationTarget(e.oConfig,e.system)});if(Number(e.oTileApi.configuration.getParameterValueAsString("isSufficient"))){sap.ushell.components.tiles.indicatorTileUtils.cache.setEvaluationById(e.oConfig.TILE_PROPERTIES.id,e.oConfig);e.flowWithoutDesignTimeCall()}else{e.flowWithDesignTimeCall()}})}catch(e){this.logError(e)}}},_setLocalModelToTile:function(){if(!this.getTile().getModel()){this.getTile().setModel(new e({}))}},onExit:function(){sap.ushell.components.tiles.indicatorTileUtils.util.abortPendingODataCalls(this.trendChartODataReadRef)}})},true);
//# sourceMappingURL=DualTrend.controller.js.map