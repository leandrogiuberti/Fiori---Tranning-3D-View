// Copyright (c) 2009-2025 SAP SE, All Rights Reserved
sap.ui.define(["sap/ushell/components/tiles/generic","sap/m/library","sap/suite/ui/microchart/AreaMicroChartItem","sap/suite/ui/microchart/AreaMicroChartPoint"],(e,i,t,l)=>{"use strict";const a=i.FrameType;const s=i.LoadState;const r=e.extend("sap.ushell.components.tiles.indicatorArea.AreaChartTile",{onInit:function(){this.KPI_VALUE_REQUIRED=false},doProcess:function(e,i){this.onAfterFinalEvaluation(e,i)},doDummyProcess:function(){const e=this;this.setTextInTile();e._updateTileModel({footer:"",description:"",width:"100%",height:"100%",chart:{color:"Good",data:[{day:0,balance:0},{day:30,balance:20},{day:60,balance:20},{day:100,balance:80}]},target:{color:"Error",data:[{day:0,balance:0},{day:30,balance:30},{day:60,balance:40},{day:100,balance:90}]},maxThreshold:{color:"Good",data:[{day:0,balance:0},{day:30,balance:40},{day:60,balance:50},{day:100,balance:100}]},innerMaxThreshold:{color:"Error",data:[]},innerMinThreshold:{color:"Neutral",data:[]},minThreshold:{color:"Error",data:[{day:0,balance:0},{day:30,balance:20},{day:60,balance:30},{day:100,balance:70}]},minXValue:0,maxXValue:100,minYValue:0,maxYValue:100,firstXLabel:{label:"June 123",color:"Error"},lastXLabel:{label:"June 30",color:"Error"},firstYLabel:{label:"0M",color:"Good"},lastYLabel:{label:"80M",color:"Critical"},minLabel:{},maxLabel:{}});this.oKpiTileView.oGenericTile.setState(s.Loaded)},scheduleJob:function(e){if(this.chipCacheTime&&!sap.ushell.components.tiles.indicatorTileUtils.util.isDualTile(this.oConfig)){sap.ushell.components.tiles.indicatorTileUtils.util.scheduleFetchDataJob.call(this,this.oTileApi.visible.isVisible())}},onAfterFinalEvaluation:function(e,i){const r=this;const o=this.DEFINITION_DATA.EVALUATION.ODATA_ENTITYSET;const n=this.DEFINITION_DATA.EVALUATION.COLUMN_NAME;const c=sap.ushell.components.tiles.indicatorTileUtils.util.prepareFilterStructure(this.DEFINITION_DATA.EVALUATION_FILTERS,this.DEFINITION_DATA.ADDITIONAL_FILTERS);let u=this.DEFINITION_DATA.TILE_PROPERTIES.dimension;if(u==undefined){this.logError();return}const h=this.DEFINITION_DATA.EVALUATION.GOAL_TYPE;const E=this.DEFINITION_DATA.EVALUATION_VALUES;const T=sap.ushell.components.tiles.indicatorTileUtils.cache.getKpivalueById(r.oConfig.TILE_PROPERTIES.id);let d;if(sap.ushell.components.tiles.indicatorTileUtils.util.isDualTile(r.oConfig)){if(T){d=T.Data&&JSON.parse(T.Data)}}const f=r.oTileApi.configuration.getParameterValueAsString("timeStamp");const g=sap.ushell.components.tiles.indicatorTileUtils.util.isCacheValid(r.oConfig.TILE_PROPERTIES.id,f,r.chipCacheTime,r.chipCacheTimeUnit,r.tilePressed);let m=n;if(this.DEFINITION_DATA.EVALUATION.VALUES_SOURCE=="MEASURE"){switch(h){case"MI":r.sWarningHigh=sap.ushell.components.tiles.indicatorTileUtils.util.getEvalValueMeasureName(r.oConfig,"WH","MEASURE");r.sCriticalHigh=sap.ushell.components.tiles.indicatorTileUtils.util.getEvalValueMeasureName(r.oConfig,"CH","MEASURE");r.sTarget=sap.ushell.components.tiles.indicatorTileUtils.util.getEvalValueMeasureName(r.oConfig,"TA","MEASURE");r.sTrend=sap.ushell.components.tiles.indicatorTileUtils.util.getEvalValueMeasureName(r.oConfig,"TC","MEASURE");if(r.sWarningHigh&&r.sCriticalHigh&&r.sTarget){m+=`,${r.sWarningHigh},${r.sCriticalHigh},${r.sTarget}`}break;case"MA":r.sWarningLow=sap.ushell.components.tiles.indicatorTileUtils.util.getEvalValueMeasureName(r.oConfig,"WL","MEASURE");r.sCriticalLow=sap.ushell.components.tiles.indicatorTileUtils.util.getEvalValueMeasureName(r.oConfig,"CL","MEASURE");r.sTarget=sap.ushell.components.tiles.indicatorTileUtils.util.getEvalValueMeasureName(r.oConfig,"TA","MEASURE");r.sTrend=sap.ushell.components.tiles.indicatorTileUtils.util.getEvalValueMeasureName(r.oConfig,"TC","MEASURE");if(r.sWarningLow&&r.sCriticalLow&&r.sTarget){m+=`,${r.sWarningLow},${r.sCriticalLow},${r.sTarget}`}break;case"RA":r.sWarningHigh=sap.ushell.components.tiles.indicatorTileUtils.util.getEvalValueMeasureName(r.oConfig,"WH","MEASURE");r.sCriticalHigh=sap.ushell.components.tiles.indicatorTileUtils.util.getEvalValueMeasureName(r.oConfig,"CH","MEASURE");r.sTarget=sap.ushell.components.tiles.indicatorTileUtils.util.getEvalValueMeasureName(r.oConfig,"TA","MEASURE");r.sTrend=sap.ushell.components.tiles.indicatorTileUtils.util.getEvalValueMeasureName(r.oConfig,"TC","MEASURE");r.sWarningLow=sap.ushell.components.tiles.indicatorTileUtils.util.getEvalValueMeasureName(r.oConfig,"WL","MEASURE");r.sCriticalLow=sap.ushell.components.tiles.indicatorTileUtils.util.getEvalValueMeasureName(r.oConfig,"CL","MEASURE");if(r.sWarningLow&&r.sCriticalLow&&r.sTarget&&r.sWarningHigh&&r.sCriticalHigh){m+=`,${r.sWarningLow},${r.sCriticalLow},${r.sTarget},${r.sWarningHigh},${r.sCriticalHigh}`}break}}function p(e,i){const a=[];const s=[];const o=[];const c=[];const T=[];const d=[];let f=e.firstXlabel;let g;let m;let p;let C;let A;let L=e.lastXlabel;const N=Number(e.results[0][n]);const I=Number(e.results[e.results.length-1][n]);let U;for(U in e.results){e.results[U][u]=Number(U);e.results[U][n]=Number(e.results[U][n]);if(r.sWarningHigh){e.results[U][r.sWarningHigh]=Number(e.results[U][r.sWarningHigh])}if(r.sCriticalHigh){e.results[U][r.sCriticalHigh]=Number(e.results[U][r.sCriticalHigh])}if(r.sCriticalLow){e.results[U][r.sCriticalLow]=Number(e.results[U][r.sCriticalLow])}if(r.sWarningLow){e.results[U][r.sWarningLow]=Number(e.results[U][r.sWarningLow])}if(r.sTarget){e.results[U][r.sTarget]=Number(e.results[U][r.sTarget])}if(r.sWarningHigh){o.push(e.results[U][r.sWarningHigh])}if(r.sCriticalHigh){c.push(e.results[U][r.sCriticalHigh])}if(r.sCriticalLow){T.push(e.results[U][r.sCriticalLow])}if(r.sWarningLow){d.push(e.results[U][r.sWarningLow])}a.push(e.results[U][u]);s.push(e.results[U][n])}try{f=sap.ushell.components.tiles.indicatorTileUtils.util.formatOdataObjectToString(f);L=sap.ushell.components.tiles.indicatorTileUtils.util.formatOdataObjectToString(L)}catch(e){r.logError(e)}let b=Number(N);if(r.oConfig.EVALUATION.SCALING==-2){b*=100}const M=Math.min.apply(Math,s);let S=r.isCurrencyMeasure(r.oConfig.EVALUATION.COLUMN_NAME);let D=sap.ushell.components.tiles.indicatorTileUtils.util.getLocaleFormattedValue(b,r.oConfig.EVALUATION.SCALING,r.oConfig.EVALUATION.DECIMAL_PRECISION,S,r.CURRENCY_CODE);if(r.oConfig.EVALUATION.SCALING==-2){D+=" %"}const w=D.toString();let R=Number(I);if(r.oConfig.EVALUATION.SCALING==-2){R*=100}const O=Math.max.apply(Math,s);S=r.isCurrencyMeasure(r.oConfig.EVALUATION.COLUMN_NAME);let V=sap.ushell.components.tiles.indicatorTileUtils.util.getLocaleFormattedValue(R,r.oConfig.EVALUATION.SCALING,r.oConfig.EVALUATION.DECIMAL_PRECISION,S,r.CURRENCY_CODE);if(r.oConfig.EVALUATION.SCALING==-2){V+=" %"}const H=V.toString();let F;let y;try{F=sap.ushell.components.tiles.indicatorTileUtils.util.formatOdataObjectToString(Math.min.apply(Math,a));y=sap.ushell.components.tiles.indicatorTileUtils.util.formatOdataObjectToString(Math.max.apply(Math,a))}catch(e){r.logError(e)}if(i=="MEASURE"){if(o.length!=0){r.firstwH=o[F];r.lastwH=o[y]}if(c.length!=0){r.firstcH=c[F];r.lastcH=c[y]}if(T.length!=0){r.firstcL=T[F];r.lastcL=T[y]}if(d.length!=0){r.firstwL=d[F];r.lastwL=d[y]}}const P={width:"100%",height:"100%",unit:r.unit||"",chart:{color:"Neutral",data:e.results},size:"Auto",minXValue:F,maxXValue:y,minYValue:M,maxYValue:O,firstXLabel:{label:`${f}`,color:"Neutral"},lastXLabel:{label:`${L}`,color:"Neutral"},firstYLabel:{label:`${w}`,color:"Neutral"},lastYLabel:{label:`${H}`,color:"Neutral"},minLabel:{},maxLabel:{}};let _;switch(h){case"MA":for(U in E){if(E[U].TYPE=="CL"){P.minThreshold={color:"Error"};_={};_[u]="";_[n]=Number(E[U].FIXED);r.cl=Number(E[U].FIXED);P.minThreshold.data=i=="MEASURE"?e.results:[_];g=i=="MEASURE"?r.sCriticalLow:n}else if(E[U].TYPE=="WL"){P.maxThreshold={color:"Good"};_={};_[u]="";_[n]=Number(E[U].FIXED);P.maxThreshold.data=i=="MEASURE"?e.results:[_];m=i=="MEASURE"?r.sWarningLow:n;r.wl=Number(E[U].FIXED)}else if(E[U].TYPE=="TA"){_={};_[u]="";_[n]=Number(E[U].FIXED);P.target={color:"Neutral"};P.target.data=i=="MEASURE"?e.results:[_];A=i=="MEASURE"?r.sTarget:n}}P.innerMinThreshold={data:[]};P.innerMaxThreshold={data:[]};if(i=="FIXED"){P.firstYLabel.color=N<r.cl?"Error":r.cl<=N&&N<=r.wl?"Critical":N>r.wl?"Good":"Neutral";P.lastYLabel.color=I<r.cl?"Error":r.cl<=I&&I<=r.wl?"Critical":I>r.wl?"Good":"Neutral"}else if(i=="MEASURE"&&r.firstwL&&r.lastwL&&r.firstcL&&r.lastcL){P.firstYLabel.color=N<r.firstcL?"Error":r.firstcL<=N&&N<=r.firstwL?"Critical":N>r.firstwL?"Good":"Neutral";P.lastYLabel.color=I<r.lastcL?"Error":r.lastcL<=I&&I<=r.lastwL?"Critical":I>r.lastwL?"Good":"Neutral"}break;case"MI":for(U in E){if(E[U].TYPE=="CH"){_={};_[u]="";_[n]=Number(E[U].FIXED);r.ch=Number(E[U].FIXED);P.maxThreshold={color:"Error"};P.maxThreshold.data=i=="MEASURE"?e.results:[_];m=i=="MEASURE"?r.sCriticalHigh:n}else if(E[U].TYPE=="WH"){_={};_[u]="";_[n]=Number(E[U].FIXED);r.wh=Number(E[U].FIXED);P.minThreshold={color:"Good"};P.minThreshold.data=i=="MEASURE"?e.results:[_];g=i=="MEASURE"?r.sWarningHigh:n}else if(E[U].TYPE=="TA"){_={};_[u]="";_[n]=Number(E[U].FIXED);P.target={color:"Neutral"};P.target.data=i=="MEASURE"?e.results:[_];A=i=="MEASURE"?r.sTarget:n}}if(i=="FIXED"){P.firstYLabel.color=N>r.ch?"Error":r.wh<=N&&N<=r.ch?"Critical":N<r.wh?"Good":"Neutral";P.lastYLabel.color=I>r.ch?"Error":r.wh<=I&&I<=r.ch?"Critical":I<r.wh?"Good":"Neutral"}else if(i=="MEASURE"&&r.firstwH&&r.lastwH&&r.firstcH&&r.lastcH){P.firstYLabel.color=N>r.firstcH?"Error":r.firstwH<=N&&N<=r.firstcH?"Critical":N<r.firstwH?"Good":"Neutral";P.lastYLabel.color=I>r.lastcH?"Error":r.lastwH<=I&&I<=r.lastcH?"Critical":I<r.lastwH?"Good":"Neutral"}P.innerMaxThreshold={data:[]};P.innerMinThreshold={data:[]};break;case"RA":for(U in E){if(E[U].TYPE=="CH"){_={};_[u]="";_[n]=Number(E[U].FIXED);r.ch=Number(E[U].FIXED);P.maxThreshold={color:"Error"};P.maxThreshold.data=i=="MEASURE"?e.results:[_];m=i=="MEASURE"?r.sCriticalHigh:n}else if(E[U].TYPE=="WH"){_={};_[u]="";_[n]=Number(E[U].FIXED);r.wh=Number(E[U].FIXED);P.innerMaxThreshold={color:"Good"};P.innerMaxThreshold.data=i=="MEASURE"?e.results:[_];C=i=="MEASURE"?r.sWarningHigh:n}else if(E[U].TYPE=="WL"){_={};_[u]="";_[n]=Number(E[U].FIXED);r.wl=Number(E[U].FIXED);P.innerMinThreshold={color:"Good"};P.innerMinThreshold.data=i=="MEASURE"?e.results:[_];p=i=="MEASURE"?r.sWarningLow:n}else if(E[U].TYPE=="CL"){_={};_[u]="";_[n]=Number(E[U].FIXED);r.cl=Number(E[U].FIXED);P.minThreshold={color:"Error"};P.minThreshold.data=i=="MEASURE"?e.results:[_];g=i=="MEASURE"?r.sCriticalLow:n}else if(E[U].TYPE=="TA"){_={};_[u]="";_[n]=Number(E[U].FIXED);P.target={color:"Neutral"};P.target.data=i=="MEASURE"?e.results:[_];A=i=="MEASURE"?r.sTarget:n}}if(i=="FIXED"){P.firstYLabel.color=N>r.ch||N<r.cl?"Error":r.wh<=N&&N<=r.ch||r.cl<=N&&N<=r.wl?"Critical":N>=r.wl&&N<=r.wh?"Good":"Neutral";P.lastYLabel.color=I>r.ch||I<r.cl?"Error":r.wh<=I&&I<=r.ch||r.cl<=I&&I<=r.wl?"Critical":I>=r.wl&&I<=r.wh?"Good":"Neutral"}else if(i=="MEASURE"&&r.firstwL&&r.lastwL&&r.firstcL&&r.lastcL&&r.firstwH&&r.lastwH&&r.firstcH&&r.lastcH){P.firstYLabel.color=N>r.firstcH||N<r.firstcL?"Error":r.firstwH<=N&&N<=r.firstcH||r.firstcL<=N&&N<=r.firstwL?"Critical":N>=r.firstwL&&N<=r.firstwH?"Good":"Neutral";P.lastYLabel.color=I>r.lastcH||I<r.lastcL?"Error":r.lastwH<=I&&I<=r.lastcH||r.lastcL<=I&&I<=r.lastwL?"Critical":I>=r.lastwL&&I<=r.lastwH?"Good":"Neutral"}break}function Y(e,i,a,s){return new t({color:`{/${e}/color}`,points:{path:`/${e}/data`,template:new l({x:`{${i}}`,y:`{${a}}`})}})}const W=r.getView().oNVConfContS;W.setTarget(Y("target",u,A));W.setInnerMinThreshold(Y("innerMinThreshold",u,p));W.setInnerMaxThreshold(Y("innerMaxThreshold",u,C));W.setMinThreshold(Y("minThreshold",u,g));W.setMaxThreshold(Y("maxThreshold",u,m));W.setChart(Y("chart",u,n));r.setTextInTile();if(r.getView().getViewData().parentController){r.getView().getViewData().parentController._updateTileModel(P)}else{r._updateTileModel(P)}}const C=sap.ushell.components.tiles.indicatorTileUtils.util.getBoolValue(e);if(d&&!d.rightData||!T||!g&&r.oTileApi.visible.isVisible()||C||i&&r.oTileApi.visible.isVisible()||r.getView().getViewData().refresh){if(r.kpiValueFetchDeferred){r.kpiValueFetchDeferred=false;const e=sap.ushell.components.tiles.indicatorTileUtils.util.prepareQueryServiceUri(r.oRunTimeODataModel,o,m,u,c);if(e){this.queryUriForTrendChart=e.uri;const i={};try{this.trendChartODataReadRef=e.model.read(e.uri,null,null,true,t=>{r.kpiValueFetchDeferred=true;if(t&&t.results&&t.results.length){if(e.unit[0]){r.unit=t.results[0][e.unit[0].name];r.CURRENCY_CODE=r.unit;i.unit=e.unit[0];i.unit.name=e.unit[0].name}r.queryUriResponseForTrendChart=t;u=sap.ushell.components.tiles.indicatorTileUtils.util.findTextPropertyForDimension(r.oRunTimeODataModel,o,u);t.results.splice(10);t.firstXlabel=t.results[0][u];t.lastXlabel=t.results[t.results.length-1][u];i.data=t;if(i&&i.data&&i.data.results&&i.data.results.length){for(let e=0;e<i.data.results.length;e++){delete i.data.results[e].__metadata}}i.isCurM=r.isCurrencyMeasure(r.oConfig.EVALUATION.COLUMN_NAME);i.dimensionName=u;p(t,r.DEFINITION_DATA.EVALUATION.VALUES_SOURCE);const l={};r.cacheTime=sap.ushell.components.tiles.indicatorTileUtils.util.getUTCDate();l.ChipId=r.oConfig.TILE_PROPERTIES.id;l.Data=JSON.stringify(i);l.CacheMaxAge=Number(r.chipCacheTime);l.CacheMaxAgeUnit=r.chipCacheTimeUnit;l.CacheType=1;const n=r.getLocalCache(l);if(r.DEFINITION_DATA.TILE_PROPERTIES.frameType==a.TwoByOne){const e=sap.ushell.components.tiles.indicatorTileUtils.cache.getKpivalueById(r.oConfig.TILE_PROPERTIES.id);let t;if(e){if(!e.CachedTime){e.CachedTime=sap.ushell.components.tiles.indicatorTileUtils.util.getUTCDate()}t=e.Data;if(t){t=JSON.parse(t);t.rightData=i}e.Data=JSON.stringify(t);sap.ushell.components.tiles.indicatorTileUtils.cache.setKpivalueById(r.oConfig.TILE_PROPERTIES.id,e)}else{t={};t.rightData=i;n.Data=JSON.stringify(t);sap.ushell.components.tiles.indicatorTileUtils.cache.setKpivalueById(r.oConfig.TILE_PROPERTIES.id,n)}r.cacheWriteData=i;r.getView().getViewData().deferredObj.resolve()}else{sap.ushell.components.tiles.indicatorTileUtils.cache.setKpivalueById(r.oConfig.TILE_PROPERTIES.id,n);let e=false;if(T){e=true}if(r.chipCacheTime){sap.ushell.components.tiles.indicatorTileUtils.util.writeFrontendCacheByChipAndUserId(r.oTileApi,r.oConfig.TILE_PROPERTIES.id,l,e,e=>{if(e){r.cacheTime=e&&e.CachedTime;sap.ushell.components.tiles.indicatorTileUtils.cache.setKpivalueById(r.oConfig.TILE_PROPERTIES.id,e);r.setTimeStamp()}if(r.chipCacheTime&&!sap.ushell.components.tiles.indicatorTileUtils.util.isDualTile(r.oConfig)){r.setTimeStamp(r.cacheTime)}})}r.oKpiTileView.oGenericTile.setState(s.Loaded);r.updateDatajobScheduled=false;const i=`${r.oConfig.TILE_PROPERTIES.id}data`;let t=sap.ushell.components.tiles.indicatorTileUtils.util.getScheduledJob(i);if(t){clearTimeout(t);t=undefined}r.scheduleJob(r.cacheTime)}}else{r.setNoData()}},e=>{r.kpiValueFetchDeferred=true;if(e&&e.response){r.logError("Data call failed")}})}catch(e){r.kpiValueFetchDeferred=true;r.logError(e)}}else{r.kpiValueFetchDeferred=true;r.logError()}}}else if(T&&T.Data){try{let e;const i=r.oConfig&&r.oConfig.TILE_PROPERTIES&&r.oConfig.TILE_PROPERTIES.tileType;if(i.indexOf("DT-")==-1){e=T.Data&&JSON.parse(T.Data)}else{e=T.Data&&JSON.parse(T.Data);e=e.rightData}if(e.unit){r.unit=e.data.results[0][e.unit.name];r.CURRENCY_CODE=r.unit}r.cacheTime=T.CachedTime;if(r.chipCacheTime&&!sap.ushell.components.tiles.indicatorTileUtils.util.isDualTile(r.oConfig)){r.setTimeStamp(r.cacheTime)}r.queryUriResponseForTrendChart=e.data;u=e.dimensionName;p(e.data,r.DEFINITION_DATA.EVALUATION.VALUES_SOURCE);if(r.oConfig.TILE_PROPERTIES.frameType==a.OneByOne){r.oKpiTileView.oGenericTile.setState(s.Loaded)}else{r.getView().getViewData().deferredObj.resolve()}r.scheduleJob(r.cacheTime)}catch(e){r.logError(e)}}else{r.setNoData()}}});return r});
//# sourceMappingURL=AreaChartTile.controller.js.map