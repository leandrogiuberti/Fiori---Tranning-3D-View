// Copyright (c) 2009-2025 SAP SE, All Rights Reserved
sap.ui.define(["sap/ui/core/mvc/Controller","sap/ushell/components/tiles/utils","sap/ushell/Config","sap/ushell/utils/WindowUtils","sap/m/library","sap/ushell/library","sap/ui/model/json/JSONModel","sap/base/Log","sap/ui/thirdparty/jquery","sap/ushell/utils/UrlParsing","sap/ushell/EventHub","sap/ushell/Container","sap/ushell/utils/LaunchpadError"],(e,t,i,a,s,o,n,r,jQuery,l,c,g,p)=>{"use strict";const _=s.GenericTileScope;const d=s.GenericTileMode;const f=o.AppType;return e.extend("sap.ushell.components.tiles.applauncher.StaticTile",{_aDoables:[],onInit:function(){const e=this.getView();const a=e.getViewData();const s=a.chip;const o=t.getAppLauncherConfig(s,s.configurationUi.isEnabled(),false);const r=this;let c=o.navigation_target_url;let g;const p=s.url.getApplicationSystem();if(p){if(l.isIntentUrl(c)){g=l.parseShellHash(c);if(!g.params){g.params={}}g.params["sap-system"]=p;c=`#${l.constructShellHash(g)}`}else{c+=`${c.indexOf("?")<0?"?":"&"}sap-system=${p}`}}this.navigationTargetUrl=c;const _=new n({sizeBehavior:i.last("/core/home/sizeBehavior"),wrappingType:i.last("/core/home/wrappingType"),config:o,mode:o.display_mode,nav:{navigation_target_url:s.configurationUi&&s.configurationUi.isEnabled()?"":c},search:{display_highlight_terms:[]}});e.setModel(_);this._aDoables.push(i.on("/core/home/sizeBehavior").do(e=>{_.setProperty("/sizeBehavior",e)}));if(s.types){s.types.attachSetType(e=>{if(r.tileType!==e){if(e==="link"){_.setProperty("/mode",d.LineMode)}else{_.setProperty("/mode",_.getProperty("/config/display_mode"))}r.tileType=e}})}if(!this.tileType){this.tileType="tile"}if(s.search){const t=e.getModel().getProperty("/config/display_search_keywords");const i=t.split(/[, ]+/).filter(e=>e&&e!=="");if(o.display_title_text&&o.display_title_text!==""&&i.indexOf(o.display_title_text)===-1){i.push(o.display_title_text)}if(o.display_subtitle_text&&o.display_subtitle_text!==""&&i.indexOf(o.display_subtitle_text)===-1){i.push(o.display_subtitle_text)}if(o.display_info_text&&o.display_info_text!==""&&i.indexOf(o.display_info_text)===-1){i.push(o.display_info_text)}s.search.setKeywords(i);s.search.attachHighlight(t=>{e.getModel().setProperty("/search/display_highlight_terms",t)})}if(s.bag&&s.bag.attachBagsUpdated){s.bag.attachBagsUpdated(i=>{if(i.indexOf("tileProperties")>-1){t._updateTilePropertiesTexts(e,s.bag.getBag("tileProperties"))}})}if(s.configuration&&s.configuration.attachConfigurationUpdated){s.configuration.attachConfigurationUpdated(i=>{if(i.indexOf("tileConfiguration")>-1){t._updateTileConfiguration(e,s.configuration.getParameterValueAsString("tileConfiguration"))}})}if(s.preview){s.preview.setTargetUrl(c);s.preview.setPreviewIcon(o.display_icon_url);s.preview.setPreviewTitle(o.display_title_text);if(s.preview.setPreviewSubtitle&&typeof s.preview.setPreviewSubtitle==="function"){s.preview.setPreviewSubtitle(o.display_subtitle_text)}}if(s.configurationUi.isEnabled()){s.configurationUi.setAsyncUiProvider(()=>t.getConfigurationUi(e,"sap.ushell.components.tiles.applauncher.Configuration").then(e=>{s.configurationUi.attachCancel(r.onCancelConfiguration.bind(null,e));s.configurationUi.attachSave(r.onSaveConfiguration.bind(null,e));return e}));this.getView().getContent()[0].setTooltip(t.getResourceBundle().getText("edit_configuration.tooltip"))}if(s.actions){let e=[];const a=o.actions;if(a){e=a.slice()}if(i.last("/core/shell/enablePersonalization")){const i=_.getProperty("/mode")===d.LineMode?"link":"tile";const a=t.getTileSettingsAction(_,this.onSaveRuntimeSettings.bind(this),i);e.push(a)}s.actions.setActionsProvider(()=>e)}},onExit:function(){this._aDoables.forEach(e=>{e.off()});this._aDoables=[]},onPress:function(e){const t=this.getView();const s=t.getViewData();const o=s.chip;const n=t.getModel().getProperty("/config");if(e.getSource().getScope&&e.getSource().getScope()===_.Display){if(o.configurationUi.isEnabled()){o.configurationUi.display()}else if(this.navigationTargetUrl){c.emit("UITracer.trace",{reason:"LaunchApp",source:"Tile",data:{targetUrl:this.navigationTargetUrl}});if(this.navigationTargetUrl[0]==="#"){hasher.setHash(this.navigationTargetUrl)}else{const e=i.last("/core/shell/enableRecentActivity")&&i.last("/core/shell/enableRecentActivityLogging");if(e){const e={title:n.display_title_text,appType:f.URL,url:n.navigation_target_url,appId:n.navigation_target_url};g.getRendererInternal("fiori2").logRecentActivity(e)}a.openURL(this.navigationTargetUrl,"_blank")}}}},onSaveRuntimeSettings:function(e){const t=e.getModel();const i=this.getView().getViewData().chip;const a=this.getView().getModel().getProperty("/config");a.display_title_text=t.getProperty("/title")||"";a.display_subtitle_text=t.getProperty("/subtitle")||"";a.display_info_text=t.getProperty("/info")||"";a.display_search_keywords=t.getProperty("/keywords")||"";const s=i.bag.getBag("tileProperties");s.setText("display_title_text",a.display_title_text);s.setText("display_subtitle_text",a.display_subtitle_text);s.setText("display_info_text",a.display_info_text);s.setText("display_search_keywords",a.display_search_keywords);s.save(()=>{r.debug("property bag 'tileProperties' saved successfully");this.getView().getModel().setProperty("/config/display_title_text",a.display_title_text);this.getView().getModel().setProperty("/config/display_subtitle_text",a.display_subtitle_text);this.getView().getModel().setProperty("/config/display_info_text",a.display_info_text);this.getView().getModel().setProperty("/config/display_search_keywords",a.display_search_keywords);this.getView().getModel().refresh()},(e,t)=>{const i=Object.keys(e)[0];const a=new p(`Bag save failed: ${e[i]}`,{info:t[i],otherMessages:e,otherInfo:t});r.error("Bag save failed",a,"sap.ushell.components.tiles.applauncher.StaticTile.controller")})},onSaveConfiguration:function(e){const i=new jQuery.Deferred;const a=e.getModel();const s=a.getProperty("/tileModel");const o=e.getViewData().chip;const l=t.tileActionsRows2TileActionsArray(a.getProperty("/config/tile_actions_rows"));const c={display_icon_url:a.getProperty("/config/display_icon_url"),navigation_use_semantic_object:a.getProperty("/config/navigation_use_semantic_object"),navigation_target_url:a.getProperty("/config/navigation_target_url"),navigation_semantic_object:(a.getProperty("/config/navigation_semantic_object")||"").trim(),navigation_semantic_action:(a.getProperty("/config/navigation_semantic_action")||"").trim(),navigation_semantic_parameters:(a.getProperty("/config/navigation_semantic_parameters")||"").trim(),display_search_keywords:a.getProperty("/config/display_search_keywords")};let g=t.checkInputOnSaveConfig(e);if(!g){g=t.checkTileActions(e)}if(g){i.reject(new Error("mandatory_fields_missing"));return i.promise()}if(c.navigation_use_semantic_object){c.navigation_target_url=t.getSemanticNavigationUrl(c);a.setProperty("/config/navigation_target_url",c.navigation_target_url)}const _=o.bag.getBag("tileProperties");_.setText("display_title_text",a.getProperty("/config/display_title_text"));_.setText("display_subtitle_text",a.getProperty("/config/display_subtitle_text"));_.setText("display_info_text",a.getProperty("/config/display_info_text"));_.setText("display_search_keywords",c.display_search_keywords);const d=o.bag.getBag("tileNavigationActions");t.populateTileNavigationActionsBag(d,l);function f(e,t){r.error(`property bag 'tileProperties' save failed: ${e}`,null,"sap.ushell.components.tiles.applauncher.StaticTile.controller");i.reject(new p(e,t))}o.writeConfiguration.setParameterValues({tileConfiguration:JSON.stringify(c)},()=>{const a=t.getAppLauncherConfig(o,false,false);const l=t.getAppLauncherConfig(o,true,false);const c=new n({config:a,nav:{navigation_target_url:""},tileModel:s});e.setModel(c);s.setData({config:l,nav:{navigation_target_url:""}},false);if(o.preview){o.preview.setTargetUrl(a.navigation_target_url);o.preview.setPreviewIcon(a.display_icon_url);o.preview.setPreviewTitle(a.display_title_text);if(o.preview.setPreviewSubtitle&&typeof o.preview.setPreviewSubtitle==="function"){o.preview.setPreviewSubtitle(a.display_subtitle_text)}}_.save(()=>{r.debug("property bag 'tileProperties' saved successfully");if(o.title){o.title.setTitle(a.display_title_text,()=>{i.resolve()},f)}else{i.resolve()}},(e,t)=>{const a=Object.keys(e)[0];const s=new p(`Bag save failed: ${e[a]}`,{info:t[a],otherMessages:e,otherInfo:t});r.error("Bag save failed",s,"sap.ushell.components.tiles.applauncher.StaticTile.controller");i.reject(s)});d.save(()=>{r.debug("property bag 'navigationProperties' saved successfully")},(e,t)=>{const a=Object.keys(e)[0];const s=new p(`Bag save failed: ${e[a]}`,{info:t[a],otherMessages:e,otherInfo:t});r.error("Bag save failed",s,"sap.ushell.components.tiles.applauncher.StaticTile.controller");i.reject(s)})},f);e.destroy();return i.promise()},onCancelConfiguration:function(e){const i=e.getViewData();const a=e.getModel();const s=a.getProperty("/tileModel");const o=i.chip;const n=t.getAppLauncherConfig(o,o.configurationUi.isEnabled(),false);e.getModel().setData({config:n,nav:{navigation_target_url:""},tileModel:s},false);e.destroy()},formatters:{leanURL:a.getLeanURL.bind(a)}})});
//# sourceMappingURL=StaticTile.controller.js.map