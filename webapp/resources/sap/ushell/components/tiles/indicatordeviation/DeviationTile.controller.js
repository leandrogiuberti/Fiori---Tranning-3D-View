// Copyright (c) 2009-2025 SAP SE, All Rights Reserved
sap.ui.define(["sap/ushell/components/tiles/generic","sap/m/library"],(e,t)=>{"use strict";const i=t.ValueColor;const o=t.LoadState;const r=t.FrameType;const l=e.extend("sap.ushell.components.tiles.indicatordeviation.DeviationTile",{onInit:function(){this.KPI_VALUE_REQUIRED=true},doProcess:function(e,t){const i=this;let l;l=t.targetValue;let s=Number(e);this.setThresholdValues();if(this.oConfig.EVALUATION.SCALING==-2){s*=100}let a=this.isCurrencyMeasure(this.oConfig.EVALUATION.COLUMN_NAME);const n=sap.ushell.components.tiles.indicatorTileUtils.util.getLocaleFormattedValue(Number(s),this.oConfig.EVALUATION.SCALING,this.oConfig.EVALUATION.DECIMAL_PRECISION,a,this.CURRENCY_CODE);this.CALCULATED_KPI_VALUE=Number(e);const u={};const A=this.getThresholdsObjAndColor(t).returnColor;const h={value:Number(e),color:A};u.actualValueLabel=n.toString();u.actual=h;u.thresholds=[];u.thresholds=this.getThresholdsObjAndColor(t).arrObj;const C=this.DEFINITION_DATA.EVALUATION_VALUES;let c;if(this.DEFINITION_DATA.EVALUATION.VALUES_SOURCE=="MEASURE"){c=Number(l);if(this.oConfig.EVALUATION.SCALING==-2){c*=100}a=this.isCurrencyMeasure(this.oConfig.EVALUATION.COLUMN_NAME);l=sap.ushell.components.tiles.indicatorTileUtils.util.getLocaleFormattedValue(c,this.oConfig.EVALUATION.SCALING,this.oConfig.EVALUATION.DECIMAL_PRECISION,a,this.CURRENCY_CODE);u.targetValue=Number(c);u.targetValueLabel=l.toString()}else{for(let e=0;e<C.length;e++){if(C[e].TYPE==="TA"){c=Number(l);if(this.oConfig.EVALUATION.SCALING==-2){c*=100}a=this.isCurrencyMeasure(this.oConfig.EVALUATION.COLUMN_NAME);l=sap.ushell.components.tiles.indicatorTileUtils.util.getLocaleFormattedValue(c,this.oConfig.EVALUATION.SCALING,this.oConfig.EVALUATION.DECIMAL_PRECISION,a,this.CURRENCY_CODE);u.targetValue=Number(c);u.targetValueLabel=l.toString()}}}if(this.oConfig.EVALUATION.SCALING==-2){u.scale="%"}this._updateTileModel(u);if(this.DEFINITION_DATA.TILE_PROPERTIES.frameType==r.TwoByOne){i.getView().getViewData().parentController._updateTileModel(this.getTile().getModel().getData());i.getView().getViewData().deferredObj.resolve();sap.ushell.components.tiles.indicatorTileUtils.util.setUnsetCallInProgress(`${i.oConfig.TILE_PROPERTIES.id}defferedRight`,false)}else{this.oKpiTileView.oGenericTile.setState(o.Loaded)}this.setToolTip(A,s,"DT");if(!sap.ushell.components.tiles.indicatorTileUtils.util.isDualTile(this.oConfig)){if(i.chipCacheTime&&!sap.ushell.components.tiles.indicatorTileUtils.util.isDualTile(this.oConfig)){sap.ushell.components.tiles.indicatorTileUtils.util.scheduleFetchDataJob.call(this,this.oTileApi.visible.isVisible())}}},getThresholdsObjAndColor:function(e){try{const t={};t.arrObj=[];t.returnColor=i.Neutral;const o=this.DEFINITION_DATA.EVALUATION.GOAL_TYPE;let r;let l;let s;let a;if(o==="MI"){s=Number(e.criticalHighValue)||0;a=Number(e.warningHighValue)||0;if(s&&a){s=window.parseFloat(s);a=window.parseFloat(a);t.arrObj.push({value:s,color:i.Error});t.arrObj.push({value:a,color:i.Critical});if(this.CALCULATED_KPI_VALUE<a){t.returnColor=i.Good}else if(this.CALCULATED_KPI_VALUE<=s){t.returnColor=i.Critical}else{t.returnColor=i.Error}}}else if(o==="MA"){l=Number(e.criticalLowValue)||0;r=Number(e.warningLowValue)||0;if(l&&r){l=window.parseFloat(l);r=window.parseFloat(r);t.arrObj.push({value:l,color:i.Error});t.arrObj.push({value:r,color:i.Critical});if(this.CALCULATED_KPI_VALUE<l){t.returnColor=i.Error}else if(this.CALCULATED_KPI_VALUE<=r){t.returnColor=i.Critical}else{t.returnColor=i.Good}}}else{s=Number(e.criticalHighValue)||0;a=Number(e.warningHighValue)||0;l=Number(e.criticalLowValue)||0;r=Number(e.warningLowValue)||0;if(r&&a&&l&&l){s=window.parseFloat(s);a=window.parseFloat(a);r=window.parseFloat(r);l=window.parseFloat(l);t.arrObj.push({value:s,color:i.Error});t.arrObj.push({value:a,color:i.Critical});t.arrObj.push({value:r,color:i.Critical});t.arrObj.push({value:l,color:i.Error});if(this.CALCULATED_KPI_VALUE<l||this.CALCULATED_KPI_VALUE>s){t.returnColor=i.Error}else if(this.CALCULATED_KPI_VALUE>=l&&this.CALCULATED_KPI_VALUE<=r||this.CALCULATED_KPI_VALUE>=a&&this.CALCULATED_KPI_VALUE<=s){t.returnColor=i.Critical}else{t.returnColor=i.Good}}}return t}catch(e){this.logError(e)}},doDummyProcess:function(){const e=this;this.setTextInTile();e._updateTileModel({actual:{value:120,color:i.Good},targetValue:100,thresholds:[{value:0,color:i.Error},{value:50,color:i.Critical},{value:150,color:i.Critical},{value:200,color:i.Error}],showActualValue:true,showTargetValue:true});this.oKpiTileView.oGenericTile.setState(o.Loaded)}});return l});
//# sourceMappingURL=DeviationTile.controller.js.map