// Copyright (c) 2009-2025 SAP SE, All Rights Reserved
sap.ui.define([],()=>{"use strict";const e={};e.CURRENTLY_HIGHLIGHTED_DOM_REFS=[];e.MUTATION_OBSERVER=window.MutationObserver||window.WebKitMutationObserver||window.MozMutationObserver;function t(e,t){this._bIsCaseSensitive=!!t.isCaseSensitive;this._aPreviouslyHighlightedNodes=[];this._aPreviouslyOriginalNodes=[];this._aOldTerms=[];this._aRegExTerms=[];this._bUseExternalStyles=!!t.useExternalStyles;this._oObserver=null;this._sQuerySelector=t.querySelector;if(Array.isArray(e)){this._oDomRef=e}else{this._oDomRef=[e]}if(t.shouldBeObserved){this._addMutationObserver()}}t.prototype.highlight=function(e){if(!e){this._aRegExTerms=[];this._aOldTerms=[];return}const t=this._formatTerms(e);if(!t||!t.length||this._isNewTermsSameAsOld(t)){return}this._aOldTerms=t;this._cacheRegExTerms();this._toggleMutationObserver(false);this._oDomRef.forEach(function(e){this._highlightSubTree(e)},this);this._toggleMutationObserver(true)};t.prototype._cacheRegExTerms=function(){let e;this._aRegExTerms=[];this._aOldTerms.forEach(function(t){t=this._escapeRegExp(t);e=this._bIsCaseSensitive?new RegExp(t,"g"):new RegExp(t,"gi");this._aRegExTerms.push(e)},this)};t.prototype._escapeRegExp=function(e){return e.replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&")};t.prototype._isNewTermsSameAsOld=function(e){const t=this._aOldTerms.length;let s;if(t!==e.length){return false}for(s=0;s<t;s++){if(this._aOldTerms[s]!==e[s]){return false}}return true};t.prototype._highlightSubTree=function(e){let t;let s;let i;if(e===this._oDomRef[0]&&this._sQuerySelector){i=this._oDomRef[0].querySelectorAll(this._sQuerySelector)}else{i=e.childNodes}for(s=0;s<i.length;s++){t=i[s];this._processNode(t)}};t.prototype._processNode=function(e){let t;let s;let i;let r;let o;let n;let l;let h;let a;let u;if(e.nodeType===document.ELEMENT_NODE){this._highlightSubTree(e)}else if(e.nodeType===document.TEXT_NODE){t=e.data;o=Object.create(null);h=[];for(i=0;i<this._aRegExTerms.length;i++){s=this._aRegExTerms[i];while((l=s.exec(t))!==null){a=l.index;if(h.indexOf(a)===-1){n=l["0"];o[a]=n;for(r=a;r<a+n.length;r++){h.push(r)}}}}if(Object.keys(o).length!==0){u=this._createHighlightedNode(o,t);this._replaceNode(e,u)}}};t.prototype._formatTerms=function(e){const t=e&&e.replace(/\s+/g," ").trim().split(" ");const s=t.reduce((e,t)=>{if(e.indexOf(t)===-1){e.push(t)}return e},[]);return s.sort((e,t)=>t.length-e.length)};t.prototype._replaceNode=function(e,t){if(e.parentNode&&e.parentNode.closest&&e.parentNode.closest(this._sQuerySelector)){e.parentNode.replaceChild(t,e);this._aPreviouslyHighlightedNodes.push(t);this._aPreviouslyOriginalNodes.push(e)}};t.prototype._restorePreviouslyHighlightedNodes=function(){let e;let t;this._toggleMutationObserver(false);for(let s=0;s<this._aPreviouslyHighlightedNodes.length;s++){e=this._aPreviouslyHighlightedNodes[s];t=this._aPreviouslyOriginalNodes[s];if(e.parentNode){e.parentNode.replaceChild(t,e)}}this._aPreviouslyHighlightedNodes=[];this._aPreviouslyOriginalNodes=[];this._toggleMutationObserver(true)};t.prototype._createHighlightedNode=function(e,t){const s=document.createElement("span");const i=[];function r(e,t){return e>t}const o=Object.keys(e).sort(r);let n;let l=0;for(let s=0;s<o.length;s++){const r=Number(o[s]);const n=e[r];const h=n.length;const a=t.substring(l,r);if(a.length){i.push(a)}i.push(n);l=r+h}if(l<t.length){i.push(t.substring(l))}for(n in i){const t=document.createElement("span");t.innerText=i[n];if(Object.values(e).indexOf(i[n])>-1){t.classList.add("defaultHighlightedText")}s.appendChild(t)}return s};t.prototype._addMutationObserver=function(){this._instantiateMutationObserver();this._toggleMutationObserver(true)};t.prototype._removeMutationObserver=function(){this._toggleMutationObserver(false);this._oObserver=null;this._oDomRef=[]};t.prototype._toggleMutationObserver=function(e){if(e){this._oDomRef.forEach(function(e){this._oObserver.observe(e,this.oObserverConfig)},this)}else if(this._oObserver){this._oObserver.disconnect()}};t.prototype._bIsDomNodeDescendant=function(e,t){return e.contains(t)};t.prototype._instantiateMutationObserver=function(){this.oObserverConfig={attributes:false,childList:true,characterData:true,subtree:true};this._oObserver=new e.MUTATION_OBSERVER(this._onMutationDetectionCallback.bind(this))};t.prototype._onMutationDetectionCallback=function(e){let t;let s;this._toggleMutationObserver(false);e.forEach(function(e){if(e.type==="childList"){t=e.addedNodes;for(let e=0;e<t.length;e++){s=t[e];this._processNode(s)}}else if(e.type==="characterData"){this._processNode(e.target)}},this);this._toggleMutationObserver(true)};t.prototype.destroy=function(){this._removeMutationObserver()};return t});
//# sourceMappingURL=Highlighter.js.map