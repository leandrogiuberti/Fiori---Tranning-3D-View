// Copyright (c) 2009-2025 SAP SE, All Rights Reserved
sap.ui.define(["sap/ui/core/Control","sap/ui/model/json/JSONModel","sap/m/Title","sap/m/List","sap/m/CustomListItem","sap/m/FlexBox","sap/m/Avatar","sap/m/ObjectIdentifier","sap/m/OverflowToolbar","sap/m/ToolbarSpacer","sap/m/Button","sap/m/SegmentedButton","sap/m/SegmentedButtonItem","sap/m/IllustratedMessage","sap/ushell/components/cepsearchresult/app/util/controls/Paginator","sap/ushell/components/cepsearchresult/app/util/appendStyleVars","sap/ushell/components/cepsearchresult/app/util/resources","sap/ui/dom/includeStylesheet","sap/ushell/components/cepsearchresult/app/util/controls/Highlighter","sap/ui/core/ResizeHandler","sap/m/library"],(t,e,i,s,o,a,r,n,h,l,u,c,p,g,d,f,_,m,y,C,S)=>{"use strict";f(["sapUiShadowLevel0","sapUiElementBorderCornerRadius","sapUiContentLabelColor","sapUiMarginSmall","sapUiMarginMedium","sapUiMarginTiny","sapUiListBorderColor","sapUiListBackground","sapUiLink","sapMFontMediumSize","sapUiIndication8HoverBackground","sapUiButtonCriticalBackground","sapUiAccentBackgroundColor10","sapUiButtonNegativeActiveBackground","sapUiButtonSuccessActiveBackground","sapUiButtonNeutralBackground","sapUiTileBackground","sapUiExtraLightBG","sapUiButtonLiteActionSelectHoverBackground"]);m(sap.ui.require.toUrl("sap/ushell/components/cepsearchresult/app/util/controls/Category.css"));const w=S.IllustratedMessageType;const T={tile:190,card:400};n.prototype._handlePress=function(t){const e=t.target;if(this.getTitleActive()&&this.getDomRef().querySelector(".sapMObjectIdentifierTitle").contains(e)){this.fireTitlePress({domRef:e});t.setMarked()}};const I=t.extend("sap.ushell.components.cepsearchresult.app.util.controls.Category",{constructor:function(e,i,s){this._oCategoryConfig=e;t.apply(this,[s])},metadata:{properties:{pageSize:{type:"int",defaultValue:10},showHeader:{type:"boolean",defaultValue:true},showFooter:{type:"boolean",defaultValue:true},allowViewSwitch:{type:"boolean",defaultValue:true},currentView:{type:"string",defaultValue:"categoryDefault"},highlightResult:{type:"boolean",defaultValue:true},useIllustrations:{type:"boolean",defaultValue:false},initialPlaceholder:{type:"boolean",defaultValue:false}},aggregations:{_header:{type:"sap.ui.core.Control",multiple:false},_list:{type:"sap.ui.core.Control",multiple:false},_footer:{type:"sap.ui.core.Control",multiple:false},_nodata:{type:"sap.ui.core.Control",multiple:false}},events:{itemNavigate:{},viewAll:{},beforeSearch:{},afterSearch:{},afterRendering:{}}},renderer:function(t,e){t.openStart("div",e);t.class("sapUiCEPSearchCat");t.openEnd();const i=e.getAggregation("_header");const s=e.getAggregation("_list");const o=e.getAggregation("_footer");const a=e.getAggregation("_nodata");if(i){t.renderControl(i)}if(e.getUseIllustrations()&&a&&a.getVisible()){t.renderControl(a)}else if(s){t.renderControl(s)}if(o){t.renderControl(o)}t.close("div")}});I._iDataRefreshMs=1e9;I._iCountRefreshMs=1e9;I.CustomListItem=o.extend("sap.ushell.components.cepsearchresult.app.util.controls.Category.CustomListItem",{renderer:o.getMetadata().getRenderer()});I.CustomListItem.prototype.onAfterRendering=function(){if(o.prototype.onAfterRendering){o.prototype.onAfterRendering.apply(this,arguments);const t=this.getDomRef();const e=this.getParent().getParent().getPaginator();if(!t||!e){return}t.setAttribute("aria-setsize",e.getCount());t.setAttribute("aria-posinset",(e.getCurrentPage()-1)*e.getPageSize()+parseInt(t.getAttribute("aria-posinset"),10))}this._activeHandling(this.$())};I.CustomListItem.prototype._activeHandling=function(t){t.removeClass("sapMLIBActive");t.removeClass("sapMLIBActionable");t.removeClass("sapMLIBHoverable");t.toggleClass("sapUiCEPSearchCatLIActive",this._active);if(this.isActionable(true)){t.toggleClass("sapUiCEPSearchCatLIHoverable",!this._active)}};I.SearchResultList=s.extend("sap.ushell.components.cepsearchresult.app.util.controls.Category.SearchResultList",{renderer:s.getMetadata().getRenderer()});I.SearchResultList.prototype._getCurrentColCount=function(){if(this.getDomRef()){const t=this.getDomRef().querySelectorAll(".sapMListItems > LI");let e=1;const i=t[0].offsetTop;for(let s=1;s<t.length&&t[s].offsetTop<=i;s++){e++}return e}};I.SearchResultList.prototype._startItemNavigation=function(){s.prototype._startItemNavigation.apply(this,[false]);const t=this._getCurrentColCount();const e=Array.from(this.getDomRef().querySelectorAll(".sapMGT"));if(this._oItemNavigation&&t>1&&e.length>0){this._oItemNavigation.setTableMode(false,true).setColumns(t)}else if(this._oItemNavigation){this._oItemNavigation.setTableMode(false,true).setColumns(t)}};I.prototype.init=function(){this.setModel(_.model,"i18n");this.setModel(new e({}),"data");this._iCurrentCount=0;this._oDirty={iDataFetchRequired:0,iCountFetchRequired:0};this._oNoDataIllustration=null;this._oErrorIllustration=null;this._iCurrentHeight=0;this._iAfterRendering=0;this._iAfterRenderingEventDelay=60;this._oPaginator=null;this.addContent()};I.prototype.getPaginator=function(){return this._oPaginator};I.prototype.addContent=function(){this.setAggregation("_header",this.createHeader());this.setAggregation("_list",this.createList());this.setAggregation("_footer",this.createFooter())};I.prototype.getKey=function(){return this._oCategoryConfig.name};I.prototype.translate=function(t,e){const i=this._oCategoryConfig.translation;return _.bundle.getText(`${i}.${t}`,e||[])};I.prototype.updateDataModel=function(t){this.setModel(new e(t),"data")};I.prototype.initialData=function(t){const e=this.getModel("data");if(!e&&this.getInitialPlaceholder()&&this.getPlaceholderData()){const e=[];for(let i=0;i<t;i++){e.push(this.getPlaceholderData())}this.updateDataModel({data:e})}};I.prototype.resetDataRequired=function(t,e,i){if(this._bResetData){this._sSearchTerm=t;this._iSkip=e;this._iTop=i;return true}const s=this.getVisible();if(this._sSearchTerm===t&&(this._iSkip===e&&this._iTop===i&&(s&&this._oDirty.iDataFetchRequired>Date.now()))||!s&&this._oDirty.iCountFetchRequired>Date.now()){return false}this._sSearchTerm=t;this._iSkip=e;this._iTop=i;return true};I.prototype.resetData=function(){this._bResetData=true;this.updateDataModel({})};I.prototype.search=function(t,e,i,s){i=isNaN(i)||i<0?this._iTop||this.getPageSize():i;e=isNaN(e)||e<0?this._iSkip||0:e;if(typeof t!=="string"){t=this.getSearchTerm()}const o=this.getVisible();const a=this._sSearchTerm!==t;let r;const n=this.getModel("data").getData()||{};if(!s&&!this.resetDataRequired(t,e,i)){this.fireFetchEvent("before","skipped",n);this.fireFetchEvent("after","skipped",n);return}this._iCurrentCount=0;this._bResetData=false;this._bIsLoading=true;this.fireFetchEvent("before",o?"data":"count",performance.now(),n);if(o){this.setNoDataText(this.translate("LoadingData"),"Loading");this.initialData(i);this.showLoadingPlaceholder(true);this._oDirty.iDataFetchRequired=Date.now()+I._iDataRefreshMs;r=this.fetchData(t,e,i);r=r.then(this.applyDataChange.bind(this,a))}else{r=this.fetchCount(t,e,i);r=r.then(this.applyCount.bind(this))}this._oDirty.iCountFetchRequired=Date.now()+I._iCountRefreshMs;if(r){r.then(t=>{this._iCurrentCount=t.count||0;setTimeout(()=>{this.setNoDataText(this.translate("NoData"),"NoData")},100);this.fireFetchEvent("after",o?"data":"count",t)})}};I.prototype.getMaxRowItemsAsync=function(){if(!this.getDomRef()){return new Promise(t=>{setTimeout(()=>{t(this._getMaxRowItems())},200)})}return Promise.resolve(this._getMaxRowItems())};I.prototype._getMaxRowItems=function(){if(this.getDomRef()){const t=this.getDomRef().clientWidth;return Math.floor(t/(T[this.getCurrentView()]||t))}return 1};I.prototype.applyDataChange=function(t,e){const i={count:e.count,top:this.getPageSize(),skip:this._iSkip,page:Math.floor(this._iSkip/this.getPageSize())+1,data:e.data};this.showLoadingPlaceholder(false,()=>{this.updateDataModel(i);this.fixHeight(t)});return i};I.prototype.applyCount=function(t){const e={count:t.count,top:this._iTop,skip:this._iSkip,page:Math.floor(this._iSkip/this._iTop)+1,data:[]};this.updateDataModel(e);return e};I.prototype.fireFetchEvent=function(t,e,i){const s={count:i?i.count||0:0,category:this.getKey(),top:this._iTop,skip:this._iSkip,page:this._iSkip/this._iTop+1,searchTerm:this._sSearchTerm,visible:this.getVisible(),time:performance.now(),fetchType:e};if(t==="before"){this.fireBeforeSearch(s)}else if(t==="after"){this.fireAfterSearch(s)}};I.prototype.fetchData=function(t,e,i){return Promise.resolve({data:[],count:0})};I.prototype.fetchCount=function(t,e,i){return Promise.resolve({data:[],count:0})};I.prototype.showLoadingPlaceholder=function(t,e){if(t){if(this._iShowLoader){clearTimeout(this._iShowLoader)}this._iShowLoader=setTimeout(()=>{this._oList.addStyleClass("loading")},200)}else if(this._iShowLoader){clearTimeout(this._iShowLoader);this._iShowLoader=setTimeout(()=>{this._oList.removeStyleClass("loading");if(e){e()}this.invalidate();this._bIsLoading=false},this._oList.hasStyleClass("loading")?100:0)}};I.prototype.isLoading=function(){return this._bIsLoading};I.prototype.getPlaceholderData=function(){return{text:" ",description:" "}};I.prototype.refreshData=function(){this._oDirty.iDataFetchRequired=0;this.search(this.getSearchTerm(),0,this.getPageSize())};I.prototype.bindListViewItems=function(t){const e=this.getItemTemplate(t);this._oList.addStyleClass(t);this._oList.bindItems({path:"data>/data",template:e,templateShareable:false})};I.prototype.setNoDataText=function(t,e){this.updateIllustration(t,"Hide");if(this._oList&&!this.bPaging){this._oList.setNoDataText(" ");this.updateIllustration(t,e);this._oList.setNoDataText(t)}};I.prototype.getItemTemplate=function(t){let e=null;switch(t){case"card":e=this.createCardItemTemplate();break;case"tile":e=this.createTileItemTemplate();break;default:e=this.createListItemTemplate()}return e.addStyleClass(`sapUiCEPSearchCatLI ${t} ${this.getKey()}`)};I.prototype.setFooter=function(t){if(t==="viewAll"){this.setAggregation("_footer",this.createFooter(t))}};I.prototype.focusCategory=function(){if(!this.bPaging){this._forceFocus="parent"}this.bPaging=false};I.prototype.createHeader=function(){this._oHeader=new h({content:[new l({width:".5rem"}),this.createTitle(),this.createCounter(),new l,this.createViewButtons(),new l({width:"1rem"})]}).addStyleClass("sapUiCEPSearchCatHeaderTB");return this._oHeader};I.prototype.getPaginatorSettings=function(){return{visible:true,count:"{= ${data>/count}}",pageSize:"{= ${data>/top}}",currentPage:"{= ${data>/page}}",selectPage:function(t){this.fixHeight();this.bPaging=true;this._forceFocus="page";this._forceFocusPage=t.mParameters.page;this.search(this.getSearchTerm(),t.getParameter("startIndex"),t.getParameter("pageSize"))}.bind(this)}};I.prototype.getSearchTerm=function(){return this._sSearchTerm||""};I.prototype.getResultCount=function(){return this.getModel("data").getProperty("/count")};I.prototype.getViewSettings=function(){return{views:[{key:"list",icon:"sap-icon://text-align-justified"},{key:"card",icon:"sap-icon://business-card"}],default:"list"}};I.prototype.getDefaultIcon=function(){return this._oCategoryConfig.icon.src};I.prototype.getCurrentView=function(){const t=this.getProperty("currentView");if(t==="categoryDefault"){this.setProperty("currentView",this.getViewSettings().default);return this.getViewSettings().default}return t};I.prototype.setShowHeader=function(t){this._oHeader.setVisible(t);this._oList.removeStyleClass("noheader");if(!t){this._oList.addStyleClass("noheader")}return this.setProperty("showHeader",t)};I.prototype.setShowFooter=function(t){this.getAggregation("_footer").setVisible(t);return this.setProperty("showFooter",t)};I.prototype.setAllowViewSwitch=function(t){this._oViewSwitch.setVisible(t&&this._oViewSwitch.getItems().length>1);return this.setProperty("allowViewSwitch",t)};I.prototype.setCurrentView=function(t){const e=this.getCurrentView();if(e!==t){this._oList.unbindItems();this.setProperty("currentView",t);t=this.getCurrentView();this._oViewSwitch.setSelectedKey(t);this._oList.removeStyleClass(e);this.bindListViewItems(t);this._oList.addStyleClass(t);this._iCurrentHeight=0;this.search(this._sSearchTerm,this._iSkip,this.iTop,true)}return this};I.prototype.setPageSize=function(t){this.setProperty("pageSize",t);if(this.getDomRef()){this.refreshData()}return this};I.prototype.createCounter=function(){return new i({text:"{= isNaN(${data>/count}) ? '...' : '('+ ${data>/count} + ')'}",level:"H4"})};I.prototype.createTitle=function(){this._oTitle=new i({text:this._oCategoryConfig.title,level:"H4"});return this._oTitle};I.prototype.createList=function(){this._oList=new I.SearchResultList({inset:false,noDataText:" ",growing:true,growingThreshold:"{= ${data>/count}}"});this._oList.addStyleClass("sapUiCEPSearchCatList");this.bindListViewItems(this.getCurrentView());return this._oList};I.prototype.createViewButtons=function(){const t=this.getViewSettings();const e=t.views.map(t=>{const e=t.key.charAt(0).toUpperCase()+t.key.slice(1);t.tooltip=`{i18n>CATEGORY.Views.${e}ButtonTooltip}`;return new p(t)});this._oViewSwitch=new c({selectedKey:this.getCurrentView(),visible:e.length>1,items:e,selectionChange:function(t){const e=t.getParameter("item");this.setCurrentView(e.getKey())}.bind(this)});return this._oViewSwitch};I.prototype.createDefaultItemTemplate=function(){const t=new r(this.getItemAvatarSettings()).addStyleClass("sapUiSmallMarginBegin");const e=new I.CustomListItem({press:this.itemNavigate.bind(this),type:"Active",content:[new a({direction:"Column",items:[new a({direction:"Row",items:[t,this.getItemObjectIdentifier()]})]})]});return e};I.prototype.getItemObjectIdentifier=function(){return new n(this.getItemObjectIdentifierSettings()).addStyleClass("sapUiSmallMarginBeginEnd")};I.prototype.getItemObjectIdentifierSettings=function(){return{text:"{data>description}",title:"{data>title}",titleActive:"{= !!${data>_navigation} || !!${data>url}}",titlePress:this.itemNavigate.bind(this)}};I.prototype.getItemAvatarSettings=function(t){return{fallbackIcon:this._oCategoryConfig.icon.src,src:t||"{data>icon}",displaySize:this._oCategoryConfig.icon.size,displayShape:this._oCategoryConfig.icon.shape,imageFitType:this._oCategoryConfig.icon.imageFitType||"Contain",backgroundColor:this._oCategoryConfig.icon.backgroundColor}};I.prototype.createListItemTemplate=function(){return this.createDefaultItemTemplate().addStyleClass("list")};I.prototype.createCardItemTemplate=function(){return this.createListItemTemplate().addStyleClass("card")};I.prototype.createTileItemTemplate=function(){return this.createListItemTemplate().addStyleClass("tile")};I.prototype.createFooter=function(t){if(t==="viewAll"){this._oFooter=new h({style:"Clear",content:[new l,new u({text:"{i18n>CATEGORIES.All.ViewAll}",press:function(){this.fireViewAll({key:this.getKey(),currentView:this.getCurrentView()})}.bind(this)}),new l({width:"1rem"})]}).addStyleClass("sapCEPCategoryFooterTB")}else{this._oPaginator=new d(this.getPaginatorSettings());this._oFooter=new h({style:"Clear",content:[new l,this._oPaginator]}).addStyleClass("sapCEPCategoryFooterTB")}return this._oFooter};I.prototype.itemNavigate=function(t){};I.prototype.updateIllustration=function(t,e){if(!this.getUseIllustrations()){return}if(!this._oNoDataIllustration){this._oNoDataIllustration=new g({illustrationType:w.NoSearchResults,enableDefaultTitleAndDescription:false,illustrationSize:"Spot",additionalContent:[new u({text:_.bundle.getText("CATEGORY.Views.RefreshButton"),visible:false,press:function(){this.fixHeight();setTimeout(()=>{this.refreshData()},600);this.updateIllustration(this.translate("LoadingData"),"Loading")}.bind(this)})]});this._oNoDataIllustration.addStyleClass("sapUiCEPSearchCatNoDataIllustration")}if(this._iCurrentCount===0){if(e==="NoData"){if(this._iCurrentCount===0){this._oNoDataIllustration.setTitle(t);this._oNoDataIllustration.setIllustrationType(w.NoSearchResults);this.setAggregation("_nodata",this._oNoDataIllustration);this._oNoDataIllustration.getAdditionalContent()[0].setVisible(true)}}else if(e==="Loading"){if(this._iCurrentCount===0){this._oNoDataIllustration.setTitle(t);this._oNoDataIllustration.setIllustrationType(w.NoSearchResults);this.setAggregation("_nodata",this._oNoDataIllustration);this._oNoDataIllustration.getAdditionalContent()[0].setVisible(false)}}}else{this.setAggregation("_nodata",null)}};I.prototype.fixHeight=function(t){if(!this.getDomRef()){return}if(t){this.getDomRef().style.setProperty("--tmpPageSize","unset");this._iCurrentHeight=0;return}if(this._oList&&this._oList.getVisible()&&this._oList.getDomRef()){this._iCurrentHeight=Math.max(this._oList.getDomRef().offsetHeight,this._iCurrentHeight)}if(this._iCurrentHeight){this.getDomRef().style.setProperty("--tmpPageSize",`${this._iCurrentHeight}px`)}};I.prototype.onResize=function(t){if(this._oList&&this._oList._oItemNavigation){this._oList._oItemNavigation.setColumns(this._oList._getCurrentColCount())}this.fixHeight(true);if(Math.abs(t.oldSize.width-t.size.width)>50){if(this._iResizeTimer){clearTimeout(this._iResizeTimer)}this._iResizeTimer=setTimeout(()=>{this.search(this._sSearchTerm,this._iSkip,this._iTop)},300)}if(t.oldSize&&t.size&&t.oldSize.width!==t.size.width){this._iCurrentHeight=0}};I.prototype.onBeforeRendering=function(){if(this._oHighlighter){this._oHighlighter.destroy()}this._oHighlighter=null;if(this._iResizeListenerId){C.deregister(this._iResizeListenerId);this._iResizeListenerId=null}};I.prototype.onAfterRendering=function(){if(!this._iResizeListenerId){this._fnResizeListener=this.onResize.bind(this);this._iResizeListenerId=C.register(this,this._fnResizeListener)}if(!this._oHighlighter&&this.getHighlightResult()){this._oHighlighter=new y(this.getDomRef(),{isCaseSensitive:false,shouldBeObserved:true,querySelector:".sapUiCEPSearchCatLI"});this._oHighlighter.highlight(this.getSearchTerm())}this.fixHeight();if(this._iAfterRendering){clearTimeout(this._iAfterRendering)}this._iAfterRendering=setTimeout(()=>{this.fireAfterRendering.bind(this)();this._iAfterRendering=null;const t=this.getDomRef();const e=this.get_header();const i=this.getPaginator();if(t&&e){const s=e.getContent()[1].getText();const o=e.getContent()[2].getText();const a=[s,o,i?_.bundle.getText("CATEGORY.Views.PageTooltip",[i.getCurrentPage(),i.getCount()]):""].join(" ");t.setAttribute("aria-label",a);t.setAttribute("tabIndex","0");if(this._forceFocus==="parent"){t.focus();this._forceFocus=""}}if(this._forceFocus==="parent"){if(t){t.focus();this._forceFocus=""}}else if(this._forceFocus==="page"){i?.focusPage(this._forceFocusPage);this._forceFocusPage=null;this._forceFocus=""}},this._iAfterRenderingEventDelay)};return I});
//# sourceMappingURL=Category.js.map