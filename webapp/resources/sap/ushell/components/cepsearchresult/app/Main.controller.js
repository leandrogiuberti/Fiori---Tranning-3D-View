// Copyright (c) 2009-2025 SAP SE, All Rights Reserved
sap.ui.define(["sap/ui/core/mvc/Controller","sap/ui/core/Core","sap/ui/model/json/JSONModel","sap/ushell/components/cepsearchresult/app/util/Edition","sap/ushell/components/cepsearchresult/app/util/resources","sap/m/library","sap/m/Menu","sap/m/MenuItem","sap/ushell/ui/footerbar/AddBookmarkButton","sap/f/GridContainerItemLayoutData","sap/ushell/EventHub","sap/ushell/Container"],(e,t,s,i,o,a,n,r,h,c,l,u)=>{"use strict";const g=a.URLHelper;return e.extend("sap.ushell.components.cepsearchresult.app.Main",{totalCounts:{},onInit:function(){this._sSearchTerm="";this._iTotalCount=0;this._oTabBar=this.byId("searchCategoriesTabs");this._oCountModel=new s(this.totalCounts);this._oTabBar.setModel(this._oCountModel,"counts");this.updateTitles();this.applyPersonalization();this.getView().setVisible(false);const e=u?.getRendererInternal("fiori2");if(e&&e.getRouter&&e.getRouter()){this._oRouter=e.getRouter();this._oRouter.getRoute("wzsearch").attachMatched(this.onRouteMatched.bind(this))}this.changeEdition(i.getEditionName())},getResourceModel:function(){return this.getOwnerComponent().getModel("appI18n")},getResourceBundle:function(){return this.getOwnerComponent().getResourceBundle()},onRouteMatched:function(e){const t=e.getParameter("arguments");const s=t["?query"];const i=s&&s.searchTerm;const o=s&&s.category;this._oEdition.loaded().then(()=>{if(i!==this.getSearchTerm()&&o===this.getCategory()){this.changeSearchTerm(i)}else if(o!==this.getCategory()){if(i!==this.getSearchTerm()){this._sSearchTerm=i}this.changeCategory(o)}this.getView().setVisible(true);l.emit("CloseFesrRecord",Date.now())})},changeEdition:function(e){if(e===this._sEditionName){return Promise.resolve()}this._sEditionName=e;this._oEdition=new i(this._sEditionName);return this._oEdition.loaded().then(()=>{const e=this._oEdition.getDefaultCategory();this._sCategory=e.getKey();this.updateTabs();if(!this._oRouter){this.updateCategories(true)}this.getView().setVisible(true)})},changeCategory:function(e){this._sCategory=e;this.updateTabs()},changeSearchTerm:function(e){this._sSearchTerm=e;this.updateCategories(true)},getEditionName:function(){return this._sEditionName},getSearchTerm:function(){return this._sSearchTerm},getCategory:function(){return this._sCategory},applyPersonalization:function(){},getPersonalization:function(e,t){const s=localStorage.getItem(`sap.ushell.components.cepsearchresult.app-${e}`);return Promise.resolve(s!==undefined?s:t)},setPersonalization:function(e,t){localStorage.setItem(`sap.ushell.components.cepsearchresult.app-${e}`,`${t}`)},updateTabs:function(){const e=this._oTabBar;e.removeAllItems();this._oEdition.getAppMenuItems().map(t=>{e.addItem(t)});e.setModel(o.model,"i18n");e.setSelectedKey(this.getCategory());e.setVisible(e.getItems().length>2);this.totalCounts={};this._oCountModel.setData(this.totalCounts);this.updateTitles()},updateCategories:function(e){const t=this._oTabBar;const s=t.getSelectedKey();t.getItems().map(t=>{const i=t.getKey();const o=t._getCategoryInstance();if(e){this.detachCategory(o);o.resetData()}if(i===s){this.showCategory(o)}o.setVisible(i===s);this.updateResult(o)})},tabSelectionChange:function(e){this.updateCategories(false)},showCategory:function(e){const t=this.byId("searchResultContent");t.removeAllItems();e.setLayoutData(new c({columns:16,minRows:2}));t.addItem(e)},updateTitles:function(){let e=0;for(const t in this.totalCounts){if(t!=="all"){e+=this.totalCounts[t]}}this.totalCounts.all=e;this.updateAppTitle(e);this._oCountModel.checkUpdate(true,true)},updateAppTitle:function(e){const t=this.byId("titleText");if(!t){return}let s="...";if(Number.isInteger(e)){s=`(${e})`}t.setText(this.getResourceBundle().getText("SEARCHRESULTAPP.HeaderTitle",[this.getSearchTerm()||"",s]))},updateResult:function(e){this.attachCategory(e);e.search(this.getSearchTerm())},attachCategory:function(e){if(!e._attached){e.attachAfterSearch(this.handleAfterSearch,this);e.attachViewAll(this.handleViewAll,this);e._attached=true}},detachCategory:function(e){if(e._attached){e.detachAfterSearch(this.handleAfterSearch,this);e.detachViewAll(this.handleViewAll,this);e._attached=false}},viewAll:function(e,t){this._oTabBar.setSelectedKey(e);const s=this._oTabBar;s.getItems().map(s=>{if(s.getKey()===e){s._getCategoryInstance().setCurrentView(t)}});this.updateCategories()},handleAfterSearch:function(e){this._oCountModel.setProperty(`/${e.getParameter("category")}`,e.getParameter("count"));const t=e.getSource();t.focusCategory();this.updateTitles();this.adaptScrollArea()},handleViewAll:function(e){this.viewAll(e.getParameter("key"),e.getParameter("currentView"))},adaptScrollArea:function(){if(this.getView().getDomRef()){const e=this.getView().getDomRef().querySelector(".sapUiCEPSRAppScroll");e.style.height=`calc( 100% - ${e.offsetTop}px )`}},openTitleMenu:function(e){if(!this._oTitleMenu){this._oTitleMenu=new n({items:[new r({text:"{appI18n>SEARCHRESULTAPP.TitleMenu.SaveAsTile}",icon:"sap-icon://header",press:this.triggerBookmark.bind(this),visible:false}),new r({text:"{appI18n>SEARCHRESULTAPP.TitleMenu.Email}",icon:"sap-icon://email",press:this.triggerEmail.bind(this)})]});this._oTitleMenu.setModel(this.getResourceModel(),"appI18n")}this._oTitleMenu.openBy(e.getSource())},triggerBookmark:function(){const e=this.getSearchTerm();const t=new h({title:this.getResourceBundle().getText("SEARCHRESULTAPP.Bookmark.Title",[e]),subtitle:"",tileIcon:"sap-icon://search",keywords:`search,result,${e}`,showGroupSelection:false,customUrl:document.location.hash});t.firePress()},triggerEmail:function(){g.triggerEmail("",this.getResourceBundle().getText("SEARCHRESULTAPP.EMail.Subject",[this.getSearchTerm()]),document.location.href)},onExit:function(){const e=this._oTabBar;e.getItems().map(e=>{const t=e._getCategoryInstance();this.detachCategory(t);t.resetData()})}})});
//# sourceMappingURL=Main.controller.js.map