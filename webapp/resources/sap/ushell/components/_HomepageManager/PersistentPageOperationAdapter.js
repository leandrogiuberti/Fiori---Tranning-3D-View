// Copyright (c) 2009-2025 SAP SE, All Rights Reserved
sap.ui.define(["sap/ui/base/Object","sap/ushell/Config","sap/ushell/resources","sap/ushell/components/MessagingHelper","sap/m/GenericTile","sap/base/util/uid","sap/base/Log","sap/ui/performance/Measurement","sap/m/library","sap/base/util/deepEqual","sap/ushell/Container"],(e,t,r,i,o,n,s,l,a,u,d)=>{"use strict";const c=a.GenericTileMode;const g=a.LoadState;const p=e.extend("sap.ushell.components._HomepageManager.PersistentPageOperationAdapter",{constructor:function(t){e.call(this);this.oPageBuilderService=t},_getIsAppBox:function(e){const t=this.oPageBuilderService;const r=!!(t.getCatalogTileTargetURL(e)&&(t.getCatalogTilePreviewTitle(e)||t.getCatalogTilePreviewSubtitle(e)));return r},getCurrentHiddenGroupIds:function(e){const t=e.getProperty("/groups");const r=[];let i;let o;let n;for(o=0;o<t.length;o++){n=t[o]?t[o].isGroupVisible:true;if(t[o].object){i=this.oPageBuilderService.getGroupId(t[o].object)}if(!n&&i!==undefined){r.push(i)}}return r},getPreparedTileModel:function(e,r,i){const s=this.oPageBuilderService;const l=n();const a=s.getTileSize(e);let u=[];let d;i=i||s.getTileType(e);if(i==="link"){u=[new o({mode:c.LineMode})]}const g={isCustomTile:!this._getIsAppBox(e),object:e,originalTileId:s.getTileId(e),uuid:l,tileCatalogId:encodeURIComponent(s.getCatalogTileId(e)),tileCatalogIdStable:s.getStableCatalogTileId(e)||"",content:u,long:a==="1x2",target:s.getTileTarget(e)||"",debugInfo:s.getTileDebugInfo(e),isTileIntentSupported:s.isTileIntentSupported(e),rgba:"",isLocked:r,showActionsIcon:t.last("/core/home/enableTileActionsIcon"),isLinkPersonalizationSupported:s.isLinkPersonalizationSupported(e),navigationMode:undefined};if(i==="card"){d=s.getCardManifest(e);g.isCard=true;if(d){g.manifest=d}}return g},getPreparedGroupModel:function(e,r,o,l){const a=this.oPageBuilderService;const u=e&&a.getGroupTiles(e)||[];const d=[];const c=[];let g;const p=t.last("/core/shell/model/personalization");const f=t.last("/core/extension/enableHelp");const h=!!(e&&a.isGroupLocked(e));const P=!!(e&&a.isGroupFeatured(e));for(g=0;g<u.length;++g){const e=u[g];const t=a.getTileType(e).toLowerCase();if(t==="tile"||t==="card"){d.push(this.getPreparedTileModel(u[g],h,t))}else if(t==="link"){c.push(this.getPreparedTileModel(u[g],h,t))}else{s.error(`Unknown tile type: '${t}'`,undefined,"sap.ushell.components.HomepageManager")}}return{title:r&&i.getLocalizedText("my_group")||e&&a.getGroupTitle(e)||l&&l.title||"",object:e,groupId:n(),helpId:f&&e?a.getGroupId(e):null,links:c,pendingLinks:[],tiles:d,isDefaultGroup:!!r,editMode:!e,isGroupLocked:h,isFeatured:P,visibilityModes:[true,true],removable:!e||a.isGroupRemovable(e),sortable:p,isGroupVisible:!e||a.isGroupVisible(e),isEnabled:!r,isLastGroup:o||false,isRendered:!!(l&&l.isRendered),isGroupSelected:false}},getPage:function(){l.start("FLP:DashboardManager.loadPersonalizedGroups","loadPersonalizedGroups","FLP");return this._getGroupsFromServer().then(this.loadGroupsFromArray.bind(this))},_getGroupsFromServer:function(){const e=this;return new Promise((t,r)=>{e.oPageBuilderService.getGroups().done(e=>{l.end("FLP:DashboardManager.loadPersonalizedGroups");t(e)}).fail(r)})},loadGroupsFromArray:function(e){const t=this;l.start("FLP:DashboardManager.loadGroupsFromArray","loadGroupsFromArray","FLP");l.start("FLP:DashboardManager.getDefaultGroup","getDefaultGroup","FLP");return new Promise((r,i)=>{t.oPageBuilderService.getDefaultGroup().done(i=>{l.end("FLP:DashboardManager.getDefaultGroup");if(e.length===0&&i===undefined){r([]);return}let o;const n=[];e=t._sortGroups(i,e);const s=e.findIndex(e=>u(e,i));const a=e.length;l.start("FLP:DashboardManager._getGroupModel","_getGroupModel","FLP");for(let r=0;r<a;++r){o=t.getPreparedGroupModel(e[r],r===s,r===a-1);o.index=r;n.push(o)}l.end("FLP:DashboardManager._getGroupModel");l.end("FLP:DashboardManager.loadGroupsFromArray");r(n)}).fail(i)})},_sortGroups:function(e,r){let i=0;const o=this;const n=r.findIndex(t=>u(t,e));const s=[];let l;let a;if(n>-1){r.splice(n,1)}while(i<r.length){l=r[i];a=this.oPageBuilderService.isGroupLocked(l);if(a){s.push(l);r.splice(i,1)}else{i++}}if(!t.last("/core/home/disableSortedLockedGroups")){s.sort((e,t)=>{const r=o.oPageBuilderService.getGroupTitle(e).toLowerCase();const i=o.oPageBuilderService.getGroupTitle(t).toLowerCase();return r<i?-1:1})}s.sort((e,t)=>{const r=o.oPageBuilderService.isGroupFeatured(e);const i=o.oPageBuilderService.isGroupFeatured(t);if(r===i){return 0}else if(r>i){return-1}return 1});const d=s;d.push(e);d.push.apply(d,r);return d},addGroupAt:function(e,t,r){const i=this;return new Promise((o,n)=>{try{if(t===undefined){i.oPageBuilderService.addGroup(e.title).done(t=>{o(i.getPreparedGroupModel(t,r,e.isLastGroup,undefined))}).fail(n)}else{i.oPageBuilderService.addGroupAt(e.title,t).done(t=>{o(i.getPreparedGroupModel(t,r,e.isLastGroup,undefined))}).fail(n)}}catch(e){n(e)}})},renameGroup:function(e,t,r){const i=this;return new Promise((r,o)=>{try{i.oPageBuilderService.setGroupTitle(e.object,t).done(()=>{r()}).fail(o)}catch(e){o(e)}})},deleteGroup:function(e){const t=this;const r=e.object;return new Promise((e,i)=>{try{t.oPageBuilderService.removeGroup(r).done(()=>{e()}).fail(i)}catch(e){i(e)}})},moveGroup:function(e,t,r){const i=this;return new Promise((r,o)=>{try{i.oPageBuilderService.moveGroup(e.object,t).done(()=>{r()}).fail(o)}catch(e){o(e)}})},resetGroup:function(e,t){const r=this;const i=e.object;return new Promise((o,n)=>{try{r.oPageBuilderService.resetGroup(i).done(n=>{o(r.getPreparedGroupModel(n||i,t,e.isLastGroup,undefined))}).fail(n)}catch(e){n(e)}})},refreshGroup:function(e){const t=this;const r=`Failed to refresh group with id:${e} in the model`;return new Promise(i=>{t.oPageBuilderService.getGroups().fail(e=>{s.error(r,e,"sap.ushell.components.HomepageManager");i(null)}).done(r=>{let o=null;for(let i=0;i<r.length;i++){if(t.oPageBuilderService.getGroupId(r[i])===e){o=r[i];break}}if(o){t.oPageBuilderService.getDefaultGroup().done(r=>{const n=e===r.getId();const s=t.getPreparedGroupModel(o,n,false,{isRendered:true});i(s)})}else{i(null)}})})},getIndexOfGroup:function(e,t){let r=-1;const i=this;const o=this.oPageBuilderService.getGroupId(t);e.every((e,t)=>{const n=i.oPageBuilderService.getGroupId(e.object);if(n===o){r=t;return false}return true});return r},getOriginalGroupIndex:function(e){const t=this.oPageBuilderService;const r=e.object;const i=this.oPageBuilderService.getGroups();return new Promise((e,o)=>{i.done(i=>{let o;for(let e=0;e<i.length;e++){if(t.getGroupId(i[e])===t.getGroupId(r)){o=e;break}}e(o)}).fail(o)})},moveTile:function(e,t,r,i,o){const n=this;let s;const l=new Promise((l,a)=>{try{const u=n.oPageBuilderService.moveTile(e.object,t.tileIndex,t.newTileIndex,r.object,i.object,o);u.done(e=>{s=e;l(e)});u.fail(a)}catch(e){a(e)}});return l.then(this._getTileViewAsPromise.bind(this)).then(e=>Promise.resolve({content:e,originalTileId:n.oPageBuilderService.getTileId(s),object:s}))},removeTile:function(e,t){const r=t.object;const o=this.oPageBuilderService.getTileTitle(r);return new Promise((t,n)=>{try{this.oPageBuilderService.removeTile(e.object,r).done(()=>{i.showLocalizedMessage("tile_deleted_msg",[o,e.title]);t()}).fail(n)}catch(e){n(e)}})},_getTileViewAsPromise:function(e){return new Promise((t,r)=>{const i=this.oPageBuilderService.getTileView(e);i.done(t);i.fail(r)})},refreshTile:function(e){this.oPageBuilderService.refreshTile(e)},setTileVisible:function(e,t){this.oPageBuilderService.setTileVisible(e,t)},getTileType:function(e){return this.oPageBuilderService.getTileType(e)},getTileSize:function(e){return this.oPageBuilderService.getTileSize(e)},getTileTitle:function(e){return this.oPageBuilderService.getTileTitle(e.object)},getTileId:function(e){return this.oPageBuilderService.getTileId(e)},isLinkPersonalizationSupported:function(e){return this.oPageBuilderService.isLinkPersonalizationSupported(e)},getTileTarget:function(e){return this.oPageBuilderService.getTileTarget(e.object)},getTileView:function(e){return this.oPageBuilderService.getTileView(e.object)},getTileActions:function(e){return this.oPageBuilderService.getTileActions(e)},getFailedLinkView:function(e){const t=this.oPageBuilderService.getCatalogTilePreviewSubtitle(e.object);let i=this.oPageBuilderService.getCatalogTilePreviewTitle(e.object);if(!i&&!t){i=r.i18n.getText("cannotLoadLinkInformation")}return new o({mode:c.LineMode,state:g.Failed,header:i,subheader:t})},getTileModelByCatalogTileId:function(e){s.error(`Cannot get tile with id ${e}: Method is not supported`)},transformGroupModel:function(){return}});let f=null;return{getInstance:function(e){if(!f){f=new p(e)}return f},destroy:function(){f=null}}});
//# sourceMappingURL=PersistentPageOperationAdapter.js.map