// Copyright (c) 2009-2025 SAP SE, All Rights Reserved
sap.ui.define(["sap/base/i18n/Localization","sap/ushell/utils/HttpClient","sap/ushell/Config"],(t,e,n)=>{"use strict";function s(){this.httpClient=new e;this._sBaseUrl=n.last("/core/workPages/contentApiUrl");const t=new URLSearchParams(window.location.search);this._sSiteId=t.get("siteId")||n.last("/core/site/siteId")}s.prototype.getCatalogs=function(){const t=this._getCatalogs();const e=[t];let n;let s;const a=new Promise((t,e)=>{n=t;s=e});t.then(t=>{let s=t.catalogs.length;const a=s;const o=t.totalCount;while(s<o){e.push(this._getCatalogs(s,a));s+=a}Promise.all(e).then(t=>{const e=t.reduce((t,e)=>t.concat(e.catalogs),[]);n({catalogs:e,totalCount:t[0].totalCount})})}).catch(t=>{s(t)});return a};s.prototype._getCatalogs=function(t,e,n){let s=`\n        getCatalogs ($siteId: String, $queryInput: QueryCatalogsInput!){\n            catalogs(siteId: $siteId, queryInput: $queryInput) {\n                totalCount,\n                nodes {\n                    id,\n                    descriptor { value }\n                    provider {\n                        id\n                    },\n                    systemLabel,\n                },\n            }\n        }`;s=s.replace(/\n/g,"").replace(/ /g,"");s=`query ${s}`;const a={...n};a.skip=t||0;if(e){a.top=e}const o={siteId:this._sSiteId,queryInput:a};return this._doRequest(s,JSON.stringify(o)).then(t=>{const e=[];if(t.data.catalogs){t.data.catalogs.nodes.forEach((t,n)=>{if(t.descriptor.value){let n={id:t.id,title:t.descriptor.value.title};if(t.provider?.id&&t.provider.id!=="SUB_ACCOUNT"){n={...n,contentProviderId:t.provider.id}}if(t.systemLabel){n={...n,contentProviderLabel:t.systemLabel}}e.push(n)}})}return{catalogs:e,totalCount:t.data.catalogs.totalCount||0}})};s.prototype.loadVisualizations=async function(t,e){if(!t){throw new Error("Catalog ID is mandatory")}let n=`\n        getCatalog($siteId: String, $filterQuery: QueryCatalogVisualizationsInput) {\n            catalog(siteId: $siteId, catalogId: "${t}") {\n                id,\n                descriptor { value },\n                visualizations(queryInput: $filterQuery) {\n                    totalCount,\n                    nodes{\n                        id,\n                        type,\n                        descriptor {\n                            value,\n                            schemaVersion\n                        },\n                        descriptorResources {\n                            baseUrl,\n                            descriptorPath\n                        },\n                        indicatorDataSource {\n                            url,\n                            refreshInterval\n                        },\n                        targetAppIntent {\n                            semanticObject,\n                            action,\n                            businessAppId\n                        },\n                        systemLabel\n                    }\n                }\n            }\n        }`;n=n.replace(/\n/g,"").replace(/ /g,"");n=`query ${n}`;const s={siteId:this._sSiteId,filterQuery:e};return this._doRequest(n,JSON.stringify(s)).then(t=>({visualizations:t.data?.catalog.visualizations||[],totalCount:t.data?.catalog.visualizations.totalCount||0}))};s.prototype._doRequest=function(e,s){let a=`${this._sBaseUrl}?query=${encodeURIComponent(e)}`;if(s){a+=`&variables=${encodeURIComponent(s)}`}const o={"Content-Type":"application/json",Accept:"application/json","Accept-Language":t.getLanguageTag().toString()};if(n.last("/core/site/sapCdmVersion")){o["sap-cdm-content-version"]=n.last("/core/site/sapCdmVersion")}return this.httpClient.get(a,{headers:o}).then(t=>{if(t.status<200||t.status>=300){throw new Error(`HTTP request failed with status: ${t.status} - ${t.statusText}`)}return JSON.parse(t.responseText||"{}")})};return s},true);
//# sourceMappingURL=CatalogService.js.map