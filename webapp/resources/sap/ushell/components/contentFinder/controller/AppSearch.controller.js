// Copyright (c) 2009-2025 SAP SE, All Rights Reserved
sap.ui.define(["./ContentFinderDialog.controller","../model/formatter","sap/ushell/Config","sap/base/Log","sap/m/library","sap/ushell/utils/WindowUtils","sap/ui/thirdparty/hasher","sap/ui/model/Filter","sap/ui/model/FilterOperator","sap/f/library"],(e,t,i,o,s,n,a,l,r,d)=>{"use strict";const c=d.LayoutType;const u=s.ListType;return e.extend("sap.ushell.components.contentFinder.controller.AppSearch",{formatter:t,onInit:function(){this.oComponent=this.getOwnerComponent();this.oUiModel=this.oComponent.getUiModel();this.oDataModel=this.oComponent.getDataModel();this.oSelectionModel=this.oComponent.getSelectionModel();this.byId("contentFinderAppSearchFlexibleColumnLayout").attachStateChange(this.onFlexibleColumnLayoutStateChange.bind(this));this.getView().setModel(this.oUiModel,"ui");this._initializeVisualizationsFilter()},onFlexibleColumnLayoutStateChange:function(e){this.oUiModel.setProperty("/maxColumnsCount",e.getParameter("maxColumnsCount"))},onSelectVisualizationsFilter:function(){this.oComponent.resetVisualizations();this.oComponent.queryVisualizations(0,this.oUiModel.getProperty("/visualizations/searchTerm"),this.oUiModel.getProperty("/categoryTree/selectedId"))},onSearch:function(e){const t=e.getParameter("query")||"";this.sCurrentSearchTerm=t;this.oComponent.resetVisualizations();this.toggleSelectionView(false);const i=this.oUiModel.getProperty("/categoryTree/selectedId");this.oComponent.queryVisualizations(0,t,i);this.oUiModel.setProperty("/visualizations/searchTerm",t)},_onCatalogSearch:function(e,t){const i=new l("title",r.Contains,e);const o=new l("contentProviderId",r.Contains,e);const s=new l("contentProviderLabel",r.Contains,e);const n=new l({filters:[i,o,s],and:false});t.filter(n)},onCatalogTreeSearch:function(e){const t=e.getParameter("newValue")||"";const i=this.byId("CategoryTreeFragment--CategoryTree").getBinding();this._onCatalogSearch(t,i)},onCatalogTreeTableSearch:function(e){const t=e.getParameter("newValue")||"";const i=this.byId("CategoryTreeTableFragment--CategoryTreeTable").getBinding("rows");this._onCatalogSearch(t,i)},onAppBoxSelected:function(e){if(e.getSource().getMode()===s.ListMode.SingleSelectMaster){const t=e.getParameter("listItem").getBindingContext("data").getObject();this.oComponent.addVisualizations([t])}else{const t=e.getParameter("selected");const i=e.getParameter("listItems").map(e=>{const t=e.getBindingContext("data");const i=t.getPath().split("/");const o=parseInt(i[i.length-1],10);return{...t.getObject(),index:o}});const o=this.oSelectionModel.getProperty("/visualizations/items");let s;if(t){s=[...o,...i]}else{s=o.filter(e=>!i.some(t=>t.id===e.id))}s.sort((e,t)=>e.index<t.index?-1:1);this.oSelectionModel.setProperty("/visualizations/items",s);if(!this.oSelectionModel.getProperty("/visualizations/items/length")){this.toggleSelectionView(false)}}},onUpdateStarted:function(e){if(e.getParameter("reason")==="Growing"){const t=this.oUiModel.getProperty("/visualizations/searchTerm");const i=e.getParameter("actual");const o=this.oUiModel.getProperty("/categoryTree/selectedId");this.oComponent.queryVisualizations(i,t,o)}},onShowSelectedPressed:function(e){const t=e.getParameter("pressed");this.toggleSelectionView(t)},onViewSelectionChange:function(e){const t=e.getSource().getSelectedKey();const i=t==="list";this.oUiModel.setProperty("/visualizations/listView",i);this.toggleSelectionView(this.oUiModel.getProperty("/visualizations/showSelectedPressed"))},toggleSelectionView:function(e){const t=e?"":this.sCurrentSearchTerm;this.oUiModel.setProperty("/visualizations/searchFieldValue",t);this.oUiModel.setProperty("/visualizations/showSelectedPressed",e);this.oComponent.useSelectionModel(e)},resetVisualizationsSearchField:function(){this.oUiModel.setProperty("/visualizations/searchTerm","");this.oUiModel.setProperty("/visualizations/searchFieldValue","");this.sCurrentSearchTerm=""},_onCategoryItemPressed:function(e,t){this.oComponent.updateSidebarStatus(c.TwoColumnsMidExpanded);this.getOwnerComponent().resetVisualizations();this.resetVisualizationsSearchField();this.toggleSelectionView(false);this.oUiModel.setProperty("/categoryTree/selectedId",t.id);this.oUiModel.setProperty("/categoryTree/selectedTitle",t.title);this.getOwnerComponent().queryVisualizations(0,"",t.id);const i=e.getPath();this.oUiModel.setProperty("/categoryTree/itemPressed",i.includes("nodes"));let o=t.allowedFilters;let s=t.filterIsTitle;if(!o&&i.includes("/nodes/")){const t=e.getPath().split("/");t.splice(-2);const i=t.join("/");o=e.getModel().getProperty(`${i}/allowedFilters`);s=e.getModel().getProperty(`${i}/filterIsTitle`)}this.oUiModel.setProperty("/visualizations/filters/displayed",o);this.oUiModel.setProperty("/visualizations/filters/filterIsTitle",!!s)},onCategoryTreeItemPressed:function(e){const t=e.getParameter("listItem").getBindingContext();const i=t.getObject();if(e.getParameter("listItem").getType()===u.Inactive){return}this._onCategoryItemPressed(t,i)},onCategoryTreeTableItemPressed:function(e){const t=e.getParameter("rowContext");if(!t&&e.getParameter("rowIndex")===-1){e.getSource().collapseAll();return}if(!t&&e.getParameter("rowIndex")>-1){const t=e.getParameter("rowIndex");e.getSource().collapse(t);return}const i=t.getObject();if(i.inactive){return}this._onCategoryItemPressed(t,i)},onCategoryTreeUpdateFinished:function(e){const t=e.getSource();if(!t.getSelectedItem()){const e=t.getItems();const i=e[0];if(i){t.setSelectedItem(i);const e=i.getBindingContext().getObject()||{};this.oUiModel.setProperty("/categoryTree/selectedId",e.id);this.oUiModel.setProperty("/categoryTree/selectedTitle",e.title)}}},onCategoryTreeTogglePressed:function(){const e=this.oUiModel.getProperty("/layoutType");const t=this.oUiModel.getProperty("/maxColumnsCount");let i;if(e===c.MidColumnFullScreen){if(t>1){i=c.TwoColumnsMidExpanded}else{i=c.OneColumn}}else if(e===c.TwoColumnsMidExpanded&&t===1){i=c.OneColumn}else if(e===c.TwoColumnsMidExpanded){i=c.MidColumnFullScreen}else{i=c.TwoColumnsMidExpanded}this.oComponent.updateSidebarStatus(i)},onLaunchApplicationPressed:function(e){const t=e.getSource().getBindingContext("data").getObject().launchUrl;if(!t){o.info("AppBox url property is not set.",null,"sap.ushell.components.Catalog.controller");return}if(t.indexOf("#")===0){a.setHash(t)}else{n.openURL(t,"_blank")}},onUpdateVisualizationsFilterData:function(){this.iVisualizationsFilterDataTimeout=this.iVisualizationsFilterDataTimeout||setTimeout(()=>{this._updateVisualizationsFilter();this.iVisualizationsFilterDataTimeout=null},0)},_initializeVisualizationsFilter:function(){this.oVisualizationsFilterInitialBinding=this.oUiModel.bindProperty("/visualizations/filters/displayed");this.oVisualizationsFilterAvailableBinding=this.oUiModel.bindProperty("/visualizations/filters/available");this.oVisualizationsFilterInitialBinding.attachChange(this.onUpdateVisualizationsFilterData,this);this.oVisualizationsFilterAvailableBinding.attachChange(this.onUpdateVisualizationsFilterData,this);this._updateVisualizationsFilter()},_updateVisualizationsFilter:function(){this.byId("selectVisualizationsFilter")?.getBinding("items")?.filter(new l((this.oUiModel.getProperty("/visualizations/filters/displayed")||[]).map(e=>new l("key",r.EQ,e))))}})});
//# sourceMappingURL=AppSearch.controller.js.map