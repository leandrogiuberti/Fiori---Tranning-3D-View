// Copyright (c) 2009-2025 SAP SE, All Rights Reserved
sap.ui.define(["sap/ui/core/Element","sap/ui/core/Lib","sap/ui/core/RenderManager","sap/ui/core/support/Plugin","sap/ui/model/json/JSONModel","sap/m/Button","sap/m/IconTabBar","sap/m/IconTabFilter","sap/m/Label","sap/m/Text","sap/m/MessageStrip","sap/m/FlexBox","sap/ui/model/resource/ResourceModel","sap/m/SearchField","sap/m/MessageBox","sap/base/util/isEmptyObject"],(e,t,n,i,o,r,s,a,l,p,u,f,c,g,d,y)=>{"use strict";const h="SAP Fiori launchpad configuration";const b=new c({async:true,bundleName:"sap/ushell/support/plugins/flpConfig/i18n/FlpConfigurationPlugin"});let E;b.getResourceBundle().then(e=>{E=e});const I=i.extend("sap.ushell.support.plugins.flpConfig.FlpConfigurationPlugin",{constructor:function(e){i.apply(this,["sapUiFlpConfigurationPlugin",h,e]);this._oSupportStub=e;if(this.runsAsToolPlugin()){this._aEventIds=[`${this.getId()}ReceiveData`]}else{this._aEventIds=[`${this.getId()}RequestData`]}}});I.prototype.isToolPlugin=function(){return true};I.prototype.isAppPlugin=function(){return true};I.prototype.init=function(){i.prototype.init.apply(this,arguments);if(this.runsAsToolPlugin()){setTimeout(()=>{this.requestData()},500);const e=(new n).getInterface();e.openStart("div",this.getId());e.openEnd();e.close("div");e.flush(this.dom());e.destroy()}else{}};I.prototype.exit=function(){i.prototype.exit.apply(this,arguments)};I.prototype.requestData=function(){this._oSupportStub.sendEvent(`${this.getId()}RequestData`,{eventData:{data:{}}})};I.prototype.onsapUiFlpConfigurationPluginRequestData=function(e){const t={};this.prepareForSending(window["sap-ushell-config"],t);this._oSupportStub.sendEvent(`${this.getId()}ReceiveData`,{eventData:{data:t}})};I.prototype.onsapUiFlpConfigurationPluginReceiveData=async function(e){this.flpConfig=e.getParameter("eventData").data;await t.load("sap.ui.table");sap.ui.require(["sap/ui/table/TreeTable","sap/ui/table/Column","sap/ui/table/library"],(e,t,n)=>{this.getFlpConfigurationPluginUI(null,e,t,n.SelectionMode)})};function m(e,t){let n=0;if(e[t]){e[t].forEach(e=>{const i=m(e,t);if(i>n){n=i}})}return n+1}function C(){let t=0;const n=e.getElementById("sap-ui-support-flpConfigurationPlugin-TabBar").getSelectedKey();const i=e.getElementById("sap-ui-support-flpConfigurationPlugin-TabBar").getModel().getData();if(Array.isArray(i[n])){i[n].forEach((e,o)=>{const r=m(i[n][o],n);if(t<r){t=r}});if(t>0){e.getElementById(`sap-ui-support-flpConfigurationPlugin-TreeTable${n}`).expandToLevel(t-1)}else{d.error(new l({text:E.getText("MISSING_HIERARCHY_LEVEL")}))}}}function T(){const t=e.getElementById("sap-ui-support-flpConfigurationPlugin-TabBar").getSelectedKey();e.getElementById(`sap-ui-support-flpConfigurationPlugin-TreeTable${t}`).collapseAll()}function P(e,t,n,i,o){e.forEach((e,r)=>{if(e[t]){n=`${n}.${r}.${t}`;n=P(e[t],t,n,i,o)}else if(e.property.indexOf(o)>-1){n=`${n}.${r}`;i.push(n);n=n.substring(0,n.lastIndexOf("."))}});n=n.substring(0,n.lastIndexOf("."));if(isNaN(parseInt(n.substr(n.lastIndexOf(".")+1),10))){return n}return n.substring(0,n.lastIndexOf("."))}function w(e,t){for(let n=0;n<t.length;n++){if(e){e=e[t[n]]}}return e}function B(e,t,n){const i=n.split(",");for(let t=0;t<i.length-1;t++){e=e[i[t]]}e[i[i.length-1]]=t}function S(e,t,n){if(Array.isArray(e)){e.forEach(e=>{if(e[t]){n=S(e[t],t,n)}else{n+=1}});return n}return undefined}function x(e,t,n,i,o){if(t.length===1){e[t[0]]=n}else{const r=t.shift();e[r]=x(typeof e[r]==="undefined"?{}:e[r],t,n,i,o)}if(e[i]&&e.property&&e.value){delete e.value;e.property=""}return e}I.prototype.onPressSearchNewModel=function(t){let n;let i;let r;let s;let a;let l;let p;let u;let f;let c=[];const g={};let d="";const y={};const h={};let b=e.getElementById("sap-ui-support-flpConfigurationPlugin-TabBar").getModel("Full");const E=t.getParameter("query");if(!b){b=e.getElementById("sap-ui-support-flpConfigurationPlugin-TabBar").getModel().getData()}else{b=b.getData()}Object.keys(b).forEach(e=>{g[e]=0});if(E){for(const e in b){d=e;n=[];P(b[e],e,d,n,E);h[e]=n}Object.keys(h).forEach(e=>{s=h[e];for(let e=0;e<s.length;e++){a=s[e].split(".");l=[];for(let e=0;e<a.length;e++){if(!isNaN(parseInt(a[e],10))){l.push(parseInt(a[e],10))}else{l.push(a[e])}}for(let e=0;e<l.length;e+=2){p={property:""};p[l[0]]=[];if(isNaN(parseInt(l[e],10))){i=l.slice(0,e+1);if(!w(y,i)&&typeof w(y,l.slice(0,l.length-2))!=="object"){x(y,i,[p],l[0],i.length)}f=w(b,l.slice(0,e+2));if(f&&w(y,l.slice(0,e+2))){B(y,f.property,`${l.slice(0,e+2).toString()},property`)}else if(e!==l.length-2){c.push(l.slice(0,e+2).toString())}}}r=l.slice(0);x(y,l,{property:"",value:""},l[0],i.length);f=w(b,r);if(f){B(y,f.value,`${r.toString()},value`);B(y,f.property,`${r.toString()},property`)}}c.forEach(e=>{f=w(b,e.split(","));if(f&&w(y,e.split(","))){B(y,f.property,`${e},property`)}});c=[];if(y[e]&&Array.isArray(y[e][0][e])&&y[e][0][e].length===0){y[e]=y[e].splice(1)}});e.getElementById("sap-ui-support-flpConfigurationPlugin-TabBar").setModel(new o(y));e.getElementById("sap-ui-support-flpConfigurationPlugin-TabBar").setModel(new o(b),"Full");let t=0;Object.keys(g).forEach(n=>{u=n;if(y[u]&&Array.isArray(y[u])){y[u].forEach((e,n)=>{const i=m(y[u][n],u);if(t<i){t=i}})}e.getElementById(`sap-ui-support-flpConfigurationPlugin-TreeTable${n}`).expandToLevel(t-1);e.getElementById(n).setCount(S(y[n],n,0))})}else{Object.keys(g).forEach(t=>{e.getElementById(t).setCount(S(b[t],t,0))});e.getElementById("sap-ui-support-flpConfigurationPlugin-TabBar").setModel(new o(b))}};function A(e,t){if(typeof e!=="object"){return[{property:t,value:e}]}return Object.keys(e).map(n=>{const i={property:n};const o=e[n];if(typeof o==="object"&&o!==null&&!y(o)&&!Array.isArray(o)){i[t]=A(o,t);return i}try{i.value=JSON.stringify(o)}catch(e){i.value=o}return i})}I.prototype.prepareForSending=function(e,t){Object.keys(e).forEach(n=>{const i=e[n];switch(typeof i){case"object":if(i===null){t[n]=i;return}else if(Array.isArray(i)){t[n]=[]}else{t[n]={}}this.prepareForSending(e[n],t[n]);break;case"undefined":t[n]="undefined";return;case"function":return;default:t[n]=e[n];return}})};I.prototype.getNewConfigJSON=function(e){const t={};Object.keys(e).forEach(n=>{t[n]=A(e[n],n)});return t};I.prototype.getFlpConfigurationPluginUI=function(t,n,i,c){let d;const h={};const I=this.getNewConfigJSON(this.flpConfig);const m=new o(I);for(const e in I){h[e]=S(I[e],e,0)}if(!e.getElementById("sap-ui-support-flpConfigurationPlugin-TabBar")){if(!I||y(I)){new u({text:E.getText("ERROR_MESSAGE"),type:"Warning",showIcon:true,showCloseButton:false}).placeAt(this.getId())}else{d=new s("sap-ui-support-flpConfigurationPlugin-TabBar",{headerMode:"Inline"});Object.keys(this.flpConfig).forEach((e,t)=>{d.insertItem(new a(e,{key:e,text:e,count:h[e],content:[new n(`sap-ui-support-flpConfigurationPlugin-TreeTable${e}`,{rows:`{/${e}/}`,selectionMode:c.None,enableCellFilter:true,extension:[new f({items:[new r({icon:"sap-icon://expand",text:"{i18n>EXPAND_BUTTON}",press:C}),new r({icon:"sap-icon://collapse",text:"{i18n>COLLAPSE_BUTTON}",press:T})]})],columns:[new i({label:new l({text:"{i18n>COLUMN_PROPERTY}"}),template:new p({text:"{property}"})}),new i({label:new l({text:"{i18n>COLUMN_VALUE}"}),template:new p({text:"{value}"})})]})]}),t)});const e=new g({search:this.onPressSearchNewModel});e.placeAt(this.getId());d.setModel(m);d.setModel(b,"i18n");d.placeAt(this.getId())}}};return I});
//# sourceMappingURL=FlpConfigurationPlugin.js.map