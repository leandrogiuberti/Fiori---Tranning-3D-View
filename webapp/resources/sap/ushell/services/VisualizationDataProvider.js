// Copyright (c) 2009-2025 SAP SE, All Rights Reserved
sap.ui.define(["sap/ushell/resources","sap/ui/thirdparty/jquery","sap/ushell/library","sap/ushell/utils/chipsUtils","sap/base/Log","sap/ushell/utils/LaunchpadError"],(t,jQuery,e,i,a,o)=>{"use strict";const s=e.DisplayFormat;function l(){this.S_COMPONENT_NAME="sap.ushell.services.VisualizationDataProvider";this._init.apply(this,arguments)}l.prototype._init=function(t){this.oLaunchPageAdapter=t;this.oCatalogTilePromise=null};l.prototype._getCatalogTileIndex=function(){if(this._oCatalogTileIndexPromise){return this._oCatalogTileIndexPromise}const t=this.oLaunchPageAdapter;return t._getCatalogTileIndex()};l.prototype._getCatalogTiles=function(){if(this.oCatalogTilePromise){return this.oCatalogTilePromise}const t=this.oLaunchPageAdapter;this.oCatalogTilePromise=new Promise((e,i)=>{t.getCatalogs().then(a=>{const o=[];const s=[];const l={};for(let e=0;e<a.length;e++){if(typeof a[e].ui2catalog==="undefined"||a[e].ui2catalog.getType()!=="REMOTE"){o.push(t.getCatalogTiles(a[e]).then(t=>{s.push(t)}))}}jQuery.when.apply(null,o).done(()=>{const i=s.flat();for(let e=0;e<i.length;e++){const a=t.getStableCatalogTileId(i[e]);l[a]=i[e]}e(l)}).fail(i)}).fail(i)});return this.oCatalogTilePromise};l.prototype.getVisualizationData=function(){let e;const i=this.oLaunchPageAdapter;if(this._oVisualizationDataPromise){return this._oVisualizationDataPromise}this._oVisualizationDataPromise=Promise.all([this._getCatalogTiles(),this._getCatalogTileIndex()]).then(t=>{const a=t[0];e=t[1];const o=[];const s=[];Object.keys(a).forEach(t=>{const e=a[t];i.setTileVisible(e,false);s.push(i.isTileIntentSupportedAsync(e).then(e=>{if(e===true){o.push(t)}}))});return Promise.all(s).then(()=>{const t=o.map(t=>{const e=a[t];if(!i.getCatalogTilePreviewTitle(e)){return new Promise((t,a)=>{i.getCatalogTileViewControl(e).done(t).fail(a)}).then(i=>({id:t,catalogTile:e,view:i}))}return Promise.resolve({id:t,catalogTile:e})});return Promise.all(t)})}).then(t=>t.reduce((t,o)=>{const s=o.id;const l=o.view;const n=o.catalogTile;try{const a=n.getChip().getBaseChipId();t.visualizations[s]={vizType:a,title:i.getCatalogTilePreviewTitle(n),subTitle:i.getCatalogTilePreviewSubtitle(n),icon:i.getCatalogTilePreviewIcon(n),info:i.getCatalogTilePreviewInfo(n),keywords:i.getCatalogTileKeywords(n),size:i.getCatalogTileSize(n),indicatorDataSource:i.getCatalogTilePreviewIndicatorDataSource(n),url:i.getCatalogTileTargetURL(n),numberUnit:i.getCatalogTileNumberUnit(n),isCustomTile:i.isCustomTile&&i.isCustomTile(n)};if(e[s]){t.visualizations[s]._instantiationData={platform:"ABAP",simplifiedChipFormat:false,chip:e[s]}}if(t.visualizations[s].isCustomTile&&!t.vizTypes[a]){t.vizTypes[a]={id:a,url:undefined,vizOptions:{displayFormats:this._getDisplayFormats(n,t.visualizations[s].size)},tileSize:t.visualizations[s].size}}}catch(t){a.error(`Could not get visualization data from tile ${s}`,t,this.S_COMPONENT_NAME)}if(l){l.destroy()}return t},{visualizations:{},vizTypes:{},page:{}})).catch(e=>{throw new o(e.message,{component:this.S_COMPONENT_NAME,description:t.i18n.getText("VisualizationDataProvider.CannotLoadData"),detail:e.message},e)});return this._oVisualizationDataPromise};l.prototype._getDisplayFormats=function(t,e){let i=["tile"];let a="tile";const o=t.getContract("types");if(o){i=o.getAvailableTypes();a=o.getDefaultType()}return{supported:this._mapDisplayFormats(i,e),default:this._mapDisplayFormats([a],e)[0]}};l.prototype._mapDisplayFormats=function(t,e){const i={tile:s.Standard,tilewide:s.StandardWide,link:s.Compact,flat:s.Flat,flatwide:s.FlatWide};return t.map(t=>{t=i[t];if(t===s.Standard&&e==="1x2"){return s.StandardWide}return t})};l.prototype.loadVizType=async function(t){const e={chipId:t};try{const a=await i.loadChipInstanceFromSimplifiedChip(e);const o=i.getTileSize(a);return{id:t,url:undefined,vizOptions:{displayFormats:this._getDisplayFormats(a,o)},tileSize:o}}catch(e){a.error(`The chipInstance '${t}' could not be loaded: `,e)}};l.hasNoAdapter=false;return l});
//# sourceMappingURL=VisualizationDataProvider.js.map