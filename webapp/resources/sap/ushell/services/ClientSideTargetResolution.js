// Copyright (c) 2009-2025 SAP SE, All Rights Reserved
sap.ui.define(["sap/base/Log","sap/base/util/isPlainObject","sap/base/util/ObjectPath","sap/base/util/extend","sap/ushell/ApplicationType","sap/ushell/navigationMode","sap/ushell/services/ClientSideTargetResolution/Formatter","sap/ushell/services/ClientSideTargetResolution/InboundIndex","sap/ushell/services/ClientSideTargetResolution/InboundProvider","sap/ushell/services/ClientSideTargetResolution/ParameterMapping","sap/ushell/services/ClientSideTargetResolution/PrelaunchOperations","sap/ushell/services/ClientSideTargetResolution/Search","sap/ushell/services/ClientSideTargetResolution/StagedLogger","sap/ushell/services/ClientSideTargetResolution/SystemContext","sap/ushell/services/ClientSideTargetResolution/Utils","sap/ushell/services/ClientSideTargetResolution/VirtualInbounds","sap/ushell/services/ClientSideTargetResolution/XAppStateProcessing","sap/ui/thirdparty/jquery","sap/ushell/TechnicalParameters","sap/ushell/utils","sap/ushell/utils/UrlParsing","sap/ushell/Container"],(e,t,n,s,i,a,o,r,l,u,c,d,p,f,g,h,m,jQuery,b,y,v,S)=>{"use strict";function R(e,t,n,s){this._init.apply(this,arguments)}R.prototype._init=function(t,n,s,i){this._iLogId=0;if(!this._implementsServiceInterface(t)){e.error("Cannot get Inbounds","ClientSideTargetResolutionAdapter should implement getInbounds method","sap.ushell.services.ClientSideTargetResolution");return}this._oInboundProvider=new l(t.getInbounds.bind(t));this._oHaveEasyAccessSystemsDeferreds={userMenu:null,sapMenu:null};this._oServiceConfiguration=i;this._oAdapter=t};R.prototype._implementsServiceInterface=function(e){if(typeof e.getInbounds==="function"){return true}return false};R.prototype._extractInboundFilter=function(e){if(!this._oAdapter.hasSegmentedAccess){return undefined}if(typeof e!=="string"){return undefined}const t=e.indexOf("#")===0?e:`#${e}`;const n=v.parseShellHash(t);if(!n||!n.semanticObject||!n.action){return undefined}return[{semanticObject:n.semanticObject,action:n.action}]};R.prototype.resolveHashFragment=async function(e){const t=this._extractInboundFilter(e);const n=await this._oInboundProvider.getInbounds(t);const s=await this._resolveHashFragment(e,n);return s};R.prototype._resolveHashFragmentWithFallback=async function(t,n,s){if(typeof this._oAdapter.resolveHashFragmentFallback!=="function"){e.error("Cannot resolve hash fragment",`${t} has matched an inbound that cannot be resolved client side and no resolveHashFragmentFallback method was implemented in ClientSideTargetResolutionAdapter`,"sap.ushell.services.ClientSideTargetResolution");throw new Error("No fallback provided")}const i=await y.promisify(this._oAdapter.resolveHashFragmentFallback(t,n,s));return i};R.prototype.resolveTileIntent=async function(e){const t=this._extractInboundFilter(e);const n=await this._oInboundProvider.getInbounds(t);const s=await this._resolveTileIntent(e,n);return s};R.prototype.resolveTileIntentInContext=async function(e,t){const n=r.createIndex(e.concat(h.getInbounds()));const s=await this._resolveTileIntent(t,n);return s};R.prototype._resolveHashFragment=async function(t,n){const s=t.indexOf("#")===0?t:`#${t}`;const i=v.parseShellHash(s);if(i===undefined){e.error(`Could not parse shell hash '${t}'`,"please specify a valid shell hash","sap.ushell.services.ClientSideTargetResolution");throw new Error(`Could not parse shell hash '${t}'please specify a valid shell hash`)}i.formFactor=y.getFormFactor();let a=await this._getMatchingInbounds(i,n,{bExcludeTileInbounds:true});if(a.length===0){e.warning(`Could not resolve ${t}`,"rejecting promise","sap.ushell.services.ClientSideTargetResolution");throw new Error(`Could not resolve ${t}`)}a=this._applySapNavigationScopeFilter(a,i);const o=a[0];o.fullHash=s;function r(e,t){return this[e]===undefined?"<undefined>":t}function l(e,t){return e==="_original"?undefined:r.call(this,e,t)}if(e.getLevel()>=e.Level.DEBUG){const t=JSON.stringify(o,l,"   ");e.debug("The following target will now be resolved",t,"sap.ushell.services.ClientSideTargetResolution")}return this._resolveSingleMatchingTarget(o,s)};R.prototype._applySapNavigationScopeFilter=function(e,t){const s=t&&t.params&&t.params["sap-navigation-scope-filter"];if(!s){return e}const i=e.filter(e=>{const t=n.get("inbound.signature.parameters",e);const i=t&&t["sap-navigation-scope"];if(i){return s[0]===i.defaultValue.value}return undefined});return i.length>0?i:e};R.prototype._resolveSingleMatchingTarget=async function(t,s){const o=v.parseShellHash(s);const r=[o.semanticObject,o.action].join("-");const l=(t.inbound.resolutionResult||{}).applicationType;let d;if(this._oAdapter.resolveSystemAlias){d=(...e)=>{const t=new jQuery.Deferred;y.promisify(this._oAdapter.resolveSystemAlias.apply(this._oAdapter,e)).then(t.resolve).catch(t.reject);return t}}const p=!!t.inbound.templateContext;const f=i.getEasyAccessMenuResolver(r,l);if(f&&!p){const e=await f(o,t,d,i.WDA.enableWdaCompatibilityMode);const n=a.getNavigationMode(e,(t.intentParamsPlusAllDefaults["sap-ushell-navmode"]||[])[0],(t.intentParamsPlusAllDefaults["sap-ushell-next-navmode"]||[])[0]);y.shallowMergeObject(e,n);e.appId=t.inbound.resolutionResult.appId;e.inboundPermanentKey=t.inbound.permanentKey||t.inbound.id;return e}const g=this._getReservedParameters(t);u.mapParameterNamesAndRemoveObjects(t);const h=await S.getServiceAsync("AppState");t=await m.mixAppStateIntoResolutionResultAndRename(t,h);delete t.intentParamsPlusAllDefaults["sap-tag"];delete t.mappedIntentParamsPlusSimpleDefaults["sap-tag"];t.mappedDefaultedParamNames=t.mappedDefaultedParamNames.filter(e=>e!=="sap-tag");const b=n.get("inbound.resolutionResult.url",t);await c.executePrelaunchOperations(t,g["sap-prelaunch-operations"]);try{let n;if(i[l]){n=i[l].generateResolutionResult}else{n=()=>this._constructFallbackResolutionResult(t,s)}const o=await n(t,b,d);const r=a.getNavigationMode(o,(t.intentParamsPlusAllDefaults["sap-ushell-navmode"]||[])[0],(t.intentParamsPlusAllDefaults["sap-ushell-next-navmode"]||[])[0]);y.shallowMergeObject(o,r);o.reservedParameters=g;o.appId=t.inbound.resolutionResult.appId;o.inboundPermanentKey=t.inbound.permanentKey||t.inbound.id;if(t.inbound.resolutionResult?.appInfo){o.appInfo=t.inbound.resolutionResult.appInfo}e.debug("Intent was resolved to the following target",JSON.stringify(o,null,3),"sap.ushell.services.ClientSideTargetResolution");y.shallowMergeObject(t.resolutionResult,o);return t.resolutionResult}catch(e){if(typeof e.message==="string"&&e.message.indexOf("fallback:")>=0){const e=await this._constructFallbackResolutionResult(t,s);y.shallowMergeObject(t.resolutionResult,e);return t.resolutionResult}throw e}};R.prototype._getReservedParameters=function(e){const t=b.getParameters({injectFrom:"startupParameter"}).map(e=>e.name);const n=g.extractParameters(t,e.intentParamsPlusAllDefaults);b.getParameters({injectFrom:"inboundParameter"}).forEach(t=>{const s=t.name;const i=e.inbound&&e.inbound.signature&&e.inbound.signature.parameters;if(i&&Object.keys(i).length>0){const t=i[s];const a=t&&t.defaultValue&&t.defaultValue.hasOwnProperty("value");const o=t&&t.filter&&t.filter.hasOwnProperty("value");if(t&&(o||a)){if(a){n[s]=t.defaultValue.value}else{n[s]=t.filter.value}}else{delete n[s]}delete e.intentParamsPlusAllDefaults[s];const r=e.defaultedParamNames.indexOf(s);if(r>=0){e.defaultedParamNames.splice(r,1)}}});return n};R.prototype._resolveTileIntent=async function(t,n){const s=t.indexOf("#")===0?t:`#${t}`;const i=v.parseShellHash(s);if(i===undefined){e.error(`Could not parse shell hash '${t}'`,"please specify a valid shell hash","sap.ushell.services.ClientSideTargetResolution");throw new Error("Cannot parse shell hash")}i.formFactor=y.getFormFactor();const a=await this._getMatchingInbounds(i,n,{bExcludeTileInbounds:false});if(a.length===0){e.warning(`Could not resolve ${t}`,"no matching targets were found","sap.ushell.services.ClientSideTargetResolution");throw new Error("No matching targets found")}const o=a[0];return this._resolveSingleMatchingTileIntent(o,s)};R.prototype._resolveSingleMatchingTileIntent=async function(t,o){const r=(t.inbound.resolutionResult||{}).applicationType;let l;if(this._oAdapter.resolveSystemAlias){l=(...e)=>{const t=new jQuery.Deferred;y.promisify(this._oAdapter.resolveSystemAlias.apply(this._oAdapter,e)).then(t.resolve).catch(t.reject);return t}}u.mapParameterNamesAndRemoveObjects(t);const c=await S.getServiceAsync("AppState");t=await m.mixAppStateIntoResolutionResultAndRename(t,c);delete t.intentParamsPlusAllDefaults["sap-tag"];delete t.mappedIntentParamsPlusSimpleDefaults["sap-tag"];t.mappedDefaultedParamNames=t.mappedDefaultedParamNames.filter(e=>e!=="sap-tag");const d=n.get("inbound.resolutionResult.url",t);let p;if(i[r]){p=i[r].generateResolutionResult}else{p=()=>this._constructFallbackResolutionResult(t,o)}const f=await p(t,d,l);y.shallowMergeObject(t.resolutionResult,f);const g=s({},t.inbound.tileResolutionResult);g.startupParameters=t.effectiveParameters;const h=a.getNavigationMode(f,(t.intentParamsPlusAllDefaults["sap-ushell-navmode"]||[])[0],(t.intentParamsPlusAllDefaults["sap-ushell-next-navmode"]||[])[0]);y.shallowMergeObject(g,h);e.debug("Tile Intent was resolved to the following target",JSON.stringify(g,null,3),"sap.ushell.services.ClientSideTargetResolution");return g};R.prototype._constructFallbackResolutionResult=async function(t,n){const i={};Object.keys(t.intentParamsPlusAllDefaults).forEach(e=>{if(Array.isArray(t.intentParamsPlusAllDefaults[e])){i[e]=t.intentParamsPlusAllDefaults[e]}});const a=t.mappedDefaultedParamNames||t.defaultedParamNames;if(a.length>0){i["sap-ushell-defaultedParameterNames"]=[JSON.stringify(a)]}e.warning("Cannot resolve hash fragment client side",`${n} has matched an inbound that cannot be resolved client side. Using fallback logic`,"sap.ushell.services.ClientSideTargetResolution");const o=await this._resolveHashFragmentWithFallback(n,s({},t.inbound),i);const r={};["applicationType","additionalInformation","url","applicationDependencies","text"].forEach(e=>{if(o.hasOwnProperty(e)){r[e]=o[e]}});return r};R.prototype.getDistinctSemanticObjects=async function(){const e={};const t=await this._oInboundProvider.getInbounds();t.getAllInbounds().forEach(t=>{if(typeof t.semanticObject==="string"&&t.semanticObject!=="*"&&!t.hideIntentLink&&t.semanticObject.length>0){e[t.semanticObject]=true}});return Object.keys(e).sort()};R.prototype.getLinks=async function(n){let i;if(arguments.length===1&&t(arguments[0])){const e=arguments[0];i=s({},e);["action","semanticObject"].forEach(t=>{if(e.hasOwnProperty(t)){i[t]=e[t]}});if(i.appStateKey){i.params=i.params||{};i.params["sap-xapp-state"]=[i.appStateKey];delete i.appStateKey}}else if(arguments.length<=3){e.warning("Passing positional arguments to getLinks is deprecated","Please use nominal arguments instead","sap.ushell.services.ClientSideTargetResolution");const t=arguments[0];const n=arguments[1];const s=arguments[2];i={semanticObject:t,params:n,ignoreFormFactor:s}}else{throw new Error("Invalid arguments for getLinks")}const a=await this._oInboundProvider.getInbounds();const o=await this._getLinks(i,a);return o};R.prototype._validateGetSemanticObjectLinksArgs=function(t){const n=t.semanticObject;const s=t.action;const i=!t.hasOwnProperty("action");if(typeof n!=="undefined"||i){if(typeof n!=="string"){e.error("invalid input for _getLinks",`the semantic object must be a string, got ${Object.prototype.toString.call(n)} instead`,"sap.ushell.services.ClientSideTargetResolution");return"invalid semantic object"}if(i&&n.match(/^\s+$/)){e.error("invalid input for _getLinks",`the semantic object must be a non-empty string, got '${n}' instead`,"sap.ushell.services.ClientSideTargetResolution");return"invalid semantic object"}if(!i&&n.length===0){e.error("invalid input for _getLinks",`the semantic object must not be an empty string, got '${n}' instead`,"sap.ushell.services.ClientSideTargetResolution");return"invalid semantic object"}}if(typeof s!=="undefined"){if(typeof s!=="string"){e.error("invalid input for _getLinks",`the action must be a string, got ${Object.prototype.toString.call(s)} instead`,"sap.ushell.services.ClientSideTargetResolution");return"invalid action"}if(s.length===0){e.error("invalid input for _getLinks",`the action must not be an empty string, got '${s}' instead`,"sap.ushell.services.ClientSideTargetResolution");return"invalid action"}}return undefined};R.prototype._getLinks=async function(t,s){const i=t.semanticObject;const a=t.action;const o=t.params;const r=!!t.withAtLeastOneUsedParam;const l=!!t.treatTechHintAsFilter;const u=t.ignoreFormFactor;const c=t.hasOwnProperty("sortResultsBy")?t.sortResultsBy:"intent";if(t.hasOwnProperty("sortResultOnTexts")){e.warning("the parameter 'sortResultOnTexts' was experimental and is no longer supported",`getLinks results will be sorted by '${c}'`,"sap.ushell.services.ClientSideTargetResolution")}const d={bExcludeTileInbounds:true};const p=this._validateGetSemanticObjectLinksArgs(t);if(t.tags){d.tags=t.tags}if(p){throw new Error(p)}if(i==="*"){return[]}function f(e){const t=v.paramsToString(e);return t?`?${t}`:""}const h=y.getFormFactor();const m=v.parseParameters(f(o));const b={semanticObject:i===""?undefined:i,action:a,formFactor:u?undefined:h,params:m};if(l){b.treatTechHintAsFilter=true}const S=await this._getMatchingInbounds(b,s,d);const R={};const w=S.map(e=>{const s=i||e.inbound.semanticObject;const a=`#${s}-${e.inbound.action}`;let o;if(s==="*"){return undefined}if(e.inbound.action==="*"){return undefined}if(e.inbound&&e.inbound.hasOwnProperty("hideIntentLink")&&e.inbound.hideIntentLink===true){return undefined}if(!R.hasOwnProperty(a)){R[a]={matchingInbound:e.inbound,count:1};if(e.inbound.signature.additionalParameters==="ignored"){o=g.filterObjectKeys(m,t=>t.indexOf("sap-")===0||e.inbound.signature.parameters.hasOwnProperty(t),false)}else{o=m}if(r){const e=Object.keys(o).some(e=>e.indexOf("sap-")!==0);if(!e){R[a].hideReason="getLinks called with 'withAtLeastOneUsedParam = true', but the inbound had no business parameters defined.";return undefined}}const s=g.inboundSignatureMeetsParameterOptions(e.inbound.signature.parameters,t.paramsOptions||[]);if(!s){R[a].hideReason="inbound signature does not meet the requested parameter filter options";return undefined}const i={intent:a+f(o),text:e.inbound.title};if(e.inbound.icon){i.icon=e.inbound.icon}if(e.inbound.subTitle){i.subTitle=e.inbound.subTitle}if(e.inbound.shortTitle){i.shortTitle=e.inbound.shortTitle}const l=n.get("inbound.signature.parameters.sap-tag.defaultValue.value",e);if(l){i.tags=[l]}return i}R[a].count++;return undefined}).filter(e=>typeof e==="object");if(c!=="priority"){w.sort((e,t)=>e[c]<t[c]?-1:1)}if(w.length===0){e.debug("_getLinks returned no results")}else if(e.getLevel()>=e.Level.DEBUG){if(e.getLevel()>=e.Level.TRACE){const t=[];const n=[];w.forEach(e=>{const s=e.intent.split("?")[0];const i=R[s];let a="";if(i.hideReason){a=`(${i.hideReason})`}else if(i.count>1){a=`(${i.count-1} others matched)`}const o=`- ${s}${a}\n  text: ${e.text}\n  full intent: ${e.intent}`;if(i.hideReason){n.push(o)}else{t.push(o)}});e.debug("_getLinks filtered to the following unique intents:",`\n${t.join("\n")}`,"sap.ushell.services.ClientSideTargetResolution");e.debug("_getLinks would have also returned the following unique intents, but something prevented this:",n.join("\n"),"sap.ushell.services.ClientSideTargetResolution")}else{e.debug("_getLinks filtered to unique intents.",`Reporting histogram: \n - ${Object.keys(R).join("\n - ")}`,"sap.ushell.services.ClientSideTargetResolution")}}return w};R.prototype._getMatchingInbounds=async function(t,n,s){let i;let a;let r;let l;if(s){i=s.tags;r=s.bExcludeTileInbounds}if(e.getLevel()>=e.Level.DEBUG){a=++this._iLogId}p.begin(()=>{function e(e){const t=e.action||(typeof e.action==="undefined"?"<any>":"<invalid-value>");const n=e.semanticObject||(typeof e.semanticObject==="undefined"?"<any>":"<invalid-value>");return v.constructShellHash({semanticObject:n,action:t,params:e.params})}const n=e(t);return{logId:a,title:`Matching Intent '${n}' to inbounds (form factor: ${t.formFactor||"<any>"})`,moduleName:"sap.ushell.services.ClientSideTargetResolution",stages:["STAGE1: Find matching inbounds","STAGE2: Resolve references","STAGE3: Rematch with references","STAGE4: Sort matched targets"]}});function u(){p.end(()=>({logId:a}))}const c=t.semanticObject;const f=t.action;this._oShellHash=t;const g=i?n.getSegmentByTags(i):n.getSegment(c,f);if(r){l=g.filter(e=>!e.tileResolutionResult||!e.tileResolutionResult.isCustomTile)}else{l=g}let h=null;if(this._oAdapter.getContentProviderDataOriginsLookup){h=this._oAdapter.getContentProviderDataOriginsLookup.bind(this._oAdapter)}const m=await d.match(t,l,{},h,e.getLevel()>=e.Level.DEBUG);p.log(()=>({logId:a,stage:1,prefix:"✘",lines:Object.keys(m.noMatchReasons||{}).map(e=>`${e} ${m.noMatchReasons[e]}`)}));p.log(()=>{const e=m.matchResults.map(e=>o.formatInbound(e.inbound));return{logId:a,stage:1,prefix:e.length>0?"✅":"✘",lines:e.length>0?e:["No inbound was matched"]}});const b={};let y=false;let R=Object.keys(m.missingReferences);R.forEach(e=>{const t=Object.keys(m.missingReferences[e]);y=y||t.length>0;b[e]=t});R=R.filter(e=>{if(b[e].length>0){return true}delete b[e];return false});let w;if(y){try{R.forEach(e=>{p.log(()=>({logId:a,stage:2,line:`@ Must resolve the following references with contentProviderId = "${e}":`,prefix:"•",lines:b[e]}))});const e=await S.getServiceAsync("ReferenceResolver");const t=await Promise.all(R.map(e=>this.getSystemContext(e)));const n=await Promise.all(R.map((n,s)=>e.resolveReferences(b[n],t[s])));const s={matchResults:m.matchResults,referencesToInclude:{}};R.forEach((e,t)=>{const i=n[t];s.referencesToInclude[e]=i;if(Object.keys(i).length>0){p.log(()=>({logId:a,stage:2,line:`✅ resolved references with contentProviderId = "${e}" to the following values:`,prefix:"•",lines:Object.keys(i).map(e=>`${e}: '${i[e]}'`)}))}});w=s}catch(e){p.log(()=>({logId:a,stage:2,prefix:"❌",line:`Failed to resolve references: ${e.message}`}));u();return[]}}else{p.log(()=>({logId:a,stage:2,prefix:"✅",line:"No need to resolve references"}));w={matchResults:m.matchResults,referencesToInclude:null}}let I;if(w.referencesToInclude){const e=w.matchResults;const n=e.map(e=>e.inbound);I=await d.match(t,n,w.referencesToInclude,h,0);p.log(()=>{const e=I.matchResults||[];if(e.length>=1){return{logId:a,stage:3,line:"The following inbounds re-matched:",lines:e.map(e=>o.formatInbound(e.inbound)),prefix:"✅"}}return{logId:a,stage:3,line:"No inbounds re-matched",prefix:"-"}})}else{p.log(()=>({logId:a,stage:3,line:"rematch was skipped (no references to resolve)",prefix:"✅"}));I=w}const P=I.matchResults||[];if(P.length<=1){p.log(()=>({logId:a,stage:4,line:"Nothing to sort"}));u();return P}const T=d.sortMatchingResultsDeterministic(I.matchResults||[]);p.log(()=>{const e=T.map(e=>`${o.formatInbound(e.inbound||{})+(e.matchesVirtualInbound?" (virtual)":"")}\n[ Sort Criteria ] `+`\n * 1 * sap-priority: '${e["sap-priority"]}'`+`\n * 2 * Sort string: '${e.priorityString}\n * 3 * Deterministic blob: '${d.serializeMatchingResult(e)}'`);return{logId:a,stage:4,line:"Sorted inbounds as follows:",lines:e,prefix:".",number:true}});u();return T};R.prototype._isIntentSupportedOne=async function(e,t){const n=v.parseShellHash(e);if(e==="#"){return true}if(n===undefined){throw new Error(`Could not parse shell hash '${e}'`)}n.formFactor=y.getFormFactor();const s=await this._getMatchingInbounds(n,t,{bExcludeTileInbounds:true});return s.length>0};R.prototype.isIntentSupported=async function(e){const t=await this._oInboundProvider.getInbounds();const n=await this._isIntentSupported(e,t);return n};R.prototype._isIntentSupported=async function(e,t){const n={};await Promise.all(e.map(async e=>{const s=await this._isIntentSupportedOne(e,t);n[e]={supported:s}}));return n};R.prototype.getUserDefaultParameterNames=async function(e){const t=await this._oInboundProvider.getInbounds();const n=await this._getUserDefaultParameterNames(t.getAllInbounds(),e);return n};R.prototype._getUserDefaultParameterNames=function(e,t){const n={simple:{},extended:{}};e=e.filter(e=>{if(e.contentProviderId===undefined&&t.id===""){return true}return e.contentProviderId===t.id});return S.getServiceAsync("ReferenceResolver").then(t=>{e.forEach(e=>{const s=e.signature&&e.signature.parameters||[];Object.keys(s).forEach(e=>{const i=s[e];let a;if(i){if(i.filter&&i.filter.format==="reference"){a=i.filter.value}else if(i.defaultValue&&i.defaultValue.format==="reference"){a=i.defaultValue.value}if(typeof a==="string"){const e=t.extractUserDefaultReferenceName(a);if(typeof e==="string"){n.simple[e]={}}const s=t.extractExtendedUserDefaultReferenceName(a);if(typeof s==="string"){n.extended[s]={}}}}})});return n})};R.prototype.getEasyAccessSystems=function(e){e=e||"sapMenu";if(!this._oHaveEasyAccessSystemsDeferreds[e]){this._oHaveEasyAccessSystemsDeferreds[e]=this._getEasyAccessSystems(e)}return this._oHaveEasyAccessSystemsDeferreds[e]};R.prototype._getEasyAccessSystems=async function(s){const a={};const r=i.getEasyAccessMenuDefinitions().reduce((e,t)=>{const n=t.easyAccessMenu.intent.split("-")[1];e[n]={appType:t.type,priority:t.easyAccessMenu.systemSelectionPriority};return e},{});let l;switch(s){case"userMenu":l=i.getEasyAccessMenuDefinitions().reduce((e,t)=>{const n=t.easyAccessMenu.intent;e[n]=t.easyAccessMenu.showSystemSelectionInUserMenu;return e},{});break;case"sapMenu":l=i.getEasyAccessMenuDefinitions().reduce((e,t)=>{const n=t.easyAccessMenu.intent;e[n]=t.easyAccessMenu.showSystemSelectionInSapMenu;return e},{});break;default:throw new Error(`Invalid menu type: '${s}'`)}const u=await this._oInboundProvider.getInbounds();const c={};const d=y.getFormFactor();u.getAllInbounds().filter(e=>{if(!e){return false}const t=[e.semanticObject,e.action].join("-");return l[t]&&e.deviceTypes&&d!==undefined&&e.deviceTypes[d]}).forEach(s=>{let i;if(t(s.signature.parameters["sap-system"])&&s.signature.parameters["sap-system"].hasOwnProperty("filter")){i=n.get("signature.parameters.sap-system.filter.value",s)}if(typeof i==="string"){const e=r[s.action].priority;const t=r[s.action].appType;if(!a[i]){c[i]=-1;a[i]={appType:{}}}if(c[i]<e){a[i].text=s.title;c[i]=e}a[i].appType[t]=true}else{e.warning(`Cannot extract sap-system from easy access menu inbound: ${o.formatInbound(s)}`,`This parameter is supposed to be a string. Got '${i}' instead.`,"sap.ushell.services.ClientSideTargetResolution")}});return a};R.prototype.getSystemContext=async function(e){const t=e===undefined?"":e;const n=await y.promisify(this._oAdapter.resolveSystemAlias(t));const s=f.createSystemContextFromSystemAlias(n);return s};R.hasNoAdapter=false;return R},true);
//# sourceMappingURL=ClientSideTargetResolution.js.map