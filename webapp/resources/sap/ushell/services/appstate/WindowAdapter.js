// Copyright (c) 2009-2025 SAP SE, All Rights Reserved
sap.ui.define(["sap/ushell/services/appstate/LimitedBuffer","sap/base/Log","sap/ui/thirdparty/jquery"],(e,t,jQuery)=>{"use strict";const o=500;const p=18;function r(){this._init.apply(this,arguments)}r.prototype._init=function(t,p,a){const n=a&&a.config&&a.config.initialAppStates||{};const s=a&&a.config&&a.config.initialAppStatesPromise;this._oServiceInstance=t;this._oBackendAdapter=p;if(!r.prototype.data){r.prototype.data=new e(o)}if(s){s.then(e=>{if(typeof e==="object"){Object.keys(e).forEach(t=>{r.prototype.data.addAsHead(t,e[t])})}})}Object.keys(n).forEach(e=>{r.prototype.data.addAsHead(e,n[e])})};r.prototype.saveAppState=function(e,t,o,p,a,n,s,i){this.sComponent=a;const d=new jQuery.Deferred;r.prototype.data.addAsHead(e,o,s,i);if(this._oBackendAdapter&&!n){return this._oBackendAdapter.saveAppState(e,t,o,p,a,s,i)}d.resolve();return d.promise()};r.prototype._checkIfTransient=function(e){return e.startsWith("TAS")};r.prototype.loadAppState=function(e){const o=new jQuery.Deferred;const a=r.prototype.data.getByKey(e);if(a){setTimeout(()=>{o.resolve(e,a.value,a.persistencyMethod,a.persistencySettings)},0);return o.promise()}try{if(window.opener&&window.opener.sap&&window.opener.sap.ushell){const t=window.opener.sap.ui.require("sap/ushell/services/AppState").WindowAdapter.prototype.data.getByKey(e);if(t){o.resolve(e,t.value);return o.promise()}}}catch(e){if(e.code===p){t.warning("AppState.js - loadAppState: Opener is not of the same origin and cannot be used for AppState resolving.")}else{t.warning("AppState.js - loadAppState: Opener is a FLP but AppState could not get resolved from there.")}}if(this._oBackendAdapter&&!this._checkIfTransient(e)){this._oBackendAdapter.loadAppState(e).done((e,t,p,a)=>{r.prototype.data.addAsHead(e,t);o.resolve(e,t,p,a)}).fail(o.reject.bind(o));return o.promise()}o.reject(new Error("AppState.js - loadAppState: Application State could not be loaded"));return o.promise()};r.prototype.deleteAppState=function(e){const t=new jQuery.Deferred;r.prototype.data.deleteByKey(e);if(this._oBackendAdapter&&this._oBackendAdapter.deleteAppState&&!this._checkIfTransient(e)){return this._oBackendAdapter.deleteAppState(e)}t.resolve();return t.promise()};r.prototype.getSupportedPersistencyMethods=function(){if(this._oBackendAdapter&&this._oBackendAdapter.getSupportedPersistencyMethods){return this._oBackendAdapter.getSupportedPersistencyMethods()}return[]};return r});
//# sourceMappingURL=WindowAdapter.js.map