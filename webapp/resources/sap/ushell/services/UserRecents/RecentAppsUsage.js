// Copyright (c) 2009-2025 SAP SE, All Rights Reserved
sap.ui.define(["sap/base/Log","sap/ushell/services/UserRecents/UserRecentsBase","sap/ushell/utils"],(e,s,a)=>{"use strict";const t=s.extend("sap.ushell.services.UserRecents.RecentAppsUsage",{constructor:function(){s.call(this,"AppsUsage")}});t.MAX_DAYS=30;t.prototype.init=async function(){const s=this.getDayFromDate(new Date);let a=false;if(!a||s!==this.oAppsUsageData.recentDay){a=true;try{const e=await this.load();this.oAppsUsageData=e||{recentDay:null,recentAppsUsageMap:{}};await this.calculateInitialUsage(s);return this.oAppsUsageData}catch(s){e.error("Load data in Init failed",s,"sap.ushell.services.UserRecents.RecentAppsUsage");throw s}}};t.prototype.calculateInitialUsage=async function(e){if(e!==this.oAppsUsageData.recentDay){this._addNewDay();this.oAppsUsageData.recentDay=e;this._cleanUnusedHashes();await this.save(this.oAppsUsageData)}};t.prototype.addAppUsage=async function(e){if(!a.validHash(e)){throw new Error("Non valid hash")}await this.init();const s=this.oAppsUsageData.recentAppsUsageMap[e]||[];if(s.length===0){s[0]=1}else{s[s.length-1]+=1}this.oAppsUsageData.recentAppsUsageMap[e]=s;await this.save(this.oAppsUsageData)};t.prototype.getAppsUsage=async function(){await this.init();const e={};let s;let a;let t=true;for(const p in this.oAppsUsageData.recentAppsUsageMap){e[p]=this._getHashUsageSum(p);if(t){s=a=e[p];t=false}else if(e[p]<a){a=e[p]}else if(e[p]>s){s=e[p]}}return{usageMap:e,maxUsage:s,minUsage:a}};t.prototype._addNewDay=function(){let e;for(const s in this.oAppsUsageData.recentAppsUsageMap){e=this.oAppsUsageData.recentAppsUsageMap[s];e[e.length]=0;if(e.length>t.MAX_DAYS){e=e.shift()}}};t.prototype._cleanUnusedHashes=function(){let e;for(const s in this.oAppsUsageData.recentAppsUsageMap){e=this._getHashUsageSum(s);if(e===0){delete this.oAppsUsageData.recentAppsUsageMap[s]}}};t.prototype._getHashUsageSum=function(e){const s=this.oAppsUsageData.recentAppsUsageMap[e];return s.reduce((e,s)=>e+s,0)};return t});
//# sourceMappingURL=RecentAppsUsage.js.map