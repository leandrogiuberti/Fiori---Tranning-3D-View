// Copyright (c) 2009-2025 SAP SE, All Rights Reserved
sap.ui.define(["sap/ui/core/EventBus","sap/ushell/Config","sap/ushell/library","sap/base/util/deepClone","sap/base/util/deepExtend","sap/base/Log","sap/ushell/utils","sap/ushell/Container"],(e,t,a,o,r,s,i,n)=>{"use strict";const c="sap.ushell.services.BookmarkV2";const u=a.ContentNodeType;function d(){this._getLaunchPageService=function(){if(!this._oLaunchPageServicePromise){this._oLaunchPageServicePromise=n.getServiceAsync("LaunchPage")}return this._oLaunchPageServicePromise};this._getPagesService=function(){if(!this._oPagesServicePromise){this._oPagesServicePromise=n.getServiceAsync("Pages")}return this._oPagesServicePromise};this._addBookmarkToContentNodes=async function(e,t,a,o){const r=t.map(async t=>{if(t&&t.hasOwnProperty("type")&&t.isContainer){if(t.type===u.Page){return this.addBookmarkToPage(e,t.id,o)}if(t.type===u.HomepageGroup){const r=await this._getLaunchPageService();const s=await i.promisify(r.getGroupById(t.id));return this.addBookmarkToHomepageGroup(e,s,a,o)}throw new Error(`Bookmark Service: The API needs to be called with a valid content node type. '${t.type}' is not supported.`)}throw new Error("Bookmark Service: Not a valid content node.")});return Promise.all(r)};this.addBookmark=async function(e,a,r){const i=t.last("/core/shell/enablePersonalization");const u=t.last("/core/spaces/enabled");const d=t.last("/core/spaces/myHome/enabled");if(!i&&(!u||!d)){return}try{await this._checkBookmarkParameters(e);const t=o(e,20);t.url=await this._changeUrlStatesToPersistent(t.url);if(typeof a==="undefined"&&u){const e=await n.getServiceAsync("Menu");const a=await e.getDefaultSpace();const o=a&&a.children&&a.children[0];return this._addBookmarkToContentNodes(t,[o],false,r)}if((typeof a==="undefined"||!a.hasOwnProperty("type"))&&!Array.isArray(a)){return this.addBookmarkToHomepageGroup(t,a,false,r)}const s=[].concat(a);return this._addBookmarkToContentNodes(t,s,false,r)}catch(e){s.error("Error during Bookmark creation: ",e,c);throw e}};this.addCustomBookmark=async function(e,t,a,s){const i=o(t);const n=r(i,{vizType:e,vizConfig:{"sap.flp":{chipConfig:i.chipConfig},"sap.platform.runtime":{includeManifest:!i.loadManifest}}});delete n.chipConfig;delete n.loadManifest;n.url=await this._changeUrlStatesToPersistent(n.url);const c=[].concat(a);return this._addBookmarkToContentNodes(n,c,true,s)};this.addBookmarkToHomepageGroup=async function(a,o,r,s){if(t.last("/core/spaces/enabled")){throw new Error("Bookmark Service: The API is not available in spaces mode.")}const n=await this._getLaunchPageService();let c;if(r){c=await i.promisify(n.addCustomBookmark(a,o,s))}else{c=await i.promisify(n.addBookmark(a,o,s))}const u={tile:c,group:o};e.getInstance().publish("sap.ushell.services.Bookmark","bookmarkTileAdded",u)};this.addBookmarkToPage=async function(e,a,o){if(!t.last("/core/spaces/enabled")){throw new Error("Bookmark Service: 'addBookmarkToPage' is not valid in launchpad home page mode, use 'addBookmark' instead.")}const r=t.last("/core/shell/enablePersonalization");const s=t.last("/core/spaces/myHome/enabled");const i=t.last("/core/spaces/myHome/myHomePageId");if(!r&&(!s||s&&a!==i)){throw new Error("Bookmark Service: Add bookmark is not allowed as the personalization functionality is not enabled.")}if(e&&(typeof e.title!=="string"||typeof e.url!=="string")){throw new Error("Bookmark Service - Invalid bookmark data.")}const n=await this._getPagesService();return n.addBookmarkToPage(a,e,undefined,o)};this.addBookmarkByGroupId=async function(e,a,o){if(t.last("/core/spaces/enabled")){throw new Error("Bookmark Service: The API 'addBookmarkByGroupId' is not supported in launchpad spaces mode.")}const r=await this._getLaunchPageService();const s=await i.promisify(r.getGroups());const n=s.find(e=>e.id===a)||null;await this.addBookmark(e,n,o)};this.getShellGroupIDs=async function(e){if(t.last("/core/spaces/enabled")){throw new Error("Bookmark Service: The API 'getShellGroupIDs' is not supported in launchpad spaces mode.")}const a=await this._getLaunchPageService();let o=await i.promisify(a.getGroupsForBookmarks(e));o=o.map(e=>({id:a.getGroupId(e.object),title:e.title}));return o};this._checkBookmarkParameters=async function(e){if(!e){throw new Error("Invalid Bookmark Data: No bookmark parameters passed.")}const t=e.dataSource;let a;if(t){if(t.type!=="OData"){throw new Error(`Invalid Bookmark Data: Unknown data source type: ${t.type}`)}a=t.settings&&t.settings.odataVersion;const e=["2.0","4.0"];if(!e.includes(a)){throw new Error(`Invalid Bookmark Data: Unknown OData version in the data source: ${a}`)}}if(e.serviceUrl){const a=await n.getServiceAsync("ReferenceResolver");if(a.hasSemanticDateRanges(e.serviceUrl)&&!t){throw new Error("Invalid Bookmark Data: Provide a data source to use semantic date ranges.")}}};this.countBookmarks=async function(e,a){if(!t.last("/core/spaces/enabled")){const t=await this._getLaunchPageService();return i.promisify(t.countBookmarks(e,a))}const o=await this._getPagesService();return o.countBookmarks({url:e,contentProviderId:a})};this.countCustomBookmarks=async function(e){if(!e||!e.url||!e.vizType){throw new Error("countCustomBookmarks: required parameters are missing.")}if(!t.last("/core/spaces/enabled")){const t=await this._getLaunchPageService();return t.countCustomBookmarks(e)}const a=await this._getPagesService();return a.countBookmarks(e)};this.deleteBookmarks=async function(a,o){if(!t.last("/core/spaces/enabled")){const t=await this._getLaunchPageService();const r=await i.promisify(t.deleteBookmarks(a,o));e.getInstance().publish("sap.ushell.services.Bookmark","bookmarkTileDeleted",a);return r}const r=await this._getPagesService();return r.deleteBookmarks({url:a,contentProviderId:o})};this.deleteCustomBookmarks=async function(a){if(!a||!a.url||!a.vizType){throw new Error("deleteCustomBookmarks: Some required parameters are missing.")}if(!t.last("/core/spaces/enabled")){const t=await this._getLaunchPageService();await t.deleteCustomBookmarks(a);e.getInstance().publish("sap.ushell.services.Bookmark","bookmarkTileDeleted",a.url);return}const o=await this._getPagesService();return o.deleteBookmarks(a)};this.updateBookmarks=async function(e,a,r){const s=o(a,20);s.url=await this._changeUrlStatesToPersistent(s.url);if(!t.last("/core/spaces/enabled")){const t=await this._getLaunchPageService();return i.promisify(t.updateBookmarks(e,s,r))}const n=await this._getPagesService();return n.updateBookmarks({url:e,contentProviderId:r},s)};this.updateCustomBookmarks=async function(e,a){if(!e||!e.url||!e.vizType){throw new Error("deleteCustomBookmarks: Some required parameters are missing.")}const o=r({},a,{vizConfig:{"sap.flp":{chipConfig:a.chipConfig},"sap.platform.runtime":{includeManifest:!a.loadManifest}}});delete o.chipConfig;delete o.loadManifest;o.url=await this._changeUrlStatesToPersistent(o.url);if(!t.last("/core/spaces/enabled")){const t=await this._getLaunchPageService();return t.updateCustomBookmarks(e,o)}const s=await this._getPagesService();return s.updateBookmarks(e,o)};this.getContentNodes=async function(){if(!t.last("/core/spaces/enabled")){const e=await this._getLaunchPageService();const t=await i.promisify(e.getGroupsForBookmarks());const a=t.map(t=>({id:e.getGroupId(t.object),label:t.title,type:u.HomepageGroup,isContainer:true}));return a}const e=await n.getServiceAsync("Menu");return e.getContentNodes()};this._changeUrlStatesToPersistent=async function(e){const t=await n.getServiceAsync("AppState");const a=t.getPersistentWhenShared();if(t.getSupportedPersistencyMethods().length===0&&a!==true){return e}if(!e||typeof e!=="string"){return e}return i.promisify(t.setAppStateToPublic(e))}}d.hasNoAdapter=true;return d},true);
//# sourceMappingURL=BookmarkV2.js.map