// Copyright (c) 2009-2025 SAP SE, All Rights Reserved
sap.ui.define(["sap/m/Bar","sap/m/Button","sap/m/Label","sap/m/HBox","sap/m/VBox","sap/m/library","sap/m/Popover","sap/m/ResponsivePopover","sap/m/Title","sap/m/ToggleButton","sap/ui/core/Element","sap/ui/core/Icon","sap/ui/core/IconPool","sap/ui/Device","sap/ui/performance/Measurement","sap/ui/thirdparty/hasher","sap/ushell/Config","sap/ushell/Container","sap/ushell/library","sap/ushell/resources","sap/ushell/ui/launchpad/AccessibilityCustomData","sap/ushell/state/StateManager","sap/ushell/state/ShellModel"],(e,t,o,s,n,l,i,p,r,a,c,h,u,d,g,y,A,f,M,v,T,S,C)=>{"use strict";const P=M.AppTitleState;const _=M.AllMyAppsState;const m=l.PlacementType;const N=S.ShellMode;const B=t.extend("sap.ushell.ui.shell.ShellAppTitle",{metadata:{library:"sap.ushell",properties:{title:{type:"string",group:"Data",defaultValue:null},subTitle:{type:"string",group:"Data",defaultValue:null},showAppTitle:{type:"boolean",group:"Data",defaultValue:true},icon:{type:"sap.ui.core.URI",group:"Appearance",defaultValue:"sap-icon://folder"}},associations:{navigationMenu:{type:"sap.ushell.ui.shell.ShellNavigationMenu"},allMyApps:{type:"sap.ui.core.mvc.View"},newExperienceControl:{type:"sap.ui.core.Control"}},events:{textChanged:{deprecated:true}}},renderer:{apiVersion:2,render:function(e,t){const o=t._getControlVisibilityAndState();const s=t.getText();e.openStart("div",t);e.class("sapUshellHeadTitle");if(o||d.system.phone){e.class("sapUshellAppTitleClickable")}e.openEnd();e.openStart("h1");e.class("sapUiPseudoInvisibleText");e.attr("aria-level","1");e.openEnd();e.text(s||"");e.close("h1");e.openStart("div",`${t.getId()}-button`);e.class("sapUshellAppTitle");if(o||d.system.phone){e.attr("tabindex","0")}if(t.getTooltip_AsString()){e.attr("title",t.getTooltip_AsString())}if(o){e.attr("role","button");e.attr("aria-haspopup","dialog");e.attr("aria-label",s)}e.openEnd();if(t.getShowAppTitle()){e.openStart("span");e.class("sapUshellAppTitleText");e.openEnd();e.text(s||"");e.close("span")}if(o&&s){e.openStart("span");e.class("sapUshellShellHeadAction");e.openEnd();e.renderControl(t.oIcon);e.close("span")}e.close("div");e.close("div")}}});B.prototype.init=function(){t.prototype.init.apply(this,arguments);this.oIcon=u.createControlByURI(u.getIconURI("slim-arrow-down"));this.oIcon.addStyleClass("sapUshellAppTitleMenuIcon");this._screenWidth=null;if(d.system.desktop){this.addEventDelegate({onkeydown:function(e){if(e.altKey&&e.keyCode===40){this.onclick(e)}}.bind(this)})}if(A.last("/core/shellBar/enabled")){d.resize.attachHandler(B._showAppTitleText.bind(this))}};B._showAppTitleText=function(e){const t=e.width;if(!this._screenWidth||Math.abs(this._screenWidth-t)>50){this.setShowAppTitle(true);this._screenWidth=t}};B.prototype._getNewExperienceWrapper=function(){if(!this._oNewExperienceWrapper){this._oNewExperienceWrapper=new n({renderType:"Bare"});this._oNewExperienceWrapper.addStyleClass("sapUiSmallMarginBeginEnd");this.addDependent(this._oNewExperienceWrapper)}return this._oNewExperienceWrapper};B.prototype.onBeforeRendering=function(){if(!A.last("/core/shellBar/enabled")){this.setShowAppTitle(d.media.getCurrentRange(d.media.RANGESETS.SAP_STANDARD).name!=="Phone")}};B.prototype.getFocusDomRef=function(){return this.getDomRef("button")};B._getCurrentState=function(){return C.getConfigModel().getProperty("/shellAppTitleState")};B._setCurrentState=function(e){C.getConfigModel().setProperty("/shellAppTitleState",e)};B.prototype.onclick=function(e){e.preventDefault();this.firePress();if(!this._getControlVisibilityAndState()){if(d.system.phone){y.setHash(A.last("/core/shellHeader/rootIntent"))}return}if(B._getCurrentState()===P.AllMyAppsOnly){g.start("FLP:ShellAppTitle.onClick","Click ShellAppTitle in HOME state, Launching AllMyApps","FLP");this._openCloseAllMyAppsPopover();return}this._openCloseNavMenuPopover()};B.prototype._openCloseAllMyAppsPopover=function(){if(!this.oAllMyAppsPopover){this.oAllMyAppsPopover=this._createAllMyAppsPopover()}if(this.oAllMyAppsPopover){if(this.oAllMyAppsPopover.isOpen()){this.oAllMyAppsPopover.close()}else{this.oAllMyAppsPopover.openBy(this)}}};B.prototype._openCloseNavMenuPopover=function(){if(!this.oNavMenuPopover){this.oNavMenuPopover=this._createNavMenuPopover()}B._setCurrentState(P.ShellNavMenu);if(this.oNavMenuPopover.isOpen()){this.oNavMenuPopover.close()}else{this.oNavMenuPopover.openBy(this)}if(this.oNavMenuPopover.getFooter()){const e=S.getShellMode()===N.Default;const t=S.isLegacyHome();this.oNavMenuPopover.getFooter().setVisible(e||t)}};B.prototype._getControlVisibilityAndState=function(){g.start("FLP:ShellAppTitle.getControlVisibilityAndState","Check AllMyApps and NavShellMenu visibility","FLP");const e=S.getShellMode()===N.Default;const t=S.isLegacyHome();const o=this._isNavMenuEnabled();let s=o;if(e||t){const e=A.last("/core/services/allMyApps/enabled");s=e||o;if(e&&o){B._setCurrentState(P.ShellNavMenu)}else if(!e&&o){B._setCurrentState(P.ShellNavMenuOnly)}else if(e&&!o){B._setCurrentState(P.AllMyAppsOnly)}}else{B._setCurrentState(P.ShellNavMenuOnly)}g.end("FLP:ShellAppTitle.getControlVisibilityAndState");return s};B.prototype._createAllMyAppsPopover=function(){const e=c.getElementById(this.getAllMyApps());if(!e){return null}const t=new p("sapUshellAllMyAppsPopover",{placement:m.Bottom,title:"",showArrow:true,customHeader:this._getPopoverHeader(),verticalScrolling:false,showHeader:{path:"configModel>/shellAppTitleState",formatter:function(e){return e!==P.ShellNavMenu}},content:[e],contentHeight:"28rem",contentWidth:"56rem"}).addStyleClass("sapContrastPlus");t.setModel(C.getConfigModel(),"configModel");t.attachBeforeOpen(()=>{f.getServiceAsync("AppLifeCycle").then(e=>{if(e.getCurrentApplication()?.homePage){const e=c.getElementById(this.getNewExperienceControl());if(e){const o=this._getNewExperienceWrapper();o.addItem(e);t.insertContent(o,0)}else if(this._oNewExperienceWrapper){this.addDependent(this._oNewExperienceWrapper)}}})});t.attachAfterOpen(()=>{const e=t.getCustomHeader();const o=e.getContentLeft()[0];const s=e.getContentLeft()[1];if(s.getVisible()){s.firePress();s.setPressed(true)}o.focus()});t.attachAfterClose(this._afterCloseAllMyAppsPopover.bind(this));return t};B.prototype._afterCloseAllMyAppsPopover=function(){if(this._bOpenNavigationMenu===true){this._bOpenNavigationMenu=false;this.oNavMenuPopover.openBy(this)}else if(!d.system.phone){this.focus()}};B.prototype._createNavMenuPopover=function(){const e=c.getElementById(this.getNavigationMenu());this.oTitle=new r("navMenuInnerTitle",{wrapping:true,text:"{shellModel>/application/title}"});this.oSecondTitle=new o("navMenuInnerSecondTitle",{text:"{shellModel>/header/secondTitle}",visible:"{= !!${shellModel>/header/secondTitle}}",wrapping:true});this.oIconControl=new h({src:"{shellModel>/application/icon}"});const t=new n({items:[this.oTitle,this.oSecondTitle]}).addStyleClass("sapUshellNavTitleBox");const l=new n({items:[this.oIconControl]}).addStyleClass("sapUiContentPadding");const p=new s("navMenuTitleBar",{width:"100%",items:[l,t]});const a=new i("sapUshellAppTitlePopover",{placement:m.Bottom,showArrow:true,showHeader:false,contentWidth:"20rem",horizontalScrolling:false,content:[p,e]}).addStyleClass("sapContrastPlus");if(A.last("/core/services/allMyApps/enabled")){a.setFooter(this._getPopoverFooterContent())}a.addStyleClass("sapUshellAppTitleNavigationMenuPopover");a.setModel(C.getModel(),"shellModel");C.getConfigModel().setProperty("/allMyAppsMasterLevel",_.FirstLevel);a.attachBeforeOpen(()=>{e._beforeOpen();const t=c.getElementById(this.getNewExperienceControl());if(t){const e=this._getNewExperienceWrapper();e.addItem(t);a.insertContent(e,1)}else if(this._oNewExperienceWrapper){this.addDependent(this._oNewExperienceWrapper)}});a.attachAfterOpen(()=>{e.$().on("touchmove.scrollFix",e=>{e.stopPropagation()});e._afterOpen()});a.attachAfterClose(this._afterCloseNavigationMenuPopover.bind(this));return a};B.prototype._afterCloseNavigationMenuPopover=function(){if(this._bOpenAllMyApps){this._bOpenAllMyApps=false;this._openCloseAllMyAppsPopover()}else if(!d.system.phone){this.focus()}};B.prototype._setAllMyAppsTitle=function(e){const t=B._getCurrentState();const o=C.getModel().getProperty("/header/secondTitle");if(o&&(t==="AllMyAppsOnly"||t==="AllMyApps")){e=`${e} - ${o}`}r.prototype.setText.apply(this,[e])};B.prototype._getPopoverHeader=function(){const t=new r({text:v.i18n.getText("allMyApps_headerTitle"),level:"H1"});t.setText=this._setAllMyAppsTitle.bind(t);const o=new e("sapUshellShellAppPopoverHeader",{contentLeft:[this._createPopoverBackButton(),this._createPopoverToggleButton()],contentMiddle:[t]});return o};B.prototype.onAfterRendering=function(){this._adjustAppTitleTooltip()};B.prototype._adjustAppTitleTooltip=function(){const e=this.getDomRef("button");const t=e&&e.firstChild;if(t){let e;const o=A.last("/core/services/allMyApps/enabled");const s=S.getShellMode()===N.Default;const n=S.isLegacyHome();const l=(s||n)&&o;const i=c.getElementById(this.getNavigationMenu());const p=i&&i.getItems()&&i.getItems().length>0;if(p){e=v.i18n.getText("shellNavMenu_openMenuTooltip_navigationMenu")}else if(l){e=v.i18n.getText("shellNavMenu_openMenuTooltip_allMyApps")}else{const o=t.offsetWidth<t.scrollWidth;e=o?this.getText():null}if(this.getTooltip()!==e){this.setTooltip(e)}}};B.prototype._createPopoverBackButton=function(){const e=new t("sapUshellAppTitleBackButton",{icon:u.getIconURI("nav-back"),press:[this._popoverBackButtonPressHandler,this],tooltip:v.i18n.getText("backBtn_tooltip"),visible:this.getAllMyAppsController().getBackButtonVisible()});e.addStyleClass("sapUshellCatalogNewGroupBackButton");return e};B.prototype._popoverBackButtonPressHandler=function(){const e=this.getAllMyAppsController();const t=e.getCurrentState();if(t===_.FirstLevel||t===_.FirstLevelSpread){if(B._getCurrentState()!==P.AllMyAppsOnly){B._setCurrentState(P.ShellNavMenu);this.oAllMyAppsPopover.close();this._bOpenNavigationMenu=true}}else if(t===_.SecondLevel){e.switchToInitialState()}else{e.handleSwitchToMasterAreaOnPhone()}e.updateHeaderButtonsState()};B.prototype._createPopoverToggleButton=function(){const e=this.getAllMyAppsController();const t=new a("sapUshellAllMyAppsToggleListButton",{icon:u.getIconURI("sap-icon://menu2"),press:function(t){e.switchToInitialState();this.setTooltip(t.getParameter("pressed")?v.i18n.getText("ToggleButtonHide"):v.i18n.getText("ToggleButtonShow"))},tooltip:v.i18n.getText("ToggleButtonShow"),visible:e.getToggleListButtonVisible()});d.media.attachHandler(()=>{t.setVisible(e.getToggleListButtonVisible())},this,d.media.RANGESETS.SAP_STANDARD);t.addStyleClass("sapUshellAllMyAppsToggleListButton");return t};B.prototype._getPopoverFooterContent=function(){const o=new t("allMyAppsButton",{text:v.i18n.getText("allMyApps_launchingButtonTitle"),press:this._allMyAppsButtonPressHandler.bind(this),visible:{path:"shellConfig>/shellAppTitleState",formatter:function(e){return e===P.ShellNavMenu}}});const s=new e("shellpopoverFooter",{contentMiddle:[o]});this.addCustomData(o,"role","button");this.addCustomData(o,"aria-label",v.i18n.getText("allMyApps_launchingButtonTitle"));return s};B.prototype._allMyAppsButtonPressHandler=function(){if(c.getElementById(this.getAllMyApps())){g.start("FLP:ShellNavMenu.footerClick","Click the footer of ShellNavMenu, Launching AllMyApps","FLP");B._setCurrentState(P.AllMyApps);this.oNavMenuPopover.close();this._bOpenAllMyApps=true}};B.prototype._isNavMenuEnabled=function(){const e=c.getElementById(this.getNavigationMenu());return e?e.getItems()&&e.getItems().length>0:false};B.prototype.addCustomData=function(e,t,o){e.addCustomData(new T({key:t,value:o,writeToDom:true}))};B.prototype.close=function(){if(this.oNavMenuPopover&&this.oNavMenuPopover.isOpen()){this.oNavMenuPopover.close()}if(this.oAllMyAppsPopover&&this.oAllMyAppsPopover.isOpen()){this.oAllMyAppsPopover.close()}};B.prototype.setTooltip=function(e){this.setAggregation("tooltip",e);this.oIcon.setTooltip(e)};B.prototype.getAllMyAppsController=function(){const e=c.getElementById(this.getAllMyApps());return e.getController()};B.prototype.onkeyup=function(e){t.prototype.onkeyup.apply(this,arguments);if(e.keyCode===32){this.onclick(e)}};B.prototype.onsapenter=B.prototype.onclick;B.prototype.exit=function(){const e=c.getElementById(this.getNavigationMenu());const t=c.getElementById(this.getAllMyApps());if(e){e.destroy()}if(t){t.destroy()}if(this.oAllMyAppsPopover){this.oAllMyAppsPopover.destroy()}if(this.oNavMenuPopover){this.oNavMenuPopover.destroy()}if(this.oIcon){this.oIcon.destroy()}};return B});
//# sourceMappingURL=ShellAppTitle.js.map