// Copyright (c) 2009-2025 SAP SE, All Rights Reserved
sap.ui.define(["sap/base/i18n/Localization","sap/ui/core/Control","sap/ui/core/Element","sap/ui/Device","sap/ui/dom/units/Rem","sap/ui/thirdparty/hasher","sap/base/Log","sap/ushell/api/NewExperience","sap/ushell/EventHub","sap/ushell/library","sap/ushell/ui/ShellHeaderRenderer","sap/ushell/utils","sap/ushell/utils/WindowUtils","sap/ushell/state/StateManager","sap/ushell/Container","sap/ui/events/KeyCodes","sap/ushell/renderer/ShellLayout"],(e,t,n,i,o,a,s,r,l,h,d,u,c,g,p,f,y)=>{"use strict";const m=g.ShellMode;const S="sapUshellShellShowSearchOverlay";let L=0;let v;const R=t.extend("sap.ushell.ui.ShellHeader",{metadata:{library:"sap.ushell",properties:{logo:{type:"sap.ui.core.URI",defaultValue:""},logoAltText:{type:"string",defaultValue:""},homeUri:{type:"sap.ui.core.URI",defaultValue:"#"},searchState:{type:"string",defaultValue:"COL"},ariaLabel:{type:"string"},centralAreaElement:{type:"string",defaultValue:null},showNewExperienceSwitch:{type:"boolean",defaultValue:false},title:{type:"string",defaultValue:""}},aggregations:{headItems:{type:"sap.ushell.ui.shell.ShellHeadItem",multiple:true},headEndItems:{type:"sap.ui.core.Control",multiple:true},search:{type:"sap.ui.core.Control",multiple:false},appTitle:{type:"sap.ushell.ui.shell.ShellAppTitle",multiple:false}},associations:{},events:{searchSizeChanged:{}}},renderer:d});R.prototype.setHomeUri=function(e){if(c.hasInvalidProtocol(e)){s.fatal("Tried to set a URL with an invalid protocol as the home uri. Setting to an empty string instead.",null,"sap/ushell/ui/ShellHeader");e=""}this._bHomeIsRoot=u.isRootIntent(e);return this.setProperty("homeUri",e)};R.prototype.SearchState={COL:"COL",EXP:"EXP",EXP_S:"EXP_S"};R.prototype.FLPRangeSet={name:"Ushell",rangeBorders:[600,1024,1440,1920],rangeNames:["Phone","Tablet","Desktop","LargeDesktop","ExtraLargeDesktop"]};R.prototype.init=function(){i.media.initRangeSet(this.FLPRangeSet.name,this.FLPRangeSet.rangeBorders,"px",this.FLPRangeSet.rangeNames);const e=y.hasAdjacentSideContentBeforeMain();this._applySideContent(e);y.attachAdjacentSideContentBeforeMainChanged(this._handleSideContent,this);i.media.attachHandler(this.invalidate,this,this.FLPRangeSet.name);i.resize.attachHandler(this.refreshLayout,this);l.once("ShellNavigationInitialized").do(()=>{p.getServiceAsync("ShellNavigationInternal").then(e=>{this._rerenderLogoNavigationFilterBound=this._rerenderLogoNavigationFilter.bind(this,e);e.registerNavigationFilter(this._rerenderLogoNavigationFilterBound);this._rerenderLogoNavigationFilterBound.detach=function(){e.unregisterNavigationFilter(this._rerenderLogoNavigationFilterBound)}})});this._oLastFocusedHeaderElement=null;this._oEventDelegate={onfocusin:this._handleOnFocusIn,onkeydown:this._handleOnKeyDown,onBeforeFastNavigationFocus:this._handleOnBeforeFastNavigationFocus};this.addEventDelegate(this._oEventDelegate,this)};R.prototype.exit=function(){i.media.detachHandler(this.invalidate,this,this.FLPRangeSet.name);i.resize.detachHandler(this.refreshLayout,this);if(this._rerenderLogoNavigationFilterfnRerenderLogoNavigationFilter){this._rerenderLogoNavigationFilterfnRerenderLogoNavigationFilter.detach()}this.removeEventDelegate(this._oEventDelegate);delete this._oEventDelegate;y.detachAdjacentSideContentBeforeMainChanged(this._handleSideContent,this)};R.prototype._handleSideContent=function(e){const t=e.getParameters();const n=t.hasAdjacentContentBefore;this._applySideContent(n)};R.prototype._applySideContent=function(e){this.toggleStyleClass("sapUshellFixedPadding",e)};R.prototype.setFocusOnShellHeader=function(e){if(e){const e=this.getHeadEndItems();if(e.length>0){e[e.length-1].focus()}else{this.getAppTitle().focus()}}else{const e=this.getHeadItems();if(e.length>0){e[0].focus()}else{this.getAppTitle().focus()}}};R.prototype.setFocusOnSearchAfterRender=function(){const e=this.getSearchState();const t=n.getElementById("searchFieldInShell-input");if(e==="COL"&&t){const e=n.getElementById("sf");if(e){e.focus()}}};R.prototype.onsapspace=function(e){if(e.target===this.getDomRef("logo")){this._setLocationHref(e.target.href)}};R.prototype._setLocationHref=function(e){if(c.hasInvalidProtocol(e)){s.fatal("Tried to navigate to URL with an invalid protocol. Preventing navigation.",null,"sap/ushell/ui/ShellHeader");return}window.location.href=e};R.prototype.onAfterRendering=function(){const e=this.getDomRef();if(!v&&document.body.getBoundingClientRect().height===0){e.style.visibility="hidden";e.style.height="2.75rem";return}this.refreshLayout();setTimeout(()=>{if(!document.activeElement||document.activeElement===document.body){this.setFocusOnSearchAfterRender()}},1)};R.prototype._handleOnKeyDown=function(e){if(e.keyCode===f.ARROW_RIGHT||e.keyCode===f.ARROW_LEFT){this._handleArrowNavigation(e)}if(e.keyCode===f.END||e.keyCode===f.HOME){this._handleHomeEndNavigation(e)}return};R.prototype._handleArrowNavigation=function(e){const t=this.getDomRef();const n=document.activeElement;if(!n||!t.contains(n)||n.tagName==="INPUT"||n.tagName==="TEXTAREA"){return}const i=this._getFocusableHeaderItems();let o;let a=i.indexOf(n);if(a<0&&this._oLastFocusedHeaderElement){a=i.indexOf(this._oLastFocusedHeaderElement)}if(a>=0){const t=e.keyCode===f.ARROW_RIGHT?a+1:a-1;o=i[t]}if(!o){i[a].focus();return}o.focus()};R.prototype._handleHomeEndNavigation=function(e){const t=this.getDomRef();const n=document.activeElement;if(!n||!t.contains(n)||n.id==="searchFieldInShell-input-inner"){return}const i=this._getFocusableHeaderItems();let o;if(e.keyCode===f.END){o=i.at(-1)}else if(e.keyCode===f.HOME){o=i.at(0)}else{return}o.focus()};R.prototype._handleOnFocusIn=function(){const e=document.activeElement;this._oLastFocusedHeaderElement=e};R.prototype._getFocusableHeaderItems=function(){const t=this.getDomRef();const n=Array.from(t.querySelectorAll("*:is(input, textarea, select, button, a, [tabindex])")).filter(e=>!e.disabled&&!e.hidden&&(e.checkVisibility?.()??true)&&e.getAttribute("tabindex")!=="-1");if(e.getRTL()){return n.reverse()}return n};R.prototype._handleOnBeforeFastNavigationFocus=function(e){e.preventDefault();const t=this._getFocusableHeaderItems();if(this._oLastFocusedHeaderElement&&t.includes(this._oLastFocusedHeaderElement)){this._oLastFocusedHeaderElement.focus();return}this._oLastFocusedHeaderElement=null;if(document.getElementById("shell-header-logo")){document.getElementById("shell-header-logo").focus()}else{this.setFocusOnShellHeader()}};R.prototype.onThemeChanged=function(e){v=e.theme};R.prototype.getLogo=function(){return this.getProperty("logo")};R.prototype.getShowLogo=function(){return!!this.getProperty("logo")};R.prototype.refreshLayout=function(){if(!this.getDomRef()){return}if(this.getSearchVisible()){const e=this.getDomRef("hdr-search");e.style.display="none";this._hideElementsForSearch();e.style.display="";e.style["max-width"]=`${L}rem`;this.fireSearchSizeChanged({remSize:o.fromPx(e.getBoundingClientRect().width),isFullWidth:this.isPhoneState()||this.getDomRef("hdr-end").style.display==="none"})}};R.prototype.removeHeadItem=function(e){if(typeof e==="number"){e=this.getHeadItems()[e]}this.removeAggregation("headItems",e)};R.prototype.isExtraLargeState=function(){return i.media.getCurrentRange(this.FLPRangeSet.name).from===this.FLPRangeSet.rangeBorders[3]};R.prototype.isMediumOrBiggerState=function(){return i.media.getCurrentRange(this.FLPRangeSet.name).from>=this.FLPRangeSet.rangeBorders[0]};R.prototype.isPhoneState=function(){const e=i.media.getCurrentRange(i.media.RANGESETS.SAP_STANDARD).name;const t=this.getDomRef().getBoundingClientRect().width>L;return i.system.phone||e==="Phone"||!t};R.prototype.setSearchState=function(e,t,n){if(this.SearchState[e]&&this.getSearchState()!==e){if(typeof t==="boolean"){n=t;t=undefined}this.setProperty("searchState",e,false);const i=e!=="COL";document.body.classList.toggle(S,i&&n);L=i?t||35:0}};R.prototype._hideElementsForSearch=function(){if(this.isExtraLargeState()){return}let e;const t=this.getDomRef("hdr-search-container");const n=this.getDomRef("hdr-begin");const i=this.getDomRef("hdr-center");const a=this.getDomRef("hdr-end");if(this.getSearchState()==="EXP"||this.isPhoneState()){e=o.toPx(L+3)}else{e=o.toPx(9+.5)}const s=[n];Array.prototype.forEach.call(n.childNodes,e=>{s.unshift(e)});if(i){s.unshift(i)}n.style.flexBasis="";a.style.display="";s.forEach(e=>{if(e.getAttribute("id")==="shellAppTitle"){e.classList.remove("sapUiPseudoInvisibleText")}else{e.style.display=""}});let r;for(let o=0;o<s.length;o++){r=s[o];if(e>t.getBoundingClientRect().width){if(r.getAttribute("id")==="shellAppTitle"){r.classList.add("sapUiPseudoInvisibleText")}else{r.style.display="none";if(i&&o===0){n.style.flexBasis="auto"}}}else{return}}if(o.toPx(L)>t.getBoundingClientRect().width){a.style.display="none"}};R.prototype.getSearchWidth=function(){return L};R.prototype.isHomepage=function(){const e=`#${a.getHash()}`;const t=new RegExp("[?]"+"(?:"+"(?!&[/])."+")*");const n=e.replace(t,"");return u.isRootIntent(n)||n==="#Launchpad-openFLPPage"};R.prototype._rerenderLogoNavigationFilter=function(e,t,n){const i=e.hashChanger.isInnerAppNavigation(t,n);if(i){this.invalidate()}return e.NavigationFilterStatus.Continue};R.prototype.getSearchVisible=function(){return this.getSearchState()!==this.SearchState.COL};R.prototype.getCentralControl=function(){return n.getElementById(this.getCentralAreaElement())};R.prototype._getLeanMode=function(){return g.getShellMode()===m.Lean};R.prototype.getNewExperienceSwitchControl=function(){if(!r.isActive()){return}if(this.getShowNewExperienceSwitch()){return r.getShellHeaderControl()}};return R});
//# sourceMappingURL=ShellHeader.js.map