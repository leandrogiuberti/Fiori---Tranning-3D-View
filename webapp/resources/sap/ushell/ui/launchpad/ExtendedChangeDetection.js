// Copyright (c) 2009-2025 SAP SE, All Rights Reserved
sap.ui.define(["sap/ui/base/ManagedObject","sap/ushell/Config"],(t,e)=>{"use strict";const n=t.extend("sap.ushell.ui.launchpad.ExtendedChangeDetection",{metadata:{library:"sap.ushell",events:{itemDeleted:{},itemAdded:{},itemsReordered:{}}},constructor:function(n,i,o){t.call(this);this._oAggregation=i.getMetadata().getAggregation(n);this._oControl=i;this._sAggregationName=n;this._aSiblingAggregationNames=o;const s=e.last("/core/spaces/extendedChangeDetection/enabled");if(s){this._oControl[this._oAggregation._sUpdater]=this._updateAggregation.bind(this);this._oControl.bUseExtendedChangeDetection=true}}});n.oUpdateFromSiblingCache={};n.prototype._updateAggregation=function(){const t=this._oControl.getBindingInfo(this._sAggregationName);const e=t.binding;const n=this._isUpdateFromSibling();const i=e.aLastContextData||[];const o=i.map(e=>{try{const n=JSON.parse(e);return n[t.key]}catch{return e}});const s=e.getContexts();const r=s.map(e=>e.getProperty(t.key));const g=s.diff;let a;const l=[];const d=[];const h={};let c=false;let f=false;if(g){for(a=0;a<g.length;a++){const t=g[a];if(t.type==="insert"){l.push({item:r[t.index],index:t.index})}if(t.type==="delete"){d.push({item:o[t.index-l.length],index:t.index-l.length});o.splice(t.index-l.length,1)}}for(a=0;a<d.length;a++){h[d[a].item]=this._oControl.removeAggregation(this._sAggregationName,d[a].index,true)}for(a=0;a<l.length;a++){const e=l[a];const n=h[e.item];if(n&&!(g.length>=2&&g[0].index===g[1].index)){this._oControl.insertAggregation(this._sAggregationName,n,e.index,true);delete h[e.item]}else{this._createAndInsertItem(s[e.index],t,e.index);f=true}}c=!!Object.keys(h).length;for(const t in h){h[t].destroy();delete h[t]}}else if(!(n&&r.length===0&&o.length===0)){this._createAndInsertItems(s,t);f=true}else{return}this._updateBindingContexts(s);if(s.length===0){this._oControl.invalidate()}if(c){this.fireItemDeleted()}if(f){this.fireItemAdded()}if(!c&&!f&&g){this.fireItemsReordered()}if(g&&g.length&&!n){this._refreshSiblingBindings()}};n.prototype._isUpdateFromSibling=function(){const t=`${this._oControl.getId()}:${this._sAggregationName}`;if(n.oUpdateFromSiblingCache[t]){delete n.oUpdateFromSiblingCache[t];return true}return false};n.prototype._refreshSiblingBindings=function(){if(this._aSiblingAggregationNames){for(let t=0;t<this._aSiblingAggregationNames.length;++t){const e=this._aSiblingAggregationNames[t];const i=`${this._oControl.getId()}:${e}`;const o=this._oControl.getBinding(e);n.oUpdateFromSiblingCache[i]=true;o.refresh(true)}}};n.prototype._createAndInsertItems=function(t,e){this._oAggregation.destroy(this._oControl);for(let n=0;n<t.length;n++){this._createAndInsertItem(t[n],e,n)}};n.prototype._createAndInsertItem=function(t,e,n){const i=e.factory(null,t);this._oControl.insertAggregation(this._sAggregationName,i,n,true)};n.prototype._updateBindingContexts=function(t){const e=this._oAggregation.get(this._oControl);for(let n=0;n<e.length;n++){e[n].setBindingContext(t[n])}};return n});
//# sourceMappingURL=ExtendedChangeDetection.js.map