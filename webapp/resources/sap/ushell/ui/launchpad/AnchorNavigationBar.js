// Copyright (c) 2009-2025 SAP SE, All Rights Reserved
sap.ui.define(["./AnchorNavigationBarRenderer","sap/base/i18n/Localization","sap/base/util/isEmptyObject","sap/m/Bar","sap/m/Button","sap/ui/core/Element","sap/ui/core/ResizeHandler","sap/ui/Device","sap/ui/thirdparty/jquery","sap/ushell/library","sap/ushell/resources"],(t,e,s,o,i,l,r,n,jQuery,h,a)=>{"use strict";const c=o.extend("sap.ushell.ui.launchpad.AnchorNavigationBar",{metadata:{library:"sap.ushell",properties:{accessibilityLabel:{type:"string",defaultValue:null},selectedItemIndex:{type:"int",group:"Misc",defaultValue:0},overflowEnabled:{type:"boolean",group:"Misc",defaultValue:true}},aggregations:{groups:{type:"sap.ushell.ui.launchpad.AnchorItem",multiple:true,singularName:"group"}},events:{afterRendering:{},itemPress:{}}},renderer:t});c.prototype.init=function(){this.bGroupWasPressed=false;this.bIsRtl=e.getRTL();this._bIsRenderedCompletely=false;this.fnNavigationBarItemsVisibility=this.setNavigationBarItemsVisibility.bind(this);this.fnAdjustVisibleAnchorItemsAccessibility=this.adjustVisibleAnchorItemsAccessibility.bind(this)};c.prototype.onBeforeRendering=function(){if(this._sResizeListenerId){r.deregister(this._sResizeListenerId);this._sResizeListenerId=null}const t=window.document.getElementsByClassName("sapUshellAnchorNavigationBarItemsScroll")[0];if(t){t.removeEventListener("scroll",this.fnNavigationBarItemsVisibility)}};c.prototype.onAfterRendering=function(){const t=this.getDomRef();if(this._bIsRenderedCompletely){this.reArrangeNavigationBarElements();this.adjustVisibleAnchorItemsAccessibility();const e=window.document.getElementsByClassName("sapUshellAnchorNavigationBarItemsScroll")[0];if(e){e.addEventListener("scroll",this.fnNavigationBarItemsVisibility)}if(t){this._sResizeListenerId=r.register(t,this.reArrangeNavigationBarElements.bind(this))}}};c.prototype.openOverflowPopup=function(){const t=jQuery(".sapUshellAnchorItemOverFlow").hasClass("sapUshellAnchorItemOverFlowOpen");if(this.oOverflowButton&&!t){this.oOverflowButton.firePress()}};c.prototype.closeOverflowPopup=function(){if(this.oPopover){this.oPopover.close()}};c.prototype.reArrangeNavigationBarElements=function(){this.anchorItems=this.getVisibleGroups();const t=this.getSelectedItemIndex()||0;if(this.anchorItems.length){this.adjustItemSelection(t)}if(n.system.phone&&this.anchorItems.length){this.anchorItems.forEach(t=>{t.setIsGroupVisible(false)});this.anchorItems[this.getSelectedItemIndex()].setIsGroupVisible(true)}else{setTimeout(()=>{if(this.isDestroyed()){return}this.setNavigationBarItemsVisibility()},200)}};c.prototype._scrollToGroupByGroupIndex=function(t,e){const s=n.system.tablet?".sapUshellAnchorNavigationBarItemsScroll":".sapUshellAnchorNavigationBarItems";const o=document.documentElement.querySelector(s);const i=this.anchorItems[t].getDomRef();if(o&&i){const t=o.getBoundingClientRect();const e=i.getBoundingClientRect();const s=jQuery(o);const l=this.bIsRtl?s.scrollLeftRTL():o.scrollLeft;let r;if(e.left<t.left){r=e.left-t.left-16}else if(e.right>t.right){r=e.right-t.right+16}if(r){if(this.bIsRtl){s.scrollLeftRTL(l+r)}else{o.scrollLeft=l+r}}this.setNavigationBarItemsVisibility()}};c.prototype.setNavigationBarItemsVisibility=function(){if(!n.system.phone){this.setNavigationBarItemsVisibilityOnDesktop()}else if(this.anchorItems&&this.anchorItems.length>0){this.oOverflowButton.removeStyleClass("sapUshellShellHidden");const t=this.getSelectedItemIndex()||0;if(this.oPopover){this.oPopover.setTitle(this.anchorItems[t].getTitle())}}};c.prototype.setNavigationBarItemsVisibilityOnDesktop=function(){if(this.anchorItems.length&&(!this.isMostRightAnchorItemVisible()||!this.isMostLeftAnchorItemVisible())){this.oOverflowButton.removeStyleClass("sapUshellShellHidden")}else if(this.oOverflowButton){this.oOverflowButton.addStyleClass("sapUshellShellHidden")}if(this.bIsRtl){if(this.anchorItems.length&&!this.isMostLeftAnchorItemVisible()){this.oOverflowRightButton.removeStyleClass("sapUshellShellHidden")}else if(this.oOverflowRightButton){this.oOverflowRightButton.addStyleClass("sapUshellShellHidden")}if(this.anchorItems.length&&!this.isMostRightAnchorItemVisible()){this.oOverflowLeftButton.removeStyleClass("sapUshellShellHidden")}else if(this.oOverflowLeftButton){this.oOverflowLeftButton.addStyleClass("sapUshellShellHidden")}}else{if(this.anchorItems.length&&!this.isMostLeftAnchorItemVisible()){this.oOverflowLeftButton.removeStyleClass("sapUshellShellHidden")}else if(this.oOverflowLeftButton){this.oOverflowLeftButton.addStyleClass("sapUshellShellHidden")}if(this.anchorItems.length&&!this.isMostRightAnchorItemVisible()){this.oOverflowRightButton.removeStyleClass("sapUshellShellHidden")}else if(this.oOverflowRightButton){this.oOverflowRightButton.addStyleClass("sapUshellShellHidden")}}};c.prototype.adjustItemSelection=function(t){setTimeout(()=>{if(this.anchorItems&&this.anchorItems.length){this.anchorItems.forEach(t=>{t.setSelected(false)});if(t>=0&&t<this.anchorItems.length){this.anchorItems[t].setSelected(true);this._scrollToGroupByGroupIndex(t)}}},50)};c.prototype.isMostRightAnchorItemVisible=function(){const t=jQuery(".sapUshellAnchorNavigationBarInner");const e=!s(t)?t.width():0;const o=!s(t)&&t.offset()?t.offset().left:0;const i=this.bIsRtl?this.anchorItems[0].getDomRef():this.anchorItems[this.anchorItems.length-1].getDomRef();let l=!s(i)?jQuery(i).width():0;if(l<0){l=80}const r=i&&jQuery(i).offset()?jQuery(i).offset().left:0;return Math.ceil(r)+l<=o+e};c.prototype.isMostLeftAnchorItemVisible=function(){const t=jQuery(".sapUshellAnchorNavigationBarInner");const e=!s(t)&&t.offset()&&t.offset().left||0;const o=this.bIsRtl?this.anchorItems[this.anchorItems.length-1].getDomRef():this.anchorItems[0].getDomRef();const i=!s(o)&&jQuery(o).offset()?jQuery(o).offset().left:0;return Math.ceil(i)>=e};c.prototype.setSelectedItemIndex=function(t){if(t!==undefined){this.setProperty("selectedItemIndex",t,true)}};c.prototype.setOverflowEnabled=function(t){this.setProperty("overflowEnabled",t);if(this.oOverflowButton){this.oOverflowButton.setEnabled(t)}};c.prototype._getOverflowLeftArrowButton=function(){if(!this.oOverflowLeftButton){this.oOverflowLeftButton=new i({icon:"sap-icon://slim-arrow-left",tooltip:a.i18n.getText("scrollToTop"),press:function(){this._scrollToGroupByGroupIndex(0)}.bind(this)}).addStyleClass("sapUshellShellHidden");this.oOverflowLeftButton._bExcludeFromTabChain=true}return this.oOverflowLeftButton};c.prototype._getOverflowRightArrowButton=function(){if(!this.oOverflowRightButton){this.oOverflowRightButton=new i({icon:"sap-icon://slim-arrow-right",tooltip:a.i18n.getText("scrollToEnd"),press:function(){this._scrollToGroupByGroupIndex(this.anchorItems.length-1)}.bind(this)}).addStyleClass("sapUshellShellHidden");this.oOverflowRightButton._bExcludeFromTabChain=true}return this.oOverflowRightButton};c.prototype._getOverflowButton=function(){if(!this.oOverflowButton){this.oOverflowButton=new i("sapUshellAnchorBarOverflowButton",{icon:"sap-icon://slim-arrow-down",tooltip:a.i18n.getText("more_groups"),enabled:this.getOverflowEnabled(),press:function(){this._togglePopover()}.bind(this)}).addStyleClass("sapUshellShellHidden")}return this.oOverflowButton};c.prototype._togglePopover=function(){sap.ui.require(["sap/m/Popover","sap/ui/model/Filter","sap/ushell/ui/launchpad/GroupListItem","sap/m/List","sap/m/library"],(t,s,o,i,r)=>{const n=r.ListMode;if(!this.oPopover){this.oList=new i({mode:n.SingleSelectMaster,rememberSelections:false,selectionChange:function(t){this.fireItemPress({group:t.getParameter("listItem")});this.oPopover.close()}.bind(this)});this.oPopover=new t("sapUshellAnchorBarOverflowPopover",{showArrow:false,showHeader:false,placement:"Left",content:[this.oList],horizontalScrolling:false,beforeOpen:function(){const t=jQuery(".sapUshellAnchorItemOverFlow");const s=e.getRTL();const o=s?-1*t.outerWidth():t.outerWidth();this.setOffsetX(o)},afterClose:function(){jQuery(".sapUshellAnchorItemOverFlow").removeClass("sapUshellAnchorItemOverFlowOpen");jQuery(".sapUshellAnchorItemOverFlow").toggleClass("sapUshellAnchorItemOverFlowPressed",false)}}).addStyleClass("sapUshellAnchorItemsPopover").addStyleClass("sapContrastPlus")}if(this.oPopover.isOpen()){this.oPopover.close()}else{this.anchorItems=this.getVisibleGroups();this.oList.setModel(this.getModel());const t=this.getModel().getProperty("/tileActionModeActive");const e=new s("","EQ","a");e.fnTest=function(e){if(!e.visibilityModes[t?1:0]){return false}return e.isGroupVisible||t};this.oList.bindItems({path:"/groups",template:new o({title:"{title}",groupId:"{groupId}",index:"{index}"}),filters:[e]});const i=jQuery(".sapUshellAnchorItemSelected").attr("id");const r=l.getElementById(i);this.oList.getItems().forEach(t=>{if(r.mProperties.groupId===t.mProperties.groupId){t.addStyleClass("sapUshellAnchorPopoverItemSelected")}else{t.addStyleClass("sapUshellAnchorPopoverItemNonSelected")}});jQuery(".sapUshellAnchorItemOverFlow").toggleClass("sapUshellAnchorItemOverFlowPressed",true);this.oPopover.openBy(this.oOverflowButton)}})};c.prototype.getVisibleGroups=function(){return this.getGroups().filter(t=>t.getVisible())};c.prototype._setRenderedCompletely=function(t){this._bIsRenderedCompletely=t};c.prototype.handleAnchorItemPress=function(t){this.bGroupWasPressed=true;this.fireItemPress({group:t.getSource(),manualPress:true})};c.prototype.adjustVisibleAnchorItemsAccessibility=function(){const t=this.getVisibleGroups();const e=t.length;t.forEach((t,s)=>{t.setPosinset(s+1);t.setSetsize(e)})};c.prototype.addGroup=function(t,e){t.attachVisibilityChanged(this.fnAdjustVisibleAnchorItemsAccessibility);return this.addAggregation("groups",t,e)};c.prototype.insertGroup=function(t,e,s){t.attachVisibilityChanged(this.fnAdjustVisibleAnchorItemsAccessibility);return this.insertAggregation("groups",t,e,s)};c.prototype.removeGroup=function(t,e){t.detachVisibilityChanged(this.fnAdjustVisibleAnchorItemsAccessibility);return this.removeAggregation("groups",t,e)};c.prototype.exit=function(){if(this.oOverflowLeftButton){this.oOverflowLeftButton.destroy()}if(this.oOverflowRightButton){this.oOverflowRightButton.destroy()}if(this.oOverflowButton){this.oOverflowButton.destroy()}if(this.oPopover){this.oPopover.destroy()}if(o.prototype.exit){o.prototype.exit.apply(this,arguments)}if(this._sResizeListenerId){r.deregister(this._sResizeListenerId);this._sResizeListenerId=null}};return c});
//# sourceMappingURL=AnchorNavigationBar.js.map