// Copyright (c) 2009-2025 SAP SE, All Rights Reserved
sap.ui.define(["sap/base/Log","sap/m/Button","sap/m/ButtonRenderer","sap/m/Dialog","sap/m/library","sap/m/MessageBox","sap/m/Text","sap/m/VBox","sap/ui/core/library","sap/ui/core/mvc/View","sap/ui/Device","sap/ui/model/json/JSONModel","sap/ushell/Config","sap/ushell/library","sap/ushell/resources","sap/ushell/state/StateManager"],(e,t,o,s,i,r,a,n,l,u,p,c,d,h,g,f)=>{"use strict";const y=i.ButtonType;const m=l.ValueState;const b=l.mvc.ViewType;const M=f.LaunchpadState;const S=f.ShellMode;const{Headerless:k,Standalone:B,Embedded:T,Merged:P}=S;const D=t.extend("sap.ushell.ui.footerbar.AddBookmarkButton",{metadata:{library:"sap.ushell",properties:{beforePressHandler:{type:"function",group:"Misc",defaultValue:null},afterPressHandler:{type:"function",group:"Misc",defaultValue:null},title:{type:"string",group:"Misc",defaultValue:null},subtitle:{type:"string",group:"Misc",defaultValue:null},info:{type:"string",group:"Misc",defaultValue:null},tileIcon:{type:"string",group:"Appearance",defaultValue:null},numberUnit:{type:"string",group:"Appearance",defaultValue:null},keywords:{type:"string",group:"Misc",defaultValue:null},customUrl:{type:"any",group:"Misc",defaultValue:null},serviceUrl:{type:"any",group:"Misc",defaultValue:null},dataSource:{type:"any",group:"Misc",defaultValue:null},serviceRefreshInterval:{type:"string",group:"Misc",defaultValue:null},showGroupSelection:{type:"boolean",group:"Misc",defaultValue:true},showPageSelection:{type:"boolean",group:"Misc",defaultValue:true},appData:{type:"object",group:"Misc",defaultValue:null,deprecated:true}}},renderer:o});D.prototype.init=function(){if(t.prototype.init){t.prototype.init.apply(this,arguments)}this.bSpaceEnabled=d.last("/core/spaces/enabled");this.bMyHomeEnabled=d.last("/core/spaces/myHome/enabled");this.setIcon("sap-icon://add-favorite");this.bindProperty("text",{path:"i18n>addToHomePageBtn"});this.setEnabled();this.oModel=new c({showGroupSelection:true,showPageSelection:true,title:"",subtitle:"",numberValue:0,info:"",icon:"",numberUnit:"",keywords:""});this.setModel(g.i18nModel,"i18n");this.attachPress(()=>{const e=this.getBeforePressHandler();if(e){e()}this.showAddBookmarkDialog()})};D.prototype.exit=function(){if(this.oDialog){this.oDialog.destroy()}if(this.oModel){this.oModel.destroy()}if(t.prototype.exit){t.prototype.exit.apply(this,arguments)}};D.prototype.setBookmarkTileView=function(e){this.bookmarkTileView=e};D.prototype.getBookmarkTileView=function(){return this.bookmarkTileView};D.prototype.showAddBookmarkDialog=function(){const e=this.getAppData()||{};const t={serviceUrl:this.getServiceUrl()||e.serviceUrl,customUrl:this.getCustomUrl()||e.customUrl};this.oModel.setProperty("/serviceUrl",!!t.serviceUrl);let o;if(this.bSpaceEnabled){o=u.create({type:b.XML,viewName:"sap.ushell.ui.bookmark.SaveOnPage",viewData:t})}else{o=u.create({viewName:"module:sap/ushell/ui/footerbar/SaveAsTile.view",viewData:t})}return o.then(e=>{this.setBookmarkTileView(e);e.setModel(this.oModel);e.setModel(g.i18nModel,"i18n");return this._openDialog(e)})};D.prototype._openDialog=function(e){this.oDialog=new s({id:"bookmarkDialog",title:"{i18n>addToHomePageBtn}",contentWidth:"25rem",content:e,beginButton:new t("bookmarkOkBtn",{text:"{i18n>saveBtn}",type:y.Emphasized,press:[this._handleOKButtonPress,this]}),endButton:new t("bookmarkCancelBtn",{text:"{i18n>cancelBtn}",press:[this._handleCancelButtonPress,this]}),stretch:p.system.phone,horizontalScrolling:false,afterClose:function(){const e=this.getAfterPressHandler();if(e){e()}this._restoreDialogEditableValuesToDefault();this.oDialog.destroy();delete this.oDialog}.bind(this)}).addStyleClass("sapContrastPlus");this.oDialog.open();this.oDialog.setModel(g.i18nModel,"i18n");return this.oDialog};D.prototype._handleOKButtonPress=function(){if(this.oDialog.getBusy()){return}if(!this.bSpaceEnabled){this._handleOKButtonPressClassicMode();return}this._handleOKButtonPressSpacesMode()};D.prototype._handleCancelButtonPress=function(){if(!this.bSpaceEnabled){this._handleCancelButtonPressClassicMode();return}this._handleCancelButtonPressSpacesMode()};D.prototype.setTitle=function(e){this.setProperty("title",e,true);this.oModel.setProperty("/title",e);return this};D.prototype.setSubtitle=function(e){this.setProperty("subtitle",e,true);this.oModel.setProperty("/subtitle",e);return this};D.prototype.setInfo=function(e){this.setProperty("info",e,true);this.oModel.setProperty("/info",e);return this};D.prototype.setTileIcon=function(e){this.setProperty("tileIcon",e,true);this.oModel.setProperty("/icon",e);return this};D.prototype.setShowGroupSelection=function(e){this.setProperty("showGroupSelection",e,true);this.oModel.setProperty("/showGroupSelection",e);return this};D.prototype.setNumberUnit=function(e){this.setProperty("numberUnit",e,true);this.oModel.setProperty("/numberUnit",e);return this};D.prototype.setServiceRefreshInterval=function(e){this.setProperty("serviceRefreshInterval",e,true);this.oModel.setProperty("/serviceRefreshInterval",e);return this};D.prototype.setDataSource=function(e){this.setProperty("dataSource",e,true);this.oModel.setProperty("/dataSource",e);return this};D.prototype.setKeywords=function(e){this.setProperty("keywords",e,true);this.oModel.setProperty("/keywords",e);return this};D.prototype.setAppData=function(e){this.setProperty("appData",e,true);const t=["showGroupSelection","title","subtitle","info","icon","numberUnit","keywords","serviceRefreshInterval","dataSource"];const o=["showInfo","showPreview"];Object.keys(e).forEach(s=>{if(t.indexOf(s)>-1){const t=s==="icon"?"tileIcon":s;this.setProperty(t,e[s],true)}if(t.indexOf(s)>-1||o.indexOf(s)>-1){this.oModel.setProperty(`/${s}`,e[s])}});return this};D.prototype._restoreDialogEditableValuesToDefault=function(){if(this.oModel){this.oModel.setProperty("/title",this.getTitle());this.oModel.setProperty("/subtitle",this.getSubtitle());this.oModel.setProperty("/info",this.getInfo())}};D.prototype._handleCancelButtonPressSpacesMode=function(){const e=this.getBookmarkTileView().getController();const t=e.getBookmarkTileData();if(t.title||t.subtitle||t.info||t.contentNodes.length){const e=g.i18n.getText("SaveAsTileDialog.MessageBox.Action.Discard");const t=g.i18n.getText("SaveAsTileDialog.MessageBox.Message.Discard");const o=g.i18n.getText("SaveAsTileDialog.MessageBox.Title.Discard");r.show(t,{title:o,actions:[e,r.Action.CANCEL],emphasizedAction:e,onClose:function(t){if(t===e){this.oDialog.close()}}.bind(this)})}else{this.oDialog.close()}};D.prototype._handleOKButtonPressSpacesMode=function(){const t=this.getBookmarkTileView().getController();const o=t.getBookmarkTileData();let s=true;if(o.contentNodes.length===0){const e=t.byId("SelectedNodesComboBox");if(e){e.setValueState(m.Error);e.setValueStateText(g.i18n.getText("bookmarkPageSelectError"));s=false}}if(!o.title||o.title.length<1){const e=t.byId("bookmarkTitleInput");if(e){e.setValueState(m.Error);e.setValueStateText(g.i18n.getText("bookmarkTitleInputError"));s=false}}if(!s){sap.ushell.Container.getServiceAsync("MessageInternal").then(e=>{e.info(g.i18n.getText("SaveAsTileDialog.MessageToast.ValidationFailed"))});return}this.oDialog.setBusy(true);this.oDialog.close();const i=sap.ushell.Container.getServiceAsync("BookmarkV2");const r=o.contentNodes.map(t=>i.then(e=>e.addBookmark(o,t)).then(()=>({pageId:t.id,status:"resolved"})).catch(o=>{e.error("Failed to add one a bookmark: ",o,"sap.ushell.ui.footerbar.AddBookmarkButton");return{pageId:t.id,error:o.message,status:"failed"}}));Promise.all(r).then(e=>{sap.ushell.Container.getServiceAsync("MessageInternal").then(t=>{const s=e.filter(e=>e.status==="resolved").length;const i=e.filter(e=>e.status==="failed");if(s===1){t.info(g.i18n.getText("SaveAsTileDialog.MessageToast.TileCreatedInPage"))}else if(s>1){t.info(g.i18n.getText("SaveAsTileDialog.MessageToast.TileCreatedInPages"))}if(i.length){this._showErrorDialog(i,s,o.title)}})})};D.prototype._showErrorDialog=function(e,t,o){sap.ushell.Container.getServiceAsync("MessageInternal").then(s=>{let i;let r;if(e.length===1){if(t===0){i=g.i18n.getText("SaveAsTileDialog.MessageBox.SinglePageError")}else{i=g.i18n.getText("SaveAsTileDialog.MessageBox.OnePageError")}r=g.i18n.getText("SaveAsTileDialog.MessageBox.PageErrorDetail",[o,e[0].pageId])}else if(e.length>1){if(t===0){i=g.i18n.getText("SaveAsTileDialog.MessageBox.AllPagesError")}else{i=g.i18n.getText("SaveAsTileDialog.MessageBox.SomePagesError")}const s=e.map(e=>e.pageId).join("\n");r=g.i18n.getText("SaveAsTileDialog.MessageBox.PagesErrorDetail",[o,s])}const l=new n({items:[new a({text:r}).addStyleClass("sapUiSmallMarginBottom"),new a({text:e.map(e=>e.error).join("\n")}).addStyleClass("sapUiSmallMarginBottom"),new a({text:g.i18n.getText("SaveAsTileDialog.MessageBox.PageErrorSolution")})]});s.errorWithDetails(i,l)})};D.prototype._handleCancelButtonPressClassicMode=function(){this.oDialog.close()};D.prototype._handleOKButtonPressClassicMode=async function(){const t=this.getBookmarkTileView();const o=t.getController();const s=o.getBookmarkTileData();if(!s.title||s.title.length<1){const e=t.getTitleInput();if(e){e.setValueState(m.Error);e.setValueStateText(g.i18n.getText("bookmarkTitleInputError"));throw new Error("Invalid bookmark title")}}this.oDialog.setBusy(true);this.oDialog.close();const i=s.group?s.group.object:"";delete s.group;return Promise.all([sap.ushell.Container.getServiceAsync("BookmarkV2"),sap.ushell.Container.getServiceAsync("MessageInternal")]).then(t=>{const o=t[0];const r=t[1];return o.addBookmark(s,i).then(()=>{r.info(g.i18n.getText("tile_created_msg"))}).catch(t=>{e.error("Failed to add bookmark",t,"sap.ushell.ui.footerbar.AddBookmarkButton");r.error(g.i18n.getText("fail_to_add_tile_msg"))})})};D.prototype.setEnabled=function(o){let s=true;const i=f.getLaunchpadState();const r=f.getShellMode();if(sap.ushell.Container){const e=d.last("/core/shell/enablePersonalization");if(e!==undefined){s=e}if(!s&&this.bSpaceEnabled&&this.bMyHomeEnabled){s=true}}if(!s||i===M.App&&[k,B,T,P].includes(r)){o=false}if(!sap.ushell.Container){if(this.getEnabled()){e.warning("Disabling 'Save as Tile' button: unified shell container not initialized",null,"sap.ushell.ui.footerbar.AddBookmarkButton")}o=false}t.prototype.setEnabled.call(this,o);if(!o){this.addStyleClass("sapUshellAddBookmarkButton")}};return D});
//# sourceMappingURL=AddBookmarkButton.js.map