// Copyright (c) 2009-2025 SAP SE, All Rights Reserved
sap.ui.define(["sap/base/Log","sap/ushell/appIntegration/PostMessageManager","sap/ushell/Config","sap/ushell/Container"],(e,s,a,n)=>{"use strict";const{DoNotReply:t}=s.BuiltInResponses;const r={};const i={"sap.ushell.services.MessageBroker":{async handler(e,a){if(a.source===window){throw new Error(`MessageBrokerHandler: Message received from FLP window by client '${e.clientId}' instead of an iframe. This scenario is not supported!`)}const r=await n.getServiceAsync("MessageBroker");const i=s.getRequestId(a);if(!e.channelId){throw new Error(`MessageBroker: No channelId provided in message body by client '${e.clientId}'`)}if(e.channelId==="sap.ushell.MessageBroker"){let n=true;switch(e.messageName){case"connect":await r.connect(e.clientId,(n,t,r)=>s.sendRequest("sap.ushell.services.MessageBroker",{targetClientId:e.clientId,channelId:e.channelId,messageName:n,clientId:t,channels:r},a.source,a.origin,false));break;case"disconnect":await r.disconnect(e.clientId);break;case"subscribe":await r.subscribe(e.clientId,e.subscribedChannels,(n,t,r,i)=>s.sendRequest("sap.ushell.services.MessageBroker",{targetClientId:e.clientId,channelId:t,messageName:r,clientId:n,data:i},a.source,a.origin,false));break;case"unsubscribe":await r.unsubscribe(e.clientId,e.subscribedChannels);break;default:n=false}if(n){await s.sendResponse(i,"sap.ushell.services.MessageBroker",{channelId:e.channelId,messageName:e.messageName,clientId:e.clientId,correlationMessageId:i,status:"accepted"},true,a.source,a.origin);return t}}await r.publish(e.channelId,e.clientId,e.messageName,e.targetClientIds,e.data);return t},options:{async isValidRequest(e){const s=await n.getServiceAsync("MessageBroker");const a=s.getAcceptedOrigins().some(s=>s===e.origin);return a}}}};return{register(){if(!a.last("/core/shell/enableMessageBroker")){return}Object.keys(r).forEach(e=>{const a=r[e];s.setDistributionPolicy(e,a)});Object.keys(i).forEach(e=>{const a=i[e];s.setRequestHandler(e,a.handler,a.options)})}}});
//# sourceMappingURL=MessageBrokerHandler.js.map