/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

(c) Copyright 2009-2017 SAP SE. All rights reserved
 */
sap.ui.define(["sap/base/Log","sap/base/security/encodeURL","sap/base/util/isEmptyObject","sap/collaboration/components/utils/CommonUtil","sap/ui/core/mvc/Controller","sap/ui/model/odata/v2/ODataModel","sap/ui/model/json/JSONModel"],function(e,t,i,a,s,r,o){"use strict";return s.extend("sap.collaboration.components.socialprofile.SocialProfile",{onInit:function(){this.getView().getViewData().collaborationHostServiceUrl?this._sJamODataServiceUrl=this.getView().getViewData().collaborationHostServiceUrl:this._sJamODataServiceUrl="/sap/bc/ui2/smi/rest_tunnel/Jam/api/v1/OData";this.getView().getViewData().smiServiceUrl?this._sSMIODataServiceUrl=this.getView().getViewData().smiServiceUrl:this._sSMIODataServiceUrl="/sap/opu/odata/sap/SM_INTEGRATION_V2_SRV";this._oCommonUtil=new a;this._sPrefixId=this.getView().getId();this._sJamURL="";this._sJamUserId="";this._sPopoverPrefix=this.getView().getViewData().popoverPrefix;this._fnUserInfoFetchedCallback=this.getView().getViewData().afterUserInfoRetrieved;this._initializeModels()},onBeforeRendering:function(){if(this._memberId!==this.getView().getViewData().memberId){this.getView().resetHeader();this._clearViewData();this._memberId=this.getView().getViewData().memberId;var e=this.getView().getViewData().memberInfo;if(i(e)){this._getMember()}else{this._setMember(e);if(this._fnUserInfoFetchedCallback){this._fnUserInfoFetchedCallback(e)}}}},_initializeModels:function(){var e=true;this._oJamODataModel=new r(this._sJamODataServiceUrl,e);this._oJSONModel=new o({});this.getView().setModel(this._oJSONModel)},_getMember:function(){var t=this;this._oJamODataModel.metadataLoaded().then(()=>{if(this._oSocialProfileRequest){this._oSocialProfileRequest.abort()}var a="Members_FindByEmail";var s={};s.urlParameters={Email:"'"+t._memberId+"'",$expand:"MemberProfile/PhoneNumbers",$select:"Id,FullName,Title,Email,WebURL,MemberProfile"};s.success=function(e,a){var s=t._oCommonUtil.getODataResult(e);if(!i(s)){var r=s.MemberProfile.PhoneNumbers.results;var o=r.length;for(var l=0;l<o;l++){if(r[l]["PhoneNumberType"]==="Work"){s.MemberProfile.WorkPhoneNumber=r[l]["PhoneNumber"]}if(r[l]["PhoneNumberType"]==="Mobile"){s.MemberProfile.MobilePhoneNumber=r[l]["PhoneNumber"]}}t._oJSONModel.setData(s);t._sJamUserId=s.Id;var m=t._buildThumbnailImageURL(t._sJamUserId);sap.ui.getCore().byId(t._sPrefixId+"_HeaderUserImage").setSrc(m);if(t._fnUserInfoFetchedCallback){t._fnUserInfoFetchedCallback(s)}}};s.error=function(i){if(i.response&&i.response.statusCode){e.error("SAP Jam request failed at sap.collaboration.components.socialprofile.SocialProfileController._getMember()");t.getView().setHeaderNoUser()}};this._oSocialProfileRequest=this._oJamODataModel.read(a,s)})},_setMember:function(e){var t={UserImage:e.picture,Id:e.id,FullName:e.fullname,Title:e.title,Email:e.email,MemberProfile:{Address:e.address,WorkPhoneNumber:e.workPhoneNumber,MobilePhoneNumber:e.mobilePhoneNumber}};this._sJamUserId=e.id;this._oJSONModel.setData(t)},_clearViewData:function(){sap.ui.getCore().byId(this._sPrefixId+"_HeaderUserImage").setSrc();sap.ui.getCore().byId(this._sPrefixId+"_FullName").setText();sap.ui.getCore().byId(this._sPrefixId+"_Role").setText();sap.ui.getCore().byId(this._sPrefixId+"_MobileNumber").setText();sap.ui.getCore().byId(this._sPrefixId+"_WorkNumber").setText();sap.ui.getCore().byId(this._sPrefixId+"_Email").setText();sap.ui.getCore().byId(this._sPrefixId+"_CompanyAddress").setText()},_buildThumbnailImageURL:function(e){return this._sJamODataServiceUrl+"/Members('"+t(e)+"')/ThumbnailImage/$value"}})});
//# sourceMappingURL=SocialProfile.controller.js.map