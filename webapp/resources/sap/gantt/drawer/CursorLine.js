/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

		(c) Copyright 2009-2015 SAP SE. All rights reserved
	
 */
sap.ui.define(["sap/ui/core/Core","sap/ui/Device","sap/gantt/misc/Format","sap/gantt/drawer/Drawer","sap/gantt/misc/Utility","../simple/GanttUtils","sap/ui/core/theming/Parameters","sap/ui/thirdparty/d3"],function(t,e,r,a,n,i,o){"use strict";var s=a.extend("sap.gantt.drawer.CursorLine");s.prototype.drawSvg=function(t,e,r,a){this._oLocale=r;var i=jQuery(n.attributeEqualSelector("id",a.svgId)).offset().left;var o=[];t.each(function(t,e){var r=jQuery(this),n=r.offset();o.push({x:a.x+i-n.left,y:a.y,svgId:r.attr("id"),svgHeight:r.height()})});var s=this;e.each(function(t,e){var r=s._createHeaderTopG(d3.select(this));var a=null;a=r[0]["parentNode"].getElementById("inner-header-svg");var n=null,i=null;var l=r[0]["parentNode"].getElementById("inner-header-g");if(l!==null){n=r[0]["parentNode"].getElementById("inner-header-g").style.height}if(n!==null){i=n.split("px")}if(i!==null){s._drawHeaderLabel(r,o[e],a,parseInt(i[0]))}else{s._drawHeaderLabel(r,o[e],null,0)}});t.each(function(t,e){var r=s._createBodyTopG(d3.select(this));s._drawCursorLine(r,o[e])})};s.prototype._createBodyTopG=function(t){var e=t.selectAll(".cursorline-top").data(function(){return[{svgHeight:jQuery(this.parentNode).height()}]});e.enter().append("g").classed("cursorline-top",true);e.exit().remove();return e};s.prototype._drawCursorLine=function(t,e){var r=t.selectAll("path").data(function(t){return[{svgHeight:t.svgHeight,x:e.x,y:e.y}]});r.enter().append("path").classed("sapGanttCursorLineBody",true);r.attr("d",function(t){return"M"+t.x+",0v"+t.svgHeight+"h1h-1"});r.exit().remove()};s.prototype._createHeaderTopG=function(t){var e=t.selectAll(".cursorline-header-top").data(function(){return[{svgHeight:jQuery(this.parentNode).height()}]});e.enter().append("g").classed("cursorline-header-top",true);e.exit().remove();return e};s.prototype._drawHeaderLabel=function(t,e,r,a){var n=this;var s=this._getAxisTime(e.svgId);var l=e.x;var u=e.y;var p;var c=s._oZoomStrategy&&s._oZoomStrategy.getParent().getParent(),d;if(c&&c.isA("sap.gantt.simple.GanttChartContainer")){c._timeStamp=!c._bCalcTimeStamp&&c.getEnableTimeScrollSync()&&c._timeStamp;c._bCalcTimeStamp=false}var g=function(t){d=c&&c._timeStamp?c._timeStamp:s.viewToTime(t);return n._getTimeLabel(d,n._oLocale,s)};var v=t.selectAll("rect").data(function(t){if(r!==null){p=t.svgHeight-a}else{p=t.svgHeight}return[{svgHeight:p,svgId:t.svgId,x:l,y:u}]});v.enter().append("rect").classed("sapGanttCursorLineHeader",true);v.attr("width",function(t){var e=o.get({name:"sapUiFontSmallSize",callback:function(t){e=t}});var r=g(t.x),a=i.getShapeTextWidth(r,parseInt(e),"Arial","normal");return a<64?64:a+10}).attr("height",function(t){return t.svgHeight>80?30:25}).attr("x",function(t){return t.x-parseFloat(v.attr("width"))/2}).attr("y",function(t){return t.svgHeight-parseFloat(v.attr("height"))-5});v.exit().remove();if(r!==null){var h=t.selectAll("path").data(function(t){return[{svgHeight:a,x:l,y:u}]});h.enter().append("path").classed("sapGanttCursorLineBody",true);h.attr("d",function(t){var e=l;return"M"+e+","+p+"v"+a+"h1h-1"});h.exit().remove()}var m=t.selectAll("text").data(function(t){return[{x:parseFloat(v.attr("x"))+parseFloat(v.attr("width")/2),y:parseFloat(v.attr("y"))+parseFloat(v.attr("height")/2)}]});m.enter().append("text").classed("sapGanttCursorLineLabel",true);m.attr("x",function(t){return t.x}).attr("y",function(t){return t.y}).text(function(t){return g(t.x)});m.exit().remove();if(c&&c.isA("sap.gantt.simple.GanttChartContainer")){c._timeStamp=d}};s.prototype.destroySvg=function(t,e){t.selectAll(".cursorline-top").remove();e.selectAll(".cursorline-header-top").remove()};s.prototype._getAxisTime=function(t){var e=n.attributeEqualSelector("id",t);var r=jQuery(e);var a=null;if(r){a=r.control(0,true).getAxisTime()}return a};s.prototype._getTimeLabel=function(t,e,r){var a=r.getZoomStrategy();var i=e.getFormattedDate(a.getLowerRowFormatter(),t);return n.getLowerCaseLabel(i)};return s},true);
//# sourceMappingURL=CursorLine.js.map