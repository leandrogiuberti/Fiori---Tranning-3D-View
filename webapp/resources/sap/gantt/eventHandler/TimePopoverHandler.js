/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

		(c) Copyright 2009-2015 SAP SE. All rights reserved
	
 */
sap.ui.define(["sap/ui/thirdparty/jquery","sap/ui/base/Object","sap/ui/core/Core","sap/gantt/misc/Format","sap/ui/core/Lib"],function(jQuery,e,t,o,i){"use strict";var a=e.extend("sap.gantt.eventHandler.TimePopoverHandler",{constructor:function(t){e.call(this);this._bSelectShape=false;this._bDragShape=false;this._iOffsetX=0;this._iOffsetY=28;this._oSourceChart=t;this._oTimePopoverModel=undefined}});a.prototype.handleTimePopover=function(e){this._handleTimePopoverDragStart(e)};a.prototype._handleTimePopoverDragStart=function(e){this._bSelectShape=false;this._bDragShape=false;this._calcPositionGap();jQuery(document.body).off("mousemove.shapeDragDrop");jQuery(document).off("mouseup.shapeDragDrop");jQuery(document.body).on("mousemove.shapeDragDrop",this._handleTimePopoverDragging.bind(this));jQuery(document).on("mouseup.shapeDragDrop",this._handleTimePopoverEnd.bind(this))};a.prototype._calcPositionGap=function(e){var o;var i=t.getConfiguration().getRTL();if(this._oSourceChart.getGhostAlignment()===sap.gantt.dragdrop.GhostAlignment.Start){this._iOffsetX=i?this._oSourceChart._oDraggingData.dragStartPoint.shapeWidth:-this._oSourceChart._oDraggingData.dragStartPoint.shapeWidth}else if(this._oSourceChart.getGhostAlignment()===sap.gantt.dragdrop.GhostAlignment.None){o=i?this._oSourceChart._oDraggingData.dragStartPoint.x-this._oSourceChart._oDraggingData.dragStartPoint.shapeX:this._oSourceChart._oDraggingData.dragStartPoint.x-this._oSourceChart._oDraggingData.dragStartPoint.shapeX-this._oSourceChart._oDraggingData.dragStartPoint.shapeWidth;this._iOffsetX=Math.ceil(o)}else if(this._oSourceChart.getGhostAlignment()===sap.gantt.dragdrop.GhostAlignment.End){this._iOffsetX=0}var a=this._oSourceChart.getBaseRowHeight();var s=this._oSourceChart._oDraggingData.groupDom.getBoundingClientRect();if(s){a+=s.height}this._iOffsetY=Math.ceil(a)};a.prototype._handleTimePopoverDragging=function(e){var t=d3.select("#dragDropShadow");var o=t[0];if(this._oSourceChart.getEnableShapeTimeDisplay()&&o[0]){var i=this._getPopoverPosition(e);this._displayTimePopover(i,o[0])}};a.prototype._displayTimePopover=function(e,t){if(!this._isDraggingShape()){this._changeDraggingStatus()}else if(!this._existsPopover()){this._buildPopover(e);this.oTimePopover.openBy(t)}else if(this.oTimePopover.isOpen()){this._updatePopover(e)}else{this.oTimePopover.destroy();this.oTimePopover=undefined;this._buildPopover(e);this.oTimePopover.openBy(t)}};a.prototype._buildPopover=function(e){var t=i.getResourceBundleFor("sap.gantt");var o=t.getText("GNT_CURRENT_START");var a=t.getText("GNT_CURRENT_END");this.oTimePopover=new sap.m.ResponsivePopover({showArrow:false,showHeader:false,offsetX:"{time>/offsetX}",offsetY:"{time>/offsetY}",placement:"{time>/placement}",content:[new sap.m.FlexBox({alignItems:"Center",items:[new sap.m.Panel({content:[new sap.m.FlexBox({alignItems:"Center",justifyContent:"End",items:[new sap.m.Label({text:o})]}).addStyleClass("sapUiTinyMargin"),new sap.m.FlexBox({alignItems:"Center",justifyContent:"End",items:[new sap.m.Label({text:a})]}).addStyleClass("sapUiTinyMargin")]}).addStyleClass("sapUiNoContentPadding"),new sap.m.Panel({content:[new sap.m.FlexBox({justifyContent:"Start",items:[new sap.m.Label({text:"{time>/startNewDate}"})]}).addStyleClass("sapUiTinyMargin"),new sap.m.FlexBox({justifyContent:"Start",items:[new sap.m.Label({text:"{time>/endNewDate}"})]}).addStyleClass("sapUiTinyMargin")]}).addStyleClass("sapUiNoContentPadding")]})]});this._oTimePopoverModel=new sap.ui.model.json.JSONModel(e);this.oTimePopover.setModel(this._oTimePopoverModel,"time")};a.prototype._updatePopover=function(e){this._oTimePopoverModel=new sap.ui.model.json.JSONModel;this._oTimePopoverModel.setData(e);this.oTimePopover.setModel(this._oTimePopoverModel,"time")};a.prototype._calPopoverPosition=function(e,t){var i=this._oSourceChart.getLocale();var a=o.abapTimestampToTimeLabel(new Date(e),i);var s=o.abapTimestampToTimeLabel(new Date(t),i);var r={startNewDate:a,endNewDate:s,offsetX:this._iOffsetX,offsetY:this._iOffsetY,placement:sap.m.PlacementType.Right};return r};a.prototype._changeDraggingStatus=function(){if(this._bSelectShape){this._bDragShape=true}if(!this._bSelectShape){this._bSelectShape=true}};a.prototype._isDraggingShape=function(){return this._bSelectShape&&this._bDragShape};a.prototype._existsPopover=function(){return this.oTimePopover!==undefined};a.prototype._getPopoverPosition=function(e){this._oSourceChart._collectDraggingShapeData(this._oSourceChart._oDraggingData,e);var t=this._oSourceChart._oDraggingData.targetData;var o=this._calPopoverPosition(t["mouseTimestamp"].startTime,t["mouseTimestamp"].endTime);return o};a.prototype._handleTimePopoverEnd=function(){if(this.oTimePopover){this.oTimePopover.destroy();this.oTimePopover=undefined}jQuery(document.body).off("mousemove.shapeDragDrop");jQuery(document.body).off("mouseup.shapeDragDrop")};a.prototype.getCurrentPopoverData=function(){return{timePopover:this.oTimePopover,offsetX:this._iOffsetX,offsetY:this._iOffsetY}};a.prototype.setCurrentPopoverData=function(e){if(e){this.oTimePopover=e.timePopover;this._iOffsetX=e.offsetX;this._iOffsetY=e.offsetY}};return a},true);
//# sourceMappingURL=TimePopoverHandler.js.map