/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

		(c) Copyright 2009-2015 SAP SE. All rights reserved
	
 */
sap.ui.define(["sap/m/Label","sap/ui/performance/Measurement","sap/ui/Device","./GanttChartBase","sap/ui/table/Column","sap/ui/table/Table","sap/ui/table/TreeTable","sap/ui/table/utils/TableUtils","sap/ui/layout/Splitter","sap/ui/layout/SplitterLayoutData","./GanttChart","./control/Cell","./control/Toolbar","./control/AssociateContainer","./drawer/SelectionPanel","./eventHandler/MouseWheelHandler","sap/ui/thirdparty/d3"],function(t,e,o,i,a,n,r,s,h,l,p,g,c,d,u,_){"use strict";var C=i.extend("sap.gantt.GanttChartWithTable",{metadata:{designtime:"sap/gantt/designtime/GanttChartWithTable.designtime",properties:{cellCallback:{type:"object"},fixedColumnCount:{type:"int"}},aggregations:{customToolbarItems:{type:"sap.ui.core.Control",multiple:true,visibility:"public",singularName:"customToolbarItem",bindable:"bindable"},columns:{type:"sap.ui.table.Column",multiple:true,visibility:"public",singularName:"column"},_selectionPanel:{type:"sap.ui.table.TreeTable",multiple:false,visibility:"hidden"},_chart:{type:"sap.gantt.GanttChart",multiple:false,visibility:"hidden"}}}});C.prototype.init=function(){i.prototype.init.apply(this,arguments);e.start("GanttChartWithTable Init","GanttPerf:GanttChartWithTable Init function");this._oGanttChart=new p;this.setAggregation("_chart",this._oGanttChart);this._oGanttChartCnt=new d({enableRootDiv:true,content:this._oGanttChart});this._oTC=this._oGanttChart._oTT;var t=this;this._oTT=new r({visibleRowCountMode:"Auto",minAutoRowCount:1});jQuery.extend(this.mDefaultTableProperties,{fixedColumnCount:0,showColumnVisibilityMenu:false,selectionBehavior:sap.ui.table.SelectionBehavior.Row});this.setTableProperties(jQuery.extend({},this.mDefaultTableProperties));this._oTT._bVariableRowHeightEnabled=true;this._oTT._collectRowHeights=function(e){var o=r.prototype._collectRowHeights.apply(this,arguments);if(e){return o}t._aHeights=o;var i=t._aHeights[0];var a=t._getTTFirstRenderingRowIndex();var n=t._aHeights.length;var s=i;var h=t._oGanttChart._getDrawingData([a,a+n-1]);if(h&&h.length>0){s=h[0].rowSpan*i}for(var l=0;l<n;l++){var p=this.getContextByIndex(a+l);if(p){var g=p.getObject();var c=g?g.uid:undefined;if(c&&t._oGanttChart._oRowStatusMap[c]){t._aHeights[l]=t._oGanttChart._oRowStatusMap[c].visibleRowSpan*i}else{t._aHeights[l]=s}}else{t._aHeights[l]=i}}return t._aHeights};this._oTT._updateRowState=function(e){s.Grouping.updateGroups(this);var o=this.getRows(),i=t._getRowHeights();if(!i){return}var a=t._getTTFirstRenderingRowIndex();var n=t._aHeights.length;var r=t._oGanttChart._getDrawingData([a,a+n-1]);if(r&&r.length>0){var h=r[0].rowSpan}var l=this.$().find(".sapUiTableCtrlFixed > tbody > tr.sapUiTableTr");var p=this.$().find(".sapUiTableContentRow > div.sapUiTableRowSelectionCell");for(var g=0;g<o.length;g++){var c=o[g].$(),d=l.filter(":eq("+g+")"),u=p.filter(":eq("+g+")"),_=i[g]||0;var C=t._oGanttChart.getBaseRowHeight();var f=_/(C*h)>1;c.toggleClass("sapGanttExpandedRow",f);d.toggleClass("sapGanttExpandedRow",f);u.toggleClass("sapGanttExpandedRow",f)}};this._oTT.addEventDelegate({onAfterRendering:this._bindVerticalScrollForTT},this);this._oTT.attachToggleOpenState(function(e){t.fireTreeTableToggleEvent({rowIndex:e.getParameter("rowIndex"),rowContext:e.getParameter("rowContext"),expanded:e.getParameter("expanded")})});this._oTT.attachEvent("_rowsUpdated",this._onTTRowUpdate.bind(this));this.setAggregation("_selectionPanel",this._oTT);this._oToolbar=new c({type:sap.gantt.control.ToolbarType.Local,sourceId:sap.gantt.config.DEFAULT_HIERARCHY_KEY});this._oToolbar.data("holder",this);this._oToolbar.attachSourceChange(this._onToolbarSourceChange,this);this._oToolbar.attachExpandChartChange(this._onToolbarExpandChartChange,this);this._oToolbar.attachExpandTreeChange(this._onToolbarExpandTreeChange,this);this._oToolbar.attachModeChange(this._onToolbarModeChange,this);this._oToolbar.attachBirdEye(this._onToolbarBirdEye,this);this._oTT.addExtension(this._oToolbar);this._oSelectionPanelCnt=new d({enableRootDiv:true,content:this._oTT,layoutData:new l({size:"30%"})});this._oSplitter=new h({width:"100%",height:"100%",orientation:sap.ui.core.Orientation.Horizontal,contentAreas:[this._oSelectionPanelCnt,this._oGanttChartCnt]}).addStyleClass("sapGanttViewSplitterH");this._oSplitter.attachResize(this._onSplitterResize,this);this._oGanttChart.attachHorizontalScroll(this._onChartHSbScroll,this);this._oGanttChart.attachVerticalScroll(this._onChartVSbScroll,this);this._oGanttChart.attachRowSelectionChange(this._onRowSelectionChange,this);this._oGanttChart.attachShapeSelectionChange(this._onShapeSelectionChange,this);this._oGanttChart.attachChartMouseOver(this._onChartMouseOver,this);this._oGanttChart.attachRelationshipSelectionChange(this._onRelationshipSelectionChange,this);this._oGanttChart.attachChartClick(this._onClick,this);this._oGanttChart.attachChartDoubleClick(this._onDoubleClick,this);this._oGanttChart.attachChartRightClick(this._onRightClick,this);this._oGanttChart.attachEvent("_zoomInfoUpdated",this._onZoomInfoUpdated,this);this._oGanttChart.attachEvent("_shapesUpdated",this._onShapesUpdated,this);this._oGanttChart.attachChartDragEnter(this._onChartDragEnter,this);this._oGanttChart.attachChartDragLeave(this._onChartDragLeave,this);this._oGanttChart.attachShapeDragEnd(this._onShapeDragEnd,this);this._oGanttChart.attachEvent("_visibleHorizonUpdate",this._onGanttChartVisibleHorizonUpdate,this);this._oGanttChart.attachEvent("_timePeriodZoomStatusChange",this._onGanttChartTimePeriodZoomStatusChange,this);this._oGanttChart.attachEvent("_timePeriodZoomOperation",this._onGanttChartTimePeriodZoomOperation,this);this._oGanttChart.attachShapeResizeEnd(this._onShapeResizeEnd,this);this._oGanttChart.attachShapeMouseEnter(this._onShapeMouseEnter,this);this._oGanttChart.attachShapeMouseLeave(this._onShapeMouseLeave,this);this._oModesConfigMap={};this._oModesConfigMap[sap.gantt.config.DEFAULT_MODE_KEY]=sap.gantt.config.DEFAULT_MODE;this._oToolbarSchemeConfigMap={};this._oToolbarSchemeConfigMap[sap.gantt.config.DEFAULT_GANTTCHART_TOOLBAR_SCHEME_KEY]=sap.gantt.config.DEFAULT_GANTTCHART_TOOLBAR_SCHEME;this._oToolbarSchemeConfigMap[sap.gantt.config.EMPTY_TOOLBAR_SCHEME_KEY]=sap.gantt.config.EMPTY_TOOLBAR_SCHEME;this._oHierarchyConfigMap={};this._oHierarchyConfigMap[sap.gantt.config.DEFAULT_HIERARCHY_KEY]=sap.gantt.config.DEFAULT_HIERARCHY;this._oSelectionPanelDrawer=new u;this._oGanttChartSchemesConfigMap={};this._oGanttChartSchemesConfigMap[sap.gantt.config.DEFAULT_CHART_SCHEME_KEY]=sap.gantt.config.DEFAULT_CHART_SCHEME;this._oObjectTypesConfigMap={};this._oObjectTypesConfigMap[sap.gantt.config.DEFAULT_OBJECT_TYPE_KEY]=sap.gantt.config.DEFAULT_OBJECT_TYPE;this._oShapesConfigMap={};this._oMouseWheelHandler=new _(this);e.end("GanttChartWithTable Init")};C.prototype.setNowLineInUTC=function(t){i.prototype.setNowLineInUTC.call(this,t);this._oGanttChart.setNowLineInUTC(t)};C.prototype.setFixedColumnCount=function(t){this.setTableProperties({fixedColumnCount:t});return this};C.prototype.getFixedColumnCount=function(){return this.getTableProperties().fixedColumnCount};C.prototype.setTimeAxis=function(t){this.setProperty("timeAxis",t,true);this._oGanttChart.setTimeAxis(t);return this};C.prototype.setMode=function(t){this.setProperty("mode",t);this._oGanttChart.setMode(t);this._oToolbar.setMode(t);return this};C.prototype.setModes=function(t){this.setProperty("modes",t);this._oToolbar.setModes(t);this._oGanttChart.setModes(t);this._oModesConfigMap={};if(t){for(var e=0;e<t.length;e++){this._oModesConfigMap[t[e].getKey()]=t[e]}}return this};C.prototype.useSelectionPlugin=function(t){var e=this.getAggregation("_chart");var o=this.getAggregation("_selectionPanel");var i=e.getAggregation("_treeTable");if(this._oSelectionPlugin){this._oSelectionPlugin.detachSelectionChange(e._onRowSelectionChange,e);i.removePlugin(this._oSelectionPlugin);o.removePlugin(this._oSelectionPlugin);delete i._oSelectionPlugin;delete o._oSelectionPlugin;this._oSelectionPlugin=null}if(t){var a=t.getSelectionMode()||i.getSelectionMode();t.attachSelectionChange(e._onRowSelectionChange,e);i.addPlugin(t);o.addPlugin(t);if(!i.getPlugins().length){i.setSelectionMode(a)}i._oSelectionPlugin=t;o._oSelectionPlugin=t;this._oSelectionPlugin=t}};C.prototype.setSelectionMode=function(t){this.setProperty("selectionMode",t);switch(t){case sap.gantt.SelectionMode.Multiple:case sap.gantt.SelectionMode.MultiWithKeyboard:this.setTableProperties({selectionMode:sap.ui.table.SelectionMode.MultiToggle,selectionBehavior:sap.ui.table.SelectionBehavior.Row});break;case sap.gantt.SelectionMode.Single:this.setTableProperties({selectionMode:sap.ui.table.SelectionMode.Single,selectionBehavior:sap.ui.table.SelectionBehavior.Row});break;case sap.gantt.SelectionMode.None:this.setTableProperties({selectionMode:sap.ui.table.SelectionMode.None,selectionBehavior:sap.ui.table.SelectionBehavior.RowOnly});break}this._oGanttChart.setSelectionMode(t);return this};C.prototype.setShapeSelectionMode=function(t){this.setProperty("shapeSelectionMode",t);this._oGanttChart.setShapeSelectionMode(t);return this};C.prototype.setToolbarSchemes=function(t){this.setProperty("toolbarSchemes",t);this._oToolbar.setToolbarSchemes(t);this._oToolbarSchemeConfigMap={};if(t){for(var e=0;e<t.length;e++){this._oToolbarSchemeConfigMap[t[e].getKey()]=t[e]}}return this};C.prototype.setHierarchyKey=function(t){this.setProperty("hierarchyKey",t);this._oGanttChart.setProperty("hierarchyKey",t);this._oToolbar.setSourceId(t);this._hierarchyChange();return this};C.prototype.setHierarchies=function(t){this.setProperty("hierarchies",t);this._oToolbar.setHierarchies(t);this._oGanttChart.setHierarchies(t);this._oHierarchyConfigMap={};if(t){for(var e=0;e<t.length;e++){this._oHierarchyConfigMap[t[e].getKey()]=t[e]}}this._hierarchyChange();return this};C.prototype.setCalendarDef=function(t){this.setAggregation("calendarDef",t);var e=t.getBindingInfo("defs");if(e){e.templateShareable=true}this._oGanttChart.setCalendarDef(t.clone());return this};C.prototype.setAdhocLineLayer=function(t){this.setProperty("adhocLineLayer",t);this._oGanttChart.setAdhocLineLayer(t);return this};C.prototype.addAdhocLine=function(t){this._oGanttChart.addAdhocLine(t);return this};C.prototype.insertAdhocLine=function(t,e){this._oGanttChart.insertAdhocLine(t,e);return this};C.prototype.removeAdhocLine=function(t){return this._oGanttChart.removeAdhocLine(t)};C.prototype.getAdhocLines=function(){return this._oGanttChart.getAdhocLines()};C.prototype.removeAllAdhocLines=function(){return this._oGanttChart.removeAllAdhocLines()};C.prototype.setUseFlatMode=function(t){this._oTT.setUseFlatMode(t);return this};C.prototype._hierarchyChange=function(t){var e=this.getHierarchyKey();if(e&&this._oHierarchyConfigMap[e]){if(this._oHierarchyConfigMap[e].getColumns()&&this._oHierarchyConfigMap[e].getColumns().length>0){this._buildColumnFromCellCallback()}var o=this.getMode();if(o===sap.gantt.config.DEFAULT_MODE_KEY&&this._oHierarchyConfigMap[this.getHierarchyKey()]){o=this._oHierarchyConfigMap[this.getHierarchyKey()].getActiveModeKey()}this.setMode(o)}};C.prototype._buildColumnFromCellCallback=function(){this._oTT.removeAllColumns();var e,o;e=this._oHierarchyConfigMap[this.getHierarchyKey()];if(e){o=e.getColumns()}if(o){for(var i=0;i<o.length;i++){var n=new a({label:new t({text:o[i].getTitle()}),sortProperty:o[i].getSortAttribute(),filterProperty:o[i].getFilterAttribute(),width:o[i].getWidth(),template:new g({cellCallback:this.getCellCallback(),columnConfig:o[i]}).data("rowTypeName",this.getRowTypeName())});this._oTT.addColumn(n);this._oTT.addAriaLabelledBy(n.getLabel())}}};C.prototype.setObjectTypes=function(t){this.setProperty("objectTypes",t,true);this._oGanttChart.setObjectTypes(t);this._oObjectTypesConfigMap={};if(t){for(var e=0;e<t.length;e++){this._oObjectTypesConfigMap[t[e].getKey()]=t[e]}}return this};C.prototype.setChartSchemes=function(t){this.setProperty("chartSchemes",t,true);this._oGanttChart.setChartSchemes(t);this._oGanttChartSchemesConfigMap={};if(t){for(var e=0;e<t.length;e++){this._oGanttChartSchemesConfigMap[t[e].getKey()]=t[e]}}return this};C.prototype.setShapeDataNames=function(t){this.setProperty("shapeDataNames",t);this._oGanttChart.setShapeDataNames(t);return this};C.prototype.setLocale=function(t){this.setProperty("locale",t,true);this._oGanttChart.setLocale(t);return this};C.prototype.setShapes=function(t){this.setProperty("shapes",t,true);this._oGanttChart.setShapes(t);this._oShapesConfigMap={};if(t){for(var e=0;e<t.length;e++){this._oShapesConfigMap[t[e].getKey()]=t[e]}}return this};C.prototype.setSvgDefs=function(t){this.setProperty("svgDefs",t);this._oGanttChart.setSvgDefs(t);return this};C.prototype.setEnableCursorLine=function(t){this.setProperty("enableCursorLine",t);this._oGanttChart.setEnableCursorLine(t);this._oToolbar.setEnableCursorLine(t);return this};C.prototype.setEnableNowLine=function(t){this.setProperty("enableNowLine",t);this._oGanttChart.setEnableNowLine(t);this._oToolbar.setEnableNowLine(t);return this};C.prototype.setEnableVerticalLine=function(t){this.setProperty("enableVerticalLine",t);this._oGanttChart.setEnableVerticalLine(t);this._oToolbar.setEnableVerticalLine(t);return this};C.prototype.setEnableAdhocLine=function(t){this.setProperty("enableAdhocLine",t);this._oGanttChart.setEnableAdhocLine(t);this._oToolbar.setEnableAdhocLine(t);return this};C.prototype.setEnableShapeTimeDisplay=function(t){this.setProperty("enableShapeTimeDisplay",t);this._oGanttChart.setEnableShapeTimeDisplay(t);return this};C.prototype.setTimeZoomRate=function(t){this.setProperty("timeZoomRate",t,true);this._oGanttChart.setTimeZoomRate(t);return this};C.prototype.setAxisTimeStrategy=function(t){this._oGanttChart.setAxisTimeStrategy(t);return this};C.prototype.getAxisTimeStrategy=function(){return this._oGanttChart.getAxisTimeStrategy()};C.prototype.addRelationship=function(t){this._oGanttChart.addRelationship(t)};C.prototype.insertRelationship=function(t,e){this._oGanttChart.insertRelationship(t,e)};C.prototype.removeRelationship=function(t){this._oGanttChart.removeRelationship(t)};C.prototype.getRelationships=function(){this._oGanttChart.getRelationships()};C.prototype.destroyRelationships=function(){this._oGanttChart.destroyRelationships()};C.prototype.indexOfRelationship=function(t){this._oGanttChart.indexOfRelationship(t)};C.prototype.removeAllRelationships=function(){this._oGanttChart.removeAllRelationships()};C.prototype.updateRelationships=function(t){this._oGanttChart.updateRelationships(t)};C.prototype.setSelectionPanelSize=function(t,e){this.setProperty("selectionPanelSize",t,e);this._oSelectionPanelCnt.setLayoutData(new l({size:t}));return this};C.prototype.addColumn=function(t){this._oTT.addColumn(t)};C.prototype.insertColumn=function(t,e){this._oTT.insertColumn(t,e)};C.prototype.removeColumn=function(t){this._oTT.removeColumn(t)};C.prototype.removeAllColumns=function(){this._oTT.removeAllColumns()};C.prototype.getColumns=function(){return this._oTT.getColumns()};C.prototype.setGhostAlignment=function(t){this.setProperty("ghostAlignment",t);this._oGanttChart.setGhostAlignment(t);return this};C.prototype._bindAggregation=function(t,e){var o,a;if(t==="rows"&&e){o=this.getModel(e.model);a=this.getBindingContext(e.model);if(a&&o){e.path=o.resolve(e.path,a)}this._oTT.bindRows(e);this._oGanttChart.bindRows(e);this._oTC.updateRows=this._updateRows.bind(this);this._oTT._oSelectionPlugin=this._oTC._oSelectionPlugin}else if(t==="relationships"&&e){o=this.getModel(e.model);a=this.getBindingContext(e.model);if(a&&o){e.path=o.resolve(e.path,a)}this._oGanttChart.bindRelationships(e)}else if(t==="columns"&&e){o=this.getModel(e.model);a=this.getBindingContext(e.model);if(a&&o){e.path=o.resolve(e.path,a)}this._oTT.bindColumns(e)}else{return i.prototype._bindAggregation.apply(this,arguments)}};C.prototype.setTableProperties=function(t){i.prototype.setTableProperties.apply(this,arguments);this._oGanttChart.setTableProperties(t);return this};C.prototype._updateRows=function(t){if(t!=="VerticalScroll"&&(this._oTC.getFirstVisibleRow()===this._oTT.getFirstVisibleRow()||t===sap.ui.model.ChangeReason.Filter||t===sap.ui.model.ChangeReason.Sort)){n.prototype.updateRows.apply(this._oTT,arguments)}n.prototype.updateRows.apply(this._oTC,arguments)};C.prototype._detachToolbarEvents=function(){this._oToolbar.detachSourceChange(this._onToolbarSourceChange,this);this._oToolbar.detachExpandChartChange(this._onToolbarExpandChartChange,this);this._oToolbar.detachExpandTreeChange(this._onToolbarExpandTreeChange,this);this._oToolbar.detachBirdEye(this._onToolbarBirdEye,this)};C.prototype._onToolbarBirdEye=function(t){this._oGanttChart._doBirdEye(t.getParameter("birdEyeRange"))};C.prototype.doBirdEyeOnRow=function(t){this._oGanttChart.doBirdEyeOnRow(t)};C.prototype.getVisibleWidth=function(){return this._oGanttChart.getVisibleWidth()};C.prototype.onAfterRendering=function(){this._adjustChartHeaderHeight();this._attachEvents()};C.prototype.onBeforeRendering=function(){if(this._oToolbar.getAllToolbarItems().length===0){this._oTT.removeExtension(this._oToolbar)}else if(this._oTT.getExtension().length===0){this._oTT.addExtension(this._oToolbar)}};C.prototype._attachEvents=function(){var t={onAfterRendering:this._syncGanttTablesDomEvents};this._oTT.removeEventDelegate(t);this._oTT.addEventDelegate(t,this);this._oTC.removeEventDelegate(t);this._oTC.addEventDelegate(t,this);this._appendMaskSvg();var e=this.$().find(this.getDomSelectorById("spm-svg-table"));if(o.browser.firefox){e.off("MozMousePixelScroll.sapUiTableMouseWheel",this._onMouseWheel.bind(this));e.on("MozMousePixelScroll.sapUiTableMouseWheel",this._onMouseWheel.bind(this))}else{e.off("wheel.sapUiTableMouseWheel",this._onMouseWheel.bind(this));e.on("wheel.sapUiTableMouseWheel",this._onMouseWheel.bind(this))}};C.prototype._onMouseWheel=function(t){this._oMouseWheelHandler.handleEvent(t)};C.prototype._onRowSelectionChange=function(t){var e=this._getSelectionHandler().getSelectedIndices();this._oToolbar.toggleExpandTreeButton(e.length>0);this.fireRowSelectionChange({originEvent:t.getParameter("originEvent")});this._oTT._updateSelection()};C.prototype._onChartMouseOver=function(t){var e=t.getParameters();this.fireChartMouseOver({objectInfo:e.objectInfo,leadingRowInfo:e.leadingRowInfo,timestamp:e.timestamp,svgId:e.svgId,svgCoordinate:e.svgCoordinate,effectingMode:e.effectingMode,originEvent:e.originEvent})};C.prototype._onShapeSelectionChange=function(t){this.fireShapeSelectionChange({originEvent:t.getParameter("originEvent")})};C.prototype._onRelationshipSelectionChange=function(t){this.fireRelationshipSelectionChange({originEvent:t.getParameter("originEvent")})};C.prototype._onClick=function(t){var e=t.getParameters();this.fireChartClick({objectInfo:e.objectInfo,leadingRowInfo:e.leadingRowInfo,timestamp:e.timestamp,svgId:e.svgId,svgCoordinate:e.svgCoordinate,effectingMode:e.effectingMode,originEvent:e.originEvent})};C.prototype._onDoubleClick=function(t){var e=t.getParameters();this.fireChartDoubleClick({objectInfo:e.objectInfo,leadingRowInfo:e.leadingRowInfo,timestamp:e.timestamp,svgId:e.svgId,svgCoordinate:e.svgCoordinate,effectingMode:e.effectingMode,originEvent:e.originEvent})};C.prototype._onRightClick=function(t){var e=t.getParameters();this.fireChartRightClick({objectInfo:e.objectInfo,leadingRowInfo:e.leadingRowInfo,timestamp:e.timestamp,svgId:e.svgId,svgCoordinate:e.svgCoordinate,effectingMode:e.effectingMode,originEvent:e.originEvent})};C.prototype._onChartDragEnter=function(t){this.fireChartDragEnter({originEvent:t.getParameter("originEvent")})};C.prototype._onChartDragLeave=function(t){this.fireChartDragLeave({originEvent:t.getParameter("originEvent"),draggingSource:t.getParameter("draggingSource"),timePopoverData:t.getParameter("timePopoverData")})};C.prototype._onShapeDragEnd=function(t){var e=t.getParameters();this.fireShapeDragEnd({originEvent:e.originEvent,sourceShapeData:e.sourceShapeData,targetData:e.targetData,sourceSvgId:e.sourceSvgId,targetSvgId:e.targetSvgId})};C.prototype._onShapeResizeEnd=function(t){var e=t.getParameters();this.fireShapeResizeEnd({shapeUid:e.shapeUid,rowObject:e.rowObject,oldTime:e.oldTime,newTime:e.newTime})};C.prototype._onShapeMouseEnter=function(t){var e=t.getParameters();this.fireShapeMouseEnter({shapeData:e.shapeData,pageX:e.pageX,pageY:e.pageY,originEvent:e.originEvent})};C.prototype._onShapeMouseLeave=function(t){var e=t.getParameters();this.fireShapeMouseLeave({shapeData:e.shapeData,originEvent:e.originEvent})};C.prototype._onGanttChartVisibleHorizonUpdate=function(t){this.fireEvent("_visibleHorizonUpdate",t.getParameters())};C.prototype._onGanttChartTimePeriodZoomStatusChange=function(t){this.fireEvent("_timePeriodZoomStatusChange",t.getParameters())};C.prototype._onGanttChartTimePeriodZoomOperation=function(t){this.fireEvent("_timePeriodZoomOperation",t.getParameters())};C.prototype.syncTimePeriodZoomStatus=function(t){this._oGanttChart.syncTimePeriodZoomStatus(t)};C.prototype.syncTimePeriodZoomOperation=function(t,e,o){this._oGanttChart.syncTimePeriodZoomOperation(t,e,o)};C.prototype.syncMouseWheelZoom=function(t){this._oGanttChart.syncMouseWheelZoom(t)};C.prototype._onChartHSbScroll=function(t){this.fireHorizontalScroll(t.getParameters())};C.prototype.syncVisibleHorizon=function(t,e,o){this._oGanttChart.syncVisibleHorizon(t,e,o)};C.prototype._onChartVSbScroll=function(t){var e=jQuery(this.getTTVsbDom());var o=jQuery(this.getTCVsbDom());if(this.sScrollSource===null||this.sScrollSource!=="GanttChartWithTable"){this.sScrollSource="GanttChart";window.requestAnimationFrame(function(){e.scrollTop(o.scrollTop())})}else{this.sScrollSource=null}this.fireVerticalScroll({scrollSteps:this._oTC.getFirstVisibleRow(),scrollPosition:jQuery(this.getTCVsbDom()).scrollTop()})};C.prototype._drawSvg=function(){this._appendMaskSvg();this._updateMaskSvg();this._updateTableRowHeights();this._drawSelectionPanel()};C.prototype._onZoomInfoUpdated=function(t){var e=t.getParameters();if(e.axisTimeChanged){this.setProperty("timeZoomRate",this._oGanttChart.getAxisTime().getZoomRate(),true)}this.fireEvent("_zoomInfoUpdated",e)};C.prototype._onShapesUpdated=function(t){this.fireEvent("_shapesUpdated",{aSvg:t.getParameter("aSvg")})};C.prototype._bindVerticalScrollForTT=function(){var t=jQuery(this.getTTVsbDom());t.off("scroll.sapUiTableVScrollForGanttChartWithTable",this._onSelectionPanelVSbScroll);t.on("scroll.sapUiTableVScrollForGanttChartWithTable",this._onSelectionPanelVSbScroll.bind(this))};C.prototype._onSelectionPanelVSbScroll=function(){var t=jQuery(this.getTTVsbDom());var e=jQuery(this.getTCVsbDom());if(this.sScrollSource===null||this.sScrollSource!=="GanttChart"){this.sScrollSource="GanttChartWithTable";window.requestAnimationFrame(function(){e.scrollTop(t.scrollTop())})}else{this.sScrollSource=null}this._applyTransform()};C.prototype._applyTransform=function(){this.$().find(this.getDomSelectorById("spm-svg-table")).css("transform","translateY("+-this._oTT.$().find(".sapUiTableCCnt").scrollTop()+"px)")};C.prototype._onSplitterResize=function(t){var e=t.getParameters();this._oGanttChart._draw();this.fireSplitterResize(e)};C.prototype._onToolbarSourceChange=function(t){var e=this.getHierarchyKey();var o=this.getMode();this.setHierarchyKey(t.getParameter("id"));this.notifySourceChange();this.fireGanttChartSwitchRequested({hierarchyKey:t.getParameter("id"),oldHierarchyKey:e,oldMode:o})};C.prototype._onToolbarExpandChartChange=function(t){var e=t.getParameter("isExpand"),o=t.getParameter("expandedChartSchemes");this.handleExpandChartChange(e,o,null)};C.prototype._onToolbarExpandTreeChange=function(t){var e=t.getParameter("action");if(e){var o=this._getSelectionHandler().getSelectedIndices();this._oTT[e](o)}};C.prototype._onToolbarModeChange=function(t){var e=this.getBinding("mode");if(e){e.setValue(t.getParameter("mode"))}this.setMode(t.getParameter("mode"))};C.prototype.handleExpandChartChange=function(t,e,o){o=o?o:this._getSelectionHandler().getSelectedIndices();this._oGanttChart.handleExpandChartChange(t,e,o)};C.prototype.invertRowExpandStatus=function(t,e){if(t&&t.length>0&&e){this._oGanttChart.invertRowExpandStatus(t,e)}};C.prototype._updateTableRowHeights=function(){var t=this._oTT;var e=this._getRowHeights();if(!e){return}t._updateRowHeights(e,false)};C.prototype._getRowHeights=function(){return this._aHeights};C.prototype.setBaseRowHeight=function(t){this.setProperty("baseRowHeight",t);this._oTT.setRowHeight(t);return this._oGanttChart.setBaseRowHeight(t)};C.prototype.getBaseRowHeight=function(){return this._oGanttChart.getBaseRowHeight()};C.prototype._onTTRowUpdate=function(){var t=this.$().find(this.getDomSelectorById("spm-svg-table-ctn"));if(this._oGanttChart.isRowExpanded()){var e=this._oTT.$();t.height(e.find(".sapUiTableCCnt").height());t.show();var o=t.find(".sapGanttSPMaskSvg");o.height(e.find(".sapUiTableCtrlCnt").height());this._drawSvg()}else{t.hide()}this._adjustGanttInferredRowHeight();this._oTT._updateRowState()};C.prototype._adjustChartHeaderHeight=function(){var t=this._oTT.$().find(".sapUiTableExt");var e=this._oTT.$().find(".sapUiTableColHdrCnt");var i=(t?t.outerHeight():0)+e.height()+1;if(o.browser.firefox){var a=this._oTT.$().find(".sapUiTableCCnt");i=parseInt(a[0].getBoundingClientRect().top-this._oTT.$()[0].getBoundingClientRect().top)}var n=this._oGanttChart.$().find(".sapGanttChartHeader");n.height(i);n.css("min-height",i);var r=this._oGanttChart.$().find(".sapGanttChartHeaderSvg");r.height(i);r.css("min-height",i)};C.prototype._adjustGanttInferredRowHeight=function(){var t=this._getRowHeights();var e=this._getTTFirstRenderingRowIndex();var o=this._oGanttChart._getDrawingData([e,e]);if(t&&t.length>0&&o&&o.length>0){var i=t[0]/o[0].visibleRowSpan;var a=this._oGanttChart._iInferedBaseRowHeight;if(i!==a){this._oGanttChart._setInferedBaseRowHeight(i);if(a===undefined){this._oTC.updateRows("change",{})}}}};C.prototype._syncGanttTablesDomEvents=function(t){var e=t.srcControl,o=e.getId()===this._oTT.getId()?this._oTC:this._oTT;this._adjustChartHeaderHeight();e.$().find(".sapUiTableRowHdr, .sapUiTableTr").hover(function(t){var e=jQuery(t.currentTarget).data("sapUiRowindex");o.$().find(".sapUiTableCtrlFixed > tbody > tr.sapUiTableTr").filter(":eq("+e+")").addClass("sapUiTableRowHvr");o.$().find(".sapUiTableCtrlScroll > tbody > tr.sapUiTableTr").filter(":eq("+e+")").addClass("sapUiTableRowHvr");o.$().find(".sapUiTableRowHdr").filter(":eq("+e+")").addClass("sapUiTableRowHvr")},function(t){o.$().find(".sapUiTableCtrlFixed > tbody > tr.sapUiTableTr").removeClass("sapUiTableRowHvr");o.$().find(".sapUiTableCtrlScroll > tbody > tr.sapUiTableTr").removeClass("sapUiTableRowHvr");o.$().find(".sapUiTableRowHdr").removeClass("sapUiTableRowHvr")})};C.prototype._setLargeDataScrolling=function(t){if(this._oTT._setLargeDataScrolling){this._oTT._setLargeDataScrolling(!!t)}if(this._oTC._setLargeDataScrolling){this._oTC._setLargeDataScrolling(!!t)}};C.prototype.getToolbarSchemeKey=function(){return this._oToolbar.getToolbarSchemeKey()};C.prototype.jumpToPosition=function(t){this._oGanttChart.jumpToPosition(t)};C.prototype.selectShapes=function(t,e){return this._oGanttChart.selectShapes(t,e)};C.prototype.deselectShapes=function(t){return this._oGanttChart.deselectShapes(t)};C.prototype.selectRelationships=function(t,e){return this._oGanttChart.selectRelationships(t,e)};C.prototype.deselectRelationships=function(t){return this._oGanttChart.deselectRelationships(t)};C.prototype.selectRows=function(t,e){return this._oGanttChart.selectRows(t,e)};C.prototype.deselectRows=function(t){return this._oGanttChart.deselectRows(t)};C.prototype.selectRowsAndShapes=function(t,e){return this._oGanttChart.selectRowsAndShapes(t,e)};C.prototype.getAllSelections=function(){return this._oGanttChart.getAllSelections()};C.prototype.getSelectedShapes=function(){var t=this._oGanttChart.getSelectedShapes();return t};C.prototype.getSelectedRows=function(){var t=this._oGanttChart.getSelectedRows();return t};C.prototype.getSelectedRelationships=function(){var t=this._oGanttChart.getSelectedRelationships();return t};C.prototype.setDraggingData=function(t){this._oGanttChart.setDraggingData(t)};C.prototype.setTimePopoverData=function(t){this._oGanttChart.setTimePopoverData(t)};C.prototype.getRowByShapeUid=function(t){return this._oGanttChart.getRowByShapeUid(t)};C.prototype._drawSelectionPanel=function(){var t=this._oTT.$().find(".sapUiTableRowHdrScr").width();var e=this._getVisibleRowData();if(e!==undefined){this._oSelectionPanelDrawer.drawSvg(d3.select(this.getDomSelectorById("spm-svg-table")),e,t,this);if(this._oTT.$().find(".sapUiTableCCnt").scrollTop()!=this._oTC.$().find(".sapUiTableCCnt").scrollTop()){this.$().find(this.getDomSelectorById("spm-svg-table")).css("transform","translateY("+-this._oTC.$().find(".sapUiTableCCnt").scrollTop()+"px)")}}};C.prototype._getVisibleRowData=function(){var t=this._getTTFirstRenderingRowIndex();var e=this.getVisibleRowCount()+1;var o=this._oGanttChart._getDrawingData([t,t+e-1]);var i=this._oGanttChart.getBaseRowHeight();var a=0;for(var n=0;n<o.length;n++){var r=o[n];r.rowHeight=r.rowSpan*i;r.y=a;a+=r.rowHeight}return o};C.prototype._appendMaskSvg=function(){var t=this.$().find(this.getDomSelectorById("spm-svg-table-ctn"));var e=this._oTT.$();if(t.length==0&&this._oGanttChart.isRowExpanded()){t=jQuery("<div id='"+this.getId()+"-spm-svg-table-ctn' class='sapGanttChartSPMSvgCtn' >"+"<svg id='"+this.getId()+"-spm-svg-table' class='sapGanttSPMaskSvg'>"+"</svg>"+"</div>");e.parent().append(t)}};C.prototype._updateMaskSvg=function(){var t=this.$().find(this.getDomSelectorById("spm-svg-table-ctn"));var e=this._oTT.$();t.height(e.find(".sapUiTableCCnt").height());t.width(jQuery(document).width());t.css("top",this._oGanttChart.$().find(".sapGanttChartHeader").height()+1);t.css("min-width",e.find("table").css("min-width"));var o=t.find(".sapGanttSPMaskSvg");o.width(t.width());o.height(e.find(".sapUiTableCtrlCnt").height())};C.prototype.getAxisOrdinal=function(){return this._oGanttChart.getAxisOrdinal()};C.prototype.getAxisTime=function(){return this._oGanttChart.getAxisTime()};C.prototype.expandToLevel=function(t){this._oTT.expandToLevel(t);return this};C.prototype.expand=function(t){this._oTT.expand(t);return this};C.prototype.collapse=function(t){this._oTT.collapse(t);return this};C.prototype.getVisibleRowCount=function(){return this._oTT.getVisibleRowCount()};C.prototype.getLargestHorizonByDataRange=function(t,e,o){return this._oGanttChart.getLargestHorizonByDataRange(t,e,o)};C.prototype.setSelectedIndex=function(t){this._getSelectionHandler().setSelectedIndex(t);return this};C.prototype.getSelectedIndex=function(){return this._getSelectionHandler().getSelectedIndex()};C.prototype.getFirstVisibleRow=function(){return this.getTableProperties().firstVisibleRow};C.prototype.setFirstVisibleRow=function(t){this.setTableProperties({firstVisibleRow:t});return this};C.prototype.getRows=function(){return this._oTT.getRows()};C.prototype.exit=function(){this._detachToolbarEvents();this._oSplitter.destroy()};C.prototype.notifySourceChange=function(){this._oTT.setFirstVisibleRow(0);this._oGanttChart.notifySourceChange()};C.prototype.autoResizeColumn=function(t){if(t>=0&&Number.isFinite(Number(t))){this._oTT.autoResizeColumn(t)}else{for(var e=this._oTT.getColumns().length;e>=0;e--){this._oTT.autoResizeColumn(e)}}};C.prototype._autoResizeColumn=function(){if(this._oHierarchyConfigMap[this.getHierarchyKey()].getAutoResizeColumn()){this.autoResizeColumn()}};C.prototype.redraw=function(t){this._oGanttChart.redraw(t)};C.prototype.selectByUid=function(t){this._oGanttChart.selectByUid(t)};C.prototype.getTTHsbDom=function(){return this._oTT.getDomRef(sap.ui.table.SharedDomRef.HorizontalScrollBar)};C.prototype.getTTVsbDom=function(){return this._oTT.getDomRef(sap.ui.table.SharedDomRef.VerticalScrollBar)};C.prototype.getTCVsbDom=function(){return this._oGanttChart.getTTVsbDom()};C.prototype._getTTFirstRenderingRowIndex=function(){if(this._oTT.getRows().length>0){return this._oTT.getRows()[0].getIndex()}return this._oTT.getFirstVisibleRow()};["addCustomToolbarItem","insertCustomToolbarItem","removeCustomToolbarItem","indexOfCustomToolbarItem","removeAllCustomToolbarItems","destroyCustomToolbarItems","getCustomToolbarItems"].forEach(function(t){C.prototype[t]=function(){return this._oToolbar[t].apply(this._oToolbar,arguments)}});return C},true);
//# sourceMappingURL=GanttChartWithTable.js.map