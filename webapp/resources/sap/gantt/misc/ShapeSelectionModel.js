/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

		(c) Copyright 2009-2015 SAP SE. All rights reserved
	
 */
sap.ui.define(["sap/ui/thirdparty/jquery","sap/ui/base/ManagedObject","sap/gantt/misc/Utility","sap/ui/core/Core"],function(jQuery,e,t,i){"use strict";var a=e.extend("sap.gantt.misc.ShapeSelectionModel",{constructor:function(t,i){e.apply(this,arguments);this.aSelectedRelationships=[];this.mSelectedShapes={uid:[],shapes:[]}},metadata:{properties:{selectionMode:{type:"sap.gantt.SelectionMode",defaultValue:sap.gantt.SelectionMode.MultiWithKeyboard}},associations:{ganttChart:{type:"sap.gantt.GanttChart",multiple:false}}}});var n={Row:"Row",Shape:"Shape"};a.prototype.clearAllSelections=function(){var e=this.clearShapeSelection();var t=this.clearRelationshipSelection();return e&&t};a.prototype.clearShapeSelection=function(){if(this.mSelectedShapes.uid.length===0){return false}this.mSelectedShapes.uid=[];return true};a.prototype.clearRelationshipSelection=function(){if(this.aSelectedRelationships.length===0){return false}this.aSelectedRelationships=[];return true};a.prototype.getSelectedShapeDatum=function(){var e=[];var t=this.mSelectedShapes.uid.length;for(var i=0;i<t;i++){var a=this.mSelectedShapes.uid[i];var n=this.getShapeDatumByShapeUid(a);if(n){e.push(n)}}return e};a.prototype.getSelectedRelationships=function(){return this.aSelectedRelationships};a.prototype.isShapeSelected=function(e){return jQuery.inArray(e,this.mSelectedShapes.uid)===-1?false:true};a.prototype.isRelationshipSelected=function(e){return this.aSelectedRelationships.some(function(t){return t.uid===e})};a.prototype.isSelectedShapeVisible=function(e,i){var a=t.getIdByUid(e);var n=t.getShapeDatumById(a,i);return n.some(function(t){return t.uid===e})};a.prototype.changeShapeSelection=function(e,i,a,n,r){var o,l;if(this.getSelectionMode()===sap.gantt.SelectionMode.None){return{shapeSelectionChange:false,relationshipSelectionChange:false}}var s=t.getShapeDataNameByUid(e.uid)===sap.gantt.shape.ShapeCategory.Relationship;var h=a&&this.getSelectionMode()===sap.gantt.SelectionMode.MultiWithKeyboard||this.getSelectionMode()===sap.gantt.SelectionMode.Multiple;if(h){if(s){if(this.isRelationshipSelected(e.uid)){l=this.deselectRelationship(e.uid)}else{l=this.selectRelationship(e)}}else{if(this.isShapeSelected(e.uid)&&!n&&!r){o=this.deselectShape(e.uid)}else{o=this.selectByShapeData(e)}}}else{if(s){if(!this.isRelationshipSelected(e.uid)){l=this.clearRelationshipSelection();o=this.clearShapeSelection();l=this.selectRelationship(e)?true:l}}else{if(!this.isShapeSelected(e.uid)&&!n&&!r){l=this.clearRelationshipSelection();o=this.clearShapeSelection();o=this.selectByShapeData(e)?true:o}}}return{shapeSelectionChange:o,relationshipSelectionChange:l}};a.prototype.selectByShapeData=function(e){if(!e||this.isShapeSelected(e.uid)){return false}this.mSelectedShapes.uid.push(e.uid);return true};a.prototype.selectShapeByUid=function(e){var t;if(e&&e.length>0){for(var i=0;i<e.length;i++){t=t||this.selectByShapeData(this.getShapeDatumByShapeUid(e[i]))}}return t};a.prototype.deselectShape=function(e){var t=jQuery.inArray(e,this.mSelectedShapes.uid);if(t>=0){this.mSelectedShapes.uid.splice(t,1)}else{return false}return true};a.prototype.selectShapes=function(e,t){if(!e||e.length===0){return this.clearShapeSelection()}var i;if(t){i=this.clearShapeSelection()}var a=this._getShapeDatumForSelection(e);for(var n=0;n<a.length;n++){i=this.selectByShapeData(a[n])?true:i}return i};a.prototype.deselectShapes=function(e){if(!e||e.length===0){return this.clearShapeSelection()}var t;var i=this.getSelectedShapeDatum();for(var a=0;a<i.length;a++){var n=i[a];if(jQuery.inArray(n.__id__,e)>=0){t=this.deselectShape(n.uid)?true:t}}return t};a.prototype.selectRelationship=function(e){if(this.isRelationshipSelected(e.uid)){return false}this.aSelectedRelationships.push(e);return true};a.prototype.deselectRelationship=function(e){var t=this;var i=jQuery.each(this.aSelectedRelationships,function(i,a){if(a&&a.uid===e){t.aSelectedRelationships.splice(i,1);return true}});return i?true:false};a.prototype.selectRelationships=function(e,t){if(!e||e.length===0){return this.clearRelationshipSelection()}var i;if(t){i=this.clearRelationshipSelection()}for(var a=0;a<e.length;a++){i=this.selectRelationship(e[a])?true:i}return i};a.prototype.deselectRelationships=function(e){if(!e||e.length===0){return this.clearRelationshipSelection()}else{var t;for(var i in this.aSelectedRelationships){var a=this.aSelectedRelationships[i];if(jQuery.inArray(a.id,e)>=0){t=this.deselectRelationship(a.uid)?true:t}}return t}};a.prototype.selectUnderlyingTableRows=function(e,t,i){var a=this._getSelectionHandler(t);var n=a.getSelectedIndices();if(i&&n.length>0){a.clearSelection()}var r=this._getRowDatumForSelection(e,t);for(var o=0;o<r.length;o++){var l=r[o];var s=this.getSelectionMode();if(s===sap.gantt.SelectionMode.Multiple||s===sap.gantt.SelectionMode.MultiWithKeyboard){a.addSelectionInterval(l.rowIndex,l.rowIndex)}else{a.setSelectedIndex(l.rowIndex)}}};a.prototype.deselectUnderlyingTableRows=function(e,t){if(!e||e.length===0){this._getSelectionHandler(t).clearSelection();return}var i=this._getRowDatumForSelection(e,t);for(var a=0;a<i.length;a++){var n=i[a];if(n){this._getSelectionHandler(t).removeSelectionInterval(n.rowIndex,n.rowIndex)}}};a.prototype.getShapeDatumByShapeUid=function(e){return this._getDatumByUid(e,n.Shape)};a.prototype.getRowDatumByShapeUid=function(e){return this._getDatumByUid(e,n.Row)};a.prototype._getDatumByUid=function(e,i){var a=this._getGanttChart();var r;if(n.Shape===i){r=t.getShapeDatumByShapeUid(e,a.getId())}else{r=t.getRowDatumByShapeUid(e,a.getId())}if(r){return r}var o,l;var s=t.getShapeDataNameByUid(e);var h=a._oTT.getBinding("rows").getMetadata().getName()==="sap.ui.model.json.JSONTreeBinding";var p=t.getChartSchemeByShapeUid(e);var c=a.getAllRowData();jQuery.each(c,function(t,i){var a=i;if(p===""||p===a.chartScheme){if(h&&a.data[s]){for(var n=0;n<a.data[s].length;n++){if(a.data[s][n].uid===e){o=a;l=a.data[s][n];return false}}}else if(a.data.uid===e){o=a;l=a.data;return false}}});if(i===n.Shape){return l}return o};a.prototype._getRowDatumForSelection=function(e,i){var a=e?e:[],r=t.getRowDatumRefById(a,i.getParent().getId()),o=r.length===a.length;if(!o){var l=this._lookupInvisibleDatum(a,r,n.Row);r=r.concat(l)}return r};a.prototype._getShapeDatumForSelection=function(e){var i=this._getGanttChart();var a=e?e:[];var r=t.getShapeDatumById(a,i.getId()),o=r.length===a.length;if(!o){var l=this._lookupInvisibleDatum(a,r,n.Shape);r=r.concat(l)}return r};a.prototype._lookupInvisibleDatum=function(e,t,i){var a=this._getInvisibleIds(e,t,i);var r=[];if(a.length>0){var o=this._getGanttChart(),l=o.getShapeDataNames();var s=o.getAllRowData();var h=function(e,t){var i=null;jQuery.each(l,function(a,n){var r;if(typeof n==="string"){r=n}else{r=n.name}var o=e.data[r];if(o){jQuery.each(o,function(e,a){if(a.__id__==t){i=a;return false}});if(i){return false}}});return i};var p=function(e,t){var i=null;jQuery.each(s,function(a,r){if(t===n.Shape){i=h(r,e);if(i){return false}}else{if(r.id==e){i=r;return false}}});return i};r=a.map(function(e){return p(e,i)})}return r};a.prototype._getInvisibleIds=function(e,t,i){var a=t.map(function(e){if(i===n.Shape){return e.__id__}return e.id});return e.filter(function(e){return jQuery.inArray(e,a)===-1})};a.prototype._getGanttChart=function(){return i.byId(this.getGanttChart())};a.prototype._getSelectionHandler=function(e){return e._oSelectionPlugin||e};return a});
//# sourceMappingURL=ShapeSelectionModel.js.map