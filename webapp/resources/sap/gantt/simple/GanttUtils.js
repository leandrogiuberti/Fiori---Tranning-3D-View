/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

		(c) Copyright 2009-2015 SAP SE. All rights reserved
	
 */
sap.ui.define(["sap/ui/thirdparty/jquery","sap/base/Log","sap/ui/base/Object","sap/base/i18n/date/CalendarType","sap/gantt/misc/Utility","sap/ui/core/format/DateFormat","sap/ui/core/Locale","sap/m/OverflowToolbar","sap/ui/core/theming/Parameters","./CoordinateUtils","./MarkerType","sap/gantt/misc/Format","sap/gantt/library","sap/ui/table/rowmodes/Auto","sap/ui/table/rowmodes/Fixed","sap/ui/table/rowmodes/Interactive","sap/gantt/utils/GanttChartConfigurationUtils","sap/ui/core/Element","sap/ui/core/RenderManager","sap/base/util/ObjectPath","sap/gantt/polyfills/timeUtils/millisecond"],function(jQuery,e,t,a,r,n,i,s,o,l,g,c,u,h,p,f,d,m,v,S,T){"use strict";var y={};var _={};var E=false;var I=false;var b={SHAPE_ID_DATASET_KEY:"data-sap-gantt-shape-id",ROW_ID_DATASET_KEY:"data-sap-gantt-row-id",CONNECTABLE_DATASET_KEY:"data-sap-gantt-connectable",SELECT_FOR_DATASET_KEY:"sap-gantt-select-for",SHAPE_CONNECT_FOR_DATASET_KEY:"sap-gantt-shape-connect-for",SHAPE_CONNECT_INDICATOR_WIDTH:10,oDateFormat:n.getDateInstance({pattern:"yyyyMMddHHmmss",calendarType:a.Gregorian}),shapeElementById:function(e,t){var a=window.document.getElementById(t),r=a.querySelector("g.sapGanttChartShapes");var n=r.querySelectorAll("["+b.SHAPE_ID_DATASET_KEY+"='"+e+"']");var i=n[0];if(i){return jQuery(i).control(0)}return null},isRelationshipConnectedToPseudoShapes:function(e,t){var a=m.getElementById(t);var r=a.getTable().getRows();var n=false,i;r.forEach(function(t){if(!n){var a=t.getAggregation("_settings");i=a.getPseudoShapes&&a.getPseudoShapes().filter(function(t){return t.aShapeIds.indexOf(e)>-1})[0];if(i){n=true}}});if(n&&document.getElementById(i.getId())){return i}},getValueX:function(t){var a;var n=t.getMetadata().getProperty("x");if(n){a=t.getProperty(n.name);if(a!==null&&a!==undefined){return a}}var i=d.getRTL(),s=i?t.getEndTime()||t.getTime():t.getTime();if(s){a=t.getXByTime(s)}if(!r.isNumeric(a)){e.warning("couldn't convert timestamp to x with value: "+s)}return a},getRowInstance:function(e,t){var a;var r=jQuery(e.target).control(0);if(r&&r.getParentRowSettings){a=r.getParentRowSettings().getParent().getIndex()}else{a=jQuery(e.target).closest("rect.sapGanttBackgroundSVGRow").data("sapUiIndex")}if(a!=null){return t.getRows()[a]}},setTableRowMode:function(e){if(e){var t=e.getRowMode();if(!t&&e.getVisibleRowCountMode()){return}if(t===null||t==="Fixed"){e.setRowMode(new p)}else if(t==="Auto"){e.setRowMode(new h)}else if(t==="Interactive"){e.setRowMode(new f)}}},getRowInstancefromShape:function(e){var t=e.getParentRowSettings();if(t!=null){return t.getParentRow()}},_get2dContext:function(e,t,a){if(!y.context){y.context=document.createElement("canvas").getContext("2d")}if(y.fontSize!==e||y.fontFamily!==t||y.fontWeight!==a){y.context.font=a+" "+e+"px "+t;y.fontSize=e;y.fontFamily=t;y.fontWeight=a}return y.context},getShapeTextWidth:function(e,t,a,r){return this._get2dContext(t,a,r).measureText(e).width},getSelectedTableRowSettings:function(e,t){var a=e.getRows(),r=e.getFirstVisibleRow();if(a.length===0){return null}var n=a[0].getIndex();var i=t-r;if(n!==r){i+=Math.abs(n-r)}if(!a[i]){return null}return a[i].getAggregation("_settings")},updateGanttRows:function(e,t,a){var r=e.getParent().getParent();var n=jQuery(document.getElementById(r.getId()+"-svg")),i=n.find("rect.sapGanttBackgroundSVGRow");if(r.getEnableChartSelectionState()){i.eq(a).toggleClass("sapGanttBackgroundSVGRowSelected",!!t[a].selected)}if(r.getEnableChartHoverState()){i.eq(a).toggleClass("sapGanttBackgroundSVGRowHovered",!!t[a].hovered)}},getShapesWithUid:function(e,t){var a=function(t){var a=r.parseUid(t),n=a.shapeId;var i=["[id='",e,"']"," ["+b.SHAPE_ID_DATASET_KEY+"='",n,"']"].join("");var s=document.querySelector(i);if(s){const e=m.getElementById(s.id);if(e){const t=r.parseUid(e.getShapeUid());if(t.shapeId===n&&t.rowId===a.rowId){return e}}}};return t.map(a)},getShapeByShapeId:function(e,t){var a=[];t.forEach(function(t){var r=["[id='",e,"']"," ["+b.SHAPE_ID_DATASET_KEY+"='",t,"']"].join("");var n=document.querySelector(r);if(n){var i=m.getElementById(n.id);if(i){a.push(i)}}});return a},getShapesInRowsById:function(e,t){var a=document.getElementById(e);var r=[];t.forEach(function(e){if(a){var t=a.querySelector("[data-sap-gantt-row-id='"+e+"']");if(t){r=Array.from(t.children).filter(function(e){return e.id!==""}).reduce(function(e,t){return e.concat(m.getElementById(t.id))},r)}}});return r},getShapeIdFromShapeUid:function(e){return e.map(function(e){var t=r.parseUid(e);return t.shapeId})},getTimeFormaterBySmallInterval:function(e){var t=e.getAxisTimeStrategy(),a=t.getTimeLineOption().smallInterval,r=a.unit;var s=t.getCalendarType(),o=t.getLocale()?t.getLocale():new i(d.getLanguage().toLowerCase());var l="yyyyMMMddhhms";if(!(r===sap.gantt.config.TimeUnit.minute||r===sap.gantt.config.TimeUnit.hour)){l="yyyyMMMdd"}var g=a.locale?new i(a.locale):o;var c={format:l,style:a.style,calendarType:s};return n.getDateTimeWithTimezoneInstance(c,g)},getFormatedDateByTimeZone:function(e){var t=this.oDateFormat.format(e);return c.abapTimestampToDate(t)},resetStrokeDasharray:function(e){if(!e){return}var t=e.getSimpleAdhocLines().find(function(e){return e._getSelected()});if(t){t._setSelected(false);var a=document.getElementById(t._getHeaderLine().sId);var r=document.getElementById(t._getLine().sId);var n=document.getElementById(t._getMarker().getId());n.style.cursor="pointer";if(r&&a){r.style.strokeDasharray=t.getStrokeDasharray();a.style.strokeDasharray=t.getStrokeDasharray();r.style.strokeWidth=t._getStrokeWidth();a.style.strokeWidth=t._getStrokeWidth()}}var i=e.getDeltaLines().find(function(e){return e._getIsSelected()});if(i){var s=i._getChartDeltaArea();if(s){var l=document.getElementById(s.sId);if(i._getEnableChartDeltaAreaHighlight()===true){l.style.opacity=0}}var g=document.getElementById(i._getForwardMarker().sId);var c=document.getElementById(i._getBackwardMarker().sId);var u=document.getElementById(i._getHeaderDeltaArea().sId);var h=o.get({name:"sapUiChartDataPointBorderColor",callback:function(e){h=e}});if(i.getVisibleDeltaStartEndLines()){var p=document.getElementById(i._getStartLine().sId);var f=document.getElementById(i._getEndLine().sId);var d=document.getElementById(i._getHeaderStartLine().sId);var m=document.getElementById(i._getHeaderEndLine().sId);p.style.strokeDasharray=i.getStrokeDasharray();f.style.strokeDasharray=i.getStrokeDasharray();d.style.strokeDasharray=i.getStrokeDasharray();m.style.strokeDasharray=i.getStrokeDasharray();p.style.strokeWidth=i._getStrokeWidth();f.style.strokeWidth=i._getStrokeWidth();d.style.strokeWidth=i._getStrokeWidth();m.style.strokeWidth=i._getStrokeWidth()}g.style.fillOpacity=0;c.style.fillOpacity=0;u.style.opacity=1;u.style.cursor="pointer";g.style.stroke=null;c.style.stroke=null;if(i._getVisibleMarker()===true){g.style.fillOpacity=1;c.style.fillOpacity=1;g.style.stroke=h;c.style.stroke=h}var v=e._getResizeExtension();v.clearAllDeltaOutline();i._setIsSelected(false)}},adhocLinesPresentAndEnabled:function(e){return e.getSimpleAdhocLines().filter(function(e){return e.MarkerType!=g.None}).length>0&&e.getEnableAdhocLine()},addToolbarToTable:function(e,t,a){if(a){if(t.getExtension().length==0){var r=new s;r.addContent(e.oExportTableToExcelButton);t.addExtension(r)}else{t.getExtension()[0].addContent(e.oExportTableToExcelButton)}}},findSpaceInLevel:function(e,a,r,n,i,s){for(var o=0;o<_[e].length;o++){if(I){return}var l=a.getParent().getParent();if(l&&l.isA("sap.gantt.overlays.GanttRowOverlay")){return}var g=n,c=n,u=n,h=i&&i[a.getScheme&&a.getScheme()];if(t.isA(a,"sap.gantt.simple.AdhocLine")){g=r}if(t.isA(_[e][o],"sap.gantt.simple.AdhocLine")){c=r}if(t.isA(_[e][o+1],"sap.gantt.simple.AdhocLine")){u=r}if(_[e].length>1){if(o===0&&(a[g]()<=_[e][o][r]()||a[g]()>_[e][o][r]()&&a[g]()-_[e][o][r]()<=1e3)&&!(this._stringToDateObject(a[r]()).getTime()===this._stringToDateObject(_[e][o][r]()).getTime()&&this._stringToDateObject(a[g]()).getTime()===this._stringToDateObject(_[e][o][c]()).getTime())){_[e].push(a);s["level"+e]=s["level"+e]>h?s["level"+e]:h;E=true}else if(_[e][o+1]!==undefined&&(a[r]()>=_[e][o][c]()&&a[g]()<=_[e][o+1][r]()||a[r]()<_[e][o][c]()&&_[e][o][c]()-a[r]()<=1e3&&(a[g]()>_[e][o+1][r]()&&a[g]()-_[e][o+1][r]()<=1e3||a[g]()<=_[e][o+1][r]())||a[g]()>_[e][o+1][r]()&&a[g]()-_[e][o+1][r]()<=1e3&&(a[r]()>=_[e][o][c]()||a[r]()<_[e][o][c]()&&_[e][o][c]()-a[r]()<=1e3))&&!(this._stringToDateObject(a[r]()).getTime()===this._stringToDateObject(_[e][o][r]()).getTime()&&this._stringToDateObject(a[g]()).getTime()===this._stringToDateObject(_[e][o][c]()).getTime()||this._stringToDateObject(a[r]()).getTime()===this._stringToDateObject(_[e][o+1][r]()).getTime()&&this._stringToDateObject(a[g]()).getTime()===this._stringToDateObject(_[e][o+1][u]()).getTime())){_[e].push(a);s["level"+e]=s["level"+e]>h?s["level"+e]:h;E=true}else if(o===_[e].length-1&&(a[r]()>=_[e][o][c]()||a[r]()<_[e][o][c]()&&_[e][o][c]()-a[r]()<=1e3)&&!(this._stringToDateObject(a[r]()).getTime()===this._stringToDateObject(_[e][o][r]()).getTime()&&this._stringToDateObject(a[g]()).getTime()===this._stringToDateObject(_[e][o][c]()).getTime())){_[e].push(a);s["level"+e]=s["level"+e]>h?s["level"+e]:h;E=true}else if(this._stringToDateObject(a[r]()).getTime()===this._stringToDateObject(_[e][o][r]()).getTime()&&this._stringToDateObject(a[g]()).getTime()===this._stringToDateObject(_[e][o][c]()).getTime()){if(parseInt(e)===Object.keys(_).length-1){_[parseInt(e)+1]=[a];s["level"+(parseInt(e)+1)]=h;E=true}else{E=false}}else if(o===_[e].length-1&&parseInt(e)===Object.keys(_).length-1){_[parseInt(e)+1]=[a];s["level"+(parseInt(e)+1)]=h;E=true}else{E=false}}else{if((a[r]()>=_[e][o][c]()||a[r]()<_[e][o][c]()&&_[e][o][c]()-a[r]()<=1e3||(a[g]()<=_[e][o][r]()||a[g]()>_[e][o][r]()&&a[g]()-_[e][o][r]()<=1e3))&&!(this._stringToDateObject(a[r]()).getTime()===this._stringToDateObject(_[e][o][r]()).getTime()&&this._stringToDateObject(a[g]()).getTime()===this._stringToDateObject(_[e][o][c]()).getTime())){_[e].push(a);s["level"+e]=s["level"+e]>h?s["level"+e]:h;E=true}else if(this._stringToDateObject(a[r]()).getTime()===this._stringToDateObject(_[e][o][r]()).getTime()&&this._stringToDateObject(a[g]()).getTime()===this._stringToDateObject(_[e][o][c]()).getTime()){if(parseInt(e)===Object.keys(_).length-1){_[parseInt(e)+1]=[a];s["level"+(parseInt(e)+1)]=h;E=true}else{E=false}}else if(parseInt(e)===Object.keys(_).length-1){_[parseInt(e)+1]=[a];s["level"+(parseInt(e)+1)]=h;E=true}else{E=false}}if(E){o=_[e].length;I=true;_=this.sortShapesByTime(_,e,r)}}},sortShapesByTime:function(e,t,a){var r=e[t].length;var n;do{n=false;for(var i=0;i<r;i++){if(e[t][i+1]!==undefined){if(e[t][i][a]()>e[t][i+1][a]()){var s=e[t][i];e[t][i]=e[t][i+1];e[t][i+1]=s;n=true}}}}while(n);return e},_partitionShapesIntoOverlappingRanges:function(e,t,a,r,n){_={};var i="get"+t.charAt(0).toUpperCase()+t.slice(1);var s="get"+a.charAt(0).toUpperCase()+a.slice(1);if(e.length>0){var o=e[0].getParent().getParent();if(!(o&&o.isA("sap.gantt.overlays.GanttRowOverlay"))){_[0]=[e[0]];if(!n){n={}}if(e[0].getScheme){n["level0"]=r&&r.schemeRowSpanMap&&r.schemeRowSpanMap[e[0].getScheme()]}}}for(var l=1,g=e.length;l<g;l++){I=false;for(var c in _){this.findSpaceInLevel(c,e[l],i,s,r&&r.schemeRowSpanMap,n)}}return{shapesWithRowLevels:_,internalRowWithSpan:n}},_stringToDateObject:function(e){if(typeof e==="string"&&e.length>0){return c.abapTimestampToDate(e)}return e},_getExpandedChildArray:function(e,a,r,n){var i,s;e.forEach(function(e){if(t.isA(e,"sap.gantt.simple.BaseConditionalShape")){var o=e._getActiveShapeElement();if(r.indexOf(o.getScheme())>-1||a.getEnablePseudoShapes()){if(t.isA(o,"sap.gantt.simple.BaseGroup")){i=null;s=null;o.getShapes().forEach(function(e){if(!i&&!s){i=e.getTime();s=e.getEndTime()}else{if(e.getTime()<i){i=e.getTime()}if(e.getEndTime()>=s){s=e.getEndTime()}}});o.setProperty("time",i,true);o.setProperty("endTime",s,true);n=n.concat(o)}else if(o){n=n.concat(o)}}}else if(t.isA(e,"sap.gantt.simple.BaseGroup")){i=null;s=null;e.getShapes().forEach(function(e){if(!i&&!s){i=e.getTime();s=e.getEndTime()}else{if(e.getTime()<i){i=e.getTime()}if(e.getEndTime()>=s){s=e.getEndTime()}}});e.setProperty("time",i,true);e.setProperty("endTime",s,true);n=n.concat(e)}else{n=n.concat(e)}});return n},calculateLevelForShapes:function(e,a,r,n,i,s){var o=function(e){return e.reduce(function(e,t){return e.concat(Array.isArray(t)?o(t):t)},[])};var l=this._partitionShapesIntoOverlappingRanges(e,a,r,i,s);var g=l.shapesWithRowLevels;s=l.internalRowWithSpan;var c=0;var u=Object.values(g).map(function(e,t){e.map(function(e){var a=t+1;if(e._setLevel){e._setLevel(a)}e._level=a;var r=e.getParentRowSettings&&e.getParentRowSettings(),n=e.getShapeId&&e.getShapeId();if(r&&r._overlayShapeIdList&&n&&r._overlayShapeIdList[n]){r._overlayShapeIdList[n]=e._level}if(c<a){c=a}return e});return e});var h=o(u);var p={};if(n){p={adhocLines:h.filter(function(e){return t.isA(e,"sap.gantt.simple.AdhocLine")}),deltaLines:h.filter(function(e){return t.isA(e,"sap.gantt.simple.DeltaLine")}),maxLevel:c}}else{p={shapes:h,maxLevel:c}}return{childWithLevels:p,internalRowWithSpan:s}},getShapeSuccessors:function(e,t){var a=[];if(e.getEnableChainSelection()){var r=this._getVisibleRelationships(t);var n=r.filter(function(t){return t.getPredecessor()===e.getShapeId()});n.forEach(function(e){var r=e.getRelatedInRowShapes(t.getId());if(r.successor){a.push(r.successor)}});a=Array.from(new Set(a))}return a},getShapePredeccessors:function(e,t){var a=[];if(e.getEnableChainSelection()){var r=this._getVisibleRelationships(t);var n=r.filter(function(t){return t.getSuccessor()===e.getShapeId()});n.forEach(function(e){var r=e.getRelatedInRowShapes(t.getId());if(r.predecessor){a.push(r.predecessor)}});a=Array.from(new Set(a))}return a},selectAssociatedShapes:function(e,t){var a=e.shape;var r=t._getDragDropExtension();var n=!a.getSelected();if(r.shapeSelectedOnMouseDown&&!r.initiallySelected&&!t.getEnableSelectAndDrag()){n=r.shapeSelectedOnMouseDown}var i=[a];if(a.getEnableChainSelection()){i=this._getShapesToSelect(a,t);i.forEach(function(e){this.oSelection.updateShape(e.getShapeUid(),{selected:n,ctrl:true,draggable:e.getDraggable(),time:e.getTime(),endTime:e.getEndTime()})}.bind(t))}return i},_getShapesToSelect:function(e,t){var a=[e];var r=this._getVisibleRelationships(t);var n=r.filter(function(t){return t.getPredecessor()===e.getShapeId()||t.getSuccessor()===e.getShapeId()});n.forEach(function(e){var r=e.getRelatedInRowShapes(t.getId());if(r.predecessor&&r.predecessor.getSelectableInChainSelection()){a.push(r.predecessor)}if(r.successor&&r.successor.getSelectableInChainSelection()){a.push(r.successor)}});a=Array.from(new Set(a));return a},_getVisibleRelationships:function(e){var t=[];e.getTable().getRows().forEach(function(e){var a=e.getAggregation("_settings").getRelationships();t=t.concat(a)});t=Array.from(new Set(t));return t},rerenderAssociatedRelationships:function(e,t){var a=new v;var r=[];var n=this._getVisibleRelationships(e);n.forEach(function(e){if(e.getSuccessor()===t.getShapeId()||e.getPredecessor()===t.getShapeId()){r.push(e)}});r.forEach(function(t){t.renderElement(a,t,e.getId())})},getFilteredShapeType:function(e){e=Array.from(new Set(e));return e.filter(function(e){return e!=="None"})},getPathCorners:function(e,t){var a=e.replace(/([A-Z])/g," $1");var r=[],n;var i=a.split(/[,\s]/).reduce(function(e,t){var a=t.match("([a-zA-Z])(.+)");if(a){e.push(a[1]);e.push(a[2])}else{e.push(t)}return e},[]);var s=i.reduce(function(e,t){if(parseFloat(t)==t&&e.length){e[e.length-1].push(t)}else{e.push([t])}return e},[]);function o(e,t,a){var r=t.x-e.x;var n=t.y-e.y;var i=Math.sqrt(r*r+n*n);return l(e,t,Math.min(1,a/i))}function l(e,t,a){return{x:e.x+(t.x-e.x)*a,y:e.y+(t.y-e.y)*a}}function g(e,t){if(e.length>2){e[e.length-2]=t.x;e[e.length-1]=t.y}}function c(e){return{x:parseFloat(e[e.length-2]),y:parseFloat(e[e.length-1])}}if(s.length>1){var u=c(s[0]),h=null;if(s[s.length-1][0]=="Z"&&s[0].length>2){h=["L",u.x,u.y];s[s.length-1]=h}r.push(s[0]);for(var p=1;p<s.length;p++){var f=r[r.length-1],d=s[p],m=d==h?s[1]:s[p+1],v=t;if(m&&f&&f.length>2&&d[0]=="L"&&m.length>2&&m[0]=="L"){var S=c(f),T=c(d),y=c(m),_,E,I=Math.abs(S.x-T.x)+Math.abs(S.y-T.y),b=Math.abs(y.x-T.x)+Math.abs(y.y-T.y),A=Math.max(Math.min(v,I,b/2),1);_=o(T,S,A);E=o(T,y,A);g(d,_);d.origPoint=T;r.push(d);var D=l(_,T,.5),w=l(T,E,.5),R=["C",D.x,D.y,w.x,w.y,E.x,E.y];R.origPoint=T;r.push(R)}else{r.push(d)}}if(h){var x=c(r[r.length-1]);r.push(["Z"]);g(r[0],x)}}else{r=s}n=r.reduce(function(e,t){return e+t.join(" ")+" "},"");return n},arrayMove:function(e,t,a){if(a>=e.length){var r=a-e.length+1;while(r--){e.push(undefined)}}e.splice(a,0,e.splice(t,1)[0]);return e},getEdgePoint:function(e){var t=2;var a=["Arrow","None"];var r=this._getVisibleRelationships(e);r.forEach(function(r){if(r.getPredecessor()!==undefined&&r.getSuccessor()!==undefined&&(r.getShapeTypeStart()!=="None"||a.indexOf(r.getShapeTypeEnd())==-1)||e.getRelationshipShapeSize()==sap.gantt.simple.relationshipShapeSize.Large){t=3}});return t},getTimeLabel:function(e,t,a,n){var i=l.getEventSVGPoint(n,e);var s,o;o=t.getZoomStrategy();s=t.viewToTime(i.x);return r.getLowerCaseLabel(a.getFormattedDate(o.getLowerRowFormatter(),s))},getVisibleElements:function(e,t,a){return Array.from(e.querySelectorAll(t)).reduce(function(e,t){return e.concat(Array.from(t.querySelectorAll(a)))},[])},isDynamicText:function(){var e=u.simple.horizontalTextAlignment;var a=false;var r=Array.from(document.querySelectorAll(".sapGanttChartSvg .sapGanttChartShapes .baseShapeSelection")).filter(function(e){if(!e.classList.contains("sapGanttTextNoPointerEvents")&&e.tagName!="text"){return e}});r.forEach(function(r){var n=r.closest("[data-sap-ui]").getAttribute("data-sap-ui");var i=m.getElementById(n);if(i&&!a){if(t.isA(i,"sap.gantt.simple.BaseConditionalShape")){var s=i._getActiveShapeElement();if(t.isA(s,"sap.gantt.simple.BaseGroup")){s.getShapes().forEach(function(t){if(t.getHorizontalTextAlignment()===e.Dynamic){a=true}})}else if(i.getHorizontalTextAlignment()===e.Dynamic){a=true}}else if(t.isA(i,"sap.gantt.simple.MultiActivityGroup")){if(i.getTask().getHorizontalTextAlignment()===e.Dynamic){a=true}}else if(t.isA(i,"sap.gantt.simple.BaseGroup")){i.getShapes().forEach(function(t){if(t.getHorizontalTextAlignment()===e.Dynamic){a=true}})}else if(i.getHorizontalTextAlignment()===e.Dynamic){a=true}}});if(!a){var n=Array.from(document.querySelectorAll(".sapGanttChartSvg .sapGanttChartCalendar .baseShapeSelection")).filter(function(e){if(!e.classList.contains("sapGanttTextNoPointerEvents")&&e.tagName!="text"){return e}});n.forEach(function(t){if(!a){var r=t.closest("[data-sap-ui]").getAttribute("data-sap-ui");var n=m.getElementById(r);if(n.getHorizontalTextAlignment()===e.Dynamic){a=true}}})}return a},setLmarker:function(e,t,a){var r=t.mAnchors.predecessor.x,n=t.mAnchors.predecessor.y;var i=t.mAnchors.successor.x,s=t.mAnchors.successor.y;t.setProperty("_lMarker","",true);var o=t.getProcessedType();var l=e._edgePoint;if(o===1&&r<=i){if(d.getRTL()?t.getLShapeForTypeSF():t.getLShapeForTypeFS()){if(l==2&&t.getShapeTypeStart()=="None"||l==3&&Math.abs(r-i)>=l*6){if(n>s){t.setProperty("_lMarker","rightUp",true)}else{t.setProperty("_lMarker","rightDown",true)}}}}else if(o===2&&r>=i){if(d.getRTL()?t.getLShapeForTypeFS():t.getLShapeForTypeSF()){if(l==2&&t.getShapeTypeStart()=="None"||l==3&&Math.abs(r-i)>=l*6){if(n>s){t.setProperty("_lMarker","leftUp",true)}else{t.setProperty("_lMarker","leftDown",true)}}}}if(a){e.relSet[t.getShapeId()]=t}else{e.relSetFake[t.getShapeId()]=t}},pseudoShapeGroupAfterEdit:function(e,t){var a=[],r=0,n=e.oOverlapShapeIds&&e.oOverlapShapeIds[t];if(n){if(n[0]){var i=b.getShapeByShapeId(e.getId(),[n[0]])[0];i&&a.push({iShapeCount:1,startTime:i.getTime(),endTime:i.getEndTime()})}for(var s=1;s<n.length;s++){var o=b.getShapeByShapeId(e.getId(),[n[s]])[0];if(o){var l=o.getTime(),g=o.getEndTime(),c=a[r];if(c){var u=c.startTime,h=c.endTime;if(l>=u&&g<=h){c.iShapeCount++}else if(l>=u&&l<h&&g>h){c.iShapeCount++;c.endTime=g}else if(l>=h&&g>=h){r++;a.push({iShapeCount:1,startTime:l,endTime:g})}}}}}return a},relationexist:function(e,t){t.mRelatedShapes=t.getRelatedInRowShapes(e.getId());var a=t.getProcessedType();t.mAnchors=t.getRlsAnchors(a,t.mRelatedShapes);if(!t.getVisible()){return false}if(!t.mRelatedShapes.predecessor&&!t.mRelatedShapes.successor){return false}var r=function(e){return e&&!isNaN(parseFloat(e.x))&&isFinite(e.x)&&!isNaN(parseFloat(e.y))&&isFinite(e.y)};if(!r(t.mAnchors.predecessor)||!r(t.mAnchors.successor)){return false}return true},geNumberOfTruncatedCharacters:function(e,t,a,r,n,i,s){var o=0;s=s?s:1;if(e>t){if(t>0&&a.length>0){o=Math.round(t/Math.ceil(e/a.length));while(true){if(o<0){break}var l=n.apply(r,[a.slice(0,o)]);var g=n.apply(r,[a.slice(0,o+1)]);l=i?l.width:l*s;g=i?g.width:g*s;if(l>t){o--;continue}if(l!=g&&g<t){o++;continue}break}}}else{return a?a.length:0}return o>=0&&o<=a.length?o:0},_calculateSelectedShapeMinTime:function(e){var t=this;var a=function(e,r){if(!e||e.isA("sap.gantt.simple.Relationship")){return}if(e.isA("sap.gantt.simple.BaseConditionalShape")){e=e._getActiveShapeElement()}if(e.getTime()||e.getEndTime()){t._oFoundShape=e}else if(e instanceof sap.gantt.simple.BaseGroup){if(r.getSelectOnlyGraphicalShape()){e._eachChildOfGroup(e,function(e,n){n&&n.forEach(function(e){if(!t._oFoundShape){a(e,r)}})})}else{e._eachChildOfGroup(e,function(e){if(!t._oFoundShape){a(e,r)}})}}};var r,n,i;var s=e.getEnableTimeScrollSync();var o=e.getGanttCharts();var l=o[0];if(l){n=c.abapTimestampToDate(l.getAxisTimeStrategy().getTotalHorizon().getEndTime())}o.forEach(function(e){var t=c.abapTimestampToDate(e.getAxisTimeStrategy().getTotalHorizon().getEndTime()),o;var l=e.getSelectedShapeUid();if(l&&l.length>0){var g=this.getShapesWithUid(e.sId,l);var u=e.getAxisTimeStrategy().getVisibleHorizon();var h=c.abapTimestampToDate(u.getStartTime()).getTime();var p=c.abapTimestampToDate(u.getEndTime()).getTime();g.forEach(function(l){this._oFoundShape=null;a(l,e);if(this._oFoundShape){var g=this._oFoundShape.getTime()?this._oFoundShape.getTime():this._oFoundShape.getEndTime();var c=this._oFoundShape.getEndTime()?this._oFoundShape.getEndTime():this._oFoundShape.getTime();var u=g.getTime();var f=c.getTime();var d=u>=h&&u<p||f>h&&f<=p||u<h&&f>p;if(d){if(s){if(u<n.getTime()){n=g;i=c;r=e}}else if(u<t.getTime()){t=g;o=c}}}}.bind(this))}if(!s&&o){e._minTime=t;e._minEndTime=o}}.bind(this));if(s&&r){r._minTime=n;r._minEndTime=i}},getObjectFromPath:function(e){if(e==="sap.gantt.polyfills.time.timeMillisecond"){return T}else{return S.get(e)}}};return b},true);
//# sourceMappingURL=GanttUtils.js.map