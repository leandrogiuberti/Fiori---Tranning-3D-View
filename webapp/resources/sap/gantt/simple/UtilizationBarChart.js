/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

		(c) Copyright 2009-2015 SAP SE. All rights reserved
	
 */
sap.ui.define(["sap/ui/thirdparty/jquery","./UtilizationChart","./BaseRectangle","sap/gantt/def/pattern/BackSlashPattern","sap/ui/core/theming/Parameters"],function(jQuery,t,e,o,r){"use strict";var n=t.extend("sap.gantt.simple.UtilizationBarChart",{metadata:{library:"sap.gantt",properties:{consumptionColor:{type:"sap.gantt.ValueSVGPaintServer",defaultValue:"sapContent_ForegroundColor"}},defaultAggregation:"periods",aggregations:{periods:{type:"sap.gantt.simple.UtilizationPeriod",group:"Data"}}},renderer:{apiVersion:2}});n.prototype.applySettings=function(e,o){e=e||{};t.prototype.applySettings.call(this,e,o);this._createDefaultDefs()};n.prototype.renderElement=function(t,e){t.openStart("g",this);t.class("sapGanttUtilizationBar");t.openEnd();var o=this.getX(),r=this.getHeight(),n=this.getRowYCenter()-r/2,i=this.getWidth();var a={x:o,y:n,width:i,height:r};this.renderBackgroundDefs(t);this.renderUBCBackground(t,a);var s=this.filterPeriods();if(s.length>0){this._iMaxAllowedSupply=this._getMaxAllowedSupply(s);this.renderOverConsumptionPolygon(t,a,s);this.renderRemainConsumptionPolygon(t,a,s);this.renderConsumptionPolygon(t,a,s);this.renderConsumptionPath(t,a,s);this.renderTooltips(t,a,s)}t.close("g")};n.prototype.filterPeriods=function(){var t=this.getPeriods();var e=this.getGanttChartBase(),o=e.getRenderedTimeRange(),r=o[0],n=o[1];return t.filter(function(t,e,o){var i=e===0||e===o.length-1;if(i){return true}else{return t.getFrom()>=r&&t.getFrom()<=n}})};n.prototype.renderUBCBackground=function(t,e){var o=this.getFill();if(!o){o="url(#"+this.getId()+"-defaultBgPattern)"}var r=jQuery.extend({id:this.getId()+"-ubcBg",fill:o,"fill-opacity":this.getFillOpacity()},e);this.renderRectangleWithAttributes(t,r)};n.prototype.renderOverConsumptionPolygon=function(t,e,o){t.openStart("polygon",this.getId()+"-ubcOCP");t.attr("points",this.getPolygonPoints(e,function(t,o){var r=e.height,n=e.y+r;return n-t.getDemand()/o*r},o));t.attr("fill",this.getOverConsumptionColor());t.openEnd();t.close("polygon")};n.prototype.renderConsumptionPath=function(t,e,o){var n=this.getStroke()||r.get({name:"sapChart_Data_InteractiveColor",callback:function(t){n=t}});t.openStart("path",this.getId()+"-ubcPath");t.attr("d",this.getDemandPathD(e,o));t.attr("fill","none");t.attr("stroke",n);t.attr("stroke-width",this.getStrokeWidth()||2);t.attr("stroke-dasharray",this.getStrokeDasharray()||"0,0");t.openEnd();t.close("path")};n.prototype.renderRemainConsumptionPolygon=function(t,e,o){t.openStart("polygon",this.getId()+"-ubcRCP");t.attr("points",this.getPolygonPoints(e,function(t,o){var r=e.height,n=e.y+r;return n-t.getSupply()/o*r},o));t.attr("fill",this.getRemainCapacityColor());t.openEnd();t.close("polygon")};n.prototype.renderConsumptionPolygon=function(t,e,o){t.openStart("polygon",this.getId()+"-ubcCP");t.attr("points",this.getPolygonPoints(e,function(t,o){var r=e.height,n=e.y+r;var i=Math.min(t.getDemand(),t.getSupply());return n-i/o*r},o));t.attr("fill",this.getConsumptionColor());t.openEnd();t.close("polygon")};n.prototype.renderTooltips=function(t,o,r){var n=[];t.openStart("g");t.class("ubc-tooltips").openEnd();for(var i=0;i<r.length;i++){var a=r[i];var s=r[i+1];if(s){var l=this.toX(a.getFrom()),p=this.toX(s.getFrom());n.push(new e({x:parseFloat(l),y:o.y,height:o.height,width:Math.abs(p-l),fill:"transparent",tooltip:a.getTooltip()}).setProperty("childElement",true))}}n.forEach(function(e){e.renderElement(t,e)});t.close("g")};n.prototype._getMaxAllowedSupply=function(t){var e=Math.max.apply(null,t.map(function(t){return t.getSupply()}));var o=e*this.getOverConsumptionMargin()/100;return e+o};n.prototype.getPolygonPoints=function(t,e,o){var r=t.y+t.height;var n=function(t,e){return[t,e].join(",")+" "};var i="";for(var a=0;a<o.length;a++){var s=o[a],l=a===0,p=a===o.length-1,g=o[p?o.length-1:a+1];var h=this.toX(s.getFrom()),u=this.toX(g.getFrom());if(l){i+=n(h,r)}var d=e(s,this._iMaxAllowedSupply);d=d.toFixed(1);i+=n(h,d);i+=n(u,d);if(p){i+=n(h,d);i+=n(h,r)}}return i};n.prototype.getDemandPathD=function(t,e){var o="";for(var r=0;r<e.length;r++){var n=e[r],i=r===e.length-1,a=e[i?e.length-1:r+1];var s=this.toX(n.getFrom()),l=this.toX(a.getFrom());var p=this.toY(n.getDemand(),t),g=this.toY(a.getDemand(),t);o+=" M "+s+" "+p+" L "+l+" "+p;o+=" M "+l+" "+p+" L "+l+" "+g}return o};n.prototype.toY=function(t,e){var o=e.y,r=e.height,n=o+r;var i=n-t/this._iMaxAllowedSupply*r;i=i<o?o:i;return parseFloat(i.toFixed(1))};n.prototype._createDefaultDefs=function(){if(this.getFill()){return}var t=r.get({name:["sapContent_ForegroundColor","sapContent_ForegroundBorderColor"],callback:function(e){t=e}});this.mDefaultDefs=new sap.gantt.def.SvgDefs({defs:[new o({id:this.getId()+"-defaultBgPattern",tileWidth:5,tileHeight:9,backgroundColor:t.sapContent_ForegroundColor,stroke:t.sapContent_ForegroundBorderColor,strokeWidth:1})]})};n.prototype.renderBackgroundDefs=function(t){if(this.getFill()==null&&this.mDefaultDefs){t.unsafeHtml(this.mDefaultDefs.getDefString())}};n.prototype.getConsumptionColor=function(){return this.determineValueColor(this.getProperty("consumptionColor"))};return n},true);
//# sourceMappingURL=UtilizationBarChart.js.map