/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

		(c) Copyright 2009-2015 SAP SE. All rights reserved
	
 */
sap.ui.define(["sap/ui/core/Element","sap/ui/Device","./RenderUtils","../misc/Utility","sap/gantt/misc/Format","sap/ui/core/theming/Parameters","./BaseRectangle","./AdhocLineRenderer","./GanttUtils","./DeltaLineRenderer","./BaseLine","sap/gantt/simple/GanttExtension","sap/gantt/utils/GanttChartConfigurationUtils","sap/ui/core/Lib","sap/ui/core/RenderManager"],function(e,t,a,r,i,n,l,o,g,s,h,d,p,f,v){"use strict";var c=e.extend("sap.gantt.simple.GanttHeader",{metadata:{library:"sap.gantt",properties:{iHeaderMinheight:{type:"int",defaultValue:33},_iHeaderHeight:{type:"int",defaultValue:0},_iHeaderHeightInitial:{type:"int",defaultValue:0}},aggregations:{_overflowToolbar:{type:"sap.m.Toolbar",multiple:false}},renderer:{apiVersion:2}}});c.prototype._setIHeaderHeight=function(e){this.setProperty("_iHeaderHeight",Math.floor(e),true)};c.prototype._getIHeaderHeight=function(){return this.getProperty("_iHeaderHeight")};c.prototype._setIHeaderHeightInitial=function(e){this.setProperty("_iHeaderHeightInitial",Math.floor(e),true)};c.prototype._getIHeaderHeightInitial=function(){return this.getProperty("_iHeaderHeightInitial")};var H=0;c.prototype.renderElement=function(){performance.mark("GanttHeader.renderElement--start");var t=new v,r=this.getParent(),h;if(!r.getShowGanttHeader()){return}var p=r.getId();var c=jQuery("div.sapGanttChartWithTableHeader[data-sap-ui-related="+p.replace(/([:.\[\],=@])/g,"\\$1")+"]");var u=this.getParent().getTable(),b=u.getAggregation("extension");h=b.filter(function(e){if(e instanceof sap.m.OverflowToolbar){return e}});this.iOverflowToolbarHeight=0;if(r.getEnableChartOverflowToolbar()){this.renderOverflowToolbar(t,r);var m=e.getElementById(p+"-ganttHeaderOverflowToolbar").getDomRef();if(h[0]){var T=e.getElementById(h[0].sId).getDomRef();if(T){this.iOverflowToolbarHeight=T.clientHeight}}else if(m){this.iOverflowToolbarHeight=m.clientHeight}}if(c&&c.length>0){H=c[0].offsetHeight;if(this.iOverflowToolbarHeight&&r.getEnableChartOverflowToolbar()){H-=this.iOverflowToolbarHeight}}this._setIHeaderHeight(H);var w=a.getGanttRenderWidth(r);var L=0;var E=r.getSimpleAdhocLines().filter(function(e){return e.MarkerType!=sap.gantt.simple.MarkerType.None});var y=r.getDeltaLines().filter(function(e){return e.getVisible()});var I,_,S;I=this._getIHeaderHeight()/4;_=this._getIHeaderHeight()/5*2;S=this._getIHeaderHeight()/5*4;if(E.length>0&&r.getEnableAdhocLine()===true||y.length>0&&r.getEnableDeltaLine()===true){y=y.filter(function(e){return e.getVisible()});E=E.filter(function(e){return e});var O=0;var x=0;var M;if(E.length>0&&r.getEnableAdhocLine()===true&&(y.length>0&&r.getEnableDeltaLine()===true)){M=g.calculateLevelForShapes(y.concat(E),"timeStamp","endTimeStamp",true,r).childWithLevels;x=Math.max.apply(Math,M.adhocLines.map(function(e){return e.mProperties._level}));O=Math.max.apply(Math,M.deltaLines.map(function(e){return e.mProperties._level}));if(x>=O){L=O*4+(x-O)*8+O*3+3}else{L=O*4+O*3}}else if(E.length>0&&r.getEnableAdhocLine()===true){M=g.calculateLevelForShapes(E,"timeStamp","endTimeStamp",true,r).childWithLevels;x=Math.max.apply(Math,M.adhocLines.map(function(e){return e.mProperties._level}));L=x*8}else if(y.length>0&&r.getEnableDeltaLine()===true){M=g.calculateLevelForShapes(y,"timeStamp","endTimeStamp",true,r).childWithLevels;O=Math.max.apply(Math,M.deltaLines.map(function(e){return e.mProperties._level}));L=O*4+(O+1)*3}if(this.iOverflowToolbarHeight&&!!h[0]&&r.getEnableChartOverflowToolbar()){r.getTable().setColumnHeaderHeight(this.getIHeaderMinheight()+L)}else if(this.iOverflowToolbarHeight&&(!h[0]||r.getEnableChartOverflowToolbar())){r.getTable().setColumnHeaderHeight(this.getIHeaderMinheight()+L+this.iOverflowToolbarHeight)}else{r.getTable().setColumnHeaderHeight(this.getIHeaderMinheight()+L)}I=(this._getIHeaderHeight()-L)/4;_=(this._getIHeaderHeight()-L)/5*2;S=(this._getIHeaderHeight()-L)/5*4}else{if(this.iOverflowToolbarHeight&&!!h[0]&&r.getEnableChartOverflowToolbar()){r.getTable().setColumnHeaderHeight(this.getIHeaderMinheight())}else if(this.iOverflowToolbarHeight&&(!h[0]||r.getEnableChartOverflowToolbar())){r.getTable().setColumnHeaderHeight(this.getIHeaderMinheight()+this.iOverflowToolbarHeight)}else{r.getTable().setColumnHeaderHeight(this.getIHeaderMinheight())}}var A=r.getAxisTimeStrategy(),C=A.getTimeLineOption(),G=r.getAxisTime();var N=G.getTickTimeIntervalLabel(C,null,[0,w]);var D=f.getResourceBundleFor("sap.gantt");t.openStart("svg",p+"-header-svg");t.class("sapGanttChartHeaderSvg");t.attr("height",this._getIHeaderHeight()+"px");t.attr("width",w);t.attr("aria-label",D.getText("ARIA_GANTT_HEADER"));t.attr("aria-hidden",true);if(this.iOverflowToolbarHeight&&r.getEnableChartOverflowToolbar()){t.style("transform","translate(0,"+this.iOverflowToolbarHeight+"px)")}t.openEnd();t.openStart("rect");t.attr("height","100%");t.attr("width","100%");t.attr("fill","transparent");t.openEnd();t.close("rect");t.openStart("g").openEnd();this.renderHeaderLabel(t,N[0],{y:_,className:"sapGanttTimeHeaderSvgText"});this.renderHeaderLabel(t,N[1],{y:S,className:"sapGanttTimeHeaderSvgTextMedium"});if(G.largeIntervalLabel&&!G.largeIntervalPath){for(var P=0;P<N[0].length;P++){if(N[0][P].value===G.firstTickPosition){N[0].splice(P,1);break}}}this.renderIntervalLine(t,N[0],{start:0,end:I,className:"sapGanttTimeHeaderLargeIntervalSvgPath"});this.renderIntervalLine(t,N[1],{start:S,end:this._getIHeaderHeight(),className:"sapGanttTimeHeaderSvgPath"});t.close("g");var R=n.get({name:"sapUiListVerticalBorderColor",callback:function(e){R=e}});if(r._bClonedGantt){var k=new l({x:0,y:this._getIHeaderHeight()-1,height:"1px",width:"100%",fill:R});k.renderElement(t,k)}if(r.getEnableAdhocLine()===true&&E.length>0||r.getEnableDeltaLine()===true&&y.length>0){t.openStart("svg","inner-header-svg");t.attr("aria-label",D.getText("ARIA_GANTT_INNER_HEADER"));t.openEnd();t.openStart("g","inner-header-g");t.style("height",L+"px");t.openEnd();var V=new l({x:0,y:this._getIHeaderHeight()-L,height:"1px",width:"100%",fill:R});var B=this;V.renderElement(t,V);var W=r.getRenderedTimeRange(),U=W[0],F=W[1];E=E.filter(function(e){var t=i.abapTimestampToDate(e.getTimeStamp());return t>=U&&t<=F&&e.getVisible()&&e.getMarkerType()===sap.gantt.simple.MarkerType.Diamond});if(E.length>0){E.forEach(function(e){o.renderMarker(t,e,r,B._getIHeaderHeight(),L)})}if(y.length!==0){y.forEach(function(e){s.renderDeltaLineHeader(t,e,r,B._getIHeaderHeight(),L)})}t.close("g");t.close("svg")}var j=G.getNowLabel(r.getNowLineInUTC())[0].value;this.renderNowLineHeader(t,r,{headerHeight:this._getIHeaderHeight(),nowLineX:j,iMarkerArea:L});t.openStart("g");t.class("sapGanttChartHeaderSelection");t.openEnd().close("g");t.close("svg");if(c&&c.length>0){t.flush(c.get(0))}t.destroy();d.attachEvents(r);performance.mark("GanttHeader.renderElement--end")};c.prototype.renderHeaderLabel=function(e,a,i){var n=p.getRTL();var l=t.browser.edge&&n;a.forEach(function(t){e.openStart("text");e.class(i.className);e.attr("text-anchor","start");e.attr("x",t.value+(n?-5:5));e.attr("y",i.y);if(l){var a=r.calculateStringLength(t.label)*(i.fontSize/2);e.attr("transform","translate("+-a+")")}e.openEnd();e.text(t.label);if(i.className==="sapGanttTimeHeaderSvgTextMedium"&&t.largeLabel){e.openStart("title").openEnd();e.text(t.largeLabel);e.close("title")}e.close("text")})};c.prototype.renderIntervalLine=function(e,t,a){var r="";for(var i=0;i<t.length;i++){var n=t[i];if(n){r+=" M"+" "+(n.value-1/2)+" "+a.start+" L"+" "+(n.value-1/2)+" "+a.end}}e.openStart("path");e.attr("d",r);e.class(a.className);e.openEnd();e.close("path")};c.prototype.renderNowLineHeader=function(e,t,a){var r=t.getSimpleAdhocLines();var i=t.getDeltaLines();var n=a.headerHeight;var l=a.iMarkerArea;var o=n;if(t.getEnableAdhocLine()===true&&r.length>0||t.getEnableDeltaLine()===true&&i.length>0){o=n-l}var g=o,s=a.nowLineX;if(t.getEnableNowLine()===false||isNaN(s)){return}var d=8;var p=d/2,f=Math.sqrt(d*d-p*p);var v=[[s,g],[s-p,g-f],[s+p,g-f],[s,g]].reduce(function(e,t,a){var r=t.join(",");return a===0?"M"+r:e+"L"+r},"");e.openStart("g");e.class("sapGanttNowLineHeaderSvgPath");e.openEnd();e.openStart("path");e.attr("d",v);e.openEnd();e.close("path");e.close("g");if(t.getEnableAdhocLine()===true&&r.length>0||t.getEnableDeltaLine()===true&&i.length>0){e.openStart("g");e.class("sapGanttNowLineBodySvgLine");e.openEnd();var c=new h({x1:s,y1:o,x2:s,y2:"100%",strokeWidth:1}).setProperty("childElement",true);c.renderElement(e,c);e.close("g")}};c.prototype.renderOverflowToolbar=function(e,t){var a=t.getId();if(!this._oOverflowToolbar){this.setAggregation("_overflowToolbar",new sap.m.OverflowToolbar(a+"-ganttHeaderOverflowToolbar",{design:"Solid"}).addStyleClass("sapGanttHeaderOverflowToolbar"));this.getAggregation("_overflowToolbar").addContent(new sap.m.ToolbarSpacer);this._oOverflowToolbar=true}var r=t.getOverflowToolbarItems();if(r.length>0){r.forEach(function(e){this.getAggregation("_overflowToolbar").addContent(e)}.bind(this))}this.getAggregation("_overflowToolbar").setWidth("100%");e.openStart("div",a+"-ganttHeaderOverflowToolbarContainer");e.style("width","100%");e.style("position","absolute");e.openEnd();e.renderControl(this.getAggregation("_overflowToolbar"));e.close("div")};c.prototype.exit=function(){if(this._oOverflowToolbar){this._oOverflowToolbar=false}};return c},true);
//# sourceMappingURL=GanttHeader.js.map