/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

		(c) Copyright 2009-2015 SAP SE. All rights reserved
	
 */
sap.ui.define(["sap/ui/thirdparty/jquery","sap/ui/core/Core","./UtilizationChart","sap/gantt/def/pattern/BackSlashPattern","sap/ui/core/Element","sap/ui/core/theming/Parameters"],function(jQuery,t,e,i,n,r){"use strict";var o=e.extend("sap.gantt.simple.UtilizationLineChart",{metadata:{library:"sap.gantt",properties:{showMiddleLine:{type:"boolean",defaultValue:true}},defaultAggregation:"dimensions",aggregations:{dimensions:{type:"sap.gantt.simple.UtilizationDimension",group:"Data"}},associations:{overConsumptionPattern:{type:"sap.gantt.def.DefBase",altTypes:["string"],multiple:false,group:"Appearance"}}},renderer:{apiVersion:2}});o.prototype.applySettings=function(t,i){t=t||{};e.prototype.applySettings.call(this,t,i);this._createDefaultDefs()};o.prototype.renderElement=function(t,e){if(this.getDimensions().length===0){this.renderEmptyDomRefs(t,true);return}this.renderEmptyDomRefs(t,false);var i=this.getX(),n=this.getHeight(),r=this.getRowYCenter()-n/2,o=this.getWidth();var a={x:i,y:r,width:o,height:n};this.renderDimensionClipPaths(t,a);this.renderDefaultDefs(t);this.renderULCBackground(t,a);this.renderMiddleLine(t,a);this.renderOverConsumptionBackground(t,a);this.renderOverConsumptionClipPath(t,a);this.renderDimensionPaths(t,a);this.renderTooltips(t,a);t.close("g")};o.prototype.renderEmptyDomRefs=function(t,e){t.openStart("g",this);t.class("sapGanttUtilizationLine");t.openEnd();if(e){t.close("g")}};o.prototype.renderDimensionClipPaths=function(t,e){var i=this.getDimensions();t.openStart("defs").openEnd();for(var n=0;n<i.length;n++){t.openStart("clipPath",i[n].getId()+"-clipPath");t.openEnd();this.renderDimensionPath(t,i[n],e.y,e.height);t.close("clipPath")}t.close("defs")};o.prototype.renderULCBackground=function(t,e){var i=jQuery.extend({id:this.getId()+"-ulcBg",fill:this.getFill()||"transparent",stroke:"none"},true,e);this.renderRectangleWithAttributes(t,i)};o.prototype.getClipPathIdOfDimension=function(t){return"url(#"+t.getId()+"-clipPath)"};o.prototype.renderOverConsumptionBackground=function(t,e){var i=jQuery.extend({id:this.getId()+"-ulcOverConsumptionBg",fill:this._getOverageFillPattern()},true,e);i.height=this.getThresholdHeight(e.height);this.renderRectangleWithAttributes(t,i)};o.prototype.renderOverConsumptionClipPath=function(t,e){var i=jQuery.extend({},true,e);i.height=this.getThresholdHeight(e.height);var n=this.getDimensions();for(var r=0;r<n.length;r++){var o=jQuery.extend({"clip-path":this.getClipPathIdOfDimension(n[r]),fill:this.getOverConsumptionColor()},true,i);this.renderRectangleWithAttributes(t,o)}};o.prototype._getOverageFillPattern=function(){var t=this.getOverConsumptionPattern();if(t){t=n.getElementById(t).getRefString()}else{t="url(#"+this.getId()+"-defaultPattern"+")"}return t};o.prototype.getThresholdHeight=function(t){return this.getOverConsumptionMargin()*t/(100+this.getOverConsumptionMargin())};o.prototype.renderMiddleLine=function(t,e){if(this.getShowMiddleLine()){var i=this.getMiddleLineY(e);t.openStart("path",this.getId()+"-middleLine");t.attr("d","M "+e.x+" "+i+" h "+e.width);t.class("sapGanttUtilizationMiddleLine");t.openEnd().close("path")}};o.prototype.getMiddleLineY=function(t){var e=this.getThresholdHeight(t.height);return t.y+e+(t.height-e)/2};o.prototype.renderDimensionPaths=function(t,e){var i=e.x,n=this.getThresholdHeight(e.height),r=e.y,o=e.width,a=e.height;var s=this.getDimensions();for(var h=0;h<s.length;h++){t.openStart("g").openEnd();var p=s[h];var l={id:p.getId()+"-ulcRect",x:i,y:r+n,width:o,height:a-n,fill:this.getRemainCapacityColor(),"fill-opacity":.5,"stroke-opacity":.5,"clip-path":this.getClipPathIdOfDimension(p)};this.renderRectangleWithAttributes(t,l);this.renderDimensionPath(t,p,r,a,"ulcPath");t.close("g")}};o.prototype.renderTooltips=function(t,e){var i=e.y,n=e.height;t.openStart("g");t.class("ulc-tooltips").openEnd();var r=this.getAllDimensionPoints();r.forEach(function(e,r,o){var a=o[r+1]||e;var s=e.tooltip;var h=e.name!==a.name;if(h){s=e.tooltip+"\n"+a.tooltip}var p=this.toX(e.from),l=o.length-1===r,g=this.toX(l?a.to:a.from),d=Math.abs(g-p);if(d>0){var u={opacity:0,fillOpacity:0,strokeOpacity:0};var f=jQuery.extend({x:p,y:i,width:d,height:n},u);this.renderRectangleWithAttributes(t,f,s)}}.bind(this));t.close("g")};o.prototype.getAllDimensionPoints=function(){var t=[];this.getDimensions().forEach(function(e){var i=e.getName();e.getPeriods().forEach(function(e,n,r){var o=e.getTooltip();if(!o){o=i+": "+e.getValue()}t.push({name:i,from:e.getFrom(),to:e.getTo(),tooltip:o})})});t.sort(function(t,e){return t.from-e.from});return t};o.prototype.renderDimensionPath=function(t,e,i,n,r){var o=e.getPeriods();var a="";for(var s=0;s<o.length;s++){var h=s===0,p=s===o.length-1;var l=o[s];var g=this.toX(l.getFrom());var d=this.toX(l.getTo());var u=l.getValue();var f=this.getOverConsumptionMargin();if(u>100+f){u=100+f}var c=i+n;var m=n*(u/(100+f));var v=c-m;a+=(h?" M "+g+" "+c:"")+" L "+g+" "+v+" L "+d+" "+v+(p?" L "+d+" "+c:"")}if(r){t.openStart("path",e.getId()+"-"+r)}else{t.openStart("path")}t.attr("d",a);t.attr("fill","none");t.attr("stroke-width",2);t.attr("stroke",e.getDimensionColor());t.class("sapGanttUlcDimensionPath");t.openEnd().close("path")};o.prototype._createDefaultDefs=function(){if(this.getOverConsumptionPattern()){return}var t=r.get({name:["sapChart_ContrastLineColor","sapContent_ForegroundColor"],callback:function(e){t=e}});this.mDefaultDefs=new sap.gantt.def.SvgDefs({defs:[new i({id:this.getId()+"-defaultPattern",tileWidth:5,tileHeight:9,backgroundColor:t.sapChart_ContrastLineColor,stroke:t.sapContent_ForegroundColor,strokeWidth:1})]})};o.prototype.renderDefaultDefs=function(t){if(this.mDefaultDefs){t.unsafeHtml(this.mDefaultDefs.getDefString())}};o.prototype.destroy=function(){e.prototype.destroy.apply(this,arguments);if(this.mDefaultDefs){this.mDefaultDefs.destroy()}};return o},true);
//# sourceMappingURL=UtilizationLineChart.js.map