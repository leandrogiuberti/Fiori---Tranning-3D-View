/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

		(c) Copyright 2009-2015 SAP SE. All rights reserved
	
 */
sap.ui.define(["sap/ui/thirdparty/jquery","sap/base/Log","sap/ui/events/KeyCodes","./GanttExtension","sap/gantt/library","./CoordinateUtils","./GanttUtils","sap/ui/core/theming/Parameters","sap/ui/Device","sap/gantt/misc/Utility","sap/gantt/misc/Format","sap/gantt/utils/GanttChartConfigurationUtils","sap/ui/core/Element"],function(jQuery,e,t,i,r,n,a,s,o,h,g,l,p){"use strict";var d=r.ValueSVGPaintServer.isValid;var c=i.extend("sap.gantt.simple.GanttResizeExtension",{_init:function(e,t){this._initResizeStatus();return"ResizeExtension"}});var m=".sapGanttResizing";var u={color:"sapUiBaseText",strokeWidth:1,strokeDasharray:"5, 1",fillOpacity:0,shapeColor:null};var f={color:"sapUiBaseText",strokeWidth:2,strokeDasharray:"5, 1",fillOpacity:0,shapeColor:null};var v={None:0,LeftResize:1,RightResize:2};var S=function(e,t){return parseFloat(e.attr(t),10)};c.prototype.getSelectionSettings=function(){if(!this.mSelectionSettings){return this.updatemSelectionSettings()||this.mSelectionSettings}return this.mSelectionSettings};c.prototype.updatemSelectionSettings=function(){var e=this.getGantt().getShapeSelectionSettings();if(jQuery.isEmptyObject(e)){return u}var t=jQuery.extend(true,{},u);for(var i in t){if(e[i]){t[i]=e[i]}}if(!t.shapeColor){t.fillOpacity=0}else if(t.fillOpacity===0){t.fillOpacity=.4}this.mSelectionSettings=t};c.prototype.getSelectionInlineStyle=function(t){var i=this.getSelectionSettings();var r=i.shapeColor;var n=i.color;if(r){r=r.substr(0,1)==="@"?r.substring(1):r}if(n){n=n.substr(0,1)==="@"?n.substring(1):n}var a=d(r),o=d(n);this._bShapeSelectedFill=false;this._getShapeSelectedFill(t);var h={"fill-opacity":this._bShapeSelectedFill?0:i.fillOpacity,"stroke-width":this._bShapeSelectedFill?0:i.strokeWidth,"stroke-dasharray":i.strokeDasharray};if(a){h.fill=s.get({name:r,callback:function(e){h.fill=e}})||r}else{e.warning("shapeColor provided in the shapeSelectionSettings is not valid, provide a valid shapeColor")}if(o){h.stroke=s.get({name:n,callback:function(e){h.stroke=e}})||n}else{e.warning("Color provided in the shapeSelectionSettings is not valid, provide a valid color")}return Object.keys(h).reduce(function(e,t){e+=t+":"+h[t]+";";return e},"")};c.prototype.getHighlightSettings=function(){if(!this.mHighlightSettings){return this.updatemHighlightSettings()||this.mHighlightSettings}return this.mHighlightSettings};c.prototype.updatemHighlightSettings=function(){var e=this.getGantt().getShapeHighlightSettings();if(e===null){return f}var t=Object.assign({},f);for(var i in t){if(e[i]){t[i]=e[i]}}if(!t.shapeColor){t.fillOpacity=0}else if(t.fillOpacity===0){t.fillOpacity=.4}this.mHighlightSettings=t};c.prototype.initDomSelector=function(){this.mDoms={}};c.prototype.updateDomSelector=function(e){if(e){this.origin.shapeUid=jQuery(e.target).parents("g").attr(a.SELECT_FOR_DATASET_KEY)}var t="g["+a.SELECT_FOR_DATASET_KEY+'="'+this.origin.shapeUid+'"]';var i={leftLine:t+" .leftLine",rightLine:t+" .rightLine",topLine:t+" .topLine",bottomLine:t+" .bottomLine",leftLineTrigger:t+" line.leftTrigger",rightLineTrigger:t+" line.rightTrigger",leftRectTrigger:t+" rect.leftTrigger",rightRectTrigger:t+" rect.rightTrigger",resizeRectCover:t+" rect.resizeCover"};for(var r in i){if(i.hasOwnProperty(r)){this.mDoms[r]=jQuery(i[r])}}};c.prototype.getSvgElement=function(){var t=jQuery(document.getElementById(this.getGantt().getId()));if(t.length===0){e.warning("can not find gantt chart, use gantt chart instance sId as the key is required")}return t.find("svg.sapGanttChartSvg").get(0)};c.prototype.getHeaderSvgElement=function(){var t=jQuery(document.getElementById(this.getGantt().getId()));if(t.length===0){e.warning("can not find gantt chart, use gantt chart instance sId as the key is required")}return t.find("svg.sapGanttChartHeaderSvg").get(0)};c.prototype._getShapeSelectionRootNode=function(){var e=this.getSvgElement(),t=jQuery(e).find("g.sapGanttChartSelection");return d3.select(t.get(0))};c.prototype._getDeltaMarkerSelectionRootNode=function(){var e=this.getHeaderSvgElement(),t=jQuery(e).find("g.sapGanttChartHeaderSelection");return d3.select(t.get(0))};c.prototype._getShapeHighlightRootNode=function(){var e=this.getSvgElement();if(e){var t=e.querySelectorAll(".sapGanttChartHighlight");return d3.select(t[0])}};c.prototype.toggleOutline=function(e){if(!e.getSelected()){this.removeOutline(e);return}this.setFrame(this._getDomRef(e).getBBox());var t=e.getConnectable(),i=e.getResizable(),r=e.getSelectable();if(r){if(t||i){this.renderResizerOutline(e)}else{this.renderPlainOutline(e)}}};c.prototype.toggleHighlight=function(e){if(!e.getHighlighted()){this.removeHighlight(e);return}this.setFrame(e.getDomRef().getBBox());var t=this.getHighlightOutLines(e);var i=this.createHighlightContainer(e);this.renderHighlightBorders(t,i);this.renderResizeTriggerAndCover(t,i,false,e)};c.prototype.addDeltaLineResizer=function(e){this.setFrame(e.getDomRef().getBBox());this.clearAllDeltaOutline();var t=this.getOutlineLines(e);var i=this.createResizeContainer(e,true);this.renderSelectionBorders(t,i);this.renderResizeTriggerAndCover(t,i,false,e);this.attachHeaderMouseEvent()};c.prototype.addResizerOnMouseOver=function(e){this.setFrame(this._getDomRef(e).getBBox());var t=e.getResizable();if(t){this.renderResizerOutlineOnMouseOver(e)}};c.prototype.clearAllOutline=function(e){this._getShapeSelectionRootNode().selectAll("*").remove()};c.prototype.clearAllDeltaOutline=function(){this._getDeltaMarkerSelectionRootNode().selectAll("*").remove()};c.prototype.clearAllHighlight=function(){if(this._getShapeHighlightRootNode()){this._getShapeHighlightRootNode().selectAll("*").remove()}};c.prototype.renderPlainOutline=function(e){var t=this._getDomRef(e);if(t){var i=!!e.getRlsAnchors;var r=h.getShapeBias(e);var n=i?e.getD():this.determineOutlineByFrame(e,r);var s=null;if(i&&e.getEnableCurvedEdge()){s=a.getPathCorners(e.getD(),5)}var o=this._getShapeSelectionRootNode();var g=i?this.createOutlineRlsNode(e,n,s):this.createOutlinePathNode(e,n);o.node().appendChild(g)}};c.prototype.createOutlineRlsNode=function(e,t,i){var r=document.createElementNS(d3.ns.prefix.svg,"g");var n=document.createElementNS(d3.ns.prefix.svg,"path");var a=document.createElementNS(d3.ns.prefix.svg,"path");var s=document.createElementNS(d3.ns.prefix.svg,"path");r.setAttribute("id",e.getShapeUid()+"-selected");r.setAttribute("aria-hidden","false");r.setAttribute("class","resizeContainer sapGanttSelectedPath");r.style=e.getSelectedStyle();if(!i){a.setAttribute("d",t)}else{a.setAttribute("fill","none");a.setAttribute("d",i)}r.appendChild(a);n.setAttribute("stroke-width",1);n.setAttribute("fill",e.getSelectedStartShapeColor());n.setAttribute("stroke-dasharray","none");n.setAttribute("d",e.getConnectorStartPath(t,e.getGanttChartBase().getId(),e.getProcessedType()));s.setAttribute("stroke-width",1);s.setAttribute("fill",e.getSelectedEndShapeColor());s.setAttribute("stroke-dasharray","none");s.setAttribute("d",e.getConnectorEndPath(t,e.getGanttChartBase().getId(),e.getProcessedType()));r.appendChild(n);r.appendChild(s);return r};c.prototype.createOutlinePathNode=function(e,t){var i=document.createElementNS(d3.ns.prefix.svg,"path");i.setAttribute("id",e.getShapeUid()+"-selected");i.setAttribute("aria-hidden","false");i.setAttribute("class","resizeContainer sapGanttSelectedPath");var r=e.getSelectedStyle?e.getSelectedStyle():this.getSelectionInlineStyle(e);i.style=r;i.setAttribute("d",t);return i};c.prototype.determineOutlineByFrame=function(e,t){var i=this._getDomRef(e).getBBox(),r=false;if(e instanceof sap.gantt.simple.BaseGroup){var n=0,a;a=window.getComputedStyle(e.getDomRef()).transform.match(/matrix.*\((.+)\)/);if(a){n=a[1].split(",")[5];r=true}}var s=i.x,o=r?i.y+parseFloat(n):i.y,h=i.width,g=i.height,l=s+h,p=o+g;var d=this.getSelectionSettings().strokeWidth,c=d/2;s=s-c+t.x;o=r?o-c:o-c+t.y;l=l+c+t.x;p=r?p+c:p+c+t.y;var m=["M",s,o,"L",l,o,"L",l,p,"L",s,p,"z"].join(" ").trim();return m};c.prototype.removeOutline=function(e){var t=document.getElementById(e.getShapeUid()+"-selected");if(t){jQuery(t).remove()}};c.prototype.removeHighlight=function(e){var t=document.getElementById(e.getShapeUid()+"-highlighted");if(t){t.childNodes.forEach(function(e){e.remove()})}};c.prototype.removeDeltaOutline=function(e){var t=document.getElementById(e.getId()+"-selected");if(t){jQuery(t).remove()}};c.prototype.renderResizerOutline=function(e){this.removeOutline(e);var t=e.getConnectable(),i=e.getResizable();var r=this.getOutlineLines(e,true);var n=this.createResizeContainer(e);this.renderSelectionBorders(r,n);if(i){this.renderResizeTriggerAndCover(r,n,false,e,true);this.attachMousedownEvent()}if(t){this.renderShapeConnectTrigger(e,n);this.getGantt()._getConnectExtension().attachShapeConnectEvents()}if(this.isResizing()){this.updateDomSelector();this.updateOriginShapeFrame();this.attachResizeEvents()}};c.prototype.renderResizerOutlineOnMouseOver=function(e){this.removeOutline(e);var t=this.getOutlineLines(e,true);var i=this.createResizeContainer(e);this.renderSelectionBorders(t,i,true);this.renderResizeTriggerAndCover(t,i,true,false,true);this.attachMousedownEvent();if(this.isResizing()){this.updateDomSelector();this.updateOriginShapeFrame();this.attachResizeEvents()}};c.prototype.showShapeConnectTrigger=function(e){var t=this.getGantt()._getConnectExtension();var i=t.getRlsStartShape().shapeUid;return t.isShapeConnecting()?i===e.getShapeUid():true};c.prototype.renderSelectionBorders=function(e,t,i){t.selectAll(".border").data(e.border).enter().append("line").each(function(e){if(i){e.stroke="transparent"}d3.select(this).attr(e)}).attr("class",function(e){return"border "+e.class+"Line"})};c.prototype.renderResizeTriggerAndCover=function(e,t,i,r,n){t.selectAll(".lineTrigger").data(e.indicator).enter().append("line").each(function(e){d3.select(this).attr(e)}).attr("class",function(e){return"resizeTrigger lineTrigger "+e.class+"Trigger"}).attr({opacity:0,"stroke-width":3}).style({cursor:"ew-resize"});if(!i){var a=this.getResizeRectCoverAttrs(r,n);t.append("rect").attr(a).style({"pointer-events":"none"})}};c.prototype.renderHighlightBorders=function(e,t){t.selectAll(".border").data(e.border).enter().append("line").each(function(e){d3.select(this).attr(e)}).attr("class",function(e){return"border "+e.class+"Line"})};c.prototype.createResizeContainer=function(e,t){var i=t?this._getDeltaMarkerSelectionRootNode():this._getShapeSelectionRootNode();var r=t?e.getId():e.getShapeUid();var n=i.append("g").classed("resizeContainer",true).attr("id",r+"-selected").attr(a.SELECT_FOR_DATASET_KEY,r);return n};c.prototype.createHighlightContainer=function(e){var t=this._getShapeHighlightRootNode();var i=e.getShapeUid();var r=t.append("g").classed("highlightContainer",true).attr("id",i+"-highlighted").attr(a.SELECT_FOR_DATASET_KEY,i);return r};c.prototype.renderShapeConnectTrigger=function(e,t){var i=this.showShapeConnectTrigger(e);var r=this.getConnectSquaresData(i,e);var n=s.get({name:"sapChart_Data_InteractiveColor",callback:function(e){n=e}});t.selectAll(".rectTrigger").data(r.slice()).enter().append("rect").each(function(e){d3.select(this).attr(e)}).attr("class",function(e){return"shapeConnectTrigger rectTrigger "+e.class+"Trigger"}).attr({stroke:n,"stroke-width":1})};c.prototype.attachMousedownEvent=function(){var e=jQuery(document.getElementById(this.getGantt().getId()+"-svg"));var t=e.find(".resizeTrigger");t.off(m);t.on("mousedown"+m,this.beforeResizing.bind(this))};c.prototype.attachHeaderMouseEvent=function(){var e=jQuery(document.getElementById(this.getGantt().getId()+"-header-svg"));var t=e.find(".resizeTrigger");t.off(m);t.on("mousedown"+m,this.beforeDeltaResizing.bind(this))};c.prototype.attachResizeEvents=function(){this._removeDragEvents();var e=jQuery(document);e.on("mousemove"+m,this.onResizing.bind(this));e.on("mouseup"+m,this.endResizing.bind(this));e.on("keydown"+m,this.onKeydown.bind(this))};c.prototype.attachDeltaResizeEvents=function(){this._removeDragEvents();var e=jQuery(document);e.on("mousemove"+m,this.onDeltaResizing.bind(this));e.on("mouseup"+m,this.onDeltaResize.bind(this));e.on("keydown"+m,this.onKeydown.bind(this))};c.prototype._removeDragEvents=function(){var e=jQuery(document);e.off(m)};c.prototype.beforeResizing=function(e){var t=jQuery(e.target),i=t.parents("g").attr(a.SELECT_FOR_DATASET_KEY);var r=this._getShapeByUid(i);if(!r||e.button!==0){return}this.setFrame(this._getDomRef(r).getBBox());this.updateDomSelector(e);this.origin.eventTarget=e.target;this.updateOriginShapeFrame();this.origin.resizeFor=i;if(t.hasClass("leftTrigger")){this.currentAction=v.LeftResize}else{this.currentAction=v.RightResize}this._updateResizingEffect(true);this.attachResizeEvents()};c.prototype.beforeDeltaResizing=function(e){var t=jQuery(e.target),i=t.parents("g").attr(a.SELECT_FOR_DATASET_KEY);var r=p.getElementById(i);if(!r||e.button!==0){return}var s=n.getEventSVGPoint(this.getDomRefs().headerSvg,e),o=e.target.getBBox();this.mResizePoint={cursorX:s.x,cursorY:s.y,shapeX:o.x,shapeY:o.y,shapeWidth:o.width};this.setFrame(r.getDomRef().getBBox());this.updateDomSelector(e);this.origin.eventTarget=e.target;this.updateOriginShapeFrame();this.origin.resizeFor=i;if(t.hasClass("leftTrigger")){this.currentAction=v.LeftResize}else{this.currentAction=v.RightResize}this._updateResizingEffect(true);this.attachDeltaResizeEvents();this.deltaResize=true};c.prototype.updateOriginShapeFrame=function(){var e=this.getFrame();this.origin.minX=e.x;this.origin.maxX=e.x+e.width};c.prototype.onResizing=function(e){if(this._shallSkip(e)){return}this._updateResizingEffect(true);var t=this.getSvgElement();var i=n.getEventSVGPoint(t,e).x;var r=this.getGantt()._getPointerExtension();i=i+r._getAutoScrollStep();if(this.currentAction===v.RightResize){this._updateRightPartDoms(i)}else if(this.currentAction===v.LeftResize){this._updateLeftPartDoms(i)}};c.prototype.onDeltaResizing=function(e){if(this._shallSkip(e)){return}this._updateResizingEffect(true);var t=this.getHeaderSvgElement();var i=n.getEventSVGPoint(t,e).x;var r=this.getGantt()._getPointerExtension();i=i+r._getAutoScrollStep();if(this.currentAction===v.RightResize){this._updateRightPartDoms(i,e)}else if(this.currentAction===v.LeftResize){this._updateLeftPartDoms(i,e)}if(e){if(!this.deltaResizeStart){this.$ghost=this.createResizeGhost(i,this.currentAction);this.deltaResizeStart=true}else if(this._isValidResize(i)){this.showGhost(e)}}};c.prototype._isValidResize=function(e){if(this.currentAction===v.LeftResize){return!(e>this.mElementFrame.x+this.mElementFrame.width)}else if(this.currentAction===v.RightResize){return!(e<this.mElementFrame.x)}};c.prototype._updateResizingEffect=function(e){var t=e?.4:0;this.mDoms.resizeRectCover.attr("opacity",t)};c.prototype.isResizing=function(){return this.currentAction===v.LeftResize||this.currentAction===v.RightResize};c.prototype.removeGhost=function(){this.$ghost=null;jQuery(document.getElementById("sapGanttDragGhostWrapper")).remove()};c.prototype._updateRightPartDoms=function(e,t){var i=function(e){if(e-this.origin.minX<=2*this.getMargin()){return this.origin.minX+2*this.getMargin()}return e}.bind(this);var r=i(e);this.mDoms.rightLine.attr({x1:r,x2:r});this.mDoms.rightLineTrigger.attr({x1:r,x2:r});this.mDoms.topLine.attr({x2:r});this.mDoms.bottomLine.attr({x2:r});this.mDoms.rightRectTrigger.attr({x:r+a.SHAPE_CONNECT_INDICATOR_WIDTH/2-2});var n=r-this.origin.minX;this.mDoms.resizeRectCover.attr({width:n})};c.prototype.showGhost=function(e){var t=this.calcGhostAligmentForLines(e);var i=a.getTimeLabel(e,this.getGantt().getAxisTime(),this.getGantt().getLocale(),this.getDomRefs().headerSvg);document.getElementById("sapGanttDragText").innerText=i;jQuery(document.getElementById("sapGanttDragGhostWrapper")).css(t).css({visibility:"visible"})};c.prototype.calcGhostAligmentForLines=function(e){var t=n.xPosOfEvent(e);var i=n.getSvgScreenPoint(this.getDomRefs().headerSvg,{pageX:this.mResizePoint.cursorX,clientX:this.mResizePoint.cursorX,pageY:this.mResizePoint.cursorY,clientY:this.mResizePoint.cursorY});return{left:t+"px",top:i.y+"px"}};c.prototype.createResizeGhost=function(e,t){var i=jQuery("<div id='sapGanttDragGhostWrapper'></div>");jQuery(document.body).append(i);var r=document.createElement("canvas");var n=this.origin.eventTarget.getBBox();r.width=1;r.height=n.height;var s=jQuery(this.origin.eventTarget),o=s.parents("g").attr(a.SELECT_FOR_DATASET_KEY);var h=p.getElementById(o);var g=h.getParent(),l={};if(g.getVisibleDeltaStartEndLines()){var d=g._getStartLine();var c=g._getEndLine();var m=g._getHeaderStartLine();var u=g._getHeaderEndLine();var f=document.getElementById(d.sId);var v=document.getElementById(c.sId);var S=document.getElementById(m.sId);var y=document.getElementById(u.sId);l={headerStartLine:S,startLine:f,headerEndLine:y,endLine:v};var T=S.getBBox();var E=f.getBBox();r.height+=E.height+T.height}this.createGhostImage(this.origin.eventTarget,r,l);return i};c.prototype.createGhostImage=function(e,t,i){var r=this.serializeClonedSvg(t,e,i);var n=this._b64EncodeUnicode(r);var a="data:image/svg+xml;base64,"+n;this.appendGhostImageToWrapper(e,a)};c.prototype._b64EncodeUnicode=function(e){return btoa(encodeURIComponent(e).replace(/%([0-9A-F]{2})/g,function e(t,i){return String.fromCharCode("0x"+i)}))};c.prototype.serializeClonedSvg=function(e,t,i){var r=d3.ns.prefix.svg;var n=document.createElementNS(r,"svg");n.setAttribute("width",e.width);n.setAttribute("height",e.height);var a=document.createElementNS(r,"g");var s=p.getElementById(this.origin.shapeUid).getParent();if(s.getVisibleDeltaStartEndLines()){var o=i.headerEndLine.getBBox();a.setAttribute("transform","translate("+-o.x+", "+-o.y+")");var h=i.headerEndLine.cloneNode(true);a.appendChild(h);var g=i.endLine.cloneNode(true);a.appendChild(g)}var l=this.getGantt().getSvgDefs();if(l){var d=jQuery(document.getElementById(l.getId())).get(0).cloneNode(true);n.appendChild(d)}n.appendChild(a);return(new XMLSerializer).serializeToString(n)};c.prototype.appendGhostImageToWrapper=function(e,t){var i=jQuery(document.getElementById("sapGanttDragGhostWrapper"));jQuery("<div class='sapGanttDragGhost'>"+"<img class='sapGanttDragGhostImg' src='"+t+"'>"+"<div id='sapGanttDragText' class='sapGanttDragTextOverlay'></div>"+"</div>").appendTo(i)};c.prototype._updateLeftPartDoms=function(e){var t=function(e){var t=this.origin.maxX;var i=2*this.getMargin();if(t-e<=i){return t-i}return e}.bind(this);var i=t(e);this.mDoms.leftLine.attr({x1:i,x2:i});this.mDoms.leftLineTrigger.attr({x1:i,x2:i});this.mDoms.topLine.attr({x1:i});this.mDoms.bottomLine.attr({x1:i});this.mDoms.leftRectTrigger.attr({x:i-this.getMargin()-a.SHAPE_CONNECT_INDICATOR_WIDTH-2});var r=Math.abs(i-S(this.mDoms.rightLineTrigger,"x1"))-2;this.mDoms.resizeRectCover.attr({x:i+this.getMargin(),width:r<0?0:r})};c.prototype.onKeydown=function(e){if(e.keyCode===t.ESCAPE){if(this.isResizing()){this._updateLeftPartDoms(this.origin.minX-this.getMargin());this._updateRightPartDoms(this.origin.maxX+this.getMargin());this._updateResizingEffect(false);this._initResizeStatus()}this._removeDragEvents()}};c.prototype.endResizing=function(e){this._removeDragEvents();if(this._shallSkip(e)){return}var t=S(this.mDoms.leftLine,"x1")+this.getMargin(),i=S(this.mDoms.rightLine,"x1")-this.getMargin();var r=this._getShapeByUid(this.origin.resizeFor),n=this.getGantt();if(r){this.renderResizerOutline(r);this._fireShapeResizeEvent(n,r,t,i);if(n.getEnablePseudoShapes()){var s=h.parseUid(this.origin.resizeFor).rowIndex;n.pseudoShapeSpecificData=n.pseudoShapeSpecificData?n.pseudoShapeSpecificData:{};n.pseudoShapeSpecificData.resizedShape=r;n.pseudoShapeSpecificData.resizedShapeRowIndex=s;n.pseudoShapeSpecificData.needUpdateForTasksInAggr=true}a.rerenderAssociatedRelationships(n,r)}this._initResizeStatus()};c.prototype.onDeltaResize=function(e){var t=jQuery(this.origin.eventTarget),i=t.parents("g").attr(a.SELECT_FOR_DATASET_KEY);var r=p.getElementById(i);var n=r.getParent();var s=this._getDeltaResizeEventData(e);if(s){n.fireDeltalineResize(s)}this.removeGhost();this._initResizeStatus();this._removeDragEvents()};c.prototype._getDeltaResizeEventData=function(e){var t=l.getRTL();var i=jQuery(this.origin.eventTarget),r=i.parents("g").attr(a.SELECT_FOR_DATASET_KEY);var s=p.getElementById(r);var o=s.getParent();var h=n.getEventSVGPoint(this.getDomRefs().headerSvg,e);var d=this.getGantt();var c=d.getAxisTime();var m=g.dateToAbapTimestamp(c.viewToTime(h.x));if(t){if(this.currentAction===v.LeftResize){if(h.x>this.mElementFrame.x+this.mElementFrame.width){m=g.dateToAbapTimestamp(c.viewToTime(this.mElementFrame.x+this.mElementFrame.width))}return{newTimeStamp:o.getTimeStamp(),newEndTimeStamp:m,oldTimeStamp:o.getTimeStamp(),oldEndTimeStamp:o.getEndTimeStamp()}}else{if(h.x<this.mElementFrame.x){m=g.dateToAbapTimestamp(c.viewToTime(this.mElementFrame.x))}return{newTimeStamp:m,newEndTimeStamp:o.getEndTimeStamp(),oldTimeStamp:o.getTimeStamp(),oldEndTimeStamp:o.getEndTimeStamp()}}}else if(this.currentAction===v.LeftResize){if(h.x>this.mElementFrame.x+this.mElementFrame.width){m=g.dateToAbapTimestamp(c.viewToTime(this.mElementFrame.x+this.mElementFrame.width))}return{newTimeStamp:m,newEndTimeStamp:o.getEndTimeStamp(),oldTimeStamp:o.getTimeStamp(),oldEndTimeStamp:o.getEndTimeStamp()}}else if(this.currentAction===v.RightResize){if(h.x<this.mElementFrame.x){m=g.dateToAbapTimestamp(c.viewToTime(this.mElementFrame.x))}return{newTimeStamp:o.getTimeStamp(),newEndTimeStamp:m,oldTimeStamp:o.getTimeStamp(),oldEndTimeStamp:o.getEndTimeStamp()}}};c.prototype._getShapeByUid=function(e){var t=a.getShapesWithUid(this.getGantt().getId(),[e]);if(t.length>0){return t[0]}};c.prototype._fireShapeResizeEvent=function(e,t,i,r){var n,a;if(l.getRTL()){n=r===this.origin.maxX?t.getTime():e.getAxisTime().viewToTime(r);a=i===this.origin.minX?t.getEndTime():e.getAxisTime().viewToTime(i)}else{n=i===this.origin.minX?t.getTime():e.getAxisTime().viewToTime(i);a=r===this.origin.maxX?t.getEndTime():e.getAxisTime().viewToTime(r)}e.fireShapeResize({shape:t,shapeUid:t.getShapeUid(),rowObject:t.getParent(),oldTime:[t.getTime(),t.getEndTime()],newTime:[n,a]})};c.prototype._initResizeStatus=function(){this.currentAction=v.None;this.origin={minX:-1,maxX:-1,eventTarget:null,resizeFor:null};this.mElementFrame=null;this.iOutlineMargin=0;this.initDomSelector();this.deltaResize=false;this.deltaResizeStart=false;this.$ghost=null;this.mResizePoint={}};c.prototype.setFrame=function(e){this.mElementFrame=e};c.prototype.getFrame=function(){return this.mElementFrame};c.prototype.setMargin=function(e){this.iOutlineMargin=e};c.prototype.getMargin=function(){return this.iOutlineMargin};c.prototype._shallSkip=function(e){if(!this.isResizing()){return true}if(this.origin.eventTarget&&!jQuery(this.origin.eventTarget).hasClass("resizeTrigger")){return true}return false};c.prototype.getConnectSquaresData=function(e,t){var i=this.getFrame(),r=i.x,n=i.y,o=i.width,g=i.height,l=this.getMargin(),p=false;if(t instanceof sap.gantt.simple.BaseGroup){var d=0,c;c=window.getComputedStyle(t.getDomRef()).transform.match(/matrix.*\((.+)\)/);if(c){d=c[1].split(",")[5];p=true}n=i.y+parseFloat(d)}var m=e?a.SHAPE_CONNECT_INDICATOR_WIDTH:0;var u=s.get({name:"sapChart_Data_InteractiveColor",callback:function(e){u=e}});var f={width:m,height:m,stroke:u,"stroke-width":1};var v=h.getShapeBias(t);var S=t.getLeftAnchorPosition()/100;var y=t.getRightAnchorPosition()/100;var T=r-l-m-2+v.x,E=p?n+g*S-m/2:n+g*S-m/2+v.y;var R=r+o+l+2+v.x,x=p?n+g*y-m/2:n+g*y-m/2+v.y;return[jQuery.extend({x:T,y:E,class:"left"},f),jQuery.extend({x:R,y:x,class:"right"},f)]};c.prototype._getShapeSelectedFill=function(e){if(e.isA("sap.gantt.simple.BaseConditionalShape")){e=e._getActiveShapeElement()}if(e&&(e.getSelectedFill()||e.getSelectedTitleColor())){this._bShapeSelectedFill=true}else if(e instanceof sap.gantt.simple.BaseGroup){if(this.getGantt().getSelectOnlyGraphicalShape()){e._eachChildOfGroup(e,function(e,t){t&&t.forEach(function(e){if(!this._bShapeSelectedFill){this._getShapeSelectedFill(e)}}.bind(this))}.bind(this))}else{e._eachChildOfGroup(e,function(e){if(!this._bShapeSelectedFill){this._getShapeSelectedFill(e)}}.bind(this))}}};c.prototype.getResizeRectCoverAttrs=function(t,i){var r=this.getFrame(),n=this.getMargin(),a=t.getHighlightable()?this.getHighlightSettings():this.getSelectionSettings(),o=a.strokeWidth,h=false;var g=a.shapeColor;if(g){g=g.substr(0,1)==="@"?g.substring(1):g}var l=d(g);this._bShapeSelectedFill=false;var p=i&&(this._getShapeSelectedFill(t)||this._bShapeSelectedFill);var c={stroke:"none","stroke-width":0,class:"resizeCover",opacity:p?0:a.fillOpacity};if(p){c.fill=null}else if(l){c.fill=s.get({name:g,callback:function(e){c.fill=e}})||g}else{e.warning("shapeColor provided in "+(t.getHighlightable()?"shapeHighlightSettings":"shapeSelectionSettings")+" is not valid, provide a valid shapeColor")}if(t instanceof sap.gantt.simple.BaseGroup){var m,u=0;m=window.getComputedStyle(t.getDomRef()).transform.match(/matrix.*\((.+)\)/);if(m){u=m[1].split(",")[5];h=true}}var f=2*n-2*o;return jQuery.extend({x:r.x-n+o,y:h?r.y-n+o+parseFloat(u):r.y-n+o,width:r.width+f,height:r.height+f},c)};c.prototype.getOutlineLines=function(t,i){var r=this.getFrame(),n=r.x,a=r.y,o=r.width,g=r.height,l=this.getMargin(),p=false;if(t instanceof sap.gantt.simple.BaseGroup){var c,m=0;c=window.getComputedStyle(t.getDomRef()).transform.match(/matrix.*\((.+)\)/);if(c){m=c[1].split(",")[5];p=true}a=r.y+parseFloat(m)}var u=this.getSelectionSettings();var f=u.shapeColor;var v=u.color;if(f){f=f.substr(0,1)==="@"?f.substring(1):f}if(v){v=v.substr(0,1)==="@"?v.substring(1):v}var S=d(f),y=d(v);this._bShapeSelectedFill=false;var T=i&&(this._getShapeSelectedFill(t)||this._bShapeSelectedFill);var E={"stroke-dasharray":u.strokeDasharray,"fill-opacity":u.fillOpacity,"stroke-width":T?0:u.strokeWidth};if(S){E.fill=s.get({name:f,callback:function(e){E.fill=e}})||f}else{e.warning("shapeColor provided in the shapeSelectionSettings is not valid, provide a valid shapeColor")}if(y){E.stroke=s.get({name:v,callback:function(e){E.stroke=e}})||v}else{e.warning("Color provided in the shapeSelectionSettings is not valid, provide a valid color")}var R=h.getShapeBias(t);var x={minX:n-l+R.x,minY:p?a-l:a-l+R.y,maxX:n+o+l+R.x,maxY:p?a+g+l:a+g+l+R.y};var _={top:{x1:x.minX,y1:x.minY,x2:x.maxX,y2:x.minY},right:{x1:x.maxX,y1:x.minY,x2:x.maxX,y2:x.maxY},bottom:{x1:x.minX,y1:x.maxY,x2:x.maxX,y2:x.maxY},left:{x1:x.minX,y1:x.minY,x2:x.minX,y2:x.maxY}};var b=["top","right","bottom","left"];var D=b.map(function(e){return jQuery.extend(_[e],{class:e},E)});var z=jQuery.extend(true,_);var C=["left","right"].map(function(e){return jQuery.extend(z[e],{class:e},E)});return{border:D,indicator:C}};c.prototype.getHighlightOutLines=function(t){var i=this.getFrame(),r=i.x,n=i.y,a=i.width,o=i.height;var g=this.getMargin();var l=this.getHighlightSettings();var p=l.shapeColor;var c=l.color;if(p){p=p.substr(0,1)==="@"?p.substring(1):p}if(c){c=c.substr(0,1)==="@"?c.substring(1):c}var m=d(p),u=d(c);var f={"stroke-dasharray":l.strokeDasharray,"fill-opacity":l.fillOpacity,"stroke-width":l.strokeWidth};if(m){f.fill=s.get({name:p,callback:function(e){f.fill=e}})||p}else{e.warning("shapeColor provided in the shapeHighlightSettings is not valid, provide a valid shapeColor")}if(u){f.stroke=s.get({name:c,callback:function(e){f.stroke=e}})||c}else{e.warning("Color provided in the shapeHighlightSettings is not valid, provide a valid color")}var v=h.getShapeBias(t);var S={minX:r-g+v.x,minY:n-g+v.y,maxX:r+a+g+v.x,maxY:n+o+g+v.y};var y={top:{x1:S.minX,y1:S.minY,x2:S.maxX,y2:S.minY},right:{x1:S.maxX,y1:S.minY,x2:S.maxX,y2:S.maxY},bottom:{x1:S.minX,y1:S.maxY,x2:S.maxX,y2:S.maxY},left:{x1:S.minX,y1:S.minY,x2:S.minX,y2:S.maxY}};var T=["top","right","bottom","left"];var E=T.map(function(e){return Object.assign(y[e],{class:e},f)});var R=Object.assign({},y);var x=["left","right"].map(function(e){return Object.assign(R[e],{class:e},f)});return{border:E,indicator:x}};c.prototype._getResizeTime=function(e){var t=S(this.mDoms.leftLine,"x1")+this.getMargin(),i=S(this.mDoms.rightLine,"x1")-this.getMargin();if(isNaN(t)||isNaN(i)){return null}var r=this.getGantt();var n=r.getAxisTime().viewToTime(t),a=r.getAxisTime().viewToTime(i),s;var o=l.getRTL();if(o){s=a;a=n;n=s}return{time:n,endTime:a}};c.prototype._getDomRef=function(e){return e.getDomRef("nonLabelGroup")?e.getDomRef("nonLabelGroup"):e.getDomRef()};return c});
//# sourceMappingURL=GanttResizeExtension.js.map