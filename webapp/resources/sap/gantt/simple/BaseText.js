/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

		(c) Copyright 2009-2015 SAP SE. All rights reserved
	
 */
sap.ui.define(["sap/ui/core/Core","./BaseShape","./GanttUtils","sap/ui/Device","sap/ui/core/theming/Parameters","../library","./RenderUtils","sap/gantt/utils/GanttChartConfigurationUtils"],function(t,e,i,r,a,s,n,o){"use strict";var l=s.simple.shapes.ShapeAlignment;var h=e.extend("sap.gantt.simple.BaseText",{metadata:{library:"sap.gantt",properties:{text:{type:"string"},x:{type:"float"},y:{type:"float"},fontSize:{type:"int",defaultValue:13},textAnchor:{type:"string",defaultValue:"start"},fontFamily:{type:"string",defaultValue:"sapFontFamily"},truncateWidth:{type:"float"},showEllipsis:{type:"boolean",defaultValue:true},isLabel:{type:"boolean",defaultValue:false},_shapeCropped:{type:"boolean",defaultValue:false,visibility:"hidden"},_xBiassed:{type:"float",visibility:"hidden"},fill:{type:"sap.gantt.ValueSVGPaintServer",defaultValue:"sapTextColor"}}},renderer:{apiVersion:2},constructor:function(){var t,i;if(arguments[0]&&arguments[0]._shapeCropped!=null){t=arguments[0]._shapeCropped;delete arguments[0]._shapeCropped}if(arguments[0]&&arguments[0]._xBiassed!=null){i=arguments[0]._xBiassed;delete arguments[0]._xBiassed}e.apply(this,arguments);if(t){this.setProperty("_shapeCropped",t,true)}if(i){this.setProperty("_xBiassed",i,true)}}});var p=["x","y","text-anchor","style","filter","transform","opacity"];h.prototype.getX=function(){var t=i.getValueX(this);var e=this.getParent();if(isNaN(t)&&e&&e.getTime){t=i.getValueX(e)}var r=this.getGanttChartBase();var a=r&&r.getEnablePseudoShapes()&&e&&e.isPseudoShape;if(a){var s=e&&e.getButton&&e.getButton()[0].getHeight();var o=e&&e.getAggregation("task");var l=o&&o.truncatedTextWidth;var h=2+2;var p={showEllipsis:true,textAnchor:this.getHorizontalTextAlignment().toLowerCase()};var u=o.getWidth(),g=p.textAnchor;t=n._calculateX(this,g,t,u,h,l,p,s)}return t};h.prototype.getFontFamily=function(){return this.determineValueColor(this.getProperty("fontFamily"))};h.prototype.getFill=function(){return this.determineValueColor(this.getProperty("fill"))};h.prototype.getY=function(){var t=this.getProperty("y"),e=1;if(t!==null&&t!==undefined){return t}var i=this.getFontSize();var r=this.getRowYCenter()+i/2;if(this._iBaseRowHeight!=undefined){if(this.getAlignShape()==l.Top){r=this.getRowYCenter()-this._iBaseRowHeight/2+i}else if(this.getAlignShape()==l.Bottom){r=this.getRowYCenter()+this._iBaseRowHeight/2-e}r=parseInt(r)}return r};h.prototype.getStyle=function(){var t=e.prototype.getStyle.apply(this,arguments);var i=this.getTitleColor()?this.getTitleColor():this.getFill()||a.get({name:"sapUiBaseText",callback:function(t){i=t}});var r={"font-size":this.getFontSize()+"px",fill:this.determineValueColor(i),"font-family":this.getFontFamily(),"font-weight":this.getFontWeight()};return t+this.getInlineStyle(r)};h.prototype.renderElement=function(t,e){this.writeElementData(t,"text",true);if(this.aCustomStyleClasses){this.aCustomStyleClasses.forEach(function(e){t.class(e)})}n.renderAttributes(t,e,p);var i=e.getGanttChartBase();if(i&&i.getSelectOnlyGraphicalShape()&&e.getIsLabel()){t.class("sapGanttTextNoPointerEvents")}t.openEnd();n.renderTooltip(t,e);if(this.getShowAnimation()){n.renderElementAnimation(t,e)}this.writeTruncatedText(t,e);t.close("text")};h.prototype.writeTruncatedText=function(t,e){var i=e.getText(),r=this.getTruncateWidth()!=null;if(r){var a=this._truncateText(i,e.bPseudoShape,e.iIconHeight);this.renderEllipsisIfNecessary(t,a,e.oTextElement)}else{t.text(i)}};h.prototype.getTruncateWidth=function(){var t=this.getProperty("truncateWidth");var e=this.getParent();if(e&&e.isA("sap.gantt.simple.BaseShape")){var i=0;if(e.getWidth){i=e.getWidth()}else if(e.getEndTime()&&e.getTime()){i=Math.abs(this.getXByTime(e.getEndTime())-this.getXByTime(e.getTime()))}else{i=t}if(i<t){t=i}}if(this.getTextAnchor().toLowerCase()===s.simple.horizontalTextAlignment.Dynamic.toLowerCase()&&this.getProperty("_shapeCropped")){t=o.getRTL()?t+this.getProperty("_xBiassed"):t-this.getProperty("_xBiassed")}if(t!==undefined){var r=this.getProperty("xBias")||0;if(r>0||!this.isA("sap.gantt.simple.BaseImage")){t=Math.max(t-r,0)}}return t};h.prototype.renderEllipsisIfNecessary=function(t,e,i){var r;if(e.ellipsis){t.text(e.truncatedText+"...");r=e.truncatedText+"..."}else{t.text(e.truncatedText);r=e.truncatedText}if(i){i.truncatedTextWidth=this.measureTextWidth(r);i.iTruncateWidth=this.getTruncateWidth()}};h.prototype._truncateText=function(t,e,i){var r=this._processTextForTruncation(t,e,i);r=r||{ellipsis:false,truncatedText:t};return r};h.prototype._processTextForTruncation=function(t,e,r){var a=this.getTruncateWidth(),s=this.measureTextWidth("..."),n=this.measureTextWidth(t);var l;if(e){l=2+r+8}else{l=8}n=n+l;if(n>a){var h,p;if(this.getShowEllipsis()&&s<a){p=true;h=a-s}else{p=false;h=a}if(h>l){h=h-l}var u;var g=i.geNumberOfTruncatedCharacters(n,h,t,this,this.measureTextWidth);var d=e&&!(h>l)?0:g;if(o.getRTL()){var f=t.length-d;u=t.slice(f,t.length).trim()}else{u=t.slice(0,d).trim()}return{ellipsis:p,truncatedText:u}}return null};h.prototype.getTextAnchor=function(){var t=this.getProperty("textAnchor");return t};h.prototype.measureTextWidth=function(t){return i.getShapeTextWidth(t,this.getFontSize(),this.getFontFamily(),this.getFontWeight())};return h},true);
//# sourceMappingURL=BaseText.js.map