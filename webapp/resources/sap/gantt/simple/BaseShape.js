/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

		(c) Copyright 2009-2015 SAP SE. All rights reserved
	
 */
sap.ui.define(["sap/base/Log","sap/ui/Device","sap/gantt/library","sap/ui/core/Element","sap/ui/core/CustomStyleClassSupport","sap/ui/base/ManagedObjectMetadata","./GanttUtils","./CoordinateUtils","./AggregationUtils","../misc/Format","sap/ui/core/date/UI5Date","sap/gantt/utils/GanttChartConfigurationUtils","sap/ui/core/Theming","sap/gantt/misc/Utility"],function(e,t,i,a,r,n,s,o,l,p,h,u,g,f){"use strict";var d=i.simple.verticalTextAlignment;var c=i.simple.horizontalTextAlignment;var m=i.simple.shapes.ShapeAlignment;var y=a.extend("sap.gantt.simple.BaseShape",{metadata:{library:"sap.gantt",abstract:true,properties:{shapeId:{type:"string"},time:{type:"object"},endTime:{type:"object"},scheme:{type:"string",defaultValue:null},xBias:{type:"float",defaultValue:0},yBias:{type:"float",defaultValue:0},fill:{type:"sap.gantt.ValueSVGPaintServer"},strokeOpacity:{type:"float",defaultValue:1},fillOpacity:{type:"float",defaultValue:1},opacity:{type:"float",defaultValue:1},stroke:{type:"sap.gantt.ValueSVGPaintServer"},strokeWidth:{type:"float",defaultValue:0},strokeDasharray:{type:"string"},transform:{type:"string"},filter:{type:"string"},expandable:{type:"boolean",defaultValue:false},selectable:{type:"boolean",defaultValue:false},selected:{type:"boolean",defaultValue:false},draggable:{type:"boolean",defaultValue:false},resizable:{type:"boolean",defaultValue:false},hoverable:{type:"boolean",defaultValue:false},connectable:{type:"boolean",defaultValue:false},rowYCenter:{type:"float"},countInBirdEye:{type:"boolean",defaultValue:false},childElement:{type:"boolean",defaultValue:false,visibility:"hidden"},shapeUid:{type:"string",visibility:"hidden"},visible:{type:"boolean",defaultValue:true},title:{type:"string",group:"Appearance",defaultValue:null},showTitle:{type:"boolean",group:"Appearance",defaultValue:true},enableChainSelection:{type:"boolean",defaultValue:false},selectableInChainSelection:{type:"boolean",defaultValue:true},verticalTextAlignment:{type:"sap.gantt.simple.verticalTextAlignment",defaultValue:d.Center},horizontalTextAlignment:{type:"sap.gantt.simple.horizontalTextAlignment",defaultValue:c.Start},animationSettings:{type:"object",defaultValue:null},showAnimation:{type:"boolean",defaultValue:false},titleColor:{type:"sap.gantt.ValueSVGPaintServer"},fontSize:{type:"int",defaultValue:13},fontWeight:{type:"string",defaultValue:"normal"},alignShape:{type:"sap.gantt.simple.shapes.ShapeAlignment",defaultValue:m.Middle},fontFamily:{type:"string",defaultValue:"sapFontFamily"},titleSpacing:{type:"int",defaultValue:0},selectedFill:{type:"sap.gantt.ValueSVGPaintServer"},selectedTitleColor:{type:"sap.gantt.ValueSVGPaintServer"},highlightable:{type:"boolean",defaultValue:false},highlighted:{type:"boolean",defaultValue:false},dragHighlightRows:{type:"string[]",defaultValue:[]},styleName:{type:"string",defaultValue:null},leftAnchorPosition:{type:"int"},rightAnchorPosition:{type:"int"}},designtime:"sap/ui/dt/designtime/notAdaptable.designtime"},renderer:{apiVersion:2}});var v={values:null,duration:"1s",repeatCount:"indefinite"};r.apply(y.prototype);y.prototype.init=function(){this.bPreventSingleClick=false;this._level=null};var S={};g.attachApplied(function(){S={}});var b=/translate\((-?\d{1,}),?\s?(-?\d{1,})?\)/gi;y.prototype.setShapeUid=function(t){e.error('The control manages the shapeUid generation. The method "setShapeUid" cannot be used programmatically!',this)};y.prototype.getTransform=function(){var e=this.getProperty("transform");if(e){return e}return this._buildTransformByXYBias()};y.prototype.getLeftAnchorPosition=function(){var e=this.getProperty("leftAnchorPosition");if(e===undefined||e===null){e=this.getDomRef("nonLabelGroup")?75:50}return e};y.prototype.getRightAnchorPosition=function(){var e=this.getProperty("rightAnchorPosition");if(e===undefined||e===null){e=this.getDomRef("nonLabelGroup")?75:50}return e};y.prototype.setLeftAnchorPosition=function(e,t){e=Math.max(0,Math.min(e,100));this.setProperty("leftAnchorPosition",e,t)};y.prototype.setRightAnchorPosition=function(e,t){e=Math.max(0,Math.min(e,100));this.setProperty("rightAnchorPosition",e,t)};y.prototype.setTransform=function(e){this.setProperty("transform",e);this._updateBiasFromTransform(e);return this};y.prototype._buildTransformByXYBias=function(){var e=this.getXBias(),t=this.getYBias();if(e||t){e=e?e:0;e=u.getRTL()?-e:e;t=t?t:0;return"translate("+e+" "+t+")"}return null};y.prototype._updateBiasFromTransform=function(e){if(e!=null){var t=this._parseBias(e);if(t.length>0){var i=t[0]||0,a=t[1]||0;this.setProperty("xBias",i,true);this.setProperty("yBias",a,true)}}};y.prototype._parseBias=function(e){var t=b.exec(e);var i=[];if(t&&t.length>0){t.forEach(function(e,t){if(t!==0&&e){i.push(parseFloat(e))}})}return i};y.prototype.getFontFamily=function(){return this.determineValueColor(this.getProperty("fontFamily"))};y.prototype.getStyle=function(){var e={stroke:this.determineValueColor(this.getStroke()),"stroke-width":this.getStrokeWidth()};var t=this.getSelectable()||this.getHoverable()||this.getTooltip()!==null;if(this.getProperty("childElement")===false&&t===false){e["pointer-events"]="none"}return this.getInlineStyle(e)};y.prototype.getXByTime=function(t){var i=this.getAxisTime();var a=i&&i.timeToView(p.abapTimestampToDate(t));if(!f.isNumeric(a)){e.warning("Cannot convert time:"+t+" to an valid coordinate. Invalid coordinate might not get rendered at all, check the property value!");return 0}return a};y.prototype.getAxisTime=function(){if(this.mAxisTime){return this.mAxisTime}else{var e=this.getGanttChartBase();return e?e.getAxisTime():null}};y.prototype.getGanttChartBase=function(){var e=this.getParentRowSettings();return e?e.getParentGantt():null};y.prototype.getParentRowSettings=function(){return l.getParentControlOf("sap.gantt.simple.GanttRowSettings",this)};y.prototype.getInlineStyle=function(e){return Object.keys(e).reduce(function(t,i){if(e[i]!==undefined&&e[i]!==null&&e[i]!==""){t+=i+":"+e[i]+"; "}return t},"")};y.prototype.determineValueColor=function(e){var t=S[e];if(!t&&e){t=i.ValueSVGPaintServer.normalize(e);S[e]=t}return t};y.prototype.destroy=function(){return a.prototype.destroy.apply(this,["KeepDom"])};y.prototype.isVisible=function(){return false};y.prototype.renderElement=function(e,t){};y.prototype.writeElementData=function(e,t,i){if(this.getProperty("childElement")){var a=n.isGeneratedId(this.getId());if(!a||this.getStyleName()){e.openStart(t,this.getId())}else{e.openStart(t)}e.attr("aria-hidden",true);if(i){e.class("baseShapeSelection")}return}if(this._shallWriteElementData(this)){e.openStart(t,this);e.attr("aria-hidden",true);if(this.getShapeId()){e.attr(s.SHAPE_ID_DATASET_KEY,this.getShapeId())}if(this.getConnectable()){e.attr(s.CONNECTABLE_DATASET_KEY,this.getConnectable())}}else{e.openStart(t);e.attr("aria-hidden",true)}if(i){e.class("baseShapeSelection")}};y.prototype._shallWriteElementData=function(e){var t=!e.getParent();if(t===false){var i=e.getParent().getParent();if(i&&i.isA("sap.gantt.overlays.GanttRowOverlay")){t=l.isParentRowSetting(i)}else{t=l.isParentRowSetting(e)}}if(t===false){t=l.isAdhocLine(e)}if(t===false){t=l.isDeltaLine(e)}if(t===false){t=l.isLazyAggregation(e)}if(t===false){t=this.getGanttChartBase()&&this.getGanttChartBase().getUseParentShapeOnExpand()&&!l.isLazyAggregation(e)}return t};y.prototype.ensureGanttChart=function(){if(!this.mChartInstance){this.mChartInstance=this.getGanttChartBase()}};y.prototype.setSelected=function(e,t){var i=this.getSelected();this.setProperty("selected",e,t);var a=this.getGanttChartBase(),r=this.getShapeUid();if(i!==e&&a&&r){a.getSelection().updateShape(r,{selected:e,ctrl:false,draggable:this.getDraggable(),time:this.getTime(),endTime:this.getEndTime()})}return this};y.prototype.setTime=function(e,t){this.setProperty("time",this._convertToJSDate(e),t)};y.prototype.setEndTime=function(e,t){this.setProperty("endTime",this._convertToJSDate(e),t)};y.prototype.setHighlighted=function(e,t){var i=this.getHighlighted();this.setProperty("highlighted",e,t);var a=this.getGanttChartBase(),r=this.getShapeUid();if(i!==e&&a&&r){a.getHighlight().updateShape(r,{highlighted:e,time:this.getTime(),endTime:this.getEndTime()})}return this};y.prototype.onclick=function(e){var t=function(){var t;if(this.bPreventSingleClick===false){t=this.getGanttChartBase();s.resetStrokeDasharray(t);var i=o.getLatestCursorPosition();if(!t.fireShapePress({popoverOffsetX:this._getPopoverOffsetX(e),rowSettings:this.getParentRowSettings(),shape:this,ctrlOrMeta:e.ctrlKey||e.metaKey,pageX:i.pageX,pageY:i.pageY,originEvent:e})){return}if(!this.getEnableChainSelection()){t.handleShapePress({shape:this,ctrlOrMeta:e.ctrlKey||e.metaKey})}e.setMarked()}this.bPreventSingleClick=false}.bind(this);if(!this.getSelectable()){return}if(this._isDoubleClickEventDisabled()){t();return}this.iSingleClickTimer=window.setTimeout(t.bind(this),300)};y.prototype.ondblclick=function(e){if(this._isDoubleClickEventDisabled()){return}window.clearTimeout(this.iSingleClickTimer);this.bPreventSingleClick=true;var t=o.getLatestCursorPosition();this.getGanttChartBase().fireShapeDoubleClick({popoverOffsetX:this._getPopoverOffsetX(e),rowSettings:this.getParentRowSettings(),shape:this,pageX:t.pageX,pageY:t.pageY});e.stopImmediatePropagation()};y.prototype.oncontextmenu=function(e){e.preventDefault();e.stopImmediatePropagation();var t=o.getLatestCursorPosition();this.getGanttChartBase().fireShapeContextMenu({pageX:t.pageX,pageY:t.pageY,popoverOffsetX:this._getPopoverOffsetX(e),rowSettings:this.getParentRowSettings(),shape:this,originEvent:e})};y.prototype.onmouseout=function(e){if(this.getHoverable()===false){return}if(this.isA("sap.gantt.simple.Relationship")&&this.bRelationshipMouseEnter){e.currentTarget.style["stroke-width"]=this.getStrokeWidth()||1;this.bRelationshipMouseEnter=false}var t=this.getGanttChartBase();if(this.iMouseOutTimer){window.clearTimeout(this.iMouseOutTimer)}if(!this.bShapeMouseEnterFired&&this.iMouseOverTimer){window.clearTimeout(this.iMouseOverTimer)}this.iMouseOutTimer=window.setTimeout(function(){if(this.bShapeMouseEnterFired){t.fireShapeMouseLeave({shape:this});t.handleShapeMouseLeave({shape:this});this.bShapeMouseEnterFired=false}}.bind(this),t.getShapeMouseLeaveDelay())};y.prototype.onmouseover=function(e){if(this.getHoverable()===false){return}if(this.isA("sap.gantt.simple.Relationship")&&!this.bRelationshipMouseEnter){e.currentTarget.style["stroke-width"]=this.getSelectedStrokeWidth();this.bRelationshipMouseEnter=true}var t=this.getGanttChartBase();if(this.iMouseOverTimer){window.clearTimeout(this.iMouseOverTimer)}this.iMouseOverTimer=window.setTimeout(function(){var e=o.getCursorElement();if(e===this){if(this.iMouseOutTimer){window.clearTimeout(this.iMouseOutTimer)}var i=o.getLatestCursorPosition();t.fireShapeMouseEnter({shape:this,pageX:i.pageX,pageY:i.pageY,isPinConnector:!!(this.mAnchors&&this.mAnchors.prompter)});this.bShapeMouseEnterFired=true;t.handleShapeMouseEnter({shape:this})}}.bind(this),t.getShapeMouseEnterDelay())};y.prototype.getShapeUid=function(){return this.getProperty("shapeUid")};y.prototype._getPopoverOffsetX=function(e){if(this.getTime()){var i=this.getDomRef().getBoundingClientRect().width;var a=typeof this.getX==="function"?this.getX():s.getValueX(this);var r=this.getEndTime()?this.getEndTime().getTime():this.getAxisTime().viewToTime(a+i).getTime();var n=new Date((this.getTime().getTime()+r)/2);var o=t.browser.mozilla?e.originalEvent.layerX:e.offsetX;var l=Math.round(o-this.getAxisTime().timeToView(n));return Math.abs(l)>i?0:l}};y.prototype._isDoubleClickEventDisabled=function(){var e=this.getGanttChartBase();return e&&e.getDisableShapeDoubleClickEvent()};y.prototype.getAnimationProperties=function(e){if(!this.mAnimationProperties){if(jQuery.isEmptyObject(e)||!e.values){return false}var t=jQuery.extend(true,{},v);for(var i in t){if(e[i]){t[i]=e[i]}}this.mAnimationProperties=t}this.mAnimationProperties["values"]=this.mAnimationProperties["values"].split(";").map(e=>this.determineValueColor(e)||e).join(";");return this.mAnimationProperties};y.prototype._convertToJSDate=function(e){if(e instanceof h){return new Date(e.getTime())}return e};return y},true);
//# sourceMappingURL=BaseShape.js.map