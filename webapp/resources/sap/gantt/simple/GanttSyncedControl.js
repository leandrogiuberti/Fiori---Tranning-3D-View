/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

		(c) Copyright 2009-2015 SAP SE. All rights reserved
	
 */
sap.ui.define(["sap/gantt/library","sap/ui/core/Control","sap/ui/Device","sap/ui/core/Core","./GanttUtils","sap/ui/core/RenderManager"],function(t,e,n,o,a,r){"use strict";var i=e.extend("sap.gantt.simple.GanttSyncedControl",{metadata:{library:"sap.gantt",properties:{innerWidth:{type:"sap.ui.core.CSSSize",group:"Dimension",defaultValue:"100%"}}},renderer:{apiVersion:2,render:function(t,e){var n=e.getParent().getParent();t.openStart("div",e);t.class("sapGanttBackground");t.openEnd();t.openStart("div",n.getId()+"-ganttBGFlexContainer");t.class("sapGanttBackgroundFlexContainer");t.openEnd();t.openStart("div",n.getId()+"-ganttBGContainerWithScrollBar");t.class("sapGanttBackgroundContainer").class("sapGanttBackgroundScrollbar");t.openEnd();t.openStart("div",n.getId()+"-ganttSyncedControlTable");t.class("sapGanttBackgroundTable");t.openEnd();e.renderGanttHeaderPlaceholder(t,n);e.renderGanttBodyPlaceholder(t,n);e.renderHorizontalScrollbarContainer(t,n);t.close("div");t.close("div");e.renderVerticalScrollbarContainer(t,e,n);t.close("div");t.close("div")}}});i.prototype.init=function(){this.oSyncInterface=null;this.state={rows:[],innerVerticalScrollPosition:0,horizontalScrollPosition:0,layout:{top:0,headerHeight:0,contentHeight:0}};this._bRowsHeightChanged=false;this._bAllowContentScroll=true};i.prototype.onAfterRendering=function(){var t=this.getDomRefs();var e=this.getParent().getParent();if(this.oSyncInterface){var n=new r;this.oSyncInterface.renderHorizontalScrollbar(n,e.getId()+"-hsb",e.getContentWidth());n.flush(t.hsbContainer)}if(this.oSyncInterface&&t.content&&t.vsbContainerContent){this.oSyncInterface.registerVerticalScrolling({wheelAreas:[t.content],touchAreas:[t.content]});this.oSyncInterface.placeVerticalScrollbarAt(t.vsbContainerContent)}this.updateScrollPositions();if(e.getParent().isA("sap.gantt.simple.GanttChartContainer")&&e.getParent().getToolbar()){e.getParent().getToolbar()._oDisplayTypeSegmentedButton.setSelectedKey(e.getDisplayType())}e._setupDisplayType()};i.prototype.renderGanttHeaderPlaceholder=function(t,e){t.openStart("div",e.getId()+"-ganttHeader");t.style("height",this.state.layout.top+this.state.layout.headerHeight+"px");t.attr("data-sap-ui-related",e.getId());if(!e.getShowGanttHeader()){e.getTable().destroyExtension();e.getTable().setColumnHeaderVisible(false)}else{e.getTable().setColumnHeaderVisible(true)}t.class("sapGanttChartWithTableHeader");t.openEnd();t.close("div")};i.prototype.renderGanttBodyPlaceholder=function(t,e){t.openStart("div",e.getId()+"-sapGanttBackgroundTableContent");t.class("sapGanttBackgroundTableContent");t.style("height",this.state.layout.contentHeight+"px");t.openEnd();t.openStart("div",e.getId()+"-gantt");t.attr("data-sap-ui-related",e.getId());t.class("sapGanttChartContentBody");t.class("sapGanttBackgroundSVG");t.openEnd();this.renderGanttChartCnt(t,e);t.close("div");t.close("div")};i.prototype.renderVerticalScrollbarContainer=function(t,e,n){t.openStart("div",n.getId()+"-sapGanttVerticalScrollBarContainer");t.class("sapGanttBackgroundVScrollContainer");t.openEnd();t.openStart("div");t.class("sapGanttBackgroundVScrollContentArea");t.style("margin-top",e.state.layout.top+e.state.layout.headerHeight+"px");t.openEnd().close("div");t.close("div")};i.prototype.syncWith=function(e){var n=e.getParent()._oExpandModel;var o=0;e._enableSynchronization().then(function(r){this.oSyncInterface=r;r.rowCount=function(t){var e=this.state.rows.length;var n;if(e<t){for(n=0;n<t-e;n++){this.state.rows.push({height:0,selected:false,hovered:false})}}else if(e>t){for(n=e-1;n>=t;n--){this.state.rows.pop()}}}.bind(this);r.rowSelection=function(t,e){if(this.state.rows[t]){this.state.rows[t].selected=e;a.updateGanttRows(this,this.state.rows,t)}}.bind(this);r.rowHover=function(t,e){if(this.state.rows[t]){this.state.rows[t].hovered=e;a.updateGanttRows(this,this.state.rows,t)}}.bind(this);r.rowHeights=function(o){var a=this.getParent().getParent();var r=a.getTable().getRows();for(var i=0;i<=o.length-1;i++){if(a.oRowsCustomHeight){var s=r[i].getAggregation("_settings").getRowId();if(a.oRowsCustomHeight.hasOwnProperty(s)&&a.oRowsCustomHeight[s]>o[i]){o[i]=a.oRowsCustomHeight[s]}}o[i]=n.getRowHeightByIndex(e,i,o[i])}this.setRowsHeightChanged(false);var l=0;o.forEach(function(t,e){if(!this.state.rows[e]){this.state.rows[e]={}}if(this.state.rows[e].height!==t){this.setRowsHeightChanged(true)}l+=t;this.state.rows[e].height=t;this.state.rows[e].rowYCenter=l-t/2}.bind(this));if((this.getRowsHeightChanged()||a._bExpandToggled)&&a.getDisplayType()!==t.simple.GanttChartWithTableDisplayType.Table){a.getInnerGantt().invalidate()}return o}.bind(this);r.innerVerticalScrollPosition=function(t){this.state.innerVerticalScrollPosition=t;this.updateScrollPositions()}.bind(this);r.layout=function(t){this.state.layout=t;var e=this.getParent().getParent();this.updateLayout();var n=this.getDomRefs();var a=false;if(e._getResizeExtension){a=e._getResizeExtension().isResizing()}var r=n.header.style.height.split("px")[0];if(e){if(parseInt(r)!==o&&!a){o=parseInt(r);e.getAggregation("_header").renderElement();if(e._getScrollExtension&&e._getScrollExtension.mOffsetWidth){e._getScrollExtension().scrollGanttChartToVisibleHorizon()}}if(e.getChartOverflowToolbar()){e.getChartOverflowToolbar().setWidth(n.header.clientWidth+"px")}}}.bind(this);this.invalidate()}.bind(this))};i.prototype.renderHorizontalScrollbarContainer=function(t,e){t.openStart("div",e.getId()+"-horizontalScrollContainer");t.class("sapGanttHSBContainer");if(e.getAxisTimeStrategy().isA("sap.gantt.axistime.FullScreenStrategy")){t.class("sapGanttHSbHidden")}t.openEnd();t.close("div")};i.prototype.renderSvgDefs=function(t,e){var n=e.getSvgDefs();if(n){t.openStart("svg",e.getId()+"-svg-psdef");t.attr("aria-hidden","true");t.style("float","left");t.style("width","0px");t.style("height","0px");t.openEnd();t.unsafeHtml(n.getDefString());t.close("svg")}};i.prototype.renderGanttChartCnt=function(t,e){t.openStart("div",e.getId()+"-cnt");t.class("sapGanttChartCnt");t.style("height","100%");t.style("width","100%");t.openEnd();t.close("div")};i.prototype.setInnerWidth=function(t){this.setProperty("innerWidth",t,true);this._toggleHSBVisibility(t);return this};i.prototype._toggleHSBVisibility=function(t){var e=this.getDomRefs();if(e.hsb==null||e.hsbContent==null){return}var n=parseFloat(t)+2>jQuery(e.contentContainer).width();if(n){e.hsbContent.style.height=null;e.hsbContent.style.width=t}else{e.hsbContent.style.cssText=null}};i.prototype.addEventListeners=function(){this.addScrollEventListeners()};i.prototype.addScrollEventListeners=function(){var t=this;this.oHSb.addEventListener("scroll",function(e){t.state.horizontalScrollPosition=e.target.scrollLeft})};i.prototype.updateLayout=function(){var e=this.getDomRefs();if(e){var n=this.getParent().getParent();if(n.getDisplayType()!==t.simple.GanttChartWithTableDisplayType.Chart||n._bClonedGantt){e.header.style.height=this.state.layout.top+this.state.layout.headerHeight+"px"}e.contentContainer.style.height=this.state.layout.contentHeight+"px";e.vsbContainerContent.style.marginTop=e.header.style.height;var o=e.vsbContainerContent.getElementsByClassName("sapUiTableVSb")[0];if(o){o.style.position="static"}}};i.prototype.updateScrollPositions=function(){var t=this.getDomRefs();if(t&&this._bAllowContentScroll||t.content.scrollTop!==this.state.innerVerticalScrollPosition){t.content.scrollTop=this.state.innerVerticalScrollPosition;if(t.content.scrollTop!==this.state.innerVerticalScrollPosition){this._bAllowContentScroll=false}}};i.prototype.setAllowContentScroll=function(t){this._bAllowContentScroll=t};i.prototype.setRowsHeightChanged=function(t){this._bRowsHeightChanged=t};i.prototype.getRowsHeightChanged=function(t){return this._bRowsHeightChanged};i.prototype.scrollContentIfNecessary=function(){if(this._bAllowContentScroll===false){this._bAllowContentScroll=true;this.updateScrollPositions()}};i.prototype.getDomRefs=function(){var t=this.getDomRef();if(!t){return null}var e=t.querySelector(".sapGanttChartWithTableHeader"),n=t.querySelector(".sapGanttBackgroundTableContent"),o=n.querySelector(".sapGanttChartContentBody");var a=t.querySelector(".sapGanttBackgroundVScrollContainer"),r=a.querySelector(".sapGanttBackgroundVScrollContentArea");var i=t.querySelector(".sapGanttHSBContainer");var s=t.querySelector(".sapUiTableHSbExternal"),l=t.querySelector(".sapUiTableHSbContent");return{header:e,contentContainer:n,content:o,vsbContainer:a,vsbContainerContent:r,hsbContainer:i,hsb:s,hsbContent:l}};i.prototype.getRowStates=function(){return this.state.rows};i.prototype.getRowHeights=function(){return this.state.rows.map(function(t){return t.height})};i.prototype.syncRowSelection=function(t){if(t>-1){var e=!this.state.rows[t].selected;this.oSyncInterface.syncRowSelection(t,e)}};i.prototype.syncRowHover=function(t,e){if(t>-1){this.oSyncInterface.syncRowHover(t,e)}};return i});
//# sourceMappingURL=GanttSyncedControl.js.map