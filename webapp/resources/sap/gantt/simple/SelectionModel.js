/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

		(c) Copyright 2009-2015 SAP SE. All rights reserved
	
 */
sap.ui.define(["sap/gantt/library","sap/ui/base/EventProvider","./GanttUtils","sap/gantt/misc/Utility","sap/ui/core/Element"],function(e,t,d,i,l){"use strict";var s=e.SelectionMode;var c=t.extend("sap.gantt.simple.SelectionModel",{constructor:function(e){t.apply(this,arguments);this.sSelectionMode=e||s.Single;this.mSelected={uid:{},shapeId:{},rowId:{},deSelectShapeId:{},deSelectRowId:{}}}});c.prototype.getSelectionMode=function(){return this.sSelectionMode};c.prototype.setSelectionMode=function(e){this.sSelectionMode=e||s.Single;return this};c.prototype.updateShape=function(e,t,d){var i=this.getSelectionMode();if(i==="None"){return}if(!e){if(i===s.Single||i===s.Multiple||i===s.MultiWithKeyboard&&!t.ctrl||i===s.MultipleWithLasso||i===s.MultiWithKeyboardAndLasso&&!t.ctrl){this.clear(false)}return}if(t.selected&&!this.mSelected.uid[e]){var l=Object.keys(this.mSelected.uid);if(this.sSelectionMode===s.Single){this.mSelected.uid={}}else if(this.sSelectionMode===s.MultiWithKeyboard||this.sSelectionMode===s.MultiWithKeyboardAndLasso){if(t.ctrl){l=[]}else{this.mSelected.uid={}}}else if(this.sSelectionMode===s.Multiple||this.sSelectionMode===s.MultipleWithLasso){l=[]}this._updateSelectedShape(e,t);if(!d){this._fireSelectionChanged(l)}}else if(!t.selected&&this.mSelected.uid[e]){delete this.mSelected.uid[e];this._updateShapeIdRowIdList(e,false);if(!d){this._fireSelectionChanged([e])}}};c.prototype._updateShapeIdRowIdList=function(e,t){var d=i.parseUid(e).shapeId,l=i.parseUid(e).rowId;if(this.mSelected.shapeId[d]){delete this.mSelected.shapeId[d];this.mSelected.deSelectShapeId[d]={selected:false}}if(this.mSelected.rowId[l]){if(t){delete this.mSelected.rowId[l];this.mSelected.deSelectRowId[l]={selected:false}}}};c.prototype.updateShapes=function(e){if(!e){return}var t=[];var d=Object.keys(e);for(var i=0;i<d.length;i++){var l=d[i];var s=e[d[i]];if(s&&s.selected&&!this.mSelected.uid[l]){this._updateSelectedShape(l,s)}else if(s&&!s.selected&&this.mSelected.uid[l]){delete this.mSelected.uid[l];this._updateShapeIdRowIdList(l,false);t.push(l)}}this._fireSelectionChanged(t)};c.prototype.updateProperties=function(e,t,d){if(this.mSelected.uid[e]){this.mSelected.uid[e].draggable=t.draggable;this.mSelected.uid[e].time=t.time;this.mSelected.uid[e].endTime=t.endTime}else if(d){this._updateSelectedShape(e,t)}};c.prototype._updateSelectedShape=function(e,t){this.mSelected.uid[e]={shapeUid:e,draggable:t.draggable,time:t.time,endTime:t.endTime}};c.prototype._fireSelectionChanged=function(e,t,d,i){var l={shapeUid:Object.keys(this.mSelected.uid),deselectedUid:e,silent:!!t,deSelectAll:i};if(l.shapeUid.length>0||l.deselectedUid.length>0||d){this.fireSelectionChanged(l)}};c.prototype.clearSelectionByUid=function(e,t){if(this.existed(e)){this._updateShapeIdRowIdList(e,t);delete this.mSelected.uid[e]}else if(t){this._updateShapeIdRowIdList(e,t)}};c.prototype.isShapeSelected=function(e){var t=i.parseUid(e),d=t.shapeId,l=t.rowId;var s=false;Object.keys(this.mSelected.uid).forEach(function(e){var t=i.parseUid(e);if(d===t.shapeId&&l===t.rowId){s=true}});return s};c.prototype.existed=function(e){return!!this.mSelected.uid[e]};c.prototype.clear=function(e){if(this.mSelected.uid.length===0){return false}var t=this.allUid();this.mSelected.uid={};this.mSelected.shapeId={};this.mSelected.rowId={};this._fireSelectionChanged(t,e);return true};c.prototype.allUid=function(){return Object.keys(this.mSelected.uid)};c.prototype.numberOfSelectedDraggableShapes=function(){return this.allSelectedDraggableUid().length};c.prototype.allSelectedDraggableUid=function(){return Object.keys(this.mSelected.uid).filter(function(e){return this.mSelected.uid[e].draggable}.bind(this))};c.prototype.updateSelectedShapes=function(e,t,d){var i=[];this.mSelected.deSelectRowId={};if(!e||e.length===0){this.mSelected.deSelectShapeId=this.mSelected.shapeId;this.mSelected.shapeId={}}if(t){i=this.allUid();this.mSelected.uid={};this.mSelected.shapeId={}}e.forEach(function(e){if(e.Selected){this.mSelected.deSelectShapeId={};if(e.ShapeId&&!this.mSelected.shapeId[e.ShapeId]){this.mSelected.shapeId[e.ShapeId]={selected:e.Selected}}else if(e.rowId&&!this.mSelected.rowId[e.rowId]){this.mSelected.rowId[e.rowId]={selected:e.Selected}}}else if(e.ShapeId&&this.mSelected.shapeId[e.ShapeId]){delete this.mSelected.shapeId[e.ShapeId];this.mSelected.deSelectShapeId[e.ShapeId]={selected:e.Selected}}else if(e.ShapeId&&!this.mSelected.shapeId[e.ShapeId]){this.mSelected.deSelectShapeId[e.ShapeId]={selected:e.Selected}}else if(e.rowId&&this.mSelected.rowId[e.rowId]){delete this.mSelected.rowId[e.rowId];this.mSelected.deSelectRowId[e.rowId]={selected:e.Selected}}else if(e.rowId&&!this.mSelected.rowId[e.rowId]){this.mSelected.deSelectRowId[e.rowId]={selected:e.Selected}}}.bind(this));if(e.length>0){var s=[];Object.keys(this.mSelected.deSelectShapeId).forEach(function(e){var t=document.querySelectorAll("[id='"+d+"'] [data-sap-gantt-shape-id='"+e+"']")[0],i=l.getElementById(t&&t.id);s.push(i&&i.getShapeUid())});i=s?s:i}this._fireSelectionChanged(i,true,true,false)};c.prototype.clearAllSelectedShapeIds=function(){this.mSelected.deSelectShapeId=this.mSelected.shapeId;this.mSelected.deSelectRowId=this.mSelected.rowId;this.mSelected.shapeId={};this.mSelected.rowId={};var e=this.allUid();this.mSelected.uid={};this._fireSelectionChanged(e,true,true,true)};c.prototype.getSelectedShapeIDS=function(){return Object.keys(this.mSelected.shapeId)};c.prototype.getSelectedRowIDS=function(){return Object.keys(this.mSelected.rowId)};c.prototype.getDeSelectedShapeIDS=function(){return Object.keys(this.mSelected.deSelectShapeId)};c.prototype.getDeSelectedRowIDS=function(){return Object.keys(this.mSelected.deSelectRowId)};c.prototype.updateShapeId=function(e,t){if(t){if(!this.mSelected.shapeId[e]){this.mSelected.shapeId[e]={selected:t}}if(this.mSelected.deSelectShapeId[e]){delete this.mSelected.deSelectShapeId[e]}}else{if(this.mSelected.shapeId[e]){delete this.mSelected.shapeId[e]}if(!this.mSelected.deSelectShapeId[e]){this.mSelected.deSelectShapeId[e]={selected:t}}}};c.prototype.clearDeselectionModelById=function(e){if(this.mSelected.deSelectShapeId[e]){delete this.mSelected.deSelectShapeId[e]}};c.prototype.getSelectedShapeDataByUid=function(e){return this.mSelected.uid[e]};c.prototype.attachSelectionChanged=function(e,t,d){this.attachEvent("selectionChanged",e,t,d)};c.prototype.detachSelectionChanged=function(e,t){this.detachEvent("selectionChanged",e,t)};c.prototype.fireSelectionChanged=function(e){this.fireEvent("selectionChanged",e);return this};return c},true);
//# sourceMappingURL=SelectionModel.js.map