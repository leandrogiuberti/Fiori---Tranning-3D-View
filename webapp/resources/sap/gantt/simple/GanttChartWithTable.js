/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

		(c) Copyright 2009-2015 SAP SE. All rights reserved
	
 */
sap.ui.define(["sap/gantt/library","sap/ui/thirdparty/jquery","sap/base/assert","sap/base/Log","sap/ui/core/Control","sap/ui/model/ChangeReason","sap/base/util/values","sap/ui/layout/Splitter","sap/ui/layout/SplitterLayoutData","sap/ui/core/ResizeHandler","./FullScreenUtil","./InnerGanttChart","./GanttHeader","./GanttSyncedControl","../control/AssociateContainer","../axistime/ProportionZoomStrategy","./SelectionModel","./ExpandModel","./ShapeScheme","./GanttExtension","./GanttScrollExtension","./GanttZoomExtension","./GanttPointerExtension","./GanttDragDropExtension","./GanttPopoverExtension","./GanttConnectExtension","./GanttResizeExtension","./GanttLassoExtension","./GanttUtils","./RenderUtils","../misc/Format","../misc/Utility","../config/TimeHorizon","sap/ui/export/Spreadsheet","sap/base/util/uid","sap/m/Dialog","sap/m/Input","sap/m/Label","sap/m/VBox","sap/m/Button","sap/ui/model/json/JSONModel","sap/m/Menu","sap/m/MenuButton","sap/m/MenuItem","sap/base/util/deepEqual","sap/ui/core/CustomData","sap/gantt/simple/GanttAdaptationData","sap/ui/fl/write/api/ControlPersonalizationWriteAPI","./HighlightModel","sap/gantt/simple/AggregationUtils","sap/gantt/simple/BasePseudoShape","sap/gantt/def/SvgDefs","sap/base/util/UriParameters","sap/ui/table/rowmodes/Auto","sap/ui/core/Element","sap/ui/core/Lib"],function(e,jQuery,t,a,i,n,s,o,r,l,h,p,g,d,u,f,c,S,m,y,b,T,v,_,E,x,w,D,R,P,C,I,A,V,O,z,H,L,M,B,G,U,N,k,F,W,j,Z,J,X,q,K,Y,Q,$,ee){"use strict";var te=e.simple.GanttChartWithTableDisplayType,ae=e.simple.VisibleHorizonUpdateType,ie=e.simple.VisibleHorizonUpdateSubType,ne=e.simple.exportTableCustomDataType;var se=Object.freeze({totalHorizonUpdated:ae.TotalHorizonUpdated,mouseWheelZoom:ae.MouseWheelZoom,syncVisibleHorizon:ae.SyncVisibleHorizon,initialRender:ae.InitialRender,horizontalScroll:ae.HorizontalScroll,zoomLevelChanged:ae.ZoomLevelChanged,timePeriodZooming:ae.TimePeriodZooming});var oe=ee.getResourceBundleFor("sap.gantt");var re=10;var le=60;var he=s(n).slice();var pe=he.concat(["Render","FirstVisibleRowChange","Resize"]);function ge(e,t){return e+t}function de(e,t){return Math.abs(e-t)<re}var ue=i.extend("sap.gantt.simple.GanttChartWithTable",{metadata:{library:"sap.gantt",properties:{width:{type:"sap.ui.core.CSSSize",defaultValue:"100%"},height:{type:"sap.ui.core.CSSSize",defaultValue:"100%"},shapeSelectionMode:{type:"sap.gantt.SelectionMode",defaultValue:e.SelectionMode.MultiWithKeyboard},shapeOverRelationship:{type:"boolean",defaultValue:true},shapeSelectionSettings:{type:"object",defaultValue:null},shapeHighlightSettings:{type:"object",defaultValue:null},enableCursorLine:{type:"boolean",defaultValue:true},enableNowLine:{type:"boolean",defaultValue:true},nowLineInUTC:{type:"boolean",defaultValue:true},enableVerticalLine:{type:"boolean",defaultValue:true},enableAdhocLine:{type:"boolean",defaultValue:true},adhocLineLayer:{type:"string",defaultValue:e.AdhocLineLayer.Top},enableDeltaLine:{type:"boolean",defaultValue:true},enableNonWorkingTime:{type:"boolean",defaultValue:true},enableChartDeltaAreaHighlight:{type:"boolean",defaultValue:true},deltaLineLayer:{type:"string",defaultValue:e.DeltaLineLayer.Bottom},datePattern:{type:"string",defaultValue:e.config.DEFAULT_DATE_PATTERN},timePattern:{type:"string",defaultValue:e.config.DEFAULT_TIME_PATTERN},enableExpandedRowBorders:{type:"boolean",defaultValue:true},enableExpandedRowBackground:{type:"boolean",defaultValue:true},expandedRowHeight:{type:"int"},dragOrientation:{type:"sap.gantt.DragOrientation",defaultValue:e.DragOrientation.Free},ghostAlignment:{type:"string",defaultValue:e.dragdrop.GhostAlignment.None},showShapeTimeOnDrag:{type:"boolean",defaultValue:false},selectionPanelSize:{type:"sap.ui.core.CSSSize",defaultValue:"30%"},displayType:{type:"sap.gantt.simple.GanttChartWithTableDisplayType",defaultValue:te.Both},disableShapeDoubleClickEvent:{type:"boolean",defaultValue:false},showExportTableToExcel:{type:"boolean",defaultValue:false},enableSelectAndDrag:{type:"boolean",defaultValue:true},deltaAreaHighlightColor:{type:"sap.gantt.ValueSVGPaintServer",defaultValue:"sapUiListSelectionBackgroundColor"},enableLassoInvert:{type:"boolean",defaultValue:false},showParentRowOnExpand:{type:"boolean",defaultValue:true},printingBatchSize:{type:"int",defaultValue:100},showGanttHeader:{type:"boolean",defaultValue:true},_isAppRunningInRTA:{type:"boolean",defaultValue:false,visibility:"hidden"},snapMode:{type:"sap.gantt.dragdrop.SnapMode",defaultValue:e.dragdrop.SnapMode.None},snapTimeInterval:{type:"object",defaultValue:{}},enableChartOverflowToolbar:{type:"boolean",defaultValue:false},enableChartSelectionState:{type:"boolean",defaultValue:true},enableChartHoverState:{type:"boolean",defaultValue:true},selectOnlyGraphicalShape:{type:"boolean",defaultValue:false},showTextOnGhost:{type:"boolean",defaultValue:true},relationshipShapeSize:{type:"sap.gantt.simple.relationshipShapeSize",defaultValue:e.simple.relationshipShapeSize.Medium},useParentShapeOnExpand:{type:"boolean",defaultValue:false},findBy:{type:"string[]",defaultValue:[]},findByOperator:{type:"string",defaultValue:e.simple.findByOperator.OR},isConnectorDetailsVisible:{type:"boolean",defaultValue:false},rowHighlightFill:{type:"sap.gantt.ValueSVGPaintServer",defaultValue:"sapChart_Sequence_1_Plus3"},rowHighlightAndHoverFill:{type:"sap.gantt.ValueSVGPaintServer",defaultValue:"sapChart_Sequence_1_Plus1"},horizontalLazyLoadingEnabled:{type:"boolean",defaultValue:false},enablePseudoShapes:{type:"boolean",defaultValue:false},shapeMouseEnterDelay:{type:"int",defaultValue:500},shapeMouseLeaveDelay:{type:"int",defaultValue:500},shapeRenderOrder:{type:"string[]",defaultValue:[]},enableMultipleGhosts:{type:"boolean",defaultValue:true},optimiseRelationships:{type:"boolean",defaultValue:false}},aggregations:{table:{type:"sap.ui.table.Table",multiple:false},adhocLines:{type:"sap.gantt.AdhocLine",multiple:true,singularName:"adhocLine",bindable:"bindable",visibility:"public"},simpleAdhocLines:{type:"sap.gantt.simple.AdhocLine",multiple:true,singularName:"simpleAdhocLine",bindable:"bindable",visibility:"public"},deltaLines:{type:"sap.gantt.simple.DeltaLine",multiple:true,singularName:"deltaLine",bindable:"bindable",visibility:"public"},svgDefs:{type:"sap.gantt.def.SvgDefs",multiple:false,singularName:"svgDef"},_pseudoSvgDefs:{type:"sap.gantt.def.SvgDefs",multiple:false,singularName:"pseudoSvgDef",visibility:"hidden"},shapeSchemes:{type:"sap.gantt.simple.ShapeScheme",multiple:true,singularName:"shapeScheme"},calendarDef:{type:"sap.gantt.def.cal.CalendarDefs",multiple:false,bindable:"bindable"},axisTimeStrategy:{type:"sap.gantt.axistime.AxisTimeStrategyBase",multiple:false,bindable:"bindable"},locale:{type:"sap.gantt.config.Locale",multiple:false},_splitter:{type:"sap.ui.layout.Splitter",multiple:false,visibility:"hidden"},_header:{type:"sap.gantt.simple.GanttHeader",multiple:false,defaultValue:null,visibility:"hidden"},_innerGantt:{type:"sap.gantt.simple.InnerGanttChart",multiple:false,visibility:"hidden"},ganttAdaptationData:{type:"sap.gantt.simple.GanttAdaptationData",multiple:true},overflowToolbarItems:{type:"sap.ui.core.Control",multiple:true},shapeStyles:{type:"sap.gantt.simple.ShapeStyle",multiple:true}},events:{shapeSelectionChange:{parameters:{shapeUids:{type:"string[]"}}},shapeHighlightChange:{parameters:{shapeUids:{type:"string[]"}}},shapeResize:{parameters:{shapeUid:{type:"string"},shape:{type:"sap.gantt.simple.BaseShape"},rowObject:{type:"object"},oldTime:{type:"string[]"},newTime:{type:"string[]"}}},shapeMouseEnter:{parameters:{shape:{type:"sap.gantt.simple.BaseShape"},pageX:{type:"int"},pageY:{type:"int"},isPinConnector:{type:"boolean"}}},shapeMouseLeave:{parameters:{shape:{type:"sap.gantt.simple.BaseShape"},originEvent:{type:"object"}}},shapePress:{parameters:{popoverOffsetX:{type:"int"},rowSettings:{type:"sap.gantt.simple.GanttRowSettings"},shape:{type:"sap.gantt.simple.BaseShape"},ctrlOrMeta:{type:"boolean"},pageX:{type:"int"},pageY:{type:"int"},originEvent:{type:"object"}},allowPreventDefault:true},shapeDoubleClick:{parameters:{popoverOffsetX:{type:"int"},rowSettings:{type:"sap.gantt.simple.GanttRowSettings"},shape:{type:"sap.gantt.simple.BaseShape"},pageX:{type:"int"},pageY:{type:"int"}}},shapeContextMenu:{parameters:{pageX:{type:"int"},pageY:{type:"int"},popoverOffsetX:{type:"int"},rowSettings:{type:"sap.gantt.simple.GanttRowSettings"},shape:{type:"sap.gantt.simple.BaseShape"},originEvent:{type:"object"}}},dragStart:{parameters:{sourceGanttChart:{type:"sap.gantt.simple.GanttChartWithTable"},draggedShapeDates:{type:"object"},lastDraggedShapeUid:{type:"string"},cursorDateTime:{type:"object"}}},shapeDrop:{parameters:{sourceGanttChart:{type:"sap.gantt.simple.GanttChartWithTable"},targetGanttChart:{type:"sap.gantt.simple.GanttChartWithTable"},draggedShapeDates:{type:"object"},lastDraggedShapeUid:{type:"string"},targetRow:{type:"sap.ui.table.Row"},cursorDateTime:{type:"object"},newDateTime:{type:"object"},targetShape:{type:"sap.gantt.simple.BaseShape"}}},shapeConnect:{parameters:{fromShapeUid:{type:"string"},toShapeUid:{type:"string"},type:{type:"sap.gantt.simple.RelationshipType"}}},visibleHorizonUpdate:{parameters:{type:{type:"sap.gantt.simple.VisibleHorizonUpdateType"},subType:{type:"sap.gantt.simple.VisibleHorizonUpdateSubType"},lastVisibleHorizon:{type:"sap.gantt.config.TimeHorizon"},currentVisibleHorizon:{type:"sap.gantt.config.TimeHorizon"},lastRenderedVisibleHorizon:{type:"sap.gantt.config.TimeHorizon"},currentRenderedVisibleHorizon:{type:"sap.gantt.config.TimeHorizon"}}},shapeConnectorList:{parameters:{pageX:{type:"int"},pageY:{type:"int"},connectorList:{type:"object"}}},renderingComplete:{}},designtime:"sap/gantt/designtime/simple/GanttChartWithTable.designtime"}});ue.prototype.getEnablePseudoShapes=function(){if(this._bEnablePseudoShapes===undefined){this._bEnablePseudoShapes=Y.fromQuery(window.location.search).get("sap-gantt-xx-EnablePseudoShapes")==="true"}return this._bEnablePseudoShapes||this.getProperty("enablePseudoShapes")};ue.prototype.init=function(){this.iGanttRenderedWidth=-1;this._bExtensionsInitialized=false;this._bSupressShapeChangeEvent=false;this._bRowActionInitialRender=false;this._oExpandModel=new S;this._aExpandedIndices=[];this._oSplitter=new o({id:this.getId()+"-ganttChartSplitter"});this.setAggregation("_splitter",this._oSplitter);this._oSyncedControl=new d;var e=new p;this.setAggregation("_innerGantt",e);this.setAggregation("_header",new g);e.attachEvent("ganttReady",function(e){var t=e.getParameter("supressEvent");if(!t){this.fireRenderingComplete()}}.bind(this));this._sPreviousDisplayType=this.getDisplayType();this.searchTxt=[];this.searchProperty=[];this._createInnerGanttRenderPromise()};ue.prototype.getInnerGantt=function(){return this.getAggregation("_innerGantt")};ue.prototype.onSplitterResize=function(e){var t=e.getParameter("oldSizes"),a=e.getParameter("newSizes"),i=t.length>0&&a.length>0&&(t[0]!==a[0]||t[1]!==a[1]),n=this.getDisplayType(),s=a[0],o=false;if(this._sPreviousDisplayType!==n){o=true;this._isDisplayTypeChanged=true}else{this._isDisplayTypeChanged=false}if(i){if(n===te.Both){this._onResize(i)}var r=function(e){return this.getSelectionPanelSize().startsWith("0")||e[0]!==0}.bind(this);if(de(t.reduce(ge),a.reduce(ge))&&t[0]!==a[0]&&r(t)){this.setProperty("selectionPanelSize",this._oSplitter._getContentAreas()[0].getLayoutData().getSize(),true);this.fireEvent("_selectionPanelResize",{newWidth:s,displayType:n})}if(o){this._isDisplayTypeChanged=true}else{this._isDisplayTypeChanged=false}this._draw()}};ue.prototype.setLayoutData=function(e){this.setAggregation("layoutData",e,true);this.fireEvent("_layoutDataChange");return this};ue.prototype.setDisplayType=function(e){this._sPreviousDisplayType=this.getDisplayType();if(this._sPreviousDisplayType===te.Both&&e!==te.Both){this._iLastTableAreaSize=this.getAggregation("_splitter").getContentAreas()[0]&&this.getAggregation("_splitter").getContentAreas()[0].getLayoutData().getSize()}this._isDisplayTypeChanged=true;this.setProperty("displayType",e,false);if(e===te.Table){this._iLastVisibleWidth=this.getVisibleWidth();this.setProperty("selectionPanelSize","auto",true)}else{delete this._bPreventInitialRender}this._setupDisplayType();return this};ue.prototype.setShapeSelectionSettings=function(e){this.setProperty("shapeSelectionSettings",e,true);if(this._getResizeExtension){this._getResizeExtension().updatemSelectionSettings()}};ue.prototype.setShapeHighlightSettings=function(e){this.setProperty("shapeHighlightSettings",e,true);if(this._getResizeExtension){this._getResizeExtension().updatemHighlightSettings()}};ue.prototype.setSelectionPanelSize=function(e){this.setProperty("selectionPanelSize",e,false);delete this._iLastTableAreaSize;this._setSplitterLayoutData(e,"auto");return this};ue.prototype.applySettings=function(e,t){e=e||{};this._applyMissingSettings(e);i.prototype.applySettings.call(this,e,t);this._initSelectionModel(this.getProperty("shapeSelectionMode"));this._initHighlightModel("Single")};ue.prototype.setShapeRenderOrder=function(e,t){if(typeof t==="undefined"){t=true}e=Array.from(new Set(e));this._aShapeRenderOrder=null;this.setProperty("shapeRenderOrder",e,t)};ue.prototype.setLocale=function(e){var t=this.getLocale();var a=t?t.getTimeZone():null;var i=e.getTimeZone();if(a!==i){this.setAggregation("locale",e);var n=this.getAxisTimeStrategy();if(n){var s=n.getAxisTime();var o=n.getSkipTimePattern();if(s){s.setLocale(e)}if(o){o.setLocale(e)}}}};ue.prototype._applyMissingSettings=function(t){if(!t.axisTimeStrategy){t.axisTimeStrategy=new f}if(!t.locale){t.locale=e.config.DEFAULT_LOCALE.clone()}if(!t.shapeSchemes){t.shapeSchemes=[new m({key:"default",primary:true})]}else{var i=t.shapeSchemes.some(function(e){return e.getPrimary()});if(!i){a.warning("you need set a ShapeSheme with primary:true")}}};ue.prototype.getPrimaryShapeScheme=function(){return this.getShapeSchemes().filter(function(e){return e.getPrimary()})[0]};ue.prototype.getSyncedControl=function(){return this._oSyncedControl};ue.prototype.getTableRowHeights=function(){return this.getSyncedControl().getRowHeights()};ue.prototype.setTable=function(e){this.setAggregation("table",e);e.addCustomData(new W({key:"sap-ui-custom-settings",value:{"sap.ui.dt":{designtime:"sap/gantt/designtime/simple/Table.designtime"}}}));e._bVariableRowHeightEnabled=true;var t=this._oSplitter.removeContentArea(0);this._oSplitter.insertContentArea(new u({content:e,enableRootDiv:true,layoutData:e.getLayoutData()?e.getLayoutData().clone():new r({size:this.getSelectionPanelSize()})}),0);var a=e.getRowActionTemplate();if(a&&a.isA("sap.gantt.simple.GanttRowAction")&&a.getControlTemplate()){R.setTableRowMode(e);if(e.getRowMode()){e.getRowMode().setRowContentHeight(80)}else{e.setRowHeight(80)}}if(t==null){this._oSyncedControl.syncWith(e);this._oSplitter.addContentArea(this._oSyncedControl)}else if(t&&t.getContent()!==e.getId()){this._oSyncedControl.syncWith(e)}e.detachEvent("_rowsUpdated",this._onTableRowsUpdated,this);e.attachEvent("_rowsUpdated",this._onTableRowsUpdated,this);e.attachEvent("columnMove",this._onTableColumnMove,this);e.attachEvent("filter",this._onTableFilter,this);e.attachEvent("sort",this._onTableSorter,this);e.attachEvent("columnVisibility",this._onColumnVisible,this);e.attachEvent("settingsChange",this._onTableSettingsChanged,this)};ue.prototype.setGanttAdaptationData=function(e,t){this.addAggregation("ganttAdaptationData",new j(e,t),true)};ue.prototype.setEnableVariableRowHeight=function(e){if(this.getTable()){this.getTable()._bVariableRowHeightEnabled=e}else{a.warning("you need to set table aggregation first")}};ue.prototype.setLargeDataScrolling=function(e){if(this.getTable()){this.getTable()._setLargeDataScrolling(e)}else{a.warning("you need to set table aggregation first")}};ue.prototype.getRenderedTimeRange=function(){return this.getAxisTime().getTimeRangeSlice(0,this.iGanttRenderedWidth)};ue.prototype._initSelectionModel=function(e){if(this.oSelection){this.oSelection.detachSelectionChanged(this._onSelectionChanged,this)}this.oSelection=new c(e);this.oSelection.attachSelectionChanged(this._onSelectionChanged,this);return this};ue.prototype.setShapeSelectionMode=function(e){this.setProperty("shapeSelectionMode",e,true);if(this.oSelection){this.oSelection.setSelectionMode(e)}return this};ue.prototype._initHighlightModel=function(e){if(this.oHighlight){this.oHighlight.detachHighlightChanged(this._onHighlightChanged,this)}this.oHighlight=new J(e);this.oHighlight.attachHighlightChanged(this._onHighlightChanged,this);return this};ue.prototype.getSelectedShapeUid=function(){return this.oSelection.allUid()};ue.prototype.getSelectedShapeId=function(){return this.oSelection.getSelectedShapeIDS()};ue.prototype.getHighlightedShapeUid=function(){return this.oHighlight.allUid()};ue.prototype.setSelectedShapeUid=function(e){return this.selectShapes(e,true)};ue.prototype.selectShapes=function(e,t){if(!this.oSelection){return this}if((!e||e.length===0)&&t){this._bSupressShapeChangeEvent=false;this.oSelection.clear(true);return this}var a=this._bSupressShapeChangeEvent;this._bSupressShapeChangeEvent=true;if(t){this.oSelection.clear(false);this.getSelection().clearAllSelectedShapeIds()}else{var i=R.getShapeIdFromShapeUid(e);if(i&&i.length>0){i.forEach(function(e){this.getSelection().clearDeselectionModelById(e)}.bind(this))}}this._bSupressShapeChangeEvent=a;this._updateShapes(e,true);return this};ue.prototype._getRowIdPath=function(){return this.getTable().getRowSettingsTemplate().mBindingInfos.rowId&&this.getTable().getRowSettingsTemplate().mBindingInfos.rowId.parts[0].path};ue.prototype._getBindingPaths=function(){var e,t,a,i;var n=this.getTable().getRows();n.forEach(function(n){if(!e||!t||!a||!i){var s=n.getAggregation("_settings");if(s){var o=X.getAllNonLazyAggregations(s);var r=Object.keys(o).filter(function(e){return e.indexOf("shapes")===0}).map(function(e){return s.getAggregation(e)||[]});r.forEach(function(n){if(n&&n.length>0&&(!e||!t||!a||!i)){e=n[0].getBinding("shapeId")&&n[0].getBinding("shapeId").getPath();t=n[0].getBinding("dimensions")&&n[0].getBinding("dimensions").getPath();a=n[0].getBinding("periods")&&n[0].getBinding("periods").getPath();i=n[0].getBinding("stockChartDimensions")&&n[0].getBinding("stockChartDimensions").getPath()}})}}});return{shapeIdPath:e,dimensionsPath:t,periodsPath:a,stockChartDimensionsPath:i}};ue.prototype.findAndSelect=function(e,t,a,i){var n=this.findAll(e,t);if(i){if(a){this.searchTxt=[];this.searchProperty=[]}if(this.searchTxt.indexOf(e)===-1){this.searchTxt.push(e)}if(Array.isArray(t)){this.searchProperty.concat(t)}else if(this.searchProperty.indexOf(t)===-1){this.searchProperty.push(t)}}var s=[];this._bDeselectShapes=false;n.forEach(function(e){if(e.rowID||e.shapeID.length>0){if(i){s.push({rowId:e.rowID,Selected:true})}else{e.shapeID.forEach(function(e){s.push({ShapeId:e,Selected:true})})}e.selected=true}});if(a){this.getSelection().clearAllSelectedShapeIds();this.getSelection().updateShape(null,{selected:false,ctrl:false})}if(s.length>0){this.oSelection.updateSelectedShapes(s,a,this.getId())}};ue.prototype.updateSelectionByShapeID=function(t,a){var i=[];var n=this.getShapeSelectionMode();if(n===e.SelectionMode.Single&&t&&t.length>0){this.oSelection.clear(true);t=t.slice(0,1)}if(t){t.forEach(function(e){i.push({ShapeId:e,Selected:true})})}if(a){a.forEach(function(e){i.push({ShapeId:e,Selected:false})})}this.oSelection.updateSelectedShapes(i,false,this.getId())};ue.prototype.findAndDeselect=function(e,t,a){var i=[];if(e===undefined){return}if(e===""){this.getSelection().clearAllSelectedShapeIds();this.getSelection().updateShape(null,{selected:false,ctrl:false});return}var n=this.findAll(e,t);if(a){this.deSelectTxt=e;this.deSelectProperty=t;if(this.searchTxt.indexOf(e)!==-1){this.searchTxt.splice(this.searchTxt.indexOf(e),1)}if(this.searchProperty.indexOf(t)!==-1){this.searchProperty.splice(this.searchTxt.indexOf(e),1)}}n.forEach(function(e){if(e.rowID||e.shapeID.length>0){if(a){i.push({rowId:e.rowID,Selected:false})}else{e.shapeID.forEach(function(e){i.push({ShapeId:e,Selected:false})})}e.selected=false}});if(i.length>0){this.oSelection.updateSelectedShapes(i,false,this.getId())}};ue.prototype.findAll=function(t,a){var i=[],n=this.getTable().getBinding().getModel().oData,s=this.getFindByOperator(),o={},r=this.getTable().getBinding().sPath.split("/")[1],l=this.getTable().getBinding().mParameters?this.getTable().getBinding().mParameters.arrayNames:null,h=[],p=[],g,d=this._getRowIdPath(),u=this._getBindingPaths(),f=u["shapeIdPath"],c={},S=false;this.pathList={};this.pathList[r]={};this._iNodesLength=0;this._getAllBindingPaths(this.pathList[r],this.getTable().getRowSettingsTemplate());if(!this._aAllShapesFormatters){this._aAllShapesFormatters=[];var m=this.getTable().getRowSettingsTemplate();this._getAllFormatters(m);this._aAllShapesFormatters.forEach(function(e,t){this._aAllShapesFormatters.forEach(function(a,i){if(t!==i){var n=JSON.stringify(e.parts);var s=JSON.stringify(a.parts);if(e.formatter.name===a.formatter.name&&n===s){this._aAllShapesFormatters.splice(i,1)}}}.bind(this))}.bind(this))}Object.keys(n).filter(function(e){if(e.startsWith(r)&&!n[e][u["dimensionsPath"]]&&!n[e][u["periodsPath"]]&&!n[e][u["stockChartDimensionsPath"]]){return true}}).forEach(function(e){var t=Object.assign({},n[e]);this._iNodesLength++;if(l&&l.length>0){l.forEach(function(e){if(t[e]){b.call(this,t[e],e)}}.bind(this))}else if(Array.isArray(t)){t.forEach(function(e){this._iNodesLength++;e.ganttShapeRelated=[];h.push(e)}.bind(this))}else{t.ganttShapeRelated=[];h.push(t)}}.bind(this));if(l&&l.length>0){var y=this.pathList[r];Object.keys(y).forEach(function(e){p.forEach(function(t){if(t[e]&&t[e].length>0){var a=t[d];T(t[e],a,y[e]);h=h.concat(t[e])}})});d=g}else{E(h,this.pathList)}A.call(this,h);Object.keys(o).forEach(function(e){if(e.toLowerCase().includes(t.toString().toLowerCase())){o[e].forEach(function(e){if(e.findAndSelectData.rowID&&e.findAndSelectData.shapeID.length>0){var t=JSON.parse(JSON.stringify(e.findAndSelectData));t.isExpandable=e.isExpandable;t.isParent=e.showParentRowOnExpand;i.push(t);S=true}})}});if(i.length===0){I(this)}if(S){i=i.filter(function(e){var t;if(c.hasOwnProperty(e.shapeID[0])){t=c[e.shapeID[0]];t.sMatchedValue=t.sMatchedValue+", "+e.sMatchedValue;return false}c[e.shapeID[0]]=e;return true})}return i;function b(e,t){e.forEach(function(e){this._iNodesLength++;if(e.hasOwnProperty(t)){b.call(this,e[t],t)}p.push(e)}.bind(this))}function T(e,t,a){e.forEach(function(e){g="row_"+f;e[g]=t;e["shapeIDPath"]=e[a["shapeIDPath"]];if(a.expandable){e.isExpandable=a.expandable}if(a.showParentRowOnExpand!==undefined&&typeof a.showParentRowOnExpand==="boolean"){e.showParentRowOnExpand=a.showParentRowOnExpand}})}function v(e,a){return e[a]!==undefined&&e[a]!==null&&e[a].toString().toLowerCase().indexOf(t.toString().toLowerCase())!==-1}function _(e,t,a){var i=JSON.parse(JSON.stringify(n[a]));t.shapeIDPath.forEach(function(e){if(i[e]){i.shapeIDPath=i[e]}});if(t.expandable){i.isExpandable=t.expandable}if(t.showParentRowOnExpand!==undefined&&typeof t.showParentRowOnExpand==="boolean"){i.showParentRowOnExpand=t.showParentRowOnExpand}if(!e.ganttShapeRelated){e.ganttShapeRelated=[]}e.ganttShapeRelated.push(i)}function E(e,t){e.forEach(function(e){var a=JSON.parse(JSON.stringify(t)),i=Object.keys(a);if(!i.includes("expandable")&&!i.includes("showParentRowOnExpand")){e.showParentRowOnExpand=false}while(a&&i.length>0){var n=true,s=["shapeIDPath","showParentRowOnExpand","expandable"];for(var o=0;o<i.length;o++){if(!s.includes(i[o])){n=false;if(e[a[i[o]].shapeIDPath]){e.shapeIDPath=e[a[i[o]].shapeIDPath]}if(e[i[o]]&&e[i[o]].__list){e[i[o]].__list.forEach(_.bind(null,e,a[i[o]]))}a=JSON.parse(JSON.stringify(a[i[o]]));i=Object.keys(a);o=-1;if(a&&Object.keys(a).length>0&&e.ganttShapeRelated&&e.ganttShapeRelated.length>0){E(e.ganttShapeRelated,a)}}}if(n){a={};i=Object.keys(a)}}})}function x(t,i){var n=false;i.sMatchedValue="";i.oMatchedValue={};if(s===e.simple.findByOperator.AND){n=true;a.forEach(function(e){if(!n){return}if(!v(t,e)){n=false}else{i.sMatchedValue=i.sMatchedValue.concat(t[e]+" ");i.oMatchedValue[e]=t[e]}})}else if(s===e.simple.findByOperator.OR){a.forEach(function(e){if(v(t,e)){n=true;i.sMatchedValue=i.sMatchedValue.concat(t[e]+" ");i.oMatchedValue[e]=t[e]}})}if(n){return t}}function w(e,t){var i=false;t.sMatchedValue="";t.oMatchedValue={};if(v(e,a)){i=true;t.sMatchedValue=t.sMatchedValue.concat(e[a]+" ");t.oMatchedValue[a]=e[a]}if(i){return e}}function D(e,t,a){e.forEach(function(e){R(e,t,a)});return t}function R(e,t,a){if(e[d]){t.rowID=e[d]}Object.keys(e).forEach(function(n){if(n==="ganttShapeRelated"){t=D(e[n],t,a)}else if(v(e,n)){if((e[f]||e.shapeIDPath)&&!t.shapeID.includes(e[f]||e.shapeIDPath)){t.shapeID.push(e[f]||e.shapeIDPath);t.startTime=e[a._startTimePath];t.sMatchedValue=t.sMatchedValue.concat(e[n]+" ");t.oMatchedValue[n]=e[n];var s=JSON.parse(JSON.stringify(t));if(e.isExpandable){s.isExpandable=e.isExpandable}if(e.showParentRowOnExpand!==undefined&&typeof e.showParentRowOnExpand==="boolean"){s.isParent=e.showParentRowOnExpand}s.shapeID=[e[f]||e.shapeIDPath];s.sMatchedValue=e[n];s.data=e;i.push(s)}}});return t}function P(e,t,a){if(e[d]){t.rowID=e[d]}var n=x(e,t);if(n&&(n[f]||n.shapeIDPath)&&!t.shapeID.includes(n[f]||n.shapeIDPath)){t.shapeID.push(n[f]||n.shapeIDPath);t.startTime=n[a._startTimePath];var s=JSON.parse(JSON.stringify(t));if(n.isExpandable){s.isExpandable=n.isExpandable}if(n.showParentRowOnExpand!==undefined&&typeof n.showParentRowOnExpand==="boolean"){s.isParent=n.showParentRowOnExpand}s.shapeID=[n[f]||n.shapeIDPath];s.data=n;i.push(s)}if(e.ganttShapeRelated&&e.ganttShapeRelated.length>0){e.ganttShapeRelated.forEach(function(e){t=P(e,t,a)})}return t}function C(e,t,a){if(e[d]){t.rowID=e[d]}var n=w(e,t);if(n&&(n[f]||n.shapeIDPath)&&!t.shapeID.includes(n[f]||n.shapeIDPath)){t.shapeID.push(n[f]||n.shapeIDPath);t.startTime=n[a._startTimePath];if(n.isExpandable){t.isExpandable=n.isExpandable}if(n.showParentRowOnExpand!==undefined&&typeof n.showParentRowOnExpand==="boolean"){t.isParent=n.showParentRowOnExpand}t.data=n;i.push(t)}if(e.ganttShapeRelated&&e.ganttShapeRelated.length>0){e.ganttShapeRelated.forEach(function(e){t=C(e,t,a)})}return t}function I(e){h.forEach(function(t){var i={rowID:"",shapeID:[],sMatchedValue:"",startTime:null,isExpandable:false,oMatchedValue:{}};if(Array.isArray(a)&&a.length>0){P(t,i,e)}else if(typeof a==="string"&&a!==""){C(t,i,e)}else{R(t,i,e)}})}function A(e){e.forEach(function(e){var t=JSON.parse(JSON.stringify(e)),i={rowID:"",shapeID:[],sMatchedValue:"",startTime:null,isExpandable:false,data:e};if(t[d]){i.rowID=t[d]}if(t[this._startTimePath]){i.startTime=t[this._startTimePath]}if(t.shapeIDPath){i.shapeID.push(t.shapeIDPath)}this._aAllShapesFormatters.forEach(function(e){var n=true,s=[];e.parts.forEach(function(e){var i=e.path.split("/")[0];if(a&&a.length>0&&a.indexOf(i)===-1){n=false}else if(e.model!=="i18n"&&!t[i]){n=false}else if(e.model==="i18n"){s.push(this.getModel("i18n").getResourceBundle().getText(i))}else{var o=new Date(t[i]);if(o.toString()!=="Invalid Date"&&o.toISOString()===t[i]){t[i]=o;s.push(t[i])}else{s.push(t[i])}}}.bind(this));if(n){var r=e.formatter.apply(null,s);if(r!==undefined){if(!o[r.toString()]){o[r.toString()]=[]}i.sMatchedValue=i.sMatchedValue.concat(r.toString()+" ");t.findAndSelectData=i;o[r.toString()].push(t)}}}.bind(this));if(t.ganttShapeRelated&&t.ganttShapeRelated.length>0){A.call(this,t.ganttShapeRelated,i)}}.bind(this))}};ue.prototype._getAllBindingPaths=function(e,t,a){var i=t.mBindingInfos,n=t.mAggregations;if(i){for(var s in i){if(s.toLowerCase().indexOf("calendars")===-1&&s.toLowerCase()!=="relationships"){var o=i[s];if(s==="shapeId"){if(e.shapeIDPath){if(!e.shapeIDPath.includes(o.parts[0].path)){e.shapeIDPath.push(o.parts[0].path)}}else{e.shapeIDPath=[o.parts[0].path]}}if(o.path){var r=o.template.mBindingInfos.shapeId&&o.template.mBindingInfos.shapeId.parts[0].path;if(!e[o.path]){e[o.path]={shapeIDPath:[]}}if(r&&!e[o.path].shapeIDPath.includes(r)){e[o.path].shapeIDPath.push(r)}if(o.template&&o.template.getExpandable&&o.template.getExpandable()){e[o.path].expandable=o.template&&o.template.getExpandable()}if(a){e[o.path].expandable=a}else{e[o.path].showParentRowOnExpand=this.getShowParentRowOnExpand()}this._getAllBindingPaths(e[o.path],o.template,o.template.getExpandable&&o.template.getExpandable())}}}}if(n){var l=function(t){if(!t.isA||t.isA("sap.gantt.simple.BaseShape")&&!t.isA("sap.gantt.simple.UtilizationChart")){this._getAllBindingPaths(e,t)}};for(var h in n){var p=n[h];if(Array.isArray(p)){p.forEach(l.bind(this))}else if(p&&p.isA&&p.isA("sap.gantt.simple.BaseShape")&&!p.isA("sap.gantt.simple.UtilizationChart")){this._getAllBindingPaths(e,p)}}}if(!n&&!i){return false}return true};ue.prototype._getAllFormatters=function(e){var t=e.mBindingInfos,a=e.mAggregations;if(t){for(var i in t){if(i.toLowerCase().indexOf("calendars")===-1&&i.toLowerCase()!=="relationships"){var n=t[i];if(i==="time"){this._startTimePath=n.parts[0].path}if(n.template){this._getAllFormatters(n.template)}else{var s=this._getAllFormatters(n);if(!s&&n.formatter){this._aAllShapesFormatters.push({formatter:n.formatter,parts:n.parts})}}}}}if(a){for(var o in a){var r=a[o];if(Array.isArray(r)){r.forEach(function(e){this._getAllFormatters(e)}.bind(this))}else if(r&&r.isA&&r.isA("sap.gantt.simple.BaseShape")){this._getAllFormatters(r)}}}if(!a&&!t){return false}return true};ue.prototype.deselectShapes=function(e){if(!this.oSelection||!e||e.length===0){return this}this._updateShapes(e,false);return this};ue.prototype._updateShapes=function(e,t){var a={};var i=R.getShapesWithUid(this.getId(),e);for(var n=0;n<e.length;n++){a[e[n]]={selected:t,ctrl:false};if(i[n]){a.draggable=i[n].getDraggable();a.time=i[n].getTime();a.endTime=i[n].getEndTime()}}this.oSelection.updateShapes(a)};ue.prototype._onSelectionChanged=function(e){var t=e.getParameter("shapeUid"),a=e.getParameter("deselectedUid"),i=e.getParameter("silent"),n=e.getParameter("deSelectAll");this._updateShapeSelections(t,a,n);if((!i||this._bDeselectShapes)&&!this._bSupressShapeChangeEvent){this.fireShapeSelectionChange({shapeUids:t})}};ue.prototype._onHighlightChanged=function(e){var t=e.getParameter("shapeUid"),a=e.getParameter("deEmphasizedUid"),i=e.getParameter("silent"),n=e.getParameter("deEmphasizeAll");this.updateShapeHighlights(t,a,n);if((!i||this._bDeselectShapes)&&!this._bSupressShapeChangeEvent){this.fireShapeHighlightChange({shapeUids:t})}};ue.prototype.setTimeForGroupShape=function(e){var t,a;function i(e){if(!t&&!a){t=e.getTime();a=e.getEndTime()}else{if(e.getTime()<t){t=e.getTime()}if(e.getEndTime()>=a){a=e.getEndTime()}}}if(e instanceof sap.gantt.simple.BaseConditionalShape){var n=e._getActiveShapeElement();if(n instanceof sap.gantt.simple.BaseGroup){n.getShapes().forEach(function(e){i(e)});e.setTime(t);e.setEndTime(a)}else if(n){t=n.getTime();a=n.getEndTime();e.setTime(t);e.setEndTime(a)}}else if(e instanceof sap.gantt.simple.BaseGroup&&!(e.getTime()&&e.getEndTime())){e.getShapes().forEach(function(e){i(e)});e.setTime(t);e.setEndTime(a)}return e};ue.prototype.handleShapePress=function(t){var a=t.shape,i=a.getShapeUid(),n=t.ctrlOrMeta,s=this._getDragDropExtension();var o=!a.getSelected();if(s.shapeSelectedOnMouseDown&&!s.initiallySelected&&!this.getEnableSelectAndDrag()){o=s.shapeSelectedOnMouseDown}this.setTimeForGroupShape(a);var r=this.getShapeSelectionMode();if(r!==e.SelectionMode.Multiple&&r!==e.SelectionMode.MultipleWithLasso&&!n){if(this.getSelectedShapeUid().length>0){this._bDeselectShapes=true}else{this._bDeselectShapes=false}this.oSelection.clearAllSelectedShapeIds();this.searchTxt=[];this.searchProperty=[]}else{var l=R.getShapeIdFromShapeUid([i]);if(l&&l.length>0){l.forEach(function(e){this.getSelection().clearDeselectionModelById(e)}.bind(this))}}this.oSelection.updateShape(i,{selected:o,ctrl:n,draggable:a.getDraggable(),time:a.getTime(),endTime:a.getEndTime()});s.shapeSelectedOnMouseDown=false};ue.prototype.handleShapeMouseEnter=function(e){if(!this.getEnableSelectAndDrag()){var t=e.shape,a=this._getResizeExtension();if(!t.getSelected()){a.addResizerOnMouseOver(t)}var i=this._getDragDropExtension();if(t.getDraggable()){i.updateCursorStyle("move")}}};ue.prototype.handleShapeMouseLeave=function(e){if(!this.getEnableSelectAndDrag()){var t=this._getDragDropExtension();t.updateCursorStyle("default")}};ue.prototype._updateShapeSelections=function(t,a,i){var n=this.getShapeSelectionMode();if(n===e.SelectionMode.None){return}if(this.oSelection.getSelectedShapeIDS().length>0||this.oSelection.getSelectedRowIDS().length>0||this.oSelection.getDeSelectedShapeIDS().length>0||this.oSelection.getDeSelectedRowIDS().length>0){P.updateShapeSelectionByShapeID(this,i)}P.updateShapeSelections(this,this.getSelection().allUid(),a)};ue.prototype.updateShapeHighlights=function(e,t){if(this.oHighlight.getHighlightedShapeID().length>0||this.oHighlight.getDeEmphasizedShapeID().length>0){P.updateShapeHighlightByShapeID(this,t)}P.updateShapeHighlights(this,this.getHighlight().allUid(),e)};ue.prototype._updateVsbContainers=function(){if(this.getParent().isA("sap.gantt.simple.GanttChartContainer")&&this.getParent().getGanttCharts().length>1){var e=this.getParent().getGanttCharts();var t=false;var a,i,n;for(a=0;a<e.length;a++){i=e[a];n=i.getTable()._getScrollExtension().getVerticalScrollbar();if(n&&!n.parentElement.classList.contains("sapUiTableHidden")){t=true;break}}if(t){for(a=0;a<e.length;a++){i=e[a];n=i.getTable()._getScrollExtension().getVerticalScrollbar();if(n){var s=n.parentElement.classList,o=n.classList;if(s.contains("sapUiTableHidden")){s.add("sapGanttTableVerticalScrollBarContainer");o.add("sapGanttTableVerticalScrollBar")}else{s.remove("sapGanttTableVerticalScrollBarContainer");o.remove("sapGanttTableVerticalScrollBar")}}}}else{for(a=0;a<e.length;a++){i=e[a];n=i.getTable()._getScrollExtension().getVerticalScrollbar();var s=n.parentElement.classList,o=n.classList;if(n){s.remove("sapGanttTableVerticalScrollBarContainer");o.remove("sapGanttTableVerticalScrollBar")}}}}};ue.prototype.getSelection=function(){return this.oSelection};ue.prototype.getHighlight=function(){return this.oHighlight};ue.prototype.getExpandedBackgroundData=function(){if(this._oExpandModel.hasExpandedRows()){var e=this.getTable().getRows();var t=e.length;var a=this.getTable().getFirstVisibleRow();var i=[];for(var n=0;n<t;n++){if(e[n].getIndex()>=a){var s=e[n].getAggregation("_settings");i.push(s.getRowUid())}}return this._oExpandModel.collectExpandedBgData(i,this.getExpandedRowHeight(),this.getShowParentRowOnExpand()&&!this.getUseParentShapeOnExpand())}};ue.prototype.setAxisTimeStrategy=function(e){e.attachEvent("_redrawRequest",this._onRedrawRequest,this);delete this._bPreventInitialRender;return this.setAggregation("axisTimeStrategy",e,false)};ue.prototype._addChangesToControlPersonalizationWriteAPI=function(e,t){var a=this.getParent();var i=a.isA("sap.gantt.simple.GanttChartContainer");var n=i&&a.getEnableVariantManagement()||this.getProperty("_isAppRunningInRTA");if(this.getEnablePseudoShapes()){this._tableDataUpdated=true}if(!e.bPreventDefault&&n){Z.add({changes:t})}};ue.prototype._onTableFilter=function(e){var t=[{selectorElement:e.mParameters.column,changeSpecificData:{changeType:"TableColumnFilterValue",content:{propertyName:"filterValue",newValue:e.mParameters.value,oldValue:""}}}];this._addChangesToControlPersonalizationWriteAPI(e,t)};ue.prototype._onTableSorter=function(e){var t=e.getParameter("column");var a=t.getParent();var i=[];a.getColumns().forEach(function(e){if(e!==t){i.push(e.getId())}});var n=[{selectorElement:t,changeSpecificData:{changeType:"TableColumnSortOrder",content:{propertyName:"sortOrder",newValue:e.getParameter("sortOrder"),oldValue:t.getSortOrder(),affectedControls:i}}}];this._addChangesToControlPersonalizationWriteAPI(e,n)};ue.prototype.multiColumnSort=function(e){var t=e.control;var a=e.oColumns;var i=e.oldValues;var n=[];t.getColumns().forEach(function(e){if(a.indexOf(e)==-1){n.push(e.getId())}});var s=[{selectorElement:t,changeSpecificData:{changeType:"TableColumnSortOrder",content:{propertyName:"sortOrder",columns:a.map(e=>e.getId()),newValue:a.map(e=>e.getSortOrder()),oldValue:i,affectedControls:n}}}];this._addChangesToControlPersonalizationWriteAPI(e,s)};ue.prototype._onColumnVisible=function(e){var t=e.mParameters.newVisible;var a=[{selectorElement:e.mParameters.column,changeSpecificData:{changeType:"TableColumnVisibility",content:{propertyName:"visible",newValue:t,oldValue:!t}}}];this._addChangesToControlPersonalizationWriteAPI(e,a)};ue.prototype._onTableColumnMove=function(e){var t=e.getSource().getAggregation("columns").map(function(e){return e.getId()});var a=e.getParameter("column").getIndex();var i=e.getParameter("newPos");var n=Array.from(new Set(t));var s=R.arrayMove(n,a,i);var o=[];s.forEach(function(t,a){var i=e.getSource().getAggregation("columns").find(function(e){return e.getId()===t});o.push(i.getId())});var r=[];r.push({selectorElement:this.getTable(),changeSpecificData:{changeType:"GanttTableColumnOrder",content:{aggregationName:"columns",newValue:o,oldValue:t}}});this._addChangesToControlPersonalizationWriteAPI(e,r)};ue.prototype._onTableSettingsChanged=function(e){this._bRowActionInitialRender=false;if(this.getEnablePseudoShapes()){this._tableDataUpdated=true}};ue.prototype._onTableRowsUpdated=function(e){performance.mark("GanttChartWithTable._onTableRowsUpdated--start");if(!this.getVisible()){performance.mark("GanttChartWithTable._onTableRowsUpdated--end");return}var t=e.getParameter("reason"),a=this.getInnerGantt(),i=e.getSource();this._invalidateRowActionTemplate(i,t);if(this.getEnablePseudoShapes()&&this.pseudoShapeSpecificData&&(this.pseudoShapeSpecificData.oDraggedShapeDates&&this.pseudoShapeSpecificData.draggedShapeTRowIndex!=null||this.pseudoShapeSpecificData.resizedShape&&this.pseudoShapeSpecificData.resizedShapeRowIndex!=null)){var n=this.pseudoShapeSpecificData.oDraggedShapeDates,s=this.getTable().getRows(),o;if(this.pseudoShapeSpecificData.draggedShapeTRowIndex!=undefined){o=[];Object.keys(n).forEach(function(e){var t=R.getShapesWithUid(this.getId(),[e])[0];var a=t?R.getRowInstancefromShape(t).getIndex():this.pseudoShapeSpecificData.draggedShapeTRowIndex;if(o.indexOf(a)==-1){o.push(a)}var i,n;s[a]&&s[a].getAggregation("_settings").getTasks&&s[a].getAggregation("_settings").getTasks().forEach(function(e){if(t&&e.aShapeIds&&e.aShapeIds.length>1&&e.aShapeIds.indexOf(this.oOverlapShapeIds&&this.oOverlapShapeIds[a]&&this.oOverlapShapeIds[a][0])>-1){i=e.getTask().getTime();n=e.getTask().getEndTime();if(i>t.getTime()&&t.getEndTime()>i||n>t.getTime()&&t.getEndTime()>n||i>t.getTime()&&n<t.getEndTime()||t.getTime()>i&&t.getEndTime()<n){this.oOverlapShapeIds&&this.oOverlapShapeIds[a].push(t.getShapeId())}}}.bind(this))}.bind(this))}o=o?o:[this.pseudoShapeSpecificData.resizedShapeRowIndex];o.forEach(function(e){e=Number(e);var t=s[0].getIndex();var a=R.pseudoShapeGroupAfterEdit(this,e);var i=true;if(a){for(var n=0;n<a.length;n++){if(a[n].iShapeCount>1){i=false}}}var o=this._oExpandModel.mExpanded[s[e-t].getAggregation("_settings").getRowUid()];this._bUpdateTriggeredDueToExpandCollapse=true;if(this._aExpandedIndices.indexOf(e)>-1&&i&&o&&o[1]&&o[1].expandSchemeShape){this._collapse(null,e,true)}}.bind(this));this.pseudoShapeSpecificData.oDraggedShapeDates=null;this.pseudoShapeSpecificData.draggedShapeTRowIndex=null;this.pseudoShapeSpecificData.resizedShape=null;this.pseudoShapeSpecificData.resizedShapeRowIndex=null}if(!this.pseudoShapeSpecificData){this.pseudoShapeSpecificData={}}if(this.getEnablePseudoShapes()){this.pseudoShapeSpecificData.isPseudoShapesEnabled=true;if(!this._bUpdateTriggeredDueToExpandCollapse||this._tableDataUpdated){if(this._bUpdateTriggeredDueToExpandCollapse){this._bUpdateTriggeredDueToExpandCollapse=false}this._addBackTasksToRows();this._tableDataUpdated=false}else{this._bUpdateTriggeredDueToExpandCollapse=false}}else if(this.pseudoShapeSpecificData.isPseudoShapesEnabled||this.bModifiedAggrTasks){this.pseudoShapeSpecificData.isPseudoShapesEnabled=false;this._addBackTasksToRows()}var r=pe.indexOf(t)!==-1;if(!r&&t!=="VerticalScroll"||this._createInnerGanttRenderPromise()){this.getInnerGantt().invalidate()}if(r){this.getSyncedControl().setAllowContentScroll(false);this._oInnerGanttRenderPromiseResolve()}else if(t==="VerticalScroll"){var l=this._getDragDropExtension();if(l._bEnableRowHighlight&&l.isDragging()){l.getShapeDndRowHighlightIndex(this);this.toggleDnDRowHighlight(true)}this._oInnerGanttRenderPromiseResolve()}else{a.getRenderer().renderImmediately(this)}performance.mark("GanttChartWithTable._onTableRowsUpdated--end")};ue.prototype._getPossibleShapesInGantt=function(){return Object.keys(this.getTable().getRowSettingsTemplate().getMetadata().getAllAggregations()).filter(function(e){return["tooltip","customData","layoutData","dependents","dragDropConfig","relationships","pseudoShapeTemplate"].indexOf(e)==-1&&e.indexOf("overlay")==-1&&e.indexOf("calendars")==-1})};ue.prototype._addBackTasksToRows=function(e){var t=this.getTable();var a=t.getBindingInfo("rows");var i=a&&a.model;var n=t.getModel(i);var s=t.getRowSettingsTemplate();var o=this._getPossibleShapesInGantt();var r=[],l=false;o.forEach(function(e){var t=s.getBindingInfo(e);r.push(t);if(t){l=true}});var h=t.getRows();var p=new q;if(l){var g=function(e){var t=[],a,i=[];r.forEach(function(t){if(t){i.push(e.getProperty(t.path))}else{i.push([])}});i.forEach(function(i,s){i.forEach(function(i,l){if(n.isA("sap.ui.model.json.JSONModel")){var h=e+"/"+r[s].path+"/"+l;a=n.getContext(h)}else{a=n.getContext("/"+i)}a.aggrType=o[s];var p=r[s].template.getBindingInfo("time"),g=r[s].template.getBindingInfo("endTime"),d=r[s].template.getAggregation("shapes"),u=r[s].template.getAggregation("task");a.timeFormatter=p&&p.formatter||d&&d[l]&&d[l].getBindingInfo("time")&&d[l].getBindingInfo("time").formatter||u&&u.getBindingInfo("time")&&u.getBindingInfo("time").formatter;a.endTimeFormatter=g&&g.formatter||d&&d[l]&&d[l].getBindingInfo("endTime")&&d[l].getBindingInfo("endTime").formatter||u&&u.getBindingInfo("endTime")&&u.getBindingInfo("endTime").formatter;t.push(a)})});return{aContext:t}};var d;if(s.getPseudoShapeTemplate){d=s.getPseudoShapeTemplate()}var u=this.getEnablePseudoShapes()&&(d?d.getTypeOfOverlapIndicator():p.getTypeOfOverlapIndicator())!="Indicator";if(!e){var f=this._aExpandedIndices,c;if(u){this.destroyAggregation("_pseudoSvgDefs",true);this._oSvgDefs=new K({id:this.getId()+"_GradientColorForPseudoShape"})}h.forEach(function(e){var t=e.getAggregation("_settings");o.forEach(function(e){var a=t.removeAllAggregation(e,true);Array.isArray(a)&&a.forEach(function(e){e.destroy()})});this.bModifiedAggrTasks=true;var a=e.getBindingContext(i),n=[];if(a){n=g(a).aContext;c=this.oOverlapShapeIds&&this.oOverlapShapeIds[e.getIndex()]&&this.oOverlapShapeIds[e.getIndex()].length>0;if(f.indexOf(e.getIndex())>-1&&!c||!this.getEnablePseudoShapes()){n.forEach(function(e){var a=r[o.indexOf(e.aggrType)];if(a){var n=a.template.clone();n.setBindingContext(e,i);t.addAggregation(e.aggrType,n,true)}})}else{p._createShapesFromContext(n,e,r,this,true,-1,u)}}}.bind(this))}else{if(typeof e.aIndices==="number"){e.aIndices=[e.aIndices]}e.aIndices.forEach(function(t){var a=h[t-this.getTable().getRows()[0].getIndex()];var n=a.getAggregation("_settings");o.forEach(function(e){var t=n.removeAllAggregation(e,true);Array.isArray(t)&&t.forEach(function(e){e.destroy()})});var s=a.getBindingContext(i),l=[];if(s){l=g(s).aContext}if(e.bExpanded&&!e.bPseudoExpand||!this.getEnablePseudoShapes()){l.forEach(function(e){var t=r[o.indexOf(e.aggrType)];if(t){var a=t.template.clone();a.setBindingContext(e,i);n.addAggregation(e.aggrType,a,true)}})}else{var d=e.bExpanded;p._createShapesFromContext(l,a,r,this,d,t,u)}}.bind(this))}if(u){this.setAggregation("_pseudoSvgDefs",this._oSvgDefs,true)}}};ue.prototype.syncVisibleHorizon=function(e,t,a,i){var n=this.getAxisTimeStrategy();var s=n.getTotalHorizon();var o;var r=this.getVisibleWidth();if(t!==undefined){if(r===undefined){return}if(a){var l=n.getVisibleHorizon();var h=C.abapTimestampToDate(l.getStartTime());o=I.calculateHorizonByWidth(e,t,r,h)}else{o=I.calculateHorizonByWidth(e,t,r)}}else{o=e}if(s.getEndTime()<o.getEndTime()){var p=C.abapTimestampToDate(o.getEndTime()).getTime()-C.abapTimestampToDate(o.getStartTime()).getTime();var g=C.abapTimestampToDate(s.getEndTime());var d=new Date;d.setTime(g.getTime()-p);o=new A({startTime:d,endTime:g})}this._updateVisibleHorizon(o,i||"syncVisibleHorizon",r)};ue.prototype._syncBirdEyeHorizon=function(e){var t=this.getAxisTimeStrategy();var a=t.getTotalHorizon();var i=this.getVisibleWidth(),n=e;n=new A({startTime:n.getStartTime()<a.getStartTime()?a.getStartTime():n.getStartTime(),endTime:n.getEndTime()>a.getEndTime()?a.getEndTime():n.getEndTime()});this._updateVisibleHorizon(n,"syncVisibleHorizon",i)};ue.prototype._updateVisibleHorizon=function(e,t,a){var i=this.getAxisTimeStrategy();i.updateGanttVisibleWidth(a);var n=i._oZoom.base.timeLineOption.innerInterval,s=i.getTimeLineOption().innerInterval;var o=(n.unit!=s.unit||i._getTimeLineRange(i._oZoom.base.timeLineOption)!=i._getTimeLineRange(i.getTimeLineOption())||n.span!=s.span)&&t!="horizontalScroll"&&t!="jumpToPosition"&&t!="syncVisibleHorizon";if(t==="initialRender"||o){if(!i.isA("sap.gantt.axistime.StepwiseZoomStrategy")){i.calZoomBase()}if(t==="initialRender"||!i.isA("sap.gantt.axistime.StepwiseZoomStrategy")&&o){i.createAxisTime(this.getLocale())}}if(e&&(e.getStartTime()||e.getEndTime())){i.setVisibleHorizonWithReason(e,t)}};ue.prototype.syncMouseWheelZoom=function(e){this._getZoomExtension().performMouseWheelZooming(e.originEvent,true)};ue.prototype.syncTimePeriodZoomOperation=function(e,t,a){this._getZoomExtension().syncTimePeriodZoomOperation(e,t,a)};ue.prototype._onRedrawRequest=function(e){var t=e.getParameter("valueBeforeChange");var a=e.getParameter("reasonCode");var i=e.getParameter("subReasonCode");if(t&&a!=="totalHorizonUpdated"&&a!=="initialRender"&&a!=="syncVisibleHorizon"){if(a=="horizontalScroll"&&this.getHorizontalLazyLoadingEnabled()){if(this._isAllDataLoadedPromiseResolved){this._syncContainerGanttCharts(a,e.getParameter("originEvent"))}}else{this._syncContainerGanttCharts(a,e.getParameter("originEvent"))}}if(this._sPreviousDisplayType!==this.getDisplayType()){this._isDisplayTypeChanged=true}else{this._isDisplayTypeChanged=false}var n,s,o,r;if(a!=="initialRender"){s=this.getRenderedTimeRange();n=new A({startTime:s[0],endTime:s[1]})}if(a=="horizontalScroll"&&this.getHorizontalLazyLoadingEnabled()){if(this._isAllDataLoadedPromiseResolved){this.redraw(a)}}else{this.redraw(a)}r=this.getRenderedTimeRange();o=new A({startTime:r[0],endTime:r[1]});this.fireVisibleHorizonUpdate({type:se[a],subType:i?ie[i]:ie.NotApplicable,lastVisibleHorizon:t,currentVisibleHorizon:this.getAxisTimeStrategy().getVisibleHorizon(),lastRenderedVisibleHorizon:n?n:o,currentRenderedVisibleHorizon:o})};ue.prototype.redraw=function(e){this._draw(e)};ue.prototype._draw=function(e){if(this.getDisplayType()===te.Table&&!this.isPrint){var t=X.getAllNonLazyAggregations(this.getParent());if(this.getParent().isA("sap.gantt.simple.GanttChartContainer")&&t.toolbar){this.getParent().getToolbar().updateZoomLevel(this.getAxisTimeStrategy().getZoomLevel())}}else{var a=this._iLastVisibleWidth?this._iLastVisibleWidth:this.getVisibleWidth();if(!a){return}var i=this.getAxisTimeStrategy();var n=i.syncContext(a);if(i.initialSettings!=null&&i.initialSettings.zoomLevel!=null&&i.initialSettings.zoomLevel!=0&&e=="initialRender"&&!i.isA("sap.gantt.axistime.FullScreenStrategy")&&!this.isPrint&&this.getParent().isA("sap.gantt.simple.GanttChartContainer")&&!this.getParent().isZoomLevelUpdated){var s=i.initialSettings.zoomLevel;i.setProperty("zoomLevel",s,true);n.zoomLevel=s;var o=i.calVisibleHorizonByRate(i._aZoomRate[s]);i.updateInitialVisibleHorizon(o,s);this.getParent().isZoomLevelUpdated=true}if(e=="initialRender"){var r=i._completeTimeHorizon(new A({startTime:i.getVisibleHorizon().getStartTime()}));i.getVisibleHorizon().setProperty("endTime",r.getEndTime(),true)}this.fireEvent("_zoomInfoUpdated",n);this._iLastVisibleWidth=null;var l=this._getScrollExtension();if(n.axisTimeChanged){l.clearOffsetWidth()}l.needRerenderGantt(function(){this.oExpandedShapesMap={};this.getInnerGantt().getRenderer().renderImmediately(this)}.bind(this),e)}};ue.prototype._syncContainerGanttCharts=function(e,t){var a=this.getParent();if(a&&a.isA("sap.gantt.simple.GanttChartContainer")&&a.getGanttCharts().length>1){this.fireEvent("_initialRenderGanttChartsSync",{reasonCode:e,visibleHorizon:this.getAxisTimeStrategy().getVisibleHorizon(),visibleWidth:this.getVisibleWidth(),originEvent:t})}};ue.prototype.onBeforeRendering=function(e){performance.mark("GanttChartWithTable--start");this._updateRowHeightInExpandModel(this.getTable());y.detachEvents(this);this._oSplitter.detachResize(this.onSplitterResize,this);if(this._sResizeHandlerId){l.deregister(this._sResizeHandlerId)}if(this.getDisplayType()!==te.Table){if(this._bPreventInitialRender){delete this._bPreventInitialRender}if(this.getEnablePseudoShapes()){this._createInnerGanttRenderPromise()}this.getInnerGantt().invalidate()}var t=this.getTable();if(this.getShowExportTableToExcel()&&!this._enableOptimisation&&this.getShowGanttHeader()){if(this.oExportTableToExcelButton==null){this.oExportTableToExcelButton=new N(this.getId()+"-exportTableToExcelButton",{icon:"sap-icon://excel-attachment",tooltip:oe.getText("EXPORT_BUTTON_TEXT"),type:sap.m.ButtonType.Transparent,buttonMode:sap.m.MenuButtonMode.Split,useDefaultActionOnly:true,defaultAction:[function(){this._exportTableToExcel()},this],menu:[new U({items:[new k({text:oe.getText("QUICK_EXPORT"),press:[function(){this._exportTableToExcel()},this]}),new k({text:oe.getText("EXPORT_WITH_SETTINGS"),press:[function(){this._createExportDialogBox()},this]})]})]})}R.addToolbarToTable(this,t,true)}else if(!this.getShowExportTableToExcel()&&(t.getExtension().length>0&&!(t.getExtension()[0].getContent().indexOf(this.oExportTableToExcelButton)===-1))){if(t.getExtension()[0].getContent().length==1){t.removeExtension(t.getExtension()[0])}else if(t.getExtension()[0].getContent().length>1){t.getExtension()[0].removeContent(this.oExportTableToExcelButton)}}this._invalidateRowActionTemplate(t)};ue.prototype._invalidateRowActionTemplate=function(e,t){var a=e.getRowActionTemplate();if(a&&a.isA("sap.gantt.simple.GanttRowAction")&&a.getControlTemplate()){if(!this._bRowActionInitialRender&&t==="Render"){this._bRowActionInitialRender=true;a.invalidate()}else if(t==="Unbind"){this._bRowActionInitialRender=false}else if(t!=="Render"&&t!=="Unbind"){a.invalidate()}}};ue.prototype.fullScreenMode=function(){if(this._bFullScreen){return true}else{return false}};ue.prototype.toggleFullScreen=function(e,t){var a;var i=this.getParent();if(!i.isA("sap.gantt.simple.GanttChartContainer")){return null}if(!i._oFullScreenUtil){i._oFullScreenUtil=h}if(this._bFullScreen){this._bFullScreen=false;i._bHideToolbar=false;i._bHideVariant=false;i.setHeight(this._fContainerHeight);i._bNoResize=true;for(var n in this._mGanttCharts){i.insertGanttChart(this._mGanttCharts[n],n)}i._bNoResize=false;a=i.getGanttCharts();var s=i.getEnableTimeScrollSync();var o=this.getAxisTimeStrategy().getVisibleHorizon();var r=this.getAxisTimeStrategy().getZoomLevel();a.forEach(function(e,t){if(s){e.getAxisTimeStrategy().getVisibleHorizon().setStartTime(o.getStartTime());e.getAxisTimeStrategy().getVisibleHorizon().setEndTime(o.getEndTime());e.getAxisTimeStrategy().setProperty("zoomLevel",r,true)}else if(e.getId()!==this.getId()){e.getAxisTimeStrategy().getVisibleHorizon().setStartTime(this._aVisibleHorizons[t].startTime);e.getAxisTimeStrategy().getVisibleHorizon().setEndTime(this._aVisibleHorizons[t].endTime)}i._oSplitter.getContentAreas()[t].getLayoutData().setSize(this._aSplitterLayoutSizes[t])}.bind(this));this._bRenderFullScreenGantt=true;i._oFullScreenUtil.toggleFullScreen(i,false,t,this.toggleFullScreen)}else{this._bFullScreen=true;a=i.getGanttCharts();this._aSplitterLayoutSizes=[];this._mGanttCharts={};this._aVisibleHorizons=[];a.forEach(function(e,t){this._aSplitterLayoutSizes.push(i._oSplitter.getContentAreas()[t].getLayoutData().getSize());this._aVisibleHorizons.push({startTime:e.getAxisTimeStrategy().getVisibleHorizon().getStartTime(),endTime:e.getAxisTimeStrategy().getVisibleHorizon().getEndTime()});if(e.getId()!==this.getId()){this._mGanttCharts[t]=e}}.bind(this));i._bNoResize=true;a.forEach(function(e){if(e.getId()!==this.getId()){i.removeGanttChart(e)}}.bind(this));i._bNoResize=false;i._bHideToolbar=!e;i._bHideVariant=true;this._fContainerHeight=i.getHeight();i.setHeight(window.innerHeight+"px");this._bRenderFullScreenGantt=true;i._oFullScreenUtil.toggleFullScreen(i,true,t,this.toggleFullScreen)}i.updateSearch()};ue.prototype.onAfterRendering=function(e){this._attachExtensions();y.attachEvents(this);this._oSplitter.attachResize(this.onSplitterResize,this);this._sResizeHandlerId=l.register(this,this._onResize.bind(this));var t=this.getShapeRenderOrder();if(!this._aShapeRenderOrder&&t&&t.length>0){var a=Object.keys(this.getTable().getRowSettingsTemplate().getMetadata().getAllAggregations());this._aShapeRenderOrder=a.filter(function(e){return t.indexOf(e)===-1&&e.indexOf("overlay")==-1}).concat(t);if(this._aShapeRenderOrder.indexOf("pseudoShapes")==-1){this._aShapeRenderOrder.push("pseudoShapes")}}if((this.mProperties.hasOwnProperty("height")||this.getParent()&&this.getParent().mProperties.hasOwnProperty("height"))&&!this._enableOptimisation){var i=this.getTable();var n=i.getRowMode();if(n){if(n.isA("sap.ui.table.rowmodes.Auto")){n.setMinRowCount(1)}else if(n.isA("sap.ui.table.rowmodes.RowMode")){i.setRowMode(new Q({rowContentHeight:n.getRowContentHeight(),fixedBottomRowCount:n.getFixedBottomRowCount(),fixedTopRowCount:n.getFixedTopRowCount(),minRowCount:1}))}else{i.setRowMode(new Q({minRowCount:1}))}}if(!n){i.setVisibleRowCountMode(sap.ui.table.VisibleRowCountMode.Auto);i.setMinAutoRowCount(1)}}performance.mark("GanttChartWithTable--end")};ue.prototype._onResize=function(e){if(this.getDisplayType()!==te.Both){return}var t=this.getAggregation("_splitter");this._sPreviousDisplayType=this.getDisplayType();if(this._sPreviousDisplayType===te.Both){this._iLastTableAreaSize=this.getAggregation("_splitter").getContentAreas()[0]&&this.getAggregation("_splitter").getContentAreas()[0].getLayoutData().getSize()}if(t.getContentAreas()[0]&&t.getContentAreas()[0].getLayoutData()){var a=t.getContentAreas()[0],i=a.getLayoutData(),n=this.getDomRef().offsetWidth,s;if(n>0&&n<le*2){s=n/2;s=s+"px"}else{var o=a.getDomRef().offsetWidth;if(o>le){return}if(this.getSelectionPanelSize()!=null&&o==0&&e!=true){s=this.getSelectionPanelSize()}else{s=Math.max(Math.min(o,n-le),Math.max(.3*n,le));s=s+"px"}}i.setSize(s)}};ue.prototype._setupDisplayType=function(){var e=this.getDisplayType();this._isDisplayTypeChanged=true;if(e===te.Table){var t=this.getSyncedControl().$().find(".sapGanttBackgroundVScrollContentArea").width();if(t!==null){this._setSplitterLayoutData("auto",t+"px")}}else if(e===te.Chart){this._setSplitterLayoutData("1px","auto")}else if(e!==this._sPreviousDisplayType){this._setSplitterLayoutData(this._iLastTableAreaSize?this._iLastTableAreaSize:this.getSelectionPanelSize(),"auto")}};ue.prototype._setSplitterLayoutData=function(e,t){var a=this._oSplitter.getContentAreas();if(a.length>1){var i=a[0].getLayoutData(),n=a[1].getLayoutData(),s=this.getDisplayType()===te.Both;i.setSize(e).setResizable(s);n.setSize(t).setResizable(s)}};ue.prototype._updateRowHeightInExpandModel=function(e){R.setTableRowMode(e);var t=e.getRowMode(),a=0;if(t){a=Math.ceil(t.getRowContentHeight())}else{a=Math.ceil(e.getRowHeight())}if(a===0){a=Math.ceil(e._getDefaultRowHeight())}this._oExpandModel.setBaseRowHeight(a)};ue.prototype.jumpToPosition=function(e){if(Object.prototype.toString.call(e)==="[object Date]"||typeof e==="string"){this._updateVisibleHorizon(new A({startTime:e}),"jumpToPosition",this.getVisibleWidth())}else if(Array.isArray(e)){this._updateVisibleHorizon(new A({startTime:e[0],endTime:e[1]}),"jumpToPosition",this.getVisibleWidth())}else if(e===undefined){this._updateVisibleHorizon(this.getAxisTimeStrategy().getTotalHorizon(),"jumpToPosition",this.getVisibleWidth())}};ue.prototype.exit=function(){if(this._sResizeHandlerId){l.deregister(this._sResizeHandlerId)}this._detachExtensions();delete this._bPreventInitialRender};ue.prototype._attachExtensions=function(){if(this._bExtensionsInitialized){return}y.enrich(this,b);y.enrich(this,T);y.enrich(this,v);y.enrich(this,_);y.enrich(this,E);y.enrich(this,x);y.enrich(this,w);y.enrich(this,D);this._bExtensionsInitialized=true};ue.prototype._detachExtensions=function(){y.cleanup(this)};ue.prototype.getAxisTime=function(){var e=this.getAxisTimeStrategy();if(e){var t=e.getAxisTime();if(!t){e.createAxisTime(this.getLocale());t=e.getAxisTime()}return t}};ue.prototype.getContentWidth=function(){var e=this.getAxisTime(),t=e.getViewRange();return Math.abs(Math.ceil(t[1])-Math.ceil(t[0]))-1};ue.prototype.getVisibleWidth=function(){return this._getScrollExtension?this._getScrollExtension().getVisibleWidth():undefined};ue.prototype.expand=function(e,t){if(typeof e==="string"){e=[e]}if(this.oOverlapShapeIds&&this.oOverlapShapeIds[t]&&this.oOverlapShapeIds[t].length>0){delete this.oOverlapShapeIds[t];var a=this.getTable().getRows();delete this._oExpandModel.mExpanded[a[t-a[0].getIndex()].getAggregation("_settings").getRowUid()]}this._expand(e,t)};ue.prototype._expand=function(e,t,a){if(this.getEnablePseudoShapes()){this._addBackTasksToRows({aIndices:t,bExpanded:true,bPseudoExpand:a})}if(a){this.toggleShapeScheme(true,e,t,a)}else{this.toggleShapeScheme(true,e,t)}this._aExpandedIndices=this._aExpandedIndices.concat(t);this._aExpandedIndices=Array.from(new Set(this._aExpandedIndices))};ue.prototype.collapse=function(e,t){if(typeof aSchemeKey==="string"){e=[e]}this._collapse(e,t)};ue.prototype._collapse=function(e,t,a){var i=[];i=i.concat(t);if(this.getEnablePseudoShapes()){this._addBackTasksToRows({aIndices:t,bExpanded:false})}if(a){this.toggleShapeScheme(false,e,t,a)}else{this.toggleShapeScheme(false,e,t)}this._aExpandedIndices=this._aExpandedIndices.filter(function(e){return i.indexOf(e)==-1});if(i.indexOf(t)>-1&&this.oOverlapShapeIds){delete this.oOverlapShapeIds[i]}};ue.prototype.toggleShapeScheme=function(e,a,i,n){var s=[];if(typeof i==="number"){s=[i]}else if(Array.isArray(i)){s=i}if(s.length===0||(!a||a&&!a.length)&&!n){return}var o=a&&this.getShapeSchemes().filter(function(e){return a.indexOf(e.getKey())>-1});if(!n&&(o==null||o.length===0)){t(false,"shape scheme must not be null or not found in shapeSchemes");return}var r=this.getPrimaryShapeScheme();this._syncRowExpandState(i,e,n);this._bExpandToggled=this._oExpandModel.isTableRowHeightNeedChange(e,this.getTable(),s,r,o);if(this._bExpandToggled){if(this.getEnablePseudoShapes()){this._bUpdateTriggeredDueToExpandCollapse=true}this._createInnerGanttRenderPromise();this.getTable().invalidate()}else{this._syncRowExpandState(i,!e,n)}};ue.prototype.isShapeVisible=function(e){if(e&&e.isVisible()){return true}if(!e.getVisible()){return false}var t=this.getRenderedTimeRange(),a=t[0],i=t[1];var n=C.abapTimestampToDate(e.getTime()),s=C.abapTimestampToDate(e.getEndTime());var o=function(e){return e>=a&&e<=i};if(e.getSelected()||!n||!s){return true}else if(n&&s){return o(n)||o(s)||n<=a&&s>=i}};ue.prototype.isCalendarTimeIntervalVisible=function(e){var t=this.getRenderedTimeRange(),a=t[0],i=t[1];var n=C.abapTimestampToDate(e.getStartTime()),s=C.abapTimestampToDate(e.getEndTime());var o=function(e){return e>=a&&e<=i};if(n&&s){return o(n)||o(s)||n<=a&&s>=i}};ue.prototype.doBirdEye=function(e){var t=this._getZoomExtension();t.doBirdEye(e)};ue.prototype._exportTableToExcel=function(e){var t,a,i,n,s,o;s=this.getTable();if(s){o=s.getBinding(s._sAggregation)}if(o.getModel().isA("sap.ui.model.json.JSONModel")){n=true}t=this._createColumnConfig();var r=o.getModel();a={workbook:{columns:t},fileName:e&&e.fileName?e.fileName:oe.getText("DEFAULT_EXPORT_FILE_NAME")+".xlsx",worker:false};if(n){a.dataSource=this._createJSONDataSource(s)}else{a.dataSource={type:"odata",dataUrl:o.getDownloadUrl?o.getDownloadUrl():null,serviceUrl:this._sServiceUrl,headers:r.getHeaders?r.getHeaders():null,count:o.getLength?o.getLength():null}}if(s.getColumns()[0].data("exportTableColumnConfig")&&s.getColumns()[0].data("exportTableColumnConfig").hierarchyNodeLevel){a.workbook.hierarchyLevel=s.getColumns()[0].data("exportTableColumnConfig").hierarchyNodeLevel}i=new V(a);i.build().finally(function(){i.destroy()})};ue.prototype._createExportDialogBox=function(){this._getExportSettingsViaDialog().then(function(e){this._exportTableToExcel(e)}.bind(this))};ue.prototype._getExportSettingsViaDialog=function(e){return new Promise(function(t,i){var n;var s=new G;var o={fileName:oe.getText("DEFAULT_EXPORT_FILE_NAME"),fileType:[{key:"xlsx"}],selectedFileType:"xlsx"};s.setData(o);var r=O();n=new z({id:r,title:oe.getText("EXPORT_SETTINGS_TITLE"),content:[new M({renderType:"Bare",width:"100%",items:[new L({text:oe.getText("FILE_NAME"),labelFor:r+"-fileName"}),new H({id:r+"-fileName",value:"{/fileName}",liveChange:function(e){var t=e.getSource();var a=e.getParameter("value");var i=/[\\/:|?"*<>]/;var n=$.getElementById(r+"-export");var s=i.test(a);if(s){t.setValueState(sap.ui.core.ValueState.Error);t.setValueStateText(oe.getText("FILENAME_ERROR"))}else if(a.length>100){t.setValueState(sap.ui.core.ValueState.Warning);t.setValueStateText(oe.getText("FILENAME_WARNING"))}else{t.setValueState(sap.ui.core.ValueState.None);t.setValueStateText(null)}n.setEnabled(!s)}}).addStyleClass("sapUiTinyMarginBottom")]}).addStyleClass("sapUiExportSettingsLabel")],endButton:new B({id:r+"-cancel",text:oe.getText("CANCEL_BUTTON"),press:function(){n.close()}}),beginButton:new B({id:r+"-export",text:oe.getText("QUICK_EXPORT"),type:sap.m.ButtonType.Emphasized,press:function(){if(n){n._bSuccess=true;n.close();t(s.getData())}}}),afterClose:function(){if(!n._bSuccess){a.warning("sap.gantt.simple.GanttChartWithTable ","Cancel Click on Export to Excel PopOver",this);i(null)}n.destroy();n=null}});n.addStyleClass("sapUiContentPadding sapUiExportSettings");n.setModel(s);n.open();if(e){e(n)}})};ue.prototype._createColumnConfig=function(){var e,t,a,i,n,s,o,r,l,h=[],p,g,d;this._oTable=this.getTable();e=this._oTable.getColumns();a=e.length;for(t=0;t<a;t++){o=null;p=null;g=null;d=null;l=null;i=e[t];if(i.getVisible()){n=i.data("exportTableColumnConfig");if(!o&&n){o=n["leadingProperty"]}if(Array.isArray(o)){o=o[0]}if(o){s=this._getColumnLabel(i);r=i.getWidth().toLowerCase()||n.width||"";r=this._getColumnWidthNumber(r);if(n.unitProperty){l=n.isCurrency?sap.ui.export.EdmType.Currency:sap.ui.export.EdmType.Number}else if(n.isDigitSequence){l=sap.ui.export.EdmType.Number}if(!l){switch(n.dataType){case ne.Numeric:l=sap.ui.export.EdmType.Number;break;case ne.DateTime:l=sap.ui.export.EdmType.DateTime;d=n.displayFormat;break;case ne.StringDate:case ne.Date:l=sap.ui.export.EdmType.Date;d=n.displayFormat;break;case ne.Boolean:l=sap.ui.export.EdmType.Boolean;p="false";g="true";break;case ne.String:l=sap.ui.export.EdmType.String;break;case ne.Time:l=sap.ui.export.EdmType.Time;break;default:l=sap.ui.export.EdmType.String;break}}h.push({columnId:i.getId(),property:o,type:l,format:d?d:undefined,label:s?s:o,width:r,textAlign:i.getHAlign(),trueValue:l===sap.ui.export.EdmType.Boolean&&g?g:undefined,falseValue:l===sap.ui.export.EdmType.Boolean&&p?p:undefined,unitProperty:l===sap.ui.export.EdmType.Currency||l===sap.ui.export.EdmType.Number?n.unitProperty:undefined,displayUnit:l===sap.ui.export.EdmType.Currency,unit:n.unit?n.unit:undefined,precision:n.precision?n.precision:undefined,scale:n.scale?n.scale:undefined,wrap:n.wrap?n.wrap:false})}}}return h};ue.prototype._getColumnLabel=function(e){var t;if(!e){return null}if(e.getLabel){t=e.getLabel()}if(e.getHeader){t=e.getHeader()}return t&&t.getText?t.getText():null};ue.prototype._getColumnWidthNumber=function(e){if(e.indexOf("em")>0){return Math.round(parseFloat(e))}if(e.indexOf("px")>0){return Math.round(parseInt(e)/16)}return""};ue.prototype._createJSONDataSource=function(e){var t,a,i,n=[];t=e.getBinding(e._sAggregation).mParameters.arrayNames[0];a=e.getBinding().sPath;i=e.getModel().getProperty(a);n=this._generateJSONRowData(i[t],t,n);return n};ue.prototype._generateJSONRowData=function(e,t,a){if(!e){return[]}if(!a){a=[]}for(var i=0;i<e.length;i++){a.push(e[i]);if(e[i][t]){this._generateJSONRowData(e[i][t],t,a)}}return a};ue.prototype.setRowsHeight=function(e){this.oRowsCustomHeight=e;this.getTable().invalidate()};ue.prototype.getShapeUids=function(e){var t=[],a=[];var i=this.getTable().getRows();for(var n=0;n<i.length;n++){var s=i[n].getAggregation("_settings");t=t.concat(this._getAllMatchedShapeInRow(s,[],e))}t.forEach(function(e){if(e.getShapeUid()){a.push(e.getShapeUid())}});a=Array.from(new Set(a));return a};ue.prototype._getAllMatchedShapeInRow=function(e,t,a){var i=e.getMetadata(),n=i.getAllAggregations(),s=false;Object.keys(n).forEach(function(i){if(i==="calendars"){return}var n=e.getAggregation(i);if(n){n=Array.isArray(n)?n:[n];if(n.length>0){n.forEach(function(e){if(e instanceof sap.gantt.simple.BaseConditionalShape){e=e._getActiveShapeElement();if(e instanceof sap.gantt.simple.BaseGroup){s=this._checkBaseGroup(e,"shapes",a);if(s&&e.getShapeUid()){t=t.concat(e)}}else if(this._isShapeMatched(e,a)&&e.getShapeUid()){t=t.concat(e)}}else if(e instanceof sap.gantt.simple.MultiActivityGroup){var i=this._oExpandModel.isRowExpanded(e.getParent().getRowUid());s=this._checkBaseGroup(e,"task",a);if(s&&e.getShapeUid()){if(!(i&&!(this.getShowParentRowOnExpand()&&!this.getUseParentShapeOnExpand()))){t=t.concat(e)}}if(i){t=t.concat(this._getAllMatchedShapeInRow(e,[],a))}}else if(e instanceof sap.gantt.simple.BaseGroup){s=this._checkBaseGroup(e,"shapes",a);if(s&&e.getShapeUid()){t=t.concat(e)}}else if(this._isShapeMatched(e,a)&&e.getShapeUid()){t=t.concat(e)}}.bind(this))}}}.bind(this));return t};ue.prototype._checkBaseGroup=function(e,t,a){var i=false;if(this._isShapeMatched(e,a)&&e.getShapeUid()){i=true;return i}var n=e.getAggregation(t);n=Array.isArray(n)?n:[n];n.forEach(function(e){if(e instanceof sap.gantt.simple.BaseGroup){i=this._checkBaseGroup(e,"shapes",a)}else if(this._isShapeMatched(e,a)){i=true;return i}}.bind(this));return i};ue.prototype._isShapeMatched=function(e,t){if(t&&e instanceof sap.gantt.simple.BaseShape){var a=true;for(var i in t){var n=e.getMetadata(),s=n.getAllProperties();if(s&&s.hasOwnProperty(i)&&a){var o=e.getProperty(i);if(o instanceof Date){o=o.getTime();if(t[i]instanceof Date){t[i]=t[i].getTime()}}else if(typeof o==="string"){o=o.toLowerCase();t[i]=t[i].toLowerCase()}if(typeof o==="object"){a=F(o,t[i])}else if(o!==t[i]){a=false}}else{a=false}}return a}else{return false}};ue.prototype.getChartOverflowToolbar=function(){var e;if(this.getEnableChartOverflowToolbar()){e=$.getElementById(this.getId()+"-ganttHeaderOverflowToolbar")}return e};ue.prototype.rebindTableRows=function(e){this._createInnerGanttRenderPromise();var t=this.getTable();t.bindRows(e);if(this.getHorizontalLazyLoadingEnabled()){t.destroyAggregation("rows",true)}if(this.getEnablePseudoShapes()){this._tableDataUpdated=true}};ue.prototype.setRowSettingsTempWithInvalid=function(e){this._createInnerGanttRenderPromise();this.getTable().invalidate();var t=this.getTable();if(this.getEnablePseudoShapes()){this._tableDataUpdated=true}t.setRowSettingsTemplate(e)};ue.prototype._createInnerGanttRenderPromise=function(e){if(!this._oInnerGanttRenderPromise||this._oInnerGanttRenderPromise&&this._bInnerGanttRenderPromiseResolved){this._bInnerGanttRenderPromiseResolved=false;this._oInnerGanttRenderPromise=new Promise(function(e){this._oInnerGanttRenderPromiseResolve=e}.bind(this));return true}return false};ue.prototype.toggleDnDRowHighlight=function(t){var a=this._getDragDropExtension();var i=document.getElementById(this.getId()+"-svg"),n=i.querySelectorAll("rect.sapGanttBackgroundSVGRow");if(a.oLastDraggedShapeData&&a.oLastDraggedShapeData._highlightedRowIndex){a.oLastDraggedShapeData._highlightedRowIndex.forEach(function(a){n[a].classList.toggle("sapGanttBackgroundSVGRowHighlighted",t);var i=e.ValueSVGPaintServer.normalize(this.getRowHighlightFill());var s=e.ValueSVGPaintServer.normalize(this.getRowHighlightAndHoverFill());if(i){n[a].style.setProperty("--sapGanttBackgroundSVGRowHighlighted-fill",i)}if(s){n[a].style.setProperty("--sapGanttBackgroundSVGRowHighlighted-sapGanttBackgroundSVGRowHovered-fill",s)}}.bind(this))}};ue.prototype.fireDragStart=function(e){var t=this._getDragDropExtension();if(t._bEnableRowHighlight){this.toggleDnDRowHighlight(true)}this.fireEvent("dragStart",e)};ue.prototype.triggerShapeDrop=function(e){var t=this._getDragDropExtension();if(t._bEnableRowHighlight){this.toggleDnDRowHighlight(false)}if(e.dragged){this.fireEvent("shapeDrop",e)}};ue.prototype._triggerCancelShapeDrop=function(){var e=this._getDragDropExtension();if(e._bEnableRowHighlight){this.toggleDnDRowHighlight(false)}};ue.prototype.getParentGanttChartContainer=function(){var e=this.getParent();if(e instanceof sap.gantt.simple.GanttChartContainer){return e}return undefined};ue.prototype.setAllDataLoadedPromise=function(e){if(this.getHorizontalLazyLoadingEnabled()){var t=this.getParentGanttChartContainer();if(t){this._isAllDataLoadedPromiseResolved=false;t._mGanttChartAllDataLoadedPromise.set(this.getId(),e);e.then(function(){this._isAllDataLoadedPromiseResolved=true}.bind(this))}}else{a.Error("This method should be called only if the Gantt chart is horizontally lazy loaded")}};ue.prototype._syncRowExpandState=function(e,t,a){var i=this.getTable().getRows(),n=[];if(typeof e==="number"){n=[e]}else if(Array.isArray(e)){n=e}const s=i[0].getIndex();for(const e of n){var o=i[e-s];var r=o&&o.getAggregation("_settings");if(r){r._onRowExpandToggle({expanded:t,pseudoShapeExpand:a})}}};ue.prototype._isLazyLoadingEnabledForSyncedChart=function(){var e=this.getParentGanttChartContainer();var t=false;if(e&&e.getGanttCharts().length>1&&e.getEnableTimeScrollSync()){e.getGanttCharts().forEach(function(e){if(e.getHorizontalLazyLoadingEnabled()){t=true}})}return t};ue.prototype.showWrapper=function(e){if(this.getDomRef()){var t=this.getParentGanttChartContainer();if(!t||t&&!t.getDomRef().classList.contains("sapGanttWrapper")){this.getDomRef().classList.toggle("sapGanttWrapper",e)}}};return ue},true);
//# sourceMappingURL=GanttChartWithTable.js.map