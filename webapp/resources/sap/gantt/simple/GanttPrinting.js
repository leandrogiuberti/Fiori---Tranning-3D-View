/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

		(c) Copyright 2009-2015 SAP SE. All rights reserved
	
 */
sap.ui.define(["sap/gantt/library","sap/ui/thirdparty/jquery","sap/ui/core/Element","sap/ui/core/format/NumberFormat","sap/m/Label","sap/m/Text","sap/m/Title","sap/m/Dialog","sap/m/ProgressIndicator","sap/m/Button","sap/m/Input","sap/m/FlexBox","sap/m/library","sap/m/FlexItemData","sap/m/ScrollContainer","sap/m/ComboBox","sap/m/RadioButton","sap/m/RadioButtonGroup","sap/m/CheckBox","sap/m/Slider","sap/m/ResponsiveScale","sap/m/StepInput","sap/m/DatePicker","sap/m/DateTimePicker","sap/m/BusyDialog","sap/m/MessageStrip","sap/m/Switch","sap/m/Panel","sap/m/TextArea","sap/gantt/misc/Format","sap/gantt/simple/GanttChartContainer","sap/gantt/config/TimeHorizon","sap/gantt/axistime/FullScreenStrategy","sap/ui/core/Item","sap/ui/core/HTML","sap/ui/core/InvisibleText","sap/ui/layout/VerticalLayout","sap/ui/layout/HorizontalLayout","sap/ui/layout/GridData","sap/ui/layout/form/SimpleForm","sap/ui/model/json/JSONModel","sap/ui/core/theming/Parameters","sap/ui/core/ResizeHandler","sap/gantt/thirdparty/jspdf","sap/gantt/thirdparty/html2canvas","sap/gantt/thirdparty/svg2pdf","./RenderUtils","sap/m/PDFViewer","sap/ui/Device","sap/gantt/simple/GanttRowSettings","sap/gantt/simple/AggregationUtils","../simple/GanttUtils","sap/ui/core/date/UI5Date","sap/ui/core/format/DateFormat","sap/ui/table/rowmodes/Fixed","sap/ui/core/library","sap/ui/model/FilterType","sap/ui/model/odata/type/DateTimeOffset","sap/ui/model/odata/type/String","sap/ui/model/odata/type/DateTimeWithTimezone","sap/ui/model/type/Integer","sap/ui/model/type/Boolean","sap/gantt/utils/GanttChartConfigurationUtils","sap/ui/core/Lib","sap/gantt/simple/PrintConfig","sap/gantt/simple/PrintUtils","sap/base/Log"],function(t,e,i,a,o,n,r,s,l,h,g,_,p,d,u,c,C,P,f,m,T,v,y,b,x,w,G,S,R,D,M,N,E,B,I,A,L,H,O,F,k,z,V,W,U,j,K,X,Z,Q,$,J,Y,q,tt,et,it,at,ot,nt,rt,st,lt,ht,gt,_t,pt){"use strict";var dt=ht.getResourceBundleFor("sap.gantt");var ut=p.FlexDirection,ct=t.simple.GanttChartWithTableDisplayType;U=window.html2canvas;W=window.jsPDF;j=window.svg2pdf;var Ct=et.ValueState;var Pt=i.extend("sap.gantt.simple.GanttPrinting",{metadata:{library:"sap.gantt",associations:{ganttChart:{type:"sap.gantt.simple.GanttChartWithTable",multiple:false}}}});var ft="9px Arial, Helvetica, sans-serif";var mt="12px Arial, Helvetica, sans-serif";var Tt="16384";var vt=190;var yt=1.85;var bt=.56;Pt.prototype.init=function(){this._oRb=ht.getResourceBundleFor("sap.gantt");var t=_t._getPaperConfiguarations();var e=_t._mmToPx(5);this.oInitialValues={multiplePage:true,qualityWarning:false,showOrientationMessage:false,orientationMessage:this._oRb.getText("GNT_PRNTG_SINGLE_PAGE_LANDSCAPE"),portrait:true,paperSize:"A4",paperWidth:t.A4.width,paperHeight:t.A4.height,unit:"mm",repeatSelectionPanel:false,scale:100,duration:"all",startDate:new Date,endDate:new Date,showPageNumber:false,showHeaderText:false,headerText:"",showFooterText:false,footerText:"",exportAll:true,exportRange:"",exportAsJPEG:true,compressionQuality:75,previewPageNumber:1,lastPageNumber:undefined,marginType:"default",marginLocked:false,marginTop:e,marginRight:e,marginBottom:e,marginLeft:e,cropMarks:false,cropMarksWeight:.25,cropMarksOffset:_t._mmToPx(3)};this._oModel=new k(this.oInitialValues);this._oGanttCanvas=undefined;this._iHeaderAndFooterHeight=_t._mmToPx(8);this._ganttChartContainer=new M;this.sFont=null;this._oPdfPreview=null};Pt.prototype.export=function(){this._savePdf()};Pt.prototype.exportSinglePage=function(){var t=new Date;this.oSinglePagePdf.save("GanttChartExport-"+t.toISOString()+".pdf")};Pt.prototype.renderGanttClone=function(t){if(lt.getRTL()&&!t){return Promise.resolve()}return new Promise(function(t){this._ganttChartClone.getTable().attachEventOnce("_rowsUpdated",t,this);this._ganttChartClone.invalidate()}.bind(this))};Pt.prototype.mergeCanvases=function(t){var e=document.createElement("canvas"),i=e.getContext("2d"),a=t[0].width,o=[],n=t.reduce(function(t,e,i,a){o.push({cnv:e,y:t});t+=a[i].height;return t},0);e.width=a;e.height=n;o.forEach(function(t){i.beginPath();i.drawImage(t.cnv,0,t.y,a,t.cnv.height)});if(e.width>Tt||e.height>Tt){this._oClonedGanttDiv.style.height=e.height+"px";this._oClonedGanttDiv.style.width=e.width+"px";return undefined}return e};Pt.prototype.generateCanvasAsync=function(t){var e=0;var i=this._getOriginalGanttChart().getTable()._getTotalRowCount()/this.iThreshold;this.bLast=i>1?false:true;var a=this;var o=[];var n=0;var r=25/Math.ceil(i);function s(){if(a._bMultipleBatches){n+=r;a._oProgressIndicator.setPercentValue(n)}}function l(t){if(a._bCancel){return Promise.reject()}a._oClonedGanttDiv.style.height=Tt+"px";var o=t*a.iThreshold;var n=a._getOriginalGanttChart().getTable()._getTotalRowCount();a.iThreshold=Math.min(a.iThreshold,n-o);a.bLast=e+1>=i?true:false;if(a._getOriginalGanttChart()._bExpandToggled){a._ganttChartClone.getTable().setRowMode(new tt({rowCount:a.iThreshold}))}else{var r=a._ganttChartClone.getTable();var s=r.getRowMode(),l=0;if(s&&s.getRowContentHeight()){l=s.getRowContentHeight()}else{l=r.getRowHeight()}a._ganttChartClone.getTable().setRowMode(new tt({rowCount:a.iThreshold,rowContentHeight:l?l:Math.ceil(a._getOriginalGanttChart().getTableRowHeights()[0])}))}a.bFirst=t===0?true:false;a._ganttChartClone.getTable().setFirstVisibleRow(o);if(lt.getRTL()){a._ganttChartClone._bRenderGanttClone=true}return a._ganttChartClone.getInnerGantt().resolveWhenReady(a._originalHasRenderedShapes)}function h(t){s();return l(t).then(function(){s();a._bExpandCollapse=true;return a._expandAndCollapse()}).then(function(){a._ganttChartClone._bExpandRows=true;s();return a._expandRowSettings()}).then(function(){return a._fetchFont(a._ganttChartClone)}).then(function(){a._ganttChartClone._bExpandRows=false;a._setCloneDivHeight();document.getElementById(a._ganttChartClone.getId()+"-sapGanttBackgroundTableContent").style.height=a._iContentHeight;document.getElementById(a._ganttChartClone.getTable().getId()+"-tableCCnt").style.height=a._iContentHeight;if(!a.bLast){s()}return a._createGanttCanvas()}).then(function(t){return o.push(t)}).then(function(){if(t===0){a._ganttChartClone.setShowGanttHeader(false)}e=e+1;if(e<i){h(e)}else if(!a._bCancel){a._oGanttCanvas=a.mergeCanvases(o);a._updateDialogPreview();a._oDialog.getContent()[0].setBusy(false);a._oFlexBoxPreview.setBusy(false);a._oButtonExport.setEnabled(true);if(a._bMultipleBatches){a._oProgressIndicator.setPercentValue(100);setTimeout(function(){a._closeProgressIndicator(true)},500)}}else{return Promise.reject()}}).catch(function(){})}return h(t)};Pt.prototype.generatePdfAsync=function(t){var e=0;var i=this._getOriginalGanttChart().getTable()._getTotalRowCount()/this.iThreshold;this.bLast=i>1?false:true;var a=this;var o=0;var n=25/Math.ceil(i);function r(){if(a._bMultipleBatches){o+=n;a._oProgressIndicator.setPercentValue(o)}}function s(t){if(a._bCancel){return Promise.reject()}a._oClonedGanttDiv.style.height=Tt+"px";var o=t*a.iThreshold;var n=a._getOriginalGanttChart().getTable()._getTotalRowCount();a.iThreshold=Math.min(a.iThreshold,n-o);a.bLast=e+1>=i?true:false;if(a._getOriginalGanttChart._bExpandToggled){a._ganttChartClone.getTable().setRowMode(new tt({rowCount:a.iThreshold}))}else{var r=a._ganttChartClone.getTable();var s=r.getRowMode(),l=0;if(s&&s.getRowContentHeight()){l=s.getRowContentHeight()}else{l=r.getRowHeight()}a._ganttChartClone.getTable().setRowMode(new tt({rowCount:a.iThreshold,rowContentHeight:l?l:Math.ceil(a._getOriginalGanttChart().getTableRowHeights()[0])}))}a.bFirst=t===0?true:false;a._ganttChartClone.getTable().setFirstVisibleRow(o);if(lt.getRTL()){a._ganttChartClone._bRenderGanttClone=true}return a._ganttChartClone.getInnerGantt().resolveWhenReady(a._originalHasRenderedShapes)}function l(t){r();return s(t).then(function(){r();a._bExpandCollapse=true;return a._expandAndCollapse()}).then(function(){a._ganttChartClone._bExpandRows=true;r();return a._expandRowSettings()}).then(function(){a._ganttChartClone._bExpandRows=false;a._setCloneDivHeight();document.getElementById(a._ganttChartClone.getId()+"-sapGanttBackgroundTableContent").style.height=a._iContentHeight;document.getElementById(a._ganttChartClone.getTable().getId()+"-tableCCnt").style.height=a._iContentHeight;if(!a.bLast){r()}return a._createBatchList()}).then(function(t){return a._oDomToPrint.push(t)}).then(function(){if(t===0){a._ganttChartClone.setShowGanttHeader(false)}e=e+1;if(e<i){l(e)}else if(!a._bCancel){if(a._bMultipleBatches){a._oProgressIndicator.setPercentValue(100);setTimeout(function(){a._closeProgressIndicator(true)},500)}return a._generateSvgToPdf()}else{return Promise.reject()}}).catch(function(){})}return l(t)};Pt.prototype._savePreset=function(t,e){var i=this._getOriginalGanttChart().getParent();if(i&&i.isA("sap.gantt.simple.GanttChartContainer")){var a=this.getPrintData();var o=[];o.push({selectorElement:i,changeSpecificData:{changeType:e?"GanttSVGPrinting":"GanttCanvasPrinting",content:{propertyName:e?"svgPage":"canvasPage",newValue:{pageConfig:a.pageConfig,textConfig:a.textConfig,marginConfig:a.marginConfig,durationConfig:a.durationConfig,exportConfig:a.exportConfig},oldValue:{pageConfig:this._onLoadValues.pageConfig,textConfig:this._onLoadValues.textConfig,marginConfig:this._onLoadValues.marginConfig,durationConfig:this._onLoadValues.durationConfig,exportConfig:this._onLoadValues.exportConfig}}}});i._addChangesToControlPersonalizationWriteAPI(t,o);this._onLoadValues=this.getPrintData()}};Pt.prototype.open=function(t,e){if(!this.getGanttChart()||!this._getOriginalGanttChart().isA("sap.gantt.simple.GanttChartWithTable")){throw new Error("Association 'ganttChart' of type 'sap.gantt.simple.GanttChartWithTable' is not set")}var i=this;if(t){t(this._ganttChartClone.getTable())}this._createAndOpenDialog(false,e);this._oDialog.getContent()[0].setBusy(true);this._oButtonExport.setEnabled(false);if(this._oButtonSave){this._oButtonSave.setEnabled(false)}if(this._ganttChartClone._enableOptimisation){this._ganttChartClone.setShowGanttHeader(true);return this._drawClonedGantt(false).then(function(){if(i._bMultipleBatches){i._openProgressDialog()}return i.generateCanvasAsync(0)}).catch(function(t){if(t&&t.bMaxCanvasSizeExceeded||t.dateDurationNotSet){i._updateDialogPreviewCanvas();i._oDialog.getContent()[0].setBusy(false)}})}else{if(lt.getRTL()){i._ganttChartClone._bRenderGanttClone=true}return this._drawClonedGantt(false).then(function(){i._bExpandCollapse=true;return i._expandAndCollapse()}).then(function(){i._ganttChartClone._bExpandRows=true;return i._expandRowSettings()}).then(function(){return i._fetchFont(i._ganttChartClone)}).then(function(){i._ganttChartClone._bExpandRows=false;i._setCloneDivHeightNonOptimised();document.getElementById(i._ganttChartClone.getId()+"-sapGanttBackgroundTableContent").style.height=i._iContentHeight;document.getElementById(i._ganttChartClone.getTable().getId()+"-tableCCnt").style.height=i._iContentHeight;return i._createGanttCanvas()}).then(function(t){i._oGanttCanvas=t;i._updateDialogPreview();i._oDialog.getContent()[0].setBusy(false);i._oButtonExport.setEnabled(true)}).catch(function(t){if(t&&t.bMaxCanvasSizeExceeded||t.dateDurationNotSet){i._updateDialogPreviewCanvas();i._oDialog.getContent()[0].setBusy(false)}})}};Pt.prototype._updateDialogErrorPDFPreview=function(t){var e=this._oPdfDialogPreview.$().find(".sapGanttPdfPreviewPageDiv");var i=e[0];if(!t){xt(i)}else{this._oPreviewErrorMessageStrip=new w({text:this._oRb.getText("GNT_PRNTG_ERROR_DATEDURATION_PREVIEW"),showIcon:true,type:"Error"}).addStyleClass("sapGanttPrintingBottomMargin");var a=document.createElement("div");a.id=this.getId()+"-previewErrorMessageStrip";a.style.width="50%";a.style.marginTop="25%";a.style.marginLeft="25%";i.appendChild(a);this._oPreviewErrorMessageStrip.placeAt(this.getId()+"-previewErrorMessageStrip")}};Pt.prototype.openPdfPreview=function(t,e){if(!this.getGanttChart()||!this._getOriginalGanttChart().isA("sap.gantt.simple.GanttChartWithTable")){throw new Error("Association 'ganttChart' of type 'sap.gantt.simple.GanttChartWithTable' is not set")}this._bSinglePage=true;this._oDomToPrint=[];this._oDomToPrintHeight=0;this._oDomToPrintWidth=0;var i=this;if(t){t(this._ganttChartClone.getTable())}this._createAndOpenDialog(true,e);this._oDialog.getContent()[0].setBusy(true);this._oButtonExport.setEnabled(false);if(this._oButtonSave){this._oButtonSave.setEnabled(false)}this._ganttChartClone.setShowGanttHeader(true);return this._drawClonedGantt(true).then(function(){if(i._bMultipleBatches){i._openProgressDialog()}return i.generatePdfAsync(0)}).catch(function(t){if(t){if(t.dateDurationNotSet){i._updateDialogErrorPDFPreview(true)}i._oDialog.getContent()[0].setBusy(false)}})};Pt.prototype.close=function(){var t=this._getOriginalGanttChart();if(this._initialDisplayType===ct.Table){t.setSelectionPanelSize(this._initialSelectionPanelSize);t.setDisplayType(this._initialDisplayType);if(t.getParent()&&t.getParent().isA("sap.gantt.simple.GanttChartContainer")&&t.getParent().getToolbar()){t.getParent().getToolbar()._oDisplayTypeSegmentedButton.setSelectedKey(ct.Table)}}this._ganttChartClone.destroy();this._ganttChartClone=null;this._ganttChartContainer.destroy();this._ganttChartContainer=null;document.body.removeChild(this._oClonedGanttDiv);V.deregister(this._sResizeHandlerId);if(this._oPdfPreview){this._oPdfPreview.destroy()}this._oDialog.close();this._oDialog.destroy();if(Z.browser.safari){t.getInnerGantt().invalidate()}};Pt.prototype._closeProgressIndicator=function(t){this._oProgressDialog.close();this._oProgressDialog.destroy();this._bCancel=true;if(!this._bUpdateGanttCanvas&&!t){this.close()}};Pt.prototype.setGanttChart=function(t){this.setAssociation("ganttChart",t);this._initialDisplayType=t.getDisplayType();this._initialSelectionPanelSize=t._iLastTableAreaSize?t._iLastTableAreaSize:t.getSelectionPanelSize();var e=this._initialDisplayType===ct.Table?true:false;if(e){t.setSelectionPanelSize("100%");t.setDisplayType(ct.Both)}this._ganttChartClone=t.clone();this._ganttChartClone._enableOptimisation=t.getPrintingBatchSize()>0?true:false;this._bUpdateGanttCanvas=false;this._bCancel=false;this._ganttChartClone.setEnableChartOverflowToolbar(false);this.canvasScale=2;this._ganttChartClone._originalGantt=t;if(this._ganttChartClone._enableOptimisation){this._ganttChartClone.getTable().destroyExtension();var i=e?1:Math.max(t.getAxisTimeStrategy().getZoomLevel(),1);this.iThreshold=Math.min(Math.round(t.getPrintingBatchSize()/i),t.getTable()._getTotalRowCount());this._bMultipleBatches=t.getTable()._getTotalRowCount()>this.iThreshold;this.bFirst=true;if(this._getOriginalGanttChart._bExpandToggled){this._ganttChartClone.getTable().setRowMode(new tt({rowCount:this.iThreshold}))}else{var a=this._ganttChartClone.getTable();var o=a.getRowMode(),n=0;if(o&&o.getRowContentHeight()){n=o.getRowContentHeight()}else{n=a.getRowHeight()}this._ganttChartClone.getTable().setRowMode(new tt({rowCount:this.iThreshold,rowContentHeight:n?n:Math.ceil(t.getTableRowHeights()[0])}))}this._ganttChartClone.getTable().setThreshold(this.iThreshold);this._ganttChartClone.setParent(this._getOriginalGanttChart(),"originalGanttChart",true)}else{this._ganttChartContainer.setParent(this._getOriginalGanttChart(),"originalGanttChart",true)}this._addBackOriginalGanttRowBinding(this._ganttChartClone,t);this._originalHasRenderedShapes=t.getInnerGantt().hasRenderedShapes();this._ganttChartClone.mEventRegistry={};this._ganttChartClone.setHeight("100%");var r=t._oSplitter._calculatedSizes[0];if(this._initialDisplayType===ct.Chart){this._ganttChartClone.setProperty("selectionPanelSize","1px",true)}else{this._ganttChartClone.setProperty("selectionPanelSize",r.toString()+"px",true)}var s=t.getAxisTimeStrategy();if(!s.isA("sap.gantt.axistime.FullScreenStrategy")&&!e){t.isPrint=true;t._getScrollExtension()._updateVisibleHorizonForce();var l=this._ganttChartClone.getAxisTimeStrategy();l.setTotalHorizon(s.getTotalHorizon());l.setVisibleHorizon(s.getTotalHorizon())}var h=s.getVisibleHorizon();var g=this._getHorizonDates(h);var _=this._horizonWidthInSec(g);this._fPixelsBySec=t.getVisibleWidth()/_;this._ganttChartClone.isPrint=true;this._ganttChartClone._bClonedGantt=true;if(!this._ganttChartClone._enableOptimisation){this._ganttChartContainer.addGanttChart(this._ganttChartClone)}return this};Pt.prototype._expandAndCollapse=function(){var t=this;return this._expandAndCollapseRow().then(function(){if(t._bExpandCollapse){return t._expandAndCollapse()}else{return Promise.resolve()}})};Pt.prototype._expandAndCollapseRow=function(){if(this._bCancel){this._bExpandCollapse=false;return Promise.reject()}var t=this._getOriginalGanttChart().getTable();if(!t.isA("sap.ui.table.TreeTable")){this._bExpandCollapse=false;return this._ganttChartClone.getInnerGantt().resolveWhenReady(this._originalHasRenderedShapes)}var e=t.getBinding("rows"),i=this._ganttChartClone.getTable().getBinding("rows");for(var a=0;a<e.getLength();a++){if(i.findNode(a)!==undefined&&e.isExpanded(a)&&!i.isExpanded(a)){i.expand(a);return this.renderGanttClone(true)}else if(i.findNode(a)!==undefined&&!e.isExpanded(a)&&i.isExpanded(a)){i.collapse(a);return this.renderGanttClone(true)}}this._bExpandCollapse=false;return Promise.resolve()};Pt.prototype._expandRowSettings=function(){if(this._bCancel){return Promise.reject()}var t=this._ganttChartClone.getUseParentShapeOnExpand();var e=this._ganttChartClone.getShapeSchemes().find(function(e){return t?e.getPrimary():!e.getPrimary()});var i=this._getOriginalGanttChart();var a=i.oOverlapShapeIds;var o=i._aExpandedIndices,n=[];var r=this._ganttChartClone.getEnablePseudoShapes();if(r){for(var s in a){if(a[s].length>0){n.push(parseInt(s))}}if(n.length>0){o=o.filter(function(t){return n.indexOf(t)==-1})}}if(o){var l;var h=0,g=Object.keys(i._oExpandModel.mExpanded);var _=g.length;while(!l&&h!=_){var p=g[h];if(!i._oExpandModel.mExpanded[p][1].expandSchemeShape){l=i._oExpandModel.mExpanded[p]}h++}l=l?l:[];var d=[];l.forEach(function(t){d.push(t.scheme)})}var u=d&&d.length?d:e&&e.getKey();if(u){if(!this._ganttChartClone._aExpandedIndices||this._ganttChartClone._aExpandedIndices.length===0){this._ganttChartClone.expand(u,o)}}if(r&&!this._ganttChartClone.oOverlapShapeIds){n.forEach(function(t){this._oPseudoShape=null;this._expandPseudoShapeInRow(t)}.bind(this))}return this._ganttChartClone.getInnerGantt().resolveWhenReady(this._originalHasRenderedShapes)};Pt.prototype._expandPseudoShapeInRow=function(t){if(this._bCancel){return Promise.reject()}var e=this._ganttChartClone.getTable();var i=e.getRows()[t];var a=i?i.getAggregation("_settings"):null;var o=this._getOriginalGanttChart().oOverlapShapeIds[t];if(a){var n=$.getAllNonLazyAggregations(a);var r=Object.keys(n).filter(function(t){return t.indexOf("calendars")===-1&&t!=="relationships"}).map(function(t){return a.getAggregation(t)||[]});r.forEach(function(t){if(t&&t.length>0&&!this._oPseudoShape){var e=0;while(e<t.length&&!this._oPseudoShape){var i=t[e];if(i.isPseudoShape){var a=i.aShapeIds;if(o.indexOf(a[0])!==-1){this._oPseudoShape=i;i.onclick()}}e++}}}.bind(this))}};Pt.prototype._onResize=function(){if(this._oHTMLDialogPreview){var t=this._oHTMLDialogPreview.getDomRef();t.style.overflow="hidden";this._resizePrintingPreviewPage();t.style.overflow="visible"}};Pt.prototype._onChangeUnitComboBox=function(){this._updatePaperSizeInputs();this._updateMarginInputs()};Pt.prototype._updatePaperSizeInputs=function(){var t=this._oModel.getProperty("/paperWidth"),e=this._oModel.getProperty("/paperHeight");this._setPaperSizeInputs(t,e)};Pt.prototype._setPaperSizeInputs=function(t,e){var i=this._oModel.getProperty("/unit");if(this._oInputPaperWidth){this._oInputPaperWidth.setValue(_t._convertPxToUnit(t,i))}if(this._oInputPaperHeight){this._oInputPaperHeight.setValue(_t._convertPxToUnit(e,i))}};Pt.prototype._setPaperSizesToModel=function(t,e){this._oModel.setProperty("/paperWidth",t);this._oModel.setProperty("/paperHeight",e)};Pt.prototype._updatePaperSizeValues=function(t,e){var i=this._oModel.getProperty("/paperSize"),a=this._oModel.getProperty("/portrait"),o,n;if(!i||i==="Custom"){return}var r=_t._getPaperConfiguarations()[i];if(a){o=r.width;n=r.height}else{o=r.height;n=r.width}this._setPaperSizeInputs(o,n);this._setPaperSizesToModel(o,n);if(i==="Letter"||i==="Legal"||i==="Tabloid"){this._oComboBoxUnit.setSelectedKey("in")}else{this._oComboBoxUnit.setSelectedKey("mm")}this._onChangeUnitComboBox();if(t){this._generateSvgToPdf()}else{this._updateDialogPreview()}};Pt.prototype._updatePaperOrientation=function(t){var e=this._oModel.getProperty("/paperWidth"),i=this._oModel.getProperty("/paperHeight");if(i>e){this._oModel.setProperty("/portrait",true);this._radioGroupOrientation.setSelectedIndex(0)}else{this._oModel.setProperty("/portrait",false);this._radioGroupOrientation.setSelectedIndex(1)}};Pt.prototype._onChangePaperSizeInput=function(t,e){var i=e.getSource();var o=this._oModel.getProperty("/unit");var n=_t._convertUnitToPx(a.getFloatInstance({groupingSeparator:",",decimalSeparator:"."}).parse(i.getValue()),o);if(i===this._oInputPaperWidth){this._oModel.setProperty("/paperWidth",n)}else{this._oModel.setProperty("/paperHeight",n)}this._oComboBoxPaperSizes.setSelectedKey("Custom");this._updatePaperOrientation();if(t){this._generateSvgToPdf()}else{this._updateDialogPreview()}};Pt.prototype._onChangeCompressionSlider=function(t){var e=t.getSource();var i=e.getValue();this._setCompressionComboBoxItem(i)};Pt.prototype._setCompressionComboBoxItem=function(t){if(t===100){this._oComboBoxCompression.setSelectedKey("maximum")}else if(t>=75){this._oComboBoxCompression.setSelectedKey("high")}else if(t>=50){this._oComboBoxCompression.setSelectedKey("medium")}else{this._oComboBoxCompression.setSelectedKey("low")}};Pt.prototype._onChangeCompressionComboBox=function(t){var e=t.getSource().getSelectedKey();var i={maximum:100,high:75,medium:50,low:25};this._oModel.setProperty("/compressionQuality",i[e])};Pt.prototype._onChangeOrientation=function(t,e){var i=this._oModel.getProperty("/paperWidth"),a=this._oModel.getProperty("/paperHeight");this._setPaperSizeInputs(a,i);this._setPaperSizesToModel(a,i);if(t){this._generateSvgToPdf()}else{this._updateDialogPreview()}};Pt.prototype._onChangeExportTypes=function(){this._updateDialogPreview()};Pt.prototype._setMarginInputs=function(t,e,i,a){var o=this._oModel.getProperty("/unit");this._oInputMarginTop.setValue(_t._convertPxToUnit(t,o));this._oInputMarginRight.setValue(_t._convertPxToUnit(e,o));this._oInputMarginBottom.setValue(_t._convertPxToUnit(i,o));this._oInputMarginLeft.setValue(_t._convertPxToUnit(a,o))};Pt.prototype._setMarginsToModel=function(t,e,i,a){if(t!==undefined){this._oModel.setProperty("/marginTop",t)}if(e!==undefined){this._oModel.setProperty("/marginRight",e)}if(i!==undefined){this._oModel.setProperty("/marginBottom",i)}if(a!==undefined){this._oModel.setProperty("/marginLeft",a)}};Pt.prototype._onChangeMarginComboBox=function(t,e){var i=e.getSource().getSelectedKey();var a=_t._mmToPx(5);if(i==="none"){a=0}this._setMarginsToModel(a,a,a,a);this._setMarginInputs(a,a,a,a);if(t){this._generateSvgToPdf()}else{this._updateDialogPreview()}};Pt.prototype._updateModelFromMarginInputs=function(){var t,e,i,a;var o=this._oModel.getProperty("/unit");if(this._oInputMarginTop.getValueState()!=="Error"){t=_t._convertUnitToPx(this._oInputMarginTop.getValue(),o)}if(this._oInputMarginRight.getValueState()!=="Error"){e=_t._convertUnitToPx(this._oInputMarginRight.getValue(),o)}if(this._oInputMarginBottom.getValueState()!=="Error"){i=_t._convertUnitToPx(this._oInputMarginBottom.getValue(),o)}if(this._oInputMarginLeft.getValueState()!=="Error"){a=_t._convertUnitToPx(this._oInputMarginLeft.getValue(),o)}this._setMarginsToModel(t,e,i,a)};Pt.prototype._updateMarginInputs=function(){var t=this._oModel.getProperty("/marginTop");var e=this._oModel.getProperty("/marginRight");var i=this._oModel.getProperty("/marginBottom");var a=this._oModel.getProperty("/marginLeft");this._setMarginInputs(t,e,i,a)};Pt.prototype._updateCropMarksOffsetInput=function(){var t=this._oModel.getProperty("/cropMarksOffset");var e=this._oModel.getProperty("/unit");this._oInputCropMarksOffset.setValue(_t._convertPxToUnit(t,e))};Pt.prototype._onChangeMarginInput=function(t,e){var i=e.getSource();if(i.getValueState()==="Error"){return}if(this._oModel.getProperty("/marginLocked")){var a=this._oModel.getProperty("/unit");var o=_t._convertUnitToPx(i.getValue(),a);this._setMarginInputs(o,o,o,o);this._setMarginsToModel(o,o,o,o)}else{this._updateModelFromMarginInputs()}if(t){this._generateSvgToPdf()}else{this._updateDialogPreview()}};Pt.prototype._onChangeCropMarksInput=function(t){var e=t.getSource();var i=this._oModel.getProperty("/unit");var a=_t._convertUnitToPx(e.getValue(),i);this._oInputCropMarksOffset.setValue(_t._convertPxToUnit(a,i));this._oModel.setProperty("/cropMarksOffset",a)};Pt.prototype._allRange=function(){this._oModel.setProperty("/startDate",this._oDatePickerFrom.getMinDate());this._oModel.setProperty("/endDate",this._oDatePickerTo.getMaxDate())};Pt.prototype._getFirstDayOfNextWeek=function(t){var e=this._getOriginalGanttChart().getAxisTimeStrategy().getFirstDayOfWeek();var i=(e+7-t.getDay())%7;return new Date(t.getFullYear(),t.getMonth(),t.getDate()+(i===0?7:i))};Pt.prototype._nextWeekRange=function(){var t=new Date;var e=this._getFirstDayOfNextWeek(t);this._oModel.setProperty("/startDate",this._validateDate(e));this._oModel.setProperty("/endDate",this._validateDate(new Date(e.getFullYear(),e.getMonth(),e.getDate()+7)))};Pt.prototype._getFirstDayOfNextMonth=function(t){return new Date(t.getFullYear(),t.getMonth()+1,1)};Pt.prototype._nextMonthRange=function(){var t=new Date;this._oModel.setProperty("/startDate",this._validateDate(this._getFirstDayOfNextMonth(t)));this._oModel.setProperty("/endDate",this._validateDate(new Date(t.getFullYear(),t.getMonth()+2,1)))};Pt.prototype._validateDate=function(t){var e=this._oDatePickerTo.getMaxDate(),i=this._oDatePickerFrom.getMinDate();if(t.getTime()>e.getTime()){return e}if(t.getTime()<i.getTime()){return i}return t};Pt.prototype._onChangeDurationComboBox=function(t){this._validateDurationInput();var e=this._oModel.getProperty("/duration");switch(e){case"all":{this._allRange();break}case"week":{this._nextWeekRange();break}case"month":{this._nextMonthRange();break}case"custom":default:return}if(t){this._updateGanttPdf()}else{this._updateGanttCanvas()}};Pt.prototype._onChangeDurationDatePicker=function(t){this._oComboBoxDuration.setSelectedKey("custom");this._oComboBoxDuration.setValueState(Ct.None);if(this._oDatePickerFrom.isValidValue()&&this._oDatePickerTo.isValidValue()){if(this._oDatePickerFrom.getDateValue().getTime()<=this._oDatePickerTo.getDateValue().getTime()){this._oDatePickerFrom.setValueState(Ct.None);this._oDatePickerTo.setValueState(Ct.None);if(t){this._updateGanttPdf()}else{this._updateGanttCanvas()}}else{this._oDatePickerFrom.setValueState(Ct.Error);this._oDatePickerTo.setValueState(Ct.Error)}}else{var e=this._oDatePickerFrom.isValidValue()?Ct.None:Ct.Error;var i=this._oDatePickerTo.isValidValue()?Ct.None:Ct.Error;this._oDatePickerFrom.setValueState(e);this._oDatePickerTo.setValueState(i)}};Pt.prototype._setEnabledPreviousButtons=function(t){this._oButtonFirst.setEnabled(t);this._oButtonPrevious.setEnabled(t)};Pt.prototype._setEnabledNextButtons=function(t){this._oButtonNext.setEnabled(t);this._oButtonLast.setEnabled(t)};Pt.prototype._updatePageNumberButtons=function(){if(!this._oGanttCanvas){this._setEnabledNextButtons(false);this._setEnabledPreviousButtons(false);return}var t=this._oModel.getProperty("/previewPageNumber"),e=this._oModel.getProperty("/lastPageNumber");if(!e){e=Number.MAX_SAFE_INTEGER}if(t<=1){this._setEnabledPreviousButtons(false)}if(t>=e){this._setEnabledNextButtons(false)}if(t>1){this._setEnabledPreviousButtons(true)}if(t<e){this._setEnabledNextButtons(true)}};Pt.prototype._getHeaderHeight=function(){var t=this._oModel.getProperty("/showHeaderText");if(t){return this._iHeaderAndFooterHeight}return 0};Pt.prototype._isFooterMultiline=function(){if(!this._oModel.getProperty("/multiplePage")){return false}var t=this._oModel.getProperty("/showPageNumber"),e=this._oModel.getProperty("/showFooterText");if(!e||!t||this._bSinglePage){return false}var i=this._oModel.getProperty("/footerText"),a=this._oModel.getProperty("/paperWidth"),o;var n=lt.getRTL();if(n){o=this._oModel.getProperty("/marginRight")}else{o=this._oModel.getProperty("/marginLeft")}var r=7;var s=this._oGanttCanvas.getContext("2d");s.font=ft;var l=s.measureText(i).width;if(a/2>o+_t._mmToPx(4)+l+_t._mmToPx(10)+r){return false}else{return true}};Pt.prototype._getFooterHeight=function(){var t=this._oModel.getProperty("/showPageNumber"),e=this._oModel.getProperty("/showFooterText");if(e&&t){return this._isFooterMultiline()?2*this._iHeaderAndFooterHeight:this._iHeaderAndFooterHeight}if(e||t){return this._iHeaderAndFooterHeight}return 0};Pt.prototype._isShrinkableToOnePageByWidth=function(){var t=this._getPaperContentWidth()/this._getPaperContentHeight(),e=this._oGanttCanvas.width/this._oGanttCanvas.height;return t<=e};Pt.prototype._isDomShrinkableToOnePageByWidth=function(t,e){var i=this._getPaperContentWidth()/this._getPaperContentHeight(),a=e/t;return i<=a};Pt.prototype._getPaperContentWidth=function(){var t=this._oModel.getProperty("/paperWidth"),e=this._oModel.getProperty("/marginLeft"),i=this._oModel.getProperty("/marginRight");return t-e-i};Pt.prototype._getPaperContentHeight=function(){var t=this._oModel.getProperty("/paperHeight"),e=this._oModel.getProperty("/marginTop"),i=this._oModel.getProperty("/marginBottom");return t-e-this._getHeaderHeight()-i-this._getFooterHeight()};Pt.prototype._getScale=function(){return 100/this._oModel.getProperty("/scale")*2};Pt.prototype._getCroppingWidth=function(){return this._getScale()*this._getPaperContentWidth()};Pt.prototype._getCroppingHeight=function(){return this._getScale()*this._getPaperContentHeight()};Pt.prototype._getPagesInARow=function(){return Math.ceil(this._oGanttCanvas.width/this._getCroppingWidth())};Pt.prototype._getPagesInAColumn=function(){return Math.ceil(this._oGanttCanvas.height/this._getCroppingHeight())};Pt.prototype._updateLastPageNumber=function(){if(!this._oGanttCanvas){return}var t=this._getPagesInARow()*this._getPagesInAColumn();this._oModel.setProperty("/lastPageNumber",t);var e=this._oModel.getProperty("/previewPageNumber");if(e>t){this._oModel.setProperty("/previewPageNumber",t)}};Pt.prototype._onPressButtonFirst=function(){this._oModel.setProperty("/previewPageNumber",1);this._updatePageNumberButtons();this._updateDialogPreviewCanvas()};Pt.prototype._onPressButtonPrevious=function(){var t=this._oModel.getProperty("/previewPageNumber");this._oModel.setProperty("/previewPageNumber",t-1);this._updatePageNumberButtons();this._updateDialogPreviewCanvas()};Pt.prototype._onPressButtonNext=function(){var t=this._oModel.getProperty("/previewPageNumber");this._oModel.setProperty("/previewPageNumber",t+1);this._updatePageNumberButtons();this._updateDialogPreviewCanvas()};Pt.prototype._onPressButtonLast=function(){var t=this._oModel.getProperty("/lastPageNumber");if(!t){return}this._oModel.setProperty("/previewPageNumber",t);this._updatePageNumberButtons();this._updateDialogPreviewCanvas()};Pt.prototype._getOriginalGanttChart=function(){return i.getElementById(this.getAssociation("ganttChart"))};Pt.prototype._getGanttCloneDivWidth=function(t){var e=this._getOriginalGanttChart(),i=this._getHorizonDates(t),a=this._horizonWidthInSec(i),o=Math.ceil(this._fPixelsBySec*a);var n=e.getDisplayType()===ct.Both?e.getTable().getDomRef().offsetWidth:0;return n+o+10};Pt.prototype._setGanttCloneDivWidth=function(t){this._oClonedGanttDiv.style.width=this._getGanttCloneDivWidth(t).toString()+"px"};Pt.prototype._setGanttCloneDivHeight=function(){this._oClonedGanttDiv.style.height=this._getGanttCloneDivHeight().toString()+"px"};Pt.prototype._getGanttCloneDivHeight=function(){var t=this._getOriginalGanttChart().getTable();var e=t._getTotalRowCount(),i=t._aRowHeights;var a=i.reduce(function(t,e){return t+e});var o=Math.ceil(a/i.length*e);this._iGanttHeight=o+102;return this._iGanttHeight};Pt.prototype._setCloneDivHeight=function(){var t=this.bFirst?document.getElementById(this._ganttChartClone.getId()+"-header-svg").height.baseVal.value:0;var e=this._ganttChartClone.getTable().getRowMode().getRowCount();var i=0;var a=this.bLast?3:0;var o=this._ganttChartClone.getTable().getRows()[0].getIndex();var n=this._ganttChartClone.getTable().getFirstVisibleRow();var r=Math.abs(o-n);var s=this._ganttChartClone.getTable()._aRowHeights;for(var l=r;l<e+r;l++){i=i+s[l]}this._iContentHeight=i+"px";this._oClonedGanttDiv.style.height=(i+t+a).toString()+"px"};Pt.prototype._setCloneDivHeightNonOptimised=function(){var t=document.getElementById(this._ganttChartClone.getId()+"-header-svg").height.baseVal.value;var e=this._ganttChartClone.getTable()._getTotalRowCount();var i=1;var a=this._ganttChartClone.getTable()._aRowHeights;for(var o=0;o<e;o++){var n=a[o]?a[o]:0;i=i+n}this._iContentHeight=i.toString()+"px";this._oClonedGanttDiv.style.height=(i+t).toString()+"px"};Pt.prototype._createImgElementsFromSvgImages=function(){var t=this._ganttChartClone.$().find("svg.sapGanttChartSvg");if(!t.length){return}var e=this._ganttChartClone.$().find(".sapGanttChartCnt")[0];if(!e){return}e.style.position="relative";var i=t.find("image");for(var a=0;a<i.length;a++){var o=i[a];var n=document.createElement("img");n.src=o.getAttribute("href");n.style.position="absolute";n.style.top=o.getAttribute("y")+"px";n.style.left=o.getAttribute("x")+"px";n.style.width=o.getAttribute("width")+"px";n.style.height=o.getAttribute("height")+"px";e.appendChild(n)}};Pt.prototype._createGanttCanvas=function(){if(this._bCancel){return Promise.reject()}this._setStyleToGanttChartSvg(this._ganttChartClone);this._createImgElementsFromSvgImages();return U(this._oClonedGanttDiv,{allowTaint:true,scale:this.canvasScale,logging:false})};Pt.prototype._createBatchList=function(){if(this._bCancel){return Promise.reject()}this._setStyleToGanttChartSvg(this._ganttChartClone);this._oDomToPrintHeight+=Number(this._oClonedGanttDiv.style.height.slice(0,-2));this._oDomToPrintWidth=Number(this._oClonedGanttDiv.style.width.slice(0,-2));return this._oClonedGanttDiv.cloneNode(true)};Pt.prototype._updateGanttPdf=function(){if(this._initialDisplayType===ct.Table){return}var t=this._oModel;var e=this._ganttChartClone.getAxisTimeStrategy();var i=e.getVisibleHorizon().clone();var a=e.getTotalHorizon().clone();i.setStartTime(t.getProperty("/startDate"));i.setEndTime(t.getProperty("/endDate"));a.setStartTime(t.getProperty("/startDate"));a.setEndTime(t.getProperty("/endDate"));this._bCancel=false;this._oDomToPrint=[];this._oDomToPrintHeight=0;this._oDomToPrintWidth=0;if(!this._bMultipleBatches){this._oFlexBoxPreview.setBusy(true);this._oButtonExport.setEnabled(false);if(this._oButtonSave){this._oButtonSave.setEnabled(false)}}var o;if(!this._oClonedGanttDiv.id){this._oClonedGanttDiv.id="clonedGanttDiv";o=true;if(this._getOriginalGanttChart().$().closest(".sapUiSizeCompact").length>0){this._oClonedGanttDiv.classList.add("sapUiSizeCompact")}this._oClonedGanttDiv.style.position="absolute";this._oClonedGanttDiv.style.top="-17000px";this._oClonedGanttDiv.style.left="-17000px";if(this._ganttChartClone._enableOptimisation){this._ganttChartClone.placeAt("clonedGanttDiv")}else{this._ganttChartContainer.placeAt("clonedGanttDiv")}this._updateDialogErrorPDFPreview(false)}if(o){o=false;this._addBackOriginalGanttRowBinding(this._ganttChartClone,this._getOriginalGanttChart())}this._setGanttCloneDivWidth(a);this._setGanttCloneDivHeight();e.setTotalHorizon(a);e.setVisibleHorizon(i);if(!this._ganttChartClone._enableOptimisation){this._ganttChartClone.invalidate()}this._ganttChartClone._bRenderGanttClone=true;var n=this._getOriginalGanttChart();var r=Math.max(n.getAxisTimeStrategy().getZoomLevel(),1);this.iThreshold=Math.min(Math.round(n.getPrintingBatchSize()/r),n.getTable()._getTotalRowCount());this._ganttChartClone.setShowGanttHeader(true);if(this._bMultipleBatches){this._openProgressDialog()}this._ganttChartClone._bRenderGanttClone=false;return this.generatePdfAsync(0)};Pt.prototype._updateGanttCanvas=function(){if(this._initialDisplayType===ct.Table){return}var t=this._oModel;var e=this._ganttChartClone.getAxisTimeStrategy();var i=e.getVisibleHorizon().clone();var a=e.getTotalHorizon().clone();i.setStartTime(t.getProperty("/startDate"));i.setEndTime(t.getProperty("/endDate"));a.setStartTime(t.getProperty("/startDate"));a.setEndTime(t.getProperty("/endDate"));var o=this._getGanttCloneDivHeight();var n=this._getGanttCloneDivWidth(a);if(n*this.canvasScale>Tt||o*this.canvasScale>Tt){this._oClonedGanttDiv.error=true;this._oGanttCanvas=undefined;this._updateDialogPreviewCanvas();this._oFlexBoxPreview.setBusy(false);return undefined}this._bUpdateGanttCanvas=true;this._bCancel=false;if(!this._bMultipleBatches){this._oFlexBoxPreview.setBusy(true);this._oButtonExport.setEnabled(false);if(this._oButtonSave){this._oButtonSave.setEnabled(false)}}var r;if(!this._oClonedGanttDiv.id){this._oClonedGanttDiv.id="clonedGanttDiv";r=true;if(this._getOriginalGanttChart().$().closest(".sapUiSizeCompact").length>0){this._oClonedGanttDiv.classList.add("sapUiSizeCompact")}this._oClonedGanttDiv.style.position="absolute";this._oClonedGanttDiv.style.top="-17000px";this._oClonedGanttDiv.style.left="-17000px";if(this._ganttChartClone._enableOptimisation){this._ganttChartClone.placeAt("clonedGanttDiv")}else{this._ganttChartContainer.placeAt("clonedGanttDiv")}}this._setGanttCloneDivWidth(a);this._setGanttCloneDivHeight();if(r){r=false;this._addBackOriginalGanttRowBinding(this._ganttChartClone,this._getOriginalGanttChart())}e.setTotalHorizon(a);e.setVisibleHorizon(i);if(!this._ganttChartClone._enableOptimisation){this._ganttChartClone.invalidate()}this._ganttChartClone._bRenderGanttClone=true;if(this._ganttChartClone._enableOptimisation){var s=this._getOriginalGanttChart();var l=Math.max(s.getAxisTimeStrategy().getZoomLevel(),1);this.iThreshold=Math.min(Math.round(s.getPrintingBatchSize()/l),s.getTable()._getTotalRowCount());this._ganttChartClone.setShowGanttHeader(true);if(this._bMultipleBatches){this._openProgressDialog()}this._ganttChartClone._bRenderGanttClone=false;return this.generateCanvasAsync(0)}else{this._oClonedGanttDiv.style.height=this._iGanttHeight*2+"px";return this._ganttChartClone.getInnerGantt().resolveWhenReady(this._originalHasRenderedShapes).then(function(){this._ganttChartClone._bRenderGanttClone=false;return this.renderGanttClone().then(function(){return this._fetchFont(this._ganttChartClone).then(function(){this._setCloneDivHeightNonOptimised();document.getElementById(this._ganttChartClone.getId()+"-sapGanttBackgroundTableContent").style.height=this._iContentHeight;document.getElementById(this._ganttChartClone.getTable().getId()+"-tableCCnt").style.height=this._iContentHeight;this._createGanttCanvas().then(function(t){this._oGanttCanvas=t;this._updateDialogPreview();this._oFlexBoxPreview.setBusy(false)}.bind(this)).catch(function(){this._oFlexBoxPreview.setBusy(false)}.bind(this))}.bind(this))}.bind(this))}.bind(this)).catch(function(){this._oFlexBoxPreview.setBusy(false)}.bind(this))}};Pt.prototype._drawClonedGantt=function(t){if(this._oClonedGanttDiv){return Promise.reject()}this._oClonedGanttDiv=document.createElement("div");document.body.appendChild(this._oClonedGanttDiv);var e=this._getGanttCloneDivHeight();var i=this._getGanttCloneDivWidth(this._ganttChartClone.getAxisTimeStrategy().getTotalHorizon());if(!t&&(i*this.canvasScale>Tt||e*this.canvasScale>Tt)){this._oClonedGanttDiv.error=true;return Promise.reject({bMaxCanvasSizeExceeded:true})}if(!this._validateDurationInput()){this._oClonedGanttDiv.dateError=true;return Promise.reject({dateDurationNotSet:true})}this._oClonedGanttDiv.id="clonedGanttDiv";if(this._getOriginalGanttChart().$().closest(".sapUiSizeCompact").length>0){this._oClonedGanttDiv.classList.add("sapUiSizeCompact")}this._oClonedGanttDiv.style.position="absolute";this._oClonedGanttDiv.style.top="-17000px";this._oClonedGanttDiv.style.left="-17000px";this._setGanttCloneDivWidth(this._ganttChartClone.getAxisTimeStrategy().getTotalHorizon());this._setGanttCloneDivHeight();var a=this._oModel;var o=this._ganttChartClone.getAxisTimeStrategy();o.getVisibleHorizon().setStartTime(a.getProperty("/startDate"));o.getVisibleHorizon().setEndTime(a.getProperty("/endDate"));if(this._ganttChartClone._enableOptimisation){this._ganttChartClone.placeAt("clonedGanttDiv")}else{this._ganttChartContainer.placeAt("clonedGanttDiv")}this._addBackOriginalGanttRowBinding(this._ganttChartClone,this._getOriginalGanttChart());if(this._ganttChartClone._enableOptimisation){return Promise.resolve()}else{this._oClonedGanttDiv.style.height=this._iGanttHeight*2+"px";return this._ganttChartClone.getInnerGantt().resolveWhenReady(this._originalHasRenderedShapes)}};Pt.prototype._addBackOriginalGanttRowBinding=function(t,e){var i=t.getTable();if(i.getBindingInfo("rows").binding==null){t.oPropagatedProperties=e._getPropertiesToPropagate();t.propagateProperties(true)}if(t.getEnablePseudoShapes()){var a=i.getRowSettingsTemplate();var o=e.getTable().getRowSettingsTemplate();if(a&&o.getBindingInfo("tasks")&&!a.getBindingInfo("tasks")){var n=Q.prototype.clone.call(o);a.bindAggregation("tasks",n.getBindingInfo("tasks"))}}if(this._ganttChartClone._enableOptimisation){if(this._getOriginalGanttChart._bExpandToggled){i.setRowMode(new tt({rowCount:this.iThreshold}))}else{var r=this._ganttChartClone.getTable();var s=r.getRowMode(),l=0;if(s&&s.getRowContentHeight()){l=s.getRowContentHeight()}else{l=r.getRowHeight()}i.setRowMode(new tt({rowCount:this.iThreshold,rowContentHeight:l?l:Math.ceil(this._getOriginalGanttChart().getTableRowHeights()[0])}))}i.setThreshold(this.iThreshold)}var h=e.getTable().getBinding("rows"),g=i.getBinding("rows");if(h){if(h.sCustomParams){g.sCustomParams=h.sCustomParams}if(h.aFilters&&h.aFilters.length>0){g.filter(h.aFilters)}if(h.aApplicationFilters&&h.aApplicationFilters.length>0){g.filter(h.aApplicationFilters,it.Application)}if(h.aSorters&&h.aSorters.length>0){g.sort(h.aSorters)}}};Pt.prototype._resizePrintingPreviewPage=function(){var t=this._oHTMLDialogPreview.getDomRef(),e=this._oHTMLDialogPreview.$().find(".sapGanttPrintingPreviewPageDiv")[0],i=t.offsetHeight,a=this._oModel.getProperty("/paperHeight"),o=this._oModel.getProperty("/paperWidth"),n=this._oModel.getProperty("/portrait"),r,s;if(n){r=i/a;s=o*r}else{r=i/o;s=i;i=a*r}e.style.width=s.toString()+"px";e.style.height=i.toString()+"px"};Pt.prototype._updateSinglePageMessages=function(t,e){if(e>t){this._oModel.setProperty("/orientationMessage",this._oRb.getText("GNT_PRNTG_SINGLE_PAGE_PORTRAIT"))}else{this._oModel.setProperty("/orientationMessage",this._oRb.getText("GNT_PRNTG_SINGLE_PAGE_LANDSCAPE"))}if(this._getPagesInARow()>3||this._getPagesInAColumn()>3){this._oModel.setProperty("/qualityWarning",true)}else{this._oModel.setProperty("/qualityWarning",false)}if(e>=t&&this._oModel.getProperty("/portrait")||e<=t&&!this._oModel.getProperty("/portrait")){this._oModel.setProperty("/showOrientationMessage",false)}else{this._oModel.setProperty("/showOrientationMessage",true)}};Pt.prototype._getCanvasOfPageN=function(t,e){var i=this._oModel.getProperty("/lastPageNumber");if(t>i){return null}var a=document.createElement("canvas");var o=a.getContext("2d");o.imageSmoothingEnabled=false;var n=this._getCroppingWidth(),r=this._getCroppingHeight();var s=this._getPagesInARow();var l=this._oModel.getProperty("/paperWidth"),h=this._oModel.getProperty("/paperHeight");var g=this._oModel.getProperty("/marginTop"),_=this._oModel.getProperty("/marginBottom"),p=this._oModel.getProperty("/marginLeft");var d=(t-1)%s,u=Math.floor((t-1)/s);a.width=l;a.height=h;if(!e){a.style.height="100%";a.style.width="auto"}o.fillStyle="white";o.fillRect(0,0,a.width,a.height);o.fillStyle=z.get({name:"sapUiBaseText",callback:function(t){o.fillStyle=t}});o.textBaseline="middle";o.font=ft;var c;var C=lt.getRTL();if(C){o.textAlign="right";c=l-_t._mmToPx(4)}else{o.textAlign="left";c=_t._mmToPx(4)}var P=o.measureText("...").width;var f=l-_t._mmToPx(4)-P;var m,T,v,y;if(this._oModel.getProperty("/showHeaderText")){m=this._oModel.getProperty("/headerText");var b=o.measureText(m).width;if(b>l-_t._mmToPx(4)){v=J.geNumberOfTruncatedCharacters(b,f,m,o,o.measureText,true);if(C){y=m.length-v;m="..."+m.slice(y,m.length).trim()}else{m=m.slice(0,v).trim()+"..."}}o.fillText(m,c,this._iHeaderAndFooterHeight/2)}if(this._oModel.getProperty("/showFooterText")){T=this._oModel.getProperty("/footerText");var x=o.measureText(T).width;if(x>l-_t._mmToPx(4)){v=J.geNumberOfTruncatedCharacters(x,f,T,o,o.measureText,true);if(C){y=T.length-v;T="..."+T.slice(y,T.length).trim()}else{T=T.slice(0,v).trim()+"..."}}o.fillText(T,c,h-this._iHeaderAndFooterHeight/2-(this._isFooterMultiline()?this._iHeaderAndFooterHeight:0))}this._mHeaderFooterInfo={headerText:m,footerText:T,position:c};var w=this._oModel.getProperty("/showPageNumber"),G=this._oModel.getProperty("/multiplePage"),S;if(G&&w){o.font=mt;o.textAlign="center";o.fillText(t.toString(),l/2,h-_-this._iHeaderAndFooterHeight/2)}if(G){var R=d*n,D=u*r,M=0,N=0;var E=false;if(R+n>this._oGanttCanvas.width){E=true;n=this._oGanttCanvas.width-R;N=n/this._getScale()}var B=false;if(D+r>this._oGanttCanvas.height){B=true;r=this._oGanttCanvas.height-D;M=r/this._getScale()}S=(E?N:this._getPaperContentWidth())/n;if(S<.5&&e){var I=document.createElement("canvas");I.width=n;I.height=r;var A=I.getContext("2d");A.drawImage(this._oGanttCanvas,R,D,n,r,0,0,n,r);this._downScaleCanvas(I,o,S,0,0,I.width,I.height,p,g+this._getHeaderHeight())}else{o.drawImage(this._oGanttCanvas,R,D,n,r,p,g+this._getHeaderHeight(),E?N:this._getPaperContentWidth(),B?M:this._getPaperContentHeight())}}else{var L=this._getPaperContentWidth(),H=this._getPaperContentHeight();var O=this._isShrinkableToOnePageByWidth();var F;if(O){F=L/this._oGanttCanvas.width;H=this._oGanttCanvas.height*F}else{F=H/this._oGanttCanvas.height;L=this._oGanttCanvas.width*F}this._updateSinglePageMessages(L,H);S=L/this._oGanttCanvas.width;if(S<1&&e){this._downScaleCanvas(this._oGanttCanvas,o,S,0,0,this._oGanttCanvas.width,this._oGanttCanvas.height,p,g+this._getHeaderHeight())}else{o.drawImage(this._oGanttCanvas,0,0,this._oGanttCanvas.width,this._oGanttCanvas.height,p,g+this._getHeaderHeight(),L,H)}}return a};Pt.prototype._getFXTextPosition=function(){var t;var e=this._oModel.getProperty("/paperWidth");var i=lt.getRTL();if(i){t=e-_t._mmToPx(4)}else{t=_t._mmToPx(4)}return t/(i?Math.trunc(yt*10)/10:yt)};Pt.prototype._downScaleCanvas=function(t,e,i,a,o,n,r,s,l){var h=document.createElement("canvas");h.width=n;h.height=r;var g=h.getContext("2d");g.drawImage(t,a,o,n,r,0,0,n,r);var _=i*i;var p=Math.floor(n*i);var d=Math.floor(r*i);var u=0,c=0,C=0;var P=0,f=0,m=0,T=0;var v=0,y=0;var b=0,x=0,w=0;var G=0,S=0,R=0;var D=false,M=false;var N=h.getContext("2d").getImageData(0,0,n,r).data;var E=new Float32Array(3*p*d);var B=0,I=0,A=0;for(c=0;c<r;c++){f=c*i;y=0|f;m=3*y*p;M=y!==(0|f+i);if(M){w=y+1-f;R=f+i-y-1}for(u=0;u<n;u++,C+=4){P=u*i;v=0|P;T=m+v*3;D=v!==(0|P+i);if(D){x=v+1-P;S=P+i-v-1}B=N[C];I=N[C+1];A=N[C+2];if(!D&&!M){E[T]+=B*_;E[T+1]+=I*_;E[T+2]+=A*_}else if(!D&&M){b=w*i;E[T]+=B*b;E[T+1]+=I*b;E[T+2]+=A*b;G=R*i;E[T+3*p]+=B*G;E[T+3*p+1]+=I*G;E[T+3*p+2]+=A*G}else if(D&&!M){b=x*i;E[T]+=B*b;E[T+1]+=I*b;E[T+2]+=A*b;G=S*i;E[T+3]+=B*G;E[T+4]+=I*G;E[T+5]+=A*G}else{b=x*w;E[T]+=B*b;E[T+1]+=I*b;E[T+2]+=A*b;G=S*w;E[T+3]+=B*G;E[T+4]+=I*G;E[T+5]+=A*G;G=x*R;E[T+3*p]+=B*G;E[T+3*p+1]+=I*G;E[T+3*p+2]+=A*G;G=S*R;E[T+3*p+3]+=B*G;E[T+3*p+4]+=I*G;E[T+3*p+5]+=A*G}}}var L=document.createElement("canvas");L.width=p;L.height=d;var H=L.getContext("2d");var O=H.getImageData(0,0,p,d);var F=O.data;var k=0;for(C=0,T=0;k<p*d;C+=3,T+=4,k++){F[T]=0|E[C];F[T+1]=0|E[C+1];F[T+2]=0|E[C+2];F[T+3]=255}e.putImageData(O,s,l);return};function xt(t){while(t.firstChild){t.removeChild(t.firstChild)}}Pt.prototype._createPreviewErrorMessageStrip=function(t){return new w({text:this._oRb.getText(t?"GNT_PRNTG_ERROR_TOOHIGHCHART":"GNT_PRNTG_ERROR_BIGCHART"),showIcon:true,type:"Error"})};Pt.prototype._updateDialogPreviewCanvas=function(){var t=this._oHTMLDialogPreview.$().find(".sapGanttPrintingPreviewPageDiv");var e=t[0];if(this._oGanttCanvas){this._oButtonExport.setEnabled(true);if(this._oButtonSave){this._oButtonSave.setEnabled(true)}var i=this._oModel.getProperty("/multiplePage");if(i){this._oModel.setProperty("/qualityWarning",false);this._oModel.setProperty("/showOrientationMessage",false)}var a=this._getCanvasOfPageN(i?this._oModel.getProperty("/previewPageNumber"):1,false);xt(e);this._resizePrintingPreviewPage();e.appendChild(a)}else if(!this._oGanttCanvas&&(this._oClonedGanttDiv.offsetWidth>Tt||this._oClonedGanttDiv.offsetHeight>Tt||this._oClonedGanttDiv.error||this._oClonedGanttDiv.dateError)){this._resizePrintingPreviewPage();this._oModel.setProperty("/qualityWarning",false);this._oModel.setProperty("/showOrientationMessage",false);if(!this._oHTMLDialogPreview.$().find("#"+this.getId()+"-previewErrorMessageStrip").length){xt(e);if(!this._oPreviewErrorMessageStrip){if(this._oClonedGanttDiv.error){this._oClonedGanttDiv.error=false;this._oPreviewErrorMessageStrip=this._createPreviewErrorMessageStrip(this._oClonedGanttDiv.offsetHeight>Tt)}else if(this._oClonedGanttDiv.dateError){this._oClonedGanttDiv.dateError=false;this._oPreviewErrorMessageStrip=new w({text:this._oRb.getText("GNT_PRNTG_ERROR_DATEDURATION_PREVIEW"),showIcon:true,type:"Error"})}}var o=document.createElement("div");o.id=this.getId()+"-previewErrorMessageStrip";o.style.width="80%";e.appendChild(o);this._oPreviewErrorMessageStrip.placeAt(this.getId()+"-previewErrorMessageStrip")}}else{throw new Error("Gantt chart canvas does not exist.")}t.addClass("sapGanttPrintingPreviewPageDivBorder")};Pt.prototype._updateDialogPreview=function(){this._updateLastPageNumber();this._updatePageNumberButtons();this._updateDialogPreviewCanvas()};Pt.prototype._setStylesToDom=function(t){const e=["fill","stroke","stroke-width","font-size","font-family","stroke-dasharray","color","opacity","visibility","display","transform","text-anchor","font-weight","background-color","style","filter"];function i(t){if(t.style.fill.indexOf('url("#')===0){return}const i=getComputedStyle(t);let a="";for(const t of e){const e=i.getPropertyValue(t);if(e){a+=t+":"+e+";"}}t.setAttribute("style",a)}const a=[t];while(a.length>0){const t=a.shift();if(!t||t.nodeType!==1||t.nodeName==="SCRIPT"){continue}i(t);for(let e=0;e<t.childNodes.length;e++){if(t.childNodes[e].nodeType===1){a.push(t.childNodes[e])}}}};Pt.prototype._fetchFont=async function(t){var e=t.getDomRef().getElementsByClassName("sapGanttChartSvg")[0];if(this.fontStyleElement&&e){e.insertBefore(this.fontStyleElement,e.firstChild);return}var i=lt.getTheme();var a="base";if(i.indexOf("sap_horizon")>-1){a=i}var o=sap.ui.require.toUrl("sap/ui/core/themes/"+a+"/fonts/SAP-icons.ttf");if(e){try{const t=await fetch(o);const i=await t.arrayBuffer();const a=new Uint8Array(i);let n="";const r=8192;for(let t=0;t<a.length;t+=r){n+=String.fromCharCode(...a.subarray(t,t+r))}n=btoa(n);this.fontStyleElement=document.createElement("style");this.fontStyleElement.setAttribute("type","text/css");this.fontStyleElement.textContent="@font-face { font-family: 'SAP-icons'; src: url(data:font/ttf;base64,"+n+") format('truetype'); font-weight: normal; font-style: normal;}";e.insertBefore(this.fontStyleElement,e.firstChild)}catch(t){pt.error("Error fetching font:",t)}}};Pt.prototype._setStyleToGanttChartSvg=function(t){var e=t.$().find("svg.sapGanttChartSvg")[0];var i=t.$().find("svg.sapGanttChartHeaderSvg")[0];if(e){this._setStylesToDom(e)}if(i){this._setStylesToDom(i)}};Pt.prototype._setStyleToGanttChartTable=function(t){var e=t.getElementsByClassName("sapUiTable")[0];if(e){this._setStylesToDom(e)}};Pt.prototype._getHorizonDates=function(t){var e=t.getStartTime();var i=t.getEndTime();return{startTime:new Date(D.abapTimestampToDate(e)),endTime:new Date(D.abapTimestampToDate(i))}};Pt.prototype._horizonWidthInSec=function(t){if(t&&t.startTime&&t.endTime){return t.endTime.getTime()-t.startTime.getTime()}return 0};Pt.prototype._pageToBeExported=function(){if(!this._oModel.getProperty("/multiplePage")){return[1]}var t=this._oModel.getProperty("/lastPageNumber"),e=this._oModel.getProperty("/exportAll"),i=[];if(e||this._bSinglePage){for(var o=1;o<=t;o++){i.push(o)}return i}else{var n=this._oModel.getProperty("/exportRange");n=n.replace(/\s/g,"");var r=a.getIntegerInstance();var s=n.split(",");s.forEach(function(t){if(t.indexOf("-")!==-1){var e=t.split("-");var a=r.parse(e[0]);var o=r.parse(e[1]);for(var n=a;n<=o;n++){i.push(n)}}else{i.push(r.parse(t))}});return i}};Pt.prototype._validateFields=function(){var t=true;t&=this._validateExportRangeInput();t&=this._validateDurationInput();t&=this._oInputMarginTop.getValueState()!=="Error";t&=this._oInputMarginRight.getValueState()!=="Error";t&=this._oInputMarginBottom.getValueState()!=="Error";t&=this._oInputMarginLeft.getValueState()!=="Error";return t};Pt.prototype._setStyleToPath=function(t){var e=["fill","fillOpacity","stroke","strokeWidth","strokeDasharray","strokeOpacity","opacity","transform"];var i=[];e.forEach(function(e){i.push(t.style[e])});t.removeAttribute("style");e.forEach(function(e,a){t.style[e]=i[a]})};Pt.prototype._updatePdfPreview=function(t){if(!this._oPdfPreview){var i=this._oPdfDialogPreview.getParent().getDomRef().offsetHeight-100;this._oPdfPreview=new X({source:t,width:"94%",height:i.toString()+"px",showDownloadButton:false,isTrustedSource:true});e.sap.addUrlWhitelist("blob");this._oPdfPreview.placeAt("sapGanttPdfPreviewDiv")}else{this._oPdfPreview.setSource(t)}this._oDialog.getContent()[0].setBusy(false);this._oFlexBoxPreview.setBusy(false);this._oButtonExport.setEnabled(true);if(this._oButtonSave){this._oButtonSave.setEnabled(true)}};Pt.prototype._addClipRectDefs=function(t,e,i,a,o){var n=document.createElement("defs");t.appendChild(n);var r=document.createElement("clipPath");r.setAttribute("id","printClipRect");n.appendChild(r);var s=document.createElement("rect");s.setAttribute("x",e);s.setAttribute("y",i);s.setAttribute("width",a);s.setAttribute("height",o);r.appendChild(s)};Pt.prototype._generateSvgToPdf=function(){if(!this._validateFields()){return}this._oDialog.getContent()[0].setBusy(true);this._oFlexBoxPreview.setBusy(true);this._oButtonExport.setEnabled(false);if(this._oButtonSave){this._oButtonSave.setEnabled(false)}var t=this;var e=this._oModel.getProperty("/portrait")?"p":"l",i=this._oModel.getProperty("/paperWidth"),a=this._oModel.getProperty("/paperHeight"),o=this._oModel.getProperty("/marginTop")*bt,n=this._oModel.getProperty("/marginRight")*bt,r=this._oModel.getProperty("/marginBottom")*bt,s=this._oModel.getProperty("/marginLeft")*bt,l=this._oModel.getProperty("/paperSize");var h=this._ganttChartClone;var g=h.getDisplayType()===ct.Both?h.getTable().getDomRef().offsetWidth:0;var _=new W({orientation:e,unit:"px",format:l==="Custom"?[i*bt,a*bt]:l.toLowerCase()});function p(){if(!this._getOriginalGanttChart()){return}var e=document.createElement("svg");e.setAttribute("id","mergedSvg");var i=Number(this._oDomToPrint[0].style.width.slice(0,-2))-Number(this._oDomToPrint[0].getElementsByTagName("section")[0].style.width.slice(0,-2))-16;if(d===0){var a=this._oDomToPrint[d].getElementsByClassName("sapGanttChartHeaderSvg")[0].cloneNode(true);var o=z.get({name:"sapUiListHeaderBackground",callback:function(t){o=t}});a.children[0].setAttribute("style","fill: "+o+";width: "+i);a.getElementsByTagName("rect")[1].setAttribute("width",i+"px");if(a.getElementById("inner-header-g")){a.getElementById("inner-header-g").children[0].setAttribute("width",i+"px")}var n=a.height.baseVal.value}var r=this._oDomToPrint[d].getElementsByClassName("sapGanttChartSvg")[0].cloneNode(true);var l=this._getOriginalGanttChart().getDomRef()?this._getOriginalGanttChart().getDomRef().getElementsByClassName("sapGanttChartSvgDefs"):null;var h=l&&l.length>0?l[0].cloneNode(true):null;if(r.getElementsByClassName("sapGanttChartVerticalLine")&&r.getElementsByClassName("sapGanttChartVerticalLine").length){var u=this._generateVerticalLines(this._ganttChartClone,r.height.baseVal.value);if(u){r.getElementsByClassName("sapGanttChartVerticalLine")[0].setAttribute("d",u);r.getElementsByClassName("sapGanttChartVerticalLine")[0].removeAttribute("style")}else{return}}r.removeAttribute("style");if(d===0){Array.prototype.slice.call(a.getElementsByTagName("path")).forEach(function(e){t._setStyleToPath(e)})}Array.prototype.slice.call(r.getElementsByClassName("sapGanttChartShapes")[0].getElementsByTagName("path")).forEach(function(e){t._setStyleToPath(e)});Array.prototype.slice.call(r.getElementsByClassName("sapGanttChartRls")[0].getElementsByTagName("path")).forEach(function(e){t._setStyleToPath(e)});if(r.getElementsByClassName("sapGanttBackgroundSVGRowBorder").length){Array.prototype.slice.call(r.getElementsByClassName("sapGanttBackgroundSVGRowBorder")).forEach(function(t){t.setAttribute("x2",i);t.setAttribute("y1",t.getAttribute("y1"));t.setAttribute("y2",t.getAttribute("y2"))})}if(r.getElementsByClassName("sapGanttBackgroundSVGRow").length){var c=z.get({name:"sapUiListBackground",callback:function(t){c=t}});Array.prototype.slice.call(r.getElementsByClassName("sapGanttBackgroundSVGRow")).forEach(function(t){t.setAttribute("style","fill: "+c+";width: "+i)})}this._setLinesHeight(r);if(d===0){this._setCalenderDefsPosition(h,R,g);e.appendChild(a);r.setAttribute("y",n)}else{r.setAttribute("y",0)}e.appendChild(r);e.appendChild(h);this._addClipRectDefs(e,0,0,i,this._oDomToPrintHeight);e.setAttribute("clip-path","url(#printClipRect)");this._mHeaderFooterInfo["mergedSVG"]=e;var C=document.createElement("div");var P=this._oDomToPrint[d].getElementsByTagName("section")[0].cloneNode(true);C.appendChild(P);if(d===0){var f=this._oDomToPrint[d].getElementsByClassName("sapUiLoSplitterBar")[0].cloneNode(true);while(f.children.length>0){f.removeChild(f.firstChild)}var m=window.getComputedStyle(this._getOriginalGanttChart().getDomRef().getElementsByClassName("sapUiLoSplitterBar")[0]);var T=m.backgroundColor?m.backgroundColor:z.get({name:"sapChart_Sequence_Neutral_Plus2",callback:function(t){T=t}});f.setAttribute("style","background-color: "+T+";width: 1rem;display: inline-block; height: "+this._oDomToPrintHeight+"px");f.style.transform="translate("+g+"px, -"+this._oDomToPrint[d].style.height+")";C.appendChild(f)}const v=document.createElement("style");v.innerHTML=`\n\t\t\t\t\t.sapUiPseudoInvisibleText { display: none !important; }\n\t\t\t\t\t.sapMObjStatusText { position: relative; top: -0.25em; }\n\t\t\t\t`;C.appendChild(v);_.html(C,{callback:function(i){var a=i.internal.getNumberOfPages();while(a>1){i.deletePage(a);a--}j(e,i,{xOffset:(g+16)*R+s,yOffset:D,scale:R});d++;if(d>=t._oDomToPrint.length){t.oSinglePagePdf=i;t._updatePdfPreview(i.output("bloburl"))}else{D=D+Number(t._oDomToPrint[d-1].style.height.slice(0,-2))*R;p.call(t)}},html2canvas:{scale:R,allowTaint:true},x:s,y:D})}var d=0;var u=0;var c=this._oDomToPrintHeight*2;var C=this._oDomToPrintWidth*2;_.setFontSize(6.5);var P=_.getTextWidth("...")*yt;var f=i-_t._mmToPx(4)-P;var m,T,v,y;var b=lt.getRTL();var x=b?"right":"left";if(this._oModel.getProperty("/showHeaderText")){m=this._oModel.getProperty("/headerText");u=u+this._iHeaderAndFooterHeight;var w=_.getTextWidth(m)*yt;if(w>i-_t._mmToPx(4)){v=J.geNumberOfTruncatedCharacters(w,f,m,_,_.getTextWidth,false,yt);if(b){y=m.length-v;m="..."+m.slice(y,m.length).trim()}else{m=m.slice(0,v).trim()+"..."}}_.text(m,this._getFXTextPosition(),this._iHeaderAndFooterHeight/(2*yt),x)}if(this._oModel.getProperty("/showFooterText")){T=this._oModel.getProperty("/footerText");u=u+this._iHeaderAndFooterHeight;var G=_.getTextWidth(T)*yt;if(G>i-_t._mmToPx(4)){v=J.geNumberOfTruncatedCharacters(G,f,T,_,_.getTextWidth,false,yt);if(b){y=T.length-v;T="..."+T.slice(y,T.length).trim()}else{T=T.slice(0,v).trim()+"..."}}_.text(T,this._getFXTextPosition(),_.getPageHeight()-this._iHeaderAndFooterHeight/(2*yt)-(this._isFooterMultiline()?this._iHeaderAndFooterHeight/yt:0),x)}this._mHeaderFooterInfo={oPdf:_,headerText:m,footerText:T,position:this._getFXTextPosition()};var S=this._isDomShrinkableToOnePageByWidth(c,C);var R=S?(i*bt-n-s)/this._oDomToPrintWidth:(a*bt-o-r-u)/this._oDomToPrintHeight;var D=o+t._getHeaderHeight();this._pageMargin=[o,n,r,s];if(this.sFont){_.addFileToVFS("SAP-icons.ttf",this.sFont);_.addFont("SAP-icons.ttf","SAP-icons","normal");_.setFont("SAP-icons");_.setFontSize(9);p.call(this)}else{var M=lt.getTheme(),N="base";if(M.indexOf("sap_horizon")>-1){N=M}var E=sap.ui.require.toUrl("sap/ui/core/themes/"+N+"/fonts/SAP-icons.ttf");this._fetchFontAndGeneratePdf(E,_,p)}};Pt.prototype._fetchFontAndGeneratePdf=function(t,e,i){var a=this;fetch(t).then(function(t){return t.blob()}).then(function(t){var o=new FileReader;o.onload=function(){if(o.readyState===o.DONE){a.sFont=o.result;e.addFileToVFS("SAP-icons.ttf",a.sFont);e.addFont("SAP-icons.ttf","SAP-icons","normal");e.setFont("SAP-icons");e.setFontSize(9);i.call(a)}};o.readAsBinaryString(t)}).catch(function(t){})};Pt.prototype._setLinesHeight=function(t){var e=t.height.baseVal.value;if(t.getElementsByClassName("sapGanttNowLineBodySvgLine").length){t.getElementsByClassName("sapGanttNowLineBodySvgLine")[0].getElementsByTagName("line")[0].setAttribute("y2",e)}if(t.getElementsByClassName("sapGanttChartAdhocLine").length){Array.prototype.slice.call(t.getElementsByClassName("sapGanttChartAdhocLine")[0].getElementsByTagName("line")).forEach(function(t){t.setAttribute("y2",e)})}if(t.getElementsByClassName("sapGanttChartDeltaLine").length){Array.prototype.slice.call(t.getElementsByClassName("sapGanttChartDeltaLine")[0].getElementsByTagName("line")).forEach(function(t){t.setAttribute("y2",e)})}if(t.getElementsByClassName("sapGanttChartAreaDeltaLine").length){Array.prototype.slice.call(t.getElementsByClassName("sapGanttChartAreaDeltaLine")[0].getElementsByTagName("rect")).forEach(function(t){t.setAttribute("height",e)})}};Pt.prototype._setCalenderDefsPosition=function(t,e,i){var a=this._oModel.getProperty("/marginRight"),o=this._oModel.getProperty("/marginLeft");Array.prototype.slice.call(t.getElementsByTagName("rect")).forEach(function(t){t.setAttribute("x",(Number(t.getAttribute("x"))+i)*e+(a+o)+32);t.setAttribute("width",Number(t.getAttribute("width"))*e)})};Pt.prototype._savePdf=function(){if(!this._validateFields()){return}var t=this._oModel.getProperty("/portrait")?"p":"l",e=this._oModel.getProperty("/paperWidth"),i=this._oModel.getProperty("/paperHeight"),a=this._oModel.getProperty("/exportAsJPEG"),o=this._oModel.getProperty("/compressionQuality")/100,n=this._oModel.getProperty("/paperSize");var r=new W({orientation:t,unit:"px",format:n==="Custom"?[e*bt,i*bt]:n.toLowerCase()});var s=this._pageToBeExported();for(var l=0;l<s.length;l++){var h=this._getCanvasOfPageN(s[l],true);if(!h){continue}if(l!==0){r.addPage()}if(a){r.addImage(h.toDataURL("image/jpeg",o),"JPEG",0,0)}else{r.addImage(h.toDataURL("image/png"),"PNG",0,0)}}this._downloadPdf(r)};Pt.prototype._downloadPdf=function(t){var e=new Date;t.save("GanttChartExport-"+e.toISOString()+".pdf")};Pt.prototype._generateVerticalLines=function(t,e){var i=Number(this._oDomToPrint[0].style.width.slice(0,-2))-Number(this._oDomToPrint[0].getElementsByTagName("section")[0].style.width.slice(0,-2)),a=t.getAxisTime();var o="";if(a){var n=a.getZoomStrategy();var r=a.getTickTimeIntervalLabel(n.getTimeLineOption(),null,[0,i]);var s=r[1];for(var l=0;l<s.length;l++){o+=" M"+" "+(s[l].value-1/2)+" 0"+" v "+e}}return o};Pt.prototype._createPaperComboBox=function(t){this._oComboBoxPaperSizes=new c({selectedKey:"{setting>/paperSize}",change:this._updatePaperSizeValues.bind(this,t),items:[new B({key:"A5",text:"A5"}),new B({key:"A4",text:"A4"}),new B({key:"A3",text:"A3"}),new B({key:"A2",text:"A2"}),new B({key:"A1",text:"A1"}),new B({key:"A0",text:"A0"}),new B({key:"Letter",text:this._oRb.getText("GNT_PRNTG_PAPER_SIZE_LETTER")}),new B({key:"Legal",text:this._oRb.getText("GNT_PRNTG_PAPER_SIZE_LEGAL")}),new B({key:"Tabloid",text:this._oRb.getText("GNT_PRNTG_PAPER_SIZE_TABLOID")}),new B({key:"Custom",text:this._oRb.getText("GNT_PRNTG_PAPER_SIZE_CUSTOM")})]});return this._oComboBoxPaperSizes};Pt.prototype._createPaperSizeFields=function(t){this._oUnitLabel=new A({text:this._oRb.getText("GNT_PRNTG_UNIT")});this._oUnitLabel.toStatic();this._oHeightLabel=new A({text:this._oRb.getText("GNT_PRNTG_HEIGHT")});this._oHeightLabel.toStatic();this._oWidthLabel=new A({text:this._oRb.getText("GNT_PRNTG_WIDTH")});this._oWidthLabel.toStatic();this._oInputPaperWidth=new g({type:"Number",change:this._onChangePaperSizeInput.bind(this,t),ariaLabelledBy:this._oWidthLabel});this._oInputPaperHeight=new g({type:"Number",change:this._onChangePaperSizeInput.bind(this,t),ariaLabelledBy:this._oHeightLabel});this._updatePaperSizeInputs();this._oComboBoxUnit=new c({selectedKey:"{setting>/unit}",change:this._onChangeUnitComboBox.bind(this),ariaLabelledBy:this._oUnitLabel,items:[new B({key:"mm",text:this._oRb.getText("GNT_PRNTG_MILLIMETERS")}),new B({key:"cm",text:this._oRb.getText("GNT_PRNTG_CENTIMETERS")}),new B({key:"in",text:this._oRb.getText("GNT_PRNTG_INCHES")})]});var e=new _({renderType:"Bare",direction:ut.Column,items:[new o({text:this._oRb.getText("GNT_PRNTG_WIDTH"),showColon:true}),this._oInputPaperWidth]}).addStyleClass("sapGanttPrintingSmallRightMargin");var i=new _({renderType:"Bare",direction:ut.Column,items:[new o({text:this._oRb.getText("GNT_PRNTG_HEIGHT"),showColon:true}),this._oInputPaperHeight]}).addStyleClass("sapGanttPrintingSmallLeftMargin");var a=new _({renderType:"Bare",direction:ut.Column,items:[new o({text:this._oRb.getText("GNT_PRNTG_UNIT"),showColon:true}),this._oComboBoxUnit]}).addStyleClass("sapGanttPrintingLeftMargin");var r=new _({renderType:"Bare",alignItems:"Center",justifyContent:"SpaceBetween",items:[e,new n({text:""}).addStyleClass("sapGanttPrintingTopMargin"),i]});return new _({renderType:"Bare",alignItems:"Center",justifyContent:"SpaceBetween",items:[r,a]})};Pt.prototype._createDurationComboBox=function(t){var e=this._getOriginalGanttChart().getAxisTimeStrategy(),i=e.getTotalHorizon(),a=new Date(D.abapTimestampToDate(i.getEndTime())),o=new Date;this._oComboBoxDuration=new c({selectedKey:"{setting>/duration}",change:this._onChangeDurationComboBox.bind(this,t),items:[new B({key:"all",text:this._oRb.getText("GNT_PRNTG_DURATION_ALL")}),new B({key:"week",enabled:this._getFirstDayOfNextWeek(o).getTime()<a.getTime(),text:this._oRb.getText("GNT_PRNTG_DURATION_NEXT_WEEK")}),new B({key:"month",enabled:this._getFirstDayOfNextMonth(o).getTime()<a.getTime(),text:this._oRb.getText("GNT_PRNTG_DURATION_NEXT_MONTH")}),new B({key:"custom",text:this._oRb.getText("GNT_PRNTG_DURATION_CUSTOM")})]});return this._oComboBoxDuration};Pt.prototype._createDatePicker=function(t){var e=this._ganttChartClone.getLocale();var i=this._ganttChartClone.getAxisTimeStrategy().getTotalHorizon();var a=D.abapTimestampToDate(i.getStartTime());var r=D.abapTimestampToDate(i.getEndTime());this._customDates={startDate:this._oModel.getProperty("/startDate"),endDate:this._oModel.getProperty("/endDate")};this._oModel.setProperty("/startDate",a);this._oModel.setProperty("/endDate",r);this._oModel.setProperty("/timezone",e.getTimeZone());this._oStartDateLabel=new A({text:this._oRb.getText("GNT_PRNTG_START_DATE")});this._oEndDateLabel=new A({text:this._oRb.getText("GNT_PRNTG_END_DATE")});this._oStartDateLabel.toStatic();this._oEndDateLabel.toStatic();var s=this._getOriginalGanttChart().getAxisTimeStrategy().getTotalHorizon();var l=D.abapTimestampToDate(s.getStartTime());var h=D.abapTimestampToDate(s.getEndTime());this._oDatePickerFrom=new b({minDate:Y.getInstance(l),maxDate:Y.getInstance(h),value:{parts:[{path:"setting>/startDate",type:new at},{path:"setting>/timezone",type:new ot}],type:new nt},change:this._onChangeDurationDatePicker.bind(this,t),enabled:true,timezone:e.getTimeZone(),showTimezone:false,ariaLabelledBy:this._oStartDateLabel});this._oDatePickerTo=new b({minDate:Y.getInstance(l),maxDate:Y.getInstance(h),value:{parts:[{path:"setting>/endDate",type:new at},{path:"setting>/timezone",type:new ot}],type:new nt},change:this._onChangeDurationDatePicker.bind(this,t),enabled:true,ariaLabelledBy:this._oEndDateLabel,timezone:e.getTimeZone(),showTimezone:false});var g=new _({renderType:"Bare",direction:ut.Column,items:[new o({text:this._oRb.getText("GNT_PRNTG_START_DATE"),showColon:true}),this._oDatePickerFrom]}).addStyleClass("sapGanttPrintingSmallRightMargin");var p=new _({renderType:"Bare",direction:ut.Column,items:[new o({text:this._oRb.getText("GNT_PRNTG_END_DATE"),showColon:true}),this._oDatePickerTo]}).addStyleClass("sapGanttPrintingSmallLeftMargin");this._updatedatePickerValues();return new _({renderType:"Bare",alignItems:"Center",justifyContent:"SpaceBetween",items:[g,new n({text:"~"}).addStyleClass("sapGanttPrintingTopMargin"),p]})};Pt.prototype._updatedatePickerValues=function(){var t=this._oModel.getProperty("/duration");if(t==="all"){var e=this._ganttChartClone.getAxisTimeStrategy().getTotalHorizon();var i=D.abapTimestampToDate(e.getStartTime());var a=D.abapTimestampToDate(e.getEndTime());this._oModel.setProperty("/startDate",this._validateDate(i));this._oModel.setProperty("/endDate",this._validateDate(a))}else if(t==="week"){this._nextWeekRange()}else if(t==="month"){this._nextMonthRange()}else if(t==="custom"){this._oModel.setProperty("/startDate",this._validateDate(this._customDates.startDate));this._oModel.setProperty("/endDate",this._validateDate(this._customDates.endDate))}var o=this._oModel.getProperty("/startDate");var n=this._oModel.getProperty("/endDate");this._oDatePickerFrom.setValue(o);this._oDatePickerTo.setValue(n);var r=this._ganttChartClone.getAxisTimeStrategy();var s=r.getVisibleHorizon().clone();var l=r.getTotalHorizon().clone();s.setStartTime(this._oModel.getProperty("/startDate"));s.setEndTime(this._oModel.getProperty("/endDate"));l.setStartTime(this._oModel.getProperty("/startDate"));l.setEndTime(this._oModel.getProperty("/endDate"));r.setTotalHorizon(l);r.setVisibleHorizon(s)};Pt.prototype._createScale=function(){return new m({min:50,max:200,step:1,width:"25rem",value:"{setting>/scale}",visible:"{setting>/multiplePage}",liveChange:this._updateDialogPreview.bind(this),showAdvancedTooltip:true,inputsAsTooltips:true})};Pt.prototype._validateExportRangeInput=function(){if(this._oModel.getProperty("/exportAll")||this._bSinglePage){return true}var t=this._oModel.getProperty("/exportRange").replace(/\s/g,"");if(/^((\d+),|(\d+-\d+),)*((\d+)|(\d+-\d+))+$/.test(t)){this._oInputRange.setValueState("None");return true}this._oInputRange.setValueState("Error");this._oInputRange.setValueStateText(this._oRb.getText("GNT_PRNTG_PAGE_RANGE_ERROR"));return false};Pt.prototype._validateDurationInput=function(){var t=this._oModel.getProperty("/duration");if(!["all","week","month","custom"].includes(t)){this._oComboBoxDuration.setValueState("Error");this._oComboBoxDuration.setValueStateText(this._oRb.getText("GNT_PRNTG_ERROR_DATEDURATION"));this._oDatePickerFrom.setValueState("Error");this._oDatePickerTo.setValueState("Error");return false}this._oComboBoxDuration.setValueState("None");this._oDatePickerFrom.setValueState("None");this._oDatePickerTo.setValueState("None");return true};Pt.prototype._createPageRange=function(){this._oRangeLabel=new A({text:this._oRb.getText("GNT_PRNTG_PAGE_RANGE")});this._oRangeLabel.toStatic();var t=function(t){var e=t.getSource().getSelectedIndex();if(e===0){this._oButtonExport.setEnabled(true);if(this._oButtonSave){this._oButtonSave.setEnabled(true)}this._oInputRange.setValueState("None")}};return new _({renderType:"Bare",alignItems:"Center",visible:"{setting>/multiplePage}",justifyContent:"SpaceBetween",items:[new P({layoutData:new d({shrinkFactor:0,growFactor:1}),selectedIndex:this._oModel.getProperty("/exportAll")?0:1,columns:2,select:t.bind(this),buttons:[new C({id:"all",text:this._oRb.getText("GNT_PRNTG_PAGE_RANGE_ALL"),selected:"{setting>/exportAll}",ariaLabelledBy:this._oRangeLabel}),new C({id:"range",text:this._oRb.getText("GNT_PRNTG_PAGE_RANGE_RANGE")+" ",ariaLabelledBy:this._oRangeLabel})]}),this._oInputRange=new g({layoutData:new d({growFactor:1}),value:"{setting>/exportRange}",change:this._validateExportRangeInput.bind(this),enabled:{path:"setting>/exportAll",formatter:function(t){return!t}},ariaLabelledBy:this._oRangeLabel}).addStyleClass("sapGanttPrintingPageRangeInput")]})};Pt.prototype._createLabelWithSwitch=function(t,e){this._oLabelWithSwitchLabel=new A({text:t});this._oLabelWithSwitchLabel.toStatic();this._oSwitch=new G({state:e,change:this._updateDialogPreview.bind(this),ariaLabelledBy:this._oLabelWithSwitchLabel});return new _({renderType:"Bare",visible:"{setting>/multiplePage}",alignItems:"Center",items:[new o({text:t,showColon:true}),this._oSwitch.addStyleClass("sapGanttPrintingSwitchPadding")]})};Pt.prototype._createCheckBoxWithInput=function(t,e,i,a){var o=a?this._generateSvgToPdf:this._updateDialogPreview;var n=this._onLiveChange.bind(this);var r=new g({width:"65%",value:i,enabled:e,valueLiveUpdate:true,valueStateText:this._oRb.getText("GNT_PRNTG_HEADER_FOOTER_TEXT_ERROR"),liveChange:function(){n(a,r,false)}});this._oHeaderFooterLabel=new A({text:this._oRb.getText("GNT_PRNTG_HEADER_AND_FOOTER")});this._oHeaderFooterLabel.toStatic();r.onsapfocusleave=function(){n(a,r,true)};return new _({renderType:"Bare",alignItems:"Start",justifyContent:"SpaceBetween",items:[new f({selected:e,text:t+":",select:o.bind(this),ariaLabelledBy:this._oHeaderFooterLabel}),r]})};Pt.prototype._onLiveChange=function(t,e,i){if(e.getValue().length>vt){e.setValue(e.getValue().slice(0,vt));e.setValueState("Error")}else{e.setValueState("None")}if(i){if(t){this._generateSvgToPdf()}else{this._updateDialogPreview()}}return};Pt.prototype._createPanel=function(t,e){return new S({expandable:true,expanded:false,headerText:t,content:[new _({renderType:"Bare",direction:ut.Column,items:[e]})]})};Pt.prototype._createCompressionSlider=function(){return new m({min:1,max:100,step:1,change:this._onChangeCompressionSlider.bind(this),value:{path:"setting>/compressionQuality",type:new rt},visible:"{setting>/exportAsJPEG}",showAdvancedTooltip:true,inputsAsTooltips:true})};Pt.prototype._createCompressionComboBox=function(){this._oComboBoxCompression=new c({visible:"{setting>/exportAsJPEG}",change:this._onChangeCompressionComboBox.bind(this),items:[new B({key:"maximum",text:this._oRb.getText("GNT_PRNTG_COMPRESSION_MAXIMUM")}),new B({key:"high",text:this._oRb.getText("GNT_PRNTG_COMPRESSION_HIGH")}),new B({key:"medium",text:this._oRb.getText("GNT_PRNTG_COMPRESSION_MEDIUM")}),new B({key:"low",text:this._oRb.getText("GNT_PRNTG_COMPRESSION_LOW")})]});var t=this._oModel.getProperty("/compressionQuality");this._setCompressionComboBoxItem(t);return this._oComboBoxCompression};Pt.prototype._updateInputsStep=function(t){var e=.1;if(t==="mm"){e=1}return e};Pt.prototype._createMargin=function(t){this._oMargin=new A({text:this._oRb.getText("GNT_PRNTG_MARGIN")});this._oMargin.toStatic();this._oMarginTop=new A({text:this._oRb.getText("GNT_PRNTG_MARGIN_TOP")});this._oMarginTop.toStatic();this._oMarginLeft=new A({text:this._oRb.getText("GNT_PRNTG_MARGIN_LEFT")});this._oMarginLeft.toStatic();this._oMarginBottom=new A({text:this._oRb.getText("GNT_PRNTG_MARGIN_BOTTOM")});this._oMarginBottom.toStatic();this._oMarginRight=new A({text:this._oRb.getText("GNT_PRNTG_MARGIN_RIGHT")});this._oMarginRight.toStatic();function e(t){var e=this._oModel.getProperty("/unit");return Math.round(_t._convertPxToUnit(t/3,e))}return[new o({text:this._oRb.getText("GNT_PRNTG_MARGIN"),showColon:true}),this._oMarginComboBox=new c({change:this._onChangeMarginComboBox.bind(this,t),selectedKey:"{setting>/marginType}",ariaLabelledBy:this._oMargin,items:[new B({key:"default",text:this._oRb.getText("GNT_PRNTG_MARGIN_DEFAULT")}),new B({key:"none",text:this._oRb.getText("GNT_PRNTG_MARGIN_NONE")}),new B({key:"custom",text:this._oRb.getText("GNT_PRNTG_MARGIN_CUSTOM")})]}),new _({renderType:"Bare",alignItems:"Center",visible:{path:"setting>/marginType",formatter:function(t){return t==="custom"}},items:[new _({direction:ut.Column,layoutData:new d({shrinkFactor:0,growFactor:0,baseSize:"8rem"}),items:[new o({text:this._oRb.getText("GNT_PRNTG_MARGIN_TOP"),showColon:true}),this._oInputMarginTop=new v({min:0,step:{path:"setting>/unit",formatter:this._updateInputsStep},displayValuePrecision:1,change:this._onChangeMarginInput.bind(this,t),value:_t._convertPxToUnit(this._oModel.getProperty("/marginTop"),this._oModel.getProperty("/unit")),fieldWidth:"7rem",validationMode:"LiveChange",valueStateText:this._oRb.getText("GNT_PRNTG_MARGIN_HEIGHT_ERROR"),max:{parts:[{path:"setting>/paperHeight"},{path:"setting>/unit"}],formatter:e.bind(this)},description:"{setting>/unit}",ariaLabelledBy:this._oMarginTop}).addStyleClass("sapGanttPrintingBottomMargin"),new o({text:this._oRb.getText("GNT_PRNTG_MARGIN_LEFT"),showColon:true}),this._oInputMarginLeft=new v({min:0,step:{path:"setting>/unit",formatter:this._updateInputsStep},displayValuePrecision:1,change:this._onChangeMarginInput.bind(this,t),value:_t._convertPxToUnit(this._oModel.getProperty("/marginLeft"),this._oModel.getProperty("/unit")),fieldWidth:"7rem",validationMode:"LiveChange",valueStateText:this._oRb.getText("GNT_PRNTG_MARGIN_WIDTH_ERROR"),max:{parts:[{path:"setting>/paperWidth"},{path:"setting>/unit"}],formatter:e.bind(this)},description:"{setting>/unit}",ariaLabelledBy:this._oMarginLeft})]}),new _({direction:ut.Column,layoutData:new d({shrinkFactor:0,growFactor:0,baseSize:"8rem"}),items:[new o({text:this._oRb.getText("GNT_PRNTG_MARGIN_BOTTOM"),showColon:true}),this._oInputMarginBottom=new v({min:0,step:{path:"setting>/unit",formatter:this._updateInputsStep},displayValuePrecision:1,change:this._onChangeMarginInput.bind(this,t),value:_t._convertPxToUnit(this._oModel.getProperty("/marginBottom"),this._oModel.getProperty("/unit")),fieldWidth:"7rem",validationMode:"LiveChange",valueStateText:this._oRb.getText("GNT_PRNTG_MARGIN_HEIGHT_ERROR"),max:{parts:[{path:"setting>/paperHeight"},{path:"setting>/unit"}],formatter:e.bind(this)},description:"{setting>/unit}",ariaLabelledBy:this._oMarginBottom}).addStyleClass("sapGanttPrintingBottomMargin"),new o({text:this._oRb.getText("GNT_PRNTG_MARGIN_RIGHT"),showColon:true}),this._oInputMarginRight=new v({min:0,step:{path:"setting>/unit",formatter:this._updateInputsStep},displayValuePrecision:1,change:this._onChangeMarginInput.bind(this,t),value:_t._convertPxToUnit(this._oModel.getProperty("/marginRight"),this._oModel.getProperty("/unit")),fieldWidth:"7rem",validationMode:"LiveChange",valueStateText:this._oRb.getText("GNT_PRNTG_MARGIN_WIDTH_ERROR"),max:{parts:[{path:"setting>/paperWidth"},{path:"setting>/unit"}],formatter:e.bind(this)},description:"{setting>/unit}",ariaLabelledBy:this._oMarginRight})]}).addStyleClass("sapGanttPrintingLeftMargin"),new h({icon:{path:"setting>/marginLocked",formatter:function(t){if(t){return"sap-icon://chain-link"}return"sap-icon://broken-link"}},press:function(){var t=this._oModel.getProperty("/marginLocked");this._oModel.setProperty("/marginLocked",!t)}.bind(this),tooltip:{path:"setting>/marginLocked",formatter:function(t){return this._oRb.getText(t?"GNT_PRNTG_UNLOCK_MARGINS":"GNT_PRNTG_LOCK_AND_SYNC_MARGINS")}.bind(this)},type:"Transparent"}).addStyleClass("sapGanttPrintingLockButton sapGanttPrintingLeftMargin")]}).addStyleClass("sapGanttPrintingTopMargin sapGanttPrintingTopMargin")]};Pt.prototype._createCropMarks=function(){return[new G({state:"{setting>/cropMarks}"}),new _({renderType:"Bare",visible:"{setting>/cropMarks}",items:[new _({direction:ut.Column,layoutData:new d({shrinkFactor:0,growFactor:0,baseSize:"8rem"}),items:[new o({text:"Weight:"}),new v({min:0,step:.05,displayValuePrecision:2,value:"{setting>/cropMarksWeight}",fieldWidth:"7rem",description:"pt"})]}),new _({direction:ut.Column,layoutData:new d({shrinkFactor:0,growFactor:0,baseSize:"8rem"}),items:[new o({text:"Offset:"}),this._oInputCropMarksOffset=new v({min:0,step:{path:"setting>/unit",formatter:this._updateInputsStep},displayValuePrecision:1,change:this._onChangeCropMarksInput.bind(this),value:_t._convertPxToUnit(this._oModel.getProperty("/cropMarksOffset"),this._oModel.getProperty("/unit")),fieldWidth:"7rem",description:"{setting>/unit}"})]}).addStyleClass("sapGanttPrintingLeftMargin")]}).addStyleClass("sapGanttPrintingTopMargin")]};Pt.prototype._createCompression=function(){var t=this._oModel.getProperty("/exportAsJPEG");this._oCompressExportType=new A({text:this._oRb.getText("GNT_PRNTG_COMPRESSION_EXPORT_TYPES")});this._oCompressExportType.toStatic();this._oCompressQuality=new A({text:this._oRb.getText("GNT_PRNTG_COMPRESSION_QUALITY")});this._oCompressQuality.toStatic();return[new o({text:this._oRb.getText("GNT_PRNTG_COMPRESSION_EXPORT_TYPES"),showColon:true}),this._oCompressExportTypeRadio=new P({columns:2,selectedIndex:t?0:1,buttons:[new C({id:"jpeg",text:"JPEG",selected:"{setting>/exportAsJPEG}",ariaLabelledBy:this._oCompressExportType}),new C({id:"png",text:"PNG",ariaLabelledBy:this._oCompressExportType})]}).addStyleClass("sapGanttPrintingBottomMargin"),new o({text:this._oRb.getText("GNT_PRNTG_COMPRESSION_QUALITY"),visible:"{setting>/exportAsJPEG}",showColon:true}),this._createCompressionComboBox().addAriaLabelledBy(this._oCompressQuality),this._createCompressionSlider().addAriaLabelledBy(this._oCompressQuality).addStyleClass("sapGanttPrintingTopMargin sapGanttPrintingBottomMargin"),new w({text:this._oRb.getText("GNT_PRNTG_COMPRESSION_PNG_WARNING"),showIcon:true,type:"Warning",visible:{path:"setting>/exportAsJPEG",type:new st,formatter:function(t){return!t}}}).addStyleClass("sapGanttPrintingBottomMargin")]};Pt.prototype._createOptionsForm=function(){this._oOrientationLabell=new A({text:this._oRb.getText("GNT_PRNTG_ORIENTATION")});this._oExportType=new A({text:this._oRb.getText("GNT_PRNTG_EXPORT_TYPES")});this._oPaperSizeLabel=new A({text:this._oRb.getText("GNT_PRNTG_PAPER_SIZE")});this._oDurationComboLabel=new A({text:this._oRb.getText("GNT_PRNTG_DURATION")});this._oScaleLabel=new A({text:this._oRb.getText("GNT_PRNTG_SCALE")});this._oOrientationLabell.toStatic();this._oExportType.toStatic();this._oPaperSizeLabel.toStatic();this._oDurationComboLabel.toStatic();this._oScaleLabel.toStatic();return new _({renderType:"Bare",direction:ut.Column,items:[new o({text:this._oRb.getText("GNT_PRNTG_EXPORT_TYPES"),showColon:true}),this._radioGroupPage=new P({columns:2,selectedIndex:this._oModel.getProperty("/multiplePage")?0:1,select:this._onChangeExportTypes.bind(this),buttons:[new C({id:"Multiple",text:this._oRb.getText("GNT_PRNTG_MULTIPLE_PAGE"),selected:"{setting>/multiplePage}",ariaLabelledBy:this._oExportType}),new C({id:"Single",text:this._oRb.getText("GNT_PRNTG_SINGLE_PAGE"),ariaLabelledBy:this._oExportType})]}).addStyleClass("sapGanttPrintingBottomMargin"),new o({text:this._oRb.getText("GNT_PRNTG_ORIENTATION"),showColon:true}),this._radioGroupOrientation=new P({columns:2,selectedIndex:this._oModel.getProperty("/portrait")?0:1,select:this._onChangeOrientation.bind(this,false),buttons:[new C({id:"Portrait",text:this._oRb.getText("GNT_PRNTG_PORTRAIT"),selected:"{setting>/portrait}",ariaLabelledBy:this._oOrientationLabell}),new C({id:"Landscape",text:this._oRb.getText("GNT_PRNTG_LANDSCAPE"),ariaLabelledBy:this._oOrientationLabell})]}).addStyleClass("sapGanttPrintingBottomMargin"),new w({text:"{setting>/orientationMessage}",type:"Information",showIcon:true,visible:"{setting>/showOrientationMessage}"}).addStyleClass("sapGanttPrintingSinglePageMessage"),new o({text:this._oRb.getText("GNT_PRNTG_PAPER_SIZE"),showColon:true}),this._createPaperComboBox(false).addAriaLabelledBy(this._oPaperSizeLabel).addStyleClass("sapGanttPrintingBottomMargin"),this._createPaperSizeFields(false).addStyleClass("sapGanttPrintingBottomMargin"),new w({text:this._oRb.getText("GNT_PRNTG_SINGLE_PAGE_QUALITY"),type:"Information",showIcon:true,visible:"{setting>/qualityWarning}"}).addStyleClass("sapGanttPrintingSinglePageMessage"),new o({text:this._oRb.getText("GNT_PRNTG_DURATION"),showColon:true}),this._createDurationComboBox(false).addAriaLabelledBy(this._oDurationComboLabel).addStyleClass("sapGanttPrintingBottomMargin"),this._createDatePicker(false).addStyleClass("sapGanttPrintingBottomMargin"),new o({text:this._oRb.getText("GNT_PRNTG_SCALE"),visible:"{setting>/multiplePage}",showColon:true}),this._createScale().addAriaLabelledBy(this._oScaleLabel).addStyleClass("sapGanttPrintingBottomMargin"),new o({text:this._oRb.getText("GNT_PRNTG_PAGE_RANGE"),visible:"{setting>/multiplePage}",showColon:true}),this._createPageRange().addStyleClass("sapGanttPrintingBottomMargin"),new o({text:this._oRb.getText("GNT_PRNTG_HEADER_AND_FOOTER"),showColon:true}),this._createCheckBoxWithInput(this._oRb.getText("GNT_PRNTG_HEADER"),"{setting>/showHeaderText}","{setting>/headerText}"),this._createCheckBoxWithInput(this._oRb.getText("GNT_PRNTG_FOOTER"),"{setting>/showFooterText}","{setting>/footerText}").addStyleClass("sapGanttPrintingBottomMargin"),this._createLabelWithSwitch(this._oRb.getText("GNT_PRNTG_SHOW_PAGE_NUMBER"),"{setting>/showPageNumber}").addStyleClass("sapGanttPrintingBottomMargin"),this._createPanel(this._oRb.getText("GNT_PRNTG_MARGIN"),this._createMargin(false)),this._createPanel(this._oRb.getText("GNT_PRNTG_COMPRESSION"),this._createCompression())]})};Pt.prototype._createSinglePageForm=function(){this._oOrientationLabel=new A({text:this._oRb.getText("GNT_PRNTG_ORIENTATION")});this._oPaperSizeLabel=new A({text:this._oRb.getText("GNT_PRNTG_PAPER_SIZE")});this._oDurationComboLabel=new A({text:this._oRb.getText("GNT_PRNTG_DURATION")});this._oOrientationLabel.toStatic();this._oDurationComboLabel.toStatic();this._oPaperSizeLabel.toStatic();return new _({renderType:"Bare",direction:ut.Column,items:[new o({text:this._oRb.getText("GNT_PRNTG_ORIENTATION"),showColon:true}),this._radioGroupOrientation=new P({columns:2,selectedIndex:this._oModel.getProperty("/portrait")?0:1,select:this._onChangeOrientation.bind(this,true),buttons:[new C({id:"Portrait",text:this._oRb.getText("GNT_PRNTG_PORTRAIT"),selected:"{setting>/portrait}",ariaLabelledBy:this._oOrientationLabel}),new C({id:"Landscape",text:this._oRb.getText("GNT_PRNTG_LANDSCAPE"),ariaLabelledBy:this._oOrientationLabel})]}).addStyleClass("sapGanttPrintingBottomMargin"),new o({text:this._oRb.getText("GNT_PRNTG_PAPER_SIZE"),showColon:true}),this._createPaperComboBox(true).addStyleClass("sapGanttPrintingBottomMargin").addAriaLabelledBy(this._oPaperSizeLabel),this._createPaperSizeFields(true).addStyleClass("sapGanttPrintingBottomMargin"),new o({text:this._oRb.getText("GNT_PRNTG_DURATION"),showColon:true}),this._createDurationComboBox(true).addAriaLabelledBy(this._oDurationComboLabel).addStyleClass("sapGanttPrintingBottomMargin"),this._createDatePicker(true).addStyleClass("sapGanttPrintingBottomMargin"),new o({text:this._oRb.getText("GNT_PRNTG_HEADER_AND_FOOTER"),showColon:true}),this._createCheckBoxWithInput(this._oRb.getText("GNT_PRNTG_HEADER"),"{setting>/showHeaderText}","{setting>/headerText}",true),this._createCheckBoxWithInput(this._oRb.getText("GNT_PRNTG_FOOTER"),"{setting>/showFooterText}","{setting>/footerText}",true).addStyleClass("sapGanttPrintingBottomMargin"),this._createPanel(this._oRb.getText("GNT_PRNTG_MARGIN"),this._createMargin(true))]})};Pt.prototype._createDialogContent=function(t){var e;if(t){e=new _({renderType:"Bare",fitContainer:true,items:[this._oFlexBoxPreview=new _({renderType:"Bare",layoutData:new d({shrinkFactor:1,growFactor:1,baseSize:"auto"}),direction:ut.Column,items:[new _({renderType:"Bare",layoutData:new d({shrinkFactor:0,growFactor:0,baseSize:"3.5rem"})}),this._oPdfDialogPreview=new I({content:'<div class="sapGanttPdfPreviewContentDiv"><div id="sapGanttPdfPreviewDiv"class="sapGanttPdfPreviewPageDiv"></div></div>'})]}).addStyleClass("sapGanttPrintingPreviewContent"),new u({horizontal:false,vertical:true,layoutData:new d({shrinkFactor:0,growFactor:0,baseSize:"27rem"}),content:[this._createSinglePageForm().addStyleClass("sapGanttPrintingDialogSettings")]})]})}else{e=new _({renderType:"Bare",fitContainer:true,items:[this._oFlexBoxPreview=new _({renderType:"Bare",layoutData:new d({shrinkFactor:1,growFactor:1,baseSize:"auto"}),direction:ut.Column,items:[new _({renderType:"Bare",layoutData:new d({shrinkFactor:0,growFactor:0,baseSize:"3.5rem"})}),this._oHTMLDialogPreview=new I({content:'<div class="sapGanttPrintingPreviewContentDiv"><div class="sapGanttPrintingPreviewPageDiv"></div></div>'}),new _({renderType:"Bare",justifyContent:"Center",alignItems:"Center",layoutData:new d({shrinkFactor:0,growFactor:0,baseSize:"6rem"}),items:[this._oButtonFirst=new h({icon:"sap-icon://close-command-field",visible:"{setting>/multiplePage}",press:this._onPressButtonFirst.bind(this),type:"Transparent",tooltip:this._oRb.getText("GNT_PRNTG_FIRST_PAGE_BUTTON")}).addStyleClass("sapGanttPrintingPreviewIconMarginRight"),this._oButtonPrevious=new h({icon:"sap-icon://navigation-left-arrow",visible:"{setting>/multiplePage}",press:this._onPressButtonPrevious.bind(this),type:"Transparent",tooltip:this._oRb.getText("GNT_PRNTG_PREVIOUS_PAGE_BUTTON")}),new n({textAlign:"Center",visible:"{setting>/multiplePage}",width:"7.25rem",text:{parts:[{path:"setting>/previewPageNumber"},{path:"setting>/lastPageNumber"}],formatter:function(t,e){return e?this._oRb.getText("GNT_PRNTG_OF",[t,e]):t.toString()}.bind(this)}}).addStyleClass("sapGanttPrintingPreviewText"),this._oButtonNext=new h({icon:"sap-icon://navigation-right-arrow",visible:"{setting>/multiplePage}",press:this._onPressButtonNext.bind(this),type:"Transparent",tooltip:this._oRb.getText("GNT_PRNTG_NEXT_PAGE_BUTTON")}).addStyleClass("sapGanttPrintingPreviewIconMarginRight"),this._oButtonLast=new h({icon:"sap-icon://open-command-field",visible:"{setting>/multiplePage}",press:this._onPressButtonLast.bind(this),type:"Transparent",tooltip:this._oRb.getText("GNT_PRNTG_LAST_PAGE_BUTTON")})]}).addStyleClass("sapGanttPrintingPreviewFooter")]}).addStyleClass("sapGanttPrintingPreviewContent"),new u({horizontal:false,vertical:true,layoutData:new d({shrinkFactor:0,growFactor:0,baseSize:"27rem"}),content:[this._createOptionsForm().addStyleClass("sapGanttPrintingDialogSettings")]})]});this._updatePageNumberButtons()}return e};Pt.prototype.getPrintData=function(){var t=Object.assign({},this._oModel.getData());var e=this._oModel.getProperty("/unit");var i=new gt({pageConfig:{paperHeight:_t._convertPxToUnit(t.paperHeight,e),paperWidth:_t._convertPxToUnit(t.paperWidth,e),paperSize:t.paperSize,unit:t.unit,portrait:t.portrait,showPageNumber:t.showPageNumber},textConfig:{showHeaderText:t.showHeaderText,showFooterText:t.showFooterText,headerText:t.headerText,footerText:t.footerText},marginConfig:{marginLeft:_t._convertPxToUnit(t.marginLeft,e),marginBottom:_t._convertPxToUnit(t.marginBottom,e),marginRight:_t._convertPxToUnit(t.marginRight,e),marginTop:_t._convertPxToUnit(t.marginTop,e),marginLocked:t.marginLocked,marginType:t.marginType},durationConfig:{duration:t.duration,startDate:t.startDate,endDate:t.endDate},exportConfig:{exportAsJPEG:t.exportAsJPEG,exportRange:t.exportRange,exportAll:t.exportAll,compressionQuality:t.compressionQuality,scale:t.scale,multiplePage:t.multiplePage}});return i};Pt.prototype.setPrintData=function(t){if(t){this._updateModel(t)}else{throw new Error("Invalid print config data is set")}};Pt.prototype._updateModel=function(t){this._oModel=new k({...this.oInitialValues,...t._getPageConfig()||{},...t._getTextConfig()||{},...t._getMarginConfig()||{},...t._getDurationConfig()||{},...t._getExportConfig()||{}});["paperHeight","paperWidth","marginTop","marginLeft","marginBottom","marginRight"].forEach(function(t){this._oModel.setProperty(`/${t}`,_t._convertUnitToPx(this._oModel.getProperty(`/${t}`),this._oModel.getProperty("/unit")))}.bind(this))};Pt.prototype._createAndOpenDialog=function(t,e){var i;var a=this._getOriginalGanttChart().getParent();if(a&&a.isA("sap.gantt.simple.GanttChartContainer")){if(a.getEnableVariantManagement()){this._onLoadValues=this.getPrintData();this._oButtonSave=new h({text:dt.getText("SAVE_BUTTON"),type:sap.m.ButtonType.Ghost,press:function(e){this._savePreset(e,t)}.bind(this)});if(a._variantData){var o=t?a._variantData.svgPage:a._variantData.canvasPage;if(o){this.setPrintData(o)}}i=[this._oButtonSave]}else{i=e&&e.getFooterButtons()||[]}}var n=i&&i.map(function(t){return t.clone()});var r=t?this.exportSinglePage:this.export;this._oDialog=new s({title:this._oRb.getText("GNT_PRNTG_PDF_EXPORT_TITLE"),contentWidth:"100%",contentHeight:"100%",horizontalScrolling:false,verticalScrolling:false,content:[this._createDialogContent(t)],buttons:[this._oButtonExport=new h({text:this._oRb.getText("GNT_PRNTG_EXPORT"),type:p.ButtonType.Emphasized,press:r.bind(this)}),this._footerButtons=n,this._oButtonClose=new h({text:this._oRb.getText("GNT_PRNTG_CANCEL"),press:function(){this.close()}.bind(this)})]}).addStyleClass("sapGanttPrintingDialog");this._oDialog.onsapescape=function(t){this.close();t.preventDefault();t.stopPropagation()}.bind(this);this._oDialog.setModel(this._oModel,"setting");this._oDialog.open();this._sResizeHandlerId=V.register(this._oDialog,this._onResize.bind(this))};Pt.prototype._openProgressDialog=function(){this._oProgressIndicator=new l({state:"Information",percentValue:0});this._oProgressText=new n({text:this._oRb.getText("GNT_PRNTG_PDF_PREVIEW"),textAlign:"Center"}).addStyleClass("sapGanttPrintingProgressText");this._oProgressIndicatorBox=new _(this.getId()+"-progressFlexBox",{direction:"Column",alignItems:"Center",items:[this._oProgressText,this._oProgressIndicator],renderType:"Bare"}).addStyleClass("sapGanttPrintingProgressBox");this._oProgressDialog=new s(this.getId()+"-progressDialog",{contentWidth:"25%",showHeader:false,content:[this._oProgressIndicatorBox],buttons:[new h({text:this._oRb.getText("GNT_PRNTG_CANCEL"),press:function(){this._closeProgressIndicator()}.bind(this)})]});this._oProgressDialog.open()};return Pt});
//# sourceMappingURL=GanttPrinting.js.map