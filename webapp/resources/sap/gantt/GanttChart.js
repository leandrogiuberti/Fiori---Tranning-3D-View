/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

		(c) Copyright 2009-2015 SAP SE. All rights reserved
	
 */
sap.ui.define(["sap/ui/thirdparty/jquery","sap/base/Log","sap/ui/performance/Measurement","sap/ui/events/KeyCodes","sap/ui/Device","sap/ui/core/Core","sap/ui/table/TreeTable","./GanttChartBase","./misc/Utility","./drawer/ShapeInRow","./drawer/ShapeCrossRow","./drawer/CursorLine","./drawer/NowLine","./drawer/VerticalLine","./drawer/AdhocLine","./drawer/CalendarPattern","./drawer/ExpandedBackground","./misc/AxisOrdinal","./misc/Format","./eventHandler/AutoScrollHandler","./eventHandler/MouseWheelHandler","./eventHandler/TimePeriodZoomHandler","./axistime/ProportionZoomStrategy","./config/TimeHorizon","./misc/ShapeSelectionModel","./misc/ShapeManager","./eventHandler/ShapeResizeHandler","./eventHandler/ShapeHoverHandler","./eventHandler/TimePopoverHandler","./eventHandler/BirdEyeHandler","sap/ui/thirdparty/d3"],function(jQuery,e,t,i,a,o,s,r,n,h,g,l,p,d,c,u,f,_,S,v,m,T,w,y,b,D,R,C,H,x){"use strict";var M=r.extend("sap.gantt.GanttChart",{metadata:{designtime:"sap/gantt/designtime/GanttChart.designtime",aggregations:{_treeTable:{type:"sap.ui.table.TreeTable",multiple:false,visibility:"hidden"}}}});M.prototype.init=function(){r.prototype.init.apply(this,arguments);t.start("GanttChart init","GanttPerf:GanttChart init function");this._oTT=new s(this.getId()+"-table",{visibleRowCountMode:"Auto",minAutoRowCount:1,columnHeaderVisible:false});jQuery.extend(this.mDefaultTableProperties,{selectionBehavior:sap.ui.table.SelectionBehavior.RowOnly});this.setTableProperties(jQuery.extend({},this.mDefaultTableProperties));this._oTT.setUseFlatMode(true);this._bJSONTreeBinding=true;this._oRowStatusMap={};this._oTT._bVariableRowHeightEnabled=true;var e=this;this._oTT._collectRowHeights=function(t){var i=s.prototype._collectRowHeights.apply(this,arguments);if(t){return i}e._aHeights=i;if(e._aHeights[0]!==undefined&&e._aHeights[0]!==0){e._iInferedBaseRowHeightOnTT=e._aHeights[0]}var a=e.getBaseRowHeight();var o=e._getTTFirstRenderingRowIndex();var r=e._aHeights.length;var n=a;var h=e._getDrawingData([o,o+r-1]);if(h&&h.length>0){n=h[0].rowSpan*a}for(var g=0;g<r;g++){var l=this.getContextByIndex(o+g);if(l){var p;if(e._bJSONTreeBinding){p=l.getObject()}else if(e._aFilteredRowData){p=e._aFilteredRowData[g]}var d=p?p.uid:undefined;if(d&&e._oRowStatusMap[d]){e._aHeights[g]=e._oRowStatusMap[d].visibleRowSpan*a}else{e._aHeights[g]=n}}else{e._aHeights[g]=a}}return e._aHeights};var i=sap.ui.getCore().getLibraryResourceBundle("sap.gantt");this._oColumn=new sap.ui.table.Column({template:new sap.ui.core.HTML({content:'<div tabIndex = " 0 " class=" sapGanttCellTransparent ">'+i.getText("XCEL_GANTT_CELL")+"</div>"})});this._oTT.addColumn(this._oColumn);this.setAggregation("_treeTable",this._oTT);this._oTT.attachEvent("_rowsUpdated",this._onTTRowUpdate.bind(this));this._oTT.attachRowSelectionChange(this._onRowSelectionChange,this);this._oTT.addEventDelegate({onAfterRendering:this._bindScrollLogicForTT},this);this._oTT.addEventDelegate({onAfterRendering:this._initialSvgDrawing},this);this._oShapeInRowDrawer=new h;this._oShapeCrossRowDrawer=new g;this._oCursorLineDrawer=new l;this._oCalendarPatternDrawer=new u;this._oExpandedBackgroundDrawer=new f;this._oAxisOrdinal=undefined;this._aFilteredRowData=undefined;this._oStatusSet=null;this._nLowerRange=0;this._nUpperRange=0;this._oShapeSelection=new b({selectionMode:this.getShapeSelectionMode(),ganttChart:this});this._oShapeManager=new D(this);this._bMouseDown=false;this._bDragging=false;this._bDragStart=false;this._oDraggingData=undefined;this._lastHoverRowIndex=undefined;this._oChartSchemesConfigMap={};this._oChartSchemesConfigMap[sap.gantt.config.DEFAULT_CHART_SCHEME_KEY]=sap.gantt.config.DEFAULT_CHART_SCHEME;this._oObjectTypesConfigMap={};this._oObjectTypesConfigMap[sap.gantt.config.DEFAULT_OBJECT_TYPE_KEY]=sap.gantt.config.DEFAULT_OBJECT_TYPE;this._fExtendFactor=.382;this._setAxisTimeStrategy(new w);this._mTimeouts={};this._bSuppressSetVisibleHorizon=false;this._oAutoScrollHandler=new v;this._oMouseWheelHandler=new m(this);this._oTimePeriodZoomHandler=new T(this);this._oShapeResizeHandler=new R(this);this._oShapeHoverHandler=new C(this);this._oTimePopoverHandler=new H(this);this._oBirdEyeHandler=new x(this);t.end("GanttChart init")};M.prototype.setAxisTimeStrategy=function(e){this._setAxisTimeStrategy(e);this._oStatusSet=null;this._draw(true);return this};M.prototype._setAxisTimeStrategy=function(e){this.setAggregation("axisTimeStrategy",e,true);this._createAxisTime(e);e.attachEvent("_redrawRequest",this._onRedrawRequest,this)};M.prototype._onRedrawRequest=function(e){var t=e.getParameter("forceUpdate");var i=e.getParameter("valueBeforeChange");var a=e.getParameter("reasonCode");var o=e.getParameter("originEvent");if(a!=="totalHorizonUpdated"&&i){this._oLastVisibleHorizon=i;if(a!=="syncVisibleHorizon"){var s=this.getAxisTimeStrategy();var r=s.getVisibleHorizon();var n=this.getVisibleWidth();this.fireEvent("_visibleHorizonUpdate",{reasonCode:a,visibleHorizon:r,visibleWidth:n,originEvent:o})}}this.redraw(t)};M.prototype.setTimeAxis=function(e){this.setProperty("timeAxis",e,true);if(e){var t=e.getZoomStrategy();this.setAxisTimeStrategy(new w({totalHorizon:e.getPlanHorizon().clone(),visibleHorizon:e.getInitHorizon().clone(),timeLineOption:t[e.getGranularity()],coarsestTimeLineOption:t[e.getCoarsestGranularity()],finestTimeLineOption:t[e.getFinestGranularity()],timeLineOptions:t}))}else{this.setAxisTimeStrategy(null)}};M.prototype.setLocale=function(e){this.setProperty("locale",e,true);var t=this.getAxisTime();if(t){t.setLocale(e);this._draw(true)}return this};M.prototype.setChartSchemes=function(e){this.setProperty("chartSchemes",e,true);this._oChartSchemesConfigMap={};if(e){for(var t=0;t<e.length;t++){this._oChartSchemesConfigMap[e[t].getKey()]=e[t]}}this._draw(true);return this};M.prototype.setObjectTypes=function(e){this.setProperty("objectTypes",e,true);this._oObjectTypesConfigMap={};if(e){for(var t=0;t<e.length;t++){this._oObjectTypesConfigMap[e[t].getKey()]=e[t]}}this._draw(true);return this};M.prototype.setSelectionMode=function(e){this.setProperty("selectionMode",e,true);this.setShapeSelectionMode(e);switch(e){case sap.gantt.SelectionMode.Multiple:case sap.gantt.SelectionMode.MultiWithKeyboard:this.setTableProperties({selectionMode:sap.ui.table.SelectionMode.MultiToggle});break;case sap.gantt.SelectionMode.None:case sap.gantt.SelectionMode.Single:this.setTableProperties({selectionMode:e});break}return this};M.prototype.setShapeSelectionMode=function(e){this.setProperty("shapeSelectionMode",e,true);this._oShapeSelection.setSelectionMode(e);return this};M.prototype.setTableProperties=function(t){if(t.hasOwnProperty("selectionBehavior")){if(t.selectionBehavior!==sap.ui.table.SelectionBehavior.RowOnly){delete t.selectionBehavior;e.warning("Change GanttChart's TreeTable selectionBehavior is not allowed!")}}r.prototype.setTableProperties.apply(this,arguments);return this};M.prototype._createAxisTime=function(e){if(e){e.createAxisTime(this.getLocale());this._nLowerRange=Math.ceil(this.getAxisTime().getViewRange()[0]);this._nUpperRange=Math.ceil(this.getAxisTime().getViewRange()[1])}};M.prototype.setShapes=function(e){this.setProperty("shapes",e,true);if(this.getAxisTimeStrategy().getAxisTime()&&e&&e.length>0){this._shapesInited=false;this._ensureShapesCreated(function(){this._draw(true)}.bind(this))}return this};M.prototype.setTimeZoomRate=function(e){this.setProperty("timeZoomRate",e,true);var t=this.getAxisTimeStrategy();if(t.onSetTimeZoomRate){t.onSetTimeZoomRate(e)}return this};M.prototype.redraw=function(e){if(!this._initHorizonApplied){return}if(e){this.resetWidthInfo()}this._draw(e)};M.prototype.resetWidthInfo=function(){this.getAxisTime().setViewOffset(0);this._oStatusSet=null;this._nLowerRange=Math.ceil(this.getAxisTime().getViewRange()[0]);this._nUpperRange=Math.ceil(this.getAxisTime().getViewRange()[1])};M.prototype.updateRelationships=function(e){var t=this.getBinding("relationships");if(t){var i=t.getContexts(0,0);if(i&&i.length>0){this._aRelationshipsContexts=i}}this._prepareRelationshipDataFromModel()};M.prototype.addRelationship=function(t){e.error('The control manages the relationships aggregation. The method "addRelationship" cannot be used programmatically!')};M.prototype.insertRelationship=function(t,i){e.error('The control manages the relationships aggregation. The method "insertRelationship" cannot be used programmatically!')};M.prototype.removeRelationship=function(t){e.error('The control manages the relationships aggregation. The method "removeRelationship" cannot be used programmatically!')};M.prototype.getRelationships=function(){e.error('The control manages the relationships aggregation. The method "getRelationships" cannot be used programmatically!')};M.prototype.destroyRelationships=function(){e.error('The control manages the relationships aggregation. The method "destroyRelationships" cannot be used programmatically!')};M.prototype.indexOfRelationship=function(t){e.error('The control manages the relationships aggregation. The method "indexOfRelationship" cannot be used programmatically!')};M.prototype.removeAllRelationships=function(){e.error('The control manages the relationships aggregation. The method "removeAllRelationships" cannot be used programmatically!')};M.prototype._bindAggregation=function(e,t){if(e=="rows"&&t){var i=this.getModel(t.model);var a=this.getBindingContext(t.model);if(a&&i){t.path=i.resolve(t.path,a)}this._getConfiguredRowKeys(t);this._oTT.bindRows(t);this._bJSONTreeBinding=i instanceof sap.ui.model.json.JSONModel}else{return r.prototype._bindAggregation.apply(this,arguments)}};M.prototype.onBeforeRendering=function(){this._bTableReady=false;this._iSvgHeight=0;this._detachEvents();this._shapesInited=false;this._ensureShapesCreated()};M.prototype._detachEvents=function(){var e=jQuery(this.getDomSelectorById("svg-ctn"));var t=jQuery(this.getDomSelectorById("header"));e.off("MozMousePixelScroll.sapUiTableMouseWheel",this._onMouseWheel);e.off("wheel.sapUiTableMouseWheel",this._onMouseWheel);t.off("MozMousePixelScroll.sapUiTableMouseWheel",this._onMouseWheel);t.off("wheel.sapUiTableMouseWheel",this._onMouseWheel);e.off("contextmenu",this._onContextMenu);e.off("mouseleave",this._onSvgMouseLeave);e.off("mouseenter",this._onSvgMouseEnter);e.off("mousedown",this._onSvgMouseDown);e.off("mousemove",this._onSvgMouseMove);e.off("mouseup",this._onSvgMouseUp);e.off("dblclick",this._onSvgDoubleClick);var i="keydown."+this.getId();jQuery(document.body).off(i);if(a.support.touch){e.off("touchstart",this._onSvgTouchstart);e.off("touchend",this._onSvgTouchend);e.off("touchmove",this._onSvgTouchmove);t.off("touchstart",this._onSvgTouchstart);t.off("touchend",this._onSvgTouchend);t.off("touchmove",this._onSvgTouchmove)}this._oTimePeriodZoomHandler.detachEvents()};M.prototype.onAfterRendering=function(){this._attachEvents()};M.prototype._attachEvents=function(){var e=jQuery(this.getDomSelectorById("svg-ctn"));var t=jQuery(this.getDomSelectorById("header"));if(a.browser.firefox){e.on("MozMousePixelScroll.sapUiTableMouseWheel",this._onMouseWheel.bind(this));t.on("MozMousePixelScroll.sapUiTableMouseWheel",this._onMouseWheel.bind(this))}else{e.on("wheel.sapUiTableMouseWheel",this._onMouseWheel.bind(this));t.on("wheel.sapUiTableMouseWheel",this._onMouseWheel.bind(this))}e.on("contextmenu",this._onContextMenu);e.on("mouseenter",this._onSvgMouseEnter.bind(this));e.on("mouseleave",this._onSvgMouseLeave.bind(this));e.on("mousedown",this._onSvgMouseDown.bind(this));e.on("mousemove",this._onSvgMouseMove.bind(this));e.on("mouseup",this._onSvgMouseUp.bind(this));e.on("dblclick",this._onSvgDoubleClick.bind(this));var i="keydown."+this.getId();jQuery(document.body).on(i,this._onKeyDown.bind(this));if(a.support.touch){e.on("touchstart",this._onSvgTouchstart.bind(this));e.on("touchend",this._onSvgTouchend.bind(this));e.on("touchmove",this._onSvgTouchmove.bind(this));t.on("touchstart",this._onSvgTouchstart.bind(this));t.on("touchend",this._onSvgTouchend.bind(this));t.on("touchmove",this._onSvgTouchmove.bind(this))}this._oTimePeriodZoomHandler.attachEvents();this.attachEvent("_autoScrolling",this._onAutoScrolling,this)};M.prototype._onAutoScrolling=function(e){if(this._oTimePeriodZoomHandler.isActive()){this._oTimePeriodZoomHandler.handleAutoScrolling(e)}this._oShapeResizeHandler._handleShapeResizingWhenAutoScroll()};M.prototype._getMouseOrTouchPoint=function(e){if(e.targetTouches&&e.targetTouches.length>0){return e.targetTouches[e.targetTouches.length-1]}else if(e.changedTouches&&e.changedTouches.length>0){return e.changedTouches[e.changedTouches.length-1]}return{pageX:e.pageX,pageY:e.pageY}};M.prototype._onTouchScrollStart=function(e){if(a.system.combi||a.system.phone||a.system.tablet){this._aTouchStartPosition=null;this._bIsScrollVertical=null;var t=this._getMouseOrTouchPoint(e);this._aTouchStartPosition=[t.pageX,t.pageY];var i=this.getTTVsbDom();if(i){this._iTouchScrollTop=i.scrollTop}var o=this.getTTHsbDom();if(o){this._iTouchScrollLeft=o.scrollLeft}}};M.prototype._onTouchScroll=function(e){if((a.system.combi||a.system.phone||a.system.tablet)&&this._aTouchStartPosition){var t=this._getMouseOrTouchPoint(e);var i=t.pageX-this._aTouchStartPosition[0];var o=t.pageY-this._aTouchStartPosition[1];if(this._bIsScrollVertical==null){this._bIsScrollVertical=Math.abs(o)>Math.abs(i)}if(this._bIsScrollVertical){var s=sap.ui.table.SharedDomRef.VerticalScrollBar;var r=this._oTT.getDomRef(s);if(r){var n=this._iTouchScrollTop-o;if(n>0&&n<this._oTT.getDomRef(s+"-content").clientHeight-r.clientHeight-1){this._preventBubbleAndDefault(e)}r.scrollTop=n}}else{var h=sap.ui.table.SharedDomRef.HorizontalScrollBar;var g=this._oTT.getDomRef(h);if(g){var l=this._iTouchScrollLeft-i;if(l>0&&l<this._oTT.getDomRef(h+"-content").clientWidth-g.clientWidth-1){this._preventBubbleAndDefault(e)}g.scrollLeft=l}}this._bScrolling=true}};M.prototype._onMouseWheel=function(e){this._oMouseWheelHandler.handleEvent(e)};M.prototype.syncMouseWheelZoom=function(e){this._oMouseWheelHandler.handleEvent(e.originEvent,true)};M.prototype.handleExpandChartChange=function(e,t,i){return this._ensureShapesCreated(function(){i=i?i:this._getSelectionHandler().getSelectedIndices();if(i.length>0){this._updateRowStatusMap(e,t,i);this._oTT.updateRows("change",{})}}.bind(this))};M.prototype.invertRowExpandStatus=function(e,t){e=e?e:this._getSelectionHandler().getSelectedIndices();if(e.length>0&&t){for(var i=0;i<e.length;i++){var a=e[i];var o=this._ifRowExpanded(a,t);if(o!==null){this._updateRowStatusMap(!o,t,[a])}}this._oTT.updateRows("change",{})}};M.prototype._ifRowExpanded=function(e,t){var i=this._oTT;var a=i.getBinding();var o=a.getContextByIndex(e);var s=null;if(o){var r=o.getObject();var n=r.uid;var h=this._getRowSpanWithData(r,t),g=h.name;if(n&&this._oRowStatusMap[n]&&this._oRowStatusMap[n][g]){s=true}else{s=false}}return s};M.prototype._updateRowStatusMap=function(e,t,i){var a=this._oTT;var o=a.getBinding();for(var s=0;s<i.length;s++){var r=i[s];var n=o.getContextByIndex(r);if(n){var h;if(this._bJSONTreeBinding){h=n.getObject()}else{h=this._aFilteredRowData[r].data}var g=h.uid;if(g){var l=this._getRowSpanWithData(h,t),p=l.name;if(e){if(this._oRowStatusMap[g]){this._oRowStatusMap[g][p]=l}else{this._oRowStatusMap[g]={};this._oRowStatusMap[g][p]=l}}else if(!e&&this._oRowStatusMap[g]){delete this._oRowStatusMap[g][p];delete this._oRowStatusMap[g].visibleRowSpan;if(jQuery.isEmptyObject(this._oRowStatusMap[g])){delete this._oRowStatusMap[g];continue}}this._getDrawingData([r,r])}}}};M.prototype.isRowExpanded=function(){var e=!jQuery.isEmptyObject(this._oRowStatusMap);return e};M.prototype._getRowSpanWithData=function(e,t){var i=1,a=null,o=null,s=this.getRowTypeName();for(var r=0;r<t.length;r++){var n=t[r];var h;if(this._oChartSchemesConfigMap[n]&&this._oChartSchemesConfigMap[n].getModeKey()){h=this._oChartSchemesConfigMap[n].getModeKey()}else{h=this.getMode()}if(this._oObjectTypesConfigMap[e[s]]&&this._oObjectTypesConfigMap[e[s]].getExpandedChartSchemeKeys().length>0){var g=this._oObjectTypesConfigMap[e[s]].getExpandedChartSchemeKeys();if(jQuery.inArray(n,g)>-1){var l=this._collectDataNameForValidChartScheme(n,h);if(l){o=l.drawData;i+=l.rowSpan;a=n}}}}return{rowSpan:i,name:a,data:o}};M.prototype._updateTableRowHeights=function(){if(this._aHeights){this._oTT._updateRowHeights(this._aHeights,false)}};M.prototype.notifySourceChange=function(){this._oTT.setFirstVisibleRow(0);this.resetRowStatusMap()};M.prototype.resetRowStatusMap=function(){this._oRowStatusMap={}};M.prototype._collectDataNameForValidChartScheme=function(e,t){if(this._oChartSchemesConfigMap[e]){var i=[];var a=this._oChartSchemesConfigMap[e].getShapeKeys();var o=this._oChartSchemesConfigMap[e].getRowSpan();var s=this._oChartSchemesConfigMap[e].getRowIndexName();var r=this._oShapeManager.mShapeConfig;jQuery.each(a,function(e,a){if(r[a]){var o=r[a].getModeKeys();if(o&&o.length>0&&jQuery.inArray(t,o)>-1||o.length==0||t==sap.gantt.config.DEFAULT_MODE_KEY){i.push(r[a].getShapeDataName())}}});if(i.length>0&&o>=1){return{drawData:i,rowSpan:o,rowIndexName:s}}}};M.prototype._composeParameterForClickPosition=function(e){var t=jQuery(this.getDomSelectorById("svg"));var i=this._getMouseXPos(e);var a=this._getSvgCoodinateByDiv(t[0],i,e.pageY);var o=i-t.offset().left||e.offsetX;var s=e.pageY-t.offset().top||e.offsetY;if(!this._oAxisOrdinalOfVisibleRow){return null}var r=this.getAxisTime().viewToTime(o);var h=this._oAxisOrdinalOfVisibleRow.viewToRowIndex(s,this._getVisibleRowCount())+this._oTT.getFirstVisibleRow();var g=n.getRowDatumByEventTarget(e.target);var l=g?g.objectInfoRef:null;var p=false;var d=this._oAxisOrdinal.viewToElementIndex(s);var c=this._aFilteredRowData[d];if(c&&c.index&&c.index!==0){p=true}var u={startTime:r,svgPoint:a,leadingRowNum:h,leadingRowInfo:l,rowIndex:d,rowInfo:c,isExpandedRow:p};return u};M.prototype.getAllRowData=function(){var e=this._oTT.getBinding("rows");return this._getDrawingData([0,e.getLength()-1])};M.prototype.getAllSelections=function(){var e=this.getSelectedRows();var t=this.getSelectedShapes();var i=this.getSelectedRelationships();return{rows:e,shapes:t,relationships:i}};M.prototype.getSelectedRows=function(){var e=this._getSelectionHandler().getSelectedIndices();var t=this._getDrawingData(undefined,e);var i=[];for(var a=0;a<t.length;a++){if(t[a]&&!t[a].parentId){i.push(t[a])}}return i};M.prototype.getSelectedShapes=function(){var e=this._oShapeSelection.getSelectedShapeDatum();var t={};e.forEach(function(e){var i=this._oShapeSelection.getRowDatumByShapeUid(e.uid,this),a=n.getShapeDataNameByUid(e.uid);var o=t[a]||[];o.push({shapeUid:e.uid,shapeData:e,objectInfoRef:i});t[a]=o}.bind(this));return t};M.prototype.getSelectedRelationships=function(){return this._oShapeSelection.getSelectedRelationships()};M.prototype.getRowByShapeUid=function(e){return this._oShapeSelection.getRowDatumByShapeUid(e,this)};M.prototype.selectShapes=function(e,t){var i=this._oShapeSelection.selectShapes(e,t);if(i){this._drawSelectedShapes()}return this};M.prototype.selectByUid=function(e){var t=this._oShapeSelection.selectShapeByUid(e,this);if(t){this._drawSelectedShapes()}return this};M.prototype.deselectShapes=function(e){var t=this._oShapeSelection.deselectShapes(e);if(t){this._drawSelectedShapes()}return this};M.prototype.selectRowsAndShapes=function(e,t){if(!e||e.length===0){this.deselectShapes();this.deselectRows();return this}var i=[];var a=n.getRowDatumById(e,this.getId());jQuery.each(a,function(e,t){var a=t.shapeData;for(var o=0;o<a.length;o++){var s=a[o];if(this.isShapeSelectable(s)){i.push(s.__id__)}}}.bind(this));this._oShapeSelection.selectUnderlyingTableRows(e,this._oTT,t);var o=this._oShapeSelection.selectShapes(i,t);if(o){this._drawSelectedShapes()}return this};M.prototype.selectRelationships=function(e,t){var i=n.getShapeDatumById(e,this.getId());var a=this._oShapeSelection.selectRelationships(i,t);if(a){this._drawSelectedShapes()}return this};M.prototype.deselectRelationships=function(e){var t=this._oShapeSelection.deselectRelationships(e);if(t){this._drawSelectedShapes()}return this};M.prototype.selectRows=function(e,t){this._oShapeSelection.selectUnderlyingTableRows(e,this._oTT,t);return this};M.prototype.deselectRows=function(e){this._oShapeSelection.deselectUnderlyingTableRows(e,this._oTT);return this};M.prototype.expandToLevel=function(e){this._oTT.expandToLevel(e);return this};M.prototype.expand=function(e){this._oTT.expand(e);return this};M.prototype.collapse=function(e){this._oTT.collapse(e);return this};M.prototype.getVisibleRowCount=function(){return this._oTT.getVisibleRowCount()};M.prototype._onRowSelectionChange=function(e){this.fireRowSelectionChange({originEvent:e})};M.prototype._selectionChange=function(e,t,i,a){var o=n.getRowDatumByEventTarget(a.target);var s=o?o.objectInfoRef:null;var r=this._oShapeSelection.changeShapeSelection(e,s,t,this._bDragging,this._oShapeResizeHandler.getIsResizing());return r};M.prototype._syncTTSelection=function(e){t.start("GanttChart syncTTSelection","GanttPerf:GanttChart syncTTSelection function");var i=e.shiftKey;var a=e.ctrlKey;var o=jQuery(this.getDomSelectorById("svg"))[0];var s=this._getSvgCoodinateByDiv(o,this._getMouseXPos(e),e.pageY-window.pageYOffset);var r=parseInt(this._oAxisOrdinalOfVisibleRow.viewToElementIndex(s.y));if(r<0){return false}var n=this._oTT.getRows();var h=n[r].getIndex();var g=this._getSelectionHandler();var l=typeof g.getSelectionMode==="function"?g.getSelectionMode():g._getSelectionMode();if(h>=0&&l!==sap.ui.table.SelectionMode.None){if(l===sap.ui.table.SelectionMode.Single){if(!g.isIndexSelected(h)){g.setSelectedIndex(h)}else{g.clearSelection()}}else{a=true;if(i){var p=g.getSelectedIndex();if(p>=0){if(p<h){g.addSelectionInterval(p,h)}else{g.addSelectionInterval(h,p)}}else{g.setSelectedIndex(h)}}else if(!g.isIndexSelected(h)){if(a){g.addSelectionInterval(h,h)}else{g.setSelectedIndex(h)}}else if(a){g.removeSelectionInterval(h,h)}else if(g.getSelectedIndices().length>1){g.setSelectedIndex(h)}}}t.end("GanttChart syncTTSelection")};M.prototype._setEventStatus=function(e){switch(e){case"dragEnter":this._bDragStart=true;break;case"mouseDown":this._bMouseDown=true;this._bDragging=false;this._bDragStart=false;this._bScrolling=false;break;case"mouseUp":this._bMouseDown=false;this._bScrolling=false;break;case"shapeDragStart":this._bDragStart=true;break;case"shapeDragging":if(this._bDragStart){this._bDragging=true}break;case"shapeDragEnd":this._bDragging=false;this._bDragStart=false;this._oDraggingData=undefined;break;case"dragLeave":this._bDragStart=false;break;default:break}};M.prototype._handleShapeDragStart=function(e){var t=jQuery(this.getDomSelectorById("svg"));var i=d3.select(e.target).datum();var a=e.target.getAttribute("class").split(" ")[0];var s=this._oShapeManager.isShapeDraggable(i,a);if(i&&s){var r=this._oShapeSelection.getRowDatumByShapeUid(i.uid,this);if(r){var n=this._getMouseXPos(e)-t.offset().left||e.offsetX;var h=e.pageY-t.offset().top||e.offsetY;var g,l,p,d;if(e.target.getAttribute("x")&&e.target.getAttribute("width")){g=parseInt(e.target.getAttribute("x"));l=parseInt(e.target.getAttribute("y"));p=parseInt(e.target.getAttribute("width"));d=parseInt(e.target.getAttribute("height"))}else if(i.startTime){var c=this.getAxisTime().timeToView(S.abapTimestampToDate(i.startTime));var u=this.getAxisTime().timeToView(S.abapTimestampToDate(i.endTime));if(o.getConfiguration().getRTL()){g=u;p=c-u>0?c-u:1}else{g=c;p=u-c>0?u-c:1}l=h;d=r.rowHeight/2}else{g=n;p=1;l=h;d=r.rowHeight/2}var f={x:n,y:h,shapeX:g,shapeWidth:p,shapeY:l,shapeHeight:d};var _=[];_.push({shapeData:i,objectInfo:r});var v=this._oShapeSelection.getSelectedShapeDatum();for(var m=0;m<v.length;m++){if(v[m].uid!==i.uid&&this._oShapeManager.isShapeDraggable(v[m])){_.push({shapeData:v[m],objectInfo:this._oShapeSelection.getRowDatumByShapeUid(v[m].uid,this)})}}var T=this._getDraggingDomObjs(e);this._oDraggingData={sourceShapeData:_,dragStartPoint:f,sourceSvgId:this.getId(),targetSvgId:this.getId(),domObject:T.contentDoms,groupDom:T.groupDom};this._setEventStatus("shapeDragStart");jQuery(document.body).off("mousemove.ganttChartDragDrop");jQuery(document).off("mouseup.ganttChartDragDrop");jQuery(document.body).on("mousemove.ganttChartDragDrop",this._handleShapeDragging.bind(this));jQuery(document).on("mouseup.ganttChartDragDrop",this._handleShapeDragEnd.bind(this));if(this.getEnableShapeTimeDisplay()){this._oTimePopoverHandler.handleTimePopover(e)}}}};M.prototype._getDraggingDomObjs=function(e){var t={};var i=d3.select(e.target)[0][0];var a;if(i.parentElement){a=i.parentElement}else if(i.parentNode){a=i.parentNode}if(a&&a.getAttribute("class")){var o=a.getAttribute("class");var s=o.split(" ")[0];if(sap.ui.getCore().byId(s)instanceof sap.gantt.shape.Group){t.groupDom=a;t.contentDoms=a.childNodes}else if(sap.ui.getCore().byId(s)instanceof sap.gantt.shape.Text){t.groupDom=a.parentElement;t.contentDoms=a.parentElement.childNodes}}else{t.groupDom=i;t.contentDoms=[i]}return t};M.prototype._handleShapeDragging=function(e){if(!a.support.touch&&(e.button!==0||e.buttons===0||e.ctrlKey)){return false}var t=o.getConfiguration().getRTL();var i=jQuery(this.getDomSelectorById("svg"));var s=Math.abs((this._getMouseXPos(e)-i.offset().left||e.offsetX)-this._oDraggingData.dragStartPoint.x);var r=Math.abs((e.pageY-i.offset().top||e.offsetY)-this._oDraggingData.dragStartPoint.y);if(s>3||r>3){var n=d3.select("#dragDropShadow");var h=n[0];if(this._oDraggingData===undefined){if(!n.empty()){n.remove()}}else{var g=this._oDraggingData.dragStartPoint.shapeX;var l=this._oDraggingData.dragStartPoint.shapeY;var p=this._oDraggingData.dragStartPoint.x;var d=this._oDraggingData.dragStartPoint.y;var c=12;var u=10;if(n.empty()||h===null){this._handleDragWithoutSelection(e);var f=this._oDraggingData.sourceShapeData.length;h=d3.select("body").append("div").attr("id","dragDropShadow");h.classed("sapGanttDraggingShadow",true);var _=12;var S=this._oDraggingData.groupDom.getBoundingClientRect();if(S){c=S.width;u=S.height}if(a.browser.safari){c=this._oDraggingData.dragStartPoint.shapeWidth;u=this._oDraggingData.dragStartPoint.shapeHeight}var v=u/2;var m='width="'+(c+5)+'" '+'height="'+(u+10)+'"';var T=jQuery(this._oDraggingData.groupDom).clone();this._resetShadowRelativePosition(T,undefined,undefined,d3.select(this._oDraggingData.groupDom).data());var w="<svg "+m+">"+this._getOuterHTML(T)+"</svg>";jQuery("#dragDropShadow").append(w);var y=h.select("svg");y.select("g").attr("opacity",.5);y.append("text").attr("x",c/2-_/2).attr("y",v+4).attr("fill","blue").attr("font-size",_).text(function(){return f})}var b;var D=this._getMouseXPos(e);if(this.getGhostAlignment()===sap.gantt.dragdrop.GhostAlignment.Start){b=t?D-this._oDraggingData.dragStartPoint.shapeWidth:D}else if(this.getGhostAlignment()===sap.gantt.dragdrop.GhostAlignment.None){b=g+D-p}else if(this.getGhostAlignment()===sap.gantt.dragdrop.GhostAlignment.End){b=t?D:D-this._oDraggingData.dragStartPoint.shapeWidth}var R=e.pageY;var C=e.pageY;C=l+R-d;var H=b+"px";var x=C+"px";var M=c+5+"px";var I=u+5+"px";d3.select("#dragDropShadow").style({left:H,top:x,width:M,height:I});jQuery(document.body).addClass("sapGanttDraggingCursor sapGanttDraggingOverflow");jQuery("svg").addClass("sapGanttDraggingCursor");this._setEventStatus("shapeDragging");this._handleAutoScroll(e)}}};M.prototype._resetShadowRelativePosition=function(e,t,i,a){var o=this;if(e.attr("x")!==undefined){if(!t){e.attr("x",0);e.attr("y",2)}}var s=e.children();if(s&&s.length>0){if(!t){s=s.filter(function(e,t){var i=jQuery(t);if(i.is("text")||i.is("title")){return false}var o=null;if(t.getAttribute("class")){o=sap.ui.getCore().byId(t.getAttribute("class").split(" ")[0])}if(i.attr("x")==undefined||i.attr("y")==undefined||o==null||o.getTime(a[0])==""){return false}return true});var r,n;s.each(function(e,t){var i=jQuery(t);var a=i.attr("x");var o=i.attr("y")-2;if(!r){r=a}else{r=a<r?a:r}if(!n){n=o}else{n=o<n?o:n}});if(!r||!n){return}s.each(function(e,t){var i=jQuery(t);i.attr("x",i.attr("x")-r);i.attr("y",i.attr("y")-n);o._resetShadowRelativePosition(i,r,n)})}else{s.each(function(e,a){var s=jQuery(a);if(s.attr("x")!==undefined){s.attr("x",s.attr("x")-t);s.attr("y",s.attr("y")-i)}o._resetShadowRelativePosition(s,t,i)})}}};M.prototype._handleDragWithoutSelection=function(e){var t=this._oDraggingData.sourceShapeData[0];if(!this._oShapeSelection.isShapeSelected(t.shapeData.uid)){var i=false;if(!e.ctrlKey){this._oDraggingData.sourceShapeData.splice(1,this._oDraggingData.sourceShapeData.length-1);i=this._oShapeSelection.clearAllSelections()}this._oShapeSelection.selectByShapeData(t.shapeData);this._drawSelectedShapes();this.fireShapeSelectionChange({originEvent:e});if(i){this.fireRelationshipSelectionChange({originEvent:e})}}};M.prototype._handleAutoScroll=function(e){return this._oAutoScrollHandler.autoScroll(this,e)};M.prototype._handleShapeDragEnd=function(e){this._oAutoScrollHandler.stop();var t=d3.select("#dragDropShadow");if(!t.empty()){t.remove()}if(this._bDragging&&this._oDraggingData!==undefined){var i=this.getId();this._collectDraggingShapeData(this._oDraggingData,e);this.fireShapeDragEnd({originEvent:e,sourceSvgId:this._oDraggingData.sourceSvgId,targetSvgId:i,sourceShapeData:this._oDraggingData.sourceShapeData,targetData:this._oDraggingData.targetData})}jQuery(document.body).off("mousemove.ganttChartDragDrop");jQuery(document).off("mouseup.ganttChartDragDrop");jQuery("svg").removeClass("sapGanttDraggingCursor");jQuery(document.body).removeClass("sapGanttDraggingCursor sapGanttDraggingOverflow");this._setEventStatus("shapeDragEnd")};M.prototype._collectDraggingShapeData=function(e,t){var i=jQuery(this.getDomSelectorById("svg"));var a=parseInt(this._getMouseXPos(t)-i.offset().left||t.offsetX);var s=e.dragStartPoint.x;var r=a-parseInt(s);var n;var h=S.abapTimestampToDate(e.sourceShapeData[0].shapeData.endTime)-S.abapTimestampToDate(e.sourceShapeData[0].shapeData.startTime);if(this.getGhostAlignment()===sap.gantt.dragdrop.GhostAlignment.Start){n=a}else if(this.getGhostAlignment()===sap.gantt.dragdrop.GhostAlignment.None){n=parseInt(e.dragStartPoint.shapeX)+r}else if(this.getGhostAlignment()===sap.gantt.dragdrop.GhostAlignment.End){n=a-parseInt(e.dragStartPoint.shapeWidth)}var g,l;if(o.getConfiguration().getRTL()===true){l=this.getAxisTime().viewToTime(n).getTime();g=new Date(l-h).getTime()}else{g=this.getAxisTime().viewToTime(n).getTime();l=new Date(g+h).getTime()}var p=this._composeParameterForClickPosition(t);var d=p?p.rowInfo:undefined;e.targetData={cursorTimestamp:this.getAxisTime().viewToTime(a).getTime(),shapeTimestamp:{startTime:g,endTime:l},mouseTimestamp:{startTime:g,endTime:l},mode:this.getMode(),objectInfo:d}};M.prototype.setDraggingData=function(e){if(e!==undefined){this._oDraggingData=e}if(this._oDraggingData!==undefined){this._oDraggingData.targetSvgId=this.getId();jQuery(document.body).off("mousemove.ganttChartDragDrop");jQuery(document).off("mouseup.ganttChartDragDrop");jQuery(document.body).on("mousemove.ganttChartDragDrop",this._handleShapeDragging.bind(this));jQuery(document).on("mouseup.ganttChartDragDrop",this._handleShapeDragEnd.bind(this));jQuery(document.body).off("mousemove.shapeDragDrop");jQuery(document).off("mouseup.shapeDragDrop");jQuery(document.body).on("mousemove.shapeDragDrop",this._oTimePopoverHandler._handleTimePopoverDragging.bind(this._oTimePopoverHandler));jQuery(document).on("mouseup.shapeDragDrop",this._oTimePopoverHandler._handleTimePopoverEnd.bind(this._oTimePopoverHandler));this._setEventStatus("dragEnter")}};M.prototype.setTimePopoverData=function(e){this._oTimePopoverHandler.setCurrentPopoverData(e)};M.prototype._onSvgMouseEnter=function(e){if(e.button===0&&e.buttons!==0&&e.target&&(e.target.id===this.getId()+"-svg-ctn"||e.target.id===this.getId()+"-svg"||this._mouseInSvgCtn(e))){this.fireChartDragEnter({originEvent:e})}};M.prototype._onSvgMouseLeave=function(e){if(e.target&&(e.target.id===this.getId()+"-svg-ctn"||e.target.id===this.getId()+"-svg"||!this._mouseInSvgCtn(e))){if(this._bDragStart&&this._oDraggingData!==undefined){this._handleDragLeave(e)}this._destroyCursorLine();this._handleHoverLeave();this._oShapeHoverHandler.handleShapeHover(null,e)}};M.prototype._mouseInSvgCtn=function(e){var t=jQuery(this.getDomSelectorById("svg-ctn"));var i=t.width()-(o.getConfiguration().getRTL()||jQuery(this.getTTVsbDom()).css("display")=="none"?0:jQuery(this.getTTVsbDom()).width());var a=t.height();var s=t.offset();var r=this._getMouseXPos(e)-s.left;var n=(e.pageY||e.clientY)-s.top;if(n>=0&&n<a&&r>=0&&r<i){return true}return false};M.prototype._onSvgMouseDown=function(e){this._prepareSelection(e);this._prepareDragging(e);this._oShapeResizeHandler.handleShapeResize(e)};M.prototype._onSvgMouseMove=function(e){this._drawCursorLine(e);this._handleHover(e)};M.prototype._onContextMenu=function(e){e.preventDefault()};M.prototype._onSvgMouseUp=function(e){if(e.button==2){this._handleRightClick(e)}else if(e.button==0&&!this._bDragging&&this._bMouseDown&&!this._oShapeResizeHandler.getIsResizing()){this._handleSelectionChange(e)}};M.prototype._onSvgDoubleClick=function(e){if(!this._bDragging&&!this._oShapeResizeHandler.getIsResizing()&&!e.ctrlKey&&!e.shiftKey&&!(a.os.name===a.os.OS.MACINTOSH&&e.metaKey)){var t=this._composeParameterForClickPosition(e);this.fireChartDoubleClick({objectInfo:t?t.rowInfo:undefined,leadingRowInfo:t?t.leadingRowInfo:undefined,timestamp:t?t.startTime.getTime():undefined,svgId:this.getId()+"-svg",svgCoordinate:t?t.svgPoint:undefined,effectingMode:this.getMode(),originEvent:e})}};M.prototype._onSvgTouchstart=function(e){this._prepareSelection(e);this._onTouchScrollStart(e)};M.prototype._onSvgTouchmove=function(e){this._onTouchScroll(e)};M.prototype._onSvgTouchend=function(e){if(this._bScrolling){this._setEventStatus("mouseUp")}};M.prototype._onKeyDown=function(e){if(e.which===i.Z&&this._oTimePeriodZoomHandler.isTimePeriodZoomEnabled()){this._oTimePeriodZoomHandler.invertActiveStatus()}};M.prototype._preventBubbleAndDefault=function(e){e.preventDefault();e.stopPropagation()};M.prototype._prepareSelection=function(e){if(!a.support.touch&&e.button!==0){return false}if(!this._bDragging&&!this._oShapeResizeHandler.getIsResizing()){this._setEventStatus("mouseDown")}};M.prototype._prepareDragging=function(e){if(e.button==0){if(this._oTimePeriodZoomHandler&&this._oTimePeriodZoomHandler.isActive()){this._oTimePeriodZoomHandler.handleDragStart(e);this._preventBubbleAndDefault(e)}else{var t=d3.select(e.target).data()[0];var i,a;if(e.target.getAttribute("class")){i=e.target.getAttribute("class").split(" ")[0];a=d3.select(e.target).classed("sapUiShapeResizingCursor")}if(!a&&i&&t&&this.isShapeSelectable(t,i)){if(this._bMouseDown){this._handleShapeDragStart(e)}this._preventBubbleAndDefault(e)}}}};M.prototype.syncTimePeriodZoomStatus=function(e){if(e){this._oTimePeriodZoomHandler.activate(true)}else{this._oTimePeriodZoomHandler.deactivate(true)}};M.prototype.syncTimePeriodZoomOperation=function(e,t,i){this._oTimePeriodZoomHandler.syncTimePeriodZoomOperation(e,t,i)};M.prototype._handleRightClick=function(e){var t=this._composeParameterForClickPosition(e);this.fireChartRightClick({objectInfo:t?t.rowInfo:undefined,leadingRowInfo:t?t.leadingRowInfo:undefined,timestamp:t?t.startTime.getTime():undefined,svgId:this.getId()+"-svg",svgCoordinate:t?t.svgPoint:undefined,effectingMode:this.getMode(),originEvent:e})};M.prototype._handleClick=function(e){var t=this._composeParameterForClickPosition(e);this.fireChartClick({objectInfo:t?t.rowInfo:undefined,leadingRowInfo:t?t.leadingRowInfo:undefined,timestamp:t?t.startTime.getTime():undefined,svgId:this.getId()+"-svg",svgCoordinate:t?t.svgPoint:undefined,effectingMode:this.getMode(),originEvent:e})};M.prototype._drawCursorLine=function(e){if(this.getEnableCursorLine()){var t=jQuery(this.getDomSelectorById("svg"));var i=this._getSvgCoodinateByDiv(t[0],this._getMouseXPos(e)-window.pageXOffset,e.pageY||e.clientY);this._oCursorLineDrawer.drawSvg(d3.selectAll(".sapGanttChartSvg"),d3.selectAll(".sapGanttChartHeaderSvg"),this.getLocale(),i)}};M.prototype._destroyCursorLine=function(){if(this.getEnableCursorLine()){this._oCursorLineDrawer.destroySvg(d3.selectAll(".sapGanttChartSvg"),d3.selectAll(".sapGanttChartHeaderSvg"))}};M.prototype._handleHover=function(e){var t=this._composeParameterForClickPosition(e);var i=t?t.leadingRowNum-this._oTT.getFirstVisibleRow():-1;i=i<0?-1:i;var a=t?t.isExpandedRow:false;var o=d3.select(e.target).data()[0];if(o){var s=this._getMouseXPos(e)-jQuery(this.getDomSelectorById("svg")).offset().left||e.offsetX;this._oShapeResizeHandler.checkShapeResizable(o,e.target,t.svgPoint?t.svgPoint.x:s)}this._oShapeHoverHandler.handleShapeHover(o,e);if(i>-1&&(o!==undefined&&o.uid!==this._lastHoverShapeUid||o===undefined&&this._lastHoverShapeUid!==undefined||i!==this._lastHoverRowIndex)){this.fireChartMouseOver({objectInfo:t?t.rowInfo:undefined,leadingRowInfo:t?t.leadingRowInfo:undefined,timestamp:t?t.startTime.getTime():undefined,svgId:this.getId()+"-svg",svgCoordinate:t?t.svgPoint:undefined,effectingMode:this.getMode(),originEvent:e});if(o!==undefined){this._lastHoverShapeUid=o.uid}else{this._lastHoverShapeUid=undefined}}if(i>-1&&i!==this._lastHoverRowIndex){var r=this._oTT;var n=r.getRows()[i];if(n){r.$().find(".sapUiTableRowHvr").trigger("mouseout");if(!a){n.$().trigger("mouseover")}}}if(i!==this._lastHoverRowIndex){this._lastHoverRowIndex=i}};M.prototype._handleDragLeave=function(e){this._oDraggingData.targetSvgId=undefined;this._setEventStatus("dragLeave");this.fireChartDragLeave({originEvent:e,draggingSource:this._oDraggingData,timePopoverData:this._oTimePopoverHandler.getCurrentPopoverData()})};M.prototype._handleHoverLeave=function(){var e=this._oTT;e.$().find(".sapUiTableRowHvr").trigger("mouseleave");this._lastHoverShapeUid=undefined;this._lastHoverRowIndex=-1};M.prototype._handleSelectionChange=function(e){var t=d3.select(e.target).datum();var i;if(e.target.getAttribute("class")){i=e.target.getAttribute("class").split(" ")[0]}var o={};if(t!==undefined&&this.isShapeSelectable(t,i)){var s=e.ctrlKey||a.os.name===sap.ui.Device.os.OS.MACINTOSH&&e.metaKey;o=this._selectionChange(t,s,e.shiftKey,e)}else{if(!(this.getParent()instanceof sap.gantt.GanttChartWithTable)||this.getParent().getTableProperties().selectionBehavior!==sap.ui.table.SelectionBehavior.RowSelector){var r=this._composeParameterForClickPosition(e);if(r&&!r.isExpandedRow){this._syncTTSelection(e)}else{return null}}if(this.getShapeSelectionMode()!==sap.gantt.SelectionMode.MultiWithKeyboard){o.shapeSelectionChange=this._oShapeSelection.clearShapeSelection();o.relationshipSelectionChange=this._oShapeSelection.clearRelationshipSelection()}}if(o.shapeSelectionChange||o.relationshipSelectionChange){this._drawSelectedShapes()}this._setEventStatus("mouseUp");if(o.shapeSelectionChange){this.fireShapeSelectionChange({originEvent:e})}if(o.relationshipSelectionChange){this.fireRelationshipSelectionChange({originEvent:e})}this._handleClick(e)};M.prototype._bindScrollLogicForTT=function(){this._bindHorizontalScroll();this._bindVerticalScroll()};M.prototype._bindHorizontalScroll=function(){this._updateScrollLeft();var e=jQuery(this.getTTHsbDom());e.off("scroll.sapUiTableHScroll");e.off("scroll.sapUiTableHScrollForGanttChart",this._onHSbScroll);e.on("scroll.sapUiTableHScrollForGanttChart",this._onHSbScroll.bind(this))};M.prototype._bindVerticalScroll=function(){var e=jQuery(this.getTTVsbDom());e.off("scroll.sapUiTableVScrollForGanttChart",this._onVSbScroll);e.on("scroll.sapUiTableVScrollForGanttChart",this._onVSbScroll.bind(this))};M.prototype._getSvgHeight=function(){return this._oTT.$().find(".sapUiTableCCnt").height()};M.prototype._getRowHeights=function(){return this._aHeights};M.prototype.setBaseRowHeight=function(e){this.setProperty("baseRowHeight",e,true);this._oTT.setRowHeight(e);return this};M.prototype._setInferedBaseRowHeight=function(e){this._iInferedBaseRowHeight=e};M.prototype.getBaseRowHeight=function(){return this._iInferedBaseRowHeight?this._iInferedBaseRowHeight:this._iInferedBaseRowHeightOnTT};M.prototype._initialSvgDrawing=function(){if(this.getBaseRowHeight()&&this._iSvgHeight!=this._getSvgHeight()){this._iSvgHeight=this._getSvgHeight();this._bTableReady=true;this._onTTRowUpdate()}};M.prototype._onHSbScroll=function(e){if(this._initHorizonApplied){var t=this._getHSBScrollLeft();if(!this._bSuppressSetVisibleHorizon){var i=this._getScrollRateByScrollLeft(t);var a=this._getVisibleHorizonByScrollRate(i);this._updateVisibleHorizon(a,"horizontalScroll")}this._bSuppressSetVisibleHorizon=false;var o=this.getAxisTimeStrategy();var s=o.getVisibleHorizon();var r=this.getVisibleWidth();this.fireHorizontalScroll({scrollSteps:t,startTime:s.getStartTime(),endTime:s.getEndTime(),visibleWidth:r});this._drawHeader()}};M.prototype._getScrollRateByScrollLeft=function(e){var t=this._oTT.$(sap.ui.table.SharedDomRef.HorizontalScrollBar+"-content");var i=t.width();var s=this.getVisibleWidth();var r=0;if(i!==s){if(o.getConfiguration().getRTL()===true&&a.browser.edge){r=(i-e-s)/(i-s)}else if(o.getConfiguration().getRTL()===true&&a.browser.safari){r=(i+e-s)/(i-s)}else{r=e/(i-s)}r=r<0?0:r;r=r>1?1:r}return r};M.prototype._getScrollRateByHorizon=function(e){var t=0;var i=this._nUpperRange-this._nLowerRange;var a=this.getVisibleWidth();if(this._initHorizonApplied&&i!==a){var s;if(o.getConfiguration().getRTL()){s=this.getAxisTime().timeToView(S.abapTimestampToDate(e.getEndTime()),true);t=s/(i-a)}else{s=this.getAxisTime().timeToView(S.abapTimestampToDate(e.getStartTime()),true);t=s/(i-a)}t=t<0?0:t;t=t>1?1:t}return t};M.prototype._getHSBScrollLeftByScrollRate=function(e){var t=this._oTT.$(sap.ui.table.SharedDomRef.HorizontalScrollBar+"-content");var i=t.width();var s=this.getVisibleWidth();var r=e*(i-s);if(o.getConfiguration().getRTL()&&a.browser.edge){r=i-s-r}else if(o.getConfiguration().getRTL()&&a.browser.safari){r=0-(i-s-r)}return r};M.prototype._getContentScrollLeftByScrollRate=function(e){var t=this._nUpperRange-this._nLowerRange;var i=this.getVisibleWidth();var a=e*(t-i);return a};M.prototype._getVisibleHorizonByScrollRate=function(e){var t=this._getContentScrollLeftByScrollRate(e);var i=this.getAxisTimeStrategy().getTotalHorizon();var a;var s={};var r=o.getConfiguration().getRTL();if(e===0){s.startTime=r?undefined:i.getStartTime();s.endTime=r?i.getEndTime():undefined}else if(e===1){s.startTime=r?i.getStartTime():undefined;s.endTime=r?undefined:i.getEndTime()}else{var n=this.getAxisTime().viewToTime(t,true);s.startTime=r?undefined:n;s.endTime=r?n:undefined}a=new y(s);return a};M.prototype.syncVisibleHorizon=function(e,t,i){var a=this.getAxisTimeStrategy();var o=a.getTotalHorizon();var s;if(t!==undefined){var r=this.getVisibleWidth();if(i){var h=a.getVisibleHorizon();var g=S.abapTimestampToDate(h.getStartTime());s=n.calculateHorizonByWidth(e,t,r,g)}else{s=n.calculateHorizonByWidth(e,t,r)}}else{s=e}if(o.getEndTime()<s.getEndTime()){var l=S.abapTimestampToDate(s.getEndTime()).getTime()-S.abapTimestampToDate(s.getStartTime()).getTime();var p=S.abapTimestampToDate(o.getEndTime());var d=new Date;d.setTime(p.getTime()-l);s=new y({startTime:d,endTime:p})}this._updateVisibleHorizon(s,"syncVisibleHorizon")};M.prototype._onVSbScroll=function(){if(!this._mTimeouts._drawSvg){this.$().find(".sapGanttChartSvg").css("transform","translateY("+-this._oTT.$().find(".sapUiTableCCnt").scrollTop()+"px)")}this.fireVerticalScroll({scrollSteps:this._oTT.getFirstVisibleRow(),scrollPosition:jQuery(this.getTTVsbDom()).scrollTop()})};M.prototype._hSbScrollLeft=function(e){var t=jQuery(this.getDomSelectorById("svg-ctn"));var i=jQuery(this.getDomSelectorById("header"));var s;if(o.getConfiguration().getRTL()===true){if(!a.browser.safari){s=this._oStatusSet.aViewBoundary[1]-i.width()-e;if(s<0){s=0}}else{s=0-e}}else{s=e}if(o.getConfiguration().getRTL()===true&&a.browser.firefox){if(Math.abs(t.scrollLeftRTL()-s)>1){t.scrollLeftRTL(s)}if(Math.abs(i.scrollLeftRTL()-s)>1){i.scrollLeftRTL(s)}}else{if(Math.abs(t.scrollLeft()-s)>1){t.scrollLeft(s)}if(Math.abs(i.scrollLeft()-s)>1){i.scrollLeft(s)}}};M.prototype._doBirdEye=function(e){this._oBirdEyeHandler.doBirdEye(e)};M.prototype.getLargestHorizonByDataRange=function(e,t,i){var a=this._oShapeManager.getAllShapeInstances();var o=[];if(a&&a.length>0){if(e===sap.gantt.config.BirdEyeRange.AllRows){o=o.concat(this.getAllRowData())}else if(e===sap.gantt.config.BirdEyeRange.VisibleRows){o=o.concat(this._aFilteredRowData)}else if(!e&&t>=0&&this._aFilteredRowData.length>t){o=o.concat(this._aFilteredRowData[t])}this._oShapeManager.collectDataForAllShapeInstances(o,this._oObjectTypesConfigMap,this._oChartSchemesConfigMap)}return this._oBirdEyeHandler.calculateLargestVisibleHorizon(a,i)};M.prototype.doBirdEyeOnRow=function(e){var t=this._getTTFirstRenderingRowIndex();e=e-t;this._oBirdEyeHandler.doBirdEye(null,e)};M.prototype.jumpToPosition=function(e){if(e instanceof Date){this._updateVisibleHorizon(new y({startTime:e}),"jumpToPosition")}else if(e instanceof Array){this._updateVisibleHorizon(new y({startTime:e[0],endTime:e[1]}),"jumpToPosition")}else if(e===undefined){this._updateVisibleHorizon(this.getAxisTimeStrategy().getTotalHorizon(),"jumpToPosition")}};M.prototype._updateVisibleHorizon=function(e,t){var i=this.getAxisTimeStrategy();var a=this.getVisibleWidth();i.updateGanttVisibleWidth(a);i.setVisibleHorizonWithReason(e,t)};M.prototype._onTTRowUpdate=function(){if(this._bTableReady){this._syncSvgHeightWithTT();this._syncSvgDataWithTT();this._draw(true)}};M.prototype._syncSvgHeightWithTT=function(){var e=this.$().find(".sapGanttChartSvgCtn");e.height(this._getSvgHeight());var t=this.$().find(".sapGanttChartSvg");t.height(jQuery(this._oTT.$().find(".sapUiTableCtrlRowScroll:not(.sapUiTableCHT)")).height())};M.prototype._syncSvgDataWithTT=function(){var e=this._oTT.getBinding("rows");if(!e){return false}var t=this._getTTFirstRenderingRowIndex();var i=this._getVisibleRowCount();this._aFilteredRowData=[];this._aNonVisibleShapeData=[];var a=[];var o=[];var s=[t,t+i-1];var r=this._aRelationshipsContexts&&this._aRelationshipsContexts.length>0;if(r){e.getContexts(0,0);if(t>0){a=this._getDrawingData([0,t-1])}o=this._getDrawingData([t+i,e.getLength()-1]);e.getContexts(s[0],s[1])}this._aFilteredRowData=this._getDrawingData(s);this._aNonVisibleShapeData=a.concat(o);var n=this.getBaseRowHeight();if(!n){n=0}this._oAxisOrdinal=this._createAxisOrdinal(this._aFilteredRowData,n,0);this._cacheObjectPosition(this._aFilteredRowData,this._oAxisOrdinal);this._cacheObjectPosition(a,this._oAxisOrdinal,true);this._cacheObjectPosition(o,this._oAxisOrdinal,false);if(!this._aVisibleRange||this._aVisibleRange[0]!==s[0]||this._aVisibleRange[1]!==s[1]){this._aVisibleRange=s;return true}return false};M.prototype._cacheObjectPosition=function(e,t,i){if(e&&e.length>0){if(i===true){for(var a=0;a<e.length;a++){e[a].y=-100;e[a].rowHeight=t.getViewBandWidth()}}else if(i===false){for(var o=0;o<e.length;o++){e[o].y=t.getViewRange()[1]+100;e[o].rowHeight=t.getViewBandWidth()}}else{var s=[];var r=[];for(var n=0;n<e.length;n++){e[n].y=t.elementToView(e[n].uid);if(n>0){e[n-1].rowHeight=e[n].y-e[n-1].y}if(e[n].visibleRowSpan){e[n].visibleRowHeight=e[n].visibleRowSpan*t.getViewBandWidth();s.push(e[n].uid);r.push(e[n].visibleRowSpan)}}e[e.length-1].rowHeight=t.getViewRange()[1]-e[e.length-1].y;this._oAxisOrdinalOfVisibleRow=new _(s,r,this.getBaseRowHeight(),0)}}};M.prototype._prepareRelationshipDataFromModel=function(){this._aRelationships=[];if(this._aRelationshipsContexts){for(var e=0;e<this._aRelationshipsContexts.length;e++){var t=this._aRelationshipsContexts[e].getObject();if(t!==undefined){this._aRelationships.push(t)}}}n.generateUidForRelationship(this._aRelationships,this.getRlsIdName())};M.prototype._createAxisOrdinal=function(e,t,i){var a=e.map(function(e){return e.uid});var o=e.map(function(e){if(e.rowSpan){return e.rowSpan}else{return 1}});return new _(a,o,t,i)};M.prototype.getFilteredRowData=function(e){return this._aFilteredRowData};M.prototype._getDrawingData=function(e,t){var i=function(e,t,i,a){if(!e[t]){e.push({})}if(!e[t][i]){e[t][i]=[]}e[t][i].push(a)};var a,o,s,r,h,g;var l=this.getRowIdName();var p=this.getRowTypeName();var d=this._oTT.getBinding("rows");var c=this._oTT.getBindingInfo("rows");var u=[];var f=[],_;if(t){f=t}else{for(a=e[0];a<=e[1];a++){f.push(a)}}_=f.length;if(d!==undefined){var S=d.getModel();var v=this.getShapeDataNames();for(a=0;a<_;a++){var m=this._oTT.getContextByIndex(f[a]);if(!m){continue}else{h=m.getObject();if(!h){continue}}var T=1;g=this._oObjectTypesConfigMap[h[p]]?this._oObjectTypesConfigMap[h[p]].getMainChartSchemeKey():sap.gantt.config.DEFAULT_CHART_SCHEME_KEY;if(h[p]){var w=this._oChartSchemesConfigMap[g];if(w){T=w.getRowSpan()}}var y={bindingObj:d,bindingInfo:c,contextObj:m,data:h,id:h[l],type:h[p],rowSpan:T,chartScheme:g,rowIndex:f[a],index:0,visibleRowSpan:T};u.push(y);if(!this._bJSONTreeBinding){if(v&&v.length>0){for(o=0;o<v.length;o++){var b;if(typeof v[o]==="string"){b=v[o]}else{b=v[o].name}var D=m.getProperty(b);var R;if(D){y.data[b]=[];for(s=0;s<D.length;s++){var C=D[s];if(typeof C==="string"){R=S.getData("/"+C)}else{R=C}y.data[b].push(R)}}}}}n.generateRowUid([y],this._oObjectTypesConfigMap,v,undefined,l);var H=h.uid;if(H&&this._oRowStatusMap[H]){for(g in this._oRowStatusMap[H]){var x;if(this._oChartSchemesConfigMap[g]&&this._oChartSchemesConfigMap[g].getModeKey()&&this._oChartSchemesConfigMap[g].getModeKey()!==sap.gantt.config.DEFAULT_MODE_KEY){x=this._oChartSchemesConfigMap[g].getModeKey()}else{x=this.getMode()}var M=this._collectDataNameForValidChartScheme(g,x);if(M&&M.drawData){var I=0;var A=[{}];for(o=0;o<M.drawData.length;o++){if(!h[M.drawData[o]]){continue}for(s=0;s<h[M.drawData[o]].length;s++){var L=h[M.drawData[o]][s][M.rowIndexName];if(L&&I<L){I=L}}}if(I>0){for(o=0;o<M.drawData.length;o++){if(!h[M.drawData[o]]){continue}for(s=0;s<h[M.drawData[o]].length;s++){var B=h[M.drawData[o]][s][M.rowIndexName];if(B){i(A,B,M.drawData[o],h[M.drawData[o]][s])}else{for(r=1;r<=I;r++){i(A,r,M.drawData[o],h[M.drawData[o]][s])}}}}for(o=1;o<=I;o++){var P={bindingObj:d,bindingInfo:c,data:A[o],id:h[l],type:h[p],parentId:y.id,rowSpan:M.rowSpan,chartScheme:g,rowIndex:f[a],index:o,icon:this._oChartSchemesConfigMap[g].getIcon(),closeIcon:"./image/closeChart.png",name:this._oChartSchemesConfigMap[g].getName()};n.generateRowUid([P],this._oObjectTypesConfigMap,v,undefined,l);u.push(P);y.visibleRowSpan+=M.rowSpan}}}}this._oRowStatusMap[H].visibleRowSpan=y.visibleRowSpan}}}return u};M.prototype._prepareVerticalDrawingRange=function(){var e=this._oTT.getBinding("rows").getLength()-1;if(e<0){return[0,-1]}var t=this._getTTFirstRenderingRowIndex();var i=t+this._getVisibleRowCount()-1;var a=t;var o=i<e?i:e;return[a,o]};M.prototype._prepareHorizontalDrawingRange=function(){var e=this._nUpperRange-this._nLowerRange;var t=this.getVisibleWidth();if(!this._oStatusSet){this._updateScrollWidth()}var i=this._getContentScrollLeft();if(this._oStatusSet){if(t>=e||this._oStatusSet.aViewBoundary[0]<=i-this._oStatusSet.nOffset&&this._oStatusSet.aViewBoundary[1]>=i+t-this._oStatusSet.nOffset){if(!this._mTimeouts._drawSvg){this._updateScrollLeft();this._scrollSvg()}return false}}var a=t*(1+this._fExtendFactor*2);var s=i-t*this._fExtendFactor;if(s<this._nLowerRange){a+=s;s=0}if(s+a>this._nUpperRange){a=this._nUpperRange-s}this.getAxisTime().setViewOffset(s);if(a<0){return false}this._oStatusSet={nWidth:a,nOffset:s,nScrollLeft:i,aViewBoundary:[0,a],aTimeBoundary:[this.getAxisTime().viewToTime(0),this.getAxisTime().viewToTime(a)],bRTL:o.getConfiguration().getRTL()};return true};M.prototype._draw=function(e){if(!this._bTableReady){return}this._ensureShapesCreated(function(){var t=this._nUpperRange-this._nLowerRange;if(t<=2){return}var i=this.getVisibleWidth();if(!i||i<=0||i>document.body.clientWidth){return}var a=this.getAxisTimeStrategy().syncContext(i);this.fireEvent("_zoomInfoUpdated",a);if(a.axisTimeChanged){this.setProperty("timeZoomRate",this.getAxisTime().getZoomRate(),true);this.resetWidthInfo()}if(!this._prepareHorizontalDrawingRange()&&!e){return}this._updateTableRowHeights();var o=this;this._mTimeouts._drawSvg=this._mTimeouts._drawSvg||window.setTimeout(function(){o._drawSvg()},0)}.bind(this))};M.prototype.getVisibleWidth=function(){var e=jQuery(this.getDomSelectorById("svg-ctn"));if(!e){return null}var t=this.getTTVsbDom()!=null?this.getTTVsbDom().getBoundingClientRect().width:0;var i=e.width()-(o.getConfiguration().getRTL()?0:t);if(!i||i<=0){return null}return i};M.prototype._updateScrollWidth=function(){var e=this._nUpperRange-this._nLowerRange;this._oColumn.setWidth(e-4+"px")};M.prototype._updateScrollLeft=function(e){var t=jQuery(this.getTTHsbDom());var i=this._calHSBScrollLeft();var s=this._getHSBScrollLeft(t);if(Math.abs(s-i)>1){this._bSuppressSetVisibleHorizon=!e;if(o.getConfiguration().getRTL()===true&&a.browser.firefox){t.scrollLeftRTL(i)}else{t.scrollLeft(i)}}else if(this._forceHsbScrollSync(s,i)){this._bSuppressSetVisibleHorizon=!e;this._onHSbScroll()}};M.prototype._forceHsbScrollSync=function(e,t){if(this._oLastVisibleHorizon){var i=this.getAxisTimeStrategy().getVisibleHorizon();if(i&&(this._oLastVisibleHorizon.getStartTime()!=i.getStartTime()||this._oLastVisibleHorizon.getEndTime()!=i.getEndTime())){this._oLastVisibleHorizon=i;return true}}return false};M.prototype._calHSBScrollLeft=function(){var e=this.getAxisTimeStrategy().getVisibleHorizon();var t=this._getScrollRateByHorizon(e);var i=this._getHSBScrollLeftByScrollRate(t);return i};M.prototype._getHSBScrollLeft=function(e){if(!e){e=jQuery(this.getTTHsbDom())}return o.getConfiguration().getRTL()===true&&a.browser.firefox?e.scrollLeftRTL():e.scrollLeft()};M.prototype._scrollSvg=function(){var e=jQuery(this.getDomSelectorById("svg"));var t=jQuery(this.getDomSelectorById("header-svg"));if(Math.abs(this._oStatusSet.nWidth-e.width())>1){e.width(this._oStatusSet.nWidth+(o.getConfiguration().getRTL()?0:jQuery(this.getTTVsbDom()).width()))}if(Math.abs(this._oStatusSet.nWidth-t.width())>1){t.width(this._oStatusSet.nWidth+(o.getConfiguration().getRTL()?0:jQuery(this.getTTVsbDom()).width()))}var i=this.getVisibleWidth();var s=this._getContentScrollLeft();if(o.getConfiguration().getRTL()===true&&!a.browser.edge){this._hSbScrollLeft(this._oStatusSet.nOffset-s+this._oStatusSet.nWidth-i)}else{this._hSbScrollLeft(s-this._oStatusSet.nOffset)}};M.prototype._getContentScrollLeft=function(){var e=this.getAxisTimeStrategy().getVisibleHorizon();var t=this._getScrollRateByHorizon(e);var i=this._getContentScrollLeftByScrollRate(t);return i};M.prototype._drawSvg=function(){t.start("GanttChart _drawSvg","GanttPerf:GanttChart _drawSvg function");if(!this._initHorizonApplied){this._prepareHorizontalDrawingRange();this._initHorizonApplied=true;this._updateScrollLeft(true)}else{this._updateScrollLeft()}jQuery(this.getDomSelectorById("svg-ctn")).css("visibility","hidden");this._scrollSvg();jQuery(this.getDomSelectorById("svg-ctn")).css("visibility","visible");this._sUiSizeMode=n.findSapUiSizeClass();this._drawCalendarPattern();this._drawHeader();this._drawNowLine();this._drawVerticalLine();this._drawExpandedBackground();this._drawShapes();this._drawSelectedShapes();this._drawAdhocLine();delete this._mTimeouts._drawSvg;this.$().find(".sapGanttChartSvg").css("transform","translateY("+-this._oTT.$().find(".sapUiTableCCnt").scrollTop()+"px)");this.fireEvent("_shapesUpdated",{aSvg:jQuery(this.getDomSelectorById("svg"))});t.end("GanttChart _drawSvg")};M.prototype._drawHeader=function(){var e=jQuery(this.getDomRef()).find(".sapGanttChartHeader");var t=e.height();var i=d3.select(jQuery(this.getDomRef()).find(".sapGanttChartHeaderSvg").get(0));i.attr("height",t);var s=t/5*2;var r=t/5*4;var h=t/5*4;var g=this.getAxisTimeStrategy();var l=window.screen.width;var p=this.getAxisTime().getTickTimeIntervalLabel(g.getTimeLineOption(),null,[0,this._oStatusSet.nWidth>=l?this._oStatusSet.nWidth:l]);i.selectAll("g").remove();var d=i.append("g");d.selectAll("label0").data(p[0]).enter().append("text").classed("sapGanttTimeHeaderSvgText0",true).text(function(e){return e.label}).attr("x",this._getXwithOffset).attr("y",function(e){return s}).attr("text-anchor","start");d.selectAll("label1").data(p[1]).enter().append("text").classed("sapGanttTimeHeaderSvgText1",true).text(function(e){return e.label}).attr("x",this._getXwithOffset).attr("y",function(e){return h});d3.selectAll(".sapGanttChartHeader .sapGanttTimeHeaderSvgText1").each(function(e,t){d3.select(this).append("title").text(function(e){if(e!=null){return e.largeLabel}})});if(a.browser.edge&&o.getConfiguration().getRTL()){d3.selectAll(".sapGanttChartHeader .sapGanttTimeHeaderSvgText0").each(function(e,t){d3.select(this).attr("transform",function(e){var t="translate("+-n.calculateStringLength(e.label)*parseInt(jQuery(".sapGanttTimeHeaderSvgText0").css("font-size"))/2+")";return t})});d3.selectAll(".sapGanttChartHeader .sapGanttTimeHeaderSvgText1").each(function(e,t){d3.select(this).attr("transform",function(e){var t="translate("+-n.calculateStringLength(e.label)*parseInt(jQuery(".sapGanttTimeHeaderSvgText1").css("font-size"))/2+")";return t})})}var c,u;var f="";for(u=0;u<p[1].length;u++){c=p[1][u];if(c){f+=" M"+" "+(c.value-1/2)+" "+r+" L"+" "+(c.value-1/2)+" "+t}}var _=this.getAxisTime();if(_.largeIntervalLabel&&!_.largeIntervalPath){for(u=0;u<p[0].length;u++){if(p[0][u].value===_.firstTickPosition){p[0].splice(u,1);break}}}var S="";for(u=0;u<p[0].length;u++){c=p[0][u];if(c){S+=" M"+" "+(c.value-1/2)+" 0"+" L"+" "+(c.value-1/2)+" "+t/2}}d.append("path").classed("sapGanttTimeHeaderSvgPath",true).attr("d",f);d.append("path").classed("sapGanttTimeHeaderLargeIntervalSvgPath",true).attr("d",S)};M.prototype._getXwithOffset=function(e){var t=5;if(o.getConfiguration().getRTL()){return e.value-t}else{return e.value+t}};M.prototype._drawCalendarPattern=function(){var e=d3.select(this.getDomSelectorById("svg"));this._oCalendarPatternDrawer.drawSvg(e,this.getId(),this.getCalendarDef(),this._oStatusSet,this.getBaseRowHeight())};M.prototype._drawNowLine=function(){this._oNowlineDrawer=new p(this.getAxisTime());var e=d3.select(this.getDomSelectorById("header-svg")),t=d3.select(this.getDomSelectorById("svg"));if(this.getEnableNowLine()){this._oNowlineDrawer.drawSvg(t,e,this.getNowLineInUTC())}else{this._oNowlineDrawer.destroySvg(t,e)}};M.prototype._drawVerticalLine=function(){this._oVerticalLineDrawer=new d(this.getAxisTime());var e=d3.select(this.getDomSelectorById("svg"));if(this.getEnableVerticalLine()){this._oVerticalLineDrawer.drawSvg(e)}else{this._oVerticalLineDrawer.destroySvg(e)}};M.prototype._drawAdhocLine=function(){this._oAdhocLineDrawer=new c(this.getAxisTime());var e=d3.select(this.getDomSelectorById("svg"));if(this.getEnableAdhocLine()){this._oAdhocLineDrawer.drawSvg(e,this.getAdhocLines(),this._oStatusSet,this.getAdhocLineLayer())}else{this._oAdhocLineDrawer.destroySvg(e)}};M.prototype._drawExpandedBackground=function(){var e=d3.select(this.getDomSelectorById("svg"));if(!this._oTT||!this._oTT.getRows()||this._oTT.getRows().length<=0){return}if(this._aFilteredRowData){var t=this._composeChartSchemeBackgroundConfig();this._oExpandedBackgroundDrawer.drawSvg(e,this._aFilteredRowData,t)}};M.prototype._composeChartSchemeBackgroundConfig=function(){var e=this._oChartSchemesConfigMap;var t={};if(e){for(var i in e){if(e[i].getHaveBackground()){t[i]=e[i].getBackgroundClass()}}}return t};M.prototype._drawShapes=function(){var e=d3.select(this.getDomSelectorById("svg"));var t=this._oShapeManager.getAllShapeInstances();var i=this._oShapeManager.mShapeInstance;if(this._aFilteredRowData&&t&&t.length>0){this._oShapeManager.collectDataForAllShapeInstances(this._aFilteredRowData,this._oObjectTypesConfigMap,this._oChartSchemesConfigMap);var a=this.getAxisTime();var o=this._oShapeCrossRowDrawer.generateRelationshipDataSet(e,i,this._aNonVisibleShapeData,this.getShapeDataNames(),this._aRelationships,a,this._oAxisOrdinal);for(var s=0;s<t.length;s++){var r=t[s];switch(r.getCategory(null,a,this._oAxisOrdinal)){case sap.gantt.shape.ShapeCategory.InRowShape:this._oShapeInRowDrawer.drawSvg(e,r,a,this._oAxisOrdinal,this._oStatusSet);break;case sap.gantt.shape.ShapeCategory.Relationship:r.dataSet=this._oShapeManager.isRelationshipDisplayable(r)?o:[];this._oShapeCrossRowDrawer.drawSvg(e,r,a,this._oAxisOrdinal);break;default:break}}}};M.prototype.getShapeInstance=function(e){this._ensureShapesCreatedSync();return this._oShapeManager.mShapeInstance[e]};M.prototype._drawSelectedShapes=function(){var e=d3.select(this.getDomSelectorById("svg"));var t=this._oShapeManager.mShapeInstance;this._oShapeManager.collectDataForSelectedShapes(this._oShapeSelection,this._oObjectTypesConfigMap,this._oChartSchemesConfigMap);var i=this.getAxisTime();var a=this._oShapeCrossRowDrawer.generateRelationshipDataSet(e,t,this._aNonVisibleShapeData,this.getShapeDataNames(),this._oShapeSelection.getSelectedRelationships(),i,this._oAxisOrdinal);for(var o in t){var s=t[o].getAggregation("selectedShape");var r=s.getCategory(null,this._oAxisTime,this._oAxisOrdinal);switch(r){case sap.gantt.shape.ShapeCategory.InRowShape:this._oShapeInRowDrawer.drawSvg(e,s,i,this._oAxisOrdinal,this._oStatusSet);break;case sap.gantt.shape.ShapeCategory.Relationship:s.dataSet=a;this._oShapeCrossRowDrawer.drawSvg(e,s,i,this._oAxisOrdinal);break;default:break}}};M.prototype._getSvgCoodinateByDiv=function(e,t,i){var a=e.createSVGPoint();a.x=t;a.y=i;a=a.matrixTransform(e.getScreenCTM().inverse());a.svgHeight=e.height.baseVal.value;a.svgId=this.getId()+"-svg";return a};M.prototype.isShapeSelectable=function(e,t){return this._oShapeManager.isShapeSelectable(e,t)};M.prototype.getAxisOrdinal=function(){return this._oAxisOrdinal};M.prototype._ensureAxisTimeCreated=function(){var e=this.getAxisTimeStrategy().getAxisTime();if(!e){this._createAxisTime(this.getAxisTimeStrategy());e=this.getAxisTimeStrategy().getAxisTime()}};M.prototype._ensureShapesCreatedSync=function(){this._ensureAxisTimeCreated();if(!this._shapesInited){var e=this.getProperty("shapes");if(e&&e.length>0){this._oShapeManager.instantiateShapesSync(e)}this._shapesInited=true}};M.prototype._ensureShapesCreated=function(e){e=e||function(){};this._ensureAxisTimeCreated();if(!this._shapesInited){var t=this.getProperty("shapes");if(t&&t.length>0){try{this._oShapeManager.instantiateShapesSync(t);this._shapesInited=true;e()}catch(i){this._oShapeManager.instantiateShapes(t).then(function(){this._shapesInited=true;e()}.bind(this)).catch(function(){})}}else{this._shapesInited=true;e()}}else{e()}};M.prototype.getAxisTime=function(){this._ensureAxisTimeCreated();var e=this.getAxisTimeStrategy().getAxisTime();return e};M.prototype.ondblclick=function(e){return null};M.prototype.onclick=function(e){return null};M.prototype.getSapUiSizeClass=function(){return this._sUiSizeMode};M.prototype.setFirstVisibleRow=function(e){this.setTableProperties({firstVisableRow:e});return this};M.prototype._getVisibleRowCount=function(){return this._oTT.getVisibleRowCount()+1};M.prototype._setLargeDataScrolling=function(e){if(this._oTT._setLargeDataScrolling){this._oTT._setLargeDataScrolling(!!e)}};M.prototype.exit=function(){this._oShapeManager.destroy();this._detachEvents();this._cleanUpTimers()};M.prototype._cleanUpTimers=function(){for(var e in this._mTimeouts){if(this._mTimeouts[e]){clearTimeout(this._mTimeouts[e]);this._mTimeouts[e]=undefined}}};M.prototype.getTTHsbDom=function(){return this._oTT.getDomRef(sap.ui.table.SharedDomRef.HorizontalScrollBar)};M.prototype.getTTVsbDom=function(){return this._oTT.getDomRef(sap.ui.table.SharedDomRef.VerticalScrollBar)};M.prototype._getTTFirstRenderingRowIndex=function(){if(this._oTT.getRows().length>0){return this._oTT.getRows()[0].getIndex()}return this._oTT.getFirstVisibleRow()};M.prototype._getMouseXPos=function(e){if(a.browser.edge){return e.clientX}return e.pageX};M.prototype._getOuterHTML=function(e){return e.prop("outerHTML")};return M},true);
//# sourceMappingURL=GanttChart.js.map