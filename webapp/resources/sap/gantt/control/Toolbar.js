/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

		(c) Copyright 2009-2015 SAP SE. All rights reserved
	
 */
sap.ui.define(["sap/gantt/library","sap/ui/core/Control","sap/ui/core/Core","sap/ui/core/CustomData","sap/ui/base/ManagedObjectMetadata","sap/ui/Device","sap/m/OverflowToolbar","sap/m/OverflowToolbarLayoutData","sap/m/ToolbarSpacer","sap/m/FlexBox","sap/m/library","sap/m/Button","sap/m/SegmentedButton","sap/m/Select","sap/m/MenuButton","sap/m/Menu","sap/m/MenuItem","sap/ui/core/Item","sap/m/ViewSettingsDialog","sap/m/ViewSettingsCustomTab","sap/m/CheckBox","sap/ui/core/library","sap/m/Slider","sap/m/Popover"],function(t,e,o,i,n,s,r,a,h,l,u,g,p,_,d,c,m,f,T,y,C,I,S,b){"use strict";var E=t.config,L=t.control;var v=I.Orientation;var B=u.FlexDirection;var A=u.PlacementType;var x=e.extend("sap.gantt.control.Toolbar",{metadata:{library:"sap.gantt",properties:{width:{type:"CSSSize",defaultValue:"100%"},height:{type:"CSSSize",defaultValue:"100%"},type:{type:"string",defaultValue:L.ToolbarType.Global},sourceId:{type:"string"},zoomLevel:{type:"int",defaultValue:0},enableTimeScrollSync:{type:"boolean",defaultValue:true},enableCursorLine:{type:"boolean",defaultValue:true},enableNowLine:{type:"boolean",defaultValue:true},enableVerticalLine:{type:"boolean",defaultValue:true},enableAdhocLine:{type:"boolean",defaultValue:true},enableDeltaLine:{type:"boolean",defaultValue:true},modes:{type:"object[]",defaultValue:[E.DEFAULT_MODE]},mode:{type:"string",defaultValue:E.DEFAULT_MODE_KEY},toolbarSchemes:{type:"object[]",defaultValue:[E.DEFAULT_CONTAINER_TOOLBAR_SCHEME,E.DEFAULT_GANTTCHART_TOOLBAR_SCHEME,E.EMPTY_TOOLBAR_SCHEME]},hierarchies:{type:"object[]",defaultValue:[E.DEFAULT_HIERARCHY]},containerLayouts:{type:"object[]",defaultValue:[E.DEFAULT_CONTAINER_SINGLE_LAYOUT,E.DEFAULT_CONTAINER_DUAL_LAYOUT]}},aggregations:{legend:{type:"sap.ui.core.Control",multiple:false,visibility:"public"},customToolbarItems:{type:"sap.ui.core.Control",multiple:true,visibility:"public",singularName:"customToolbarItem"},_toolbar:{type:"sap.m.OverflowToolbar",multiple:false,visibility:"hidden"}},events:{sourceChange:{parameters:{id:{type:"string"}}},layoutChange:{parameters:{id:{type:"string"},value:{type:"string"}}},expandChartChange:{parameters:{action:{type:"string"},expandedChartSchemes:{type:"any[]"}}},expandTreeChange:{parameters:{action:{type:"string"}}},zoomStopChange:{parameters:{index:{type:"int"},selectedItem:{type:"sap.ui.core.Item"}}},settingsChange:{parameters:{id:{type:"string"},value:{type:"boolean"}}},modeChange:{parameters:{mode:{type:"string"}}},birdEye:{parameters:{birdEyeRange:{type:"string"}}}}}});x.ToolbarItemPosition={Left:"Left",Right:"Right"};x.prototype.init=function(){this._oToolbar=new r({width:"auto",design:sap.m.ToolbarDesign.Auto});this.setAggregation("_toolbar",this._oToolbar,true);this._bClearCustomItems=true;this._resetToolbarInfo();this._oModesConfigMap={};this._oModesConfigMap[E.DEFAULT_MODE_KEY]=E.DEFAULT_MODE;this._oToolbarSchemeConfigMap={};this._oToolbarSchemeConfigMap[E.DEFAULT_CONTAINER_TOOLBAR_SCHEME_KEY]=E.DEFAULT_CONTAINER_TOOLBAR_SCHEME;this._oToolbarSchemeConfigMap[E.DEFAULT_GANTTCHART_TOOLBAR_SCHEME_KEY]=E.DEFAULT_GANTTCHART_TOOLBAR_SCHEME;this._oToolbarSchemeConfigMap[E.EMPTY_TOOLBAR_SCHEME_KEY]=E.EMPTY_TOOLBAR_SCHEME;this._oHierarchyConfigMap={};this._oHierarchyConfigMap[E.DEFAULT_HIERARCHY_KEY]=E.DEFAULT_HIERARCHY;this._oContainerLayoutConfigMap={};this._oContainerLayoutConfigMap[E.DEFAULT_CONTAINER_SINGLE_LAYOUT_KEY]=E.DEFAULT_CONTAINER_SINGLE_LAYOUT;this._oContainerLayoutConfigMap[E.DEFAULT_CONTAINER_DUAL_LAYOUT_KEY]=E.DEFAULT_CONTAINER_DUAL_LAYOUT;this._oZoomSlider=null;this._oSelect=null;this._iLiveChangeTimer=-1;this._aTimers=[];this._oRb=sap.ui.getCore().getLibraryResourceBundle("sap.gantt");this._nCounterOfDefaultSliders=0;this._sZoomControlType=E.ZoomControlType.SliderWithButtons};x.prototype._resetToolbarInfo=function(){this._oItemConfiguration={Left:[],Right:[]};this._oAllItems={Left:[],Right:[]};if(this._bClearCustomItems){this._aCustomItems=[];this._iCustomItemInsertIndex=-1}};x.prototype.applySettings=function(t,o){if(this.getSourceId()&&this.getType()){this._resetAllCompositeControls()}var i=e.prototype.applySettings.apply(this,arguments);return i};x.prototype.onAfterRendering=function(){if(this._oVHButton&&jQuery("#"+this._oVHButton.getId())[0]){jQuery("#"+this._oVHButton.getId()).attr("aria-label",this._oRb.getText("TLTP_SWITCH_GANTTCHART"))}};x.prototype.setLegend=function(t){this.setAggregation("legend",t);if(!this._oLegendPop){this._oLegendPop=new b({placement:A.Bottom,showArrow:false,showHeader:false})}if(t){this._oLegendPop.removeAllContent();this._oLegendPop.addContent(t);this._oLegendPop.setOffsetX(this._calcOffsetForLegendPopover())}};x.prototype.updateZoomLevel=function(t){this._bSuppressZoomStopChange=true;this.setZoomLevel(t)};x.prototype.setZoomLevel=function(t,e){if(t>=0){var o=this.getZoomLevel();if(o!==t){this.setProperty("zoomLevel",t,e);if(this._oZoomSlider){this._oZoomSlider.setValue(t);this._oZoomSlider.setTooltip(this._oRb.getText("TLTP_SLIDER_ZOOM_LEVEL")+":"+t);if(!this._bSuppressZoomStopChange){this.fireZoomStopChange({index:t})}}if(this._oSelect){this._oSelect.setSelectedItem(this._oSelect.getItems()[t]);if(!this._bSuppressZoomStopChange){this.fireZoomStopChange({index:t,selectedItem:this._oSelect.getSelectedItem()})}}if(this._oToolbarScheme&&!isNaN(t)&&this._oZoomInButton&&this._oZoomOutButton&&this._oToolbarScheme.getTimeZoom()){var i=this._oToolbarScheme.getTimeZoom().getStepCountOfSlider()-1,n=0;if(t===i){this._oZoomInButton.setEnabled(false);this._oZoomOutButton.setEnabled(true)}else if(t===n){this._oZoomInButton.setEnabled(true);this._oZoomOutButton.setEnabled(false)}else{this._oZoomInButton.setEnabled(true);this._oZoomOutButton.setEnabled(true)}}}}this._bSuppressZoomStopChange=false;return this};x.prototype.setMode=function(t){this.setProperty("mode",t);if(this._oModeSegmentButton){this._oModeSegmentButton.setSelectedButton(this._oModeButtonMap[t])}return this};x.prototype.setHierarchies=function(t){this.setProperty("hierarchies",t,true);this._oHierarchyConfigMap={};if(t){for(var e=0;e<t.length;e++){this._oHierarchyConfigMap[t[e].getKey()]=t[e]}}this._resetAllCompositeControls();return this};x.prototype.setContainerLayouts=function(t){this.setProperty("containerLayouts",t,true);this._oContainerLayoutConfigMap={};if(t){for(var e=0;e<t.length;e++){this._oContainerLayoutConfigMap[t[e].getKey()]=t[e]}}this._resetAllCompositeControls();return this};x.prototype.setModes=function(t){this.setProperty("modes",t,true);this._oModesConfigMap={};if(t){for(var e=0;e<t.length;e++){this._oModesConfigMap[t[e].getKey()]=t[e]}}return this};x.prototype.setToolbarDesign=function(t){this._oToolbar.setDesign(t);return this};x.prototype.setToolbarSchemes=function(t){this.setProperty("toolbarSchemes",t,true);this._oToolbarSchemeConfigMap={};if(t){for(var e=0;e<t.length;e++){this._oToolbarSchemeConfigMap[t[e].getKey()]=t[e]}}this._resetAllCompositeControls();return this};x.prototype.setSourceId=function(t){this.setProperty("sourceId",t,true);this._resetAllCompositeControls();return this};x.prototype.setType=function(t){this.setProperty("type",t,true);this._resetAllCompositeControls();return this};x.prototype.addCustomToolbarItem=function(t){if(this._iCustomItemInsertIndex==-1){this._oToolbar.insertContent(t,0);this._iCustomItemInsertIndex++}else{this._oToolbar.insertContent(t,this._iCustomItemInsertIndex+1);this._iCustomItemInsertIndex++}this._aCustomItems.push(t);this._resetAllCompositeControls();return this};x.prototype.insertCustomToolbarItem=function(t,e){var o=this._aCustomItems.length;if(e>=o){e=o}if(this._iCustomItemInsertIndex===-1){this._oToolbar.insertContent(t,0);this._aCustomItems.push(t)}else{this._oToolbar.insertContent(t,this._iCustomItemInsertIndex-this._aCustomItems.length+1+e);this._aCustomItems.splice(e,0,t)}this._iCustomItemInsertIndex++;return this};x.prototype.removeCustomToolbarItem=function(t){if(this._aCustomItems.length===0){return this._aCustomItems}if(typeof t==="number"){var e=this._aCustomItems.length;var o=t>e?e:t;this._oToolbar.removeContent(this._iCustomItemInsertIndex-e+o+1);this._iCustomItemInsertIndex--;return this._aCustomItems.splice(o,1)}else if(t){this._oToolbar.removeContent(t);this._iCustomItemInsertIndex--;return this._aCustomItems.splice(jQuery.inArray(t,this._aCustomItems),1)}};x.prototype.getCustomToolbarItems=function(){return this._aCustomItems.slice(0)};x.prototype.destroyCustomToolbarItems=function(){var t=this.removeAllCustomToolbarItems();t.forEach(function(t){t.destroy()});return t};x.prototype.removeAllCustomToolbarItems=function(){var t=[];for(var e=0;e<this._aCustomItems.length;e++){t.push(this._oToolbar.removeContent(this._aCustomItems[e]))}this._iCustomItemInsertIndex=this._iCustomItemInsertIndex-this._aCustomItems.length;this._aCustomItems.splice(0,this._aCustomItems.length);return t};x.prototype._resetAllCompositeControls=function(){this._determineToolbarSchemeConfig(this.getSourceId());this._destroyCompositeControls();if(!this._sToolbarSchemeKey){return}this._resolvePositions();var t,e,o=x.ToolbarItemPosition.Left,i=x.ToolbarItemPosition.Right;var n=this._oItemConfiguration[o];for(t=0;t<n.length;t++){if(n[t]){this._createCompositeControl(o,t,n[t])}}var s=this._oItemConfiguration[i];for(t=s.length-1;t>=0;t--){if(s[t]){this._createCompositeControl(i,t,s[t])}}var r=function(t){if(Array.isArray(t)){for(var e=0;e<t.length;e++){this._oToolbar.addContent(t[e])}}else if(t){this._oToolbar.addContent(t)}};for(t=0;t<this._oAllItems[o].length;t++){e=this._oAllItems[o][t];r.call(this,e)}if(this._oAllItems[o].length!==0||this._oAllItems[i].length!==0){this._oToolbar.addContent(new h)}for(t=0;t<this._oAllItems[i].length;t++){e=this._oAllItems[i][t];r.call(this,e)}};x.prototype.getAllToolbarItems=function(){return this._oToolbar.getContent()};x.prototype._determineToolbarSchemeConfig=function(t){this._sToolbarSchemeKey=null;if(this.getType()===L.ToolbarType.Global&&this._oContainerLayoutConfigMap[t]){this._sToolbarSchemeKey=this._oContainerLayoutConfigMap[t].getToolbarSchemeKey();this._sInitMode=this.getMode()!=E.DEFAULT_MODE_KEY?this.getMode():this._oContainerLayoutConfigMap[t].getActiveModeKey()}else if(this.getType()===L.ToolbarType.Local&&this._oHierarchyConfigMap[t]){this._sToolbarSchemeKey=this._oHierarchyConfigMap[t].getToolbarSchemeKey();this._sInitMode=this.getMode()!=E.DEFAULT_MODE_KEY?this.getMode():this._oHierarchyConfigMap[t].getActiveModeKey()}if(this._oToolbarScheme==this._oToolbarSchemeConfigMap[this._sToolbarSchemeKey]){this._bClearCustomItems=false}else{this._oToolbarScheme=this._oToolbarSchemeConfigMap[this._sToolbarSchemeKey];this._bClearCustomItems=true}if(this._oToolbarScheme&&this._oToolbarScheme.getProperty("toolbarDesign")){this.setToolbarDesign(this._oToolbarScheme.getProperty("toolbarDesign"))}};x.prototype._destroyCompositeControls=function(){this._oToolbar.getContent().forEach(function(t){if(this._aCustomItems.indexOf(t)<0){t.destroy()}},this);this._oToolbar.removeAllContent();this._resetToolbarInfo()};x.prototype._resolvePositions=function(){if(this._oToolbarScheme){jQuery.each(this._oToolbarScheme.getMetadata().getAllProperties(),function(t){if(t!=="key"&&t!=="toolbarDesign"){var e=this._oToolbarScheme.getProperty(t);if(e){var o=this._parsePosition(e.getPosition());this._oItemConfiguration[o.position][o.idx]=jQuery.extend({},{groupId:t},e)}}}.bind(this));var t=this._oItemConfiguration;var e=Object.keys(t);e.forEach(function(e){var o=t[e],i=[];var n=Object.keys(o).sort();n.forEach(function(t,e){i.push(o[t])});t[e]=i})}};x.prototype._parsePosition=function(t){return{position:t.toUpperCase().substr(0,1)==="L"?x.ToolbarItemPosition.Left:x.ToolbarItemPosition.Right,idx:parseInt(t.substr(1,t.length-1))}};x.prototype._createCompositeControl=function(t,e,o){var i;switch(o.groupId){case"sourceSelect":i=this._genSourceSelectGroup(o);break;case"birdEye":i=this._genBirdEyeGroup(o);break;case"layout":i=this._genLayoutGroup(o);break;case"expandChart":i=this._genExpandChartGroup(o);break;case"expandTree":i=this._genExpandTreeGroup(o);break;case"customToolbarItems":i=this._genCustomToolbarItemGroup(t,o);break;case"mode":i=this._genModeButtonGroup(o);break;case"timeZoom":i=this._genTimeZoomGroupControls(o);break;case"legend":i=this._genLegend(o);break;case"settings":i=this._genSettings(o);break;default:break}if(i){this._oAllItems[t]=this._oAllItems[t].concat(i)}};x.prototype._genBirdEyeGroup=function(t){var e=this;var o=new a({priority:t.getOverflowPriority()});var i=this._oRb.getText("TXT_BRIDEYE");var n=this._oRb.getText("TXT_BRIDEYE_RANGE_VISIBLE_ROWS");var s=this._oRb.getText("TXT_BRIDEYE_RANGE_ALL_ROWS");var r=this._oRb.getText("TLTP_BRIDEYE_ON_VISIBLE_ROWS");var h=this._oRb.getText("TLTP_BRIDEYE_ON_ALL_ROWS");this._oBirdEyeButton=null;if(t.getBirdEyeRange()===E.BirdEyeRange.AllRows){this._oBirdEyeButton=new g({id:this._getConfigButtonId(t),icon:"sap-icon://show",tooltip:i+"("+s+"): "+h,layoutData:o,press:function(o){e.fireBirdEye({action:"birdEye",birdEyeRange:t.getBirdEyeRange()})}})}else if(t.getBirdEyeRange()===E.BirdEyeRange.VisibleRows){this._oBirdEyeButton=new g({id:this._getConfigButtonId(t),icon:"sap-icon://show",tooltip:i+"("+n+"): "+r,layoutData:o,press:function(o){e.fireBirdEye({action:"birdEye",birdEyeRange:t.getBirdEyeRange()})}})}else{this._oBirdEyeButton=new d({width:"8rem",text:n,tooltip:i+": "+r,icon:"sap-icon://show",buttonMode:sap.m.MenuButtonMode.Split,useDefaultActionOnly:true,defaultAction:function(t){e.fireBirdEye({action:"birdEye",birdEyeRange:this._currentBirdEyeRange?this._currentBirdEyeRange:E.BirdEyeRange.VisibleRows})}});var l=new c({id:this._getConfigButtonId(t),itemSelected:function(t){var o=t.getParameter("item");var i=o.birdEyeRange;e._oBirdEyeButton.setTooltip(o.getTooltip());e._oBirdEyeButton.setText(o.getText());o.setIcon("sap-icon://show");if(!this.getParent()._currentBirdEyeRange||this.getParent()._currentBirdEyeRange!==i){this.getParent()._currentBirdEyeRange=i}e.fireBirdEye({action:"birdEye",birdEyeRange:i})}});var u=new m({text:n,tooltip:i+": "+r,press:function(t){this.setIcon()}});u.birdEyeRange=E.BirdEyeRange.VisibleRows;l.addItem(u);u=new m({text:s,tooltip:i+": "+h,press:function(t){this.setIcon()}});u.birdEyeRange=E.BirdEyeRange.AllRows;l.addItem(u);this._oBirdEyeButton.setMenu(l)}return this._oBirdEyeButton};x.prototype._genSourceSelectGroup=function(t){var e=this.getSourceId();var o=this;var i;this._oSourceSelectBox=new _({id:this._getConfigButtonId(t),layoutData:new a({priority:t.getOverflowPriority()}),width:"200px",change:function(t){var e=t.getParameter("selectedItem");var i=e.oSourceConfig;o.fireSourceChange({id:e.getKey(),config:i})}});switch(this.getType()){case L.ToolbarType.Global:i=this.getContainerLayouts();this._oSourceSelectBox.setTooltip(this._oRb.getText("TLTP_GLOBAL_HIERARCHY_RESOURCES"));break;case L.ToolbarType.Local:i=this.getHierarchies();this._oSourceSelectBox.setTooltip(this._oRb.getText("TLTP_LOCAL_HIERARCHY_RESOURCES"));break;default:return null}var n;for(var s=0;s<i.length;s++){n=new f({key:i[s].getKey(),text:i[s].getText()});n.oSourceConfig=i[s];this._oSourceSelectBox.addItem(n);if(n.getKey()===e){this._oSourceSelectBox.setSelectedItem(n)}}return this._oSourceSelectBox};x.prototype._genLayoutGroup=function(t){if(this.getType==="LOCAL"){return null}var e=this,o=this.getHierarchies(),i,n;this._oAddGanttChartSelect=new _({id:this._getConfigButtonId(t,"add"),icon:"sap-icon://add",type:sap.m.SelectType.IconOnly,autoAdjustWidth:true,maxWidth:"50px",tooltip:this._oRb.getText("TLTP_ADD_GANTTCHART"),forceSelection:false,layoutData:new a({priority:t.getOverflowPriority()}),change:function(t){if(t.getParameter("selectedItem")){var o=e.data("holder");if(o.getGanttCharts().length<o.getMaxNumOfGanttCharts()){if(!e._oLessGanttChartSelect.getEnabled()){e._oLessGanttChartSelect.setEnabled(true);if(e._oVHButton){e._oVHButton.setEnabled(true)}}if(o.getGanttCharts().length==o.getMaxNumOfGanttCharts()-1){this.setEnabled(false)}t.getSource().setSelectedItemId("");e.fireLayoutChange({id:"add",value:{hierarchyKey:t.getParameter("selectedItem").getKey(),hierarchyConfig:t.getParameter("selectedItem").data("hierarchyConfig")}})}if(o.getGanttCharts().length>o.getMaxNumOfGanttCharts()){this.setEnabled(false)}}}});if(o&&o.length>0){for(n=0;n<o.length;n++){i=new f({text:o[n].getText(),key:o[n].getKey()});i.data("hierarchyConfig",o[n]);this._oAddGanttChartSelect.addItem(i)}}var s=this._oContainerLayoutConfigMap[this.getSourceId()].getGanttChartLayouts().length>1?true:false;this._oLessGanttChartSelect=new _({id:this._getConfigButtonId(t,"less"),icon:"sap-icon://less",type:sap.m.SelectType.IconOnly,tooltip:this._oRb.getText("TLTP_REMOVE_GANTTCHART"),maxWidth:"50px",autoAdjustWidth:true,forceSelection:false,enabled:s,layoutData:new a({priority:t.getOverflowPriority()}),change:function(t){if(t.getParameter("selectedItem")){var o=e.data("holder");if(o.getGanttCharts().length<=o.getMaxNumOfGanttCharts()){if(!e._oAddGanttChartSelect.getEnabled()){e._oAddGanttChartSelect.setEnabled(true)}}e.fireLayoutChange({id:"less",value:{hierarchyKey:t.getParameter("selectedItem").getKey(),hierarchyConfig:t.getParameter("selectedItem").data("hierarchyConfig"),ganttChartIndex:t.getParameter("selectedItem").data("ganttChartIndex")}});var i=t.getSource().getSelectedItem();if(i){i.setText("")}if(o.getGanttCharts().length==1){this.setEnabled(false);if(e._oVHButton){e._oVHButton.setEnabled(false)}}}}});this._oLessGanttChartSelect.addEventDelegate({onclick:this._fillLessGanttChartSelectItem},this);var r=this._oContainerLayoutConfigMap[this.getSourceId()].getOrientation()===v.Vertical?"sap-icon://resize-vertical":"sap-icon://resize-horizontal";var h=this._oContainerLayoutConfigMap[this.getSourceId()].getOrientation()===v.Vertical?this._oRb.getText("TLTP_ARRANGE_GANTTCHART_VERTICALLY"):this._oRb.getText("TLTP_ARRANGE_GANTTCHART_HORIZONTALLY");this._oVHButton=new g({id:this._getConfigButtonId(t),icon:r,tooltip:h,type:t.getButtonType(),layoutData:new a({priority:t.getOverflowPriority()}),press:function(t){switch(this.getIcon()){case"sap-icon://resize-vertical":this.setIcon("sap-icon://resize-horizontal");this.setTooltip(e._oRb.getText("TLTP_ARRANGE_GANTTCHART_HORIZONTALLY"));e.fireLayoutChange({id:"orientation",value:v.Horizontal});break;case"sap-icon://resize-horizontal":this.setIcon("sap-icon://resize-vertical");this.setTooltip(e._oRb.getText("TLTP_ARRANGE_GANTTCHART_VERTICALLY"));e.fireLayoutChange({id:"orientation",value:v.Vertical});break;default:break}}});this._oLayoutButton=[this._oAddGanttChartSelect,this._oLessGanttChartSelect,this._oVHButton];return this._oLayoutButton};x.prototype._fillLessGanttChartSelectItem=function(){var t=this.data("holder").getGanttCharts(),e;this._oLessGanttChartSelect.removeAllItems();if(t&&t.length>0){for(var o=0;o<t.length;o++){e=new f({text:this._oHierarchyConfigMap[t[o].getHierarchyKey()].getText(),key:t[o].getHierarchyKey()});e.data("hierarchyConfig",this._oHierarchyConfigMap[t[o].getHierarchyKey()]);e.data("ganttChartIndex",o);this._oLessGanttChartSelect.insertItem(e,o)}}};x.prototype._genExpandChartGroup=function(t){this._aChartExpandButtons=[];var e=function(t){this.fireExpandChartChange({isExpand:t.getSource().data("isExpand"),expandedChartSchemes:t.getSource().data("chartSchemeKeys")})};var o=t.getExpandCharts(),n;for(var s=0;s<o.length;s++){var r=o[s];n=new g({id:this._getConfigButtonId(r),icon:r.getIcon(),tooltip:r.getTooltip(),layoutData:new a({priority:t.getOverflowPriority()}),press:e.bind(this),type:t.getButtonType(),customData:[new i({key:"isExpand",value:r.getIsExpand()}),new i({key:"chartSchemeKeys",value:r.getChartSchemeKeys()})]});if(t.getShowArrowText()){n.setText(r.getIsExpand()?"ꜜ":"ꜛ")}this._aChartExpandButtons.push(n)}return this._aChartExpandButtons};x.prototype._genCustomToolbarItemGroup=function(t,e){if(this._iCustomItemInsertIndex===-1){if(t==x.ToolbarItemPosition.Left){var o=this._oAllItems[t].length;this._iCustomItemInsertIndex=o-1}else{var o=this._oAllItems[x.ToolbarItemPosition.Left].length+1+this._oAllItems[t].length;this._iCustomItemInsertIndex=o-1}}return this._aCustomItems};x.prototype._genExpandTreeGroup=function(t){var e=this;this._oTreeGroup=[new g({id:this._getConfigButtonId(t,"expand"),icon:"sap-icon://expand",tooltip:this._oRb.getText("TLTP_EXPAND"),type:t.getButtonType(),layoutData:new a({priority:t.getOverflowPriority()}),enabled:false,press:function(t){e.fireExpandTreeChange({action:"expand"})}}),new g({id:this._getConfigButtonId(t,"collapse"),icon:"sap-icon://collapse",tooltip:this._oRb.getText("TLTP_COLLAPSE"),layoutData:new a({priority:t.getOverflowPriority()}),enabled:false,press:function(t){e.fireExpandTreeChange({action:"collapse"})}})];return this._oTreeGroup};x.prototype._genModeButtonGroup=function(t){var e=function(t){var e=t.getParameter("button");this.fireModeChange({mode:e.data("mode")})};this._oModeSegmentButton=new p({select:e.bind(this)});this._oModeButtonMap={};var o=function(e,o){if(this._oModesConfigMap[o]){var n=new g({id:this._getConfigButtonId(this._oModesConfigMap[o]),icon:this._oModesConfigMap[o].getIcon(),activeIcon:this._oModesConfigMap[o].getActiveIcon(),type:t.getButtonType(),tooltip:this._oModesConfigMap[o].getText(),layoutData:new a({priority:t.getOverflowPriority()}),customData:[new i({key:"mode",value:o})]});this._oModeButtonMap[o]=n;this._oModeSegmentButton.addButton(n)}};jQuery.each(t.getModeKeys(),o.bind(this));if(this._sInitMode){this._oModeSegmentButton.setSelectedButton(this._oModeButtonMap[this._sInitMode])}return this._oModeSegmentButton};x.prototype._getCounterOfZoomLevels=function(){if(!this._nCounterOfDefaultSliders){this._nCounterOfDefaultSliders=this._oToolbarScheme.getTimeZoom().getStepCountOfSlider()}var t=this._oToolbarScheme.getTimeZoom().getInfoOfSelectItems();if(!t||t.length===0){this._oToolbarScheme.getTimeZoom().setStepCountOfSlider(this._nCounterOfDefaultSliders);return this._nCounterOfDefaultSliders}var e=t.length;this._oToolbarScheme.getTimeZoom().setStepCountOfSlider(e);return e};x.prototype._getZoomControlType=function(){return this._sZoomControlType};x.prototype._genTimeZoomGroupControls=function(t){var e=this;var o=t.getZoomControlType(),i=[],n,s,r,h;var l=new a({priority:t.getOverflowPriority()});var u=function(t){window.clearTimeout(this._iLiveChangeTimer);this._iLiveChangeTimer=-1;this.setZoomLevel(t,true)}.bind(this);this._sZoomControlType=o;this.fireEvent("_zoomControlTypeChange",{zoomControlType:o});if(o===E.ZoomControlType.None){return i}else if(o===E.ZoomControlType.Select){var p=[],d=this._oToolbarScheme.getTimeZoom().getInfoOfSelectItems();if(d.length>0){if(d[0]instanceof f){p=d}else{for(var c=0;c<d.length;c++){var m=new f({key:d[c].key,text:d[c].text});p.push(m)}}}n=new _({id:this._getConfigButtonId(t,"select"),items:p,selectedItem:p[this.getZoomLevel()],layoutData:l,change:function(t){var o=t.getSource();var i=o.getSelectedItem();var n=o.indexOfItem(i);this._iLiveChangeTimer=window.setTimeout(u.bind(e),200,n,i)}});this._oSelect=n;i.push(n)}else{var T=this._getCounterOfZoomLevels();if(this.data("holder")&&this.data("holder").getSliderStep()){T=this.data("holder").getSliderStep()}if(o!==E.ZoomControlType.ButtonsOnly){s=new S({tooltip:this._oRb.getText("TLTP_SLIDER_ZOOM_LEVEL")+":"+this.getZoomLevel(),showHandleTooltip:true,showAdvancedTooltip:true,id:this._getConfigButtonId(t,"slider"),width:"200px",layoutData:l,max:T-1,value:this.getZoomLevel(),min:0,step:1,liveChange:function(t){var e=parseInt(t.getParameter("value"));window.clearTimeout(this._iLiveChangeTimer);this._iLiveChangeTimer=window.setTimeout(u.bind(this),200,e)}.bind(this)})}if(o!==E.ZoomControlType.SliderOnly){var y=function(t){return function(e){var o=parseInt(t?this._oZoomSlider.stepUp(1).getValue():this._oZoomSlider.stepDown(1).getValue());this._iLiveChangeTimer=window.setTimeout(u.bind(this),200,o)}};r=new sap.m.Button({id:this._getConfigButtonId(t,"zoomIn"),icon:"sap-icon://zoom-in",type:t.getButtonType(),tooltip:this._oRb.getText("TLTP_SLIDER_ZOOM_IN"),layoutData:l.clone(),press:y(true).bind(this)});h=new g({id:this._getConfigButtonId(t,"zoomOut"),icon:"sap-icon://zoom-out",type:t.getButtonType(),tooltip:this._oRb.getText("TLTP_SLIDER_ZOOM_OUT"),layoutData:l.clone(),press:y(false).bind(this)})}if(h){i.push(h);this._oZoomOutButton=h}if(s){i.push(s);this._oZoomSlider=s}if(r){i.push(r);this._oZoomInButton=r}}return i};x.prototype._genLegend=function(t){if(!this._oLegendPop){this._oLegendPop=new b({placement:A.Bottom,showArrow:false,showHeader:false})}if(this.getLegend()){this._oLegendPop.removeAllContent();this._oLegendPop.addContent(this.getLegend())}this._oLegendButton=new g({id:this._getConfigButtonId(t),icon:"sap-icon://legend",type:t.getButtonType(),tooltip:this._oRb.getText("TLTP_SHOW_LEGEND"),layoutData:new a({priority:t.getOverflowPriority(),closeOverflowOnInteraction:false}),press:function(t){this._oLegendPop.setOffsetX(this._calcOffsetForLegendPopover());var e=this._oLegendPop;if(e.isOpen()){e.close()}else{e.openBy(this._oLegendButton)}}.bind(this)});return this._oLegendButton};x.prototype._genSettings=function(t){var e=t.getItems()||[];var o=e.map(function(t){return new C({name:t.getKey(),text:t.getDisplayText(),tooltip:t.getTooltip(),selected:t.getChecked()}).addStyleClass("sapUiSettingBoxItem")});this._oInitialSettingState={};o.forEach(function(t){this._oInitialSettingState[t.getName()]=t.getSelected()}.bind(this));this._oLastConfirmedSettingState=Object.assign({},this._oInitialSettingState);var i=function(t,e){var o;for(var i=0;i<t.length;i++){o=t[i].getName();t[i].setSelected(e[o])}};this._oSettingsBox=new l({direction:B.Column,items:o}).addStyleClass("sapUiSettingBox");this._oSettingsDialog=new T({title:this._oRb.getText("SETTINGS_DIALOG_TITLE"),customTabs:[new y({content:this._oSettingsBox})],confirm:function(){var t=this._oSettingsBox.getItems();var e=[];for(var o=0;o<t.length;o++){e.push({id:t[o].getName(),value:t[o].getSelected()});this._oLastConfirmedSettingState[t[o].getName()]=t[o].getSelected()}this.fireSettingsChange(e)}.bind(this),cancel:function(){i(o,this._oLastConfirmedSettingState)}.bind(this),reset:function(){i(o,this._oInitialSettingState)}.bind(this)});this._oSettingsButton=new g({id:this._getConfigButtonId(t),icon:"sap-icon://action-settings",type:t.getButtonType(),tooltip:this._oRb.getText("TXT_SETTING_BUTTON"),layoutData:new a({priority:t.getOverflowPriority()}),press:function(t){this._oSettingsDialog.open()}.bind(this)});return this._oSettingsButton};x.prototype.toggleExpandTreeButton=function(t){if(this._oTreeGroup&&this._oTreeGroup.length>0){this._oTreeGroup.forEach(function(e){e.setEnabled(t)})}};x.prototype.getToolbarSchemeKey=function(){return this._sToolbarSchemeKey};x.prototype.setEnableNowLine=function(t){this.setProperty("enableNowLine",t,true);if(this._oSettingsBox&&this._oSettingsBox.getItems().length>0){this._setSettingItemProperties(E.SETTING_ITEM_ENABLE_NOW_LINE_KEY,t)}return this};x.prototype.setEnableCursorLine=function(t){this.setProperty("enableCursorLine",t,true);if(this._oSettingsBox&&this._oSettingsBox.getItems().length>0){this._setSettingItemProperties(E.SETTING_ITEM_ENABLE_CURSOR_LINE_KEY,t)}return this};x.prototype.setEnableVerticalLine=function(t){this.setProperty("enableVerticalLine",t,true);if(this._oSettingsBox&&this._oSettingsBox.getItems().length>0){this._setSettingItemProperties(E.SETTING_ITEM_ENABLE_VERTICAL_LINE_KEY,t)}return this};x.prototype.setEnableAdhocLine=function(t){this.setProperty("enableAdhocLine",t,true);if(this._oSettingsBox&&this._oSettingsBox.getItems().length>0){this._setSettingItemProperties(E.SETTING_ITEM_ENABLE_ADHOC_LINE_KEY,t)}return this};x.prototype.setEnableTimeScrollSync=function(t){this.setProperty("enableTimeScrollSync",t,true);if(this._oSettingsBox&&this._oSettingsBox.getItems().length>0){this._setSettingItemProperties(E.SETTING_ITEM_ENABLE_TIME_SCROLL_SYNC_KEY,t)}return this};x.prototype._setSettingItemProperties=function(t,e){var o=this._oSettingsBox.getItems();for(var i=0;i<o.length;i++){if(o[i].getName()===t){o[i].setSelected(e);this._oLastConfirmedSettingState[t]=e;break}}};x.prototype.exit=function(){if(this._oLegendPop){this._oLegendPop.destroy(false)}if(this._oSettingsPop){this._oSettingsPop.destroy(false)}};x.prototype._calcOffsetForLegendPopover=function(){var t=0,e=65;var i=1;var n=1;var r=window.devicePixelRatio||1;r=Math.round(r*100)/100;if(s.browser.name==="ie"){n=Math.round(screen.deviceXDPI/screen.logicalXDPI*100)/100}else if(s.browser.name==="cr"){n=Math.round(window.outerWidth/window.innerWidth*100)/100}else{n=r}if(n!==1){if(n<1||(n-1)%1===0){e+=e*(n-1)*.1}else{e=85}r=Math.round(r*10)/10;if(n<1){i=r+Math.floor((1-n)*10)/10}else if(n<=1.1){i=Math.round(n*10)/10*r}else{i=r-Math.floor((n-1.1)*10)/10}}if(o.getConfiguration().getRTL()===true){t=140}else{var a=this._oLegendPop.getContent();if(a&&a.length>0){var h=sap.ui.getCore().byId(a[0].getContent());t=Math.round((e-parseInt(h.getWidth()))*i)}}return t};x.prototype.getZoomLevels=function(){if(this._oToolbarScheme){var t=this._oToolbarScheme.getTimeZoom();if(t){switch(t.getZoomControlType()){case E.ZoomControlType.Select:return t.getTextsOfSelect()||0;case E.ZoomControlType.None:return-1;default:return t.getStepCountOfSlider()}}}return-1};x.prototype._getConfigButtonId=function(t,e){var o=null;if(n.isGeneratedId(t.getId())){return o}var i=this.getParent();if(i){i=this.getType()==="LOCAL"?i.getParent():i;if(i){o=i.getId()+"-"+t.getId();o=e?o+"-"+e:o}}return o};return x},true);
//# sourceMappingURL=Toolbar.js.map