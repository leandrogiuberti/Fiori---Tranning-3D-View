/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

		(c) Copyright 2009-2015 SAP SE. All rights reserved
	
 */
sap.ui.define(["sap/ui/core/Control","./LegendBase","sap/gantt/drawer/Legend","sap/ui/Device"],function(e,t,i,n){"use strict";var a=t.extend("sap.gantt.legend.DimensionLegend",{metadata:{library:"sap.gantt",properties:{shape:{type:"sap.gantt.config.Shape"},xDimension:{type:"string"},yDimension:{type:"string"},xDomain:{type:"any[]",defaultValue:[]},yDomain:{type:"any[]",defaultValue:[]},exclude:{type:"any[][]",defaultValue:[]},legendSpace:{type:"float",defaultValue:8}}}});a.prototype.init=function(){t.prototype.init.apply(this,arguments);this._oDimensionLegendDrawer=new i};a.prototype.applySettings=function(){var t=e.prototype.applySettings.apply(this,arguments);this._modifyDimensionFunction();return t};a.prototype._modifyDimensionFunction=function(){var e=this.getXDimension(),t=this.getYDimension();this._oShapeInstance._oLegend=this;this._oShapeInstance._sXDimension=e;this._oShapeInstance._sYDimension=t;this._oShapeInstance["get"+this._capitalFirst(e)]=function(e){if(this.mShapeConfig.hasShapeProperty(this._sXDimension)){return this._configFirst(this._sXDimension,e)}if(e.xIndex===-1){return sap.gantt.DIMENSION_LEGEND_NIL}return this._oLegend.getXDomain()[e.xIndex]};this._oShapeInstance["get"+this._capitalFirst(t)]=function(e){if(this.mShapeConfig.hasShapeProperty(this._sYDimension)){return this._configFirst(this._sYDimension,e)}if(e.yIndex===-1){return sap.gantt.DIMENSION_LEGEND_NIL}return this._oLegend.getYDomain()[e.yIndex]}};a.prototype._capitalFirst=function(e){return e.charAt(0).toUpperCase()+(e.length>1?e.slice(1):"")};a.prototype.onAfterRendering=function(){if(this._oShapeInstance){var e=this.getParent().$();var t={width:e.width(),height:e.height()};var i=d3.select("#"+this.getId()+"-svg");var n=this._drawDimensionLegend(i,this._oShapeInstance);i.attr("width",n.width+"px");i.attr("height",n.height+"px");var a=d3.select("#"+this.getId()+"-dimension-path");var s=this._drawDimensionPath(a,this._oShapeInstance);a.attr("width",n.width+"px");a.attr("height",s.height+"px");a.style("top",n.height+"px");var r=d3.select("#"+this.getId()+"-dimension-text");this._drawDimensionText(r,this._oShapeInstance,t,n);r.style(sap.ui.getCore().getConfiguration().getRTL()?"right":"left",n.width+"px");r.attr("width",t.width-n.width-5+"px");r.attr("height",n.height+s.height+this.getLegendSpace()*2+"px");d3.select("#"+this.getId()).style("height",n.height+s.height+this.getLegendSpace()*2+"px")}};a.prototype.setShape=function(e){var t=this;this.setProperty("shape",e);if(e){try{t._oShapeInstance=t._instantShapeSync([e])[0]}catch(i){t._instantShapeAsync([e]).then(function(e){t._oShapeInstance=e[0]})}}return this};a.prototype._drawDimensionLegend=function(e,t){var i=this.getXDomain();var n=this._prepareData(t);var a=e.selectAll("."+t.getId()+"-row").data(n);a.enter().append("g").classed(t.getId()+"-row",true);a.exit().remove();if(!a.empty()){this._oDimensionLegendDrawer._recursiveDraw(a,t)}var s={};var r=i.length;if(r>0){s.width=this.getScaledLegendWidth()*r+this.getLegendSpace()*(r+1);s.height=this.getScaledLegendHeight()*n.length+this.getLegendSpace()*(n.length+1)}return s};a.prototype._prepareData=function(e){var t=[],i=this.getXDimension(),n=this.getYDimension(),a=this.getXDomain(),s=this.getYDomain(),r=this.getExclude();this.aXDimension=[];this.aYDimension=[];var h=this,o;jQuery.each(a,function(t,i){o={};o.xIndex=t;o.yIndex=-1;h.aXDimension.push(e.getLegend(o))});this.aReversedXDimension=jQuery.extend(true,[],this.aXDimension);this.aReversedXDimension.reverse();jQuery.each(s,function(t,i){o={};o.xIndex=-1;o.yIndex=t;h.aYDimension.push(e.getLegend(o))});jQuery.each(s,function(e,s){var o=[];jQuery.each(a,function(t,a){var g=false;jQuery.each(r,function(e,t){if(a==t[0]&&s==t[1]){g=true;return false}});if(!g){var p={};p.xIndex=t;p.yIndex=e;p[i]=a;p[n]=s;p.xName=h.aXDimension[t];p.yName=h.aYDimension[e];o.push(p)}});if(o.length>0){t.push(o)}});return t};a.prototype._drawDimensionPath=function(e,t){var i=this.getXDomain(),n=i.length,a=this;var s=e.selectAll(".dimension-path").data(i);s.enter().append("path").attr("d",function(e,t){var i=a.getScaledLegendWidth();var s=a.getScaledLegendHeight();var r=0,h=h=s*(n-1-t)+a.getLegendSpace()*(n-t),o=i*(n-1-t)+a.getLegendSpace()*(n-t);if(sap.ui.getCore().getConfiguration().getRTL()){r=i*(n-1-t)+a.getLegendSpace()*(n-t)+i/2;o=-o}else{r=i*t+a.getLegendSpace()*(t+1)+i/2}return"M"+r+" 0 v"+h+" h"+o}).attr("fill","none");s.exit().remove();var r={};r.height=0;if(n>0){r.height=this.getScaledLegendHeight()*n+this.getLegendSpace()*(n-1)}return r};a.prototype._drawDimensionText=function(e,t,i,a){var s=this.aYDimension.concat(this.aReversedXDimension);var r=this.aYDimension.length;var h=this;var o=i.width-a.width-5;var g=e.selectAll(".dimension-text").data(s);g.enter().append("text").attr("x",function(e){if(sap.ui.getCore().getConfiguration().getRTL()){return o}return 0}).attr("y",function(e,t){return h.getScaledLegendHeight()*t+h.getLegendSpace()*(t+1)+parseInt(h.getFontSize())/2+h.getScaledLegendHeight()/2-2}).text(function(e){return e}).attr("font-size",h.getFontSize()+"px").attr("font-style",function(e,t){return t<r?"normal":"italic"}).attr("text-anchor",n.browser.name==="ie"&&sap.ui.getCore().getConfiguration().getRTL()?"end":"start");g.select("title").remove();g.insert("title",":first-child").text(function(e){return e});g.exit().remove()};return a},true);
//# sourceMappingURL=DimensionLegend.js.map