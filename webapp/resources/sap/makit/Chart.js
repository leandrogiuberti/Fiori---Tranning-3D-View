/*!
 * SAPUI5
 * (c) Copyright 2025 SAP SE. All rights reserved.
 */
sap.ui.define(["./library","./MakitLib","./CategoryAxis","./ValueAxis","./ValueBubble","./Row","./ChartRenderer","sap/ui/core/Control","sap/ui/core/Element","sap/ui/core/RenderManager","sap/ui/core/ResizeHandler","sap/ui/thirdparty/jquery","sap/base/Log","sap/base/assert"],function(e,t,a,i,r,s,o,n,h,l,g,jQuery,p,u){"use strict";var d=e.LegendPosition;var f=e.ChartType;var m=n.extend("sap.makit.Chart",{metadata:{deprecated:true,library:"sap.makit",properties:{width:{type:"sap.ui.core.CSSSize",group:"Dimension",defaultValue:"100%"},height:{type:"sap.ui.core.CSSSize",group:"Dimension",defaultValue:"100%"},type:{type:"sap.makit.ChartType",group:"Appearance",defaultValue:f.Column},showRangeSelector:{type:"boolean",group:"Appearance",defaultValue:true},showTableView:{type:"boolean",group:"Misc",defaultValue:false},legendPosition:{type:"sap.makit.LegendPosition",group:"Misc",defaultValue:null},lineThickness:{type:"float",group:"Misc",defaultValue:1},showTableValue:{type:"boolean",group:"Misc",defaultValue:true},maxSliceCount:{type:"int",group:"Misc",defaultValue:12},primaryColorPalette:{type:"any",group:"Misc",defaultValue:null},showTotalValue:{type:"boolean",group:"Misc",defaultValue:false},numberOfVisibleCategories:{type:"int",group:"Misc",defaultValue:null},rangeSelectorStartPosition:{type:"int",group:"Misc",defaultValue:0}},aggregations:{rows:{type:"sap.makit.Row",multiple:true,singularName:"row",bindable:"bindable",deprecated:true},columns:{type:"sap.makit.Column",multiple:true,singularName:"column",bindable:"bindable",deprecated:true},series:{type:"sap.makit.Series",multiple:false,deprecated:true},values:{type:"sap.makit.Value",multiple:true,singularName:"value",deprecated:true},categoryRegions:{type:"sap.makit.Category",multiple:true,singularName:"categoryRegion",deprecated:true},category:{type:"sap.makit.Category",multiple:false,deprecated:true},categoryAxis:{type:"sap.makit.CategoryAxis",multiple:false,deprecated:true},valueAxis:{type:"sap.makit.ValueAxis",multiple:false,deprecated:true},valueBubble:{type:"sap.makit.ValueBubble",multiple:false,deprecated:true}},events:{doubletap:{},tap:{},longpress:{}}}});m.prototype.init=function(){this._makitChart=null;this._parentCurrentHeight=0;this._selectedCatIdx=0;this._chartTypeDefined=false;this._legendPosDefined=false;this._createRowsCalled=false;this._datarows=[];this._styleClasses=[];this.setCategoryAxis(new a);this.setValueAxis(new i);this.setValueBubble(new r);this.setPrimaryColorPalette(null);if(this.getType()===f.Pie||this.getType()===f.Donut){this.setLegendPosition(d.Left)}else{this.setLegendPosition(d.None)}this.attachEvent("_change",this._onPropertyChanged);sap.ui.getCore().attachThemeChanged(this._applyCSS,this)};m.prototype.onBeforeRendering=function(e){this.fireEvent("_beforeRendering",this);if(this.getDomRef()&&!l.isPreservedContent(this.getDomRef())){l.preserveContent(this.getDomRef(),true,false)}};m.prototype.onAfterRendering=function(e){this.fireEvent("_afterRendering",this);var t=jQuery(document.getElementById("sap-ui-dummy-"+this.getId()));var a=l.findPreservedContent(this.getId());var i=null;if(a.length==0){this.fireEvent("_createMAKitObject",this);this._createChartObject();i=new jQuery(this.getDomRef());t.replaceWith(i);var r=document.getElementById(this.getParent().getId());this._parentCurrentHeight=r.offsetHeight;g.register(r,jQuery.proxy(this._onResize,this))}else if(a.length>0){this.fireEvent("_restoreMAKitObject",this);t.replaceWith(a)}else{t.remove()}if(i){this._makitChart.showRangeSelectorView(this.getShowRangeSelector());this._makitChart.showTableView(this.getShowTableView());this._makitChart.setGraphLineWidth(this.getLineThickness());this._makitChart.showTableValue(this.getShowTableValue());this._makitChart.setMaxPies(this.getMaxSliceCount());this._makitChart.setPalette(this.getPrimaryColorPalette());this._makitChart.setProperty("ShowTotal",this.getShowTotalValue());this._makitChart.setNumberOfVisibleCategories(this.getNumberOfVisibleCategories());this._makitChart.setRangeSelectorStartPosition(this.getRangeSelectorStartPosition())}this._setDataTable()};m.prototype.addStyleClass=function(e,t){if(this._styleClasses.indexOf(e)===-1){this._styleClasses.push(e)}if(this._makitChart){n.prototype.addStyleClass.call(this,e,t)}return this};m.prototype.removeStyleClass=function(e,t){var a=this._styleClasses.indexOf(e);if(a>-1){this._styleClasses.splice(a,1)}if(this._makitChart){n.prototype.removeStyleClass.call(this,e,t)}return this};m.prototype.bindAggregation=function(e,t){if(e==="rows"){if(typeof t=="string"){t={path:arguments[1],template:arguments[2],sorter:arguments[3],filters:arguments[4]}}t.template=undefined;t.factory=function(){};return h.prototype.bindAggregation.call(this,e,t)}return h.prototype.bindAggregation.apply(this,arguments)};m.prototype.addRow=function(e){p.error('The control manages the rows aggregation. The method "addRow" cannot be used programmatically!')};m.prototype.insertRow=function(e,t){p.error('The control manages the rows aggregation. The method "insertRow" cannot be used programmatically!')};m.prototype.removeRow=function(e){p.error('The control manages the rows aggregation. The method "removeRow" cannot be used programmatically!')};m.prototype.removeAllRows=function(){p.error('The control manages the rows aggregation. The method "removeAllRows" cannot be used programmatically!')};m.prototype.destroyRows=function(e){p.error('The control manages the rows aggregation. The method "destroyRows" cannot be used programmatically!')};m.prototype.updateRows=function(){this.fireEvent("_startUpdateRows",this);this._createRows();this._createRowsCalled=true;if(this._makitChart){this._setDataTable()}this.fireEvent("_endUpdateRows",this)};m.prototype.setValueBubble=function(e){if(e instanceof r){h.prototype.setAggregation.call(this,"valueBubble",e,false);e.attachEvent("_change",this._onValueBubbleChanged,this);if(this._makitChart){var t=e.toObject();this._makitChart.setValueBubbleStyle(t);if(this._makitChart.isValueBubbleVisible()!=t.visible){this._makitChart.showValueBubble(t.visible)}}}else{throw new Error("valueBubble property must be of type sap.makit.ValueBubble")}return this};m.prototype.setCategory=function(e){var t=this.getCategoryRegions();if(t.length>0){this.removeCategoryRegion(0)}this.insertCategoryRegion(e,0);return this};m.prototype.getCategory=function(e){var t=this.getCategoryRegions();return t[0]};m.prototype.destroyCategory=function(){this.removeCategoryRegion(0);return this};m.prototype.addCategoryRegion=function(e){h.prototype.addAggregation.call(this,"categoryRegions",e,false);e.attachEvent("_change",{type:"categories"},this._onDataRegionPropChanged,this);return this};m.prototype.insertCategoryRegion=function(e,t){h.prototype.insertAggregation.call(this,"categoryRegions",e,t,false);e.attachEvent("_change",{type:"categories"},this._onDataRegionPropChanged,this);return this};m.prototype.removeCategoryRegion=function(e){var t=h.prototype.removeAggregation.call(this,"categoryRegions",e,false);if(t!=null){e.detachEvent("_change",this._onDataRegionPropChanged,this)}return t};m.prototype.removeAllCategoryRegions=function(){var e=h.prototype.removeAllAggregation.call(this,"categoryRegions",false);var t=e.length;var a;for(a=0;a<t;a++){e[a].detachEvent("_change",this._onDataRegionPropChanged,this)}return e};m.prototype.addValue=function(e){h.prototype.addAggregation.call(this,"values",e,false);e.attachEvent("_change",{type:"values"},this._onDataRegionPropChanged,this);return this};m.prototype.insertValue=function(e,t){h.prototype.insertAggregation.call(this,"values",e,t,false);e.attachEvent("_change",{type:"values"},this._onDataRegionPropChanged,this);return this};m.prototype.removeValue=function(e){var t=h.prototype.removeAggregation.call(this,"values",e,false);if(t!=null){t.detachEvent("_change",this._onDataRegionPropChanged,this)}return t};m.prototype.removeAllValues=function(){var e=h.prototype.removeAllAggregation.call(this,"values",false);var t=e.length;var a;for(a=0;a<t;a++){e[a].detachEvent("_change",this._onDataRegionPropChanged,this)}return e};m.prototype.setSeries=function(e){h.prototype.setAggregation.call(this,"series",e,false);e.attachEvent("_change",{type:"series"},this._onDataRegionPropChanged,this);return this};m.prototype.setValueAxis=function(e){if(e instanceof i){h.prototype.setAggregation.call(this,"valueAxis",e,false);e.attachEvent("_change",{axis:"values"},this._onAxisPropChanged,this)}else{throw new Error("valueAxis property must be of type sap.makit.ValueAxis")}return this};m.prototype.setCategoryAxis=function(e){if(e instanceof a){h.prototype.setAggregation.call(this,"categoryAxis",e,false);e.attachEvent("_change",{axis:"category"},this._onAxisPropChanged,this)}else{throw new Error("categoryAxis property must be of type sap.makit.CategoryAxis")}return this};m.prototype.setPrimaryColorPalette=function(e){if(e==null||e instanceof Array&&e.length>0){h.prototype.setProperty.call(this,"primaryColorPalette",e,false);if(this._makitChart){this._makitChart.setPalette(e)}}else{throw new Error("primaryColorPalette property must be an array")}return this};m.prototype._setRealHeight=function(e){var t=this.getDomRef();var a=t.style.height;var i="0px";if(e.indexOf("%")>-1){var r=document.getElementById(this.getParent().getId());var s=parseInt(e);var o=Math.ceil(r.offsetHeight*(s/100));i=o+"px"}else{i=e}if(a!=i){t.style.height=i}};m.prototype._createRows=function(){this.fireEvent("_startCreateRows",this);var e=new s(this.getId()+"-dummyrows");var t=this.getColumns();for(var a=0,i=t.length;a<i;a++){var r=t[a];if(r){var o=r.clone("col"+a);o.detachEvent("_change",this._onColumnPropChanged,this);for(var n in r.mProperties){if(r.mProperties.hasOwnProperty(n)){o.setProperty(n,r.getProperty(n),false)}}o.data("sap-ui-colindex",a);e.addAggregation("cells",o);o.unbindAggregation("name",true)}}this.fireEvent("_endColumn",this);this.destroyAggregation("rows");this.fireEvent("_endDestroyRows",this);var h=undefined;var l=this.getBinding("rows");if(l){h=l.getContexts()}var g=l.getLength();this._datarows=[];var p=this.getBindingInfo("rows");var u=undefined;if(p&&p.model){u=p.model}this.fireEvent("_endPrepareRows",this);for(var a=0;a<g;a++){if(h&&h[a]){var o=e.clone("row"+a);o.setBindingContext(h[a],u);this.addAggregation("rows",o);this._datarows.push(o._datarow)}}this.fireEvent("_endCreateRows",this);e.destroy()};m.prototype._createChartObject=function(){var e=this.getDomRef();u(e,"Chart's DomRef is not ready");e.style.width=this.getWidth();this._setRealHeight(this.getHeight());this._makitChart=new window.$MA.Chart(this.getId(),true);var t=this;this._makitChart.bind("initialized",function(){t._makitChart.showToolBar(false);t._setMakitChartProperties()});this._makitChart.bind("beforerender",function(){t.fireEvent("_makitBeforeRender",t)});this._makitChart.bind("renderstart",function(){t.fireEvent("_makitRenderStart",t)});this._makitChart.bind("renderend",function(){t.fireEvent("_makitRenderEnd",t)});this._makitChart.bind("animationend",function(){t.fireEvent("_makitAnimationEnd",t)});var a=this._getChartSyntax();this._makitChart.create(a);this._makitChart.bind("tap",function(e){t._selectedCatIdx=t._makitChart.getSelectedCategoryIndex();t.fireTap(e)});this._makitChart.bind("doubletap",function(e){t.fireEvent("doubletap",e)});this._makitChart.bind("longpress",function(e){t._selectedCatIdx=t._makitChart.getSelectedCategoryIndex();t.fireEvent("longpress",e)});var i=this._styleClasses.length;for(var r=0;r<i;r++){this.addStyleClass(this._styleClasses[r])}this._applyCSS()};m.prototype._setMakitChartProperties=function(){if(!this._makitChart){return}this._makitChart.setLegend(this.getLegendPosition().toLowerCase());if(this._dataInitialized){this._makitChart.showTableView(this.getShowTableView());this._makitChart.showRangeSelectorView(this.getShowRangeSelector());this._makitChart.setGraphLineWidth(this.getLineThickness());this._makitChart.showTableValue(this.getShowTableValue());this._makitChart.setPalette(this.getPrimaryColorPalette());this._makitChart.setProperty("ShowTotal",this.getShowTotalValue());this._makitChart.setNumberOfVisibleCategories(this.getNumberOfVisibleCategories());this._makitChart.setRangeSelectorStartPosition(this.getRangeSelectorStartPosition())}var e=this.getValueBubble();if(e){var t=e.toObject();this._makitChart.setValueBubbleStyle(t);if(this._makitChart.isValueBubbleVisible()!=t.visible){this._makitChart.showValueBubble(t.visible)}}};m.prototype.addColumn=function(e){h.prototype.addAggregation.call(this,"columns",e,false);e.attachEvent("_change",{type:"columns"},this._onColumnPropChanged,this);return this};m.prototype._getChartSyntax=function(){var e=this.getCategoryAxis();var t=this.getCategoryRegions();var a=t.length;if(a>0){var i;var r="<Categories";if(e){if(e.getDisplayAll()){r+=' display ="'+e.getDisplayAll()+'"'}}r+=">";var s="";for(i=a-1;i>=0;i--){var o=t[i].getDisplayName();if(o&&o.length>0){s+=o+" | "}}s=s.substr(0,s.length-3);for(i=0;i<a;i++){var n=t[i];r+='<Category column ="'+n.getColumn()+'"';if(n.getFormat()){r+=' format ="'+n.getFormat()+'"'}if(i==0){r+=' displayname ="'+s+'"'}if(e){r+=' showprimaryline ="'+e.getShowPrimaryLine()+'"';r+=' showgrid ="'+e.getShowGrid()+'"';r+=' showlabel ="'+e.getShowLabel()+'"';r+=' thickness ="'+e.getThickness()+'"';r+=' color ="'+e.getColor()+'"';r+=' sortorder ="'+e.getSortOrder().toLowerCase()+'"';r+=' displaylastlabel ="'+e.getDisplayLastLabel()+'"'}r+=" />"}r+="</Categories>"}else{throw new Error("Chart '"+this.getId()+"' needs at least one Category data region")}var h=this.getSeries();var l="";if(h){l='<Series Column ="'+h.getColumn()+'"';if(h.getFormat()){l+=' format ="'+h.getFormat()+'"'}if(h.getDisplayName()){l+=' displayname ="'+h.getDisplayName()+'"'}l+="/>"}var g=this.getValueAxis();var p="<Values>";if(g){p="<Values";p+=' showprimaryline ="'+g.getShowPrimaryLine()+'"';p+=' showgrid ="'+g.getShowGrid()+'"';p+=' showlabel ="'+g.getShowLabel()+'"';p+=' thickness ="'+g.getThickness()+'"';p+=' color ="'+g.getColor()+'"';if(g.getMin()!==""){p+=' min ="'+g.getMin()+'"'}if(g.getMax()!==""){p+=' max ="'+g.getMax()+'"'}p+=">"}var u=this.getValues();var d=u.length;if(d==0){throw new Error("Chart '"+this.getId()+"' needs at least one Value data region")}var f;for(var i=0;i<d;i++){f=u[i];p+='<Value Expression ="'+f.getExpression()+'"';if(f.getFormat()){p+=' format ="'+f.getFormat()+'"'}if(f.getDisplayName()){p+=' displayname ="'+f.getDisplayName()+'"'}if(f.getLocale()!==""){p+=' Locale ="'+f.getLocale()+'"'}p+="/>"}p+="</Values>";var m=this.getType().toLowerCase();var y=null;if(m==="donut"||m==="pie"){y=m;m="pie"}var c='<Chart ChartType ="'+m+'"';if(y!==null){c+=' PieStyle ="'+y+'"'}c+=" >";c+=r;if(h){c+=l}c+=p;c+="</Chart>";return c};m.prototype._setDataTable=function(){this._setDataTableTimer=this._setDataTableTimer||setTimeout(function(){u(this._makitChart,"_makitChart is not initialized");if(this._datarows&&this._datarows.length>0){this.fireEvent("_createDataTable",this);var e=this._datarows;var t=new window.$MA.DataTable;var a=this.getColumns();var i=a.length;if(i==0){a=this.getRows()[0].getCells();i=a.length}for(var r=0;r<i;r++){t.addColumn(a[r].getName(),a[r].getType())}t.addRows(e);this.fireEvent("_beforeSetDataTable",this);this._makitChart.setDataTable(t);this._dataInitialized=true}this._setDataTableTimer=undefined}.bind(this),150)};m.prototype._applyCSS=function(e){if(this._makitChart){this._makitChart.applyCSS()}};m.prototype._onResize=function(e){var t=document.getElementById(this.getParent().getId());var a=t.offsetHeight;var i=t.offsetWidth;if(this._parentCurrentHeight!=a&&a>0||a<5){this._setRealHeight(this.getHeight());this._parentCurrentHeight=t.offsetHeight}if(this._makitChart!=null&&a>0&&i>0){this._makitChart.refresh()}};m.prototype._onPropertyChanged=function(e){var t=e.mParameters["name"];var a=e.mParameters["newValue"];if(t==="type"&&!this._chartTypeDefined){this._chartTypeDefined=true;if(!this._legendPosDefined){if(a===f.Pie||a===f.Donut){this.setLegendPosition(d.Left)}else{this.setLegendPosition(d.None)}}}else if(t==="legendPosition"&&!this._legendPosDefined){this._legendPosDefined=true}if(this._makitChart){if(t==="type"){var i=a.toLowerCase();var r=null;this._makitChart.setProperty("ChartType",i);if(i==="donut"||i==="pie"){r=i;i="pie";this._makitChart.setProperty("PieStyle",r)}}else if(t==="showRangeSelector"){this._makitChart.showRangeSelectorView(a)}else if(t==="showTableView"){this._makitChart.showTableView(a)}else if(t==="legendPosition"){this._makitChart.setLegend(a.toLowerCase())}else if(t==="width"){this.getDomRef().style.width=this.getWidth()}else if(t==="height"){this._setRealHeight(a)}else if(t==="lineThickness"){this._makitChart.setGraphLineWidth(a)}else if(t==="maxSliceCount"){this._makitChart.setMaxPies(a)}else if(t==="showTableValue"){this._makitChart.showTableValue(a)}else if(t==="primaryColorPalette"){this._makitChart.setPalette(a)}else if(t==="showTotalValue"){this._makitChart.setProperty("ShowTotal",a)}else if(t==="numberOfVisibleCategories"){this._makitChart.setNumberOfVisibleCategories(a)}else if(t==="rangeSelectorStartPosition"){this._makitChart.setRangeSelectorStartPosition(a)}this._makitChart.setSelectedCategoryIndex(this._selectedCatIdx);this._makitChart.refresh()}};m.prototype._onColumnPropChanged=function(e,t){var a=e.mParameters;if(a["name"]=="name"&&this._createRowsCalled){p.info("Column name property is changed due to name has been binded");this._createRows()}};m.prototype._onDataRegionPropChanged=function(e,t){u(t,"oData is expected to be set in _onDataRegionPropChanged");if(!this._makitChart){return}var a=e.mParameters;if(t["type"]=="values"){var i=e.oSource;var r=this.indexOfValue(i);if(r>-1){this._makitChart.setProperty(t["type"]+"["+r+"]."+a["name"],a["newValue"])}}else if(t["type"]=="categories"){var s=e.oSource;var r=this.indexOfCategoryRegion(s);var o=a["name"];if(r>-1){if(o=="displayName"){var n=this.getCategoryRegions();var h,l="",g=n.length;for(h=0;h<g;h++){l+=n[h].getDisplayName();if(h!=g-1){l+=" | "}}this._makitChart.setProperty("category."+o,a["newValue"])}else{this._makitChart.setProperty(t["type"]+"["+r+"]."+o,a["newValue"])}}}else{this._makitChart.setProperty(t["type"]+"."+a["name"],a["newValue"])}};m.prototype._onAxisPropChanged=function(e,t){u(t,"oData is expected to be set in _onAxisPropChanged");if(!this._makitChart){return}var a=e.mParameters;var i=a["name"].toLowerCase();var r=a["newValue"];var s=t["axis"];if(i==="sortorder"){r=r.toLowerCase()}else if(i==="displayall"){s="categories";i="display";if(!r){r=""}}this._makitChart.setProperty(s+"."+i,r);if(i==="sortorder"){this._setDataTable()}};m.prototype._onValueBubbleChanged=function(e){if(!this._makitChart){return}var t=this.getValueBubble().toObject();this._makitChart.setValueBubbleStyle(t);if(this._makitChart.isValueBubbleVisible()!=t.visible){this._makitChart.showValueBubble(t.visible)}this._makitChart.refresh()};m.prototype.getSelectedCategory=function(){var e=undefined;if(this._makitChart){e=this._makitChart.getSelectedCategory()}return e};m.prototype.getSelectedSeries=function(){var e=undefined;if(this._makitChart){e=this._makitChart.getSelectedSeries()}return e};m.prototype.getNumberOfCategories=function(){var e=undefined;if(this._makitChart){e=this._makitChart.getNumberOfCategories()}return e};m.prototype.getSelectedCategoryGroup=function(){var e=undefined;if(this._makitChart){e=this._makitChart.getSelectedCategoryGroup()}return e};return m});
//# sourceMappingURL=Chart.js.map