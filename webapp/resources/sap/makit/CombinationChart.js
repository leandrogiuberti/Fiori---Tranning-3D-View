/*!
 * SAPUI5
 * (c) Copyright 2025 SAP SE. All rights reserved.
 */
sap.ui.define(["./library","./MakitLib","./CategoryAxis","./ValueAxis","./ValueBubble","./CombinationChartRenderer","sap/ui/core/Control","sap/ui/core/Element","sap/ui/core/RenderManager","sap/ui/core/ResizeHandler","sap/ui/thirdparty/jquery","sap/base/assert"],function(e,t,a,i,r,s,o,n,h,l,jQuery,g){"use strict";var p=e.ChartType;var y=e.LegendPosition;var d=o.extend("sap.makit.CombinationChart",{metadata:{deprecated:true,library:"sap.makit",properties:{width:{type:"sap.ui.core.CSSSize",group:"Dimension",defaultValue:"100%"},height:{type:"sap.ui.core.CSSSize",group:"Dimension",defaultValue:"100%"},showRangeSelector:{type:"boolean",group:"Appearance",defaultValue:true},legendPosition:{type:"sap.makit.LegendPosition",group:"Misc",defaultValue:y.Left},primaryColorPalette:{type:"any",group:"Misc",defaultValue:null},secondaryColorPalette:{type:"any",group:"Misc",defaultValue:null},showTableValue:{type:"boolean",group:"Misc",defaultValue:true},numberOfVisibleCategories:{type:"int",group:"Misc",defaultValue:null},rangeSelectorStartPosition:{type:"int",group:"Misc",defaultValue:0}},aggregations:{categoryRegions:{type:"sap.makit.Category",multiple:true,singularName:"categoryRegion",deprecated:true},layers:{type:"sap.makit.Layer",multiple:true,singularName:"layer",deprecated:true},categoryAxis:{type:"sap.makit.CategoryAxis",multiple:false,deprecated:true},primaryValueAxis:{type:"sap.makit.ValueAxis",multiple:false,deprecated:true},secondaryValueAxis:{type:"sap.makit.ValueAxis",multiple:false,deprecated:true},valueBubble:{type:"sap.makit.ValueBubble",multiple:false,deprecated:true}},events:{doubletap:{},tap:{},longpress:{}}}});d.prototype.init=function(){this._makitChart=null;this._parentCurrentHeight=0;this._selectedCatIdx=0;this._datarows=[];this._styleClasses=[];this.setCategoryAxis(new a);this.setPrimaryValueAxis(new i);this.setSecondaryValueAxis(new i);this.setValueBubble(new r);this.attachEvent("_change",this._onPropertyChanged);sap.ui.getCore().attachThemeChanged(this._applyCSS,this)};d.prototype.onBeforeRendering=function(e){this.fireEvent("_beforeRendering",this);if(this.getDomRef()&&!h.isPreservedContent(this.getDomRef())){h.preserveContent(this.getDomRef(),true,false)}};d.prototype.onAfterRendering=function(e){this.fireEvent("_afterRendering",this);var t=jQuery(document.getElementById("sap-ui-dummy-"+this.getId()));var a=h.findPreservedContent(this.getId());var i=null;if(this.getLayers().length>0){if(a.length==0){this.fireEvent("_createMAKitObject",this);i=new jQuery(this.getDomRef());t.replaceWith(i);this._createChartObject();var r=document.getElementById(this.getParent().getId());this._parentCurrentHeight=r.offsetHeight;l.register(r,jQuery.proxy(this._onResize,this))}else if(a.length>0){this.fireEvent("_restoreMAKitObject",this);t.replaceWith(a)}if(i){this._makitChart.setPalette(this.getPrimaryColorPalette(),"primaryaxis");this._makitChart.setPalette(this.getSecondaryColorPalette(),"secondaryaxis");this._makitChart.setNumberOfVisibleCategories(this.getNumberOfVisibleCategories());this._makitChart.setRangeSelectorStartPosition(this.getRangeSelectorStartPosition());this._setDataTable()}}};d.prototype.addStyleClass=function(e,t){if(this._styleClasses.indexOf(e)===-1){this._styleClasses.push(e)}if(this._makitChart){o.prototype.addStyleClass.call(this,e,t)}return this};d.prototype.removeStyleClass=function(e,t){var a=this._styleClasses.indexOf(e);if(a>-1){this._styleClasses.splice(a,1)}if(this._makitChart){o.prototype.removeStyleClass.call(this,e,t)}return this};d.prototype.addLayer=function(e){if(this._makitChart){throw new Error("Cannot add layer once the chart has been rendered")}this._checkLayer(e);n.prototype.addAggregation.call(this,"layers",e,false);e.attachEvent("rowsUpdated",this._setDataTable,this);e.attachEvent("dataRegionChanged",this._onDataRegionPropChanged,this);e.attachEvent("_change",this._onLayerPropertyChanged,this);return this};d.prototype.insertLayer=function(e,t){if(this._makitChart){throw new Error("Cannot add layer once the chart has been rendered")}this._checkLayer(e);n.prototype.insertAggregation.call(this,"layers",e,t,false);e.attachEvent("rowsUpdated",this._setDataTable,this);e.attachEvent("dataRegionChanged",this._onDataRegionPropChanged,this);e.attachEvent("_change",this._onLayerPropertyChanged,this);return this};d.prototype.removeLayer=function(e){if(this._makitChart){throw new Error("Cannot remove layer once the chart has been rendered")}var t=n.prototype.removeAggregation.call(this,"layers",e,false);if(t!=null){t.detachEvent("rowsUpdated",this._setDataTable,this);t.detachEvent("dataRegionChanged",this._onDataRegionPropChanged,this);t.detachEvent("_change",this._onLayerPropertyChanged,this)}return t};d.prototype.removeAllLayers=function(){if(this._makitChart){throw new Error("Cannot remove layers once the chart has been rendered")}var e=n.prototype.removeAllAggregation.call(this,"layers",false);var t=e.length;var a;for(a=0;a<t;a++){e[a].detachEvent("rowsUpdated",this._setDataTable,this);e[a].detachEvent("dataRegionChanged",this._onDataRegionPropChanged,this);e[a].detachEvent("_change",this._onLayerPropertyChanged,this)}return e};d.prototype._checkLayer=function(e){var t=this.getLayers();var a=t.length;var i;if(e.getType()==p.Line){for(i=0;i<a;i++){if(t[i].getType()==p.Bar){e.setLineType("verticalline");break}else{e.setLineType("line")}}}else{for(i=0;i<a;i++){if(t[i].getType()!=p.Line){throw new Error("Cannot combine 2 different non-line chart type")}}for(i=0;i<a;i++){if(t[i].getType()==p.Line){if(e.getType()==p.Bar){t[i].setLineType("verticalline")}else{t[i].setLineType("line")}}}}};d.prototype.setValueBubble=function(e){if(e instanceof r){n.prototype.setAggregation.call(this,"valueBubble",e,false);e.attachEvent("_change",this._onValueBubbleChanged,this);if(this._makitChart){var t=e.toObject();this._makitChart.setValueBubbleStyle(t);if(this._makitChart.isValueBubbleVisible()!=t.visible){this._makitChart.showValueBubble(t.visible)}}}else{throw new Error("valueBubble property must be of type sap.makit.ValueBubble")}return this};d.prototype.addCategoryRegion=function(e){n.prototype.addAggregation.call(this,"categoryRegions",e,false);e.attachEvent("_change",{type:"categories"},this._onDataRegionPropChanged,this);return this};d.prototype.insertCategoryRegion=function(e,t){n.prototype.insertAggregation.call(this,"categoryRegions",e,t,false);e.attachEvent("_change",{type:"categories"},this._onDataRegionPropChanged,this);return this};d.prototype.removeCategoryRegion=function(e){var t=n.prototype.removeAggregation.call(this,"categoryRegions",e,false);if(t!=null){e.detachEvent("_change",this._onDataRegionPropChanged,this)}return t};d.prototype.removeAllCategoryRegions=function(){var e=n.prototype.removeAllAggregation.call(this,"categoryRegions",false);var t=e.length;var a;for(a=0;a<t;a++){e[a].detachEvent("_change",this._onDataRegionPropChanged,this)}return e};d.prototype.setPrimaryValueAxis=function(e){if(e instanceof i){n.prototype.setAggregation.call(this,"primaryValueAxis",e,false);e.attachEvent("_change",{axis:"values",secondaryAxis:false},this._onAxisPropChanged,this)}else{throw new Error("primaryValueAxis property must be of type sap.makit.ValueAxis")}return this};d.prototype.setSecondaryValueAxis=function(e){if(e instanceof i){n.prototype.setAggregation.call(this,"secondaryValueAxis",e,false);e.attachEvent("_change",{axis:"values",secondaryAxis:true},this._onAxisPropChanged,this)}else{throw new Error("secondaryValueAxis property must be of type sap.makit.ValueAxis")}return this};d.prototype.setCategoryAxis=function(e){if(e instanceof a){n.prototype.setAggregation.call(this,"categoryAxis",e,false);e.attachEvent("_change",{axis:"category"},this._onAxisPropChanged,this)}else{throw new Error("categoryAxis property must be of type sap.makit.CategoryAxis")}return this};d.prototype._setRealHeight=function(e){var t=this.getDomRef();var a=t.style.height;var i="0px";if(e.indexOf("%")>-1){var r=document.getElementById(this.getParent().getId());var s=parseInt(e);var o=Math.ceil(r.offsetHeight*(s/100));i=o+"px"}else{i=e}if(a!=i){t.style.height=i}};d.prototype._createChartObject=function(){var e=this.getDomRef();g(e,"Chart's DomRef is not ready");e.style.width=this.getWidth();this._setRealHeight(this.getHeight());this._makitChart=new window.$MA.Chart(this.getId(),true);var t=this;this._makitChart.bind("initialized",function(){t._makitChart.showToolBar(false);t._setMakitChartProperties()});this._makitChart.bind("beforerender",function(){t.fireEvent("_makitBeforeRender",t)});this._makitChart.bind("renderstart",function(){t.fireEvent("_makitRenderStart",t)});this._makitChart.bind("renderend",function(){t.fireEvent("_makitRenderEnd",t)});this._makitChart.bind("animationend",function(){t.fireEvent("_makitAnimationEnd",t)});var a=this._getChartSyntax();this._makitChart.create(a);this._makitChart.bind("tap",function(e){t._selectedCatIdx=t._makitChart.getSelectedCategoryIndex();t.fireTap(e)});this._makitChart.bind("doubletap",function(e){t.fireEvent("doubletap",e)});this._makitChart.bind("longpress",function(e){t._selectedCatIdx=t._makitChart.getSelectedCategoryIndex();t.fireEvent("longpress",e)});var i=this._styleClasses.length;for(var r=0;r<i;r++){this.addStyleClass(this._styleClasses[r])}this._applyCSS()};d.prototype._setMakitChartProperties=function(){if(!this._makitChart){return}this._makitChart.setLegend(this.getLegendPosition().toLowerCase());this._makitChart.setPalette(this.getPrimaryColorPalette(),"primaryaxis");this._makitChart.setPalette(this.getSecondaryColorPalette(),"secondaryaxis");this._makitChart.showRangeSelectorView(this.getShowRangeSelector());this._makitChart.showTableValue(this.getShowTableValue());this._makitChart.setNumberOfVisibleCategories(this.getNumberOfVisibleCategories());this._makitChart.setRangeSelectorStartPosition(this.getRangeSelectorStartPosition());var e=this.getValueBubble();if(e){var t=e.toObject();this._makitChart.setValueBubbleStyle(t);if(this._makitChart.isValueBubbleVisible()!=t.visible){this._makitChart.showValueBubble(t.visible)}}var a=this.getLayers();var i=a.length;for(var r=0;r<i;r++){var s=a[r];if(s.getType()==p.Line){this._makitChart.setGraphLineWidth(s.getLineThickness(),s.getId())}var o=s.getPrimaryColorPalette();if(o){this._makitChart.setPalette(o,s.getId())}this._makitChart.setProperty(s.getId()+".values.SecondaryAxis",s.getDrawOnSecondaryAxis())}};d.prototype._getChartSyntax=function(){var e=this.getCategoryAxis();var t=this.getCategoryRegions();var a=t.length;if(a>0){var i;var r="<Categories";if(e){if(e.getDisplayAll()){r+=' display ="'+e.getDisplayAll()+'"'}}r+=">";var s="";for(i=a-1;i>=0;i--){var o=t[i].getDisplayName();if(o&&o.length>0){s+=o+" | "}}s=s.substr(0,s.length-3);for(i=0;i<a;i++){var n=t[i];r+='<Category column ="'+n.getColumn()+'"';if(n.getFormat()){r+=' format ="'+n.getFormat()+'"'}if(i==0){r+=' displayname ="'+s+'"'}if(e){r+=' showprimaryline ="'+e.getShowPrimaryLine()+'"';r+=' showgrid ="'+e.getShowGrid()+'"';r+=' showlabel ="'+e.getShowLabel()+'"';r+=' thickness ="'+e.getThickness()+'"';r+=' color ="'+e.getColor()+'"';r+=' sortorder ="'+e.getSortOrder().toLowerCase()+'"';r+=' displaylastlabel ="'+e.getDisplayLastLabel()+'"'}r+=" />"}r+="</Categories>"}else{throw new Error("CombinationChart '"+this.getId()+"' needs at least one Category data region")}var h=this.getLayers();var l=h.length;var g="";for(var i=0;i<l;i++){var p=h[i];g+=p.getSyntax(this.getPrimaryValueAxis(),this.getSecondaryValueAxis())}var y="<OverlayGroup>";y+=r;y+=g;y+="</OverlayGroup>";return y};d.prototype._setDataTable=function(){if(this._makitChart){this._setDataTableTimer=this._setDataTableTimer||setTimeout(function(){g(this._makitChart,"_makitChart is not initialized");this.fireEvent("_createDataTable",this);var e=this.getLayers();var t=e.length;this.fireEvent("_beforeSetDataTable",this);for(var a=0;a<t;a++){var i=e[a];this._makitChart.setDataTable(i.getDataTable(),i.getId())}this._dataInitialize=true;this._setDataTableTimer=undefined}.bind(this),150)}};d.prototype._applyCSS=function(e){if(this._makitChart){this._makitChart.applyCSS()}};d.prototype._getSelectedSeries=function(e){var t=this.indexOfLayer(e);if(t>=0&&this._makitChart){return this._makitChart.getSelectedSeries(e.getId())}};d.prototype._onResize=function(e){var t=document.getElementById(this.getParent().getId());var a=t.offsetHeight;var i=t.offsetWidth;if(this._parentCurrentHeight!=a&&a>0){this._setRealHeight(this.getHeight());this._parentCurrentHeight=t.offsetHeight}if(this._makitChart!=null&&a>0&&i>0){this._makitChart.refresh()}};d.prototype._onPropertyChanged=function(e){if(!this._makitChart){return}var t=e.mParameters["name"];var a=e.mParameters["newValue"];if(this._makitChart){if(t==="showRangeSelector"){this._makitChart.showRangeSelectorView(a)}else if(t==="legendPosition"){this._makitChart.setLegend(a.toLowerCase())}else if(t==="width"){this.getDomRef().style.width=this.getWidth()}else if(t==="height"){this._setRealHeight(a)}else if(t==="showTableValue"){this._makitChart.showTableValue(a)}else if(t==="primaryColorPalette"){this._makitChart.setPalette(a,"primaryaxis")}else if(t==="secondaryColorPalette"){this._makitChart.setPalette(a,"secondaryaxis")}else if(t==="numberOfVisibleCategories"){this._makitChart.setNumberOfVisibleCategories(a)}else if(t==="rangeSelectorStartPosition"){this._makitChart.setRangeSelectorStartPosition(a)}this._makitChart.setSelectedCategoryIndex(this._selectedCatIdx);this._makitChart.refresh()}};d.prototype._onLayerPropertyChanged=function(e){if(!this._makitChart){return}var t=e.mParameters["name"];var a=e.mParameters["newValue"];var i=e.mParameters["oldValue"];if(this._makitChart){if(t==="type"){var r=e.getSource();var s=this.indexOfLayer(r);var o=this.getLayers();var n=o.length;var h;if(a!=p.Line){for(h=0;h<n;h++){var l=o[h].getType();if(s!=h&&l!=p.Line){r.setType(i);throw new Error("CombinationChart : "+a+" chart type cannot be combine with "+l+" chart type")}}}var g=a;if(g==p.Line){for(h=0;h<n;h++){if(o[h].getType()!=p.Line){g=o[h].getType();break}}}var y="line";if(g==p.Bar){y="verticalline"}var d=a;if(a==p.Line){d=y}this._makitChart.setProperty(r.getId()+".ChartType",d);for(h=0;h<n;h++){if(o[h].getType()==p.Line&&o[h].getLineType()!=y&&r!=o[h]){o[h].setLineType(y);this._makitChart.setProperty(o[h].getId()+".ChartType",y)}}}else if(t==="lineThickness"){this._makitChart.setGraphLineWidth(a,e.getSource().getId())}else if(t==="primaryColorPalette"){this._makitChart.setPalette(a,e.getSource().getId())}else if(t==="drawOnSecondaryAxis"){this._makitChart.setProperty(e.getSource().getId()+".values.SecondaryAxis",a)}this._makitChart.setSelectedCategoryIndex(this._selectedCatIdx);this._makitChart.refresh()}};d.prototype._onDataRegionPropChanged=function(e,t){if(!this._makitChart){return}var a=e.mParameters;if(a["type"]=="values"){var i=e.getSource().getId();var r=a["index"];if(r>-1){this._makitChart.setProperty(i+"."+a["type"]+"["+r+"]."+a["name"],a["newValue"])}}else if(a["type"]=="series"){var i=e.getSource().getId();var r=a["index"];this._makitChart.setProperty(i+"."+a["type"]+"["+r+"]."+a["name"],a["newValue"])}else if(t!=undefined){this._makitChart.setProperty(t["type"]+"."+a["name"],a["newValue"])}};d.prototype._onAxisPropChanged=function(e,t){g(t,"oData is expected to be set in _onAxisPropChanged");if(!this._makitChart){return}var a=e.mParameters;var i=a["name"].toLowerCase();var r=a["newValue"];if(i==="sortorder"){r=r.toLowerCase()}if(t["axis"]=="values"){var s="primaryaxis";if(t["secondaryAxis"]){s="secondaryaxis"}this._makitChart.setProperty(s+"."+t["axis"]+"."+i,r)}else{var o=t["axis"];if(i==="displayall"){o="categories";i="display";if(!r){r=""}}this._makitChart.setProperty(o+"."+i,r)}this._makitChart.refresh();if(i==="sortorder"||i=="display"){this._setDataTable()}};d.prototype._onValueBubbleChanged=function(e){if(!this._makitChart){return}var t=this.getValueBubble().toObject();this._makitChart.setValueBubbleStyle(t);if(this._makitChart.isValueBubbleVisible()!=t.visible){this._makitChart.showValueBubble(t.visible)}this._makitChart.refresh()};d.prototype.getSelectedCategory=function(){var e=undefined;if(this._makitChart){e=this._makitChart.getSelectedCategory()}return e};d.prototype.getNumberOfCategories=function(){var e=undefined;if(this._makitChart){e=this._makitChart.getNumberOfCategories()}return e};d.prototype.getSelectedCategoryGroup=function(){var e=undefined;if(this._makitChart){e=this._makitChart.getSelectedCategoryGroup()}return e};return d});
//# sourceMappingURL=CombinationChart.js.map