sap.ui.define(["sap/rules/ui/ast/autoComplete/dataStructure/BaseStack","sap/rules/ui/ast/constants/Constants","sap/rules/ui/ast/autoComplete/node/TermNode"],function(e,t,s){"use strict";var n=function(){e.apply(this,arguments);this._name="";this._oFunction=null};n.prototype=new e;n.prototype.constructor=e;n.prototype.init=function(e){this.oStack=e};n.prototype.push=function(e){var s=e.getTokenType();switch(s){case t.LEFTPARENTHESIS:return this.handleLeftParenthesisToken(e);case t.RIGHTPARENTHESIS:return this._handleRightParenthesisToken(e);case t.COMMA:if(this.getTop()&&"push"in this.getTop()){var n=this.getTop().push(e);if(n.bTokenPushed==false&&this.getHasOpenParenthesis()==true){return this._CloseArgumentAndCreateNextStack()}else if(n.bTokenPushed==false){return n}}else{return{bTokenPushed:false,error:"invalid token comma"}}case t.WS:return{bTokenPushed:true};default:if(this.getTop()&&"push"in this.getTop()){return this._top.push(e)}else{return{bTokenPushed:false}}}};n.prototype._getArgSequenceDeterminingBusinessDataType=function(){var e=this.getFunction().getArgumentsMetadata();for(var s=0;s<e.length;s++){if(e[s][t.DETERMINESRETURNDATAOBJECTTYPE]==t.YES){return s}}return-1};n.prototype.getName=function(){return this._name};n.prototype.setName=function(e){this._name=e;return this};n.prototype.getFunction=function(){return this._oFunction};n.prototype.setFunction=function(e){this._oFunction=e;return this};n.prototype._handleRightParenthesisToken=function(e){if(this.getTop()&&"push"in this.getTop()){var t=this.getTop().push(e);if(t.bTokenPushed===false&&this.getHasOpenParenthesis()==true){return this._closeFunctionAndReturnCalculatedNode()}else if(t.bTokenPushed===true){return t}else{return{bTokenPushed:false}}}else if(this.getTop()&&!("push"in this.getTop())&&this.getHasOpenParenthesis()==true){return this._closeFunctionAndReturnCalculatedNode()}else{return{bTokenPushed:false}}};n.prototype._closeFunctionAndReturnCalculatedNode=function(){this.setHasOpenParenthesis(false);var e=this.getFunction().getCategory();if(e==t.AGGREGATE||e==t.SELECTION){return this._closeAggregateFunction()}else{return this._closeFunction()}};n.prototype._closeFunction=function(){var e=new s;e.setName(this.getFunction().getName());e.setLabel(this.getFunction().getLabel());var t=this.getSize();var n=this.getFunction().getArgumentsMetadata();var i;var r;var a;if(n==undefined){i=this.getFunction().getDefaultReturnBusinessDataType();r=this.getFunction().getDefaultReturnDataObjectType()}else if(n){if(this.getFunction()&&this.getFunction().getNumberOfArguments()==="*"&&t>=n.length){a=n[n.length-1]}else{a=n[t-1]}var o=this._getNodeRecursively(this._top);if(a){if(a.referenceIndex!=-1){var u=this._getNodeRecursively(this.peek(a.referenceIndex-1));var h=u.getBusinessDataType();var c=u.getDataObjectType();if(c=="S"){c="T"}if(h&&o&&"getBusinessDataType"in o&&o.getBusinessDataType()&&"referenceBusinessDataTypeCollection"in a&&a["referenceBusinessDataTypeCollection"]&&a["referenceBusinessDataTypeCollection"][h]){i=a["referenceBusinessDataTypeCollection"][h][o.getBusinessDataType()]}var g=o.getDataObjectType();if(g=="S"){g="T"}if(c&&o&&"getDataObjectType"in o&&o.getDataObjectType()&&"referenceDataObjectTypeCollection"in a&&a["referenceDataObjectTypeCollection"]&&a["referenceDataObjectTypeCollection"][c]){r=a["referenceDataObjectTypeCollection"][c][g]}if(r==undefined&&i==undefined){return{bTokenPushed:false,errorCode:10,errorMessage:"Mismatch in argument businessData type or dataObject type"}}}else{i=undefined;r=undefined}}else{return{bTokenPushed:false,errorCode:9,errorMessage:"Mismatch in number of arguments"}}}else{return{bTokenPushed:false,errorCode:9,errorMessage:"Mismatch in number of arguments"}}e.setBusinessDataType(i);e.setDataObjectType(r);this._top=e;this._size=1;return{bTokenPushed:true,bFunctionClosed:true}};n.prototype._closeAggregateFunction=function(){var e=new s;e.setName(this.getFunction().getName());e.setLabel(this.getFunction().getLabel());var n=this.getFunction().getDefaultReturnDataObjectType();var i=this.getFunction().getProbableDataObjectTypeList();e.setDataObjectType(n);e.setBusinessDataType(this.getFunction().getDefaultReturnBusinessDataType());if(this.getTermPrefixId()&&this.getTermPrefixId()!=""){e.setId(this.getTermPrefixId())}var r=this._getArgSequenceDeterminingBusinessDataType();if(i&&i.length>=1&&r>-1&&this._determinetoChangeDataObjectType()){var a=this._getNodeRecursively(this.peek(r));if(a instanceof s){if(n==t.Element){e.setDataObjectType(t.Table)}else{e.setDataObjectType(t.Element);var o=a.getBusinessDataType();if(this.getFunction().getName()==t.COUNTDISTINCT){o=t.NUMBERBUSINESSDATATYPE}e.setBusinessDataType(o)}}}this._top=e;this._size=1;return{bTokenPushed:true,bFunctionClosed:true}};n.prototype._determinetoChangeDataObjectType=function(){if(this.getFunction().getName()==t.COUNT){if(this.getSize()==1)return false;else return true}else if(this.getSize()<=2)return true;return false};n.prototype.handleLeftParenthesisToken=function(e){if(this.getHasOpenParenthesis()===false&&this.getSize()==0){this.setHasOpenParenthesis(true);this._top=new this.oStack(this.getTermPrefixId());var t=this.getFunction().getArgumentsMetadata();var s=[];var n=[];if(t){s=t[0].dataObjectTypeList;n=t[0].businessDataTypeList?t[0].businessDataTypeList:[]}this._top.setPrevious(this);this._top.setProbableDataObjectReturnTypeList(s);this._top.setProbableBusinessDataReturnTypeList(n);this._size+=1;return{bTokenPushed:true}}else if(this.getHasOpenParenthesis()==true&&this.getSize()>0&&this.getTop()&&"push"in this.getTop()){return this.getTop().push(e)}else{return{bTokenPushed:false}}};n.prototype._CloseArgumentAndCreateNextStack=function(){var e=this.getSize()+1;var n=this._getNodeRecursively(this._top);var i=this.getFunction().getArgumentsMetadata();if(this.getFunction().getNumberOfArguments()!="*"&&e>this.getFunction().getNumberOfArguments()){return{bTokenPushed:false,errorCode:11,errorMessage:"More number of arguments is been added"}}var r=new this.oStack(this.getTermPrefixId());if(this.getFunction().getCategory()==t.AGGREGATE||this.getFunction().getCategory()==t.SELECTION){if(this.getSize()<=i.length){r.setProbableDataObjectReturnTypeList(i[this.getSize()-1].dataObjectTypeList);r.setProbableBusinessDataReturnTypeList(i[this.getSize()-1].businessDataTypeList)}else{r.setProbableDataObjectReturnTypeList([]);r.setProbableBusinessDataReturnTypeList([])}if(this.getSize()==1&&n instanceof s){this.setTermPrefixId(n.getId())}}else{var a;var o;var u;var h;if(i){var c=this.getSize();if(this.getFunction()&&this.getFunction().getNumberOfArguments()==="*"&&c>=i.length){u=i[0];h=i[i.length-1]}else{u=i[c-1];h=i[c]}if(h.referenceIndex!=-1){var g=n.getBusinessDataType();var p=n.getDataObjectType();if(p=="S"){p="T"}if(g&&"referenceBusinessDataTypeCollection"in h&&h["referenceBusinessDataTypeCollection"]){var l=h["referenceBusinessDataTypeCollection"][g];if(l){a=Object.keys(l)}else{return{bTokenPushed:false,errorCode:13,errorMessage:"BusinessDatatype Mismatch for arguement :"+this.getSize()+"FunctionName :"+this.getFunction().getName()}}}if(p&&"referenceDataObjectTypeCollection"in h&&h["referenceDataObjectTypeCollection"]){var f=h["referenceDataObjectTypeCollection"][p];if(f){o=Object.keys(f)}else{return{bTokenPushed:false,errorCode:13,errorMessage:"BusinessDatatype Mismatch for arguement :"+this.getSize()+"FunctionName :"+this.getFunction().getName()}}}}else{a=[];o=[]}}else{return{bTokenPushed:false,errorCode:12,errorMessage:"Arguments information is missing : "+this.getFunction().getName()}}r.setProbableBusinessDataReturnTypeList(a);r.setProbableDataObjectReturnTypeList(o)}r.setTermPrefixId(this.getTermPrefixId());r.setPrevious(this._top);this._top=r;this._size+=1;return{bTokenPushed:true}};n.prototype.getProbableBusinessDataReturnTypeList=function(){return this.getFunction().getProbableBusinessDataTypeList()};n.prototype.getProbableDataObjectReturnTypeList=function(){return this.getFunction().getProbableDataObjectTypeList()};return n},true);
//# sourceMappingURL=FunctionalStack.js.map