sap.ui.define(["sap/rules/ui/ast/autoComplete/node/TermNode","sap/rules/ui/ast/constants/Constants","sap/rules/ui/ast/autoComplete/dataStructure/BaseStack","sap/rules/ui/ast/provider/FunctionProvider","sap/rules/ui/ast/provider/OperatorProvider","sap/rules/ui/ast/autoComplete/dataStructure/FunctionalStack","sap/rules/ui/ast/autoComplete/dataStructure/ArrayAndRangeStack","sap/rules/ui/ast/autoComplete/node/OperatorNode","sap/rules/ui/ast/autoComplete/dataStructure/ComparisionOperatorStack"],function(e,t,s,a,r,i,o,n,u){"use strict";var p=function(){s.apply(this,arguments);this._probableBusinessDataReturnTypeList=[];this._probableDataObjectReturnTypeList=[];this._isContextComparision=false;this._comparisionLeftOperandBusinessType=null};p.prototype=new s;p.prototype.constructor=s;p.prototype.push=function(e){var s=e.getTokenType();var n;var u;if(this.getTop()&&"push"in this.getTop()){n=this.getTop().push(e);if(n&&n.bTokenPushed==true||n&&"errorCode"in n){if(n.bFunctionClosed==true){return this._handleFunctionClosed()}else if(n.bArrayAndRangeClosed==true){return this._handleArrayAndRangeClosed()}else if(n.bComparisionOperatorClosed){return this._handleComparisionOperatorClosed(n,e)}return n}}switch(s){case t.AND:case t.OR:var T=this._getNodeRecursively(this._top);if(T&&"getBusinessDataType"in T&&T.getBusinessDataType()==t.BOOLEANBUSINESSDATATYPE){this.empty();return{bTokenPushed:true}}return{bTokenPushed:false};case t.RIGHTPARENTHESIS:return this._handleRightParenthesisToken(e);case t.LEFTPARENTHESIS:return this._handleLeftParenthesisToken(e);case t.STRINGBUSINESSDATATYPE:case t.DATEBUSINESSDATATYPE:case t.BOOLEANBUSINESSDATATYPE:case t.TIMEBUSINESSDATATYPE:case t.QUANTITYBUSINESSDATATYPE:case t.AMOUNTBUSINESSDATATYPE:case t.NUMBERBUSINESSDATATYPE:case t.GEOBUSINESSDATATYPE:case t.UTC_TIMESTAMP:case t.TERM:return this._handleTermAndLiteralToken(e);case t.OPERATOR:return this._handleOpertorToken(e);case t.RANGE_OPERATOR:case t.ARRAY_OPERATOR:var l=e.getText();var c=r.getInstance().getOperatorByName(l.toUpperCase());u=new o(this.getTermPrefixId());u.init(p);u.setOperator(c);u.setPrevious(this._top);this._top=u;this._size+=1;return{bTokenPushed:true};case t.COMPARISION_OPERATOR:return this._createComparisionStack(e.getText());case t.FUNCTION:var h=e.getText();var g=a.getInstance().getFunctionByName(h.toUpperCase());u=new i(this.getTermPrefixId());u.init(p);u.setFunction(g);u.setPrevious(this._top);this._top=u;this._size+=1;return{bTokenPushed:true};case t.COMMA:return{bTokenPushed:false,error:"invalid character comma"};case t.WS:return{bTokenPushed:true};default:return{bTokenPushed:false,error:"unidentified  token"}}};p.prototype._createComparisionStack=function(e){var t=this._getNodeRecursively(this._top);if(t&&"getBusinessDataType"in t&&t.getBusinessDataType()){var s;s=new u(this.getTermPrefixId());s.init(p);s.setName(e);s.setLeftOperandBusinessDataType(t.getBusinessDataType());s.setPrevious(this._top);this._top=s;this._size+=1;return{bTokenPushed:true}}else{return{bTokenPushed:false,errorCode:5,error:"Could not Determine BussinessDataType of Left Operarnd for ComparisionOperator : "+e}}};p.prototype._doesStackContainsFunctions=function(e){var t=e;while("getTop"in e&&e.getTop()){if(e instanceof i){return true}t=e;e=e.getTop()}return false};p.prototype.getProbableBusinessDataReturnTypeList=function(){return this._probableBusinessDataReturnTypeList};p.prototype.setProbableBusinessDataReturnTypeList=function(e){this._probableBusinessDataReturnTypeList=e;return this};p.prototype.getProbableDataObjectReturnTypeList=function(){return this._probableDataObjectReturnTypeList};p.prototype.setProbableDataObjectReturnTypeList=function(e){this._probableDataObjectReturnTypeList=e;return this};p.prototype.isContextComparision=function(){return this._isContextComparision};p.prototype.setContextComparision=function(e){this._isContextComparision=e};p.prototype.setComparisionLeftOperandType=function(e){this._comparisionLeftOperandBusinessType=e};p.prototype.getComparisionLeftOperandBusinessType=function(){return this._comparisionLeftOperandBusinessType};p.prototype._handleTermAndLiteralToken=function(s){var a=this._nodeManager.getNode(s,this.getTermPrefixId());var r;var i;var o=false;var u={bTokenPushed:false,errorCode:1};if(this.getSize()==0){a.setPrevious(this._top);this._top=a;this._size+=1;return{bTokenPushed:true}}else if(this.getTop()&&"getNodeType"in this.getTop()&&this.getTop().getNodeType()==t.OPERATORNODE&&this._top.getPrevious()&&("getBusinessDataType"in this._top.getPrevious()||this._getNodeRecursively(this._top.getPrevious())&&"getBusinessDataType"in this._getNodeRecursively(this._top.getPrevious()))){r=new e;var p=this._getNodeRecursively(this._top);var T=p.getOperatorMetadata();var l=this._getNodeRecursively(this._top.getPrevious());var c=l?l.getBusinessDataType():"";if(l&&"getDataObjectType"in l)var h=l.getDataObjectType();i=l.getName()+" "+p.getName()+" "+a.getName();r.setName(i).setLabel(i);if(h){var g=T.getReturnValueDataObjectTypeCollection()[h][a.getDataObjectType()];if(g){r.setDataObjectType(g)}else{u["expectedDataObjectTypeList"]=Object.keys(T.getReturnValueDataObjectTypeCollection()[h]);o=true}}if(c){var y=T.getReturnValueBussinessDataTypeCollection()[c][a.getBusinessDataType()];if(y){r.setBusinessDataType(y)}else{u["expectedBusinessDataTypeList"]=Object.keys(T.getReturnValueBussinessDataTypeCollection()[c]);o=true}}if(o){return u}this.pop();this.pop();r.setPrevious(this._top);this._top=r;this._size+=1;return{bTokenPushed:true}}else if(this.getTop()&&this.getTop()instanceof n&&(this.getTop().getName()==t.MINUS||this.getTop().getName()==t.LOGICAL_NOT)){r=new e;i=this.getTop().getName()+" "+a.getName();r.setName(i).setLabel(i);if(this.getTop().getName()==t.MINUS&&(a instanceof e&&!(a.getBusinessDataType()==t.NUMBERBUSINESSDATATYPE))||!(s.getTokenType()==t.NUMBERBUSINESSDATATYPE)){u["expectedBusinessDataTypeList"]=[t.NUMBERBUSINESSDATATYPE];o=true}else if(this.getTop().getName()==t.LOGICAL_NOT&&(a instanceof e&&!(a.getBusinessDataType()==t.BOOLEANBUSINESSDATATYPE)||!(s.getTokenType()==t.BOOLEANBUSINESSDATATYPE))){u["expectedBusinessDataTypeList"]=[t.BOOLEANBUSINESSDATATYPE];o=true}if(o){return u}else if(this.getTop().getName()==t.MINUS){r.setBusinessDataType(t.NUMBERBUSINESSDATATYPE);r.setDataObjectType(t.Element)}else if(this.getTop().getName()==t.LOGICAL_NOT){r.setBusinessDataType(t.BOOLEANBUSINESSDATATYPE);r.setDataObjectType(t.Element)}this.pop();r.setPrevious(this._top);this._top=r;this._size+=1;return{bTokenPushed:true}}else{return{bTokenPushed:false,error:"Token should be prefixed with operator"}}};p.prototype._handleOpertorToken=function(s){var a=this._nodeManager.getNode(s);var r=this._getNodeRecursively(this._top);if(r){var i=this._getNodeRecursively(this._top);var o;var n;if(i&&"getBusinessDataType"in i)n=i.getBusinessDataType();if(i&&"getDataObjectType"in i){o=i.getDataObjectType()}var u=a.getOperatorMetadata();if(o&&u.getReturnValueDataObjectTypeCollection()&&u.getReturnValueDataObjectTypeCollection()[o]){a.setProbableDataObjectReturnTypeList(Object.keys(u.getReturnValueDataObjectTypeCollection()[o]))}else if(o){return{bTokenPushed:false,errorCode:3,error:"Left operand DataObject type : "+o+" is not matching given operator DataObject"}}if(n&&u.getReturnValueBussinessDataTypeCollection()&&u.getReturnValueBussinessDataTypeCollection()&&u.getReturnValueBussinessDataTypeCollection()[n]){a.setProbableBusinessDataReturnTypeList(Object.keys(u.getReturnValueBussinessDataTypeCollection()[n]))}else if(n){return{bTokenPushed:false,errorCode:4,error:"Left operand businessDatatype : "+n+" is not matching given operator businessDataType"}}a.setPrevious(this._top);this._top=a;this._size+=1;return{bTokenPushed:true}}else if(!(r instanceof e)&&(s.getText()==t.MINUS||s.getText()==t.LOGICAL_NOT)){a.setPrevious(this._top);if(s.getText()==t.MINUS){a.setProbableBusinessDataReturnTypeList([t.NUMBERBUSINESSDATATYPE])}else{a.setProbableBusinessDataReturnTypeList([t.BOOLEANBUSINESSDATATYPE])}a.setProbableDataObjectReturnTypeList([t.Element]);this._top=a;this._size+=1;return{bTokenPushed:true}}else{return{bTokenPushed:false,error:"Operator should be preceded with term/Expression"}}};p.prototype._handleLeftParenthesisToken=function(e){if(this.getHasOpenParenthesis()===false){this.setHasOpenParenthesis(true);var t=new sap.rules.ui.ast.autoComplete.dataStructure.Stack(this.getTermPrefixId());if(this._top){t.setPrevious(this._top)}else{t.setPrevious(this)}t.setProbableDataObjectReturnTypeList(this.getProbableDataObjectReturnTypeList());t.setProbableBusinessDataReturnTypeList(this.getProbableBusinessDataReturnTypeList());this._top=t;this._size+=1;return{bTokenPushed:true}}return{bTokenPushed:false}};p.prototype._closeComparisionStack=function(t){var s=this._getComparisionStack(t);var a=this._getNodeRecursively(s.getTop());var r=new e;var i=s.getOperatorMetadata();var o=this._getNodeRecursively(s.getPrevious());var n=o.getBusinessDataType();if(o&&"getDataObjectType"in o)var u=o.getDataObjectType();var p=o.getName()+" "+i.getName()+" "+a.getName();r.setName(p).setLabel(p);var T={bTokenPushed:false,errorCode:1};var l=false;if(u){var c=i.getReturnValueDataObjectTypeCollection()[u][a.getDataObjectType()];if(c){r.setDataObjectType(c)}else{T["expectedDataObjectTypeList"]=Object.keys(i.getReturnValueDataObjectTypeCollection()[u]);l=true}}if(n){var h=i.getReturnValueBussinessDataTypeCollection()[n][a.getBusinessDataType()];if(h){r.setBusinessDataType(h)}else{T["expectedBusinessDataTypeList"]=Object.keys(i.getReturnValueBussinessDataTypeCollection()[n]);l=true}}if(l){return T}r.setPrevious(null);this._top=r;this._size=1;return{bTokenPushed:true}};p.prototype._handleRightParenthesisToken=function(e){var s;if(this.getHasOpenParenthesis()==true){s=this._getNodeRecursively(this._top);this.setHasOpenParenthesis(false);if(this.getSize()>0&&this._top.getPrevious()&&"getNodeType"in this._top.getPrevious()&&this._top.getPrevious().getNodeType()==t.OPERATORNODE){return this._calculateTopNode()}else if(this._doesStackContainsComparisionOperator(this.getTop())){return this._closeComparisionStack(this.getTop())}else{this._top=s}return{bTokenPushed:true}}return{bTokenPushed:false,error:"Extra right parenthesis"}};p.prototype._handleFunctionClosed=function(){return this._calculateTopNode()};p.prototype._handleArrayAndRangeClosed=function(){var s=new e;s.setName("Array and range Operator").setLabel("Array and range Operator");s.setBusinessDataType(t.BOOLEANBUSINESSDATATYPE);s.setDataObjectType(t.Element);s.setPrevious(null);this._top=s;this.size=1;return{bTokenPushed:true}};p.prototype._handleComparisionOperatorClosed=function(s,a){var r=this._getNodeRecursively(this._top);var i=s.oMetadata;var o=this._top.getPrevious();var n={bTokenPushed:false,errorCode:1};var u=new e;var p=r.getName()+" "+i.getName()+" "+o.getName();var T=i.getReturnValueBussinessDataTypeCollection()[o.getBusinessDataType()][r.getBusinessDataType()];if(T){u.setBusinessDataType(t.BOOLEANBUSINESSDATATYPE);u.setDataObjectType(t.Element);u.setPrevious(null);u.setName(p).setLabel(p);this._top=u;this._size=1;if(a&&a.getTokenType()==t.AND||a.getTokenType()==t.OR){this.empty();return{bTokenPushed:true}}return this._createComparisionStack(a.getText())}return n};p.prototype._doesStackContainsComparisionOperator=function(e){if(e&&e instanceof u){return true}while(e&&"getTop"in e){e=e.getTop();if(e instanceof u){return true}}return false};p.prototype._getComparisionStack=function(e){if(e&&e instanceof u){return e}while(e&&"getTop"in e){e=e.getTop();if(e instanceof u){return e}}return e};p.prototype._calculateTopNode=function(){var t=this._getNodeRecursively(this._top);var s=new e;var a=this._top.getPrevious();var r;var i;if(a&&"getOperator"in a&&a.getOperator()&&"getSupportedFunctions"in a.getOperator()&&a.getOperator().getSupportedFunctions()){var o=a.getOperator().getSupportedFunctions();i=this._getNodeRecursively(a.getPrevious());var n=false;for(var u=0;u<o.length;u++){if(o[u].name.toLocaleUpperCase()==t.getName()){r=i.getName()+" "+a.getOperator().getName()+" "+t.getName();s.setName(r).setLabel(r);if(o[u].dataObjectTypeList&&o[u].dataObjectTypeList[0]){s.setDataObjectType(o[u].dataObjectTypeList[0])}s.setBusinessDataType(o[u].businessDataType);n=true}}if(!n){return{bTokenPushed:false,errorCode:6}}}else if(a){var p=a.getOperatorMetadata();i=this._getNodeRecursively(a.getPrevious());var T=i.getBusinessDataType();if(i&&"getDataObjectType"in i)var l=i.getDataObjectType();r=i.getName()+" "+p.getName()+" "+t.getName();s.setName(r).setLabel(r);var c={bTokenPushed:false,errorCode:1};var h=false;if(l&&t.getDataObjectType()){var g=p.getReturnValueDataObjectTypeCollection()[l][t.getDataObjectType()];if(g){s.setDataObjectType(g)}else{c["expectedDataObjectTypeList"]=Object.keys(p.getReturnValueDataObjectTypeCollection()[l]);h=true}}if(T&&t.getBusinessDataType()){var y=p.getReturnValueBussinessDataTypeCollection()[T][t.getBusinessDataType()];if(y){s.setBusinessDataType(y)}else{c["expectedBusinessDataTypeList"]=Object.keys(p.getReturnValueBussinessDataTypeCollection()[T]);h=true}}if(h){return c}}else{s.setName(t.getName()).setLabel(t.getLabel());s.setBusinessDataType(t.getBusinessDataType());s.setDataObjectType(t.getDataObjectType())}s.setPrevious(null);this._top=s;this._size=1;return{bTokenPushed:true}};return p},true);
//# sourceMappingURL=Stack.js.map