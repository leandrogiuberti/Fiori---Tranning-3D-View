sap.ui.define(["sap/rules/ui/ast/util/AstUtil","sap/rules/ui/ast/provider/TermsProvider","sap/rules/ui/ast/constants/Constants"],function(e,t,a){"use strict";var s;var r=function(){this._dataObjects=[];this._nestedDataObjects=[];this._visitorAssociations=new e.prototype.HashSet;this.termsProviderInstance=t.getInstance()};r.prototype._getDataObjectType=function(e){if(e){if(e==="Structure"){return"S"}if(e==="Table"){return"T"}if(e==="Element"){return"E"}}return e};r.prototype._getBusinessDataType=function(e){if(e){if(e.toLocaleLowerCase()==="Number".toLocaleLowerCase()){return"N"}if(e.toLocaleLowerCase()==="String".toLocaleLowerCase()){return"S"}if(e.toLocaleLowerCase()==="Boolean".toLocaleLowerCase()){return"B"}if(e.toLocaleLowerCase()==="Date".toLocaleLowerCase()){return"D"}if(e.toLocaleLowerCase()==="Timestamp".toLocaleLowerCase()){return"U"}if(e.toLocaleLowerCase()==="Time".toLocaleLowerCase()){return"T"}if(e.toLocaleLowerCase()==="Geometry".toLocaleLowerCase()){return"G"}if(e.toLocaleLowerCase()==="Amount".toLocaleLowerCase()){return"A"}}return e};r.prototype._generateTermsFromAssociations=function(e,t,s,r,i,n,o){var d,c,T,m,l,D,I,O;if(e){if(o.indexOf(e.TargetDataObjectId)===-1){o.push(e.TargetDataObjectId)}else{o.push(e.TargetDataObjectId);return}D=t.Name;if(t.Label&&t.Label!=""){D=t.Label}I=e.Name;if(e.Label&&e.Label!=""){I=e.Label}l=this.termsProviderInstance.createTerm(r+a.DOT+e.Name,i+a.DOT+e.Id,null,s,"AO",I,false,e.Cardinality);d=this._getDataObject(e.TargetDataObjectId);this.termsProviderInstance.addToTermsIdMap(i+a.DOT+e.Id,l);this.termsProviderInstance.addToTermsNameMap(r+a.DOT+e.Name,l);this.termsProviderInstance.addToTermsLabelMap(n+a.DOT+I,l);if(d){c=d.Attributes;for(var f=0;f<c.length;f++){T=c[f];O=T.Name;if(T.Label&&T.Label!=""){O=T.Label}l=this.termsProviderInstance.createTerm(r+a.DOT+e.Name+a.DOT+T.Name,i+a.DOT+e.Id+a.DOT+T.Id,this._getBusinessDataType(T.BusinessDataType),s,"E",O,T.HasValueSource);this.termsProviderInstance.addToTermsIdMap(i+a.DOT+e.Id+a.DOT+T.Id,l);this.termsProviderInstance.addToTermsNameMap(r+a.DOT+e.Name+a.DOT+T.Name,l);this.termsProviderInstance.addToTermsLabelMap(n+a.DOT+I+a.DOT+O,l)}var b=[];if(d&&d.References){b=d.References}var u;for(var h=0;h<b.length;h++){u=b[h];this._generateTermsFromReferences(u,d,s,r+a.DOT+e.Name,i+a.DOT+e.Id,n+a.DOT+I,o);o.pop()}m=d.Associations;var p;for(var v=0;v<m.length;v++){p=m[v];this._generateTermsFromAssociations(p,d,s,r+a.DOT+e.Name,i+a.DOT+e.Id,n+a.DOT+I,o);o.pop()}}}};r.prototype._generateTermsFromReferences=function(e,t,s,r,i,n,o){var d,c,T,m,l,D,I,O,f;if(e){if(o.indexOf(e.TargetDataObjectId)===-1){o.push(e.TargetDataObjectId)}else{o.push(e.TargetDataObjectId);return}D=t.Name;if(t.Label&&t.Label!=""){D=t.Label}I=e.Name;if(e.Label&&e.Label!=""){I=e.Label}d=this._getNestedDataObject(e.TargetDataObjectId);var b=false;if(d&&d.Type&&d.Type==="Table"){b=true}l=this.termsProviderInstance.createTerm(r+a.DOT+e.Name,i+a.DOT+e.Id,null,s,"R",I);l.setIsDataObjectTable(b);this.termsProviderInstance.addToTermsIdMap(i+a.DOT+e.Id,l);this.termsProviderInstance.addToTermsNameMap(r+a.DOT+e.Name,l);this.termsProviderInstance.addToTermsLabelMap(n+a.DOT+I,l);if(d){c=d.Attributes;for(var u=0;u<c.length;u++){T=c[u];O=T.Name;if(T.Label&&T.Label!=""){O=T.Label}l=this.termsProviderInstance.createTerm(r+a.DOT+e.Name+a.DOT+T.Name,i+a.DOT+e.Id+a.DOT+T.Id,this._getBusinessDataType(T.BusinessDataType),s,"E",O);this.termsProviderInstance.addToTermsIdMap(i+a.DOT+e.Id+a.DOT+T.Id,l);this.termsProviderInstance.addToTermsNameMap(r+a.DOT+e.Name+a.DOT+T.Name,l);this.termsProviderInstance.addToTermsLabelMap(n+a.DOT+I+a.DOT+O,l)}f=d.Associations;for(var h=0;h<f.length;h++){var p;p=f[h];this._generateTermsFromAssociations(p,d,s,r+a.DOT+e.Name,i+a.DOT+e.Id,n+a.DOT+I,o);o.pop()}m=[];if(d&&d.References){m=d.References}var v;for(var L=0;L<m.length;L++){v=m[L];this._generateTermsFromReferences(v,d,s,r+a.DOT+e.Name,i+a.DOT+e.Id,n+a.DOT+I,o);o.pop()}}}};r.prototype._getNestedDataObject=function(e){for(var t=0;t<this._nestedDataObjects.length;t++){if(e===this._nestedDataObjects[t].Id){var a=this._nestedDataObjects[t];if(a.DataObjectReference&&a.DataObjectReference.TargetDataObjectId){return this._getNestedDataObject(a.DataObjectReference.TargetDataObjectId)}return a}}};r.prototype._generateTermsFromRules=function(e){var t,s,r,i,n,o,d,c,T,m,l,D,I,O;if(e.d&&e.d.DataObjects){I=e.d.DataObjects;O=e.d.Id}else if(e.DataObjects){I=e.DataObjects;O=e.Id}if(e.d&&e.d.Rules){s=e.d.Rules}else if(e.Rules){s=e.Rules}for(var f=0;f<s.length;f++){t=s[f];r=t.Name;if(t.Label&&t.Label!=""){r=t.Label}i=this.termsProviderInstance.createTerm(t.Name,t.Id,null,t.VocabularyId,null,r);i.ResultDataObjectId=t.ResultDataObjectId;i.Status=t.Status;i.Type=a.RULE;var b=this.termsProviderInstance.getTermByTermId(i.ResultDataObjectId);if(b&&b.getIsDataObjectElement()){i.isResultDataObjectElement=true;var u=this.termsProviderInstance._getAllAttrsRefsAssocsForDataObject(i.ResultDataObjectId);i._bussinessDataType=u[0]._bussinessDataType;i._hasValueSource=u[0]._hasValueSource}this.termsProviderInstance.addToTermsIdMap(t.Id,i);this.termsProviderInstance.addToTermsNameMap(t.Name,i);this.termsProviderInstance.addToTermsLabelMap(r,i);for(var h=0;h<I.length;h++){n=I[h];if(n.Id===i.ResultDataObjectId){var p=[];var v=null;if(n.DataObjectReference&&n.DataObjectReference.TargetDataObjectId){v=this._getNestedDataObject(n.DataObjectReference.TargetDataObjectId)}o=n.Attributes;if(v){o=v.Attributes}for(var L=0;L<o.length;L++){d=o[L];D=d.Name;if(d.Label&&d.Label!=""){D=d.Label}i=this.termsProviderInstance.createTerm(d.Name,t.Id+a.DOT+d.Id,this._getBusinessDataType(d.BusinessDataType),O,"E",D);this.termsProviderInstance.addToTermsIdMap(t.Id+a.DOT+d.Id,i);this.termsProviderInstance.addToTermsNameMap(t.Name+a.DOT+d.Name,i);this.termsProviderInstance.addToTermsLabelMap(r+a.DOT+D,i)}T=n.Associations;if(v){T=v.Associations}for(var g=0;g<T.length;g++){c=T[g];p.push(n.Id);this._generateTermsFromAssociations(c,n,O,t.Name,t.Id,r,p);p.pop();p.pop()}m=[];if(n&&n.References){m=n.References}if(v){m=v.References}for(var j=0;j<m.length;j++){l=m[j];p.push(n.Id);this._generateTermsFromReferences(l,n,O,t.Name,t.Id,r,p);p.pop();p.pop()}}}}};r.prototype._getDataObject=function(e){for(var t=0;t<this._dataObjects.length;t++){if(e===this._dataObjects[t].Id){return this._dataObjects[t]}}};r.prototype.construct=function(e){this._dataObjects=e.DataObjects;this._nestedDataObjects=e.NestedDataObjects;this._rules=e.Rules;var t=e.Id;this.termsProviderInstance.reset();this.termsProviderInstance.setVocabularyId(t);var s,r,i,n,o,d,c,T,m,l;for(var D=0;D<this._dataObjects.length;D++){s=this._dataObjects[D];m=s.Name;if(s.Label&&s.Label!=""){m=s.Label}var I=false;if(s.Type==="Element"){I=true}T=this.termsProviderInstance.createTerm(s.Name,s.Id,null,t,this._getDataObjectType(s.Type),m);T.setIsDataObjectElement(I);this.termsProviderInstance.addToTermsIdMap(s.Id,T);this.termsProviderInstance.addToTermsNameMap(s.Name,T);this.termsProviderInstance.addToTermsLabelMap(m,T);var O=null;if(s.DataObjectReference&&s.DataObjectReference.TargetDataObjectId){O=this._getNestedDataObject(s.DataObjectReference.TargetDataObjectId)}r=s.Attributes;if(O){r=O.Attributes}for(var f=0;f<r.length;f++){i=r[f];l=i.Name;if(i.Label&&i.Label!=""){l=i.Label}T=this.termsProviderInstance.createTerm(s.Name+a.DOT+i.Name,s.Id+a.DOT+i.Id,this._getBusinessDataType(i.BusinessDataType),t,"E",l,i.HasValueSource);this.termsProviderInstance.addToTermsIdMap(s.Id+a.DOT+i.Id,T);this.termsProviderInstance.addToTermsNameMap(s.Name+a.DOT+i.Name,T);this.termsProviderInstance.addToTermsLabelMap(m+a.DOT+l,T)}var b=[];o=s.Associations;if(O){o=O.Associations}for(var u=0;u<o.length;u++){n=o[u];b.push(s.Id);this._generateTermsFromAssociations(n,s,t,s.Name,s.Id,m,b);b.pop();b.pop()}c=[];if(s&&s.References){c=s.References}if(O){c=O.References}for(var h=0;h<c.length;h++){d=c[h];b.push(s.Id);this._generateTermsFromReferences(d,s,t,s.Name,s.Id,m,b);b.pop();b.pop()}}if(this._rules&&this._rules.length>0){this._generateTermsFromRules(e)}};return{getInstance:function(){if(!s){s=new r;s.constructor=null}return s}}},true);
//# sourceMappingURL=TermsBuilder.js.map