sap.ui.define(["sap/ui/thirdparty/jquery","../../library","sap/ui/core/Control","sap/m/List","sap/ui/model/json/JSONModel","sap/m/library","sap/ui/core/CustomData","sap/ui/model/Sorter","sap/rules/ui/ast/util/utilsBase","sap/m/Panel","sap/ui/layout/HorizontalLayout","sap/m/Label","sap/m/Link","sap/m/Select","sap/m/TextArea","sap/m/Dialog","sap/m/Button","sap/m/CustomListItem","sap/m/DisplayListItem","sap/ui/layout/VerticalLayout","sap/m/SegmentedButton","sap/m/SegmentedButtonItem","sap/ui/model/Filter","sap/ui/model/FilterOperator","sap/m/SearchField","sap/ui/core/Lib","sap/ui/core/Element","./AutoSuggestionVocabularyPanelRenderer"],function(jQuery,e,t,a,i,s,n,l,r,o,u,c,d,h,p,b,f,g,y,m,w,T,A,v,x,D,S,B){"use strict";var V=s.ListMode;var L=t.extend("sap.rules.ui.ast.autoCompleteContent.AutoSuggestionVocabularyPanel",{metadata:{library:"sap.rules.ui",properties:{reference:{type:"object",defaultValue:null},dialogOpenedCallbackReference:{type:"object",defaultValue:null},data:{type:"object",defaultValue:null},context:{type:"string",defaultValue:""}},aggregations:{PanelLayout:{type:"sap.m.Panel",multiple:false}},events:{}},init:function(){this.oBundle=D.getResourceBundleFor("sap.rules.ui.i18n");this.infraUtils=new r.utilsBaseLib;this.needCreateLayout=true;this.AttributeSegmentSelected=true;this.dataObjectName=""},onBeforeRendering:function(){this._reference=this.getReference();this._dialogOpenedCallbackReference=this.getDialogOpenedCallbackReference();if(this.needCreateLayout){var e=this._createLayout();this.setAggregation("PanelLayout",e,true);this.needCreateLayout=false}},initializeVariables:function(){},_createAggregateFunctionSection:function(){var e=new o({expandable:false,expanded:true,width:"auto",content:[new d({wrapping:true,text:this.oBundle.getText("aggregateFunctionPanelTitle"),press:function(e){var t=new u({content:[new c({text:this.oBundle.getText("function")+": "}),new h({width:"200px",height:"60px"}),new c({text:" "+this.oBundle.getText("oflabel")+" "}),new p({value:"",showExceededText:true,width:"150%",height:"65px"})]});var a=new u({content:[new c({text:this.oBundle.getText("where_label")+":"}),new p({value:"",showExceededText:true,width:"300px"})]});var i=new u({content:[new c({text:this.oBundle.getText("group_by")+": "}),new p({value:"",showExceededText:true,width:"300px"})]});var s=new u({content:[new c({text:this.oBundle.getText("function_label")+":"}),new p({value:"",enabled:false,width:"300px"})]});var n=new m({content:[t,a,i,s]});var l=this;var r=new b({title:this.oBundle.getText("configure_aggr_title"),contentWidth:"800px",contentHeight:"500px",showHeader:true,content:[n],afterClose:function(){l._dialogOpenedCallbackReference(false)},buttons:[new f({text:this.oBundle.getText("applyChangesBtn"),tooltip:this.oBundle.getText("applyChangesBtn"),press:function(e){r.close()}}),new f({text:this.oBundle.getText("cancelBtn"),tooltip:this.oBundle.getText("cancelBtn"),press:function(e){r.close()}})]});r.open()}})]});var t=new g({content:e});return t},_createLayout:function(){var e=this;this.VocabularyTerms=this.getData();var t=new i;var s=[];for(var n=0;n<5&&n<this.VocabularyTerms.length;n++){s.push(this.VocabularyTerms[n])}t.setData(s);this.vocabularylist=new a({growingScrollToLoad:true,enableBusyIndicator:true});this.vocabularylist.bindItems({path:"/",sorter:new l("label"),rememberSelections:false,mode:V.SingleSelectMaster,template:new y({label:"{label}",type:"Active",press:function(t){e._setModal(false);e._reference(t)}})});this.vocabularylist.setModel(t);var r=this.getMoreVocabulariesLink();var u=new o({headerText:this.oBundle.getText("vocabularyPanelTitle"),expandable:true,expanded:true,content:this.vocabularylist,width:"auto"});if(this.VocabularyTerms.length>=5){u.addContent(r)}return u},_setModal:function(e){var t=S.getElementById("popover");if(t){t.setModal(e)}},getMoreVocabulariesLink:function(){var e=this;var t=new d({text:this.oBundle.getText("more_link"),tooltip:this.oBundle.getText("more_link_tooltip"),enabled:true,press:function(t){e._setModal(true);e._dialogOpenedCallbackReference(true);var a=e.isDoAndAttrsPresent(e.VocabularyTerms);if(a||e.VocabularyTerms[0].isParentEntity){e.getDataObjectsDialog()}else{e.getAttributesDialog(e.dataObjectName)}}});return t},isDoAndAttrsPresent:function(e){if(e){var t=false;var a=false;for(var i=0;i<e.length;i++){if(e[i].isParentEntity&&e[i].type!=="AO"&&e[i].type!=="R"){t=true}else{a=true}}return t&&a}return false},getDataObjectsDialog:function(){var e=this;var t=this.oBundle.getText("searchTextVocabulary");var a=this.getSearchField(t);this.detailedVocabularyList=this.initializeVocabularyList(this.VocabularyTerms);this.bindFilteredTermsToList(this.detailedVocabularyList,"DataObjects","",false);var i=new m({content:[a,e.detailedVocabularyList]}).addStyleClass("sapAstVocabularyPanel");this.dataObjectsDialog=new b({title:this.oBundle.getText("selectVocabularyTitle"),contentWidth:"500px",contentHeight:"500px",showHeader:true,content:[i],afterClose:function(){e._dialogOpenedCallbackReference(false)},buttons:[new f({text:this.oBundle.getText("cancelBtn"),tooltip:this.oBundle.getText("cancelBtn"),press:function(t){e._setModal(false);e.dataObjectsDialog.close()}})]});e.dataObjectsDialog.open()},getAttributesDialog:function(e){var t=this;var a=this.getAttributesSegmentedButtons();var i=this.oBundle.getText("searchTextAttr");if(this.AttributeSegmentSelected){i=this.oBundle.getText("searchTextAttr")}if(this.AssociationSegmentSelected){i=this.oBundle.getText("searchTextAssoc")}var s=this.getSearchField(i);this.detailedVocabularyList=this.initializeVocabularyList(this.VocabularyTerms);this.bindFilteredAttributesAndAssociationsToList(this.detailedVocabularyList,"Attributes","E",false);var n=new m({content:[a,s,t.detailedVocabularyList]}).addStyleClass("sapAstVocabularyPanel");t.attributesDialog=new b({title:this.oBundle.getText("selectAttrAssocTitle"),contentWidth:"500px",contentHeight:"500px",showHeader:true,content:[n],afterClose:function(){t._dialogOpenedCallbackReference(false)},buttons:[new f({text:this.oBundle.getText("cancelBtn"),tooltip:this.oBundle.getText("cancelBtn"),press:function(e){t._setModal(false);t.attributesDialog.close()}})]});t.attributesDialog.open()},getAttributesSegmentedButtons:function(){var e=this;var t=new w({items:[new T({text:this.oBundle.getText("attributes"),width:"230px",press:function(){e._setModal(false);e.AttributeSegmentSelected=true;e.AssociationSegmentSelected=false;e.searchField.setValue("");e.searchField.setPlaceholder(e.oBundle.getText("searchTextAttr"));e.bindFilteredAttributesAndAssociationsToList(e.detailedVocabularyList,"Attributes","E",false)}}),new T({text:this.oBundle.getText("associations"),width:"230px",press:function(){e._setModal(false);e.AttributeSegmentSelected=false;e.AssociationSegmentSelected=true;e.searchField.setValue("");e.searchField.setPlaceholder(e.oBundle.getText("searchTextAssoc"));e.bindFilteredAttributesAndAssociationsToList(e.detailedVocabularyList,"Association","AO",false)}})]});return t},bindFilteredTermsToList:function(e,t,s,r){var o=new i(this.VocabularyTerms);for(var u in o.oData){if(o.oData[u].type==="T"){o.oData[u].displayType="Table"}else if(o.oData[u].type==="S"){o.oData[u].displayType="Structure"}else if(o.oData[u].type==="E"){if(o.oData[u].isParentEntity){o.oData[u].displayType="Element"}else{var c="Attribute";o.oData[u].displayType=o.oData[u].bussinessDataType?c+" ("+o.oData[u].bussinessDataType+")":c}}else if(o.oData[u].type==="AO"){o.oData[u].displayType="Association"}else if(o.oData[u].ResultDataObjectId&&!o.oData[u].type){o.oData[u].displayType="Rule"}else{o.oData[u].displayType=o.oData[u].type}}var d=this;var h="/";if(!e){e=new a({})}e.setModel(o);e.bindItems({path:h,sorter:new l("type"),template:new y({label:"{label}",value:"{displayType}",type:"Active",customData:[new n({Type:"sap.ui.core.CustomData",key:"id",value:"{id}"})],press:function(e){d._setModal(false);if(d.dataObjectsDialog.isOpen()){d.dataObjectsDialog.close()}else{d.attributesDialog.close()}d._reference(e)}}),rememberSelections:false,mode:V.SingleSelectMaster});if(r){var p=[];var b="label";p.push(new A(b,v.Contains,s));e.getBinding("items").filter(p);e.getModel().refresh(true)}},bindFilteredAttributesAndAssociationsToList:function(e,t,s,n){var r=new i(this.VocabularyTerms);var o=this;var u="/";if(!e){e=new a({})}if(r&&r.oData){for(var c in r.oData){if(r.oData[c].type==="E"){var d="Attribute";r.oData[c].displayType=r.oData[c].bussinessDataType?d+" ("+r.oData[c].bussinessDataType+")":d}else if(r.oData[c].type==="R"){var d="Reference";r.oData[c].displayType=d}}}e.setModel(r);e.bindItems({path:u,sorter:new l("label"),template:new y({label:"{label}",value:"{displayType}",type:"Active",press:function(e){o._setModal(false);o.attributesDialog.close();o._reference(e)}}),rememberSelections:false,mode:V.SingleSelectMaster});if(n){if(t==="AO"){e.getBinding("items").filter(new A({filters:[this.getSearchFiltersAttributesAssociation(s,t)],and:true}))}else{e.getBinding("items").filter(new A({filters:[this.getSearchFiltersReference(s),this.getSearchFiltersAttributesAssociation(s,t)],and:false}))}}else{var h=[];var p="type";if(s==="E"){h.push(new A(p,v.Contains,s));h.push(new A(p,v.Contains,"R"))}else{h.push(new A(p,v.Contains,s))}e.getBinding("items").filter(new A({filters:h,and:false}));e.getModel().refresh(true)}},getSearchFiltersReference:function(e){return new A({filters:[new A("type",v.Contains,"R"),new A("label",v.Contains,e)],and:true})},getSearchFiltersAttributesAssociation:function(e,t){return new A({filters:[new A("type",v.Contains,t),new A("label",v.Contains,e)],and:true})},getDataObjectFilter:function(){if(this.AttributeSegmentSelected){return new A("DataObjectId",v.Contains,this.dataObjectId)}if(this.AssociationSegmentSelected){return new A("SourceDataObjectId",v.Contains,this.dataObjectId)}},getSearchFilters:function(e){return new A({filters:[new A("name",v.Contains,e),new A("label",v.Contains,e)],and:false})},getSearchField:function(e){var t=this;this.searchField=new x({showSearchButton:false,width:"462px",placeholder:e,liveChange:function(e){if(t.dataObjectsDialog){t.searchTheValueInDataObjects(e.getParameter("newValue"),a)}else{var a="Attributes";if(t.AttributeSegmentSelected){a="Attributes"}if(t.AssociationSegmentSelected){a="Association"}t.searchValueInAttributesAndAssociation(e.getParameter("newValue"),a)}}});return this.searchField},searchTheValueInDataObjects:function(e,t){this.bindFilteredTermsToList(this.detailedVocabularyList,t,e,true)},searchValueInAttributesAndAssociation:function(e,t){if(this.AttributeSegmentSelected){t="E"}if(this.AssociationSegmentSelected){t="AO"}this.bindFilteredAttributesAndAssociationsToList(this.detailedVocabularyList,t,e,true)},initializeVocabularyList:function(e){var t=new i(e);var s="/";var r=new a({headerText:this.oBundle.getText("vocabulary")});r.setModel(t);r.bindItems({path:s,sorter:new l("label"),template:new y({label:"{label}",value:"{type}",type:"Active",customData:[new n({Type:"sap.ui.core.CustomData",key:"id",value:"{id}"})]})});return r},renderer:B});return L},true);
//# sourceMappingURL=AutoSuggestionVocabularyPanel.js.map