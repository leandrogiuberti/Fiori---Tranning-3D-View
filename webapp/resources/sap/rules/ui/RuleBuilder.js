/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

		(c) Copyright 2009-2016 SAP SE. All rights reserved
	
 */
sap.ui.define(["./library","sap/ui/core/Control","sap/m/Select","sap/ui/core/Item","sap/rules/ui/DecisionTable","sap/rules/ui/DecisionTableConfiguration","sap/rules/ui/TextRuleConfiguration","sap/rules/ui/TextRule","sap/ui/core/Lib","sap/ui/model/json/JSONModel","sap/m/ComboBox","sap/ui/model/Context","./RuleBuilderRenderer"],function(e,t,i,n,a,r,l,s,o,u,g,d,p){"use strict";var h=t.extend("sap.rules.ui.RuleBuilder",{metadata:{library:"sap.rules.ui",properties:{types:{type:"sap.rules.ui.RuleType[]",defaultValue:[e.RuleType.DecisionTable,e.RuleType.TextRule]},bindingContextPath:{type:"string",group:"Misc"},editable:{type:"boolean",defaultValue:true}},aggregations:{_ruleTypeSelector:{type:"sap.m.ComboBox",multiple:false,singularName:"_ruleTypeSelector",visibility:"hidden"},_rule:{type:"sap.rules.ui.RuleBase",multiple:false,singularName:"_rule",visibility:"hidden"},decisionTableConfiguration:{type:"sap.rules.ui.DecisionTableConfiguration",multiple:false,singularName:"decisionTableConfiguration"},textRuleConfiguration:{type:"sap.rules.ui.TextRuleConfiguration",multiple:false,singularName:"textRuleConfiguration"}},associations:{expressionLanguage:{type:"sap.rules.ui.services.ExpressionLanguage",multiple:false,singularName:"expressionLanguage"},astExpressionLanguage:{type:"sap.rules.ui.services.AstExpressionLanguage",multiple:false,singularName:"astExpressionLanguage"}},events:{}},init:function(){this.oBundle=o.getResourceBundleFor("sap.rules.ui.i18n");this.needCreateDisplayedControl=true;this.needRebind=true;this._internalModel=this._initInternalModel();this.setModel(this._internalModel,"ruleBuilderInternalModel")},validate:function(){var e=this.getAggregation("_rule");if(e){e.validate()}},_initInternalModel:function(){var e={types:this.getTypes(),bindingContextPath:this.getBindingContextPath(),editable:this.getEditable(),decisionTableConfiguration:{},textRuleConfiguration:{}};var t=new u;t.setData(e);return t},_getModel:function(){return this.getModel()},_setBindingContext:function(){var e=this.getBindingContextPath();var t=this._getModel();var i=new d(t,e);this.setBindingContext(i)},_createRuleset:function(){return null},_createTextRule:function(){var e=this.getTextRuleConfiguration();if(!e){e=new l;this.setTextRuleConfiguration(e)}var t=new s({bindingContextPath:{path:"ruleBuilderInternalModel>/bindingContextPath"},modelName:{path:"ruleBuilderInternalModel>/modelName"},editable:{path:"ruleBuilderInternalModel>/editable"},enableSettings:{path:"ruleBuilderInternalModel>/textRuleConfiguration/enableSettings"},enableSettingResult:{path:"ruleBuilderInternalModel>/textRuleConfiguration/enableSettingResult"},enableElse:{path:"ruleBuilderInternalModel>/textRuleConfiguration/enableElse"},enableElseIf:{path:"ruleBuilderInternalModel>/textRuleConfiguration/enableElseIf"},expressionLanguage:this.getExpressionLanguage(),astExpressionLanguage:this.getAstExpressionLanguage()});return t},_createDecisionTable:function(){var e=this.getDecisionTableConfiguration();if(!e){e=new r;this.setDecisionTableConfiguration(e)}a.prototype.VISIBLEROWCOUNT=this.getDecisionTableConfiguration().getVisibleRowCount();a.prototype.THRESHOLD=this.getDecisionTableConfiguration().getThreshold();var t=new a({bindingContextPath:{path:"ruleBuilderInternalModel>/bindingContextPath"},modelName:{path:"ruleBuilderInternalModel>/modelName"},editable:{path:"ruleBuilderInternalModel>/editable"},cellFormat:{path:"ruleBuilderInternalModel>/decisionTableConfiguration/cellFormat"},enableSettings:{path:"ruleBuilderInternalModel>/decisionTableConfiguration/enableSettings"},enableSettingResult:{path:"ruleBuilderInternalModel>/decisionTableConfiguration/enableSettingResult"},hitPolicies:{path:"ruleBuilderInternalModel>/decisionTableConfiguration/hitPolicies"},decisionTableFormat:{path:"ruleBuilderInternalModel>/decisionTableConfiguration/decisionTableFormat"},expressionLanguage:this.getExpressionLanguage(),astExpressionLanguage:this.getAstExpressionLanguage()});return t},_createDisplayedControl:function(t){var i;switch(t){case e.RuleType.DecisionTable:i=this._createDecisionTable();break;case"library.RuleType.Ruleset":i=this._createRuleset();break;case e.RuleType.TextRule:i=this._createTextRule();break;default:break}this.setAggregation("_rule",i,true)},_createRuleTypeSelector:function(){var t=this;this.oBundle.getText("decisionTable");var i=new u({items:[{key:e.RuleType.DecisionTable,text:this.oBundle.getText("decisionTable")}]});var a=new g({width:"25%",items:{path:"ruleTypes>/items",template:new n({text:"{ruleTypes>text}",key:"{ruleTypes>key}"})},change:function(e){var i=e.getSource().getSelectedKey();t._createDisplayedControl.call(t,i)}}).setModel(i,"ruleTypes");this.setAggregation("_ruleTypeSelector",a,true)},setEditable:function(e){this._internalModel.setProperty("/editable",e);return this.setProperty("editable",e,true)},setBindingContextPath:function(e,t){var i=this.getBindingContextPath();if(t||e&&i!==e){this.needRebind=true;this._internalModel.setProperty("/bindingContextPath",e);this._needReBind();return this.setProperty("bindingContextPath",e)}},setModelName:function(e){this.needRebind=true;this._internalModel.setProperty("/modelName",e);return this.setProperty("modelName",e)},_setTextRuleConfigurationProperty:function(e,t){var i="/textRuleConfiguration/"+e;this._internalModel.setProperty(i,t)},setTextRuleConfiguration:function(e){e.attachChange(function(e){this.getParent()._setTextRuleConfigurationProperty.call(this.getParent(),e.getParameter("name"),e.getParameter("value"))});this._setTextRuleConfigurationProperty("enableSettings",e.getEnableSettings());this._setTextRuleConfigurationProperty("enableSettingResult",e.getEnableSettingResult());this._setTextRuleConfigurationProperty("enableElse",e.getEnableElse());this._setTextRuleConfigurationProperty("enableElseIf",e.getEnableElseIf());return this.setAggregation("textRuleConfiguration",e,true)},_setDecisionTableConfigurationProperty:function(e,t){var i="/decisionTableConfiguration/"+e;this._internalModel.setProperty(i,t)},setDecisionTableConfiguration:function(e){e.attachChange(function(e){this.getParent()._setDecisionTableConfigurationProperty.call(this.getParent(),e.getParameter("name"),e.getParameter("value"))});this._setDecisionTableConfigurationProperty("enableSettings",e.getEnableSettings());this._setDecisionTableConfigurationProperty("enableSettingResult",e.getEnableSettingResult());this._setDecisionTableConfigurationProperty("hitPolicies",e.getHitPolicies());this._setDecisionTableConfigurationProperty("cellFormat",e.getCellFormat());this._setDecisionTableConfigurationProperty("decisionTableFormat",e.getDecisionTableFormat());this._setDecisionTableConfigurationProperty("visibleRowCount",e.getVisibleRowCount());this._setDecisionTableConfigurationProperty("threshold",e.getThreshold());return this.setAggregation("decisionTableConfiguration",e,true)},setExpressionLanguage:function(e){var t=this.getAggregation("_rule");if(t){t.setExpressionLanguage(e)}return this.setAssociation("expressionLanguage",e,true)},setAstExpressionLanguage:function(e){var t=this.getAggregation("_rule");if(t){t.setAstExpressionLanguage(e)}return this.setAssociation("astExpressionLanguage",e,true)},resetControl:function(){var e=this.getAggregation("_rule");if(e){e.destroy()}},_needReBind:function(){if(this.needRebind){this.resetControl();var e=this.getTypes();if(e&&e.length===1){this._createDisplayedControl(e[0]);this.needCreateDisplayedControl=false}this.needRebind=false}},onBeforeRendering:function(){this._needReBind()},renderer:p});return h},true);
//# sourceMappingURL=RuleBuilder.js.map