sap.ui.define(["sap/rules/ui/parser/resources/vocabulary/lib/constantsBase","sap/rules/ui/parser/businessLanguage/lib/constants"],function(t,e){"use strict";function i(){}var a="OneToMany";i.prototype.AssocInfo=function(t){this.name=t;this.isValid=false;this.object=null;this.isCollection=false;this.alt=[]};i.prototype.isCardinalityCollection=function(t){return t===a};i.prototype.getTypedAttribute=function(t,e,i,a,s,r){var l=t.getAttribute(e,i,a);if(!l){return null}if(r.length>0){var n=false;var o;for(o=0;o<r.length;o++){if(r[o].type===l.businessDataType&&r[o].hasOwnProperty("isCollection")&&r[o].isCollection===s){n=true;break}}if(!n){return null}}return l};i.prototype.getAltTypedAttributes=function(i,a,s,r,l,n,o){var u=null;var f=[];var p,c,d,T;var y=o===e.DISPLAY_TEXT?t.TermModeRelated.TERM_MODE_BY_DESCRIPTION:t.TermModeRelated.TERM_MODE_BY_NAME;var h=i.getObjectAttributesNamesByTermMode(a,s,r,y);if(n.length===0){return h}for(p=0;p<h.length;p++){d=false;for(c=0;c<n.length;c++){if((n[c].type===e.TYPE_BOOLEAN||n[c].type===e.TYPE_BOOLEAN_COLLECTION)&&o===e.DISPLAY_TEXT){continue}if(n[c].hasOwnProperty("isCollection")&&n[c].isCollection===l){T=i.getAttribute(a,s,h[p].name);if(T&&T.businessDataType===n[c].type){h[p].type=T.businessDataType;u=T.description;d=true;break}}}if(d){h[p].description=u;h[p].tokenType=e.tokenTypesEnum.vocabulary;f.push(h[p])}}return f};i.prototype.canObjectLeadToType=function(t,e,i,a,s,r){if(r.hasOwnProperty(i)){return r[i]}r[i]=false;var l,n;if(s){var o=false;for(l=0;l<a.length;l++){if(a[l].hasOwnProperty("isCollection")&&a[l].isCollection){o=true;break}}if(!o){r[i]=false;return false}}var u=t.getAttributes(e,i);for(l=0;l<a.length;l++){if(a[l].hasOwnProperty("isCollection")&&a[l].isCollection===s){for(n=0;n<u.length;n++){if(u[n].businessDataType===a[l].type){r[i]=true;return true}}}}var f=t.getAssociations(e,i,false);var p;for(l=0;l<f.length;l++){p=s||this.isCardinalityCollection(f[l].cardinality);if(this.canObjectLeadToType(t,e,f[l].target,a,p,r)){r[i]=true;return true}}return false};i.prototype.isTypedObjectExists=function(t,e,i,a){var s=t.getObject(e,i);if(s===null){return null}if(a.length===0){return s}var r={};var l=this.canObjectLeadToType(t,e,i,a,false,r);if(l===false){return null}return s};i.prototype.isTypedAliasExists=function(t,e,i,a){var s=t.getAlias(e,i,null);if(s===null){return null}if(a.length===0){return s}var r=s.isCollection;var l=s.businessDT;var n;for(n=0;n<a.length;n++){if(a[n].type===l){if(a[n].isCollection===r){return s}}}return null};i.prototype.getAltTypedTerms=function(i,a,s,r,l,n,o,u,f,p,c,d,T){var y=i.getTerms(a,s,d);var h=y.terms;var v=[];var g,b;var A;var m;n=!n?false:n;T=T===undefined||T===null?false:T;var _=false;var E=null;var O=null;var C=f?true:false;var D;if(d===t.TermModeRelated.TERM_MODE_BY_DESCRIPTION){D=t.TermModeRelated.TERM_PROPERTY_FRIENDLY_TERM}else{D=t.TermModeRelated.TERM_PROPERTY_DESCRIPTION}if(l&&o){O=l.split(".");if(O.length>0){O=O.shift()}}for(g=0;g<h.length;g++){A=h[g];_=false;if(C&&A.isDeprecated===true){continue}if((n||u)&&A.modifiers.hasOwnProperty("all")&&A.modifiers.all){continue}if(A.modifiers.hasOwnProperty("current")&&A.modifiers.current&&(n||p!==undefined&&p===false||c!==undefined&&c===false&&u!==undefined&&u===false)){continue}if(!o&&T&&A.expression.split(".").length>2){continue}if(r.length===0){v.push(A[D]);continue}if((A.businessDataType!==e.TYPE_BOOLEAN||d!==t.TermModeRelated.TERM_MODE_BY_DESCRIPTION)&&!n&&!o&&l!==null&&A.context!==null&&A.expression.indexOf(l)===0&&A.isConditionalContext===false&&l!==A.context&&A.businessDataType!==null&&A.expression.split(".").length===l.split(".").length+1){continue}if(l&&o){E=null;if(A.isCollection&&!A.isConditionalContext){E=A.expression.split(".");if(E.length>0){E=E.shift();_=E===O?true:false}}}if(l===null&&A.isConditionalContext===false&&!n||A.isVocaRuleTerm||l!==null&&A.context!==null&&l.indexOf(A.context)===0&&!n&&(l!==A.context||l===A.context&&A.isCollection===false&&A.expression.split(".").length>l.split(".").length+1)||l!==null&&A.expression.indexOf(l)===0&&A.isConditionalContext===false&&n||l!==null&&A.expression.indexOf(l)===0&&(A.modifiers.hasOwnProperty("current")&&A.modifiers.current||A.businessDataType===e.TYPE_BOOLEAN&&d===t.TermModeRelated.TERM_MODE_BY_DESCRIPTION)||_){for(b=0;b<r.length;b++){m=r[b];if(_&&m.type===A.businessDataType&&A.isCollection&&m.isCollection){v.push(A[D]);break}else if(!_&&m.type===A.businessDataType&&m.isCollection===A.isCollection){v.push(A[D]);break}}}}return v};i.prototype.buildExternalAltValueList=function(t,i,a){var s=[];var r=t.getValueList(i,a.attributeValueList);var l=r.metadata;l.businessDataType=r.businessDataType;var n={name:a.attributeValueList,tokenType:e.tokenTypesEnum.valueList,info:{id:a.attributeValueList,metadata:l}};s.push(n);return s};i.prototype.buildInternalAltValueList=function(t,i,a,s){var r=[];var l=[];var n=0;l=t.getValueListDescriptions(i,a.attributeValueList,s);for(n=0;n<l.length;n++){r.push({name:l[n],info:{key:a.attributeValueList},tokenType:e.tokenTypesEnum.valueList})}return r};i.prototype.getAltValueList=function(e,i,a,s){var r=[];if(a){var l=e.getValueListType(i,a.attributeValueList);switch(l){case t.INTERNAL_VALUE_LIST:r=this.buildInternalAltValueList(e,i,a,s);break;case t.EXTERNAL_VALUE_LIST:r=this.buildExternalAltValueList(e,i,a);break;default:return[]}}return r};i.prototype.getAltValueListForValueListAttr=function(t,e,i,a){return this.getAltValueList(e,t,i,a)};i.prototype.getAltTypedObjects=function(t,i,a,s){var r=t.getObjectsNames(i,a);if(s.length===0){return r}var l=[];var n,o;for(n=0;n<r.length;n++){o={};if(this.canObjectLeadToType(t,i,r[n].name,s,false,o)){r[n].tokenType=e.tokenTypesEnum.vocabulary;l.push(r[n])}}return l};i.prototype.getAltTypedAliases=function(i,a,s,r){var l=i.getAliases(a,s);l=l.hasOwnProperty("aliases")?l.aliases:l;if(r.length===0){return l}var n;var o;var u,f=false;var p;var c=[];for(n=0;n<l.length;n++){f=false;u=l[n].isCollection;p=l[n].businessDT===null?e.SIMPLE_SELECTION_VALUE_TYPE.COLLECTION.string:l[n].businessDT;if(u){f=l[n].type===t.ALIAS_CONTENT_DECISION_TABLE?true:false}for(o=0;o<r.length;o++){if(r[o].hasOwnProperty("isCollection")&&r[o].isCollection===u&&f===r[o].isDTAlias){if(r[o].type===p){l[n].tokenType=e.tokenTypesEnum.alias;c.push(l[n]);break}}}}return c};i.prototype.getTypedAssociation=function(t,e,i,a,s,r){var l=t.getAssociation(e,i,a,false);if(!l){return null}if(r.length===0){return l}var n=s;if(this.isCardinalityCollection(l.cardinality)){n=true}var o={};if(!this.canObjectLeadToType(t,e,l.target,r,n,o)){return null}return l};i.prototype.getAltTypedAssociations=function(t,i,a,s,r,l){var n=t.getObjectAssociationsNames(i,a,s);if(l.length===0){return n}var o=[];var u,f,p,c;for(u=0;u<n.length;u++){f=t.getAssociation(i,a,n[u].name,false);p=r;if(!this.isICollection&&this.isCardinalityCollection(f.cardinality)){p=true}c={};if(this.canObjectLeadToType(t,i,f.target,l,p,c)){n[u].tokenType=e.tokenTypesEnum.vocabulary;o.push(n[u])}}return o};i.prototype.isAttributeExists=function(t,e,i){if(i.isAttributeExists(e,t)){return true}return false};i.prototype.isTermPrefix=function(i,a,s,r){var l=null;if(!a){return false}if(r===e.DISPLAY_TEXT){l=t.TermModeRelated.TERM_MODE_BY_DESCRIPTION}else{l=t.TermModeRelated.TERM_MODE_BY_NAME}var n=this.getAltTypedTerms(a,s,i,[],null,null,null,null,null,null,null,l,null);if(n.length>0){return true}return false};i.prototype.isTermsExists=function(t,e){return t.isTermsExist(e)};i.prototype.validateNavigationDetails=function(i,a,s,r,l,n){var o={navigation:i,term:i,root:{name:null,isValid:false,isAlias:false,isDTAlias:false,vocabulary:null,businessDataType:null,altDO:[],altAlias:[],altDTAlias:[],altValueList:[]},associations:{isValid:false,path:[]},attribute:{name:null,dataType:null,size:null,businessDataType:null,vocabulary:null,sourceType:null,isValid:false,valueListName:null,altAttr:[],altAssoc:[]},isValid:false,isCollection:false,isVocaRule:false,modifiers:{},message:{id:"invalid_root_error_message",params:[]}};var u;if(!i){o.root.altDO=this.getAltTypedObjects(a,s,"",r);o.root.altAlias=this.getAltTypedAliases(a,s,"",r);o.root.altValueList=this.getAltValueList(a,s,l,null);return o}if(n===e.DISPLAY_TEXT){u=t.TermModeRelated.TERM_MODE_BY_DESCRIPTION}else{u=t.TermModeRelated.TERM_MODE_BY_NAME}var f=a.getTerm(s,i,u);if(f!==null){o.navigation=i=f.expression;o.modifiers=f.modifiers;o.isCollection=f.isCollection;o.isVocaRule=f.isVocaRuleTerm}var p=i.split(".");if(p.length>1){o.navigationFullPathId=this.getNavigationPathById(a,i)}if(p.length<1){o.root.altDO=this.getAltTypedObjects(a,s,"",r);o.root.altAlias=this.getAltTypedAliases(a,s,"",r);o.root.altValueList=this.getAltValueList(a,s,l,i);return o}o.root.name=p.shift();var c=null;var d=this.isTypedObjectExists(a,s,o.root.name,r);if(d===null){c=this.isTypedAliasExists(a,s,o.root.name,r)}if(d===null&&c===null){if(p.length===0){o.root.altDO=this.getAltTypedObjects(a,s,o.root.name,r);o.root.altAlias=this.getAltTypedAliases(a,s,o.root.name,r);o.root.altValueList=this.getAltValueList(a,s,l,null)}return o}if(d!==null){o.root.vocabulary=d.vocaName;o.root.id=d.id}o.isValid=o.root.isValid=true;o.message.id=null;if(c!==null){o.root.vocabulary=c.vocaName;o.root.isAlias=true;o.root.businessDataType=c.businessDT;o.root.isDTAlias=c.type===t.ALIAS_CONTENT_DECISION_TABLE?true:false;o.isCollection=c.isCollection;return o}var T=o.root.name;var y;var h;var v;var g;while(p.length>0){y=p.shift();h=new this.AssocInfo(y);v=this.getTypedAssociation(a,s,T,y,o.isCollection,r);if(!v){if(p.length>0){o.associations.isValid=o.isValid=false;h.alt=this.getAltTypedAssociations(a,s,T,y,o.isCollection,r);o.associations.path.push(h);o.message.id="invalid_assoc_error_message";return o}o.attribute.name=y;g=this.getTypedAttribute(a,s,T,y,o.isCollection,r);if(g){o.attribute.isValid=true;o.attribute.dataType=g.dataType;o.attribute.size=g.size;o.attribute.businessDataType=g.businessDataType;o.attribute.sourceType=g.sourceType;o.attribute.vocabulary=g.vocaName;o.attribute.valueListName=g.valueListName;o.attribute.id=g.id}else{o.isValid=false;o.message.id="invalid_assoc_or_attr_error_message";o.attribute.altAttr=this.getAltTypedAttributes(a,s,T,y,o.isCollection,r,n);o.attribute.altAssoc=this.getAltTypedAssociations(a,s,T,y,o.isCollection,r);return o}}else{h.isValid=true;h.vocabulary=v.vocaName;T=h.object=v.target;if(this.isCardinalityCollection(v.cardinality)&&!f){o.isCollection=h.isCollection=true}o.associations.isValid=true;o.associations.path.push(h)}}return o};i.prototype.getTypedParam=function(t,e){var i=t.getObjects();var a;for(a=0;a<i.length;a++){if(i[a].name===e){return i[a]}}return null};i.prototype.getTypedNestedParam=function(t,e,i){var a=t.getAssociations(e);var s=null;for(s in a){if(a.hasOwnProperty(s)&&s===i){return a[s]}}return null};i.prototype.getTypedParamAttribute=function(t,e,i){var a=t.getAttributes(e);var s=null;for(s in a){if(a.hasOwnProperty(s)&&s===i){return a[s]}}return null};i.prototype.isCollection=function(e){return e.dataType===t.DATA_TYPE_COLLECTION};i.prototype.isStruct=function(e){return e.dataType===t.DATA_TYPE_STRUCTURE};i.prototype.isDataObject=function(e){return e.dataType===t.DATA_TYPE_DATAOBJECT};i.prototype.isLeaf=function(t){return!this.isCollection(t)&&!this.isStruct(t)&&!this.isDataObject(t)};i.prototype.validateParamDetails=function(t,e,i,a,s){var r={navigation:e,root:{name:null,isValid:false},associations:{isValid:false,path:[]},attribute:{name:null,dataType:null,size:null,businessDataType:null,isValid:false},isValid:false,isCollection:false,isDataObject:false,message:{id:null,params:[]}};if(!e){return r}var l=e.split(".");if(l.length<1){return r}var n=l.shift();var o=l.length===0;var u=this.getTypedParam(t,n,s);if(!u){if(o){r.attribute.name=n;r.message.id="invalid_assoc_or_attr_error_message"}else{r.message.id="invalid_root_error_message";r.root.name=n}return r}if(o){r.isValid=true;if(this.isLeaf(u)){r.attribute.name=n;r.attribute.isValid=true;r.attribute.dataType=u.dataType;r.attribute.size=u.size;r.attribute.businessDataType=u.businessDataType}else{r.root.name=n;r.root.isValid=true;r.isCollection=this.isCollection(u);r.isDataObject=this.isDataObject(u)}return r}r.root.name=n;if(this.isLeaf(u)){r.message.id="invalid_root_data_type_error_message";return r}if(this.isDataObject(u)){var f=u.dataObject.name;var p;for(p=0;p<l.length;p++){f+=".";f+=l[p]}var c=this.validateNavigationDetails(f,i,a,s);c.root=r.root;c.isDataObject=true;return c}r.isCollection=this.isCollection(u);r.root.isValid=true;var d=r.root.name;var T,y,h,v;while(l.length>0){T=l.shift();y=new this.AssocInfo(T);h=this.getTypedNestedParam(t,d,T,r.isCollection,s);if(!h){if(l.length>0){r.message.id="invalid_assoc_error_message";r.associations.isValid=r.isValid=false;r.associations.path.push(y);return r}r.attribute.name=T;v=this.getTypedParamAttribute(t,d,T,r.isCollection,s);if(v){r.attribute.isValid=true;r.attribute.dataType=v.dataType;r.attribute.size=v.size;r.attribute.businessDataType=v.businessDataType;r.isValid=true}else{r.isValid=false;r.message.id="invalid_assoc_or_attr_error_message"}return r}y.isValid=true;d=y.object=h.name;if(this.isCollection(h)){r.isCollection=y.isCollection=true}r.associations.isValid=true;r.associations.path.push(y)}r.message.id="invalid_path_attr_not_found_error_message";return r};i.prototype.getNavigationCompletion=function(i,a,s,r,l,n,o,u,f,p,c,d,T){var y={altDO:[],altAlias:[],altValueList:[]};o=!o?false:o;var h=null;if(d===e.DISPLAY_TEXT){h=t.TermModeRelated.TERM_MODE_BY_DESCRIPTION}else{h=t.TermModeRelated.TERM_MODE_BY_NAME}y.altDO=this.getAltTypedTerms(a,s,i,r,n,o,u,f,true,p,c,h,T);y.altValueList=this.getAltValueList(a,s,l,i);if(!o){y.altAlias=this.getAltTypedAliases(a,s,i,r)}return y};i.prototype.getAttributeByDesc=function(t,e,i,a){return t.getAttributeByDesc(e,i,a)};i.prototype.getNavigationPathById=function(t,e){var i="";if(t&&e){var a=e.split(".");var s=t.allVocaObjects.allObjects;var r=t.allVocaObjects.allAssoc;var l=t.allVocaObjects.allAttr;var n="";if(r&&r.length>0){for(var o in a){for(var u in s){if(s[u].name===a[o]){n=s[u].id;i=i+s[u].id+"."}}}var f=a.length;var p=a[f-1];for(var c in l){if(p===l[c].name&&n===l[c].objId){i=i+l[c].id}}}else{var d=a[0];for(var T in s){if(d===s[T].name){n=s[T].id;i=i+s[T].id+"."}}var y=a[1];for(var h in l){if(y===l[h].name&&n===l[h].objId){i=i+l[h].id}}}}return i};return{vocabularyUtilsLib:i}},true);
//# sourceMappingURL=vocabularyUtils.js.map