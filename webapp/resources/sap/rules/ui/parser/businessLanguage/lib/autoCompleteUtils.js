sap.ui.define(["sap/rules/ui/parser/businessLanguage/lib/parseModel","sap/rules/ui/parser/businessLanguage/lib/constants","sap/rules/ui/parser/businessLanguage/lib/parseUtils","sap/rules/ui/parser/businessLanguage/lib/vocabularyUtils","sap/rules/ui/parser/businessLanguage/lib/parserTokens","sap/rules/ui/parser/businessLanguage/lib/utils","sap/rules/ui/parser/businessLanguage/lib/antlr3_all_min","sap/rules/ui/parser/infrastructure/errorHandling/hrfException","sap/base/Log"],function(t,e,n,i,o,s,a,r,l){"use strict";var u=new t.parseModelLib;var p=new n.parseUtilsLib;var g=new i.vocabularyUtilsLib;var f=new s;function T(){}T.prototype.overwriteParserReportError=function(t,e){t.reportError=function(n){function i(){u.getModelManger().setDFAFailed(true);e.contextInfo.valueListAttribute=u.getModelManger().getValueListAttribute();e.contextInfo.isDeprecatedAllContext=u.getModelManger().isAllContext();e.contextInfo.isTermAllContext=u.getModelManger().isTermAllContext()}function s(){u.getModelManger().cleanValueListAttribute();t.isInsideWhere=t.isInsideWhere!==undefined&&t.isInsideWhere===true?true:u.getModelManger().isInsideWhere;t.disableAliases=t.disableAliases!==undefined&&t.disableAliases===true?true:u.getModelManger().disableAliases;var e=u.getModelManger().contextQueue.length;if(e>0){var n=u.getModelManger().contextQueue[e-1];var i=n.associations.path.length;var o=i>0?n.associations.path[i-1].object:n.root.name;t.context=n.root.isAlias?null:o;t.fullContext=n;t.contextWasFound=true}else{if(t.hasOwnProperty("contextWasFound")===false||t.contextWasFound===false){t.context=null;t.fullContext=null;t.isInsideWhere=null}}}function l(){if(!t.lexerErrorOccurred){e.lastText=n.input.tokenSource.input.data;if(!(n.input.tokens.length===undefined||n.input.tokens.length===0)){var i=n.input.tokens.length-1;var s=n.input.tokens[n.input.tokens.length-1].stop+1;var r=n.input.tokens[n.input.tokens.length-1].start;for(i;i>=0;i--){if(n.input.tokens[i].channel!==a.antlr.runtime.Token.HIDDEN_CHANNEL&&n.input.tokens[i].type===o.NAVIGATION){r=n.input.tokens[i].start;break}}e.lastText=e.lastText.substring(r,s)}}}function g(){if(n instanceof a.antlr.runtime.NoViableAltException||n instanceof a.antlr.runtime.RecognitionException&&!(n instanceof a.antlr.runtime.UnwantedTokenException)){if(f.isInArray(n.decisionNumber,t.DFA_decisions)){p.handleFailedDFA(t,n,e)}}else if(n instanceof a.antlr.runtime.MismatchedTokenException){if(n instanceof a.antlr.runtime.UnwantedTokenException){e.isPartialText=e.isPartialText||p.isLastTokenPartialText(t)}}}i();s();l();g();throw new r.HrfException}};T.prototype.overwriteLexerReportError=function(t,e,n){t.reportError=function(t){if(e.lexerErrorOccurred===false){e.lexerErrorOccurred=true;e.lexerErrorStartIndex=t.input.markers[1].charPositionInLine;if(t instanceof a.antlr.runtime.NoViableAltException){var i=t.input.data;n.lastText=i.substring(t.input.p,t.input.n);n.isPartialText=true}if((t instanceof a.antlr.runtime.MismatchedTokenException||t instanceof a.antlr.runtime.MismatchedSetException||t instanceof a.antlr.runtime.EarlyExitException)&&t.c===-1){var o=e.input.tokens.length;if(o>0){var s=e.input.tokens[o-1].stop+1;var l=t.input.data;n.lastText=l.substring(s,t.input.n)}else{n.lastText=t.input.data}n.isPartialText=true}else if(t.c===" "){throw new r.HrfException}}}};T.prototype.insertTermsAlternatives=function(t,n,i,o){var s="";var a;var r;for(a=0;a<t.length;a++){r=n===null?t[a]:t[a].substring(n.length);s=s+o+'{"text":"'+t[a]+'", "completion":"'+i+r+'", "tokenType":"'+e.tokenTypesEnum.vocabulary+'"';s=s+"}";o=","}return s};T.prototype.insertOMAlternatives=function(t,e,n,i,o,s){var a="";var r;e.sort(function(t,e){if(t.name>e.name){return 1}if(t.name<e.name){return-1}return 0});var l,p;var g=JSON.stringify(n);g=g.substring(1,g.length-1);var f;var T=null;for(r=0;r<e.length;r++){if(e[r].tokenType==="vocabulary"&&s==="displayText"){T=e[r].description}else{T=e[r].name}f=JSON.stringify(T);f=f.substring(1,f.length-1);l=g===null?f:f.substring(g.length);if(this.navigationCompletionInfo.isValueListSuggestions){if(t.getValueListType(u.getModelManger().vocabulary,f)==="External"){f=l="<Value Help>";i=""}}p=e[r].info?JSON.stringify(e[r].info):null;a=a+o+'{"text":"'+f+'", "completion":"'+i+l+'", "tokenType":"'+e[r].tokenType+'"';if(p){a=a+","+'"info":'+p}a=a+"}";o=","}return a};T.prototype.completeByValueListInLexerError=function(t,e){var n="";if(e.lexerErrorOccurred){var i=g.getAltValueListForValueListAttr(u.getModelManger().vocabulary,t,this.parsingOutputInfo.contextInfo.valueListAttribute,this.parsingOutputInfo.lastText);if(i.length>0){this.startSuggestionList();var o="";n+=this.insertOMAlternatives(t,i,this.parsingOutputInfo.lastText,"",o,null);this.navigationCompletionInfo.isValueListSuggestions=true;this.strSuggestions+=n;return true}}return false};T.prototype.filterTypes=function t(e,n,i){var s=[];if(e===o.COUNT_OF||e===o.NUMBER_OF){s[0]=i[o.TYPECOLLECTION].toLowerCase()}else{s=n}return s};T.prototype.convertNavigationRELTypesToBusinessTypes=function(t){var n;var i;var s;var a=t.getTokenNames();var r=f.removeDuplicate(this.parsingOutputInfo.allowedTypes);var l=p.getLastTokenTypeAndIgnoreWS(t);r=this.filterTypes(l,r,a);for(n=0;n<r.length;n++){i={};s={};switch(r[n]){case a[o.TYPENUMBER].toLowerCase():i.isCollection=false;i.isDTAlias=false;i.type=e.SIMPLE_SELECTION_VALUE_TYPE.INTEGER.string;break;case a[o.TYPEBOOLEAN].toLowerCase():i.isCollection=false;i.isDTAlias=false;i.type=e.SIMPLE_SELECTION_VALUE_TYPE.BOOLEAN.string;break;case a[o.TYPESTRING].toLowerCase():i.isCollection=false;i.isDTAlias=false;i.type=e.SIMPLE_SELECTION_VALUE_TYPE.STRING.string;break;case a[o.TYPEDATE].toLowerCase():i.isCollection=false;i.isDTAlias=false;i.type=e.SIMPLE_SELECTION_VALUE_TYPE.DATE.string;break;case a[o.TYPETIME].toLowerCase():i.isCollection=false;i.isDTAlias=false;i.type=e.SIMPLE_SELECTION_VALUE_TYPE.TIME.string;break;case a[o.TYPETIMESTAMP].toLowerCase():i.isCollection=false;i.isDTAlias=false;i.type=e.SIMPLE_SELECTION_VALUE_TYPE.TIMESTAMP.string;break;case a[o.TYPETIMEINTERVAL].toLowerCase():i.isCollection=false;i.isDTAlias=false;i.type=e.SIMPLE_SELECTION_VALUE_TYPE.TIMESPAN.string;break;case a[o.TYPENUMBERCOLLECTION].toLowerCase():i.isCollection=true;i.isDTAlias=false;i.type=e.SIMPLE_SELECTION_VALUE_TYPE.INTEGER.string;break;case a[o.TYPEBOOLEANCOLLECTION].toLowerCase():i.isCollection=true;i.isDTAlias=false;i.type=e.SIMPLE_SELECTION_VALUE_TYPE.BOOLEAN.string;break;case a[o.TYPESTRINGCOLLECTION].toLowerCase():i.isCollection=true;i.isDTAlias=false;i.type=e.SIMPLE_SELECTION_VALUE_TYPE.STRING.string;break;case a[o.TYPEDATECOLLECTION].toLowerCase():i.isCollection=true;i.isDTAlias=false;i.type=e.SIMPLE_SELECTION_VALUE_TYPE.DATE.string;break;case a[o.TYPETIMECOLLECTION].toLowerCase():i.isCollection=true;i.isDTAlias=false;i.type=e.SIMPLE_SELECTION_VALUE_TYPE.TIME.string;break;case a[o.TYPETIMESTAMPCOLLECTION].toLowerCase():i.isCollection=true;i.isDTAlias=false;i.type=e.SIMPLE_SELECTION_VALUE_TYPE.TIMESTAMP.string;break;case a[o.TYPETIMEINTERVALCOLLECTION].toLowerCase():i.isCollection=true;i.isDTAlias=false;i.type=e.SIMPLE_SELECTION_VALUE_TYPE.TIMESPAN.string;break;case a[o.TYPENUMBERDT].toLowerCase():i.isCollection=true;i.isDTAlias=true;i.type=e.SIMPLE_SELECTION_VALUE_TYPE.INTEGER.string;break;case a[o.TYPEBOOLEANDT].toLowerCase():i.isCollection=true;i.isDTAlias=true;i.type=e.SIMPLE_SELECTION_VALUE_TYPE.BOOLEAN.string;break;case a[o.TYPESTRINGDT].toLowerCase():i.isCollection=true;i.isDTAlias=true;i.type=e.SIMPLE_SELECTION_VALUE_TYPE.STRING.string;break;case a[o.TYPEDATEDT].toLowerCase():i.isCollection=true;i.isDTAlias=true;i.type=e.SIMPLE_SELECTION_VALUE_TYPE.DATE.string;break;case a[o.TYPETIMEDT].toLowerCase():i.isCollection=true;i.isDTAlias=true;i.type=e.SIMPLE_SELECTION_VALUE_TYPE.TIME.string;break;case a[o.TYPETIMESTAMPDT].toLowerCase():i.isCollection=true;i.isDTAlias=true;i.type=e.SIMPLE_SELECTION_VALUE_TYPE.TIMESTAMP.string;break;case a[o.TYPETIMEINTERVALDT].toLowerCase():i.isCollection=true;i.isDTAlias=true;i.type=e.SIMPLE_SELECTION_VALUE_TYPE.TIMESPAN.string;break;case a[o.TYPECOLLECTION].toLowerCase():i.isCollection=true;i.isDTAlias=false;i.type=null;break;default:continue}s=JSON.parse(JSON.stringify(i));if(s.isCollection!==true){s.isCollection=true;this.navigationCompletionInfo.collectionBusinessTypes.push(i)}else{this.navigationCompletionInfo.completeCollection=true}this.navigationCompletionInfo.collectionBusinessTypes.push(s);this.navigationCompletionInfo.simpleBusinessTypes.push(i)}};T.prototype.calcSpacePrefixAdditionForNonNavigation=function(t){if(!this.isPartialCompletion()&&!f.isEmptyArray(t.input.tokens)&&t.input.tokens[t.input.tokens.length-1].type!==o.WS){return" "}return""};T.prototype.calcSpacePrefixAdditionForNavigation=function(t){if(!this.isPartialCompletion()&&!f.isEmptyArray(t.input.tokens)&&t.input.tokens[t.input.tokens.length-1].type!==o.WS&&t.input.tokens[t.input.tokens.length-1].type!==o.NAVIGATION&&t.input.tokens[t.input.tokens.length-1].type!==o.ALL){return" "}return""};T.prototype.calculateNavigationStartText=function(){if(this.isPartialCompletion()){this.navigationCompletionInfo.navigationTextInput=this.parsingOutputInfo.lastText}else{this.navigationCompletionInfo.navigationTextInput=""}};T.prototype.isPartialCompletion=function(){return this.parsingOutputInfo.isPartialText};T.prototype.handleEmptyNextTokens=function(t){if(f.isEmptyArray(this.parsingOutputInfo.nextTokens)){if(this.isPartialCompletion()&&t.lexerErrorOccurred){this.parsingOutputInfo.nextTokens=t.getTokenNames();this.parsingOutputInfo.allTokens=true}}};T.prototype.disableToken=function(t,e,n,i,s){var a=false;var r=p.getTokensDisplayMap(s);a=n===r.DOT&&p.endsWith(this.parsingOutputInfo.lastText.toLowerCase()," ")||n===r.COUNT_OF||n===r.MAXIMUM_OF||n===r.MINIMUM_OF||n===r.FIRST||n===r.LAST||i===o.CURRENT&&!e.isInsideWhere||n===r.EQ_SIGN||n===r.NOT_EQUAL_SIGN||n===r.GREATER_EQUAL_SIGN||n===r.LESS_EQUAL_SIGN||n===r.GREATER_SIGN||n===r.LESS_SIGN||n===r.EQUALS||n===r.DOES_NOT_EQUAL||n===r.NOT_EQUAL||n===r.ZERO_OR_ONE||i===o.CURRENT&&this.parsingOutputInfo.contextInfo.isDeprecatedAllContext===false&&!this.parsingOutputInfo.contextInfo.isTermAllContext||i===o.ALL_OF_OBJ||i===o.ALL&&!t.isTermModifierEmpty(u.getModelManger().vocabulary)||i===o.OF&&!t.isTermModifierEmpty(u.getModelManger().vocabulary)||i===o.CURRENT&&!t.isCurrentTermModifierEmpty(u.getModelManger().vocabulary);return a};T.prototype.disableAdvancedFunctions=function(t,e){var n=t.getAdvancedFunctions(u.getModelManger().vocabulary);if(!p.advancedFunctions.hasOwnProperty(e)){return false}var i;for(i=0;i<n.advancedFunctions.length;i++){if(n.advancedFunctions[i].name===p.advancedFunctions[e]){return false}}return true};T.prototype.disableGreaterOrLessThenOps=function(t,e){if(t===o.IS_EQUAL_OR_GREATER_THAN||t===o.IS_GREATER_THAN||t===o.GREATER_THAN||t===o.IS_EQUAL_OR_LESS_THAN||t===o.IS_LESS_THAN||t===o.LESS_THAN){var n=p.getLastTokenTypeAndIgnoreWS(e);if(n===o.TYPETIME||n===o.TYPEDATE||n===o.TYPETIMESTAMP){return true}}return false};T.prototype.disableDateTimeFormatsForString=function(t,e,n){var i=false;var s=p.getTokensDisplayMap(n);if(f.isInArray(o.TYPESTRING.toString(),e)&&!(f.isInArray(o.TYPETIMESTAMP.toString(),e)||f.isInArray(o.TYPEDATE.toString(),e)||f.isInArray(o.TYPETIME.toString(),e))){i=t===s.DATESTRING||t===s.TIMESTAMPSTRING||t===s.TIMESTRING}return i};T.prototype.getTokenName=function(t,e){var n=e.getTokenNames();var i=e.parseModelLib.getModelManger();var o=p.getTokensDisplayMap(i);var s=n[t];if(o.hasOwnProperty(s)){s=o[s]}if(s===o.DATESTRING||s===o.TIMESTAMPSTRING||s===o.TIMESTRING){return s}return s.toLowerCase()};T.prototype.disableNumericFragements=function(t,e,n){var i=false;var s=p.getTokensDisplayMap(n);if(f.isInArray(o.ZERO_TO_ONE.toString(),e)&&(f.isInArray(o.INT.toString(),e)||f.isInArray(o.DECIMAL.toString(),e))){i=t===s.ZERO_TO_ONE}return i};T.prototype.isValidTokenToSuggest=function(t,e,n){var i=!t||t==="<eor>"||n||this.isPartialCompletion()&&e!==this.parsingOutputInfo.lastText.toLowerCase()||t.indexOf("parameter")!==-1;return!i};T.prototype.checkNavigationToken=function(t){var e=false;if(t.lastIndexOf("type",0)===0&&t.indexOf("parameter",0)<0||t==="navigation"){e=true;this.parsingOutputInfo.navigationCompleteion=true;if(t!=="navigation"){this.parsingOutputInfo.allowedTypes.push(t)}}return e};T.prototype.filterTokens=function(t,e){var n=[];var i="<eor>";var o=-1;var s=0;var a="";var r=false;var l={};var u=e.parseModelLib.getModelManger();this.parsingOutputInfo.nextTokens=f.removeDuplicate(this.parsingOutputInfo.nextTokens);for(s=0;s<this.parsingOutputInfo.nextTokens.length;s++){r=false;i="<eor>";o=this.parsingOutputInfo.allTokens?s:parseInt(this.parsingOutputInfo.nextTokens[s],10);if(o>0){i=this.getTokenName(o,e)}a=i.substring(0,this.parsingOutputInfo.lastText.length);if(this.disableToken(t,e,i,o,u)){continue}if(this.disableAdvancedFunctions(t,i)){continue}if(this.disableDateTimeFormatsForString(i,this.parsingOutputInfo.nextTokens,u)){continue}if(this.disableNumericFragements(i,this.parsingOutputInfo.nextTokens,u)){continue}if(this.disableGreaterOrLessThenOps(o,e)){continue}r=this.checkNavigationToken(i);if(this.isValidTokenToSuggest(i,a,r)){l={};l.type=o;l.name=i;n.push(l)}}n=f.removeDupplicateByName(n);n.sort(function(t,e){if(t>e){return 1}if(t<e){return-1}return 0});return n};T.prototype.handleWhitespaceCharsInLastText=function(){if(p.isEmptyString(this.parsingOutputInfo.lastText)){this.parsingOutputInfo.lastText=""}this.parsingOutputInfo.lastText=this.parsingOutputInfo.lastText.replace(/\s+/g," ")};T.prototype.startSuggestionList=function(){this.strSuggestions="["};T.prototype.closeSuggestionList=function(){if(this.strSuggestions.charAt(this.strSuggestions.length-1)===","){this.strSuggestions=this.strSuggestions.slice(0,this.strSuggestions.length-1)}this.strSuggestions=this.strSuggestions+"]";this.strSuggestions=this.strSuggestions.replace(/\\/g,"\\\\")};T.prototype.prepareContextSuggestionsInsideWhere_dotMode=function(t,e,n,i){if(this.navigationCompletionInfo.navigationTextInput.indexOf(".")!==-1&&this.parsingOutputInfo.contextInfo.contextNavigation!==null&&this.navigationCompletionInfo.completeCollection===false&&e!==o.CURRENT){var s=this.navigationCompletionInfo.navigationTextInput.substring(0,this.navigationCompletionInfo.navigationTextInput.lastIndexOf("."));if(this.parsingOutputInfo.contextInfo.contextNavigation.navigation.indexOf(s)===0){if(n.length>2){var a=g.validateNavigationDetails(this.navigationCompletionInfo.navigationTextInput,t,u.getModelManger().vocabulary,this.navigationCompletionInfo.collectionBusinessTypes,this.parsingOutputInfo.contextInfo.valueListAttribute);if(a.isValid===false&&a.attribute.altAttr.length>0){this.navigationCompletionInfo.navSuggestions+=this.insertOMAlternatives(t,a.attribute.altAttr,a.attribute.name,i,this.navigationCompletionInfo.commaDelimiter,null);this.navigationCompletionInfo.commaDelimiter=","}}var r=this.parsingOutputInfo.contextInfo.contextNavigation.navigation.substring(0,this.parsingOutputInfo.contextInfo.contextNavigation.navigation.lastIndexOf("."));if(s!==r&&r.indexOf(this.navigationCompletionInfo.navigationTextInput)===0){var l=r.replace(this.navigationCompletionInfo.navigationTextInput,"");var p=l.split(".");this.navigationCompletionInfo.navSuggestions=this.navigationCompletionInfo.navSuggestions+this.navigationCompletionInfo.commaDelimiter+'{"text":"'+i+n[n.length-1]+p[0]+'", "completion":"'+i+p[0]+'"}';this.navigationCompletionInfo.commaDelimiter=","}}}};T.prototype.prepareContextAttrsSuggestionsInsideWhere=function(t,e){var n=u.getModelManger().termMode;if(this.parsingOutputInfo.contextInfo.contextDO!==null&&!p.endsWith(this.navigationCompletionInfo.navigationTextInput,".")&&(this.navigationCompletionInfo.completeCollection===false&&e!==o.CURRENT)){var i=this.parsingOutputInfo.contextInfo.contextDO+"."+this.navigationCompletionInfo.navigationTextInput;var s=g.validateNavigationDetails(i,t,u.getModelManger().vocabulary,this.navigationCompletionInfo.simpleBusinessTypes,this.parsingOutputInfo.contextInfo.valueListAttribute,n);if(s.isValid===false&&s.associations.isValid===false&&s.attribute.altAttr.length>0){this.navigationCompletionInfo.navAlternatives=s.attribute.altAttr}}};T.prototype.prepareContextCompletion=function(t,e,n,i){this.prepareContextSuggestionsInsideWhere_dotMode(t,e,n,i);this.prepareContextAttrsSuggestionsInsideWhere(t,e,i)};T.prototype.completeNavSuggestions_dotMode=function(t,e,n){var i=null;i=g.validateNavigationDetails(this.navigationCompletionInfo.navigationTextInput,t,u.getModelManger().vocabulary,this.navigationCompletionInfo.simpleBusinessTypes,this.parsingOutputInfo.contextInfo.valueListAttribute);if(i.isValid===false){if(i.root.isValid===false){if(this.parsingOutputInfo.contextInfo.valueListAttribute){this.navigationCompletionInfo.isValueListSuggestions=true;this.navigationCompletionInfo.navAlternatives=[];this.navigationCompletionInfo.navAlternatives=this.navigationCompletionInfo.navAlternatives.concat(i.root.altValueList)}this.navigationCompletionInfo.navAlternatives=this.navigationCompletionInfo.navAlternatives.concat(i.root.altDO);if(e.disableAliases===false){this.navigationCompletionInfo.navAlternatives=this.navigationCompletionInfo.navAlternatives.concat(i.root.altAlias)}this.navigationCompletionInfo.navSuggestions+=this.insertOMAlternatives(t,this.navigationCompletionInfo.navAlternatives,i.root.name,n,this.navigationCompletionInfo.commaDelimiter,null);this.navigationCompletionInfo.navAlternatives=[]}else{this.navigationCompletionInfo.navAlternatives=this.navigationCompletionInfo.navAlternatives.concat(i.attribute.altAssoc);this.navigationCompletionInfo.navSuggestions+=this.insertOMAlternatives(t,i.attribute.altAttr.concat(this.navigationCompletionInfo.navAlternatives),i.attribute.name,n,this.navigationCompletionInfo.commaDelimiter,null);this.navigationCompletionInfo.navAlternatives=[]}}};T.prototype.completeNavSuggestions_termsMode=function(t,n,i,s,a){var r=null;if(this.parsingOutputInfo.contextInfo.contextNavigation!==null){var l=this.parsingOutputInfo.contextInfo.contextNavigation.navigation.split(".");if(this.parsingOutputInfo.contextInfo.contextNavigation.attribute.isValid){l.pop()}r=l.length===0?this.parsingOutputInfo.contextInfo.contextNavigation.navigation:l.join(".")}var p=s===o.CURRENT?true:false;if(p&&r){var f=r.split(".");r=f.length>0?f[0]:r}else if(s===o.ALL){r=null}var T=u.getModelManger().termMode;var c=null;var I=false;if(u.getModelManger().flags.hasOwnProperty(e.propertiesEnum.noAssocSuggestion)){I=u.getModelManger().flags[e.propertiesEnum.noAssocSuggestion]}var v=this.parsingOutputInfo.contextInfo.valueListAttribute;if(!this.parsingOutputInfo.contextInfo.valueListAttribute&&a){v=a}c=g.getNavigationCompletion(this.navigationCompletionInfo.navigationTextInput,t,u.getModelManger().vocabulary,this.navigationCompletionInfo.simpleBusinessTypes,v,r,p,this.navigationCompletionInfo.completeCollection,this.parsingOutputInfo.contextInfo.isDeprecatedAllContext,n.isInsideWhere,this.parsingOutputInfo.contextInfo.isTermAllContext,T,I);if(c.altValueList.length>0){this.navigationCompletionInfo.isValueListSuggestions=true;this.navigationCompletionInfo.navAlternatives=c.altValueList}if(n.disableAliases===false&&c.altAlias.length>0){this.navigationCompletionInfo.navAlternatives=this.navigationCompletionInfo.navAlternatives.concat(c.altAlias)}if(c.altDO.length>0){this.navigationCompletionInfo.navSuggestions+=this.insertTermsAlternatives(c.altDO,this.navigationCompletionInfo.navigationTextInput,i,this.navigationCompletionInfo.commaDelimiter);this.navigationCompletionInfo.commaDelimiter=","}if(this.navigationCompletionInfo.navAlternatives.length>0){this.navigationCompletionInfo.navSuggestions+=this.insertOMAlternatives(t,this.navigationCompletionInfo.navAlternatives,this.navigationCompletionInfo.navigationTextInput,i,this.navigationCompletionInfo.commaDelimiter,T);this.navigationCompletionInfo.navAlternatives=[]}};T.prototype.isDotMode=function(t){return this.navigationCompletionInfo.navigationTextInput.indexOf(".")!==-1||!g.isTermsExists(t,u.getModelManger().vocabulary)||u.getModelManger().flags.hasOwnProperty(e.propertiesEnum.disableTerms)&&u.getModelManger().flags[e.propertiesEnum.disableTerms]};T.prototype.isTermMode=function(t){return g.isTermsExists(t,u.getModelManger().vocabulary)&&(!u.getModelManger().flags.hasOwnProperty(e.propertiesEnum.disableTerms)||!u.getModelManger().flags[e.propertiesEnum.disableTerms])};T.prototype.addNavigationSuggestions=function(t,e,n){var i="";this.initNavigationInfo();if(this.parsingOutputInfo.navigationCompleteion){if(this.completeByValueListInLexerError(t,e)){return}i=this.calcSpacePrefixAdditionForNavigation(e);this.calculateNavigationStartText();this.convertNavigationRELTypesToBusinessTypes(e);var s=p.getLastTokenTypeAndIgnoreWS(e);var a=this.navigationCompletionInfo.navigationTextInput.split(".");this.parsingOutputInfo.contextInfo.isDeprecatedAllContext=this.parsingOutputInfo.contextInfo.isDeprecatedAllContext||s===o.ALL;this.prepareContextCompletion(t,s,a,i);if(this.isTermMode(t)){this.completeNavSuggestions_termsMode(t,e,i,s,n)}if(this.isDotMode(t)){this.completeNavSuggestions_dotMode(t,e,i)}l.debug("Autocopmlete: End : this.navigationCompletionInfo.navSuggestions - "+this.navigationCompletionInfo.navSuggestions);if(this.navigationCompletionInfo.isValueListSuggestions){this.startSuggestionList()}this.strSuggestions+=this.navigationCompletionInfo.navSuggestions}};T.prototype.addNonNavigationSuggestions=function(t,e){var n;var i=null;var o={};var s="";if(t.length>0&&this.strSuggestions.length>1){this.strSuggestions+=","}for(n=0;n<t.length;n++){i=null;s=t[n].name;if(this.isPartialCompletion()){i=s.substring(this.parsingOutputInfo.lastText.length,s.length)}else{i=s}if(i){o=p.getTokenTypeMetadata(t[n].type,s,0,false,u.getModelManger());this.strSuggestions+='{"text":"'+s+'","completion":"'+e+i+'","tokenType":"'+o.group+'","info":'+JSON.stringify(o.info)+"},"}}};T.prototype.setDOContext=function(t){if(t.hasOwnProperty("context")){this.parsingOutputInfo.contextInfo.contextDO=t.context}if(t.hasOwnProperty("fullContext")){this.parsingOutputInfo.contextInfo.contextNavigation=t.fullContext;this.parsingOutputInfo.contextInfo.isTermAllContext=this.parsingOutputInfo.contextInfo.isTermAllContext||t.fullContext&&t.fullContext.modifiers&&t.fullContext.modifiers.hasOwnProperty("all")}};T.prototype.initParsingOutputInfo=function(t){this.parsingOutputInfo={nextTokens:[],lastText:t,isPartialText:false,allTokens:false,allowedTypes:[],navigationCompleteion:false,contextInfo:{contextDO:null,contextNavigation:null,valueListAttribute:null,isDeprecatedAllContext:false,isTermAllContext:false}}};T.prototype.initNavigationInfo=function(){this.navigationCompletionInfo={simpleBusinessTypes:[],collectionBusinessTypes:[],completeCollection:false,isValueListSuggestions:false,navigationTextInput:"",navAlternatives:[],navSuggestions:"",commaDelimiter:""}};T.prototype.getNextSuggestions=function(t,n,i,o,s,a){var r="";var l=[];this.startSuggestionList();this.initParsingOutputInfo(t);this.overwriteParserReportError(i,this.parsingOutputInfo);this.overwriteLexerReportError(n,i,this.parsingOutputInfo);var g=s===e.TYPE_ALL?e.TYPE_AUTOCOMPLETE:s;p.parseType(i,g);this.setDOContext(i);if(i.lastExpecting.reachedEOF||this.parsingOutputInfo.isPartialText){this.parsingOutputInfo.nextTokens=i.lastExpecting.expecting;if(i.lastExpecting.isPartialText){this.parsingOutputInfo.isPartialText=i.lastExpecting.isPartialText}}else{this.parsingOutputInfo.nextTokens=[]}r=this.calcSpacePrefixAdditionForNonNavigation(i);this.handleEmptyNextTokens(i);l=this.filterTokens(o,i);this.handleWhitespaceCharsInLastText();if(o.getTermModes().indexOf("byDescription")!==-1){u.getModelManger()[e.propertiesEnum.termMode]=e.DISPLAY_TEXT}this.addNavigationSuggestions(o,i,a);this.addNonNavigationSuggestions(l,r);this.closeSuggestionList();return this.strSuggestions};return{autoCompleteUtilsLib:T}},true);
//# sourceMappingURL=autoCompleteUtils.js.map