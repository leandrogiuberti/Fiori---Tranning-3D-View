sap.ui.define(["sap/rules/ui/parser/businessLanguage/lib/constants","sap/rules/ui/parser/businessLanguage/lib/entityModelConstractor","sap/rules/ui/parser/businessLanguage/lib/utils","sap/rules/ui/parser/resources/dependencies/lib/constantsBase","sap/rules/ui/parser/resources/vocabulary/lib/constantsBase","sap/rules/ui/parser/businessLanguage/lib/parseUtils","sap/rules/ui/parser/resources/dependencies/lib/objects"],function(t,e,i,n,s,r,a){"use strict";var o=new r.parseUtilsLib;var u=new i;function l(){}l.prototype.ModelManager=function(){var i=this;this.nextTokens=[];this.contextQueue=[];this.isInsideWhere=false;this.disableAliases=false;this.lastValueListAttribute=null;this.allContext=false;this.allTermContext=false;this.DFAFaildMode=false;this.terms=[];this.term=null;this.expression=null;this.vocaRTServ=null;this.actualReturnType=null;this.modelOutput=null;this.tokensContext=null;this.parseResult={status:t.statusEnum.SUCCESS,errorDetails:[],errorID:null,cursorPosition:0,actualReturnType:null,businessDataType:null,isCollection:false,clear:function(){this.errorDetails=[];this.errorID=null;this.cursorPosition=0;this.status=t.statusEnum.SUCCESS;this.actualReturnType=null;this.businessDataType=null;this.isCollection=false},getParseResults:function(){var e;if(this.status===t.statusEnum.SUCCESS){var s=o.getBusinessDTFromRelType(i.actualReturnType);e={status:t.statusEnum.SUCCESS,errorDetails:null,errorID:null,model:i.modelOutput,cursorPosition:null,actualReturnType:i.actualReturnType,businessDataType:s[t.propertiesEnum.businessType],isCollection:s[t.propertiesEnum.isCollection]};if(i.actualReturnType===t.TYPE_COLLECTION){e.dataObject=i.dataObject}}else{e={status:t.statusEnum.ERROR,errorDetails:this.getErrors(),errorID:this.errorID,model:null,cursorPosition:this.cursorPosition,actualReturnType:null,businessDataType:null,isCollection:false};if(this.hasOwnProperty(t.propertiesEnum.convertedExpression)){e.convertedExpression=null}}if(i.hasOwnProperty(t.propertiesEnum.flags)&&i.flags.hasOwnProperty(n.PROPERTY_NAME_DEPENDENCIES_OUTPUT)&&i.flags[n.PROPERTY_NAME_DEPENDENCIES_OUTPUT]===true){e[n.PROPERTY_NAME_DEPENDENCIES_OUTPUT]=this.status===t.statusEnum.ERROR?null:i.getDependencies()}if(i.hasOwnProperty(t.propertiesEnum.flags)&&i.flags.hasOwnProperty(t.propertiesEnum.unknownTokens)&&i.flags[t.propertiesEnum.unknownTokens]===true){e[t.propertiesEnum.unknownTokens]=this.status===t.statusEnum.ERROR&&i.hasOwnProperty(t.propertiesEnum.unknownTokens)?i[t.propertiesEnum.unknownTokens]:{}}return e},getErrors:function(){var t="";var e=0;for(e;e<this.errorDetails.length;++e){t+=this.errorDetails[e]+"\n"}return t}};this.popFromContextQueue=function(){this.contextQueue.pop()};this.pushToContextQueue=function(t){this.contextQueue.push(t)};this.clearTermsArray=function(){this.terms=[]};this.clearCurrentTerm=function(){this.term=null};this.setCurrentTerm=function(t){if(this.term===null){this.term={}}this.term.text=t;this.term.whitechar=""};this.setCurrentTermWhiteChar=function(t){if(this.term===null){this.term={};this.term.text=""}this.term.whitechar=t};this.getCurrentTerm=function(){if(this.term===null){return null}return this.term.text};this.getCurrentTermWhiteChar=function(){if(this.term===null){return""}return this.term.whitechar};this.setTokenContext=function(t,e,i){if(this.tokensContext===null){this.tokensContext={}}this.tokensContext[t]={token:e,dataObjectContext:i}};this.getTokenContext=function(t,e){if(this.tokensContext===null){return null}var i=this.tokensContext[t];if(i&&i.token===e){return i.dataObjectContext}return null};var r={};this.dateTimeObjectsDictionary={};var l={};var h={};this.setDFAFailed=function(t){this.DFAFaildMode=t};this.getDFAFailed=function(){return this.DFAFaildMode};this.setLastValueListAttribute=function(t){this.lastValueListAttribute=t};this.cleanValueListAttribute=function(){this.lastValueListAttribute=null};this.getValueListAttribute=function(){return this.lastValueListAttribute};this.setTermAllContext=function(){this.allTermContext=true};this.setAllContext=function(){this.allContext=true};this.cleanAllContext=function(){this.allTermContext=false;this.allContext=false};this.isAllContext=function(){return this.allContext};this.isTermAllContext=function(){return this.allTermContext};this.setCurrentNavigationObject=function(t,e){l[t]=e;var i=this.contextQueue.length;if(i===0){return}var n=this.contextQueue[i-1];if(n.root.isAlias||n.root.isParameter){return}if(h.hasOwnProperty(n.navigation)===false){h[n.navigation]={}}h[n.navigation][t]=e};this.getCurrentNavigationObject=function(t){if(l[t]===undefined){return null}var e=this.contextQueue.length;if(e===0){return l[t]}var i=this.contextQueue[e-1];if(i.root.isAlias||i.root.isParameter){return l[t]}if(h.hasOwnProperty(i.navigation)===false){return l[t]}if(h[i.navigation][t]===undefined){return l[t]}return h[i.navigation][t]};this.getNavigationFromDictionary=function(t){return r[t]};this.addDateTimeObject=function(t,e){this.dateTimeObjectsDictionary[t]=e};this.getDateTimeObject=function(t){if(this.dateTimeObjectsDictionary[t]===undefined){return null}return this.dateTimeObjectsDictionary[t]};this.clearModelData=function(){this.allContext=false;this.allTermContext=false;this.lastValueListAttribute=null;this.DFAFaildMode=false;this.term=null;this.terms=[];this.vocabulary=null;this.vocaRTServ=null;this.expression=null;this.mode=null;this.paramServ=null;this.contextQueue=[];this.isInsideWhere=false;this.disableAliases=false;this[t.propertiesEnum.unknownTokens]={};this[t.propertiesEnum.rootObjectContext]={name:null,assocNames:{},assocs:[]};r={};l={};this.modelOutput=null;this.actualReturnType=null;this.tokensContext=null};this.clearTerm=function(){this.terms=[]};this.modelManagerOutput=function(e){if(arguments.length!==1){o.handleWarning("wrong number of arguments for output model")}var n=e.getType();if(n!==t.objectNamesEnum.model){o.handleWarning("failed to create the output Model, unexpected model type")}i.modelOutput=e};this.addStatement=function(t){var e=t.constructor.name;if(!(e==="Statement"||e==="Operator")){o.handleWarning("failed to add "+t.toString()+" to statement array")}this.statementArray.push(t)};this.createWhereFilter=function(t){if(t!==null&&t.hasOwnProperty("selection")){var i=new e.SimpleStatementFilter(t);return i}else{var n=new e.ComplexStatementFilter(t);return n}};this.getDependencies=function(){var t=null;var e=null;var i,n,o,l,h;for(e in r){if(r.hasOwnProperty(e)){i=this.getCurrentNavigationObject(e);if(!i.isValid||i.isParameter){continue}t=t===null?{}:t;n=i.root.name;if(i.root.isAlias){t[s.PROPERTY_NAME_ALIASES+"."+n]=new a.VocaAlias(n,i.root.vocabulary)}else{t[s.PROPERTY_NAME_DATA_OBJECTS+"."+n]=new a.VocaDOInfo(n,i.root.vocabulary)}o=n;l=i.associations.path;if(!u.isEmptyArray(l)){for(h=0;h<l.length;h++){t[s.PROPERTY_NAME_DATA_OBJECTS+"."+o+"."+s.PROPERTY_NAME_OM_ASSOCIATIONS+"."+l[h].name]=new a.VocaDOAssociation(o,l[h].name,l[h].vocabulary);o=l[h].object}}if(i.attribute.isValid){t[s.PROPERTY_NAME_DATA_OBJECTS+"."+o+"."+s.PROPERTY_NAME_ATTRIBUTES+"."+i.attribute.name]=new a.VocaDOAttributes(o,i.attribute.name,i.attribute.vocabulary)}}}return t};this.addNavigationToDictionary=function(i,n){var s=t.SIMPLE_SELECTION_VALUE_TYPE.COLLECTION.string;if(n.attribute.businessDataType!==null){s=n.attribute.businessDataType}else if(n.root.isAlias&&n.root.businessDataType!==null){s=n.root.businessDataType}var a=t.SIMPLE_SELECTION_VALUE_TYPE.getByValue("string",s);var o=function(t){var e=[];if(u.isEmptyArray(t)){return e}var i;for(i=0;i<t.length;i++){e.push(t[i].name)}return e};var l=u.getFixedParamName(i);var h={navigationPredicate:l,navigationFullPath:n.isParameter?l:n.navigation,navigationFullPathId:n.navigationFullPathId,rootObject:n.root.name,rootObjectId:n.root.id,attribute:n.attribute.name,attributeId:n.attribute.id,attributeType:a.value,associationsArray:o(n.associations.path),attributeMappingType:n.attribute.sourceType,attributeValueList:n.attribute.valueListName,isVocaRule:n.isVocaRule,isCollection:n.isCollection,isParameter:n.isParameter,isAlias:n.isParameter?false:n.root.isAlias,isDataObject:n.isParameter?n.isDataObject:null,dataObject:null,modifiers:n.isParameter?{}:n.modifiers};if(!h.isAlias&&!h.isParameter){var c=null;if(u.isEmptyArray(h.associationsArray)&&h.attributeType===t.SIMPLE_SELECTION_VALUE_TYPE.COLLECTION.string){c=h.rootObject}else if(!u.isEmptyArray(h.associationsArray)){c=h.associationsArray[h.associationsArray.length-1]}if(h.attribute===null||h.attribute===undefined){this.dataObject=c}h.dataObject=c}var p=new e.NavigationPredicateDetails(h);r[i]=p;return p}};l.prototype.getModelManger=function(){if(l.prototype.manager_singletonInstance){return l.prototype.manager_singletonInstance}l.prototype.manager_singletonInstance=new this.ModelManager;return l.prototype.manager_singletonInstance};l.prototype.createModelManger=function(){l.prototype.manager_singletonInstance=new this.ModelManager;l.prototype.manager_singletonInstance.clearModelData();return l.prototype.manager_singletonInstance};l.prototype.validateNavigationRule=function(t){var e=this.getModelManger().getCurrentNavigationObject(t);var i=null;if(e.isValid||e.root.isValid){i=this.getModelManger().addNavigationToDictionary(t,e);if(i.getModifiers().hasOwnProperty("all")){this.getModelManger().setTermAllContext()}var n=i.getAttributeValueList();if(n){var s={};s.navPath=t;s.attributeValueList=e.attribute.valueListName;this.getModelManger().setLastValueListAttribute(s)}else{this.getModelManger().cleanValueListAttribute()}}else{o.handleWarning("general error in "+t)}return i};return{parseModelLib:l}},true);
//# sourceMappingURL=parseModel.js.map