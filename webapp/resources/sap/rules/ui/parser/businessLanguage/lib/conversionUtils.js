sap.ui.define(["sap/rules/ui/parser/infrastructure/errorHandling/hrfException","sap/rules/ui/parser/businessLanguage/lib/constants","sap/rules/ui/parser/businessLanguage/lib/localeConversion","sap/rules/ui/parser/businessLanguage/lib/parseUtils","sap/rules/ui/parser/resources/vocabulary/lib/constantsBase","sap/base/i18n/Formatting","sap/base/i18n/date/CalendarType","sap/ui/core/format/DateFormat","sap/ui/core/LocaleData"],function(e,r,t,n,o,s,a,i,u){"use strict";var l=new n.parseUtilsLib;function p(){}function c(r,t,n){var o={args:[]};if(r===null){o.key="error_in_expression_invalid_value_from_list_message";o.args[0]=t.token.slice(1,-1);o.args[1]=t.info.key;n.parseResult.cursorPosition=t.start;n.parseResult.convertedExpression=null;l.handleError(o.key,o.args,n);throw new e.HrfException}}function v(r,t,n){var o={args:[]};o.key="techincal_error";o.args[0]=r.message;n.parseResult.cursorPosition=t.start;n.parseResult.convertedExpression=null;l.handleError(o.key,o.args,n);throw new e.HrfException}p.prototype.needsNativeValueListConversion=function(e){return e.hasOwnProperty(r.propertiesEnum.flags)&&e.flags.hasOwnProperty(r.propertiesEnum.conversionOutput)&&(e.flags[r.propertiesEnum.conversionOutput]===r.conversionOutputEnum.toKeys||e.flags[r.propertiesEnum.conversionOutput]===r.conversionOutputEnum.toDescriptions)};p.prototype.needsLocaleConversion=function(e){return e.hasOwnProperty(r.propertiesEnum.flags)&&e.flags.hasOwnProperty(r.propertiesEnum.locale)&&e.flags.locale.hasOwnProperty(r.propertiesEnum.convert)&&e.flags.locale.convert.hasOwnProperty(r.propertiesEnum.source)&&e.flags.locale.convert.hasOwnProperty(r.propertiesEnum.target)&&e.flags.locale.convert.source!==e.flags.locale.convert.target};p.prototype.needsTermConversion=function(e){return e.hasOwnProperty(r.propertiesEnum.flags)&&e.flags.hasOwnProperty(r.propertiesEnum.termMode)&&e.flags.termMode.hasOwnProperty(r.propertiesEnum.convert)&&e.flags.termMode.convert.hasOwnProperty(r.propertiesEnum.source)&&e.flags.termMode.convert.hasOwnProperty(r.propertiesEnum.target)&&e.flags.termMode.convert.source!==e.flags.termMode.convert.target};p.prototype.isConvertRequested=function(e){return e.hasOwnProperty(r.propertiesEnum.flags)&&e.flags.hasOwnProperty(r.propertiesEnum.locale)&&e.flags.locale.hasOwnProperty(r.propertiesEnum.convert)};p.prototype.needsConversion=function(e){return this.needsNativeValueListConversion(e)||this.isConvertRequested(e)};p.prototype.convertValueNativeList=function(e,t,n,o){var s=n.flags[r.propertiesEnum.conversionOutput];var a=s===r.conversionOutputEnum.toKeys;var i="";var u;if(o.tokenType===r.tokenTypesEnum.valueList&&e.IsValueListDescriptionExist(t,o.info.key)){u=o.info.key;try{i=a?e.GetValueFromValueListDescription(t,u,o.token):e.GetDescriptionFromValueListValue(t,u,o.token)}catch(e){v(e,o,n)}c(i,o,n);i=i.indexOf("'")!==0?"'"+i+"'":i}else{i=o.token}return i};p.prototype.convertLocale=function(e,r){var n=t.convertLocaleFormat(r.token,e,r.info.type);c(n,r,e);return n};p.prototype.convertTerm=function(e,t,n){var s=null;var a=null;var i=null;var u=e.flags.termMode.convert.source;var l="";var p=null;if(u===r.DISPLAY_TEXT){a=o.TermModeRelated.TERM_MODE_BY_DESCRIPTION;i=o.TermModeRelated.TERM_PROPERTY_DESCRIPTION}else{a=o.TermModeRelated.TERM_MODE_BY_NAME;i=o.TermModeRelated.TERM_PROPERTY_FRIENDLY_TERM}while(t[t.length-1]===" "){l=l+" ";t=t.slice(0,t.length-1)}s=e.vocaRTServ.getTerm(e.vocabulary,t,a);if(s){p=s[i];if(l.length){p+=l}}else{var c=null;var v=e.getTokenContext(n,t);if(v){c=e.vocaRTServ.getAttributeByTermMode(e.vocabulary,v,t,a);if(c){p=a===o.TermModeRelated.TERM_MODE_BY_DESCRIPTION?c.name:c.description;if(l.length){p+=l}}}}return p};p.prototype.isValueListDateType=function(e){var r=s.getLanguageTag();var t=u.getInstance(r);var n=i.getInstance({pattern:t.getDatePattern("short"),calendarType:a.Gregorian},r);if(n.parse(e.replace(/'/g,""))){return true}else{return false}};p.prototype.convert=function(e,t,n,o,s){var a=s;var i=0;var u="";var l="";var p;var c;var v;var f;var g=null;var y=0;var E=0;for(p=0;p<o.length;p++){c=false;v=o[p];f=0;g="";l="";switch(v.tokenType){case r.tokenTypesEnum.valueList:if(this.needsNativeValueListConversion(n)){c=true;y=v.start;E=v.end;l=v.token;u=this.convertValueNativeList(e,t,n,v)}else if(this.isValueListDateType(v.token)){c=true;y=v.start;E=v.end;l=v.token;v.info.type="Date";u=this.convertLocale(n,v);delete v.info.type}break;case r.tokenTypesEnum.constant:if(this.needsLocaleConversion(n)){switch(v.info.type){case r.TYPE_DATE:case r.TYPE_TIMESTAMP:case r.TYPE_TIME:case r.TYPE_NUMERIC:c=true;y=v.start;E=v.end;l=v.token;u=this.convertLocale(n,v);break}}break;case r.tokenTypesEnum.vocabulary:if(this.needsTermConversion(n)){y=v.start;while(p+f<o.length&&(o[p+f].tokenType===r.tokenTypesEnum.vocabulary||o[p+f].tokenType===r.tokenTypesEnum.whitespace)){if(o[p+f].tokenType===r.tokenTypesEnum.whitespace){g+=" "}else{g+=o[p+f].token}l+=o[p+f].token;f++}f--;p+=f;v=o[p];E=v.end;c=true;u=this.convertTerm(n,g,y)}break}if(c&&u){a=a.slice(0,y+i)+u+a.slice(E+1+i);i+=u.length-l.length}}return a};return{conversionUtilsLib:p}},true);
//# sourceMappingURL=conversionUtils.js.map