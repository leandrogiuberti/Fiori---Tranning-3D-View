sap.ui.define(["sap/rules/ui/parser/resources/vocabulary/lib/utilsBase","sap/rules/ui/parser/infrastructure/util/constants","sap/rules/ui/parser/businessLanguage/lib/parsingBackendMediator","sap/rules/ui/parser/resources/vocabulary/lib/constants","sap/rules/ui/parser/ruleBody/lib/constantsBase","sap/rules/ui/parser/infrastructure/messageHandling/lib/responseCollector","sap/rules/ui/parser/businessLanguage/lib/constants","sap/rules/ui/parser/infrastructure/errorHandling/hrfException","sap/rules/ui/parser/resources/common/lib/constants","sap/rules/ui/parser/resources/vocabulary/lib/vocabularyDataProviderFactory"],function(r,e,a,t,s,i,n,o,l,u){"use strict";var _=new r.utilsBaseLib;var E=i.ResponseCollector;function c(){}c.prototype.handleError=function(r,e,a){var t=JSON.stringify(E.getInstance().addMessage(r,e));if(a){a.allMsg+=t}else{throw new o.HrfException(t,false)}};c.prototype.validateAliasNamesUniquenessAgainstOtherVocabularies=function(r,e,a,s,i,n){var o;var l;var u;var _;var E;for(o=0;o<r.length;o++){l=r[o];E=e[l];if(E&&(!i||E.isPrivate)){u=[t.PROPERTY_NAME_ALIASES,l,t.PROPERTY_NAME_ALIASES,E.vocaName];this.handleError("error_vocabulary_parameter_name_exists_in_other_voca",u,n)}if(a.hasOwnProperty(l)){if(a[l]===null){u=[l];this.handleError("error_vocabulary_alias_name_cant_be_reserved_word",u,n)}u=[t.PROPERTY_NAME_ALIASES,l,t.PROPERTY_NAME_DATA_OBJECTS,a[l]];this.handleError("error_vocabulary_parameter_name_exists_in_other_voca",u,n)}if(s.hasOwnProperty(l)){_=s[l];if(s[l].vocaName===null){u=[l,_.objectName];this.handleError("error_vocabulary_alias_name_exists_as_an_attribute_name_in_global_attribute",u,n)}u=[l,_.objectName,_.vocaName];this.handleError("error_vocabulary_alias_name_exists_as_an_attribute_name_in_other_vocabulary",u,n)}}};c.prototype.isAlpha=function(r){return r>="A".charCodeAt(0)&&r<="Z".charCodeAt(0)||r>="a".charCodeAt(0)&&r<="z".charCodeAt(0)};c.prototype.isNumeric=function(r){return r>="0".charCodeAt(0)&&r<="9".charCodeAt(0)};c.prototype.isAllowedSpecialChar=function(r){return r==="_".charCodeAt(0)};c.prototype.isReservedWord=function(r){return a.isReservedWord(r)};c.prototype.isValidToken=function(r){var e;if(r.length<1){return false}if(!this.isAlpha(r.charCodeAt(0))){return false}var a;for(a=1;a<r.length;a++){e=r.charCodeAt(a);if(!this.isAlpha(e)&&!this.isNumeric(e)&&!this.isAllowedSpecialChar(e)){return false}}return true};c.prototype.isValidName=function(r){if(!this.isValidToken(r)){return false}if(this.isReservedWord(r)===true){return false}return true};c.prototype.isValidSize=function(r,a){var t=r.replace(/\s+/g,"");var s=[];if(a===e.SQL_TYPES.DECIMAL){s=t.split(",");if(s.length!==2||!/^\d+$/.test(s[0])||!/^\d+$/.test(s[1])||parseInt(s[0],10)===0){return false}}else if(!/^\d+$/.test(t)||parseInt(t,10)===0){return false}return true};c.prototype.validateAliases=function(r,e,a){var s;var i=[];var n;var o;var l;var u={};for(s=0;s<r.length;s++){n=r[s][t.PROPERTY_NAME_ALIAS_NAME];o=r[s][t.PROPERTY_NAME_ALIAS_CONTENT];if(!this.isValidName(n)){l=[n];this.handleError("error_vocabulary_invalid_alias_name",l,a)}if(!o||0===o.length){l=[n];this.handleError("error_vocabulary_alias_content_couldnt_be_empty",l,a);continue}if(u.hasOwnProperty(n)){l=[n];this.handleError("error_vocabulary_alias_name_already_exists",l,a);continue}if(e){if(e.dataObjects.hasOwnProperty(n)){l=[n];this.handleError("error_vocabulary_invalid_alias_name_exist_as_om",l,a);continue}if(e.attributes.hasOwnProperty(n)){l=[n,e.attributes[n]];this.handleError("error_vocabulary_alias_name_exists_as_an_attribute_name",l,a);continue}}u[r[s][t.PROPERTY_NAME_ALIAS_NAME]]=r[s][t.PROPERTY_NAME_ALIAS_NAME];i.push(r[s][t.PROPERTY_NAME_ALIAS_NAME])}return i};c.prototype.validateValueLists=function(r,e,a){var t=[];var s=null;var i;var n;var o=e.valueLists;for(s in r){if(r.hasOwnProperty(s)){i=r[s];if(!this.isValidName(s)){n=[s];this.handleError("error_vocabulary_invalid_value_list_name",n,a)}if(!i||0===i.length){n=[s];this.handleError("error_vocabulary_value_list_content_couldnt_be_empty",n,a)}t.push(r[s])}}var l;for(s in o){if(o.hasOwnProperty(s)){if(r.hasOwnProperty(s)===false){for(l=0;l<o[s].length;l++){n=[s,o[s][l].attribute,o[s][l].dataObject];this.handleError("error_vocabulary_value_list_does_not_exist",n,a)}}}}return t};c.prototype.collectErrorMessages=function(r,e,a){var s=[];if(r===t.ALIAS_CONTENT_DECISION_TABLE){s=s.concat(a)}else if(r===t.ALIAS_CONTENT_EXPRESSION){var i={description:e[n.attributesNamesEnum.errorDetails]};s=s.concat(i)}return s};c.prototype.isAliasContentValid=function(r,e){var a=false;if(e===t.ALIAS_CONTENT_DECISION_TABLE){if(r.status==="Error"){a=false}else{a=true}}else if(e===t.ALIAS_CONTENT_EXPRESSION){if(r[n.attributesNamesEnum.isValid]===true){a=true}else{a=false}}return a};c.prototype.reValidateAliasContent=function(r,e,a,i,n){var o=null;if(i===t.ALIAS_CONTENT_DECISION_TABLE){var l={};l[s.OUTPUT_FLAGS_ENUM.validationOutput]=true;l[s.OUTPUT_FLAGS_ENUM.unknownTokensOutput]=true;l[s.OUTPUT_FLAGS_ENUM.isAlias]=true;o=r.reValidateBusinessRule(a,n,l,null)}else if(i===t.ALIAS_CONTENT_EXPRESSION){o=r.validateAndGetExpressionActualReturnTypeRT(n,e,a,null,false)}return o};c.prototype.getVocabularyFullName=function(r,e){var a="";if(e&&e.hasOwnProperty(t.PROPERTY_NAME_NAME)){a=e[t.PROPERTY_NAME_NAME]}else{if(r[l.PROPERTY_NAME_PACKAGE]===undefined){a=r[l.PROPERTY_NAME_NAME]}else{a=r[l.PROPERTY_NAME_PACKAGE]+"::"+r[l.PROPERTY_NAME_NAME]}}return a};c.prototype.autoCompleteAliasType=function(r){if(!r[t.PROPERTY_NAME_TYPE]){r[t.PROPERTY_NAME_TYPE]=t.ALIAS_CONTENT_EXPRESSION}};c.prototype.addErrorMessages=function(r,e,a,t){var s;var i=[];var n;var o,l="";for(n=0;n<e.length;++n){s=e[n];i=[a,s.description];o=E.getInstance().addMessage(r,i);l+=JSON.stringify(o)}if(t){E.getInstance().addMessage("error_vocabulary_invalid_alias_dependancy",t)}return l};c.prototype.validateAliasContent=function(r,e,a,i,n){var o=null;if(i===t.ALIAS_CONTENT_DECISION_TABLE){var l={};l[s.OUTPUT_FLAGS_ENUM.validationOutput]=true;l[s.OUTPUT_FLAGS_ENUM.unknownTokensOutput]=true;l[s.OUTPUT_FLAGS_ENUM.isAlias]=true;o=r.validateBusinessRule(e,a,n,l,null)}else if(i===t.ALIAS_CONTENT_EXPRESSION){o=r.validateAndGetExpressionActualReturnTypeRT(n,e,a,null,false)}return o};c.prototype.getValidatorInstance=function(r){var e;if(r===t.ALIAS_CONTENT_DECISION_TABLE){var a=sap.ui.require("sap/rules/ui/parser/ruleBody/lib/ruleBodyValidator");e=new a.RuleBodyValidator}else{var s=new s.parsingBackendMediatorLib;e=s}return e};c.prototype.getHanaDataType=function(r){return _.getHanaDataType(r)};c.prototype.getBusinessDataType=function(r){return _.getBusinessDataType(r)};c.prototype.isVocabularySuffix=function(r){return r==="hprvocabulary"||r==="hrfvocabulary"};c.prototype.calculateScope=function(r,e,a){var s=e;var i;var n;var o=null;var l=null;l=new u.vocaDataProviderFactoryLib;o=l.getVocabularyDataProvider();if(r[t.PROPERTY_NAME_VOCABULARY_SCOPE]){s=t.GLOBAL}else if(r.hasOwnProperty(t.PROPERTY_NAME_DEPENDENCY)){n=r[t.PROPERTY_NAME_DEPENDENCY];if(n[0]&&this.isVocabularySuffix(n[0].suffix)){i=n[0][t.PROPERTY_NAME_DEPENDS_ON_PACKAGE]+"::"+n[0][t.PROPERTY_NAME_DEPENDS_ON_NAME];var _=o.getVocabulary(i);if(_.scope===t.GLOBAL){s=e}else{s=_.scope}}}return s};return{utilsLib:c}},true);
//# sourceMappingURL=utils.js.map