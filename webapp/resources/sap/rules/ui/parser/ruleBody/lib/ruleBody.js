sap.ui.define(["sap/rules/ui/parser/businessLanguage/lib/parsingBackendMediator","sap/rules/ui/parser/ruleBody/lib/constants","sap/rules/ui/parser/infrastructure/errorHandling/hrfException","sap/rules/ui/parser/infrastructure/messageHandling/lib/responseCollector","sap/rules/ui/parser/infrastructure/util/utilsBase","sap/rules/ui/parser/ruleBody/lib/decisionTableCell","sap/base/Log"],function(t,e,r,a,i,n,s){"use strict";var o=new t.parsingBackendMediatorLib;var l=new i.utilsBaseLib;var a=a.ResponseCollector;var u=function(t){if(t===null||t===undefined||t===""){return true}return false};function p(){this.ruleType="";this.ruleBodyCopy=null;this.needDeserializeInput=false;this.serializedHeaders=[]}p.prototype.initTraversalParts=function t(r){this.traversalParts={};if(r!==undefined&&r!==null){this.traversalParts[e.traversalEnum.condition]=r.hasOwnProperty(e.traversalEnum.condition)?r[e.traversalEnum.condition]:true;this.traversalParts[e.traversalEnum.outputParams]=r.hasOwnProperty(e.traversalEnum.outputParams)?r[e.traversalEnum.outputParams]:true;this.traversalParts[e.traversalEnum.actionParams]=r.hasOwnProperty(e.traversalEnum.actionParams)?r[e.traversalEnum.actionParams]:true;this.traversalParts[e.traversalEnum.actions]=r.hasOwnProperty(e.traversalEnum.actions)?r[e.traversalEnum.actions]:true}else{this.traversalParts[e.traversalEnum.condition]=true;this.traversalParts[e.traversalEnum.outputParams]=true;this.traversalParts[e.traversalEnum.actionParams]=true;this.traversalParts[e.traversalEnum.actions]=true}};p.prototype.traverse=function t(r,a,i,n,o){s.debug("Traverse rule --\x3e "+JSON.stringify(r));this.initTraversalParts(n);this.vocabulary=a;this.vocaRTServ=i;if(r!==null&&r!==undefined){if(r.hasOwnProperty(e.RULE_BODY_TYPE)){this.ruleType=r.type;this.setHitPolicy(r);this.ruleBodyCopy=JSON.parse(JSON.stringify(r));if(this.ruleType===e.SINGLE_TEXT){this.traverseText(this.ruleBodyCopy,o)}else if(this.ruleType===e.DECISION_TABLE||this.ruleType===e.RULE_SET){this.traverseDecisionTable(this.ruleBodyCopy,o)}}}return this};p.prototype.traverseText=function t(r,a){var i;var n;if(r.hasOwnProperty(e.RULE_CONTENT)){this.initResult();var s=this.initRowResult(r.content,0);n=l.buildJsonPath(a,e.RULE_CONTENT);if(r.content.hasOwnProperty(e.CONDITION)&&this.traversalParts[e.traversalEnum.condition]===true){n=l.buildJsonPath(n,e.CONDITION);s=this.handleTextCondition(r.content.condition,s,n)}if(r.content.hasOwnProperty(e.RULE_OUTPUTS)&&this.traversalParts[e.traversalEnum.outputParams]===true){this.initTextOutputsResult();var o;for(i=0;i<r.content.outputs.length;i++){n=l.buildJsonPath(a,e.RULE_OUTPUTS,i);o=r.content.outputs[i];if(o.hasOwnProperty(e.RULE_CONTENT)){s=this.handleTextOutputParameter(o,s,n)}}}if(r.content.hasOwnProperty(e.RULE_PARAMETERS)&&this.traversalParts[e.traversalEnum.actionParams]===true){this.initTextParametersResult();var u;for(i=0;i<r.content.parameters.length;i++){n=l.buildJsonPath(a,e.RULE_PARAMETERS,i);u=r.content.parameters[i];if(u.hasOwnProperty(e.RULE_CONTENT)){s=this.handleTextActionParameter(u,s,i,n)}}}if(r.content.hasOwnProperty(e.RULE_ACTIONS)&&this.traversalParts[e.traversalEnum.actionParams]===true){this.initTextActionsResult();var p;for(i=0;i<r.content.actions.length;i++){n=l.buildJsonPath(a,e.RULE_ACTIONS,i);p=r.content.actions[i];s=this.handleTextAction(p,s,n)}}this.addRowResult(s)}else{this.handleEmptyRuleBody()}};p.prototype.traverseDecisionTable=function t(r,a){var i,n;var s;var o;var l=null;if(r.hasOwnProperty(e.RULE_CONTENT)&&r.content.hasOwnProperty(e.RULE_ROWS)&&r.content.hasOwnProperty(e.RULE_HEADERS)){s=r.content;this.initResult();o=this.handleHeaders(s);var u,p;for(i=0;i<s.rows.length;i++){u=s.rows[i];if(u.hasOwnProperty(e.RULE_ROW)&&u.hasOwnProperty(e.RULE_ROW_ID)){p=this.initRowResult(s,i);for(n=0;n<u.row.length;n++){if(u.row[n].hasOwnProperty(e.RULE_COL_ID)){l=null;if(o.hasOwnProperty(u.row[n].colID)){l=o[u.row[n].colID]}if(l&&l.hasOwnProperty(e.RULE_CELL_TYPE)){if(l.type===e.CONDITION&&this.traversalParts[e.traversalEnum.condition]===true){p=this.handleDecisionTableCondition(l,u,n,p)}else if(l.type===e.PARAM&&this.traversalParts[e.traversalEnum.actionParams]===true){p=this.handleDecisionTableActionParameter(l,u,n,p)}else if(l.type===e.OUTPUT_PARAM&&this.traversalParts[e.traversalEnum.outputParams]===true){p=this.handleDecisionTableOutputParameter(l,u,n,p)}else if(l.type===e.ACTION_PARAM&&this.traversalParts[e.traversalEnum.actions]===true){p=this.handleDecisionTableAction(l,u,n,p)}}}}this.addRowResult(p)}}this.finalizeResult(r)}else{this.handleEmptyRuleBody()}};p.prototype.handleTextCondition=function t(e,r,a){};p.prototype.initTextOutputsResult=function t(){};p.prototype.handleTextOutputParameter=function t(e,r,a){};p.prototype.initTextParametersResult=function t(){};p.prototype.handleTextActionParameter=function t(e,r,a,i){};p.prototype.initTextActionsResult=function t(){};p.prototype.handleTextAction=function t(e,r,a){};p.prototype.handleHeaders=function t(e){return[]};p.prototype.handleDecisionTableCondition=function t(r,a,i,s){if(a.row[i].hasOwnProperty(e.RULE_CONTENT)){if(this.needDeserializeInput){a.row[i][e.RULE_CONTENT]=a.row[i][e.RULE_CONTENT]?n.deserializeExpression(a.row[i][e.RULE_CONTENT]).text:null}if(r.hasOwnProperty(e.afterConversionParts.fixedOperator)&&r.fixedOperator.operator){a.row[i][e.RULE_CONTENT]=r.fixedOperator.operator+" "+a.row[i][e.RULE_CONTENT]}}};p.prototype.handleDecisionTableActionParameter=function t(e,r,a,i){return i};p.prototype.handleDecisionTableOutputParameter=function t(r,a,i,s){if(a.row[i].hasOwnProperty(e.RULE_CONTENT)&&this.needDeserializeInput){a.row[i][e.RULE_CONTENT]=a.row[i][e.RULE_CONTENT]?n.deserializeExpression(a.row[i][e.RULE_CONTENT]).text:null}};p.prototype.handleDecisionTableAction=function t(e,r,a,i){return i};p.prototype.traverseDecisionTableHeaders=function t(r,a){var i=0,s=0;var o={};if(r.hasOwnProperty(e.RULE_HEADERS)){s=r.headers.length;for(i=0;i<s;i++){o=r.headers[i];if(this.needDeserializeInput&&!this.serializedHeaders.hasOwnProperty(i)&&!this.serializedHeaders[i]){if(o[e.RULE_DT_EXPRESSION]){o[e.RULE_DT_EXPRESSION]=o[e.RULE_DT_EXPRESSION]?n.deserializeExpression(o[e.RULE_DT_EXPRESSION]).text:null}if(o.hasOwnProperty(e.afterConversionParts.fixedOperator)){o.fixedOperator.operator=o.fixedOperator.operator?n.deserializeExpression(o.fixedOperator.operator).text:null}this.serializedHeaders[i]=true}if(o.hasOwnProperty(e.RULE_COL_ID)){if(a!==null){a(o)}}}}};p.prototype.buildHeadersMap=function t(e){var r=[];this.traverseDecisionTableHeaders(e,function(t){r[t.colID]=t});return r};p.prototype.concatToDecisionTableCondition=function t(e,r,a){return n.concatToDecisionTableCondition(e,r,a)};p.prototype.splitDecisionTableCondition=function t(e,r,a){return n.splitDecisionTableCondition(e,r,a)};p.prototype.initResult=function t(){};p.prototype.initRowResult=function t(e,r){};p.prototype.addRowResult=function t(e){};p.prototype.finalizeResult=function t(e){};p.prototype.handleEmptyRuleBody=function t(){};p.prototype.getParserAST=function t(e,i,n,l,p){var h=o.parseInputRT(e,i,this.vocaRTServ,n,l,this.vocabulary,p);s.debug("****************************************************************************************************");s.debug("expresstion to parser: "+e+" type: "+l+" vocabulary: "+this.vocabulary+" "+i);s.debug("*****************************************************************************************************");if(h===undefined||h===null&&u(e)===false){a.getInstance().addMessage("error_in_parsing_expression",[e]);throw new r.HrfException("error_in_parsing_expression: "+e,false)}if(i===o.PARSE_MODE){if(h!==null&&h.status==="Error"){throw new r.HrfException("",false)}}s.debug(JSON.stringify(h));return h};p.prototype.setHitPolicy=function t(r){if(r.hasOwnProperty(e.HIT_POLICY_PROPERTY)){this.hitPolicy=r.hitPolicy}else{this.hitPolicy=e.ALL_MATCH}};p.prototype.getHitPolicy=function t(){return this.hitPolicy};return{RuleBody:p}},true);
//# sourceMappingURL=ruleBody.js.map