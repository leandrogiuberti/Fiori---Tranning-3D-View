sap.ui.define(["sap/rules/ui/parser/infrastructure/messageHandling/lib/responseCollector","sap/rules/ui/parser/resources/common/lib/resourcesConvertor","sap/rules/ui/parser/resources/vocabulary/lib/vocabularyDataProviderInitiator","sap/rules/ui/parser/resources/vocabulary/lib/constants","sap/rules/ui/parser/ruleBody/lib/ruleBodyServices","sap/rules/ui/parser/ruleBody/lib/decisionTableCell","sap/rules/ui/parser/ruleBody/lib/constants","sap/rules/ui/parser/resources/common/lib/oDataHandler","sap/rules/ui/parser/businessLanguage/lib/constants","sap/rules/ui/parser/resources/dependencies/lib/constants"],function(r,e,a,l,n,u,t,i,v,s){"use strict";var o=r.ResponseCollector.getInstance();var _=new a.vocaDataProviderInitiatorLib;var c=new n.RuleBodyServicesLib;var f="rule";var R="rules";var E="id";var T="name";var d="content";var p="parameters";var O="usage";var U="RESULT";var S="flags";var A="vocabularyRules";var L="dependencies";var C=function(r,e){var a=i.getOdataPropName(r,e);var l=null;if(a){l=r[a]}return l};var g=function(r,e){var a=null;var n=null;a={connection:null,resourceID:r,vocaLoadingType:l.vocaContextTypeEnum.JSON,resourceContent:e,termModes:["byName"]};n=_.init(a);return n};var b=function(r){var e=null;var a=r;if((a=C(a,t.EXECUTION_CONTEXT))&&(a=C(a,t.RESULT_DATA_OBJECT_ID))){e=a}return e};var y=function(r){var e=0;var a=null;var l=null;var n=null;var u=b(r);var i=r;if((i=C(i,t.VOCABULARY))&&(i=C(i,t.RULE_CONTENT))&&(i=C(i,t.DATA_OBJECTS))){var v=i;for(e=0;e<v.length;e++){a=v[e];if((i=C(a,t.ID))===u&&(i=C(a,O))===U){return true}}}i=C(r,t.ID);n={type:t.additionalInfoTypeEnum.executionContext};l=[u,i];o.addMessage("result_data_object_of_the_rule_services_is_not_valid",l,null,n);return false};var D=function(r,e){var a=0;var l=null;var n=null;var u=null;var i=null;var v=null;var s=null;var _=null;var c=C(r,t.ID);var f=b(r);var R=C(r,t.RULES);if(f&&R){n=R;for(a=0;a<n.length;a++){l=n[a];if((R=C(l,t.RULE_CONTENT))&&(R=C(R,t.RESULT_DATA_OBJECT_ID))){v=R;if(v===f){continue}if((s=C(l,E))&&(R=C(l,t.RULE_CONTENT))&&(_=C(R,T))){e[s]=_}i={ruleID:l[E],type:t.additionalInfoTypeEnum.ruleResult};u=[v,s,f,c];o.addMessage("result_data_object_of_the_rule_is_not_valid",u,null,i)}}}};var m=function(r,e){var a=0;var l=0;var n=true;var u=null;var i=[];var v=[];var s=null;var _=null;var c=e.getParameters()||[];var f=C(r,t.EXECUTION_CONTEXT);var R=C(f,p)||[];var E=C(r,t.ID);f=C(r,t.VOCABULARY);var d=C(f,t.ID);for(a=0;a<c.length;a++){u=c[a][t.ATTRIBUTES]||[];for(l=0;l<u.length;l++){i.push(u[l][t.PARAMETER_NAME])}}for(a=0;a<R.length;a++){v.push(C(R[a],T))}for(a=0;a<i.length;a++){if(v.indexOf(i[a])===-1){n=false;_={type:t.additionalInfoTypeEnum.executionContext};s=[i[a],d,E];o.addMessage("execution_context_parameter_of_the_rule_services_is_not_valid",s,null,_);break}}return n};var I=function(r,e,a){var l={};var n=false;var u=false;a=a||{};l[t.RULE_STATUS]=t.RULE_ERROR;n=y(r);if(n){u=m(r,e);if(u){D(r,a);if(Object.keys(a).length===0){l[t.RULE_STATUS]=t.RULE_SUCCESS}}}return l};var N=function(r,e,a){if(!a){a={}}a[t.ODATA_FORMAT_PAYLOAD]={};a[t.ODATA_FORMAT_PAYLOAD][t.RULE_ID]=r;a[t.outputFlagsEnum.validationOutput]=false;a[t.outputFlagsEnum.rootObjectContextOutput]=true;a[t.outputFlagsEnum.dependenciesOutput]=true;if(!a.vocaRules){a.vocaRules={}}a.vocaRules.rootObjectMap=e};var h=function r(e,a,l,n,t,i,v,s){var o=new u.DecisionTableCell(e,a,l,n,t,i);var _=o.validateAndConvert(s,v);return _};var P=function(r,e){var a=null;if(r){for(a in r){if(r.hasOwnProperty(a)){if(r[a][s.PROPERTY_NAME_CATEGORY]===s.CATEGORY_VOCA_DO){e[r[a].DOName]=null}}}}};var x=function(r,a,l,n,u,i){var v=null;var s=null;var o=null;var _=n?JSON.parse(JSON.stringify(n)):{};v=e.convertRuleODataToInternalModel(r,null);s=v[t.EXPLICIT_OUTPUT];var f=_&&_[t.outputFlagsEnum.dependenciesOutput];N(C(r,E),u,_);o=c.process(v.ruleBody,a,l,_,s,null,r);if(o[t.RULE_STATUS]===t.RULE_SUCCESS){if(i!==null&&i!==undefined){P(o[L],i)}if(!f){delete o[L]}}return o};var B=function(r,e,a,l,n){var u=0;var i=C(r,R);var v=null;var s=null;var o={};var _={};var c=null;o=I(r,a,_);if(!(o[t.RULE_STATUS]===t.RULE_ERROR&&Object.keys(_).length===0)){for(u=0;u<i.length;u++){v=i[u];c=C(v,E);if(!_[c]){s=x(C(v,d),e,a,null,l,n);if(s[t.RULE_STATUS]===t.RULE_ERROR){o=s}}}}return o};var M=function(r,e,a,l,n){var u=null;var i=0;var v=null;var s=null;var o=null;var _=null;var c={};for(i=0;i<r.length;i++){v=r[i];_=C(v,d);o=C(_,T);if(n.hasOwnProperty(o)===false){continue}s=x(_,a,e,c,null,null);if(s[t.RULE_STATUS]===t.RULE_ERROR){u=s}else{l[o]=s[t.RULE_ROOT_OBJECT_CONTEXT]}}return u};var V=function(r){var e=null;var a={};var l=null;var n=null;var u=null;var i=null;var v=null;var s=null;var _={};var c=C(r,f);var R=C(c,d);var T=C(r,t.VOCABULARY);if(!T){o.addMessage("voca_is_missing_in_the_payload",[],null,null);a[t.RULE_STATUS]=t.RULE_ERROR}else{u=C(T,d);e=C(u,E);i=C(r,S);n=g(e,u);v=C(r,A);a=x(R,e,n,i,null,_);if(a[t.RULE_STATUS]===t.RULE_SUCCESS){if(v!==null){s={};l=M(v,n,e,s,_);if(l===null){a=x(R,e,n,i,s)}else{a=l}}}}return a};var Y=function(r){var e=null;var a=null;var l=null;var n={};var u=null;var i=null;var v=null;var s={};var _=C(r,t.VOCABULARY);if(!_){o.addMessage("voca_is_missing_in_the_payload",[],null,null);n[t.RULE_STATUS]=t.RULE_ERROR}else{a=C(_,d);e=C(a,E);i=g(e,a);u=C(r,A);n=B(r,e,i,null,s);if(n[t.RULE_STATUS]===t.RULE_SUCCESS){if(u!==null){v={};l=M(u,i,e,v,s);if(l===null){n=B(r,e,i,v,null)}else{n=l}}}}return n};var J=function(){return v.PARSER_EXPR_LANG_VERSION};return{executeRuleValidation:V,executeRuleServiceValidation:Y,validateRuleService:B,validateDecisionTableExpression:h,validateRule:x,validateExecutionContext:I,getParserExprLangVersion:J}},true);
//# sourceMappingURL=ruleServices.js.map