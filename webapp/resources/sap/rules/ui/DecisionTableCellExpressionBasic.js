/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

		(c) Copyright 2009-2016 SAP SE. All rights reserved
	
 */
sap.ui.define(["sap/ui/thirdparty/jquery","./library","sap/rules/ui/ExpressionBasic","sap/rules/ui/InstructionRenderer","sap/ui/core/library","sap/ui/core/Element","./DecisionTableCellExpressionBasicRenderer"],function(jQuery,e,t,i,s,a,r){"use strict";var l=t.extend("sap.rules.ui.DecisionTableCellExpressionBasic",{metadata:{library:"sap.rules.ui",properties:{headerValue:{type:"string",defaultValue:"",bindable:"bindable"},fixedOperator:{type:"string",defaultValue:"",bindable:"bindable"},attributeName:{type:"string",defaultValue:"",bindable:"bindable"},type:{type:"sap.rules.ui.ExpressionType",defaultValue:e.ExpressionType.BooleanEnhanced,bindable:"bindable"}}},_reload:function(){this._isOperation=" is ";this._ofOperation=" of the ";this._equalOperation="is equal to";var e;var s=this.resultDataObjectName;if("getAttributeName"in this&&this.getAttributeName()){e=this.getAttributeName()}if(e&&s){if(this.getType()==="Boolean"){this.sHeaderValue=s+this._isOperation+e}else{this.sHeaderValue=e+this._ofOperation+s}this.FixedOperatorValue=this._equalOperation}else{this.sHeaderValue=this.getHeaderValue();this.FixedOperatorValue=this.getFixedOperator()}this.shouldReload=false;this.sCellValue=this.getValue();this.sValueFromSettings=this.sHeaderValue+" "+this.FixedOperatorValue;this.sValue=(this.sValueFromSettings+this.sCellValue).trim();var r=a.getElementById(this.getExpressionLanguage());var l;if(!this.sHeaderValue&&!this.FixedOperatorValue){this.setProperty("value",this.sValue);t.prototype._reload.apply(this,arguments);return}else{if(this.sHeaderValue&&this.FixedOperatorValue){l=r._getRightSuggestions(this.sHeaderValue,this.FixedOperatorValue,this.sCellValue,null,null);if(!r._hasValueSource&&this._checkForValueHelpSuggestions(l)){return}}else if(this.sHeaderValue&&!this.FixedOperatorValue){var o=r.validateExpression(this.sHeaderValue);if(o.status==="Error"){this.bReadOnly=true;this.bFlagForChange=true;l=[r._getLeftSuggestions("","")]}else{var n=this._getSubExpression(this.sCellValue);var u=n[1]?n[1].exp:"";l=[r._getCompSuggestions(this.sHeaderValue,u,null)];if(u){var h;var p=n[2]?n[2].exp:"";h=r._getRightSuggestions(this.sHeaderValue,u,p,null,null);l.push.apply(l,h);if(!r._hasValueSource&&this._checkForValueHelpSuggestions(l)){return}}}}this.instructions=this._createInstructions(l);var d=new i({instructions:this.instructions,useIndent:false,change:this._onChange.bind(this)});this.setAggregation("_instructionRenderer",d,true)}},_calculateOffSet:function(){if(!this.sHeaderValue&&!this.FixedOperatorValue){this.offSet=0}else if(this.sHeaderValue&&this.FixedOperatorValue){this.offSet=2}else{this.offSet=1}},_onChangeByIndex:function(e,i){t.prototype._onChangeByIndex.apply(this,[this.offSet+e,this.sHeaderValue+this.FixedOperatorValue,e])},renderer:r});l.prototype.init=function(){};l.prototype.exit=function(){this._handleValidation()};l.prototype.validateExpression=function(){};l.prototype.onAfterRendering=function(){t.prototype.onAfterRendering.apply(this,arguments);this._calculateOffSet();this.oDecisionTableCell=this.getParent()&&this.getParent().getParent()?this.getParent().getParent():null;if(this.oDecisionTableCell){var e=this.oDecisionTableCell.getValueStatePath();var i=this.oDecisionTableCell.getModel("dtModel");this.setProperty("valueStateText","");i.setProperty(e.slice(8),s.ValueState.None);this.createEventListeners()}};l.prototype.onBeforeRendering=function(){t.prototype.onBeforeRendering.apply(this,arguments)};l.prototype._getSubExpression=function(e){var t=a.getElementById(this.getExpressionLanguage());return t._getSubExpressions(null,"dummy "+e)};l.prototype._handleValidation=function(){var t;var i=this.getHeaderValue();var r=this.getFixedOperator();var l=this.getValue();var o;if(!l){o=l}else{o=i+" "+r+" "+l}var n=a.getElementById(this.getExpressionLanguage());if(o){var u=n.validateExpression(o);if(u.deferredResult){u.deferredResult.done(function(i){if(this.oDecisionTableCell){var a=this.oDecisionTableCell.getValueStateTextPath();var r=this.oDecisionTableCell.getValueStatePath();var l=this.oDecisionTableCell.getModel("dtModel");if(i.status===e.ValidationStatus.Error){t=i.errorDetails.replace(/\r\n/g," ").replace(/\r/g," ").replace(/\n/g," ");l.setProperty(a.slice(8),t);if(!this.oDecisionTableCell._oPopover||!this.oDecisionTableCell._oPopover.isOpen()){l.setProperty(r.slice(8),s.ValueState.Error)}else{l.setProperty(r.slice(8),s.ValueState.None)}this.setProperty("valueStateText",t)}else{this.setProperty("valueStateText","");l.setProperty(a.slice(8),"null");l.setProperty(r.slice(8),s.ValueState.None)}}}.bind(this))}if(this.oDecisionTableCell){var h=this.oDecisionTableCell.getValueStateTextPath();var p=this.oDecisionTableCell.getValueStatePath();var d=this.oDecisionTableCell.getModel("dtModel");if(u.status===e.ValidationStatus.Error){t=u.errorDetails.replace(/\r\n/g," ").replace(/\r/g," ").replace(/\n/g," ");this.setProperty("valueStateText",t);d.setProperty(h.slice(8),t);d.setProperty(p.slice(8),s.ValueState.Error)}else{this.setProperty("valueStateText","");d.setProperty(h.slice(8),"null");d.setProperty(p.slice(8),s.ValueState.None)}}}};l.prototype.createEventListeners=function(){var e=this.oDecisionTableCell.getDomRef().parentElement.parentElement;if(e){document.getElementById(this.getId()).addEventListener("keyup",function(t){if(t.keyCode===27){jQuery(e).focus()}}.bind(this))}};return l},true);
//# sourceMappingURL=DecisionTableCellExpressionBasic.js.map