/*!
 * SAPUI5
 * (c) Copyright 2025 SAP SE. All rights reserved.
 */
jQuery.sap.declare("sap.uiext.inbox.controller.InboxControllerAsync");jQuery.sap.require("sap.uiext.inbox.controller.InboxController");jQuery.sap.require("sap.ui.model.json.JSONModel");sap.uiext.inbox.controller.InboxController.extend("sap.uiext.inbox.controller.InboxControllerAsync",{constructor:function(){if(sap.uiext.inbox.controller.InboxController.prototype.constructor){sap.uiext.inbox.controller.InboxController.prototype.constructor.apply(this,arguments)}this.oTaskDefinitionModel=new sap.ui.model.json.JSONModel;this.oTaskDefinitionModel.setData({TaskDefinitionCollection:[]});this.oTaskDescriptionModel=new sap.ui.model.json.JSONModel;this.oTaskDescriptionModel.setData({TaskDescriptionCollection:[]});this.oCustomAttributeDataModel=new sap.ui.model.json.JSONModel;this.oCustomAttributeDataModel.setData({CustomAttributeDataCollection:[]});this.oUtilityModelTaskDescription;this.oUtilityModelTaskDefinition;this.oUtilityModelCustomAttributeData;this.aFetchedTaskDefinitions=[];this.aBatchedTaskDefinitions=[];this.aFetchedTaskDescriptions=[];this.aBatchedTaskDescriptions=[];this.aFetchedCustomAttributes=[];this.aBatchedCustomAttributes=[];this.oBatchTimer;this.sLoadingText;this.iBatchThreshold=50;this.iTimerThreshold=1e3},setModel:function(t){if(sap.uiext.inbox.controller.InboxController.prototype.setModel){sap.uiext.inbox.controller.InboxController.prototype.setModel.apply(this,arguments)}if(t instanceof sap.ui.model.odata.ODataModel||t instanceof sap.ui.model.odata.v2.ODataModel){this.oUtilityModelTaskDescription=new sap.ui.model.odata.ODataModel(t.sServiceUrl);this.oUtilityModelCustomAttributeData=new sap.ui.model.odata.ODataModel(t.sServiceUrl);this.oUtilityModelTaskDefinition=new sap.ui.model.odata.ODataModel(t.sServiceUrl);this.getView()._getComponent("tasksRowRepeater").setModel(this.oTaskDefinitionModel,"TaskDefinitionModel").setModel(this.oTaskDescriptionModel,"TaskDescriptionModel");this.getView()._getComponent("listViewTable").setModel(this.oTaskDefinitionModel,"TaskDefinitionModel").setModel(this.oCustomAttributeDataModel,"CustomAttributeDataModel")}},setView:function(t){if(sap.uiext.inbox.controller.InboxController.prototype.setView){sap.uiext.inbox.controller.InboxController.prototype.setView.apply(this,arguments)}this.sLoadingText=t._oBundle.getText("INBOX_LP_LOADING")},getExpandParameters:function(){return""},addReadTaskDefinitionToBatch:function(t,i,e){if(this.aFetchedTaskDefinitions.indexOf(i+e)===-1&&this.aBatchedTaskDefinitions.indexOf(i+e)===-1){if(this.oBatchTimer===undefined){this._startBatchTimer()}var s=this._getRequestURLTaskDefinitionData(t,e);var o=this.oUtilityModelTaskDefinition.createBatchOperation(s,"GET");this.oUtilityModelTaskDefinition.addBatchReadOperations([o]);this.aBatchedTaskDefinitions.push(i+e);if(this.aBatchedTaskDefinitions.length===this.iBatchThreshold){this._submitBatchTaskDefinitions(this.oUtilityModelTaskDefinition);this.aBatchedTaskDefinitions=[]}}return""},_getRequestURLTaskDefinitionData:function(t,i){var e=this.getView().constants;var s=e.TaskCollection;var o=e.forwardSlash+s.entityName+"("+s.properties.instanceID+"='"+t+"',"+e.sapOrigin+"='"+i+"')"+e.forwardSlash+s.navParam.taskDefinition;return o},_submitBatchTaskDefinitions:function(t){var i=this;t.submitBatch(function(t,e){i._processTaskDefinitionsResponse(t.__batchResponses)},function(t){var i=JSON.parse(String(t.response.body))},true)},_processTaskDefinitionsResponse:function(t){var i,e,s,o,a,n=[],r={};function c(t,i){this.sSapOrigin=i;this.sTaskDefinitionID=t}c.prototype.toString=function(){return this.sTaskDefinitionID+this.sSapOrigin};for(var h=0;h<t.length;h++){i=t[h];if(i&&i.statusCode&&i.statusCode==200){a=i.data;e=a.SAP__Origin;s=a.TaskDefinitionID;o=a.Category;n[new c(s,e)]={Category:o};this.aFetchedTaskDefinitions.push(s+e)}else{this.aBatchedTaskDefinitions=[]}}this.oTaskDefinitionModel.setData({TaskDefinitionCollection:n},true);n=[]},addReadTaskDescriptionToBatch:function(t,i){if(this.aFetchedTaskDescriptions.indexOf(t+i)===-1&&this.aBatchedTaskDescriptions.indexOf(t+i)===-1){if(this.oBatchTimer===undefined){this._startBatchTimer()}var e=this._getRequestURLTaskDescriptionData(t,i);var s=this.oUtilityModelTaskDescription.createBatchOperation(e,"GET");this.oUtilityModelTaskDescription.addBatchReadOperations([s]);this.aBatchedTaskDescriptions.push(t+i);if(this.aBatchedTaskDescriptions.length===this.iBatchThreshold){this.aBatchedTaskDescriptions=[];this._submitBatchTaskDescriptions(this.oUtilityModelTaskDescription)}}return this.sLoadingText},_submitBatchTaskDescriptions:function(t){var i=this;t.submitBatch(function(t,e){i._processTaskDescriptionResponse(t.__batchResponses)},function(t){var i=JSON.parse(String(t.response.body))},true)},_processTaskDescriptionResponse:function(t){var i,e,s,o,a,n,r={},c={};function h(t,i){this.sSapOrigin=i;this.sTaskInstanceID=t}h.prototype.toString=function(){return this.sTaskInstanceID+this.sSapOrigin};for(var l=0;l<t.length;l++){i=t[l];if(i&&i.statusCode&&i.statusCode==200){n=i.data;e=n.SAP__Origin;s=n.InstanceID;o=n.Description;a=n.DescriptionAsHtml;r[new h(s,e)]={Description:o,DescriptionAsHtml:a};this.aFetchedTaskDescriptions.push(s+e)}else{this.aBatchedTaskDescriptions=[]}}this.oTaskDescriptionModel.setData({TaskDescriptionCollection:r},true)},_getRequestURLTaskDescriptionData:function(t,i){var e=this.getView().constants;var s=e.TaskCollection;var o=e.forwardSlash+s.entityName+"("+s.properties.instanceID+"='"+t+"',"+e.sapOrigin+"='"+i+"')"+e.forwardSlash+s.navParam.taskDescription;return o},addReadCustomAttributeDataToBatch:function(t,i){if(this.aFetchedCustomAttributes.indexOf(t+i)===-1&&this.aBatchedCustomAttributes.indexOf(t+i)===-1){if(this.oBatchTimer===undefined){this._startBatchTimer()}var e=this.getRequestURLCustomAttributeData(t,i);var s=this.oUtilityModelCustomAttributeData.createBatchOperation(e,"GET");this.oUtilityModelCustomAttributeData.addBatchReadOperations([s]);this.aBatchedCustomAttributes.push(t+i);if(this.aBatchedCustomAttributes.length===this.iBatchThreshold){this.aBatchedCustomAttributes=[];this._submitBatchCustomAttributeData(this.oUtilityModelCustomAttributeData)}}return this.sLoadingText},getRequestURLCustomAttributeData:function(t,i){var e=this.getView().constants;var s=e.TaskCollection;var o=e.forwardSlash+s.entityName+"("+s.properties.instanceID+"='"+t+"',"+e.sapOrigin+"='"+i+"')"+e.forwardSlash+s.navParam.customAttrValues;return o},_submitBatchCustomAttributeData:function(t){var i=this;t.submitBatch(function(t,e){for(var s=0;s<t.__batchResponses.length;s++){i._processCustomAttributeDataResponse(t.__batchResponses[s])}},function(t){var i=JSON.parse(String(t.response.body))},true)},_processCustomAttributeDataResponse:function(t){var i,e,s,o,a={},n={};function r(t,i){this.sSapOrigin=i;this.sTaskInstanceID=t}r.prototype.toString=function(){return this.sTaskInstanceID+this.sSapOrigin};if(t&&t.statusCode&&t.statusCode==200){var c;for(var h=0;h<t.data.results.length;h++){i=t.data.results[h];if(h===0){c=new r(i.InstanceID,i.SAP__Origin);this.aFetchedCustomAttributes.push(i.InstanceID+i.SAP__Origin)}n[i.Name]=i.Value}a[c]=n}else{this.aBatchedCustomAttributes=[]}this.oCustomAttributeDataModel.setData({CustomAttributeDataCollection:a},true)},_fireSubmitBatch:function(){if(this.aBatchedTaskDefinitions!==undefined&&this.aBatchedTaskDefinitions.length>0){this.aBatchedTaskDefinitions=[];this._submitBatchTaskDefinitions(this.oUtilityModelTaskDefinition)}if(this.aBatchedTaskDescriptions!==undefined&&this.aBatchedTaskDescriptions.length>0){this.aBatchedTaskDescriptions=[];this._submitBatchTaskDescriptions(this.oUtilityModelTaskDescription)}if(this.aBatchedCustomAttributes!==undefined&&this.aBatchedCustomAttributes.length>0){this.aBatchedCustomAttributes=[];this._submitBatchCustomAttributeData(this.oUtilityModelCustomAttributeData)}this._stopBatchTimer()},_startBatchTimer:function(){var t=this;this.oBatchTimer=window.setInterval(function(){t._fireSubmitBatch()},this.iTimerThreshold)},_stopBatchTimer:function(){window.clearInterval(this.oBatchTimer);this.oBatchTimer=undefined},getTaskInitiatorIconParts:function(){return[{path:"InstanceID"},{path:"TaskDefinitionID"},{path:"SAP__Origin"},{path:"CreatedBy"},{path:"TaskDefinitionModel>Category"}]},getTaskInitiatorIconFormatter:function(t){return function(i,e,s,o,a){if(!o){if(i&&e&&s){var n;if(a===null){this.bindElement("TaskDefinitionModel>/TaskDefinitionCollection/"+e+s+"/");return""}if(a!=null){this.setVisible(true);var r=a.toUpperCase();if(r===t._oBundle.getText("ALERT"))n=t.constants.iconPool.getIconURI("alert");else if(r===t._oBundle.getText("NOTIFICATION"))n=t.constants.iconPool.getIconURI("notification-2");else if(r===t._oBundle.getText("TODO"))n=t.constants.iconPool.getIconURI("activity-2");else if(r===t._oBundle.getText("TASK"))n=t.constants.iconPool.getIconURI("task");return n}else if(this.getBindingContext()){t.oController.addReadTaskDefinitionToBatch(i,e,s)}}}else{this.setVisible(false)}}},getExpandTaskDescriptionLinkParts:function(){return[{path:"InstanceID"},{path:"SAP__Origin"},{path:"TaskDescriptionModel>Description"},{path:"TaskDescriptionModel>DescriptionAsHtml"}]},getExpandTaskDescriptionLinkFormatter:function(t){return function(i,e,s,o){if(i&&e){this.bindElement("TaskDescriptionModel>/TaskDescriptionCollection/"+i+e+"/");if(s){var a=t.oTcmMetadata._isPropertyAvailable("TaskDescription","DescriptionAsHtml");if(!a){if(s&&s!==""){if(s.search(/(<([^>]+)>)/gi)!==-1){return"true"}}}else{if(o&&o!==""){if(o.search(/(<([^>]+)>)/gi)!==-1){return"true"}}}}return"auto"}}},isFilterOnCustomAttributesSupported:function(){return false},isSortOnCustomAttributesSupported:function(){return false},getCustomAttributeColumnParts:function(t){return[{path:"InstanceID"},{path:"SAP__Origin"},{path:"CustomAttributeDataModel>"+t}]},getCustomAttributeColumnFormatter:function(t){return function(i,e,s){if(i&&e){this.bindElement("CustomAttributeDataModel>/CustomAttributeDataCollection/"+i+e+"/");var o=this.getBindingContext();if(s!=null){return s}else if(o){return t.oController.addReadCustomAttributeDataToBatch(i,e)}}}},getTaskDetailsParts:function(){return[{path:"InstanceID"},{path:"SAP__Origin"},{path:"TaskDescriptionModel>Description"},{path:"TaskDescriptionModel>DescriptionAsHtml"}]},getTaskDetailsFormatter:function(t){return function(i,e,s,o){if(i&&e){this.bindElement("TaskDescriptionModel>/TaskDescriptionCollection/"+i+e+"/");var a=this.getBindingContext();if(s!=null){var n=t.oTcmMetadata._isPropertyAvailable("TaskDescription","DescriptionAsHtml");var r=/(<([^>]+)>)/gi;var c;if(s){if(n&&o!==""){c=o}else{c=s}}if(c!==null&&c!==undefined&&c!==""){this.data("showMore",c);this.data("showLess",c.replace(r,""));return c.replace(r,"")}else{return""}}else if(a){return t.oController.addReadTaskDescriptionToBatch(i,e)}}}}});
//# sourceMappingURL=InboxControllerAsync.js.map