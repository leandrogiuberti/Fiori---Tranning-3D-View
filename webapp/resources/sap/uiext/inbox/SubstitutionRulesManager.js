/*!
 * SAPUI5
 * (c) Copyright 2025 SAP SE. All rights reserved.
 */
jQuery.sap.declare("sap.uiext.inbox.SubstitutionRulesManager");jQuery.sap.require("sap.uiext.inbox.library");jQuery.sap.require("sap.ui.core.Control");sap.ui.core.Control.extend("sap.uiext.inbox.SubstitutionRulesManager",{metadata:{deprecated:true,library:"sap.uiext.inbox"}});jQuery.sap.require("sap.uiext.inbox.InboxUtils");jQuery.sap.require("sap.uiext.inbox.InboxConstants");jQuery.sap.require("sap.uiext.inbox.SubstitutionRulesManagerConstants");jQuery.sap.require("sap.uiext.inbox.SubstitutionRulesManagerUtils");jQuery.sap.require("sap.uiext.inbox.TCMMetadata");jQuery.sap.require("sap.ui.core.IconPool");sap.uiext.inbox.SubstitutionRulesManager.prototype.init=function(){var e=sap.ui.getCore().getConfiguration().getTheme();this._imgResourcePath=sap.ui.resource("sap.uiext.inbox","themes/"+e+"/img/");this._oBundle=sap.ui.getCore().getLibraryResourceBundle("sap.uiext.inbox");this.sUrl="";this.sPath="/SubstitutionRuleCollection";this.inboxUtils=sap.uiext.inbox.InboxUtils;this.substitutionRulesManagerUtils=sap.uiext.inbox.SubstitutionRulesManagerUtils;this.inboxConstants=sap.uiext.inbox.InboxConstants;this.substitutionConstants=sap.uiext.inbox.SubstitutionRulesManagerConstants;this.substitutionRuleCollection=this.substitutionConstants.SubstitutionRuleCollection;this.substitutesRuleCollection=this.substitutionConstants.SubstitutesRuleCollection;this.oTcmMetadata=new sap.uiext.inbox.TCMMetadata;this.constants=sap.uiext.inbox.InboxConstants;this.bUseBatch=false;this.oPendingSearchRequestInSubstitution=undefined};sap.uiext.inbox.SubstitutionRulesManager.prototype.exit=function(){this.vLayout.destroy();this.vLayout=null;function e(e){var t=sap.ui.getCore().byId(e);t&&t.destroy()}this._oBundle=undefined};sap.uiext.inbox.SubstitutionRulesManager.prototype.getSubstitutionRulesData=function(e){if(this.bUseBatch){this._fetchSubstitutionRuleCollectionData()}else{this.data.substitutionRulesCollection=[];this._fetchEnabledSubstitutionRuleCollection(e);this._fetchDisabledSubstitutionRuleCollection(e)}};sap.uiext.inbox.SubstitutionRulesManager.prototype._getSubstitutesRulesData=function(e){if(this.bUseBatch){this._fetchSubstitutesRuleCollectionData()}else{this.data.substitutesRulesCollection=[];this._fetchEnabledSubstitutesRuleCollection(e);this._fetchDisabledSubstitutesRuleCollection(e)}};sap.uiext.inbox.SubstitutionRulesManager.prototype._handleAuthenticationResponse=function(e,t){if(t.statusCode===200&&e===undefined){window.location.reload(true)}};sap.uiext.inbox.SubstitutionRulesManager.prototype._fetchSubstitutionRuleCollectionData=function(){var e=new Array;e[0]="/SubstitutionRuleCollection";if(this.oTcmMetadata._isEntitySet(this.constants.SystemInfoCollection.name,this.constants.SystemInfoCollection.entityType)){e[1]="/"+this.constants.SystemInfoCollection.name}this.oDataManager.fireBatchRequest({aPaths:e,sMethod:"GET",sBatchGroupId:"fetchInitialSubstitutionData",numberOfRequests:e.length,fnSuccess:jQuery.proxy(this.processSubstitutionData,this),fnError:jQuery.proxy(this.showSubstitutionErrorMessage,this)})};sap.uiext.inbox.SubstitutionRulesManager.prototype._fetchSubstitutesRuleCollectionData=function(){var e=this;e.oDataManager.readData("/SubstitutesRuleCollection",{success:function(t,o){e.oSubstitutesRuleCollectionModel.setData({SubstitutesRuleCollection:t.results})},error:function(t){e.showSubstitutionErrorMessage()}})};sap.uiext.inbox.SubstitutionRulesManager.prototype.processSubstitutionData=function(e,t){var o=e.__batchResponses;var i=true;if(this.oTcmMetadata._isEntitySet(this.constants.SystemInfoCollection.name,this.constants.SystemInfoCollection.entityType)){var s=o[1];if(s&&s.statusCode&&s.statusCode==200){this.oSystemInfoData=s.data.results}else{i=false}}var a=o[0];if(a&&a.statusCode&&a.statusCode==200){this._getSubstitutionRuleCollectionModel().setData({SubstitutionRuleCollection:a.data.results})}else{i=false}if(!i){this.showSubstitutionErrorMessage()}};sap.uiext.inbox.SubstitutionRulesManager.prototype._fetchEnabledSubstitutionRuleCollection=function(e){var t=this;e.read("/SubstitutionRuleCollection?$filter=IsEnabled%20eq%20true",null,null,true,function(e,o){t._handleAuthenticationResponse(e,o);t.data.substitutionRulesCollection=t.data.substitutionRulesCollection.concat(e.results);t._getSubstitutionRuleCollectionModel().setData({SubstitutionRuleCollection:t.data.substitutionRulesCollection})},function(e){t.showSubstitutionErrorMessage()})};sap.uiext.inbox.SubstitutionRulesManager.prototype._fetchDisabledSubstitutionRuleCollection=function(e){var t=this;e.read("/SubstitutionRuleCollection?$filter=IsEnabled%20eq%20false",null,null,true,function(e,o){t._handleAuthenticationResponse(e,o);t.data.substitutionRulesCollection=t.data.substitutionRulesCollection.concat(e.results);t._getSubstitutionRuleCollectionModel().setData({SubstitutionRuleCollection:t.data.substitutionRulesCollection})},function(e){t.showSubstitutionErrorMessage()})};sap.uiext.inbox.SubstitutionRulesManager.prototype._fetchEnabledSubstitutesRuleCollection=function(e){var t=this;e.read("/SubstitutesRuleCollection?$filter=IsEnabled%20eq%20true",null,null,true,function(e,o){t._handleAuthenticationResponse(e,o);t.data.substitutesRulesCollection=t.data.substitutesRulesCollection.concat(e.results);t.oSubstitutesRuleCollectionModel.setData({SubstitutesRuleCollection:t.data.substitutesRulesCollection})},function(e){t.showSubstitutionErrorMessage()})};sap.uiext.inbox.SubstitutionRulesManager.prototype._fetchDisabledSubstitutesRuleCollection=function(e){var t=this;e.read("/SubstitutesRuleCollection?$filter=IsEnabled%20eq%20false",null,null,true,function(e,o){t._handleAuthenticationResponse(e,o);t.data.substitutesRulesCollection=t.data.substitutesRulesCollection.concat(e.results);t.oSubstitutesRuleCollectionModel.setData({SubstitutesRuleCollection:t.data.substitutesRulesCollection})},function(e){t.showSubstitutionErrorMessage()})};sap.uiext.inbox.SubstitutionRulesManager.prototype.showSubstitutionErrorMessage=function(){this.showMessage("error",this._oBundle.getText("INBOX_MSG_FETCH_SUBSTITUTION_FAILED"))};sap.uiext.inbox.SubstitutionRulesManager.prototype.open=function(){var e=this.getModel();if(e instanceof sap.ui.model.odata.ODataModel){var t=e.getServiceMetadata();if(e.sServiceUrl&&t){this.oTcmMetadata.setServiceMetadata(t)}}this.overlayContainer=this.populateOverlayContainer();this.overlayContainer.open()};sap.uiext.inbox.SubstitutionRulesManager.prototype.populateOverlayContainer=function(){var e=this;var t=this.getId()+"--";var o=sap.ui.getCore().byId(t+"substitutionOverlayContainer");if(o===undefined){o=new sap.ui.ux3.OverlayContainer(t+"substitutionOverlayContainer");o.setOpenButtonVisible(false);o.attachClose(function(t){e.closeNotificationBar1();if(e.bSubstituteDataRefreshed){e.bSubstituteDataRefreshed=false}});var i=sap.ui.getCore().byId(t+"substitutionVLayout");if(i===undefined){i=new sap.ui.commons.layout.VerticalLayout(t+"substitutionVLayout")}i.setWidth("95%");i.addStyleClass("verticalLayoutStyle");var s=sap.ui.getCore().byId(t+"substDummyLabel0");if(s===undefined){s=new sap.ui.commons.Label(this.getId()+"--"+"substDummyLabel0",{text:""})}var a=sap.ui.getCore().byId(t+"newSubstitutionLink");if(a===undefined){a=new sap.ui.commons.Link(t+"newSubstitutionLink",{text:this._oBundle.getText("SUBSTITUTION_RULE_CREATE_NEW_BUTTON"),tooltip:this._oBundle.getText("SUBSTITUTION_RULE_CREATE_TOOLTIP")})}a.attachPress(e,e.openCreateSubstRulePopup);a.addStyleClass("newSubstitutionLink");var n=sap.ui.getCore().byId(t+"subsNavBar");if(n===undefined){n=new sap.ui.ux3.NavigationBar(t+"subsNavBar",{items:[new sap.ui.ux3.NavigationItem(t+"mySubstitutes",{key:t+"mySubstitutes",text:this._oBundle.getText("SUBSTITUTION_MY_SUBSTITUTES_TAB_TITLE"),tooltip:this._oBundle.getText("SUBSTITUTION_MY_SUBSTITUTES_TAB_TITLE")}),new sap.ui.ux3.NavigationItem(t+"iamSubstituting",{key:t+"iamSubstituting",text:this._oBundle.getText("SUBSTITUTION_I_AM_SUBSTITUTING_TAB_TITLE"),tooltip:this._oBundle.getText("SUBSTITUTION_I_AM_SUBSTITUTING_TAB_TITLE")})]})}n.setSelectedItem(t+"mySubstitutes");n.addStyleClass("navigationBarMargin");n.addStyleClass("sapUiExtInboxSubstitutionNavigationBar");var u=sap.ui.getCore().byId(t+"substDummyLabel");if(u===undefined){u=new sap.ui.commons.Label(this.getId()+"--"+"substDummyLabel",{text:""})}var r=0;i.insertContent(s,r);if(sap.ui.getCore().byId(t+"notificationBar1")===undefined){i.insertContent(this.populateNotificationBar(),++r)}i.insertContent(n,++r);i.insertContent(a,++r);i.insertContent(u,++r);var l=sap.ui.getCore().byId(t+"activeAndinactiveRulesVLayout");if(l===undefined){l=new sap.ui.commons.layout.VerticalLayout(t+"activeAndinactiveRulesVLayout");l.setWidth("100%");l.insertContent(new sap.ui.commons.Label({text:e._oBundle.getText("SUBSTITUTION_ACTIVE_SUBSTITUTION_RULE"),design:sap.ui.commons.LabelDesign.Bold}).addStyleClass("activeLabelFontSize"),0);l.insertContent(new sap.ui.commons.Label({text:""}),1);l.insertContent(new sap.ui.commons.Label({text:""}),2);l.insertContent(new sap.ui.commons.Label({text:""}),3);l.insertContent(new sap.ui.commons.Label({text:e._oBundle.getText("SUBSTITUTION_INACTIVE_SUBSTITUTION_RULE"),design:sap.ui.commons.LabelDesign.Bold}).addStyleClass("activeLabelFontSize"),4);l.insertContent(new sap.ui.commons.Label({text:""}),5);l.insertContent(new sap.ui.commons.Label({text:""}),6)}var p=++r;i.insertContent(e.getOverlayContent(t+"mySubstitutes",l),p);o.addContent(i);n.attachSelect(function(t){var o=t.getParameter("item").getKey();i.removeContent(p);i.insertContent(e.getOverlayContent(o,l),p)})}else{var n=sap.ui.getCore().byId(t+"subsNavBar");n.setSelectedItem(t+"mySubstitutes");var l=sap.ui.getCore().byId(t+"activeAndinactiveRulesVLayout");var i=sap.ui.getCore().byId(t+"substitutionVLayout");i.insertContent(e.getOverlayContent(t+"mySubstitutes",l),p);o.addContent(i)}return o};sap.uiext.inbox.SubstitutionRulesManager.prototype.getOverlayContent=function(e,t){var o=this.getId()+"--";var i=this;var s={};var a=sap.ui.getCore().byId(o+"substitutionOverlayContainer");var n=sap.ui.getCore().byId(o+"newSubstitutionLink");var u=sap.ui.getCore().byId(o+"substitutionVLayout");if(s[e])return s[e];if(e===o+"mySubstitutes"){n.setVisible(i.isSubstitutionRuleCreationSupported);t.removeContent(2);t.insertContent(i.createSubtRuleRowReapterContent(e,true),2);t.removeContent(6);t.insertContent(i.createSubtRuleRowReapterContent(e,false),8);s[e]=t}else if(e===o+"iamSubstituting"){n.setVisible(false);t.removeContent(2);t.insertContent(i.createSubtRuleRowReapterContent(e,true),2);t.removeContent(6);t.insertContent(i.createSubtRuleRowReapterContent(e,false),8);s[e]=t}return s[e]};sap.uiext.inbox.SubstitutionRulesManager.prototype.openCreateSubstRulePopup=function(e,t){var o=this;var i=t.getId()+"--";var s=sap.ui.getCore().byId(i+"newSubstitutionLink");var a=sap.ui.getCore().byId(i+"createSubsRulePopup");if(a===undefined){a=new sap.ui.ux3.ToolPopup(i+"createSubsRulePopup",{modal:true});var n=new sap.ui.commons.layout.MatrixLayout(i+"popupMainMatrix",{layoutFixed:false,width:"300px",columns:2,widths:["25%","75%"]});var u=new sap.ui.commons.layout.MatrixLayoutCell(i+"popupMainMatrixCell1",{colSpan:2});var r=new sap.ui.commons.layout.MatrixLayoutCell(i+"popupMainMatrixCellMsgBar",{colSpan:2});u.addContent(new sap.ui.commons.TextView(i+"popupCreateSubstRuleTxt",{text:t._oBundle.getText("CREATE_SUBSTITUTION_RULE"),design:sap.ui.commons.TextViewDesign.H3}));n.createRow(u);n.createRow(r);t.populateNotificationBar(t);var l=new sap.ui.commons.layout.MatrixLayoutCell(i+"popupMainMatrixCell2",{colSpan:2});l.addContent(new sap.ui.commons.HorizontalDivider(i+"popHorzDivdr1"));n.createRow(l);var p=new sap.ui.commons.Label(i+"popupSubstLbl",{text:t._oBundle.getText("SUBSTITUTION_RULE_SUBSTITUTE_LABEL")});var d=new sap.ui.commons.ValueHelpField(i+"popupValueHelp",{width:"100%"});d.addDelegate({onAfterRendering:function(){d.$("input").prop("maxLength",0);d.$("input").prop("readonly","readonly")}});d.attachValueHelpRequest(t,t.openUsersDialog);d.setRequired(true);d.setTooltip(t._oBundle.getText("SUBSTITUTION_RULE_SUBSTITUTE_TOOLTIP"));p.setLabelFor(d);n.createRow(p,d);var T=new sap.ui.commons.Label(i+"popupAutoFwdtLbl",{text:t._oBundle.getText("SUBSTITUTION_AUTOMATIC_FORWARDING_LABEL")});var S=new sap.ui.commons.SegmentedButton(i+"popupSegBtn",{buttons:[new sap.ui.commons.Button(i+"popupSegBtnON",{text:t._oBundle.getText("SUBSTITUTION_AUTOMATIC_FORWARDING_ON_STATE_TEXT"),tooltip:t._oBundle.getText("SUBSTITUTION_AUTOMATIC_FORWARDING_ON_STATE")}),new sap.ui.commons.Button(i+"popupSegBtnOFF",{text:t._oBundle.getText("SUBSTITUTION_AUTOMATIC_FORWARDING_OFF_STATE_TEXT"),tooltip:t._oBundle.getText("SUBSTITUTION_AUTOMATIC_FORWARDING_OFF_STATE")})]});S.attachSelect(function(e){if(sap.ui.getCore().byId(e.getParameters().selectedButtonId).getText()==t._oBundle.getText("SUBSTITUTION_AUTOMATIC_FORWARDING_ON_STATE_TEXT")){sap.ui.getCore().byId(i+"popupFromDatePicker").setProperty("visible",true);sap.ui.getCore().byId(i+"popupToDatePicker").setProperty("visible",true);sap.ui.getCore().byId(i+"popupFromLbl").setProperty("visible",true);sap.ui.getCore().byId(i+"popupToLbl").setProperty("visible",true);sap.ui.getCore().byId(i+"popupFromDatePicker").setProperty("required",true);sap.ui.getCore().byId(i+"popupToDatePicker").setProperty("required",true)}else{sap.ui.getCore().byId(i+"popupFromDatePicker").setProperty("visible",false);sap.ui.getCore().byId(i+"popupToDatePicker").setProperty("visible",false);sap.ui.getCore().byId(i+"popupFromLbl").setProperty("visible",false);sap.ui.getCore().byId(i+"popupToLbl").setProperty("visible",false);sap.ui.getCore().byId(i+"popupFromDatePicker").setProperty("required",false);sap.ui.getCore().byId(i+"popupToDatePicker").setProperty("required",false)}n.rerender()});S.setSelectedButton(i+"popupSegBtnON");T.setLabelFor(S);T.setWrapping(true);n.createRow(T,S);if(t.bSubstitutionProfileAvailable){var c=new sap.ui.commons.Label(i+"substProfileLbl",{text:t._oBundle.getText("SUBSTITUTION_RULE_SUBSTITUTION_PROFILE"),wrapping:true});var b=new sap.ui.commons.ValueHelpField(i+"substProfileValueHelp",{width:"100%"}).addDelegate({onAfterRendering:function(){b.$("input").prop("maxLength",0);b.$("input").prop("readonly","readonly")}}).attachValueHelpRequest(t,t.openSubstProfileDialog).setRequired(false).setTooltip(t._oBundle.getText("SUBSTITUTION_RULE_SUBSTITUTION_PROFILE_TOOLTIP"));c.setLabelFor(b);n.createRow(c,b)}var g=new sap.ui.commons.Label(i+"popupFromLbl",{text:t._oBundle.getText("SUBSTITUTION_SUBSTITUTION_FROM_DATE_LABEL")});var _=new sap.ui.commons.DatePicker(i+"popupFromDatePicker",{text:t._oBundle.getText("SUBSTITUTION_SUBSTITUTION_FROM_DATE_LABEL"),width:"100%",tooltip:t._oBundle.getText("SUBSTITUTION_CREATE_FROM_DATE_TOOLTIP")});_.setRequired(true);_.setYyyymmdd(t.substitutionRulesManagerUtils._getTodaysDateinYYYYMMDD());g.setLabelFor(_);n.createRow(g,_);var f=new sap.ui.commons.Label(i+"popupToLbl",{text:t._oBundle.getText("SUBSTITUTION_SUBSTITUTION_TO_DATE_LABEL")});var I=new sap.ui.commons.DatePicker(i+"popupToDatePicker",{text:t._oBundle.getText("SUBSTITUTION_SUBSTITUTION_TO_DATE_LABEL"),width:"100%",tooltip:t._oBundle.getText("SUBSTITUTION_CREATE_TO_DATE_TOOLTIP")});I.setRequired(true);f.setLabelFor(I);n.createRow(f,I);var R=new sap.ui.commons.Label(i+"activateCheckBoxLbl",{text:t._oBundle.getText("SUBSTITUTION_RULE_ACTIVATE")});var C=new sap.ui.commons.CheckBox(i+"activateCheckBox",{tooltip:t._oBundle.getText("SUBSTITUTION_RULE_ACTIVATE_TOOLTIP"),checked:true});R.setLabelFor(C);n.createRow(R,C);var m=new sap.ui.commons.layout.MatrixLayoutCell(i+"popupMainMatrixCell3",{colSpan:2});m.addContent(new sap.ui.commons.HorizontalDivider(i+"popHorzDivdr2"));n.createRow(m);var y=new sap.ui.commons.Button(i+"popupCreateBtn",{text:t._oBundle.getText("SUBSTITUTION_SUBSTITUTIN_RULE_CREATE_BUTTON"),tooltip:t._oBundle.getText("SUBSTITUTION_CREATE_BUTTON_TOOLTIP")});y.attachPress(t,t.createSubstitutionRule);var x=new sap.ui.commons.Button(i+"popupCancelBtn",{text:t._oBundle.getText("SUBSTITUTION_SUBSTITUTIN_RULE_CANCEL_BUTTON"),tooltip:t._oBundle.getText("SUBSTITUTION_CANCEL_BUTTON_TOOLTIP"),press:function(){a.close();a.destroy()}});n.createRow(y,x);a.addContent(n)}t.deleteMessage();a.setPosition(sap.ui.core.Popup.Dock.EndTop,sap.ui.core.Popup.Dock.BeginTop,s.getDomRef(),"-10 -10","fit");a.setInitialFocus(t.getId()+"--popupValueHelp-input");a.open()};sap.uiext.inbox.SubstitutionRulesManager.prototype.createSubtRuleRowReapterContent=function(e,t){var o=e===this.getId()+"--"+"mySubstitutes"?true:false;var i=e;if(t){i=i+"active"+"--"}else{i=i+"inactive"+"--"}var s=this;var a=sap.ui.getCore().byId(i+"subsRowRepeater");if(a===undefined){a=new sap.ui.commons.RowRepeater(i+"subsRowRepeater",{});a.attachPage(s,s.deleteMessage);a.setDesign(sap.ui.commons.RowRepeaterDesign.Transparent);s.setNoOfRules(i);jQuery(window).resize(function(e){s.setNoOfRules(i);a.rerender()});a.setNoData(new sap.ui.commons.TextView({text:s._oBundle.getText("SUBSTITUTION_VALIDATION_MESSAGE_NO_SUBSTITUTION_RULES_FOUND")}));var n=new sap.ui.commons.layout.MatrixLayout(i+"rowRepMainMatrix",{layoutFixed:true});if(s.bSubstitutionProfileAvailable){n.setWidths(["2%","30%","18%","18%","17%","12%","3%"]);n.setColumns(7)}else{n.setWidths(["2%","37%","24%","21%","12%","3%"]);n.setColumns(6)}if(t){n.addStyleClass("borderFillColorGray");n.addStyleClass("shadowEffectGray");n.addStyleClass("mySapUiMltPadRight")}else{n.addStyleClass("borderFillColorGray");n.addStyleClass("shadowEffectGray")}var u=new sap.ui.commons.layout.MatrixLayoutCell(i+"rowRepEmptyCell");var r=new sap.ui.commons.TextView(i+"substitutionID");r.setVisible(false);r.bindProperty("text","SubstitutionRuleID");u.addContent(r);var l=new sap.ui.commons.layout.MatrixLayout(i+"rowRepSubsDetailMatLyt",{columns:1,layoutFixed:true});var p=new sap.ui.commons.layout.MatrixLayoutRow(i+"rowRepEmptyRow1");var d=new sap.ui.commons.TextView(i+"rowRepEmpltyTxt1",{text:""});var T=new sap.ui.commons.layout.MatrixLayoutCell(i+"rowRepEmpltyCell1",{backgroundDesign:sap.ui.commons.layout.BackgroundDesign.Transparent});T.addContent(d);p.addCell(T);var S=new sap.ui.commons.layout.MatrixLayoutRow(i+"rowRepSubstNameRow");var c;c=new sap.ui.commons.TextView(i+"rowRepSubstNameTxtView");c.bindProperty("text","FullName",function(e){if(e!==null&&e!==""){return e}});c.addStyleClass("blueFontColor");c.addStyleClass("boldFontWeight");c.addStyleClass("sapUiExtSubstitutionPadding");var b=new sap.ui.commons.layout.MatrixLayoutCell(i+"rowRepSubstNameCell",{backgroundDesign:sap.ui.commons.layout.BackgroundDesign.Transparent});b.addContent(c);S.addCell(b);l.addRow(S);var g=new sap.ui.commons.layout.MatrixLayoutRow(i+"rowRepUsrFriendlyRow");var _=new sap.ui.commons.TextView(i+"rowRepUsrFriendlyTxt");_.addStyleClass("blackFontColor");_.bindProperty("text","FullName",function(e){if(e!==null&&e!==""&&e){var t=this.getModel();return s.substitutionRulesManagerUtils._getText(e,o,t.getProperty("IsEnabled",this.getBindingContext(),false),t.getProperty("SupportsEnableSubstitutionRule",this.getBindingContext(),false),t.getProperty("BeginDate",this.getBindingContext(),false),t.getProperty("EndDate",this.getBindingContext(),false))}});var f=new sap.ui.commons.layout.MatrixLayoutCell(i+"rowRepUsrFriendly");f.addContent(_);g.addCell(f);l.addRow(g);if(s.bSubstitutionProfileAvailable){var I=new sap.ui.commons.layout.MatrixLayout(i+"rowRepSubstProfileMatLyt",{columns:1,layoutFixed:true});var R=new sap.ui.commons.TextView(i+"rowRepSystemInfoTxt").bindText({path:"SAP__Origin",formatter:function(e){var t="";if(e&&s.oSystemInfoData){jQuery.each(s.oSystemInfoData,function(o,i){if(i.SAP__Origin===e){t=s._oBundle.getText("SUBSTITUTION_RULE_SYSTEM_ALIAS")+" : "+i.SystemAlias;return false}})}return t}}).addStyleClass("grayFontColor").addStyleClass("sapUiExtSubstitutionPadding");var C=new sap.ui.commons.layout.MatrixLayoutCell(i+"rowRepSystemInfoCell");var m=new sap.ui.commons.layout.MatrixLayoutRow(i+"rowRepSystemInfoRow");C.addContent(R);m.addCell(C);I.addRow(m);var y=new sap.ui.commons.TextView(i+"rowRepSubstProfileTxt").bindText({parts:[{path:"ProfileText",type:new sap.ui.model.type.String},{path:"Profile",type:new sap.ui.model.type.String}],formatter:function(e,t){if(e&&t){return s._oBundle.getText("SUBSTITUTION_RULE_SUBSTITUTION_PROFILE")+" : "+e+" ("+t+")"}else{return""}}}).addStyleClass("grayFontColor");var x=new sap.ui.commons.layout.MatrixLayoutCell(i+"rowRepSubstProfileCell");var h=new sap.ui.commons.layout.MatrixLayoutRow(i+"rowRepSubstProfileRow");x.addContent(y);h.addCell(x);I.addRow(h)}var U=new sap.ui.commons.layout.MatrixLayout(i+"rowRepSinceUntilMatLyt",{columns:1,layoutFixed:true});var v=new sap.ui.commons.layout.MatrixLayoutRow(i+"rowRepSinceDateRow");var B=new sap.ui.commons.TextView(i+"rowRepSinceDateTxt");B.addStyleClass("grayFontColor");B.addStyleClass("sapUiExtSubstitutionPadding");var E=s._oBundle.getText("SUBSTITUTION_RULE_SINCE_LABEL");if(!t){E=s._oBundle.getText("SUBSTITUTION_SUBSTITUTION_FROM_DATE_LABEL")}B.bindText({parts:[{path:"BeginDate"},{path:"Mode"}],formatter:function(e,t){if(t&&t===s.substitutionConstants.MODE_RECEIVE_TASKS){return E+" : "+s.substitutionRulesManagerUtils._getFormattedDate(e)}}});var M=new sap.ui.commons.layout.MatrixLayoutCell(i+"rowRepSinceDate");M.addContent(B);v.addCell(M);U.addRow(v);var O=new sap.ui.commons.layout.MatrixLayoutRow(i+"rowRepUntilDateRow");var w=new sap.ui.commons.TextView(i+"rowRepUntilDateTxt");w.addStyleClass("grayFontColor");w.bindText({parts:[{path:"EndDate"},{path:"Mode"}],formatter:function(e,t){if(t&&t===s.substitutionConstants.MODE_RECEIVE_TASKS){return s._oBundle.getText("SUBSTITUTION_RULE_UNTIL_LABEL")+" : "+s.substitutionRulesManagerUtils._getFormattedDate(e)}}});var D=new sap.ui.commons.layout.MatrixLayoutCell(i+"rowRepUntilDateCell");D.addContent(w);O.addCell(D);U.addRow(O);var L=new sap.ui.commons.layout.MatrixLayout(i+"rowRepActiveTimeMatLyt",{columns:1,layoutFixed:true});var N=new sap.ui.commons.layout.MatrixLayoutRow(i+"rowRepActiveRow");var A=new sap.ui.commons.TextView(i+"rowRepActiveTxt");A.addStyleClass("grayFontColor");A.addStyleClass("boldFontWeight");A.addStyleClass("sapUiExtSubstitutionPadding");A.bindText({parts:[{path:"Mode"},{path:"IsEnabled"},{path:"BeginDate"},{path:"EndDate"}],formatter:function(e,t,i,a){if(e&&e===s.substitutionConstants.MODE_RECEIVE_TASKS){return s.substitutionRulesManagerUtils._getStatus(o,t,i,a)}}});var P=new sap.ui.commons.layout.MatrixLayoutCell(i+"rowRepActiveCell",{backgroundDesign:sap.ui.commons.layout.BackgroundDesign.Transparent});P.addContent(A);N.addCell(P);L.addRow(N);var F=new sap.ui.commons.SegmentedButton(i+"rowRepOnOffSegBtn",{visible:false,buttons:[new sap.ui.commons.Button(i+"rowRepOnSegBtn",{text:s._oBundle.getText("SUBSTITUTION_AUTOMATIC_FORWARDING_ON_STATE_TEXT"),tooltip:s._oBundle.getText("SUBSTITUTION_AUTOMATIC_FORWARDING_ON_STATE_TEXT")}),new sap.ui.commons.Button(i+"rowRepOffSegBtn",{text:s._oBundle.getText("SUBSTITUTION_AUTOMATIC_FORWARDING_OFF_STATE_TEXT"),tooltip:s._oBundle.getText("SUBSTITUTION_AUTOMATIC_FORWARDING_OFF_STATE_TEXT")})]});F.bindProperty("visible",{parts:[{path:"Mode"},{path:"SupportsEnableSubstitutionRule"}],formatter:function(e,t){if(!o)return t;else return e&&e===s.substitutionConstants.MODE_RECEIVE_TASKS&&t}});F.bindProperty("enabled","IsEnabled",function(e){if(e!=null&&e!==""){if(e){this.setSelectedButton(this.getButtons()[0].getId())}else{this.setSelectedButton(this.getButtons()[1].getId())}}return true});F.attachSelect(this,function(e,t){var o=true;if(e.mParameters.selectedButtonId.indexOf("rowRepOnSegBtn")==-1){o=false}t.updateSubstitutionRule(e,t,o)});if(o){var V=new sap.ui.commons.Button(i+"rowRepDeleteImg",{tooltip:this._oBundle.getText("SUBSTITUTION_RULE_DELETE"),icon:this.constants.iconPool.getIconURI("delete"),lite:true});V.bindProperty("visible","SupportsDeleteSubstitutionRule",function(e){return e});V.attachPress(this,this.deleteSubstitutionRule);if(s.bSubstitutionProfileAvailable){n.createRow(u,l,I,U,L,F,V)}else{n.createRow(u,l,U,L,F,V)}}else{if(s.bSubstitutionProfileAvailable){n.createRow(u,l,I,U,L,F)}else{n.createRow(u,l,U,L,F)}}var k=new sap.ui.commons.layout.MatrixLayout(i+"rowRepMainMatrixWapperMatrix",{layoutFixed:true});k.createRow(n);k.createRow(new sap.ui.commons.TextView(i+"rowRepWapperMatEmptyTxt",{text:""}));var q;if(e===this.getId()+"--iamSubstituting"){q=this.substitutesRuleCollection;a.setModel(this._getSubstitutesRuleCollectionModel())}else{q=this.substitutionRuleCollection;a.setModel(this._getSubstitutionRuleCollectionModel())}a.bindRows("/"+q,k,null,this._getFilters(t))}else{this._refreshBindings(e,t)}return a};sap.uiext.inbox.SubstitutionRulesManager.prototype.formatUserName=function(e){if(e!==null&&e!==""){var t=e.indexOf(",");var o=e.substring(t+1);if(o===" ")e=e.substring(0,t);return e}};sap.uiext.inbox.SubstitutionRulesManager.prototype.setNoOfRules=function(e){var t=sap.ui.getCore().byId(e+"subsRowRepeater");var o=jQuery(window).height();var i=Math.floor((o-230)/180);if(i>0){t.setNumberOfRows(i)}};sap.uiext.inbox.SubstitutionRulesManager.prototype.bindSubstitutionRules=function(e){};sap.uiext.inbox.SubstitutionRulesManager.prototype.deleteMessage=function(e,t){if(t===undefined)t=this;var o=sap.ui.getCore().byId(t.getId()+"--"+"notificationBar1");var i=sap.ui.ux3.NotificationBarStatus.Default;if(o!=undefined&&o.hasItems()){o.setVisibleStatus(i)}};sap.uiext.inbox.SubstitutionRulesManager.prototype.closeNotificationBar1=function(){var e=sap.ui.getCore().byId(this.getId()+"--"+"notificationBar1");var t=sap.ui.ux3.NotificationBarStatus.None;if(e!=undefined)e.setVisibleStatus(t)};sap.uiext.inbox.SubstitutionRulesManager.prototype.showMessage=function(e,t){var o=sap.ui.getCore().byId(this.getId()+"--"+"notificationBar1");var i=sap.ui.getCore().byId(this.getId()+"--"+"messageNotifier1");var s=sap.ui.ux3.NotificationBarStatus.None;if(o===undefined){this.populateNotificationBar()}if(o!=undefined){o.setVisibleStatus(s);var a=new Date;var n=sap.ui.core.format.DateFormat.getDateTimeInstance({style:"medium"});var u=n.format(a);var r=new sap.ui.core.Message({text:t,timestamp:u});if(e==="success"){r.setLevel(sap.ui.core.MessageType.Success)}else if(e==="info"){r.setLevel(sap.ui.core.MessageType.Information)}else if(e==="error"){r.setLevel(sap.ui.core.MessageType.Error)}else if(e==="warning"){r.setLevel(sap.ui.core.MessageType.Warning)}i.addMessage(r);o.setMessageNotifier(i)}};sap.uiext.inbox.SubstitutionRulesManager.prototype._getComponent=function(e){return sap.ui.getCore().byId(this.getId()+"--"+e)};sap.uiext.inbox.SubstitutionRulesManager.prototype.deleteSubstitutionRule=function(e,t){var o=e.getSource().getModel();var i=e.getSource().getBindingContext();var s=o.getProperty("SubstitutionRuleID",i);var a=o.getProperty("SAP__Origin",i);var n={};n.SubstitutionRuleID=decodeURIComponent(s);n.SAP__Origin=a;t.oDataManager.callFunctionImport(t.substitutionConstants.deleteRuleExecutionFunctionImport,{method:"POST",success:function(e,s){var a=i.getPath();var n=a.split("/");o.oData[n[1]].splice(n[2],1);o.checkUpdate(false);t.showMessage("success",t._oBundle.getText("SUBSTITUTION_VALIDATION_MESSAGE_SUBSTITUTION_RULE_DELETED_SUCCESSFULLY"))},error:function(e){if(e.response===undefined||e.response.statusCode!=205){t.showMessage("error",t._oBundle.getText("SUBSTITUTION_VALIDATION_MESSAGE_SUBSTITUTION_RULE_DELETION_FAILURE_CONTACT_ADMIN"))}else if(e.response.statusCode==205){var i={statusCode:e.response.statusCode,statusText:e.response.statusText};o.fireRequestFailed(i)}},urlParameters:n},true)};sap.uiext.inbox.SubstitutionRulesManager.prototype.updateSubstitutionRule=function(e,t,o){var i=e.getSource().getModel();var s=e.getSource().getBindingContext();var a=i.getProperty("SubstitutionRuleID",s);var n=i.getProperty("SAP__Origin",s);var u={};u.SubstitutionRuleID=decodeURIComponent(a);u.SAP__Origin=n;u.Enabled=o;t.oDataManager.callFunctionImport(t.substitutionConstants.updateRuleExecutionFunctionImport,{method:"POST",success:function(e,o){var a=sap.ui.getCore().byId(t.getId()+"--subsNavBar");var n=a.getSelectedItem();var u=s.getPath();var r=u.split("/");i.oData[r[1]][r[2]].IsEnabled=e.IsEnabled;i.checkUpdate(true);t.showMessage("success",t._oBundle.getText("SUBSTITUTION_VALIDATION_MESSAGE_SUBSTITUTION_RULE_UPDATED_SUCCESSFULLY"))},error:function(e){if(e.response===undefined||e.response.statusCode!=205){t.showMessage("error",t._oBundle.getText("SUBSTITUTION_VALIDATION_MESSAGE_SUBSTITUTION_RULE_UPDATION_FAILURE_CONTACT_ADMIN"))}else if(e.response.statusCode==205){var o={statusCode:e.response.statusCode,statusText:e.response.statusText};i.fireRequestFailed(o)}},urlParameters:u},true)};sap.uiext.inbox.SubstitutionRulesManager.prototype.isSubstitutionDatesDateTimeType=function(){var e,t;var o=false;e=this.oTcmMetadata.getParameterTypeForFunctionImport(this.substitutionConstants.CREATE_SUBSTITUTION_RULE,"BeginDate");if(e==="Edm.DateTime"){o=true}return o};sap.uiext.inbox.SubstitutionRulesManager.prototype.createSubstitutionRule=function(e,t){var o=t.validate(t);if(o===false){var i=t.getModel();var s={};var a=t.isSubstitutionDatesDateTimeType();var n=sap.ui.core.format.DateFormat.getDateInstance({pattern:"yyyyMMdd"});var u;var r;var l=t._getComponent("popupToDatePicker").getYyyymmdd();if(l!=undefined&&l!==""){var p=l.substr(0,4);var d=l.substr(4,2);var T=l.substr(6,8);var S=t.substitutionRulesManagerUtils._getTimeZoneOffset();if(S!==undefined){S=S/(60*1e3);r=new Date(Date.UTC(p,d-1,T,23,59-S,59,59))}else{r=n.parse(l);r.setHours(23,59,59,59)}}else{r=null}var c=t._getComponent("popupFromDatePicker").getYyyymmdd();if(c!=undefined&&c!==""){var b=c.substr(0,4);var g=c.substr(4,2);var _=c.substr(6,8);var S=t.substitutionRulesManagerUtils._getTimeZoneOffset();if(S!==undefined){S=S/(60*1e3);u=new Date(Date.UTC(b,g-1,_,0,-S,0,0))}else{u=n.parse(c)}}else{u=new Date;u.setHours(0,0,0,0)}a?s.BeginDate=u.getTime():s.BeginDate="/Date("+u.getTime()+")/";var f=t._getComponent("popupValueHelp");s.FullName=f.getValue();s.User=f.data("uniqueName");var I=t._getComponent("popupSegBtn");var R=I.getSelectedButton();if(R.indexOf("popupSegBtnON")>=0){s.Mode=t.substitutionConstants.MODE_RECEIVE_TASKS;a?s.EndDate=r.getTime():s.EndDate="/Date("+r.getTime()+")/"}else{s.Mode=t.substitutionConstants.MODE_TAKE_OVER;var C=new Date(9999,11,31);a?s.EndDate=C.getTime():s.EndDate="/Date("+C.getTime()+")/"}var m=t._getComponent("activateCheckBox");s.IsEnabled=m.getChecked();if(t.bSubstitutionProfileAvailable){var y=t._getComponent("substProfileValueHelp");if(y!=undefined){s.Profile=y.data("Profile");s.ProfileText=y.data("ProfileText")}t._sendCreateRuleRequestWithProfile(t,s)}else{t._sendCreateRuleRequest(t,s)}var x=sap.ui.getCore().byId(t.getId()+"--createSubsRulePopup");x.close();x.destroy()}};sap.uiext.inbox.SubstitutionRulesManager.prototype.openUsersDialog=function(e,t){var o=t.getId()+"--";var i=sap.ui.getCore().byId(o+"usersDialog");var s=sap.ui.getCore().byId(o+"userTable");if(i===undefined){var a=new sap.ui.commons.layout.MatrixLayout({id:o+"dLayout",layoutFixed:true,width:"100%"});var n=new sap.ui.commons.SearchField({id:o+"oSearch",enableListSuggest:false,startSuggestion:0,tooltip:t._oBundle.getText("SUBSTIUTION_RULE_SEARCH_FOR_USERS"),editable:true,width:"100%"});n.addDelegate({onAfterRendering:function(){var e=sap.ui.getCore().byId(o+"oSearch-tf");e.prop("placeholder",t._oBundle.getText("SUBSTITUTION_USERS_PICKLIST_SEARCH_LABEL"))}});n.attachSearch(t,function(e,t){s.setBusy(true);t._handleSearchUsersClickforCreateSubstitution(e)});n.attachSuggest(t,function(e,t){if(e.getParameter("value")===""){s.clearSelection();s.bindRows("")}});a.createRow(n);var u={collection:"UserInfoCollection",propertiesLabel:[t._oBundle.getText("SUBSTITUTION_USERS_PICKLIST_LOGONID"),t._oBundle.getText("SUBSTITUTION_USERS_PICKLIST_NAME")],properties:["UniqueName","DisplayName"]};if(s===undefined){s=new sap.ui.table.Table(o+"userTable",{selectionMode:sap.ui.table.SelectionMode.Single})}s.setModel(t.getModel());s.setVisibleRowCount(5);s.attachRowSelectionChange(function(){if(s.getSelectedIndices().length!==0){sap.ui.getCore().byId(o+"usersDialogOKBtn").setEnabled(true)}else{sap.ui.getCore().byId(o+"usersDialogOKBtn").setEnabled(false)}});s.bDynamic=true;for(var r=0;r<=u.properties.length-1;r++){s.addColumn((new sap.ui.table.Column).setLabel(new sap.ui.commons.Label({text:u.propertiesLabel[r],design:sap.ui.commons.LabelDesign.Bold})).setTemplate(new sap.ui.commons.TextField({editable:false,value:{path:u.properties[r]}})))}var l=new sap.ui.commons.layout.VerticalLayout(o+"userDialogVLayout",{width:"100%"});l.insertContent(a,0);l.insertContent(s,1);i=new sap.ui.commons.Dialog(o+"usersDialog",{modal:true,title:t._oBundle.getText("SUBSTIUTION_RULE_SEARCH_FOR_USERS"),content:[l],buttons:[new sap.ui.commons.Button(o+"usersDialogOKBtn",{enabled:false,text:t._oBundle.getText("INBOX_BUTTON_OK_TEXT"),tooltip:t._oBundle.getText("SUBSTITUTE_SEARCH_USERS_OK_BUTTON_TOOLTIP"),press:function(){var e=sap.ui.getCore().byId(o+"userTable");var s=e.getSelectedIndex();var a=e.getContextByIndex(s);var n=sap.ui.getCore().byId(o+"userTable").getModel();var u=n.getProperty("DisplayName",a);if(u===null)u="";var r=n.getProperty("UniqueName",a);var l=t._getComponent("popupValueHelp");l.setValue(u);l.data("uniqueName",r);i.close()}})]})}i.setWidth("400px");i.open();i.attachClosed(t,function(e,t){i.destroy()});i.setInitialFocus(n)};sap.uiext.inbox.SubstitutionRulesManager.prototype.validate=function(e){var t=this;var o=false;var i="";var s,a;var n=sap.ui.core.format.DateFormat.getDateInstance({pattern:"yyyyMMdd"});var u=e._getComponent("popupToDatePicker").getYyyymmdd();var r=e._getComponent("popupFromDatePicker").getYyyymmdd();if(u!=undefined&&u!==""){var l=u.substr(0,4);var p=u.substr(4,2);var d=u.substr(6,8);var T=e.substitutionRulesManagerUtils._getTimeZoneOffset();if(T!==undefined){T=T/(60*1e3);s=new Date(Date.UTC(l,p-1,d,23,59-T,59,59))}else{s=n.parse(u);s.setHours(23,59,59,59)}}if(r!=undefined&&r!==""){var S=r.substr(0,4);var c=r.substr(4,2);var b=r.substr(6,8);var T=e.substitutionRulesManagerUtils._getTimeZoneOffset();if(T!==undefined){T=T/(60*1e3);a=new Date(Date.UTC(S,c-1,b,0,-T,0,0))}else{a=n.parse(r)}}var g=e._getComponent("popupValueHelp").getValue();var _=e._getComponent("popupFromDatePicker").getProperty("required");if(g===null||g===""){o=true;i=e._oBundle.getText("SUBSTITUTION_VALIDATION_MESSAGE_SELECT_SUBSTITUTE")}if(o!=true&&_===true){if(s===null||a===null||s===""||a===""||isNaN(s)||isNaN(a)){o=true;i=e._oBundle.getText("SUBSTITUTION_VALIDATION_MESSAGE_ENTER_VALID_DATE_RANGE")}if(o!=true){if(s<a){o=true;i=e._oBundle.getText("SUBSTITUTION_VALIDATION_MESSAGE_FROM_DATE_AFTER_TODATE")}}}if(o!=true&&_!=true){if(s!=null&&a!=null){if(o!=true&&s<a){o=true;i=e._oBundle.getText("SUBSTITUTION_VALIDATION_MESSAGE_FROM_DATE_AFTER_TODATE")}}}if(o===true){e.showMessage("error",i)}return o};sap.uiext.inbox.SubstitutionRulesManager.prototype.populateNotificationBar=function(){var e=sap.ui.getCore().byId(this.getId()+"--"+"notificationBar1");if(e===undefined){var t=new sap.ui.ux3.NotificationBar({id:this.getId()+"--"+"notificationBar1",visibleStatus:"None"});t.attachDisplay(function(e){var o=t.getVisibleStatus();var i=sap.ui.ux3.NotificationBarStatus.None;var s=sap.ui.ux3.NotificationBarStatus.Default;if(o===i){t.setVisibleStatus(s)}else{t.setVisibleStatus(i)}});var o=new sap.ui.ux3.Notifier({id:this.getId()+"--"+"messageNotifier1",title:this._oBundle.getText("INBOX_NOTIFICATIONS")});t.setMessageNotifier(o);t.addStyleClass("sapUiExtInboxNotificationBar");return t;var i=this._getComponent("popupMainMatrixCellMsgBar");i.addContent(t)}};sap.uiext.inbox.SubstitutionRulesManager.prototype._refreshBindings=function(e,t){var o=e;var i=e===this.getId()+"--iamSubstituting"?this.substitutesRuleCollection:this.substitutionRuleCollection;if(i===this.substitutesRuleCollection&&!this.bSubstituteDataRefreshed){this._getSubstitutesRulesData(this.getModel());this.bSubstituteDataRefreshed=true}if(t===undefined){this._refreshBindings(e,true);this._refreshBindings(e,false)}else if(t){var s=sap.ui.getCore().byId(o+"active"+"--"+"rowRepMainMatrixWapperMatrix");var a=sap.ui.getCore().byId(o+"active"+"--"+"subsRowRepeater");a.bindRows("/"+i,s,null,this._getFilters(t))}else{var n=sap.ui.getCore().byId(o+"inactive"+"--"+"rowRepMainMatrixWapperMatrix");var u=sap.ui.getCore().byId(o+"inactive"+"--"+"subsRowRepeater");u.bindRows("/"+i,n,null,this._getFilters(t))}};sap.uiext.inbox.SubstitutionRulesManager.prototype.getSubstitutionRulesManagerUtils=function(){return this.substitutionRulesManagerUtils};sap.uiext.inbox.SubstitutionRulesManager.prototype._searchUsers=function(e){var t=this;var o=this.oTCMModel.getFunctionImportHandler();var i=t.getId()+"--";var s=sap.ui.getCore().byId(i+"userTable");o.setServiceURL(this.sUrl);o.setHeaders({Accept:this.inboxConstants.acceptHeaderforJSON,"x-csrf-token":this.getModel().oHeaders["x-csrf-token"]});var a=e.sSearchTerm;var n=e.iMaxResults;var u=e.sSAPOrigin;var r;this.oPendingSearchRequestInSubstitution=o.callSearchUsers({SearchPattern:jQuery.sap.encodeURL(a),MaxResults:n,SAP__Origin:u},function(e,o){s.setBusy(false);r=e;t.displaySubstitesSearchResults(r,s,n);t.oPendingSearchRequestInSubstitution=undefined},function(e){s.setBusy(true);if(e.response!==undefined){t.showMessage("error",t._oBundle.getText("INBOX_MSG_NO_USER_FOUND",[a]));s.setBusy(false)}t.oPendingSearchRequestInSubstitution=undefined})};sap.uiext.inbox.SubstitutionRulesManager.prototype.displaySubstitesSearchResults=function(e,t,o){if(e){var i=new sap.ui.model.json.JSONModel;i.setData(e);t.clearSelection();t.setModel(i);t.bindRows("/results");if(e.results.length>0){t.setSelectedIndex(0)}}if(e.results.length===o){this.showMessage("warning",this._oBundle.getText("INBOX_TOP_MAX_USER",[o]))}if(e.results.length===0){this.showMessage("error",this._oBundle.getText("INBOX_MSG_FOR_NO_DATA"))}};sap.uiext.inbox.SubstitutionRulesManager.prototype._handleSearchUsersClickforCreateSubstitution=function(e){var t=this.oConfiguration?this.oConfiguration.getSearchUersMaxLimit():100;var o="";var i=e.getParameter("query").trim();if(this.bSystemInfoAvailable===undefined){var s=this.constants.SystemInfoCollection;this.bSystemInfoAvailable=this.oTcmMetadata._isEntitySet(s.name,s.entityType)}if(this.bSystemInfoAvailable){o=this.oSystemInfoData[0].SAP__Origin}if(this.oPendingSearchRequestInSubstitution!==undefined){this.oPendingSearchRequestInSubstitution.abort()}this._searchUsers({sSearchTerm:i,iMaxResults:t,sSAPOrigin:o})};sap.uiext.inbox.SubstitutionRulesManager.prototype._sendCreateRuleRequestWithProfile=function(e,t){var o=jQuery.proxy(function(o){if(o.length==0){this._sendCreateRuleRequest(e,t)}else{var i=e.isSubstitutionDatesDateTimeType();if(i){t.BeginDate="/Date("+t.BeginDate+")/";t.EndDate="/Date("+t.EndDate+")/"}if(o.length===1){this._createSubRuleWithProfile(t,o[0])}else if(o.length>1){this._createSubRuleWithProfileBatch(t,o)}}},this);this._getProvidersForCreateSubstitution(t,o)};sap.uiext.inbox.SubstitutionRulesManager.prototype._sendCreateRuleRequest=function(e,t){var o="Profile";if(!t[o]){delete t[o]}var i=this.getModel();var s=this._getSubstitutionRuleCollectionModel();if(this.oTcmMetadata._isFunctionImport(this.substitutionConstants.CREATE_SUBSTITUTION_RULE)){i.callFunction("CreateSubstitutionRule","POST",t,null,function(t,o){e.showMessage("success",e._oBundle.getText("SUBSTITUTION_VALIDATION_MESSAGE_SUBSTITUTION_RULE_CREATED_SUCCESSFULLY"));s.oData.SubstitutionRuleCollection.push(t);s.checkUpdate(false)},function(t){e.showMessage("error",e._oBundle.getText("SUBSTITUTION_VALIDATION_MESSAGE_SUBSTITUTION_RULE_CREATION_FAILURE_CONTACT_ADMIN"))})}else{i.create(e.sPath,t,null,function(t,o){e.showMessage("success",e._oBundle.getText("SUBSTITUTION_VALIDATION_MESSAGE_SUBSTITUTION_RULE_CREATED_SUCCESSFULLY"));s.oData.SubstitutionRuleCollection.push(t);s.checkUpdate(false);i.oHeaders["DataServiceVersion"]="2.0"},function(t){e.showMessage("error",e._oBundle.getText("SUBSTITUTION_VALIDATION_MESSAGE_SUBSTITUTION_RULE_CREATION_FAILURE_CONTACT_ADMIN"))})}};sap.uiext.inbox.SubstitutionRulesManager.prototype._getSubstitutionRuleCollectionModel=function(){if(!this.oSubstitutionRuleCollectionModel)this.oSubstitutionRuleCollectionModel=new sap.ui.model.json.JSONModel;return this.oSubstitutionRuleCollectionModel};sap.uiext.inbox.SubstitutionRulesManager.prototype._getSubstitutesRuleCollectionModel=function(){if(!this.bSubstituteDataRefreshed){if(!this.oSubstitutesRuleCollectionModel)this.oSubstitutesRuleCollectionModel=new sap.ui.model.json.JSONModel;this._getSubstitutesRulesData(this.getModel());this.bSubstituteDataRefreshed=true}return this.oSubstitutesRuleCollectionModel};sap.uiext.inbox.SubstitutionRulesManager.prototype.openSubstProfileDialog=function(e,t){var o=t.getId()+"--";var i=function(e){var i={};jQuery.each(e.results,function(e,t){var o={};o.Profile=t.Profile;o.ProfileText=t.ProfileText;i[t.Profile+" - "+t.ProfileText]=o});var s=[];var a=0;jQuery.each(i,function(e,t){s[a++]=t});var n={};n.results=s;var u=new sap.ui.model.json.JSONModel;u.setData(n);var r=sap.ui.getCore().byId(o+"substProfileTable");if(r===undefined){r=new sap.ui.table.Table(o+"substProfileTable",{selectionMode:sap.ui.table.SelectionMode.Single})}r.clearSelection();r.setModel(u);r.bindRows("/results");r.setVisibleRowCount(5);r.bDynamic=true;r.addColumn((new sap.ui.table.Column).setLabel(new sap.ui.commons.Label({text:t._oBundle.getText("SUBSTITUTION_RULE_SUBSTITUTION_PROFILE"),design:sap.ui.commons.LabelDesign.Bold})).setTemplate(new sap.ui.commons.TextField({editable:false}).bindValue({parts:[{path:"ProfileText",type:new sap.ui.model.type.String},{path:"Profile",type:new sap.ui.model.type.String}],formatter:function(e,t){if(e&&t){return e+" ("+t+")"}else{return null}}})));var l=sap.ui.getCore().byId(o+"substProfileDialog");if(l===undefined){var p=new sap.ui.commons.layout.MatrixLayout({id:o+"searchSubstProfileLayout",layoutFixed:true,width:"100%"});var d=new sap.ui.commons.SearchField({id:o+"substProfileSearch",enableListSuggest:false,startSuggestion:0,tooltip:t._oBundle.getText("SUBSTIUTION_RULE_SEARCH_FOR_SUBSTITUTION_PROFILE"),editable:true,width:"100%"});d.addDelegate({onAfterRendering:function(){var e=sap.ui.getCore().byId(o+"substProfileSearch-tf");e.prop("placeholder",t._oBundle.getText("SUBSTITUTION_USERS_PICKLIST_SEARCH_LABEL"))}});d.attachSuggest(function(e){var t=e.getParameter("value");var o=[];o.push(new sap.ui.model.Filter("ProfileText",sap.ui.model.FilterOperator.Contains,t));o.push(new sap.ui.model.Filter("Profile",sap.ui.model.FilterOperator.Contains,t));var i=new sap.ui.model.Filter(o,false);r.getBinding("rows").filter(i,sap.ui.model.FilterType.Application)});p.createRow(d);var T=new sap.ui.commons.layout.VerticalLayout(o+"substProfileDialogVLayout",{width:"100%"});T.insertContent(p,0);T.insertContent(r,1);l=new sap.ui.commons.Dialog(o+"substProfileDialog",{width:"400px",modal:true,title:t._oBundle.getText("SUBSTIUTION_RULE_SEARCH_FOR_SUBSTITUTION_PROFILE"),content:[T],buttons:[new sap.ui.commons.Button(o+"substProfileDialogOKBtn",{text:t._oBundle.getText("INBOX_BUTTON_OK_TEXT"),tooltip:t._oBundle.getText("SUBSTIUTION_RULE_SEARCH_SUBSTITUTION_PROFILE_OK_BUTTON_TOOLTIP"),press:function(){var e=sap.ui.getCore().byId(o+"substProfileTable");var i=e.getSelectedIndex();var s=e.getContextByIndex(i);var a=e.getModel();var n=a.getProperty("ProfileText",s);var u=a.getProperty("Profile",s);var r=t._getComponent("substProfileValueHelp");r.setValue(n);r.data("Profile",u);r.data("ProfileText",n);l.close()}})]})}l.open();l.attachClosed(t,function(e,t){l.destroy()});l.setInitialFocus(d)};t._getSubstProfileData(i)};sap.uiext.inbox.SubstitutionRulesManager.prototype._getSubstProfileData=function(e){if(!t){var t=this.getModel()}var o=this;if(!this.oSubstitutionProfileData){this.oDataManager.readData("/SubstitutionProfileCollection",{success:function(t,i){o.oSubstitutionProfileData=t;e(o.oSubstitutionProfileData)},error:function(e){o.showMessage("error",o._oBundle.getText("INBOX_MSG_FETCH_SUBSTITUTION_PROFILE_FAILED"))}})}else{e(this.oSubstitutionProfileData)}};sap.uiext.inbox.SubstitutionRulesManager.prototype._getProvidersForCreateSubstitution=function(e,t){var o=[];var i=this._getComponent("substProfileValueHelp").getValue();if(i!=null&&i!==""){jQuery.each(this.oSubstitutionProfileData.results,function(t,i){if(i.Profile===e.Profile&&i.ProfileText===e.ProfileText){o.push(i.SAP__Origin)}})}else{var s=this.oSystemInfoData;for(var a in s){o.push(s[a].SAP__Origin)}}t(o)};sap.uiext.inbox.SubstitutionRulesManager.prototype._createSubRuleWithProfile=function(e,t){var o=this.getModel();var i=this._getSubstitutionRuleCollectionModel();var s=i.oData.SubstitutionRuleCollection.length>0;var a=this;var n={};n=jQuery.extend(true,{},e);n.SAP__Origin=t;o.create(this.sPath,n,{success:function(e,t){a.showMessage("success",a._oBundle.getText("SUBSTITUTION_VALIDATION_MESSAGE_SUBSTITUTION_RULE_CREATED_SUCCESSFULLY"));if(s)a._fetchSubstitutionRuleCollectionData();else i.oData.SubstitutionRuleCollection.push(e);i.checkUpdate(false)},error:function(e){if(e.response===undefined||e.response.statusCode!=205){a.showMessage("error",a._oBundle.getText("SUBSTITUTION_VALIDATION_MESSAGE_SUBSTITUTION_RULE_CREATION_FAILURE_CONTACT_ADMIN"))}else if(e.response.statusCode==205){var t={statusCode:e.response.statusCode,statusText:e.response.statusText};o.fireRequestFailed(t)}}})};sap.uiext.inbox.SubstitutionRulesManager.prototype._createSubRuleWithProfileBatch=function(e,t){var o=this._getSubstitutionRuleCollectionModel();var i=o.oData.SubstitutionRuleCollection.length>0;var s=this;var a=[];jQuery.each(t,function(t,o){var i={};i=jQuery.extend(true,{},e);i.SAP__Origin=o;a.push(i)});this.oDataManager.fireBatchRequest({sPath:s.sPath,sMethod:"POST",aProperties:a,numberOfRequests:t.length,sBatchGroupId:"createSubRule",fnSuccess:function(e,a){var n=e.__batchResponses;var u=[],r=[];jQuery.each(n,function(e,t){var s=t.__changeResponses;if(s){if(s[0].statusCode==="201"&&s[0].statusText==="Created"){if(!i)o.oData.SubstitutionRuleCollection.push(s[0].data);r.push(e)}else{u.push(e)}}else{u.push(e)}});if(i)s._fetchSubstitutionRuleCollectionData();if(u.length>0){if(r.length<1){s.showMessage("error",s._oBundle.getText("SUBSTITUTION_VALIDATION_MESSAGE_SUBSTITUTION_RULE_CREATION_FAILURE_CONTACT_ADMIN"))}else{s.showMessage("warning",s._oBundle.getText("INBOX_MSG_CREATE_SUBSTITUTION_SUCCESS_AND_ERROR",[r.length,t.length]))}}else{s.showMessage("success",s._oBundle.getText("SUBSTITUTION_VALIDATION_MESSAGE_SUBSTITUTION_RULE_CREATED_SUCCESSFULLY"))}o.checkUpdate(false)},fnError:function(e){s.showMessage("error",s._oBundle.getText("SUBSTITUTION_VALIDATION_MESSAGE_SUBSTITUTION_RULE_CREATION_FAILURE_CONTACT_ADMIN"))}})};sap.uiext.inbox.SubstitutionRulesManager.prototype._getFilters=function(e){var t=this.substitutionRulesManagerUtils._getTodaysDate();var o=Date.UTC(t.getFullYear(),t.getMonth(),t.getDate(),0,0,0,0);var i=Date.UTC(t.getFullYear(),t.getMonth(),t.getDate(),23,59,59,59);var s,a,n;var u=e;if(e){s=new sap.ui.model.Filter("IsEnabled",sap.ui.model.FilterOperator.EQ,true);a=new sap.ui.model.Filter("BeginDate",sap.ui.model.FilterOperator.LE,i);n=new sap.ui.model.Filter("EndDate",sap.ui.model.FilterOperator.GE,o)}else{s=new sap.ui.model.Filter("IsEnabled",sap.ui.model.FilterOperator.EQ,false);a=new sap.ui.model.Filter("BeginDate",sap.ui.model.FilterOperator.GT,i);n=new sap.ui.model.Filter("EndDate",sap.ui.model.FilterOperator.LT,o)}var r=[s,a,n];var l=new sap.ui.model.Filter(r,u);var p=[l];return p};
//# sourceMappingURL=SubstitutionRulesManager.js.map