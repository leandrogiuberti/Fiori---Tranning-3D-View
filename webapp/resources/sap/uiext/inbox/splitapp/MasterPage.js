/*!
 * SAPUI5
 * (c) Copyright 2025 SAP SE. All rights reserved.
 */
jQuery.sap.declare("sap.uiext.inbox.splitapp.MasterPage");jQuery.sap.require("sap.uiext.inbox.InboxUtils");sap.ui.base.Object.extend("sap.uiext.inbox.splitapp.MasterPage",{constructor:function(e){sap.ui.base.Object.apply(this);this.oCore=sap.ui.getCore();this.Id=e;this.utils=sap.uiext.inbox.InboxUtils;this._oBundle=this.oCore.getLibraryResourceBundle("sap.uiext.inbox");this.bPhoneDevice=jQuery.device.is.phone;this.masterPage=this._create()}});sap.uiext.inbox.splitapp.MasterPage.prototype.getPage=function(){return this.masterPage};sap.uiext.inbox.splitapp.MasterPage.prototype.setShowNavButton=function(e){this.masterPage.setShowNavButton(e);return this};sap.uiext.inbox.splitapp.MasterPage.prototype._setTcmServiceURL=function(e){this.tcmServiceURL=e};sap.uiext.inbox.splitapp.MasterPage.prototype._create=function(){var e=this.oCore.byId(this.Id+"-masterPage");if(!e){var t=this;var a=new sap.m.SearchField(t.Id+"-searchFld",{showRefreshButton:false,placeholder:t._oBundle.getText("INBOX_LP_SEARCH_LABEL"),tooltip:t._oBundle.getText("INBOX_LP_SEARCH_LABEL_TOOLTIP"),width:"100%"});a.attachSearch(t,t.handleSearch);a.attachLiveChange(t,function(e,t){if(e.getParameter("newValue")===""){t._resetSearch()}});e=new sap.m.Page(t.Id+"-masterPage",{title:t._oBundle.getText("INBOX_LP_TASKS_AND_COUNT",[""]),showNavButton:true,showFooter:false,footer:new sap.m.Bar(t.Id+"fooBar",{contentLeft:[new sap.m.Button(this.Id+"-mangSubstBtn",{tooltip:t._oBundle.getText("INBOX_MANAGE_SUBSTITUTION_RULES_TOOLTIP"),icon:"sap-icon://visits"}).attachPress(t,t._openManageSubstitutionOverlay)]}),subHeader:new sap.m.Bar(t.Id+"-searchBar",{contentMiddle:[a],contentRight:[new sap.m.Button(t.Id+"-refreshBtn",{tooltip:t._oBundle.getText("INBOX_LP_REFRESH_BUTTON_TOOLTIP"),icon:"sap-icon://synchronize"}).attachPress(t,t._refreshTasks)]})}).attachNavButtonTap(function(e){sap.ui.getCore().getEventBus().publish("sap.uiext.inbox","masterPageNavButtonTapped")});var i=new sap.m.List(t.Id+"-list",{growing:true,growingThreshold:7,visible:true,mode:sap.m.ListMode.SingleSelectMaster,threshhold:50,noDataText:t._oBundle.getText("INBOX_LP_NO_MATCHING_TASKS")}).attachSelect(this,this.handleListSelect);i.addEventDelegate({ontap:function(e){var t=i.getSelectedItem();if(t&&t.getDomRef().contains(e.target)){if(jQuery.device.is.phone)i.setSelectedItem(t,false)}}});this.oList=i;var s=new Array;s.push(new sap.m.ObjectAttribute({text:"{CreatedByName}"}));s.push((new sap.m.ObjectAttribute).bindProperty("text","CreatedOn",function(e){return t.utils._dateFormat(e)}));var r=new sap.m.ObjectListItem(t.Id+"-objLstItm",{type:"Active",title:"{TaskTitle}",icon:"sap-icon://person-placeholder",attributes:s,firstStatus:new sap.m.ObjectStatus({icon:{path:"CompletionDeadLine",formatter:function(e){if(t.utils._isOverDue(e)){return"sap-icon://pending"}}},state:sap.ui.core.ValueState.Error}),secondStatus:new sap.m.ObjectStatus(t.Id+"-objStatus").bindProperty("text",{parts:[{path:"Status",type:new sap.ui.model.type.String},{path:"StatusText",type:new sap.ui.model.type.String}],formatter:function(e,a){if(e!=null&&a){return a}else if(e!=null&&e!=""){var i=t._oBundle.getText(sap.uiext.inbox.InboxConstants.statusMap[e]);return i==""?e:i}else{return""}},useRawValues:true})}).addStyleClass("inbox_split_app_wordBreak");r.bindProperty("icon","CreatedBy",function(e){if(this.getBindingContext()){return t.utils.getUserMediaResourceURL(t.tcmServiceURL,this.getBindingContext().getProperty("SAP__Origin"),e)}else{return"sap-icon://person-placeholder"}});this.oListTemplate=r;i.attachUpdateFinished(function(e){if(t.bPhoneDevice){var a=t.oCore.byId(t.Id+"-list");var i=a.mBindingInfos.items.binding.iLength;t.masterPage.setTitle(t._oBundle.getText("INBOX_LP_TASKS_AND_COUNT",[i]))}else{var s=this.getItems();if(s.length>0){this.fireSelect({listItem:s[0],selected:true})}}});e.addContent(i)}return e};sap.uiext.inbox.splitapp.MasterPage.prototype._selectDetail=function(){var e=this.oCore.byId(this.Id+"-list");var t=e.getItems();if(!jQuery.device.is.phone&&t.length>0&&!e.getSelectedItem()){e.setSelectedItem(t[0],true);this._showDetail(t[0])}};sap.uiext.inbox.splitapp.MasterPage.prototype.handleSearch=function(e,t){t._updateList()};sap.uiext.inbox.splitapp.MasterPage.prototype._updateList=function(){var e=this;var t=new Array;var a=e.oCore.byId(e.Id+"-searchFld").getValue();if(a&&a.length>0){var i="in progress";var s=a.indexOf(" ")>=0&&i.indexOf(a.toLowerCase())!=-1?true:false;var r=a.split(" ");var o=[];jQuery.each(r,function(e,t){var a=s?"IN_PROGRESS":t;var i=new sap.ui.model.Filter("TaskTitle",sap.ui.model.FilterOperator.Contains,t);var r=new sap.ui.model.Filter("CreatedByName",sap.ui.model.FilterOperator.Contains,t);var n=new sap.ui.model.Filter("Status",sap.ui.model.FilterOperator.Contains,a);o[e]=new sap.ui.model.Filter({aFilters:[i,r,n],bAnd:false})});t.push(new sap.ui.model.Filter({aFilters:o,bAnd:true}));if(this.aFilters){t=t.concat(e.aFilters)}var n=e.oCore.byId(e.Id+"-list");var p=n.getSelectedItem();var l=n.getBinding("items");l.filter(t);if(t.length==0){n.setSelectedItem(p,true)}}};sap.uiext.inbox.splitapp.MasterPage.prototype.handleListSelect=function(e,t){var a=e.getParameter("onUpdate");var i=t.oCore.byId(t.Id+"-list");var s=i.mBindingInfos.items.binding.iLength;t.masterPage.setTitle(t._oBundle.getText("INBOX_LP_TASKS_AND_COUNT",[s]));var r=i.getItems();if(r.length>0&&!i.getSelectedItem()){i.setSelectedItem(r[0],true)}var o=i.getSelectedItem();var n=o.getBindingContext();t.oCore.getEventBus().publish("sap.uiext.inbox","masterPageListSelected",{context:n,onUpdate:a})};sap.uiext.inbox.splitapp.MasterPage.prototype.bindService=function(e){this.aFilters=e;this.oList.bindItems({path:"/TaskCollection",template:this.oListTemplate,filters:e})};sap.uiext.inbox.splitapp.MasterPage.prototype._openManageSubstitutionOverlay=function(e,t){var a=t.oCore.byId(t.Id+"--"+"substitutionRulesManager");if(a===undefined){jQuery.sap.require("sap.uiext.inbox.SubstitutionRulesManager");a=new sap.uiext.inbox.SubstitutionRulesManager(t.Id+"--"+"substitutionRulesManager")}if(a.getModel()===undefined){var i=t.oCore.getModel();var s=new sap.ui.model.odata.ODataModel(t.tcmServiceURL,true);a.setModel(s)}jQuery.sap.require("sap.uiext.inbox.tcm.TCMModel");a.oTCMModel=new sap.uiext.inbox.tcm.TCMModel;a.open()};sap.uiext.inbox.splitapp.MasterPage.prototype._refreshTasks=function(e,t){t.addBusyIndicatorOnRefresh();t.oCoreModel=t.masterPage.getModel("inboxTCMModel");t.oCoreModel.read("/TaskCollection?$filter=Status ne 'COMPLETED'&$orderby=CreatedOn desc",null,null,true,function(e,a){t.oTaskData=e.results;t._updateModel(t)},function(e){sap.m.MessageToast.show(t._oBundle.getText("INBOX_LP_MSG_FAILED_TO_READ_SERVICE_WHILE_REFRESH"))})};sap.uiext.inbox.splitapp.MasterPage.prototype._updateModel=function(e){var t=e.masterPage.getModel();var a={TaskCollection:e.oTaskData};t.setData(a);e.bindService(e.aFilters);var i=this.oCore.byId("refreshBI");if(i&&this.masterPage.indexOfContent(i)>=0){this.masterPage.removeContent(i)}};sap.uiext.inbox.splitapp.MasterPage.prototype.rerenderTask=function(e){var t=e.Status=="COMPLETED"?true:false;var a=this.oCore.byId(this.Id+"-list");var i=a.getSelectedItem();var s=i.getBindingContext().getPath();var r=s.split("/");if(t){this.masterPage.getModel().oData.TaskCollection.splice(r[2],1)}else{this.masterPage.getModel().oData.TaskCollection[r[2]]=e}this.masterPage.getModel().checkUpdate(false)};sap.uiext.inbox.splitapp.MasterPage.prototype.resetSearchCriteria=function(){var e=this.oCore.byId(this.Id+"-searchFld");if(e){e.setValue("");this._resetSearch()}};sap.uiext.inbox.splitapp.MasterPage.prototype.addBusyIndicatorOnRefresh=function(){var e=this.oCore.byId("refreshBI");if(!e){e=new sap.m.BusyIndicator("refreshBI",{text:this._oBundle.getText("INBOX_LP_LOADING")})}this.masterPage.insertContent(e,0)};sap.uiext.inbox.splitapp.MasterPage.prototype._resetSearch=function(){var e=this.oCore.byId(this.Id+"-list");if(e){var t=e.getSelectedItem();var a=e.getBinding("items")}if(a){a.filter(this.aFilters)}if(t&&this.aFilters.length==0){e.setSelectedItem(t,true)}};
//# sourceMappingURL=MasterPage.js.map