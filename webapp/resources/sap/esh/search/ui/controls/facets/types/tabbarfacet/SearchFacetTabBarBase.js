/*!
 * SAPUI5
 * Copyright (c) 2025 SAP SE or an SAP affiliate company. All rights reserved.
 * 
 */
sap.ui.define(["../../../../i18n","sap/m/Button","sap/m/ActionSheet","sap/m/Link","sap/m/Label","sap/m/VBox","sap/m/library","sap/ui/core/Control","./SearchFacetPieChart","./SearchFacetBarChart","./SearchFacetSimpleList","sap/ui/core/Element","sap/m/FlexBox","../../../OpenShowMoreDialog","../../../../personalization/PersonalizationKeys"],function(t,e,n,a,o,s,c,i,r,l,d,g,u,h,f){"use strict";function p(t){return t&&t.__esModule&&typeof t.default!=="undefined"?t.default:t}const m=p(t);const S=c["ButtonType"];const b=c["FlexAlignItems"];const B=c["FlexJustifyContent"];const C=c["PlacementType"];const y=p(r);const x=p(l);const w=p(d);const I=h["openShowMoreDialog"];const F=f["PersonalizationKeys"];const T=i.extend("sap.esh.search.ui.controls.SearchFacetTabBarBase",{renderer:{apiVersion:2,render(t,e){const n=e.getAggregation("items");if(n.length===0){return}const c=e.getContentFacets(n);t.openStart("div",e);t.attr("aria-label",m.getText("filterBy"));t.class("sapUshellSearchFacetTabBar");t.openEnd();const i=e.getBindingContext().getObject()["dimension"];const r=e.getBindingContext().getObject()["dataType"];const l=e.getBindingContext().getObject()["title"];let d;const g=e.getModel();const h=g.getPersonalizationStorageInstance().getItem(F.searchFacetPanelChartState);if(h&&Object.prototype.toString.call(h)==="[object Array]"){for(const t of h){if(t.dimension===i){d=t;break}}}let f=0;if(d&&d.buttonIndex){const t=d.buttonIndex;f=parseInt(t,10)}if(r!=g.sinaNext.AttributeType.String){f=0}e.getBindingContext().getObject()["chartIndex"]=f;const p=e.assembleChartSwitchButton(n,f,i,g.getProperty("/config").enableCharts);let S;if(r===g.sinaNext.AttributeType.String){S=new u({justifyContent:B.SpaceBetween,alignItems:b.Center,items:[new o({text:l}),p]})}else{S=new u({justifyContent:B.SpaceBetween,alignItems:b.Center,items:[new o({text:l})]})}S.addStyleClass("sapUshellSearchFacetHeader");S.data("facet-dimension",i,true);S.addStyleClass("sapUshellSearchFacetTabBarHeader");const C=new a("",{text:m.getText("showMore"),press:e.createOpenFacetDialogFn(f,n).bind(e)});C.setModel(e.getModel("i18n"));C.addStyleClass("sapUshellSearchFacetShowMoreLink");const y=new o("",{text:""});y.addStyleClass("sapUshellSearchFacetInfoZeile");const x=new s("",{items:[y,C]});x.addStyleClass("sapUshellSearchFacetShowMore");const w=new s("",{items:[S,c[f],x]});w.addStyleClass("sapUshellSearchFacetContainer");w.data("sap-ui-fastnavgroup","false",true);w.setModel(e.getModel());t.renderControl(w);n[f].addContent(c[f]);t.close("div")}},metadata:{properties:{facetType:"string",headerText:"string",selectedButtonParameters:{type:"object",defaultValue:null}},aggregations:{items:{type:"sap.m.IconTabFilter",multiple:true}}},constructor:function t(e,n){i.prototype.constructor.call(this,e,n)},getSearchFacetTabBarAndDimensionById:function t(e){const n={};n.index=0;const a=document.getElementById(e);const o=a.dataset.facetView;const s=a.dataset.facetViewIndex;const c=a.parentElement;const i=c.dataset.facetDimension;const r=Array.from(document.querySelectorAll(".sapUshellSearchFacetTabBar"));for(let t=0;t<r.length;t++){const e=r[t].querySelector(".sapUshellSearchFacetTabBarHeader");const a=e.dataset.facetDimension;if(a===i){n.index=t;n.control=g.getElementById(r[t].id);n.view=o;n.buttonIndex=s;n.dimension=i;break}}return n},storeClickedTabInformation:function t(e){const n=e.getSource()["sId"];const a=this.getSearchFacetTabBarAndDimensionById(n);const o=a.control.getModel();const s=o.getPersonalizationStorageInstance().getItem(F.searchFacetPanelChartState);const c=a.dimension;const i=a.control;const r=a.view;const l=a.buttonIndex;const d=i.getBindingContext().getObject()["dimension"];const g=e.getSource().getId();const u=[];const h={};h.tabId=n;h.buttonId=g;h.buttonIndex=l;h.dimension=d;h.view=r;u.push(h);if(s&&Object.prototype.toString.call(s)==="[object Array]"){for(const t of s){if(t.dimension!==c){u.push(t)}}}o.getPersonalizationStorageInstance().setItem(F.searchFacetPanelChartState,u);i.getBindingContext().getObject()["chartIndex"]=l},createOpenFacetDialogFn:function t(e,n){return async function(){let t;const a=this.getModel();let o=this.getDomRef();while(o&&!o.classList.contains("sapUshellSearchFacetTabBar")){o=o.parentElement}const s=o?g.getElementById(o.getAttribute("id")):null;if(s?.getBindingContext()?.getObject()["dimension"]){t=s.getBindingContext().getObject()["dimension"]}await I({searchModel:a,dimension:t,selectedTabBarIndex:e,tabBarItems:n,sourceControl:this})}},assembleChartSwitchButtons:function t(n,a){const o=[];let s=null;let c=0;for(const t of n){const n=t.getContent()[0];if(n instanceof w||n instanceof y||n instanceof x){s=new e("",{text:t.getText(),icon:t.getIcon(),press:t=>{this.storeClickedTabInformation(t);this.setProperty("selectedButtonParameters",t.getParameters())}});s.data("facet-view",t.getText(),true);s.data("facet-view-index",""+c,true);s.data("dimension",a,true);o.push(s)}c++}return o},assembleChartSwitchActionSheet:function t(e,a){const o=this.assembleChartSwitchButtons(e,a);const s=new n("",{showCancelButton:false,buttons:o,placement:C.Bottom,afterClose:()=>{window.setTimeout(()=>{const t=Array.from(document.querySelectorAll(".sapUshellSearchFacetTabBarButton"));for(const e of t){const t=e.getAttribute("data-facet-dimension");if(a===t){e.focus()}}},100)}});s.data("facet-dimension",a,true);return s},assembleChartSwitchButton:function t(n,a,o,s){const c=n[a];const i=this.assembleChartSwitchActionSheet(n,o);const r=new e("",{icon:c.getIcon(),type:S.Transparent,visible:s});r.data("facet-dimension",o,true);r.addStyleClass("sapUshellSearchFacetTabBarButton");const l=c.getText();const d=m.getText("displayAs",[l]);r.setTooltip(d);r.attachPress(()=>{i.openBy(r)});r.onAfterRendering=()=>{const t=r.getDomRef();if(t){t.setAttribute("aria-label",m.getText("dropDown"))}};return r},getContentFacets:function t(e){const n=[];for(const t of e){const e=t.getContent()[0];if(e instanceof w||e instanceof y||e instanceof x){n.push(e)}}return n}});return T});
//# sourceMappingURL=SearchFacetTabBarBase.js.map