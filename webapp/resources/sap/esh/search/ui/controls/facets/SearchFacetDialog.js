/*!
 * SAPUI5
 * Copyright (c) 2025 SAP SE or an SAP affiliate company. All rights reserved.
 * 
 */
sap.ui.define(["../../i18n","sap/esh/search/ui/SearchHelper","sap/esh/search/ui/SearchFacetDialogHelper","sap/esh/search/ui/SearchFacetDialogHelper_SearchAdvancedCondition_ModuleLoader","sap/esh/search/ui/SearchFacetDialogHelperCharts","sap/esh/search/ui/controls/SearchAdvancedCondition","sap/esh/search/ui/FacetItem","sap/m/library","sap/m/Page","sap/m/Dialog","sap/m/Select","sap/m/CheckBox","sap/m/SearchField","sap/m/ToggleButton","sap/m/Button","sap/m/StandardListItem","sap/m/SplitContainer","sap/ui/core/Item","sap/m/List","sap/m/HBox","sap/m/VBox","sap/ui/model/Filter","sap/ui/model/FilterOperator","sap/m/ScrollContainer","sap/m/Toolbar","sap/m/IconTabBar","sap/m/IconTabFilter","sap/ui/model/json/JSONModel","sap/esh/search/ui/SearchModel","../../eventlogging/UserEvents","../../hierarchydynamic/SearchHierarchyDynamicFacet","./types/SearchFacetHierarchyDynamic","./FacetTypeUI","sap/ui/core/Element","sap/ui/base/ManagedObject","sap/base/Log"],function(e,t,a,s,n,i,l,o,r,c,d,h,g,p,u,f,C,y,S,m,D,I,b,P,F,B,x,T,O,w,v,E,A,M,L,H){"use strict";function U(e){return e&&e.__esModule&&typeof e.default!=="undefined"?e.default:e}const V=U(e);const N=o["ButtonType"];const _=o["ListMode"];const R=o["ListSeparators"];const k=o["FlexAlignItems"];const j=o["FlexJustifyContent"];const z=o["BackgroundDesign"];const K=w["UserEventType"];const q=U(v);const G=U(E);const Q=A["FacetTypeUI"];const W=c.extend("sap.esh.search.ui.controls.SearchFacetDialog",{renderer:{apiVersion:2},metadata:{properties:{tabBarItems:{type:"object"},selectedAttribute:{type:"string"},selectedTabBarIndex:{type:"int"}}},constructor:function e(i,l){const o=new s;c.prototype.constructor.call(this,i,l);const r=typeof i==="object"?i:l;this.bConditionValidateError=false;this.bShowCharts=true;this.bOldPieChart=true;this.chartOnDisplayIndex=r.selectedTabBarIndex;this.facetOnDisplayIndex=0;this.chartOnDisplayIndexByFilterArray=[];this.aItemsForBarChart=[];this.aItemsForBarChartFacetTotalCount=undefined;this.SearchFacetDialogHelperCharts=new n(this);if(!this.getProperty("tabBarItems")){n.setDummyTabBarItems(this)}this.setShowHeader(true);this.setTitle(V.getText("dialogTitle"));this.setHorizontalScrolling(false);this.setVerticalScrolling(false);this.setContentHeight("35rem");this.setBeginButton(new u({text:V.getText("okDialogBtn"),type:N.Emphasized,press:e=>{this.onOkClick();this.close();this.getModel().destroy();this.destroy()}}));this.setEndButton(new u({text:V.getText("cancelDialogBtn"),press:e=>{this.onCancelClick();this.close();this.getModel().destroy();this.destroy()}}));this.setEscapeHandler(()=>{this.onCancelClick();this.close();this.getModel().destroy();this.destroy()});this.addContent(this.createContainer());a.init(this);this.addStyleClass("sapUshellSearchFacetDialog");this.onSearchFieldLiveChangeDelayed=t.delayedExecution(this.onSearchFieldLiveChange,1e3)},createContainer:function e(){this.oSplitContainer=new C({masterPages:this.createMasterPages()});this.oSplitContainer.bindAggregation("detailPages",{path:"/facetDialog",factory:(e,t)=>this.createDetailPage(e,t)});this.oSplitContainer.addStyleClass("sapUshellSearchFacetDialogContainer");return this.oSplitContainer},setModel:function e(t,a){c.prototype.setModel.call(this,t,a);if(t instanceof O&&typeof t.config!=="undefined"){if(t.config.optimizeForValueHelp){this.addStyleClass("sapUshellSearchFacetDialogValueHelp")}}return this},createMasterPages:function e(){const t=new S({mode:_.SingleSelectMaster,selectionChange:e=>{this.onMasterPageSelectionChange(e)}});t.addStyleClass("sapUshellSearchFacetDialogFacetList");t.bindItems({path:"/facetDialog",factory:(e,t)=>{const a=t.getObject();if(a instanceof q){const e=new f({title:{path:"title"},counter:{path:"filterCount"},visible:{path:"visible"}});return e}else{const e=new f({title:{path:"title"},counter:{path:"count"},visible:{path:"visible"}});return e}}});const s=new u({icon:"sap-icon://clear-filter",tooltip:V.getText("resetFilterButton_tooltip"),type:N.Transparent,enabled:{path:"/facetDialogOverallCounter"},press:e=>{this.resetAllFilters()}});s.addStyleClass("sapUshellSearchFacetDialogFilterResetButton");const n=new r({title:V.getText("filters"),headerContent:s,content:[t]}).addStyleClass("sapUshellSearchFacetDialogMasterContainer");n.addEventDelegate({onAfterRendering:()=>{if(this.getProperty("selectedAttribute")){for(let e=0;e<t.getItems().length;e++){const a=t.getItems()[e];const s=a.getBindingContext().getObject();if(this.getProperty("selectedAttribute")===s.dimension){t.setSelectedItem(a);this.facetOnDisplayIndex=e;this.chartOnDisplayIndexByFilterArray.push(this.chartOnDisplayIndex)}else{let e=0;const t=a.getBindingContext().getModel().getData().facets;for(let a=0;a<t.length;a++){if(t[a].chartIndex&&t[a].dimension===s.dimension&&!isNaN(t[a].chartIndex)){e=t[a].chartIndex}}this.chartOnDisplayIndexByFilterArray.push(e)}}}if(!t.getSelectedItem()){t.setSelectedItem(t.getItems()[0])}const e=t.getSelectedItem();if(e){a.updateDetailPage(e,null,true)}this.resetEnabledForFilterResetButton()}});return[n]},resetAllFilters:function e(){const t=document.querySelector(".sapUshellSearchFacetDialogSettingsContainer");let s=null;if(t){const e=t.querySelectorAll(".sapMCbBg.sapMCbHoverable.sapMCbMark");if(e.length===1){s=e[0]}}if(s&&s.parentNode){const e=s.parentNode.id;const t=M.getElementById(e);t.setSelected(false);t.setEnabled(false)}const n=this.getModel();n.aFilters=[];a.bResetFilterIsActive=true;const i=a.getFacetList();const l=i.getItems();for(let e=0;e<l.length;e++){l[e].setCounter(0)}this.resetAdvancedConditionFilters();a.resetChartQueryFilters();a.updateDetailPage(i.getSelectedItem());this.resetEnabledForFilterResetButton();a.bResetFilterIsActive=false},resetAdvancedConditionFilters:function e(){let t,s,n,i,l,o;const r=this.oSplitContainer.getDetailPages();for(let e=0;e<r.length;e++){const c=r[e];const d=c.getBindingContext().getObject();if(d instanceof q){continue}n=a.POS_ATTRIBUTE_LIST_CONTAINER;t=c.getContent()[n];if(t){for(let e=t.getContent().length-2;e>0;e--){s=t.getContent()[e];l=s.getParent();o=s;l.removeContent(o)}}else{n=a.POS_ICONTABBAR;i=a.POS_TABBAR_CONDITION;t=c.getContent()[n].getItems()[i].getContent()[0];if(t){for(let e=t.getContent().length-1;e>-1;e--){s=t.getContent()[e];if(s.getContent&&s.getContent()[1]){const e=s.getContent()[1].getContent()[1];const t=e.getValue();if(t&&(""+t).length>0){l=s.getParent();o=s;l.removeContent(o)}}}}}}},resetEnabledForFilterResetButton:function e(t){let s=false;let n=0;const i=a.getFacetList();const l=i.getItems();for(let e=0;e<l.length;e++){n+=l[e].getCounter()}const o=this.getModel();if(o.aFilters&&o.aFilters.length>0||t||n>0){s=true}o.setProperty("/facetDialogOverallCounter",s)},onMasterPageSelectionChange:function e(t){const s=t.getParameter("listItem");this.facetOnDisplayIndex=s.getParent().indexOfItem(s.getParent().getSelectedItem());this.setChartOnDisplayIndexForFacetListItem(this.facetOnDisplayIndex);const n=s.getParent().getModel();const i=s.getBindingContext().getPath();this.resetIcons(n,i,this);a.updateDetailPage(s);if(this.oSplitContainer.getMode()==="ShowHideMode"){this.oSplitContainer.hideMaster()}this.controlChartVisibility(this,this.chartOnDisplayIndex)},createDetailPage:function e(t,a){const s=a.getObject();switch(s.facetType){case Q.Attribute:return this.createAttributeDetailPage(t,a);case Q.Hierarchy:return this.createDynamicHierarchyAttributeDetailPage(t,a)}},createDynamicHierarchyAttributeDetailPage:function e(t,a){const s=new G("",{showTitle:false});const n=a.getObject();const i=new r({title:n.title,showHeader:true,content:[s]}).addStyleClass("sapUshellSearchFacetDialogDetailPage").addStyleClass("sapUshellSearchFacetDialogHierarchyTreeDetailPage");return i},createAttributeDetailPage:function e(t,a){const s=a.getModel().getProperty(a.getPath()).facetType;const l=a.getModel()["getAttributeDataType"](a.getModel().getProperty(a.getPath()));const o=new d({items:[new y({text:V.getText("notSorted"),key:"notSorted"}),new y({text:V.getText("sortByCount"),key:"sortCount"}),new y({text:V.getText("sortByName"),key:"sortName"})],selectedKey:l==="string"||l==="text"?"sortCount":"notSorted",change:e=>{this.onSelectChange(e)}}).addStyleClass("sapUshellSearchFacetDialogSettingsSelect");const c=new m({alignItems:k.End,justifyContent:j.End,items:[o]});const C=new h({text:V.getText("showSelectedOnTop"),enabled:false,select:e=>{this.onCheckBoxSelect(e)}});const T=new D({items:[c,C]}).addStyleClass("sapUshellSearchFacetDialogSettingsContainer");T.setVisible(false);const O=new S({backgroundDesign:z.Transparent,includeItemInSelection:true,showNoData:false,showSeparators:R.None,selectionChange:e=>{this.onDetailPageSelectionChange(e)}});O.addStyleClass("sapUshellSearchFacetDialogDetailPageList");O.addStyleClass("largeChart0");if(s===Q.Attribute){O.setMode(_.MultiSelect)}const w={path:"items",factory:(e,t)=>{const a=t.oModel.getProperty(t.sPath);const s=new f({title:{path:"label"},tooltip:V.getText("facetListTooltip",[L.escapeSettingsValue(a.label),L.escapeSettingsValue(a.valueLabel)]),info:{path:"valueLabel"},selected:{path:"selected"}});if(a.selected){t.oModel.addFilter(a)}return s}};if(l==="number"||l==="integer"){o.removeItem(2)}w["filters"]=new I("advanced",b.NE,true);O.bindAggregation("items",w);O.data("dataType",l);if(this.bShowCharts){O.addEventDelegate({onAfterRendering:e=>{this.hideSelectively(e,this,0)}})}let v,E;const A=n.getBarChartPlaceholder();A.addEventDelegate({onAfterRendering:e=>{this.hideSelectively(e,this,1)}});A.data("dataType",l);if(this.bOldPieChart){E=n.getPieChartPlaceholder()}else{E={}}E.addEventDelegate({onAfterRendering:e=>{this.hideSelectively(e,this,2)}});if(this.bShowCharts&&(l==="string"||l==="text")){v=new P({height:"67.2%",horizontal:false,vertical:true,content:[O,A,E]})}else{v=new P({height:"calc(100% - 0.25rem)",horizontal:false,vertical:true,content:[O]});if(l==="number"||l==="integer"){v.addStyleClass("sapUshellSearchFacetDialogDetailPageListContainerNumber")}else{v.addStyleClass("sapUshellSearchFacetDialogDetailPageListContainerDate")}}v.addStyleClass("sapUshellSearchFacetDialogDetailPageListContainer");v.addStyleClass("searchFacetLargeChartContainer");v.setBusyIndicatorDelay(0);const M=new i("",{type:l});let H;if(l==="string"||l==="text"){const e=new P({horizontal:false,vertical:true,content:[M]});e.addStyleClass("sapUshellSearchFacetDialogDetailPageAdvancedContainer");const t=new u({icon:"sap-icon://add",type:N.Transparent,press:e=>{this.onPlusButtonPress(e,l)}});t.addStyleClass("sapUshellSearchFacetDialogDetailPageAdvancedContainerPlusButton");e.addContent(t);e.data("dataType",l);e.data("initial",true);v.setHeight("calc(100% - 0.25rem)");e.setHeight("100%");const s=n.getDropDownButton(this);const i=new F({content:[new g({placeholder:V.getText("filterPlaceholder"),liveChange:e=>{this.onSearchFieldLiveChangeDelayed(e["oSource"].getValue())}}),new p({icon:"sap-icon://sort",press:e=>{this.onSettingButtonPress(e)}}).addStyleClass("sapUshellSearchFacetDialogSortButton")]}).addStyleClass("sapUshellSearchFacetDialogSubheaderToolbar");i.addEventDelegate({onAfterRendering:()=>{document.querySelectorAll(".sapUshellSearchFacetDialogSubheaderToolbar").forEach(e=>{e.classList.remove("sapContrastPlus")})}});if(this.bShowCharts){i.addContent(s)}const o=new r({showHeader:false,subHeader:i,content:[T,v]}).addStyleClass("sapUshellSearchFacetDialogDetailPage");const c=new B({expandable:false,stretchContentHeight:true,backgroundDesign:z.Transparent,applyContentPadding:false,select:()=>{this.controlChartVisibility(this,this.chartOnDisplayIndex)},items:[new x({text:V.getText("selectFromList"),content:[o]}),new x({text:V.getText("defineCondition"),content:[e]})]});c.addStyleClass("sapUshellSearchFacetDialogIconTabBar");H=new r({showHeader:true,title:a.getModel().getProperty(a.getPath()).title,content:[c]});H.addStyleClass("sapUshellSearchFacetDialogDetailPageString")}else{v.addContent(M);v.data("dataType",l);v.data("initial",true);if(this.bShowCharts){const e=a.getModel().getProperty(a.getPath()).title;H=new r({title:e,showHeader:true,content:[T,v]})}else{H=new r({showHeader:true,title:a.getModel().getProperty(a.getPath()).title,content:[T,v]})}H.addStyleClass("sapUshellSearchFacetDialogDetailPage")}H.addEventDelegate({onAfterRendering:()=>{this.controlChartVisibility(this,this.chartOnDisplayIndex)}});return H},onDetailPageSelectionChange:function e(t){const s=t.getParameter("listItems");s.forEach(e=>{const s=e.getBindingContext().getObject();const n=this.getModel();if(e.getSelected()){s.listed=true;n.addFilter(s)}else{s.listed=false;n.removeFilter(s)}const i=t.getSource();let l;if(i.data("dataType")==="string"||i.data("dataType")==="text"){l=i.getParent().getParent().getParent().getParent().getParent().getParent()}else{l=i.getParent().getParent()}a.updateCountInfo(l);const o=i.getParent().getParent().getContent()[a.POS_SETTING_CONTAINER];const r=o.getItems()[a.POS_SHOWONTOP_CHECKBOX];const c=o.getItems()[a.POS_SORTING_SELECT].getItems()[0];if(r.getSelected()){r.setSelected(false);c.setSelectedKey("notSorted")}if(i.getSelectedContexts().length>0){r.setEnabled(true)}else{r.setEnabled(false)}})},onSearchFieldLiveChange:function e(t){const s=a.getFacetList().getSelectedItem();a.updateDetailPage(s,t)},onSettingButtonPress:function e(t){const s=t.getSource();const n=s.getPressed();const i=s.getParent().getParent()["getContent"]()[a.POS_SETTING_CONTAINER];const l=s.getParent().getParent()["getContent"]()[a.POS_ATTRIBUTE_LIST_CONTAINER];if(n){i.setVisible(true);l.setHeight("calc(100% - 4.25rem)")}else{i.setVisible(false);l.setHeight("calc(100% - 0.25rem)")}},onSelectChange:function e(t){const s=t.getSource();a.sortingAttributeList(s.getParent().getParent().getParent())},onCheckBoxSelect:function e(t){const s=t.getSource();a.sortingAttributeList(s.getParent().getParent())},onPlusButtonPress:function e(t,a){const s=t.getSource();const n=s.getParent();const l=new i("",{type:a});const o=n.getContent().length-1;n.insertContent(l,o)},onOkClick:function e(){const t=this.getModel();const s=this.getModel("searchModel");s.resetFilterByFilterConditions(false);const n=this.oSplitContainer.getDetailPages();for(let e=0;e<t.aFilters.length;e++){const a=t.aFilters[e];if(!a.advanced||a.listed){s.addFilterCondition(a.filterCondition,false)}}for(let e=0;e<n.length;e++){const t=n[e];const i=t.getBindingContext().getObject();if(i instanceof q){continue}if(a.getFacetList().getItems()[e]){a.applyAdvancedCondition(t,a.getFacetList().getItems()[e].getBindingContext().getObject(),s)}}if(!this.bConditionValidateError){s.filterChanged=true;s.invalidateQuery();s.fireSearchQuery()}s.eventLogger.logEvent({type:K.FACET_SHOW_MORE_CLOSE,dataSourceKey:s.getDataSource().id})},onCancelClick:function e(){const t=this.getModel("searchModel");t.eventLogger.logEvent({type:K.FACET_SHOW_MORE_CLOSE,dataSourceKey:t.getDataSource().id})},setChartOnDisplayIndexForFacetListItem:function e(t){let a=0;try{a=this.chartOnDisplayIndexByFilterArray[t]}catch(e){H.warning("Error in setChartOnDisplayIndexForFacetListItem: "+e);a=0}if(a===undefined){a=0}this.chartOnDisplayIndex=a},resetIcons:function e(t,a,s){let n=false;const i=t.getAttributeDataType(t.getProperty(a));if(this.bShowCharts&&(i==="string"||i==="text")){n=true}const l=Array.from(document.getElementsByClassName("sapUshellSearchFacetDialogTabBarButton"));if(n){l.forEach(e=>{e.style.display="block"});for(let e=0;e<l.length;e++){const t=l[e].id;const a=M.getElementById(t);const n=s.getProperty("tabBarItems")[s.chartOnDisplayIndex].getIcon();a.setIcon(n);const i=s.getProperty("tabBarItems")[s.chartOnDisplayIndex].getText();a.setTooltip(V.getText("displayAs",[i]))}}else{l.forEach(e=>{e.style.display="none"})}},onDetailPageSelectionChangeCharts:function e(t){let s=0;let n,i,o,r,c,d,h,g,p;let u,f,C;if(t.getSource&&t.getId()==="press"){n=t.getSource().getBindingContext();i=n.getModel();o=n.getObject();r=o.selected;c=!r;d=t.getSource();h=d.getBindingContext().sPath+"/selected";i.setProperty(h,c);g=d.getBindingContext().getObject();if(c){i.addFilter(g)}else{i.removeFilter(g)}p=h.replace(/\/items.+/,"");p+="/items";u=i.getProperty(p);s=0;for(let e=0;e<u.length;e++){f=u[e];if(f.selected===true){s++}}}else{o=t["dataObject"];r=o.selected;c=!r;s=t["cnt"];i=t["model"];g=new l;g.facetAttribute=L.escapeSettingsValue(o.dimension);g.filterCondition=L.escapeSettingsValue(o.filterCondition);g.label=L.escapeSettingsValue(o.label);g.selected=L.escapeSettingsValue(o.selected);g.listed=L.escapeSettingsValue(o.selected);g.value=L.escapeSettingsValue(o.value);g.valueLabel=L.escapeSettingsValue(o.valueLabel);for(let e=0;e<this.aItemsForBarChart.length;e++){const t=this.aItemsForBarChart[e];if(t.label===L.escapeSettingsValue(o.label)){t.selected=o.selected}}const e=this.getModel();if(r){e.addFilter(g)}else{e.removeFilter(g)}}const y=a.getFacetList();C=y.getSelectedItem();if(!C){C=y.getItems()[0]}C.setCounter(s);this.resetEnabledForFilterResetButton()},updateDetailPageCharts:function e(t,a){if(this.bShowCharts===false){return}this.aItemsForBarChart=t;this.aItemsForBarChartFacetTotalCount=a;const s=n.getListContainersForDetailPage();const i=s[1];if(!i){return}const l=i.getContent();if(l&&this.chartOnDisplayIndex===1){const e=l[2].getDomRef();if(e){const t=document.getElementById(e.id);if(t){t.style.display="none"}}}else if(l&&this.chartOnDisplayIndex===2){if(l&&this.chartOnDisplayIndex===2){const e=l[2];const n=s[5];let i=s[2];i=.9*i;const o={relevantContainerHeight:i,oSearchFacetDialog:this};const r=new T;r.setData(t);const c=document.getElementById(n.id);if(c){c.innerHTML=""}e.directUpdate(t,n,r,a,o)}const e=l[1].getDomRef();if(e){const t=document.getElementById(e.id);if(t){t.style.display="none"}}}},controlChartVisibility:function e(t,a,s){let i,l,o;if(this.bShowCharts===false)return;const r=n.getListContainersForDetailPage();const c=r[1];if(!c||!c.getContent)return;const d=c.getContent();for(let e=0;e<d.length;e++){i=d[e].getDomRef();if(!i)return;l=i.className;o=false;if(l.indexOf("largeChart")>-1){o=true}const t=document.getElementById(i.id);if(t){if(o&&e!==a){t.style.display="none"}else{t.style.display="block"}}}if(t.bOldPieChart){if(o&&a===2&&s){const e=this.aItemsForBarChart;const t=this.aItemsForBarChartFacetTotalCount;this.updateDetailPageCharts(e,t)}if(o&&a===2){c.setVertical(false)}else{c.setVertical(true)}}const h=r[6];const g=r[7];if(h){const e=document.getElementById(h.sId);const t=document.getElementById(g.sId);if(a===0){if(e)e.style.display="block";if(t)t.style.visibility="visible"}else{if(e)e.style.display="none";if(t)t.style.visibility="hidden"}}},hideSelectively:function e(t,a,s){const i=document.getElementById(t["srcControl"].sId);const l=a.chartOnDisplayIndex;const o=n.getListContainersForDetailPage();const r=o[1];if(o[0].firstChild.children.length!=3)return;if(l!==undefined){if(a.chartOnDisplayIndex!==s){if(i)i.style.display="none"}else{if(i)i.style.display="block"}}else{if(i)i.style.display="block"}if(l===2){if(!o[0].firstChild.children[2]||!o[0].firstChild.children[2].firstChild){a.controlChartVisibility(a,a.chartOnDisplayIndex,true)}if(a.bOldPieChart){r.setVertical(false)}}else{r.setVertical(true)}const c=o[6];if(c){const e=document.getElementById(c.sId);if(l===0){if(e)e.style.display="block"}else{if(e)e.style.display="none"}}}});return W});
//# sourceMappingURL=SearchFacetDialog.js.map