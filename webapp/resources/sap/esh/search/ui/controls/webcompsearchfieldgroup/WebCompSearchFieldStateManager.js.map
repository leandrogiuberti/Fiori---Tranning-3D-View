{"version":3,"file":"WebCompSearchFieldStateManager.js","names":["sap","ui","define","____SearchUtil","SearchHelper","StateWatcher","WebCompSearchFieldStateManager","stateWatcher","shellHeader","model","searchFieldGroup","constructor","props","this","checkInterval","config","searchFieldCheckInterval","getState","isNoResultsScreen","isSearchInputFocused","compareStates","s1","s2","changed","handleStateChanged","bind","interval","start","newState","shallShowOverlay","isOverlayShown","setSearchState","expandSearch","collapseSearch","isSearchAppActive","getProperty","document","querySelector","activeElement","getDomRef"],"sources":["WebCompSearchFieldStateManager.ts"],"sourcesContent":["/*!\n * SAPUI5\n * Copyright (c) 2025 SAP SE or an SAP affiliate company. All rights reserved.\n * \n */\nimport type SearchModel from \"sap/esh/search/ui/SearchModel\";\nimport Control from \"sap/ui/core/Control\";\nimport { StateWatcher } from \"../../SearchUtil\";\nimport * as SearchHelper from \"sap/esh/search/ui/SearchHelper\";\nimport type SearchFieldGroup from \"../searchfieldgroup/SearchFieldGroup\";\n\ninterface State {\n    isSearchInputFocused: boolean;\n    isNoResultsScreen: boolean;\n}\n\nexport default class WebCompSearchFieldStateManager {\n    stateWatcher: StateWatcher<State>;\n    shellHeader: any;\n    model: SearchModel;\n    searchFieldGroup: SearchFieldGroup;\n    constructor(props: { shellHeader: Control; model: SearchModel; searchFieldGroup: SearchFieldGroup }) {\n        this.shellHeader = props.shellHeader;\n        this.model = props.model;\n        this.searchFieldGroup = props.searchFieldGroup;\n        const checkInterval = this?.model?.config?.searchFieldCheckInterval ?? 100;\n        this.stateWatcher = new StateWatcher<State>({\n            getState: () => ({\n                isNoResultsScreen: this.isNoResultsScreen(),\n                isSearchInputFocused: this.isSearchInputFocused(),\n            }),\n            compareStates: (s1: State, s2: State) =>\n                s1.isNoResultsScreen === s2.isNoResultsScreen &&\n                s1.isSearchInputFocused === s2.isSearchInputFocused,\n            changed: this.handleStateChanged.bind(this),\n            interval: checkInterval,\n        });\n        if (checkInterval > 0) {\n            this.stateWatcher.start();\n        }\n    }\n\n    handleStateChanged(newState: State): void {\n        // console.log(\"schange\" + newState.isSearchInputFocused);\n        const shallShowOverlay = newState.isSearchInputFocused && !newState.isNoResultsScreen;\n        if (shallShowOverlay && !this.isOverlayShown()) {\n            this.shellHeader.setSearchState(\"EXP_S\", 35, false); // intermediate state to force shell to show overlay\n            this.shellHeader.setSearchState(\"EXP\", 35, true);\n        }\n        if (!shallShowOverlay && this.isOverlayShown) {\n            this.shellHeader.setSearchState(\"EXP_S\", 35, false); // intermediate state to force shell to disable overlay\n            this.shellHeader.setSearchState(\"EXP\", 35, false);\n        }\n    }\n\n    expandSearch(): void {\n        this.shellHeader.setSearchState(\"EXP\", 35, false);\n    }\n\n    collapseSearch(): void {\n        this.shellHeader.setSearchState(\"COL\", 35, false);\n    }\n\n    isNoResultsScreen(): boolean {\n        return (\n            SearchHelper.isSearchAppActive() &&\n            this.model.getProperty(\"/boCount\") === 0 &&\n            this.model.getProperty(\"/appCount\") === 0\n        );\n    }\n\n    isSearchInputFocused(): boolean {\n        if (!document.querySelector(\"#searchFieldInShell:not([collapsed])\")) {\n            return false;\n        }\n        return document.activeElement === (this.searchFieldGroup as Control).getDomRef();\n    }\n\n    isOverlayShown(): boolean {\n        return !!document.querySelector(\".sapUshellShellShowSearchOverlay\");\n    }\n}\n"],"mappings":";;;;;AAAAA,IAAAC,GAAAC,OAAA,+DAAAC,EAAAC,GAAA,mBAOSC,EAAYF,EAAA,gBASN,MAAMG,EACjBC,aACAC,YACAC,MACAC,iBACAC,YAAYC,GACRC,KAAKL,YAAcI,EAAMJ,YACzBK,KAAKJ,MAAQG,EAAMH,MACnBI,KAAKH,iBAAmBE,EAAMF,iBAC9B,MAAMI,EAAgBD,MAAMJ,OAAOM,QAAQC,0BAA4B,IACvEH,KAAKN,aAAe,IAAIF,EAAoB,CACxCY,SAAUA,KAAA,CACNC,kBAAmBL,KAAKK,oBACxBC,qBAAsBN,KAAKM,yBAE/BC,cAAeA,CAACC,EAAWC,IACvBD,EAAGH,oBAAsBI,EAAGJ,mBAC5BG,EAAGF,uBAAyBG,EAAGH,qBACnCI,QAASV,KAAKW,mBAAmBC,KAAKZ,MACtCa,SAAUZ,IAEd,GAAIA,EAAgB,EAAG,CACnBD,KAAKN,aAAaoB,OACtB,CACJ,CAEAH,mBAAmBI,GAEf,MAAMC,EAAmBD,EAAST,uBAAyBS,EAASV,kBACpE,GAAIW,IAAqBhB,KAAKiB,iBAAkB,CAC5CjB,KAAKL,YAAYuB,eAAe,QAAS,GAAI,OAC7ClB,KAAKL,YAAYuB,eAAe,MAAO,GAAI,KAC/C,CACA,IAAKF,GAAoBhB,KAAKiB,eAAgB,CAC1CjB,KAAKL,YAAYuB,eAAe,QAAS,GAAI,OAC7ClB,KAAKL,YAAYuB,eAAe,MAAO,GAAI,MAC/C,CACJ,CAEAC,eACInB,KAAKL,YAAYuB,eAAe,MAAO,GAAI,MAC/C,CAEAE,iBACIpB,KAAKL,YAAYuB,eAAe,MAAO,GAAI,MAC/C,CAEAb,oBACI,OACId,EAAa8B,qBACbrB,KAAKJ,MAAM0B,YAAY,cAAgB,GACvCtB,KAAKJ,MAAM0B,YAAY,eAAiB,CAEhD,CAEAhB,uBACI,IAAKiB,SAASC,cAAc,wCAAyC,CACjE,OAAO,KACX,CACA,OAAOD,SAASE,gBAAmBzB,KAAKH,iBAA6B6B,WACzE,CAEAT,iBACI,QAASM,SAASC,cAAc,mCACpC,EACH,OAAA/B,CAAA","ignoreList":[]}