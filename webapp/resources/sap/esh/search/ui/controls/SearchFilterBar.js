/*!
 * SAPUI5
 * Copyright (c) 2025 SAP SE or an SAP affiliate company. All rights reserved.
 * 
 */
sap.ui.define(["../i18n","sap/m/Text","sap/m/Toolbar","sap/m/ToolbarSpacer","sap/m/library","sap/ui/core/Icon","../sinaNexTS/sina/ComplexCondition","../sinaNexTS/sina/ComparisonOperator","../eventlogging/UserEvents","../sinaNexTS/sina/HierarchyDisplayType","../error/errors","./facets/FacetTypeUI","../sinaNexTS/sina/SimpleCondition"],function(t,e,r,i,n,o,s,a,l,c,u,f,h){"use strict";function d(t){return t&&t.__esModule&&typeof t.default!=="undefined"?t.default:t}const p=d(t);const b=n["ToolbarDesign"];const m=s["ComplexCondition"];const F=a["ComparisonOperator"];const y=l["UserEventType"];const g=c["HierarchyDisplayType"];const T=d(u);const C=f["FacetTypeUI"];const x=h["SimpleCondition"];const L=r.extend("sap.esh.search.ui.controls.SearchFilterBar",{renderer:{apiVersion:2},constructor:function t(n,s){r.prototype.constructor.call(this,n,s);this.setProperty("design",b.Info);this.addStyleClass("sapUshellSearchFilterContextualBar");this.filterFormatter=this.filterFormatter.bind(this);this.filterText=new e(this.getId()+"-resetFilterText",{text:{parts:[{path:"/uiFilter/rootCondition"},{path:"/facets"}],formatter:this.filterFormatter},tooltip:{parts:[{path:"/uiFilter/rootCondition"},{path:"/facets"}],formatter:this.filterFormatter}}).addStyleClass("sapUshellSearchFilterText");this.filterText.setMaxLines(1);this.addContent(this.filterText);this.addContent(new i);this.resetButton=new o(this.getId()+"-resetFilterButton",{src:"sap-icon://clear-filter",tooltip:p.getText("resetFilterButton_tooltip")}).addStyleClass("sapUshellSearchFilterResetButton");this.addContent(this.resetButton)},filterFormatter:function t(e,r){if(!e||!e.hasFilters()){return""}const i=this.getModel();if(i.config.formatFilterBarText){try{return i.config.formatFilterBarText(this._assembleFilterLabels(e,r))}catch(t){const n=new T.ConfigurationExitError("formatFilterBarText",i.config.applicationComponent,t);const o=i.getSearchCompositeControlInstanceByChildControl(this);o?.errorHandler.onError(n);return this._formatFilterText(e,r)}}else{return this._formatFilterText(e,r)}},_assembleFilterLabels:function t(e,r){const i=[];e=this.sortConditions(e,r);for(let t=0;t<e.conditions.length;++t){const r=e.conditions[t];const n=this.getModel();const o=r.getFirstAttribute();const s=n.getProperty("/uiFilter")?.dataSource.attributeMetadataMap[o];if(s&&s.isHierarchy===true&&s.hierarchyDisplayType===g.StaticHierarchyFacet){continue}const a={attributeName:s?.id||o,attributeLabel:"",attributeFilterValueLabels:[]};i.push(a);for(let t=0;t<r.conditions.length;++t){const e=r.conditions[t];if(t===0){a.attributeLabel=e.attributeLabel}let i;if(e instanceof x){i=this._formatLabel(e.valueLabel,e.operator)}else if(e instanceof m){i=this._formatLabel(e.valueLabel)}a.attributeFilterValueLabels.push(i)}}return i},_formatFilterText:function t(e,r){const i=this._assembleFilterLabels(e,r);const n=i.map(t=>t.attributeLabel+" ("+t.attributeFilterValueLabels.join(", ")+")");return p.getText("filtered_by",[n.join(", ")])},_formatLabel:function t(e,r){let i;switch(r){case F.Bw:i=e+"*";break;case F.Ew:i="*"+e;break;case F.Co:i="*"+e+"*";break;default:i=e;break}return i},sortConditions:function t(e,r){if(r.length===0){return e}const i=function(t){const e=t.conditions[0];if(e.attribute){return e.attribute}return e.conditions[0].attribute};const n=function(t,e,r){for(let i=0;i<t.length;++i){const n=t[i];if(n[e]===r){return i}}};e=e.clone();e.conditions.sort(function(t,e){const o=i(t);const s=n(r,"dimension",o);const a=i(e);const l=n(r,"dimension",a);return s-l});const o=function(t){const e=i(t);const o=n(r,"dimension",e);if(!o){return}const s=r[o];if(s.facetType===C.Hierarchy){return}const a=function(t,e){return n(s.items,"label",t.valueLabel)-n(s.items,"label",e.valueLabel)};t.conditions.sort(a)};for(let t=0;t<e.conditions.length;++t){const r=e.conditions[t];o(r)}return e},onAfterRendering:function t(e){r.prototype.onAfterRendering.call(this,e);this.resetButton.attachPress(()=>{const t=this.getModel();t.eventLogger.logEvent({type:y.CLEAR_ALL_FILTERS,dataSourceKey:t.getDataSource().id});t.resetFilterByFilterConditions(true)});const i=document.querySelector(".sapUshellSearchFilterText");if(i){i.setAttribute("aria-label",p.getText("filtered_by_aria_label"))}}});return L});
//# sourceMappingURL=SearchFilterBar.js.map