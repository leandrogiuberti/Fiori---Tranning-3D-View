/*!
 * SAPUI5
 * Copyright (c) 2025 SAP SE or an SAP affiliate company. All rights reserved.
 * 
 */
sap.ui.define(["../../SearchShellHelperHorizonTheme","sap/ui/core/Element","../../SearchUtil","sap/esh/search/ui/SearchHelper"],function(e,t,s,i){"use strict";function r(e){return e&&e.__esModule&&typeof e.default!=="undefined"?e.default:e}const a=r(e);const c=s["PeriodicRetry"];const h=s["StateWatcher"];class l{stateWatcher;shellHeader;model;searchFieldGroup;periodicRetryFocus;periodicRetryFocusOptions;constructor(e){this.shellHeader=e.shellHeader;this.model=e.model;this.searchFieldGroup=e.searchFieldGroup;const t=this?.model?.config?.searchFieldCheckInterval??100;this.initPeriodicRetryFocus();this.stateWatcher=new h({getState:()=>({isNoResultsScreen:this.isNoResultsScreen(),isSearchInputFocused:this.isSearchInputFocused(),isSearchFieldExpandedByDefault:a.isSearchFieldExpandedByDefault()}),compareStates:(e,t)=>e.isNoResultsScreen===t.isNoResultsScreen&&e.isSearchFieldExpandedByDefault===t.isSearchFieldExpandedByDefault&&e.isSearchInputFocused===t.isSearchInputFocused,changed:this.handleStateChanged.bind(this),interval:t});if(t>0){this.stateWatcher.start()}}handleStateChanged(e,t){if(this.model){this.model.calculateSearchButtonStatus()}const s=e.isSearchInputFocused&&!e.isNoResultsScreen;switch(this.shellHeader.getSearchState()){case"EXP":case"EXP_S":if(!e.isSearchFieldExpandedByDefault&&t&&t.isSearchFieldExpandedByDefault&&this.getSearchBoxValue()===""){this.collapseSearch();return}if(s&&!this.isOverlayShown()){this.shellHeader.setSearchState("EXP_S",35,false);this.shellHeader.setSearchState("EXP",35,true)}if(!s&&this.isOverlayShown){this.shellHeader.setSearchState("EXP_S",35,false);this.shellHeader.setSearchState("EXP",35,false)}break;case"COL":if(e.isSearchFieldExpandedByDefault){this.expandSearch()}break}}getShellSearchButton(){return t.getElementById("sf")}expandSearch(e){const t=this.getShellSearchButton();if(!t){return}this.shellHeader.setSearchState("EXP",35,false);if(this.searchFieldGroup.cancelButton){this.searchFieldGroup.cancelButton.setVisible(true)}t.setVisible(false);if(e){this.focusSearchInput({selectContent:false})}}collapseSearch(){const e=this.getShellSearchButton();if(!e){return}this.model.abortSuggestions();this.shellHeader.setSearchState("COL",35,false);if(this.searchFieldGroup.cancelButton){this.searchFieldGroup.cancelButton.setVisible(false)}e.setVisible(true)}getSearchBoxValue(){return this.searchFieldGroup.input.getValue()}isSearchInputFocused(){if(!this.searchFieldGroup||!this.searchFieldGroup.input||!this.searchFieldGroup.input.getDomRef()){return false}return this.searchFieldGroup.input.getDomRef().contains(document.activeElement)}isOverlayShown(){return!!document.querySelector(".sapUshellShellShowSearchOverlay")}initPeriodicRetryFocus(){const e=()=>{if(!this?.searchFieldGroup?.input){return false}const e=this.searchFieldGroup.input.getDomRef();if(e&&jQuery(e).is(":visible")){if(this.searchFieldGroup.input.getEnabled()){this.searchFieldGroup.input.focus();if(this.periodicRetryFocusOptions.selectContent){this.searchFieldGroup.input.selectText(0,9999)}return true}}return false};this.periodicRetryFocus=new c({interval:100,maxRetries:10,action:e})}focusSearchInput(e={}){this.periodicRetryFocusOptions=e;this.periodicRetryFocus.run()}isNoResultsScreen(){return i.isSearchAppActive()&&this.model.getProperty("/boCount")===0&&this.model.getProperty("/appCount")===0}}return l});
//# sourceMappingURL=SearchFieldStateManager.js.map