{"version":3,"file":"SearchFieldStateManager-dbg.js","names":["sap","ui","define","__SearchShellHelperHorizonTheme","Element","____SearchUtil","SearchHelper","_interopRequireDefault","obj","__esModule","default","SearchShellHelperHorizonTheme","PeriodicRetry","StateWatcher","SearchFieldStateManager","stateWatcher","shellHeader","model","searchFieldGroup","periodicRetryFocus","periodicRetryFocusOptions","constructor","props","checkInterval","config","searchFieldCheckInterval","initPeriodicRetryFocus","getState","isNoResultsScreen","isSearchInputFocused","isSearchFieldExpandedByDefault","compareStates","s1","s2","changed","handleStateChanged","bind","interval","start","newState","oldState","calculateSearchButtonStatus","shallShowOverlay","getSearchState","getSearchBoxValue","collapseSearch","isOverlayShown","setSearchState","expandSearch","getShellSearchButton","getElementById","focusSearchField","shellSearchButton","cancelButton","setVisible","focusSearchInput","selectContent","abortSuggestions","input","getValue","getDomRef","contains","document","activeElement","querySelector","focus","domRef","jQuery","is","getEnabled","selectText","maxRetries","action","options","run","isSearchAppActive","getProperty"],"sources":["SearchFieldStateManager.ts"],"sourcesContent":["/*!\n * SAPUI5\n * Copyright (c) 2025 SAP SE or an SAP affiliate company. All rights reserved.\n * \n */\nimport SearchModel from \"sap/esh/search/ui/SearchModel\";\nimport Button from \"sap/m/Button\";\nimport Control from \"sap/ui/core/Control\";\nimport SearchShellHelperHorizonTheme from \"../../SearchShellHelperHorizonTheme\";\nimport Element from \"sap/ui/core/Element\";\nimport { PeriodicRetry, StateWatcher } from \"../../SearchUtil\";\nimport type SearchFieldGroup from \"./SearchFieldGroup\";\nimport * as SearchHelper from \"sap/esh/search/ui/SearchHelper\";\n\ninterface State {\n    isSearchInputFocused: boolean;\n    isNoResultsScreen: boolean;\n    isSearchFieldExpandedByDefault: boolean;\n}\n\nexport default class SearchFieldStateManager {\n    stateWatcher: StateWatcher<State>;\n    shellHeader: any;\n    model: SearchModel;\n    searchFieldGroup: SearchFieldGroup;\n    periodicRetryFocus: PeriodicRetry;\n    periodicRetryFocusOptions: { selectContent?: boolean };\n    constructor(props: { shellHeader: Control; model: SearchModel; searchFieldGroup: SearchFieldGroup }) {\n        this.shellHeader = props.shellHeader;\n        this.model = props.model;\n        this.searchFieldGroup = props.searchFieldGroup;\n        const checkInterval = this?.model?.config?.searchFieldCheckInterval ?? 100;\n        this.initPeriodicRetryFocus();\n        this.stateWatcher = new StateWatcher<State>({\n            getState: () => ({\n                isNoResultsScreen: this.isNoResultsScreen(),\n                isSearchInputFocused: this.isSearchInputFocused(),\n                isSearchFieldExpandedByDefault:\n                    SearchShellHelperHorizonTheme.isSearchFieldExpandedByDefault(),\n            }),\n            compareStates: (s1: State, s2: State) =>\n                s1.isNoResultsScreen === s2.isNoResultsScreen &&\n                s1.isSearchFieldExpandedByDefault === s2.isSearchFieldExpandedByDefault &&\n                s1.isSearchInputFocused === s2.isSearchInputFocused,\n            changed: this.handleStateChanged.bind(this),\n            interval: checkInterval,\n        });\n        if (checkInterval > 0) {\n            this.stateWatcher.start();\n        }\n    }\n\n    handleStateChanged(newState: State, oldState: State): void {\n        // console.log(\"schange\");\n        if (this.model) {\n            this.model.calculateSearchButtonStatus();\n        }\n\n        const shallShowOverlay = newState.isSearchInputFocused && !newState.isNoResultsScreen;\n\n        switch (this.shellHeader.getSearchState()) {\n            case \"EXP\":\n            case \"EXP_S\":\n                if (\n                    !newState.isSearchFieldExpandedByDefault &&\n                    oldState &&\n                    oldState.isSearchFieldExpandedByDefault &&\n                    this.getSearchBoxValue() === \"\"\n                ) {\n                    this.collapseSearch();\n                    return;\n                }\n                if (shallShowOverlay && !this.isOverlayShown()) {\n                    this.shellHeader.setSearchState(\"EXP_S\", 35, false); // intermediate state to force shell to show overlay\n                    this.shellHeader.setSearchState(\"EXP\", 35, true);\n                }\n                if (!shallShowOverlay && this.isOverlayShown) {\n                    this.shellHeader.setSearchState(\"EXP_S\", 35, false); // intermediate state to force shell to disable overlay\n                    this.shellHeader.setSearchState(\"EXP\", 35, false);\n                }\n                break;\n            case \"COL\":\n                if (newState.isSearchFieldExpandedByDefault) {\n                    this.expandSearch();\n                }\n                break;\n        }\n    }\n\n    getShellSearchButton(): Button {\n        return Element.getElementById(\"sf\") as any as Button;\n    }\n\n    expandSearch(focusSearchField?: boolean): void {\n        const shellSearchButton = this.getShellSearchButton();\n        if (!shellSearchButton) {\n            return;\n        }\n        this.shellHeader.setSearchState(\"EXP\", 35, false);\n        if (this.searchFieldGroup.cancelButton) {\n            this.searchFieldGroup.cancelButton.setVisible(true);\n        }\n        shellSearchButton.setVisible(false);\n        if (focusSearchField) {\n            this.focusSearchInput({\n                selectContent: false,\n            });\n        }\n    }\n\n    collapseSearch(): void {\n        const shellSearchButton = this.getShellSearchButton();\n        if (!shellSearchButton) {\n            return;\n        }\n        this.model.abortSuggestions();\n        this.shellHeader.setSearchState(\"COL\", 35, false);\n        if (this.searchFieldGroup.cancelButton) {\n            this.searchFieldGroup.cancelButton.setVisible(false);\n        }\n        shellSearchButton.setVisible(true);\n    }\n\n    getSearchBoxValue(): string {\n        return this.searchFieldGroup.input.getValue();\n    }\n\n    isSearchInputFocused(): boolean {\n        if (\n            !this.searchFieldGroup ||\n            !this.searchFieldGroup.input ||\n            !this.searchFieldGroup.input.getDomRef()\n        ) {\n            return false;\n        }\n        return this.searchFieldGroup.input.getDomRef().contains(document.activeElement);\n    }\n\n    isOverlayShown(): boolean {\n        return !!document.querySelector(\".sapUshellShellShowSearchOverlay\");\n    }\n\n    initPeriodicRetryFocus(): void {\n        const focus = () => {\n            if (!this?.searchFieldGroup?.input) {\n                return false;\n            }\n            const domRef = this.searchFieldGroup.input.getDomRef();\n            if (domRef && jQuery(domRef).is(\":visible\")) {\n                if (this.searchFieldGroup.input.getEnabled()) {\n                    this.searchFieldGroup.input.focus();\n                    if (this.periodicRetryFocusOptions.selectContent) {\n                        this.searchFieldGroup.input.selectText(0, 9999);\n                    }\n                    return true;\n                }\n            }\n            return false;\n        };\n        this.periodicRetryFocus = new PeriodicRetry({\n            interval: 100,\n            maxRetries: 10,\n            action: focus,\n        });\n    }\n\n    focusSearchInput(options: { selectContent?: boolean } = {}): void {\n        this.periodicRetryFocusOptions = options;\n        this.periodicRetryFocus.run();\n    }\n\n    isNoResultsScreen(): boolean {\n        return (\n            SearchHelper.isSearchAppActive() &&\n            this.model.getProperty(\"/boCount\") === 0 &&\n            this.model.getProperty(\"/appCount\") === 0\n        );\n    }\n}\n"],"mappings":"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","ignoreList":[]}