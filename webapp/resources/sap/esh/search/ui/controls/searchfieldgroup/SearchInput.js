/*!
 * SAPUI5
 * Copyright (c) 2025 SAP SE or an SAP affiliate company. All rights reserved.
 * 
 */
sap.ui.define(["../../i18n","sap/m/Input","sap/m/Label","sap/m/Text","sap/m/library","sap/m/Column","sap/m/ColumnListItem","sap/m/CustomListItem","sap/m/FlexItemData","sap/m/BusyIndicator","sap/m/FlexBox","sap/ui/core/Icon","sap/ui/layout/HorizontalLayout","sap/ui/layout/VerticalLayout","sap/ui/model/BindingMode","../../SearchHelper","../../suggestions/SuggestionType","../../SearchShellHelperHorizonTheme","../../eventlogging/UserEvents","../../UIEvents","sap/ui/Device","./SearchObjectSuggestionImage","sap/ui/core/Element","sap/ui/core/EventBus","sap/base/Log","sap/m/Link"],function(e,t,s,i,a,n,o,r,c,l,g,u,h,d,p,S,f,y,m,b,T,I,v,C,w,A){"use strict";function L(e){return e&&e.__esModule&&typeof e.default!=="undefined"?e.default:e}const x=L(e);const R=a["FlexAlignItems"];const U=a["FlexDirection"];const F=a["FlexJustifyContent"];const O=a["ListType"];const D=L(f);const M=f["Type"];const H=f["isSearchSuggestion"];const E=L(y);const N=m["UserEventType"];const j=L(b);const B=L(I);const V=t.extend("sap.esh.search.ui.controls.SearchInput",{renderer:{apiVersion:2},constructor:function e(s,i){this.logger=w.getLogger("sap.esh.search.ui.SearchInput");this.triggerSuggestionItemSelected=false;const a=T.system.phone;try{T.system.phone=false;t.prototype.constructor.call(this,s,i)}finally{T.system.phone=a}this.decorateHandleListNavigation();this.setStartSuggestion(0);this.setWidth("100%");this.setShowValueStateMessage(false);this.setShowTableSuggestionValueHelp(false);this.setEnableSuggestionsHighlighting(false);this.setShowSuggestion(true);this.setFilterSuggests(false);this.addSuggestionColumn(new n(""));this.attachSuggestionItemSelected(this.handleSuggestionItemSelected.bind(this));this.setAutocomplete(false);this.setTooltip(x.getText("search"));this.bindProperty("placeholder",{path:"/searchTermPlaceholder",mode:p.OneWay});this.attachLiveChange(this.handleLiveChange.bind(this));this.setValueLiveUpdate(true);this.bindProperty("enabled",{parts:[{path:"/initializingObjSearch"}],formatter:e=>!e});this.bindAggregation("suggestionRows",{path:"/suggestions",factory:(e,t)=>this.suggestionItemFactory(e,t)});this.bindProperty("value",{path:"/uiFilter/searchTerm"});this.addStyleClass("searchInput");this._bUseDialog=false;this._bFullScreen=false;this.listNavigationMode=false},isMobileDevice:function e(){return false},onfocusin:function e(s){t.prototype.onfocusin.call(this,s);const i=s.relatedTarget;if(i?.classList?.contains("searchSuggestionColumnListItem")||this["_oSuggPopover"].isOpen()){return}const a=this.getModel();if(a.getSearchBoxTerm().length===0&&(a.config.bRecentSearches||a.config.aiSuggestions)){a.doSuggestion()}},onsapenter:function e(...s){const i=this["_oSuggestionPopup"]?.isOpen()&&this["_oSuggPopover"].getFocusedListItem();if(!i){this.getModel().invalidateQuery();this.triggerSearch();t.prototype.onsapenter.apply(this,s)}else{this.triggerSuggestionItemSelected=true;t.prototype.onsapenter.apply(this,s);this.triggerSuggestionItemSelected=false}},updateSelectionFromList:function e(s){if(this.triggerSuggestionItemSelected){t.prototype.updateSelectionFromList.apply(this,[s])}else{this["setSelectionUpdatedFromList"](false)}},triggerSearch:function e(){const t=this.getModel().getProperty("/messagePopoverControlId");const s=v.getElementById(t);if(this.getModel().getProperty("/errors").length>0&&s?.isOpen()){s.close();s.setVisible(false)}S.subscribeOnlyOnce("triggerSearch",j.ESHSearchFinished,function(){this.getModel().autoStartApp()},this);const i=this.getModel();if(this.getValue().trim()===""&&i.config.isUshell){this.setValue("*")}if(this.isNavigationAllowed()){this.navigateToSearchApp()}this.destroySuggestionRows();i.abortSuggestions()},isNavigationAllowed:function e(){const t=this.getModel();const s=this.getValue();for(const e of t.searchTermHandlers){const t=e.handleSearchTerm(s);if(t===true){this.focus();return false}}return true},decorateHandleListNavigation:function e(){const t=this["_oSuggPopover"];if(t&&t.handleListNavigation&&!t.handleListNavigation.decorated){const e=t.handleListNavigation;t.handleListNavigation=(...s)=>{this.listNavigationMode=true;e.apply(t,s);this.listNavigationMode=false};t.handleListNavigation.decorated=true}},handleLiveChange:function e(){const t=this.getModel();if(t.getSearchBoxTerm().length>0||t.config.bRecentSearches){t.doSuggestion()}else{this.destroySuggestionRows();t.abortSuggestions();const e=this.getDomRef();if(e){const t=e.querySelector("input");if(t){t.setAttribute("aria-expanded","false")}}}},handleSuggestionItemSelected:function e(t){const s=this.getModel();const i=s.getSearchBoxTerm();const a=t.getParameter("selectedRow").getBindingContext().getObject();const n=a.searchTerm||"";const o=a.dataSource||s.getDataSource();let r=a.url;const c=a.uiSuggestionType;if(c===D.Header||c===D.BusyIndicator){this.destroySuggestionRows();this.setValue("");return}s.eventLogger.logEvent({type:N.SUGGESTION_SELECT,suggestionTitle:a.title,suggestionType:c,suggestionTerm:n,searchTerm:i,targetUrl:r,dataSourceKey:o?o.id:""});if(s.config.bRecentSearches&&s.recentlyUsedStorage&&c===D.Object){s.recentlyUsedStorage.addItem(a)}this.selectText(0,0);switch(c){case D.Search:{if(H(a)){a.titleNavigation.performNavigation()}break}case D.Transaction:case D.App:this.destroySuggestionRows();s.abortSuggestions();if(r[0]==="#"){if(r.indexOf("#Action-search")===0&&(r===S.getHashFromUrl()||r===decodeURIComponent(S.getHashFromUrl()))){s.setSearchBoxTerm(s.query.filter.searchTerm,false);s.setDataSource(s.query.filter.dataSource,false);s.notifySubscribers(j.ESHSearchFinished);C.getInstance().publish(j.ESHSearchFinished);return}if(window["hasher"]){if(r[1]===window.hasher.prependHash){r=r.slice(0,1)+r.slice(2)}window["hasher"].setHash(r)}else{window.location.href=r}}else{this.logRecentActivity(a);window.open(r,"_blank","noopener,noreferrer");s.setSearchBoxTerm("",false)}if(s.config.isUshell&&r.indexOf("#Action-search")!==0){if(!E.isSearchFieldExpandedByDefault()){sap.ui.require("sap/esh/search/ui/SearchShellHelper").collapseSearch()}}else{this.focus()}break;case D.DataSource:s.setDataSource(o,false);s.setSearchBoxTerm("",false);this.focus();break;case D.SearchTermData:case D.SearchTermAI:s.setDataSource(o,false);s.setSearchBoxTerm(n,false);s.invalidateQuery();this.navigateToSearchApp();break;case D.SearchTermHistory:s.setDataSource(o,false);s.setSearchBoxTerm(n,false);s.invalidateQuery();this.navigateToSearchApp();break;case D.Object:{const e=a;if(e.titleNavigation){e.titleNavigation.performNavigation()}break}default:break}},logRecentActivity:function e(t){sap.ui.require(["sap/ushell/Config","sap/ushell/services/AppType"],function(e,s){const i=e.last("/core/shell/enableRecentActivity")&&e.last("/core/shell/enableRecentActivityLogging");if(i){const e={title:t.title,appType:s.URL,url:t.url,appId:t.url};window.sap.ushell.Container.getRenderer("fiori2").logRecentActivity(e)}})},suggestionItemFactory:function e(t,s){const i=this.getDomRef();if(i){const e=i.querySelector("input");if(e){e.setAttribute("aria-expanded","true")}}const a=s.getObject();switch(a.uiSuggestionType){case D.Object:return this.objectSuggestionItemFactory(t,s);case D.Header:return this.headerSuggestionItemFactory(t,s);case D.BusyIndicator:return this.busyIndicatorSuggestionItemFactory();default:return this.regularSuggestionItemFactory(t,s)}},busyIndicatorSuggestionItemFactory:function e(){const t=new d("",{content:[new l("",{size:"0.6rem"})]});t["getText"]=()=>this.getValue();const s=new o("",{cells:[t],type:O.Inactive});s.addStyleClass("searchSuggestion");s.addStyleClass("searchBusyIndicatorSuggestion");s.getVisible=this.assembleListNavigationModeGetVisibleFunction();return s},headerSuggestionItemFactory:function e(t,i){const a=i.getObject();const n=[];const r=[];if(a.uiSuggestionTypeOfSuggestionsInSection===M.SearchTermAI){const e=new u({src:"sap-icon://ai"});e.addStyleClass("sapUiTinyMarginEnd");r.push(e)}const c=new s("",{text:{path:"label"}});r.push(c);const l=new g("",{direction:U.Row,justifyContent:F.Start,items:r});n.push(l);if(a.helpLink){const e=new A({text:x.getText("searchTermAILernMoreLink"),target:"_blank",href:a.helpLink});n.push(e)}const h=new g("",{direction:U.Row,justifyContent:F.SpaceBetween,items:n});h["getText"]=()=>a.label;const d=new o("",{cells:[h],type:O.Inactive});d.addStyleClass("searchSuggestion");d.addStyleClass("searchHeaderSuggestion");d.getVisible=this.assembleListNavigationModeGetVisibleFunction();return d},assembleListNavigationModeGetVisibleFunction:function e(){return()=>{if(!this.listNavigationMode){return true}return false}},assembleObjectSuggestionLabels:function e(t){const i=[];const a=new s("",{text:{path:"label1"}});a.addEventDelegate({onAfterRendering:()=>{S.boldTagUnescaper(a.getDomRef())}},a);a.addStyleClass("sapUshellSearchObjectSuggestion-Label1");i.push(a);if(t.label2){const e=new s("",{text:{path:"label2"}});e.addEventDelegate({onAfterRendering:()=>{S.boldTagUnescaper(e.getDomRef())}},e);e.addStyleClass("sapUshellSearchObjectSuggestion-Label2");i.push(e)}const n=new d("",{content:i});n.addStyleClass("sapUshellSearchObjectSuggestion-Labels");return n},objectSuggestionItemFactory:function e(t,s){const i=s.getObject();const a=[];if(i.imageExists&&i.imageUrl){if(i.imageUrl.startsWith("sap-icon://")){a.push(new u("",{src:i.imageUrl}).addStyleClass("sapUshellSearchObjectSuggestIcon"))}else{a.push(new B("",{src:{path:"imageUrl"},isCircular:{path:"imageIsCircular"}}))}}const n=this.assembleObjectSuggestionLabels(i);a.push(n);const r=new h("",{content:a});r.addStyleClass("sapUshellSearchObjectSuggestion-Container");r["getText"]=()=>this.getValue();const c=new o("",{cells:[r],type:O.Active});c.addStyleClass("searchSuggestion");c.addStyleClass("searchObjectSuggestion");return c},regularSuggestionItemFactory:function e(t,s){const a=new u("",{src:{path:"icon"}}).addStyleClass("suggestIcon").addStyleClass("sapUshellSearchSuggestAppIcon").addStyleClass("suggestListItemCell");const n=new u("",{src:{path:"filterIcon"}}).addStyleClass("suggestIcon").addStyleClass("sapUshellSearchSuggestFilterIcon").addStyleClass("suggestListItemCell");const l=new c("",{shrinkFactor:1,minWidth:"4rem"});const h=new i("",{text:{path:"label"},layoutData:l,wrapping:false}).addStyleClass("suggestText").addStyleClass("suggestNavItem").addStyleClass("suggestListItemCell");const d=s.getModel().getProperty(s.getPath());h.addEventDelegate({onAfterRendering:()=>{const e=h.getDomRef();const t=e.innerHTML;const s=t.lastIndexOf("&lt;/span&gt;")>0;if(d.uiSuggestionType===D.Search&&s){const s=t.slice(t.indexOf("&lt;span&gt;")+12,t.lastIndexOf("&lt;/span&gt;"));const i=t.slice(t.lastIndexOf("&lt;/span&gt;")+13);const a=S.boldTagUnescaperForStrings(i);e.innerHTML="<span>"+s+"</span>"+a}else{S.boldTagUnescaper(h.getDomRef())}}},h);const p=[a,h];if(d.filterIcon){p.push(n)}const f=new r("",{type:O.Active,content:new g("",{items:p,alignItems:R.Center})});f.addStyleClass("searchSuggestionCustomListItem");f["getText"]=()=>typeof d?.filter?.searchTerm==="string"?d.filter.searchTerm:this.getValue();const y=new o("",{cells:[f],type:O.Active});f.addStyleClass("searchSuggestionColumnListItem");if(d.uiSuggestionType===D.App){if(d.title&&d.title.indexOf("combinedAppSuggestion")>=0){y.addStyleClass("searchCombinedAppSuggestion")}else{y.addStyleClass("searchAppSuggestion")}}if(d.uiSuggestionType===D.DataSource){y.addStyleClass("searchDataSourceSuggestion")}if(d.uiSuggestionType===D.SearchTermData){y.addStyleClass("searchBOSuggestion")}if(d.uiSuggestionType===D.SearchTermAI){y.addStyleClass("searchAISuggestion")}if(d.uiSuggestionType===D.SearchTermHistory){y.addStyleClass("searchHistorySuggestion")}if(d.uiSuggestionType===D.Search){y.addStyleClass("searchRecentSuggestion")}y.addStyleClass("searchSuggestion");return y},navigateToSearchApp:function e(){const t=this.getModel();if(S.isSearchAppActive()||!t.config.isUshell){t.fireSearchQuery()}else{t.resetSearchResultItemMemory();const e=t.createSearchNavigationTargetCurrentState({updateUrl:true}).targetUrl;window.location.hash=e}},onAfterRendering:function e(s){t.prototype.onAfterRendering.call(this,s);const i=this.getDomRef();if(!i)return;const a=i.querySelector("input");if(!a)return;a.setAttribute("autocomplete","off");a.setAttribute("autocorrect","off");a.setAttribute("type","search");a.setAttribute("name","search");const n=document.createElement("form");n.style.setProperty("width","100%");n.setAttribute("action","");n.addEventListener("submit",e=>{e.preventDefault();return false});const o=a.parentElement;if(!o)return;o.appendChild(n);n.appendChild(a);a.setAttribute("role","combobox");a.setAttribute("aria-autocomplete","list");a.setAttribute("aria-expanded","false");a.setAttribute("aria-controls",this.getId()+"-popup");a.setAttribute("aria-label",x.getText("search"))},onValueRevertedByEscape:function e(){if(S.isSearchAppActive()){return}this.setValue(" ")},onsapescape:function e(s){const i=this.getDomRef();if(i){const e=i.querySelector("input");if(e){e.setAttribute("aria-expanded","false")}}t.prototype.onsapescape.call(this,s)}});return V});
//# sourceMappingURL=SearchInput.js.map