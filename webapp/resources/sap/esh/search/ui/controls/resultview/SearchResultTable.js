/*!
 * SAPUI5
 * Copyright (c) 2025 SAP SE or an SAP affiliate company. All rights reserved.
 * 
 */
sap.ui.define(["../../i18n","../../SearchResultTableFormatter","../../SearchResultTableP13NPersonalizer","sap/m/Table","sap/m/plugins/ColumnResizer","sap/m/Column","sap/m/ColumnListItem","sap/m/CustomListItem","../../SearchResultTableColumnType","./SearchText","../SearchLink","sap/ui/core/Element","sap/m/library","sap/m/HBox","sap/m/Button","sap/ui/core/Icon","../../sinaNexTS/sina/NavigationTarget","sap/m/ActionSheet","sap/ui/base/ManagedObject","sap/base/util/merge","sap/base/Log","../../error/ErrorHandler","sap/m/FlexItemData","../../UIEvents","sap/ui/core/EventBus","../../SelectionMode"],function(e,t,s,n,i,l,o,a,r,c,u,h,d,f,g,p,b,m,S,I,y,C,T,w,v,M){"use strict";function P(e){return e&&e.__esModule&&typeof e.default!=="undefined"?e.default:e}const R=P(e);const x=P(t);const E=P(s);const A=r["TableColumnType"];const L=P(c);const N=P(u);const D=d["ListMode"];const B=d["ListType"];const U=d["PlacementType"];const z=d["PopinDisplay"];const V=d["PopinLayout"];const F=b["NavigationTarget"];const H=P(C);const O=P(w);const W=M["SelectionMode"];const j=n.extend("sap.esh.search.ui.controls.SearchResultTable",{renderer:{apiVersion:2},constructor:function e(t,s){n.prototype.constructor.call(this,t,s);this.useStableIds=true;this.log=y.getLogger("sap.esh.search.ui.controls.resultview.SearchResultTable");this.errorHandler=H.getInstance()},assembleTable:function e(t){this.bindProperty("mode",{parts:[{path:"/multiSelectionEnabled"},{path:"/config/resultviewSelectionMode"},{path:"/resultviewSelectionVisibility"}],formatter:(e,t,s)=>{if(e===true||t===W.MultipleItems){if(s===true){return D.MultiSelect}else{return D.None}}else if(t===W.OneItem){if(s===true){return D.SingleSelectMaster}else{return D.None}}else{return D.None}}});this.setProperty("rememberSelections",false);this.attachSelectionChange(e=>{const s=e.getParameter("listItem");s.setProperty("selected",e.getParameter("selected"),true);t.updateMultiSelectionSelected()});this.bindProperty("visible",{parts:[{path:"/resultViewType"},{path:"/count"}],formatter:this.formatVisible.bind(this)});this.setProperty("sticky",["ColumnHeaders"]);this.setNoDataText(R.getText("noCloumnsSelected"));this.update();if(t.config?.FF_resizeResultTableColumns===true){this.setupColumnResizable();this.addStyleClass("sapElisa-search-result-table-resizable")}else{this.addStyleClass("sapElisa-search-result-table-might-popin")}this.addStyleClass("sapElisa-search-result-table")},formatVisible:function e(t,s){const n=t==="searchResultTable"&&s!==0;if(n&&this.getModel()?.config?.searchResultTablePersonalization!==false){if(!this.tablePersonalizer){this.tablePersonalizer=new E(this.getModel())}this.tablePersonalizer.initialize(this)}return n},update:function e(){if(!this.getBinding("columns")){this.bindTableColumns()}if(!this.getBinding("items")){this.bindTableItems()}if(this.getModel()){this.getModel().updateBindings(true)}},bindTableColumns:function e(){this.bindAggregation("columns",{path:"/tableColumns",factory:e=>{const t=new l(this.getStableId(e,"column"),{header:new L(this.getStableId(e,"headerLabel"),{text:"{name}",wrapping:false}),visible:"{visible}",width:"{width}"});t.getHeader().addStyleClass("sapUshellSearchResultListItem-MightOverflow");return t}})},bindTableItems:function e(){this.bindAggregation("items",{path:"/tableRows",factory:(e,t)=>this.assembleTableItems(e,t)})},assembleTableItems:function e(t,s){if(s.getObject().type==="footer"){return new a(this.getStableId(t,"item-footer"),{visible:false})}this.sortCellsInRows(s.getPath());return this.assembleTableMainItem(t,s)},assembleTableMainItem:function e(t,s){const n=this.getModel();const i=new o(this.getStableId(t,"item"),{selected:{path:"selected"}}).addStyleClass("sapUshellSearchTable");i.bindProperty("type",{parts:[{path:"/config/resultviewMasterDetailMode"},{path:"/config/resultviewSelectionMode"}],formatter:(e,t)=>{let s;const l=e=>{n.notifySubscribers(O.ESHShowResultDetail);v.getInstance().publish(O.ESHShowResultDetail,e)};if(e){s=B.Navigation;i.attachPress(l.bind(this))}else if(t===W.OneItem){s=B.Active;i.detachPress(l)}else{s=B.Inactive;i.detachPress(l)}return s}});if(s.getObject().customItemStyleClass){i.addStyleClass(s.getObject().customItemStyleClass)}i.bindAggregation("cells",{path:"cells",factory:(e,t)=>{const s=t.getObject();if(s.type===A.TITLE){let t="";let n=false;let i=true;const l=s.titleNavigation;if(l instanceof F){n=typeof l.targetFunction==="function";t=l.targetUrl}if((typeof t!=="string"||t.length===0)&&n===false){i=false}let o;const a=s.titleIconUrl;if(l){o=new N(this.getStableId(e,"link"),{navigationTarget:l,text:{path:"value"},wrapping:false});o.setIcon(s.titleIconUrl)}else{o=new L(this.getStableId(e,"link"),{text:{path:"value"},wrapping:false});if(a&&!(o.getAggregation("icon")instanceof p)){const t=new p(this.getStableId(e,"icon"),{src:S.escapeSettingsValue(a)});o.setIcon(t)}}o.addStyleClass("sapUshellSearchResultListItem-MightOverflow");o.addStyleClass("sapUshellSearchTableTitleLink");if(s.isHighlighted){o.addStyleClass("sapUshellSearchResultItem-AttributeValueHighlighted")}let r=o;const c=s.titleInfoIconUrl;const u=s.titleInfoIconTooltip&&s.titleInfoIconTooltip.length?s.titleInfoIconTooltip:R.getText("collectionShared");if(c){const t=new p(this.getStableId(e,"infoIcon"),{src:S.escapeSettingsValue(c),tooltip:u}).addStyleClass("sapUshellSearchTableTitleInfoIcon");if(!i){t.addStyleClass("sapUshellSearchTableTitleInfoIconDisabled")}o.setLayoutData(new T({growFactor:1,minWidth:"0px"}));t.setLayoutData(new T({growFactor:0,minWidth:"0px"}));r=new f(this.getStableId(e,"titleContainer"),{items:[o,new f({items:[t],layoutData:new T({growFactor:1}),justifyContent:"End"})],fitContainer:true,width:"100%",justifyContent:"Start"})}return r}if(s.type===A.RELATED_APPS){const t=new g(this.getStableId(e,"relAppsButton"),{icon:"sap-icon://action",tooltip:R.getText("intents"),press:()=>{const n=h.getElementById(this.getStableId(t.getId(),"relAppsActionSheet"));if(n){n.destroy();return}const i=s.navigationObjects;const l=[];let o;const a=(e,t)=>{if(t instanceof F){t.performNavigation({event:e})}};for(let t=0;t<i.length;t++){const s=i[t];this.destroyControl(this.getStableId(e,`navButton${t}`));o=new g(this.getStableId(e,`navButton${t}`),{text:S.escapeSettingsValue(s?.text),tooltip:S.escapeSettingsValue(s?.text)});o.attachPress(s,a);l.push(o)}const r=new m(this.getStableId(t.getId(),"relAppsActionSheet"),{buttons:l,placement:U.Auto});r.attachAfterClose(()=>{r.destroy()});r.openBy(t)}});t.addStyleClass("sapElisaSearchTableRelatedAppsButton");return t}const i=s.defaultNavigationTarget;if(i instanceof F){const t=new N(this.getStableId(e,"attrLink"),{navigationTarget:null,wrapping:false,tooltip:S.escapeSettingsValue(s.tooltip||"")});t.setNavigationTarget(i);t.setText(s.value);t.addStyleClass("sapUshellSearchResultListItem-MightOverflow");t.setIcon(s.icon);return t}if(s.type===A.EXTEND){try{return n.config.extendTableColumn.bindingFunction(s)}catch(e){this.errorHandler.onError(e)}}const l=new L(this.getStableId(e,"searchText"),{text:{path:"value"},wrapping:false}).addStyleClass("sapUshellSearchResultListItem-MightOverflow");if(s.icon){const t=new p(this.getStableId(e,"cellIcon"),{src:S.escapeSettingsValue(s.icon)});l.setIcon(t)}if(s.isHighlighted){l.addStyleClass("sapUshellSearchResultItem-AttributeValueHighlighted")}return l}});return i},sortCellsInRows:function e(t){const s=this.getModel();let n;if(t){const e=[s.getProperty(t)][0];e.cells=this.getSortedCells(e.cells);s.setProperty(t,e)}else{n=s.getProperty("/tableRows");for(const e of n){e.cells=this.getSortedCells(e.cells)}s.setProperty("/tableRows",n)}},getSortedCells:function e(t){const s=[];const n=this.getModel().getTableColumns(false);for(const e of n){for(const n of t){if(e.p13NColumnName===n.p13NColumnName){s.push(n);break}}}return s},setupColumnResizable:function e(){const t=this;const s=new i;s.attachColumnResize(()=>{setTimeout(function(){t.getModel().saveTableColumns(t.getModel().getTableColumns(false))},500)});t.addDependent(s)},setupPopin:function e(){const t=this.getModel();if(!t){return}this.setPopinLayout(V.Block);let s=0;this.getColumns().forEach(function(e){e.setDemandPopin(true);e.setPopinDisplay(z.Inline);if(e.getVisible()){s++;e.setMinScreenWidth(12*s+"rem")}})},setupColumnsAbsoluteWidth:function e(){const t=this.getModel();if(!t){return}const s=this.getDomRef();const n=s?s.querySelector("table"):null;const i=n?n.offsetWidth:undefined;if(typeof i!=="number"){return}let l=0;if(n){const e=n.querySelector("th.sapMListTblSelCol");if(e){l=e.offsetWidth}}const o=I([],t.getTableColumns(false));const a=new x(t);let r=0;let c=0;o.forEach(e=>{const t=a.getColumnWidthInPixel(e.width);if(t){r+=t}else{e.width=a.defaultColumnWidth;if(e.visible){c++}}});if(c===0){return}const u=2;const h=Math.trunc((i-l-r)/c-u)+"px";o.forEach(e=>{const t=a.getColumnWidthInPixel(e.width);if(!t){e.width=h}});t.setTableColumns(o,true)},getStableId:function e(t,s,n="-"){if(this.useStableIds){return`${t}${n}${s}`}else{return""}},destroyControl:function e(t){const s=h.getElementById(t);if(s){s.destroy()}},onBeforeRendering:function e(){},onAfterRendering:function e(){const t=this.getModel();const s=this.getDomRef();const n=s?.querySelector("table > tbody > tr > td.sapMListTblCellNoData:first-child");if(n){n.setAttribute("colspan","3")}const i=s?.querySelector("table > thead > tr:first-child");if(i){i.setAttribute("aria-labelledby",t?.getSearchCompositeControlInstanceByChildControl(this)?.countBreadcrumbsHiddenElement.getId())}if(t.config?.FF_resizeResultTableColumns===true){this.setupColumnsAbsoluteWidth()}if(t.config?.FF_resizeResultTableColumns!==true){this.setupPopin()}}});return j});
//# sourceMappingURL=SearchResultTable.js.map