{"version":3,"file":"CatalogSearch.js","names":["sap","ui","define","__ErrorHandler","device","__jsSearchFactory","Log","___error_errors","__SearchModel","_interopRequireDefault","obj","__esModule","default","ErrorHandler","jsSearchFactory","AppSearchError","AppSearchSearchTermExceedsLimitsError","ESHUIError","SearchModel","CatalogSearch","errorHandler","initPromise","searchEngine","logger","getLogger","constructor","this","getInstance","model","getModelSingleton","initAsync","searchService","window","ushell","Container","getServiceAsync","flpApps","getApps","apps","formatApps","debug","length","shouldNormalize","isIE","browser","msie","String","prototype","normalize","createJsSearch","objects","fields","algorithm","id","options","error","flpError","previous","resultApps","forEach","app","visualizations","vis","label","title","subtitle","push","keywords","join","icon","visualization","url","targetURL","prefetch","search","query","searchTermLengthLimit","searchTerm","searchResults","searchFor","top","skip","items","i","results","result","formattedResult","Object","assign","object","highlightedLabel","hasHighlightedSubtitle","highlighted","totalCount","tiles","appSearchError","onError"],"sources":["CatalogSearch.ts"],"sourcesContent":["/*!\n * SAPUI5\n * Copyright (c) 2025 SAP SE or an SAP affiliate company. All rights reserved.\n * \n */\nimport ErrorHandler from \"../error/ErrorHandler\";\nimport device from \"sap/ui/Device\"; // TODO\nimport jsSearchFactory from \"./JsSearchFactory\";\nimport JsSearch from \"sap/esh/search/ui/appsearch/JsSearch\";\nimport Log from \"sap/base/Log\";\nimport { AppSearchError, AppSearchSearchTermExceedsLimitsError, ESHUIError } from \"../error/errors\";\nimport SearchModel from \"../SearchModel\";\n\ninterface FLPAppVisualization {\n    id: string;\n    vizId: string;\n    vizType: string;\n    title: string;\n    subtitle: string;\n    icon: string;\n    info: string;\n    keywords: string[];\n    technicalAttributes: string[];\n    target: {\n        type: string;\n        url: string;\n    };\n    targetURL: string;\n}\n\nexport interface FLPApp {\n    id: string;\n    title: string;\n    subtitle: string;\n    icon: string;\n    info: string;\n    keywords: string[];\n    technicalAttributes: string[];\n    target: {\n        type: string;\n        url: string;\n    };\n    visualizations: Array<FLPAppVisualization>;\n}\n\nexport interface ESHApp {\n    title: string;\n    subtitle: string;\n    keywords: string;\n    icon: string;\n    label: string;\n    visualization: FLPAppVisualization;\n    url: string;\n}\n\nexport default class CatalogSearch {\n    private errorHandler: ErrorHandler;\n    private initPromise: Promise<void>;\n    private searchEngine: JsSearch;\n    private logger = Log.getLogger(\"sap.esh.search.ui.appsearch.catalogsearch\");\n\n    constructor() {\n        this.errorHandler = ErrorHandler.getInstance({ model: SearchModel.getModelSingleton({}, \"flp\") });\n        this.initPromise = this.initAsync();\n    }\n\n    private async initAsync(): Promise<void> {\n        // check cached promise\n        if (this.initPromise) {\n            return this.initPromise;\n        }\n        try {\n            const searchService = await (window.sap.ushell as any).Container.getServiceAsync(\n                \"SearchableContent\"\n            );\n            const flpApps = (await searchService.getApps()) as Array<FLPApp>;\n\n            // format\n            const apps = this.formatApps(flpApps);\n            // add demo apps\n            // apps.push(...this.createDemoApps());\n\n            this.logger.debug(`Adding ${apps.length} flp apps to the search index`);\n\n            // decide whether jsSearch should do normalization\n            let shouldNormalize = true;\n            const isIE = (device && device.browser && (device.browser as any).msie) || false;\n            if (!String.prototype.normalize || isIE) {\n                shouldNormalize = false;\n            }\n\n            // create js search engine\n            this.searchEngine = jsSearchFactory.createJsSearch({\n                objects: apps,\n                fields: [\"title\", \"subtitle\", \"keywords\"],\n                shouldNormalize: shouldNormalize,\n                algorithm: {\n                    id: \"contains-ranked\",\n                    options: [50, 49, 40, 39, 5, 4, 51],\n                },\n            });\n        } catch (error) {\n            const flpError = new ESHUIError(\n                \"FLP SearchableContent Service Failed - App Search won't be available.\"\n            );\n            flpError.previous = error;\n            throw flpError;\n        }\n    }\n\n    /*private createDemoApps(): Array<ESHApp> {\n        const apps: Array<ESHApp> = [];\n        for (let i = 0; i < 15; ++i) {\n            apps.push({\n                title: \"Generic App \" + i,\n                subtitle: \"App\",\n                keywords: \"app\",\n                icon: \"sap-icon://product\",\n                label: \"rudi\",\n                visualization: null,\n                url: \"#Shell-home\",\n            });\n        }\n        return apps;\n    }*/\n\n    private formatApps(apps: Array<FLPApp>): Array<ESHApp> {\n        const resultApps = [];\n        apps.forEach(function (app) {\n            app.visualizations.forEach(function (vis) {\n                let label = vis.title;\n                if (vis.subtitle) {\n                    label = label + \" - \" + vis.subtitle;\n                }\n                resultApps.push({\n                    title: vis.title || \"\",\n                    subtitle: vis.subtitle || \"\",\n                    keywords: vis.keywords ? vis.keywords.join(\" \") : \"\",\n                    icon: vis.icon || \"\",\n                    label: label,\n                    visualization: vis,\n                    url: vis.targetURL,\n                });\n            });\n        });\n        return resultApps;\n    }\n\n    prefetch(): void {\n        // empty\n    }\n\n    async search(query: {\n        searchTerm: string;\n        top: number;\n        skip: number;\n    }): Promise<{ totalCount: number; tiles: Array<ESHApp> }> {\n        // check length limit (for long search terms jssearch may freeze the UI because of too much regexp creation...)\n        const searchTermLengthLimit = 1000;\n        if (query.searchTerm?.length > searchTermLengthLimit) {\n            throw new AppSearchSearchTermExceedsLimitsError(searchTermLengthLimit);\n        }\n\n        try {\n            await this.initAsync();\n\n            // use js search for searching\n            const searchResults = this.searchEngine.search({\n                searchFor: query.searchTerm || \"*\",\n                top: query.top,\n                skip: query.skip,\n            });\n\n            // convert to result structure\n            const items: ESHApp[] = [];\n            for (let i = 0; i < searchResults.results.length; ++i) {\n                const result = searchResults.results[i];\n                const formattedResult = Object.assign({}, result.object) as ESHApp;\n                let highlightedLabel = formattedResult.title;\n                let hasHighlightedSubtitle = false;\n                if (typeof result.highlighted === \"object\" && result.highlighted) {\n                    if (\"title\" in result.highlighted && typeof result.highlighted.title === \"string\") {\n                        highlightedLabel = result.highlighted.title;\n                    }\n                    if (\"subtitle\" in result.highlighted && typeof result.highlighted.subtitle === \"string\") {\n                        highlightedLabel = highlightedLabel + \" - \" + result.highlighted.subtitle;\n                        hasHighlightedSubtitle = true;\n                    }\n                }\n                if (!hasHighlightedSubtitle && formattedResult.subtitle) {\n                    highlightedLabel = highlightedLabel + \" - \" + formattedResult.subtitle;\n                }\n                formattedResult.label = highlightedLabel;\n                items.push(formattedResult);\n            }\n\n            // return search result\n            return {\n                totalCount: searchResults.totalCount,\n                tiles: items,\n            };\n        } catch (error) {\n            const appSearchError = new AppSearchError(error);\n            appSearchError.previous = error;\n            this.errorHandler.onError(appSearchError);\n            return {\n                totalCount: 0,\n                tiles: [],\n            };\n        }\n    }\n}\n"],"mappings":"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","ignoreList":[]}