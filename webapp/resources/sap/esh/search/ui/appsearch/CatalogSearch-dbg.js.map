{"version":3,"file":"CatalogSearch-dbg.js","names":["sap","ui","define","__ErrorHandler","device","__jsSearchFactory","Log","___error_errors","__SearchModel","_interopRequireDefault","obj","__esModule","default","ErrorHandler","jsSearchFactory","AppSearchError","AppSearchSearchTermExceedsLimitsError","ESHUIError","SearchModel","CatalogSearch","errorHandler","initPromise","searchEngine","logger","getLogger","constructor","getInstance","model","getModelSingleton","initAsync","searchService","window","ushell","Container","getServiceAsync","flpApps","getApps","apps","formatApps","debug","length","shouldNormalize","isIE","browser","msie","String","prototype","normalize","createJsSearch","objects","fields","algorithm","id","options","error","flpError","previous","resultApps","forEach","app","visualizations","vis","label","title","subtitle","push","keywords","join","icon","visualization","url","targetURL","prefetch","search","query","searchTermLengthLimit","searchTerm","searchResults","searchFor","top","skip","items","i","results","result","formattedResult","Object","assign","object","highlightedLabel","hasHighlightedSubtitle","highlighted","totalCount","tiles","appSearchError","onError"],"sources":["CatalogSearch.ts"],"sourcesContent":["/*!\n * SAPUI5\n * Copyright (c) 2025 SAP SE or an SAP affiliate company. All rights reserved.\n * \n */\nimport ErrorHandler from \"../error/ErrorHandler\";\nimport device from \"sap/ui/Device\"; // TODO\nimport jsSearchFactory from \"./JsSearchFactory\";\nimport JsSearch from \"sap/esh/search/ui/appsearch/JsSearch\";\nimport Log from \"sap/base/Log\";\nimport { AppSearchError, AppSearchSearchTermExceedsLimitsError, ESHUIError } from \"../error/errors\";\nimport SearchModel from \"../SearchModel\";\n\ninterface FLPAppVisualization {\n    id: string;\n    vizId: string;\n    vizType: string;\n    title: string;\n    subtitle: string;\n    icon: string;\n    info: string;\n    keywords: string[];\n    technicalAttributes: string[];\n    target: {\n        type: string;\n        url: string;\n    };\n    targetURL: string;\n}\n\nexport interface FLPApp {\n    id: string;\n    title: string;\n    subtitle: string;\n    icon: string;\n    info: string;\n    keywords: string[];\n    technicalAttributes: string[];\n    target: {\n        type: string;\n        url: string;\n    };\n    visualizations: Array<FLPAppVisualization>;\n}\n\nexport interface ESHApp {\n    title: string;\n    subtitle: string;\n    keywords: string;\n    icon: string;\n    label: string;\n    visualization: FLPAppVisualization;\n    url: string;\n}\n\nexport default class CatalogSearch {\n    private errorHandler: ErrorHandler;\n    private initPromise: Promise<void>;\n    private searchEngine: JsSearch;\n    private logger = Log.getLogger(\"sap.esh.search.ui.appsearch.catalogsearch\");\n\n    constructor() {\n        this.errorHandler = ErrorHandler.getInstance({ model: SearchModel.getModelSingleton({}, \"flp\") });\n        this.initPromise = this.initAsync();\n    }\n\n    private async initAsync(): Promise<void> {\n        // check cached promise\n        if (this.initPromise) {\n            return this.initPromise;\n        }\n        try {\n            const searchService = await (window.sap.ushell as any).Container.getServiceAsync(\n                \"SearchableContent\"\n            );\n            const flpApps = (await searchService.getApps()) as Array<FLPApp>;\n\n            // format\n            const apps = this.formatApps(flpApps);\n            // add demo apps\n            // apps.push(...this.createDemoApps());\n\n            this.logger.debug(`Adding ${apps.length} flp apps to the search index`);\n\n            // decide whether jsSearch should do normalization\n            let shouldNormalize = true;\n            const isIE = (device && device.browser && (device.browser as any).msie) || false;\n            if (!String.prototype.normalize || isIE) {\n                shouldNormalize = false;\n            }\n\n            // create js search engine\n            this.searchEngine = jsSearchFactory.createJsSearch({\n                objects: apps,\n                fields: [\"title\", \"subtitle\", \"keywords\"],\n                shouldNormalize: shouldNormalize,\n                algorithm: {\n                    id: \"contains-ranked\",\n                    options: [50, 49, 40, 39, 5, 4, 51],\n                },\n            });\n        } catch (error) {\n            const flpError = new ESHUIError(\n                \"FLP SearchableContent Service Failed - App Search won't be available.\"\n            );\n            flpError.previous = error;\n            throw flpError;\n        }\n    }\n\n    /*private createDemoApps(): Array<ESHApp> {\n        const apps: Array<ESHApp> = [];\n        for (let i = 0; i < 15; ++i) {\n            apps.push({\n                title: \"Generic App \" + i,\n                subtitle: \"App\",\n                keywords: \"app\",\n                icon: \"sap-icon://product\",\n                label: \"rudi\",\n                visualization: null,\n                url: \"#Shell-home\",\n            });\n        }\n        return apps;\n    }*/\n\n    private formatApps(apps: Array<FLPApp>): Array<ESHApp> {\n        const resultApps = [];\n        apps.forEach(function (app) {\n            app.visualizations.forEach(function (vis) {\n                let label = vis.title;\n                if (vis.subtitle) {\n                    label = label + \" - \" + vis.subtitle;\n                }\n                resultApps.push({\n                    title: vis.title || \"\",\n                    subtitle: vis.subtitle || \"\",\n                    keywords: vis.keywords ? vis.keywords.join(\" \") : \"\",\n                    icon: vis.icon || \"\",\n                    label: label,\n                    visualization: vis,\n                    url: vis.targetURL,\n                });\n            });\n        });\n        return resultApps;\n    }\n\n    prefetch(): void {\n        // empty\n    }\n\n    async search(query: {\n        searchTerm: string;\n        top: number;\n        skip: number;\n    }): Promise<{ totalCount: number; tiles: Array<ESHApp> }> {\n        // check length limit (for long search terms jssearch may freeze the UI because of too much regexp creation...)\n        const searchTermLengthLimit = 1000;\n        if (query.searchTerm?.length > searchTermLengthLimit) {\n            throw new AppSearchSearchTermExceedsLimitsError(searchTermLengthLimit);\n        }\n\n        try {\n            await this.initAsync();\n\n            // use js search for searching\n            const searchResults = this.searchEngine.search({\n                searchFor: query.searchTerm || \"*\",\n                top: query.top,\n                skip: query.skip,\n            });\n\n            // convert to result structure\n            const items: ESHApp[] = [];\n            for (let i = 0; i < searchResults.results.length; ++i) {\n                const result = searchResults.results[i];\n                const formattedResult = Object.assign({}, result.object) as ESHApp;\n                let highlightedLabel = formattedResult.title;\n                let hasHighlightedSubtitle = false;\n                if (typeof result.highlighted === \"object\" && result.highlighted) {\n                    if (\"title\" in result.highlighted && typeof result.highlighted.title === \"string\") {\n                        highlightedLabel = result.highlighted.title;\n                    }\n                    if (\"subtitle\" in result.highlighted && typeof result.highlighted.subtitle === \"string\") {\n                        highlightedLabel = highlightedLabel + \" - \" + result.highlighted.subtitle;\n                        hasHighlightedSubtitle = true;\n                    }\n                }\n                if (!hasHighlightedSubtitle && formattedResult.subtitle) {\n                    highlightedLabel = highlightedLabel + \" - \" + formattedResult.subtitle;\n                }\n                formattedResult.label = highlightedLabel;\n                items.push(formattedResult);\n            }\n\n            // return search result\n            return {\n                totalCount: searchResults.totalCount,\n                tiles: items,\n            };\n        } catch (error) {\n            const appSearchError = new AppSearchError(error);\n            appSearchError.previous = error;\n            this.errorHandler.onError(appSearchError);\n            return {\n                totalCount: 0,\n                tiles: [],\n            };\n        }\n    }\n}\n"],"mappings":"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","ignoreList":[]}