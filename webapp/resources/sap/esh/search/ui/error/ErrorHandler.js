/*!
 * SAPUI5
 * Copyright (c) 2025 SAP SE or an SAP affiliate company. All rights reserved.
 * 
 */
sap.ui.define(["sap/base/Log","sap/m/MessageBox","sap/ui/core/library","sap/ui/core/message/MessageType","../i18n","./errors","../sinaNexTS/core/errors"],function(r,e,s,t,o,n,a){"use strict";function i(r){return r&&r.__esModule&&typeof r.default!=="undefined"?r.default:r}const c=s["TextDirection"];const l=i(o);const h=n["ESHUIError"];const E=a["DataSourceAttributeMetadataNotFoundError"];const d=a["ServerError"];const u=a["ServerErrorCode"];const g=a["SinaError"];class f{label;searchModel;static instance;externalOnErrorHandler;_oLogger=r.getLogger("sap.esh.search.ui.error.ErrorHandler");static getInstance(r){if(!f.instance){f.instance=new f(r)}return f.instance}constructor(r){this.label=r?.label;this.searchModel=r?.model;this.externalOnErrorHandler=r?.onErrorHandler}onError(r,e){if(typeof this.externalOnErrorHandler==="function"){try{this.externalOnErrorHandler(r,e)}catch(r){this.handleError(r,e)}}else{this.handleError(r,e)}}onErrorAsync(r,e){this.onError(r,e);return Promise.resolve(true)}handleError(r,e){this.logError(r);this.showError(r,e)}setSearchModel(r){this.searchModel=r}setExternalOnErrorHandler(r){this.externalOnErrorHandler=r}getErrorTextGeneric(r){let e=r.name;e+=" "+r;if(typeof r.stack!=="undefined"){e="\n"+r.stack}if(r.previous instanceof Error){e+=`\n--\x3e Previous error was: ${this.getErrorText(r.previous)}`}return e}getErrorTextEsh(r){let e=r.name;if(r instanceof d){e+=" code:"+r.code}e+=" "+r.message;if(r?.details){e+="\n"+r.details}if(r?.solution){e+="\n"+r.solution}if(typeof r.stack!=="undefined"){e+="\n"+r.stack}if(r.previous instanceof Error){e+=`\n--\x3e Previous error was: ${this.getErrorText(r.previous)}`}return e}getErrorText(r){if(r instanceof g||r instanceof h){return this.getErrorTextEsh(r)}else{return this.getErrorTextGeneric(r)}}logError(r){let e=this.label?this.label+": ":"";e+=this.getErrorText(r)+"\n";if(this.searchModel&&this.searchModel.sinaNext){e+=this.searchModel.sinaNext.getDebugInfo()+"\n"}this._oLogger.error(e,"ErrorHandler")}convertErrorToMessage(r,e){if(r instanceof h||r instanceof g){return this.convertErrorToMessageEsh(r,e)}else{return this.convertErrorToMessageGeneric(r)}}convertErrorToMessageGeneric(r){let e,s;switch(r.name){case"TypeError":e=l.getText("error.TypeError.message");s=l.getText("error.TypeError.solution");break;case"URIError":e=l.getText("searchError");s=l.getText("error.URIError.solution");break;default:e=""+r;s=""}return{title:e,description:s,type:t.Error}}convertErrorToMessageEsh(r,e){if(r instanceof d&&r.code===u.E300||r instanceof E){this.showReloadPopup();return null}let s=t.Error;if(e?.showMinorErrorsAsWarnings){switch(r.name){case"ServerError":switch(r.code){case u.E100:s=t.Warning;break;case u.E400:s=t.Warning;break;case u.E500:s=t.Warning;break}}}const o=r.message||l.getText("searchError");const n=[];if(r.details){n.push(r.details)}if(r.solution){n.push(r.solution)}let a="";if(r.name==="ServerError"){a=" "+r.code}n.push("("+r.name+a+")");return{title:o,description:n.join("\n"),type:s}}showReloadPopup(){e.confirm(l.getText("searchModelChanged"),{onClose:r=>{if(r==="OK"){if(this.searchModel){this.searchModel.resetDataSource(false);this.searchModel.resetAllFilterConditions(false);const r=this.searchModel.createSearchNavigationTargetCurrentState();window.location.href=r.targetUrl}window.location.reload()}},styleClass:"sapUshellSearchMessageBox"})}showMessageBox(r){const s=r.title+"\n"+r.description;const o={onClose:null,initialFocus:null,textDirection:c.Inherit,styleClass:"sapUshellSearchMessageBox"};switch(r.type){case t.Information:e.information(s,o);break;case t.Warning:e.warning(s,o);break;case t.Error:e.error(s,o);break;default:e.error(s,o);break}}showError(r,e){const s=this.convertErrorToMessage(r,e);if(!s){return}if(this.searchModel){this.searchModel.pushUIMessage(s)}else{this.showMessageBox(s)}}}return f});
//# sourceMappingURL=ErrorHandler.js.map