{"version":3,"file":"UserCategoryManager-dbg.js","names":["sap","ui","define","__i18n","sap_esh_search_ui_SearchHelper","___error_errors","___personalization_PersonalizationKeys","_interopRequireDefault","obj","__esModule","default","i18n","isSearchAppActive","ProgramError","PersonalizationKeys","myFavDataStore","myFavorites","UserCategoryManager","active","lastActive","categories","personalizationStorage","sina","create","properties","instance","initAsync","constructor","that","userCategory","sinaSubDataSources","undefinedSubDataSourceIds","myFavData","getItem","isPersonalizationStorageItem","createDataSource","id","label","getText","labelPlural","type","DataSourceType","UserCategory","includeApps","subDataSources","push","Promise","resolve","setFavActive","isFavActive","setLastFavActive","favUserCategory","userCatgories","map","dataSource","sinaSubDataSource","getDataSource","filter","x","object","getCategory","category","isLastFavActive","value","save","categoriesJson","subDataSourceList","subDataSource","undefinedSubDataSourceId","setItem","saveNotDelayed","then","result","RegExp","exec","window","location","href","sUrl","setTimeout","assign","reload","bind"],"sources":["UserCategoryManager.ts"],"sourcesContent":["/*!\n * SAPUI5\n * Copyright (c) 2025 SAP SE or an SAP affiliate company. All rights reserved.\n * \n */\nimport i18n from \"../i18n\";\nimport { isSearchAppActive } from \"sap/esh/search/ui/SearchHelper\";\nimport { Sina } from \"../sinaNexTS/sina/Sina\";\nimport {\n    UserCategoryDataSource,\n    UserCategoryDataSourceProperties,\n} from \"../sinaNexTS/sina/UserCategoryDataSource\";\nimport PersonalizationStorage from \"../personalization/PersonalizationStorage\";\nimport { ProgramError } from \"../error/errors\";\nimport { PersonalizationKeys } from \"../personalization/PersonalizationKeys\";\n\nexport interface UserCategoryManagerProperties {\n    sina: Sina;\n    personalizationStorage: PersonalizationStorage;\n}\n\ninterface PersonalizationStorageItem {\n    active: boolean;\n    userCatgories: Array<{ id: string; includeApps: boolean; subDataSources: Array<{ id: string }> }>;\n}\n\nconst myFavDataStore = PersonalizationKeys.myFavorites;\n\nexport default class UserCategoryManager {\n    active: boolean;\n    lastActive: boolean;\n    categories: Array<UserCategoryDataSource>;\n    personalizationStorage: PersonalizationStorage;\n    sina: Sina;\n\n    static async create(properties: UserCategoryManagerProperties): Promise<UserCategoryManager> {\n        const instance = new UserCategoryManager(properties);\n        await instance.initAsync();\n        return instance;\n    }\n\n    constructor(properties: UserCategoryManagerProperties) {\n        this.active = false;\n        this.lastActive = false;\n        this.categories = [];\n        this.personalizationStorage = properties.personalizationStorage;\n        this.sina = properties.sina;\n    }\n    initAsync(): Promise<void> {\n        // eslint-disable-next-line @typescript-eslint/no-this-alias\n        const that = this;\n        let userCategory;\n        let sinaSubDataSources;\n        const undefinedSubDataSourceIds = [];\n\n        const myFavData = this.personalizationStorage.getItem(myFavDataStore);\n        if (!this.isPersonalizationStorageItem(myFavData)) {\n            throw new ProgramError(null, \"wrong myFavData type\");\n        }\n\n        /* // example for storage\n                        personalizationStorageInstance.setItem('my-fav-data', {\n                            active: true,\n                            userCatgories: [{\n                                id: 'MyFavorites',\n                                includeApps: true\n                                subDataSources: [{\n                                    id: 'CD$ALL~ZESH_EPM_P_DEMO~'\n                                }, {\n                                    id: 'CD$ALL~ZESH_EPM_S_DEMO~'\n                                }]\n                            }]\n                        });*/\n\n        // No FavData exists\n        if (!myFavData) {\n            userCategory = this.sina.createDataSource({\n                id: \"MyFavorites\",\n                label: i18n.getText(\"label_userFavorites\"),\n                labelPlural: i18n.getText(\"label_userFavorites\"),\n                type: this.sina.DataSourceType.UserCategory,\n                includeApps: false,\n                subDataSources: [],\n                undefinedSubDataSourceIds: [],\n            } as UserCategoryDataSourceProperties);\n            this.categories.push(userCategory);\n            return Promise.resolve();\n        }\n\n        this.setFavActive(myFavData.active);\n        if (!this.isFavActive()) {\n            // null or undefined\n            this.setFavActive(false);\n        }\n        this.setLastFavActive(this.isFavActive());\n\n        // convert subDataSources from personalizationStorage into sina datasources\n        // if not possible -> add subDataSource to undefinedSubDataSourceIds\n\n        for (const favUserCategory of myFavData.userCatgories) {\n            const subDataSources = favUserCategory.subDataSources;\n            if (subDataSources) {\n                sinaSubDataSources = subDataSources.map(function (dataSource) {\n                    const sinaSubDataSource = that.sina.getDataSource(dataSource.id);\n                    if (!sinaSubDataSource) {\n                        undefinedSubDataSourceIds.push(dataSource.id);\n                    }\n                    return sinaSubDataSource;\n                });\n            } else {\n                sinaSubDataSources = [];\n            }\n\n            // delete all undefined entries (datasources which do not exist currently)\n            sinaSubDataSources = sinaSubDataSources.filter((x) => x);\n\n            // DataSourceType.UserCategory: switch in sina.js createDataSource depending on DataSourceType\n            userCategory = this.sina.createDataSource({\n                id: favUserCategory.id,\n                label: i18n.getText(\"label_userFavorites\"),\n                labelPlural: i18n.getText(\"label_userFavorites\"),\n                type: this.sina.DataSourceType.UserCategory,\n                includeApps: favUserCategory.includeApps || false,\n                subDataSources: sinaSubDataSources,\n                undefinedSubDataSourceIds: undefinedSubDataSourceIds,\n            } as UserCategoryDataSourceProperties);\n\n            this.categories.push(userCategory);\n        }\n        return Promise.resolve();\n    }\n\n    isPersonalizationStorageItem(object: unknown): object is PersonalizationStorageItem {\n        return true;\n    }\n\n    getCategory(id: string): UserCategoryDataSource {\n        for (const category of this.categories) {\n            if (category.id === id) {\n                return category;\n            }\n        }\n        return null;\n    }\n\n    isFavActive(): boolean {\n        return this.active;\n    }\n\n    setFavActive(active: boolean): void {\n        this.active = active;\n    }\n\n    isLastFavActive(): boolean {\n        return this.lastActive;\n    }\n\n    setLastFavActive(value: boolean): void {\n        this.lastActive = value;\n    }\n\n    save(): void {\n        const categoriesJson = [];\n\n        // check change of subDataSources\n        // convert sina -> Fav format\n        for (const category of this.categories) {\n            const subDataSourceList = [];\n            // add subDataSources (active)\n            for (const subDataSource of category.subDataSources) {\n                subDataSourceList.push({\n                    id: subDataSource.id,\n                });\n            }\n            // add undefinedSubDataSources (inactive)\n            for (const undefinedSubDataSourceId of category.undefinedSubDataSourceIds) {\n                subDataSourceList.push({\n                    id: undefinedSubDataSourceId,\n                });\n            }\n\n            categoriesJson.push({\n                id: category.id,\n                includeApps: category.includeApps,\n                subDataSources: subDataSourceList,\n            });\n        }\n\n        this.personalizationStorage.setItem(myFavDataStore, {\n            active: this.isFavActive(),\n            userCatgories: categoriesJson,\n        });\n        // save must be finished before reload\n        // timeout necessary for MessageToast display with success message for save\n        this.personalizationStorage.saveNotDelayed().then(\n            function () {\n                //search used and flag for 'Use Personalized Search Scope' changed => reset to home URL required\n                //refresh of search dropdown listbox\n                if (isSearchAppActive() && this.isLastFavActive() !== this.isFavActive()) {\n                    const result = new RegExp(/^[^#]*#/).exec(window.location.href); //new RegExp('^[^#]*') without # /\n                    const sUrl = result[0];\n                    setTimeout(function () {\n                        window.location.assign(sUrl);\n                        window.location.reload();\n                    }, 2000);\n                } else if (\n                    //search not used and flag for 'Use Personalized Search Scope' changed --> refresh of search dropdown listbox OR\n                    //when search used and flag for 'Use Personalized Search Scope' not changed --> refresh for tree update after change of My Favorites\n                    (!isSearchAppActive() && this.isLastFavActive() !== this.isFavActive()) ||\n                    (isSearchAppActive() && this.isLastFavActive() === this.isFavActive())\n                ) {\n                    setTimeout(function () {\n                        window.location.reload();\n                    }, 2000);\n                }\n            }.bind(this)\n        );\n    }\n}\n"],"mappings":"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","ignoreList":[]}