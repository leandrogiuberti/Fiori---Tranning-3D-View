/*!
 * SAPUI5
 * Copyright (c) 2025 SAP SE or an SAP affiliate company. All rights reserved.
 * 
 */
sap.ui.define(["../i18n","sap/esh/search/ui/SearchHelper","../error/errors","../personalization/PersonalizationKeys"],function(t,e,s,i){"use strict";function a(t){return t&&t.__esModule&&typeof t.default!=="undefined"?t.default:t}const o=a(t);const r=e["isSearchAppActive"];const n=s["ProgramError"];const c=i["PersonalizationKeys"];const u=c.myFavorites;class l{active;lastActive;categories;personalizationStorage;sina;static async create(t){const e=new l(t);await e.initAsync();return e}constructor(t){this.active=false;this.lastActive=false;this.categories=[];this.personalizationStorage=t.personalizationStorage;this.sina=t.sina}initAsync(){const t=this;let e;let s;const i=[];const a=this.personalizationStorage.getItem(u);if(!this.isPersonalizationStorageItem(a)){throw new n(null,"wrong myFavData type")}if(!a){e=this.sina.createDataSource({id:"MyFavorites",label:o.getText("label_userFavorites"),labelPlural:o.getText("label_userFavorites"),type:this.sina.DataSourceType.UserCategory,includeApps:false,subDataSources:[],undefinedSubDataSourceIds:[]});this.categories.push(e);return Promise.resolve()}this.setFavActive(a.active);if(!this.isFavActive()){this.setFavActive(false)}this.setLastFavActive(this.isFavActive());for(const r of a.userCatgories){const a=r.subDataSources;if(a){s=a.map(function(e){const s=t.sina.getDataSource(e.id);if(!s){i.push(e.id)}return s})}else{s=[]}s=s.filter(t=>t);e=this.sina.createDataSource({id:r.id,label:o.getText("label_userFavorites"),labelPlural:o.getText("label_userFavorites"),type:this.sina.DataSourceType.UserCategory,includeApps:r.includeApps||false,subDataSources:s,undefinedSubDataSourceIds:i});this.categories.push(e)}return Promise.resolve()}isPersonalizationStorageItem(t){return true}getCategory(t){for(const e of this.categories){if(e.id===t){return e}}return null}isFavActive(){return this.active}setFavActive(t){this.active=t}isLastFavActive(){return this.lastActive}setLastFavActive(t){this.lastActive=t}save(){const t=[];for(const e of this.categories){const s=[];for(const t of e.subDataSources){s.push({id:t.id})}for(const t of e.undefinedSubDataSourceIds){s.push({id:t})}t.push({id:e.id,includeApps:e.includeApps,subDataSources:s})}this.personalizationStorage.setItem(u,{active:this.isFavActive(),userCatgories:t});this.personalizationStorage.saveNotDelayed().then(function(){if(r()&&this.isLastFavActive()!==this.isFavActive()){const t=new RegExp(/^[^#]*#/).exec(window.location.href);const e=t[0];setTimeout(function(){window.location.assign(e);window.location.reload()},2e3)}else if(!r()&&this.isLastFavActive()!==this.isFavActive()||r()&&this.isLastFavActive()===this.isFavActive()){setTimeout(function(){window.location.reload()},2e3)}}.bind(this))}}return l});
//# sourceMappingURL=UserCategoryManager.js.map