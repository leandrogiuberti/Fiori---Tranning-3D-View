{"version":3,"file":"SearchHierarchyDynamicTreeNode-dbg.js","names":["sap","ui","define","__TreeNode","_interopRequireDefault","obj","__esModule","default","TreeNode","SearchHierarchyDynamicTreeNode","count","selected","partiallySelected","hasFilter","constructor","props","getData","facet","fetchChildTreeNodesImpl","resultChildNodes","filter","clone","rootCondition","removeAttributeConditions","attributeId","resultSet","sina","createHierarchyQuery","nodeId","id","nlq","model","isNlqActive","getResultSetAsync","hasErrors","getErrors","forEach","error","errorHandler","onError","node","childNodes","treeNodeFactory","getTreeNodeFactory","childNode","push","createTreeNode","label","expandable","hasChildren","updateStructureTree","setExpanded","expanded","updateUI","mixinFilterNodes","toggleFilter","setFilter","visitParentNodesRecursively","visitChildNodesRecursively","isShowMoreDialog","activateFilters","set","filterCondition","createSimpleCondition","operator","ComparisonOperator","DescendantOf","attribute","attributeLabel","title","value","valueLabel","autoInsertCondition","setProperty","autoRemoveCondition","length","filterCount","handleSetFilter"],"sources":["SearchHierarchyDynamicTreeNode.ts"],"sourcesContent":["/*!\n * SAPUI5\n * Copyright (c) 2025 SAP SE or an SAP affiliate company. All rights reserved.\n * \n */\nimport { HierarchyResultSet } from \"../sinaNexTS/sina/HierarchyResultSet\";\nimport TreeNode, { TreeNodeProperties } from \"../tree/TreeNode\";\nimport TreeNodeFactory from \"../tree/TreeNodeFactory\";\nimport SearchHierarchyDynamicFacet from \"./SearchHierarchyDynamicFacet\";\n\ninterface SearchHierarchyDynamicTreeNodeProperties extends TreeNodeProperties {\n    count: number;\n    facet: SearchHierarchyDynamicFacet;\n}\n\nexport default class SearchHierarchyDynamicTreeNode extends TreeNode {\n    count: number;\n    selected: boolean;\n    partiallySelected: boolean;\n    hasFilter: boolean;\n    constructor(props: SearchHierarchyDynamicTreeNodeProperties) {\n        super(props);\n        this.count = props.count;\n        this.selected = false;\n        this.partiallySelected = false;\n        this.hasFilter = false;\n        this.getData().facet = props.facet;\n    }\n\n    /*wait() {\n        return new Promise((resolve) => {\n            setTimeout(resolve, 1000);\n        });\n    }*/\n\n    async fetchChildTreeNodesImpl(): Promise<Array<SearchHierarchyDynamicTreeNode>> {\n        const resultChildNodes: Array<SearchHierarchyDynamicTreeNode> = [];\n        // assemble filter by removing attribute conditions of \"own\" facet attribute\n        // (we want to show all children independend on the selection done in the \"own\" facet)\n        const facet = this.getData().facet as SearchHierarchyDynamicFacet;\n        const filter = this.getData().facet.filter.clone();\n        filter.rootCondition.removeAttributeConditions(facet.attributeId);\n        // fetch sina result set\n        const resultSet = (await facet.sina\n            .createHierarchyQuery({\n                attributeId: facet.attributeId,\n                nodeId: this.id,\n                filter: filter,\n                nlq: facet?.model?.isNlqActive(),\n            })\n            .getResultSetAsync()) as HierarchyResultSet;\n        if (resultSet.hasErrors()) {\n            const facet = this.getData().facet as SearchHierarchyDynamicFacet;\n            resultSet.getErrors().forEach((error) => facet.model.errorHandler.onError(error));\n        }\n        if (!resultSet?.node?.childNodes) {\n            return resultChildNodes;\n        }\n        const treeNodeFactory = this.getTreeNodeFactory() as TreeNodeFactory<\n            SearchHierarchyDynamicTreeNode,\n            typeof SearchHierarchyDynamicTreeNode\n        >;\n        for (const childNode of resultSet.node.childNodes) {\n            resultChildNodes.push(\n                treeNodeFactory.createTreeNode({\n                    id: childNode.id,\n                    label: childNode.label,\n                    count: childNode.count,\n                    facet: this.getData().facet,\n                    expandable: childNode.hasChildren,\n                })\n            );\n        }\n        (this.getData().facet as SearchHierarchyDynamicFacet).updateStructureTree(resultSet.node);\n        return resultChildNodes;\n    }\n\n    async setExpanded(expanded: boolean, updateUI?: boolean) {\n        await super.setExpanded(expanded, false);\n        this.getData().facet.mixinFilterNodes();\n        if (updateUI) {\n            this.getTreeNodeFactory().updateUI();\n        }\n    }\n\n    toggleFilter(): void {\n        if (this.selected) {\n            if (this.partiallySelected) {\n                // 1. checkbox with square\n                this.setFilter(true);\n                this.visitParentNodesRecursively(function (node) {\n                    node.setFilter(false);\n                });\n                this.visitChildNodesRecursively(function (node) {\n                    node.setFilter(false);\n                });\n            } else {\n                // 2. selected checkbox\n                this.setFilter(false);\n            }\n        } else {\n            // 3. not selected checkbox\n            this.setFilter(true);\n            this.visitParentNodesRecursively(function (node) {\n                node.setFilter(false);\n            });\n        }\n        const facet = this.getData().facet as SearchHierarchyDynamicFacet;\n        if (facet.isShowMoreDialog) {\n            facet.mixinFilterNodes();\n            facet.treeNodeFactory.updateUI();\n        } else {\n            facet.activateFilters();\n        }\n    }\n\n    setFilter(set: boolean): void {\n        const facet = this.getData().facet as SearchHierarchyDynamicFacet;\n        const filterCondition = facet.sina.createSimpleCondition({\n            operator: facet.sina.ComparisonOperator.DescendantOf,\n            attribute: facet.attributeId,\n            attributeLabel: facet.title,\n            value: this.id,\n            valueLabel: this.label,\n        });\n        if (set) {\n            facet.filter.autoInsertCondition(filterCondition);\n            facet.model.setProperty(\"/facetDialogOverallCounter\", true);\n        } else {\n            facet.filter.autoRemoveCondition(filterCondition);\n            // TODO: this if condition works for disable reset button in facet dialog, but could be improved\n            if (facet.model[\"aFilters\"]?.length === 1 && facet.filterCount === 1) {\n                facet.model.setProperty(\"/facetDialogOverallCounter\", false);\n            }\n        }\n        if (facet.handleSetFilter) {\n            facet.handleSetFilter(this, set, filterCondition);\n        }\n    }\n}\n"],"mappings":"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","ignoreList":[]}