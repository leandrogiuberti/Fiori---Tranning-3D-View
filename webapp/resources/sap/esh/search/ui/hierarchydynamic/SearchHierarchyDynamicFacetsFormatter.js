/*!
 * SAPUI5
 * Copyright (c) 2025 SAP SE or an SAP affiliate company. All rights reserved.
 * 
 */
sap.ui.define(["../sinaNexTS/sina/HierarchyDisplayType","./SearchHierarchyDynamicFacet"],function(t,e){"use strict";function a(t){return t&&t.__esModule&&typeof t.default!=="undefined"?t.default:t}const r=t["HierarchyDisplayType"];const i=a(e);class o{testCounter;facetMap;facetFromMetadataMap;model;constructor(t){this.testCounter=0;this.facetMap={};this.facetFromMetadataMap={};this.model=t}getFacetAttributes(t){const e=[];for(let a=0;a<t.facets.length;++a){const r=t.facets[a];if(r.type!==t.sina.FacetType.Hierarchy){continue}if(!r["node"]){continue}const i=r.query.attributeId;if(e.indexOf(i)>=0){continue}e.push(i)}const a=t.query.filter.rootCondition.getAttributes();for(let r=0;r<a.length;++r){const i=a[r];const o=t.query.filter.dataSource.getAttributeMetadata(i);if(!(o.isHierarchy&&o.usage&&(o.usage.Facet&&typeof o.usage.Facet.displayOrder==="number"||o.usage.AdvancedSearch&&typeof o.usage.AdvancedSearch.displayOrder==="number"))){continue}if(e.indexOf(i)>=0){continue}e.push(i)}return e}getFacetFromResultSet(t,e){for(let a=0;a<t.facets.length;++a){const r=t.facets[a];if(e===r.query.attributeId){return r}}}async getFacet(t,e,a){const r=t.query.filter.dataSource.getAttributeMetadata(a);let o=this.facetMap[a];if(!o){o=new i({model:e,sina:t.sina,dataSource:t.query.filter.dataSource,attributeId:a,title:r.label,filter:this.model.getProperty("/uiFilter"),modelPathPrefix:"/facets",isShowMoreDialog:false});this.facetMap[a]=o}o.setFilter(this.model.getProperty("/uiFilter"));const s=t.query.filter.rootCondition.containsAttribute(a);const c=o.rootTreeNode&&o.rootTreeNode.hasExpandedChildNode();if(s||c){await o.treeNodeFactory.updateRecursively()}else{const e=this.getFacetFromResultSet(t,a);o.updateFromResultSet(e)}o.updateNodesFromHierarchyNodePaths(t.hierarchyNodePaths);o.mixinFilterNodes();return o}getFacets(t,e){if(!this.model.config.FF_dynamicHierarchyFacets){return Promise.resolve([])}const a=this.getFacetAttributes(t);const r=[];for(let i=0;i<a.length;++i){const o=a[i];const s=this.getFacet(t,e,o);r.push(s)}return Promise.all(r).then(function(t){return Array.from(t)})}destroy(){for(const t in this.facetMap){const e=this.facetMap[t];e.delete()}this.facetMap={};for(const t in this.facetFromMetadataMap){const e=this.facetFromMetadataMap[t];e.delete()}this.facetFromMetadataMap={}}handleDataSourceChanged(){this.destroy()}getFacetFromMetadata(t,e,a){let r=this.facetFromMetadataMap[t];if(r){return r}const o=e.getAttributeMetadata(t);r=new i({model:a,sina:e.sina,dataSource:e,attributeId:t,title:o.label,filter:this.model.getProperty("/uiFilter"),modelPathPrefix:"/facetDialog",isShowMoreDialog:true});this.facetFromMetadataMap[t]=r;return r}getFacetsFromMetadata(t,e){const a=[];if(!e.config.FF_dynamicHierarchyFacetsInShowMore){return a}for(const i of t.attributesMetadata){if(i.isHierarchy&&i.hierarchyDisplayType===r.DynamicHierarchyFacet){a.push(this.getFacetFromMetadata(i.id,t,e))}}return a}}return o});
//# sourceMappingURL=SearchHierarchyDynamicFacetsFormatter.js.map