{"version":3,"file":"SearchUrlParser.js","names":["sap","ui","define","__SearchUrlParserInav2","SearchHelper","__i18n","MessageBox","__ErrorHandler","core","_interopRequireDefault","obj","__esModule","default","SearchUrlParserInav2","i18n","ErrorHandler","SearchUrlParser","model","urlParserInav2","errorHandler","constructor","options","this","getInstance","parse","fireQuery","config","isSearchUrl","getHashFromUrl","Promise","resolve","undefined","e","onError","hasher","hasChanged","initAsync","sinaNext","oParametersLowerCased","getUrlParameters","isEmptyObject","datasource","searchterm","isJson","parseUrlParameters","parseSearchUrlParameters","parseSimplifiedUrlParameters","setProperty","calculatePlaceholder","calculateSearchButtonStatus","fireSearchQuery","deserialization","data","indexOf","top","parseInt","setTop","filter","createFilter","setSearchTerm","dataSource","getDataSource","allDataSource","setDataSource","orderby","sortorder","orderBy","sortOrder","setOrderBy","resetOrderBy","filterJson","JSON","parseFilterFromJson","show","getText","toString","icon","Icon","ERROR","title","actions","Action","OK","styleClass"],"sources":["SearchUrlParser.ts"],"sourcesContent":["/*!\n * SAPUI5\n * Copyright (c) 2025 SAP SE or an SAP affiliate company. All rights reserved.\n * \n */\nimport SearchModel from \"sap/esh/search/ui/SearchModel\";\nimport SearchUrlParserInav2 from \"./SearchUrlParserInav2\";\nimport * as SearchHelper from \"./SearchHelper\";\nimport i18n from \"./i18n\";\nimport MessageBox from \"sap/m/MessageBox\";\nimport { OrderBy, UrlParameters } from \"./SearchModelTypes\";\nimport ErrorHandler from \"./error/ErrorHandler\";\nimport * as core from \"./sinaNexTS/core/core\";\n\nexport interface SearchUrlParserOptions {\n    model: SearchModel;\n    urlParserInav2?: SearchUrlParserInav2;\n}\nexport default class SearchUrlParser {\n    private model: SearchModel;\n    private urlParserInav2: SearchUrlParserInav2;\n    private errorHandler: ErrorHandler;\n\n    constructor(options: SearchUrlParserOptions) {\n        this.model = options.model;\n        this.urlParserInav2 = new SearchUrlParserInav2(options);\n        this.errorHandler = ErrorHandler.getInstance();\n    }\n\n    public async parse(fireQuery = true): Promise<void> {\n        // ignore url hash change which if no search application\n        try {\n            if (!this.model.config.isSearchUrl(SearchHelper.getHashFromUrl())) {\n                return Promise.resolve(undefined);\n            }\n        } catch (e) {\n            this.errorHandler.onError(e);\n            return Promise.resolve(undefined);\n        }\n\n        // check if hash differs from old hash. if not -> return\n        if (!SearchHelper.hasher.hasChanged()) {\n            return Promise.resolve(undefined);\n        }\n\n        // ensure model is initialized\n        await this.model.initAsync();\n\n        // without sina -> do nothing\n        if (!this.model.sinaNext) {\n            return;\n        }\n\n        // parse url parameters\n        let oParametersLowerCased = SearchHelper.getUrlParameters();\n        if (core.isEmptyObject(oParametersLowerCased)) {\n            return undefined;\n        }\n\n        // handle old sina format\n        if (oParametersLowerCased.datasource || oParametersLowerCased.searchterm) {\n            if (!oParametersLowerCased.datasource || this.isJson(oParametersLowerCased.datasource)) {\n                return this.urlParserInav2.parseUrlParameters(oParametersLowerCased);\n            }\n        }\n\n        // parameter modification exit\n        try {\n            oParametersLowerCased = this.model.config.parseSearchUrlParameters(oParametersLowerCased);\n        } catch (e) {\n            this.errorHandler.onError(e);\n            return;\n        }\n\n        if (\n            oParametersLowerCased.datasource &&\n            !this.isJson(oParametersLowerCased.datasource) &&\n            oParametersLowerCased.searchterm\n        ) {\n            // parse simplified url parameters\n            this.parseSimplifiedUrlParameters(oParametersLowerCased);\n        } else {\n            // parse new sinaNext format\n            this.parseUrlParameters(oParametersLowerCased);\n        }\n\n        // update placeholder in case back button is clicked.\n        this.model.setProperty(\"/searchTermPlaceholder\", this.model.calculatePlaceholder());\n\n        // calculate search button status\n        this.model.calculateSearchButtonStatus();\n\n        // fire query\n        if (fireQuery) {\n            this.model.fireSearchQuery({ deserialization: true });\n        }\n    }\n\n    private isJson(data: string): boolean {\n        return data.indexOf(\"{\") >= 0 && data.indexOf(\"}\") >= 0;\n    }\n\n    private parseSimplifiedUrlParameters(oParametersLowerCased: {\n        filter?: string;\n        datasource?: string;\n        top?: string;\n        searchterm?: string;\n    }): void {\n        // top\n        if (oParametersLowerCased.top) {\n            const top = parseInt(oParametersLowerCased.top, 10);\n            this.model.setTop(top, false);\n        }\n\n        // search term\n        const filter = this.model.sinaNext.createFilter();\n        filter.setSearchTerm(oParametersLowerCased.searchterm);\n\n        // datasource\n        let dataSource = this.model.sinaNext.getDataSource(oParametersLowerCased.datasource);\n        if (!dataSource) {\n            dataSource = this.model.sinaNext.allDataSource;\n        }\n        filter.setDataSource(dataSource);\n\n        // update model\n        this.model.setProperty(\"/uiFilter\", filter);\n        this.model.setDataSource(filter.dataSource, false, false); // explicitely updata datasource (for categories: update ds list in model)\n    }\n\n    private parseUrlParameters(oParametersLowerCased: UrlParameters): void {\n        // top\n        if (oParametersLowerCased.top) {\n            const top = parseInt(oParametersLowerCased.top, 10);\n            this.model.setTop(top, false);\n        }\n\n        // order by\n        if (oParametersLowerCased.orderby && oParametersLowerCased.sortorder) {\n            const orderBy: OrderBy = {\n                orderBy: oParametersLowerCased.orderby,\n                sortOrder: oParametersLowerCased.sortorder,\n            };\n            this.model.setOrderBy(orderBy, false);\n        } else {\n            this.model.resetOrderBy(false);\n        }\n\n        // filter conditions\n        let filter;\n        if (oParametersLowerCased.filter) {\n            try {\n                const filterJson = JSON.parse(oParametersLowerCased.filter);\n                filter = this.model.sinaNext.parseFilterFromJson(filterJson);\n                this.model.setProperty(\"/uiFilter\", filter);\n                this.model.setDataSource(filter.dataSource, false, false); // explicitely updata datasource (for categories: update ds list in model)\n            } catch (e) {\n                // no filter taken over from url + send error message\n                MessageBox.show(i18n.getText(\"searchUrlParsingErrorLong\") + \"\\n(\" + e.toString() + \")\", {\n                    icon: MessageBox.Icon.ERROR,\n                    title: i18n.getText(\"searchUrlParsingError\"),\n                    actions: [MessageBox.Action.OK],\n                    styleClass: \"sapUshellSearchMessageBox\", // selector for closePopovers\n                });\n            }\n        }\n    }\n}\n"],"mappings":"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","ignoreList":[]}