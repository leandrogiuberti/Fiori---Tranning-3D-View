{"version":3,"file":"SearchPrefsModel.js","names":["sap","ui","define","__i18n","JSONModel","SearchModel","___personalization_PersonalizationKeys","_interopRequireDefault","obj","__esModule","default","i18n","PersonalizationKeys","SearchPrefsModel","searchModel","initializePromise","userCategory","userCategoryManager","configuration","asyncInit","this","getModelSingleton","initAsync","config","searchBusinessObjects","setProperty","initSearchPersonalization","initMyFavorites","initNlq","sinaNext","provider","id","getConfigurationAsync","isPersonalizedSearchEditable","personalizedSearch","isMyFavoritesAvailable","initSubDataSources","reload","newDS","getUserCategoryManager","then","getCategory","dataSources","filter","x","type","DataSourceType","BusinessObject","appDataSource","forEach","unshift","label","labelPlural","selected","isIncludeApps","undefined","push","hasSubDataSource","undefinedSubDataSources","getUndefinedSubDataSourceIds","reverse","undefinedSubDataSource","getText","isFavActive","getNumberSubDataSources","getNumberSelectedSubDataSources","isNlqAreaVisible","aiNlq","capabilities","nlq","nlqActive","getPersonalizationStorageInstance","getItem","nlqEnabledInfoOnDataSource","nlqDataSources","ds","saveNlq","setItem","getProperty","save","calculateIsNlqActive","length","saveSubDataSources","subDataSources","setIncludeApps","setFavActive","clearSubDataSources","clearUndefinedSubDataSourceIds","subDataSource","sinaSubDataSource","sina","getDataSource","addSubDataSource","addUndefinedSubDataSourceId","shortStatus","isPersonalizedSearchActive","isSearchPrefsActive","isMultiProvider","savePreferences","setPersonalizedSearch","saveAsync","cancelPreferences","resetProfile","resetPersonalizedSearchDataAsync"],"sources":["SearchPrefsModel.ts"],"sourcesContent":["/*!\n * SAPUI5\n * Copyright (c) 2025 SAP SE or an SAP affiliate company. All rights reserved.\n * \n */\nimport i18n from \"../i18n\";\nimport JSONModel from \"sap/ui/model/json/JSONModel\";\nimport SearchModel from \"sap/esh/search/ui/SearchModel\";\nimport { UserCategoryDataSource } from \"../sinaNexTS/sina/UserCategoryDataSource\";\nimport UserCategoryManager from \"../usercategories/UserCategoryManager\";\nimport { Configuration } from \"../sinaNexTS/sina/Configuration\";\nimport { PersonalizationKeys } from \"../personalization/PersonalizationKeys\";\n\n// model class for search preferences view\n// =======================================================================\n\nexport default class SearchPrefsModel extends JSONModel {\n    private searchModel: SearchModel;\n    private initializePromise: Promise<void>;\n    private userCategory: UserCategoryDataSource;\n    private userCategoryManager: UserCategoryManager;\n    private configuration: Configuration;\n\n    //const path = \"sap.esh.search.ui.userpref.SearchPrefsModel\";\n    asyncInit(): Promise<void> {\n        // check cache\n        if (this.initializePromise) {\n            return this.initializePromise;\n        }\n        this.initializePromise = (async () => {\n            // get search model\n            this.searchModel = SearchModel.getModelSingleton({}, \"flp\") as SearchModel;\n\n            // ensure that search model is initialized\n            await this.searchModel.initAsync();\n\n            // if bo search is disabled -> disable search prefs + return\n            if (!this.searchModel.config.searchBusinessObjects) {\n                this.setProperty(\"/isSearchPrefsActive\", false);\n                this.setProperty(\"/isPersonalizedSearchEditable\", false);\n                this.setProperty(\"/personalizedSearch\", false);\n                this.setProperty(\"/resetButtonWasClicked\", false);\n                return;\n            }\n\n            // activate search entry\n            this.setProperty(\"/isSearchPrefsActive\", true);\n\n            // init subareas\n            await this.initSearchPersonalization();\n            await this.initMyFavorites();\n            await this.initNlq();\n        })();\n        return this.initializePromise;\n    }\n\n    async initSearchPersonalization(): Promise<void> {\n        const sinaNext = this.searchModel.sinaNext;\n        // set property for visibility of Personalized Search area (oPersSearchVBox)\n        // not visible in case of cross system search\n        this.setProperty(\"/isPersonalizedSearchAreaVisible\", sinaNext.provider.id === \"multi\" ? false : true);\n        this.configuration = await sinaNext.getConfigurationAsync();\n        this.setProperty(\"/isPersonalizedSearchEditable\", this.configuration.isPersonalizedSearchEditable);\n        this.setProperty(\"/personalizedSearch\", this.configuration.personalizedSearch);\n        this.setProperty(\"/resetButtonWasClicked\", false);\n    }\n\n    async initMyFavorites(): Promise<void> {\n        this.setProperty(\"/isMyFavoritesAvailable\", this.searchModel.isMyFavoritesAvailable());\n        if (this.searchModel.isMyFavoritesAvailable()) {\n            this.initSubDataSources();\n        }\n    }\n\n    reload(): Promise<void> {\n        return this.asyncInit();\n    }\n\n    initSubDataSources(): void {\n        const newDS = [];\n\n        this.searchModel.getUserCategoryManager().then((userCategoryManager) => {\n            this.userCategoryManager = userCategoryManager;\n            this.userCategory = userCategoryManager.getCategory(\"MyFavorites\");\n            // get datasources from sina\n            const dataSources = this.searchModel.sinaNext.dataSources;\n\n            dataSources\n                .filter(\n                    (x) =>\n                        (x.type === this.searchModel.sinaNext.DataSourceType.BusinessObject ||\n                            x === this.searchModel.appDataSource) &&\n                        x.id !== \"CD$ALL~ESH_TRANSACTION~\"\n                )\n                .forEach((x) => {\n                    if (x === this.searchModel.appDataSource) {\n                        newDS.unshift({\n                            id: x.id,\n                            label: x.labelPlural,\n                            selected: this.userCategory.isIncludeApps(),\n                            undefined: false,\n                        });\n                    } else {\n                        newDS.push({\n                            id: x.id,\n                            label: x.labelPlural,\n                            selected: this.userCategory.hasSubDataSource(x.id),\n                            undefined: false,\n                        });\n                    }\n                });\n\n            // add undefinedSubDataSources to the top of the list\n            const undefinedSubDataSources = this.userCategory.getUndefinedSubDataSourceIds().reverse();\n            for (const undefinedSubDataSource of undefinedSubDataSources) {\n                newDS.unshift({\n                    id: undefinedSubDataSource,\n                    label: undefinedSubDataSource + \" \" + i18n.getText(\"sp.connectorNotExists\"),\n                    selected: true,\n                    undefined: true,\n                });\n            }\n\n            this.setProperty(\"/favActive\", this.userCategoryManager.isFavActive());\n\n            this.setProperty(\"/subDataSources\", newDS);\n            this.setProperty(\"/dataSourceCount\", this.getNumberSubDataSources());\n            this.setProperty(\"/selectedDataSourceCount\", this.getNumberSelectedSubDataSources());\n        });\n    }\n\n    async initNlq(): Promise<void> {\n        // visibility of area\n        const isNlqAreaVisible = !!(\n            this.searchModel.config.aiNlq && this.searchModel.sinaNext.capabilities.nlq\n        );\n        this.setProperty(\"/isNlqAreaVisible\", isNlqAreaVisible);\n        if (!isNlqAreaVisible) {\n            return;\n        }\n\n        // nlq active checkbox\n        const nlqActive = this.searchModel\n            .getPersonalizationStorageInstance()\n            .getItem(PersonalizationKeys.nlqActive);\n        this.setProperty(\"/nlqActive\", nlqActive);\n\n        // nlq data sources list\n        if (this.searchModel.sinaNext.capabilities.nlqEnabledInfoOnDataSource) {\n            const nlqDataSources = this.searchModel.sinaNext.dataSources.filter((ds) => ds.nlq);\n            this.setProperty(\"/nlqDataSources\", nlqDataSources);\n            this.setProperty(\"/nlqEnabledInfoOnDataSource\", true);\n        } else {\n            this.setProperty(\"/nlqDataSources\", []);\n            this.setProperty(\"/nlqEnabledInfoOnDataSource\", false);\n        }\n    }\n\n    async saveNlq(): Promise<void> {\n        this.searchModel\n            .getPersonalizationStorageInstance()\n            .setItem(PersonalizationKeys.nlqActive, this.getProperty(\"/nlqActive\"));\n        await this.searchModel.getPersonalizationStorageInstance().save();\n        this.searchModel.calculateIsNlqActive();\n    }\n\n    getNumberSubDataSources(): number {\n        return this.getProperty(\"/subDataSources\").length;\n    }\n\n    getNumberSelectedSubDataSources(): number {\n        return this.getProperty(\"/subDataSources\").filter((x) => x.selected).length; //x.selected === true)\n    }\n\n    saveSubDataSources(): void {\n        const subDataSources = this.getProperty(\"/subDataSources\");\n        this.userCategory.setIncludeApps(false);\n        this.userCategoryManager.setFavActive(this.getProperty(\"/favActive\"));\n        this.userCategory.clearSubDataSources();\n        this.userCategory.clearUndefinedSubDataSourceIds();\n\n        for (const subDataSource of subDataSources) {\n            if (subDataSource.selected === true) {\n                if (subDataSource.id === this.searchModel.appDataSource.id) {\n                    this.userCategory.setIncludeApps(true);\n                } else {\n                    const sinaSubDataSource = this.userCategoryManager.sina.getDataSource(subDataSource.id);\n                    if (sinaSubDataSource) {\n                        this.userCategory.addSubDataSource(sinaSubDataSource);\n                    } else {\n                        this.userCategory.addUndefinedSubDataSourceId(subDataSource.id);\n                    }\n                }\n            }\n        }\n        this.userCategoryManager.save();\n    }\n\n    //not used in future -> delete\n    shortStatus(): Promise<string> {\n        return this.asyncInit().then(() => {\n            return this.getProperty(\"/personalizedSearch\") ? i18n.getText(\"sp.on\") : i18n.getText(\"sp.off\");\n        });\n    }\n\n    isPersonalizedSearchActive(): Promise<boolean> {\n        return this.asyncInit().then(() => {\n            return this.getProperty(\"/personalizedSearch\");\n        });\n    }\n\n    isSearchPrefsActive(): Promise<boolean> {\n        return this.asyncInit().then(() => {\n            return this.getProperty(\"/isSearchPrefsActive\");\n        });\n    }\n\n    isMultiProvider(): Promise<boolean> {\n        return this.asyncInit().then(() => {\n            return this.searchModel.sinaNext.provider.id === \"multi\";\n        });\n    }\n\n    async savePreferences() {\n        // nlq\n        await this.saveNlq();\n        // my favorites\n        if (this.searchModel.isMyFavoritesAvailable()) {\n            this.saveSubDataSources();\n        }\n        // search personaization\n        if (this.configuration.isPersonalizedSearchEditable) {\n            this.configuration.setPersonalizedSearch(this.getProperty(\"/personalizedSearch\"));\n            await this.configuration.saveAsync();\n        }\n        this.setProperty(\"/resetButtonWasClicked\", false);\n    }\n\n    cancelPreferences(): void {\n        this.setProperty(\"/personalizedSearch\", this.configuration.personalizedSearch);\n        this.setProperty(\"/resetButtonWasClicked\", false);\n        this.initNlq();\n    }\n\n    resetProfile(): Promise<void> {\n        return this.configuration.resetPersonalizedSearchDataAsync().then(() => {\n            this.setProperty(\"/resetButtonWasClicked\", true);\n        });\n    }\n}\n"],"mappings":"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","ignoreList":[]}