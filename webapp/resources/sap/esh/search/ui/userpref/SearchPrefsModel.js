/*!
 * SAPUI5
 * Copyright (c) 2025 SAP SE or an SAP affiliate company. All rights reserved.
 * 
 */
sap.ui.define(["../i18n","sap/ui/model/json/JSONModel","sap/esh/search/ui/SearchModel","../personalization/PersonalizationKeys"],function(e,t,s,i){"use strict";function a(e){return e&&e.__esModule&&typeof e.default!=="undefined"?e.default:e}const r=a(e);const o=i["PersonalizationKeys"];class n extends t{searchModel;initializePromise;userCategory;userCategoryManager;configuration;asyncInit(){if(this.initializePromise){return this.initializePromise}this.initializePromise=(async()=>{this.searchModel=s.getModelSingleton({},"flp");await this.searchModel.initAsync();if(!this.searchModel.config.searchBusinessObjects){this.setProperty("/isSearchPrefsActive",false);this.setProperty("/isPersonalizedSearchEditable",false);this.setProperty("/personalizedSearch",false);this.setProperty("/resetButtonWasClicked",false);return}this.setProperty("/isSearchPrefsActive",true);await this.initSearchPersonalization();await this.initMyFavorites();await this.initNlq()})();return this.initializePromise}async initSearchPersonalization(){const e=this.searchModel.sinaNext;this.setProperty("/isPersonalizedSearchAreaVisible",e.provider.id==="multi"?false:true);this.configuration=await e.getConfigurationAsync();this.setProperty("/isPersonalizedSearchEditable",this.configuration.isPersonalizedSearchEditable);this.setProperty("/personalizedSearch",this.configuration.personalizedSearch);this.setProperty("/resetButtonWasClicked",false)}async initMyFavorites(){this.setProperty("/isMyFavoritesAvailable",this.searchModel.isMyFavoritesAvailable());if(this.searchModel.isMyFavoritesAvailable()){this.initSubDataSources()}}reload(){return this.asyncInit()}initSubDataSources(){const e=[];this.searchModel.getUserCategoryManager().then(t=>{this.userCategoryManager=t;this.userCategory=t.getCategory("MyFavorites");const s=this.searchModel.sinaNext.dataSources;s.filter(e=>(e.type===this.searchModel.sinaNext.DataSourceType.BusinessObject||e===this.searchModel.appDataSource)&&e.id!=="CD$ALL~ESH_TRANSACTION~").forEach(t=>{if(t===this.searchModel.appDataSource){e.unshift({id:t.id,label:t.labelPlural,selected:this.userCategory.isIncludeApps(),undefined:false})}else{e.push({id:t.id,label:t.labelPlural,selected:this.userCategory.hasSubDataSource(t.id),undefined:false})}});const i=this.userCategory.getUndefinedSubDataSourceIds().reverse();for(const t of i){e.unshift({id:t,label:t+" "+r.getText("sp.connectorNotExists"),selected:true,undefined:true})}this.setProperty("/favActive",this.userCategoryManager.isFavActive());this.setProperty("/subDataSources",e);this.setProperty("/dataSourceCount",this.getNumberSubDataSources());this.setProperty("/selectedDataSourceCount",this.getNumberSelectedSubDataSources())})}async initNlq(){const e=!!(this.searchModel.config.aiNlq&&this.searchModel.sinaNext.capabilities.nlq);this.setProperty("/isNlqAreaVisible",e);if(!e){return}const t=this.searchModel.getPersonalizationStorageInstance().getItem(o.nlqActive);this.setProperty("/nlqActive",t);if(this.searchModel.sinaNext.capabilities.nlqEnabledInfoOnDataSource){const e=this.searchModel.sinaNext.dataSources.filter(e=>e.nlq);this.setProperty("/nlqDataSources",e);this.setProperty("/nlqEnabledInfoOnDataSource",true)}else{this.setProperty("/nlqDataSources",[]);this.setProperty("/nlqEnabledInfoOnDataSource",false)}}async saveNlq(){this.searchModel.getPersonalizationStorageInstance().setItem(o.nlqActive,this.getProperty("/nlqActive"));await this.searchModel.getPersonalizationStorageInstance().save();this.searchModel.calculateIsNlqActive()}getNumberSubDataSources(){return this.getProperty("/subDataSources").length}getNumberSelectedSubDataSources(){return this.getProperty("/subDataSources").filter(e=>e.selected).length}saveSubDataSources(){const e=this.getProperty("/subDataSources");this.userCategory.setIncludeApps(false);this.userCategoryManager.setFavActive(this.getProperty("/favActive"));this.userCategory.clearSubDataSources();this.userCategory.clearUndefinedSubDataSourceIds();for(const t of e){if(t.selected===true){if(t.id===this.searchModel.appDataSource.id){this.userCategory.setIncludeApps(true)}else{const e=this.userCategoryManager.sina.getDataSource(t.id);if(e){this.userCategory.addSubDataSource(e)}else{this.userCategory.addUndefinedSubDataSourceId(t.id)}}}}this.userCategoryManager.save()}shortStatus(){return this.asyncInit().then(()=>this.getProperty("/personalizedSearch")?r.getText("sp.on"):r.getText("sp.off"))}isPersonalizedSearchActive(){return this.asyncInit().then(()=>this.getProperty("/personalizedSearch"))}isSearchPrefsActive(){return this.asyncInit().then(()=>this.getProperty("/isSearchPrefsActive"))}isMultiProvider(){return this.asyncInit().then(()=>this.searchModel.sinaNext.provider.id==="multi")}async savePreferences(){await this.saveNlq();if(this.searchModel.isMyFavoritesAvailable()){this.saveSubDataSources()}if(this.configuration.isPersonalizedSearchEditable){this.configuration.setPersonalizedSearch(this.getProperty("/personalizedSearch"));await this.configuration.saveAsync()}this.setProperty("/resetButtonWasClicked",false)}cancelPreferences(){this.setProperty("/personalizedSearch",this.configuration.personalizedSearch);this.setProperty("/resetButtonWasClicked",false);this.initNlq()}resetProfile(){return this.configuration.resetPersonalizedSearchDataAsync().then(()=>{this.setProperty("/resetButtonWasClicked",true)})}}return n});
//# sourceMappingURL=SearchPrefsModel.js.map