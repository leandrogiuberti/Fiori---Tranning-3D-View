/*!
 * SAPUI5
 * Copyright (c) 2025 SAP SE or an SAP affiliate company. All rights reserved.
 * 
 */
sap.ui.define(["../i18n","sap/esh/search/ui/SearchHelper","./SuggestionType","sap/ushell/Container"],function(e,t,s,i){"use strict";function o(e){return e&&e.__esModule&&typeof e.default!=="undefined"?e.default:e}const r=o(e);const a=s["Type"];const n=s["SuggestionType"];class l{model;suggestApplications;suggestionHandler;constructor(e){this.model=e.model;this.suggestionHandler=e.suggestionHandler;this.suggestApplications=t.refuseOutdatedRequests(this.suggestApplicationsNotDecorated)}abortSuggestions(){this.suggestApplications.abort()}combineSuggestionsWithIdenticalTitle(e){let t;const s={};for(let i=0;i<e.length;i++){t=e[i];const o=s[t.title+t.subtitle];if(o){if(!o.combinedSuggestionExists){const e={title:"combinedAppSuggestion"+i,subtitle:t.subtitle,sortIndex:o.sortIndex,url:this.model.createSearchNavigationTarget({top:this.model.appTopDefault,filter:this.model.sinaNext.createFilter({dataSource:this.model.appDataSource,searchTerm:t.title}),encodeFilter:false}).targetUrl,label:r.getText("suggestion_in_apps",[t.label]),icon:"sap-icon://search",keywords:"",uiSuggestionType:a.App};const n=r.getText("suggestion_in_apps",[""]);e.label=e.label.replace(n,"<i>"+n+"</i>");s[e.title+e.subtitle]=e;o.combinedSuggestionExists=true}}else{t.sortIndex=i;s[t.title+t.subtitle]=t}}e=[];for(const i in s){if(Object.prototype.hasOwnProperty.call(s,i)){t=s[i];if(!t.combinedSuggestionExists){e.push(t)}}}e.sort(function(e,t){return e.sortIndex-t.sortIndex});return e}addAsterisk4ShowAllApps(e){const t=e.match(/\S+/g);if(t.length>0){let s;const i=[];for(let e=0;e<t.length;e++){s=t[e];if(s&&s.lastIndexOf("*")!==s.length-1){i.push(s+"*")}else{i.push(s)}}e=i.join(" ")}return e}createShowMoreSuggestion(e,t){let s=r.getText("showAllNApps",[e]);s=s.replace(/"/g,"");const i=s;const o="<i>"+s+"</i>";return{title:s,tooltip:i,label:o,dataSource:this.model.appDataSource,labelRaw:this.model.getProperty("/uiFilter/searchTerm"),uiSuggestionType:a.SearchTermData,isShowMoreApps:true,searchTerm:this.model.getProperty("/uiFilter/searchTerm")||"",titleNavigation:this.model.createSearchNavigationTarget({filter:this.model.sinaNext.createFilter({searchTerm:t,dataSource:this.model.appDataSource})}),totalCount:e}}async getSuggestions(e){const t=this.model.getDataSource();const s=this.model.userCategoryManager;const i=s?.isFavActive()&&s?.getCategory("MyFavorites")?.includeApps;if(t!==this.model.allDataSource&&t!==this.model.appDataSource&&!(t===this.model.favDataSource&&i)){return[]}if(e.searchTerm.length<1){return[]}const o=this.model.getProperty("/uiFilter/searchTerm");const r=await this.suggestApplications(o);let l=r.getElements();l=this.combineSuggestionsWithIdenticalTitle(l);let c=[];for(const e of l){const t={...e,uiSuggestionType:a.App,dataSource:this.model.appDataSource,position:n.properties.App.position,key:n.App+e.url+e.icon};c.push(t)}const u=this.suggestionHandler.getSuggestionLimit(a.App);c=c.slice(0,u);if(r.totalResults>u&&t===this.model.appDataSource){c.push(this.createShowMoreSuggestion(r.totalResults,o))}return c}async suggestApplicationsNotDecorated(e){const t=await i.getServiceAsync("Search");return t.queryApplications({searchTerm:e,suggestion:true})}}return l});
//# sourceMappingURL=AppSuggestionProvider.js.map