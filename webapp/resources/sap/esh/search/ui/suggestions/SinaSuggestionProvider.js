/*!
 * SAPUI5
 * Copyright (c) 2025 SAP SE or an SAP affiliate company. All rights reserved.
 * 
 */
sap.ui.define(["../i18n","./SinaBaseSuggestionProvider","./SinaObjectSuggestionFormatter","./SuggestionType","sap/esh/search/ui/SearchHelper","../sinaNexTS/sina/SearchResultSetItemAttribute","sap/ui/Device"],function(e,t,s,i,a,o,r){"use strict";function n(e){return e&&e.__esModule&&typeof e.default!=="undefined"?e.default:e}const g=n(e);const u=n(t);const c=n(s);const h=i["Type"];const S=i["SuggestionType"];const l=o["SearchResultSetItemAttribute"];class d extends u{suggestionLimit;suggestionStartingCharacters;model;sinaObjectSuggestionFormatter;suggestions;firstObjectDataSuggestion;numberSuggestionsByType;suggestionHandler;constructor(e){super(e.sinaNext);this.model=e.model;this.suggestionTypes=e.suggestionTypes;this.suggestionHandler=e.suggestionHandler;this.suggestionLimit=r.system.phone?5:7;this.suggestionStartingCharacters=this.model.config.suggestionStartingCharacters;this.sinaObjectSuggestionFormatter=new c}abortSuggestions(){this.suggestionQuery.abort()}async getSuggestions(e){this.suggestions=[];this.firstObjectDataSuggestion=true;this.numberSuggestionsByType={};for(let e=0;e<S.types.length;++e){const t=S.types[e];this.numberSuggestionsByType[t]=0}const t=e.searchTerm;if(this.suggestionTypes.length===1&&this.suggestionTypes.indexOf(h.SearchTermHistory)>=0&&t.length<1){return[]}if(this.suggestionTypes.length===1&&this.suggestionTypes.indexOf(h.SearchTermData)>=0&&(t.length<this.suggestionStartingCharacters||e.dataSource===this.model.allDataSource)){return[]}if(this.suggestionTypes.length===1&&this.suggestionTypes.indexOf(h.Object)>=0&&t.length<this.suggestionStartingCharacters){return[]}if(this.suggestionTypes.length===1&&this.suggestionTypes.indexOf(h.DataSource)>=0&&this.model.getDataSource()!==this.model.sinaNext.allDataSource&&this.model.getDataSource()!==this.model.favDataSource){return[]}if(this.suggestionTypes.length===1&&this.suggestionTypes.indexOf(h.DataSource)>=0&&t.length<1){return[]}if(this.suggestionTypes.length===1&&this.suggestionTypes.indexOf(h.SearchTermAI)>=0&&!this.model.isNlqActive()){return[]}this.createAllAndAppDsSuggestions();if(!this.model.config.searchBusinessObjects){return Promise.resolve(this.suggestions)}if(this.model.getDataSource()===this.model.appDataSource){return Promise.resolve(this.suggestions)}this.prepareSuggestionQuery(e);const s=await this.suggestionQuery.getResultSetAsync();const i=s.items;this.formatSinaSuggestions(i);return this.suggestions}createAllAndAppDsSuggestions(){if(this.suggestionTypes.indexOf(h.DataSource)<0){return}if(this.model.getDataSource()!==this.model.allDataSource&&this.model.getDataSource()!==this.model.favDataSource){return}const e=[];if(this.model.getDataSource()===this.model.allDataSource){e.unshift(this.model.appDataSource);e.unshift(this.model.allDataSource)}if(this.model.getDataSource()===this.model.favDataSource){if(this.model.favDataSource.includeApps){e.unshift(this.model.appDataSource)}e.unshift(this.model.favDataSource)}const t=this.model.getProperty("/uiFilter/searchTerm");const s=t.replace(/\*/g,"");const i=new a.Tester(s);for(let t=0;t<e.length;++t){const s=e[t];if(s.id===this.model.getDataSource().id){continue}const a=i.test(s.label);if(a.bMatch===true){if(this.isSuggestionLimitReached(h.DataSource)){return}const e={sina:this.sinaNext,label:"<i>"+g.getText("searchInPlaceholder",[""])+"</i> "+a.sHighlightedText,dataSource:s,position:S.properties.DataSource.position,type:this.sinaNext.SuggestionType.DataSource,calculationMode:this.sinaNext.SuggestionCalculationMode.Data,uiSuggestionType:h.DataSource};this.addSuggestion(e)}}}isSuggestionLimitReached(e){const t=this.suggestionHandler.getSuggestionLimit(e);const s=this.numberSuggestionsByType[e];if(s>=t){return true}return false}preFormatSuggestions(e){for(let t=0;t<e.length;++t){const s=e[t];const i=s;i.uiSuggestionType=this.getSuggestionType(s);i.position=S.properties[i.uiSuggestionType].position;this.assembleKey(i);if(i.childSuggestions){this.preFormatSuggestions(i.childSuggestions)}}}assembleKey(e){switch(e.uiSuggestionType){case h.DataSource:e.key=h.DataSource+e.dataSource.id;break;case h.SearchTermData:e.key=h.SearchTermData+e.searchTerm;if(e.dataSource){e.key+=e.dataSource.id}break;case h.SearchTermHistory:e.key=h.SearchTermData+e.searchTerm;if(e.dataSource){e.key+=e.dataSource.id}break;case h.SearchTermAI:e.key=h.SearchTermAI+e.searchTerm;break;case h.Object:{const t=e.object.detailAttributes[0];if(t instanceof l){const s=t.value;e.key=h.Object+s}break}}}formatSinaSuggestions(e){this.preFormatSuggestions(e);for(let t=0;t<e.length;++t){const s=e[t];if(this.isSuggestionLimitReached(s.uiSuggestionType)){continue}switch(s.uiSuggestionType){case h.DataSource:if(this.model.getDataSource()!==this.model.allDataSource&&this.model.getDataSource()!==this.model.favDataSource){continue}this.addSuggestion(s);break;case h.SearchTermData:s.titleNavigation=this.model.createSearchNavigationTarget(s.filter);this.formatSearchTermDataSuggestion(s);break;case h.SearchTermHistory:s.titleNavigation=this.model.createSearchNavigationTarget(s.filter);this.addSuggestion(s);break;case h.SearchTermAI:this.addSuggestion(s);break;case h.Object:case h.Transaction:{const e={...s,dataSource:s.object.dataSource,object:s.object};this.sinaObjectSuggestionFormatter.format(this,e);break}default:break}}return this.suggestions}addSuggestion(e){this.suggestions.push(e);this.numberSuggestionsByType[e.uiSuggestionType]+=1}formatSearchTermDataSuggestion(e){if(this.model.getDataSource()===this.model.allDataSource){if(this.firstObjectDataSuggestion){this.firstObjectDataSuggestion=false;if(e.childSuggestions.length>0){e.label=this.assembleSearchInSuggestionLabel(e);e.grouped=true;this.addSuggestion(e);this.addChildSuggestions(e)}else{this.addSuggestion(e)}}else{this.addSuggestion(e)}}else{this.addSuggestion(e)}}addChildSuggestions(e){for(let t=0;t<Math.min(2,e.childSuggestions.length);++t){if(this.isSuggestionLimitReached(h.SearchTermData)){return}const s=e.childSuggestions[t];s.label=this.assembleSearchInSuggestionLabel(s);s.grouped=true;this.addSuggestion(s)}}assembleSearchInSuggestionLabel(e){return g.getText("resultsIn",["<span>"+e.label+"</span>",e.filter.dataSource.labelPlural])}getSuggestionType(e){switch(e.type){case this.sinaNext.SuggestionType.SearchTerm:if(e.calculationMode===this.sinaNext.SuggestionCalculationMode.History){return h.SearchTermHistory}return h.SearchTermData;case this.sinaNext.SuggestionType.SearchTermAndDataSource:if(e.calculationMode===this.sinaNext.SuggestionCalculationMode.History){return h.SearchTermHistory}return h.SearchTermData;case this.sinaNext.SuggestionType.SearchTermAI:return h.SearchTermAI;case this.sinaNext.SuggestionType.DataSource:return h.DataSource;case this.sinaNext.SuggestionType.Object:return h.Object}}}return d});
//# sourceMappingURL=SinaSuggestionProvider.js.map