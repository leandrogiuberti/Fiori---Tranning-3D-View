{"version":3,"file":"TransactionSuggestionProvider-dbg.js","names":["sap","ui","define","___sinaNexTS_sina_DataSourceType","__SuggestionType","__Formatter","__BackendSystem","__FrontendSystem","Device","Container","_interopRequireDefault","obj","__esModule","default","DataSourceType","SuggestionType","Type","Formatter","BackendSystem","FrontendSystem","TransactionSuggestionProvider","model","suggestionHandler","suggestionLimit","sinaNext","suggestionQuery","transactionsDS","suggestionStartingCharacters","suggestionFormatter","transactionSuggestions","constructor","params","system","phone","createSuggestionQuery","createDataSource","id","label","type","BusinessObject","config","abortSuggestions","abort","getUrl","tCode","tCodeStartUrl","eshBackendSystemInfo","getSystem","equals","getSuggestions","filter","searchBusinessObjects","Promise","resolve","dataSource","getDataSource","userCategoryManager","favoritesIncludeApps","isFavActive","getCategory","includeApps","allDataSource","appDataSource","favDataSource","clone","suggestionTerm","searchTerm","toLowerCase","indexOf","slice","length","prepareSuggestionQuery","resultSet","getResultSetAsync","sinaSuggestions","items","sinaSuggestion","transactionSuggestion","uiSuggestionType","Transaction","position","properties","key","object","attributesMap","TCODE","value","url","icon","TCDTEXT","valueHighlighted","calculationMode","sina","can","getServiceAsync","isSupported","isNavigationSupported","target","shellHash","supported","format","transactionSuggestionLimit","getSuggestionLimit","addSuggestion","push","resetResultSet","setFilter","setDataSource","setTypes","Object","setCalculationModes","SuggestionCalculationMode","Data","setTop"],"sources":["TransactionSuggestionProvider.ts"],"sourcesContent":["/*!\n * SAPUI5\n * Copyright (c) 2025 SAP SE or an SAP affiliate company. All rights reserved.\n * \n */\nimport SearchModel from \"sap/esh/search/ui/SearchModel\";\nimport { DataSource } from \"../sinaNexTS/sina/DataSource\";\nimport { DataSourceType } from \"../sinaNexTS/sina/DataSourceType\";\nimport { Filter } from \"../sinaNexTS/sina/Filter\";\nimport { Sina } from \"../sinaNexTS/sina/Sina\";\nimport { SuggestionQuery } from \"../sinaNexTS/sina/SuggestionQuery\";\nimport { SuggestionProvider } from \"./SuggestionProvider\";\nimport SuggestionType, { UISinaObjectSuggestion } from \"./SuggestionType\";\nimport { Type } from \"./SuggestionType\";\nimport CrossApplicationNavigation from \"sap/ushell/services/CrossApplicationNavigation\";\nimport SuggestionHandler from \"./SuggestionHandler\";\nimport { ObjectSuggestion } from \"../sinaNexTS/sina/ObjectSuggestion\";\nimport Formatter from \"./SinaObjectSuggestionFormatter\";\nimport BackendSystem from \"../flp/BackendSystem\";\nimport FrontendSystem from \"../flp/FrontendSystem\";\nimport Device from \"sap/ui/Device\";\nimport Container from \"sap/ushell/Container\";\n\nexport interface TransactionSuggestion extends UISinaObjectSuggestion {\n    searchTerm: string;\n    uiSuggestionType: Type.Transaction;\n    position: number;\n    key: string;\n    url: string;\n    icon: \"sap-icon://generate-shortcut\";\n}\n\nexport default class TransactionSuggestionProvider implements SuggestionProvider {\n    readonly model: SearchModel;\n    private suggestionHandler: SuggestionHandler;\n    private suggestionLimit: number;\n    private sinaNext: Sina;\n    private suggestionQuery: SuggestionQuery;\n    private transactionsDS: DataSource;\n    private suggestionStartingCharacters: number;\n    private suggestionFormatter = new Formatter();\n    public transactionSuggestions: Array<TransactionSuggestion> = [];\n\n    constructor(params: { model: SearchModel; suggestionHandler: SuggestionHandler }) {\n        this.model = params.model;\n        this.suggestionHandler = params.suggestionHandler;\n        this.suggestionLimit = Device.system.phone ? 5 : 7;\n        this.sinaNext = this.model.sinaNext;\n        this.suggestionQuery = this.sinaNext.createSuggestionQuery();\n        this.transactionsDS = this.sinaNext.createDataSource({\n            id: \"CD$ALL~ESH_TRANSACTION~\",\n            label: \"Transactions\",\n            type: DataSourceType.BusinessObject,\n        });\n        this.suggestionStartingCharacters = this.model.config.suggestionStartingCharacters;\n    }\n\n    abortSuggestions(): void {\n        this.suggestionQuery.abort();\n    }\n\n    // openTransactionSuggestion(tcode: string, startInNewWindow: boolean): void {\n    //     const transactionSuggestion = this.suggestionHandler.autoSelectTransactionSuggestion(tcode);\n    //     // const url = \"#Shell-startGUI?sap-ui2-tcode=\" + tcode;\n    //     if (!transactionSuggestion) return;\n    //     if (startInNewWindow) {\n    //         window.open(transactionSuggestion.url, \"_blank\", \"noopener,noreferrer\");\n    //     } else {\n    //         if (window.hasher) {\n    //             window.hasher.setHash(transactionSuggestion.url);\n    //         } else {\n    //             window.location.href = transactionSuggestion.url;\n    //         }\n    //     }\n    // }\n\n    private getUrl(tCode: string): string {\n        let tCodeStartUrl = \"#Shell-startGUI?sap-ui2-tcode=\" + tCode;\n        const eshBackendSystemInfo = BackendSystem.getSystem(this.model);\n        if (eshBackendSystemInfo && !eshBackendSystemInfo.equals(FrontendSystem.getSystem())) {\n            // add sid(XYZ.123) url parameter\n            tCodeStartUrl = `#Shell-startGUI?sap-system=sid(${eshBackendSystemInfo.id})&sap-ui2-tcode=${tCode}`;\n        }\n        return tCodeStartUrl;\n    }\n\n    async getSuggestions(filter: Filter): Promise<Array<TransactionSuggestion>> {\n        // check that BO search is enabled\n        if (!this.model.config.searchBusinessObjects) {\n            return Promise.resolve([]);\n        }\n        const dataSource = this.model.getDataSource();\n        const userCategoryManager = this.model.userCategoryManager;\n        const favoritesIncludeApps =\n            userCategoryManager?.isFavActive() &&\n            userCategoryManager?.getCategory(\"MyFavorites\")?.includeApps;\n        // check that datasource is all, apps or my favorites and my favorites include apps:\n        if (\n            dataSource !== this.model.allDataSource &&\n            dataSource !== this.model.appDataSource &&\n            !(dataSource === this.model.favDataSource && favoritesIncludeApps)\n        ) {\n            return Promise.resolve([]);\n        }\n        filter = filter.clone();\n        let suggestionTerm = filter.searchTerm;\n        if (\n            suggestionTerm.toLowerCase().indexOf(\"/n\") === 0 ||\n            suggestionTerm.toLowerCase().indexOf(\"/o\") === 0\n        ) {\n            suggestionTerm = suggestionTerm.slice(2);\n            filter.searchTerm = suggestionTerm;\n        }\n        this.transactionSuggestions = [];\n\n        if (suggestionTerm.length < this.suggestionStartingCharacters) {\n            return Promise.resolve([]);\n        }\n\n        // prepare sina suggestion query\n        this.prepareSuggestionQuery(filter);\n\n        const resultSet = await this.suggestionQuery.getResultSetAsync();\n        const sinaSuggestions = resultSet.items as Array<ObjectSuggestion>;\n\n        // const inTransactions = i18n.getText(\"suggestion_in_transactions\", [\"\"]);\n\n        // set type, datasource and position\n        for (const sinaSuggestion of sinaSuggestions) {\n            const transactionSuggestion: TransactionSuggestion = {\n                uiSuggestionType: Type.Transaction,\n                dataSource: this.transactionsDS,\n                position: SuggestionType.properties.Transaction.position,\n                key: sinaSuggestion.object.attributesMap.TCODE.value,\n                searchTerm: filter.searchTerm,\n                url: this.getUrl(sinaSuggestion.object.attributesMap.TCODE.value),\n                icon: \"sap-icon://generate-shortcut\",\n                label: sinaSuggestion.object.attributesMap.TCDTEXT.valueHighlighted,\n                type: sinaSuggestion.type,\n                calculationMode: sinaSuggestion.calculationMode,\n                object: sinaSuggestion.object,\n                sina: sinaSuggestion.sina,\n            };\n\n            const can: CrossApplicationNavigation = await Container.getServiceAsync(\n                \"CrossApplicationNavigation\"\n            );\n\n            const isSupported: Array<{\n                supported: boolean;\n            }> = await can.isNavigationSupported([\n                {\n                    target: {\n                        shellHash: transactionSuggestion.url,\n                    },\n                },\n            ]);\n            if (isSupported[0].supported) {\n                this.suggestionFormatter.format(this, transactionSuggestion);\n            }\n        }\n\n        // limit transaction suggestions\n        const transactionSuggestionLimit = this.suggestionHandler.getSuggestionLimit(Type.Transaction);\n        this.transactionSuggestions = this.transactionSuggestions.slice(0, transactionSuggestionLimit);\n\n        return this.transactionSuggestions;\n    }\n\n    addSuggestion(transactionSuggestion: TransactionSuggestion): void {\n        this.transactionSuggestions.push(transactionSuggestion);\n    }\n\n    private prepareSuggestionQuery(filter: Filter): void {\n        this.suggestionQuery.resetResultSet();\n        this.suggestionQuery.setFilter(filter);\n        this.suggestionQuery.setDataSource(this.transactionsDS);\n        this.suggestionQuery.setTypes([this.sinaNext.SuggestionType.Object]);\n        this.suggestionQuery.setCalculationModes([this.sinaNext.SuggestionCalculationMode.Data]);\n        this.suggestionQuery.setTop(10);\n    }\n}\n"],"mappings":"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","ignoreList":[]}