{"version":3,"file":"SearchUrlParser-dbg.js","names":["sap","ui","define","__SearchUrlParserInav2","SearchHelper","__i18n","MessageBox","__ErrorHandler","core","_interopRequireDefault","obj","__esModule","default","SearchUrlParserInav2","i18n","ErrorHandler","SearchUrlParser","model","urlParserInav2","errorHandler","constructor","options","getInstance","parse","fireQuery","config","isSearchUrl","getHashFromUrl","Promise","resolve","undefined","e","onError","hasher","hasChanged","initAsync","sinaNext","oParametersLowerCased","getUrlParameters","isEmptyObject","datasource","searchterm","isJson","parseUrlParameters","parseSearchUrlParameters","parseSimplifiedUrlParameters","setProperty","calculatePlaceholder","calculateSearchButtonStatus","fireSearchQuery","deserialization","data","indexOf","top","parseInt","setTop","filter","createFilter","setSearchTerm","dataSource","getDataSource","allDataSource","setDataSource","orderby","sortorder","orderBy","sortOrder","setOrderBy","resetOrderBy","filterJson","JSON","parseFilterFromJson","show","getText","toString","icon","Icon","ERROR","title","actions","Action","OK","styleClass"],"sources":["SearchUrlParser.ts"],"sourcesContent":["/*!\n * SAPUI5\n * Copyright (c) 2025 SAP SE or an SAP affiliate company. All rights reserved.\n * \n */\nimport SearchModel from \"sap/esh/search/ui/SearchModel\";\nimport SearchUrlParserInav2 from \"./SearchUrlParserInav2\";\nimport * as SearchHelper from \"./SearchHelper\";\nimport i18n from \"./i18n\";\nimport MessageBox from \"sap/m/MessageBox\";\nimport { OrderBy, UrlParameters } from \"./SearchModelTypes\";\nimport ErrorHandler from \"./error/ErrorHandler\";\nimport * as core from \"./sinaNexTS/core/core\";\n\nexport interface SearchUrlParserOptions {\n    model: SearchModel;\n    urlParserInav2?: SearchUrlParserInav2;\n}\nexport default class SearchUrlParser {\n    private model: SearchModel;\n    private urlParserInav2: SearchUrlParserInav2;\n    private errorHandler: ErrorHandler;\n\n    constructor(options: SearchUrlParserOptions) {\n        this.model = options.model;\n        this.urlParserInav2 = new SearchUrlParserInav2(options);\n        this.errorHandler = ErrorHandler.getInstance();\n    }\n\n    public async parse(fireQuery = true): Promise<void> {\n        // ignore url hash change which if no search application\n        try {\n            if (!this.model.config.isSearchUrl(SearchHelper.getHashFromUrl())) {\n                return Promise.resolve(undefined);\n            }\n        } catch (e) {\n            this.errorHandler.onError(e);\n            return Promise.resolve(undefined);\n        }\n\n        // check if hash differs from old hash. if not -> return\n        if (!SearchHelper.hasher.hasChanged()) {\n            return Promise.resolve(undefined);\n        }\n\n        // ensure model is initialized\n        await this.model.initAsync();\n\n        // without sina -> do nothing\n        if (!this.model.sinaNext) {\n            return;\n        }\n\n        // parse url parameters\n        let oParametersLowerCased = SearchHelper.getUrlParameters();\n        if (core.isEmptyObject(oParametersLowerCased)) {\n            return undefined;\n        }\n\n        // handle old sina format\n        if (oParametersLowerCased.datasource || oParametersLowerCased.searchterm) {\n            if (!oParametersLowerCased.datasource || this.isJson(oParametersLowerCased.datasource)) {\n                return this.urlParserInav2.parseUrlParameters(oParametersLowerCased);\n            }\n        }\n\n        // parameter modification exit\n        try {\n            oParametersLowerCased = this.model.config.parseSearchUrlParameters(oParametersLowerCased);\n        } catch (e) {\n            this.errorHandler.onError(e);\n            return;\n        }\n\n        if (\n            oParametersLowerCased.datasource &&\n            !this.isJson(oParametersLowerCased.datasource) &&\n            oParametersLowerCased.searchterm\n        ) {\n            // parse simplified url parameters\n            this.parseSimplifiedUrlParameters(oParametersLowerCased);\n        } else {\n            // parse new sinaNext format\n            this.parseUrlParameters(oParametersLowerCased);\n        }\n\n        // update placeholder in case back button is clicked.\n        this.model.setProperty(\"/searchTermPlaceholder\", this.model.calculatePlaceholder());\n\n        // calculate search button status\n        this.model.calculateSearchButtonStatus();\n\n        // fire query\n        if (fireQuery) {\n            this.model.fireSearchQuery({ deserialization: true });\n        }\n    }\n\n    private isJson(data: string): boolean {\n        return data.indexOf(\"{\") >= 0 && data.indexOf(\"}\") >= 0;\n    }\n\n    private parseSimplifiedUrlParameters(oParametersLowerCased: {\n        filter?: string;\n        datasource?: string;\n        top?: string;\n        searchterm?: string;\n    }): void {\n        // top\n        if (oParametersLowerCased.top) {\n            const top = parseInt(oParametersLowerCased.top, 10);\n            this.model.setTop(top, false);\n        }\n\n        // search term\n        const filter = this.model.sinaNext.createFilter();\n        filter.setSearchTerm(oParametersLowerCased.searchterm);\n\n        // datasource\n        let dataSource = this.model.sinaNext.getDataSource(oParametersLowerCased.datasource);\n        if (!dataSource) {\n            dataSource = this.model.sinaNext.allDataSource;\n        }\n        filter.setDataSource(dataSource);\n\n        // update model\n        this.model.setProperty(\"/uiFilter\", filter);\n        this.model.setDataSource(filter.dataSource, false, false); // explicitely updata datasource (for categories: update ds list in model)\n    }\n\n    private parseUrlParameters(oParametersLowerCased: UrlParameters): void {\n        // top\n        if (oParametersLowerCased.top) {\n            const top = parseInt(oParametersLowerCased.top, 10);\n            this.model.setTop(top, false);\n        }\n\n        // order by\n        if (oParametersLowerCased.orderby && oParametersLowerCased.sortorder) {\n            const orderBy: OrderBy = {\n                orderBy: oParametersLowerCased.orderby,\n                sortOrder: oParametersLowerCased.sortorder,\n            };\n            this.model.setOrderBy(orderBy, false);\n        } else {\n            this.model.resetOrderBy(false);\n        }\n\n        // filter conditions\n        let filter;\n        if (oParametersLowerCased.filter) {\n            try {\n                const filterJson = JSON.parse(oParametersLowerCased.filter);\n                filter = this.model.sinaNext.parseFilterFromJson(filterJson);\n                this.model.setProperty(\"/uiFilter\", filter);\n                this.model.setDataSource(filter.dataSource, false, false); // explicitely updata datasource (for categories: update ds list in model)\n            } catch (e) {\n                // no filter taken over from url + send error message\n                MessageBox.show(i18n.getText(\"searchUrlParsingErrorLong\") + \"\\n(\" + e.toString() + \")\", {\n                    icon: MessageBox.Icon.ERROR,\n                    title: i18n.getText(\"searchUrlParsingError\"),\n                    actions: [MessageBox.Action.OK],\n                    styleClass: \"sapUshellSearchMessageBox\", // selector for closePopovers\n                });\n            }\n        }\n    }\n}\n"],"mappings":"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","ignoreList":[]}