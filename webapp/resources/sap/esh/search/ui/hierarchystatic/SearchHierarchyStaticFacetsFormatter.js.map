{"version":3,"file":"SearchHierarchyStaticFacetsFormatter.js","names":["sap","ui","define","__SearchHierarchyStaticFacet","_interopRequireDefault","obj","__esModule","default","SearchHierarchyStaticFacet","SearchHierarchyStaticFacetsFormatter","model","facetMap","constructor","this","getFacetAttributes","resultSet","attributesMetadata","query","filter","dataSource","facetAttributes","i","length","attributeMetadata","isHierarchy","hierarchyDisplayType","sina","HierarchyDisplayType","StaticHierarchyFacet","getHierarchyDataSource","hierarchyName","push","attributeId","id","getFacet","facetAttribute","facet","getAttributeMetadata","getProperty","title","label","treeNodeFactory","cache","activate","initAsync","updateNodesFromHierarchyNodePaths","hierarchyNodePaths","mixinFilterNodes","deActivate","getFacets","config","FF_staticHierarchyFacets","Promise","resolve","facetPromises","all","destroy","facetAttributeId","delete","handleDataSourceChanged"],"sources":["SearchHierarchyStaticFacetsFormatter.ts"],"sourcesContent":["/*!\n * SAPUI5\n * Copyright (c) 2025 SAP SE or an SAP affiliate company. All rights reserved.\n * \n */\n/*!\n * The SearchHierarchyStaticFacetsFormatter is called from the search model after each search.\n * The formatter assembles the static facets from the sina search result.\n */\n\nimport SearchModel from \"sap/esh/search/ui/SearchModel\";\nimport { SearchResultSet } from \"../sinaNexTS/sina/SearchResultSet\";\nimport SearchHierarchyStaticFacet from \"./SearchHierarchyStaticFacet\";\nimport { DataSource } from \"../sinaNexTS/sina/DataSource\";\nimport { AttributeMetadata } from \"../sinaNexTS/sina/AttributeMetadata\";\n\nexport default class SearchHierarchyStaticFacetsFormatter {\n    model: SearchModel;\n    facetMap: { [key: string]: SearchHierarchyStaticFacet };\n\n    constructor(model: SearchModel) {\n        this.model = model;\n        this.facetMap = {};\n    }\n\n    getFacetAttributes(resultSet: SearchResultSet): Array<{ attributeId: string; dataSource: DataSource }> {\n        const attributesMetadata = resultSet.query.filter.dataSource.attributesMetadata;\n        const facetAttributes = [];\n        for (let i = 0; i < attributesMetadata.length; ++i) {\n            const attributeMetadata = attributesMetadata[i] as AttributeMetadata;\n            if (!attributeMetadata.isHierarchy) {\n                continue;\n            }\n            if (\n                attributeMetadata.hierarchyDisplayType !==\n                resultSet.sina.HierarchyDisplayType.StaticHierarchyFacet\n            ) {\n                continue;\n            }\n            const dataSource = resultSet.sina.getHierarchyDataSource(attributeMetadata.hierarchyName);\n            if (!dataSource) {\n                continue;\n            }\n            facetAttributes.push({\n                attributeId: attributeMetadata.id,\n                dataSource: dataSource,\n            });\n        }\n        return facetAttributes;\n    }\n\n    async getFacet(\n        resultSet: SearchResultSet,\n        model: SearchModel,\n        facetAttribute\n    ): Promise<SearchHierarchyStaticFacet> {\n        let facet;\n        try {\n            facet = this.facetMap[facetAttribute.attributeId];\n            if (!facet) {\n                const attributeMetadata = resultSet.query.filter.dataSource.getAttributeMetadata(\n                    facetAttribute.attributeId\n                ) as AttributeMetadata;\n                facet = new SearchHierarchyStaticFacet({\n                    model: model,\n                    attributeId: facetAttribute.attributeId,\n                    dataSource: facetAttribute.dataSource,\n                    filter: model.getProperty(\"/uiFilter\"),\n                    title: attributeMetadata.label,\n                });\n                this.facetMap[facetAttribute.attributeId] = facet;\n                facet.treeNodeFactory.cache.activate();\n                await facet.initAsync();\n            }\n            facet.treeNodeFactory.cache.activate();\n            facet.filter = model.getProperty(\"/uiFilter\");\n            facet.updateNodesFromHierarchyNodePaths(resultSet.hierarchyNodePaths);\n            await facet.mixinFilterNodes();\n            return facet;\n        } finally {\n            facet.treeNodeFactory.cache.deActivate();\n        }\n    }\n\n    getFacets(resultSet: SearchResultSet): Promise<Array<SearchHierarchyStaticFacet>> {\n        if (!this.model.config.FF_staticHierarchyFacets) {\n            return Promise.resolve([]);\n        }\n        if (!this.model.getProperty(\"/facetVisibility\")) {\n            return Promise.resolve([]);\n        }\n        const facetAttributes = this.getFacetAttributes(resultSet);\n        const facetPromises = [];\n        for (let i = 0; i < facetAttributes.length; ++i) {\n            const facetAttribute = facetAttributes[i];\n            const facet = this.getFacet(resultSet, this.model, facetAttribute);\n            facetPromises.push(facet);\n        }\n        return Promise.all(facetPromises);\n    }\n\n    destroy(): void {\n        for (const facetAttributeId in this.facetMap) {\n            const facet = this.facetMap[facetAttributeId];\n            facet.delete();\n        }\n        this.facetMap = {};\n    }\n\n    handleDataSourceChanged(): void {\n        this.destroy();\n    }\n}\n"],"mappings":";;;;;AAAAA,IAAAC,GAAAC,OAAA,0CAAAC,GAAA,sBAAAC,EAAAC,GAAA,OAAAA,KAAAC,mBAAAD,EAAAE,UAAA,YAAAF,EAAAE,QAAAF,CAAA,CAKA,MAOOG,EAA0BJ,EAAAD,GAIlB,MAAMM,EACjBC,MACAC,SAEAC,YAAYF,GACRG,KAAKH,MAAQA,EACbG,KAAKF,SAAW,CAAC,CACrB,CAEAG,mBAAmBC,GACf,MAAMC,EAAqBD,EAAUE,MAAMC,OAAOC,WAAWH,mBAC7D,MAAMI,EAAkB,GACxB,IAAK,IAAIC,EAAI,EAAGA,EAAIL,EAAmBM,SAAUD,EAAG,CAChD,MAAME,EAAoBP,EAAmBK,GAC7C,IAAKE,EAAkBC,YAAa,CAChC,QACJ,CACA,GACID,EAAkBE,uBAClBV,EAAUW,KAAKC,qBAAqBC,qBACtC,CACE,QACJ,CACA,MAAMT,EAAaJ,EAAUW,KAAKG,uBAAuBN,EAAkBO,eAC3E,IAAKX,EAAY,CACb,QACJ,CACAC,EAAgBW,KAAK,CACjBC,YAAaT,EAAkBU,GAC/Bd,WAAYA,GAEpB,CACA,OAAOC,CACX,CAEA,cAAMc,CACFnB,EACAL,EACAyB,GAEA,IAAIC,EACJ,IACIA,EAAQvB,KAAKF,SAASwB,EAAeH,aACrC,IAAKI,EAAO,CACR,MAAMb,EAAoBR,EAAUE,MAAMC,OAAOC,WAAWkB,qBACxDF,EAAeH,aAEnBI,EAAQ,IAAI5B,EAA2B,CACnCE,MAAOA,EACPsB,YAAaG,EAAeH,YAC5Bb,WAAYgB,EAAehB,WAC3BD,OAAQR,EAAM4B,YAAY,aAC1BC,MAAOhB,EAAkBiB,QAE7B3B,KAAKF,SAASwB,EAAeH,aAAeI,EAC5CA,EAAMK,gBAAgBC,MAAMC,iBACtBP,EAAMQ,WAChB,CACAR,EAAMK,gBAAgBC,MAAMC,WAC5BP,EAAMlB,OAASR,EAAM4B,YAAY,aACjCF,EAAMS,kCAAkC9B,EAAU+B,0BAC5CV,EAAMW,mBACZ,OAAOX,CACX,CAAC,QACGA,EAAMK,gBAAgBC,MAAMM,YAChC,CACJ,CAEAC,UAAUlC,GACN,IAAKF,KAAKH,MAAMwC,OAAOC,yBAA0B,CAC7C,OAAOC,QAAQC,QAAQ,GAC3B,CACA,IAAKxC,KAAKH,MAAM4B,YAAY,oBAAqB,CAC7C,OAAOc,QAAQC,QAAQ,GAC3B,CACA,MAAMjC,EAAkBP,KAAKC,mBAAmBC,GAChD,MAAMuC,EAAgB,GACtB,IAAK,IAAIjC,EAAI,EAAGA,EAAID,EAAgBE,SAAUD,EAAG,CAC7C,MAAMc,EAAiBf,EAAgBC,GACvC,MAAMe,EAAQvB,KAAKqB,SAASnB,EAAWF,KAAKH,MAAOyB,GACnDmB,EAAcvB,KAAKK,EACvB,CACA,OAAOgB,QAAQG,IAAID,EACvB,CAEAE,UACI,IAAK,MAAMC,KAAoB5C,KAAKF,SAAU,CAC1C,MAAMyB,EAAQvB,KAAKF,SAAS8C,GAC5BrB,EAAMsB,QACV,CACA7C,KAAKF,SAAW,CAAC,CACrB,CAEAgD,0BACI9C,KAAK2C,SACT,EACH,OAAA/C,CAAA","ignoreList":[]}