{"version":3,"file":"SearchHierarchyStaticFacetsFormatter-dbg.js","names":["sap","ui","define","__SearchHierarchyStaticFacet","_interopRequireDefault","obj","__esModule","default","SearchHierarchyStaticFacet","SearchHierarchyStaticFacetsFormatter","model","facetMap","constructor","getFacetAttributes","resultSet","attributesMetadata","query","filter","dataSource","facetAttributes","i","length","attributeMetadata","isHierarchy","hierarchyDisplayType","sina","HierarchyDisplayType","StaticHierarchyFacet","getHierarchyDataSource","hierarchyName","push","attributeId","id","getFacet","facetAttribute","facet","getAttributeMetadata","getProperty","title","label","treeNodeFactory","cache","activate","initAsync","updateNodesFromHierarchyNodePaths","hierarchyNodePaths","mixinFilterNodes","deActivate","getFacets","config","FF_staticHierarchyFacets","Promise","resolve","facetPromises","all","destroy","facetAttributeId","delete","handleDataSourceChanged"],"sources":["SearchHierarchyStaticFacetsFormatter.ts"],"sourcesContent":["/*!\n * SAPUI5\n * Copyright (c) 2025 SAP SE or an SAP affiliate company. All rights reserved.\n * \n */\n/*!\n * The SearchHierarchyStaticFacetsFormatter is called from the search model after each search.\n * The formatter assembles the static facets from the sina search result.\n */\n\nimport SearchModel from \"sap/esh/search/ui/SearchModel\";\nimport { SearchResultSet } from \"../sinaNexTS/sina/SearchResultSet\";\nimport SearchHierarchyStaticFacet from \"./SearchHierarchyStaticFacet\";\nimport { DataSource } from \"../sinaNexTS/sina/DataSource\";\nimport { AttributeMetadata } from \"../sinaNexTS/sina/AttributeMetadata\";\n\nexport default class SearchHierarchyStaticFacetsFormatter {\n    model: SearchModel;\n    facetMap: { [key: string]: SearchHierarchyStaticFacet };\n\n    constructor(model: SearchModel) {\n        this.model = model;\n        this.facetMap = {};\n    }\n\n    getFacetAttributes(resultSet: SearchResultSet): Array<{ attributeId: string; dataSource: DataSource }> {\n        const attributesMetadata = resultSet.query.filter.dataSource.attributesMetadata;\n        const facetAttributes = [];\n        for (let i = 0; i < attributesMetadata.length; ++i) {\n            const attributeMetadata = attributesMetadata[i] as AttributeMetadata;\n            if (!attributeMetadata.isHierarchy) {\n                continue;\n            }\n            if (\n                attributeMetadata.hierarchyDisplayType !==\n                resultSet.sina.HierarchyDisplayType.StaticHierarchyFacet\n            ) {\n                continue;\n            }\n            const dataSource = resultSet.sina.getHierarchyDataSource(attributeMetadata.hierarchyName);\n            if (!dataSource) {\n                continue;\n            }\n            facetAttributes.push({\n                attributeId: attributeMetadata.id,\n                dataSource: dataSource,\n            });\n        }\n        return facetAttributes;\n    }\n\n    async getFacet(\n        resultSet: SearchResultSet,\n        model: SearchModel,\n        facetAttribute\n    ): Promise<SearchHierarchyStaticFacet> {\n        let facet;\n        try {\n            facet = this.facetMap[facetAttribute.attributeId];\n            if (!facet) {\n                const attributeMetadata = resultSet.query.filter.dataSource.getAttributeMetadata(\n                    facetAttribute.attributeId\n                ) as AttributeMetadata;\n                facet = new SearchHierarchyStaticFacet({\n                    model: model,\n                    attributeId: facetAttribute.attributeId,\n                    dataSource: facetAttribute.dataSource,\n                    filter: model.getProperty(\"/uiFilter\"),\n                    title: attributeMetadata.label,\n                });\n                this.facetMap[facetAttribute.attributeId] = facet;\n                facet.treeNodeFactory.cache.activate();\n                await facet.initAsync();\n            }\n            facet.treeNodeFactory.cache.activate();\n            facet.filter = model.getProperty(\"/uiFilter\");\n            facet.updateNodesFromHierarchyNodePaths(resultSet.hierarchyNodePaths);\n            await facet.mixinFilterNodes();\n            return facet;\n        } finally {\n            facet.treeNodeFactory.cache.deActivate();\n        }\n    }\n\n    getFacets(resultSet: SearchResultSet): Promise<Array<SearchHierarchyStaticFacet>> {\n        if (!this.model.config.FF_staticHierarchyFacets) {\n            return Promise.resolve([]);\n        }\n        if (!this.model.getProperty(\"/facetVisibility\")) {\n            return Promise.resolve([]);\n        }\n        const facetAttributes = this.getFacetAttributes(resultSet);\n        const facetPromises = [];\n        for (let i = 0; i < facetAttributes.length; ++i) {\n            const facetAttribute = facetAttributes[i];\n            const facet = this.getFacet(resultSet, this.model, facetAttribute);\n            facetPromises.push(facet);\n        }\n        return Promise.all(facetPromises);\n    }\n\n    destroy(): void {\n        for (const facetAttributeId in this.facetMap) {\n            const facet = this.facetMap[facetAttributeId];\n            facet.delete();\n        }\n        this.facetMap = {};\n    }\n\n    handleDataSourceChanged(): void {\n        this.destroy();\n    }\n}\n"],"mappings":"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","ignoreList":[]}