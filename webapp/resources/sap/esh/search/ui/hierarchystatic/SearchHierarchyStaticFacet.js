/*!
 * SAPUI5
 * Copyright (c) 2025 SAP SE or an SAP affiliate company. All rights reserved.
 * 
 */
sap.ui.define(["../tree/TreeNodeFactory","./SearchHierarchyStaticTreeNode","../SearchHelperSequentializeDecorator","../controls/facets/FacetTypeUI"],function(e,t,o,i){"use strict";function r(e){return e&&e.__esModule&&typeof e.default!=="undefined"?e.default:e}const a=r(e);const s=r(t);const d=o["sequentializedExecution"];const n=i["FacetTypeUI"];class c{static rootNodeId="$$ROOT$$";model;attributeId;dataSource;filter;title;sina;facetType;facetIndex;position;treeNodeFactory;rootTreeNode;constructor(e){this.model=e.model;this.sina=this.model.sinaNext;this.attributeId=e.attributeId;this.dataSource=e.dataSource;this.filter=e.filter;this.facetType=n.HierarchyStatic;this.title=e.title;this.facetIndex=-1;this.position=-1;this.treeNodeFactory=a.create({model:this.model,rootTreeNodePath:`/facets/${this.facetIndex}/rootTreeNode`,treeNodeConstructor:s,busyIndicator:this.model.busyIndicator});this.rootTreeNode=this.treeNodeFactory.createRootTreeNode({id:c.rootNodeId,label:"Root",facet:this});this.updateTree=d(this.updateTree)}setFacetIndex(e){this.facetIndex=e;this.treeNodeFactory.setRootTreeNodePath(`/facets/${this.facetIndex}/rootTreeNode`)}async initAsync(){const e=await this.rootTreeNode.fetchChildTreeNodes();this.rootTreeNode.addChildTreeNodes(e)}async activateFilters(){try{await this.model.fireSearchQuery();this.model.notifyFilterChanged()}finally{}}updateTree(){return this.doUpdateTree()}async doUpdateTree(){await this.treeNodeFactory.updateRecursively();await this.mixinFilterNodes();this.treeNodeFactory.updateUI()}getComplexConditionOfFacet(){for(const e of this.filter.rootCondition.conditions){if(e.containsAttribute(this.attributeId)){return e}}return null}getFilterConditions(){const e=[];const t=this.getComplexConditionOfFacet();if(!t){return e}for(const o of t.conditions){e.push(o)}return e}async mixinFilterNodes(){this.rootTreeNode.hasFilter=false;this.rootTreeNode.visitChildNodesRecursively(function(e){e.hasFilter=false});const e=this.getFilterConditions();for(const t of e){const e=this.treeNodeFactory.getTreeNode(t.value);if(!e){continue}e.hasFilter=true}await this.autoExpandFirstFilterNode()}handleModelUpdate(){this.treeNodeFactory.updateUI()}delete(){this.treeNodeFactory.delete()}async autoExpandFirstFilterNode(){let e=null;this.rootTreeNode.visitChildNodesRecursively(function(t){if(t.hasFilter&&!e){e=t}});if(!e){return}if(e.isVisible()){return}let t=e.getParentTreeNode();while(t){t.expanded=true;t=t.getParentTreeNode()}await this.treeNodeFactory.updateRecursively()}updateNodesFromHierarchyNodePaths(e){for(let t=0;t<e.length;++t){const o=e[t];if(o.name!==this.attributeId){continue}this.rootTreeNode.updateNodePath(o.path,0)}}}return c});
//# sourceMappingURL=SearchHierarchyStaticFacet.js.map