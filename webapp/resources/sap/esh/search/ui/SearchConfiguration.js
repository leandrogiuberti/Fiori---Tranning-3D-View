/*!
 * SAPUI5
 * Copyright (c) 2025 SAP SE or an SAP affiliate company. All rights reserved.
 * 
 */
sap.ui.define(["./controls/resultview/SearchResultListSelectionHandler","./controls/resultview/SearchResultListItemNote","./SearchConfigurationSettings","sap/base/Log","sap/base/assert","./SelectionMode"],function(e,t,o,s,r,a){"use strict";function i(e){return e&&e.__esModule&&typeof e.default!=="undefined"?e.default:e}const n=i(e);const u=i(t);const c=i(o);const l=o["defaultSearchConfigurationSettings"];const d=o["deprecatedParameters"];const h=o["urlForbiddenParameters"];const f=a["SelectionMode"];class g extends c{log=s.getLogger("sap.esh.search.ui.SearchConfiguration");dataSourceConfigurations;dataSourceConfigurations_Regexes=[];defaultDataSourceConfig={searchResultListItem:undefined,searchResultListItemControl:undefined,searchResultListItemContent:undefined,searchResultListItemContentControl:undefined,searchResultListSelectionHandler:n["getMetadata"]().getName(),searchResultListSelectionHandlerControl:n};documentDataSourceConfiguration;_dataSourceLoadingProms;_loadCustomModulesProm;constructor(e){super();g.extendSearchConfiguration(this,e);this.aiNlqExplainBar??=false;if(this.isUshell){this.aiNlq=true;this.enableCharts=true;this.reloadOnUrlChange=false;this.readUshellConfiguration();this.readOutdatedUshellConfiguration()}this.updateConfigFromUrlParameters();this.initDataSourceConfig();this.checkForDeprecatedParameters(e)}checkForDeprecatedParameters(e){for(const t in d){if(e&&Object.prototype.hasOwnProperty.call(e,t)){if(e[t]===l[t]){continue}let o=`You are using a deprecated configuration property for SearchCompositeControl which will be removed in a future release: '${t}'.`;const s=d[t];if(s.replacedBy){if(s.replacedBy==="enableMultiSelectionResultItems"){if(this[t]===true){this.resultviewSelectionMode=f.MultipleItems}else{this.resultviewSelectionMode=f.None}}else{this[s.replacedBy]=this[t]}o+=`\nPlease use '${s.replacedBy}' instead.`}if(s.replacementInfo){o+=`\n${s.replacementInfo}`}r(false,o)}}}readUshellConfiguration(){try{const e=window["sap-ushell-config"].renderers.fiori2.componentData.config.esearch;g.extendSearchConfiguration(this,e)}catch(e){this.log.debug("Could not read ushell configuration",e)}}static extendSearchConfiguration(e,...t){return Object.assign(e,...t)}readOutdatedUshellConfiguration(){try{const e=window["sap-ushell-config"].renderers.fiori2.componentData.config;if(typeof e.searchBusinessObjects!=="undefined"){if(e.searchBusinessObjects==="hidden"||e.searchBusinessObjects===false){this.searchBusinessObjects=false}else{this.searchBusinessObjects=true}}}catch(e){this.log.debug("Could not read ushell configuration",e)}}initDataSourceConfig(){this.dataSourceConfigurations={};this.dataSourceConfigurations_Regexes=[];if(this.dataSources){for(let e=0;e<this.dataSources.length;e++){const t=this.dataSources[e];if(t.id){this.dataSourceConfigurations[t.id]=t}else if(t.regex){const e=t.regexFlags||undefined;const o=new RegExp(t.regex,e);if(o){t.regexObject=o;this.dataSourceConfigurations_Regexes.push(t)}}else{const e="Following datasource configuration does neither include a valid id nor a regular expression, therefore it is ignored:\n"+JSON.stringify(t);this.log.warning(e)}}}this.dataSources=undefined;this.documentDataSourceConfiguration={searchResultListItem:"sap.esh.search.ui.controls.SearchResultListItemDocument"};const e=this.dataSourceConfigurations.noteprocessorurl||{};this.dataSourceConfigurations.noteprocessorurl=e;this.dataSourceConfigurations.noteprocessorurl.searchResultListItemControl=this.dataSourceConfigurations.noteprocessorurl.searchResultListItemControl||new u;this.dataSourceConfigurations.noteprocessorurl.searchResultListSelectionHandler=this.dataSourceConfigurations.noteprocessorurl.searchResultListSelectionHandler||"sap.esh.search.ui.controls.resultview.SearchResultListSelectionHandlerNote"}getParameterType(e){if(e in d){if(d[e]){e=d[e].replacedBy}else{return"string"}}if(!l.hasOwnProperty(e)){return""}return typeof l[e]}parseBoolean(e){if(e.toLowerCase()==="true"){return true}return false}parseEsDevConfig(e){const t=JSON.parse(e);for(const e of h){delete t[e]}g.extendSearchConfiguration(this,t)}updateConfigFromUrlParameters(){const e=this.parseUrlParameters();for(const t in e){const o=e[t];if(h.includes(t)){continue}if(t.startsWith("sina")){continue}if(t==="demoMode"){this.searchBusinessObjects=true;continue}if(t==="resultViewTypes"){let e=o.split(",");e=e.filter(e=>e.length>0);this.resultViewTypes=e;continue}if(t==="esDevConfig"){this.parseEsDevConfig(o);continue}const s=this.getParameterType(t);switch(s){case"string":this[t]=o;break;case"number":this[t]=parseInt(o);break;case"boolean":this[t]=this.parseBoolean(o);break;default:}}}parseUrlParameters(){if(!URLSearchParams){return{}}const e=new URLSearchParams(window.location.search);return Object.fromEntries(e.entries())}loadCustomModulesAsync(){if(this._loadCustomModulesProm){return this._loadCustomModulesProm}let e;const t=[];for(const o in this.dataSourceConfigurations){e=this.loadCustomModulesForDataSourceIdAsync(o);t.push(e)}this._loadCustomModulesProm=Promise.all(t);return this._loadCustomModulesProm}async loadCustomModulesForDataSourcesAsync(e,t){const o=[];for(let s=0;s<e.length;s++){const r=Array.isArray(t)&&t.length>s&&t[s]||{};const a=this.loadCustomModulesForDataSourceAsync(e[s],r);o.push(a)}return Promise.all(o)}loadCustomModulesForDataSourceAsync(e,t={}){t=t||{};return this.loadCustomModulesForDataSourceIdAsync(e.id,t)}loadCustomModulesForDataSourceIdAsync(e,t){if(!e){return Promise.resolve()}this._dataSourceLoadingProms=this._dataSourceLoadingProms||{};let o=this._dataSourceLoadingProms[e];if(!o){const s=[{moduleAttrName:"searchResultListItem",controlAttrName:"searchResultListItemControl"},{moduleAttrName:"searchResultListItemContent",controlAttrName:"searchResultListItemContentControl"},{moduleAttrName:"searchResultListSelectionHandler",controlAttrName:"searchResultListSelectionHandlerControl"}];const r=this._prepareDataSourceConfigurationForDataSource(e,t);let a;const i=[];for(let t=0;t<s.length;t++){a=this._doLoadCustomModulesAsync(e,r,s[t].moduleAttrName,s[t].controlAttrName);i.push(a)}o=Promise.all(i);o._resolvedOrFailed=false;o.then(function(){o._resolvedOrFailed=true});this._dataSourceLoadingProms[e]=o}return o}_doLoadCustomModulesAsync(e,t,o,s,r,a){const i=this;return new Promise(function(n){if(t[o]&&(!t[s]||t[s]==i.defaultDataSourceConfig[s])){try{sap.ui.require([t[o].replace(/[.]/g,"/")],function(e){t[s]=e;n()})}catch(u){let c="Could not load custom module '"+t[o]+"' for data source with id '"+e+"'. ";c+="Falling back to default data source configuration.";i.log.warning(c,u);t[o]=r||i.defaultDataSourceConfig[o];t[s]=a||i.defaultDataSourceConfig[s];n()}}else{if(!t[s]){t[o]=r||i.defaultDataSourceConfig[o];t[s]=a||i.defaultDataSourceConfig[s]}n()}})}getDataSourceConfig(e){if(this._dataSourceLoadingProms&&this._dataSourceLoadingProms[e.id]&&!this._dataSourceLoadingProms[e.id]._resolvedOrFailed){return this.defaultDataSourceConfig}let t=this.dataSourceConfigurations[e.id];if(!t){t=this.defaultDataSourceConfig;this.dataSourceConfigurations[e.id]=t}return t}_prepareDataSourceConfigurationForDataSource(e,t){let o={};if(this.dataSourceConfigurations[e]){o=this.dataSourceConfigurations[e]}else{for(let t=0;t<this.dataSourceConfigurations_Regexes.length;t++){if(this.dataSourceConfigurations_Regexes[t].regexObject.test(e)){o=this.dataSourceConfigurations_Regexes[t];break}}}if(t&&t.isDocumentConnector){if(!o.searchResultListItem){o.searchResultListItem=this.documentDataSourceConfiguration.searchResultListItem}else{const t="Will attempt to load '"+o.searchResultListItem+"' instead of '"+this.documentDataSourceConfiguration.searchResultListItem+"' for data source '"+e+"'";this.log.warning(t)}}this.dataSourceConfigurations[e]=o;return o}isWebCompSearchFieldGroupEnabled(){if(!this.FF_useWebComponentsSearchInput){return false}if(this.isUshell){if(!document.querySelector("#shell-header .sapUshellShellBar")){return false}}return true}}return g});
//# sourceMappingURL=SearchConfiguration.js.map