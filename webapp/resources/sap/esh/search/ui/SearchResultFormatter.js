/*!
 * SAPUI5
 * Copyright (c) 2025 SAP SE or an SAP affiliate company. All rights reserved.
 * 
 */
sap.ui.define(["./SearchResultBaseFormatter","./sinaNexTS/sina/SearchResultSetItemAttribute","./sinaNexTS/sina/NavigationTarget"],function(t,e,a){"use strict";function i(t){return t&&t.__esModule&&typeof t.default!=="undefined"?t.default:t}const l=i(t);const r=e["SearchResultSetItemAttribute"];const o=a["NavigationTarget"];class s extends l{constructor(t){super(t);this.model=t}format(t,e,a){a=a||{};a.suppressHighlightedValues=a.suppressHighlightedValues||false;const i=t.sina;const l={};const o=[];const s=t.items;for(let e=0;e<s.length;e++){const n=s[e];const u={};const f=[];for(let t=0;t<n.detailAttributes.length;t++){const e=n.detailAttributes[t];let l="";let o="";let s=undefined;if(e instanceof r){l=e.value;o=e.metadata.format;s=e.defaultNavigationTarget}switch(e.metadata.type){case i.AttributeType.ImageBlob:if(l&&l.trim().length>0){l="data:;base64,"+l}break;case i.AttributeType.ImageUrl:u.imageUrl=l;u.imageFormat=o?o.toLowerCase():undefined;if(s){u.imageNavigation=s}break;case i.AttributeType.GeoJson:u.geoJson={value:l,label:e.label};break;case i.AttributeType.Group:{const t=this._formatAttributeGroup(e,a);f.push(t);break}case i.AttributeType.Double:case i.AttributeType.Integer:case i.AttributeType.String:case i.AttributeType.Date:case i.AttributeType.Time:case i.AttributeType.Timestamp:{const t=this._formatSingleAttribute(e,a);f.push(t);break}}}u.key=n.key;u.keystatus=n.keystatus;u.dataSource=n.dataSource;u.dataSourceName=n.dataSource.label;u.attributesMap=n.attributesMap;u.sinaItem=n;const d=n.hierarchyNodePaths;if(Array.isArray(d)===true&&d.length>0){u.hierarchyNodePath=d[0]}if(n.titleAttributes){let t,e,l;const r=[];let o=false;for(let s=0;s<n.titleAttributes.length;s++){t=n.titleAttributes[s];if(t.metadata.type===i.AttributeType.Group){e=this._formatAttributeGroup(t,a);o=o||e.whyfound}else if(t.metadata.type===i.AttributeType.ImageUrl){e=this._formatSingleAttribute(t,a);u.titleIconUrl=t.value;e.value="";o=o||false}else{e=this._formatSingleAttribute(t,a);o=o||e.whyfound}if(t.infoIconUrl){u.titleInfoIconUrl=t.infoIconUrl;if(t.tooltip){u.titleInfoIconTooltip=t.tooltip}e.value="";o=o||false}l=e.value;r.push(l)}u.title=r.join(" ");u.isTitleHighlighted=o}else{u.title=a.suppressHighlightedValues?n.title:n.titleHighlighted;u.isTitleHighlighted=a.suppressHighlightedValues?false:true}if(n.titleDescriptionAttributes&&n.titleDescriptionAttributes.length>0){let t,e,l;const r=[];const o=[];let s=false;for(let u=0;u<n.titleDescriptionAttributes.length;u++){t=n.titleDescriptionAttributes[u];if(t.metadata.type===i.AttributeType.Group){e=this._formatAttributeGroup(t,a);s=s||e.whyfound}else{e=this._formatSingleAttribute(t,a);s=s||e.whyfound}l=e.value;r.push(l);o.push(e.name)}u.titleDescription=r.join(" ");u.titleDescriptionLabel=o.join(" ");u.isTitleDescriptionHighlighted=s}u.itemattributes=f;if(n.defaultNavigationTarget){u.titleNavigation=n.defaultNavigationTarget;if(!u.title||u.title.length===0){u.title=n.defaultNavigationTarget.text}}if(n.navigationTargets&&n.navigationTargets.length>0){u.navigationObjects=[];for(let t=0;t<n.navigationTargets.length;t++){const e=n.navigationTargets[t];u.navigationObjects.push(e)}}const c=l[n.dataSource.id]||{};l[n.dataSource.id]=c;u.layoutCache=c;u.customItemStyleClass="";u.selected=false;u.selectionEnabled=true;u.expanded=false;const g={};this._formatResultForDocuments(n,g);this._formatResultForNotes(n,g);u.additionalParameters=g;u.positionInList=e;u.resultSetId=t.id;o.push(u)}return o}_formatAttributeGroup(t,e){if(t.attributes.length===2&&typeof t.attributes[1].attribute.value==="string"&&t.attributes[1].attribute.value.startsWith("sap-icon://")){const a=this._formatSingleAttribute(t.attributes[0].attribute,e);a.iconUrl=t.attributes[1].attribute.value;a.key=t.id;a.sinaAttribute=t;a.isTitle=false;a.isSortable=t.metadata.isSortable;a.displayOrder=t.metadata.usage.Detail&&t.metadata.usage.Detail.displayOrder;return a}const a={};const i={};a.name=t.label;let l=false;let r=false;const s=t.metadata._private;let n,u;for(let a=0;a<t.attributes.length;a++){const o=t.attributes[a];const f=o.attribute;const d=o.metadata.nameInGroup;let c;if(f.metadata.type===f.sina.AttributeType.Group){c=this._formatAttributeGroup(f,e)}else{c=this._formatSingleAttribute(f,e)}if(s){if(s.parentAttribute===f.metadata){n=c}else if(s.childAttribute===f.metadata){u=c}}if(c.value){i[d]=c;l=l||c.whyfound;r=r||c.longtext!==undefined}}a.value="";a.valueRaw=undefined;a.valueWithoutWhyfound="";a.whyfound=false;if(Object.keys(i).length>0){let e=true;if(s&&n&&u&&(s.isUnitOfMeasure||s.isCurrency||s.isDescription)){let i=n.value;let l=u.value;if(typeof i==="string"&&i.trim().length<1){i=undefined}if(typeof l==="string"&&l.trim().length<1){l=undefined}if(!(i&&l)){if(s.isUnitOfMeasure||s.isCurrency){if(i&&!l){a.value=n.value;a.valueRaw=n.valueRaw;a.valueWithoutWhyfound=n.valueWithoutWhyfound;e=false}}else if(s.isDescription){const r=s.textArrangement;const o=t.sina;if(r===o.AttributeGroupTextArrangement.TextFirst){if(!i&&l){a.value=u.value;a.valueRaw=u.valueRaw;a.valueWithoutWhyfound=u.valueWithoutWhyfound;e=false}}else if(r===o.AttributeGroupTextArrangement.TextLast){if(i&&!l){a.value=n.value;a.valueRaw=n.valueRaw;a.valueWithoutWhyfound=n.valueWithoutWhyfound;e=false}}else if(r===o.AttributeGroupTextArrangement.TextOnly){if(!l){e=false}}}}}if(e){a.value=this._formatBasedOnGroupTemplate(t.template,i,"value");a.valueRaw=this._formatBasedOnGroupTemplate(t.template,i,"valueRaw");a.valueWithoutWhyfound=this._formatBasedOnGroupTemplate(t.template,i,"valueWithoutWhyfound")}a.whyfound=l}a.key=t.id;a.sinaAttribute=t;a.isTitle=false;a.isSortable=t.metadata.isSortable;a.displayOrder=t.metadata.usage.Detail&&t.metadata.usage.Detail.displayOrder;if(r){a.longtext=a.value}if(!(a.defaultNavigationTarget instanceof o)){if(n?.defaultNavigationTarget instanceof o){a.defaultNavigationTarget=n.defaultNavigationTarget}else if(u?.defaultNavigationTarget instanceof o){a.defaultNavigationTarget=u.defaultNavigationTarget}}if(n?.tooltip){a.tooltip=n.tooltip}else if(u?.tooltip){a.tooltip=u.tooltip}if(!a.iconUrl){if(n?.iconUrl){a.iconUrl=n.iconUrl}else if(u?.iconUrl){a.iconUrl=u.iconUrl}}return a}_formatSingleAttribute(t,e){const a={};const i=t.sina;a.name=t.label;a.valueRaw=t.value;a.value=e.suppressHighlightedValues?t.valueFormatted:t.valueHighlighted;a.valueWithoutWhyfound=t.valueFormatted;a.key=t.id;a.sinaAttribute=t;a.isTitle=false;a.isSortable=t.metadata.isSortable;a.displayOrder=t.metadata.usage.Detail&&t.metadata.usage.Detail.displayOrder;a.whyfound=t.isHighlighted;if(t.defaultNavigationTarget instanceof o){a.defaultNavigationTarget=t.defaultNavigationTarget}if(typeof t.tooltip==="string"&&t.tooltip.length>0){a.tooltip=t.tooltip}if(typeof t.iconUrl==="string"&&t.iconUrl.length>0&&t.iconUrl.startsWith("sap-icon://")){a.iconUrl=t.iconUrl}if(t.metadata.format&&(t.metadata.format===i.AttributeFormatType.MultilineText||t.metadata.format===i.AttributeFormatType.LongText)){a.longtext=t.valueHighlighted}return a}_formatBasedOnGroupTemplate(t,e,a){if(!(t&&e&&a)){return""}const i=/{\w+}/gi;let l="";let r=0;let o;while((o=i.exec(t))!==null){l+=t.substring(r,o.index);const s=o[0].slice(1,-1);l+=e[s]&&e[s][a]||"";r=i.lastIndex}l+=t.substring(r);return l}_formatResultForDocuments(t,e){let a="";e.isDocumentConnector=false;let i;for(let l=0;l<t.detailAttributes.length;l++){i=t.detailAttributes[l];if(i.metadata.id==="FILE_PROPERTY"){e.isDocumentConnector=true}if(i.metadata.isKey===true){if(a.length>0){a+=";"}a=a+i.metadata.id+"="+i.value}}if(e.isDocumentConnector===true){const l=";o=sid("+t.dataSource.system+"."+t.dataSource.client+")";const r=t.dataSource.id;e.imageUrl="/sap/opu/odata/SAP/ESH_SEARCH_SRV"+l+"/FileLoaderFiles(ConnectorId='"+r+"',FileType='ThumbNail',SelectionParameters='"+a+"')/$value";e.titleUrl="/sap/opu/odata/SAP/ESH_SEARCH_SRV"+l+"/FileLoaderFiles(ConnectorId='"+r+"',FileType='BinaryContent',SelectionParameters='"+a+"')/$value";const o="/sap/opu/odata/SAP/ESH_SEARCH_SRV"+l+"/FileLoaderFiles(ConnectorId='"+r+"',FileType='SUVFile',SelectionParameters='"+a+"')/$value";e.suvlink="/sap/bc/ui5_ui5/ui2/ushell/resources/sap/fileviewer/viewer/web/viewer.html?file="+encodeURIComponent(o);if(!t.navigationObjects){t.navigationObjects=[]}const s={text:"Show Document",targetUrl:e.suvlink,target:"_blank"};const n=this.model.sinaNext.createNavigationTarget(s);t.navigationObjects.push(n);for(let a=0;a<t.detailAttributes.length;a++){i=t.detailAttributes[a];if(i.id==="PHIO_ID_THUMBNAIL"&&i.value){e.containsThumbnail=true}if(i.id==="PHIO_ID_SUV"&&i.value){e.containsSuvFile=true}}}}_formatResultForNotes(t,e){}}return s});
//# sourceMappingURL=SearchResultFormatter.js.map