/*!
 * SAPUI5
 * Copyright (c) 2025 SAP SE or an SAP affiliate company. All rights reserved.
 * 
 */
sap.ui.define(["sap/base/Log","./suggestions/SuggestionType","./personalization/PersonalizationKeys"],function(e,t,i){"use strict";const a=t["Type"];const r=t["SuggestionType"];const s=t["RecentEntriesPosition"];const o=i["PersonalizationKeys"];var n=function(e){e[e["V2"]=2]="V2";return e}(n||{});const g=["uiSuggestionType","label","label1","label2","imageUrl","imageIsCircular","imageExists"];const l=["uiSuggestionType","label","icon","filterIcon"];const c=["uiSuggestionType","label","url","icon","searchTerm"];class h{personalizationStorage;_oLogger;maxItems;key=o.recentSearches;searchModel;constructor(t){this.personalizationStorage=t.personalizationStorage;this._oLogger=e.getLogger("sap.esh.search.ui.RecentlyUsedStorage");this.maxItems=t.maxItems||10;this.searchModel=t.searchModel}async deleteAllItems(){this.personalizationStorage.deleteItem(this.key);return this.personalizationStorage.save()}getSerializedItemsInternal(){const e=this.personalizationStorage.getItem(this.key)??[];return e.filter(e=>e.version>=n.V2)}getItems(){const e=this.searchModel?.query?.filter;return this.getSerializedItemsInternal().map(e=>this.deSerialize(e)).filter(t=>{if(t.uiSuggestionType===a.Search&&t.filter.equals(e)){return false}return true})}copyProperties(e,t,i){for(const a of i){e[a]=t[a]}}deSerialize(e){const t={label:""};let i;switch(e.uiSuggestionType){case r.Object:this.copyProperties(t,e,g);t.titleNavigation=this.searchModel.sinaNext.parseNavigationTargetFromJson(e.titleNavigation);t.dataSource=this.searchModel.sinaNext.getDataSource(e.dataSource);break;case r.Search:this.copyProperties(t,e,l);i=this.deSerializeSearchNavigationTarget(e.titleNavigation);t.titleNavigation=i.navigationTarget;t.filter=i.filter;break;case r.Transaction:this.copyProperties(t,e,c);break}t.position=s;t.isRecentEntry=true;return t}serialize(e){const t={key:""};switch(e.uiSuggestionType){case r.Object:this.copyProperties(t,e,g);t.titleNavigation=e.titleNavigation.toJson();t.dataSource=e.dataSource.id;t.key=e.uiSuggestionType+"/"+e.label1+"/"+e.label2;break;case r.Search:this.copyProperties(t,e,l);t.titleNavigation=this.serializeSearchNavigationTarget(e.titleNavigation);t.key=e.uiSuggestionType+"/"+e.label;break;case r.Transaction:this.copyProperties(t,e,c);t.key=e.uiSuggestionType+"/"+e.label;break}t.version=n.V2;return t}serializeSearchNavigationTarget(e){const t=this.searchModel.parseSearchNavigationTarget(e);return this.searchModel.createSearchNavigationTarget(Object.assign(t,{updateUrl:true})).toJson()}deSerializeSearchNavigationTarget(e){const t=this.searchModel.sinaNext.parseNavigationTargetFromJson(e);const i=this.searchModel.parseSearchNavigationTarget(t);return{filter:i.filter,navigationTarget:this.searchModel.createSearchNavigationTarget(i)}}addItem(e){if(!this.personalizationStorage.isStorageOfPersonalDataAllowed())return;const t=this.serialize(e);const i=this.getSerializedItemsInternal();i.some((e,i,a)=>{if(e.key===t.key){this._oLogger.debug("Removing already existing item "+t.key+" at pos "+i);a.splice(i,1);return true}});if(i.length>=this.maxItems){const e=i.pop();this._oLogger.debug("Removing oldest item "+e.key)}this._oLogger.debug("Adding item "+t.key);i.unshift(t);this.personalizationStorage.setItem(this.key,i)}}return h});
//# sourceMappingURL=RecentlyUsedStorage.js.map