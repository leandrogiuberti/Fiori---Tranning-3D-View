/*!
 * SAPUI5
 * Copyright (c) 2025 SAP SE or an SAP affiliate company. All rights reserved.
 * 
 */
sap.ui.define(["./i18n","sap/ui/model/Sorter","sap/ui/core/format/NumberFormat","sap/ui/core/message/MessageType","./hierarchydynamic/SearchHierarchyDynamicFacet","./SearchFacetDialogHelperDynamicHierarchy","./sinaNexTS/sina/SimpleCondition","sap/ui/core/format/DateFormat","./controls/facets/FacetTypeUI"],function(t,e,n,o,a,i,r,s,g){"use strict";function l(t){return t&&t.__esModule&&typeof t.default!=="undefined"?t.default:t}const c=l(t);const C=l(a);const d=i["updateDetailPageforDynamicHierarchy"];const T=r["SimpleCondition"];const O=g["FacetTypeUI"];class u{static searchAdvancedCondition;static dialog;static POS_FACET_LIST;static POS_TOOLBAR_SEARCHFIELD;static POS_TOOLBAR_TOGGLEBUTTON;static POS_SETTING_CONTAINER;static POS_ATTRIBUTE_LIST_CONTAINER;static POS_ICONTABBAR;static POS_TABBAR_LIST;static POS_TABBAR_CONDITION;static POS_SORTING_SELECT;static POS_SHOWONTOP_CHECKBOX;static POS_ADVANCED_CHECKBOX;static POS_ADVANCED_INPUT_LAYOUT;static POS_ADVANCED_BUTTON;static bResetFilterIsActive;static oFloatNumberFormat;static oIntegernumberFormat;static oNumberFormat;static oDateFormatOptions;static oTimestampFormatOptions;static oDateFormat;static oTimestampFormat;static oDateTimeFormat;static injectSearchAdvancedCondition(t){u.searchAdvancedCondition=t}constructor(){throw new Error("Cannot instantiate static class 'SearchFacetDialogHelper'")}static init(t){u.POS_FACET_LIST=0;u.POS_TOOLBAR_SEARCHFIELD=0;u.POS_TOOLBAR_TOGGLEBUTTON=1;u.POS_SETTING_CONTAINER=0;u.POS_ATTRIBUTE_LIST_CONTAINER=1;u.POS_ICONTABBAR=0;u.POS_TABBAR_LIST=0;u.POS_TABBAR_CONDITION=1;u.POS_SORTING_SELECT=0;u.POS_SHOWONTOP_CHECKBOX=1;u.POS_ADVANCED_CHECKBOX=0;u.POS_ADVANCED_INPUT_LAYOUT=1;u.POS_ADVANCED_BUTTON=2;u.bResetFilterIsActive=false;const e={decimals:2};u.oFloatNumberFormat=n.getFloatInstance(e);u.oIntegernumberFormat=n.getIntegerInstance();u.oDateFormatOptions={pattern:"yyyy/MM/dd",UTC:false};u.oTimestampFormatOptions={pattern:"yyyy-MM-dd HH:mm:ss.SSSSSSS",UTC:true};u.oDateFormat=s.getDateTimeInstance(u.oDateFormatOptions);u.oTimestampFormat=s.getDateTimeInstance(u.oTimestampFormatOptions);u.dialog=t}static getFacetList(){const t=u.dialog.oSplitContainer.getMasterPages()[0];return t.getContent()[u.POS_FACET_LIST]}static updateDetailPage(t,e,n){const o=u.dialog.getModel();const a=u.dialog.getModel("searchModel");const i=t.getBindingContext().sPath;const r=o.getProperty(i);const s=o.getAttributeDataType(r);const g=u.getFacetList().indexOfAggregation("items",t);const l=u.dialog.oSplitContainer.getDetailPages()[g];const c=l.getBindingContext().getObject();if(c.facetType===O.Hierarchy){const t=c;d(o,t,o.aFilters);u.dialog.oSplitContainer.toDetail(l.getId(),"show",null,null);return}let C,T,A,S;if(s==="string"||s==="text"){C=l.getContent()[u.POS_ICONTABBAR].getAggregation("items")[u.POS_TABBAR_LIST].getContent()[0].getContent()[u.POS_ATTRIBUTE_LIST_CONTAINER];T=l.getContent()[u.POS_ICONTABBAR].getAggregation("items")[u.POS_TABBAR_LIST].getContent()[0].getContent()[u.POS_ATTRIBUTE_LIST_CONTAINER].getContent()[0];A=l.getContent()[u.POS_ICONTABBAR].getAggregation("items")[u.POS_TABBAR_CONDITION].getContent()[0];S=l.getContent()[u.POS_ICONTABBAR].getAggregation("items")[u.POS_TABBAR_LIST].getContent()[0].getContent()[u.POS_SETTING_CONTAINER]}else{C=l.getContent()[u.POS_ATTRIBUTE_LIST_CONTAINER];T=l.getContent()[u.POS_ATTRIBUTE_LIST_CONTAINER].getContent()[0];A=l.getContent()[u.POS_ATTRIBUTE_LIST_CONTAINER];S=l.getContent()[u.POS_SETTING_CONTAINER]}const _=l.getId();u.dialog.oSplitContainer.toDetail(_,"show",null,null);u.dialog.resetIcons(o,i,u.dialog);C.setBusy(true);const m={sAttribute:r.dimension,sBindingPath:i,sAttributeLimit:1e3,bInitialFilters:n};if(s==="number"){m.sAttributeLimit=20}if(!o.chartQuery){o.chartQuery=o.sinaNext.createChartQuery({filter:o.getProperty("/uiFilter").clone(),dimension:r.dimension,top:1e3})}u.applyChartQueryFilter(g);if(e){const t=o.sinaNext.createSimpleCondition({attribute:r.dimension,operator:o.sinaNext.ComparisonOperator.Bw,value:e});if(!u.bResetFilterIsActive){o.chartQuery.filter.autoInsertCondition(t)}}else{if(e===undefined&&(s==="string"||s==="text")){l.getContent()[u.POS_ICONTABBAR].getAggregation("items")[u.POS_TABBAR_LIST].getContent()[0].getSubHeader().getContent()[u.POS_TOOLBAR_SEARCHFIELD].setValue("")}}o.chartQuery.filter.searchTerm=a.getSearchBoxTerm();o.facetDialogSingleCall(m).then(()=>{const t=o.getProperty(l.getBindingContext().getPath()).items;const e=o.getProperty(l.getBindingContext().getPath())?.facetTotalCount;if(A.data("initial")){u.initiateAdvancedConditions(A,t,A.data("dataType"))}const n=S.getItems()[u.POS_SHOWONTOP_CHECKBOX];if(T.getSelectedContexts().length>0){n.setEnabled(true)}u.updateDetailPageListItemsSelected(T,A);u.dialog.updateDetailPageCharts(t,e)})}static applyChartQueryFilter(t){const e=u.dialog.getModel();e.resetChartQueryFilterConditions();const n=u.dialog.oSplitContainer.getDetailPages();for(let o=0;o<n.length;o++){const a=n[o];if(o===t||a.getContent().length===0){continue}const i=a.getBindingContext().getObject();if(i instanceof C){this.applyDynamicHierarchyChartQueryFilter(i,e);continue}let r;if(!a.getContent()[u.POS_ATTRIBUTE_LIST_CONTAINER]){r=a.getContent()[u.POS_ICONTABBAR].getAggregation("items")[u.POS_TABBAR_LIST].getContent()[0].getContent()[u.POS_ATTRIBUTE_LIST_CONTAINER].getContent()[0]}else{r=a.getContent()[u.POS_ATTRIBUTE_LIST_CONTAINER].getContent()[0]}for(let t=0;t<r.getItems().length;t++){const n=r.getItems()[t];const o=n.getBindingContext().getObject();const a=o.filterCondition;if(a.attribute||a.conditions){if(n.getSelected()&&!u.bResetFilterIsActive){e.chartQuery.filter.autoInsertCondition(a)}}}u.applyAdvancedCondition(a,u.getFacetList().getItems()[o].getBindingContext().getObject(),u.dialog.getModel())}}static applyDynamicHierarchyChartQueryFilter(t,e){for(const n of e.aFilters){const o=n;const a=o.filterCondition;if(a instanceof T&&a.attribute===t.attributeId){e.chartQuery.filter.autoInsertCondition(a.clone())}}}static resetChartQueryFilters(){const t=u.dialog.getModel();t.resetChartQueryFilterConditions();const e=u.dialog.oSplitContainer.getDetailPages();for(let t=0;t<e.length;t++){if(e[t].getContent().length===0){continue}const n=e[t].getBindingContext().getObject();if(n instanceof C){continue}let o;if(!e[t].getContent()[u.POS_ATTRIBUTE_LIST_CONTAINER]){o=e[t].getContent()[u.POS_ICONTABBAR].getAggregation("items")[u.POS_TABBAR_LIST].getContent()[0].getContent()[u.POS_ATTRIBUTE_LIST_CONTAINER].getContent()[0]}else{o=e[t].getContent()[u.POS_ATTRIBUTE_LIST_CONTAINER].getContent()[0]}for(let t=0;t<o.getItems().length;t++){const e=o.getItems()[t];const n=e.getBindingContext().getObject();const a=n.filterCondition;if(a.attribute||a.conditions){if(e.getSelected()){e.setSelected(false)}}}}}static applyAdvancedCondition(t,e,n){const a=u.dialog.getModel();let i,r,s,g,l,C,d,T;if(t.getContent()[u.POS_ATTRIBUTE_LIST_CONTAINER]){const O=t.getContent()[u.POS_ATTRIBUTE_LIST_CONTAINER];i=O.data("dataType");r=O.getContent();switch(i){case"timestamp":case"date":u.oDateTimeFormat=i==="timestamp"?u.oTimestampFormat:u.oDateFormat;for(s=1;s<r.length;s++){g=r[s];l=g.getContent()[u.POS_ADVANCED_CHECKBOX];const t=g.getContent()[u.POS_ADVANCED_INPUT_LAYOUT];if(l.getSelected()&&t.getDateValue()&&t.getSecondDateValue()){const o=new Date(t.getSecondDateValue().getFullYear(),t.getSecondDateValue().getMonth(),t.getSecondDateValue().getDate(),23,59,59);const r=u.oDateTimeFormat.format(t.getDateValue());const s=u.oDateTimeFormat.format(o);C=a.sinaNext.createSimpleCondition({attribute:e.dimension,attributeLabel:e.title,operator:a.sinaNext.ComparisonOperator.Ge,value:i==="timestamp"?t.getDateValue():r,valueLabel:r});d=a.sinaNext.createSimpleCondition({attribute:e.dimension,attributeLabel:e.title,operator:a.sinaNext.ComparisonOperator.Le,value:i==="timestamp"?o:s,valueLabel:s});T=a.sinaNext.createComplexCondition({valueLabel:t.getValue(),operator:a.sinaNext.LogicalOperator.And,conditions:[C,d],userDefined:true});if(!u.bResetFilterIsActive){n.addFilterCondition(T,false)}}}break;case"integer":case"number":u.oNumberFormat=i==="integer"?u.oIntegernumberFormat:u.oFloatNumberFormat;for(s=1;s<r.length;s++){g=r[s];l=g.getContent()[u.POS_ADVANCED_CHECKBOX];const t=g.getContent()[u.POS_ADVANCED_INPUT_LAYOUT].getContent()[0];const i=g.getContent()[u.POS_ADVANCED_INPUT_LAYOUT].getContent()[2];const O=g.getContent()[u.POS_ADVANCED_INPUT_LAYOUT].getContent()[1];const A=u.oNumberFormat.parse(t.getValue());const S=u.oNumberFormat.parse(i.getValue());if(l.getSelected()){const t=u.dialog.getModel("searchModel");if(!isNaN(A)&&!isNaN(S)&&S>=A){C=a.sinaNext.createSimpleCondition({attribute:e.dimension,attributeLabel:e.title,operator:a.sinaNext.ComparisonOperator.Ge,value:A,valueLabel:u.oNumberFormat.format(A),userDefined:true});d=a.sinaNext.createSimpleCondition({attribute:e.dimension,attributeLabel:e.title,operator:a.sinaNext.ComparisonOperator.Le,value:S,valueLabel:u.oNumberFormat.format(S),userDefined:true});T=a.sinaNext.createComplexCondition({valueLabel:u.oNumberFormat.format(A)+O.getText()+u.oNumberFormat.format(S),operator:a.sinaNext.LogicalOperator.And,conditions:[C,d],userDefined:true});if(!u.bResetFilterIsActive){n.addFilterCondition(T,false)}}else if(S<A){const e={type:o.Error,title:c.getText("filterInputErrorTitle"),description:c.getText("filterInputErrorRange")};t.pushUIMessage(e);u.dialog.bConditionValidateError=true}else{const e={type:o.Error,title:c.getText("filterInputErrorTitle"),description:c.getText("filterInputError")};t.pushUIMessage(e);u.dialog.bConditionValidateError=true}}}break;default:break}}else{const o=t.getContent()[u.POS_ICONTABBAR].getItems()[u.POS_TABBAR_CONDITION].getContent()[0];i=o.data("dataType");r=o.getContent();let l,c,C,d,T;switch(i){case"string":for(s=0;s<r.length-1;s++){g=r[s];l=g.getContent()[u.POS_ADVANCED_INPUT_LAYOUT].getContent()[0];c=g.getContent()[u.POS_ADVANCED_INPUT_LAYOUT].getContent()[1];C=c.getValue();switch(l.getSelectedKey()){case"eq":T=a.sinaNext.ComparisonOperator.Eq;break;case"ew":T=a.sinaNext.ComparisonOperator.Ew;break;case"bw":T=a.sinaNext.ComparisonOperator.Bw;break;case"co":T=a.sinaNext.ComparisonOperator.Co;break;default:T=a.sinaNext.ComparisonOperator.Eq;break}if(c.getValue()){d=a.sinaNext.createSimpleCondition({attribute:e.dimension,attributeLabel:e.title,operator:T,value:C,valueLabel:C,userDefined:true});if(!u.bResetFilterIsActive){n.addFilterCondition(d,false)}}}break;case"text":for(s=0;s<r.length-1;s++){g=r[s];l=g.getContent()[u.POS_ADVANCED_INPUT_LAYOUT].getContent()[0];c=g.getContent()[u.POS_ADVANCED_INPUT_LAYOUT].getContent()[1];C=c.getValue();switch(l.getSelectedKey()){case"co":T=a.sinaNext.ComparisonOperator.Co;break;default:T=a.sinaNext.ComparisonOperator.Eq}if(c.getValue()){d=a.sinaNext.createSimpleCondition({attribute:e.dimension,attributeLabel:e.title,operator:T,value:C,valueLabel:C,userDefined:true});if(!u.bResetFilterIsActive){n.addFilterCondition(d,false)}}}break;default:break}}}static initiateAdvancedConditions(t,e,n){let o,a,i,r,s;const g=u.dialog.getModel();for(let l=e.length;l>0;l--){const c=e[l-1];if(c.advanced){o=t.getContent();if(n==="string"||n==="text"){a=o[o.length-2]}else{a=o[o.length-1]}i=a.getContent()[u.POS_ADVANCED_CHECKBOX];i.setSelected(true);r=a.getContent()[u.POS_ADVANCED_INPUT_LAYOUT];switch(n){case"integer":case"number":{const t=r.getContent()[0];const e=r.getContent()[2];if(c.filterCondition.conditions){for(let n=0;n<c.filterCondition.conditions.length;n++){const o=c.filterCondition.conditions[n];if(o.operator==="Ge"){t.setValue(o.valueLabel||u.oNumberFormat.format(o.value))}if(o.operator==="Le"){e.setValue(o.valueLabel||u.oNumberFormat.format(o.value))}}}break}case"string":s=c.filterCondition.operator;if(s==="Co"){r.getContent()[0].setSelectedKey("co")}else if(s==="Ew"){r.getContent()[0].setSelectedKey("ew")}else if(s==="Bw"){r.getContent()[0].setSelectedKey("bw")}r.getContent()[1].setValue(c.filterCondition.valueLabel);break;case"text":s=c.filterCondition.operator;if(s==="Co"){r.getContent()[0].setSelectedKey("co")}r.getContent()[1].setValue(c.filterCondition.valueLabel);break;default:r.setValue(c.label);break}u.insertNewAdvancedCondition(a,n);g.changeFilterAdvaced(c,true)}}t.data("initial",false)}static updateDetailPageListItemsSelected(t,e){const n=e.data("dataType");u.sortingAttributeList(t.getParent().getParent());t.getParent().setBusy(false);if(n==="date"||n==="timestamp"||n==="number"||n==="integer"){t.focus()}}static removeAdvancedCondition(t,e,n){const o=t.getContent();let a,i,r;if(n==="string"||n==="text"){for(let t=0;t<o.length-1;t++){a=o[t];i=a.getContent()[u.POS_ADVANCED_INPUT_LAYOUT].getContent()[1];if(i.getProperty("value")){const n=i.getValue();const o=e.getBindingContext().getObject();if(n===o.filterCondition.value){r=t;break}}}}t.removeContent(r)}static sortingAttributeList(t){const n=t.getContent()[u.POS_SETTING_CONTAINER];const o=n.getItems()[u.POS_SORTING_SELECT].getItems()[0];const a=n.getItems()[u.POS_SHOWONTOP_CHECKBOX];const i=t.getContent()[u.POS_ATTRIBUTE_LIST_CONTAINER].getContent()[0];const r=i.data("dataType");const s=i.getBinding("items");const g=[];if(a.getSelected()){g.push(new e("selected",true,false))}switch(o.getSelectedKey()){case"sortName":g.push(new e("label",false,false));break;case"sortCount":g.push(new e("value",true,false));if(r==="string"||r==="text"){g.push(new e("label",false,false))}break;default:break}s.sort(g)}static insertNewAdvancedCondition(t,e){const n=t.getParent();const o=new u.searchAdvancedCondition("",{type:e});if(e==="string"||e==="text"){const t=n.getContent().length-1;n.insertContent(o,t)}else{const e=n.indexOfContent(t);if(e===n.getContent().length-1){n.addContent(o)}}}static deleteAdvancedCondition(t){const e=t.getParent();const n=t.getParent().getParent().getParent().getParent().getParent();e.removeContent(t);u.updateCountInfo(n)}static updateCountInfo(t){const e=u.getFacetList();let n=e.getSelectedItem();if(!n){n=e.getItems()[0]}const o=n.getBindingContext().getModel();const a=n.getBindingContext().getPath();const i=o.getProperty(a).dimension;const r=o.aFilters;let s=0;for(const t of r){if(!t.advanced&&t.facetAttribute===i){s++}}let g;const l=o.getAttributeDataType(o.getProperty(a));if(l==="string"||l==="text"){g=t.getContent()[u.POS_ICONTABBAR].getItems()[u.POS_TABBAR_CONDITION].getContent()[0]}else{g=t.getContent()[u.POS_ATTRIBUTE_LIST_CONTAINER]}const c=g.getContent();let C=0;for(const t of c){if(typeof t.getContent==="function"){const e=t.getContent()[0];if(e.getSelected()){C++}}}const d=o.getProperty(a).facetType;if(d===O.Attribute){const t=s+C;o.setProperty(a+"/count",t);u.dialog.resetEnabledForFilterResetButton()}}}return u});
//# sourceMappingURL=SearchFacetDialogHelper.js.map