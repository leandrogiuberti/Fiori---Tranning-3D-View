/*!
 * SAPUI5
 * Copyright (c) 2025 SAP SE or an SAP affiliate company. All rights reserved.
 * 
 */
sap.ui.define(["./i18n","sap/base/Log","./error/ErrorHandler","sap/esh/search/ui/SearchHelper","sap/ui/model/json/JSONModel","sap/esh/search/ui/SearchResultFormatter","sap/esh/search/ui/SearchTabStripsFormatter","sap/esh/search/ui/SearchResultTableFormatter","sap/esh/search/ui/SearchFacetsFormatter","sap/esh/search/ui/BreadcrumbsFormatter","sap/esh/search/ui/suggestions/SuggestionHandler","sap/esh/search/ui/SearchConfiguration","sap/esh/search/ui/personalization/PersonalizationStorage","sap/esh/search/ui/personalization/keyValueStoreFactory","sap/esh/search/ui/eventlogging/EventLogger","sap/esh/search/ui/SearchUrlParser","sap/esh/search/ui/cFLPUtil","sap/esh/search/ui/usercategories/UserCategoryManager","sap/esh/search/ui/error/errors","sap/esh/search/ui/RecentlyUsedStorage","./sinaNexTS/sina/SinaConfiguration","./sinaNexTS/sina/sinaFactory","./SearchResultItemMemory","./FolderModeUtils","sap/ui/core/message/MessageType","./sinaNexTS/sina/HierarchyDisplayType","./UIEvents","./SearchShellHelperHorizonTheme","sap/base/util/merge","sap/base/assert","sap/ui/Device","sap/ui/core/EventBus","./sinaNexTS/core/core","./BusyIndicator","./sinaNexTS/sina/Filter","./SinaConfigurator","./UrlUtils","./suggestions/SearchSuggestionFactory","./PublicSearchModel","./personalization/PersonalizationKeys","./eventlogging/TechnicalEvents","./SelectionMode"],function(e,t,r,s,i,o,a,n,l,h,c,u,f,p,y,g,d,S,b,P,m,C,T,w,F,D,R,v,A,E,M,I,x,V,B,_,O,H,N,U,q,L){"use strict";function z(e){return e&&e.__esModule&&typeof e.default!=="undefined"?e.default:e}function j(e){return new Promise(function(t,r){sap.ui.require([e],function(r){if(!(r&&r.__esModule)){r=r===null||!(typeof r==="object"&&e.endsWith("/library"))?{default:r}:r;Object.defineProperty(r,"__esModule",{value:true})}t(r)},function(e){r(e)})})}const k=z(e);const Q=z(r);const K=a["Formatter"];const $=b["SearchTermExceedsLimitsError"];const W=b["UrlParseError"];const G=m["AvailableProviders"];const J=z(T);const Y=w["FolderModeResultViewTypeCalculator"];const X=D["HierarchyDisplayType"];const Z=z(R);const ee=z(v);const te=V["BusyIndicator"];const re=B["Filter"];const se=_["SinaConfigurator"];const ie=O["renderUrlFromParameters"];const oe=H["createSearchSuggestionForCurrentSearch"];const ae=z(N);const ne=U["PersonalizationKeys"];const le=q["TechnicalEventType"];const he=L["SelectionMode"];const ce=i.extend("sap.esh.search.ui.SearchModel",{selectKey:function e(t){this._selectedKeys[t]=true},deselectKey:function e(t){delete this._selectedKeys[t]},isKeySelected:function e(t){return!!this._selectedKeys[t]},resetKeyStore:function e(){this._selectedKeys={}},forgetMissingSelections:function e(t){const r=new Set(t.map(e=>e.key));Object.keys(this._selectedKeys).forEach(e=>{if(!r.has(e)){delete this._selectedKeys[e]}})},constructor:function e(r){i.prototype.constructor.call(this,[]);this.searchTermHandlers=[];this.logger=t.getLogger("sap.esh.search.ui.SearchModel");this._selectedKeys={};i.prototype.setProperty.call(this,"/errors",[]);const o=r||{};const a=!!o.searchModel;this.errorHandler=Q.getInstance();if(!a){this.errorHandler.setSearchModel(this)}this.config=new u(o?.configuration);if(!a){this.errorHandler.setExternalOnErrorHandler(this.config.onErrorHandler)}this.publicSearchModel=new ae({modelName:ae.defaultModelName,internalSearchModel:this});this.searchResultSetItemMemory=new J;this.setSizeLimit(1e3);this._suggestionHandler=new c({model:this});this.folderModeResultViewTypeCalculator=new Y(this);this._performanceLoggerSearchMethods=[];this._searchApplicationsRefuseOutdatedReq=s.refuseOutdatedRequests(this.searchApplications.bind(this),"search");this.pageSize=this.config.pageSize||10;this.appTopDefault=20;this.boTopDefault=this.pageSize;this.filterChanged=false;this.busyIndicator=new te(this);this.setProperty("/isQueryInvalidated",true);this.setProperty("/busyDelay",0);this.setProperty("/sortableAttributes",[]);this.setProperty("/results",[]);this.setProperty("/appResults",[]);this.setProperty("/boResults",[]);this.resetTableData();this.setProperty("/breadcrumbsHierarchyNodePaths",[]);this.setProperty("/breadcrumbsHierarchyAttribute","");this.setProperty("/hierarchyNodePaths",[]);this.setProperty("/isFolderMode",false);this.setProperty("/origBoResults",[]);this.setProperty("/count",0);this.setProperty("/countText","");this.setProperty("/boCount",0);this.setProperty("/appCount",0);this.setProperty("/facets",[]);this.setProperty("/dataSources",[this.allDataSource,this.appDataSource]);this.setProperty("/appSearchDataSource",null);this.setProperty("/currentPersoServiceProvider",null);this.setProperty("/businessObjSearchEnabled",true);this.setProperty("/initializingObjSearch",false);this.setProperty("/suggestions",[]);this.setProperty("/resultViewTypes",[]);this.setProperty("/resultViewType","");this.setProperty("/resultViewSwitchVisibility",false);this.setProperty("/resultviewSelectionVisibility",false);this.setProperty("/documentTitle","Search");this.setProperty("/top",this.boTopDefault);this.setProperty("/orderBy",{});this.setProperty("/facetVisibility",false);this.setProperty("/focusIndex",0);this.setProperty("/isErrorPopovered",false);this.setProperty("/nlqExplanation",{});this.setProperty("/nlqResult",{success:false,filterDescription:""});this.setProperty("/firstSearchWasExecuted",false);this.setProperty("/multiSelectionAvailable",false);this.setProperty("/multiSelectionEnabled",false);this.setProperty("/multiSelection/actions",[]);this.setProperty("/multiSelectionSelected",false);this.setProperty("/multiSelectionObjects",[]);this.setProperty("/singleSelectionSelected",false);this.setProperty("/inputHelpSelectedItems",null);this.setProperty("/inputHelp",null);this.setProperty("/config",this.config);this.setProperty("/searchInLabel","");this.setProperty("/searchInIcon","sap-icon://none");this.setProperty("/searchButtonStatus","Search");this.setProperty("/isNlqActive",false);this._subscribers=[];this.searchUrlParser=new g({model:this});this._userCategoryManagerPromise=null;this._tempDataSources=[];this.tableFormatter=undefined;if(o?.searchModel?.initAsyncPromise){this.initAsyncPromise=o.searchModel.initAsyncPromise;this.oFacetFormatter=new l(this)}this.initializationStatus=this.initAsync();this.initAsyncPromise=this.initializationStatus.catch(()=>{})},getInitializationStatus:async function e(){try{await this.initializationStatus;return{success:true}}catch(e){return{success:false,error:e}}},initAsync:async function e(){if(this.initAsyncPromise){return this.initAsyncPromise}this.setProperty("/initializingObjSearch",true);this.busyIndicator.setBusy(true);const t={label:k.getText("genericLoading"),labelPlural:k.getText("genericLoading"),enabled:false,id:"$$Loading$$"};this.setProperty("/dataSource",t);this.setProperty("/dataSources",[t]);try{const e=await p.create(this.config.personalizationStorage,this.config.isUshell,this.config.id);this.setPersonalizationStorageInstance(new f(e,this));if(this.config.bRecentSearches){this.recentlyUsedStorage=new P({personalizationStorage:this._personalizationStorage,searchModel:this})}this.initFacetVisibility();this.sinaNext=await this.createSina();this.sinaNext.createSearchNavigationTarget=this.createSearchNavigationTarget.bind(this);this.createAllAndAppDataSource();this.calculateIsNlqActive();if(this.isMyFavoritesAvailable()){this.userCategoryManager=await S.create({sina:this.sinaNext,personalizationStorage:this._personalizationStorage})}const t={sinaNext:this.sinaNext,searchModel:this,eventConsumers:this.config.eventConsumers};this.eventLogger=new y(t);await this.eventLogger.initAsync();this.setProperty("/defaultDataSource",this.calculateDefaultDataSource());if(this.sinaNext.provider.id==="dummy"){this.setProperty("/defaultDataSource",this.appDataSource);this.setProperty("/businessObjSearchEnabled",false);this.config.searchBusinessObjects=false;this.setFacetVisibility(false,false)}if(this.sinaNext.provider.id==="inav2"&&this.config.isUshell){sap.ui.require(["sap/ushell/System"],e=>{sap.ushell["Container"].addRemoteSystem(new e({alias:"ENTERPRISE_SEARCH",platform:"abap",baseUrl:"/ENTERPRISE_SEARCH"}))})}this.setProperty("/uiFilter",this.sinaNext.createFilter());this.loadDataSources();this.resetDataSource(false);this.resetAllFilterConditions(false);this.query=this.sinaNext.createSearchQuery({limitAjaxRequests:this.config.limitAjaxRequests});this.query.setMultiSelectFacets(true);this.oFacetFormatter=new l(this);this._tabStripFormatter=new K(this.allDataSource,this);this._breadcrumbsFormatter=new h.Formatter(this);this.dataSourceTree=this._tabStripFormatter.tree;this.setSearchBoxTerm(this.config.searchTerm,false);if(this.config.exclusiveDataSource){this.setDataSourceById(this.config.exclusiveDataSource,false,false)}else if(this.config.dataSource){this.setDataSourceById(this.config.dataSource,false,false)}if(this.config.filterRootCondition){this.setFilterRootCondition(this.config.filterRootCondition,false)}this.setProperty("/initializingObjSearch",false);this.busyIndicator.setBusy(false);try{await this.config.initAsync(this)}catch(e){this.errorHandler.onError(e)}if(this.config.isUshell){const{default:e}=await j("sap/ushell/Container");this.uShellVisualizationInstantiationService=await e.getServiceAsync("VisualizationInstantiation")}if(this.config.isUshell&&this.config.FF_enableTCodes){const{default:e}=await j("sap/esh/search/ui/searchtermhandler/TransactionsHandler");this.searchTermHandlers.push(new e(this))}}catch(e){this.errorHandler.onError(e);return Promise.reject(e)}finally{this.busyIndicator.setBusy(false)}const r={type:le.SESSION_START,searchTerm:this.getSearchBoxTerm(),dataSourceKey:this.getDataSource().id,top:this.getTop(),filter:this.getFilterRootCondition()+""};this.eventLogger.logTechnicalEvent(r);return Promise.resolve()},createSina:async function e(){if(!this.config.searchBusinessObjects){return C.createAsync("dummy")}let t=[];if(window.location.href.indexOf("demo/FioriLaunchpad.")!==-1){t=[G.SAMPLE]}else{t=[G.ABAP_ODATA,G.INAV2,G.DUMMY]}t=await d.readCFlpConfiguration(t);if(this.config.sinaConfiguration){t=[this.config.sinaConfiguration]}const r=new se(this);t=r.configure(t);const s=await C.createByTrialAsync(t);if(s.hasErrors()){s.getErrors().forEach(e=>this.errorHandler.onError(e))}return s},initBusinessObjSearch:async function e(){return this.initAsync()},calculateDefaultDataSource:function e(){let t=this.allDataSource;if(this.config.defaultSearchScopeApps){t=this.appDataSource}if(this.config.defaultDataSource){t=this.sinaNext.getDataSource(this.config.defaultDataSource)}if(this.config.exclusiveDataSource){t=this.sinaNext.getDataSource(this.config.exclusiveDataSource)}if(this.userCategoryManager&&this.userCategoryManager.isFavActive()){t=this.userCategoryManager.getCategory("MyFavorites")}return t},initFacetVisibility:function e(){if(!this.config.facets||this.config.optimizeForValueHelp){this.setFacetVisibility(false,false);return}let t;try{t=this._personalizationStorage.getItem(ne.searchFacetPanelButtonState)??this.config.facetVisibility??false}catch(e){this.logger.warning("Error reading facet visibility from personalization storage",e)}this.setFacetVisibility(t,false)},isBusinessObjSearchConfigured:function e(){try{const e=window["sap-ushell-config"].renderers.fiori2.componentData.config;return e.searchBusinessObjects!=="hidden"}catch(e){this.logger.debug("Error reading searchBusinessObjects from ushell config",e);return true}},isBusinessObjSearchEnabled:function e(){return this.getProperty("/businessObjSearchEnabled")},setProperty:function e(t,r,s,i){return this.setPropertyInternal(t,r,s,i,true)},setPropertyInternal:function e(t,r,s,o,a=true){try{if(t==="/resultViewType"){if(this.getProperty("/resultViewType")!==""&&r!==""&&this.getProperty("/resultViewType")!==r){this.notifySubscribers(Z.ESHResultViewTypeChanged);I.getInstance().publish(Z.ESHResultViewTypeChanged)}}if(t==="/uiFilter/searchTerm"){r=this.shortenSearchTermByConfigLimit(r)}if(t==="/resultviewSelectionVisibility"){if(r===false&&this.getProperty("/config/resultviewSelectionMode")!==he.None&&this.config.showSelectionToggleButton===false){r=true}}let e=i.prototype.setProperty.call(this,t,r,s,o);switch(t){case"/boResults":case"/appResults":this.calculateResultList();break;case"/appCount":case"/boCount":e=this.setProperty("/count",this.getProperty("/appCount")+this.getProperty("/boCount"));break;case"/count":e=this.setProperty("/countText",this._calculateCountText());break;case"expanded":if(s&&s.getPath().startsWith("/results/")){const e=s.getObject();if("key"in e&&e.key&&typeof r==="boolean"){const t=e;this.searchResultSetItemMemory.setExpanded(t.key,r)}}break}if(a){this.publicSearchModel?.setPropertyFromInternalModel(this,t,r,s,o)}return e}catch(e){this.errorHandler.onError(e)}},shortenSearchTermByConfigLimit:function e(t){const r=this.config.searchTermLengthLimit;if(r<0){return t}if(t.length>r){this.errorHandler.onError(new $(r));t=t.slice(0,r)}return t},_calculateCountText:function e(){const t=this.getProperty("/count");if(typeof t!=="number"){return""}const r=s.formatInteger(t);if(this.getProperty("/searchInLabel")){return(this.getProperty("/searchInLabel")||k.getText("results"))+" ("+r+")"}const i=k.getText("results")+" ("+r+")";return i},getSearchCompositeControlInstanceByChildControl:function e(t){if(typeof t?.hasStyleClass==="function"&&t.hasStyleClass("sapUshellSearchInputHelpPage")){return t}else if(typeof t?.getParent==="function"){return this.getSearchCompositeControlInstanceByChildControl(t.getParent())}return undefined},getPersonalizationStorageInstance:function e(){return this._personalizationStorage},setPersonalizationStorageInstance:function e(t){this._personalizationStorage=t},getSearchBoxTerm:function e(){return this.getProperty("/uiFilter/searchTerm")||""},setSearchBoxTerm:function e(t,r){t=t||"";const s=t.replace(/^\s+/,"");this.setProperty("/uiFilter/searchTerm",s);this.calculateSearchButtonStatus();if(r||typeof r==="undefined"){this.fireSearchQuery()}},getLastSearchTerm:function e(){return this.query.getSearchTerm()},setFacetVisibility:function e(t,r){if(M.system.phone){t=false}this.setProperty("/facetVisibility",t);try{this._personalizationStorage.setItem(ne.searchFacetPanelButtonState,t)}catch(e){this.logger.warning("Error writing facet visibility to personalization storage",e)}if(r||typeof r==="undefined"){this.fireSearchQuery()}},getFacetVisibility:function e(){return this.getProperty("/facetVisibility")},setResultviewSelectionVisibility:function e(t){this.setProperty("/resultviewSelectionVisibility",t)},getResultviewSelectionVisibility:function e(){return this.getProperty("/resultviewSelectionVisibility")},getTop:function e(){return this.getProperty("/top")},setTop:function e(t,r){if(t<0){this.resetTop();this.errorHandler.onError(new Error(`Could not set 'top' with value '${t}'.\nWe will use default value '${this.getProperty("/top")}' instead.`))}else{this.setProperty("/top",t)}if(r||typeof r==="undefined"){this.fireSearchQuery()}},resetTop:function e(){this.setProperty("/focusIndex",0);if(this.isAppCategory()||this.isUserCategory()&&this.userCategoryManager&&this.userCategoryManager.getCategory("MyFavorites").subDataSources.length===0){this.setTop(this.appTopDefault,false)}else{this.setTop(this.boTopDefault,false)}},getOrderBy:function e(){return this.getProperty("/orderBy")},setOrderBy:function e(t,r){this.setProperty("/orderBy",t);this.updateSortableAttributesSelection(t.orderBy);if(r||typeof r==="undefined"){this.fireSearchQuery()}},resetOrderBy:function e(t){this.setProperty("/orderBy",{});this.updateSortableAttributesSelection();if(t||typeof t==="undefined"){this.fireSearchQuery()}},updateSortableAttributesSelection:function e(t){const r=this.getProperty("/sortableAttributes");if(r.length===0){return}for(let e=0;e<r.length;e++){r[e].selected=false}const s=t===undefined?"DEFAULT_SORT_ATTRIBUTE":t;for(let e=0;e<r.length;e++){if(r[e].attributeId===s){r[e].selected=true}}this.setProperty("/sortableAttributes",r)},isEqualOrderBy:function e(t,r){if(!t.orderBy){return r.length===0}if(r.length!==1){return false}const s=r[0];if(s.id!==t.orderBy){return false}if(t.sortOrder==="ASC"){return s.order===this.sinaNext.SortOrder.Ascending}return s.order===this.sinaNext.SortOrder.Descending},isMyFavoritesAvailable:function e(){let t=false;if(this.sinaNext.provider.id==="abap_odata"){t=true}if(this.sinaNext.provider.id==="multi"&&this.config.userDefinedDatasourcesMulti){t=true}return t},calculateIsNlqActive:function e(){const t=!this.config.isUshell||this.getPersonalizationStorageInstance().getItem(ne.nlqActive);const r=this.config.aiNlq&&this.sinaNext.capabilities.nlq&&t;this.setProperty("/isNlqActive",r)},isNlqActive:function e(){return this.getProperty("/isNlqActive")},getDocumentTitle:function e(){const t=this.getSearchBoxTerm();const r=this.getDataSource().labelPlural||this.getDataSource().label;let s;if(this.getDataSource()===this.allDataSource){s=k.getText("searchTileTitleProposalAll",[t])}else{s=k.getText("searchTileTitleProposal",[t,r])}return s},resetQuery:function e(){if(this.getProperty("/initializingObjSearch")){return}s.hasher.reset();this.resetTop();this.setSearchBoxTerm("",false);this.resetDataSource(false);this.resetAllFilterConditions(false);this.query.resetConditions();this.query.setSearchTerm("random-jgfhfdskjghrtekjhg");this.setProperty("/facets",[]);this.setProperty("/results",[]);this.setProperty("/appResults",[]);this.setProperty("/boResults",[]);this.setProperty("/breadcrumbsHierarchyNodePaths",[]);this.setProperty("/breadcrumbsHierarchyAttribute","");this.setProperty("/hierarchyNodePaths",[]);this.setProperty("/isFolderMode",false);this.setProperty("/origBoResults",[]);this.setProperty("/count",0);this.setProperty("/boCount",0);this.setProperty("/appCount",0);this.setProperty("/nlqResult",{success:false,filterDescription:""})},resetSearchResultItemMemory:function e(){this.searchResultSetItemMemory.reset()},createAllAndAppDataSource:function e(){this.allDataSource=this.sinaNext.getAllDataSource();this.allDataSource.label=k.getText("label_all");this.allDataSource.labelPlural=k.getText("label_all");this.appDataSource=this.sinaNext._createDataSource({id:"$$APPS$$",label:k.getText("label_apps"),labelPlural:k.getText("label_apps"),type:this.sinaNext.DataSourceType.Category});this.setProperty("/appSearchDataSource",this.appDataSource)},getUserCategoryManager:async function e(){if(this._userCategoryManagerPromise){return this._userCategoryManagerPromise}this._userCategoryManagerPromise=this.initAsync().then(()=>this.userCategoryManager);return this._userCategoryManagerPromise},loadDataSources:function e(){let t=this.sinaNext.getBusinessObjectDataSources();t=t.slice();let r=[];t.forEach(function(e){if(!e.usage.appSearch){r.push(e)}});if(this.userCategoryManager&&this.userCategoryManager.isFavActive()){r.splice(0,0,this.userCategoryManager.getCategory("MyFavorites"));this.favDataSource=this.userCategoryManager.getCategory("MyFavorites")}if(this.config.isUshell){r.splice(0,0,this.appDataSource)}if(!this.config.searchScopeWithoutAll){r.splice(0,0,this.allDataSource)}else{if(!this.config.defaultDataSource&&(!this.userCategoryManager||this.userCategoryManager&&!this.userCategoryManager.isFavActive())){this.setProperty("/defaultDataSource",r[0])}}try{r=this.config.filterDataSources(r)}catch(e){this.errorHandler.onError(e)}this.setProperty("/dataSources",r);this.setProperty("/searchTermPlaceholder",this.calculatePlaceholder())},resetDataSource:function e(t){this.setDataSource(this.getDefaultDataSource(),t)},isAllCategory:function e(){const t=this.getProperty("/uiFilter/dataSource");return t===this.allDataSource},isOtherCategory:function e(){const t=this.getProperty("/uiFilter/dataSource");return(t.type===this.sinaNext.DataSourceType.Category||t.type===this.sinaNext.DataSourceType.UserCategory)&&!this.isAllCategory()},isAppCategory:function e(){const t=this.getProperty("/uiFilter/dataSource");return t===this.appDataSource},isUserCategory:function e(){const t=this.getProperty("/uiFilter/dataSource");return t.type===this.sinaNext.DataSourceType.UserCategory},isBusinessObject:function e(){return this.getProperty("/uiFilter/dataSource").type===this.sinaNext.DataSourceType.BusinessObject},isUserCategoryAppSearchOnlyWithoutBOs:function e(){return this.isUserCategory()&&this.userCategoryManager&&this.userCategoryManager.getCategory("MyFavorites").subDataSources.length===0},getDataSource:function e(){return this.getProperty("/uiFilter/dataSource")},getDefaultDataSource:function e(){return this.getProperty("/defaultDataSource")},setDataSourceById:function e(t,r,s){const i=this.sinaNext.getDataSource(t);if(i&&i.id&&i.id===t){this.setDataSource(i,r,s);return}throw new Error(`Could not set data source with id ${t} because it was not in the list of loaded data sources.`)},setDataSource:function e(t,r,s){if(this.getDataSource()!==t){const e={type:le.DATASOURCE_CHANGE,dataSourceKey:t.id,dataSourceKeyOld:this.getDataSource().id};this.eventLogger.logTechnicalEvent(e)}this.updateDataSourceList(t);this.getProperty("/uiFilter").setDataSource(t);if(s||s===undefined){this.resetTop()}this.setProperty("/searchTermPlaceholder",this.calculatePlaceholder());this.calculateSearchButtonStatus();if(r||r===undefined){this.fireSearchQuery()}},notifyFilterChanged:function e(){for(const e of this["aBindings"]){if(e.sPath==="/uiFilter/rootCondition"){e.checkUpdate(true)}}},getFilterRootCondition:function e(){let t;if(this.getProperty("/uiFilter")){t=this.getProperty("/uiFilter").rootCondition}return t},setFilterRootCondition:function e(t,r){if(t.type!=="Complex"){throw new Error("filter root condition must be of type ComplexCondition")}for(let e=0;e<t.conditions.length;e++){const r=t.conditions[e];if(r.type!=="Complex"){throw new Error("filters of root condition must be of type ComplexCondition")}for(let e=0;e<r.conditions.length;e++){const t=r.conditions[e];if(t.type!=="Simple"){throw new Error("filters of the lowest level must be of type SimpleCondition")}}}this.getProperty("/uiFilter").setRootCondition(t);if(r||typeof r==="undefined"){this.fireSearchQuery()}this.notifyFilterChanged()},addFilterCondition:function e(t,r){try{const e=this.getProperty("/uiFilter");if(typeof this.config.adjustFilters==="function"){this.config.adjustFilters(this,t)}if(t.attribute||t.conditions){e.autoInsertCondition(t)}else{this.setDataSource(t,false)}if(r||typeof r==="undefined"){this.fireSearchQuery()}this.notifyFilterChanged()}catch(e){this.errorHandler.onError(e)}},removeFilterCondition:function e(t,r){if(t.attribute||t.conditions){this.getProperty("/uiFilter").autoRemoveCondition(t)}else{this.setDataSource(t,false)}if(r||typeof r==="undefined"){this.fireSearchQuery()}this.notifyFilterChanged()},resetAllFilterConditions:function e(t){this.getProperty("/uiFilter").resetConditions();if(t||typeof t==="undefined"){this.fireSearchQuery()}this.notifyFilterChanged()},resetFilterByFilterConditions:function e(t){const r=this.getStaticHierarchyFilterConditions();this.getProperty("/uiFilter").resetConditions();if(r.length>0){for(const e of r){this.getProperty("/uiFilter").autoInsertCondition(e)}}if(t||typeof t==="undefined"){this.fireSearchQuery()}this.notifyFilterChanged()},setFilter:function e(t){this.setDataSource(t.dataSource,false);this.setSearchBoxTerm(t.searchTerm,false);const r=this.getProperty("/uiFilter");r.setRootCondition(t.rootCondition);this.fireSearchQuery()},hasStaticHierarchyFacetFilterConditionOnly:function e(){const t=this.getStaticHierarchyFilterConditions();return t.length>0&&t.length===this.getProperty("/uiFilter").rootCondition.conditions.length},getStaticHierarchyFilterConditions:function e(){const t=[];for(const e of this.getProperty("/uiFilter").rootCondition.getAttributes()){const r=this.getProperty("/uiFilter").dataSource.attributeMetadataMap[e];if(r&&r.isHierarchy===true&&r.hierarchyDisplayType===X.StaticHierarchyFacet){for(const r of this.getProperty("/uiFilter").rootCondition.getAttributeConditions(e)){t.push(r)}}}return t},doSuggestion:function e(){this._suggestionHandler.doSuggestion(this.getProperty("/uiFilter").clone())},abortSuggestions:function e(){this._suggestionHandler.abortSuggestions()},fireSearchQuery:async function e(t){try{await this.initAsync()}catch(e){return Promise.reject(e)}return this.doFireSearchQuery(t)},doFireSearchQuery:async function e(t){let r;if(typeof t==="object"&&"deserialization"in t){r=t.deserialization}else{r=t||undefined}const s=this.getProperty("/uiFilter");if(!s){return}if(s.equals(this.query.filter)&&this.getTop()===this.query.top&&this.isEqualOrderBy(this.getOrderBy(),this.query.sortOrder)&&this.getCalculateFacetsFlag()===this.query.calculateFacets&&!this.getProperty("/isQueryInvalidated")){return Promise.resolve()}this.query.setNlq(this.isNlqActive());const i=this.query.filter;const o=s;if(!i.equals(o)){this.resetKeyStore()}if(!r&&(this.query.filter.dataSource&&s.dataSource!==this.query.filter.dataSource||this.query.filter.searchTerm&&s.searchTerm!==this.query.filter.searchTerm)){this.resetOrderBy(false)}if(this.query.filter.dataSource&&s.dataSource!==this.query.filter.dataSource){this.oFacetFormatter.handleDataSourceChanged()}if(!r){if(!s.equals(this.query.filter)){this.resetTop()}}if(s.searchTerm!==this.query.filter.searchTerm||!s.rootCondition.equals(this.query.filter.rootCondition)){this._tabStripFormatter.invalidate(this.getDataSource())}if(this.getProperty("/isQueryInvalidated")===true||r&&this.config.reloadOnUrlChange){this.query.resetResultSet();this.setProperty("/isQueryInvalidated",false)}this.query.setFilter(s.clone());this.query.setTop(this.getTop());this.query.setSortOrder(this.assembleSortOrder());this.query.setCalculateFacets(this.getCalculateFacetsFlag());this.setProperty("/queryFilter",this.query.filter);this.notifySubscribers(Z.ESHSearchStarted);I.getInstance().publish(Z.ESHSearchStarted);if(r||!this.config.isUshell){this.setProperty("/busyDelay",0)}else{this.setProperty("/busyDelay",600)}this.busyIndicator.setBusy(true);this.abortSuggestions();this.updateSearchURLSilently(r);if(!r){this.resetSearchResultItemMemory()}this.logSearchRequestAdvanced();const a=`Search for '${this.getSearchBoxTerm()}' (logId:${this.config.performanceLogger?.getUniqueId()})`;this._performanceLoggerSearchMethods.push(a);this.config.performanceLogger?.enterMethod({name:a},{isSearch:true,comments:`Top: ${this.getTop()}, searchbox term: ${this.getSearchBoxTerm()}`});return Promise.all([this.normalSearch(),this.appSearch()]).then(()=>{this.calculateResultViewSwitchVisibility();this.setProperty("/tabStrips",this._tabStripFormatter.format(this.getDataSource(),this.resultSet,this));this.setProperty("/breadcrumbsHierarchyNodePaths",this._breadcrumbsFormatter.formatNodePaths(this.resultSet));this.setProperty("/breadcrumbsHierarchyAttribute",this._breadcrumbsFormatter.formatHierarchyAttribute(this.resultSet));this.setProperty("/hierarchyNodePaths",this.resultSet?.hierarchyNodePaths);this.setProperty("/isFolderMode",s.isFolderMode());if(this.config.bRecentSearches&&this.recentlyUsedStorage){const e=oe(this);if(e){this.recentlyUsedStorage.addItem(e)}}return this.oFacetFormatter.getFacets(this.getDataSource(),this.resultSet,this).catch(e=>{for(const e of this._performanceLoggerSearchMethods){this.config.performanceLogger?.leaveMethod({name:e})}this._performanceLoggerSearchMethods=[];return this.errorHandler.onErrorAsync(e)}).then(e=>{if(e?.length>0){e[0].change=Date.now();this.setProperty("/facets",e);e.forEach(e=>e.handleModelUpdate&&e.handleModelUpdate())}})}).catch(e=>{for(const e of this._performanceLoggerSearchMethods){this.config.performanceLogger?.leaveMethod({name:e})}this._performanceLoggerSearchMethods=[];return this.errorHandler.onErrorAsync(e)}).finally(()=>{try{if(this.config&&this.config.overwriteBrowserTitle===true){document.title=this.getDocumentTitle()}for(const e of this._performanceLoggerSearchMethods){this.config.performanceLogger?.leaveMethod({name:e})}this._performanceLoggerSearchMethods=[];this.notifySubscribers(Z.ESHSearchFinished);I.getInstance().publish(Z.ESHSearchFinished);this.busyIndicator.setBusy(false);this.setProperty("/firstSearchWasExecuted",true);this.notifyFilterChanged();this.updateMultiSelectionSelected()}catch(e){this.errorHandler.onError(e)}this.ensureOneTimeDisplayForErrorMessages()})},ensureOneTimeDisplayForErrorMessages:function e(){const t=this.getProperty("/errors");for(let e=0;e<t.length;++e){const r=t[e];if(r.shownToUser){t.splice(e,1);e--;continue}r.shownToUser=true}this.setProperty("/errors",t)},assembleSortOrder:function e(){const t=this.getOrderBy();if(!t.orderBy){return[]}let r=this.sinaNext.SortOrder.Ascending;if(t.sortOrder==="DESC"){r=this.sinaNext.SortOrder.Descending}return[{id:t.orderBy,order:r}]},getCalculateFacetsFlag:function e(){if(this.getDataSource().type===this.sinaNext.DataSourceType.Category||this.getFacetVisibility()){return true}return false},appSearch:function e(){if(!this.config.isUshell){return Promise.resolve(true)}this.setProperty("/appResults",[]);this.setProperty("/appCount",0);if(this.isBusinessObject()||this.isOtherCategory()&&!this.isAppCategory()&&!this.isUserCategory()||this.isUserCategory()&&this.userCategoryManager&&!this.userCategoryManager.getCategory("MyFavorites").includeApps){return Promise.resolve(true)}const t=this.query.filter.dataSource===this.allDataSource?this.appTopDefault:this.query.top;return this._searchApplicationsRefuseOutdatedReq(this.query.filter.searchTerm,t,0).then(e=>{this.setProperty("/appCount",e.totalResults);this.setProperty("/appResults",e.getElements())},e=>this.errorHandler.onErrorAsync(e))},searchApplications:async function e(t,r,s){if(this.config.isUshell){const{default:e}=await j("sap/ushell/Container");const i=await e.getServiceAsync("Search");return i.queryApplications({searchTerm:t,top:r,skip:s})}else{return Promise.resolve({totalResults:0,searchTerm:t,getElements:()=>[]})}},normalSearch:async function e(){if(!this.isBusinessObjSearchEnabled()||this.isAppCategory()||this.isUserCategory()&&this.userCategoryManager&&this.userCategoryManager.getCategory("MyFavorites").subDataSources.length===0){this.setProperty("/boResults",[]);this.setProperty("/breadcrumbsHierarchyNodePaths",[]);this.setProperty("/breadcrumbsHierarchyAttribute","");this.setProperty("/hierarchyNodePaths",[]);this.setProperty("/isFolderMode",false);this.setProperty("/origBoResults",[]);this.setProperty("/boCount",0);this.setProperty("/nlqExplanation",{});this.setProperty("/nlqResult",{success:false,filterDescription:""});this.resultSet=null;return}this.setDataSource(this.getDataSource(),false,false);this.query.setCalculateFacets(this.getCalculateFacetsFlag());try{const e=await this.query.getResultSetAsync();if(e.hasErrors()){e.getErrors().forEach(t=>{this.errorHandler.onError(t,{showMinorErrorsAsWarnings:e?.items?.length>0})})}this.dataSourceOfPreviousSearch=this?.resultSet?.query?.filter?.dataSource;this.resultSet=e;this.setProperty("/nlqResult",e.nlqResult);await this._afterSearchPrepareResultList(e)}catch(e){this.dataSourceOfPreviousSearch=this?.resultSet?.query?.filter?.dataSource;this.setProperty("/nlqResult",{success:false,filterDescription:""});this.errorHandler.onError(e)}},_afterSearchPrepareResultList:function e(t){this.setProperty("/boResults",[]);this.setProperty("/breadcrumbsHierarchyNodePaths",[]);this.setProperty("/breadcrumbsHierarchyAttribute","");this.setProperty("/hierarchyNodePaths",[]);this.setProperty("/isFolderMode",false);this.setProperty("/origBoResults",t.items);this.setProperty("/boCount",0);const r=new o(this);const s=r.format(t,this.query.filter.searchTerm);this.setProperty("/sortableAttributes",r.formatSortAttributes());this.forgetMissingSelections(s);this.setTableData(s);this.restoreResultSetItemExpansion(s);let i;const a=[];const n=[];for(let e=0;e<s.length;e++){i=s[e];a.push(i.dataSource);n.push({isDocumentConnector:i.isDocumentConnector})}const l=this.config.loadCustomModulesForDataSourcesAsync(a,n);const h=Promise.all([Promise.resolve(t),l]).then(e=>{const t=e[0];if(this.config&&typeof this.config.setSearchInLabelIconBindings==="function"){try{this.config.setSearchInLabelIconBindings(this,t.facets)}catch(e){const t=new b.ConfigurationExitError("setSearchInLabelIconBindings",this.config.applicationComponent,e);throw t}}for(const e of s){if(this.isKeySelected(e.key)){e.selected=true}}this.setProperty("/boCount",t.totalCount);this.setProperty("/boResults",s);this.enableOrDisableMultiSelection();return Promise.resolve()});return h},restoreResultSetItemExpansion:function e(t){for(const e of t){const t=this.searchResultSetItemMemory.getExpanded(e.key);if(typeof t!=="undefined"){e.expanded=t}}},enableOrDisableMultiSelection:function e(){if([he.MultipleItems].includes(this.config.resultviewSelectionMode)||this.config.enableMultiSelectionResultItems){this.setProperty("/multiSelectionAvailable",true);this.setProperty("/multiSelectionEnabled",true);return}const t=this.getDataSource();const r=this.config.getDataSourceConfig(t);const s=new r.searchResultListSelectionHandlerControl;if(s){this.setProperty("/multiSelectionAvailable",s.isMultiSelectionAvailable())}else{this.setProperty("/multiSelectionAvailable",false)}},updateMultiSelectionSelected:function e(){let t;if(this.getResultViewType()==="searchResultTable"){t=this.getProperty("/tableRows")}else{t=this.getProperty("/results")}let r=0;const s=[];for(let e=0;e<t.length;e++){if(t[e].selected){this.selectKey(t[e].key);r++;s.push(t[e])}else{this.deselectKey(t[e].key)}}if(r>0){this.setProperty("/multiSelectionSelected",true);this.setProperty("/multiSelectionObjects",s)}else{this.setProperty("/multiSelectionSelected",false);this.setProperty("/multiSelectionObjects",[])}if(r===1){this.setProperty("/singleSelectionSelected",true)}else{this.setProperty("/singleSelectionSelected",false)}this.notifySubscribers(Z.ESHSelectionChanged);I.getInstance().publish(Z.ESHSelectionChanged,this)},calculatePlaceholder:function e(){let t=this.getDataSource().labelPlural;if(this.isAllCategory()||this.config?.bPlaceHolderFixedValue===true){return k.getText("search")}else if(typeof this.config?.getSearchInputPlaceholderLabel==="function"){try{t=this.config?.getSearchInputPlaceholderLabel(this.getProperty("/uiFilter"))}catch(e){const t=new b.ConfigurationExitError("getSearchInputPlaceholderLabel",this.config.applicationComponent,e);this.errorHandler.onError(t)}}if(typeof t==="undefined"||t===null||t===""){t=this.getDataSource().labelPlural}return k.getText("searchInPlaceholder",[t])},updateDataSourceList:function e(t){const r=this.getProperty("/dataSources");this.removeTempDataSources();if(r.indexOf(t)>=0){return}r.unshift(t);this._tempDataSources.push(t);this.setProperty("/dataSources",r)},removeTempDataSources:function e(){const t=this.getProperty("/dataSources");this._tempDataSources.forEach((e,r,s)=>{const i=t.indexOf(e);if(i<0){const e=new Error("could not find temp DataSource in DataSources");throw new b.ProgramError(e)}t.splice(i,1);s.splice(r,1)})},invalidateQuery:function e(){this.setProperty("/isQueryInvalidated",true)},logSearchRequestAdvanced:function e(){const t={type:le.SEARCH_REQUEST,searchTerm:this.getSearchBoxTerm(),filter:this.getFilterRootCondition()+"",dataSourceKey:this.getDataSource().id,top:this.getTop()};if(this.getFilterRootCondition().conditions?.length>0){if(this.getSearchBoxTerm()){t.type=le.SEARCH_WITH_SEARCHTERM_FILTERS}else{t.type=le.SEARCH_WITH_FILTERS}}else{if(!this.getSearchBoxTerm()){t.type=le.SEARCH_WITHOUT_SEARCHTERM_FILTERS}else{t.type=le.SEARCH_WITH_SEARCHTERM}}this.eventLogger.logTechnicalEvent(t)},autoStartApp:function e(){const t=this.getProperty("/uiFilter/searchTerm");if(this.getProperty("/appCount")===1&&this.getProperty("/count")===1){const e=this.getProperty("/appResults");if(e&&e.length>0&&e[0]&&e[0].url&&t&&e[0].tooltip&&t.toLowerCase().trim()===e[0].tooltip.toLowerCase().trim()){if(e[0].url[0]==="#"){window.location.href=e[0].url}else{window.open(e[0].url,"_blank","noopener,noreferrer")}return}}},isHomogenousResult:function e(){if(this.isAllCategory()){return false}if(this.isOtherCategory()){return false}if(this.isAppCategory()){return false}return true},getResultViewTypes:function e(){return this.getProperty("/resultViewTypes")},setResultViewTypes:function e(t){this.setProperty("/resultViewTypes",t)},getResultViewType:function e(){return this.getProperty("/resultViewType")},setResultViewType:function e(t){this.setProperty("/resultViewType",t);if(this.isAppCategory()){return}else if(this.isAllCategory()||this.isOtherCategory()){try{this._personalizationStorage.setItem(ne.resultViewTypeForAllAndCategorySearch,t)}catch(e){this.logger.warning("Could not store resultViewTypeForAllAndCategorySearch in personalization storage",e)}}else{try{this._personalizationStorage.setItem(ne.resultViewTypeForBusinessObjectSearch,t)}catch(e){this.logger.warning("Could not store resultViewTypeForBusinessObjectSearch in personalization storage",e)}}},calculateResultViewSwitchVisibility:function e(t){this.validateResultViewSettings(t);if(t!==undefined){this.setResultViewTypes(t.resultViewTypes);this.setResultViewType(t.resultViewType);this.setProperty("/resultViewSwitchVisibility",t.resultViewTypes.length>1);return}let r;let s;if(this.isAppCategory()||this.isUserCategory()&&this.userCategoryManager&&this.userCategoryManager.getCategory("MyFavorites").subDataSources.length===0){r=["appSearchResult"];s="appSearchResult";this.setResultViewTypes(r);this.setResultViewType(s);this.setProperty("/resultViewSwitchVisibility",r.length>1);return}if(this.isAllCategory()||this.isOtherCategory()){if(this.config.isUshell){r=["searchResultList"];s="searchResultList"}else{r=["searchResultList","searchResultGrid"];try{s=this._personalizationStorage.getItem(ne.resultViewTypeForAllAndCategorySearch)}catch(e){this.logger.warning("Could not read resultViewTypeForAllAndCategorySearch from personalization storage",e)}if(s===undefined||s===null||s.length===0||!r.includes(s)){s="searchResultList"}}this.setResultViewTypes(r);this.setResultViewType(s);this.setProperty("/resultViewSwitchVisibility",r.length>1);return}r=this.config.resultViewTypes;try{if(this._personalizationStorage instanceof f)s=this._personalizationStorage.getItem(ne.resultViewTypeForBusinessObjectSearch)}catch(e){this.logger.warning("Could not read resultViewTypeForBusinessObjectSearch from personalization storage",e)}if(s===undefined||s===null||s.length===0||!r.includes(s)){s=this.config.fallbackResultViewType}s=this.folderModeResultViewTypeCalculator.calculate(r,s,this.getProperty("/uiFilter"));this.setResultViewTypes(r);this.setResultViewType(s);this.setProperty("/resultViewSwitchVisibility",r.length>1)},validateResultViewSettings:function e(t){let r;let i;let o;let a;let n;let l;if(typeof t==="undefined"){r=true}else{r=false}if(r){i=["searchResultList","searchResultTable","searchResultGrid"];o=this.config.resultViewTypes;a=this.config.fallbackResultViewType;n="\nERROR: Search Result View Settings of SearchConfiguration:\n\n";l=". \n Please check the validation and compatibility of resultViewTypes of SearchConfiguration!"}else{if(this.isAppCategory()){i=["appSearchResult"]}else if(this.isAllCategory()||this.isOtherCategory()){i=["searchResultList","searchResultGrid"]}else{i=["searchResultList","searchResultTable","searchResultGrid"]}o=t.resultViewTypes;a=t.resultViewType;n="\nERROR: Search Result View Settings of SearchCompositeControl\n\n";l=". \n Please check the validation and compatibility of resultViewTypes and resultViewType of SearchCompositeControl!"+"\n When adding a new resultViewType and making it active at the same time, make use of function 'setResultViewSettings' to apply both changes together."}if(!Array.isArray(o)||o.length===0){throw Error(n+"resultViewTypes should be non-empty array"+l)}let h=o;h=h.filter((e,t)=>h.indexOf(e)===t);if(h.length!==o.length){throw Error(n+"resultViewTypes ("+o.toString()+") should not have duplicated value"+l)}if(!s.isSubsetOf(o,i)){throw Error(n+"resultViewTypes ("+o.toString()+") contains invalid value. Possible values are ("+i.toString()+")"+l)}if(typeof a==="undefined"&&r){a=o[0];this.config.fallbackResultViewType=o[0]}if(typeof a!=="string"){throw Error(n+"resultViewType should be of string"+l)}if(!o.includes(a)){throw Error(n+"resultViewTypes ("+o.toString()+") doesn't contain resultViewType ("+a+")"+l)}},calculateSearchButtonStatus:function e(){if(!this.config.isUshell){this.setProperty("/searchButtonStatus","Search");return}if(this.getDataSource()===this.getProperty("/defaultDataSource")&&this.getSearchBoxTerm().length===0){if(ee.isSearchFieldExpandedByDefault()){this.setProperty("/searchButtonStatus","Focus")}else{this.setProperty("/searchButtonStatus","Close")}}else{this.setProperty("/searchButtonStatus","Search")}},calculateResultList:function e(){let t=[];const r=this.getProperty("/boResults");if(r&&r.length){t.push(...r)}const s=this.getProperty("/appResults");if(s&&s.length>0){const e={type:"appcontainer",tiles:s};if(t.length>0){if(t.length>3){t.splice(3,0,e)}else{t.push(e)}}else{t=[e]}}this.setProperty("/results",t)},pushUIMessage:function e(t){t.title=t.title==="[object Object]"?k.getText("searchError"):t.title;t.type=t.type!==undefined?t.type:F.Error;const r=this.getProperty("/errors");r.push(t);const s=this.removeAdjacentDuplicateMessages(r);this.setProperty("/errors",s)},removeAdjacentDuplicateMessages:function e(t){const r=[];let s;for(const e of t){if(typeof s==="undefined"){r.push(e)}else if(s.title!==e.title||s.description!==e.description||s.type!==e.type||s.shownToUser!==e.shownToUser){r.push(e)}s=e}return r},updateSearchURLSilently:function e(t){if(!t&&this.config.updateUrl){const e=this.createSearchNavigationTargetCurrentState().targetUrl;s.hasher.setHash(e)}},parseURL:function e(){this.searchUrlParser.parse()},subscribe:function e(t,r,s){this._subscribers.push({eventId:t||"",callback:r,listener:s||this});this.assertInternalEvents(t)},unsubscribe:function e(t,r,s){t=t||"";s=s||this;for(let e=0;e<this._subscribers.length;e++){const i=this._subscribers[e];if(i.eventId===t&&i.callback===r&&i.listener===s){this._subscribers.splice(e,1)}}this.assertInternalEvents(t)},assertInternalEvents:function e(t){const r=(new Error).stack;if(r.includes("sap/esh/search/ui/SearchCompositeControl")||r.includes("sap/esh/search/ui/library-preload")||r.includes("sap/esh/search/ui/SearchShellHelper")){}else{E(false,`Subscription to internal events ('${t}') of search library is only allowed for internal components.\nSubscribe to events of SearchCompositeControl:\n  - "searchStarted"        : Triggered when a search is started and the UI is waiting for results\n  - "searchFinished"       : Triggered as soon as the results are in and the UI finished its updates\n  - "selectionChanged"     : Triggered after selection changed (checkboxes of result items) \n  - "resultViewTypeChanged": Triggered after result view type got changed (list, table or grid)`)}},notifySubscribers:function e(t){for(const e of this._subscribers){if(e.eventId===t){e.callback.apply(e.listener,[t])}}},createSearchNavigationTarget:function e(t,r){let s;if(t instanceof re){s={filter:t,label:r}}else{s=t}s.updateUrl=s.updateUrl??this.config.updateUrl;s.top=s.top??this.config.pageSize??10;s.label=s.label??"Search";s.encodeFilter=s.encodeFilter??true;if(s.updateUrl){const e=ie(this,s.top,s.filter,s.encodeFilter,s.orderBy);return this.sinaNext.createNavigationTarget({targetUrl:e,text:s.label,target:"_self"})}else{return this.sinaNext.createNavigationTarget({targetFunction:()=>{this.setTop(s.top,false);if(s.orderBy){this.setOrderBy(s.orderBy,false)}this.setFilter(s.filter)},targetFunctionCustomData:{top:s.top,filter:s.filter,orderBy:s.orderBy},text:s.label})}},createSearchNavigationTargetCurrentState:function e(t){return this.createSearchNavigationTarget({top:this.getTop(),filter:this.getProperty("/uiFilter"),encodeFilter:true,orderBy:this.getOrderBy(),updateUrl:t?.updateUrl})},parseSearchNavigationTarget:function e(t){const r={filter:null};if(t.targetFunctionCustomData){return t.targetFunctionCustomData}let i=s.parseUrlParameters(t.targetUrl);if(x.isEmptyObject(i)){return undefined}try{i=this.config.parseSearchUrlParameters(i)}catch(e){this.errorHandler.onError(e)}if(i.top){r.top=parseInt(i.top,10)}if(i.orderby&&i.sortorder){r.orderBy={orderBy:i.orderby,sortOrder:i.sortorder}}if(i.filter){try{const e=JSON.parse(i.filter);r.filter=this.sinaNext.parseFilterFromJson(e)}catch(e){throw new W(e)}}return r},getTableColumns:function e(t){if(!t){return A([],this.getProperty("/tableColumns"))}else{return this.fetchTableColumns()}},fetchTableColumns:function e(){try{if(this.getProperty("/tableDataSource").length>0){const e=ne.searchResultTableState+this.getProperty("/tableDataSource");const t=this.getPersonalizationStorageInstance()?.getItem(e);if(this.isTablePersoStateValid(t)){return A([],t.aColumns)}return undefined}}catch(e){this.logger.warning("Could not fetch table columns from personalization storage",e);return undefined}},isTablePersoStateValid:function e(t){if(!t||t._persoSchemaVersion!=="p13n"||!Array.isArray(t.aColumns)){return false}for(const e of t.aColumns){if(e.p13NColumnName===undefined){return false}}return true},setTableColumns:function e(t,r){this.setProperty("/tableColumns",t);if(r){this.saveTableColumns(t)}},saveTableColumns:function e(t){try{if(this.getProperty("/tableDataSource").length>0){const e=ne.searchResultTableState+this.getProperty("/tableDataSource");this.getPersonalizationStorageInstance().setItem(e,{aColumns:t,_persoSchemaVersion:"p13n"})}}catch(e){this.logger.warning("Could not save table columns to personalization storage",e)}},getTableInitialColumns:function e(){if(!this.tableFormatter){this.tableFormatter=new n(this)}const t=this.getTableColumns(false);if(t?.length>0){return this.tableFormatter.formatInitialColumns(t)}else{return[]}},setTableData:function e(t){try{if(this.isHomogenousResult()){if(!this.tableFormatter){this.tableFormatter=new n(this)}if(t.length>0){this.setProperty("/tableDataSource",this.getDataSource().id);this.setTableColumns(this.tableFormatter.formatColumns(t),true);const e=this.tableFormatter.formatRows(t,this.getTableColumns(false));for(let r=0;r<e.length;r++){t[r].cells=e[r].cells}this.setProperty("/tableRows",t)}else{this.resetTableData()}}else{this.resetTableData()}}catch(e){this.logger.warning("Could not set table data",e);this.resetTableData()}},resetTableData:function e(){this.setProperty("/tableDataSource",undefined);this.setProperty("/tableColumns",[]);this.setProperty("/tableRows",[])}});ce._searchModels={};ce.getModelSingleton=function e(t,r){const s=r||"default";if(!ce._searchModels[s]){t.isUshell=s==="flp"?true:false;ce._searchModels[s]=new ce({configuration:t})}return ce._searchModels[s]};return ce});
//# sourceMappingURL=SearchModel.js.map