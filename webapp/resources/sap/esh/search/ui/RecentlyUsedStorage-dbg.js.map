{"version":3,"file":"RecentlyUsedStorage-dbg.js","names":["sap","ui","define","Log","___suggestions_SuggestionType","___personalization_PersonalizationKeys","Type","SuggestionType","RecentEntriesPosition","PersonalizationKeys","StorageVersion","objectSuggestionCopyProperties","searchSuggestionCopyProperties","transactionSuggestionsCopyProperties","RecentlyUsedStorage","personalizationStorage","_oLogger","maxItems","key","recentSearches","searchModel","constructor","properties","getLogger","deleteAllItems","deleteItem","save","getSerializedItemsInternal","serializedItems","getItem","filter","item","version","V2","getItems","currentFilter","query","map","serializedItem","deSerialize","uiSuggestionType","Search","equals","copyProperties","target","source","property","label","tmpResult","Object","titleNavigation","sinaNext","parseNavigationTargetFromJson","dataSource","getDataSource","deSerializeSearchNavigationTarget","navigationTarget","Transaction","position","isRecentEntry","serialize","serializedRecentItem","toJson","id","label1","label2","serializeSearchNavigationTarget","searchNavigationTarget","navigationTargetParamters","parseSearchNavigationTarget","createSearchNavigationTarget","assign","updateUrl","navigationTargetJson","navigationTargetParameters","addItem","isStorageOfPersonalDataAllowed","some","index","items","debug","splice","length","oldest","pop","unshift","setItem"],"sources":["RecentlyUsedStorage.ts"],"sourcesContent":["/*!\n * SAPUI5\n * Copyright (c) 2025 SAP SE or an SAP affiliate company. All rights reserved.\n * \n */\n// read and write recently used data into personalization storage\n\nimport Log, { Logger } from \"sap/base/Log\";\nimport PersonalizationStorage from \"./personalization/PersonalizationStorage\";\nimport SearchModel from \"./SearchModel\";\nimport { DataSource } from \"./sinaNexTS/sina/DataSource\";\nimport { Type, SuggestionType, RecentEntriesPosition } from \"./suggestions/SuggestionType\";\nimport { NavigationTarget, NavigationTargetJson } from \"./sinaNexTS/sina/NavigationTarget\";\nimport { Filter } from \"./sinaNexTS/sina/Filter\";\nimport { PersonalizationKeys } from \"./personalization/PersonalizationKeys\";\n\nenum StorageVersion {\n    V2 = 2,\n}\n\nconst objectSuggestionCopyProperties = [\n    \"uiSuggestionType\",\n    \"label\",\n    \"label1\",\n    \"label2\",\n    \"imageUrl\",\n    \"imageIsCircular\",\n    \"imageExists\",\n];\n\nconst searchSuggestionCopyProperties = [\"uiSuggestionType\", \"label\", \"icon\", \"filterIcon\"];\n\nconst transactionSuggestionsCopyProperties = [\"uiSuggestionType\", \"label\", \"url\", \"icon\", \"searchTerm\"];\n\nexport interface RecentItem {\n    label: string;\n    label1?: string;\n    label2?: string;\n    icon?: string;\n    uiSuggestionType?: Type;\n    imageUrl?: string;\n    imageExists?: true;\n    imageIsCircular?: boolean;\n    titleNavigation?: NavigationTarget;\n    dataSource?: DataSource;\n    // --\n    position?: number;\n    isRecentEntry?: boolean;\n    filter?: Filter;\n}\n\nexport interface RecentItemInStorage {\n    label?: string;\n    label1?: string;\n    label2?: string;\n    icon?: string;\n    uiSuggestionType?: Type;\n    imageUrl?: string;\n    imageExists?: true;\n    imageIsCircular?: string;\n    titleNavigation?: NavigationTargetJson;\n    // --\n    dataSource?: string;\n    key: string;\n    version?: StorageVersion;\n}\n\nexport default class RecentlyUsedStorage {\n    private personalizationStorage: PersonalizationStorage;\n    private _oLogger: Logger;\n    private maxItems;\n    private readonly key = PersonalizationKeys.recentSearches;\n    private readonly searchModel: SearchModel;\n\n    constructor(properties: {\n        personalizationStorage: PersonalizationStorage;\n        maxItems?: number;\n        searchModel: SearchModel;\n    }) {\n        this.personalizationStorage = properties.personalizationStorage;\n        this._oLogger = Log.getLogger(\"sap.esh.search.ui.RecentlyUsedStorage\");\n        this.maxItems = properties.maxItems || 10;\n        this.searchModel = properties.searchModel;\n    }\n\n    public async deleteAllItems(): Promise<unknown> {\n        this.personalizationStorage.deleteItem(this.key);\n        return this.personalizationStorage.save();\n    }\n\n    private getSerializedItemsInternal(): Array<RecentItemInStorage> {\n        const serializedItems =\n            (this.personalizationStorage.getItem(this.key) as Array<RecentItemInStorage>) ?? [];\n        return serializedItems.filter((item: RecentItemInStorage) => item.version >= StorageVersion.V2);\n    }\n\n    public getItems(): Array<RecentItem> {\n        const currentFilter = this.searchModel?.query?.filter;\n        return this.getSerializedItemsInternal()\n            .map((serializedItem) => this.deSerialize(serializedItem))\n            .filter((item: RecentItem) => {\n                if (item.uiSuggestionType === Type.Search && item.filter.equals(currentFilter)) {\n                    return false;\n                }\n                return true;\n            });\n    }\n\n    private copyProperties(target: object, source: object, properties: Array<string>) {\n        for (const property of properties) {\n            target[property] = source[property];\n        }\n    }\n\n    private deSerialize(serializedItem: RecentItemInStorage): RecentItem {\n        const item: RecentItem = { label: \"\" };\n        let tmpResult;\n        switch (serializedItem.uiSuggestionType) {\n            case SuggestionType.Object:\n                this.copyProperties(item, serializedItem, objectSuggestionCopyProperties);\n                item.titleNavigation = this.searchModel.sinaNext.parseNavigationTargetFromJson(\n                    serializedItem.titleNavigation\n                );\n                item.dataSource = this.searchModel.sinaNext.getDataSource(serializedItem.dataSource);\n                break;\n            case SuggestionType.Search:\n                this.copyProperties(item, serializedItem, searchSuggestionCopyProperties);\n                tmpResult = this.deSerializeSearchNavigationTarget(serializedItem.titleNavigation);\n                item.titleNavigation = tmpResult.navigationTarget;\n                item.filter = tmpResult.filter;\n                break;\n            case SuggestionType.Transaction:\n                this.copyProperties(item, serializedItem, transactionSuggestionsCopyProperties);\n                break;\n        }\n        item.position = RecentEntriesPosition;\n        item.isRecentEntry = true;\n        return item;\n    }\n\n    private serialize(item: RecentItem): RecentItemInStorage {\n        const serializedRecentItem: RecentItemInStorage = { key: \"\" };\n        switch (item.uiSuggestionType) {\n            case SuggestionType.Object:\n                this.copyProperties(serializedRecentItem, item, objectSuggestionCopyProperties);\n                serializedRecentItem.titleNavigation = item.titleNavigation.toJson();\n                serializedRecentItem.dataSource = item.dataSource.id;\n                serializedRecentItem.key = item.uiSuggestionType + \"/\" + item.label1 + \"/\" + item.label2;\n                break;\n            case SuggestionType.Search:\n                this.copyProperties(serializedRecentItem, item, searchSuggestionCopyProperties);\n                serializedRecentItem.titleNavigation = this.serializeSearchNavigationTarget(\n                    item.titleNavigation\n                );\n                serializedRecentItem.key = item.uiSuggestionType + \"/\" + item.label;\n                break;\n            case SuggestionType.Transaction:\n                this.copyProperties(serializedRecentItem, item, transactionSuggestionsCopyProperties);\n                serializedRecentItem.key = item.uiSuggestionType + \"/\" + item.label;\n                break;\n        }\n        serializedRecentItem.version = StorageVersion.V2;\n        return serializedRecentItem;\n    }\n\n    private serializeSearchNavigationTarget(searchNavigationTarget: NavigationTarget): NavigationTargetJson {\n        // parse navigation target\n        const navigationTargetParamters =\n            this.searchModel.parseSearchNavigationTarget(searchNavigationTarget);\n        // recreate navigation target with forced updateUrl=true\n        return this.searchModel\n            .createSearchNavigationTarget(Object.assign(navigationTargetParamters, { updateUrl: true }))\n            .toJson();\n    }\n\n    private deSerializeSearchNavigationTarget(navigationTargetJson: NavigationTargetJson): {\n        filter: Filter;\n        navigationTarget: NavigationTarget;\n    } {\n        // json -> navigation target\n        const searchNavigationTarget =\n            this.searchModel.sinaNext.parseNavigationTargetFromJson(navigationTargetJson);\n        // parse navigation target\n        const navigationTargetParameters =\n            this.searchModel.parseSearchNavigationTarget(searchNavigationTarget);\n        // recreate navigation target (this evaluates model.config.updateUrl and create a url based or target function based navigation target)\n        return {\n            filter: navigationTargetParameters.filter,\n            navigationTarget: this.searchModel.createSearchNavigationTarget(navigationTargetParameters),\n        };\n    }\n\n    /**\n     * Adds a search to the recent store. Item at index 0 is newest entry. If item is omitted, the current search will be saved.\n     **/\n    public addItem(item: RecentItem): void {\n        // check storage enabled\n        if (!this.personalizationStorage.isStorageOfPersonalDataAllowed()) return;\n\n        // serialize item\n        const serializedItem = this.serialize(item);\n\n        // remove existing items (with identical key)\n        const serializedItems = this.getSerializedItemsInternal();\n        serializedItems.some((item: RecentItemInStorage, index, items) => {\n            if (item.key === serializedItem.key) {\n                this._oLogger.debug(\n                    \"Removing already existing item \" + serializedItem.key + \" at pos \" + index\n                );\n                items.splice(index, 1);\n                return true;\n            }\n        });\n\n        // remove oldest item if limit reached\n        if (serializedItems.length >= this.maxItems) {\n            const oldest = serializedItems.pop();\n            this._oLogger.debug(\"Removing oldest item \" + oldest.key);\n        }\n\n        // add new item\n        this._oLogger.debug(\"Adding item \" + serializedItem.key);\n        serializedItems.unshift(serializedItem);\n        this.personalizationStorage.setItem(this.key, serializedItems);\n    }\n}\n"],"mappings":"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","ignoreList":[]}