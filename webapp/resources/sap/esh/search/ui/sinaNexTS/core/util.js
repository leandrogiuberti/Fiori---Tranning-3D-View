/*!
 * SAPUI5
 * Copyright (c) 2025 SAP SE or an SAP affiliate company. All rights reserved.
 * 
 */
sap.ui.define(["../sina/AttributeSemanticsType","../sina/SearchResultSetItemAttribute","../sina/SearchResultSetItemAttributeGroup","../sina/i18n","./errors"],function(t,e,n,a,i){"use strict";const r=t["AttributeSemanticsType"];const s=e["SearchResultSetItemAttribute"];const o=n["SearchResultSetItemAttributeGroup"];const c=a["getText"];const u=i["NoJSONDateError"];const l=i["TimeOutError"];function f(t,e){return Object.prototype.hasOwnProperty.apply(t,e)}function g(t,e){const n=function(...n){const a=this;return new Promise(function(i,r){let s=false;const o=setTimeout(function(){s=true;r(new l)},e);return t.apply(a,n).then(function(t){if(s){return}clearTimeout(o);i(t)},function(t){if(s){return}clearTimeout(o);r(t)})})};return n}function p(t){let e=0;const n=function(...n){const a=++e;return t.apply(this,n).then(function(t){return new Promise(function(n){if(a!==e){return}n(t)})},function(t){return new Promise(function(n,i){if(a!==e){return}i(t)})})};n.abort=function(){++e};return n}function d(t,e){if(!e){if(typeof window==="undefined"){return null}e=window.location.href}t=M(t);const n=new RegExp("[?&]"+t+"(=([^&#]*)|&|#|$)"),a=n.exec(e);if(!a){return null}if(!a[2]){return""}return decodeURIComponent(a[2].replace(/\+/g," "))}function m(t,e){for(let n=0;n<e.length;++n){const a=e[n];let i=0;while(i>=0){i=t.indexOf(a);if(i>=0){t=t.slice(0,i)+t.slice(i+a.length)}}}return t}function h(){const t=function(t,e){const n="000000000"+t;return n.substr(n.length-e)};const e=new Date;return""+e.getUTCFullYear()+t(e.getUTCMonth()+1,2)+t(e.getUTCDate(),2)+t(e.getUTCHours(),2)+t(e.getUTCMinutes(),2)+t(e.getUTCSeconds(),2)+t(e.getUTCMilliseconds(),3)}class b{timeDelay;consumer;consumerContext;objects;constructor(t){t=t||{};this.timeDelay=t.timeDelay||1e3;this.consumer=t.consumer||function(){};this.consumerContext=t.consumerContext||null;this.objects=[]}add(t){this.objects.push(t);if(this.objects.length===1){setTimeout(this.consume.bind(this),this.timeDelay)}}consume(){this.consumer.apply(this.consumerContext,[this.objects]);this.objects=[]}}function T(t){return{type:"Timestamp",value:t.toJSON()}}function x(t){if(t.type!=="Timestamp"){throw new u(c("error.sina.noTimestampJsonDateError",[t]))}return new Date(t.value)}function y(t){if(t.items){const e=t.items;for(let t=0;t<e.length;t++){let n=e[t];n=D(n);const a=n.detailAttributes;for(let t=0;t<a.length;t++){const e=a[t];v(e)}}}return t}function v(t){if(t instanceof s){O(t)}else if(t instanceof o){N(t)}}function N(t){for(const e of t.attributes){const t=e.attribute;if(!(t instanceof s)){continue}const n=t.metadata;const a=t.sina;const i=t.value;if(n.semantics==r.HTTPURL){t.setDefaultNavigationTarget(a.createNavigationTarget({text:i,targetUrl:i,target:"_blank"}))}}}function O(t){const e=t.sina;const n=t.value;const a=t.metadata;if(typeof n==="string"&&t.metadata.type!=="ImageUrl"){const i=n.match(/^[^\0-\x20,:;<>@\[\\\]^_`]+@[^\0-,.-@\[\\\]^_`\{\|\}~]+\.[^\0-,.-@\[\\\]^_`\{\|\}~]+$/g);const s=n.match(/^https?:\/\/(?=[^\/])\S+$/gi);if(a.semantics==r.EmailAddress){t.setDefaultNavigationTarget(e.createNavigationTarget({text:n,targetUrl:"mailto:"+n}))}else if(a.semantics==r.PhoneNr){t.setDefaultNavigationTarget(e.createNavigationTarget({text:n,targetUrl:"tel:"+n}))}else if(a.semantics==r.HTTPURL){t.setDefaultNavigationTarget(e.createNavigationTarget({text:n,targetUrl:n,target:"_blank"}))}else if(i!==null&&i.length===1){t.setDefaultNavigationTarget(e.createNavigationTarget({text:i[0],targetUrl:"mailto:"+i[0]}))}else if(s!==null&&s[0].match(/\w\w\w/)!==null){t.setDefaultNavigationTarget(e.createNavigationTarget({text:s[0],targetUrl:s[0],target:"_blank"}))}}}function w(t){const e=t.sina.getDataSource(t.query.filter.dataSource.id);for(let n=0;n<t.facets.length;n++){const a=t.facets[n].query.dimension;const i=e.attributeMetadataMap[a];if(i&&i.usage.AdvancedSearch&&i.usage.Facet===undefined){t.facets.splice(n,1);n=n-1}}return t}function C(t,e,n){let a=false;let i,r,s,o,c,u;const l=t.id;const f=t.value;if(l.match(/latitude/i)!==null){if(!isNaN(f)){c=l;i=f;s=n}a=true}else if(l.match(/longitude/i)!==null){if(!isNaN(f)){u=l;r=f;o=n}a=true}else if(l.match(/LOC_4326/)){o=n;s=n;const t=JSON.parse(f);const e=t.coordinates;if(e&&e.length>1){r=e[0];i=e[1]}a=true}if(e===undefined||e===true){return a}return{lat:i,lon:r,latAttribName:c,lonAttribName:u,latIndex:s,lonIndex:o}}function D(t){let e,n,a,i,r,s;const o=t.detailAttributes;for(let t=0;t<o.length;t++){e=C(o[t],false,t);n=e.lat?e.lat:n;a=e.lon?e.lon:a;r=e.latIndex?e.latIndex:r;s=e.lonIndex?e.lonIndex:s;if(n&&a){break}}if(n&&a){if(r===s){o.splice(r,1)}else if(r>s){o.splice(r,1);o.splice(s,1)}else{o.splice(s,1);o.splice(r,1)}const e={sina:t.sina,type:"GeoJson",id:"LOC_4326",label:"LOC_4326",isCurrency:false,IsBoolean:false,IsKey:false,IsSortable:true,isUnitOfMeasure:false,semanticObjectType:[],usage:{Map:"coordinates"}};const c='{ "type": "Point", "coordinates": ['+a+", "+n+", 0] }";const u={id:"LOC_4326",label:"LOC_4326",isHighlighted:false,value:c,valueFormatted:c,valueHighlighted:t.sina,metadata:e,sina:t.sina};o.push(u);i=t.sina.getDataSource(t.dataSource.id);if(!i.attributeMetadataMap.LOC_4326){i.attributesMetadata.push(e);i.attributeMetadataMap.LOC_4326=e}else{i.attributeMetadataMap.LOC_4326.type="GeoJson";i.attributeMetadataMap.LOC_4326.usage={Map:"coordinates"}}}return t}function S(t){const e={};return function(n){if(Object.prototype.hasOwnProperty.call(e,n)){return e[n]}const a=t.apply(this,[n]);e[n]=a;return a}}function M(t){return t.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&")}function U(t,e){const n=new RegExp("{{([^{}]*)}}");const a=function(t){const e=n.exec(t);if(!e){return null}return e[1]};const i=function(t,e,n){const a=new RegExp("{{"+M(e)+"}}","g");t=t.replace(a,n);return t};const r=function(t){const n=a(t);if(!n){return t}t=i(t,n,e[n]);return r(t)};return r(t)}const _=new RegExp("<b>(.*?)<\\/b>","g");function A(t){let e;const n=[];do{e=_.exec(t);if(e){n.push(e[1])}}while(e);return n}function I(t,e){for(let n=0;n<e.length;++n){const a=e[n];if(t.indexOf(a)<0){t.push(a)}}}const R=["\\","-","(",")","~","^","?",'"',":","'","[","]"];const P=["AND","OR","NOT"];const L=["\\",'"',"*","?","'"];function j(t,e,n){return t.split(e).join(n)}function E(t){let e=t.trim();for(const t of R){if(t==="'"){e=j(e,t,"''")}else{e=j(e,t,"\\"+t)}}for(const t of P){if(e===t){e='"'+t+'"'}if(e.startsWith(t+" ")){e='"'+t+'" '+e.substring(t.length+1)}if(e.endsWith(" "+t)){e=e.substring(0,e.length-(t.length+1))+' "'+t+'"'}e=j(e," "+t+" ",' "'+t+'" ')}if(e===""){e="*"}return e}function J(t){let e=t.trim();for(const t of L){if(t==="'"){e=j(e,t,"''")}else{e=j(e,t,"\\"+t)}}if(e===""){e="*"}return e}var F={__esModule:true};F.hasOwnProperty=f;F.timeoutDecorator=g;F.refuseOutdatedResponsesDecorator=p;F.getUrlParameter=d;F.filterString=m;F.generateTimestamp=h;F.DelayedConsumer=b;F.dateToJson=T;F.dateFromJson=x;F.addPotentialNavTargets=y;F.removePureAdvancedSearchFacets=w;F.isMapsAttribute=C;F.addGeoDataIfAvailable=D;F.cacheDecorator=S;F.escapeRegExp=M;F.evaluateTemplate=U;F.extractRegExp=_;F.extractHighlightedTerms=A;F.appendRemovingDuplicates=I;F.escapeQuery=E;F.escapeFilterCondition=J;return F});
//# sourceMappingURL=util.js.map