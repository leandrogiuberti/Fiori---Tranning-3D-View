{"version":3,"file":"ajax-dbg.js","names":["sap","ui","define","___requestNodePlain","___requestBrowser","___core","___Log","requestNodePlain","requestBrowser","isBrowserEnv","Log","request","properties","result","dataJSON","JSON","parse","data","e","log","warn","applyResponseFormattersAndUpdateJSON","response","formatters","formatter","__exports","__esModule"],"sources":["ajax.ts"],"sourcesContent":["/*!\n * SAPUI5\n * Copyright (c) 2025 SAP SE or an SAP affiliate company. All rights reserved.\n * \n */\nimport { requestNodePlain } from \"./requestNodePlain\";\nimport { requestBrowser } from \"./requestBrowser\";\nimport { isBrowserEnv } from \"./core\";\nimport { SinaError } from \"./errors\";\nimport { Log } from \"./Log\";\n\nexport interface RequestProperties {\n    data?: string;\n    headers?: Record<string, string>;\n    url: string;\n    parameters?: Record<string, unknown>;\n    method: string;\n    cookies?: string; // only for node-fetch\n}\n\nexport type RequestFormatter = (request: RequestProperties) => RequestProperties;\n\nexport interface ResponseProperties {\n    data: string;\n    dataJSON?: JSONValue;\n    headers: Record<string, string | string[]>;\n    status: number;\n    statusText: string;\n}\n\nexport interface JSONResponseProperties {\n    data: JSONValue;\n    headers: Record<string, string | string[]>;\n    status: number;\n    statusText: string;\n}\n\nexport type JSONValue = string | number | boolean | { [x: string]: JSONValue } | Array<JSONValue>;\n\nexport type ResponseFormatter = (\n    request: RequestProperties,\n    response: ResponseProperties\n) => ResponseProperties;\n\nexport type AjaxErrorFormatter = (\n    request: RequestProperties,\n    response: ResponseProperties,\n    error: SinaError\n) => SinaError;\n\nexport async function request(properties: RequestProperties): Promise<ResponseProperties> {\n    let result;\n    if (isBrowserEnv()) {\n        result = await requestBrowser(properties);\n    } else {\n        result = await requestNodePlain(properties);\n    }\n    try {\n        delete result.dataJSON;\n        result.dataJSON = JSON.parse(result.data);\n    } catch (e) {\n        const log = new Log(\"ajax\");\n        log.warn(\"Could not parse response data as JSON: \" + result?.data + \" (\" + e + \")\");\n    }\n    return result;\n}\n\nexport type AjaxErrorFactory = (request: RequestProperties, response: ResponseProperties) => SinaError;\n\nexport function applyResponseFormattersAndUpdateJSON(\n    request: RequestProperties,\n    response: ResponseProperties,\n    formatters: Array<ResponseFormatter>\n): ResponseProperties {\n    const data = response.data;\n    for (const formatter of formatters) {\n        response = formatter(request, response);\n    }\n    if (response.data !== data) {\n        // in case data changed also update dataJSON\n        try {\n            delete response.dataJSON;\n            response.dataJSON = JSON.parse(response.data);\n        } catch (e) {\n            const log = new Log(\"ajax\");\n            log.warn(\"Could not parse response data as JSON: \" + response?.data + \" (\" + e + \")\");\n        }\n    }\n    return response;\n}\n"],"mappings":"AAAA;AACA;AACA;AACA;AACA;AAJAA,GAAA,CAAAC,EAAA,CAAAC,MAAA,0EAAAC,mBAAA,EAAAC,iBAAA,EAAAC,OAAA,EAAAC,MAAA;EAAA;;EAAA,MAKSC,gBAAgB,GAAAJ,mBAAA;EAAA,MAChBK,cAAc,GAAAJ,iBAAA;EAAA,MACdK,YAAY,GAAAJ,OAAA;EAAA,MAEZK,GAAG,GAAAJ,MAAA;EAyCL,eAAeK,OAAOA,CAACC,UAA6B,EAA+B;IACtF,IAAIC,MAAM;IACV,IAAIJ,YAAY,CAAC,CAAC,EAAE;MAChBI,MAAM,GAAG,MAAML,cAAc,CAACI,UAAU,CAAC;IAC7C,CAAC,MAAM;MACHC,MAAM,GAAG,MAAMN,gBAAgB,CAACK,UAAU,CAAC;IAC/C;IACA,IAAI;MACA,OAAOC,MAAM,CAACC,QAAQ;MACtBD,MAAM,CAACC,QAAQ,GAAGC,IAAI,CAACC,KAAK,CAACH,MAAM,CAACI,IAAI,CAAC;IAC7C,CAAC,CAAC,OAAOC,CAAC,EAAE;MACR,MAAMC,GAAG,GAAG,IAAIT,GAAG,CAAC,MAAM,CAAC;MAC3BS,GAAG,CAACC,IAAI,CAAC,yCAAyC,GAAGP,MAAM,EAAEI,IAAI,GAAG,IAAI,GAAGC,CAAC,GAAG,GAAG,CAAC;IACvF;IACA,OAAOL,MAAM;EACjB;EAIO,SAASQ,oCAAoCA,CAChDV,OAA0B,EAC1BW,QAA4B,EAC5BC,UAAoC,EAClB;IAClB,MAAMN,IAAI,GAAGK,QAAQ,CAACL,IAAI;IAC1B,KAAK,MAAMO,SAAS,IAAID,UAAU,EAAE;MAChCD,QAAQ,GAAGE,SAAS,CAACb,OAAO,EAAEW,QAAQ,CAAC;IAC3C;IACA,IAAIA,QAAQ,CAACL,IAAI,KAAKA,IAAI,EAAE;MACxB;MACA,IAAI;QACA,OAAOK,QAAQ,CAACR,QAAQ;QACxBQ,QAAQ,CAACR,QAAQ,GAAGC,IAAI,CAACC,KAAK,CAACM,QAAQ,CAACL,IAAI,CAAC;MACjD,CAAC,CAAC,OAAOC,CAAC,EAAE;QACR,MAAMC,GAAG,GAAG,IAAIT,GAAG,CAAC,MAAM,CAAC;QAC3BS,GAAG,CAACC,IAAI,CAAC,yCAAyC,GAAGE,QAAQ,EAAEL,IAAI,GAAG,IAAI,GAAGC,CAAC,GAAG,GAAG,CAAC;MACzF;IACJ;IACA,OAAOI,QAAQ;EACnB;EAAC,IAAAG,SAAA;IAAAC,UAAA;EAAA;EAAAD,SAAA,CAAAd,OAAA,GAAAA,OAAA;EAAAc,SAAA,CAAAJ,oCAAA,GAAAA,oCAAA;EAAA,OAAAI,SAAA;AAAA","ignoreList":[]}