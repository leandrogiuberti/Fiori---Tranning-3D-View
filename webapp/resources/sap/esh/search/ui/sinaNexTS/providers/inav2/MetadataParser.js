/*!
 * SAPUI5
 * Copyright (c) 2025 SAP SE or an SAP affiliate company. All rights reserved.
 * 
 */
sap.ui.define(["../../core/errors","../../sina/AttributeFormatType","../../sina/AttributeType","../../sina/MatchingStrategy"],function(t,e,a,s){"use strict";const r=t["UnknownDataTypeError"];const i=t["UnknownPresentationUsageError"];const n=e["AttributeFormatType"];const o=a["AttributeType"];const u=s["MatchingStrategy"];class c{provider;sina;constructor(t){this.provider=t;this.sina=t.sina}normalizeAttributeMetadata(t){t.IsKey=t.isKey}parseRequestAttributes(t,e){const a=e.Cube.Dimensions;const s=[];for(let t=0;t<a.length;++t){const e=a[t];if(e.Name.slice(0,2)==="$$"){continue}const r=e.Attributes[0];this.normalizeAttributeMetadata(r);s.push(r)}this.provider.fillInternalMetadata(t,"metadataRequest",s)}parseResponseAttributes(t,e){const a=[];const s=e.Cube.Dimensions[0].Attributes;for(let t=0;t<s.length;++t){const e=s[t];if(e.Name.slice(0,2)==="$$"){continue}this.normalizeAttributeMetadata(e);a.push(e)}this.provider.fillInternalMetadata(t,"metadataRequest",a)}parseMetadataRequestMetadata(t,e){const a=this.provider.getInternalMetadataLoadStatus(t);if(a.metadataRequest){return}this.parseRequestAttributes(t,e);this.parseResponseAttributes(t,e);this.fillPublicMetadataBuffer(t)}parseSearchRequestMetadata(t){const e=this.sina.getDataSource(t.$$DataSourceMetaData$$[0].ObjectName);const a=this.provider.getInternalMetadataLoadStatus(e);if(a.searchRequest){return}this.provider.fillInternalMetadata(e,"searchRequest",t.$$AttributeMetadata$$);this.fillPublicMetadataBuffer(e);this.calculateAttributeDisplayOrder(e,t)}fillPublicMetadataBuffer(t){t.attributesMetadata=[];t.attributeMetadataMap={};const e=this.provider.getInternalMetadataAttributes(t);for(let a=0;a<e.length;++a){const s=e[a];const r=this._parseAttributeTypeAndFormat(s);const i=this.sina._createAttributeMetadata({type:r.type,format:r.format,id:s.Name,label:s.Description,isSortable:this._parseIsSortable(s),isKey:s.IsKey,matchingStrategy:this._parseMatchingStrategy(s),usage:this._parseUsage(s)});t.attributesMetadata.push(i);t.attributeMetadataMap[s.Name]=i}t._configure()}calculateAttributeDisplayOrder(t,e){let a,s,r;const i=[];const n=[];const o=[];const u=[];for(let a=0;a<e.$$ResultItemAttributes$$.length;++a){const s=e.$$ResultItemAttributes$$[a];const r=this.provider.getInternalMetadataAttribute(t,s.Name);if(r.presentationUsage.indexOf("Title")>=0||r.IsTitle){i.push(s.Name)}if(r.presentationUsage.indexOf("Summary")>=0||r.presentationUsage.indexOf("Image")>=0||r.presentationUsage.indexOf("Thumbnail")>=0){n.push(s.Name)}else if(r.presentationUsage.indexOf("Detail")>=0){o.push(s.Name)}}for(r=0;r<i.length;++r){a=i[r];s=t.getAttributeMetadata(a);s.usage.Title.displayOrder=r}u.push(...n);u.push(...o);for(r=0;r<u.length;++r){a=u[r];s=t.getAttributeMetadata(a);s.usage.Detail.displayOrder=r}}_parseIsSortable(t){if(typeof t.IsSortable==="undefined"){return false}return t.IsSortable}_parseMatchingStrategy(t){if(t.hasFulltextIndex){return u.Text}return u.Exact}_parseUsage(t){const e={};if(t.presentationUsage.indexOf("Title")>=0||t.IsTitle){e.Title={displayOrder:0}}if(t.presentationUsage.indexOf("Summary")>=0||t.presentationUsage.indexOf("Image")>=0||t.presentationUsage.indexOf("Thumbnail")>=0||t.presentationUsage.indexOf("Detail")>=0){e.Detail={displayOrder:0}}if(t.accessUsage.indexOf("AutoFacet")>=0){e.Facet={displayOrder:0}}if(t.accessUsage.indexOf("AdvancedSearch")>=0){e.AdvancedSearch={displayOrder:0}}return e}_parseAttributeTypeAndFormat(t){for(let e=0;e<t.presentationUsage.length;e++){const a=t.presentationUsage[e];switch(a){case"Summary":continue;case"Detail":continue;case"Title":continue;case"Hidden":continue;case"FactSheet":continue;case"Thumbnail":case"Image":return{type:o.ImageUrl};case"Text":return{type:o.String,format:n.LongText};default:throw new i(a)}}switch(t.DataType){case"Integer":case"Long":return{type:o.Integer};case"Double":return{type:o.Double};case"String":return{type:o.String};case"Date":return{type:o.Date};case"Time":return{type:o.Time};case"Timestamp":return{type:o.Timestamp};case"GeoJson":return{type:o.GeoJson};default:throw new r(t.DataType)}}}var l={__esModule:true};l.MetadataParser=c;return l});
//# sourceMappingURL=MetadataParser.js.map