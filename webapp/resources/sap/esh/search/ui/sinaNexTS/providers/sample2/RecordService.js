/*!
 * SAPUI5
 * Copyright (c) 2025 SAP SE or an SAP affiliate company. All rights reserved.
 * 
 */
sap.ui.define(["./Util","../../sina/ComplexCondition","../../sina/SimpleCondition"],function(t,e,r){"use strict";const o=t["formatRawValue"];const i=t["getMatchedStringValues"];const s=t["isValuePairMatched"];const n=t["readFile"];const a=e["ComplexCondition"];const c=r["SimpleCondition"];class l{sina;dataSourceIds=[];records=[];constructor(t,e){this.sina=t;this.dataSourceIds=e}async loadRecords(){if(this.records.length>0){return}for(const t of this.dataSourceIds){const e=await n(`/resources/sap/esh/search/ui/sinaNexTS/providers/sample2/data/${t}.csv`);this.records.push(...this.parseCsv2RecordSet(t,e))}}parseCsv2RecordSet(t,e){const r=this.parseCsv2ArraySet(e);const o=r[0];const i=[];for(let e=1;e<r.length;e++){const s=r[e];const n=this.createAttributeValueMap(t,o,s);const a={id:`${t}_${e}`,dataSourceId:t,valueMap:n,rawValues:Object.values(n).map(t=>t.rawValue),stringValues:Object.values(n).map(t=>t.stringValue)};i.push(a)}return i}parseCsv2ArraySet(t){const e=t.split("\n").filter(t=>t.trim()!=="").map(t=>{const e=[];let r="";let o=false;for(const i of t){if(i==='"'){o=!o}else if(i===","&&!o){e.push(r);r=""}else{r+=i}}e.push(r);return e});return e}createAttributeValueMap(t,e,r){const i={};for(let s=0;s<e.length;s++){const n=e[s];const a=r[s];try{const e=this.sina.getDataSource(t).getAttributeMetadata(n).type;i[n]={stringValue:a,rawValue:o(a,e)}}catch(t){i[n]={stringValue:a,rawValue:a}}}const s=this.sina.getDataSource(t).attributesMetadata;for(const t of s){if(i[t.id]===undefined&&t.type!=="Group"){i[t.id]={stringValue:"default attribute value",rawValue:o("default attribute value",t.type)}}}return i}getRecordsByDataSourceId(t,e){let r=[];if(e){r=e}else{r=this.records}return r.filter(e=>e.dataSourceId===t)}getResponse(t){let e=[];const r=[];const o=t.filter.searchTerm;const s=t.filter.dataSource.id!=="All"?[t.filter.dataSource.id]:this.dataSourceIds;for(const t of this.records){if(s.includes(t.dataSourceId)&&i(t.stringValues,o).length>0){r.push(t)}}if(t.filter.rootCondition instanceof a&&t.filter.rootCondition.conditions.length>0){e=this.getRecordsByConditions(r,t.filter.rootCondition)}else if(t.filter.rootCondition instanceof c){e=this.getRecordsBySimpleCondition(r,{attributeId:t.filter.rootCondition.attribute,rawValue:t.filter.rootCondition.value,operator:t.filter.rootCondition.operator})}else{e=r}return{results:e,resultsToDisplay:this.getDisplayedRecords(e,t),totalCount:e.length}}getRecordsByConditions(t,e){if(e instanceof a){let r=this.getRecordsByConditions(t,e.conditions[0]);for(let o=1;o<e.conditions.length;o++){const i=this.getRecordsByConditions(t,e.conditions[o]);if(e.operator==="And"){r=this.intersectRecords(r,i)}else if(e.operator==="Or"){r=this.uniteRecords(r,i)}}return r}else{return this.getRecordsBySimpleCondition(t,{attributeId:e.attribute,rawValue:e.value,operator:e.operator})}}getRecordsBySimpleCondition(t,e){try{return t.filter(t=>{const r=t.valueMap[e.attributeId].rawValue;return s(r,e.rawValue,e.operator)})}catch(t){return[]}}intersectRecords(t,e){return t.filter(t=>e.some(e=>t.id===e.id))}uniteRecords(t,e){const r=new Set(t.map(t=>t.id));return t.concat(e.filter(t=>!r.has(t.id)))}getDisplayedRecords(t,e){let r=t;const o=e?.sortOrder[0]?.id;const i=e?.sortOrder[0]?.order;if(o&&i){r=this.sortRecords(r,o,i)}if(e.top){r=r.slice(0,e.top)}if(e.skip){r=r.slice(e.skip)}return r}sortRecords(t,e,r){return t.sort((t,o)=>{const i=t.valueMap[e].rawValue;const s=o.valueMap[e].rawValue;if(r==="Descending"){if(typeof i==="string"&&typeof s==="string"){return s.localeCompare(i)}if(typeof i==="number"&&typeof s==="number"){return s-i}if(typeof i==="boolean"&&typeof s==="boolean"){return s.toString().localeCompare(i.toString())}if(i instanceof Date&&s instanceof Date){return s.getTime()/1e3-i.getTime()/1e3}return 1}else{if(typeof i==="string"&&typeof s==="string"){return i.localeCompare(s)}if(typeof i==="number"&&typeof s==="number"){return i-s}if(typeof i==="boolean"&&typeof s==="boolean"){return i.toString().localeCompare(s.toString())}if(i instanceof Date&&s instanceof Date){return i.getTime()/1e3-s.getTime()/1e3}return 1}})}}var u={__esModule:true};u.RecordService=l;return u});
//# sourceMappingURL=RecordService.js.map