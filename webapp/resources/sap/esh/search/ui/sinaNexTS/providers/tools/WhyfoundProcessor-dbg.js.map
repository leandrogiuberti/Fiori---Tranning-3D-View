{"version":3,"file":"WhyfoundProcessor-dbg.js","names":["sap","ui","define","____sina_SearchResultSetItemAttributeGroup","SearchResultSetItemAttributeGroup","WhyfoundProcessor","sina","constructor","processRegularWhyFoundAttributes","attributeName","structuredAttribute","whyFounds","metadata","attrWhyFound","attributeNameWhyfound","usage","Title","TitleDescription","Detail","calculateValueHighlighted","processAdditionalWhyfoundAttributes","searchResultSetItem","restWhyfoundAttribute","dataSource","getAttributeMetadata","attributeId","id","valueTemp","valueFormattedTemp","attributesMap","valueFormatted","JSON","stringify","valueHighlightedTemp","wAttribute","_createSearchResultSetItemAttribute","label","value","valueHighlighted","isHighlighted","originalAttribute","attributes","find","attr","detailAttributes","isAttributeDisplayed","undefined","push","_getFirstItemIfArray","Array","isArray","identifierHighlight","identifierSnippet","format","calIsHighlighted","length","indexOf","__exports","__esModule"],"sources":["WhyfoundProcessor.ts"],"sourcesContent":["/*!\n * SAPUI5\n * Copyright (c) 2025 SAP SE or an SAP affiliate company. All rights reserved.\n * \n */\nimport { AttributeMetadata } from \"../../sina/AttributeMetadata\";\nimport { SearchResultSetItem } from \"../../sina/SearchResultSetItem\";\nimport { SearchResultSetItemAttributeGroup } from \"../../sina/SearchResultSetItemAttributeGroup\";\nimport { Sina } from \"../../sina/Sina\";\nimport { ODataValue } from \"../../sina/odatatypes\";\n\nexport class WhyfoundProcessor {\n    sina: Sina;\n\n    constructor(sina: Sina) {\n        this.sina = sina;\n    }\n\n    processRegularWhyFoundAttributes(\n        attributeName: string,\n        structuredAttribute: Record<\"value\", ODataValue>,\n        whyFounds: Record<string, ODataValue>,\n        metadata: AttributeMetadata\n    ): string {\n        let attrWhyFound;\n\n        // Process whyfound attributes which belongs to title, title description and detail\n        for (const attributeNameWhyfound in whyFounds) {\n            if (attributeNameWhyfound === attributeName && whyFounds[attributeNameWhyfound][0]) {\n                // replace attribue value with whyfound value\n                attrWhyFound = whyFounds[attributeNameWhyfound][0];\n                if (metadata.usage.Title || metadata.usage.TitleDescription || metadata.usage.Detail) {\n                    delete whyFounds[attributeNameWhyfound];\n                }\n            }\n        }\n\n        attrWhyFound = this.calculateValueHighlighted(structuredAttribute, metadata, attrWhyFound);\n        return attrWhyFound;\n    }\n\n    // Precondition: attribute group has been prepared in itemPostParser\n    // If a remaining whyfound attribute (after the regular processing above) is no displayAttribute in a attribute group\n    // it's either not modeled for display or just a request attribute.\n    // Add it to detail attributes and will be displayed in case of no hit in other displayed attributes.\n    async processAdditionalWhyfoundAttributes(\n        whyFounds: Record<string, string | ODataValue>,\n        searchResultSetItem: SearchResultSetItem\n    ): Promise<SearchResultSetItem> {\n        // Check whether there is still whyfoundattr remaining\n        // If yes, it means hits in request attributes\n        // Convert it to attribute and concat it to detailAttributes\n        // No display order normally, candidates for the additional line for whyfounds\n        for (const restWhyfoundAttribute in whyFounds) {\n            if (whyFounds[restWhyfoundAttribute] && whyFounds[restWhyfoundAttribute][0]) {\n                const metadata = searchResultSetItem.dataSource.getAttributeMetadata(\n                    restWhyfoundAttribute\n                ) as AttributeMetadata;\n                const attributeId = metadata.id || restWhyfoundAttribute;\n                const valueTemp = whyFounds[restWhyfoundAttribute][0];\n                let valueFormattedTemp = \"\";\n                if (searchResultSetItem.attributesMap[restWhyfoundAttribute]) {\n                    valueFormattedTemp =\n                        searchResultSetItem.attributesMap[restWhyfoundAttribute].valueFormatted;\n                    valueFormattedTemp =\n                        typeof valueFormattedTemp === \"string\"\n                            ? valueFormattedTemp\n                            : JSON.stringify(valueFormattedTemp);\n                }\n                const valueHighlightedTemp =\n                    typeof valueTemp === \"string\" ? valueTemp : JSON.stringify(valueTemp);\n                const wAttribute = this.sina._createSearchResultSetItemAttribute({\n                    id: attributeId,\n                    label: metadata.label || restWhyfoundAttribute,\n                    value: \"\",\n                    valueFormatted: valueFormattedTemp,\n                    valueHighlighted: valueHighlightedTemp,\n                    isHighlighted: true,\n                    metadata: metadata,\n                });\n\n                const originalAttribute = searchResultSetItem.attributes.find(\n                    (attr) => attr.id === attributeId\n                );\n\n                // If the attribute is already part of display attribute of a group\n                // it unnecessary to add it to detail attributes\n                if (\n                    searchResultSetItem.detailAttributes.find(\n                        (attr) =>\n                            attr instanceof SearchResultSetItemAttributeGroup &&\n                            attr.isAttributeDisplayed(attributeId)\n                    ) === undefined\n                ) {\n                    // If wAttribute is not in the original attributes, e.g. a request attribute, just add it\n                    if (originalAttribute === undefined) {\n                        searchResultSetItem.detailAttributes.push(wAttribute);\n                        searchResultSetItem.attributes.push(wAttribute);\n                        searchResultSetItem.attributesMap[attributeId] = wAttribute;\n                    } else if (originalAttribute.isHighlighted === true) {\n                        // Already highlighted originalAttribute\n                        searchResultSetItem.detailAttributes.push(originalAttribute);\n                    } else {\n                        // If wAttribute is already in the list of original attributes and not marked as highlighted yet,\n                        // replace valueHighlighted of originalAttribute from wAttribute and set isHighlighted to true\n                        originalAttribute.valueHighlighted = wAttribute.valueHighlighted;\n                        originalAttribute.isHighlighted = true;\n                        searchResultSetItem.detailAttributes.push(originalAttribute);\n                    }\n                }\n\n                delete whyFounds[restWhyfoundAttribute];\n            }\n        }\n        return searchResultSetItem;\n    }\n\n    _getFirstItemIfArray(value) {\n        if (Array.isArray(value)) {\n            value = value[0];\n        }\n        return value;\n    }\n\n    // valueHiglighted  =\n    // multiline: true => input.highlighted | input.snippet | why found\n    // multiline: false => input.snippet | input.highlighted | why found\n    calculateValueHighlighted(structuredAttribute, metadata: AttributeMetadata, attrWhyFound) {\n        const identifierHighlight = \"com.sap.vocabularies.Search.v1.Highlighted\";\n        const identifierSnippet = \"com.sap.vocabularies.Search.v1.Snippets\";\n        let value = \"\";\n        if (metadata.format === \"MultilineText\") {\n            value = structuredAttribute[identifierHighlight];\n            if (value) {\n                return this._getFirstItemIfArray(value);\n            }\n            value = structuredAttribute[identifierSnippet];\n            if (value) {\n                return this._getFirstItemIfArray(value);\n            }\n            return attrWhyFound;\n        }\n        value = structuredAttribute[identifierSnippet];\n        if (value) {\n            return this._getFirstItemIfArray(value);\n        }\n        value = structuredAttribute[identifierHighlight];\n        if (value) {\n            return this._getFirstItemIfArray(value);\n        }\n        return this._getFirstItemIfArray(attrWhyFound);\n    }\n\n    calIsHighlighted(attrWhyFound): boolean {\n        if (\n            typeof attrWhyFound === \"string\" &&\n            attrWhyFound.length > 0 &&\n            attrWhyFound.indexOf(\"<b>\") > -1 &&\n            attrWhyFound.indexOf(\"</b>\") > -1\n        ) {\n            return true;\n        }\n\n        // Must not come from Snippets and Highlighted\n        if (Array.isArray(attrWhyFound) && attrWhyFound.length > 0) {\n            return true;\n        }\n\n        return false;\n    }\n}\n"],"mappings":"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","ignoreList":[]}