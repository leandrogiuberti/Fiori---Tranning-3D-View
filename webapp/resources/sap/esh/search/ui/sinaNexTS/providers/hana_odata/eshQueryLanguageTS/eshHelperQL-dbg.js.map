{"version":3,"file":"eshHelperQL-dbg.js","names":["sap","ui","define","___eshObjects_src_index","Expression","LogicalOperator","SEARCH_DEFAULTS","parseFreeStyleText","createEshSearchQueryUrl","options","searchPath","resourcePath","metadataCall","metadataObjects","entitySets","suggestTerm","encodeURIComponent","replace","newODataFilter","operator","and","items","query","scope","$select","facets","oDataFilter","push","length","urlSearchPath","searchQueryFilter","searchQueryFilterStatement","toStatement","trim","freeStyleText","freeStyleTextExpression","parameters","optionKey","Object","keys","$apply","filter","groupby","properties","join","aggregateCountAlias","$orderby","map","i","key","order","queryParameters","__exports","__esModule"],"sources":["eshHelperQL.ts"],"sourcesContent":["/*!\n * SAPUI5\n * Copyright (c) 2025 SAP SE or an SAP affiliate company. All rights reserved.\n * \n */\n// file copied from DSP (DSP specifica removed), src/components/shell/utility/Crud.ts\n// import * as eshObjectsQL from \"../sinaNexTS/providers/hana_odata/eshObjects/src/index\";\nimport {\n    Expression,\n    IESSearchOptions,\n    LogicalOperator,\n    SEARCH_DEFAULTS,\n    parseFreeStyleText,\n} from \"../eshObjects/src/index\";\n\ninterface ParametersType {\n    $apply?: string;\n    $orderby?: string;\n    [key: string]: string;\n}\nexport function createEshSearchQueryUrl(options?: IESSearchOptions): string {\n    let searchPath = options.resourcePath || \"/$all\";\n    if (options.metadataCall === true) {\n        if (options.metadataObjects) {\n            if (options.metadataObjects.entitySets) {\n                searchPath += \"/EntitySets(\" + options.metadataObjects.entitySets + \")\";\n            }\n        }\n        return searchPath;\n    }\n    if (options.suggestTerm) {\n        searchPath =\n            searchPath +\n            `/${encodeURIComponent(\"GetSuggestion(term='\" + options.suggestTerm.replace(/'/g, \"''\") + \"')\")}`;\n    }\n    const newODataFilter = new Expression({\n        operator: LogicalOperator.and,\n        items: [],\n    });\n    if (!options) {\n        options = {\n            query: SEARCH_DEFAULTS.query,\n            scope: SEARCH_DEFAULTS.scope,\n            $select: [],\n            facets: [],\n        };\n    } else {\n        if (!options.query) {\n            options.query = SEARCH_DEFAULTS.query;\n        }\n        if (!options.scope) {\n            options.scope = SEARCH_DEFAULTS.scope;\n        }\n        if (!options.$select) {\n            options.$select = [];\n        }\n        if (!options.facets) {\n            options.facets = [];\n        }\n    }\n    if (options.oDataFilter) {\n        newODataFilter.items.push(options.oDataFilter);\n    }\n    if (newODataFilter.items.length > 0) {\n        options.oDataFilter = newODataFilter;\n    }\n    const urlSearchPath = searchPath;\n    let query = \"SCOPE:\" + options.scope;\n\n    if (options.searchQueryFilter) {\n        const searchQueryFilterStatement = options.searchQueryFilter.toStatement().trim();\n        if (searchQueryFilterStatement.length > 0) {\n            if (query !== \"\") {\n                query += \" \";\n            }\n            query += searchQueryFilterStatement;\n        }\n    }\n    if (options.freeStyleText) {\n        if (query !== \"\") {\n            query += \" \";\n        }\n        const freeStyleTextExpression = parseFreeStyleText(options.freeStyleText);\n        query += freeStyleTextExpression.toStatement();\n    }\n    const parameters: ParametersType = {};\n    for (const optionKey of Object.keys(options)) {\n        switch (optionKey) {\n            case \"query\":\n                if (options.$apply) {\n                    // it is not allowed to use query and $apply together\n                    break;\n                }\n                // eslint-disable-next-line no-case-declarations\n                let filter = query === \"\" ? \"\" : \"filter(Search.search(query='\" + query + \"')\";\n                if (options.oDataFilter && options.oDataFilter.items.length > 0) {\n                    filter += \" and \" + options.oDataFilter.toStatement();\n                }\n                if (query !== \"\") {\n                    filter += \")\";\n                }\n                if (options.groupby && options.groupby.properties && options.groupby.properties.length > 0) {\n                    filter += `/groupby((${options.groupby.properties.join(\",\")})`;\n                    if (options.groupby.aggregateCountAlias && options.groupby.aggregateCountAlias !== \"\") {\n                        filter += `,aggregate($count as ${options.groupby.aggregateCountAlias})`;\n                    }\n                    filter += \")\";\n                }\n                if (filter !== \"\") {\n                    parameters.$apply = filter;\n                }\n                break;\n            case \"$orderby\":\n                if (options.$orderby) {\n                    parameters.$orderby = options.$orderby.map((i) => i.key + \" \" + i.order).join(\",\");\n                }\n                break;\n            case \"facets\":\n            case \"$select\":\n                if (options[optionKey].length > 0) {\n                    parameters[optionKey] = options[optionKey].join(\",\");\n                }\n                break;\n            case \"$top\":\n            case \"$skip\":\n            case \"$count\":\n            case \"whyfound\":\n            case \"estimate\":\n            case \"wherefound\":\n            case \"language\":\n            case \"facetlimit\":\n                parameters[optionKey] = options[optionKey];\n                break;\n            case \"resourcePath\":\n            default:\n                break;\n        }\n    }\n    const queryParameters = Object.keys(parameters)\n        .map((i) => encodeURIComponent(i) + \"=\" + encodeURIComponent(parameters[i]))\n        .join(\"&\");\n    return queryParameters === \"\" ? urlSearchPath : urlSearchPath + \"?\" + queryParameters;\n}\n"],"mappings":"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","ignoreList":[]}