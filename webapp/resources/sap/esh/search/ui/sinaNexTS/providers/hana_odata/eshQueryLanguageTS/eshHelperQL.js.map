{"version":3,"file":"eshHelperQL.js","names":["sap","ui","define","___eshObjects_src_index","Expression","LogicalOperator","SEARCH_DEFAULTS","parseFreeStyleText","createEshSearchQueryUrl","options","searchPath","resourcePath","metadataCall","metadataObjects","entitySets","suggestTerm","encodeURIComponent","replace","newODataFilter","operator","and","items","query","scope","$select","facets","oDataFilter","push","length","urlSearchPath","searchQueryFilter","searchQueryFilterStatement","toStatement","trim","freeStyleText","freeStyleTextExpression","parameters","optionKey","Object","keys","$apply","filter","groupby","properties","join","aggregateCountAlias","$orderby","map","i","key","order","queryParameters","__exports","__esModule"],"sources":["eshHelperQL.ts"],"sourcesContent":["/*!\n * SAPUI5\n * Copyright (c) 2025 SAP SE or an SAP affiliate company. All rights reserved.\n * \n */\n// file copied from DSP (DSP specifica removed), src/components/shell/utility/Crud.ts\n// import * as eshObjectsQL from \"../sinaNexTS/providers/hana_odata/eshObjects/src/index\";\nimport {\n    Expression,\n    IESSearchOptions,\n    LogicalOperator,\n    SEARCH_DEFAULTS,\n    parseFreeStyleText,\n} from \"../eshObjects/src/index\";\n\ninterface ParametersType {\n    $apply?: string;\n    $orderby?: string;\n    [key: string]: string;\n}\nexport function createEshSearchQueryUrl(options?: IESSearchOptions): string {\n    let searchPath = options.resourcePath || \"/$all\";\n    if (options.metadataCall === true) {\n        if (options.metadataObjects) {\n            if (options.metadataObjects.entitySets) {\n                searchPath += \"/EntitySets(\" + options.metadataObjects.entitySets + \")\";\n            }\n        }\n        return searchPath;\n    }\n    if (options.suggestTerm) {\n        searchPath =\n            searchPath +\n            `/${encodeURIComponent(\"GetSuggestion(term='\" + options.suggestTerm.replace(/'/g, \"''\") + \"')\")}`;\n    }\n    const newODataFilter = new Expression({\n        operator: LogicalOperator.and,\n        items: [],\n    });\n    if (!options) {\n        options = {\n            query: SEARCH_DEFAULTS.query,\n            scope: SEARCH_DEFAULTS.scope,\n            $select: [],\n            facets: [],\n        };\n    } else {\n        if (!options.query) {\n            options.query = SEARCH_DEFAULTS.query;\n        }\n        if (!options.scope) {\n            options.scope = SEARCH_DEFAULTS.scope;\n        }\n        if (!options.$select) {\n            options.$select = [];\n        }\n        if (!options.facets) {\n            options.facets = [];\n        }\n    }\n    if (options.oDataFilter) {\n        newODataFilter.items.push(options.oDataFilter);\n    }\n    if (newODataFilter.items.length > 0) {\n        options.oDataFilter = newODataFilter;\n    }\n    const urlSearchPath = searchPath;\n    let query = \"SCOPE:\" + options.scope;\n\n    if (options.searchQueryFilter) {\n        const searchQueryFilterStatement = options.searchQueryFilter.toStatement().trim();\n        if (searchQueryFilterStatement.length > 0) {\n            if (query !== \"\") {\n                query += \" \";\n            }\n            query += searchQueryFilterStatement;\n        }\n    }\n    if (options.freeStyleText) {\n        if (query !== \"\") {\n            query += \" \";\n        }\n        const freeStyleTextExpression = parseFreeStyleText(options.freeStyleText);\n        query += freeStyleTextExpression.toStatement();\n    }\n    const parameters: ParametersType = {};\n    for (const optionKey of Object.keys(options)) {\n        switch (optionKey) {\n            case \"query\":\n                if (options.$apply) {\n                    // it is not allowed to use query and $apply together\n                    break;\n                }\n                // eslint-disable-next-line no-case-declarations\n                let filter = query === \"\" ? \"\" : \"filter(Search.search(query='\" + query + \"')\";\n                if (options.oDataFilter && options.oDataFilter.items.length > 0) {\n                    filter += \" and \" + options.oDataFilter.toStatement();\n                }\n                if (query !== \"\") {\n                    filter += \")\";\n                }\n                if (options.groupby && options.groupby.properties && options.groupby.properties.length > 0) {\n                    filter += `/groupby((${options.groupby.properties.join(\",\")})`;\n                    if (options.groupby.aggregateCountAlias && options.groupby.aggregateCountAlias !== \"\") {\n                        filter += `,aggregate($count as ${options.groupby.aggregateCountAlias})`;\n                    }\n                    filter += \")\";\n                }\n                if (filter !== \"\") {\n                    parameters.$apply = filter;\n                }\n                break;\n            case \"$orderby\":\n                if (options.$orderby) {\n                    parameters.$orderby = options.$orderby.map((i) => i.key + \" \" + i.order).join(\",\");\n                }\n                break;\n            case \"facets\":\n            case \"$select\":\n                if (options[optionKey].length > 0) {\n                    parameters[optionKey] = options[optionKey].join(\",\");\n                }\n                break;\n            case \"$top\":\n            case \"$skip\":\n            case \"$count\":\n            case \"whyfound\":\n            case \"estimate\":\n            case \"wherefound\":\n            case \"language\":\n            case \"facetlimit\":\n                parameters[optionKey] = options[optionKey];\n                break;\n            case \"resourcePath\":\n            default:\n                break;\n        }\n    }\n    const queryParameters = Object.keys(parameters)\n        .map((i) => encodeURIComponent(i) + \"=\" + encodeURIComponent(parameters[i]))\n        .join(\"&\");\n    return queryParameters === \"\" ? urlSearchPath : urlSearchPath + \"?\" + queryParameters;\n}\n"],"mappings":"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","ignoreList":[]}