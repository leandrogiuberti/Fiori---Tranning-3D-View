{"version":3,"file":"ajaxErrorFactory-dbg.js","names":["sap","ui","define","____core_errors","____sina_i18n","ServerErrorCode","ServerError","InternalSinaError","getText","ajaxErrorFactory","request","response","errorFactories","ajaxNlqErrorFactory","ajaxDefaultErrorFactory","errors","errorFactory","error","push","mergeErrors","length","details","message","code","E001","join","data","includes","responseData","dataJSON","d","ExecutionDetails","results","serverMessages","executionDetail","DataSourceId","Failed","ErrorMessage","E500","messages","value","trim","innererror","application","component_id","Error_Resolution","SAP_Note","__exports","__esModule"],"sources":["ajaxErrorFactory.ts"],"sourcesContent":["/*!\n * SAPUI5\n * Copyright (c) 2025 SAP SE or an SAP affiliate company. All rights reserved.\n * \n */\nimport { RequestProperties, ResponseProperties } from \"../../core/ajax\";\nimport { ServerErrorCode, SinaError, ServerError, InternalSinaError } from \"../../core/errors\";\nimport { getText } from \"../../sina/i18n\";\n\nexport function ajaxErrorFactory(request: RequestProperties, response: ResponseProperties): SinaError {\n    const errorFactories = [ajaxNlqErrorFactory, ajaxDefaultErrorFactory];\n    const errors: Array<SinaError> = [];\n    for (const errorFactory of errorFactories) {\n        const error = errorFactory(request, response);\n        if (error) {\n            errors.push(error);\n        }\n    }\n    return mergeErrors(errors);\n}\n\nfunction mergeErrors(errors: SinaError[]): SinaError {\n    if (errors.length === 0) {\n        return;\n    }\n    if (errors.length === 1) {\n        return errors[0];\n    }\n    const details = [];\n    for (const error of errors) {\n        if (!(error instanceof ServerError)) {\n            return new InternalSinaError({\n                message: \"program error: error factory returned an error that is not a ServerError\",\n            });\n        }\n        details.push(error.message + \"\\n\");\n        details.push(error.details + \"\\n\");\n    }\n    return new ServerError({\n        request: (errors[0] as ServerError).request,\n        response: (errors[0] as ServerError).response,\n        code: ServerErrorCode.E001,\n        message: getText(\"error.sina.generalServerError2\"),\n        details: details.join(\"\\n\"),\n    });\n}\n\n// AI error factory\nfunction ajaxNlqErrorFactory(request: RequestProperties, response: ResponseProperties): SinaError {\n    //\n\n    // factory is only active if nlq is activated\n    if (!request?.data?.includes('\"ActivateNLQ\":true')) {\n        return;\n    }\n\n    // check for repsonse data\n    if (!response.data) {\n        return;\n    }\n\n    // check for json\n    const responseData: any = response.dataJSON;\n    if (!responseData) {\n        return;\n    }\n\n    // check for execution details existence\n    if (!(responseData?.d?.ExecutionDetails?.results?.length > 0)) {\n        return;\n    }\n\n    // loop through execution details\n    const serverMessages = [];\n    for (const executionDetail of responseData.d.ExecutionDetails.results) {\n        if (\n            // very special check for AI not available error\n            executionDetail?.DataSourceId === \"0_GENERIC\" &&\n            executionDetail?.Failed === false &&\n            executionDetail?.ErrorMessage\n        ) {\n            serverMessages.push(executionDetail.ErrorMessage);\n        }\n    }\n\n    // generate error\n    if (serverMessages.length > 0) {\n        return new ServerError({\n            request: request,\n            response: response,\n            code: ServerErrorCode.E500,\n            message: getText(\"error.sina.nlqNotAvailableError\"),\n            details: serverMessages.join(\"\\n\"),\n        });\n    }\n}\n\n// default error factory\nfunction ajaxDefaultErrorFactory(request: RequestProperties, response: ResponseProperties): SinaError {\n    //\n    // check for repsonse data\n    if (!response.data) {\n        return;\n    }\n\n    // check for json\n    const responseData: any = response.dataJSON;\n    if (!responseData) {\n        return;\n    }\n\n    // check for error\n    if (typeof responseData !== \"object\") {\n        return;\n    }\n    if (!responseData?.error?.code) {\n        return;\n    }\n\n    // parse messages\n    const messages = [];\n    messages.push(getText(\"error.sina.generalServerError2\"));\n    messages.push(getText(\"error.sina.errorCode\", [responseData.error.code]));\n    if (responseData?.error?.message?.value) {\n        const value = responseData.error.message.value.trim();\n        messages.push(value);\n    }\n\n    // parse details\n    const details = [];\n    if (responseData?.error?.innererror) {\n        const innererror = responseData?.error?.innererror;\n        if (innererror?.application?.component_id) {\n            details.push(getText(\"error.sina.applicationComponent\", [innererror?.application?.component_id]));\n        }\n        if (innererror?.Error_Resolution?.SAP_Note) {\n            details.push(getText(\"error.sina.solutionNote\", [innererror?.Error_Resolution?.SAP_Note]));\n        }\n    }\n\n    // create error\n    return new ServerError({\n        request: request,\n        response: response,\n        code: ServerErrorCode.E001,\n        message: messages.join(\"\\n\"),\n        details: details.join(\"\\n\"),\n    });\n}\n"],"mappings":"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","ignoreList":[]}