/*!
 * SAPUI5
 * Copyright (c) 2025 SAP SE or an SAP affiliate company. All rights reserved.
 * 
 */
sap.ui.define(["../../core/util","./typeConverter","./pivotTableParser","../../core/errors"],function(t,e,a,i){"use strict";const r=i["WhyFoundAttributeMetadataMissingError"];class s{provider;sina;intentsResolver;constructor(t){this.provider=t;this.sina=t.sina;this.intentsResolver=this.sina._createFioriIntentsResolver()}parse(t,e){const i=this.parseTotalCount(e);e=a.parse(e);if(e.axes.length===0){return Promise.resolve({totalCount:0,items:[]})}const r=e.axes[0];const s=[];for(let t=0;t<r.length;++t){const e=r[t];this.provider.metadataParser.parseSearchRequestMetadata(e);const a=this.parseItem(e);s.push(a)}return Promise.all(s).then(function(t){return{totalCount:i,items:t}})}parseTotalCount(t){if(t.ItemLists&&t.ItemLists[0]&&t.ItemLists[0].TotalCount){return t.ItemLists[0].TotalCount.Value}return 0}parseItem(t){const a=[];const i=[];const r=[];const s=this.sina.getDataSource(t.$$DataSourceMetaData$$[0].ObjectName);for(let n=0;n<t.$$ResultItemAttributes$$.length;++n){const o=t.$$ResultItemAttributes$$[n];const u=s.getAttributeMetadata(o.Name);const l=this.sina._createSearchResultSetItemAttribute({id:o.Name,label:s.getAttributeMetadata(o.Name).label,value:e.ina2Sina(u.type,o.Value),valueFormatted:o.ValueFormatted||o.Value,valueHighlighted:o.ValueFormatted||o.Value,isHighlighted:false,metadata:u});if(u.usage.Title){a.push(l)}if(u.usage.Detail){i.push(l)}for(let e=0;e<t.$$AttributeMetadata$$.length;e++){const a=t.$$AttributeMetadata$$[e];if(a.Name==o.Name){if(a.SemanticObjectType&&a.SemanticObjectType.length>0){r.push({name:a.SemanticObjectType,value:l.value,type:l.metadata.type})}break}}}a.sort(function(t,e){return t.metadata.usage.Title.displayOrder-e.metadata.usage.Title.displayOrder});i.sort(function(t,e){return t.metadata.usage.Detail.displayOrder-e.metadata.usage.Detail.displayOrder});this.parseWhyFound(s,a,i,t);let n;for(let e=0;e<t.$$RelatedActions$$.length;++e){const a=t.$$RelatedActions$$[e];if(a.Type==="GeneralUri"||a.Type==="SAPNavigation"){const t=a.Description;const e=encodeURI(a.Uri);n=this.sina.createNavigationTarget({text:t,targetUrl:e})}}const o=t.$$DataSourceMetaData$$[0].SemanticObjectType;const u=t.$$DataSourceMetaData$$[0].SystemId;const l=t.$$DataSourceMetaData$$[0].Client;return this.intentsResolver.resolveIntents({semanticObjectType:o,semanticObjectTypeAttributes:r,systemId:u,client:l,fallbackDefaultNavigationTarget:n}).then(function(t){const e=t&&t.defaultNavigationTarget;const r=t&&t.navigationTargets;const n=this.sina._createSearchResultSetItem({dataSource:s,titleAttributes:a,titleDescriptionAttributes:[],detailAttributes:i,defaultNavigationTarget:e,navigationTargets:r});return n}.bind(this))}parseWhyFound(e,a,i,s){let n,o,u,l,c;for(n=0;n<s.$$WhyFound$$.length;n++){o=s.$$WhyFound$$[n];u=this.getResponseAttributeId(e,o.Name);for(l=0;l<a.length;++l){c=a[l];if(u===c.id){o.matched=true;c.valueHighlighted=o.Value;c.isHighlighted=true;break}}for(l=0;l<i.length;++l){c=i[l];if(u===c.id){o.matched=true;c.valueHighlighted=o.Value;c.isHighlighted=true;break}}}for(n=0;n<s.$$WhyFound$$.length;n++){o=s.$$WhyFound$$[n];if(o.matched){continue}u=this.getResponseAttributeId(e,o.Name);const a=e.getAttributeMetadata(u);if(!a){throw new r(u)}c=this.sina._createSearchResultSetItemAttribute({id:a.id,label:a.label,value:null,valueFormatted:t.filterString(o.Value,["<b>","</b>"]),valueHighlighted:o.Value,isHighlighted:true,metadata:a});i.push(c)}}getResponseAttributeId(t,e){const a=this.provider.getInternalMetadataAttribute(t,e);if(!a){return e}const i=this.provider.getInternalMetadataAttribute(t,a.correspondingSearchAttributeName);if(!i){return e}return i.Name}}var n={__esModule:true};n.ItemParser=s;return n});
//# sourceMappingURL=ItemParser.js.map