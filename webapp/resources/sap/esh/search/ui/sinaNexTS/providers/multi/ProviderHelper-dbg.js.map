{"version":3,"file":"ProviderHelper-dbg.js","names":["sap","ui","define","ProviderHelper","provider","sina","constructor","calculateMultiDataSourceLabel","label","identify","id","calculateMultiDataSourceId","updateProviderId","childSina","i","duplicateSina","findSinaById","createMultiDataSource","dataSource","_createDataSource","labelPlural","type","hidden","attributesMetadata","providerId","multiSina","length","undefined","updateAttributesMetadata","dataSourceWithMetadata","attributeMetadataMap","updateSuggestionDataSource","results","items","item","childSuggestions","j","childSuggestion","dataSourceId","dataSourceMap","filter","multiDataSourceId","multiDataSource","createMultiChartResultSet","chartResultSet","that","multiChartResultSet","_createChartResultSet","query","title","facetTotalCount","childChartResultSetItem","childFilterCondition","parseConditionFromJson","filterCondition","toJson","push","_createChartResultSetItem","dimensionValueFormatted","measureValue","measureValueFormatted","updateDataSourceFacets","resultSetFacets","facetItem","facetItemMultiId","multiDataSourceMap","updateRootCondition","rootCondition","conditions","__exports","__esModule"],"sources":["ProviderHelper.ts"],"sourcesContent":["/*!\n * SAPUI5\n * Copyright (c) 2025 SAP SE or an SAP affiliate company. All rights reserved.\n * \n */\nimport { MultiProvider } from \"./Provider\";\nimport { Sina } from \"../../sina/Sina\";\nimport { ComplexCondition } from \"../../sina/ComplexCondition\";\nimport { AbstractProvider } from \"../AbstractProvider\";\nimport { DataSource } from \"../../sina/DataSource\";\n\nexport class ProviderHelper {\n    provider: MultiProvider;\n    sina: Sina;\n\n    constructor(provider: MultiProvider) {\n        this.provider = provider;\n        this.sina = provider.sina;\n    }\n\n    calculateMultiDataSourceLabel(label: string, provider: AbstractProvider): string {\n        if (provider.label) {\n            const identify = provider.label || provider.id;\n            return label + \" - \" + identify;\n        }\n        return label;\n    }\n\n    calculateMultiDataSourceId(id: string, identify: string): string {\n        return identify + \"_\" + id;\n    }\n\n    updateProviderId(childSina: Sina): void {\n        let i = 0;\n        for (;;) {\n            if (i !== 0) {\n                childSina.provider.id = childSina.provider.id + \"_\" + i;\n            }\n            const duplicateSina = this.findSinaById(childSina.provider.id);\n            if (duplicateSina) {\n                i++;\n                continue;\n            } else {\n                break;\n            }\n        }\n    }\n\n    //input: multiDataSource id, dataSource with child provider, output: dataSource with multi provider\n    createMultiDataSource(id: string, dataSource: DataSource): DataSource {\n        return this.sina._createDataSource({\n            id: id,\n            label: this.calculateMultiDataSourceLabel(dataSource.label, dataSource.sina.provider),\n            labelPlural: this.calculateMultiDataSourceLabel(dataSource.labelPlural, dataSource.sina.provider),\n            type: dataSource.type,\n            hidden: dataSource.hidden,\n            attributesMetadata: dataSource.attributesMetadata,\n        });\n    }\n\n    findSinaById(providerId: string): Sina | undefined {\n        for (let i = 0; i < this.provider.multiSina.length; i++) {\n            const childSina = this.provider.multiSina[i];\n            if (providerId === childSina.provider.id) {\n                return childSina;\n            }\n        }\n        return undefined;\n    }\n\n    updateAttributesMetadata(dataSourceWithMetadata: DataSource, dataSource: DataSource): void {\n        dataSource.attributesMetadata = dataSourceWithMetadata.attributesMetadata;\n        dataSource.attributeMetadataMap = dataSourceWithMetadata.attributeMetadataMap;\n    }\n\n    updateSuggestionDataSource(results) {\n        for (let i = 0; i < results.items.length; i++) {\n            const item = results.items[i];\n            if (item.childSuggestions) {\n                for (let j = 0; j < item.childSuggestions.length; j++) {\n                    const childSuggestion = item.childSuggestions[j];\n                    const dataSourceId = this.calculateMultiDataSourceId(\n                        childSuggestion.dataSource.id,\n                        childSuggestion.sina.provider.id\n                    );\n                    childSuggestion.dataSource = this.sina.dataSourceMap[dataSourceId];\n                    childSuggestion.filter.dataSource = this.sina.dataSourceMap[dataSourceId];\n                }\n            }\n            //update dataSource for dataSource suggestion type\n            if (item.dataSource) {\n                item.label = this.calculateMultiDataSourceLabel(item.label, item.sina.provider);\n                const multiDataSourceId = this.calculateMultiDataSourceId(\n                    item.dataSource.id,\n                    item.sina.provider.id\n                );\n                // const multiDataSource = this.createMultiDataSource(multiDataSourceId, item.dataSource);\n                const multiDataSource = this.sina.dataSourceMap[multiDataSourceId];\n                item.dataSource = multiDataSource;\n                item.sina = this.sina;\n            }\n        }\n        return results;\n    }\n\n    createMultiChartResultSet(chartResultSet) {\n        // eslint-disable-next-line @typescript-eslint/no-this-alias\n        const that = this;\n        const multiChartResultSet = that.sina._createChartResultSet({\n            id: chartResultSet.id,\n            items: [],\n            query: chartResultSet.query,\n            title: chartResultSet.title,\n            facetTotalCount: undefined,\n        });\n        for (let i = 0; i < chartResultSet.items.length; i++) {\n            const childChartResultSetItem = chartResultSet.items[i];\n            const childFilterCondition = that.sina.parseConditionFromJson(\n                childChartResultSetItem.filterCondition.toJson()\n            );\n            multiChartResultSet.items.push(\n                that.sina._createChartResultSetItem({\n                    filterCondition: childFilterCondition,\n                    dimensionValueFormatted: childChartResultSetItem.dimensionValueFormatted,\n                    measureValue: childChartResultSetItem.measureValue,\n                    measureValueFormatted: childChartResultSetItem.measureValueFormatted,\n                })\n            );\n        }\n        return multiChartResultSet;\n    }\n\n    updateDataSourceFacets(resultSetFacets) {\n        for (let j = 0; j < resultSetFacets[0].items.length; j++) {\n            const facetItem = resultSetFacets[0].items[j];\n            if (facetItem.dataSource) {\n                const facetItemMultiId = this.calculateMultiDataSourceId(\n                    facetItem.dataSource.id,\n                    facetItem.sina.provider.id\n                );\n                //new Category, should be insert to multi provider\n                if (!this.provider.multiDataSourceMap[facetItemMultiId]) {\n                    this.createMultiDataSource(facetItemMultiId, facetItem.dataSource);\n                    this.provider.multiDataSourceMap[facetItemMultiId] = facetItem.dataSource;\n                }\n                //set the facet result item dataSource as multi provider dataSource\n                facetItem.dataSource = this.sina.dataSourceMap[facetItemMultiId];\n            }\n        }\n        return resultSetFacets;\n    }\n\n    // update rootCondition sina as childSina\n    updateRootCondition(rootCondition: ComplexCondition, childSina: Sina): void {\n        rootCondition.sina = childSina;\n        if (rootCondition.conditions && rootCondition.conditions.length > 0) {\n            for (let i = 0; i < rootCondition.conditions.length; i++) {\n                this.updateRootCondition(rootCondition.conditions[i] as ComplexCondition, childSina);\n            }\n        }\n    }\n}\n"],"mappings":"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","ignoreList":[]}