{"version":3,"file":"suggestionParser-dbg.js","names":["sap","ui","define","____sina_SuggestionCalculationMode","____sina_SuggestionType","____core_errors","SuggestionCalculationMode","SuggestionType","InternalSinaError","SuggestionParser","provider","sina","constructor","parse","query","data","suggestions","suggestion","cell","i","length","parseSearchTermSuggestion","push","parseDataSourceSuggestion","calculationMode","Data","dataSource","getDataSource","FromDataSource","filter","clone","setDataSource","_createDataSourceSuggestion","label","SearchTermsHighlighted","setSearchTerm","term","types","indexOf","SearchTermAI","message","_createSearchTermAISuggestion","searchTerm","highlighted","_createSearchTermSuggestion","parseSearchTermAndDataSourceSuggestion","parseCalculationMode","Type","SearchTerms","_createSearchTermAndDataSourceSuggestion","parseObjectSuggestions","searchItems","objectSuggestions","object","fillValueHighlighted","title","titleAttributes","map","attribute","valueFormatted","join","oObjectSuggestion","_createObjectSuggestion","doFillValueHighlighted","attributes","valueHighlighted","startsWith","detailAttributes","scope","History","__exports","__esModule"],"sources":["suggestionParser.ts"],"sourcesContent":["/*!\n * SAPUI5\n * Copyright (c) 2025 SAP SE or an SAP affiliate company. All rights reserved.\n * \n */\nimport { HANAOdataSuggestionResponseResult, Provider } from \"./Provider\";\nimport { Sina } from \"../../sina/Sina\";\nimport { SuggestionQuery } from \"../../sina/SuggestionQuery\";\nimport { SearchTermSuggestion } from \"../../sina/SearchTermSuggestion\";\nimport { DataSourceSuggestion } from \"../../sina/DataSourceSuggestion\";\nimport { SearchTermAndDataSourceSuggestion } from \"../../sina/SearchTermAndDataSourceSuggestion\";\nimport { SuggestionCalculationMode } from \"../../sina/SuggestionCalculationMode\";\nimport { ObjectSuggestion } from \"../../sina/ObjectSuggestion\";\nimport { SuggestionType } from \"../../sina/SuggestionType\";\nimport { InternalSinaError } from \"../../core/errors\";\n\nexport class SuggestionParser {\n    provider: Provider;\n    sina: Sina;\n\n    constructor(provider: Provider) {\n        this.provider = provider;\n        this.sina = provider.sina;\n    }\n\n    parse(\n        query: SuggestionQuery,\n        data: Array<HANAOdataSuggestionResponseResult>\n    ): Array<SearchTermSuggestion> {\n        const suggestions = [];\n        let suggestion;\n        // var parentSuggestion;\n        // var parentSuggestions = [];\n        // var suggestionSearchTerms = [];\n        let cell;\n        // var parentCell;\n        // var calculationMode;\n\n        for (let i = 0; i < data.length; i++) {\n            suggestion = null;\n            cell = data[i];\n            // calculationMode = this.parseCalculationMode(cell.Type);\n            //\n            // switch (cell.Type) {\n            // case 'H':\n            //     suggestion = this.parseSearchTermSuggestion(query, cell);\n            //     break;\n            // case 'A':\n            //     suggestion = this.parseSearchTermAndDataSourceSuggestion(query, cell);\n            //     // attach type and cell information\n            //     suggestion.type = 'A';\n            //     suggestion.cell = cell;\n            //     break;\n            // case 'M':\n            //     suggestion = this.parseDataSourceSuggestion(query, cell);\n            //     break;\n            // }\n\n            suggestion = this.parseSearchTermSuggestion(query, cell);\n\n            // if (suggestion) {\n            //     if (suggestion.type === 'A') {\n            //         // set parent sugestion\n            //         if (parentSuggestions[suggestion.searchTerm] === undefined) {\n            //             parentCell = this._getParentCell(suggestion.cell);\n            //             parentSuggestion = this.parseSearchTermSuggestion(query, parentCell);\n            //             parentSuggestions[suggestion.searchTerm] = parentSuggestion;\n            //         }\n            //         // remove type and cell information\n            //         delete suggestion.type;\n            //         delete suggestion.cell;\n            //         // attach children\n            //         parentSuggestions[suggestion.searchTerm].childSuggestions.push(suggestion);\n            //     } else {\n            //         // push non-attribute suggestion\n            //         suggestions.push(suggestion);\n            //     }\n            // }\n            if (suggestion) {\n                suggestions.push(suggestion);\n            }\n        }\n\n        // push attribute suggestion\n        // Object.keys(parentSuggestions).forEach(function (key) {\n        //     suggestions.push(parentSuggestions[key]);\n        // });\n\n        return suggestions;\n    }\n\n    private parseDataSourceSuggestion(\n        query: SuggestionQuery,\n        cell: {\n            FromDataSource: string; // id\n            SearchTermsHighlighted: string;\n        }\n    ): DataSourceSuggestion {\n        const calculationMode = this.sina.SuggestionCalculationMode.Data; // always data suggestion\n        const dataSource = this.sina.getDataSource(cell.FromDataSource);\n        if (!dataSource) {\n            return null;\n        }\n        const filter = query.filter.clone();\n        filter.setDataSource(dataSource);\n        return this.sina._createDataSourceSuggestion({\n            calculationMode: calculationMode,\n            dataSource: dataSource,\n            label: cell.SearchTermsHighlighted,\n        });\n    }\n\n    private parseSearchTermSuggestion(\n        query: SuggestionQuery,\n        cell: {\n            term: string;\n            highlighted: string;\n        }\n    ): SearchTermSuggestion {\n        const filter = query.filter.clone();\n        filter.setSearchTerm(cell.term);\n        if (query.types.indexOf(SuggestionType.SearchTermAI) >= 0) {\n            if (query.types.length > 1) {\n                throw new InternalSinaError({\n                    message: \"mix of ai suggestions with other suggestions not allowed\",\n                });\n            }\n            if (!cell.term) {\n                return null;\n            }\n            return this.sina._createSearchTermAISuggestion({\n                searchTerm: cell.term,\n                calculationMode: this.sina.SuggestionCalculationMode.Data,\n                filter: filter,\n                label: cell.highlighted || cell.term,\n            });\n        } else {\n            return this.sina._createSearchTermSuggestion({\n                searchTerm: cell.term,\n                calculationMode: this.sina.SuggestionCalculationMode.Data,\n                filter: filter,\n                label: cell.highlighted || cell.term,\n            });\n        }\n    }\n\n    private parseSearchTermAndDataSourceSuggestion(\n        query: SuggestionQuery,\n        cell: {\n            SearchTerms: string;\n            FromDataSource: string; // id\n            SearchTermsHighlighted: string;\n            Type: \"H\" | \"A\" | \"M\";\n        }\n    ): SearchTermAndDataSourceSuggestion {\n        const calculationMode = this.parseCalculationMode(cell.Type);\n        const filter = query.filter.clone();\n        filter.setSearchTerm(cell.SearchTerms);\n        const dataSource = this.sina.getDataSource(cell.FromDataSource);\n        if (!dataSource) {\n            return null;\n        }\n        filter.setDataSource(dataSource);\n        return this.sina._createSearchTermAndDataSourceSuggestion({\n            searchTerm: cell.SearchTerms,\n            dataSource: dataSource,\n            calculationMode: calculationMode,\n            filter: filter,\n            label: cell.SearchTermsHighlighted,\n        });\n    }\n\n    public parseObjectSuggestions(query: SuggestionQuery, searchItems): Array<ObjectSuggestion> {\n        // const filter = query.filter.clone();\n        const objectSuggestions: Array<ObjectSuggestion> = [];\n        // var objectSuggestions = searchItems.d.ObjectSuggestions.SearchResults.results;\n        for (let i = 0; i < searchItems.length; ++i) {\n            const object = searchItems[i];\n            // fill highlighted value: actually it would be better to call\n            // the search result set formatter like for a regular result\n            // set\n            this.fillValueHighlighted(object);\n            const title = object.titleAttributes\n                .map(function (attribute) {\n                    return attribute.valueFormatted || \"\";\n                })\n                .join(\" \");\n            const oObjectSuggestion = this.sina._createObjectSuggestion({\n                calculationMode: this.sina.SuggestionCalculationMode.Data,\n                label: title,\n                // searchTerm: filter.searchTerm,\n                // filter: filter,\n                object: object,\n            });\n            objectSuggestions.push(oObjectSuggestion);\n        }\n        return objectSuggestions;\n    }\n\n    private fillValueHighlighted(object) {\n        const doFillValueHighlighted = function (attributes) {\n            if (!attributes) {\n                return;\n            }\n            for (let i = 0; i < attributes.length; ++i) {\n                const attribute = attributes[i];\n                if (!attribute.valueHighlighted) {\n                    if (\n                        typeof attribute.valueFormatted === \"string\" &&\n                        attribute.valueFormatted.startsWith(\"sap-icon://\") === true\n                    ) {\n                        attribute.valueHighlighted = \"\";\n                    } else {\n                        attribute.valueHighlighted = attribute.valueFormatted;\n                    }\n                }\n            }\n        };\n        doFillValueHighlighted(object.detailAttributes);\n        doFillValueHighlighted(object.titleAttributes);\n    }\n\n    private parseCalculationMode(scope: \"H\" | \"A\" | \"M\"): SuggestionCalculationMode {\n        switch (scope) {\n            case \"H\":\n                return SuggestionCalculationMode.History;\n            case \"A\":\n            case \"M\":\n                return SuggestionCalculationMode.Data;\n        }\n    }\n}\n"],"mappings":"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","ignoreList":[]}