/*!
 * SAPUI5
 * Copyright (c) 2025 SAP SE or an SAP affiliate company. All rights reserved.
 * 
 */
sap.ui.define(["./pivotTableParser","./typeConverter","../../sina/ComparisonOperator","../../sina/SearchQuery","../../sina/LogicalOperator","../../core/errors"],function(e,t,a,r,i,s){"use strict";const u=a["ComparisonOperator"];const o=r["SearchQuery"];const n=i["LogicalOperator"];const l=s["FacetsParseError"];class c{provider;sina;constructor(e){this.provider=e;this.sina=e.sina}parse(e,t){const a=[];if(!t.ResultsetFacets||!t.ResultsetFacets.Elements){return[]}for(let r=0;r<t.ResultsetFacets.Elements.length;r++){const i=t.ResultsetFacets.Elements[r];const s=i.Metadata.Cube.ObjectName;if(s==="$$DataSources$$"){a.push(this.parseDataSourceFacet(e,i))}else{if(e.filter.dataSource.type===e.sina.DataSourceType.Category){continue}a.push(this.parseChartFacet(e,i,undefined))}}return Promise.all(a)}parseDataSourceFacet(t,a){let r=t;if(t instanceof o){r=this.sina.createDataSourceQuery({dataSource:t.filter.dataSource,filter:t.filter.clone(),nlq:t.nlq})}const i=e.parse(a.ResultSet);const s=[];for(let e=0;e<i.cells.length;e++){const t=i.cells[e];let a=this.sina.getDataSource(t.$$DataSource$$[0].Value);if(!a){a=this.sina._createDataSource({type:this.sina.DataSourceType.Category,id:t.$$DataSource$$[0].Value,label:t.$$DataSource$$[0].ValueFormatted})}s.push(this.sina._createDataSourceResultSetItem({dataSource:a,dimensionValueFormatted:t.$$DataSource$$[0].ValueFormatted,measureValue:t.Value,measureValueFormatted:t.ValueFormatted}))}const u=this.sina._createDataSourceResultSet({title:t.filter.dataSource.label,items:s,query:r,facetTotalCount:undefined});if(t instanceof o){return r._setResultSet(u)}return u}createAttributeFilterCondition(e,a,r){switch(r.$$AttributeValue$$.length){case 2:return this.sina.createSimpleCondition({attribute:e,value:t.ina2Sina(a.type,r.$$AttributeValue$$[0].Value),attributeLabel:a.label,valueLabel:r.$$AttributeValue$$[0].ValueFormatted});case 3:{const i=this.sina.createComplexCondition({attributeLabel:a.label,valueLabel:r.$$AttributeValue$$[0].ValueFormatted,operator:n.And});const s=[];if(r.$$AttributeValue$$[1].Value){s.push(this.sina.createSimpleCondition({attribute:e,operator:u.Ge,value:t.ina2Sina(a.type,r.$$AttributeValue$$[1].Value)}))}if(r.$$AttributeValue$$[2].Value){s.push(this.sina.createSimpleCondition({attribute:e,operator:u.Le,value:t.ina2Sina(a.type,r.$$AttributeValue$$[2].Value)}))}i.conditions=s;return i}default:throw new l}}parseChartFacet(t,a,r){const i=this.sina.getDataSource(a.Metadata.Cube.DataSource.ObjectName);const s=a.Metadata.Cube.ObjectName;const u=i.getAttributeMetadata(s);let n=t;if(t instanceof o){const e=t.filter.clone();e.setDataSource(i);e.setRootCondition(t.filter.rootCondition.clone());n=this.sina.createChartQuery({filter:e,dimension:a.Metadata.Cube.ObjectName,nlq:t.nlq})}const l=e.parse(a.ResultSet);const c=[];for(let e=0;e<l.cells.length;e++){const t=l.cells[e];c.push(this.sina._createChartResultSetItem({filterCondition:this.createAttributeFilterCondition(s,u,t),dimensionValueFormatted:t.$$AttributeValue$$[0].ValueFormatted||t.$$AttributeValue$$[0].Value,measureValue:t.Value,measureValueFormatted:t.ValueFormatted}))}const $=this.sina._createChartResultSet({title:u.label,items:c,query:n,facetTotalCount:r});if(t instanceof o){return n._setResultSet($)}return $}}var $={__esModule:true};$.FacetParser=c;return $});
//# sourceMappingURL=FacetParser.js.map