/*!
 * SAPUI5
 * Copyright (c) 2025 SAP SE or an SAP affiliate company. All rights reserved.
 * 
 */
sap.ui.define(["../../../sina/SinaObject","../../../sina/AttributeType","./NavigationServiceFactory","../../../core/Log"],function(t,e,n,i){"use strict";const r=t["SinaObject"];const s=e["AttributeType"];const a=n["getNavigationService"];const o=i["Log"];class c extends r{_fioriFrontendSystemInfo;_primaryIntentAction;_suppressInSearchTag;log=new o("FioriIntentsResolver");constructor(t){super(t);const e=typeof window!=="undefined"?window?.sap?.ushell?.["Container"]:null;if(e){this._fioriFrontendSystemInfo={systemId:e.getLogonSystem().getName(),client:e.getLogonSystem().getClient()};this._primaryIntentAction="-displayFactSheet";this._suppressInSearchTag="suppressInEnterpriseSearch".toLowerCase()}else{this._fioriFrontendSystemInfo={systemId:"",client:""}}}async resolveIntents(t){const e=await a();if(!e||!t){return{defaultNavigationTarget:t.fallbackDefaultNavigationTarget}}if(Array.isArray(t)){const e=t.map(t=>this.doResolveIntents(t));return await Promise.all(e)}else{return await this.doResolveIntents(t)}}async doResolveIntents(t){const e=t.semanticObjectType;const n=t.semanticObjectTypeAttributes;const i=t.systemId;const r=t.client;const s=t.fallbackDefaultNavigationTarget;if(!e||e.length===0){return{defaultNavigationTarget:s}}if(!n||n.length===0){return undefined}const a=this.convertSemanticObjectTypeAttrs(n);const[o,c]=await Promise.all([this.getPrimaryIntent(e,a),this.getSecondaryIntents(e,a)]);const d={defaultNavigationTarget:undefined,navigationTargets:[]};const g=this.assembleSapSystem(i,r);let l;if(o&&!this.shallIntentBeSuppressed(o)){l=await this.getNavigationTargetForIntent(o,g);d.defaultNavigationTarget=l}let u=d.defaultNavigationTarget!==undefined;if(!c){return d}const f=[];const h=[];for(const t of c){if(this.shallIntentBeSuppressed(t)){continue}f.push(t);h.push(this.getNavigationTargetForIntent(t,g))}const m=await Promise.all(h);for(let t=0;t<f.length;++t){const e=f[t];const n=m[t];if(!u&&this.isPrimaryIntentAction(e)){d.defaultNavigationTarget=n;u=true}else if(!l||!n.isEqualTo(l)){d.navigationTargets.push(n)}}return d}isPrimaryIntentAction(t){const e=t.intent.substring(t.intent.indexOf("-"),t.intent.indexOf("?"));return e===this._primaryIntentAction}assembleSapSystem(t,e){const n={systemId:t||this._fioriFrontendSystemInfo&&this._fioriFrontendSystemInfo.systemId,client:e||this._fioriFrontendSystemInfo.client&&this._fioriFrontendSystemInfo.client};if(window.sap&&window.sap["cf"]||t&&t.trim().length>0&&e&&e.trim().length>0&&(!this._fioriFrontendSystemInfo||!(this._fioriFrontendSystemInfo.systemId===t&&this._fioriFrontendSystemInfo.client===e))){n.urlParameter="sap-system=sid("+t+"."+e+")"}return n}convertSemanticObjectTypeAttrs(t){const e={};for(const n of t){const t=this.convertAttributeValueToUI5DataTypeFormats(n.value,n.type);e[n.name]=t}return e}async getPrimaryIntent(t,e){const n=await a();if(!n||!n.getPrimaryIntent){return undefined}try{return await this.convertJQueryDeferredToPromise(n.getPrimaryIntent(t,e))}catch(t){this.log.warn("Error while fetching primary intent: "+t);return undefined}}async getSecondaryIntents(t,e){const n=await a();if(!n){return undefined}if(!n.getLinks){return undefined}try{return await this.convertJQueryDeferredToPromise(n.getLinks({semanticObject:t,params:e,withAtLeastOneUsedParam:true,sortResultOnTexts:true}))}catch(t){this.log.warn("Error while fetching secondary intents: "+t);return undefined}}shallIntentBeSuppressed(t){if(t.tags){for(let e=0;e<t.tags.length;e++){if(t.tags[e].toLowerCase()===this._suppressInSearchTag){return true}}}return false}async getNavigationTargetForIntent(t,e){const n=await a();let i=t.intent;if(e.urlParameter){if(i.indexOf("?")===-1){i+="?"}else{i+="&"}i+=e.urlParameter}const r={target:{shellHash:i}};const s=await this.convertJQueryDeferredToPromise(n.hrefForExternalAsync(r));const o=this.sina.createNavigationTarget({text:t.text,targetUrl:s,customWindowOpenFunction:()=>{n.toExternal(r)}});return o}convertAttributeValueToUI5DataTypeFormats(t,e){let n,i,r,a,o,c,d;switch(e){case s.Timestamp:n=t.getUTCFullYear();i=t.getUTCMonth()+1;r=t.getUTCDate();a=t.getUTCHours();o=t.getUTCMinutes();c=t.getUTCSeconds();d=t.getUTCMilliseconds()*1e3;t=this.addLeadingZeros(n.toString(),4)+"-"+this.addLeadingZeros(i.toString(),2)+"-"+this.addLeadingZeros(r.toString(),2)+"T"+this.addLeadingZeros(a.toString(),2)+":"+this.addLeadingZeros(o.toString(),2)+":"+this.addLeadingZeros(c.toString(),2)+"."+this.addLeadingZeros(d.toString(),3);break;case s.Date:t=t.slice(0,4)+"-"+t.slice(5,7)+"-"+t.slice(8,10);break}return t}addLeadingZeros(t,e){return"00000000000000".slice(0,e-t.length)+t}convertJQueryDeferredToPromise(t){if(t.always){return new Promise(function(e,n){t.then(e,n)})}else{return t}}}var d={__esModule:true};d.FioriIntentsResolver=c;return d});
//# sourceMappingURL=FioriIntentsResolver.js.map