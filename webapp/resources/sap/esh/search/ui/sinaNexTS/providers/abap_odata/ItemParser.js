/*!
 * SAPUI5
 * Copyright (c) 2025 SAP SE or an SAP affiliate company. All rights reserved.
 * 
 */
sap.ui.define(["../../sina/SinaObject","../../core/util","./typeConverter","../../sina/AttributeType","../tools/WhyfoundProcessor"],function(t,e,i,s,r){"use strict";const a=t["SinaObject"];const u=s["AttributeType"];const n=r["WhyfoundProcessor"];class l extends a{provider;suvNavTargetResolver;constructor(t){super();this.provider=t;this.sina=t.sina;this.suvNavTargetResolver=this.sina._createSuvNavTargetResolver()}parse(t,e){if(e.ResultList.SearchResults===null){return Promise.resolve([])}const i=e.ResultList.SearchResults.results;return this.parseItems(i)}parseItems(t){const e=[];for(let i=0;i<t.length;++i){const s=t[i];const r=this.parseItem(s);e.push(r)}return Promise.all(e)}async parseItem(t){let s;const r={};const a=[];const l=[];const o=[];const d=[];const p=[];let g;const c=this.sina.getDataSource(t.DataSourceId);let h,b,f,v;const m=Number(t.Score)/100;const A=[];let T,y,I,S;const _={};let M={};const N=new n(this.sina);for(s=0;s<t.Attributes.results.length;s++){h=t.Attributes.results[s];b=c.getAttributeMetadata(h.Id);f=this.sina._createSearchResultSetItemAttribute({id:h.Id,label:b.label,value:i.odata2Sina(b.type,h.Value),valueFormatted:b.type===u.Timestamp?undefined:h.ValueFormatted,valueHighlighted:h.Snippet,isHighlighted:h.Snippet.indexOf("<b>")>-1&&h.Snippet.indexOf("</b>")>-1,metadata:b,groups:[]});r[f.id]=f;e.appendRemovingDuplicates(A,e.extractHighlightedTerms(f.valueHighlighted));if(b.suvUrlAttribute&&b.suvMimeTypeAttribute){I=r[b.suvUrlAttribute]||b.suvUrlAttribute.id;S=r[b.suvMimeTypeAttribute]||b.suvMimeTypeAttribute.id;_[h.Id]={suvThumbnailAttribute:f,suvTargetUrlAttribute:I,suvTargetMimeTypeAttribute:S}}if(b.usage.Navigation){if(b.usage.Navigation.mainNavigation){g=this.sina.createNavigationTarget({text:f.value,targetUrl:f.value,target:"_blank"})}}o.push(f);if(b.usage.Detail){d.push(f)}if(b.usage.Title){a.push(f)}if(b.usage.TitleDescription){l.push(f)}v=c.attributeMetadataMap[f.id]._private.semanticObjectType;if(v&&v.length>0){p.push({name:v,value:f.value,type:f.metadata.type})}if(f.isHighlighted||f.descriptionAttribute&&f.descriptionAttribute.isHighlighted){if(!this._isVisible(b)&&typeof M[f.id]==="undefined"){M[f.id]=[f.valueHighlighted]}}}for(y in _){T=_[y];if(typeof T.suvTargetUrlAttribute==="string"){T.suvTargetUrlAttribute=r[T.suvTargetUrlAttribute]}if(typeof T.suvTargetMimeTypeAttribute==="string"){T.suvTargetMimeTypeAttribute=r[T.suvTargetMimeTypeAttribute]}if(!(T.suvTargetUrlAttribute||T.suvTargetMimeTypeAttribute)){delete _[y]}}a.sort(function(t,e){return t.metadata.usage.Title.displayOrder-e.metadata.usage.Title.displayOrder});d.sort(function(t,e){return t.metadata.usage.Detail.displayOrder-e.metadata.usage.Detail.displayOrder});this.suvNavTargetResolver.resolveSuvNavTargets(c,_,A);const R=this.sina._createSearchResultSetItem({dataSource:c,attributes:o,titleAttributes:a,titleDescriptionAttributes:l,detailAttributes:d,defaultNavigationTarget:g,navigationTargets:[],score:m});R._private.allAttributesMap=r;R._private.semanticObjectTypeAttributes=p;const D=this.sina._createItemPostParser({searchResultSetItem:R});const H=R.detailAttributes;const U=await D.postParseResultSetItem();M=this._pushAdditionalWhyFounds(t,M,H);return await N.processAdditionalWhyfoundAttributes(M,U)}_isVisible(t){if(typeof t.usage.Title!=="undefined"||typeof t.usage.Detail!=="undefined"||typeof t.isDescription!=="undefined"){return true}if(Array.isArray(t.groups)){for(let e=0;e<t.groups.length;e++){const i=t.groups[e].group;if(this._isVisible(i)&&this._isInTamplate(t.id,i)){return true}}return false}return false}_isInTamplate(t,e){if(e.template&&e.attributes&&e.attributes.length>0){const i=this._getNameInGroup(t,e.attributes);if(i&&e.template.includes("{"+i+"}")){return true}}return false}_getNameInGroup(t,e){for(let i=0;i<e.length;i++){if(e[i].attribute.id===t){return e[i].nameInGroup}}return undefined}_pushAdditionalWhyFounds(t,e,i){if(t.HitAttributes&&Array.isArray(t.HitAttributes.results)){for(let s=0;s<t.HitAttributes.results.length;s++){const r=t.HitAttributes.results[s];if(typeof e[r.Id]==="undefined"&&!this._isUngrouppedDetailAttribute(r.Id,i)){e[r.Id]=[r.Snippet]}}}return e}_isUngrouppedDetailAttribute(t,e){for(let i=0;i<e.length;i++){if(t===e[i].id){return true}}return false}}var o={__esModule:true};o.ItemParser=l;return o});
//# sourceMappingURL=ItemParser.js.map