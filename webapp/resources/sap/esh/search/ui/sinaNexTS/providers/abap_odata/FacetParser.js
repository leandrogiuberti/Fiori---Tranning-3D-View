/*!
 * SAPUI5
 * Copyright (c) 2025 SAP SE or an SAP affiliate company. All rights reserved.
 * 
 */
sap.ui.define(["../../sina/ComparisonOperator","../../sina/FacetType","../../sina/LogicalOperator","../../sina/SearchQuery","./typeConverter"],function(e,t,a,r,s){"use strict";const i=e["ComparisonOperator"];const o=t["FacetType"];const u=a["LogicalOperator"];const n=r["SearchQuery"];class l{provider;sina;constructor(e){this.provider=e;this.sina=e.sina}parse(e,t){if(t.ValueHelp){this.prepareValueHelpFacet(e,t)}const a=[];if(!t.Facets||!t.Facets.results){return[]}for(let r=0;r<t.Facets.results.length;r++){const s=t.Facets.results[r];if(s.Type===o.DataSource){a.push(this.parseDataSourceFacet(e,s))}else{if(e.filter.dataSource.type===e.sina.DataSourceType.Category||e.filter.dataSource.type===e.sina.DataSourceType.UserCategory){continue}a.push(this.parseChartFacet(e,s,undefined))}}return Promise.all(a)}prepareValueHelpFacet(e,t){const a=t.ValueHelp.results;const r=this.sina.getDataSource(e.filter.dataSource.id);const s=t.ValueHelpAttribute;const i=r.getAttributeMetadata(s);const o={Id:t.ValueHelpAttribute,Name:i.label,Type:"AttributeValue",Values:{results:[]}};const u=[];for(let e=0;e<a.length;e++){const t=a[e];u.push({Description:t.ValueFormatted,NumberOfObjects:t.NumberOfInstances,Type:"AttributeValue",ValueLow:t.Value,ValueLowFormatted:t.ValueFormatted,ValueHigh:"",ValueHighFormatted:""})}o.Values.results=u;t.Facets={};t.Facets.results=[];t.Facets.results[0]=o}parseDataSourceFacet(e,t){let a=e;if(e instanceof n){a=this.sina.createDataSourceQuery({dataSource:e.filter.dataSource,filter:e.filter.clone(),nlq:e.nlq})}const r=[];for(let e=0;e<t.Values.results.length;e++){const a=t.Values.results[e];let s=this.sina.getDataSource(a.ValueLow);if(!s){s=this.sina.createDataSource({type:this.sina.DataSourceType.Category,id:a.ValueLow,label:a.Description})}r.push(this.sina._createDataSourceResultSetItem({dataSource:s,dimensionValueFormatted:s.labelPlural,measureValue:a.NumberOfObjects,measureValueFormatted:a.NumberOfObjects.toString()}))}const s=this.sina._createDataSourceResultSet({title:e.filter.dataSource.label,items:r,query:a,facetTotalCount:undefined});if(e instanceof n){return a._setResultSet(s)}return s}createAttributeFilterCondition(e,t,a){if(a.Type==="AttributeRange"){const r=[];if(a.ValueLow&&a.ValueLow.length!==0){const o=a.Type==="AttributeConstant";r.push(this.sina.createSimpleCondition({attribute:e,operator:i.Ge,value:o?a.ValueLow:s.odata2Sina(t.type,a.ValueLow),isDynamicValue:o}))}if(a.ValueHigh&&a.ValueHigh.length!==0){const o=a.Type==="AttributeConstant";r.push(this.sina.createSimpleCondition({attribute:e,operator:i.Le,value:o?a.ValueHigh:s.odata2Sina(t.type,a.ValueHigh),isDynamicValue:o}))}return this.sina.createComplexCondition({attributeLabel:t.label,valueLabel:a.Description,operator:u.And,conditions:r})}const r=a.Type==="AttributeConstant";return this.sina.createSimpleCondition({attributeLabel:t.label,attribute:e,value:r?a.ValueLow:s.odata2Sina(t.type,a.ValueLow),valueLabel:a.Description,isDynamicValue:r})}parseChartFacet(e,t,a){const r=this.sina.getDataSource(e.filter.dataSource.id);const s=t.Id;const i=r.getAttributeMetadata(s);let o,u=e;if(e instanceof n){o=e.filter.clone();o.setDataSource(r);o.setRootCondition(e.filter.rootCondition.clone());u=this.sina.createChartQuery({filter:o,dimension:t.Id,nlq:e.nlq})}const l=[];for(let e=0;e<t.Values.results.length;e++){const a=t.Values.results[e];l.push(this.sina._createChartResultSetItem({filterCondition:this.createAttributeFilterCondition(s,i,a),dimensionValueFormatted:a.Description,measureValue:a.NumberOfObjects,measureValueFormatted:a.ValueLowFormatted}))}const c=this.sina._createChartResultSet({title:i.label,items:l,query:u,facetTotalCount:a});if(e instanceof n){return u._setResultSet(c)}return c}}var c={__esModule:true};c.FacetParser=l;return c});
//# sourceMappingURL=FacetParser.js.map