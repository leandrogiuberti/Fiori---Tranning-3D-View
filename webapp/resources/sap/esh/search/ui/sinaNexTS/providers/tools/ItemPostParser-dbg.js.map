{"version":3,"file":"ItemPostParser-dbg.js","names":["sap","ui","define","____sina_SinaObject","____sina_AttributeType","___abap_odata_Provider","SinaObject","AttributeType","ABAPODataProvider","ItemPostParser","_searchResultSetItem","_dataSource","_allAttributesMap","_intentsResolver","constructor","properties","searchResultSetItem","dataSource","_private","allAttributesMap","sina","_createFioriIntentsResolver","postParseResultSetItem","prom","enhanceResultSetItemWithNavigationTargets","enhanceResultSetItemWithGroups","that","semanticObjectType","semanticObjectTypeAttributes","systemId","system","id","split","client","intents","resolveIntents","fallbackDefaultNavigationTarget","defaultNavigationTarget","navigationTargets","navigationTargetForEnhancement","push","setDefaultNavigationTarget","setNavigationTargets","enhanceNavigationTargetsWithContentProviderId","provider","contentProviderId","navigationTarget","targetUrl","attributesMetadata","i","length","attributeMetadata","type","Group","group","_addAttributeGroup","parent","usage","Detail","detailAttributes","Title","titleAttributes","TitleDescription","titleDescriptionAttributes","sortAttributes","createSortFunction","attributeName","a1","a2","displayOrder1","metadata","displayOrder","undefined","displayOrder2","sort","attributeGroupMetadata","_createSearchResultSetItemAttributeGroup","label","template","attributes","groups","displayAttributes","parentAttributeMetadata","childAttributeMetadata","parentAttribute","childAttribute","k","attributeMembershipMetadata","attribute","attributeOrGroup","attributeGroupMembership","_createSearchResultSetItemAttributeGroupMembership","__exports","__esModule"],"sources":["ItemPostParser.ts"],"sourcesContent":["/*!\n * SAPUI5\n * Copyright (c) 2025 SAP SE or an SAP affiliate company. All rights reserved.\n * \n */\nimport { SinaObject, SinaObjectProperties } from \"../../sina/SinaObject\";\nimport { AttributeType } from \"../../sina/AttributeType\";\nimport { SearchResultSetItem } from \"../../sina/SearchResultSetItem\";\nimport { NavigationTarget } from \"../../sina/NavigationTarget\";\nimport { Provider as ABAPODataProvider } from \"../abap_odata/Provider\";\nimport { SearchResultSetItemAttributeGroup } from \"../../sina/SearchResultSetItemAttributeGroup\";\nimport { DataSource } from \"../../sina/DataSource\";\n\nexport interface ItemPostParserOptions extends SinaObjectProperties {\n    searchResultSetItem: SearchResultSetItem;\n}\nexport class ItemPostParser extends SinaObject {\n    _searchResultSetItem: SearchResultSetItem;\n    _dataSource: DataSource;\n    _allAttributesMap: any;\n    _intentsResolver: any;\n\n    constructor(properties: ItemPostParserOptions) {\n        super(properties);\n        this._searchResultSetItem = properties.searchResultSetItem;\n        this._dataSource = properties.searchResultSetItem.dataSource;\n        this._allAttributesMap = properties.searchResultSetItem._private.allAttributesMap;\n\n        this._intentsResolver = this.sina._createFioriIntentsResolver({\n            sina: properties.sina,\n        });\n    }\n\n    async postParseResultSetItem(): Promise<SearchResultSetItem> {\n        const prom = this.enhanceResultSetItemWithNavigationTargets();\n        // TODO: what about exceptions?\n        this.enhanceResultSetItemWithGroups(); // can be done in parallel, if parallelization is possible\n        return prom;\n    }\n\n    async enhanceResultSetItemWithNavigationTargets(): Promise<SearchResultSetItem> {\n        // eslint-disable-next-line @typescript-eslint/no-this-alias\n        const that = this;\n        const semanticObjectType = that._dataSource._private.semanticObjectType;\n        const semanticObjectTypeAttributes = that._searchResultSetItem._private.semanticObjectTypeAttributes;\n        const systemId = that._dataSource.system?.id?.split(\".\")[0];\n        const client = that._dataSource.system?.id?.split(\".\")[1];\n        const intents = await that._intentsResolver.resolveIntents({\n            semanticObjectType: semanticObjectType,\n            semanticObjectTypeAttributes: semanticObjectTypeAttributes,\n            systemId: systemId,\n            client: client,\n            fallbackDefaultNavigationTarget: that._searchResultSetItem.defaultNavigationTarget,\n        });\n        const defaultNavigationTarget = intents && intents.defaultNavigationTarget;\n        const navigationTargets = intents && intents.navigationTargets;\n        let navigationTargetForEnhancement: Array<NavigationTarget> = [];\n        if (defaultNavigationTarget) {\n            navigationTargetForEnhancement.push(defaultNavigationTarget);\n            that._searchResultSetItem.setDefaultNavigationTarget(defaultNavigationTarget);\n        }\n        if (navigationTargets) {\n            that._searchResultSetItem.setNavigationTargets(navigationTargets);\n            navigationTargetForEnhancement = [...navigationTargetForEnhancement, ...navigationTargets];\n        }\n        this.enhanceNavigationTargetsWithContentProviderId(navigationTargetForEnhancement);\n        return that._searchResultSetItem;\n    }\n\n    private enhanceNavigationTargetsWithContentProviderId(navigationTargets: Array<NavigationTarget>): void {\n        if (!(this.sina.provider instanceof ABAPODataProvider)) {\n            return;\n        }\n        if (!(this.sina.provider as ABAPODataProvider).contentProviderId) {\n            return;\n        }\n        for (const navigationTarget of navigationTargets) {\n            navigationTarget.targetUrl +=\n                \"&sap-app-origin-hint=\" + (this.sina.provider as ABAPODataProvider).contentProviderId;\n        }\n    }\n\n    enhanceResultSetItemWithGroups(): void {\n        const attributesMetadata = this._searchResultSetItem.dataSource.attributesMetadata;\n        for (let i = 0; i < attributesMetadata.length; i++) {\n            const attributeMetadata = attributesMetadata[i];\n            if (attributeMetadata.type === AttributeType.Group) {\n                const group = this._addAttributeGroup(attributeMetadata);\n                group.parent = this._searchResultSetItem;\n                if (attributeMetadata.usage.Detail) {\n                    this._searchResultSetItem.detailAttributes.push(group);\n                }\n                if (attributeMetadata.usage.Title) {\n                    this._searchResultSetItem.titleAttributes.push(group);\n                }\n                if (attributeMetadata.usage.TitleDescription) {\n                    this._searchResultSetItem.titleDescriptionAttributes.push(group);\n                }\n            }\n        }\n        this.sortAttributes();\n    }\n\n    sortAttributes(): void {\n        const createSortFunction = function (attributeName) {\n            return function (a1, a2) {\n                // be careful to handle displayOrder === 0 correctly!\n                const displayOrder1 =\n                    a1.metadata.usage && a1.metadata.usage[attributeName]\n                        ? a1.metadata.usage[attributeName].displayOrder\n                        : undefined;\n                const displayOrder2 =\n                    a2.metadata.usage && a2.metadata.usage[attributeName]\n                        ? a2.metadata.usage[attributeName].displayOrder\n                        : undefined;\n                if (displayOrder1 === undefined || displayOrder2 === undefined) {\n                    if (displayOrder2 !== undefined) {\n                        return 1;\n                    }\n                    return -1;\n                }\n                return displayOrder1 - displayOrder2;\n            };\n        };\n        this._searchResultSetItem.titleAttributes.sort(createSortFunction(\"Title\"));\n        this._searchResultSetItem.titleDescriptionAttributes.sort(createSortFunction(\"TitleDescription\"));\n        this._searchResultSetItem.detailAttributes.sort(createSortFunction(\"Detail\"));\n    }\n\n    _addAttributeGroup(attributeGroupMetadata): SearchResultSetItemAttributeGroup {\n        const group = this.sina._createSearchResultSetItemAttributeGroup({\n            id: attributeGroupMetadata.id,\n            metadata: attributeGroupMetadata,\n            label: attributeGroupMetadata.label,\n            template: attributeGroupMetadata.template,\n            attributes: [],\n            groups: [],\n            displayAttributes: attributeGroupMetadata.displayAttributes || [],\n        });\n\n        let parentAttributeMetadata, childAttributeMetadata;\n        if (attributeGroupMetadata._private) {\n            parentAttributeMetadata = attributeGroupMetadata._private.parentAttribute;\n            childAttributeMetadata = attributeGroupMetadata._private.childAttribute;\n        }\n\n        for (let k = 0; k < attributeGroupMetadata.attributes.length; k++) {\n            const attributeMembershipMetadata = attributeGroupMetadata.attributes[k];\n            const attributeMetadata = attributeMembershipMetadata.attribute;\n            let attributeOrGroup;\n            if (attributeMetadata.type === AttributeType.Group) {\n                // attributeOrGroup = this._addAttributeGroup(attributeMetadata, this._allAttributesMap);\n                attributeOrGroup = this._addAttributeGroup(attributeMetadata);\n            } else {\n                attributeOrGroup = this._allAttributesMap[attributeMetadata.id];\n            }\n            if (attributeOrGroup) {\n                const attributeGroupMembership = this.sina._createSearchResultSetItemAttributeGroupMembership(\n                    {\n                        group: group,\n                        attribute: attributeOrGroup,\n                        metadata: attributeMembershipMetadata,\n                    }\n                );\n                group.attributes.push(attributeGroupMembership);\n                attributeOrGroup.groups.push(attributeGroupMembership);\n            }\n            if (attributeMetadata == parentAttributeMetadata) {\n                group._private.parentAttribute = attributeOrGroup;\n            } else if (attributeMetadata == childAttributeMetadata) {\n                group._private.childAttribute = attributeOrGroup;\n            }\n        }\n\n        return group;\n    }\n}\n"],"mappings":"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","ignoreList":[]}