/*!
 * SAPUI5
 * Copyright (c) 2025 SAP SE or an SAP affiliate company. All rights reserved.
 * 
 */
sap.ui.define(["../../core/util","./typeConverter","../../core/Log","../tools/WhyfoundProcessor","./HierarchyNodePathParser"],function(t,e,a,r,i){"use strict";const s=a["Log"];const o=r["WhyfoundProcessor"];const n=i["HierarchyNodePathParser"];class u{provider;sina;suvNavTargetResolver;log=new s("hana_odata item parser");hierarchyNodePathParser;constructor(t){this.provider=t;this.sina=t.sina;this.suvNavTargetResolver=this.sina._createSuvNavTargetResolver({sina:this.sina});this.hierarchyNodePathParser=new n(this.sina)}async parse(t,e){if(!e.value){return Promise.resolve([])}if(e.error){this.log.warn("Server-side Warning: "+e.error.message)}const a=e.value;const r=[];for(let e=0;e<a.length;++e){const i=a[e];let s;try{s=this.parseItem(i,t);r.push(s)}catch(t){this.log.warn("Error occurred by parsing result item number "+e+": "+t.message)}}return Promise.all(r)}async parseItem(a,r){const i=[];const s=[];const n=[];const u=[];const c={};const l={};let g=a["@odata.context"]||"";const h=g.lastIndexOf("#");if(h>-1){g=g.slice(h+1)}const d=this.sina.getDataSource(g)??r.getDataSource();let v=undefined;if(a["@com.sap.vocabularies.Search.v1.ParentHierarchies"]){const t=a["@com.sap.vocabularies.Search.v1.ParentHierarchies"];v=this.hierarchyNodePathParser.parse(t,r)}const p=a["@com.sap.vocabularies.Search.v1.WhyFound"]||{};const f=a["@com.sap.vocabularies.Search.v1.hasChildren"]||false;const m=this.sina._createSearchResultSetItemAttribute({id:"HASHIERARCHYNODECHILD",label:"HASHIERARCHYNODECHILD",value:f.toString(),valueFormatted:f.toString(),valueHighlighted:f.toString(),isHighlighted:false,metadata:undefined,groups:[]});c[m.id]=m;i.push(m);let y;let b="";const A={};let T,S;const P=[];let N;const H=Number(a["@com.sap.vocabularies.Search.v1.Ranking"]);const I=new o(this.sina);const R=this.preParseItem(a);for(const a in R){if(r.groupBy&&r.groupBy.aggregateCountAlias&&r.groupBy.aggregateCountAlias===a){continue}const o=R[a];y=d.getAttributeMetadata(a);if(y.id=="LOC_4326"){y.usage.Detail.displayOrder=-1}const g=e.odata2Sina(y.type,o.value);const h=I.processRegularWhyFoundAttributes(a,o,p,y);const v=this.sina._createSearchResultSetItemAttribute({id:y.id,label:y.label,value:g,valueFormatted:undefined,valueHighlighted:h,isHighlighted:I.calIsHighlighted(h),metadata:y,groups:[]});if(y.iconUrlAttributeName&&R[y.iconUrlAttributeName]){const t=R[y.iconUrlAttributeName];if(t){if(typeof t==="object"&&"value"in t&&typeof t.value==="string"&&t.value){v.iconUrl=t.value}else if(typeof t==="string"){v.iconUrl=t}}}t.appendRemovingDuplicates(P,t.extractHighlightedTerms(v.valueHighlighted));if(y.usage.Title){s.push(v)}if(y.usage.TitleDescription){u.push(v)}if(y.usage.Detail){n.push(v)}i.push(v);if(y.usage.Navigation){if(y.usage.Navigation.mainNavigation){N=this.sina.createNavigationTarget({text:v.value,targetUrl:v.value,target:"_blank"})}}c[v.id]=v;b=d.attributeMetadataMap[y.id]._private.semanticObjectType||"";if(b.length>0){l[b]=g}}for(S in A){T=A[S];if(typeof T.suvTargetUrlAttribute==="string"){T.suvTargetUrlAttribute=c[T.suvTargetUrlAttribute]}if(typeof T.suvTargetMimeTypeAttribute==="string"){T.suvTargetMimeTypeAttribute=c[T.suvTargetMimeTypeAttribute]}if(!(T.suvTargetUrlAttribute||T.suvTargetMimeTypeAttribute)){delete A[S]}}s.sort(function(t,e){return t.metadata.usage.Title.displayOrder-e.metadata.usage.Title.displayOrder});n.sort(function(t,e){return t.metadata.usage.Detail.displayOrder-e.metadata.usage.Detail.displayOrder});this.suvNavTargetResolver.resolveSuvNavTargets(d,A,P);const _=this.sina._createSearchResultSetItem({dataSource:d,attributes:i,titleAttributes:s,titleDescriptionAttributes:u,detailAttributes:n,defaultNavigationTarget:N,navigationTargets:[],score:H});if(Array.isArray(v)&&v.length>0){_.hierarchyNodePaths=v}_._private.allAttributesMap=c;_._private.semanticObjectTypeAttributes=l;const D=this.sina._createItemPostParser({searchResultSetItem:_});const O=await D.postParseResultSetItem();return await I.processAdditionalWhyfoundAttributes(p,O)}preParseItem(t){const e={};for(const a in t){if(a[0]==="@"||a[0]==="_"){continue}const r=t[a];const i=a.split("@");const s=i[0];let o=e[s];if(!o){o={};e[s]=o}if(i.length===1){o.value=r;continue}if(i.length===2){o[i[1]]=r;continue}throw"more than two @ in property name"}return e}}var c={__esModule:true};c.ItemParser=u;return c});
//# sourceMappingURL=ItemParser.js.map