{"version":3,"file":"Provider-dbg.js","names":["sap","ui","define","___ajax","ajaxTemplates","conditionSerializer","core","dataSourceSerializer","labelCalculation","suggestionTermSplitter","___AbstractProvider","___FacetParser","___ItemParser","___suggestionParser","___MetadataParser","____core_errors","___nlqParser","____sina_SuggestionType","___tools_util","__ui5_require_async","path","Promise","resolve","reject","require","module","__esModule","endsWith","default","Object","defineProperty","value","err","createAjaxClient","AbstractProvider","FacetParser","ItemParser","SuggestionParser","MetadataParser","ESHNotActiveError","NotImplementedError","parseNlqInfo","SuggestionType","handleError","Provider","id","contentProviderId","requestPrefix","ajaxClient","metadataLoadPromises","internalMetadata","labelCalculator","metadataParser","itemParser","facetParser","suggestionParser","sessionId","sorsNavigationTargetGenerator","serviceXML","initAsync","configuration","url","sina","createLabelCalculator","generateGuid","_createSorsNavigationTargetGenerator","urlPrefix","getPropertyMetadata","metadata","name","label","semanticObjectType","_private","response","usage","Detail","Title","request","serverInfo","loadServerInfo","d","results","supports","loadBusinessObjectDataSources","capabilities","_createCapabilities","fuzzy","nlq","nlqEnabledInfoOnDataSource","service","capability","annotationsQueryString","length","nodes","querySelectorAll","i","Services","checkService","Id","j","Capabilities","checkCapability","requestUrlServerInfos","buildQueryUrl","requestUrlMetadata","serverInfosProm","getJson","metadataProm","getXML","all","then","values","isBrowserEnv","oParser","DOMParser","oDOM","parseFromString","documentElement","nodeName","jsdom","dom","JSDOM","window","document","data","requestUrlTemplate","isCDSAnnotationSupported","isInternalPath","isQueryPropertySupported","requestUrl","dataSourcesData","parseDataSourceData","finishRegistration","bind","elements","assembleOrderBy","query","result","sortOrder","sortKey","order","SortOrder","Descending","push","AttributeId","executeSearchQuery","requestTemplate","searchRequest","clientServiceNamePath","QueryOptions","ClientServiceName","JSON","parse","stringify","rootCondition","filter","clone","serialize","dataSource","SubFilters","Filter","DataSources","SearchTerms","searchTerm","Top","top","Skip","skip","OrderBy","addSessionId","calculateFacets","MaxFacetValues","Facets","Values","ActivateNLQ","ResultList","NLQQueries","NLQConnectorQueries","postJson","parseDynamicMetadata","items","facets","nlqResult","searchResultSet","_createSearchResultSet","ExecutionID","title","totalCount","TotalHits","generateNavigationTargets","executeChartQuery","decideValueHelp","valueHelperRequest","removeClientOptions","ValueHelpAttribute","dimension","ValueFilter","getFilterValueFromConditionTree","chartRequest","FacetRequests","DataSourceAttribute","_createChartResultSet","getAttributeMetadata","facetTotalCount","undefined","executeHierarchyQuery","conditions","_getAttribute","executeSuggestionQuery","executeRegularSuggestionQuery","executeObjectSuggestionQuery","suggestions","_createSuggestionResultSet","isObjectSuggestionQuery","types","indexOf","type","DataSourceType","BusinessObject","objectSuggestionRequest","parseObjectSuggestions","SearchTermAI","suggestionRequest","splittedTerm","split","SuggestionInput","suggestionTerm","includeSuggestionTypes","parseRegularSuggestions","concatenate","sina2OdataConversion","SearchTerm","Data","History","DataSource","suggestionTypes","calculationModes","success","suggestionType","calculationMode","ClientSessionID","timeStamp","Date","getTime","ClientCallTimestamp","ClientLastExecutionID","conditionTree","ConditionAttribute","ConditionValue","getConfigurationAsync","config","personalizedSearch","isPersonalizedSearchEditable","responseData","MainSwitch","IsEnabledForPersonalizedSearch","_createConfiguration","saveConfigurationAsync","mergeJson","resetPersonalizedSearchDataAsync","ClearPersonalizedSearchHistory","queryPrefix","queryPostfix","windowUrl","location","href","systemStringBegin","systemString","systemInRequestUrl","systemStringEnd","substring","systemStringEnd1","systemStringEnd2","getDebugInfo","SystemId","Client","transformPathToJsDomPath","escapeRegExp","string","replace","replaceAll","str","find","RegExp","replacementRules","replacementRule","oldTerm","newTerm","__exports"],"sources":["Provider.ts"],"sourcesContent":["/*!\n * SAPUI5\n * Copyright (c) 2025 SAP SE or an SAP affiliate company. All rights reserved.\n * \n */\nimport { createAjaxClient } from \"./ajax\";\nimport * as ajaxTemplates from \"./ajaxTemplates\";\nimport * as conditionSerializer from \"./conditionSerializer\";\nimport * as core from \"../../core/core\";\nimport * as dataSourceSerializer from \"./dataSourceSerializer\";\nimport * as labelCalculation from \"./labelCalculation\";\nimport * as suggestionTermSplitter from \"./suggestionTermSplitter\";\nimport { AjaxClient as Client } from \"../../core/AjaxClient\";\nimport { LabelCalculator } from \"../../core/LabelCalculator\";\nimport { AbstractProviderConfiguration, AbstractProvider } from \"../AbstractProvider\";\nimport { FacetParser } from \"./FacetParser\";\nimport { ItemParser } from \"./ItemParser\";\nimport { ABAPOdataSuggestionResponse, SuggestionParser } from \"./suggestionParser\";\nimport { MetadataParser } from \"./MetadataParser\";\nimport { NavigationTargetGenerator } from \"../tools/sors/NavigationTargetGenerator\";\nimport { Query } from \"../../sina/Query\";\nimport { SearchQuery } from \"../../sina/SearchQuery\";\nimport { SuggestionQuery } from \"../../sina/SuggestionQuery\";\nimport { SuggestionResultSet } from \"../../sina/SuggestionResultSet\";\nimport {\n    SerializedSimpleCondition,\n    SerializedComplexCondition,\n    SerializedBetweenCondition,\n} from \"./conditionSerializer\";\nimport { ESHNotActiveError, NotImplementedError } from \"../../core/errors\";\nimport { HierarchyQuery } from \"../../sina/HierarchyQuery\";\nimport { HierarchyResultSet } from \"../../sina/HierarchyResultSet\";\nimport { Capabilities } from \"../../sina/Capabilities\";\nimport { Configuration } from \"../../sina/Configuration\";\nimport { ChartQuery } from \"../../sina/ChartQuery\";\nimport { ChartResultSet } from \"../../sina/ChartResultSet\";\nimport { SearchResultSet } from \"../../sina/SearchResultSet\";\nimport { parseNlqInfo } from \"./nlqParser\";\nimport { SuggestionType } from \"../../sina/SuggestionType\";\nimport { handleError } from \"../tools/util\";\nimport { AttributeMetadata } from \"../../sina/AttributeMetadata\";\n\nexport type OdataEDMType =\n    | \"Edm.Time\"\n    | \"Edm.DateTime\"\n    | \"Edm.Byte\"\n    | \"Edm.Int16\"\n    | \"Edm.Int32\"\n    | \"Edm.Int64\"\n    | \"Edm.Decimal\"\n    | \"Edm.Single\"\n    | \"Edm.Double\"\n    | \"Edm.String\"\n    | \"Edm.Binary\";\n\nexport interface PersonalizedSearchMainSwitchesResponse {\n    d: { results: Array<{ MainSwitch: number }> };\n}\nexport interface ABAPOdataServerInfoResponse {\n    d: {\n        results: Array<ServerInfo>;\n    };\n}\nexport interface ServerInfo {\n    __metadata: {\n        id: string; // https://<server>:<port>/sap/opu/odata/sap/ESH_SEARCH_SRV/ServerInfos(SystemId='',Client='')\n        uri: string; // https://<server>:<port>/sap/opu/odata/sap/ESH_SEARCH_SRV/ServerInfos(SystemId='',Client='')\n        type: \"ESH_SEARCH_SRV.ServerInfo\";\n    };\n    SystemId: string;\n    Client: string;\n    SystemType: string; // \"CUSTOMER\";\n    DBType: string; // \"HDB\";\n    CurrentUserName: string; // \"TESTER_01\";\n    URL: string;\n    Port: string;\n    Services: {\n        results: [\n            {\n                __metadata: {\n                    id: string; // \"https://<server>:<port>/sap/opu/odata/sap/ESH_SEARCH_SRV/Services('Search')\";\n                    uri: string; // \"https://<server>:<port>/sap/opu/odata/sap/ESH_SEARCH_SRV/Services('Search')\";\n                    type: \"ESH_SEARCH_SRV.Service\";\n                };\n                Id: \"Search\";\n                Capabilities: {\n                    results: [{ Id: \"NLSSearch\" }];\n                };\n            },\n            {\n                __metadata: {\n                    id: string; // \"https://<server>:<port>/sap/opu/odata/sap/ESH_SEARCH_SRV/Services('Suggestions')\";\n                    uri: string; // \"https://<server>:<port>/sap/opu/odata/sap/ESH_SEARCH_SRV/Services('Suggestions')\";\n                    type: \"ESH_SEARCH_SRV.Service\";\n                };\n                Id: \"Suggestions\";\n                Capabilities: {\n                    results: [];\n                };\n            },\n            {\n                __metadata: {\n                    id: string; // \"https://<server>:<port>/sap/opu/odata/sap/ESH_SEARCH_SRV/Services('ObjectSuggestions')\";\n                    uri: string; // \"https://<server>:<port>/sap/opu/odata/sap/ESH_SEARCH_SRV/Services('ObjectSuggestions')\";\n                    type: \"ESH_SEARCH_SRV.Service\";\n                };\n                Id: \"ObjectSuggestions\";\n                Capabilities: {\n                    results: [];\n                };\n            },\n            {\n                __metadata: {\n                    id: string; // \"https://<server>:<port>/sap/opu/odata/sap/ESH_SEARCH_SRV/Services('Configuration')\";\n                    uri: string; // \"https://<server>:<port>/sap/opu/odata/sap/ESH_SEARCH_SRV/Services('Configuration')\";\n                    type: \"ESH_SEARCH_SRV.Service\";\n                };\n                Id: \"Configuration\";\n                Capabilities: {\n                    results: [];\n                };\n            },\n            {\n                __metadata: {\n                    id: string; // \"https://<server>:<port>/sap/opu/odata/sap/ESH_SEARCH_SRV/Services('Analysis')\";\n                    uri: string; // \"https://<server>:<port>/sap/opu/odata/sap/ESH_SEARCH_SRV/Services('Analysis')\";\n                    type: \"ESH_SEARCH_SRV.Service\";\n                };\n                Id: \"Analysis\";\n                Capabilities: {\n                    results: [];\n                };\n            },\n        ];\n    };\n}\n\nexport interface ABAPOdataSearchRequest {\n    d: {\n        DataSources: Array<{\n            Id: string;\n            Type: string;\n        }>;\n        Facets?: Array<Record<string, unknown>>;\n        Filter?:\n            | SerializedSimpleCondition\n            | SerializedComplexCondition\n            | SerializedBetweenCondition\n            | Record<string, unknown>;\n        Id: string;\n        MaxFacetValues?: number;\n        OrderBy?: Array<Record<string, unknown>>;\n        QueryOptions?: {\n            ClientCallTimestamp?: string;\n            ClientLastExecutionID?: string;\n            ClientServiceName?: string;\n            ClientSessionID?: string;\n            SearchTerms?: string;\n            SearchType?: string;\n            Skip?: number;\n            Top?: number;\n        };\n        ResultList?: {\n            SearchResults: Array<Record<string, unknown>>;\n        };\n    };\n}\n\nexport interface ABAPOdataSearchResponseDataSourceNlqInfo {\n    Description: string;\n    NLQConnectorQueries: { results: Array<{ ConnectorID: string }> };\n}\n\nexport class Provider extends AbstractProvider {\n    readonly id = \"abap_odata\";\n    declare serverInfo: ServerInfo;\n    contentProviderId: string;\n    requestPrefix: string;\n    ajaxClient: Client;\n    metadataLoadPromises: unknown;\n    internalMetadata: unknown;\n    labelCalculator: LabelCalculator;\n    metadataParser: MetadataParser;\n    itemParser: ItemParser;\n    facetParser: FacetParser;\n    suggestionParser: SuggestionParser;\n    sessionId: string;\n    sorsNavigationTargetGenerator: NavigationTargetGenerator;\n    serviceXML: XMLDocument;\n\n    async initAsync(configuration: AbstractProviderConfiguration): Promise<{\n        capabilities: Capabilities;\n    }> {\n        this.contentProviderId = configuration.contentProviderId;\n        this.requestPrefix = configuration.url || \"/sap/opu/odata/sap/ESH_SEARCH_SRV\";\n        this.sina = configuration.sina;\n        this.ajaxClient = configuration.ajaxClient ?? createAjaxClient();\n        this.metadataLoadPromises = {};\n        this.internalMetadata = {};\n        this.labelCalculator = labelCalculation.createLabelCalculator();\n        this.metadataParser = new MetadataParser(this);\n        this.itemParser = new ItemParser(this);\n        this.facetParser = new FacetParser(this);\n        this.suggestionParser = new SuggestionParser(this, this.itemParser);\n        this.sessionId = core.generateGuid();\n        this.sorsNavigationTargetGenerator = this.sina._createSorsNavigationTargetGenerator({\n            urlPrefix: \"#Action-search&/top=10&filter=\",\n            getPropertyMetadata(metadata) {\n                return {\n                    name: metadata.id,\n                    label: metadata.label,\n                    semanticObjectType: metadata._private.semanticObjectType,\n                    response: !!(metadata.usage && (metadata.usage.Detail || metadata.usage.Title)),\n                    request: true,\n                };\n            },\n        });\n\n        const serverInfo = await this.loadServerInfo();\n        this.serverInfo = serverInfo.d.results[0];\n        if (!this.supports(\"Search\")) {\n            throw new ESHNotActiveError();\n        }\n\n        await this.loadBusinessObjectDataSources();\n\n        return {\n            capabilities: this.sina._createCapabilities({\n                fuzzy: false,\n                nlq: this.supports(\"Search\", \"NLSSearch\"),\n                nlqEnabledInfoOnDataSource: this.supports(\"misc\", \"DataSourceIsNLSEnabled\"),\n            }),\n        };\n    }\n\n    supports(service: string, capability?: string): boolean {\n        // pseudo miscellaneous service\n        // having InteractionEventLists and NavigationEvents capability\n        if (service === \"misc\") {\n            let annotationsQueryString = \"\";\n            if (capability === \"InteractionEventLists\") {\n                annotationsQueryString =\n                    \"Schema[Namespace=ESH_SEARCH_SRV]>EntityContainer[Name=ESH_SEARCH_SRV_Entities]>EntitySet[Name=InteractionEventLists]\";\n            }\n            if (capability === \"NavigationEvents\") {\n                annotationsQueryString =\n                    \"Schema[Namespace=ESH_SEARCH_SRV]>EntityContainer[Name=ESH_SEARCH_SRV_Entities]>EntitySet[Name=NavigationEvents]\";\n            }\n            if (capability === \"DataSourceIsNLSEnabled\") {\n                annotationsQueryString =\n                    \"Schema[Namespace=ESH_SEARCH_SRV]>EntityType[Name=DataSource]>Property[Name=IsNLSEnabled]\";\n            }\n            if (annotationsQueryString.length !== 0) {\n                const nodes = this.querySelectorAll(annotationsQueryString);\n                return nodes.length > 0;\n            }\n        }\n\n        // server defined services\n        for (let i = 0; i < this.serverInfo.Services.results.length; ++i) {\n            const checkService = this.serverInfo.Services.results[i];\n            if (checkService.Id == service) {\n                if (!capability) {\n                    return true;\n                }\n                for (let j = 0; j < checkService.Capabilities.results.length; ++j) {\n                    const checkCapability = checkService.Capabilities.results[j];\n                    if (checkCapability.Id === capability) {\n                        return true;\n                    }\n                }\n            }\n        }\n        return false;\n    }\n\n    private loadServerInfo(): Promise<ABAPOdataServerInfoResponse> {\n        const requestUrlServerInfos = this.buildQueryUrl(\n            this.requestPrefix,\n            \"/ServerInfos?$expand=Services/Capabilities\"\n        );\n        const requestUrlMetadata = this.buildQueryUrl(this.requestPrefix, \"/$metadata\");\n\n        const serverInfosProm = this.ajaxClient.getJson(requestUrlServerInfos);\n        const metadataProm = this.ajaxClient.getXML(requestUrlMetadata);\n\n        return Promise.all([serverInfosProm, metadataProm]).then(async (values) => {\n            const response = values[0];\n            const serviceXML = values[1];\n            if (core.isBrowserEnv()) {\n                const oParser = new DOMParser();\n                const oDOM = oParser.parseFromString(serviceXML, \"text/xml\");\n                if (oDOM.documentElement.nodeName != \"parsererror\") {\n                    this.serviceXML = oDOM;\n                }\n            } else {\n                // Node.js sina tests\n                const jsdom = await import(\"jsdom\");\n                const dom = new jsdom.JSDOM(serviceXML);\n                this.serviceXML = dom.window.document;\n            }\n            return response.data;\n        }) as unknown as Promise<ABAPOdataServerInfoResponse>; // cast from generic response to provider specific response\n    }\n\n    loadBusinessObjectDataSources(): Promise<void> {\n        // complete requestUrlTemplate is \"/DataSources?$expand=Annotations,Attributes/UIAreas,Attributes/Annotations&$filter=Type eq 'View' and IsInternal eq false\";\n        let requestUrlTemplate =\n            \"/DataSources?$expand=Annotations,Attributes/UIAreas,Attributes/Annotations&$filter=Type eq 'View'\";\n        if (this.serviceXML) {\n            if (!this.isCDSAnnotationSupported()) {\n                // Do not query for annotations in data sources request\n                requestUrlTemplate = \"/DataSources?$expand=Attributes/UIAreas&$filter=Type eq 'View'\";\n            }\n\n            const isInternalPath =\n                \"Schema[Namespace=ESH_SEARCH_SRV]>EntityType[Name=DataSource]>Property[Name=IsInternal]\";\n            if (this.isQueryPropertySupported(isInternalPath)) {\n                // add isInternal filter in data sources request\n                requestUrlTemplate = requestUrlTemplate + \" and IsInternal eq false\";\n            }\n        }\n        const requestUrl = this.buildQueryUrl(this.requestPrefix, requestUrlTemplate);\n        return this.ajaxClient.getJson(requestUrl).then(\n            function (response) {\n                const dataSourcesData = response.data.d.results;\n                this.metadataParser.parseDataSourceData(dataSourcesData, this.sorsNavigationTargetGenerator);\n                this.sorsNavigationTargetGenerator.finishRegistration();\n            }.bind(this)\n        );\n    }\n\n    private isCDSAnnotationSupported(): boolean {\n        if (!this.serviceXML) {\n            return false;\n        }\n\n        const annotationsQueryString =\n            \"Schema[Namespace='ESH_SEARCH_SRV']>EntityType[Name='DataSource'][*|content-version='1']>NavigationProperty[Name='Annotations'],\" +\n            \"Schema[Namespace='ESH_SEARCH_SRV']>EntityType[Name='DataSourceAttribute'][*|content-version='1']>NavigationProperty[Name='Annotations']\";\n        const elements = this.querySelectorAll(annotationsQueryString);\n        if (elements.length < 2) {\n            // very old oData service\n            return false;\n        }\n\n        // new oData service\n        // may have more than 2 types of annotation in the futrue\n        return true;\n    }\n\n    assembleOrderBy(query: Query): Array<{\n        AttributeId: string;\n        SortOrder: \"desc\" | \"asc\";\n    }> {\n        const result = [];\n        for (let i = 0; i < query.sortOrder.length; ++i) {\n            const sortKey = query.sortOrder[i];\n            const sortOrder = sortKey.order === this.sina.SortOrder.Descending ? \"desc\" : \"asc\";\n            result.push({\n                AttributeId: sortKey.id,\n                SortOrder: sortOrder,\n            });\n        }\n        return result;\n    }\n\n    async executeSearchQuery(query: SearchQuery): Promise<SearchResultSet> {\n        let requestTemplate = ajaxTemplates.searchRequest as any;\n        const clientServiceNamePath =\n            \"Schema[Namespace=ESH_SEARCH_SRV]>EntityType[Name=SearchOptions]>Property[Name=ClientServiceName]\";\n        if (!this.isQueryPropertySupported(clientServiceNamePath)) {\n            // remove ClientServiceName from data sources request\n            delete requestTemplate.d.QueryOptions.ClientServiceName;\n        }\n\n        requestTemplate = JSON.parse(JSON.stringify(requestTemplate));\n\n        const rootCondition = query.filter.rootCondition.clone();\n        const filter = conditionSerializer.serialize(query.filter.dataSource, rootCondition);\n\n        if (filter.SubFilters.length !== 0) {\n            requestTemplate.d.Filter = filter;\n        } else {\n            delete requestTemplate.d.Filter;\n        }\n        requestTemplate.d.DataSources = dataSourceSerializer.serialize(query.filter.dataSource);\n        requestTemplate.d.QueryOptions.SearchTerms = query.filter.searchTerm;\n        requestTemplate.d.QueryOptions.Top = query.top;\n        requestTemplate.d.QueryOptions.Skip = query.skip;\n        requestTemplate.d.OrderBy = this.assembleOrderBy(query);\n\n        this.addSessionId(requestTemplate);\n        if (!query.calculateFacets) {\n            delete requestTemplate.d.MaxFacetValues;\n            delete requestTemplate.d.Facets;\n        } else {\n            requestTemplate.d.MaxFacetValues = 5;\n            requestTemplate.d.Facets = [\n                {\n                    Values: [],\n                },\n            ];\n        }\n\n        // nlq\n        if (query.nlq) {\n            requestTemplate.d.ActivateNLQ = true;\n            requestTemplate.d.ResultList.NLQQueries = [{ NLQConnectorQueries: [] }];\n        }\n\n        // build request url\n        const requestUrl = this.buildQueryUrl(this.requestPrefix, \"/SearchQueries\");\n\n        // fire request\n        return handleError(\n            async () => {\n                // fetch\n                return (await this.ajaxClient.postJson(requestUrl, requestTemplate)).data as any;\n            },\n            async (data) => {\n                // parse\n                this.metadataParser.parseDynamicMetadata(data.d);\n                const items = await this.itemParser.parse(query, data.d);\n                const facets = await this.facetParser.parse(query, data.d);\n                const nlqResult = parseNlqInfo(this.sina, data.d?.ResultList?.NLQQueries?.results);\n\n                // create search result set\n                const searchResultSet = this.sina._createSearchResultSet({\n                    id: data.d.ResultList.ExecutionID,\n                    title: \"Search Result List\",\n                    query: query,\n                    items: items,\n                    totalCount: data.d.ResultList.TotalHits,\n                    facets: facets,\n                    nlqResult: nlqResult,\n                });\n\n                // generate navigation targets based on foreig keys\n                this.sorsNavigationTargetGenerator.generateNavigationTargets(searchResultSet);\n\n                return searchResultSet;\n            }\n        );\n    }\n\n    executeChartQuery(query: ChartQuery): Promise<ChartResultSet> {\n        let requestUrl = \"\";\n        let requestTemplate;\n        const rootCondition = query.filter.rootCondition.clone();\n        let filter;\n\n        if (this.decideValueHelp(query)) {\n            // value help chart query\n            requestTemplate = JSON.parse(\n                JSON.stringify(ajaxTemplates.valueHelperRequest)\n            ) as typeof ajaxTemplates.valueHelperRequest;\n            this.removeClientOptions(requestTemplate);\n            requestTemplate.d.ValueHelpAttribute = query.dimension;\n            filter = conditionSerializer.serialize(query.filter.dataSource, rootCondition);\n            if (filter.SubFilters.length !== 0) {\n                requestTemplate.d.Filter = filter;\n            } else {\n                delete requestTemplate.d.Filter;\n            }\n            requestTemplate.d.ValueFilter = this.getFilterValueFromConditionTree(query.dimension, filter);\n            requestTemplate.d.QueryOptions.SearchTerms = query.filter.searchTerm;\n            requestTemplate.d.DataSources = dataSourceSerializer.serialize(query.filter.dataSource);\n            requestUrl = this.buildQueryUrl(this.requestPrefix, \"/ValueHelpQueries\");\n            // nlq not supported by backend\n            /*if (query.nlq) {\n                requestTemplate.d.ActivateNLQ = true;\n            }*/\n        } else {\n            // normal chart query\n            requestTemplate = JSON.parse(\n                JSON.stringify(ajaxTemplates.chartRequest)\n            ) as typeof ajaxTemplates.chartRequest;\n            filter = conditionSerializer.serialize(query.filter.dataSource, rootCondition);\n            if (filter.SubFilters.length !== 0) {\n                requestTemplate.d.Filter = filter;\n            } else {\n                delete requestTemplate.d.Filter;\n            }\n            requestTemplate.d.DataSources = dataSourceSerializer.serialize(query.filter.dataSource);\n            requestTemplate.d.QueryOptions.SearchTerms = query.filter.searchTerm;\n            requestTemplate.d.QueryOptions.Skip = 0;\n            this.addSessionId(requestTemplate);\n            requestTemplate.d.FacetRequests = [\n                {\n                    DataSourceAttribute: query.dimension,\n                },\n            ];\n            requestTemplate.d.MaxFacetValues = query.top;\n            requestUrl = this.buildQueryUrl(this.requestPrefix, \"/SearchQueries\");\n            // nlq\n            if (query.nlq) {\n                requestTemplate.d.ActivateNLQ = true;\n            }\n        }\n\n        return this.ajaxClient\n            .postJson(requestUrl, requestTemplate)\n            .then(\n                function (response) {\n                    // DataSourceAttribute is facet attribute\n                    return this.facetParser.parse(query, response.data.d);\n                }.bind(this)\n            )\n            .then(\n                function (facets) {\n                    if (facets.length > 0) {\n                        return facets[0];\n                    }\n                    return this.sina._createChartResultSet({\n                        title: (\n                            query.filter.dataSource.getAttributeMetadata(query.dimension) as AttributeMetadata\n                        ).label,\n                        items: [],\n                        query: query,\n                        facetTotalCount: undefined,\n                    });\n                }.bind(this)\n            );\n    }\n\n    // eslint-disable-next-line @typescript-eslint/no-unused-vars\n    executeHierarchyQuery(query: HierarchyQuery): Promise<HierarchyResultSet> {\n        throw new NotImplementedError();\n    }\n\n    decideValueHelp(query): boolean {\n        const conditions = query.filter.rootCondition.conditions;\n        for (let i = 0; i < conditions.length; i++) {\n            if (query.filter._getAttribute(conditions[i]) === query.dimension) {\n                return true;\n            }\n        }\n        return false;\n    }\n\n    async executeSuggestionQuery(query: SuggestionQuery): Promise<SuggestionResultSet> {\n        // handle regular suggestions and object suggestion separately because\n        // object suggestions have only searchterms and no suggestionInput\n        return Promise.all([\n            this.executeRegularSuggestionQuery(query),\n            this.executeObjectSuggestionQuery(query),\n        ]).then(\n            function (results) {\n                const suggestions = [];\n                suggestions.push(...results[1]);\n                suggestions.push(...results[0]);\n                return this.sina._createSuggestionResultSet({\n                    title: \"Suggestions\",\n                    query: query,\n                    items: suggestions,\n                });\n            }.bind(this)\n        );\n    }\n\n    isObjectSuggestionQuery(query): boolean {\n        return (\n            query.types.indexOf(\"Object\") >= 0 &&\n            query.filter.dataSource.type === query.sina.DataSourceType.BusinessObject\n        );\n    }\n\n    executeObjectSuggestionQuery(query) {\n        // check query type\n        if (!this.supports(\"ObjectSuggestions\") || !this.isObjectSuggestionQuery(query)) {\n            return Promise.resolve([]);\n        }\n\n        // build request\n        const requestTemplate = JSON.parse(JSON.stringify(ajaxTemplates.objectSuggestionRequest));\n        const rootCondition = query.filter.rootCondition.clone();\n        const filter = conditionSerializer.serialize(query.filter.dataSource, rootCondition);\n        if (filter.SubFilters.length !== 0) {\n            requestTemplate.d.Filter = filter;\n        } else {\n            delete requestTemplate.d.Filter;\n        }\n        requestTemplate.d.DataSources = dataSourceSerializer.serialize(query.filter.dataSource);\n        requestTemplate.d.QueryOptions.Top = query.top;\n        requestTemplate.d.QueryOptions.Skip = query.skip;\n        requestTemplate.d.QueryOptions.SearchTerms = query.filter.searchTerm;\n        this.addSessionId(requestTemplate);\n\n        // nlq\n        if (query.nlq) {\n            requestTemplate.d.ActivateNLQ = true;\n        }\n\n        // build request url\n        const requestUrl = this.buildQueryUrl(this.requestPrefix, \"/SuggestionsQueries\");\n\n        // fire request\n        return this.ajaxClient\n            .postJson(requestUrl, requestTemplate)\n            .then((response) => this.suggestionParser.parseObjectSuggestions(query, response.data));\n    }\n\n    private executeRegularSuggestionQuery(query) {\n        // AI suggestions not supported\n        if (query.types.indexOf(SuggestionType.SearchTermAI) >= 0) {\n            return [];\n        }\n\n        const requestTemplate = JSON.parse(JSON.stringify(ajaxTemplates.suggestionRequest));\n\n        // split search term in query into (1) searchTerm (2) suggestionTerm\n        const searchTerm = query.filter.searchTerm;\n        const splittedTerm = suggestionTermSplitter.split(searchTerm);\n\n        // add search term to condition\n        const rootCondition = query.filter.rootCondition.clone();\n\n        // assemble request\n        const filter = conditionSerializer.serialize(query.filter.dataSource, rootCondition);\n        if (filter.SubFilters.length !== 0) {\n            requestTemplate.d.Filter = filter;\n        } else {\n            delete requestTemplate.d.Filter;\n        }\n        requestTemplate.d.DataSources = dataSourceSerializer.serialize(query.filter.dataSource);\n        requestTemplate.d.QueryOptions.Top = query.top;\n        requestTemplate.d.QueryOptions.Skip = query.skip;\n        requestTemplate.d.SuggestionInput = splittedTerm.suggestionTerm;\n        requestTemplate.d.QueryOptions.SearchTerms =\n            splittedTerm.searchTerm === null ? \"\" : splittedTerm.searchTerm;\n        if (!this.includeSuggestionTypes(query, requestTemplate)) {\n            // no regular suggestions requested -> return\n            return [];\n        }\n        this.addSessionId(requestTemplate);\n\n        // nlq\n        if (query.nlq) {\n            requestTemplate.d.ActivateNLQ = true;\n        }\n\n        // build request url\n        const requestUrl = this.buildQueryUrl(this.requestPrefix, \"/SuggestionsQueries\");\n\n        // fire request\n        return this.ajaxClient\n            .postJson(requestUrl, requestTemplate)\n            .then((response) =>\n                this.suggestionParser.parseRegularSuggestions(\n                    query,\n                    response.data as unknown as ABAPOdataSuggestionResponse // cast from generic response to provider specific response\n                )\n            )\n            .then((suggestions) => {\n                suggestionTermSplitter.concatenate(splittedTerm, suggestions);\n                return suggestions;\n            });\n    }\n\n    includeSuggestionTypes(query: SuggestionQuery, suggestionRequest): boolean {\n        const sina2OdataConversion = {\n            SearchTerm: {\n                Data: \"IncludeAttributeSuggestions\",\n                History: \"IncludeHistorySuggestions\",\n            },\n            Object: {},\n            DataSource: {\n                Data: \"IncludeDataSourceSuggestions\",\n            },\n        };\n        const suggestionTypes = query.types;\n        const calculationModes = query.calculationModes;\n        let success = false;\n        for (let i = 0; i < suggestionTypes.length; i++) {\n            const suggestionType = suggestionTypes[i];\n            for (let j = 0; j < calculationModes.length; j++) {\n                const calculationMode = calculationModes[j];\n                const value = sina2OdataConversion[suggestionType][calculationMode];\n                if (typeof value === \"undefined\") {\n                    continue;\n                }\n                suggestionRequest.d[value] = true;\n                success = true;\n            }\n        }\n        return success;\n    }\n\n    private addSessionId(request: ABAPOdataSearchRequest): void {\n        request.d.QueryOptions.ClientSessionID = this.sessionId;\n        const timeStamp = new Date().getTime();\n        request.d.QueryOptions.ClientCallTimestamp = \"\\\\/Date(\" + timeStamp + \")\\\\/\";\n    }\n\n    removeClientOptions(\n        request: typeof ajaxTemplates.valueHelperRequest | typeof ajaxTemplates.chartRequest\n    ): void {\n        delete request.d.QueryOptions.ClientSessionID;\n        delete request.d.QueryOptions.ClientCallTimestamp;\n        delete request.d.QueryOptions.ClientServiceName;\n        delete request.d.QueryOptions.ClientLastExecutionID;\n    }\n\n    private getFilterValueFromConditionTree(dimension, conditionTree): string | null {\n        if (conditionTree.ConditionAttribute && conditionTree.ConditionAttribute === dimension) {\n            return conditionTree.ConditionValue;\n        } else if (conditionTree.SubFilters) {\n            let i;\n            let result = null;\n            for (i = 0; result === null && i < conditionTree.SubFilters.length; i++) {\n                result = this.getFilterValueFromConditionTree(dimension, conditionTree.SubFilters[i]);\n            }\n            return result;\n        }\n        return null;\n    }\n\n    getConfigurationAsync(): Promise<Configuration> {\n        let requestUrl = this.buildQueryUrl(\n            this.requestPrefix,\n            \"/PersonalizedSearchMainSwitches?$filter=Selected eq true\"\n        );\n        return this.ajaxClient.getJson(requestUrl).then((response) => {\n            const config = {\n                personalizedSearch: false,\n                isPersonalizedSearchEditable: false,\n            };\n            const responseData = response.data as unknown as PersonalizedSearchMainSwitchesResponse;\n            switch (responseData.d.results[0].MainSwitch) {\n                case 3:\n                    // Enabled after user‘s approval\n                    config.isPersonalizedSearchEditable = true;\n                    break;\n                case 4:\n                    // Enabled until user‘s rejection\n                    config.isPersonalizedSearchEditable = true;\n                    break;\n                case 2:\n                    // Enabled for all users\n                    config.isPersonalizedSearchEditable = false;\n                    break;\n                case 1:\n                    // Disabled for all users\n                    config.isPersonalizedSearchEditable = false;\n                    break;\n            }\n\n            requestUrl = this.buildQueryUrl(this.requestPrefix, \"/Users('<current>')\");\n            return this.ajaxClient.getJson(requestUrl).then(\n                function (response) {\n                    if (response.data.d.IsEnabledForPersonalizedSearch) {\n                        config.personalizedSearch = true;\n                    }\n                    return this.sina._createConfiguration(config);\n                }.bind(this)\n            );\n        });\n    }\n\n    public saveConfigurationAsync(configuration: Configuration): Promise<unknown> {\n        const data = {\n            IsEnabledForPersonalizedSearch: configuration.personalizedSearch,\n        };\n\n        const requestUrl = this.buildQueryUrl(this.requestPrefix, \"/Users('<current>')\");\n        return this.ajaxClient.mergeJson(requestUrl, data);\n    }\n\n    public resetPersonalizedSearchDataAsync(): Promise<unknown> {\n        const data = {\n            ClearPersonalizedSearchHistory: true,\n        };\n\n        const requestUrl = this.buildQueryUrl(this.requestPrefix, \"/Users('<current>')\");\n        return this.ajaxClient.mergeJson(requestUrl, data);\n    }\n\n    buildQueryUrl(queryPrefix: string, queryPostfix: string): string {\n        if (typeof window === \"undefined\") {\n            // sina mocha tests on node\n            return queryPrefix + queryPostfix;\n        }\n        const windowUrl = window.location.href;\n        let requestUrl = \"\";\n        let systemStringBegin;\n        let systemString = \"\";\n        let systemInRequestUrl = \"\";\n\n        // assign search backend system manuelly\n        // url: esh-system=sid(PH6.002) -> query: ;o=sid(PH6.002)\n        systemStringBegin = windowUrl.indexOf(\"esh-system=sid(\");\n        if (systemStringBegin !== -1) {\n            const systemStringEnd = windowUrl.substring(systemStringBegin).indexOf(\")\");\n            if (systemStringEnd !== -1) {\n                systemString = windowUrl.substring(\n                    systemStringBegin + 15,\n                    systemStringBegin + systemStringEnd\n                );\n                if (systemString.length !== 0) {\n                    systemInRequestUrl = \";o=sid(\" + systemString + \")\";\n                }\n            }\n        }\n\n        // assign search backend system manuelly\n        // url: esh-system=ALIASNAMEXYZCLNT002 -> query: ;o=sid(ALIASNAMEXYZCLNT002)\n        if (systemString.length === 0) {\n            systemStringBegin = windowUrl.indexOf(\"esh-system=\");\n            if (systemStringBegin !== -1) {\n                const systemStringEnd1 = windowUrl.substring(systemStringBegin).indexOf(\"&\");\n                const systemStringEnd2 = windowUrl.substring(systemStringBegin).indexOf(\"#\");\n\n                if (systemStringEnd1 !== -1 && systemStringEnd2 !== -1) {\n                    if (systemStringEnd1 < systemStringEnd2) {\n                        systemString = windowUrl.substring(\n                            systemStringBegin + 11,\n                            systemStringBegin + systemStringEnd1\n                        );\n                    } else {\n                        systemString = windowUrl.substring(\n                            systemStringBegin + 11,\n                            systemStringBegin + systemStringEnd2\n                        );\n                    }\n                }\n\n                if (systemStringEnd1 !== -1 && systemStringEnd2 === -1) {\n                    systemString = windowUrl.substring(\n                        systemStringBegin + 11,\n                        systemStringBegin + systemStringEnd1\n                    );\n                }\n\n                if (systemStringEnd1 === -1 && systemStringEnd2 !== -1) {\n                    systemString = windowUrl.substring(\n                        systemStringBegin + 11,\n                        systemStringBegin + systemStringEnd2\n                    );\n                }\n\n                if (systemStringEnd1 === -1 && systemStringEnd2 === -1) {\n                    systemString = windowUrl.substring(systemStringBegin + 11);\n                }\n            }\n            if (systemString.length !== 0) {\n                systemInRequestUrl = \";o=\" + systemString;\n            }\n        }\n\n        requestUrl = queryPrefix + systemInRequestUrl + queryPostfix;\n        return requestUrl;\n    }\n\n    getDebugInfo(): string {\n        return `Searchsystem: ${this.serverInfo.SystemId} Client: ${this.serverInfo.Client} ESH Search API Provider: ${this.id}`;\n    }\n\n    isQueryPropertySupported(path: string): boolean {\n        if (this.serviceXML === undefined) {\n            return false;\n        }\n\n        const elements = this.querySelectorAll(path);\n        if (elements.length > 0) {\n            return true;\n        }\n        return false;\n    }\n\n    transformPathToJsDomPath(query: string): string {\n        function escapeRegExp(string) {\n            return string.replace(/[.*+?^${}()|[\\]\\\\]/g, \"\\\\$&\");\n        }\n\n        function replaceAll(str, find, replace) {\n            return str.replace(new RegExp(escapeRegExp(find), \"g\"), replace);\n        }\n        const replacementRules = [\n            // tags to lowercase\n            [\"Schema\", \"schema\"],\n            [\"EntityType\", \"entitytype\"],\n            [\"EntityContainer\", \"entitycontainer\"],\n            [\"EntitySet\", \"EntitySet\"],\n            [\"NavigationProperty\", \"navigationproperty\"],\n            [\"Property\", \"property\"],\n            // child selector to descendant selector\n            [\">\", \" \"],\n            // prefix by by namespace\n            [\"content-version\", \"sap:\\\\content-version\"],\n        ];\n        for (const replacementRule of replacementRules) {\n            const [oldTerm, newTerm] = replacementRule;\n            query = replaceAll(query, oldTerm, newTerm);\n        }\n        return query;\n    }\n\n    querySelectorAll(path: string): NodeListOf<Element> {\n        if (this.serviceXML === undefined) {\n            return undefined;\n        }\n        if (!core.isBrowserEnv()) {\n            path = this.transformPathToJsDomPath(path);\n        }\n        return this.serviceXML.querySelectorAll(path);\n    }\n}\n"],"mappings":"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","ignoreList":[]}