/*!
 * SAPUI5
 * Copyright (c) 2025 SAP SE or an SAP affiliate company. All rights reserved.
 * 
 */
sap.ui.define(["../../sina/FacetType","../../sina/AttributeType","./Util"],function(e,t,a){"use strict";const n=e["FacetType"];const s=t["AttributeType"];const r=a["format10Power"];class u{sina;dataSourceIds=[];constructor(e,t,a){this.searchEngine=a;this.sina=e;this.dataSourceIds=t}createFacetsByDataSourceId(e,t){if(t.length===0){return undefined}if(e==="All"){return this.createDataSourceFacetSet(t)}else{const a=this.sina.getDataSource(e).attributesMetadata;const n=a.filter(e=>e.usage.Facet!==undefined);const s=n.sort((e,t)=>(e.usage.Facet.displayOrder||0)-(t.usage.Facet.displayOrder||0));return this.createAttributeFacetSet(t,s,5)}}createDataSourceFacetSet(e){const t={dataSourceId:"All",facets:[]};const a={id:"DataSource",label:"Data Sources",type:n.DataSource,position:0,items:[]};const s=this.sina.dataSources.filter(e=>e.type==="BusinessObject");const r=this.searchEngine.recordService;for(const t of s){a.items.push({description:t.label,count:r.getRecordsByDataSourceId(t.id,e).length,rawValueLow:t.id,rawValueHigh:"",stringValueLow:t.label,stringValueHigh:""})}t.facets.push(a);return t}createAttributeFacetSet(e,t,a){if(e.length===0){return undefined}const n=e[0].dataSourceId;const s={dataSourceId:n,facets:[]};for(const n of t?t:[]){const t=this.createAttributeFacet(e,n,a);if(t){s.facets.push(t)}}return s}createAttributeFacet(e,t,a){if(t.usage?.Facet===undefined&&t.usage?.AdvancedSearch===undefined){return undefined}if(e[0]?.valueMap[t.id]===undefined){return undefined}const r={id:t.id,label:t.label,type:n.Chart,position:t.usage?.Facet?.displayOrder||t.usage?.AdvancedSearch?.displayOrder||0,items:[],facetTotalCount:99999};let u=[];switch(t.type){case s.String:u=this.getPointItemsData(e,t.id,a);for(const e of u){r.items.push({description:e.lowStringValue,count:e.count,rawValueLow:e.lowRawValue,rawValueHigh:"",stringValueLow:e.lowStringValue,stringValueHigh:""})}break;case s.Double:case s.Integer:u=this.getNumberRangeItemsData(e,t.id,a);for(const e of u){r.items.push({description:e.lowStringValue+" ... "+e.highStringValue,count:e.count,rawValueLow:e.lowRawValue,rawValueHigh:e.highRawValue,stringValueLow:e.lowStringValue,stringValueHigh:e.highStringValue})}break;case s.Timestamp:case s.Date:case s.Time:u=this.getDateRangeItemsData(e,t.id,a);for(const e of u){r.items.push({description:e.lowStringValue,count:e.count,rawValueLow:e.lowRawValue,rawValueHigh:e.highRawValue,stringValueLow:e.lowStringValue,stringValueHigh:e.highStringValue})}break;default:}return r.items.length>0?r:undefined}getPointItemsData(e,t,a){const n=new Map;const s=[];for(const a of e){const e=a?.valueMap[t]?.stringValue;if(n.get(e)===undefined){n.set(e,1)}else{n.set(e,n.get(e)+1)}}for(const[e,t]of n){if(t>0){s.push({lowStringValue:e,lowRawValue:e,highStringValue:undefined,highRawValue:undefined,count:t})}}if(Number.isInteger(a)&&a>0){return s.sort((e,t)=>t.count-e.count).slice(0,a)}else{return s.sort((e,t)=>t.count-e.count)}}getNumberRangeItemsData(e,t,a){const n=[];const s=a||100;const u=this.searchEngine.recordService.sortRecords(e,t,"Ascending");const l=u[0].valueMap[t].rawValue;const i=u[u.length-1].valueMap[t].rawValue;const o=r(l,false);const c=r((i-l)/s,true);for(let a=0;a<s;a++){const s=o+a*c;const r=s+c;const u=e.filter(e=>{const a=e.valueMap[t].rawValue;return a>=s&&a<r});if(u.length>0){n.push({lowStringValue:s.toFixed(2).toString(),lowRawValue:s,highStringValue:r.toFixed(2).toString(),highRawValue:r,count:u.length})}}if(Number.isInteger(a)&&a>0){return n.slice(0,a)}else{return n}}getDateRangeItemsData(e,t,a){const n=[];const s=new Date;const r=new Date(s.getFullYear(),s.getMonth(),s.getDate(),23,59,59,999);const u=new Date(r.getTime()+1);const l=new Date(new Date(r.getTime()-6*24*60*60*1e3).setHours(0,0,0,0));const i=new Date(new Date(r.getTime()-29*24*60*60*1e3).setHours(0,0,0,0));const o=new Date(r.getFullYear(),0,1,0,0,0,0);const c=new Date(new Date(r.getFullYear()+1,0,1).getTime()-1);const g=new Date(r.getFullYear()-1,0,1,0,0,0,0);const d=new Date(new Date(r.getFullYear(),0,1).getTime()-1);const h=new Date(r.getFullYear()-3,0,1,0,0,0,0);const w=new Date(r.getFullYear()-5,0,1,0,0,0,0);const V=[{label:"Future",startValue:u,endValue:new Date(864e13)},{label:"Last 7 Days",startValue:l,endValue:r},{label:"Last 30 Days",startValue:i,endValue:r},{label:"This Year",startValue:o,endValue:c},{label:"Last Year",startValue:g,endValue:d},{label:"Last 3 Years",startValue:h,endValue:r},{label:"Last 5 Years",startValue:w,endValue:r},{label:"Older Than 5 Years",startValue:new Date(-864e13),endValue:new Date(w.getTime()-1)}];for(let a=0;a<V.length;a++){const s=V[a].startValue;const r=V[a].endValue;const u=e.filter(e=>{const a=e.valueMap[t].rawValue;if(s!=undefined){return a>=s&&a<=r}else{return a<=r}});if(u.length>0){n.push({lowStringValue:V[a].label,lowRawValue:s,highStringValue:undefined,highRawValue:r,count:u.length})}}if(Number.isInteger(a)&&a>0){return n.slice(0,a)}else{return n}}}var l={__esModule:true};l.FacetService=u;return l});
//# sourceMappingURL=FacetService.js.map