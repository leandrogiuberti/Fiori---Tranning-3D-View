/*!
 * SAPUI5
 * Copyright (c) 2025 SAP SE or an SAP affiliate company. All rights reserved.
 * 
 */
sap.ui.define(["../../core/errors","../../sina/DataSourceType","./MetadataParser"],function(t,e,a){"use strict";const n=t["ServerError"];const s=t["ServerErrorCode"];const r=e["DataSourceType"];const i=a["MetadataParser"];class o extends i{constructor(t){super(t)}async fireRequest(t,e){try{const a=await t.getJson(e);return a}catch(t){if(t instanceof n&&t.code===s.E101){this.provider.sina?.addError(t);return t.response.dataJSON}throw t}}async parseResponse(t){const e={businessObjectMap:new Map,businessObjectList:[],dataSourceMap:new Map,dataSourcesList:[]};const a=t.data&&t.data.metadata||t.data||t;const n=a["$EntityContainer"];if(typeof n!=="string"||n.length<1){throw"Meta data contains invalid EntityContainer!"}const s=n.split(".");const r=s[0];const i=s[1];const o=a[r];const E=o[i];const c=this._parseEntityType(r,o,i,E);this._parseEntityContainer(E,c,e);return e}_parseEntityType(t,e,a,n){const s={};for(let r in e){if(r===a){continue}const i=e[r];if(i["@EnterpriseSearch.enabled"]!==true){continue}r=r.substring(0,r.length-4);const o={schema:t,keys:[],attributeMap:{},label:n[r]["@SAP.Common.Label"]||"",labelPlural:n[r]["@SAP.Common.Label"]||"",annotations:{}};s[r]=o;let E=0;for(const t in i){const e=i[t];if(t==="$Key"){o.keys=e;continue}if(t.startsWith("@")){this._parseEntityTypeAnnotations(t,e,o);continue}this._parseAttribute(t,e,o,E);E++}}return s}_parseEntityTypeAnnotations(t,e,a){t=t.substring(1).toUpperCase();switch(t){case"UI.HEADERINFO.TYPENAME":a.label=e;break;case"UI.HEADERINFO.TYPENAMEPLURAL":a.label=e;break;case"UI.HEADERINFO.TITLE.TYPE":this._setAnnotationValue(a.annotations,t,e);break;case"UI.HEADERINFO.TITLE.VALUEQUALIFIER":this._setAnnotationValue(a.annotations,t,e);break;case"UI.HEADERINFO.TYPEIMAGEURL":a.icon=e;break;default:this._setAnnotationValue(a.annotations,t,e)}}_parseAttribute(t,e,a,n){if(typeof e!=="object"){return}const s={labelRaw:t,label:null,type:"",presentationUsage:[],isFacet:false,isSortable:false,supportsTextSearch:false,displayOrder:n,annotationsAttr:{},unknownAnnotation:[]};a.attributeMap[t]=s;for(const t in e){const a=e[t];if(t==="$Type"||t==="Type"){s["type"]=a;continue}if(t.startsWith("@")){this._parseAttributeAnnotations(t,a,s)}}}_parseAttributeAnnotations(t,e,a){t=t.substring(1).toUpperCase();if(e!==undefined){this._normalizeAnnotationValueOfArrayOrObject(e);switch(t){case"SAP.COMMON.LABEL":if(!a.label){a.label=e}break;case"ENTERPRISESEARCH.KEY":a.isKey=e;break;case"ENTERPRISESEARCH.PRESENTATIONMODE":a.presentationUsage=e;break;case"ENTERPRISESEARCHHANA.ISSORTABLE":a.isSortable=e;break;case"ENTERPRISESEARCHHANA.SUPPORTSTEXTSEARCH":a.supportsTextSearch=e;break;case"ENTERPRISESEARCH.FILTERINGFACET.DEFAULT":a.isFacet=e;break;case"ENTERPRISESEARCH.FILTERINGFACET.DISPLAYPOSITION":a.facetPosition=e;break;case"ENTERPRISESEARCH.FILTERINGFACET.ICONURL":a.facetIconUrlAttributeName=e;break;case"ENTERPRISESEARCH.FILTERINGATTRIBUTE.DEFAULT":a.isFilteringAttribute=e;break;case"ENTERPRISESEARCH.FILTERINGATTRIBUTE.DISPLAYPOSITION":a.facetPosition=e;break;case"ENTERPRISESEARCH.FILTERINGATTRIBUTE.ICONURL":a.facetIconUrlAttributeName=e;break;case"ENTERPRISESEARCH.DISPLAYORDER":a.displayOrder=e;break;default:if(t.startsWith("UI")||t.startsWith("OBJECTMODEL")||t.startsWith("SEMANTICS")){this._setAnnotationValue(a.annotationsAttr,t,e)}else{a.unknownAnnotation.push(t)}}}}_normalizeAnnotationValueOfArrayOrObject(t){if(Array.isArray(t)){for(let e=0;e<t.length;e++){this._normalizeAnnotationValueOfObject(t[e])}}else this._normalizeAnnotationValueOfObject(t);return t}_normalizeAnnotationValueOfObject(t){if(typeof t==="object"){for(const e in t){const a=e.toUpperCase();t[a]=t[e];delete t[e]}}return t}_getValueFromArrayWithSingleEntry(t){if(Array.isArray(t)&&t.length===1){return t[0]}return t}_parseEntityContainer(t,e,a){for(const n in t){const t=e[n];if(n==="$Kind"){continue}if(t===undefined){throw"EntityType "+n+" has no corresponding meta data!"}const s=this.sina.createDataSource({id:n,label:t.label||n,labelPlural:t.labelPlural||t.label||n,icon:t.icon||"",type:r.BusinessObject,attributesMetadata:[{id:"dummy"}]});s.annotations=t.annotations;a.dataSourceMap[s.id]=s;a.dataSourcesList.push(s);t.name=n;t.dataSource=s;a.businessObjectMap[n]=t;a.businessObjectList.push(t)}}}var E={__esModule:true};E.MetadataParserJson=o;return E});
//# sourceMappingURL=MetadataParserJson.js.map