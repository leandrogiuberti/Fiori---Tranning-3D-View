{"version":3,"file":"ajaxErrorFactory.js","names":["sap","ui","define","____core_errors","____sina_i18n","ServerErrorCode","ServerError","InternalSinaError","getText","ajaxErrorFactory","request","response","errorFactories","ajaxNlqErrorFactory","ajaxDefaultErrorFactory","errors","errorFactory","error","push","mergeErrors","length","details","message","code","E001","join","data","includes","responseData","dataJSON","d","ExecutionDetails","results","serverMessages","executionDetail","DataSourceId","Failed","ErrorMessage","E500","messages","value","trim","innererror","application","component_id","Error_Resolution","SAP_Note","__exports","__esModule"],"sources":["ajaxErrorFactory.ts"],"sourcesContent":["/*!\n * SAPUI5\n * Copyright (c) 2025 SAP SE or an SAP affiliate company. All rights reserved.\n * \n */\nimport { RequestProperties, ResponseProperties } from \"../../core/ajax\";\nimport { ServerErrorCode, SinaError, ServerError, InternalSinaError } from \"../../core/errors\";\nimport { getText } from \"../../sina/i18n\";\n\nexport function ajaxErrorFactory(request: RequestProperties, response: ResponseProperties): SinaError {\n    const errorFactories = [ajaxNlqErrorFactory, ajaxDefaultErrorFactory];\n    const errors: Array<SinaError> = [];\n    for (const errorFactory of errorFactories) {\n        const error = errorFactory(request, response);\n        if (error) {\n            errors.push(error);\n        }\n    }\n    return mergeErrors(errors);\n}\n\nfunction mergeErrors(errors: SinaError[]): SinaError {\n    if (errors.length === 0) {\n        return;\n    }\n    if (errors.length === 1) {\n        return errors[0];\n    }\n    const details = [];\n    for (const error of errors) {\n        if (!(error instanceof ServerError)) {\n            return new InternalSinaError({\n                message: \"program error: error factory returned an error that is not a ServerError\",\n            });\n        }\n        details.push(error.message + \"\\n\");\n        details.push(error.details + \"\\n\");\n    }\n    return new ServerError({\n        request: (errors[0] as ServerError).request,\n        response: (errors[0] as ServerError).response,\n        code: ServerErrorCode.E001,\n        message: getText(\"error.sina.generalServerError2\"),\n        details: details.join(\"\\n\"),\n    });\n}\n\n// AI error factory\nfunction ajaxNlqErrorFactory(request: RequestProperties, response: ResponseProperties): SinaError {\n    //\n\n    // factory is only active if nlq is activated\n    if (!request?.data?.includes('\"ActivateNLQ\":true')) {\n        return;\n    }\n\n    // check for repsonse data\n    if (!response.data) {\n        return;\n    }\n\n    // check for json\n    const responseData: any = response.dataJSON;\n    if (!responseData) {\n        return;\n    }\n\n    // check for execution details existence\n    if (!(responseData?.d?.ExecutionDetails?.results?.length > 0)) {\n        return;\n    }\n\n    // loop through execution details\n    const serverMessages = [];\n    for (const executionDetail of responseData.d.ExecutionDetails.results) {\n        if (\n            // very special check for AI not available error\n            executionDetail?.DataSourceId === \"0_GENERIC\" &&\n            executionDetail?.Failed === false &&\n            executionDetail?.ErrorMessage\n        ) {\n            serverMessages.push(executionDetail.ErrorMessage);\n        }\n    }\n\n    // generate error\n    if (serverMessages.length > 0) {\n        return new ServerError({\n            request: request,\n            response: response,\n            code: ServerErrorCode.E500,\n            message: getText(\"error.sina.nlqNotAvailableError\"),\n            details: serverMessages.join(\"\\n\"),\n        });\n    }\n}\n\n// default error factory\nfunction ajaxDefaultErrorFactory(request: RequestProperties, response: ResponseProperties): SinaError {\n    //\n    // check for repsonse data\n    if (!response.data) {\n        return;\n    }\n\n    // check for json\n    const responseData: any = response.dataJSON;\n    if (!responseData) {\n        return;\n    }\n\n    // check for error\n    if (typeof responseData !== \"object\") {\n        return;\n    }\n    if (!responseData?.error?.code) {\n        return;\n    }\n\n    // parse messages\n    const messages = [];\n    messages.push(getText(\"error.sina.generalServerError2\"));\n    messages.push(getText(\"error.sina.errorCode\", [responseData.error.code]));\n    if (responseData?.error?.message?.value) {\n        const value = responseData.error.message.value.trim();\n        messages.push(value);\n    }\n\n    // parse details\n    const details = [];\n    if (responseData?.error?.innererror) {\n        const innererror = responseData?.error?.innererror;\n        if (innererror?.application?.component_id) {\n            details.push(getText(\"error.sina.applicationComponent\", [innererror?.application?.component_id]));\n        }\n        if (innererror?.Error_Resolution?.SAP_Note) {\n            details.push(getText(\"error.sina.solutionNote\", [innererror?.Error_Resolution?.SAP_Note]));\n        }\n    }\n\n    // create error\n    return new ServerError({\n        request: request,\n        response: response,\n        code: ServerErrorCode.E001,\n        message: messages.join(\"\\n\"),\n        details: details.join(\"\\n\"),\n    });\n}\n"],"mappings":";;;;;AAAAA,IAAAC,GAAAC,OAAA,iDAAAC,EAAAC,GAAA,mBAMSC,EAAeF,EAAA,yBAAaG,EAAWH,EAAA,qBAAEI,EAAiBJ,EAAA,2BAC1DK,EAAOJ,EAAA,WAET,SAASK,EAAiBC,EAA4BC,GACzD,MAAMC,EAAiB,CAACC,EAAqBC,GAC7C,MAAMC,EAA2B,GACjC,IAAK,MAAMC,KAAgBJ,EAAgB,CACvC,MAAMK,EAAQD,EAAaN,EAASC,GACpC,GAAIM,EAAO,CACPF,EAAOG,KAAKD,EAChB,CACJ,CACA,OAAOE,EAAYJ,EACvB,CAEA,SAASI,EAAYJ,GACjB,GAAIA,EAAOK,SAAW,EAAG,CACrB,MACJ,CACA,GAAIL,EAAOK,SAAW,EAAG,CACrB,OAAOL,EAAO,EAClB,CACA,MAAMM,EAAU,GAChB,IAAK,MAAMJ,KAASF,EAAQ,CACxB,KAAME,aAAiBX,GAAc,CACjC,OAAO,IAAIC,EAAkB,CACzBe,QAAS,4EAEjB,CACAD,EAAQH,KAAKD,EAAMK,QAAU,MAC7BD,EAAQH,KAAKD,EAAMI,QAAU,KACjC,CACA,OAAO,IAAIf,EAAY,CACnBI,QAAUK,EAAO,GAAmBL,QACpCC,SAAWI,EAAO,GAAmBJ,SACrCY,KAAMlB,EAAgBmB,KACtBF,QAASd,EAAQ,kCACjBa,QAASA,EAAQI,KAAK,OAE9B,CAGA,SAASZ,EAAoBH,EAA4BC,GAIrD,IAAKD,GAASgB,MAAMC,SAAS,sBAAuB,CAChD,MACJ,CAGA,IAAKhB,EAASe,KAAM,CAChB,MACJ,CAGA,MAAME,EAAoBjB,EAASkB,SACnC,IAAKD,EAAc,CACf,MACJ,CAGA,KAAMA,GAAcE,GAAGC,kBAAkBC,SAASZ,OAAS,GAAI,CAC3D,MACJ,CAGA,MAAMa,EAAiB,GACvB,IAAK,MAAMC,KAAmBN,EAAaE,EAAEC,iBAAiBC,QAAS,CACnE,GAEIE,GAAiBC,eAAiB,aAClCD,GAAiBE,SAAW,OAC5BF,GAAiBG,aACnB,CACEJ,EAAef,KAAKgB,EAAgBG,aACxC,CACJ,CAGA,GAAIJ,EAAeb,OAAS,EAAG,CAC3B,OAAO,IAAId,EAAY,CACnBI,QAASA,EACTC,SAAUA,EACVY,KAAMlB,EAAgBiC,KACtBhB,QAASd,EAAQ,mCACjBa,QAASY,EAAeR,KAAK,OAErC,CACJ,CAGA,SAASX,EAAwBJ,EAA4BC,GAGzD,IAAKA,EAASe,KAAM,CAChB,MACJ,CAGA,MAAME,EAAoBjB,EAASkB,SACnC,IAAKD,EAAc,CACf,MACJ,CAGA,UAAWA,IAAiB,SAAU,CAClC,MACJ,CACA,IAAKA,GAAcX,OAAOM,KAAM,CAC5B,MACJ,CAGA,MAAMgB,EAAW,GACjBA,EAASrB,KAAKV,EAAQ,mCACtB+B,EAASrB,KAAKV,EAAQ,uBAAwB,CAACoB,EAAaX,MAAMM,QAClE,GAAIK,GAAcX,OAAOK,SAASkB,MAAO,CACrC,MAAMA,EAAQZ,EAAaX,MAAMK,QAAQkB,MAAMC,OAC/CF,EAASrB,KAAKsB,EAClB,CAGA,MAAMnB,EAAU,GAChB,GAAIO,GAAcX,OAAOyB,WAAY,CACjC,MAAMA,EAAad,GAAcX,OAAOyB,WACxC,GAAIA,GAAYC,aAAaC,aAAc,CACvCvB,EAAQH,KAAKV,EAAQ,kCAAmC,CAACkC,GAAYC,aAAaC,eACtF,CACA,GAAIF,GAAYG,kBAAkBC,SAAU,CACxCzB,EAAQH,KAAKV,EAAQ,0BAA2B,CAACkC,GAAYG,kBAAkBC,WACnF,CACJ,CAGA,OAAO,IAAIxC,EAAY,CACnBI,QAASA,EACTC,SAAUA,EACVY,KAAMlB,EAAgBmB,KACtBF,QAASiB,EAASd,KAAK,MACvBJ,QAASA,EAAQI,KAAK,OAE9B,CAAC,IAAAsB,EAAA,CAAAC,WAAA,MAAAD,EAAAtC,mBAAA,OAAAsC,CAAA","ignoreList":[]}