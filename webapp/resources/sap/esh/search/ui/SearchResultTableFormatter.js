/*!
 * SAPUI5
 * Copyright (c) 2025 SAP SE or an SAP affiliate company. All rights reserved.
 * 
 */
sap.ui.define(["./i18n","./SearchResultBaseFormatter","./SearchResultTableColumnType","./uiConstants","sap/base/util/merge","sap/esh/search/ui/controls/SearchLayoutResponsive","sap/base/Log"],function(e,t,i,n,l,o,a){"use strict";function s(e){return e&&e.__esModule&&typeof e.default!=="undefined"?e.default:e}const u=s(e);const r=s(t);const m=i["TableColumnType"];const d=n["initialValueUnicode"];class f extends r{defaultColumnWidth;logger=a.getLogger("sap.esh.search.ui.SearchResultTableFormatter");constructor(e){super(e);this.model=e;this.defaultColumnWidth="100%"}formatColumns(e){if(e?.length===0){return[]}const t=this.preformatColumns(e);if(this.model.config?.searchResultTablePersonalization!==false){const e=this.model.getTableColumns(true);if(Array.isArray(e)===false||e.length===0){return this.formatInitialColumns(t)}return this.unifyColumns(t,e)}else{return this.formatInitialColumns(t)}}preformatColumns(e){let t;const i=[];const n=new Set;const l=this?.model?.config;for(const l of e||[]){for(const e of l?.itemattributes||[]){const l=e?.key;if(!n.has(l)&&(this.isSingleAttributeInDetail(l)||this.isGroupAttributeInDetail(l))){n.add(l);t={p13NColumnName:this.createP13NColumnName(l),attributeId:l,name:e.name,type:m.DETAIL,visible:true};i.push(t)}}}for(const n of e||[]){if(n.navigationObjects!==undefined&&n.navigationObjects.length>0){t={p13NColumnName:this.createP13NColumnName(m.RELATED_APPS),name:u.getText("intents"),type:m.RELATED_APPS,visible:true};i.push(t);break}}if(l?.extendTableColumn?.column){t={p13NColumnName:this.createP13NColumnName(m.EXTEND),attributeId:l.extendTableColumn.column?.attributeId||"",name:l.extendTableColumn.column?.name||"",type:m.EXTEND,visible:true};i.push(t)}if(e[0].titleDescription!==undefined){t={p13NColumnName:this.createP13NColumnName(m.TITLE_DESCRIPTION),name:e[0].titleDescriptionLabel+" ("+u.getText("titleDescription")+")",type:m.TITLE_DESCRIPTION,visible:true};i.unshift(t)}if(e[0].title!==undefined){if(typeof l?.titleColumnName==="string"&&l?.titleColumnName.length>0){t={p13NColumnName:this.createP13NColumnName(m.TITLE),name:u.hasText(l?.titleColumnName)?u.getText(l?.titleColumnName):l?.titleColumnName,type:m.TITLE,visible:true}}else{t={p13NColumnName:this.createP13NColumnName(m.TITLE),name:this.model.getDataSource().label,type:m.TITLE,visible:true}}i.unshift(t)}i.forEach(function(e,t){e.index=t});return i}formatInitialColumns(e){const t=l([],e);const i=[];t.sort((e,t)=>{if(e.index<t.index){return-1}else if(e.index>t.index){return 1}else{return 0}});for(const e of t){const t=this.createColumnOfAdaptiveVisibleAndWidth(e,false,undefined);i.push(t)}if(this.model?.config?.extendTableColumn?.column){for(const e of i){e.visible=e.index<7||e.type===m.EXTEND}}else{for(const e of i){e.visible=e.index<6}}return i}unifyColumns(e,t){const i=l([],e);const n=new Map(i.map(e=>[e.p13NColumnName,e]));const o=l([],t);const a=new Map(o.map(e=>[e.p13NColumnName,e]));const s=[];for(const e of t){const t=n.get(e.p13NColumnName);if(t){s.push(this.createColumnOfAdaptiveVisibleAndWidth(t,e.visible,e.width))}}if(s.length===e.length){return s}for(const t of e){const e=a.get(t.p13NColumnName);if(!e){s.push(this.createColumnOfAdaptiveVisibleAndWidth(t,true,undefined))}}return s}createColumnOfAdaptiveVisibleAndWidth(e,t,i){const n=e;const l=this.getConfigWidth(e);n.visible=t||false;if(this.model?.config?.FF_resizeResultTableColumns===true){n.width=i||l||this.defaultColumnWidth}else{if(l===undefined){delete n.width}else{n.width=l}}return n}formatRows(e,t){if(e?.length===0){return[]}if(t?.length===0){return[]}const i=[];for(let n=0;n<e.length;n++){i[n]={cells:[]};const l=e[n].itemattributes;for(let e=0;e<t.length;e++){if(t[e].type!==m.DETAIL){continue}const o=t[e].attributeId;const a=this.getAttribute(l,o);if(a!==undefined){if(a.iconUrl&&a.defaultNavigationTarget){i[n].cells.push({p13NColumnName:this.createP13NColumnName(o),attributeId:o,value:this.formatCellText(a.value,d),isHighlighted:a.whyfound||false,tooltip:this.formatCellText(a.tooltip,""),icon:a.iconUrl,defaultNavigationTarget:a.defaultNavigationTarget,type:m.DETAIL})}else if(a.iconUrl){i[n].cells.push({p13NColumnName:this.createP13NColumnName(o),attributeId:o,value:this.formatCellText(a.value,d),isHighlighted:a.whyfound||false,icon:a.iconUrl,type:m.DETAIL})}else if(a.defaultNavigationTarget){i[n].cells.push({p13NColumnName:this.createP13NColumnName(o),attributeId:o,value:this.formatCellText(a.value,d),isHighlighted:a.whyfound||false,tooltip:this.formatCellText(a.tooltip,""),defaultNavigationTarget:a.defaultNavigationTarget,type:m.DETAIL})}else{i[n].cells.push({p13NColumnName:this.createP13NColumnName(o),attributeId:o,value:this.formatCellText(a.value,d),isHighlighted:a.whyfound||false,type:m.DETAIL})}}else{i[n].cells.push({p13NColumnName:this.createP13NColumnName(o),attributeId:o,value:this.formatCellText("",d),isHighlighted:false,type:m.DETAIL})}}if(e[n].navigationObjects!==undefined&&e[n].navigationObjects.length>0){i[n].cells.push({p13NColumnName:this.createP13NColumnName(m.RELATED_APPS),value:u.getText("intents"),isHighlighted:false,navigationObjects:e[n].navigationObjects||[],type:m.RELATED_APPS})}if(this.model?.config?.extendTableColumn&&typeof this.model?.config?.extendTableColumn["assembleCell"]==="function"){const t={id:e[n].attributesMap["id"]||e[n].attributesMap["ID"],favorites_user_id:e[n].attributesMap["favorites_user_id"]||e[n].attributesMap["FAVORITES_USER_ID"]};if(typeof t.id!=="undefined"&&typeof t.favorites_user_id!=="undefined"){try{const e=this.model?.config?.extendTableColumn["assembleCell"](t);e.p13NColumnName=this.createP13NColumnName(m.EXTEND);e.value=this.formatCellText(e.value,d);e.isHighlighted=false;e.type=m.EXTEND;i[n].cells.push(e)}catch(e){this.errorHandler.onError(e)}}}if(e[n].titleDescription!==undefined){i[n].cells.unshift({p13NColumnName:this.createP13NColumnName(m.TITLE_DESCRIPTION),value:this.formatCellText(e[n]?.titleDescription||"",d),isHighlighted:e[n]?.isTitleDescriptionHighlighted||false,type:m.TITLE_DESCRIPTION})}if(e[n].title!==undefined){i[n].cells.unshift({p13NColumnName:this.createP13NColumnName(m.TITLE),value:this.formatCellText(e[n]?.title||"",d),isHighlighted:e[n]?.isTitleHighlighted||false,titleNavigation:e[n]?.titleNavigation||undefined,titleIconUrl:e[n]?.titleIconUrl||"",titleInfoIconUrl:e[n]?.titleInfoIconUrl||"",titleInfoIconTooltip:e[n]?.titleInfoIconTooltip||"",type:m.TITLE})}}return i}isSingleAttributeInDetail(e){try{const t=this.model?.getDataSource()?.getAttributeMetadata(e)["usage"];if(t&&t.Detail&&t.Detail.displayOrder>=0){return true}else{return false}}catch(t){this.logger.warning("Attribute "+e+" is not found in metadata.",t);return false}}isGroupAttributeInDetail(e){try{const t=this.model?.getDataSource()?.getAttributeGroupMetadata(e)["usage"];if(t&&t.Detail&&t.Detail.displayOrder>=0){return true}else{return false}}catch(t){this.logger.warning("Attribute "+e+" is not found in group metadata.",t);return false}}createP13NColumnName(e){const t="TABLE-COLUMN-";return t+e}getAttribute(e,t){for(let i=0;i<e.length;i++){if(e[i].key===t){return e[i]}}return undefined}getConfigWidth(e){if(e?.type===m.TITLE&&this.getColumnWidthInPixel(this?.model?.config?.titleColumnWidth)){return this.getColumnWidthInPixel(this?.model?.config?.titleColumnWidth)+"px"}if(e?.type===m.EXTEND&&this.getColumnWidthInPixel(this?.model?.config?.extendTableColumn?.column?.width)){return this.getColumnWidthInPixel(this?.model?.config?.extendTableColumn?.column?.width)+"px"}return undefined}getColumnWidthInPixel(e){try{let t=undefined;if(/^\d+(px)/.test(e)){t=parseInt(e,10)}if(/^\d+(rem)/.test(e)){t=(new o)?.convertRemToPixel(parseInt(e,10));t=parseInt(t)}if(t===undefined){return undefined}if(t>0){return t}console.warn("Invalid Value: Column width should be defined as a positive integer in pixels (px) or rem units. Example: '10rem'.");return undefined}catch(e){this.logger.warning("Invalid Value: Column width should be defined as a positive integer in pixels (px) or rem units. Example: '10rem'.",e);return undefined}}formatCellText(e,t){if(typeof e==="string"&&e.trim().length>0){return e}return t}}return f});
//# sourceMappingURL=SearchResultTableFormatter.js.map