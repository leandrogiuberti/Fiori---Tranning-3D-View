/*!
 * SAPUI5
 * Copyright (c) 2025 SAP SE or an SAP affiliate company. All rights reserved.
 * 
 */
sap.ui.define(["sap/ui/core/IconPool","../i18n","sap/ui/Device","sap/m/OverflowToolbarLayoutData","sap/m/library","sap/m/OverflowToolbar","sap/m/OverflowToolbarButton","../controls/SearchSpreadsheet","../eventlogging/UserEvents","sap/m/ToolbarSpacer","sap/m/ToolbarSeparator","../error/errors","sap/m/Button","sap/m/ActionSheet","sap/m/IconTabBar","sap/m/IconTabFilter","sap/m/SegmentedButton","sap/m/SegmentedButtonItem","sap/ui/model/BindingMode","sap/m/ViewSettingsDialog","sap/ui/core/Element","sap/m/OverflowToolbarToggleButton"],function(t,e,o,s,r,i,a,n,l,c,p,u,h,d,g,m,S,b,f,C,y,T){"use strict";function w(t){return t&&t.__esModule&&typeof t.default!=="undefined"?t.default:t}const B=w(e);const I=r["ButtonType"];const D=r["OverflowToolbarPriority"];const v=r["PlacementType"];const R=r["URLHelper"];const E=w(n);const x=l["UserEventType"];const V=w(u);class O{compositeControl;constructor(t){this.compositeControl=t}assembleFilterButton(){const e=this.compositeControl.getModelInternal();const r=new T(this.compositeControl.getId()+"-searchBarFilterButton",{icon:t.getIconURI("filter"),tooltip:{parts:[{path:"/facetVisibility"}],formatter:t=>t?B.getText("hideFacetBtn_tooltip"):B.getText("showFacetBtn_tooltip")},pressed:{path:"/facetVisibility"},press:t=>{this.compositeControl.searchContainer.setProperty("animateFacetTransition",true);const o=t.getParameter("pressed");e.setFacetVisibility(o);e.eventLogger.logEvent(o?{type:x.FACETS_SHOW,dataSourceKey:e.getDataSource().id}:{type:x.FACETS_HIDE,dataSourceKey:e.getDataSource().id});this.compositeControl.searchContainer.setProperty("animateFacetTransition",false);setTimeout(()=>this.compositeControl.adjustSearchbarCustomGenericButtonWidth(),100)},visible:{path:"/businessObjSearchEnabled",formatter:t=>!o.system.phone&&!e.config.optimizeForValueHelp&&e.config.facets&&t}});r.addStyleClass("searchBarFilterButton");r.setLayoutData(new s({priority:D.NeverOverflow}));return r}assembleResultviewSelectionButton(){const e=this.compositeControl.getModelInternal();const r=new T(this.compositeControl.getId()+"-searchBarResultviewSelectionButton",{icon:t.getIconURI("multi-select"),tooltip:{parts:[{path:"/resultviewSelectionVisibility"}],formatter:t=>t?B.getText("hideSelectionBtn_tooltip"):B.getText("showSelectionBtn_tooltip")},pressed:{path:"/resultviewSelectionVisibility"},press:t=>{const o=t.getParameter("pressed");e.setResultviewSelectionVisibility(o);if(o===false){for(const t of this.compositeControl.getSearchResultSet().items){t.setSelected(false)}}},visible:{path:"/businessObjSearchEnabled",formatter:t=>!o.system.phone&&!e.config.optimizeForValueHelp&&e.config.showSelectionToggleButton&&e.config.facets&&t}});r.addStyleClass("searchBarResultviewSelectionButton");r.setLayoutData(new s({priority:D.NeverOverflow}));return r}assembleGenericButtonsToolbar(){const t=this.compositeControl.getModelInternal();const e=this.assembleExportButton();e.setLayoutData(new s({priority:D.High}));this.assembleResultViewSwitch();const o=new a((this.compositeControl.getId()?this.compositeControl.getId()+"-":"")+"tableSortButton",{icon:"sap-icon://sort",text:"{i18n>sortTable}",tooltip:"{i18n>sortTable}",visible:{parts:[{path:"/count"},{path:"/sortableAttributes"}],formatter:(t,e)=>{const o=this.compositeControl.getModelInternal();if(o&&o.isHomogenousResult()&&t>0&&e.length>0){return true}else{return false}}},type:{parts:[{path:"/orderBy"}],formatter:t=>{if(t&&t.sortOrder){return I.Emphasized}else{return I.Transparent}}},press:()=>{this.compositeControl.openSortDialog()}});o.addStyleClass("sapUshellSearchTableSortButton");o.setLayoutData(new s({priority:D.High}));this.compositeControl.sortDialog=this.assembleSearchResultSortDialog();let r=undefined;if(t?.config?.searchResultTablePersonalization!==false){r=new a((this.compositeControl.getId()?this.compositeControl.getId()+"-":"")+"tablePersonalizeButton",{icon:"sap-icon://action-settings",text:"{i18n>personalizeTable}",tooltip:"{i18n>personalizeTable}",type:I.Transparent,enabled:{parts:[{path:"/resultViewType"}],formatter:t=>t==="searchResultTable"},visible:{parts:[{path:"/count"},{path:"/tableColumns"}],formatter:(t,e)=>{const o=this.compositeControl.getModelInternal();if(o&&o.isHomogenousResult()&&t>0&&e.length>0){return true}else{return false}}},press:()=>{this.compositeControl.searchResultTable?.tablePersonalizer?.openDialog();const t=this.compositeControl.getModelInternal();const e={type:x.TABLE_CONFIG_OPEN,dataSourceKey:t.getDataSource().id};t.eventLogger.logEvent(e)}});r.addStyleClass("sapUshellSearchTablePersonalizeButton");r.setLayoutData(new s({priority:D.High}))}let n=[];n.push(e);n.push(o);if(t?.config?.searchResultTablePersonalization!==false&&r){n.push(r)}const l=t?.config?.isUshell;if(l){const t=this.assembleShareButton();t.setLayoutData(new s({priority:D.High}));n.push(t)}n.push(this.compositeControl.resultViewSwitch);let u=false;try{let e=[new c];const o=t?.config?.getCustomToolbar();if(o?.length>0){u=true;o.push(new p("",{visible:{parts:[{path:"/resultViewSwitchVisibility"},{path:"/count"}],formatter:(t,e)=>t&&e!==0}}))}if(t?.config?.searchInputLocation==="Searchbar"){e=e.concat(this.compositeControl.oSearchFieldGroup)}e=e.concat(o);n=e.concat(n)}catch(e){const o=new V.ConfigurationExitError("getCustomToolbar",t.config.applicationComponent,e);this.compositeControl.errorHandler.onError(o)}const h=new i(this.compositeControl.getId()+"-searchBar--genericButtonsToolbar",{content:n});h.addStyleClass("sapElisaSearchGenericButtonsToolbar");return{toolbar:h,hasCustomButtons:u}}assembleSearchResultSortDialog(){const t=this.compositeControl.getId()+"-sortDialog";const e=y.getElementById(t);if(e){e.destroy()}const o=new C(t,{sortDescending:{parts:[{path:"/orderBy"}],formatter:t=>Object.keys(t).length===0||t.sortOrder==="DESC"},confirm:t=>{const e=t.getParameter("sortItem");const s=t.getParameter("sortDescending");const r=this.compositeControl.getModelInternal();const i=e.getBindingContext().getObject().attributeId;if(typeof e==="undefined"||i==="DEFAULT_SORT_ATTRIBUTE"){o.setSortDescending(true);r.resetOrderBy(true)}else{r.setOrderBy({orderBy:i,sortOrder:s===true?"DESC":"ASC"},true)}},cancel:()=>{},resetFilters:()=>{setTimeout(()=>{o.setSortDescending(true);o.setSelectedSortItem("searchSortAttributeKeyDefault")},500)}});o.addStyleClass("sapUshellSearchResultSortDialog");o.addStyleClass("sapElisaSearchResultSortDialog");this.compositeControl.addDependent(o);return o}assembleExportButton(){return new a((this.compositeControl.getId()?this.compositeControl.getId()+"-":"")+"ushell-search-result-dataExportButton",{icon:"sap-icon://download",text:"{i18n>exportData}",tooltip:"{i18n>exportData}",type:I.Transparent,visible:{parts:[{path:"/count"},{path:"/tableColumns"}],formatter:(t,e)=>{const o=this.compositeControl.getModelInternal();if(o&&o.isHomogenousResult()&&t>0&&e.length>0){return true}else{return false}}},press:()=>{if(this.compositeControl.searchSpreadsheet===undefined){this.compositeControl.searchSpreadsheet=new E("ushell-search-spreadsheet")}const t=this.compositeControl.getModelInternal();this.compositeControl.searchSpreadsheet.onExport(t)}}).addStyleClass("sapUshellSearchTableDataExportButton")}assembleShareButton(){const e=new d((this.compositeControl.getId()?this.compositeControl.getId()+"-":"")+"shareActionSheet",{placement:v.Bottom,buttons:[]});e.addStyleClass("sapUshellSearchResultShareActionSheet");this.compositeControl.addDependent(e);const o=this.compositeControl.getModelInternal();sap.ui.require(["sap/ushell/ui/footerbar/AddBookmarkButton"],s=>{const r=new s((this.compositeControl.getId()?this.compositeControl.getId()+"-":"")+"bookmarkButton",{width:"auto",beforePressHandler:()=>{const e={url:document.URL,title:o.getDocumentTitle(),icon:t.getIconURI("search")};r.setAppData(e)}});e.addButton(r);const i=new h((this.compositeControl.getId()?this.compositeControl.getId()+"-":"")+"emailButton",{icon:"sap-icon://email",text:B.getText("eMailFld"),width:"auto",press:()=>{R.triggerEmail(null,o.getDocumentTitle(),document.URL)}});e.addButton(i)});const s=new a((this.compositeControl.getId()?this.compositeControl.getId()+"-":"")+"shareButton",{icon:"sap-icon://action",text:B.getText("shareBtn"),tooltip:B.getText("shareBtn"),type:I.Transparent,press:()=>{e.openBy(s)}});return s}assembleDataSourceTabBar(){const t=new g(`${this.compositeControl.getId()}-dataSourceTabBar`,{expandable:false,stretchContentHeight:false,visible:{parts:[{path:"/facetVisibility"},{path:"/count"},{path:"/businessObjSearchEnabled"}],formatter:(t,e,o)=>{const s=this.compositeControl.getModelInternal();if(s.config.exclusiveDataSource){return false}return!t&&e>0&&o}},selectedKey:{path:"/tabStrips/selected/id",mode:f.OneWay},select:t=>{const e=this.compositeControl.getModelInternal();if(e.config.searchScopeWithoutAll){return}if(e.getDataSource()!==t.getParameter("item").getBindingContext().getObject()){e.setDataSource(t.getParameter("item").getBindingContext().getObject())}}});t.data("sap-ui-fastnavgroup","false",true);t.addStyleClass("searchDataSourceTabStripBar");t.addStyleClass("sapUiSmallMarginBegin");t.setAriaTexts({headerLabel:B.getText("dataSources"),headerDescription:B.getText("dataSources")});t.bindAggregation("items",{path:"/tabStrips/strips",template:new m("",{key:"{id}",text:"{labelPlural}",visible:{path:"",formatter:t=>{const e=this.compositeControl.getModelInternal();if(e.config.searchScopeWithoutAll&&t===e.allDataSource){return false}}}})});return t}assembleResultViewSwitch(){if(this.compositeControl.resultViewSwitch!==undefined){return}this.compositeControl.resultViewSwitch=new S(this.compositeControl.getId()+"-ResultViewType",{selectedKey:"{/resultViewType}",visible:{parts:[{path:"/resultViewSwitchVisibility"},{path:"/count"}],formatter:(t,e)=>t&&e!==0},selectionChange:t=>{const e=t.getParameter("item").getKey();this.compositeControl.setResultViewType(e);this.compositeControl.assignDragDropConfig();const o=this.compositeControl.getModelInternal();const s={type:x.RESULT_VIEW_SWITCH,resultViewType:e};o.eventLogger.logEvent(s)}});this.compositeControl.resultViewSwitch.bindAggregation("items",{path:"/resultViewTypes",factory:(t,e)=>{const o=new b("",{visible:true});switch(e.getObject()){case"searchResultList":o.setIcon("sap-icon://list");o.setTooltip(B.getText("displayList"));o.setKey("searchResultList");break;case"searchResultTable":o.setIcon("sap-icon://table-view");o.setTooltip(B.getText("displayTable"));o.setKey("searchResultTable");break;case"searchResultGrid":o.setIcon("sap-icon://grid");o.setTooltip(B.getText("displayGrid"));o.setKey("searchResultGrid");break;default:o.setVisible(false)}return o}});this.compositeControl.resultViewSwitch.addStyleClass("sapUshellSearchResultViewSwitch");this.compositeControl.resultViewSwitch.setLayoutData(new s({priority:D.High}))}}return O});
//# sourceMappingURL=ToolbarAssembler.js.map