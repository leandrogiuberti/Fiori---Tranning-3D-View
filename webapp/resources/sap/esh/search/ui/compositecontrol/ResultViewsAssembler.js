/*!
 * SAPUI5
 * Copyright (c) 2025 SAP SE or an SAP affiliate company. All rights reserved.
 * 
 */
sap.ui.define(["../controls/resultview/SearchResultTable","sap/ui/core/InvisibleText","../controls/resultview/SearchResultList","../i18n","sap/m/library","../controls/resultview/SearchResultGrid","sap/f/GridContainerSettings","../error/errors","sap/ui/layout/VerticalLayout","sap/f/GridContainer","../eventlogging/UserEvents","sap/f/GridContainerItemLayoutData","sap/m/Text","sap/m/Button","sap/m/FlexBox","sap/m/CustomListItem","../controls/SearchTileHighlighter","../controls/resultview/CustomSearchResultListItem","../controls/resultview/SearchResultListItem","sap/m/GenericTile","sap/m/TileContent","sap/ui/core/Element","../SelectionMode","../UIEvents","sap/ui/core/EventBus"],function(t,e,s,o,n,r,i,l,a,c,p,u,h,m,d,g,C,f,y,S,I,b,R,w,L){"use strict";function v(t){return t&&t.__esModule&&typeof t.default!=="undefined"?t.default:t}const T=v(t);const A=v(s);const M=v(o);const E=n["ButtonType"];const U=n["FlexJustifyContent"];const D=n["ListMode"];const P=n["ListType"];const x=v(r);const O=v(l);const G=p["UserEventType"];const B=C["Highlighter"];const H=v(f);const V=v(y);const z=R["SelectionMode"];const F=v(w);class N{compositeControl;constructor(t){this.compositeControl=t}assembleResultView(t){this.compositeControl.searchResultList=this.assembleSearchResultList(t);this.compositeControl.searchResultTable=this.assembleSearchResultTable(t);this.compositeControl.searchResultGrid=this.assembleSearchResultGrid(t);this.compositeControl.appSearchResult=this.assembleAppSearch(t);this.compositeControl.showMoreFooter=this.assembleShowMoreFooter();const e=[this.compositeControl.searchResultList,this.compositeControl.searchResultTable,this.compositeControl.searchResultGrid,this.compositeControl.appSearchResult,this.compositeControl.showMoreFooter,this.compositeControl.countBreadcrumbsHiddenElement];return e}assembleCountBreadcrumbsHiddenElement(){const t=new e("",{text:{parts:[{path:"/count"}],formatter:t=>{if(typeof t!=="number"){return""}return M.getText("results_count_for_screenreaders",[t.toString()])}}});return t}assembleSearchResultTable(t){const e=this.compositeControl.getModelInternal();const s=new T(`${t}-ushell-search-result-table`,{});s.assembleTable(e);s.addEventDelegate({onAfterRendering:()=>{const t=this.compositeControl.getDomRef();if(!t){return}const e=t.querySelectorAll("table tbody tr");for(const t of Array.from(e)){const e=t.getAttribute("id");const s=b.getElementById(e);if(s){const t=s.getAriaLabelledBy();if(t.indexOf(this.compositeControl.countBreadcrumbsHiddenElement.getId())===-1){s.addAriaLabelledBy(this.compositeControl.countBreadcrumbsHiddenElement)}}break}}});return s}assembleSearchResultList(t){const e=new A(t+"-ushell-search-result-list",{mode:D.None,width:"auto",showNoData:false,visible:{parts:[{path:"/resultViewType"},{path:"/count"}],formatter:(t,e)=>t==="searchResultList"&&e!==0}});e.bindItems({path:"/results",factory:(t,e)=>this.assembleListItem(t,e)});return e}assembleSearchResultGrid(t){const e=this.compositeControl.getModelInternal();let s;if(typeof e.config.customGridView==="function"){try{s=e.config.customGridView()}catch(t){const s=new O.ConfigurationExitError("customGridView",e.config.applicationComponent,t);throw s}}else{const e=new i("",{rowSize:"11rem",columnSize:"11rem",gap:"0.5rem"});s=new x(t+"-ushell-search-result-grid",{layout:e,snapToRow:true})}s.bUseExtendedChangeDetection=false;s.bindProperty("visible",{parts:["/resultViewType","/count"],formatter:(t,e)=>t==="searchResultGrid"&&e!==0});s.addStyleClass("sapUshellSearchGrid");return s}assembleAppSearch(t){const e=new i("",{rowSize:"5.5rem",columnSize:"5.5rem",gap:"0.25rem"});const s=new c(t+"-ushell-search-result-app",{layout:e,snapToRow:true,visible:{parts:[{path:"/count"}],formatter:t=>{const e=this.compositeControl.getModelInternal();return(e.isAppCategory()||e.isUserCategoryAppSearchOnlyWithoutBOs())&&t!==0}},items:{path:"/appResults",factory:(t,e)=>{const s=this.compositeControl.getModelInternal();if(s.isAppCategory()||s.isUserCategoryAppSearchOnlyWithoutBOs()){const t=e.getObject();const o=t.visualization;const n=s.uShellVisualizationInstantiationService;const r=n.instantiateVisualization(o);r.attachPress(()=>{s.eventLogger.logEvent({type:G.TILE_NAVIGATE,tileTitle:o.title,targetUrl:o.targetURL})});r.addEventDelegate({onAfterRendering:this.highlightTile});r.setActive(false,true);r.setLayoutData(new u(r.getLayout()));return r}return new h("",{text:""})}}});s.addStyleClass("sapUshellSearchGridContainer");const o=new m({text:"{i18n>showMore}",type:E.Transparent,visible:{parts:[{path:"/appCount"},{path:"/appResults"}],formatter:(t,e)=>{const s=this.compositeControl.getModelInternal();return(s.isAppCategory()||s.isUserCategoryAppSearchOnlyWithoutBOs())&&e.length<t}},press:()=>{const t=this.compositeControl.getModelInternal();const e=t.getTop()+t.pageSize;t.setProperty("/focusIndex",t.getTop());t.setTop(e);t.eventLogger.logEvent({type:G.SHOW_MORE})}});o.addStyleClass("sapUshellResultListMoreFooter");const n=new a("",{width:"100%",visible:{parts:[{path:"/count"}],formatter:t=>{const e=this.compositeControl.getModelInternal();return(e.isAppCategory()||e.isUserCategoryAppSearchOnlyWithoutBOs())&&t!==0}},content:[s,o]});n.addStyleClass("sapUshellResultApps");return n}highlightTile(t){const e=t["srcControl"]?.getAggregation("content");if(e){let s=e.findAggregatedObjects(true,t=>t.isA("sap.m.GenericTile")||t.isA("sap.f.Card"));if(s.length===0&&e.getComponentInstance){s=e.getComponentInstance().findAggregatedObjects(true,t=>t.isA("sap.m.GenericTile")||t.isA("sap.f.Card"))}if(s.length>0){const e=s[0];const o=new B;o.setHighlightTerms(t["srcControl"]?.getModel().getProperty("/uiFilter/searchTerm"));o.highlight(e)}}}assembleShowMoreFooter(){const t=new m(this.compositeControl.getId()+"-resultview-moreFooter-button",{text:"{i18n>showMore}",type:E.Transparent,press:()=>{const t=this.compositeControl.getModelInternal();t.setProperty("/focusIndex",t.getTop());const e=t.getTop()+t.pageSize;t.setTop(e);t.eventLogger.logEvent({type:G.SHOW_MORE})}});t.addStyleClass("sapUshellResultListMoreFooter");const e=new d(this.compositeControl.getId()+"-resultview-moreFooter",{visible:{parts:[{path:"/boCount"},{path:"/boResults"}],formatter:(t,e)=>e.length<t},justifyContent:U.Center});e.addStyleClass("sapUshellResultListMoreFooterContainer");e.addItem(t);return e}assembleListItem(t,e){const s=e.getObject();if(s.type==="footer"){return new g(`${t}-footerItem`,{selected:{path:"selected"}})}else if(s.type==="appcontainer"){this.compositeControl.appResultListItem=this.assembleAppContainerResultListItem(t);return this.compositeControl.appResultListItem}return this.assembleResultListItem(t,s)}assembleResultListItem(t,e){const s=this.compositeControl.getModelInternal();const o=s.config.getDataSourceConfig(e.dataSource);const n={dataSource:e.dataSource,title:"{title}",isTitleHighlighted:{path:"isTitleHighlighted"},titleDescription:"{titleDescription}",isTitleDescriptionHighlighted:{path:"isTitleDescriptionHighlighted"},titleNavigation:{path:"titleNavigation"},type:"{dataSourceName}",imageUrl:"{imageUrl}",imageFormat:"{imageFormat}",imageNavigation:{path:"imageNavigation"},geoJson:"{geoJson}",attributes:{path:"itemattributes"},navigationObjects:{path:"navigationObjects"},selected:{path:"selected"},selectionEnabled:{path:"selectionEnabled"},customItemStyleClass:{path:"customItemStyleClass"},expanded:{path:"expanded"},positionInList:{path:"positionInList"},resultSetId:{path:"resultSetId"},layoutCache:{path:"layoutCache"},titleIconUrl:{path:"titleIconUrl"},titleInfoIconUrl:{path:"titleInfoIconUrl"},titleInfoIconTooltip:"{titleInfoIconTooltip}"};let r;if(o.searchResultListItemControl){r=new o.searchResultListItemControl(n)}else if(o.searchResultListItemContentControl){n["content"]=new o.searchResultListItemContentControl;r=new H(`${t}--customItemContent`,n)}else{r=new V(`${t}--itemContent`,n)}if(r.setCountBreadcrumbsHiddenElement){r.setCountBreadcrumbsHiddenElement(this.compositeControl.countBreadcrumbsHiddenElement)}const i=new g(`${t}--customListItem`,{content:r});i.addStyleClass("sapUshellSearchResultListItem");i.bindProperty("type",{parts:[{path:"/config/resultviewMasterDetailMode"},{path:"/config/resultviewSelectionMode"}],formatter:(t,e)=>{let o;const n=t=>{s.notifySubscribers(F.ESHShowResultDetail);L.getInstance().publish(F.ESHShowResultDetail,t)};if(t){o=P.Navigation;i.attachPress(n.bind(this))}else if(e===z.OneItem){o=P.Active;i.detachPress(n)}else{o=P.Inactive;i.detachPress(n)}return o}});if(r.setParentListItem){r.setParentListItem(i)}return i}assembleAppContainerResultListItem(t){const e=new i("",{rowSize:"5.5rem",columnSize:"5.5rem",gap:"0.25rem"});const s=`${t}-appItemContainer`;const o=new c(s,{layout:e,snapToRow:true,items:{path:"/appResults",factory:(t,e)=>{const s=this.compositeControl.getModelInternal();if(!s.isAppCategory()){const t=e.getObject();const o=t.visualization;const n=s.uShellVisualizationInstantiationService;const r=n.instantiateVisualization(o);r.attachPress(()=>{const t=this.compositeControl.getModelInternal();t.eventLogger.logEvent({type:G.TILE_NAVIGATE,tileTitle:o.title,targetUrl:o.targetURL})});r.addEventDelegate({onAfterRendering:this.highlightTile});r.setActive(false,true);r.setLayoutData(new u(r.getLayout()));return r}return new h(t,{text:""})}}});o.addStyleClass("sapUshellSearchGridContainer");o.addEventDelegate({onAfterRendering:()=>{const t=this.compositeControl.getModelInternal();const e=180;const n=4;const r=e+n;const i=6;const l=o.getItems();const a=t.getProperty("/appCount");const c=t.getProperty("/boCount");const p=l[l.length-1];if(o.getDomRef().clientWidth===0){return}let u=o.getDomRef().clientWidth-i-e;if(u<0){if(p.hasStyleClass("sapUshellSearchResultListItemAppsShowMore")){const e=t.getProperty("/appResults");t.setProperty("/appResults",e.slice(0,-1))}return}if(u<e){u=e}const m=Math.floor(u/r);if(p.hasStyleClass("sapUshellSearchResultListItemAppsShowMore")){return}if(l.length>m+1){let e=0,s=0;for(;s<l.length;s++){e=e+l[s].getDomRef().clientWidth+n;if(e>u){break}}const o=t.getProperty("/appResults");t.setProperty("/appResults",o.slice(0,s))}else if(l.length<m+1){if(a>m&&!p.hasStyleClass("sapUshellSearchResultListItemAppsShowMore")){const e=`${s}--showMore`;const n=new S(e,{tileContent:new I(`${e}--content`,{content:new h(`${e}--content--text`,{text:M.getText("showMoreApps")})}),press:()=>{const t=this.compositeControl.getModelInternal();t.setDataSource(t.appDataSource)}});n.addStyleClass("sapUshellSearchResultListItemAppsShowMore");o.addItem(n);t.setProperty("/resultViewType","appSearchResult");t.setProperty("/resultViewType","searchResultList");t.setProperty("/boCount",0);t.setProperty("/boCount",c)}}}},o);const n=new g(`${this.compositeControl.getId()}-appItem`,{content:o});n.addStyleClass("sapUshellSearchResultListItem");n.addStyleClass("sapUshellSearchResultListItemApps");n.addEventDelegate({onAfterRendering:function(){const t=n.getDomRef();if(t){t.removeAttribute("role");t.setAttribute("aria-hidden","true")}}},n);return n}}return N});
//# sourceMappingURL=ResultViewsAssembler.js.map