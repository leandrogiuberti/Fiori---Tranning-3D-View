/*!
 * SAPUI5
 * Copyright (c) 2025 SAP SE or an SAP affiliate company. All rights reserved.
 * 
 */
sap.ui.define(["./i18n","./controls/searchfieldgroup/SearchFieldGroup","sap/esh/search/ui/SearchHelper","sap/esh/search/ui/SearchModel","./controls/searchfieldgroup/SearchFieldStateManager","./SearchShellHelperHorizonTheme","./UIEvents","sap/ui/core/Element","sap/ui/core/EventBus","sap/ui/model/resource/ResourceModel","./controls/webcompsearchfieldgroup/WebCompSearchFieldGroupBindings","./controls/webcompsearchfieldgroup/UShellWebCompLoader"],function(e,t,a,i,s,r,o,l,c,h,n,d){"use strict";function u(e){return e&&e.__esModule&&typeof e.default!=="undefined"?e.default:e}const p=u(e);const S=u(t);const f=u(s);const F=u(r);const g=u(o);const M=n["createWebCompSearchFieldGroupBindings"];const C=d["loadUShellWebComps"];class b{static isInitialized;static sSearchOverlayCSS;static oModel;static oShellHeader;static oSearchFieldGroup;static focusInputFieldTimeout;static isFocusHandlerActive;static searchFieldStateManager;static periodicRetryFocus;constructor(){throw new Error("Cannot instantiate static class 'SearchShellHelper'")}static async init(e){this.oModel=i.getModelSingleton({},"flp");this.oShellHeader=l.getElementById("shell-header");if(this.oModel.config.isWebCompSearchFieldGroupEnabled()&&!e){return}if(this.isInitialized){return}this.isInitialized=true;window.sap.ushell.Container.getServiceAsync("Search").then(e=>{e.prefetch()});if(this.oModel.config.isWebCompSearchFieldGroupEnabled()){this.oSearchFieldGroup=await this.createWebCompSearchFieldGroup(e);if(!e){this.oShellHeader.setSearch(this.oSearchFieldGroup)}}else{this.oSearchFieldGroup=this.createSearchFieldGroup();this.searchFieldStateManager=new f({shellHeader:this.oShellHeader,model:this.oModel,searchFieldGroup:this.oSearchFieldGroup});this.oShellHeader.setSearch(this.oSearchFieldGroup)}c.getInstance().subscribe("shell","searchCompLoaded",this.onSearchComponentLoaded.bind(this),{});l.getElementById("viewPortContainer").attachAfterNavigate(this.onAfterNavigate.bind(this),{});c.getInstance().subscribe("sap.ushell","appComponentLoaded",()=>{if(this?.oModel?.focusHandler&&a.isSearchAppActive()){this.oModel.focusHandler.setFocus()}})}static onSearchComponentLoaded(){if(!a.isSearchAppActive()){return}this.expandSearch()}static resetModel(){this.oModel.resetQuery()}static onAfterNavigate(e){if(e.getParameter("toId")!=="shellPage-Action-search"&&e.getParameter("toId")!=="applicationShellPage-Action-search"&&e.getParameter("toId")!=="application-Action-search"){return}this.oModel.focusHandler.setFocus();this.oModel.notifySubscribers(g.ESHSearchLayoutChanged)}static expandSearch(e){this.searchFieldStateManager?.expandSearch(e)}static collapseSearch(){this.searchFieldStateManager?.collapseSearch()}static async createWebCompSearchFieldGroup(e){M(e,await C());e.setModel(this.oModel);e.setModel(new h({bundle:p}),"i18n");return e}static createSearchFieldGroup(){const e=new S("searchFieldInShell");e.setModel(this.oModel);e.setModel(new h({bundle:p}),"i18n");const t=e.input;t.setMaxSuggestionWidth("30rem");const a=e.select;a.setTooltip(p.getText("searchInTooltip"));a.addEventDelegate({onAfterRendering:()=>{jQuery('[id$="searchFieldInShell-select-icon"]').attr("title",p.getText("searchIn"))}},a);a.setTooltip(p.getText("searchIn"));a.attachChange(()=>{this.searchFieldStateManager.focusSearchInput({selectContent:true})});const i=e.button;i.attachPress(()=>{this.handleClickSearchButton()});const s=e.cancelButton;s.attachPress(()=>{this.collapseSearch()});e.setCancelButtonActive(false);jQuery(document).on("keydown",this.fnEscCallBack.bind(this));this.oShellHeader.attachSearchSizeChanged(this.sizeSearchFieldChanged.bind(this));return e}static fnEscCallBack(e){if(!this.oSearchFieldGroup){return}if(e.keyCode!==27){return}if(!this.searchFieldStateManager.isSearchInputFocused()){return}if(a.isSearchAppActive()){return}e.preventDefault();if(this.oSearchFieldGroup.input.getValue()===""){this.collapseSearch()}else if(this.oSearchFieldGroup.input.getValue()===" "){this.oSearchFieldGroup.input.setValue("")}}static sizeSearchFieldChanged(e){if(!this.oSearchFieldGroup){return}const t=e.getParameters()["remSize"];let a=24;if(t<=a){this.oSearchFieldGroup.select.setDisplayMode("icon")}else{this.oSearchFieldGroup.select.setDisplayMode("default")}a=9;if(t<a){this.oSearchFieldGroup.button.setVisible(false)}else{this.oSearchFieldGroup.button.setVisible(true)}if(e.getParameter("isFullWidth")){this.oSearchFieldGroup.setCancelButtonActive(true);this.oSearchFieldGroup.addStyleClass("sapUshellSearchInputFullWidth")}else{this.oSearchFieldGroup.setCancelButtonActive(false);this.oSearchFieldGroup.removeStyleClass("sapUshellSearchInputFullWidth")}}static onShellSearchButtonPressed(){b.init();if(this.oModel.config.isWebCompSearchFieldGroupEnabled()){return}this.expandSearch(true)}static handleClickSearchButton(){if(this.searchFieldStateManager.getSearchBoxValue()===""&&this.oModel.getDataSource()===this.oModel.getDefaultDataSource()){if(F.isSearchFieldExpandedByDefault()){this.searchFieldStateManager.focusSearchInput({selectContent:false})}else{this.collapseSearch()}}}}return b});
//# sourceMappingURL=SearchShellHelper.js.map