/*!
 * SAP APF Analysis Path Framework
 *
 * (c) Copyright 2012-2014 SAP AG. All rights reserved
 */
sap.ui.define(["sap/apf/core/constants","sap/apf/core/utils/filter","sap/apf/core/utils/filterTerm","sap/apf/utils/exportToGlobal","sap/base/util/deepExtend"],function(e,t,n,r,i){"use strict";function a(n,r,a,s){var o=this;this.type="binding";var d=0;var c=[];var l=[];var p=[];var u;this.oTitle=r.oTitle;this.oLongTitle=r.oLongTitle;var f=r.requiredFilters;var g=r.requiredFilterOptions;this.destroy=function(){c.forEach(function(e){if(e&&e.destroy){e.destroy()}});c=[];l=[];p=[];u=undefined};function h(e,t){if(n.exits&&n.exits.binding&&n.exits.binding.afterGetFilter){return n.exits.binding.afterGetFilter(e,o.getSelectedRepresentation(),n.instances.coreApi,r,t)}return e}this.getFilter=function(r){var i=this.getSelectedRepresentation();var a=e.filterMethodTypes;var s=[];var o;if(i.getFilterMethodType()===a.filter){var d=i.getFilter().getInternalFilter();return h(d,r)}if(i.getSelectionAsArray){s=i.getSelectionAsArray()}else{return h(new t(n.instances.messageHandler),r)}if(s===undefined){o=t.createEmptyFilter(n.instances.messageHandler,f);return h(o,r)}if(s.length===p.length||s.length===0){return h(new t(n.instances.messageHandler),r)}o=t.createFromArray(n.instances.messageHandler,f,p,s);return h(o,r)};this.getRequiredFilters=function(){return f};this.getRequiredFilterOptions=function(){return g};this.getRequestOptions=function(e){if(typeof this.getSelectedRepresentation().getRequestOptions==="function"){return this.getSelectedRepresentation().getRequestOptions(e)}return{}};this.setFilterValues=function(e){var t=this.getSelectedRepresentation();t.setFilterValues(e)};this.setData=function(e){n.instances.messageHandler.check(e!==undefined,"aDataResponse is undefined (binding function setData)");p=e.data;u=e.metadata;this.getSelectedRepresentation().setData(e.data,e.metadata,e.count,e.selectionValidation)};this.updateTreetable=function(e,t,n,r){this.getSelectedRepresentation().updateTreetable(e,t,n,r)};this.getSortedSelections=function(){return this.getSelectedRepresentation().getSortedSelections()};this.getRepresentationInfo=function(){var e=i([],l);for(var t=0;t<e.length;t++){delete e[t].id;delete e[t].type;delete e[t].constructor}return e};this.getSelectedRepresentationInfo=function(){n.instances.messageHandler.check(d>=0&&d<l.length,"index in array boundaries");var e=i({},l[d]);delete e.id;delete e.type;delete e.constructor;return e};this.getSelectedRepresentation=function(){n.instances.messageHandler.check(d>=0&&d<c.length,"selectedRepresentation in array boundaries");return c[d]};this.setSelectedRepresentation=function(e){n.instances.messageHandler.check(typeof e==="string","setSelectedRepresentation() - sRepresentationId missing");var t=this;var i=this.getSelectedRepresentation();var s=l(e,r.representations);var o=f(s);d=s.index;if(p!==undefined&&u!==undefined){o.setData(p,u)}if(o.adoptSelection){o.adoptSelection(i)}if(i&&i.onChartSwitch){i.onChartSwitch()}function l(e,t){for(var r=0;r<t.length;r++){if(e===t[r].id){return{config:t[r],constructor:a.getConfigurationById(t[r].representationTypeId).constructor,index:r}}}n.instances.messageHandler.check(false,"Representation config not found")}function f(e){var i;if(c[e.index]===undefined){if(e.config.parameter&&e.config.parameter.alternateRepresentationTypeId){e.config.parameter.alternateRepresentationType=a.getConfigurationById(e.config.parameter.alternateRepresentationTypeId)}e.config.parameter.requiredFilters=r.requiredFilters;e.config.parameter.requiredFilterOptions=r.requiredFilterOptions;i=t.convertSortToOrderBy(e.config.parameter);c[e.index]=n.instances.coreApi.createRepresentation(e.constructor,i);return c[e.index]}return c[e.index]}};this.serialize=function(){return{selectedRepresentation:o.getSelectedRepresentation().serialize(),selectedRepresentationId:o.getSelectedRepresentationInfo().representationId}};this.deserialize=function(e){o.setSelectedRepresentation(e.selectedRepresentationId);o.getSelectedRepresentation().deserialize(e.selectedRepresentation);return o};this.convertSortToOrderBy=function(e){var t;if(e.sort&&!e.orderby){t=i({},e);if(e.alternateRepresentationType){t.alternateRepresentationType=e.alternateRepresentationType}t.orderby=[{property:e.sort.sortField,ascending:!e.sort.descending}];delete t.sort;return t}t=e;return t};c[0]=undefined;var R=false;r.representations.forEach(function(e,t){var n=e.representationTypeId;l[t]=i({},a.getConfigurationById(n));l[t].representationId=e.id;if(s===l[t].representationId){R=true}l[t].representationLabel=e.label;l[t].thumbnail=e.thumbnail;l[t].parameter=i({},e.parameter)});if(R){this.setSelectedRepresentation(s)}else if(l.length>0){this.setSelectedRepresentation(l[0].representationId)}if(!R&&s){n.instances.messageHandler.putMessage(n.instances.messageHandler.createMessageObject({code:"5037",aParameters:[s]}))}}r("sap.apf.core.Binding",a);return a});
//# sourceMappingURL=binding.js.map