/*!
 * SAP APF Analysis Path Framework
 * 
 * (c) Copyright 2012-2018 SAP AG. All rights reserved
 */
sap.ui.define(["sap/apf/core/constants","sap/apf/utils/utils","sap/apf/core/messageObject","sap/apf/utils/hashtable","sap/apf/utils/exportToGlobal","sap/base/Log","sap/base/util/deepExtend","sap/ui/Device","sap/ui/thirdparty/jquery","sap/apf/core/messageDefinition"],function(e,r,s,t,i,n,a,o,jQuery){"use strict";function f(i){var f={initial:0,startup:1,running:2,shutdown:3};var g=this;var u;var d=[];var c=0;var v;var l;var h;var p=false;var m=false;var y=false;var w=false;var M=false;var E="";var b={code:e.message.code.errorUnknown,severity:e.message.severity.error,rawText:"Unknown Error occurred"};var C=f.initial;var x=[];this.setLifeTimePhaseStartup=function(e){C=f.startup};this.setLifeTimePhaseRunning=function(){C=f.running};this.setLifeTimePhaseShutdown=function(){C=f.shutdown};this.fatalErrorOccurredAtStartup=function(){var r;if(C!==f.startup){return false}for(r=0;r<x.length;r++){if(x[r].getSeverity()===e.message.severity.fatal){return true}}return false};this.createMessageObject=function(r){var t=new s(r);if(i){if(t.getCode()===undefined){t.setCode(e.message.code.errorUnknown)}O.bind(this)(t);j(t,1)}else if(r.enrichInfoInMessageObject===true){O.bind(this)(t)}return t};this.activateOnErrorHandling=function(e){p=e;if(p===true){jQuery(window).on("error",L)}else{jQuery(window).off("error")}};this.setTextResourceHandler=function(e){u=e};this.loadConfig=function(e,r){if(v===undefined||r){v=new t(g)}for(var s=0;s<e.length;s++){F(e[s])}};this.setMessageCallback=function(e){if(e!==undefined&&typeof e==="function"){l=e}else{l=undefined}};this.setCallbackForTriggeringFatal=function(e){if(e!==undefined&&typeof e==="function"){h=e}else{h=undefined}};this.putMessage=function(r){var s;var t=0;var n;if(r.getCode()===undefined){r.setCode(e.message.code.errorUnknown)}O.bind(this)(r);if(r.getSeverity()===e.message.severity.fatal){n=g.createMessageObject({code:e.message.code.errorExitTriggered});O.bind(this)(n);n.setSeverity(e.message.severity.fatal);if(n.getMessage()===""){n.setMessage("The app has stopped working due to a technical error.")}}s=r.getPrevious();while(s!==undefined&&s.type&&s.type==="messageObject"&&t<10){if(s.getCode()===undefined){s.setCode(e.message.code.errorUnknown)}O.bind(this)(s);s=s.getPrevious();t++}if(n!==undefined){n.setPrevious(r);r=n}if(!i){j(r,10)}x.push(r);if(m){return}if(r.getSeverity()===e.message.severity.technError){return}if(l!==undefined){if(C===f.shutdown||C===f.startup&&r.getSeverity()!==e.message.severity.fatal){return}m=true;l(r);m=false}if(h!==undefined&&y===false){y=true;h(r);y=false}if(r.getSeverity()===e.message.severity.fatal&&C!==f.shutdown){if(o.browser.firefox){M=true}throw new Error(E)}};this.check=function(r,s,t){var i=t||e.message.code.errorCheck;if(!r){var n=this.createMessageObject({code:i,aParameters:[s]});g.putMessage(n)}};this.getConfigurationByCode=function(e){if(v===undefined){return undefined}return v.getItem(e)};this.getLogMessages=function(){return a([],d)};this.reset=function(){v=undefined;l=undefined;d=[];x=[]};this.isOwnException=function(e){return e&&e.message&&e.message.search(E)>-1};function k(e){if(o.browser.firefox){return M}return e.originalEvent&&e.originalEvent.message&&e.originalEvent.message.search(E)>-1}function T(r){return r.originalEvent&&r.originalEvent.message&&r.originalEvent.message.search(E)===-1&&r.originalEvent.message.search(e.message.code.suppressFurtherException)>-1}function P(){var s=r.createPseudoGuid(32);return e.message.code.suppressFurtherException+s}function S(r){var s=parseInt(r,10);return s==e.message.code.errorExitTriggered||s==e.message.code.errorUnknown||s==e.message.code.errorInMessageDefinition}function I(r){var s=parseInt(r,10);return s==e.message.code.errorExitTriggered||s==e.message.code.errorInMessageDefinition}function O(r){function s(e,r){var s=0;while(e.indexOf("{"+s+"}")>-1){if(typeof r[s]==="string"){e=e.replace("{"+s+"}",r[s])}else{e=e.replace("{"+s+"}","undefined")}s++}return e}var t=r.getCode();var i=g.getConfigurationByCode(t);if(i===undefined){i=a({},b);if(S(t)){if(r.hasRawText()){i.rawText=r.getRawText()}i.rawText+=" "+r.getParameters();if(I(t)){i.severity=e.message.severity.fatal}}else{i.rawText="Message "+t+"  "+r.getParameters()+" (Message Code has no Configuration)"}if(!S(t)){r.setCode(i.code)}}if(i.severity!==undefined){r.setSeverity(i.severity)}else{r.setSeverity(e.message.severity.technError)}if(i.rawText){r.setMessage(i.rawText)}else{var n=r.getParameters();if(r.getSeverity()===e.message.severity.technError){var o=g.getConfigurationByCode(i.code).text;if(!o){o=g.getConfigurationByCode(i.code).description}r.setMessage(s(o,n))}else{try{if(u&&i.key){r.setMessage(u.getMessageText(i.key,r.getParameters()))}else if(i.description){r.setMessage(s(i.description,n))}else{r.setMessage("Message Code: "+t+" "+n.toString())}}catch(e){if(i.description){r.setMessage(s(i.description,n))}else{r.setMessage("Message Code: "+t+" "+n.toString())}}}}}function j(r,s){var t="APF message ";var i="";var a=s-1;if(s===0){return}var o=r.getPrevious();if(o!==undefined){j(o,a);i=" - (see previous message for more information)"}c++;var f=t+"("+c+"): "+r.getCode()+" - "+r.getMessage()+i;if(w){alert("Fatal Error during Log Writing "+f);return}w=true;if(r.getSeverity()===e.message.severity.fatal){if(d.length<2){d.unshift(f)}}switch(r.getSeverity()){case e.message.severity.warning:n.warning(f);break;case e.message.severity.error:n.error(f);break;case e.message.severity.fatal:n.error(f);break;case e.message.severity.technError:n.error(f);break;default:n.info(f)}w=false}function D(r){g.check(r!==undefined&&r.hasOwnProperty("code")!==false,"MessageHandler setItem: oItem is undefined or property 'code' is missing",e.message.code.errorInMessageDefinition);var s=v.setItem(r.code,r);g.check(s===undefined,"MessageHandler setItem: Configuration includes duplicated codes",e.message.code.errorInMessageDefinition)}function F(e){if(e.type===undefined){e.type="message"}D(e)}function L(e){var r;var t="";var i="";var n="";var a="";var f=true;if(o.browser.firefox){f=false}if(f&&e&&e.originalEvent){t=e.originalEvent.message;n=e.originalEvent.filename;i=e.originalEvent.lineno}if(k(e)){e.stopImmediatePropagation();e.preventDefault()}else if(T(e)){return}else if(m){a="";if(f){a=t+" (source: "+n+":"+i+")"}r=new s({code:"5070",aParameters:[a]});O.bind(this)(r);j(r,1)}else{a="";if(f){a=t+" (source: "+n+":"+i+")"}r=new s({code:"5070",aParameters:[a]});O.bind(this)(r);j(r,1)}}function U(){E=P()}U()}i("sap.apf.core.MessageHandler",f);return f});
//# sourceMappingURL=messageHandler.js.map