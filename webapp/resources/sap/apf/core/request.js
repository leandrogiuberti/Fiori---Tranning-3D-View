/*!
 * SAP APF Analysis Path Framework
 * 
 * (c) Copyright 2012-2014 SAP AG. All rights reserved
 */
sap.ui.define(["sap/apf/utils/exportToGlobal","sap/apf/utils/utils","sap/apf/core/utils/filter","sap/apf/core/utils/filterTerm","sap/apf/core/utils/filterSimplify","sap/base/i18n/Localization","sap/ui/thirdparty/datajs"],function(e,t,a,r,s,n,i){"use strict";var o=function(e,a){var r=e.instances.messageHandler;var o=e.instances.coreApi;var c=a.service;var u=a.selectProperties;var d=o.getUriGenerator();var p;if(c===undefined){p=r.createMessageObject({code:"5015",aParameters:[a.id]});r.putMessage(p)}var f=o.getMetadata(c);this.type=a.type;this.sendGetInBatch=function(e,p,g,v){f.done(function(f){o.getXsrfToken(c).done(function(l){var b=f.getUriComponents(a.entityType);var h,_;if(b){h=b.entitySet;_=b.navigationProperty}r.check(h!==undefined,"Invalid request configuration: An entityset does not exist under the service "+a.entityType);r.check(_!==undefined,"Invalid request configuration: A usable navigation does not exist for the service "+a.entityType);var m;var y;A(e);if(e&&e.getProperties){m=e.restrictToProperties(f.getFilterableProperties(h));if(o.getStartParameterFacade().isFilterReductionActive()){y=new s.FilterReduction;m=y.reduceFilter(r,m)}}x(g);var P=g&&g.paging;var M=g&&g.orderby;var R=d.buildUri(r,h,u,m,e,M,P,undefined,w,_,f);var O=[{requestUri:R,method:"GET",headers:{"Accept-Language":n.getLanguage(),"x-csrf-token":l}}];k();var q=d.getAbsolutePath(c);q=q+"$batch";var j={method:"POST",headers:{"x-csrf-token":l},requestUri:q,serviceMetadata:f.getODataModel().getServiceMetadata(),data:{__batchRequests:O}};var F=function(e,s){var n={};o.getEntityTypeMetadata(a.service,a.entityType).done(function(a){var i;try{var o="";if(e&&e.__batchResponses&&e.__batchResponses[0].data){n.data=e.__batchResponses[0].data.results;n.metadata=a;if(e.__batchResponses[0].data.__count){n.count=parseInt(e.__batchResponses[0].data.__count,10)}if(e.__batchResponses[1]&&e.__batchResponses[1].data){n.selectionValidation=e.__batchResponses[1].data.results}p(n,true)}else if(e&&e.__batchResponses[0]&&e.__batchResponses[0].response&&e.__batchResponses[0].message){o=s.requestUri;var c=e.__batchResponses[0].message;var u=e.__batchResponses[0].response.body;i=t.extractOdataErrorResponse(u);var d=e.__batchResponses[0].response.statusCode;n=r.createMessageObject({code:"5001",aParameters:[d,c,i,o]});r.putMessage(n)}else{o=s.requestUri||R;n=r.createMessageObject({code:"5001",aParameters:["unknown","unknown error","unknown error",o]});r.putMessage(n)}}catch(e){i=e&&e.message||"";window.console.trace("sap.apf.core.request catch exception: "+i);if(!r.isOwnException(e)){r.putMessage(r.createMessageObject({code:"5042",aParameters:[i]}))}}})};var T=function(e){var t="unknown error";var a;var s="unknown error";var n=R;if(e.message!==undefined){t=e.message}var i="unknown";if(e.response&&e.response.statusCode){i=e.response.statusCode;s=e.response.statusText||"";n=e.response.requestUri||R}if(e.messageObject&&e.messageObject.type==="messageObject"){r.putMessage(e.messageObject);p(e.messageObject)}else{a=r.createMessageObject({code:"5001",aParameters:[i,t,s,n]});r.putMessage(a);p(a)}};o.odataRequest(j,F,T,i.batchHandler);function k(){if(v&&v.requiredFilterProperties&&v.selectionFilter){var t=m.copy();t.addAnd(v.selectionFilter);if(o.getStartParameterFacade().isFilterReductionActive()){t=y.reduceFilter(r,t)}var a=d.buildUri(r,h,v.requiredFilterProperties,t,e,undefined,undefined,undefined,w,_,f);O.push({requestUri:a,method:"GET",headers:{"Accept-Language":n.getLanguage(),"x-csrf-token":l}})}}function w(e,a){var r="'";var s=f.getPropertyMetadata(h,e);if(s&&s.dataType){return t.formatValue(a,s)}if(typeof a==="number"){return a}return r+t.escapeOdata(a)+r}function x(e){var t,a;if(!e){return}t=Object.getOwnPropertyNames(e);for(a=0;a<t.length;a++){if(t[a]!=="orderby"&&t[a]!=="paging"){r.putMessage(r.createMessageObject({code:"5032",aParameters:[h,t[a]]}))}}}function A(e){var t=f.getFilterableProperties(h);var a="";var s=f.getEntityTypeAnnotations(h);var n;if(s.requiresFilter!==undefined&&s.requiresFilter==="true"){if(s.requiredProperties!==undefined){a=s.requiredProperties}}if(a===""){return}if(!t?.includes(a)){n=r.createMessageObject({code:"5006",aParameters:[h,a]});r.putMessage(n)}var i=e.getProperties();if(!i?.includes(a)){n=r.createMessageObject({code:"5005",aParameters:[h,a]});r.putMessage(n)}}})})}};e("sap.apf.core.Request",o);return o},true);
//# sourceMappingURL=request.js.map