/*!
 * SAP APF Analysis Path Framework
 *
 * (c) Copyright 2012-2014 SAP AG. All rights reserved
 */
sap.ui.define(["sap/apf/core/ajax","sap/apf/utils/exportToGlobal","sap/apf/utils/filter","sap/apf/utils/hashtable","sap/apf/core/constants","sap/ui/model/odata/ODataUtils","sap/ui/thirdparty/jquery"],function(e,t,s,n,a,r,jQuery){"use strict";function i(t){var s=null;var a=false;var i=false;var f=false;var o="";var u="";var c=new n(t.instances.messageHandler);var l=t.instances.coreApi;var p=t.instances.messageHandler;if(t&&t.functions&&t.functions.serializeApfState&&typeof t.functions.serializeApfState=="function"){a=t.functions.serializeApfState}if(t&&t.functions&&t.functions.deserializeApfState&&typeof t.functions.deserializeApfState=="function"){i=t.functions.deserializeApfState}this.type="sessionHandler";this.ajax=function(t){e(t)};this.getXsrfToken=function(e){var t=jQuery.Deferred();e=d(e);var s=c.getItem(e);if(s!==undefined&&s!==false){return t.resolve(s)}this.fetchXcsrfToken(e).done(function(s){c.setItem(e,s);t.resolve(s)});return t.promise()};function d(e){var t=l.getStartParameterFacade().getSapSystem();if(t){return r.setOrigin(e,{force:true,alias:t})}return e}this.fetchXcsrfToken=function(e){var t=jQuery.Deferred();var s="HEAD";if(c.getItem(e)===false){s="GET"}this.ajax({url:l.getUriGenerator().getAbsolutePath(e),type:s,beforeSend:function(e){e.setRequestHeader("x-csrf-token","Fetch")},success:n.bind(this),error:a.bind(this),async:true});function n(e,s,n){u=n.getResponseHeader("x-csrf-token");if(u!==undefined&&u!==null){t.resolve(u)}if(u===null){u="";t.resolve(u)}}function a(s,n,a){if(s.status===405&&c.getItem(e)!==false){c.setItem(e,false);this.fetchXcsrfToken(e).done(function(e){t.resolve(e)})}else{u="";var r=p.createMessageObject({code:5101,aParameters:[]});p.putMessage(r);t.resolve(u)}}return t.promise()};this.setDirtyState=function(e){f=e};this.isDirty=function(){return f};this.setPathName=function(e){if(typeof e!="string"){o="";return}o=e};this.getPathName=function(){return o};this.isApfStateAvailable=function(){if(s===null){return false}return true};this.storeApfState=function(){var e=true;if(a){a(undefined,e).done(function(e){s=e})}};this.restoreApfState=function(){if(this.isApfStateAvailable()&&i){l.resetPath();return i(s)}}}t("sap.apf.core.SessionHandler",i);return i});
//# sourceMappingURL=sessionHandler.js.map