/*!
 * SAP APF Analysis Path Framework
 *
 * (c) Copyright 2012-2014 SAP SE. All rights reserved
 */
sap.ui.define(["sap/apf/utils/exportToGlobal","sap/apf/utils/utils","sap/apf/core/constants","sap/base/i18n/Localization","sap/ui/thirdparty/datajs","sap/ui/thirdparty/jquery"],function(e,t,a,s,n,jQuery){"use strict";var r=a.entitySets;function o(e,a){var o=a.instances.coreApi;var i=a.instances.messageHandler;var c=e.serviceRoot;function u(e,t){return o.getEntityTypeMetadata(e,t)}function f(e){var t,a,s;if(!e){return""}a=e.length;if(a===1){return"('"+e[0].value+"')"}s="(";for(t=0;t<a;t++){if(t>0){s=s+","}s=s+e[t].name+"='"+e[t].value+"'"}return s+")"}function d(e){var t;if(e.messageObject&&e.messageObject.getCode){t=e.messageObject}else if(e.response&&e.response.statusCode&&e.response.statusCode>=400){t=i.createMessageObject({code:"11005",aParameters:[e.response.statusCode.toString(),e.response.statusText]})}else{t=i.createMessageObject({code:"5201"})}i.putMessage(t);return t}function h(e,t){var a=d(e);t(undefined,undefined,a)}function l(e,t,a,s){var n;var r;if(e&&e.results){n=e.results}else if(e){n=e}else{r=i.createMessageObject({code:"5201"})}u(t,a).done(function(e){s(n,e,r)})}function p(e){var t=JSON.parse(e.SerializedAnalyticalConfiguration);delete e.SerializedAnalyticalConfiguration;t.configHeader=e;e.SerializedAnalyticalConfiguration=JSON.stringify(t);return e}this.readEntity=function(e,t,a,s,n){var i=r[e];o.getXsrfToken(c).done(function(e){var n=c+"/"+i;n=n+f(a);if(s&&s.length>0){n=n+"?$select="+s.join()}var r={requestUri:n,async:true,method:"GET",headers:{"x-csrf-token":e}};o.odataRequest(r,function(e){l(e,c,i,t)},function(e){h(e,t)})})};function v(e,a,s){var n="'";if(s&&s.dataType){return t.formatValue(a,s.dataType.type)}if(typeof a==="number"){return a}return n+t.escapeOdata(a)+n}function g(e){var t=jQuery.Deferred();o.getXsrfToken(c).done(function(a){var n=[];var o,i=e.length;var d;var h=0;for(o=0;o<i;o++){d=r[e[h].entitySetName];u(c,d).done(function(o){var c,u,d;var l=false;c=r[e[h].entitySetName];c=c+f(e[h].inputParameters);if(e[h].selectList&&e[h].selectList.length>0){c=c+"?$select="+e[h].selectList.join();l=true}if(e[h].filter){if(l){c=c+"&"}else{c=c+"?"}c=c+"$filter="+e[h].filter.toUrlParam({formatValue:function(e,t){return v(e,t,o)}})}u=e[h].method||"GET";d={requestUri:c,method:u,headers:{"Accept-Language":s.getLanguage(),"x-csrf-token":a}};if(u!=="GET"){d.data=e[h].data}n.push(d);h++;if(h===i){t.resolve(n)}})}});return t}function b(e,t,a,s){var n=jQuery.Deferred();var o="";var i=e+f(t);if(a&&a.length>0){o="$select="+a.join()}u(c,e).done(function(t){if(s){if(o){o=o+"&"}o=o+"$filter="+s.toUrlParam({formatValue:function(e,a){return v(e,a,t)}})}if(e===r.application){if(o){o=o+"&"}o=o+"$orderby=ApplicationName"}if(o){i=i+"?"+o}n.resolve(i)});return n}function _(e,t){var a="unknown error";var s="unknown error";var n="";if(e.message!==undefined){a=e.message}var r="unknown";if(e.response&&e.response.statusCode){r=e.response.statusCode;s=e.response.statusText||"";n=e.response.requestUri}if(e.messageObject&&e.messageObject.type==="messageObject"){t([],e.messageObject)}else{t([],i.createMessageObject({code:"5001",aParameters:[r,a,s,n]}))}}this.doChangeOperationsInBatch=function(e,t){o.getXsrfToken(c).done(function(a){g(e).done(function(e){var s={requestUri:c+"/"+"$batch",method:"POST",headers:{"x-csrf-token":a},data:{__batchRequests:[{__changeRequests:e}]}};var r=function(e,a){var s;var n;var r,o,c;var u="";var f,d;if(e&&e.__batchResponses){for(f=0;f<e.__batchResponses.length;f++){if(e.__batchResponses[f].message){r=e.__batchResponses[f].message;o="";u=a.requestUri;s=i.createMessageObject({code:"5001",aParameters:[o,r,"",u]});break}for(d=0;d<e.__batchResponses[f].__changeResponses.length;d++){n=e.__batchResponses[f].__changeResponses[d];if(n.message){r=n.message;c=n.data;o=n.statusCode;u=a.requestUri;s=i.createMessageObject({code:"5001",aParameters:[o,r,c,u]});break}}}t(s)}};var u=function(e){_(e,t)};o.odataRequest(s,r,u,n.batchHandler)})})};this.readCollectionsInBatch=function(e,t){o.getXsrfToken(c).done(function(a){g(e).done(function(e){var s={requestUri:c+"/"+"$batch",async:true,method:"POST",headers:{"x-csrf-token":a},data:{__batchRequests:e}};var r=function(e){var a=[];var s,n,r,o,c;var u;if(e&&e.__batchResponses){for(u=0;u<e.__batchResponses.length;u++){if(e.__batchResponses[u].data&&e.__batchResponses[u].data.results){a.push(e.__batchResponses[u].data.results)}else if(e.__batchResponses[u].message){n=e.__batchResponses[u].message;r=e.__batchResponses[u].response.body;o=e.__batchResponses[u].response.statusCode;c=a.requestUri;s=i.createMessageObject({code:"5001",aParameters:[o,n,r,c]});break}else{c=a.requestUri;s=i.createMessageObject({code:"5001",aParameters:["unknown","unknown error","unknown error",c]});break}}t(a,s)}};var u=function(e){_(e,t)};o.odataRequest(s,r,u,n.batchHandler)})})};this.readCollection=function(e,t,a,s,n){m(e,t,a,s,n)};function m(e,t,a,f,d){var l=r[e];var p=function(e,a){var s;var n;var r="";if(e&&e.__batchResponses){if(e.__batchResponses[0].data&&e.__batchResponses[0].data.results){s=e.__batchResponses[0].data.results}else if(e.__batchResponses[0].message){var o=e.__batchResponses[0].message;var f=e.__batchResponses[0].response.body;var d=e.__batchResponses[0].response.statusCode;r=a.requestUri;n=i.createMessageObject({code:"5001",aParameters:[d,o,f,r]})}else{r=a.requestUri;n=i.createMessageObject({code:"5001",aParameters:["unknown","unknown error","unknown error",r]})}u(c,l).done(function(e){t(s,e,n)})}};o.getXsrfToken(c).done(function(e){b(l,a,f,d).done(function(a){var r={requestUri:c+"/"+"$batch",async:true,method:"POST",headers:{"x-csrf-token":e},data:{__batchRequests:[{requestUri:a,method:"GET",headers:{"x-csrf-token":e,"Accept-Language":s.getLanguage()}}]}};o.odataRequest(r,p,function(e){h(e,t)},n.batchHandler)})})}this.create=function(e,t,a){if(e==="configuration"){t=p(t)}var s=r[e];o.getXsrfToken(c).done(function(e){var n=c+"/"+s;var r={requestUri:n,async:true,method:"POST",headers:{"x-csrf-token":e},data:t};function f(e,t){var n;var r;if(e&&t.statusCode===201){n=e}else{r=i.createMessageObject({code:"5201"})}u(c,s).done(function(e){a(n,e,r)})}function h(e){var t=d(e);a(undefined,undefined,t)}o.odataRequest(r,f,h)})};this.update=function(e,t,a,s){if(e==="configuration"){t=p(t)}var n=r[e];o.getXsrfToken(c).done(function(e){var r=c+"/"+n+f(s);var h={requestUri:r,method:"PUT",headers:{"x-csrf-token":e},data:t};function l(e,t){var s;if(t.statusCode!==204){s=i.createMessageObject({code:"5201"})}u(c,n).done(function(e){a(e,s)})}function p(e){var t=d(e);a(undefined,t)}o.odataRequest(h,l,p)})};this.remove=function(e,t,a,s){var n=r[e];o.getXsrfToken(c).done(function(e){var r=c+"/"+n+f(t);u(c,n).done(function(t){if(s){r=r+"$filter="+s.toUrlParam({formatValue:function(e,a){return v(e,a,t)}})}var a={requestUri:r,method:"DELETE",headers:{"x-csrf-token":e}};o.odataRequest(a,h,l)});function h(e,t){if(t.statusCode===204){u(c,n).done(function(e){a(e,undefined)})}else{var s=i.createMessageObject({code:"5201"});a(undefined,s)}}function l(e){var t=d(e);a(undefined,t)}})}}e("sap.apf.core.OdataProxy",o);return o});
//# sourceMappingURL=odataProxy.js.map