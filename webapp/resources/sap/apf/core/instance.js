/*!
 * SAP APF Analysis Path Framework
 *
 * (c) Copyright 2012-2014 SAP AG. All rights reserved
 */
sap.ui.define(["sap/apf/utils/utils","sap/apf/utils/exportToGlobal","sap/apf/utils/filter","sap/apf/utils/hashtable","sap/apf/core/utils/checkForTimeout","sap/apf/core/utils/uriGenerator","sap/apf/core/utils/fileExists","sap/apf/core/utils/annotationHandler","sap/apf/core/utils/filter","sap/apf/core/messageHandler","sap/apf/core/path","sap/apf/core/persistence","sap/apf/core/metadataFactory","sap/apf/core/textResourceHandler","sap/apf/core/configurationFactory","sap/apf/core/sessionHandler","sap/apf/core/resourcePathHandler","sap/apf/core/constants","sap/apf/cloudFoundry/analysisPathProxy","sap/apf/cloudFoundry/ajaxHandler","sap/apf/core/metadataProperty","sap/apf/core/metadataFacade","sap/apf/core/metadata","sap/apf/core/readRequestByRequiredFilter","sap/apf/core/ajax","sap/apf/core/odataRequest","sap/apf/core/entityTypeMetadata","sap/apf/core/readRequest","sap/base/util/deepExtend","sap/ui/comp/smartfilterbar/ControlConfiguration","sap/ui/comp/smartfilterbar/SelectOption","sap/ui/model/odata/v2/ODataModel","sap/ui/thirdparty/datajs","sap/ui/thirdparty/jquery"],function(t,e,n,a,r,s,i,o,c,u,f,l,g,p,d,h,m,v,y,S,F,P,x,C,A,T,H,M,R,b,j,B,E,jQuery){"use strict";function w(e){var u=this;var w;var k,D,I;var O=e.instances.messageHandler;var q=e.instances.startParameter;e.constructors=e.constructors||{};var N=e.functions&&e.functions.checkForTimeout||r;var U={instances:{messageHandler:O,coreApi:this},constructors:{Request:e.constructors.Request},exits:{binding:{afterGetFilter:e.exits&&e.exits.binding&&e.exits.binding.afterGetFilter},path:{beforeAddingToCumulatedFilter:e.exits&&e.exits.path&&e.exits.path.beforeAddingToCumulatedFilter}},functions:e.functions};var L;var V;var G;var K;var z;var W;var X;var _;var J;var Q;var Y=e&&e.instances&&e.instances.datajs||E;this.destroy=function(){z.destroy()};this.ajax=function(t){var n=R({},t);n.functions=n.functions||{};n.functions.getSapSystem=q.getSapSystem;if(e.functions&&e.functions.ajax){n.functions.ajax=e.functions.ajax}n.instances=n.instances||{};n.instances.messageHandler=O;return A(n)};this.odataRequest=function(t,n,a,r){var s={instances:{datajs:Y},functions:{getSapSystem:q.getSapSystem}};var i=e&&e.functions&&e.functions.odataRequest||T;i(s,t,n,a,r)};this.getStartParameterFacade=function(){return q};this.getMessageHandler=function(){return O};this.putMessage=function(t){return O.putMessage(t)};this.check=function(t,e,n){return O.check(t,e,n)};this.createMessageObject=function(t){return O.createMessageObject(t)};this.activateOnErrorHandling=function(t){O.activateOnErrorHandling(t)};this.setCallbackForMessageHandling=function(t){O.setMessageCallback(t)};this.getLogMessages=function(){return O.getLogMessages()};this.checkForTimeout=function(t){var e=N(t);if(e){O.putMessage(e)}return e};this.getUriGenerator=function(){return s};this.getMetadata=function(t){return V.getMetadata(t)};this.getMetadataFacade=function(){return V.getMetadataFacade()};this.getEntityTypeMetadata=function(t,e){return V.getEntityTypeMetadata(t,e)};this.loadApplicationConfig=function(t){L.loadConfigFromFilePath(t)};this.loadTextElements=function(t){G.loadTextElements(t)};this.registerTextWithKey=function(t,e){G.registerTextWithKey(t,e)};this.getApplicationConfigProperties=function(){return L.getConfigurationProperties()};this.getResourceLocation=function(t){return L.getResourceLocation(t)};this.getPersistenceConfiguration=function(){return L.getPersistenceConfiguration()};this.getCategories=function(){return K.getCategories()};this.existsConfiguration=function(t){return K.existsConfiguration(t)};this.getStepTemplates=function(){return K.getStepTemplates()};this.getConfigurationObjectById=function(t){return K.getConfigurationById(t)};this.registerSmartFilterBarInstance=function(t){if(!Q){Q=jQuery.Deferred()}Q.resolve(t)};this.getSmartFilterBarAsPromise=function(){if(!Q){Q=jQuery.Deferred()}this.getSmartFilterBarConfigurationAsPromise().done(function(t){if(!t){Q.resolve(null)}});return Q};this.getSmartFilterBarConfigurationAsPromise=function(){return K.getSmartFilterBarConfiguration()};this.getSmartFilterBarPersistenceKey=function(t){return"APF"+K.getConfigHeader().AnalyticalConfiguration+t};this.getSmartFilterbarDefaultFilterValues=function(){const t=jQuery.Deferred();const n=e.constructors.SFBControlConfiguration??b;const a=e.constructors.SFBSelectOption??j;function r(t,e){var n=t.getFilterTermsForProperty(e);var r=[];n.forEach(function(t){var e=new a({low:t.getValue(),operator:t.getOp(),high:t.getHighValue(),sign:"I"});r.push(e)});return r}var s=[];e.functions.getCombinedContext().done(function(e){e.getProperties().forEach(function(t){var a={key:t,visibleInAdvancedArea:true,defaultFilterValues:r(e,t)};s.push(new n(a))});t.resolve(s)});return t};this.getReducedCombinedContext=function(){var t=jQuery.Deferred();e.functions.getCombinedContext().done(function(n){var a=u.getSmartFilterBarAsPromise();a.done(function(a){if(!a){t.resolve(n);return}var r=new c(e.instances.messageHandler);var s=a.getFilters();s.forEach(function(t){r.addAnd(c.transformUI5FilterToInternal(e.instances.messageHandler,t))});t.resolve(n.removeTermsByProperty(r.getProperties()))})});return t};this.getFacetFilterConfigurations=function(){return K.getFacetFilterConfigurations()};this.getNavigationTargets=function(){return K.getNavigationTargets()};this.createStep=function(t,e,n){var a;O.check(t!==undefined&&typeof t==="string"&&t.length!==0,"sStepID is  unknown or undefined");a=K.createStep(t,n);z.addStep(a,e);return a};this.getSteps=function(){return z.getSteps()};this.moveStepToPosition=function(t,e,n){z.moveStepToPosition(t,e,n)};this.updatePath=function(t,e){z.update(t,e)};this.removeStep=function(t,e){z.removeStep(t,e)};this.resetPath=function(){if(z){z.destroy()}z=new f.constructor(U)};this.stepIsActive=function(t){return z.stepIsActive(t)};this.isApfStateAvailable=function(){return W.isApfStateAvailable()};this.storeApfState=function(){W.storeApfState()};this.restoreApfState=function(){return W.restoreApfState()};this.serialize=function(){var t=z.serialize();u.getSmartFilterBarAsPromise().done(function(e){if(e){t.smartFilterBar=e.fetchVariant()}});return t};this.deserialize=function(t){if(t.smartFilterBar){if(!Q){Q=jQuery.Deferred()}Q.done(function(e){e._apfOpenPath=true;e.applyVariant(t.smartFilterBar);e.clearVariantSelection();e.fireFilterChange()})}z.deserialize(t)};this.getTextNotHtmlEncoded=function(t,e){return G.getTextNotHtmlEncoded(t,e)};this.getTextHtmlEncoded=function(t,e){return G.getTextHtmlEncoded(t,e)};this.isInitialTextKey=function(t){return t===v.textKeyForInitialText};this.getMessageText=function(t,e){return G.getMessageText(t,e)};this.getXsrfToken=function(t){return W.getXsrfToken(t)};this.setDirtyState=function(t){W.setDirtyState(t)};this.isDirty=function(){return W.isDirty()};this.setPathName=function(t){W.setPathName(t)};this.getPathName=function(){return W.getPathName()};this.getCumulativeFilter=function(){return e.functions.getCumulativeFilter()};this.createReadRequest=function(t){var e=K.createRequest(t);var n;if(typeof t==="string"){n=K.getConfigurationById(t)}else{n=t}return new M(U,e,n.service,n.entityType)};this.createReadRequestByRequiredFilter=function(t){var e=K.createRequest(t);var n;if(typeof t==="string"){n=K.getConfigurationById(t)}else{n=t}return new C(U,e,n.service,n.entityType)};this.loadMessageConfiguration=function(t,e){O.loadConfig(t,e)};this.loadAnalyticalConfiguration=function(t){K.loadConfig(t)};this.savePath=function(t,e,n,a){var r;var s;var i;var o;if(typeof t==="string"&&typeof e==="string"&&typeof n==="function"){r=t;s=e;i=n;o=a;this.setPathName(s);X.modifyPath(r,s,i,o)}else if(typeof t==="string"&&typeof e==="function"){s=t;i=e;o=n;this.setPathName(s);X.createPath(s,i,o)}else{O.putMessage(O.createMessageObject({code:"5027",aParameters:[t,e,n]}))}};this.readPaths=function(t){X.readPaths(t)};this.openPath=function(t,e){function n(t,n,a){if(!a){u.setPathName(t.path.AnalysisPathName)}e(t,n,a)}return X.openPath(t,n)};this.deletePath=function(t,e){X.deletePath(t,e)};this.createFilter=function(t){return new n(O,t)};this.getActiveStep=function(){return z.getActiveSteps()[0]};this.getCumulativeFilterUpToActiveStep=function(){return z.getCumulativeFilterUpToActiveStep()};this.setActiveStep=function(t){z.makeStepActive(t);var e=z.getActiveSteps();var n;for(n=0;n<e.length;++n){z.makeStepInactive(e[n])}return z.makeStepActive(t)};this.createFirstStep=function(t,e,n){var a=false;var r;r=u.getStepTemplates();r.forEach(function(e){a=e.id===t?true:a});if(!a){O.putMessage(O.createMessageObject({code:"5036",aParameters:[t]}))}else{u.createStep(t,n,e)}};this.getFunctionCreateRequest=function(){return K.createRequest};this.getAnnotationsForService=function(t){return _.getAnnotationsForService(t)};this.checkAddStep=function(t){return z.checkAddStep(t)};this.getPathFilterInformation=function(){return z.getFilterInformation()};this.getGenericExit=function(t){if(e&&e.exits&&e.exits[t]&&typeof e.exits[t]==="function"){return e.exits[t]}return undefined};this.getComponent=function(){return e&&e.instances&&e.instances.component};G=new(e.constructors.TextResourceHandler||p)(U);O.setTextResourceHandler(G);if(e.manifests){U.manifests=e.manifests}J=new(e.constructors.FileExists||i)({functions:{ajax:u.ajax,getSapSystem:q.getSapSystem}});var Z={manifests:e.manifests,functions:{getSapSystem:q.getSapSystem,getComponentNameFromManifest:t.getComponentNameFromManifest,getODataPath:s.getODataPath,getBaseURLOfComponent:s.getBaseURLOfComponent,addRelativeToAbsoluteURL:s.addRelativeToAbsoluteURL},instances:{fileExists:J}};_=new(e.constructors.AnnotationHandler||o.constructor)(Z);K=new(e.constructors.ConfigurationFactory||d)(U);var $={constructors:{EntityTypeMetadata:H,Hashtable:e.constructors.Hashtable||a,Metadata:e.constructors.Metadata||x,MetadataFacade:e.constructors.MetadataFacade||P,MetadataProperty:e.constructors.MetadataProperty||F,ODataModel:e.constructors.ODataModel||B},instances:{messageHandler:U.instances.messageHandler,coreApi:u,annotationHandler:_},functions:{getServiceDocuments:K.getServiceDocuments,getSapSystem:q.getSapSystem}};V=new(e.constructors.MetadataFactory||g)($);z=new(e.constructors.Path||f.constructor)(U);W=new(e.constructors.SessionHandler||h)(U);if(e.functions&&e.functions.isUsingCloudFoundryProxy){w=e.functions.isUsingCloudFoundryProxy}else{w=function(){return false}}if(w()){k={instances:{messageHandler:O},functions:{coreAjax:this.ajax}};D=e.constructors.AjaxHandler||S;I=new D(k)}var tt={instances:{messageHandler:O,coreApi:this},functions:{getComponentName:e.functions&&e.functions.getComponentName},manifests:e.manifests};if(e.constructors.Persistence){tt.instances.ajaxHandler=I;X=new e.constructors.Persistence(tt)}else if(w()){tt.instances.ajaxHandler=I;X=new(e.constructors.AnalysisPathProxy||y)(tt)}else{X=new l.constructor(tt)}var et={instances:{coreApi:u,messageHandler:U.instances.messageHandler,fileExists:J},functions:{checkForTimeout:N,initTextResourceHandlerAsPromise:G.loadResourceModelAsPromise,isUsingCloudFoundryProxy:w},corePromise:e.corePromise,manifests:e.manifests};if(e.constructors&&e.constructors.ProxyForAnalyticalConfiguration){et.constructors={ProxyForAnalyticalConfiguration:e.constructors.ProxyForAnalyticalConfiguration}}L=new(e.constructors.ResourcePathHandler||m)(et);if(e&&e.coreProbe){e.coreProbe({coreApi:this,startParameter:q,resourcePathHandler:L,textResourceHandler:G,configurationFactory:K,path:z,sessionHandler:W,persistence:X,fileExists:J,corePromise:e.corePromise})}}e("sap.apf.core.Instance",w);return{constructor:w}});
//# sourceMappingURL=instance.js.map