/*!
 * SAP APF Analysis Path Framework
 *
 * (c) Copyright 2012-2014 SAP AG. All rights reserved
 */
sap.ui.define(["sap/apf/core/utils/filter","sap/apf/utils/exportToGlobal","sap/base/util/deepExtend","sap/ui/thirdparty/jquery"],function(e,t,i,jQuery){"use strict";function s(t,s,n){var r;var l;var a=new e(t.instances.messageHandler);var o;var u;var f=0;var c=0;var p=i([],n);var d;if(s.preselectionDefaults&&s.preselectionDefaults.length>0){d=i([],s.preselectionDefaults)}else if(typeof s.preselectionFunction==="function"){d=i([],s.preselectionFunction())}var v=false;if(s.valueHelpRequest||Array.isArray(s.valueList)&&s.valueList.length>0){v=true}var h=false;var y={};var g={};var m;A=A.bind(this);P=P.bind(this);N=N.bind(this);E=E.bind(this);q=q.bind(this);F=F.bind(this);this.hasValueHelpRequest=function(){return!!s.valueHelpRequest};this.setContext=function(e){if(s.notConfigured===true){n=e}else{t.instances.messageHandler.putMessage(t.instances.messageHandler.createMessageObject({code:"5100",aParameters:["Context of configured Startfilter cannot be changed"]}))}};this.getPropertyName=function(){return s.property};this.getLabel=function(){return s.label};this.getAliasNameIfExistsElsePropertyName=function(){return s.alias||s.property};this.isMultiSelection=function(){if(s.multiSelection==="true"||s.multiSelection===true){return true}return false};this.isVisible=function(){if(n&&n.type==="internalFilter"&&!s.filterResolutionRequest){return false}return!s.invisible};this.setRestriction=function(e){a=e.copy();if(!u){u=jQuery.Deferred()}R(++c)};this.setSelectedValues=function(e,t){if(!u){u=jQuery.Deferred()}if(!r){r=jQuery.Deferred();if(!t){q().done(function(e){if(r){r.resolve(e)}})}else{r.resolve(e)}}if(e.type==="internalFilter"){l=e}else{l=i([],e)}if(!t){R(++c)}};this.getSelectedValues=function(){var e;if(!u){u=jQuery.Deferred();e=u;R(++c)}else if(u.state()==="pending"){e=u;if(r){r.done(function(){R(++c)})}else{R(++c)}}return e.promise()};this.getValues=function(){var e;if(!o||o.state()!=="pending"){o=jQuery.Deferred()}e=o;D(++f);return e.promise()};this.getMetadata=function(){if(s.metadataProperty){return jQuery.Deferred().resolve(s.metadataProperty)}return jQuery.Deferred().resolve({})};this.serialize=function(e,t){var i=jQuery.Deferred();var s={propertyName:this.getPropertyName()};q().done(function(n){if(n&&n.type==="internalFilter"){n=n.mapToSapUI5FilterExpression()}s.selectedValues=n;if(r){r.done(function(n){if(e===true){s.initiallySelectedValues=n}if(t!==true){r=null}i.resolve(s)})}else{i.resolve(s)}});return i};this.deserialize=function(s){if(s.selectedValues&&(s.selectedValues.aFilters||s.selectedValues.sPath)){s.selectedValues=e.transformUI5FilterToInternal(t.instances.messageHandler,s.selectedValues)}l=null;if(s.initiallySelectedValues){r=jQuery.Deferred().resolve(s.initiallySelectedValues)}else{r=null}if(Array.isArray(s.selectedValues)){p=i([],s.selectedValues);n=i([],s.selectedValues)}else{p=s.selectedValues;n=s.selectedValues}h=false};this.reset=function(){if(r){r.done(function(e){l=e})}};function D(e){F(e,f).done(function(t){if(e===f){o.resolve(t)}})}function R(e){q(e).done(function(t){if(e===c){var i=u;u=jQuery.Deferred();i.resolve(t,u.promise())}})}function F(e,t){var i=jQuery.Deferred();var r=[];l=l.bind(this);if(v&&Array.isArray(n)){V(e,t).then(function(e){var t=e.data;var s=A(p,t);i.resolve(s)})}else if(n&&n.type==="internalFilter"&&v&&s.filterResolutionRequest){jQuery.when(V(e,t),E(e,t)).then(function(e,t){var s=e.data;l(t.data,s);i.resolve(s)})}else if(v&&(s.preselectionDefaults&&s.preselectionDefaults.length>0||typeof s.preselectionFunction==="function")){V(e,t).then(function(e){var t=e.data;m=A(d,t);i.resolve(m)})}else if(v){V(e,t).then(function(e){i.resolve(e.data)})}else if(n&&n.type==="internalFilter"&&s.filterResolutionRequest){E(e,t).then(function(e){i.resolve(e.data)})}else if(Array.isArray(n)&&s.filterResolutionRequest&&!v){E(e,t).then(function(e){i.resolve(e.data)})}else if(Array.isArray(n)){r=A(p,r);i.resolve(r)}else if((s.preselectionDefaults&&s.preselectionDefaults.length>0||typeof s.preselectionFunction==="function")&&!v&&!s.filterResolutionRequest&&!n){if(this.isMultiSelection()){m=A(d,r)}else if(d.length>0){m=A([d[0]],r)}i.resolve(m)}else if((s.preselectionDefaults&&s.preselectionDefaults.length>0||typeof s.preselectionFunction==="function")&&s.filterResolutionRequest&&!n){if(this.isMultiSelection()){m=A(d,r)}else if(d.length>0){m=A([d[0]],r)}i.resolve(m)}else if(n&&n.type==="internalFilter"||!n){i.resolve(null)}return i.promise();function l(e,t){var i=N(t);for(var s=e.length-1;s>=0;s--){if(!i[e[s][this.getAliasNameIfExistsElsePropertyName()]]){t.unshift(e[s])}}}}function A(e,t){var s=i([],t);var n=N(t);var r;for(var l=e.length-1;l>=0;l--){if(!n[e[l]]){r={};r[this.getAliasNameIfExistsElsePropertyName()]=e[l];s.unshift(r)}else if(!h){e.splice(l,1)}}h=true;return s}function q(e){var t=jQuery.Deferred();var r;var a;var o;var u=this;if(l){if(!s.invisible){p(i([],l),e)}else{r=l;f()}}else if(typeof s.preselectionFunction==="function"&&!v){r=s.preselectionFunction();f()}else if(n&&n.type==="internalFilter"&&!s.filterResolutionRequest){t.resolve(n)}else if(s.preselectionDefaults===null&&!n){t.resolve([])}else if(s.filterResolutionRequest&&!n&&!v&&!(s.preselectionDefaults&&s.preselectionDefaults.length>0)){t.resolve(null)}else if(n&&n.type==="internalFilter"&&s.filterResolutionRequest){E(e,c).then(function(t){var s=P(t);p(i([],s),e)})}else if(v&&!Array.isArray(n)&&!(s.preselectionDefaults&&s.preselectionDefaults.length>0)&&!s.preselectionFunction){V(e,c).then(function(e){var t=P(e);if(this.isMultiSelection()){r=t}else{r=[t[0]]}f()}.bind(this))}else if(v&&!Array.isArray(n)&&(s.preselectionDefaults&&s.preselectionDefaults.length>0||s.preselectionFunction)){if(typeof s.preselectionFunction==="function"){a=s.preselectionFunction()}else{a=s.preselectionDefaults}p(i([],a),e)}else if(Array.isArray(n)){p(n,e)}else if(s.preselectionDefaults&&s.preselectionDefaults.length>0){r=s.preselectionDefaults;p(r,e)}else{t.resolve(null)}return t.promise();function f(){if(r&&r.type==="internalFilter"){t.resolve(r)}else{t.resolve(i([],r))}}function p(e,t){F(t,c).done(function(t){if(t!==null){r=[];o=N(t);e.forEach(function(e){if(o[e]){r.push(e)}});if(e.length!==0&&r.length===0&&s.preselectionDefaults!==null){r=P({data:t})}if(!u.isMultiSelection()){r=[r[0]]}if(l!==null){l=r}}else{r=null}f()})}}function E(i,r){var l;var o=jQuery.Deferred();if(i&&i!==r){return o.promise()}var u;if(Array.isArray(n)){u=new e(t.instances.messageHandler);n.forEach(function(e){u.addOr(this.getAliasNameIfExistsElsePropertyName(),"eq",e)}.bind(this))}else if(n instanceof e){u=n}else{u=new e(t.instances.messageHandler)}if(!a.isEmpty()){l=new e(t.instances.messageHandler);l.addAnd(a).addAnd(u)}else{l=u}if(y.lastMergedFilter&&y.lastMergedFilter.isEqual(l)){y.lastFilterResolutionPromise.done(function(e){o.resolve(e)})}else{y.lastMergedFilter=l.copy();y.lastFilterResolutionPromise=o;t.functions.createRequest(s.filterResolutionRequest).sendGetInBatch(l,f,undefined)}return o.promise();function f(e){o.resolve(e)}}function V(e,t){var i;if(s.valueHelpRequest){return b(e,t)}else if(s.valueList){i={data:A(s.valueList,[])};return jQuery.Deferred().resolve(i)}}function b(e,i){var n=jQuery.Deferred();var r={paging:{top:1e5,skip:0,inlineCount:true}};if(e&&i!==e){return n.promise()}if(g.lastRestriction&&g.lastRestriction.isEqual(a)){g.lastValueHelpPromise.done(function(e){n.resolve(e)})}else{g.lastRestriction=a.copy();g.lastValueHelpPromise=n;t.functions.createRequest(s.valueHelpRequest).sendGetInBatch(a,l,r)}return n.promise();function l(e){n.resolve(e)}}function P(e){var t=[];e.data.forEach(function(e){t.push(e[this.getAliasNameIfExistsElsePropertyName()])}.bind(this));return t}function N(e){var t={};e.forEach(function(e){var i=e[this.getAliasNameIfExistsElsePropertyName()];t[i]=true}.bind(this));return t}}t("sap.apf.utils.StartFilter",s);return s},true);
//# sourceMappingURL=startFilter.js.map