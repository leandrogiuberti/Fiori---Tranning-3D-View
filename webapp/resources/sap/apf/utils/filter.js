/*!
 * SAP APF Analysis Path Framework
 * 
 * (c) Copyright 2012-2014 SAP AG. All rights reserved
 */
sap.ui.define(["sap/apf/core/utils/filter","sap/apf/core/constants","sap/apf/utils/exportToGlobal","sap/base/Log"],function(e,t,r,n){"use strict";var i=function(e){var t;var r=this;var a=function(){t=new s(e,i.topAndId)};this.getById=function(e){if(t){if(e===i.topAndId){return t}return t.getById(e)}return undefined};this.type="filter";this.getExpressions=function(){if(t){return t.getExpressions()}return[]};this.getInternalFilter=function(){return t.getInternalFilter()};this.getTopAnd=function(){return t};this.updateExpression=function(t,r){e.check(t===r.id,"sId differs from oExpression.id");var n=this.getById(t);n.update(r)};this.updateValue=function(t,r,n){e.check(t!==undefined,"Filter updateValue: parameter id required");e.check(r!==undefined,"Filter updateValue: parameter value is required");var i=this.getById(t);e.check(i!==undefined,"Filter updateValue: id for expression not valid");i.updateValue(r,n)};this.serialize=function(){function e(t,r){var n={id:r.getId(),type:r.type,expressions:[],terms:[]};t.forEach(function(t,i){if(t instanceof Array){if(r.type==="filterAnd"){n.terms.push(e(t,r.getAndTerms()[i]))}else if(r.type==="filterOr"){n.terms.push(e(t,r.getOrTerms()[i]))}}else{n.expressions.push(t)}});return n}return e(this.getTopAnd().getExpression(),this.getTopAnd())};this.deserialize=function(e){t=undefined;a();function r(e,t){if(e.type==="filterAnd"&&e.id!==i.topAndId){t=t.addAnd(e.id)}else if(e.type==="filterOr"&&e.id!==i.topAndId){t=t.addOr(e.id)}e.expressions.forEach(function(e){t.addExpression(e)});e.terms.forEach(function(e){r(e,t)})}r(e,this.getTopAnd());return this};this.addAnd=function(e){n.error("Method 'addAnd' is deprecated since 1.23.0","Will be discarded with 1.26.0.")};this.intersectWith=function(t){var n=0;var s=[];var a;var o=new i(e);var d=r.serialize();u(d);switch(arguments.length){case 1:a=arguments[0];if(a instanceof Array){s=a}else{s.push(a)}break;default:s=Array.prototype.slice.call(arguments,0)}s.forEach(function(t){e.check(t instanceof i,"Parameter value is not of type sap.apf.utils.Filter");var r=t.serialize();u(r);Array.prototype.push.apply(d.expressions,r.expressions);Array.prototype.push.apply(d.terms,r.terms)});o.deserialize(d);return o;function u(e){if(e.id!==i.topAndId){e.id="#"+n+++"#"}e.terms.forEach(u)}};a();return this};i.createFilterFromSapUi5FilterJSON=function(e,t){var r=new i(e);function n(e,t,r){var i;t++;if(r.aFilters){if(r.bAnd){if(t!==1){i=e.addAnd()}else{i=e}}else{i=e.addOr()}r.aFilters.forEach(function(e){n(i,t,e)})}else if(r.sOperator){e.addExpression({name:r.sPath,operator:r.sOperator,value:r.oValue1,high:r.oValue2})}}n(r.getTopAnd(),0,t);return r};i.getOperators=function(){return t.FilterOperators};i.prototype.getOperators=i.getOperators;i.topAndId="filterTopAnd";var s=function(r,i){var s=i;var d=[];var u=this;this.type="filterAnd";this.getById=function(e){if(e===s){return this}var t;var r;for(r=0;r<d.length;r++){t=d[r].getById(e);if(t!==undefined){return t}}return undefined};this.getExpressions=function(){var e=[];var t;var r;for(r=0;r<d.length;r++){t=d[r].getExpression();if(t instanceof Array&&t.length===0){continue}if(t instanceof Array){e.push(t)}else{e.push([t])}}return e};this.getExpression=function(){var e=[];var t;var r;for(r=0;r<d.length;r++){t=d[r].getExpression();if(t instanceof Array&&t.length===0){continue}e.push(t)}return e};this.getCompoundExpressions=function(){n.error("Method 'getExpressions' is deprecated since 1.23.0","Will be discarded with 1.26.0.")};this.getId=function(){return i};this.getInternalFilter=function(){var t=new e(r);var n=d.length;var i;for(i=0;i<n;i++){t.addAnd(d[i].getInternalFilter())}return t};this.addAndTerm=function(e){n.error("Method 'addAndTerm' is deprecated since 1.23.0","Will be discarded with 1.26.0.")};this.getAndTerms=function(){return d};this.addOr=function(e){r.check(e===undefined||this.getById(e)===undefined,"Filter includes duplicated identifiers (IDs)");var t=new a(r,e,u);d.push(t);return t};this.addExpression=function(e){if(e.operator.length==2){e.operator=e.operator.toUpperCase()}r.check(e.id===undefined||this.getById(e.id)===undefined,"Filter includes duplicated identifiers (IDs)");r.check(e.operator!==undefined,"sap.apf.utils.Filter oExpression.operator undefined");r.check(t.aSelectOpt.includes(e.operator),"Filter oExpression.operator "+e.operator+" not supported");d.push(new o(r,e));return this}};var a=function(r,i,a){var d=i;var u=[];var p=a;this.type="filterOr";this.getById=function(e){if(e===d){return this}var t;for(var r=0;r<u.length;r++){t=u[r].getById(e);if(t!==undefined){return t}}return undefined};this.getExpression=function(){var e=[];var t;for(var r=0;r<u.length;r++){t=u[r].getExpression();if(t instanceof Array&&t.length===0){continue}e.push(t)}return e};this.getId=function(){return i};this.getInternalFilter=function(){var t=new e(r);for(var n=0;n<u.length;n++){t.addOr(u[n].getInternalFilter())}return t};this.getAndObject=function(){return p};this.addOrTerm=function(e){n.error("Method 'addOr' is deprecated since 1.23.0","Will be discarded with 1.26.0.")};this.getOrTerms=function(){return u};this.addExpression=function(e){if(e.operator.length==2){e.operator=e.operator.toUpperCase()}r.check(e.id===undefined||this.getAndObject().getById(e.id)===undefined,"Filter includes duplicated identifiers (IDs)");r.check(e.operator!==undefined,"sap.apf.utils.Filter oExpression.operator undefined");r.check(t.aSelectOpt.includes(e.operator),"Filter oExpression.operator "+e.operator+" not supported");u.push(new o(r,e));return this};this.addAnd=function(e){r.check(e===undefined||this.getById(e)===undefined,"Filter includes duplicated identifiers (IDs)");var t=new s(r,e);u.push(t);return t}};var o=function(r,n){u(n.high,n.operator);var i=n.id;var s=n.name;var a=n.operator;var o=n.value;var d=n.high;this.getById=function(e){if(i===e){return this}return undefined};this.getExpression=function(){if(!a||a!==t.FilterOperators.BT){return{name:s,operator:a,value:o}}return{name:s,operator:a,value:o,high:d}};this.getInternalFilter=function(){return new e(r,s,a,o,d)};this.update=function(e){u(e.high,e.operator);s=e.name;a=e.operator;o=e.value;d=e.high};this.updateValue=function(e,t){o=e;if(t!==undefined){d=t}u(d,a)};function u(e,n){if(!n){return}if(n===t.FilterOperators.BT&&(e===null||e===undefined)){r.check(false,"sap.apf.utils.FilterExpression: High value needed for 'between' selection")}else if(n!==t.FilterOperators.BT&&(e!==null&&e!==undefined)){r.check(false,"sap.apf.utils.FilterExpression: High value only needed for 'between' selection")}}};r("sap.apf.utils.Filter",i);return i},true);
//# sourceMappingURL=filter.js.map