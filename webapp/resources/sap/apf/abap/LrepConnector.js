/*!
 * SAP UI development toolkit for HTML5 (SAPUI5). (c) Copyright 2009-2021 SAP SE. All rights reserved.
 */
sap.ui.define(["sap/ui/thirdparty/jquery","sap/ui/thirdparty/URI","sap/base/util/merge"],function(jQuery,e,t){"use strict";var s=function(e){this._initClientParam();this._initLanguageParam();if(e){this._sXsrfToken=e.XsrfToken}this._sLrepUrl="/sap/bc/lrep"};s.DEFAULT_CONTENT_TYPE="application/json; charset=utf-8";s.ROUTES={CONTENT:"/content/",CSRF:"/actions/getcsrftoken/",DATA:"/flex/data/"};s.createConnector=function(e){return new s(e)};s.prototype._initClientParam=function(){var e=n("sap-client");if(e){this._sClient=e}};function n(e){return new URLSearchParams(window.location.search).get(e)}s.prototype._initLanguageParam=function(){var e;e=n("sap-language")||n("sap-ui-language");if(e){this._sLanguage=e}};s.prototype._resolveUrl=function(t){if(!t.startsWith("/")){t="/"+t}var s=e(t).absoluteTo("");return s.toString()};s.prototype._getDefaultHeader=function(){return{headers:{"X-CSRF-Token":this._sXsrfToken||"fetch"}}};s.prototype._getDefaultOptions=function(e,n,a){var r;if(!n){n=s.DEFAULT_CONTENT_TYPE}else if(n.indexOf("charset")===-1){n+="; charset=utf-8"}r=t(this._getDefaultHeader(),{type:e,async:true,contentType:n,processData:false,headers:{"Content-Type":n}});if(a&&r.contentType.indexOf("application/json")===0){r.dataType="json";if(typeof a==="object"){r.data=JSON.stringify(a)}else{r.data=a}}else if(a){r.data=a}if(e==="DELETE"){delete r.data;delete r.contentType}return r};s.prototype.send=function(e,s,n,a){s=s||"GET";s=s.toUpperCase();a=a||{};e=this._resolveUrl(e);a=t(this._getDefaultOptions(s,a.contentType,n),a);return this._sendAjaxRequest(e,a)};s.prototype.deleteFile=function(e,t,s,n,a){return this._fileAction("DELETE",e,t,s,n,null,null,a)};s.prototype.upsert=function(e,t,s,n,a,r,i){var o=this;return Promise.resolve(o._fileAction("PUT",e,t,s,n,a,r,i))};s.prototype.listContent=function(e,t){var n=this._sLrepUrl+s.ROUTES.CONTENT;n+=e;var a=[];if(t){a.push({name:"layer",value:t})}n+=this._buildParams(a);return this.send(n,"GET",null,null)};s.prototype._fileAction=function(e,t,n,a,r,i,o,u){var l=this._sLrepUrl+s.ROUTES.CONTENT;l+=t+"/"+n+"."+a;var f=[];f.push({name:"layer",value:r});if(u){f.push({name:"changelist",value:u})}l+=this._buildParams(f);var p={contentType:o||s.DEFAULT_CONTENT_TYPE};return this.send(l,e.toUpperCase(),i,p)};s.prototype._getMessagesFromXHR=function(e){var t;var s;var n;var a;s=[];try{t=JSON.parse(e.responseText);if(t&&t.messages&&t.messages.length>0){n=t.messages.length;for(a=0;a<n;a++){s.push({severity:t.messages[a].severity,text:t.messages[a].text})}}}catch(e){}return s};s.prototype._sendAjaxRequest=function(e,t){var n=this._sLrepUrl;if(!n){return Promise.reject({status:"warning",messages:[{severity:"warning",text:"Flexibility Services requests were not sent. The UI5 bootstrap is configured to not send any requests."}]})}var a=n+s.ROUTES.CSRF;var r={headers:{"X-CSRF-Token":"fetch"},type:"HEAD"};if(this._sClient){r.headers["sap-client"]=this._sClient}return new Promise(function(s,n){function i(e,t,n){var a=n.getResponseHeader("X-CSRF-Token");this._sXsrfToken=a||this._sXsrfToken;var r=n.getResponseHeader("etag");var i={status:t,etag:r,response:e};s(i);this._aSentRequestListeners?.forEach(function(e){e(i)})}function o(e,t,s,n){var a=new Error(n);a.status=s;a.code=t.statusCode().status;a.messages=this._getMessagesFromXHR(t);if(!a.stack){try{throw a}catch(t){e(t)}}else{e(a)}}function u(s,a,r){this._sXsrfToken=r.getResponseHeader("X-CSRF-Token");t.headers=t.headers||{};t.headers["X-CSRF-Token"]=this._sXsrfToken;jQuery.ajax(e,t).done(i).fail(o.bind(this,n))}function l(e,s,n,i,l){if(n.status===403){jQuery.ajax(a,r).done(u.bind(this)).fail(function(){s({status:"error"})})}else if(t&&t.type==="DELETE"&&n.status===404){e()}else{o.call(this,s,n,i,l)}}var f=true;if(t&&t.type){if(t.type==="GET"||t.type==="HEAD"){f=false}else if(this._sXsrfToken&&this._sXsrfToken!=="fetch"){f=false}}if(f){jQuery.ajax(a,r).done(u.bind(this)).fail(o.bind(this,n))}else{jQuery.ajax(e,t).done(i.bind(this)).fail(l.bind(this,s,n))}}.bind(this))};s.prototype._buildParams=function(e){if(!e){e=[]}if(this._sClient){e.push({name:"sap-client",value:this._sClient})}if(this._sLanguage){e.push({name:"sap-language",value:this._sLanguage})}var t="";var s=e.length;for(var n=0;n<s;n++){if(n===0){t+="?"}else if(n>0&&n<s){t+="&"}t+=e[n].name+"="+e[n].value}return t};s.prototype.getStaticResource=function(e,t,n,a){var r=this._sLrepUrl+s.ROUTES.CONTENT;r+=e+"/"+t+"."+n;var i=[];if(!a){i.push({name:"dt",value:"true"})}r+=this._buildParams(i);return this.send(r,"GET",null,null)};s.prototype.getFileAttributes=function(e,t,n,a){var r=this._sLrepUrl+s.ROUTES.CONTENT;r+=e+"/"+t+"."+n;var i=[];i.push({name:"metadata",value:"true"});if(a){i.push({name:"layer",value:a})}r+=this._buildParams(i);return this.send(r,"GET",null,null)};return s},true);
//# sourceMappingURL=LrepConnector.js.map