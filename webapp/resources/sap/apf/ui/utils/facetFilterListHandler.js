/*!
 * SAP APF Analysis Path Framework
 *
 * (c) Copyright 2012-2014 SAP AG. All rights reserved
 */
sap.ui.define(["sap/apf/ui/utils/facetFilterListConverter","sap/apf/ui/utils/facetFilterValueFormatter","sap/apf/utils/exportToGlobal","sap/m/FacetFilterList","sap/m/FacetFilterItem","sap/m/library","sap/ui/Device","sap/ui/model/BindingMode","sap/ui/model/json/JSONModel","sap/ui/thirdparty/jquery"],function(e,t,i,s,a,r,l,n,o,jQuery){"use strict";const{ListMode:c}=r;function u(i,r,u){"use strict";var d=[];var f;var g=new e;function F(e){if(e===null||e.length===0){var t=i.createMessageObject({code:"6010",aParameters:[i.getTextNotHtmlEncoded(u.getLabel())]});i.putMessage(t);f.setActive(false)}}function p(e,s,a,n){var o=new t(r,i);var c=o.getFormattedFFData(e,s,a);var u=g.getFFListDataFromFilterValues(c,s,d);var F=f.getModel();F.setSizeLimit(500);F.setData(u);var p=F.getData();if(n){p.forEach(function(e){if(e.selected==false){if(!l.browser.msie){if(Object.values(f.getSelectedKeys()).indexOf(e.text)>-1){f.removeSelectedKey(e.key)}}else{if(Object.keys(f.getSelectedKeys()).indexOf(e.text)>-1){f.removeSelectedKey(e.key)}}}})}F.updateBindings()}this.createFacetFilterList=function(){var e=this;f=new s({title:i.getTextNotHtmlEncoded(u.getLabel()),mode:u.isMultiSelection()?c.MultiSelect:c.SingleSelectMaster,key:u.getPropertyName(),growing:true,growingThreshold:10,growingScrollToLoad:true,listClose:this.onListClose.bind(this),listOpen:this.onListOpen.bind(this)});f.bindItems("/",new a({key:"{key}",text:"{text}",selected:"{selected}"}));var t=new o([]);t.setDefaultBindingMode(n.OneWay);f.setModel(t);if(!u.hasValueHelpRequest()){this.getFacetFilterListData().done(F)}this.getSelectedFFValues().then(function(e){r(e)});return f;function r(t){t.oFilterRestrictionPropagationPromiseForSelectedValues.done(function(e,t){r({aSelectedFilterValues:e,oFilterRestrictionPropagationPromiseForSelectedValues:t})});if(t.aSelectedFilterValues.length>0||d.length>0){d=t.aSelectedFilterValues;e.getFacetFilterListData().done(function(e,t,i){p(e,t,i,true)})}}};this.getFacetFilterListData=function(){var e;var t=jQuery.Deferred();var i=u.getValues();i.then(function(i){e=u.getAliasNameIfExistsElsePropertyName()||u.getPropertyName();u.getMetadata().then(function(s){t.resolve(i,e,s)})});return t.promise()};this.getSelectedFFValues=function(){var e=jQuery.Deferred();var t=u.getSelectedValues();t.then(function(t,i){e.resolve({aSelectedFilterValues:t,oFilterRestrictionPropagationPromiseForSelectedValues:i})});return e.promise()};this.setSelectedFFValues=function(e){u.setSelectedValues(e)};this.onListClose=function(){var e=[],t,i,s,a;t=f.getSelectedItems();e=t.map(function(e){return e.getKey()});i=JSON.stringify(e.sort());s=JSON.stringify(d.sort());a=i!==s;if(a){d=e;this.setSelectedFFValues(e);r.selectionChanged(true)}};this.onListOpen=function(){f.setBusy(true);this.getFacetFilterListData().done(function(e,t,i){p(e,t,i,false);f.setBusy(false)})}}i("sap.apf.ui.utils.FacetFilterListHandler",u);return u});
//# sourceMappingURL=facetFilterListHandler.js.map