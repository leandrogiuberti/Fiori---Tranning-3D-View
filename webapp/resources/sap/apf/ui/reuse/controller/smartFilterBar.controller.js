/*!
* SAP APF Analysis Path Framework
* 
 * (c) Copyright 2012-2018 SAP SE. All rights reserved
*/
sap.ui.define(["sap/ui/comp/state/UIState","sap/ui/core/mvc/Controller","sap/ui/model/odata/ODataUtils","sap/ui/model/odata/v2/ODataModel","sap/ui/model/odata/CountMode"],function(e,t,a,i,r){"use strict";return t.extend("sap.apf.ui.reuse.controller.smartFilterBar",{onInit:function(){var e=this;var t=e.getView().getViewData().oSmartFilterBarConfiguration.service;var n=e.getView().getViewData().oCoreApi.getAnnotationsForService(t);var o={annotationURI:n,json:true};if(n&&n.length>0){o.loadAnnotationsJoined=true}var s=e.getView().getViewData().oCoreApi.getStartParameterFacade().getSapSystem();if(s){t=a.setOrigin(t,{force:true,alias:s})}var g=new i(t,o);g.getMetaModel().loaded().then(function(){e.getView().getViewData().oCoreApi.getMetadata(t).done(function(a){if(a.getAllEntitySetsExceptParameterEntitySets().indexOf(e.getView().getViewData().oSmartFilterBarConfiguration.entitySet)<0){e.getView().getViewData().oCoreApi.putMessage(e.getView().getViewData().oCoreApi.createMessageObject({code:"5053",aParameters:[e.getView().getViewData().oSmartFilterBarConfiguration.entitySet,t]}))}g.setDefaultCountMode(r.None);e.byId("idAPFSmartFilterBar").setModel(g)})});g.attachMetadataFailed(function(){e.getView().getViewData().oCoreApi.putMessage(e.getView().getViewData().oCoreApi.createMessageObject({code:"5052",aParameters:[t]}))})},afterInitialization:function(){this.handleSplitterSize();this.setFilterData();this.validateFilters();this.registerSFBInstanceWithCore()},registerSFBInstanceWithCore:function(){var e=this;e.getView().getViewData().oCoreApi.registerSmartFilterBarInstance(e.byId("idAPFSmartFilterBar"))},handlePressOfGoButton:function(){var e=this;var t=this.byId("idAPFSmartFilterBar");if(!t._apfOpenPath&&e.getView().getViewData().oCoreApi.getActiveStep()){e.getView().getViewData().oUiApi.selectionChanged(true)}delete t._apfOpenPath},setFilterData:function(){var t=this;var a=this.byId("idAPFSmartFilterBar");var i=t.getView().getViewData().oCoreApi.getStartParameterFacade().getAnalyticalConfigurationId();var r=t.getView().getViewData().oCoreApi.getStartParameterFacade().getXappStateId();var n=a.getUiState();var o=a.mProperties;a.setUiState(n,o);if(i!==undefined||r!==null&&r!==undefined){var s=t.getView().getViewData().oCoreApi;var g=s.getComponent();const i=sap.ui.require("sap/ushell/Container");if(i!==undefined){var d=i.getService("CrossApplicationNavigation");var l=d.getStartupAppState(g);l.done(function(t){var a=t.getData();if(a){a=JSON.parse(JSON.stringify(a));var i=a.selectionVariant;var r=new e({selectionVariant:i});var n=this.byId("idAPFSmartFilterBar");n.setUiState(r,{replace:true,strictMode:false});var o=n.getVariantManagement().STANDARDVARIANTKEY;n.getVariantManagement().setCurrentVariantId(o)}}.bind(this))}var p=a.getVariantManagement().getDefaultVariantKey();a.setCurrentVariantId(p)}},validateFilters:function(){var e=this.byId("idAPFSmartFilterBar");var t=e.validateMandatoryFields();this.getView().getViewData().oUiApi.getAddAnalysisStepButton().setEnabled(t);this.getView().getViewData().oUiApi.getAddAnalysisStepButton().rerender()},handleSplitterSize:function(){var e=this;var t=this.byId("idAPFSmartFilterBar");var a=t.getAggregation("_searchButton");a.attachPress(function(){var t=this.getParent();if(t.getFilterBarExpanded()){e.getView().getViewData().oUiApi.getLayoutView().byId("idSplitterLayoutData").setSize("127px")}else{e.getView().getViewData().oUiApi.getLayoutView().byId("idSplitterLayoutData").setSize("65px")}})}})});
//# sourceMappingURL=smartFilterBar.controller.js.map