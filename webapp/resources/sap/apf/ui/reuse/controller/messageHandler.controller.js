/*!
 * SAP APF Analysis Path Framework
 * 
 * (c) Copyright 2012-2014 SAP AG. All rights reserved
 */
sap.ui.define(["sap/apf/core/constants","sap/base/Log","sap/base/security/encodeXML","sap/m/Button","sap/m/Dialog","sap/m/library","sap/m/Link","sap/m/MessageBox","sap/m/MessageToast","sap/m/Text","sap/m/VBox","sap/ui/Device","sap/ui/core/HTML","sap/ui/core/library","sap/ui/core/mvc/Controller","sap/ui/thirdparty/jquery"],function(e,t,o,a,s,i,n,r,l,g,c,u,d,p,f,jQuery){"use strict";var w=i.DialogType,m=i.FlexAlignItems,h=p.ValueState;var y;function v(e){var t=e.getMessage();while(e.getPrevious()){e=e.getPrevious();t=t+"\n"+e.getMessage()}return t}function x(e,t){var o=e.getView().getViewData().oCoreApi;var a=o.getGenericExit("closeFatalErrorDialog");if(a){a(o,e,t)}else{window.history.go(-1)}}function C(e,t){r.information(t.getMessage(),{styleClass:u.system.desktop?"sapUiSizeCompact":""})}function A(e,t){l.show(t.getMessage(),{width:"20em"})}function E(e){var t=y.oCoreApi.getLogMessages();var o=false;for(var a=0;a<t.length;a++){if(t[a].search(5021)!==-1){o=true;break}}return o}function T(e,t){var i=new s(e.createId("idShowDetailsDialog"),{contentWidth:jQuery(window).height()*.6+"px",contentHeight:jQuery(window).height()*.6+"px",title:y.oCoreApi.getTextNotHtmlEncoded("error"),type:w.Message,state:h.Error,content:new d({content:["<div><p> "+o(v(t))+"</p></div>"].join(""),sanitizeContent:true}),beginButton:new a({text:y.oCoreApi.getTextNotHtmlEncoded("close"),press:function(){i.close()}}),afterClose:function(){i.destroy()}});i.setInitialFocus(i);i.open()}function b(e,t){var o=E(e);var i=new s(e.createId("idFatalDialog"),{title:y.oCoreApi.getTextNotHtmlEncoded("error"),type:w.Message,state:h.Error,content:[new g({text:o?y.oCoreApi.getTextNotHtmlEncoded("application-reload"):y.oCoreApi.getTextNotHtmlEncoded("fatalErrorMessage")}),new c({alignItems:m.End,items:[new n({text:y.oCoreApi.getTextNotHtmlEncoded("showDetails"),press:function(){T(e,t)}})]})],beginButton:new a({text:y.oCoreApi.getTextNotHtmlEncoded("close"),press:function(){x(e,i)}}),afterClose:function(){i.destroy()}});i.setInitialFocus(i);i.open()}function V(e,t){var o=y.oCoreApi;var i=y.uiApi;var r=new s(e.createId("idShowValidStateDialog"),{title:o.getTextNotHtmlEncoded("error"),type:w.Message,state:h.Error,content:[new g({text:o.getTextNotHtmlEncoded("lastValidStateMessage")}),new c({alignItems:m.End,items:[new n({text:o.getTextNotHtmlEncoded("showDetails"),press:function(){T(e,t)}})]})],beginButton:new a({text:o.getTextNotHtmlEncoded("gobackToValidState"),press:function(){var e=o.restoreApfState();e.then(function(){i.getAnalysisPath().getController().bLastValidState=true;i.getAnalysisPath().getCarouselView().getController().removeAllThumbnails();o.updatePath(i.getAnalysisPath().getController().callBackForUpdatePath.bind(i.getAnalysisPath().getController()));i.getLayoutView().getController().setPathTitle();r.close();i.getAnalysisPath().getCarouselView().rerender();i.getLayoutView().setBusy(false)},function(){r.close()})}}),endButton:new a({text:o.getTextNotHtmlEncoded("startNewAnalysis"),press:function(){i.getAnalysisPath().getToolbar().getController().resetAnalysisPath();r.close()}}),afterClose:function(){r.destroy()}});r.setInitialFocus(r);r.open()}function M(e,t){var o=y.oCoreApi.isApfStateAvailable();if(o){V(e,t)}else{b(e,t)}}return f.extend("sap.apf.ui.reuse.controller.messageHandler",{onInit:function(){var e=this;if(u.system.desktop){e.getView().addStyleClass("sapUiSizeCompact")}y=e.getView().getViewData()},showMessage:function(o){var a=this;var s=o.getSeverity();var i=e.message.severity;switch(s){case i.fatal:y.uiApi.getLayoutView().setBusy(false);M(a,o);break;case i.error:y.uiApi.getLayoutView().setBusy(false);break;case i.information:C(a,o);break;case i.success:A(a,o);break;default:t.error("Error type not defined");break}if(s===i.warning||s===i.error){l.show(o.getMessage(),{width:"40%",offset:"0 -50",animationDuration:2e3})}}})});
//# sourceMappingURL=messageHandler.controller.js.map