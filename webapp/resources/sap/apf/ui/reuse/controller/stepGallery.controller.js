/*!
 * SAP APF Analysis Path Framework
 * 
 * (c) Copyright 2012-2014 SAP AG. All rights reserved
 */
sap.ui.define(["sap/apf/ui/utils/helper","sap/apf/utils/trace","sap/ui/Device","sap/ui/core/Fragment","sap/ui/core/mvc/Controller","sap/ui/model/json/JSONModel"],function(e,t,i,a,o,s){"use strict";function r(e){var t=e.getMessage();while(e.getPrevious()){e=e.getPrevious();t=t+"\n"+e.getMessage()}return t}return o.extend("sap.apf.ui.reuse.controller.stepGallery",{getGalleryElementsData:function(){var t=this;var i=[];var a=this.oCoreApi.getCategories();var o=this.oCoreApi.getTextNotHtmlEncoded("label");var s=this.oCoreApi.getTextNotHtmlEncoded("steps");var r=this.oCoreApi.getTextNotHtmlEncoded("category");var l;if(a.length===0){l=this.oCoreApi.createMessageObject({code:"6001",aParameters:["Categories"]});this.oCoreApi.putMessage(l)}var n;for(n=0;n<a.length;n++){var c={};var p=a[n];var h;if(!p.label){l=this.oCoreApi.createMessageObject({code:"6002",aParameters:[o,r+": "+h]});this.oCoreApi.putMessage(l)}else{h=this.oCoreApi.getTextNotHtmlEncoded(p.label);c.title=this.oCoreApi.getTextNotHtmlEncoded(p.label)}c.id=p.id;c.stepTemplates=[];p.stepTemplates.forEach(function(i){var a={};if(!i.title){l=t.oCoreApi.createMessageObject({code:"6003",aParameters:["Title"]});t.oCoreApi.putMessage(l)}else{a.title=t.oCoreApi.getTextNotHtmlEncoded(i.title)}a.id=i.id;a.representationtypes=i.getRepresentationInfo();a.representationtypes.forEach(function(i){i.title=t.oCoreApi.getTextNotHtmlEncoded(i.label);if(i.parameter&&i.parameter.orderby){new e(t.oCoreApi).getRepresentationSortInfo(i).done(function(e){var t=[];for(var a=0;a<e.length;a++){e[a].done(function(e){t.push(e)})}i.sortDescription=t})}});a.defaultRepresentationType=a.representationtypes[0];c.stepTemplates.push(a)});i.push(c)}var g=this.oCoreApi.getStepTemplates();if(g.length===0){l=this.oCoreApi.createMessageObject({code:"6002",aParameters:[s,r]});this.oCoreApi.putMessage(l)}var d={GalleryElements:i};return d},onInit:function(){if(i.system.desktop){this.getView().addStyleClass("sapUiSizeCompact")}this.oCoreApi=this.getView().getViewData().oCoreApi;this.oUiApi=this.getView().getViewData().uiApi;var e=this.getGalleryElementsData().GalleryElements;var t=new s({GalleryElements:e});this.getView().setModel(t)},getStepDetails:function(e,t){var i=this.getGalleryElementsData().GalleryElements;var a=i[e].stepTemplates[t];return a},openHierarchicalSelectDialog:async function(){if(this.pHierchicalSelectDialog){this.bAbortOpeningHierchicalSelectDialog=true;this.oHierchicalSelectDialog=await this.pHierchicalSelectDialog;this.pHierchicalSelectDialog=undefined}if(this.oHierchicalSelectDialog){this.oHierchicalSelectDialog.destroy();this.oHierchicalSelectDialog=undefined}this.pHierchicalSelectDialog=a.load({type:"JS",name:"sap.apf.ui.reuse.fragment.stepGallery",controller:this});this.bAbortOpeningHierchicalSelectDialog=false;this.oHierchicalSelectDialog=await this.pHierchicalSelectDialog;this.pHierchicalSelectDialog=undefined;if(this.bAbortOpeningHierchicalSelectDialog){this.oHierchicalSelectDialog.destroy();this.oHierchicalSelectDialog=undefined;return}this.oHierchicalSelectDialog.setModel(this.getView().getModel());if(i.system.desktop){this.oHierchicalSelectDialog.addStyleClass("sapUiSizeCompact")}this.oHierchicalSelectDialog.open()},onStepPress:function(e,i){t.logCall("stepGallery.onStepPress -- adds an active step, id=",e," ************************************** ");var a=this;var o=a.oUiApi.getAnalysisPath().getController();this.oCoreApi.checkAddStep(e).done(function(s,l){t.log("onStepPress->continuation",", bCanStepBeAdded",s," oRepresentationType=",i);if(s){a.oHierchicalSelectDialog.close();a.oCoreApi.createStep(e,o.callBackForUpdatePathAndSetLastStepAsActive.bind(o),i);o.refresh(-1)}else{var n=r(l);var c={oController:a,sMessageText:n};a.openAddStepCheckDialog(c)}});var s=this.oCoreApi.getSteps();var l=s.length>0?s[s.length-1].getSelectedRepresentation():{};t.logReturn("onStepPress",", step id=",e,", repr.apfId="+(l?l.apfId:"--"),", selectedRepr=",l?l:"error: no step existing")},openAddStepCheckDialog:async function(e){const t=await a.load({type:"JS",name:"sap.apf.ui.reuse.fragment.addStepCheckDialog",controller:e});t.open();this.oUiApi.getLayoutView().setBusy(false)}})});
//# sourceMappingURL=stepGallery.controller.js.map