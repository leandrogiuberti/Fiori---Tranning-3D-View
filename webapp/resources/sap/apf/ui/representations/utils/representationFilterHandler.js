/*!
 * SAP APF Analysis Path Framework
 *
 * (c) Copyright 2012-2014 SAP AG. All rights reserved
 */
sap.ui.define(["sap/apf/ui/representations/utils/displayOptionHandler","sap/apf/utils/exportToGlobal","sap/apf/utils/utils","sap/apf/core/metadataProperty","sap/ui/thirdparty/jquery"],function(e,t,r,i,jQuery){"use strict";function a(e){return e.filter(function(e,t,r){return r.indexOf(e)===t})}function o(e,t,a){var o,s;var n=e.oParameter.requiredFilters[0];if(n){var l=e.oParameter.requiredFilterOptions?e.oParameter.requiredFilterOptions.labelDisplayOption:undefined;var u=e.oDisplayOptionHandler.getColumnNameBasedOnDisplayOption(n,l,t);var p=new i.constructor(t.getPropertyMetadata(u));e.aFilterValues.forEach(function(t){for(o=0;o<a.length;o++){if(a[o][n]===t){if(a[o]["formatted_"+u]){s=a[o]["formatted_"+u]}else{s=r.convertToExternalFormat(a[o][u],p)}break}}e.filterValueLookup[t]=s})}}function s(t,r,i){this.oApi=t;this.aFilterValues=[];this.oParameter=r;this.sRequiredFilter=this.oParameter.requiredFilters[0];this.oDisplayOptionHandler=new e;this.filterValueLookup={};this.oTimeAxisDateConverter=i}s.prototype.constructor=s;s.prototype.setMetadataAndDataResponse=function(e,t){this.oMetadata=e;this.aDataResponse=t};s.prototype.validateFiltersWithDataset=function(){var e=[];var t=this.aDataResponse.map(function(e){return e[this.sRequiredFilter]}.bind(this));e=this.aFilterValues.filter(function(e){return t.indexOf(e)!==-1});this.aFilterValues=e};s.prototype.createFilterFromSelectedValues=function(e){var t=this,r=false,i;var o=this.oApi.createFilter();if(e&&e.length>0){this.aFilterValues=a(e.concat(this.aFilterValues))}var s=o.getTopAnd().addOr("exprssionOr");var n=o.getOperators().EQ;r=t.oTimeAxisDateConverter.bIsConversionToDateRequired(this.oParameter.requiredFilters[0],this.oMetadata);this.aFilterValues.forEach(function(e){if(r){i=t.oTimeAxisDateConverter.getConvertedDateLookUp()[e]||e}else{i=e}var a={id:e,name:t.sRequiredFilter,operator:n,value:i};s.addExpression(a)});return o};s.prototype.updateFilterFromSelection=function(e){var t=a(e);this.aFilterValues=t.slice(0)};s.prototype.clearFilters=function(){this.aFilterValues=[]};s.prototype.getDisplayInfoForFilters=function(e,t){var r=[],i=this;o(i,e,t);i.aFilterValues.forEach(function(e){var t={id:e,text:i.filterValueLookup[e]};r.push(t)});return r};s.prototype.getFilterValues=function(){return this.aFilterValues};s.prototype.getIfSelectedFilterChanged=function(e){var t=jQuery(this.aFilterValues).not(e).length===0&&jQuery(e).not(this.aFilterValues).length===0;return!t};t("sap.apf.ui.representations.utils.RepresentationFilterHandler",s);return s});
//# sourceMappingURL=representationFilterHandler.js.map