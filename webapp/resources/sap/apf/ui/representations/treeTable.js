/*!
 * SAP APF Analysis Path Framework
 * 
 * (c) Copyright 2012-2018 SAP SE. All rights reserved
*/
sap.ui.define(["sap/apf/core/constants","sap/apf/modeler/ui/utils/constants","sap/apf/ui/representations/BaseUI5ChartRepresentation","sap/apf/ui/representations/utils/paginationDisplayOptionHandler","sap/apf/ui/utils/constants","sap/apf/ui/utils/formatter","sap/m/FlexItemData","sap/m/Label","sap/m/Text","sap/m/Title","sap/m/VBox","sap/ui/core/library","sap/ui/model/BindingMode","sap/ui/table/Column","sap/ui/table/library","sap/ui/table/TreeTable","sap/ui/table/rowmodes/Type"],function(e,t,r,a,o,i,n,l,s,p,u,d,c,f,T,g,h){"use strict";var b=d.HorizontalAlign,y=T.SelectionMode;function m(e){return e.metadata.getPropertyMetadata(e.requiredFilter).text}function F(e){return e.oTreeTableControlObject.parameters.treeAnnotationProperties.hierarchyNodeExternalKeyFor}function v(e,t){if(e){if(t.getPropertyMetadata(e)["filter-restriction"]==="single-value"){return y.Single}return y.MultiToggle}return y.None}function C(e,t,r){var a;var o=function(e){return function(t){if(r.metadata!==undefined){var a;if(t){a=r.oFormatter.getFormattedValue(e,t);if(a!==undefined){return a}}}return t}};a=new g({showNoData:false,rows:{parameters:{numberOfExpandedLevels:99}},extension:[new p({text:t})],enableSelectAll:false,rowMode:h.Auto});a.setLayoutData(new n({growFactor:1}));a.addStyleClass("sapUiSizeCompact");a.setSelectionMode(v(r.requiredFilter,r.metadata));var i=[],u,d;e.name.forEach(function(t,r){u=new s({text:{path:e.value[r],formatter:o(e.value[r]),bindingMode:c.OneWay}});d=new f({label:new l({text:t}),template:u,tooltip:t});i.push(d)});i.forEach(function(e){a.addColumn(e)});r.oTreeTableModel.attachBatchRequestCompleted(function(){if(r.oApi.getUiApi().getLayoutView().getController()&&r.oApi.getUiApi().getLayoutView().getController().byId("stepContainer")){r.oApi.getUiApi().getLayoutView().getController().byId("stepContainer").getContent()[0].byId("idStepLayout").setBusy(false)}A(r,a,e);if(r.oRepresentationFilterHandler!==null){if(r.oRepresentationFilterHandler!==undefined){if(r.oRepresentationFilterHandler.getFilterValues().length>0){x(r)}else{r.oTreeTable.clearSelection()}}}});r.oTreeTableModel.attachBatchRequestSent(function(e){if(r.oApi.getUiApi().getLayoutView().getController()&&r.oApi.getUiApi().getLayoutView().getController().byId("stepContainer")){r.oApi.getUiApi().getLayoutView().getController().byId("stepContainer").getContent()[0].byId("idStepLayout").setBusy(true)}});a.setModel(r.oTreeTableModel);a.bindRows(r.oTreeTableControlObject);return a}function x(e){var t=e.oTreeTable.getRows();e.oTreeTable.clearSelection();setTimeout(function(){t.forEach(function(t,r){var a=t.getBindingContext();if(a){var o=a.getProperty(e.requiredFilter);e.oRepresentationFilterHandler.getFilterValues().forEach(function(t){if(o===t){e.oTreeTable.addSelectionInterval(r,r)}})}})},1)}function A(e,t,r){if(e.metadata!==null){if(e.metadata!==undefined){for(var a=0;a<r.name.length;a++){var o=e.metadata.getPropertyMetadata(r.value[a]);if(o["aggregation-role"]==="measure"){var i=t.getColumns()[a];i.setHAlign(b.End)}}}}}function P(e,t){var r=e.oTreeTable.getContextByIndex(t).getProperty(e.requiredFilter);var a=e.oTreeTable.getSelectionMode(e.requiredFilter);var o=e.oTreeTable.isIndexSelected(t);var i=e.oTreeTable.getContextByIndex(t).getProperty(m(e));var n=e.oTreeTable.getContextByIndex(t).getProperty(F(e));e.oPaginationDisplayOptionHandler.createDisplayValueLookupForPaginatedFilter(r,i,n);var l=e.oRepresentationFilterHandler.getFilterValues();if(o){l=E(e,a,r,l)}else{l=H(e,a,r,l)}S(e,l)}function R(e){e.oRepresentationFilterHandler.clearFilters()}function w(e){return e.filter(function(e,t,r){return r.indexOf(e)===t})}function E(e,t,r,a){if(t===y.Single){a=[r]}else{a.push(r)}return w(a)}function H(e,t,r,a){if(t===y.Single){a=[]}else{var o=a.indexOf(r);if(o!==-1){a.splice(o,1)}}return a}function S(e,t){R(e);e.oRepresentationFilterHandler.updateFilterFromSelection(t);e.oApi.selectionChanged()}function O(e){var r={name:[],value:[]};var a=e.oParameters.hierarchicalProperty.concat(e.oParameters.properties);a.forEach(function(a,o){var i=a.fieldName;var n=e.metadata.getPropertyMetadata(i).label||e.metadata.getPropertyMetadata(i).name;if(a.kind===t.propertyTypes.HIERARCHIALCOLUMN){if(a.labelDisplayOption==="text"){i=e.metadata.getPropertyMetadata(e.oTreeTableControlObject.parameters.treeAnnotationProperties.hierarchyNodeFor).text}else{i=e.oTreeTableControlObject.parameters.treeAnnotationProperties.hierarchyNodeExternalKeyFor}}r.name[o]=a.fieldDesc===undefined||!e.oApi.getTextNotHtmlEncoded(a.fieldDesc).length?n:e.oApi.getTextNotHtmlEncoded(a.fieldDesc);r.value[o]=i});return r}var M=function(e,t){var i=this;i.oParameters=t;i.requiredFilter=i.oParameters.requiredFilters[0];i.oKeyTextLookup={};i.type=o.representationTypes.TREE_TABLE_REPRESENTATION;r.apply(i,[e,t]);i.oPaginationDisplayOptionHandler=new a;i._selectRowInTreeTable=function(e){var t=e.getParameter("userInteraction");var r=e.getParameter("rowIndex");if(!t||r===undefined||r===null){return}P(i,r)};i.handleRowSelectionInTreeTable=function(e){i._selectRowInTreeTable(e)}};M.prototype=Object.create(r.prototype);M.prototype.constructor=M;M.prototype.getMainContent=function(e){if(!this.oTreeTable){var t=O(this);this.oTreeTable=C(t,e,this);this.oTreeTable.attachRowSelectionChange(this.handleRowSelectionInTreeTable.bind(this))}return new u({fitContainer:true,items:[this.oTreeTable]})};M.prototype.getSelections=function(){var e=[],t=this,r;this.oRepresentationFilterHandler.getFilterValues().forEach(function(a){r=t.oPaginationDisplayOptionHandler.getDisplayNameForPaginatedFilter(a,t.parameter.requiredFilterOptions,t.requiredFilter,t.oFormatter,t.metadata);e.push({id:a,text:r})});return e};M.prototype.removeAllSelection=function(){this.oRepresentationFilterHandler.clearFilters();this.oTreeTable.clearSelection();this.oApi.selectionChanged()};M.prototype.getFilter=function(){var e=this.oApi.createFilter();var t=e.getTopAnd().addOr("exprssionOr");this.oRepresentationFilterHandler.getFilterValues().forEach(function(e){var r={id:e,name:this.requiredFilter,operator:"EQ",value:e};t.addExpression(r)}.bind(this));return e};M.prototype.setFilterValues=function(e){var t=this,r=[];var a=t.requiredFilter;t.oRepresentationFilterHandler.clearFilters();e.forEach(function(e){var o=e[a];var i=e[m(t)];var n=e[F(t)];t.oPaginationDisplayOptionHandler.createDisplayValueLookupForPaginatedFilter(o,i,n);r.push(o)});t.oRepresentationFilterHandler.updateFilterFromSelection(r)};M.prototype.updateTreetable=function(e,t,r,a){this.oTreeTableModel=t;this.oTreeTableControlObject=e;this.metadata=r;this.oFormatter=new i({getEventCallback:this.oApi.getEventCallback.bind(this.oApi),getTextNotHtmlEncoded:this.oApi.getTextNotHtmlEncoded,getExits:this.oApi.getExits()},this.metadata);if(this.oTreeTable&&a){this.oTreeTable.bindRows(this.oTreeTableControlObject)}};M.prototype.getPrintContent=function(e){var t=this.oTreeTable.clone();var r={oRepresentation:t};return r};M.prototype.getSelectedFilterPropertyLabel=function(e){return this.metadata.getPropertyMetadata(e)["hierarchy-node-for"]};M.prototype.destroy=function(){if(this.oParameters){this.oParameters=null}if(this.oTreeTableModel){this.oTreeTableModel=null}if(this.oTreeTableControlObject){this.oTreeTableControlObject=null}if(this.oTreeTable){this.oTreeTable.destroy()}if(this.metadata){this.metadata=null}if(this.oRepresentationFilterHandler){this.oRepresentationFilterHandler=null}r.prototype.destroy.call(this)};return M},true);
//# sourceMappingURL=treeTable.js.map