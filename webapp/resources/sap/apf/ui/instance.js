/*!
 * SAP APF Analysis Path Framework
 *
 * (c) Copyright 2012-2019 SAP AG. All rights reserved
 */
sap.ui.define(["sap/apf/ui/utils/constants","sap/apf/core/constants","sap/apf/utils/exportToGlobal","sap/apf/utils/trace","sap/ui/base/Object","sap/ui/core/mvc/View","sap/ui/core/mvc/ViewType","sap/ui/dom/includeStylesheet","sap/ui/thirdparty/jquery"],function(e,t,a,i,n,r,o,s,jQuery){"use strict";function l(e,t,a){const i=n.isObjectA(t,"sap.ui.comp.smartfilterbar.SmartFilterBar");var r=e.getLayoutView();var o=r.byId("subHeader");var s=r.byId("idSplitterLayoutData");o.addContent(t);if(!i){s.setSize("65px")}t.addEventDelegate({onAfterRendering:function(){o.setBusy(false);if(i){o.setHeight("");o.addStyleClass(a)}}})}function u(e){e.getLayoutView().byId("subHeader").setBusy(false)}function c(a){a.uiApi=this;var n=a.oCoreApi;var c=a.oStartFilterHandler;const d={};var f;var p;var g;var h;var v;var y;var w;var C;var m,S;var A=n.getUriGenerator().getApfLocation();this.oEventCallbacks={};s(A+"resources/css/apfUi.css","apfCss");s(A+"resources/css/apfPrint.css","printCss");jQuery("#printCss").attr("media","print");this.getAddAnalysisStepButton=function(){return this.getAnalysisPath().getCarouselView().getAddStepButton()};this._loadAnalysisPath=function(){if(d.analysisPath===undefined){d.analysisPath=r.create({viewName:"module:sap/apf/ui/reuse/view/analysisPath.view",viewData:a}).then(e=>f=e)}return d.analysisPath};this.getAnalysisPath=function(){if(f===undefined){throw new Error("premature access to analysisPath view")}return f};this.loadNotificationBar=function(){if(d.messageHandler===undefined){d.messageHandler=r.create({viewName:"module:sap/apf/ui/reuse/view/messageHandler.view",viewData:a})}return d.messageHandler};this._loadStepContainer=function(){if(d.stepContainer===undefined){d.stepContainer=r.create({viewName:"module:sap/apf/ui/reuse/view/stepContainer.view",viewData:a}).then(e=>p=e)}return d.stepContainer};this.getStepContainer=function(){if(p===undefined){throw new Error("premature access to stepContainer view")}return p};this._loadToolbar=function(){if(d.toolbar===undefined){d.toolbar=r.create({viewName:"module:sap/apf/ui/reuse/view/toolbar.view",viewData:a}).then(e=>g=e)}return d.toolbar};this.getToolbar=function(){if(g===undefined){throw new Error("premature access to toolbar view")}return g};this._loadCarouselSingleton=function(){if(a&&a.functions&&a.functions.createCarouselSingleton){h=a.functions.createCarouselSingleton();d.carousel=Promise.resolve(h)}if(d.carousel===undefined){d.carousel=r.create({viewName:"module:sap/apf/ui/reuse/view/carousel.view",viewData:{oInject:a}}).then(e=>h=e)}return d.carousel};this.createCarouselSingleton=function(){if(h===undefined){throw new Error("premature access to carousel view")}return h};this._loadStepGallery=function(){if(d.stepGallery==null){d.stepGallery=r.create({viewName:"module:sap/apf/ui/reuse/view/stepGallery.view",viewData:a}).then(e=>v=e)}return d.stepGallery};this.getStepGallery=function(){if(v===undefined){throw new Error("premature access to stepGallery view")}return v};this._loadPathGallery=function(){if(d.pathGallery===undefined){d.pathGallery=r.create({viewName:"module:sap/apf/ui/reuse/view/pathGallery.view",viewData:{oInject:a}}).then(e=>y=e)}return d.pathGallery};this.getPathGallery=function(){if(y===undefined){throw new Error("premature access to pathGallery view")}return y};this._loadDeleteAnalysisPath=function(){if(d.deleteAnalysisPath===undefined){d.deleteAnalysisPath=r.create({viewName:"module:sap/apf/ui/reuse/view/deleteAnalysisPath.view",viewData:{oInject:a}}).then(e=>w=e)}return d.deleteAnalysisPath};this.getDeleteAnalysisPath=function(){if(w===undefined){throw new Error("premature access to deleteAnalysisPath view")}return w};this._loadLayoutView=function(){if(d.applicationLayout===undefined){d.applicationLayout=r.create({viewName:"sap.apf.ui.reuse.view.layout",type:o.XML,viewData:a}).then(e=>C=e)}return d.applicationLayout};this.getLayoutView=function(){if(C===undefined){throw new Error("premature access to applicationLayout view")}return C};this.selectionChanged=function(e){i.logCall("ui/Instance.selectionChanged",", bRefreshAllSteps: ",e,"--------");var t;var a=this;function r(){if(C){C.getController().enableDisableOpenIn()}}t=n.getSteps().indexOf(n.getActiveStep());var o=0;t=n.getSteps().indexOf(n.getActiveStep());if(!e){o=t+1}i.logCall("...",", nActiveStepIndex: ",t,", indexOfRefresh",o);a.getAnalysisPath().getController().refresh(o);a.getAnalysisPath().getController().getView().getCarouselView().getController().setBusyFromIndex(o);n.updatePath(a.getAnalysisPath().getController().callBackForUpdatePath.bind(a.getAnalysisPath().getController()),function(){r()});i.logReturn("ui/Instance.selectionChanged")};let P;this.createApplicationLayout=function(e){var t=this;if(P==null){P=new Promise(function(a){var i=t._loadStepGallery();var n=t._loadToolbar();var r=t._loadPathGallery();var o=t._loadDeleteAnalysisPath();var s=t._loadStepContainer();var l=i.then(function(){return t._loadCarouselSingleton()});var u=Promise.all([n,l,r,o]).then(function(){return t._loadAnalysisPath()});var c=Promise.all([s,u]).then(function(){return t._loadLayoutView()});c.then(function(){e.addPage(C);a(e)})})}return P};this.addDetailFooterContent=function(e){this.getLayoutView().getController().addDetailFooterContentLeft(e)};this.addMasterFooterContentRight=function(e){this.getLayoutView().getController().addMasterFooterContentRight(e)};this.setEventCallback=function(e,t){this.oEventCallbacks[e]=t};this.getEventCallback=function(e){return this.oEventCallbacks[e]};this.getCustomFormatExit=function(){return a.exits};this.setCustomFormatExit=function(e){var t=this.getCustomFormatExit();t.customFormat=e};this.drawSmartFilterBar=function(e){var t=this;function a(e){return n.getSmartFilterbarDefaultFilterValues().done(async function(a){S=await r.create({viewName:"module:sap/apf/ui/reuse/view/smartFilterBar.view",viewData:{oCoreApi:n,oUiApi:t,oSmartFilterBarConfiguration:e,controlConfiguration:a,parent:t.getLayoutView()}});l(t,S.byId("idAPFSmartFilterBar"),"smartFilterBarContainer")})}if(e){if(e.entitySet){return a(e)}return n.getMetadata(e.service).done(function(t){e.entitySet=t.getEntitySetByEntityType(e.entityType);delete e.entityType;return a(e)})}u(t)};this.drawFacetFilter=async function(e){if(e.length>0){if(d.facetFilterView==null){d.facetFilterView=r.create({viewName:"module:sap/apf/ui/reuse/view/facetFilter.view",viewData:{oCoreApi:n,oUiApi:this,aConfiguredFilters:e,oStartFilterHandler:c}})}m=await d.facetFilterView;l(this,m.byId("idAPFFacetFilter"))}else{u(this)}};this.contextChanged=function(e){var a=this.getEventCallback(t.eventTypes.contextChanged);if(typeof a==="function"){a()}};this.getFacetFilterForPrint=function(){if(m){return m.byId("idAPFFacetFilter")}};this.getSmartFilterForPrint=function(){if(S){return S.byId("idAPFSmartFilterBar")}};this.handleStartup=function(e){var t=this;var a=jQuery.Deferred();n.getSmartFilterBarConfigurationAsPromise().done(function(i){if(i){t.drawSmartFilterBar(i)}e.done(function(e){var r=c.getStartFilters();r.done(function(r){t.contextChanged();if(!i){t.drawFacetFilter(r)}if(e.navigationMode==="backward"){t.getAnalysisPath().getController().isBackNavigation=true;n.updatePath(t.getAnalysisPath().getController().callBackForUpdatePath.bind(t.getAnalysisPath().getController()));t.getLayoutView().getController().setPathTitle()}if(e.navigationMode==="forward"){if(n.getStartParameterFacade().getSteps()){var o=n.getStartParameterFacade().getSteps()[0].stepId;var s=n.getStartParameterFacade().getSteps()[0].representationId;var l=t.getAnalysisPath().getController().callBackForUpdatePathAndSetLastStepAsActive.bind(t.getAnalysisPath().getController());n.createFirstStep(o,s,l)}sap.ui.require("sap/ui/core/BusyIndicator")?.hide()}t.loadNotificationBar().then(function(e){t.getLayoutView().byId("applicationPage").addContent(e);var i=e.getController().showMessage;n.setCallbackForMessageHandling(i.bind(e.getController()));a.resolve()})})})});return a.promise()};this.destroy=function(){m=undefined;S=undefined;if(f){var e=this.getAnalysisPath().getToolbar().getController();F(e.saveDialog);F(e.newOpenDialog);F(e.newDialog);F(e.confirmDialog);F(e.errorMsgDialog);F(e.noPathAddedDialog);if(e.deleteAnalysisPath!==undefined){F(e.deleteAnalysisPath.getController().oDialog)}if(e.pathGallery!==undefined){F(e.pathGallery.getController().oDialog)}var t=this.getAnalysisPath().getCarouselView().getStepGallery().getController();F(t.oHierchicalSelectDialog)}if(p){var a=this.getStepContainer().getController();F(a.selectionDisplayDialog);b(this)}};function F(e){if(e!==undefined){if(e.isA("sap.m.ViewSettingsDialog")){e.destroy()}else if(e.isOpen()){e.close()}}}function b(t){var a=false;var i=false;var n;if(t.getStepContainer().getViewData().oCoreApi.getActiveStep()!==undefined){a=true}if(a){n=t.getStepContainer().getViewData().oCoreApi.getActiveStep().getSelectedRepresentation();if(n!==undefined){i=true}}if(i){if(n.type!==e.representationTypes.TABLE_REPRESENTATION){if(n.toggleInstance!==undefined){F(n.toggleInstance.viewSettingsDialog)}}else{F(n.viewSettingsDialog)}}}}a("sap.apf.ui.Instance",c);return c},true);
//# sourceMappingURL=instance.js.map