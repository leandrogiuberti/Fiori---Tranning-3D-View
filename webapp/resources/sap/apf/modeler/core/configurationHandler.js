/*!
 * SAP APF Analysis Path Framework
 *
 * (c) Copyright 2012-2014 SAP SE. All rights reserved
 */
sap.ui.define(["sap/apf/modeler/core/configurationEditor","sap/apf/modeler/core/configurationObjects","sap/apf/utils/exportToGlobal","sap/apf/utils/hashtable","sap/apf/utils/utils","sap/apf/modeler/core/configurationObjects","sap/ui/Global"],function(t,e,n,i,a,o,r){"use strict";function s(t){var n=this;var i=t.instances.messageHandler;var o=t.instances.persistenceProxy;var s=t.constructors.ConfigurationEditor;var c=t.constructors.Hashtable;var u=t.constructors.LazyLoader;var f=new c(i);var l=new c(i);var g=new c(i);var m=new c(i);var p,C;var d={constructors:{Hashtable:c},instances:{messageHandler:i}};this.exportTexts=function(t){var e=this.getConfiguration(t).AnalyticalConfigurationName;return C.exportTexts(e)};this.getTextPool=function(){return C};this.setApplicationIdAndContext=function(t,e,n){C=n||C;f=new c(i);var a,o=e.length;for(a=0;a<o;a++){f.setItem(e[a].AnalyticalConfiguration,e[a]);l.setItem(e[a].AnalyticalConfiguration,e[a].AnalyticalConfigurationName)}p=t};this.getApplicationId=function(){return p};this.setConfiguration=function(t,e){t.AnalyticalConfiguration=e||v();t.Application=p;f.setItem(t.AnalyticalConfiguration,t);return t.AnalyticalConfiguration};this.getList=function(){var t=[];var e=function(e,n){t.push(n)};f.each(e);return t};this.getConfiguration=function(t){return f.getItem(t)};this.loadConfiguration=function(e,a){var r,f=e.id||e;if(!e.updateExisting){r=g.getItem(f)}if(!r){r=new u(d,m);g.setItem(f,r)}r.asyncGetInstance(f,l);function l(t,e,n){a(t,e)}function m(a,r,u){var f={instances:{coreApi:t.instances.coreApi,messageHandler:i,configurationHandler:n,persistenceProxy:o,textPool:C,metadataFactory:t.instances.metadataFactory},constructors:{Hashtable:c,Step:t.constructors.Step,HierarchicalStep:t.constructors.HierarchicalStep,SmartFilterBar:t.constructors.SmartFilterBar,FacetFilter:t.constructors.FacetFilter,NavigationTarget:t.constructors.NavigationTarget,Representation:t.constructors.Representation,ConfigurationObjects:t.constructors.ConfigurationObjects,ElementContainer:t.constructors.ElementContainer,ConfigurationFactory:t.constructors.ConfigurationFactory,RegistryProbe:t.constructors.RegistryProbe}};new s(e,f,function(t,e){r(a,t,e)})}};this.resetConfiguration=function(t){var e;if(g.hasItem(t)){e=f.getItem(t);e.AnalyticalConfigurationName=l.getItem(t);g.removeItem(t);return t}};this.updateConfigurationName=function(t,e){l.setItem(t,e)};this.copyConfiguration=function(t,i){var a=this.getConfiguration(t);if(!a){i(null);return}n.loadConfiguration(t,o);function o(t){var o,r,s,c;c=e.deepDataCopy(a);o=v();c.AnalyticalConfiguration=o;n.setConfiguration(c,o);r=t.copy(o);s=new u(d,undefined,{id:o,instance:r});g.setItem(o,s);i(o)}};this.replaceConfigurationId=function(t,e){if(t.indexOf("apf1972-")===0){var n=f.getItem(t);var i=g.getItem(t).getInstance();var a=new u(d,undefined,{id:e,instance:i});n.AnalyticalConfiguration=e;f.setItem(e,n);l.setItem(e,n.AnalyticalConfigurationName);f.removeItem(t);g.setItem(e,a);g.removeItem(t)}};this.exportConfiguration=function(e,a){var s;this.loadConfiguration(e,c);function c(c){if(!c.isSaved()){i.putMessage(i.createMessageObject({code:"11007",aParameters:[e]}));a(null)}else{var u=t.functions.getApplication(p);var f=n.getConfiguration(e).AnalyticalConfigurationName;s=c.serialize();s.configHeader={Application:p,ApplicationName:u.ApplicationName,SemanticObject:u.SemanticObject,AnalyticalConfiguration:e,AnalyticalConfigurationName:f,UI5Version:r.version};o.readEntity("configuration",function(t,n,o){if(o){i.putMessage(i.createMessageObject({code:"5022",aParameters:[e]}));a(null)}else{s.configHeader.CreationUTCDateTime=t.CreationUTCDateTime;s.configHeader.LastChangeUTCDateTime=t.LastChangeUTCDateTime;s=JSON.stringify(s,null,"\t");a(s,f)}},[{name:"AnalyticalConfiguration",value:e}],["CreationUTCDateTime","LastChangeUTCDateTime"],p)}}};this.memorizeConfiguration=function(t){var e,n;n=g.getItem(t);if(!n){return null}e=n.getInstance();if(e){m.setItem(t,e.copy(t));return t}return null};this.restoreMemorizedConfiguration=function(t){var e,n;n=m.removeItem(t);if(n){e=new u(d,undefined,{id:t,instance:n});g.setItem(t,e);return n}return null};this.removeConfiguration=function(t,e){function n(n,i){if(!i){f.removeItem(t);g.removeItem(t)}e(t,n,i)}if(t.indexOf("apf1972-")!==0){o.remove("configuration",[{name:"AnalyticalConfiguration",value:t}],n,undefined,p)}else{f.removeItem(t);g.removeItem(t);e(t,undefined,undefined)}};this.removeAllConfigurations=function(){f=new c(i)};function v(){return"apf1972-"+a.createPseudoGuid(32)}}n("sap.apf.modeler.core.ConfigurationHandler",s);return s});
//# sourceMappingURL=configurationHandler.js.map