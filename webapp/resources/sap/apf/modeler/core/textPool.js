/*!
 * SAP APF Analysis Path Framework
 *
 * (c) Copyright 2012-2014 SAP SE. All rights reserved
 */
sap.ui.define(["sap/apf/utils/hashtable","sap/apf/core/constants","sap/apf/core/utils/filter","sap/ui/core/format/DateFormat","sap/apf/utils/exportToGlobal","sap/apf/utils/utils","sap/ui/thirdparty/jquery"],function(e,t,n,a,i,r,jQuery){"use strict";function s(e,n,a){var i=e.instances.messageHandler;var s=e.instances.persistenceProxy;var m=e.isUsingCloudFoundryProxy;var o=e.constructors.Hashtable;var l=new o(i);var u=new o(i);var x=new o(i);var T={TextElement:t.textKeyForInitialText,Language:t.developmentLanguage,TextElementType:"XFLD",TextElementDescription:"",MaximumLength:10,Application:n,TranslationHint:""};function g(e,t){var n=l.getKeys();var a,i=n.length;var r=t.MaximumLength||10;var s=t.TranslationHint||"";var m;for(a=0;a<i;a++){m=l.getItem(n[a]);if(m.TextElementDescription===e&&m.MaximumLength===r&&m.TranslationHint===s){return n[a]}}return undefined}this.removeTexts=function(e,n,a){var i=[];var r,o;function u(t){var n;if(!t){for(n=0;n<o;n++){l.removeItem(e[n])}}a(t)}o=e.length;if(o===0){a(undefined);return}for(r=0;r<o;r++){if(e[r]===t.textKeyForInitialText){continue}i.push({method:"DELETE",entitySetName:"texts",inputParameters:[{name:"TextElement",value:e[r]},{name:"Language",value:t.developmentLanguage}]})}if(m){s.doChangeOperationsInBatch(i,u,n,true)}else{s.doChangeOperationsInBatch(i,u,n)}};this.isInitialTextKey=function(e){return e===t.textKeyForInitialText};this.addTextsAndSave=function(e,n,a){function i(e,t){return e.TextElement===t.TextElement&&e.TextElementDescription===t.TextElementDescription&&e.MaximumLength===t.MaximumLength&&e.Language===t.Language&&e.TranslationHint===t.TranslationHint}var r;var o=e.length;var u;var x=[];var T=[];var g=[];var p;for(r=0;r<o;r++){if(e[r]===t.textKeyForInitialText){continue}u=l.getItem(e[r].TextElement);if(u){if(!i(u,e[r])){x.push(e[r]);l.setItem(e[r].TextElement,e[r])}}else{T.push(e[r]);l.setItem(e[r].TextElement,e[r])}}o=x.length;for(r=0;r<o;r++){p=[{name:"TextElement",value:x[r].TextElement},{name:"Language",value:x[r].Language}];x[r].MaximumLength=parseInt(x[r].MaximumLength,10);g.push({method:"PUT",entitySetName:"texts",data:x[r],inputParameters:p})}o=T.length;for(r=0;r<o;r++){T[r].MaximumLength=parseInt(T[r].MaximumLength,10);g.push({method:"POST",entitySetName:"texts",data:T[r]})}if(g.length>0){if(m){s.doChangeOperationsInBatch(g,n,a,false)}else{s.doChangeOperationsInBatch(g,n,a)}}else{n(undefined)}};this.exportTexts=function(e){var a=r.renderHeaderOfTextPropertyFile(n,i);var s={TextElement:"AnalyticalConfigurationName",Language:t.developmentLanguage,TextElementType:"XTIT",TextElementDescription:e,MaximumLength:250,Application:n,TranslationHint:""};return a+r.renderTextEntries(l,i)+r.renderEntryOfTextPropertyFile(s,i)};this.get=function(e){var n,a;if(e===t.textKeyForInitialText){return T}if(l.hasItem(e)){return l.getItem(e)}if(u.hasItem(e)){n=u.getItem(e);if(n.TextElementDescription){return n}return l.getItem(n)}a=jQuery.extend({},true,T);a.TextElement=e;a.TextElementDescription=e;return a};this.getPersistentKey=function(e){return e};this.setTextAsPromise=function(e,a){var r;var m=jQuery.Deferred();var o=function(e,t,n){if(n){i.putMessage(n)}if(e){l.setItem(e.TextElement,e);r=e.TextElement}m.resolve(e&&e.TextElement)};var u={TextElement:"",Language:t.developmentLanguage,TextElementType:a.TextElementType,TextElementDescription:e,MaximumLength:a.MaximumLength||10,Application:n,TranslationHint:a.TranslationHint||""};if(!e){m.resolve(t.textKeyForInitialText)}r=g(e,a);if(r){m.resolve(r)}else{s.create("texts",u,o,true)}return m.promise()};this.getTextKeys=function(e){var t=l.getKeys();var n,a,i=t.length;var r=[];for(n=0;n<i;n++){a=l.getItem(t[n]);if(e&&a.TextElementType!==e){continue}if(x.hasItem(t[n])){r.push(x.getItem(t[n]))}else{r.push(t[n])}}return r};this.getTextsByTypeAndLength=function(e,t){var n=l.getKeys();var a,i,r=n.length;var s=[];for(a=0;a<r;a++){i=l.getItem(n[a]);if(i.TextElementType===e&&i.MaximumLength===t){if(x.hasItem(n[a])){s.push({TextElement:x.getItem(n[a]),TextElementDescription:i.TextElementDescription})}else{s.push({TextElement:n[a],TextElementDescription:i.TextElementDescription})}}}return s};function p(){var e,t;t=a.length;for(e=0;e<t;e++){if(a[e].TextElement){l.setItem(a[e].TextElement,a[e])}}}p()}i("sap.apf.modeler.core.TextPool",s);return s});
//# sourceMappingURL=textPool.js.map