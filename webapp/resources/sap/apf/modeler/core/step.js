/*!
 * SAP APF Analysis Path Framework
 *
 * (c) Copyright 2012-2014 SAP SE. All rights reserved
 */
sap.ui.define(["sap/apf/modeler/core/configurationObjects","sap/apf/utils/exportToGlobal","sap/ui/thirdparty/jquery"],function(e,t,jQuery){"use strict";function r(t,n,i){var o,s,p,a,u,c,f,l,g,h,d,y,v,m,P,b,T,E,F,S,C;T=n.instances.messageHandler;if(!i){o=new n.constructors.ElementContainer(t+"-Representation",n.constructors.Representation,n);s={};p=new n.constructors.ElementContainer("SelectProperty",undefined,n);a=new n.constructors.ElementContainer("FilterProperty",undefined,n);u={};c=new n.constructors.ElementContainer("SelectPropertyForFilterMapping",undefined,n);f=new n.constructors.ElementContainer("TargetPropertyForFilterMapping",undefined,n);g=false;l=new n.constructors.ElementContainer("NavigationTarget",undefined,n)}else{o=i.representationContainer;s=i.request;p=i.selectProperties;a=i.filterProperties;E=i.filterPropertyLabelKey;F=i.filterPropertyLabelDisplayOption;S=i.targetPropertyLabelKey;C=i.targetPropertyLabelDisplayOption;u=i.requestForFilterMapping;c=i.selectPropertiesForFilterMapping;f=i.targetPropertiesForFilterMapping;g=i.keepSourceForFilterMapping;l=i.navigationTargets;h=i.titleId;d=i.longTitleId;y=i.leftUpperCornerTextKey;v=i.rightUpperCornerTextKey;m=i.leftLowerCornerTextKey;P=i.rightLowerCornerTextKey;b=i.topNSettings}this.getType=function(){return"step"};this.getId=function(){return t};this.setTopN=function(e,t){if(t&&t instanceof Array&&t.length>0){this.resetTopN();b={};b.top=e;b.orderby=t}else{T.putMessage(T.createMessageObject({code:11016}));return}o.getElements().forEach(function(t){t.setTopN(e);b.orderby.forEach(function(e){t.addOrderbySpec(e.property,e.ascending)})})};this.setTopNValue=function(e){if(!b){b={}}b.top=e;if(b.orderby){L()}};this.setTopNSortProperties=function(e){if(!b){b={}}if(e&&e.length>0){e.forEach(function(e){if(e.ascending==="true"){e.ascending=true}})}b.orderby=e;if(b.top){L()}};function L(){o.getElements().forEach(function(e){e.setTopN(b.top);e.removeAllOrderbySpecs();b.orderby.forEach(function(t){e.addOrderbySpec(t.property,t.ascending)})})}this.getTopN=function(){if(b&&b.top>0){if(Array.isArray(b.orderby)){var e=this.getSelectProperties();var t;for(t=b.orderby.length-1;t>=0;t--){if(!e.includes(b.orderby[t].property)){b.orderby.splice(t,1);L()}}}return jQuery.extend({},true,b)}};this.resetTopN=function(){b=undefined;o.getElements().forEach(function(e){if(e.getTopN()){e.setTopN(undefined)}})};this.getService=function(){return s.service};this.setService=function(e){s.service=e};this.getEntitySet=function(){return s.entitySet};this.setEntitySet=function(e){s.entitySet=e};this.setTitleId=function(e){h=e};this.getTitleId=function(){return h};this.setLongTitleId=function(e){d=e};this.getLongTitleId=function(){return d};this.getSelectProperties=function(){var e=[];var t=p.getElements();t.forEach(function(t){e.push(t.getId())});return e};this.addSelectProperty=function(e){p.createElementWithProposedId(undefined,e)};this.removeSelectProperty=function(e){p.removeElement(e)};this.getFilterProperties=function(){var e=[];var t=a.getElements();t.forEach(function(t){e.push(t.getId())});return e};this.addFilterProperty=function(e){E=undefined;F=undefined;return a.createElementWithProposedId(undefined,e).getId()};this.removeFilterProperty=function(e){E=undefined;F=undefined;a.removeElement(e)};this.setFilterPropertyLabelKey=function(e){E=e};this.getFilterPropertyLabelKey=function(){return E};this.setFilterPropertyLabelDisplayOption=function(e){F=e};this.getFilterPropertyLabelDisplayOption=function(){return F};this.setFilterMappingService=function(e){u.service=e};this.getFilterMappingService=function(){return u.service};this.setFilterMappingEntitySet=function(e){u.entitySet=e};this.getFilterMappingEntitySet=function(){return u.entitySet};this.addFilterMappingTargetProperty=function(e){S=undefined;C=undefined;f.createElementWithProposedId(undefined,e)};this.getFilterMappingTargetProperties=function(){var e=[];var t=f.getElements();t.forEach(function(t){e.push(t.getId())});return e};this.removeFilterMappingTargetProperty=function(e){S=undefined;C=undefined;f.removeElement(e)};this.setFilterMappingTargetPropertyLabelKey=function(e){S=e};this.getFilterMappingTargetPropertyLabelKey=function(){return S};this.setFilterMappingTargetPropertyLabelDisplayOption=function(e){C=e};this.getFilterMappingTargetPropertyLabelDisplayOption=function(){return C};this.addNavigationTarget=function(e){l.createElementWithProposedId(undefined,e)};this.getNavigationTargets=function(){var e=[];var t=l.getElements();t.forEach(function(t){e.push(t.getId())});return e};this.removeNavigationTarget=function(e){l.removeElement(e)};this.setFilterMappingKeepSource=function(e){g=e};this.getFilterMappingKeepSource=function(){return g};this.getRepresentations=o.getElements;this.getRepresentation=o.getElement;this.createRepresentation=function(e){var t;if(e&&e.id){t=o.createElementWithProposedId(e,e.id)}else{t=o.createElement(e)}if(b&&b.top){t.setTopN(b.top);b.orderby.forEach(function(e){t.addOrderbySpec(e.property,e.ascending)})}return t};this.removeRepresentation=o.removeElement;this.copyRepresentation=o.copyElement;this.moveRepresentationBefore=function(e,t){return o.moveBefore(e,t)};this.moveRepresentationUpOrDown=function(e,t){return o.moveUpOrDown(e,t)};this.moveRepresentationToEnd=function(e){return o.moveToEnd(e)};this.setLeftUpperCornerTextKey=function(e){y=e};this.getLeftUpperCornerTextKey=function(){return y};this.setRightUpperCornerTextKey=function(e){v=e};this.getRightUpperCornerTextKey=function(){return v};this.setLeftLowerCornerTextKey=function(e){m=e};this.getLeftLowerCornerTextKey=function(){return m};this.setRightLowerCornerTextKey=function(e){P=e};this.getRightLowerCornerTextKey=function(){return P};this.getConsumablePropertiesForTopN=function(){var e=jQuery.Deferred();this.getAvailableProperties().done(function(t){var r=[];if(b&&b.orderby&&b.orderby.length>0){b.orderby.forEach(function(e){r.push(e.property)})}e.resolve({available:t,consumable:this.getConsumableProperties(t,r)})}.bind(this));return e.promise()};this.getConsumablePropertiesForRepresentation=function(e){var t=jQuery.Deferred();function r(e){var t=[];jQuery.merge(t,e.getDimensions());jQuery.merge(t,e.getMeasures());jQuery.merge(t,e.getProperties());return t}this.getAvailableProperties().done(function(n){if(this.getHierarchyProperty&&this.getHierarchyProperty()){n.push(this.getHierarchyProperty())}var i=[];var s=o.getElement(e);if(s){i=r(s);if(s.getHierarchyProperty){i.push(s.getHierarchyProperty())}}else{i=this.getSelectProperties()}t.resolve({available:n,consumable:this.getConsumableProperties(n,i)})}.bind(this));return t.promise()};this.getConsumableSortPropertiesForRepresentation=function(e){var t=jQuery.Deferred();this.getAvailableProperties().done(function(r){t.resolve({available:r,consumable:this.getConsumableProperties(r,this.getSortPropertiesFromRepresentation(e))})}.bind(this));return t.promise()};this.getSortPropertiesFromRepresentation=function(e){var t=[];var r=o.getElement(e);var n=r.getOrderbySpecifications();n.forEach(function(e){t.push(e.property)});return t};this.getConsumableProperties=function(e,t){var r=[];e.forEach(function(e){if(!t?.includes(e)){r.push(e)}});return r};this.getAvailableProperties=function(){var e=jQuery.Deferred();var t=[];if(s.service&&s.entitySet){n.instances.metadataFactory.getMetadata(s.service).then(function(r){if(r){var n=r.getAllPropertiesOfEntitySet(s.entitySet);var i=this.getSelectProperties();i.forEach(function(e){if(n.includes(e)){t.push(e)}})}e.resolve(t)}.bind(this),function(){e.resolve([])})}else{e.resolve([])}return e.promise()};this.copy=function(t){var i=e.deepDataCopy(this.getDataForCopy());i.representationContainer=o.copy((t||this.getId())+"-Representation");return new r(t||this.getId(),n,i)};this.getDataForCopy=function(){return{request:s,selectProperties:p,filterProperties:a,filterPropertyLabelKey:E,filterPropertyLabelDisplayOption:F,requestForFilterMapping:u,selectPropertiesForFilterMapping:c,targetPropertiesForFilterMapping:f,targetPropertyLabelKey:S,targetPropertyLabelDisplayOption:C,navigationTargets:l,keepSourceForFilterMapping:g,titleId:h,longTitleId:d,leftUpperCornerTextKey:y,rightUpperCornerTextKey:v,leftLowerCornerTextKey:m,rightLowerCornerTextKey:P,topNSettings:b}};this.getRepresentationContainer=function(){return o}}t("sap.apf.modeler.core.Step",r);return r});
//# sourceMappingURL=step.js.map