/*!
 * SAP APF Analysis Path Framework
 *
 * (c) Copyright 2012-2014 SAP AG. All rights reserved
 */
sap.ui.define(["sap/apf/core/constants","sap/apf/modeler/ui/controller/requestOptions","sap/apf/modeler/ui/utils/constants","sap/apf/modeler/ui/utils/displayOptionsValueBuilder","sap/apf/modeler/ui/utils/nullObjectChecker","sap/apf/modeler/ui/utils/textManipulator","sap/apf/modeler/ui/utils/textPoolHelper","sap/ui/thirdparty/jquery"],function(e,t,i,r,a,n,l,jQuery){"use strict";var o=l.TranslationFormatMap.STEPFILTERPROPERTY_LABEL;function d(e){var t=e.getView().getViewData().oTextReader;var i=e.oParentObject.getFilterMappingTargetPropertyLabelKey()?t("label"):t("label")+" ("+t("default")+")";e.byId("idOptionalSelectedPropertyLabel").setText(i);e.byId("idOptionalSelectedPropertyLabel").setTooltip(i)}function s(e){var t=e.getSource();var i=e.getEntity();var r;var n=e.oParentObject.getFilterMappingTargetPropertyLabelKey();if(t===undefined||i===undefined){return}if(a.checkIsNotUndefined(n)){r=e.getView().getViewData().oConfigurationHandler.getTextPool().get(n).TextElementDescription;e.byId("idOptionalSelectedPropertyLabelText").setValue(r);return}e.oStepPropertyMetadataHandler.getFilterMappingEntityTypeMetadataAsPromise(t,i).done(function(t){var i=e.oParentObject.getFilterMappingTargetProperties()[0];if(i){r=e.oStepPropertyMetadataHandler.getDefaultLabel(t,i)}e.byId("idOptionalSelectedPropertyLabelText").setValue(r)})}function p(e){e.byId("idOptionalRequestFieldLabel").addStyleClass("filterPropertyLable");e.byId("idOptionalRequestField").addStyleClass("filterProperty");e.byId("idOptionalLabelDisplayOptionType").addStyleClass("filterProperty")}var u=t.extend("sap.apf.modeler.ui.controller.stepFilterMapping",{setLabelDisplayOptionTypeAsPromise:function(t){var a=jQuery.Deferred();var l=this;var o=l.getSource();var p=l.getEntity();var u=[];var y=l.getView().getViewData().oTextReader;var c=new r(y,t);var g=c.getLabelDisplayOptions();var b=e.representationMetadata.labelDisplayOptions;var f=n.removePrefixText(l.byId("idOptionalRequestField").getSelectedKey(),y(i.texts.NOTAVAILABLE));d(l);s(l);l.byId("idOptionalLabelDisplayOptionType").setEnabled(true);if(!f){l.byId("idOptionalLabelDisplayOptionType").setModel(g);l.byId("idOptionalLabelDisplayOptionType").setEnabled(false);return a.promise()}var P=l.oParentObject.getFilterMappingTargetPropertyLabelDisplayOption();l.oStepPropertyMetadataHandler.getFilterMappingEntityTypeMetadataAsPromise(o,p).done(function(e){if((P===b.KEY_AND_TEXT||P===b.TEXT)&&!e.getPropertyMetadata(f).text){g=c.getValidatedLabelDisplayOptions();u=n.addPrefixText([P],y);P=u[0]}l.byId("idOptionalLabelDisplayOptionType").setModel(g);l.byId("idOptionalLabelDisplayOptionType").setSelectedKey(P);a.resolve()});return a.promise()},enableDisableLabelDisplayOptionTypeAsPromise:function(){var e=this;var t=e.getSource();var r=e.getEntity();var a=jQuery.Deferred();var l=e.getView().getViewData().oTextReader;var o=e.byId("idOptionalLabelDisplayOptionType");var d=n.removePrefixText(e.byId("idOptionalRequestField").getSelectedKey(),l(i.texts.NOTAVAILABLE));e.oStepPropertyMetadataHandler.getFilterMappingEntityTypeMetadataAsPromise(t,r).done(function(e){var t=e.getPropertyMetadata(d).text;o.getItems().forEach(function(e){e.setEnabled(true);if(e.getKey()!=="key"&&!t){e.setEnabled(false)}});a.resolve()});return a.promise()},changeLabelDisplayOption:function(e){var t=this;t.oParentObject.setFilterMappingTargetPropertyLabelDisplayOption(e)},changeOptionalSelectedPropertyLabelText:function(e){var t=this;if(e.trim().length===0){t.oParentObject.setFilterMappingTargetPropertyLabelKey(undefined);d(t);s(t);return}t.getView().getViewData().oConfigurationHandler.getTextPool().setTextAsPromise(e,o).done(function(e){t.oParentObject.setFilterMappingTargetPropertyLabelKey(e);d(t);s(t)})},onBeforeRendering:function(){var e=this;e.byId("idSelectPropertiesLabel").setVisible(false);e.byId("idSelectProperties").setVisible(false);e.byId("idOptionalRequestFieldLabel").setVisible(true);e.byId("idOptionalRequestField").setVisible(true);e.byId("idOptionalLabelDisplayOptionType").setVisible(true);e.byId("idOptionalRequestField").setForceSelection(false);e.byId("idOptionalSelectedPropertyLabel").setVisible(true);e.byId("idOptionalSelectedPropertyLabelText").setVisible(true)},onAfterRendering:function(){p(this)},getIdOfPropertiesControl:function(){return"idOptionalRequestField"},getIdOfPropertyLabel:function(){return"idOptionalRequestFieldLabel"},setSelectedKeysForProperties:function(e){var t=this;if(e.length!==0){t.byId("idOptionalRequestField").setSelectedKey(e[0])}else{t.byId("idOptionalRequestField").clearSelection()}},getSelectedKeysForProperties:function(){var e=this,t,r;var l=e.getView().getViewData().oTextReader;t=n.removePrefixText(e.byId("idOptionalRequestField").getSelectedKey(),l(i.texts.NOTAVAILABLE));r=a.checkIsNotNullOrUndefinedOrBlank(t)?[t]:[];return r},setDisplayText:function(){var e=this;var t=e.getView().getViewData().oTextReader;e.byId("idSourceLabel").setText(t("source"));e.byId("idEntityLabel").setText(t("entity"));e.byId("idOptionalRequestFieldLabel").setText(t("targetProperty"))},resetEntityAndProperties:function(){var e=this;e.clearEntity();e.byId("idEntity").setModel(null);e.byId("idEntity").setSelectedKey(undefined);e.clearSelectProperties();e.byId("idOptionalRequestField").setModel(null);e.byId("idOptionalRequestField").setSelectedKey(undefined)},resetFilterMappingFields:function(){var e=this;e.clearSource();e.byId("idSource").setValue("");e.resetEntityAndProperties();e.addOrRemoveMandatoryFieldsAndRequiredFlag(false)},updateFilterMappingFields:function(){var e=this,t,r,l,o,d;var s=e.getView().getViewData().oTextReader;t=e.byId("idSource").getValue().trim();e.oConfigurationEditor.setIsUnsaved();if(a.checkIsNotNullOrUndefinedOrBlank(t)){e.getAllEntitiesAsPromise(t).done(function(t){if(!a.checkIsNotNullOrUndefinedOrBlank(t)){e.resetEntityAndProperties();return}e.setDetailData();r=n.removePrefixText(e.byId("idEntity").getSelectedKey(),s(i.texts.NOTAVAILABLE));l=a.checkIsNotNullOrUndefinedOrBlank(r)?r:undefined;e.updateEntity(l);o=n.removePrefixText(e.byId("idOptionalRequestField").getSelectedKey(),s(i.texts.NOTAVAILABLE));d=a.checkIsNotNullOrUndefinedOrBlank(o)?[o]:[];e.updateSelectProperties(d)})}},getSource:function(){var e=this;return e.oParentObject.getFilterMappingService()},getAllEntitiesAsPromise:function(e){var t=this;return t.oConfigurationEditor.getAllEntitySetsOfServiceWithGivenPropertiesAsPromise(e,t.oParentObject.getFilterProperties())},getEntity:function(){var e=this;return e.oParentObject.getFilterMappingEntitySet()},getAllEntitySetPropertiesAsPromise:function(e,t){var i=this;return i.oConfigurationEditor.getAllPropertiesOfEntitySetAsPromise(e,t)},clearSource:function(){var e=this;e.oParentObject.setFilterMappingService(undefined);e.clearEntity()},clearEntity:function(){var e=this;e.oParentObject.setFilterMappingEntitySet(undefined);e.clearSelectProperties()},clearSelectProperties:function(){var e=this;var t=e.oParentObject.getFilterMappingTargetProperties();t.forEach(function(t){e.oParentObject.removeFilterMappingTargetProperty(t)});e.byId("idOptionalSelectedPropertyLabelText").setValue("")},removeSelectProperties:function(e){var t=this;e.forEach(function(e){t.oParentObject.removeFilterMappingTargetProperty(e)})},updateSource:function(e){var t=this;t.oParentObject.setFilterMappingService(e)},updateEntity:function(e){var t=this;t.oParentObject.setFilterMappingEntitySet(e)},updateSelectProperties:function(e){var t=this;t.removeSelectProperties(t.oParentObject.getFilterMappingTargetProperties());e.forEach(function(e){t.oParentObject.addFilterMappingTargetProperty(e)})},updateOptionalRequestFieldProperty:function(e){var t=this;t.updateSelectProperties(e)},getSelectProperties:function(){var e=this;return e.oParentObject.getFilterMappingTargetProperties()},getValidationState:function(){var e=this;return e.viewValidator.getValidationState()}});return u},true);
//# sourceMappingURL=stepFilterMapping.controller.js.map