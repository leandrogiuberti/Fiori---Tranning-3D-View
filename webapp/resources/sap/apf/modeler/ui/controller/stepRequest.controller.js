sap.ui.define(["sap/apf/core/constants","sap/apf/modeler/ui/controller/requestOptions","sap/apf/modeler/ui/utils/constants","sap/apf/modeler/ui/utils/displayOptionsValueBuilder","sap/apf/modeler/ui/utils/nullObjectChecker","sap/apf/modeler/ui/utils/optionsValueModelBuilder","sap/apf/modeler/ui/utils/textManipulator","sap/apf/modeler/ui/utils/textPoolHelper","sap/ui/thirdparty/jquery"],function(e,t,r,i,a,o,n,l,jQuery){"use strict";var s=l.TranslationFormatMap.STEPFILTERPROPERTY_LABEL;function d(e){var t=e.getView().getViewData().oTextReader;var r=e.oParentObject.getFilterPropertyLabelKey()?t("label"):t("label")+" ("+t("default")+")";e.byId("idOptionalSelectedPropertyLabel").setText(r);e.byId("idOptionalSelectedPropertyLabel").setTooltip(r)}function p(e){var t=jQuery.Deferred();var r;var i=e.oParentObject.getFilterPropertyLabelKey();if(!e.getSource()||!e.getEntity()){return t.resolve()}if(a.checkIsNotUndefined(i)){r=e.getView().getViewData().oConfigurationHandler.getTextPool().get(i).TextElementDescription;e.byId("idOptionalSelectedPropertyLabelText").setValue(r);return t.resolve()}e.oStepPropertyMetadataHandler.getEntityTypeMetadataAsPromise().done(function(i){var a=e.oParentObject.getFilterProperties()[0];if(e.oParentObject.getType()==="hierarchicalStep"&&a){a=e.oStepPropertyMetadataHandler.getPropertyMetadata(i,a)["hierarchy-node-for"]}if(a){r=e.oStepPropertyMetadataHandler.getDefaultLabel(i,a)}e.byId("idOptionalSelectedPropertyLabelText").setValue(r);t.resolve()});return t}function c(e){e.byId("idOptionalRequestFieldLabel").addStyleClass("filterPropertyLable");e.byId("idOptionalRequestField").addStyleClass("filterProperty");e.byId("idOptionalLabelDisplayOptionType").addStyleClass("filterProperty")}return t.extend("sap.apf.modeler.ui.controller.stepRequest",{setLabelDisplayOptionTypeAsPromise:function(t){var a=jQuery.Deferred();var o,l,s,c,y,u=this,P=[];var b=u.getView().getViewData().oTextReader;o=new i(b,t);s=o.getLabelDisplayOptions();l=e.representationMetadata.labelDisplayOptions;c=n.removePrefixText(u.byId("idOptionalRequestField").getSelectedKey(),b(r.texts.NOTAVAILABLE));d(u);p(u).done(function(){u.byId("idOptionalLabelDisplayOptionType").setEnabled(true);if(c===b("none")){u.byId("idOptionalLabelDisplayOptionType").setModel(s);u.byId("idOptionalLabelDisplayOptionType").setEnabled(false);return a.promise()}y=u.oParentObject.getFilterPropertyLabelDisplayOption();u.oStepPropertyMetadataHandler.getEntityTypeMetadataAsPromise().done(function(e){if((y===l.KEY_AND_TEXT||y===l.TEXT)&&!u.oStepPropertyMetadataHandler.hasTextPropertyOfDimension(e,c)){s=o.getValidatedLabelDisplayOptions();P=n.addPrefixText([y],b);y=P[0]}u.byId("idOptionalLabelDisplayOptionType").setModel(s);u.byId("idOptionalLabelDisplayOptionType").setSelectedKey(y);a.resolve()})});return a.promise()},enableDisableLabelDisplayOptionTypeAsPromise:function(){var e,t=this;var i=jQuery.Deferred();var a=t.getView().getViewData().oTextReader;var o=t.byId("idOptionalLabelDisplayOptionType");var l=n.removePrefixText(t.byId("idOptionalRequestField").getSelectedKey(),a(r.texts.NOTAVAILABLE));t.oStepPropertyMetadataHandler.getEntityTypeMetadataAsPromise().done(function(r){var a=t.oStepPropertyMetadataHandler.hasTextPropertyOfDimension(r,l);for(e=0;e<o.getItems().length;e++){o.getItems()[e].setEnabled(true);if(e>0&&!a){o.getItems()[e].setEnabled(false)}}i.resolve()});return i.promise()},onBeforeRendering:function(){var e=this;e.byId("idOptionalRequestFieldLabel").setVisible(true);e.byId("idOptionalRequestField").setVisible(true);e.byId("idOptionalLabelDisplayOptionType").setVisible(true);e.byId("idOptionalSelectedPropertyLabel").setVisible(true);e.byId("idOptionalSelectedPropertyLabelText").setVisible(true)},onAfterRendering:function(){var e=this;e.addOrRemoveMandatoryFieldsAndRequiredFlag(true);c(e)},setDisplayText:function(){var e=this;var t=e.getView().getViewData().oTextReader;e.byId("idSourceLabel").setText(t("source"));e.byId("idEntityLabel").setText(t("entity"));e.byId("idSelectPropertiesLabel").setText(t("selectProperties"));e.byId("idOptionalRequestFieldLabel").setText(t("requiredFilters"))},setOptionalRequestFieldProperty:function(){var e=this;var t,r,i,n,l,s=[];var d=e.oParentObject.getFilterProperties();l=[e.getView().getViewData().oTextReader("none")];t=e.byId("idSelectProperties").getSelectedKeys();r=e.oParentObject.getSelectProperties();r.forEach(function(e){if(e===d[0]){i=true}});if(!i&&d.length>0){e.removeOptionalRequestFieldProperty(d);d=e.oParentObject.getFilterProperties()}n=o.convert(l.concat(t));e.byId("idOptionalRequestField").setModel(n);e.byId("idOptionalRequestField").setSelectedKey(l[0]);if(a.checkIsNotNullOrUndefinedOrBlank(d)){s=e.validateSelectedValues(e,d,t);d=s.aSelectedValues;e.byId("idOptionalRequestField").setSelectedKey(d[0])}},addOrRemoveMandatoryFieldsAndRequiredFlag:function(e){var t=this;if(e===false){return}t.byId("idSourceLabel").setRequired(e);t.byId("idEntityLabel").setRequired(e);t.byId("idSelectPropertiesLabel").setRequired(e);t.viewValidator.addFields(["idSource","idEntity","idSelectProperties"])},fireRelevantEvents:function(e){var t=this,i,o;if(e.getSource()!==t.byId("idOptionalRequestField")){i=[n.removePrefixText(t.byId("idOptionalRequestField").getSelectedKey(),t.getView().getViewData().oTextReader(r.texts.NOTAVAILABLE))];if(a.checkIsNotNullOrUndefinedOrBlank(i)){t.updateOptionalRequestFieldProperty(i)}if(t.getSelectProperties().length===0){t.oParentObject.resetTopN()}t.getView().fireEvent(r.events.step.SETDATAREDUCTIONSECTION)}if(e.getSource()===t.byId("idOptionalProperty")){t.setOptionalRequestFieldProperty()}o=t.byId("idOptionalRequestField").getSelectedKey()!==t.getView().getViewData().oTextReader("none")?true:false;t.getView().fireEvent(r.events.step.SETVISIBILITYOFFILTERMAPPINGFIELDS,{bShowFilterMappingLayout:o});t.getView().fireEvent(r.events.step.UPDATEFILTERMAPPINGFIELDS)},getSource:function(){return this.oParentObject.getService()},getAllEntitiesAsPromise:function(e){return this.oConfigurationEditor.getAllEntitySetsOfServiceAsPromise(e)},getEntity:function(){return this.oParentObject.getEntitySet()},getAllEntitySetPropertiesAsPromise:function(e,t){return this.oConfigurationEditor.getAllPropertiesOfEntitySetAsPromise(e,t)},changeLabelDisplayOption:function(e){var t=this;t.oParentObject.setFilterPropertyLabelDisplayOption(e)},changeOptionalSelectedPropertyLabelText:function(e){var t=this;if(e.trim().length===0){t.oParentObject.setFilterPropertyLabelKey(undefined);d(t);p(t);return}t.getView().getViewData().oConfigurationHandler.getTextPool().setTextAsPromise(e,s).done(function(e){t.oParentObject.setFilterPropertyLabelKey(e);d(t);p(t)})},resetEntityAndProperties:function(){var e=this;e.clearEntity();e.byId("idEntity").setModel(null);e.byId("idEntity").setSelectedKey(undefined);e.clearSelectProperties();e.byId("idSelectProperties").setModel(null);e.byId("idSelectProperties").setSelectedKeys([]);e.byId("idOptionalRequestField").setModel(null);e.byId("idOptionalRequestField").setSelectedKey(undefined)},clearSource:function(){var e=this;e.oParentObject.setService(undefined);e.clearEntity()},clearEntity:function(){var e=this;e.oParentObject.setEntitySet(undefined);e.clearSelectProperties()},clearSelectProperties:function(){var e=this;var t=e.oParentObject.getSelectProperties();t.forEach(function(t){e.oParentObject.removeSelectProperty(t)});e.clearOptionalRequestFieldProperty()},clearOptionalRequestFieldProperty:function(){var e=this;var t=e.oParentObject.getFilterProperties();t.forEach(function(t){e.oParentObject.removeFilterProperty(t)})},removeSelectProperties:function(e){var t=this;e.forEach(function(e){t.oParentObject.removeSelectProperty(e)})},removeOptionalRequestFieldProperty:function(e){var t=this;e.forEach(function(e){t.oParentObject.removeFilterProperty(e)})},updateSource:function(e){var t=this;t.oParentObject.setService(e)},updateEntity:function(e){var t=this;t.oParentObject.setEntitySet(e)},updateSelectProperties:function(e){var t=this;t.removeSelectProperties(t.oParentObject.getSelectProperties());e.forEach(function(e){t.oParentObject.addSelectProperty(e)})},updateOptionalRequestFieldProperty:function(e){var t=this;var r=t.oParentObject.getFilterPropertyLabelKey();var i=t.oParentObject.getFilterPropertyLabelDisplayOption();var a=t.oParentObject.getFilterProperties();t.removeOptionalRequestFieldProperty(t.oParentObject.getFilterProperties());e.forEach(function(e){if(e!==t.getView().getViewData().oTextReader("none")){t.oParentObject.addFilterProperty(e);if(e===a[0]){t.oParentObject.setFilterPropertyLabelKey(r);t.oParentObject.setFilterPropertyLabelDisplayOption(i)}}})},getSelectProperties:function(){var e=this;return e.oParentObject.getSelectProperties()},getOptionalRequestFieldProperty:function(){var e=this;return e.oParentObject.getFilterProperties()},getValidationState:function(){var e=this;return e.viewValidator.getValidationState()}})});
//# sourceMappingURL=stepRequest.controller.js.map