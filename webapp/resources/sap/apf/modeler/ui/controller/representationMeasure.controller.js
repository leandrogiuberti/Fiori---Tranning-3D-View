/*!
 * SAP APF Analysis Path Framework
 *
 * (c) Copyright 2012-2014 SAP AG. All rights reserved
 */
sap.ui.define(["sap/apf/modeler/ui/controller/propertyType","sap/apf/modeler/ui/utils/constants","sap/apf/modeler/ui/utils/displayOptionsValueBuilder","sap/apf/modeler/ui/utils/textManipulator","sap/apf/core/constants","sap/apf/utils/utils"],function(e,t,a,r,o,n){"use strict";return e.extend("sap.apf.modeler.ui.controller.representationMeasure",{setLabelDisplayOptionTypeAsPromise:function(e){var t=this;var r=t.getView().getViewData().oPropertyTypeData.sProperty;if(!t.oRepresentationTypeHandler.isCombinationChart(t.oRepresentation.getRepresentationType())){if(t.byId("idLabelDisplayOptionType")){t.byId("idLabelDisplayOptionType").destroy();t.byId("idPropertyTypeLayout").setSpan("L4 M4 S4");t.oRepresentation.setMeasureDisplayOption(r,undefined)}}else{var n=new a(t.oTextReader,e);var i=n.getMeasureDisplayOptions();t.byId("idLabelDisplayOptionType").setModel(i);var s=t.oRepresentation.getMeasureDisplayOption(r);if(!s){var p=t.getView().getViewData().oPropertyTypeData.bMandatory?o.representationMetadata.measureDisplayOptions.BAR:o.representationMetadata.measureDisplayOptions.LINE;t.byId("idLabelDisplayOptionType").setSelectedKey(p);t.oRepresentation.setMeasureDisplayOption(r,p)}else{t.byId("idLabelDisplayOptionType").setSelectedKey(s)}}return jQuery.Deferred().resolve()},changeLabelDisplayOption:function(e){var t=this;var a=t.getView().getViewData().oPropertyTypeData.sProperty;t.oRepresentation.setMeasureDisplayOption(a,e)},getAllPropertiesAsPromise:function(){var e=this,a,o,n,i,s=[];var p=e.oStepPropertyMetadataHandler.oStep;var y=t;var d=jQuery.Deferred();e.oStepPropertyMetadataHandler.getEntityTypeMetadataAsPromise().done(function(t){p.getConsumablePropertiesForRepresentation(e.oRepresentation.getId()).done(function(p){a=p.consumable;a.forEach(function(a){if(e.oStepPropertyMetadataHandler.getPropertyMetadata(t,a)){i=e.oStepPropertyMetadataHandler.getPropertyMetadata(t,a)["aggregation-role"];if(i===y.aggregationRoles.MEASURE){s.push(a)}}});o=e.getSelectedProperty();if(o!==undefined){n=s.indexOf(o)!==-1?s:s.concat(o);s=p.available.indexOf(o)!==-1?n:s.concat(r.addPrefixText([o],e.oTextReader));o=p.available.indexOf(o)!==-1?o:r.addPrefixText([o],e.oTextReader)[0]}d.resolve({aAllProperties:s,sSelectedKey:o})})});return d.promise()},getPropertyTextLabelKey:function(e){var t=this;return t.oRepresentation.getMeasureTextLabelKey(e)},updatePropertiesInConfiguration:function(e){var t=this;t.oRepresentation.getMeasures().forEach(function(e){t.oRepresentation.removeMeasure(e)});e.forEach(function(e){t.oRepresentation.addMeasure(e.sProperty);t.oRepresentation.setMeasureKind(e.sProperty,e.sKind);t.oRepresentation.setMeasureTextLabelKey(e.sProperty,e.sTextLabelKey);t.oRepresentation.setMeasureDisplayOption(e.sProperty,e.sMeasureDisplayOption)})},createNewPropertyInfoAsPromise:function(e){var t=this,a={};a.sProperty=e;a.sKind=t.getView().getViewData().oPropertyTypeData.sContext;a.sTextLabelKey=undefined;return n.createPromise(a)},setPropertyTextLabelKey:function(e,t){var a=this;a.oRepresentation.setMeasureTextLabelKey(e,t)},setNextPropertyInParentObject:function(){var e=this;e.updateOfConfigurationObjectAsPromise().then(function(){e.setDetailData()})},removePropertyFromParentObject:function(){var e=this;e.oRepresentation.removeMeasure(r.removePrefixText(e.byId("idPropertyType").getSelectedKey(),e.oTextReader(t.texts.NOTAVAILABLE)))},addPropertyAsPromise:function(){var e=jQuery.Deferred();var a=this,r,o=[];var n=a.oStepPropertyMetadataHandler.oStep;var i=t;a.oStepPropertyMetadataHandler.getEntityTypeMetadataAsPromise().done(function(t){n.getConsumablePropertiesForRepresentation(a.oRepresentation.getId()).done(function(n){n.consumable.forEach(function(e){if(a.oStepPropertyMetadataHandler.getPropertyMetadata(t,e)){r=a.oStepPropertyMetadataHandler.getPropertyMetadata(t,e)["aggregation-role"];if(r===i.aggregationRoles.MEASURE){o.push(e)}}});a.getView().fireEvent(i.events.ADDPROPERTY,{sProperty:o[0],sContext:a.getView().getViewData().oPropertyTypeData.sContext});a.oConfigurationEditor.setIsUnsaved();e.resolve()})});return e.promise()}})});
//# sourceMappingURL=representationMeasure.controller.js.map