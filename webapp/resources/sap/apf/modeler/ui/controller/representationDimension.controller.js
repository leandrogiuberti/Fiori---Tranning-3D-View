/*!
 * SAP APF Analysis Path Framework
 *
 * (c) Copyright 2012-2018 SAP SE. All rights reserved
 */
sap.ui.define(["sap/apf/core/constants","sap/apf/modeler/ui/controller/propertyType","sap/apf/modeler/ui/utils/constants","sap/apf/modeler/ui/utils/displayOptionsValueBuilder","sap/apf/modeler/ui/utils/propertyTypeOrchestration","sap/apf/modeler/ui/utils/textManipulator"],function(e,t,r,a,o,n){"use strict";var i=e.representationMetadata;return t.extend("sap.apf.modeler.ui.controller.representationDimension",{_apfName:"representationDimension",setLabelDisplayOptionTypeAsPromise:function(t){var o=this;var i=jQuery.Deferred();var s=[];var p=new a(o.oTextReader,t);var d=e.representationMetadata.labelDisplayOptions;var y=n.removePrefixText(o.byId("idPropertyType").getSelectedKey(),o.oTextReader(r.texts.NOTAVAILABLE));var l=o.oRepresentation.getLabelDisplayOption(y);var P=p.getLabelDisplayOptions();o.oStepPropertyMetadataHandler.getEntityTypeMetadataAsPromise().done(function(e){if((l===d.KEY_AND_TEXT||l===d.TEXT)&&!o.oStepPropertyMetadataHandler.hasTextPropertyOfDimension(e,y)){P=p.getValidatedLabelDisplayOptions();s=n.addPrefixText([l],o.oTextReader);l=s[0]}o.byId("idLabelDisplayOptionType").setModel(P);o.byId("idLabelDisplayOptionType").setSelectedKey(l);i.resolve()});return i.promise()},getAllPropertiesAsPromise:function(){var e=this;var t=e.oStepPropertyMetadataHandler.oStep;var a=jQuery.Deferred();e.oStepPropertyMetadataHandler.getEntityTypeMetadataAsPromise().done(function(i){var s=[];t.getConsumablePropertiesForRepresentation(e.oRepresentation.getId()).done(function(t){var p=t.consumable;p.forEach(function(t){var a;if(e.oStepPropertyMetadataHandler.getPropertyMetadata(i,t)){a=e.oStepPropertyMetadataHandler.getPropertyMetadata(i,t)["aggregation-role"];if(a===r.aggregationRoles.DIMENSION){s.push(t)}}});var d=e.getSelectedProperty();a.resolve(o.getPropertyListAndSelectedKey(s,d,e,t,n.addPrefixText))})});return a.promise()},getPropertyTextLabelKey:function(e){var t=this;return t.oRepresentation.getDimensionTextLabelKey(e)},removeProperties:function(){var e=this;e.getView().getViewData().oRepresentationHandler.getActualDimensions().forEach(function(t){e.oRepresentation.removeDimension(t.sProperty)})},updatePropertiesInConfiguration:function(e){var t=this;t.removeProperties();e.forEach(function(e){t.oRepresentation.addDimension(e.sProperty);t.oRepresentation.setDimensionKind(e.sProperty,e.sKind);t.oRepresentation.setLabelDisplayOption(e.sProperty,e.sLabelDisplayOption);t.oRepresentation.setDimensionTextLabelKey(e.sProperty,e.sTextLabelKey)})},createNewPropertyInfoAsPromise:function(e){var t=jQuery.Deferred();var r=this,a={};r.oStepPropertyMetadataHandler.getEntityTypeMetadataAsPromise().done(function(o){var n=r.oStepPropertyMetadataHandler.hasTextPropertyOfDimension(o,e);a.sProperty=e;a.sKind=r.getView().getViewData().oPropertyTypeData.sContext;a.sLabelDisplayOption=n?i.labelDisplayOptions.KEY_AND_TEXT:i.labelDisplayOptions.KEY;a.sTextLabelKey=undefined;t.resolve(a)});return t.promise()},setPropertyTextLabelKey:function(e,t){var r=this;r.oRepresentation.setDimensionTextLabelKey(e,t)},setNextPropertyInParentObject:function(){var e=this;e.updateOfConfigurationObjectAsPromise().then(function(){e.setDetailData()})},enableDisableLabelDisplayOptionTypeAsPromise:function(){var e,t=this;var a=jQuery.Deferred();var o=t.byId("idLabelDisplayOptionType");var i=n.removePrefixText(t.byId("idPropertyType").getSelectedKey(),t.oTextReader(r.texts.NOTAVAILABLE));t.oStepPropertyMetadataHandler.getEntityTypeMetadataAsPromise().done(function(r){var n=t.oStepPropertyMetadataHandler.hasTextPropertyOfDimension(r,i);if(i===t.oTextReader("none")){o.setEnabled(false);a.resolve()}else{o.setEnabled(true);for(e=0;e<o.getItems().length;e++){o.getItems()[e].setEnabled(true);if(e>0&&!n){o.getItems()[e].setEnabled(false)}}a.resolve()}});return a.promise()},changeLabelDisplayOption:function(e){var t=this;var a=n.removePrefixText(t.byId("idPropertyType").getSelectedKey(),t.oTextReader(r.texts.NOTAVAILABLE));t.oRepresentation.setLabelDisplayOption(a,e)},removePropertyFromParentObject:function(){var e=this;e.oRepresentation.removeDimension(n.removePrefixText(e.byId("idPropertyType").getSelectedKey(),e.oTextReader(r.texts.NOTAVAILABLE)))},addPropertyAsPromise:function(){var e=jQuery.Deferred();var t=this,a,o=[];var n=t.oStepPropertyMetadataHandler.oStep;t.oStepPropertyMetadataHandler.getEntityTypeMetadataAsPromise().done(function(i){n.getConsumablePropertiesForRepresentation(t.oRepresentation.getId()).done(function(n){n.consumable.forEach(function(e){if(t.oStepPropertyMetadataHandler.getPropertyMetadata(i,e)){a=t.oStepPropertyMetadataHandler.getPropertyMetadata(i,e)["aggregation-role"];if(a===r.aggregationRoles.DIMENSION){o.push(e)}}});t.getView().fireEvent(r.events.ADDPROPERTY,{sProperty:o[0],sContext:t.getView().getViewData().oPropertyTypeData.sContext,bMandatory:t.getView().getViewData().oPropertyTypeData.bMandatory});t.oConfigurationEditor.setIsUnsaved();e.resolve()})});return e.promise()}})});
//# sourceMappingURL=representationDimension.controller.js.map