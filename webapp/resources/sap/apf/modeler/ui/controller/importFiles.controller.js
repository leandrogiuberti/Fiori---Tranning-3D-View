/*!
 * SAP APF Analysis Path Framework
 *
 * (c) Copyright 2012-2014 SAP AG. All rights reserved
 */
sap.ui.define(["sap/apf/modeler/ui/controller/overwriteExistingConfiguration","sap/apf/modeler/ui/utils/nullObjectChecker","sap/ui/core/CustomData","sap/ui/core/Fragment"],function(e,t,i,l){"use strict";var a,o,r,n,s;function d(e){var t=a.getText;e.byId("idImportFilesDialog").setTitle(t("importConfig"));e.byId("idJsonFileLabel").setText(t("jsonFile"));e.byId("idJsonFileUploader").setPlaceholder(t("jsonFileInputPlaceHolder"));e.byId("idTextFileLabel").setText(t("textFile"));e.byId("idTextFileUploader").setPlaceholder(t("textFileInputPlaceHolder"));e.byId("idUploadOfConfig").setText(t("upload"));e.byId("idCancelImportOfConfig").setText(t("cancel"))}function c(e,t,o,r){l.load({id:"idOverwriteConfirmationFragment",type:"XML",name:"sap.apf.modeler.ui.fragment.overwriteConfirmation",controller:e}).then(s=>{n=s;e.getView().addDependent(n);e.setOverwriteConfirmationDialogText(a.getText);const d=new i({value:{callbackOverwrite:t,callbackCreateNew:o}});n.destroyCustomData();n.addCustomData(d);l.byId("idOverwriteConfirmationFragment","idNewConfigTitleInput").setValue(r);n.open()})}function p(e){var t=a.createMessageObject({code:e});a.putMessage(t)}function u(e,i,l){var r=this;var n=r.byId("idTextFileUploader");if(!t.checkIsNotUndefined(l)){o.fireEvent("updateAppListEvent");p("11515");if(n&&n.getValue()){n.upload()}else{r.closeAllOpenDialogs()}}else{var s=a.createMessageObject({code:"11502"});s.setPrevious(l);a.putMessage(s);r.closeAllOpenDialogs()}}function f(e,i){a.importTexts(i,function(e){if(!t.checkIsNotUndefined(e)){p("11516")}else{var i=a.createMessageObject({code:"11503"});i.setPrevious(e);a.putMessage(i)}});e.closeAllOpenDialogs()}return e.extend("sap.apf.modeler.ui.controller.importFiles",{onInit:function(){var e=this;a=e.getView().getViewData().oCoreApi;o=e.getView().getViewData().oParentControl;a.getApplicationHandler(function(e,i){if(e&&!t.checkIsNotUndefined(i)){r=e}else{var l=a.createMessageObject({code:"11508"});l.setPrevious(i);a.putMessage(l)}});d(e);e.byId("idImportFilesDialog").setInitialFocus("true");e.byId("idImportFilesDialog").open()},addAcceptAttribute:function(){var e=this;var t=jQuery("#"+e.getView().getId()+"--idJsonFileUploader-fu");var i=jQuery("#"+e.getView().getId()+"--idTextFileUploader-fu");t.attr("accept",".json");i.attr("accept",".properties")},handleTypeMissmatchForJSONFile:function(){p("11517")},handleTypeMissmatchForPropertiesFile:function(){p("11518")},handleJSONFileUploadComplete:function(e){var t=this;var i=e.getSource().oFileUpload.files[0];if(i){var l=new FileReader;l.readAsText(i,"UTF-8");l.onload=function(e){s=JSON.parse(e.target.result).configHeader.Application;a.importConfiguration(JSON.stringify(JSON.parse(e.target.result)),function(e,i,l){c(t,e,i,l)},u.bind(t))};l.onerror=function(){p("11519")}}},handleTextFileUploadComplete:function(e){var i=this,l,a;l=e.getSource().oFileUpload.files[0];a=i.byId("idJsonFileUploader");if(l){var o=new FileReader;o.readAsText(l,"UTF-8");o.onload=function(e){var l=e.target.result.split(/\r?\n/);var o,n,d;for(n=0;n<l.length;n++){o=/^\#\s*ApfApplicationId=[0-9A-F]+\s*$/.exec(l[n]);if(t.checkIsNotNull(o)){d=l[n].split("=")[1]}}var c;if(r){for(n=0;n<r.getList().length;n++){if(d===r.getList()[n].Application){c=true;break}else{c=false}}}if(!c&&a&&!a.getValue()){p("11520")}else if(a&&a.getValue()){if(s&&d&&d!==s){p("11521")}else{f(i,e.target.result)}}else if(c&&a&&!a.getValue()){f(i,e.target.result)}};o.onerror=function(){p("11522")}}i.closeAllOpenDialogs()},handleUploadOfConfig:function(){var e=this;var i=t.checkIsNotNullOrUndefinedOrBlank(e.byId("idJsonFileUploader").getValue());var l=t.checkIsNotNullOrUndefinedOrBlank(e.byId("idTextFileUploader").getValue());if(i&&l||i){e.byId("idJsonFileUploader").upload()}else{e.byId("idTextFileUploader").upload()}},handleCancelOfImportFilesDialog:function(){var e=this;e.byId("idImportFilesDialog").close()},closeAllOpenDialogs:function(){var e=this.byId("idImportFilesDialog");if(n&&n.isOpen()){this.handleCancelOfOverwriteDialog()}if(e&&e.isOpen()){this.handleCancelOfImportFilesDialog()}}})});
//# sourceMappingURL=importFiles.controller.js.map