/*!
 * SAP APF Analysis Path Framework
 * 
 * (c) Copyright 2012-2014 SAP AG. All rights reserved
 */
sap.ui.define(["sap/apf/modeler/ui/utils/constants","sap/apf/modeler/ui/utils/propertyTypeFactory","sap/apf/modeler/ui/utils/nullObjectChecker","sap/apf/modeler/ui/utils/propertyTypeState","sap/apf/modeler/ui/utils/propertyTypeOrchestration","sap/base/util/deepExtend","sap/ui/core/mvc/Controller","sap/ui/thirdparty/jquery"],function(e,t,r,o,a,n,p,jQuery){"use strict";function i(t,r){r.attachEvent(e.events.ADDPROPERTY,t.handlePressOfAdd.bind(t));r.attachEvent(e.events.REMOVEPROPERTY,t.handlePressOfRemove.bind(t));r.attachEvent(e.events.SETNEXTPROPERTYINPARENTOBJECT,r.getController().setNextPropertyInParentObject.bind(r.getController()));t.getView().attachEvent(e.events.SETNEXTPROPERTYINPARENTOBJECT,r.getController().setNextPropertyInParentObject.bind(r.getController()));r.attachEvent(e.events.REMOVECURRENTPROPERTYFROMPARENTOBJECT,r.getController().removePropertyFromParentObject.bind(r.getController()));r.attachEvent(e.events.REMOVEPROPERTYFROMPARENTOBJECT,r.getController().removePropertyFromParentObject.bind(r.getController()));r.attachEvent(e.events.UPDATEPROPERTYVALUESTATE,t.updatePropertyValueState.bind(t));r.attachEvent(e.events.FOCUSONREMOVE,t.handleFocusOnRemove.bind(t));r.attachEvent(e.events.SETFOCUSONREMOVEICON,r.getController().setFocusOnAddRemoveIcons.bind(r.getController()))}function y(e,t){var r=[];var o=e.getView().getViewData().aPropertiesToBeCreated;o.forEach(function(o){var a=P(e,o,e.nCounter,t);r.push(a.then(e=>e.getController().initPromise))});e.initPromise=jQuery.when.apply(jQuery,r)}async function P(e,r,o,a){var p=n({},e.getView().getViewData().oViewDataForPropertyType);p.oPropertyTypeState=e.oPropertyTypeState;p.oPropertyTypeData=r;p.oPropertyOrchestration=a;p.oPropertyTypeHandlerBackLink=e;var y=e.createId("id"+p.sPropertyType+"View"+e.nCounter);e.oPropertyTypeState.addPropertyAt(r.sProperty,o);e.oPropertyTypeState.addPropertyTypeViewIdAt(y,o);e.nCounter++;var P=await t.createPropertyTypeView(p,y);if(a){a.addPropertyTypeReference(y,r,p.sPropertyType,P)}i(e,P);e.byId("idPropertyTypeVBox").insertItem(P,o);return P}var s=p.extend("sap.apf.modeler.ui.controller.propertyTypeHandler",{_apfName:"propertyTypeHandler",nCounter:0,oPropertyTypeState:{},initPromise:undefined,oPropertyOrchestration:undefined,onInit:function(){var e=this;e.oPropertyOrchestration=e.getView().getViewData().oPropertyOrchestration;e.oPropertyTypeState=new o;y(e,e.oPropertyOrchestration);if(e.oPropertyOrchestration){e.oPropertyOrchestration.updateAllSelectControlsForPropertyType()}},handlePressOfAdd:function(t){var o=this,n={},p;var i=t.getParameter("oSourceView");var y=o.getView().getViewData().oPropertyOrchestration;var s=y.getPropertyTypeRow(i.getId()).sPropertyType;var d=a._mapPropertyType2AggregationRole(s);var T=o.byId("idPropertyTypeVBox").indexOfItem(i)+1;var l=o.getView().getViewData().oViewDataForPropertyType.oParentObject.getId();var v=o.getView().getViewData().oViewDataForPropertyType.oStepPropertyMetadataHandler;var c=v.oStep;var E=c.getType()==="hierarchicalStep";if(E&&s===e.propertyTypes.REPRESENTATIONSORT){d=e.aggregationRoles.MEASURE}a.getConsumableAndAvailablePropertiesAsPromise(l,d,v).then(async function(e){var t=a._relativeComplement(e.available,y.getSelectedProperties());var s=t[0];n.sProperty=s;n.sContext=y.getPropertyTypeRow(i.getId()).propertyRowInformation.sContext;if(r.checkIsNotUndefined(n.sProperty)){p=await P(o,n,T,y);p.getController().setNextPropertyInParentObject()}return y.updateAllSelectControlsForPropertyType()})},handleFocusOnRemove:function(t){var r=this;var o=r.byId("idPropertyTypeVBox");var a=t.getSource();var n=o.indexOfItem(a);var p=r.byId(r.oPropertyTypeState.aPropertyTypeViewIds[n-1]);p.fireEvent(e.events.SETFOCUSONREMOVEICON)},handlePressOfRemove:function(e){var t=this;var r=e.oSourceView||e.getSource();var o=t.byId("idPropertyTypeVBox");var a=o.indexOfItem(r);t.oPropertyTypeState.removePropertyAt(a);t.oPropertyTypeState.removePropertyTypeViewIdAt(a);o.removeItem(r)},updatePropertyValueState:function(e){var t=this;var r=e.getSource();var o=e.getParameter("sProperty");var a=t.byId("idPropertyTypeVBox").indexOfItem(r);t.oPropertyTypeState.updatePropertyAt(o,a)},handleRemoveOfProperty:function(){var t=this;var o=t.byId("idPropertyTypeVBox");if(r.checkIsNotUndefined(o)){o.getItems().forEach(function(t){t.fireEvent(e.events.REMOVEPROPERTYFROMPARENTOBJECT)})}},handleSettingTopNProperties:function(){var t=this;t.getView().fireEvent(e.events.SETNEXTPROPERTYINPARENTOBJECT)}});return s},true);
//# sourceMappingURL=propertyTypeHandler.controller.js.map