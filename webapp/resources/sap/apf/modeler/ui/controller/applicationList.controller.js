/*!
 * SAP APF Analysis Path Framework
 *
 * (c) Copyright 2012-2018 SAP SE. All rights reserved
 */
sap.ui.define(["sap/m/library","sap/m/List","sap/m/Popover","sap/m/StandardListItem","sap/m/Text","sap/ui/core/CustomData","sap/ui/core/Element","sap/ui/core/Fragment","sap/ui/core/UIComponent","sap/ui/core/mvc/Controller","sap/ui/core/mvc/View","sap/ui/core/mvc/ViewType","sap/apf/modeler/ui/utils/helper","sap/apf/modeler/ui/utils/nullObjectChecker","sap/apf/modeler/ui/utils/optionsValueModelBuilder","sap/ui/model/Filter","sap/ui/model/FilterOperator"],function(e,t,i,a,n,o,r,l,d,p,s,c,u,f,g,m,h){"use strict";var b=e.ListType,v=e.PlacementType;function y(e){return function(...t){e.call(this,...t)}}function I(e){var t=e.coreApi.getText;e.byId("idAppPage").setTitle(t("configModelerTitle"));e.byId("idAppTitle").setText(t("applicationOverview"));e.byId("idApplicationToolbar").setTooltip(t("applications"));e.byId("idAppNumberTitle").setText(t("applications"));e.byId("idAppNumberTitle").setTooltip(t("applications"));e.byId("idDescriptionLabel").setText(t("description"));if(e.coreApi.showSemanticObject()){e.byId("idSemanticObjectLabel").setText(t("semanticObject"))}e.byId("idImportButton").setText(t("import"));e.byId("idImportButton").setTooltip(t("importConfig"));e.byId("idNewButton").setText(t("new"));e.byId("idNewButton").setTooltip(t("newApplication"));e.byId("idEditIcon").setTooltip(t("editApplication"));e.byId("idDeleteIcon").setTooltip(t("deleteApplication"));e.byId("idTextpoolCleanupIcon").setTooltip(t("textCleanUp"));e.byId("idAriaPropertyForDelete").setText(t("ariaTextForDeleteIcon"));e.byId("idAriaPropertyForEdit").setText(t("ariaTextForEditIcon"));e.byId("idAriaPropertyForTextpoolCleanup").setText(t("ariaTextForTextpoolCleanupIcon"))}function A(e){var t=e.coreApi.getText;l.byId("idDeleteConfirmationFragment","idDeleteConfirmation").setTitle(t("confirmation"));l.byId("idDeleteConfirmationFragment","idDeleteButton").setText(t("deleteButton"));l.byId("idDeleteConfirmationFragment","idCancelButtonDialog").setText(t("cancel"))}function T(e){var t=e.applicationHandler.getList();e.byId("idAppCount").setText("("+t.length+")");var i=[];t.forEach(function(e){var t={};t.id=e.Application;t.description=e.ApplicationName;t.semanticObject=e.SemanticObject;i.push(t)});var a=g.prepareModel(i,i.length);e.byId("idApplicationTable").setModel(a);if(e.actualQuery!==""){e.filterValues(e.actualQuery)}}function C(e,t){var i=e.coreApi.createMessageObject({code:t});e.coreApi.putMessage(i)}function D(e){e.byId("idApplicationTable").attachEvent("addNewAppEvent",e.handleAdditionOfNewApp.bind(e));e.byId("idApplicationTable").attachEvent("updateAppListEvent",e.handleAppListUpdate.bind(e))}async function x(e,t){var i,a;i={oParentControl:e.byId("idApplicationTable"),oCoreApi:e.coreApi};a=await s.create({viewName:"sap.apf.modeler.ui.view."+t,type:c.XML,viewData:i});e.getView().addDependent(a)}function w(e,t,i,a){e.getView().addDependent(t);var o=new n({text:e.coreApi.getText(i)});t.removeAllContent();t.addContent(o);t.addAriaDescribedBy(o);if(a){t.removeAllCustomData();t.addCustomData(a)}t.open()}function O(e){var t=e.byId("idAppListScrollContainer");var i=e.byId("idApplicationTable");var a=e.getView();i.addEventDelegate({onAfterRendering:function(){var i=jQuery(window).height();var n=jQuery(a.byId("idAppTitle").getDomRef()).height()??0;var o=jQuery(a.byId("idApplicationToolbar").getDomRef()).height()??0;var r=jQuery(a.byId("idAppPage").getDomRef()).find("header").height()??0;var l=jQuery(a.byId("idAppPage").getDomRef()).find("footer").height()??0;var p;if(n>0){n=n+80;p=n+o+r+l+25}else{p=232}t.setHeight(i-p+"px");t.setWidth("100%");u.onResize(function(){if(jQuery(a.getDomRef()).css("display")==="block"){i=jQuery(a.byId("idAppPage").getDomRef()).height()??0;t.setHeight(i-p+"px");t.setWidth("100%")}});d.getRouterFor(e).attachRoutePatternMatched(function(e){if(e.getParameter("name")==="applicationList"){i=jQuery(a.getDomRef()).height()??0;t.setHeight(i-p+"px");t.setWidth("100%")}})}})}function j(e,n){var o=new a({title:e.coreApi.getText("importDeliveredContent"),type:b.Active,press:function(){x(e,"importDeliveredContent")}});var r=new a({title:e.coreApi.getText("importFiles"),type:b.Active,press:function(){x(e,"importFiles")}});var l=new i({placement:v.Top,showHeader:false});var d=new t({items:[o,r]});l.addContent(d);l.openBy(n.getSource())}return p.extend("sap.apf.modeler.ui.controller.applicationList",{onInit:function(){var e=this;this.actualQuery="";var t=e.getOwnerComponent();if(f.checkIsNotUndefined(t)){e.coreApi=t.oCoreApi;if(!this.coreApi.showSemanticObject()){this.hideSemanticObjectColumn()}D(this);I(e);e.coreApi.getApplicationHandler(function(t,i){e.applicationHandler=t;if(e.applicationHandler&&!f.checkIsNotUndefined(i)){T(e)}else{e.showMessage("11508",i)}})}O(e)},showMessage:function(e,t){var i=this.coreApi.createMessageObject({code:e});if(t){i.setPrevious(t)}this.coreApi.putMessage(i)},hideSemanticObjectColumn:function(){this.byId("idSemanticObjectColumn").setVisible(false)},handleAddNewAppPress:function(){var e=this;if(f.checkIsNotNullOrUndefinedOrBlank(e.applicationHandler)){x(e,"newApplication")}else{e.showMessage("11509")}},handleListItemPress:function(e){var t=this,i;i=e.getParameter("listItem").getBindingContext().getPath().split("/")[2];d.getRouterFor(t).navTo("configurationList",{appId:t.byId("idApplicationTable").getModel().getData().Objects[i].id})},handleTextpoolCleanupPress:y(async function(e){var t;var i=e.getSource().getBindingContext().getObject().id;var a=new o({value:{applicationId:i}});var n=this.coreApi.getText;t=await l.load({id:"idTextpoolCleanupConfirmationFragment",name:"sap.apf.modeler.ui.fragment.textpoolCleanupConfirmationDialog",controller:this});t.setTitle(n("confirmation"));t.getButtons()[0].setText(n("ok"));t.getButtons()[1].setText(n("cancel"));w(this,t,"textpoolCleanupConfirmation",a)}),handleConfirmTextpoolCleanup:function(e){var t=this;var i=l.byId("idTextpoolCleanupConfirmationFragment","idTextpoolCleanupConfirmation").getCustomData()[0].getValue().applicationId;t.coreApi.getConfigurationHandler(i,function(e){var a=e.getTextPool();t.coreApi.getUnusedTextKeys(i,function(e,n){if(!f.checkIsNotUndefined(n)){a.removeTexts(e,i,function(e){if(!f.checkIsNotUndefined(e)){t.showMessage("11511")}else{t.showMessage("11507",e)}t.closeTextpoolCleanupConfirmationDialog()})}else{t.showMessage("11506",n);t.closeTextpoolCleanupConfirmationDialog()}})})},closeTextpoolCleanupConfirmationDialog:function(){l.byId("idTextpoolCleanupConfirmationFragment","idTextpoolCleanupConfirmation").destroy()},handleCancelTextpoolCleanup:function(e){this.closeTextpoolCleanupConfirmationDialog()},handleEditPress:function(e){var t,i;if(f.checkIsNotNullOrUndefinedOrBlank(this.applicationHandler)){t=e.getSource().getBindingContext().getObject();i={parentControl:this.byId("idApplicationTable"),coreApi:this.coreApi,applicationData:t};s.create({viewName:"sap.apf.modeler.ui.view.editApplication",type:c.XML,viewData:i}).then(function(e){this.getView().addDependent(e)}.bind(this))}},handleDeletePress:y(async function(e){var t=this,i;var a=e.getSource().getBindingContext().getPath().split("/")[2];var n=new o({value:{removeId:this.byId("idApplicationTable").getModel().getData().Objects[a].id,sPath:a}});i=await l.load({id:"idDeleteConfirmationFragment",type:"XML",name:"sap.apf.modeler.ui.fragment.deleteConfirmationDialog",controller:t});A(t);w(t,i,"deleteApp",n)}),handleConfirmDeletion:function(){var e=this;var t=l.byId("idDeleteConfirmationFragment","idDeleteConfirmation").getCustomData()[0].getValue().removeId;if(f.checkIsNotUndefined(t)){e.applicationHandler.removeApplication(t,function(t,i,a){if(!f.checkIsNotUndefined(a)&&typeof t==="string"){T(e);C(e,"11510")}else{e.showMessage("11501",a)}e.closeDialog()})}},closeDialog:function(){l.byId("idDeleteConfirmationFragment","idDeleteConfirmation").destroy()},handleNavigationWithSave:function(){var e=this;e.handleSavePress();l.byId("idUnsavedDataConfirmationFragment","idMessageDialog").destroy()},handleNavigationWithoutSave:function(){l.byId("idUnsavedDataConfirmationFragment","idMessageDialog").destroy()},handlePreventNavigation:function(){l.byId("idUnsavedDataConfirmationFragment","idMessageDialog").destroy()},handleImportPress:function(e){if(this.coreApi.isVendorContentAvailable()){j(this,e)}else{x(this,"importFiles")}},handleSavePress:function(){var e=this,t=[],i,a,n;i=e.applicationHandler.getList();a=e.byId("idApplicationTable").getModel().getData().Objects;for(n=0;n<i.length;n++){if(a[n].description!==i[n].ApplicationName||a[n].semanticObject!==i[n].SemanticObject){t.push(a[n])}}t.forEach(function(t){var i={ApplicationName:t.description,SemanticObject:t.semanticObject};e.applicationHandler.setAndSave(i,function(t,i,a){if(f.checkIsNotUndefined(a)){e.showMessage("11500",a)}},t.id)})},handleNavigationToConfigurationList:function(e){var t=this;var i={listItem:r.getElementById(e.currentTarget.id).getParent(),srcControl:t.byId("idApplicationTable")};t.byId("idApplicationTable").fireItemPress(i)},handleAdditionOfNewApp:function(e){var t=this,i,a,n,o=0,r;i=e.getParameter("appId");T(t);a=t.byId("idApplicationTable").getModel().getData().Objects;C(t,"11512");t.byId("idApplicationTable").rerender();for(n=0;n<a.length;n++){if(a[n].id===i){o=n;break}}r=t.byId("idApplicationTable").getItems();if(r.length){var l=r[o].getDomRef();if(l){l.scrollIntoView()}}if(this.actualQuery!==""){this.filterValues(this.actualQuery)}},handleAppListUpdate:function(){var e=this;T(e)},handleNavBack:function(){window.history.go(-1)},onSearch:function(e){var t=e.getParameters().newValue;this.actualQuery=t;this.filterValues(t)},filterValues:function(e){var t=[];if(e&&e.length>0){var i=new m("description",h.Contains,e);t.push(i)}var a=this.byId("idApplicationTable");var n=a.getBinding("items");n.filter(t,"Objects")}})});
//# sourceMappingURL=applicationList.controller.js.map