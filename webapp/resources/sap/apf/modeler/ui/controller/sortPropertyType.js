/*!
 * SAP APF Analysis Path Framework
 *
 * (c) Copyright 2012-2014 SAP AG. All rights reserved
 */
sap.ui.define(["sap/apf/modeler/ui/utils/optionsValueModelBuilder","sap/apf/modeler/ui/utils/staticValuesBuilder","sap/apf/modeler/ui/utils/constants","sap/apf/modeler/ui/utils/textManipulator","sap/apf/modeler/ui/utils/nullObjectChecker","sap/apf/utils/utils","sap/ui/Device","sap/ui/core/Item","sap/ui/core/mvc/Controller"],function(e,t,r,o,i,n,a,d,s){"use strict";var u="idSortProperty";var p="idSortDirection";var c=r.events;function f(e){e.byId("idSortLabel").setText(e.oTextReader("sortingField"));e.byId("idSortLabel").setTooltip(e.oTextReader("sortingField"));e.byId("idSortDirectionLabel").setText(e.oTextReader("direction"));e.byId("idSortDirectionLabel").setTooltip(e.oTextReader("direction"));e.byId("idAddPropertyIcon").setTooltip(e.oTextReader("addButton"));e.byId("idRemovePropertyIcon").setTooltip(e.oTextReader("deleteButton"))}function l(e){if(a.browser.msie&&a.browser.version>=11){e.byId("idAriaPropertyForSortGroup").setText(e.oTextReader("sorting"))}e.byId("idAriaPropertyForAdd").setText(e.oTextReader("ariaTextForAddIcon"));e.byId("idAriaPropertyForDelete").setText(e.oTextReader("ariaTextForDeleteIcon"))}function y(t){var r=t.byId(u);t.getAllPropertiesAsPromise().done(function(t){var o=e.convert(t.aAllProperties);r.setModel(o);r.setSelectedKey(t.sSelectedKey)})}function g(r){var o=r.byId(p);var i=new t(r.oTextReader,e);var n=i.getSortDirections();o.setModel(n);o.setSelectedKey(r.getView().getViewData().oPropertyTypeData.sContext)}function v(e){var t=true,r=true;var o=e.getView().getViewData().oPropertyTypeState;var i=o.indexOfPropertyTypeViewId(e.getView().getId());if(o.indexOfPropertyTypeViewId(e.getView().getId())===0){r=false}e.byId("idAddPropertyIcon").setVisible(t);e.byId("idRemovePropertyIcon").setVisible(r);if(i>0&&o.aProperties!==undefined){var n=o.getViewAt(i-1);n.oController.byId("idAddPropertyIcon").setVisible(false)}}function P(e,t){var r=e.getView().getViewData().oPropertyTypeState;if(r!==undefined){var o=r.aProperties.length;var i=r.getViewAt(t-1);var n=e.oConfigurationEditor.isSaved();if(t>1&&t==o&&n==false){i.oController.byId("idAddPropertyIcon").setVisible(true);i.oController.byId("idRemovePropertyIcon").setVisible(true)}if(t===1&&t==o&&n==false){i.oController.byId("idAddPropertyIcon").setVisible(true)}}}function I(e){e.byId("idAddPropertyIcon").attachEvent(c.SETFOCUSONADDICON,e.setFocusOnAddRemoveIcons.bind(e))}var V=s.extend("sap.apf.modeler.ui.controller.sortPropertyType",{oConfigurationEditor:{},oParentObject:{},oStepPropertyMetadataHandler:{},oTextReader:{},onInit:function(){var e=this;e.oConfigurationEditor=e.getView().getViewData().oConfigurationEditor;e.oParentObject=e.getView().getViewData().oParentObject;e.oStepPropertyMetadataHandler=e.getView().getViewData().oStepPropertyMetadataHandler;e.oTextReader=e.getView().getViewData().oCoreApi.getText;e.setDetailData()},onAfterRendering:function(){var e=this;e.byId("idAddPropertyIcon").fireEvent(c.SETFOCUSONADDICON)},setDetailData:function(){var e=this;f(e);l(e);y(e);g(e);v(e);e.disableView()},handleChangeForSortProperty:function(e){var t=this;var i=o.removePrefixText(t.byId(u).getSelectedKey(),t.oTextReader(r.texts.NOTAVAILABLE));var n=t.getView().getViewData().oPropertyOrchestration;var a=t.getView().getId();return new Promise(function(e){t.getView().fireEvent(c.UPDATEPROPERTYVALUESTATE,{sProperty:i});n.updatePropertyTypeRow(a,i);n.updateAllSelectControlsForPropertyType().then(function(){t.updateOfConfigurationObject();t.oConfigurationEditor.setIsUnsaved();e()})})},handleChangeForSortDirection:function(){var e=this;e.updateOfConfigurationObject();e.oConfigurationEditor.setIsUnsaved()},setFocusOnAddRemoveIcons:function(){var e=this;e.byId("idAddPropertyIcon").focus()},handlePressOfAddPropertyIcon:function(){var e=this;I(e);e.addPropertyAsPromise()},handlePressOfRemovePropertyIcon:function(){var e=this;var t=e.getView().getViewData();var r=e.getView().getViewData().oPropertyTypeState;if(r!==undefined){var o=r.indexOfPropertyTypeViewId(e.getView().getId())}return new Promise(function(r){e.getView().fireEvent(c.FOCUSONREMOVE);var i=t.oPropertyOrchestration;i.removePropertyTypeReference(e.getView().getId());i.updateAllSelectControlsForPropertyType().then(function(){e.updateOfConfigurationObject();t.oPropertyTypeHandlerBackLink.handlePressOfRemove({oSourceView:e.getView()});P(e,o);e.oConfigurationEditor.setIsUnsaved();e.getView().destroy();r()})})},updateOfConfigurationObject:function(){var e=this;var t=e.getView().getViewData().oPropertyOrchestration;var r=t.getSortPropertyInformationList(p);e.updateOfConfigurationObjectOfSubclass(r)},getSelectedSortProperty:function(){var e=this;var t=e.getView().getViewData().oPropertyTypeState;var r=t.getPropertyValueState();var o=t.indexOfPropertyTypeViewId(e.getView().getId());return r[o]},removeAllItemsFromDropDownList:function(){var e=this;var t=e.byId(u);t.getItems().forEach(function(e){t.removeItem(e)})},setItemsOfDropDownList:function(e,t,r){function i(e,t){return e.indexOf(t)!==-1}var n=this;var a=n.byId(u);var s=r===n.oTextReader("none");var p=JSON.parse(JSON.stringify(e));a.addItem(new d({key:n.oTextReader("none"),text:n.oTextReader("none")}));if(!i(p,r)&&!s){p.unshift(r)}p=p.filter(function(e){return e!==n.oTextReader("none")});p.forEach(function(e){var u=e;if(!i(t,e)&&!s){e=o.addPrefixText([e],n.oTextReader)[0]}var p=new d({key:e,text:e});a.addItem(p);if(u===r){r=e}});a.setSelectedKey(r)},updateOfConfigurationObjectOfSubclass:function(e){},getOrderBy:function(){},setNextPropertyInParentObject:function(){},removePropertyFromParentObject:function(){},disableView:function(){},addPropertyAsPromise:function(){return n.createPromise()}});return V},true);
//# sourceMappingURL=sortPropertyType.js.map