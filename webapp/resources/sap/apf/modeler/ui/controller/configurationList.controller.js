/*!
* SAP APF Analysis Path Framework
*
* (c) Copyright 2012-2014 SAP SE. All rights reserved
*/
sap.ui.define(["sap/apf/modeler/ui/utils/APFRouter","sap/apf/modeler/ui/utils/constants","sap/apf/modeler/ui/utils/textPoolHelper","sap/apf/modeler/ui/utils/navigationHandler","sap/apf/modeler/ui/utils/helper","sap/apf/modeler/ui/utils/APFTree","sap/m/Label","sap/m/Link","sap/ui/core/Fragment","sap/ui/core/Icon","sap/ui/core/UIComponent","sap/ui/core/mvc/Controller","sap/ui/core/mvc/View","sap/ui/core/mvc/ViewType","sap/ui/core/util/File","sap/ui/model/json/JSONModel","sap/ui/util/openWindow","sap/apf/cloudFoundry/uiHandler","sap/ui/thirdparty/jquery","sap/base/util/deepExtend","sap/base/util/extend","sap/base/util/isEmptyObject","sap/ui/core/syncStyleClass"],function(e,t,i,a,o,n,r,s,d,l,g,f,c,u,h,C,p,D,jQuery,I,T,v,b){"use strict";var x=t.configurationObjectTypes;return f.extend("sap.apf.modeler.ui.controller.configurationList",{onInit:function(){this._pOnInit=this.onInitAsync()},whenInitialized:function(){return Promise.resolve(this._pOnInit)},onInitAsync:async function(){var t=this.getOwnerComponent();if(t!==undefined){this.oCoreApi=t.oCoreApi;this._setDisplayText();this._setPublishVisible()}this._addConfigStyleClass();this.oModel=new C({aConfigDetails:[]});this.getView().setModel(this.oModel);this.bProgramaticSelection=false;if(this.oTreeInstance!==undefined){this.oTreeInstance.expandToLevel(1);this.oTreeInstance.collapseAll()}this.modelUpdateDeferred={};e.patternMatch(this);await this._instantiateToolbarView();this._instantiateAPFTree();await this._instantiateTitleAndBreadCrumbView()},_instantiateToolbarView:async function(){var e=await c.create({viewName:"sap.apf.modeler.ui.view.toolbar",type:u.XML,viewData:{oConfigListInstance:this}});this.toolbarController=e.getController();this.byId("idConfigMasterData").insertItem(e,0)},_instantiateAPFTree:function(){this.oTreeInstance=this.byId("idConfigTree");this.oTreeInstance.setTranslationFunction(this.oCoreApi.getText);var e;if(this.oCoreApi.getRepresentationTypes()[0].metadata){e=this.oCoreApi.getRepresentationTypes()[0].id}this.oTreeInstance.setDefaultRepresentationType(e)},_instantiateTitleAndBreadCrumbView:async function(){this.oTitleBreadCrumbView=await c.create({viewName:"sap.apf.modeler.ui.view.titleBreadCrumb",type:u.XML,viewData:{getText:this.oCoreApi.getText}});this.oTitleBreadCrumbController=this.oTitleBreadCrumbView.getController();this.byId("idConfigDetail").insertItem(this.oTitleBreadCrumbView,0);this.oBreadCrumb=this.oTitleBreadCrumbView.byId("IdBreadCrumb")},setConfigListMasterTitle:function(e){this.byId("idConfigTitleMaster").setText(this.oCoreApi.getText("configurationObjectTitle")+" : "+e)},onAfterRendering:function(){var e=this;this.whenInitialized().then(()=>{this.oTreeInstance.onAfterRendering=function(){e._setHeightForScrollBar()}})},_setHeightForScrollBar:function(){var e=this;var t=jQuery(window).height();t=t-165;e.byId("idMasterScroll").setHeight(t+"px");o.onResize(function(){t=jQuery(e.byId("configPage").getDomRef()).height();e.byId("idMasterScroll").setHeight(t+"px")})},_setDisplayText:function(){this.byId("configPage").setTitle(this.oCoreApi.getText("configModelerTitle"));this.byId("idSavebutton").setText(this.oCoreApi.getText("save"));this.byId("idCancelbutton").setText(this.oCoreApi.getText("cancel"));this.byId("idExportbutton").setText(this.oCoreApi.getText("export"));this.byId("idExecuteButton").setText(this.oCoreApi.getText("execute"));this.byId("idPublishbutton").setText(this.oCoreApi.getText("share"));this.byId("idAriaPropertyForBreadCrumb").setText(this.oCoreApi.getText("breadCrumbText"))},_setPublishVisible:function(){var e=this.oCoreApi.isUsingCloudFoundryProxy();this.byId("idPublishbutton").setVisible(e)},_addConfigStyleClass:function(){this.getView().addStyleClass("sapUiSizeCompact");this.byId("idConfigTree").addStyleClass("configTree");this.byId("idConfigTitleMaster").addStyleClass("configTitle");this.byId("idConfigMasterData").addStyleClass("configMasterData");this.byId("idConfigDetailData").addStyleClass("configDetailData")},_setSubViewContainerHeight:function(e){var t=this;var i=e.getContent()[0].getItems()[0];var a=jQuery(window).height();var n=jQuery(this.byId("idConfigTitleMaster").getDomRef()).outerHeight()+jQuery(this.byId("idConfigTitleMaster").getDomRef()).offset().top+25;var r=jQuery(this.byId("idConfigMasterData").getItems()[0].getDomRef()).height();var s=jQuery(this.byId("configPage").getDomRef()).find("header").height();var d=jQuery(this.byId("configPage").getDomRef()).find("footer").height();var l,g;if(r>0){l=n+r+s+d}else{l=265}var f=a-l-40+"px";i.setHeight(f);var c=jQuery(this.byId("idConfigDetailData").getDomRef()).width();if(c>0){g=jQuery(this.byId("idConfigMasterData").getDomRef()).offset().left}else{c=1015;g=15}var u=c-g;var h=u+"px";i.setWidth(h);o.onResize(function(){a=jQuery(t.byId("configPage").getDomRef()).height();f=a-l+"px";i.setHeight(f);c=jQuery(t.byId("idConfigDetailData").getDomRef()).width();u=c-g;h=u+"px";i.setWidth(h)})},_setSubView:async function(e){this.oSubView=e},_getSubView:async function(){return this.oSubView},updateSubView:async function(e){var t=this;var i=await this._getSubView();var a=this.byId("idConfigDetailData");var o=this.getSPathFromURL(e);this.configurationHandler.memorizeConfiguration(e.arguments.configId);if(i){i.destroy()}if(e.arguments.configId.indexOf("newConfig")===0){this.modelUpdateDeferred[this.byId("idConfigTree").getModel().getData().aConfigDetails.length-1]=new jQuery.Deferred}var n=await c.create({viewName:"sap.apf.modeler.ui.view."+o.objectType,type:"XML",viewData:{oParams:e,oCoreApi:t.oCoreApi,updateConfigTree:t.updateConfigTree.bind(t),updateSelectedNode:t.updateSelectedNode.bind(t),updateTitleAndBreadCrumb:t.updateTitleAndBreadCrumb.bind(t),updateTree:t.updateTree.bind(t),oConfigurationHandler:t.configurationHandler,oApplicationHandler:t.applicationHandler,oConfigurationEditor:t.configEditor,getText:t.oCoreApi.getText,getEntityTypeMetadataAsPromise:t.oCoreApi.getEntityTypeMetadataAsPromise,getRepresentationTypes:t.oCoreApi.getRepresentationTypes,oFooter:t.byId("idFooterBarMain"),createMessageObject:t.oCoreApi.createMessageObject,putMessage:t.oCoreApi.putMessage,getAllAvailableSemanticObjects:t.oCoreApi.getAllAvailableSemanticObjects,getSemanticActions:t.oCoreApi.getSemanticActions,getNavigationTargetName:t._getNavigationTargetName.bind(t),setNavigationTargetName:t._setNavigationTargetName.bind(t),getCalatogServiceUri:t.oCoreApi.getCatalogServiceUri,oTitleBreadCrumbController:t.oTitleBreadCrumbController}});if(e.name!=="applicationList"){a.removeAllContent();n.placeAt(a);this._setSubViewContainerHeight(n);await this._setSubView(n);return n}return null},clearTitleAndBreadCrumb:function(){this.oTitleBreadCrumbView.byId("IdFormTitle").setText("");this.oTitleBreadCrumbView.byId("IdBreadCrumb").destroyContent()},_createLinkForBreadCrumb:function(e,t,i){var a=this;var o=new s({text:e,id:a.createId("linkId"+t),press:function(){a._navigateToNode(i)}});o.addAriaDescribedBy(a.byId("idAriaPropertyForBreadCrumb"));return o},_createTextForBreadCrumb:function(e,t){var i=this;var a=new r({id:i.createId("textId"+t)});a.addStyleClass("dialogText");a.setText(e);return a},_createIconForBreadCrumb:function(){var e=new l({src:"sap-icon://open-command-field"});e.addStyleClass("breadCrumbIcon");return e},_navigateToNode:function(e){var t=this.oTreeInstance.getItemNodeByContext(e);this.oTreeInstance.setSelectedItem(t);this._onTreeNodeSelection()},_getAllPossibleNodes:function(e){var t=[];if(e.configId){t.push({id:e.configId,name:e.configurationName,oParams:{arguments:{configId:e.configId}}})}if(e.facetFilterId){t.push({id:e.facetFilterId,name:e.facetFilterName,oParams:{arguments:{configId:e.configId,facetFilterId:e.facetFilterId}}})}if(e.smartFilterId){t.push({id:e.smartFilterId,name:e.smartFilterName,oParams:{arguments:{configId:e.configId,smartFilterId:e.smartFilterId}}})}if(e.categoryId){t.push({id:e.categoryId,name:e.categoryName,oParams:{arguments:{configId:e.configId,categoryId:e.categoryId}}})}if(e.stepId){t.push({id:e.stepId,name:e.stepName,oParams:{arguments:{configId:e.configId,categoryId:e.categoryId,stepId:e.stepId}}})}if(e.representationId){t.push({id:e.representationId,name:e.representationName,oParams:{arguments:{configId:e.configId,categoryId:e.categoryId,stepId:e.stepId,representationId:e.representationId}}})}if(e.navTargetId){t.push({id:e.navTargetId,name:e.navTargetName,oParams:{arguments:{configId:e.configId,navTargetId:e.navTargetId}}})}return t},_breadCrumbCreation:function(e,t){for(var i=0;i<e.length;i++){var a=this.getSPathFromURL(e[i].oParams).sPath;var o;if(i===1){o=this._createTextForBreadCrumb(t,i);this.oBreadCrumb.addContent(o);var n=this._createIconForBreadCrumb();this.oBreadCrumb.addContent(n)}if(i!==e.length-1){var r=this._createLinkForBreadCrumb(e[i].name,i,a);this.oBreadCrumb.addContent(r);var s=this._createIconForBreadCrumb();this.oBreadCrumb.addContent(s)}if(i===e.length-1){o=this._createTextForBreadCrumb(e[i].name,++i);this.oBreadCrumb.addContent(o)}}},updateTitleAndBreadCrumb:function(e){var t;var i;var a=this.oTreeInstance.getSelectedItems();if(a&&a.length>0){i=a[0]}var o=i?this.oTreeInstance.getAPFTreeNodeContext(i):undefined;var n=o?o.nodeObjectType:undefined;var r=o?this.oTreeInstance.getParentNodeContext(o):undefined;if(e){t=e}else{if(n){var s=i.getTitle();t=this.oCoreApi.getText(n)+": "+s;if(n===x.SMARTFILTERBAR){t=s}}}if(r){if(this.oBreadCrumb){this.oBreadCrumb.destroyContent()}var d=this._getAllPossibleNodes(r);var l;switch(n){case x.CONFIGURATION:this._breadCrumbCreation(d);break;case x.SMARTFILTERBAR:case x.FACETFILTER:l=this.oCoreApi.getText("facetFilter");this._breadCrumbCreation(d,l);break;case x.CATEGORY:l=this.oCoreApi.getText("category");this._breadCrumbCreation(d,l);break;case x.STEP:l=this.oCoreApi.getText("category");this._breadCrumbCreation(d,l);break;case x.REPRESENTATION:l=this.oCoreApi.getText("category");this._breadCrumbCreation(d,l);break;case x.NAVIGATIONTARGET:l=this.oCoreApi.getText("navigationTarget");this._breadCrumbCreation(d,l);break;default:break}}if(n!==x.STEP){this.oTitleBreadCrumbController.setTitleForDetailPage(t)}},setSelectionOnTree:function(e){if(e.objectType==="smartFilterBar"){this.toolbarController.disableCopyDeleteButton()}else{this.toolbarController.enableCopyDeleteButton()}this._enableDisableExportAndExecuteButton(true);this.oTreeInstance.setSelectionOnTree(e.sPath)},removeSelectionOnTree:function(){this.oTreeInstance.removeSelectionOnTree(this.selectedNode)},updateConfigTree:function(e){var t,i,a,o,n,r,s,d,l;var f=this;e.forEach(function(e){var g;t=f.getSPathFromURL(e.oldContext).sPath;a=t.split("/");o=a[2];n=a[6];s=a[8];d=I({},f.oModel.getData().aConfigDetails[o].configData[1].categories[n].steps[s]);l=d.id;d.isSelected=false;i=f.getSPathFromURL(e.newContext).sPath;r=i.split("/")[6];if(e.removeStep===undefined){if(f.oModel.getData().aConfigDetails[o].configData[1].categories[r].steps){f.oModel.getData().aConfigDetails[o].configData[1].categories[r].steps.forEach(function(e){if(e.id===l){g=true}});if(g===undefined){f.oModel.getData().aConfigDetails[o].configData[1].categories[r].steps.push(d)}}else{f.oModel.getData().aConfigDetails[o].configData[1].categories[r].steps=[];f.oModel.getData().aConfigDetails[o].configData[1].categories[r].steps.push(d)}}else if(e.removeStep===true){if(f.oModel.getData().aConfigDetails[o].configData[1].categories[r].steps){f.oModel.getData().aConfigDetails[o].configData[1].categories[r].steps.forEach(function(e,t){if(e.id===l){var i=f.oModel.getData().aConfigDetails[o].configData[1].categories[r].steps;i.splice(t,1);f.oModel.getData().aConfigDetails[o].configData[1].categories[r].steps=i}});if(e.changeCategory===true){var c=f.getSPathFromURL(e.categoryChangeContext).sPath;var u=c.split("/");o=u[2];var h=u[6];var C=u[8];f.oModel.getData().aConfigDetails[o].configData[1].categories[h].steps[C].isSelected=true;f.oModel.getData().aConfigDetails[o].configData[1].categories[h].expanded=true}}}});this.oModel.updateBindings();var c=e.length;if(e[c-1].changeCategory){g.getRouterFor(this).navTo(e[c-1].oldContext.name,e[c-1].categoryChangeContext.arguments,true)}this.configEditor.setIsUnsaved()},updateSelectedNode:function(e,t){if(e){if(this.oTreeInstance.getSelectedItems()){this.selectedNode=this.oTreeInstance.getSelectedItem()}if(this.selectedNode){if(e.name&&this.selectedNode._getBindingContext()&&this.selectedNode._getBindingContext().getObject()){this.selectedNode.getBindingContext().getObject().name=e.name;this.selectedNode.getBindingContext().getObject().isSelected=true;if(this.selectedNode.getBindingContext().getObject().type===x.REPRESENTATION||this.selectedNode.getBindingContext().getObject().type===x.NAVIGATIONTARGET){this.selectedNode.getBindingContext().getObject().icon=e.icon}this.oModel.updateBindings()}if(e.id&&this.selectedNode.getBindingContext().getObject().id){this.selectedNode.getBindingContext().getObject().id=e.id;if(e.icon){this.selectedNode.getBindingContext().getObject().icon=e.icon}this.oModel.updateBindings()}else if(e.id&&this.selectedNode.getBindingContext().getObject().AnalyticalConfiguration){this.selectedNode.getBindingContext().getObject().AnalyticalConfiguration=e.id;this.selectedNode.getBindingContext().getObject().expanded=true}}if(this.selectedNode.getBindingContext().getObject().type===x.CONFIGURATION&&t){g.getRouterFor(this).navTo(this.selectedNode.getBindingContext().getObject().type,t,true);this.updateTree()}}},createConfigList:function(){var e=this;this.configList=this.configurationHandler.getList();this.configList.forEach(function(t,i){var a={};a.AnalyticalConfiguration=t.AnalyticalConfiguration;a.name=t.AnalyticalConfigurationName;a.Application=t.Application;a.type=x.CONFIGURATION;a.bIsLoaded=false;a.bToggleState=false;a.isSelected=false;a.expanded=false;a.selectable=true;a.hasExpander=true;e.oModel.getData().aConfigDetails.push(a);e.modelUpdateDeferred[i]=new jQuery.Deferred});this.oModel.updateBindings()},showNoConfigSelectedText:function(){this.byId("idConfigDetailData").removeAllContent();this.clearTitleAndBreadCrumb();var e=(new r).addStyleClass("noConfigSelected");e.setText(this.oCoreApi.getText("noConfigSelected"));e.placeAt(this.byId("idConfigDetailData"));this.toolbarController.disableCopyDeleteButton();this._enableDisableExportAndExecuteButton(false);this.byId("idConfigDetail").setBusy(false)},updateConfigListView:function(){this.selectedNode=this.oTreeInstance.getSelectedItems();if(this.selectedNode===null||this.selectedNode===undefined||this.selectedNode.length==0){if(this.configList.length>1){this.showNoConfigSelectedText()}else{this.oModel.getData().aConfigDetails[0].isSelected=true;this.oModel.getData().aConfigDetails[0].expanded=true;this.configId=this.oModel.getData().aConfigDetails[0].AnalyticalConfiguration;this.oModel.updateBindings();var e={appId:this.appId,configId:this.oModel.getData().aConfigDetails[0].AnalyticalConfiguration};this.selectedNode=this.oTreeInstance.getItems()[0];this.oTreeInstance.expand(0);this.toolbarController.enableCopyDeleteButton();this._enableDisableExportAndExecuteButton(true);g.getRouterFor(this).navTo(this.oModel.getData().aConfigDetails[0].type,e,true)}}},_getNodeData:function(e,t){var i=this.oModel.getData().aConfigDetails;var a={};var o=function(e){var t={};var a=e||this.configId;for(var o=0;o<i.length;o++){if(i[o].AnalyticalConfiguration===a){t.index=o;t.data=i[o];t.id=i[o].AnalyticalConfiguration;break}}return t};var n=function(t){var a=o.call(this,e[x.CONFIGURATION]).index;var n={};for(var r=0;r<i[a].configData.length;r++){if(i[a].configData[r].filters instanceof Array){n.indexConfigData=r;for(var s=0;s<i[a].configData[r].filters.length;s++){if(i[a].configData[r].filters[s].id===t){n.index=s;n.data=i[a].configData[r].filters[s];n.id=i[a].configData[r].filters[s].id;n.filterNodeExpansion=i[a].configData[r].expanded}}}}return n};var r=function(t){var a=o.call(this,e[x.CONFIGURATION]).index;var n={};for(var r=0;r<i[a].configData.length;r++){if(i[a].configData[r].categories instanceof Array){n.indexConfigData=r;for(var s=0;s<i[a].configData[r].categories.length;s++){if(i[a].configData[r].categories[s].id===t){n.index=s;n.data=i[a].configData[r].categories[s];n.id=i[a].configData[r].categories[s].id;n.categoryExpansion=i[a].configData[r].expanded}}}}return n};var s=function(t){var a=o.call(this,e[x.CONFIGURATION]).index;var n=r.call(this,e[x.CATEGORY]).indexConfigData;var s=r.call(this,e[x.CATEGORY]).index;var d={};for(var l=0;l<i[a].configData[n].categories[s].steps.length;l++){if(i[a].configData[n].categories[s].steps[l].id===t){d.index=l;d.data=i[a].configData[n].categories[s].steps[l];d.id=i[a].configData[n].categories[s].steps[l].id}}return d};var d=function(t){var a=o.call(this,e[x.CONFIGURATION]).index;var n=r.call(this,e[x.CATEGORY]).indexConfigData;var d=r.call(this,e[x.CATEGORY]).index;var l=s.call(this,e[x.STEP]).index;var g={};if(i[a].configData[n].categories[d].steps[l]){for(var f=0;f<i[a].configData[n].categories[d].steps[l].representations.length;f++){if(i[a].configData[n].categories[d].steps[l].representations[f].id===t){g.index=f;g.data=i[a].configData[n].categories[d].steps[l].representations[f];g.id=i[a].configData[n].categories[d].steps[l].representations[f].id}}}return g};var l=function(t){var a=o.call(this,e[x.CONFIGURATION]).index;var n={};for(var r=0;r<i[a].configData.length;r++){if(i[a].configData[r].navTargets instanceof Array){n.indexConfigData=r;for(var s=0;s<i[a].configData[r].navTargets.length;s++){if(i[a].configData[r].navTargets[s].id===t){n.index=s;n.data=i[a].configData[r].navTargets[s];n.id=i[a].configData[r].navTargets[s].id;n.nTExpansion=i[a].configData[r].expanded}}}}return n};switch(t){case x.CONFIGURATION:a=o.call(this,e[x.CONFIGURATION]);break;case x.FACETFILTER:a=n.call(this,e[x.FACETFILTER]);break;case x.SMARTFILTERBAR:a=n.call(this,e[x.SMARTFILTERBAR]);break;case x.CATEGORY:a=r.call(this,e[x.CATEGORY]);break;case x.STEP:a=s.call(this,e[x.STEP]);break;case x.REPRESENTATION:a=d.call(this,e[x.REPRESENTATION]);break;case x.NAVIGATIONTARGET:a=l.call(this,e[x.NAVIGATIONTARGET]);break;default:break}return a},_retainNodeState:function(e,t){var i=this._getNodeData(e,x.CONFIGURATION).index;if(!this.oModel.getData().aConfigDetails[i].bIsLoaded){return{}}var a=this._getNodeData(e,t);if(!a.data){return{}}return{expanded:a.data.expanded,isSelected:a.data.isSelected}},updateTree:function(){var t=this;var i=[],a=[],o=[],n={},r=[],s=[],d=[],l=[],g,f;this.oTextPool=this.configurationHandler.getTextPool();var c={};c[x.CONFIGURATION]=this.configId;var u=t._getNodeData(c,x.CONFIGURATION).index;var h=this.configId;var C=false;var p=false;var D=false;var I=Object.keys(this.configEditor.getFilterOption())[0];i=this.configEditor.getCategories();function v(){if(t.oModel.getData().aConfigDetails[u].bIsLoaded){f=t._getNodeData(c,I)}g=t._retainNodeState(c,I)}function b(e,i){var a=t.oCoreApi.getText("smartFilterBar");if(I===x.FACETFILTER){a=t.oTextPool.get(i.getLabelKey())?t.oTextPool.get(i.getLabelKey()).TextElementDescription:i.getLabelKey()}c[I]=i.getId();v();o.push({id:i.getId(),name:a,type:I,isSelected:g.isSelected||false,expanded:g.expanded||false,selectable:true,icon:e})}if(I===x.SMARTFILTERBAR){n=this.configEditor.getSmartFilterBar();b("sap-icon://filter",n)}else if(I===x.FACETFILTER){a=this.configEditor.getFacetFilters();a.forEach(function(e){var t=e.isVisible()?"sap-icon://filter":"sap-icon://hide";b(t,e)})}if(f&&f.filterNodeExpansion){C=true}r=this.configEditor.getNavigationTargets();var m=this.oCoreApi.getRepresentationTypes();var N={};m.forEach(function(e){var t=e.id;N[t]=e.picture});i.forEach(function(e){c[x.CATEGORY]=e.getId();var i=e;var a=i.getId();l=[];t.configEditor.getCategoryStepAssignments(a).forEach(function(e){var i=t.configEditor.getStep(e);c[x.CATEGORY]=a;c[x.STEP]=i.getId();var o=t._retainNodeState(c,x.STEP);var n=i.getRepresentations();var r=n.map(function(e){c[x.REPRESENTATION]=e.getId();var i=t._retainNodeState(c,x.REPRESENTATION);return{id:e.getId(),name:t.oCoreApi.getText(e.getRepresentationType()),type:"representation",isSelected:i.isSelected||false,expanded:i.expanded||false,selectable:true,icon:N[e.getRepresentationType()]}});l.push({id:i.getId(),name:t.oTextPool.get(i.getTitleId())?t.oTextPool.get(i.getTitleId()).TextElementDescription:i.getTitleId(),type:"step",representations:r,isSelected:o.isSelected||false,expanded:o.expanded||false,selectable:true,icon:i.getType()==="hierarchicalStep"?"sap-icon://drill-down":"sap-icon://step"})});var o=t._retainNodeState(c,x.CATEGORY);if(t.oModel.getData().aConfigDetails[u].bIsLoaded){var n=t._getNodeData(c,x.CATEGORY);if(n.categoryExpansion){D=true}}s.push({id:e.getId(),name:t.oTextPool.get(e.labelKey)?t.oTextPool.get(e.labelKey).TextElementDescription:e.labelKey,type:"category",steps:l,isSelected:o.isSelected||false,expanded:o.expanded||false,selectable:true,icon:"sap-icon://open-folder"})});d.push({filters:o,name:t.oCoreApi.getText("facetFilters"),expanded:C,selectable:false});d.push({categories:s,name:t.oCoreApi.getText("categories"),expanded:D,selectable:false});var y=[];var S=function(e,i){c[x.NAVIGATIONTARGET]=i.getId();var a=t._retainNodeState(c,x.NAVIGATIONTARGET);if(t.oModel.getData().aConfigDetails[u].bIsLoaded){var o=t._getNodeData(c,x.NAVIGATIONTARGET);if(o.nTExpansion){p=true}}var n,r;for(n=0;n<e.length;n++){if(e[n].id===i.getAction()){r=e[n].text;break}}if(i.getTitleKey()){r=t.configurationHandler.getTextPool().get(i.getTitleKey()).TextElementDescription}y.push({id:i.getId(),name:r||i.getSemanticObject(),type:"navigationTarget",isSelected:a.isSelected||false,expanded:a.expanded||false,selectable:true,icon:i.isStepSpecific()?"sap-icon://pushpin-off":"sap-icon://overview-chart"})};var A=function(){var e=r.map(function(e){return e.getId()});var t=[];for(var i=0;i<e.length;i++){for(var a=0;a<y.length;a++){if(e[i]===y[a].id){t[i]=y[a];break}}}y=t};var E=function(){var e={};e.configData=d;t.oModel.getData().aConfigDetails[u].bIsLoaded=true;var i=t.oModel.getData().aConfigDetails[u];T(i,e);t.oModel.getData().aConfigDetails[u]=i;t.oModel.getData().aConfigDetails[u].name=t.configurationHandler.getConfiguration(h).AnalyticalConfigurationName;for(var a=0;a<t.oModel.getData().aConfigDetails.length;a++){if(t.modelUpdateDeferred[a]&&t.modelUpdateDeferred[a].state()==="pending"&&r.length===0){t.modelUpdateDeferred[a].resolve(t.oModel.getData())}}if(i.configData[2].navTargets.length>0){t._setNavigationTargetName({configIndexInTree:u});t.modelUpdateDeferred[u].resolve(t.oModel.getData())}t.oModel.updateBindings()};r.forEach(function(i){var a=t.oCoreApi.getSemanticActions(i.getSemanticObject());a.then(function(a){S(a.semanticActions,i);if(y.length===r.length){A();if(d[2]){d.splice(2,2);d.push({navTargets:y,name:t.oCoreApi.getText("navigationTargets"),expanded:p,selectable:false});E();var o=e.params;if(o.name==="navigationTarget"){e.setCurrentSelectionState(o,t)}}}})});d.push({navTargets:y,name:t.oCoreApi.getText("navigationTargets"),expanded:p,selectable:false});E()},_checkIfKeyExists:function(e,t){var i;if(this.navTargetTextsTable[t]){this.navTargetTextsTable[t].texts.forEach(function(t,a){if(t.key===e){i=a}})}return i},_getNavigationTargetName:function(e){var t=this;var i;var a=new jQuery.Deferred;var o=t.getSPathForConfig(t.configId).split("/")[2];if(this.modelUpdateDeferred[o]===undefined){this.modelUpdateDeferred[o]=new jQuery.Deferred;this.modelUpdateDeferred[o].resolve(this.oModel.getData())}jQuery.when(this.modelUpdateDeferred[o]).done(function(n){var r=t._checkIfKeyExists(e,o);if(r!==undefined){i=t.navTargetTextsTable[o].texts[r].value;a.resolve(i)}});return a.promise()},_setNavigationTargetName:function(e){var t=e.configIndexInTree!==undefined?e.configIndexInTree:this.getSPathForConfig(this.configId).split("/")[2];if(v(this.navTargetTextsTable)){this.navTargetTextsTable={}}if(!this.navTargetTextsTable[t]){this.navTargetTextsTable[t]={texts:[]}}if(e.key&&e.value){var i=this._checkIfKeyExists(e.key,t);if(i===undefined){var a={};a.key=e.key;a.value=e.value;this.navTargetTextsTable[t].texts.push(a)}else{this.navTargetTextsTable[t].texts[i].value=e.value}}else{var o=this.oModel.getData().aConfigDetails[t].configData[2].navTargets;for(var n=0;n<o.length;n++){var r={};r.key=o[n].id;r.value=o[n].name;this.navTargetTextsTable[e.configIndexInTree].texts.push(r)}}},_handleToggleTreeNode:function(e){var t=this;var i=e.getSource().getSelectedItems();if(i&&i.length>0){var a=i[0]._getBindingContext().sPath;var o=i[0]._getBindingContext().getObject().type;if(o===x.CONFIGURATION){var n=a.split("/")[2];if(t.oModel.getData().aConfigDetails[n].bIsLoaded===true){this.oModel.updateBindings()}else{this.configurationHandler.loadConfiguration(this.oModel.getData().aConfigDetails[n].AnalyticalConfiguration,function(e,i){if(i===undefined){t.configEditor=e;t.configId=t.oModel.getData().aConfigDetails[n].AnalyticalConfiguration;t.updateTree()}})}}}},getSPathForConfig:function(e){var t;this.oModel.getData().aConfigDetails.forEach(function(i,a){if(i.AnalyticalConfiguration===e){t="/aConfigDetails/"+a}});return t},getSPathFromURL:function(e){var t={sPath:undefined,objectType:undefined};var i=this;this.oModel.getData().aConfigDetails.forEach(function(a,o){if(a.AnalyticalConfiguration===e.arguments.configId){t.sPath="/aConfigDetails/"+o;t.objectType=x.CONFIGURATION;i.oModel.getData().aConfigDetails[o].expanded=true;if(e.arguments.categoryId!==undefined){i.oModel.getData().aConfigDetails[o].configData[1].categories.forEach(function(a,n){if(a.id===e.arguments.categoryId){t.sPath=t.sPath.concat("/configData/1/categories/"+n);t.objectType=x.CATEGORY;i.oModel.getData().aConfigDetails[o].configData[1].expanded=true;if(e.arguments.stepId!==undefined){i.oModel.getData().aConfigDetails[o].configData[1].categories[n].steps.forEach(function(a,r){if(a.id===e.arguments.stepId){t.sPath=t.sPath.concat("/steps/"+r);t.objectType=x.STEP;i.oModel.getData().aConfigDetails[o].configData[1].categories[n].expanded=true;if(e.arguments.representationId!==undefined){i.oModel.getData().aConfigDetails[o].configData[1].categories[n].steps[r].representations.forEach(function(a,s){if(a.id===e.arguments.representationId){i.oModel.getData().aConfigDetails[o].configData[1].categories[n].steps[r].expanded=true;t.sPath=t.sPath.concat("/representations/"+s);t.objectType=x.REPRESENTATION}})}}})}}})}if(e.arguments.facetFilterId!==undefined){i.oModel.getData().aConfigDetails[o].configData[0].filters.forEach(function(a,n){if(a.id===e.arguments.facetFilterId){t.sPath=t.sPath.concat("/configData/0/filters/"+n);t.objectType=x.FACETFILTER;i.oModel.getData().aConfigDetails[o].configData[0].expanded=true}})}if(e.arguments.smartFilterId!==undefined){t.sPath=t.sPath.concat("/configData/0/filters/0");t.objectType=x.SMARTFILTERBAR;i.oModel.getData().aConfigDetails[o].configData[0].expanded=true}if(e.arguments.navTargetId!==undefined){i.oModel.getData().aConfigDetails[o].configData[2].navTargets.forEach(function(a,n){if(a.id===e.arguments.navTargetId){t.sPath=t.sPath.concat("/configData/2/navTargets/"+n);t.objectType=x.NAVIGATIONTARGET;i.oModel.getData().aConfigDetails[o].configData[2].expanded=true}})}}});return t},_navHandleExpandDelete:function(e,t,i){var a=this;this.selectedNode=this.oTreeInstance.getSelectedItem();var o=this.oModel.getData().aConfigDetails;var n=i||this.oTreeInstance.isConfigurationSwitched(this.oPreviousSelectedNode,this.selectedNode);var r=function(e){var t;for(var i=0;i<o.length;i++){if(o[i].AnalyticalConfiguration===e){t=i;break}}return t};var s=function(e){var i=r.call(this,t.configId);var a,n;for(var s=0;s<o[i].configData.length;s++){if(o[i].configData[s].filters instanceof Array){a=s;for(var d=0;d<o[i].configData[s].filters.length;d++){if(o[i].configData[s].filters[d].id===e){n=d;break}else{n=d}}}}return{indexConfig:a,indexFilter:n}};var d=function(e){var i=r.call(this,t.configId);var a,n;for(var s=0;s<o[i].configData.length;s++){if(o[i].configData[s].navTargets instanceof Array){a=s;for(var d=0;d<o[i].configData[s].navTargets.length;d++){if(o[i].configData[s].navTargets[d].id===e){n=d;break}else{n=d}}}}return{indexConfig:a,indexNavTarget:n}};var l=function(e){var i=r.call(this,t.configId);var a,n;for(var s=0;s<o[i].configData.length;s++){if(o[i].configData[s].categories instanceof Array){a=s;for(var d=0;d<o[i].configData[s].categories.length;d++){if(o[i].configData[s].categories[d].id===e){n=d;break}else{n=d}}}}return{indexConfig:a,indexCategory:n}};var g=function(e){var i=r.call(this,t.configId);var a=l.call(this,t.categoryId).indexConfig;var n=l.call(this,t.categoryId).indexCategory;var s;for(var d=0;d<o[i].configData[a].categories[n].steps.length;d++){if(o[i].configData[a].categories[n].steps[d].id===e){s=d;break}else{s=d}}return s};if(t.configId.indexOf(x.ISNEWCONFIG)===0&&n){this.configurationHandler.removeConfiguration(t.configId,function(e){var i=a.oModel.getData().aConfigDetails;var o=r.call(a,t.configId);a._deleteConfigNavTargetTexts(o,i.length);i.splice(o,1);a.oModel.getData().aConfigDetails=i})}else{var f,c,u,h,C,p;switch(e.nodeObjectType){case x.CONFIGURATION:f=r.call(this,t.configId);this.oModel.getData().aConfigDetails[f].isSelected=true;this.oModel.getData().aConfigDetails[f].expanded=true;break;case x.FACETFILTER:f=r.call(this,t.configId);c=s.call(this,t.facetFilterId).indexConfig;u=s.call(this,t.facetFilterId).indexFilter;this.oModel.getData().aConfigDetails[f].expanded=true;this.oModel.getData().aConfigDetails[f].configData[c].expanded=true;this.oModel.getData().aConfigDetails[f].configData[c].filters[u].expanded=true;break;case x.CATEGORY:f=r.call(this,t.configId);c=l.call(this,t.categoryId).indexConfig;h=l.call(this,t.categoryId).indexCategory;this.oModel.getData().aConfigDetails[f].expanded=true;this.oModel.getData().aConfigDetails[f].configData[c].expanded=true;break;case x.STEP:f=r.call(this,t.configId);c=l.call(this,t.categoryId).indexConfig;h=l.call(this,t.categoryId).indexCategory;C=g.call(this,t.stepId);this.oModel.getData().aConfigDetails[f].expanded=true;this.oModel.getData().aConfigDetails[f].configData[c].expanded=true;this.oModel.getData().aConfigDetails[f].configData[c].categories[h].expanded=true;break;case x.REPRESENTATION:f=r.call(this,t.configId);c=l.call(this,t.categoryId).indexConfig;h=l.call(this,t.categoryId).indexCategory;C=g.call(this,t.stepId);this.oModel.getData().aConfigDetails[f].expanded=true;this.oModel.getData().aConfigDetails[f].configData[c].expanded=true;this.oModel.getData().aConfigDetails[f].configData[c].categories[h].expanded=true;this.oModel.getData().aConfigDetails[f].configData[c].categories[h].steps[C].expanded=true;break;case x.NAVIGATIONTARGET:f=r.call(this,t.configId);c=d.call(this,t.navTargetId).indexConfig;p=d.call(this,t.navTargetId).indexNavTarget;this.oModel.getData().aConfigDetails[f].expanded=true;this.oModel.getData().aConfigDetails[f].configData[c].expanded=true;this.oModel.getData().aConfigDetails[f].configData[c].navTargets[p].expanded=true;break;default:break}}this.oModel.updateBindings()},_isNewSubView:function(e){var t=false;if(e.arguments.configId.indexOf(x.ISNEWCONFIG)===0){t=true}else{if(e.name===x.CONFIGURATION){t=this.configurationHandler.getConfiguration(e.arguments.configId)!==undefined?false:true}else if(e.name===x.CATEGORY){t=this.configEditor.getCategory(e.arguments.categoryId)!==undefined?false:true}else if(e.name===x.FACETFILTER){t=this.configEditor.getFacetFilter(e.arguments.facetFilterId)!==undefined?false:true}else if(e.name===x.STEP){t=this.configEditor.getStep(e.arguments.stepId)!==undefined?false:true}else if(e.name===x.REPRESENTATION){t=this.configEditor.getStep(e.arguments.stepId).getRepresentation(e.arguments.representationId)!==undefined?false:true}else if(e.name===x.NAVIGATIONTARGET){t=this.configEditor.getNavigationTarget(e.arguments.navTargetId)!==undefined?false:true}}return t},_getCurrentConfigurationNode:function(){var e=this.oTreeInstance.getItems();var t=this.configId;for(var i=0;i<e.length;i++){if(t===e[i]._getBindingContext().getObject().AnalyticalConfiguration){return e[i]}}return undefined},_navMandatoryResetState:function(e,t){var i=e;e.selectedNode=e.oTreeInstance.getSelectedItem();i.bIsSaved=i.configEditor?i.configEditor.isSaved():undefined;var a=typeof i.byId("idConfigDetailData").getContent()[0].getController==="function"?i.byId("idConfigDetailData").getContent()[0].getController():undefined;e.configurationHandler.memorizeConfiguration(a.getView().getViewData().oParams.arguments.configId);var o=this._isNewSubView(a.getView().getViewData().oParams);if(!o){i.updateTree();var n=i.selectedNode._getBindingContext().getObject();if(n){n.isSelected=true;var r=a.getView().getViewData().oParams.name;var s=x;if(r!==s.REPRESENTATION){a.updateSubViewInstancesOnReset(i.configEditor)}else{a.oConfigurationEditor=i.configEditor}a.setDetailData.call(a);i.updateTitleAndBreadCrumb()}else{i.oTreeInstance.setSelectedItem(i._getCurrentConfigurationNode())}if(typeof t==="function"){t()}}else{i.handleConfirmDeletion()}return{bIsSaved:i.bIsSaved,isNewView:o}},_navSaveState:function(e){e()},_navConfigResetState:function(e,t){var i=e;var a=typeof i.byId("idConfigDetailData").getContent()[0].getController==="function"?i.byId("idConfigDetailData").getContent()[0].getController():undefined;var o=this._isNewSubView(a.getView().getViewData().oParams);if(!o){i.configurationHandler.loadConfiguration(i.configId,function(e,a){if(a===undefined){var o=typeof i.byId("idConfigDetailData").getContent()[0].getController==="function"?i.byId("idConfigDetailData").getContent()[0].getController():undefined;i.configEditor=e;i.updateTree();var n=i.selectedNode._getBindingContext().getObject();if(n){n.isSelected=true;var r=o.getView().getViewData().oParams.name;var s=x;if(r!==s.REPRESENTATION){o.updateSubViewInstancesOnReset(i.configEditor)}else{o.oConfigurationEditor=i.configEditor}o.setDetailData.call(o);i.updateTitleAndBreadCrumb()}else{i.oTreeInstance.setSelectedItem(i._getCurrentConfigurationNode())}if(typeof t==="function"){t()}}})}else{i.handleConfirmDeletion()}},_onTreeNodeSelection:function(e){this.selectedNode=this.oTreeInstance.getSelectedItem();var t=this;var i,o,n;if(!this.bProgramaticSelection){this.oPreviousSelectedNode=this.oTreeInstance.previousSelectedItem;this.bIsDifferntConfig=this.oTreeInstance.isConfigurationSwitched(this.oPreviousSelectedNode,this.selectedNode);this.oSelectedNodeDetails=this.oTreeInstance.getAPFTreeNodeContext(this.selectedNode);this.oParentNodeDetails=this.oTreeInstance.getParentNodeContext(this.oSelectedNodeDetails);this._enableDisableExportAndExecuteButton(true);var r;if(this.byId("idConfigDetailData").getContent().length>=1){r=typeof this.byId("idConfigDetailData").getContent()[0].getController==="function"?this.byId("idConfigDetailData").getContent()[0].getController():undefined}var s=this.selectedNode?this.selectedNode.getId():null;var d=this.oPreviousSelectedNode?this.oPreviousSelectedNode.getId():null;var l=function(){if(t.oPreviousSelectedNode){var e=t.selectedNode.getBindingContext().getObject();e.isSelected=false;t.oModel.updateBindings()}};if(s!==d||this.bNavDeletionMode){var g=a.getInstance();var f;if(r!==undefined){f=typeof r.getValidationState==="function"?r.getValidationState.call(r):true}else{f=true}var c=this.configEditor?I({},this.configEditor):undefined;this.bIsSaved=c?c.isSaved():undefined;var u;var h=false;var C=this.configurationHandler.getList();if(!f&&C.length>0){g.throwMandatoryPopup(this,{yes:function(){var e=typeof t.byId("idConfigDetailData").getContent()[0].getController==="function"?t.byId("idConfigDetailData").getContent()[0].getController():undefined;var i=t._isNewSubView(e.getView().getViewData().oParams);if(!i){var a=function(e){t.configEditor=t.configurationHandler.restoreMemorizedConfiguration(t.oParentNodeDetails.configId);if(t.bIsSaved===false&&t.configEditor){t.configEditor.setIsUnsaved()}if(typeof e==="function"){e()}t.updateTree();var i=t.selectedNode.getBindingContext().getObject();t.navigateToDifferntView(t.oParentNodeDetails,t.oSelectedNodeDetails);i.isSelected=true;t.oModel.updateBindings()};if(t.bIsSaved===false&&t.bIsDifferntConfig){u(false,function(){a.call(t)})}else{a.call(t)}}else{if(t.bIsSaved===false&&t.bIsDifferntConfig){u(false,function(){var e=t.selectedNode.getBindingContext().sPath;var i=t.oPreviousSelectedNode;t.handleConfirmDeletion(i,e)})}else{var o=t.selectedNode.getBindingContext().sPath;var n=t.oPreviousSelectedNode;t.handleConfirmDeletion(n,o)}}t._navHandleExpandDelete.call(t,t.oSelectedNodeDetails,t.oParentNodeDetails)},no:function(){l()}});h=true}u=function(e){if(r){t.configurationHandler.memorizeConfiguration(r.getView().getViewData().oParams.arguments.configId)}g.throwLossOfDataPopup(t,{yes:function(a){if(typeof e==="function"){e(function(){a(function(){var e;if(t.oPreviousSelectedNode){var i=t.oPreviousSelectedNode._getBindingContext().sPath;var a=i.split("/");e=a[2]}t.oModel.getData().aConfigDetails[e].AnalyticalConfiguration=t.configId})})}else{if(t.oPreviousSelectedNode){i=t.oTreeInstance.getAPFTreeNodeContext(t.oPreviousSelectedNode);o=t.oTreeInstance.getParentNodeContext(i);n=t.configurationHandler.restoreMemorizedConfiguration(o.configId);if(n){t.configEditor=n}}a(function(){var e;if(t.oPreviousSelectedNode){var i=t.oPreviousSelectedNode._getBindingContext().sPath;var a=i.split("/");e=a[2]}t.oModel.getData().aConfigDetails[e].AnalyticalConfiguration=t.configId;var o=t.selectedNode._getBindingContext().getObject();t.navigateToDifferntView(t.oParentNodeDetails,t.oSelectedNodeDetails);o.isSelected=true;t.oModel.updateBindings()})}},no:function(){t.configurationHandler.loadConfiguration(t.configId,function(e,i){if(i===undefined){t.configEditor=e;if(t.configId.indexOf(x.ISNEWCONFIG)===0){t._navHandleExpandDelete.call(t,{},{configId:t.configId},t.oParentNodeDetails)}else{t.updateTree()}t.navigateToDifferntView(t.oParentNodeDetails,t.oSelectedNodeDetails);t._navHandleExpandDelete.call(t,t.oSelectedNodeDetails,t.oParentNodeDetails)}})},cancel:function(){l()}})};if(t.bIsSaved===false&&t.bIsDifferntConfig&&f){u();h=true}if(!h){if(this.oPreviousSelectedNode&&this.oPreviousSelectedNode.getId()!==this.selectedNode.getId()){var p=this.oPreviousSelectedNode.getBindingContext().getObject();if(p){this.oPreviousSelectedNode.getBindingContext().getObject().isSelected=false}}else{this.selectedNode.getBindingContext().getObject().isSelected=true}this.navigateToDifferntView(this.oParentNodeDetails,this.oSelectedNodeDetails,this.bIsSaved,this.bIsDifferntConfig)}this.oTreeInstance.previousSelectedItem=this.oTreeInstance.getSelectedItem()}}this.bProgramaticSelection=false;this.bNavDeletionMode=false},navigateToDifferntView:function(e,t,i,a){if(!v(e)&&(i===undefined||i)||!a){g.getRouterFor(this).navTo(t.nodeObjectType,e,true)}},_deleteConfigNavTargetTexts:function(e,t){var i=this;var a;for(var o=e;o<t-1;o++){this.modelUpdateDeferred[o]=this.modelUpdateDeferred[o+1]}delete this.modelUpdateDeferred[t-1];if(this.navTargetTextsTable){if(this.navTargetTextsTable[e]){delete this.navTargetTextsTable[e]}if(e!==t-1){Object.keys(this.navTargetTextsTable).forEach(function(t){t=parseInt(t,10);if(t>e){i.navTargetTextsTable[t-1]=i.navTargetTextsTable[t];a=t}});if(a!==undefined){delete this.navTargetTextsTable[a]}}}},handleConfirmDeletion:function(e,t){var i=e===undefined||typeof e.preventDefault==="function"?this.oTreeInstance.getAPFTreeNodeContext(this.oTreeInstance.getSelectedItem()):this.oTreeInstance.getAPFTreeNodeContext(e);var a=this;this.selectedNode=this.oTreeInstance.getSelectedItem();var o,n,s,d,l,f,c,u,h,C;l=i.nodeContext;d=l.split("/");f=d[2];switch(i.nodeObjectType){case x.FACETFILTER:this.configEditor.removeFacetFilter(i.nodeAPFId);c=d[6];var p=this.oModel.getData().aConfigDetails[f].configData[0].filters;p.splice(c,1);this.oModel.getData().aConfigDetails[f].configData[0].filters=p;s=d.slice(0,3);n=s.join("/");break;case x.CATEGORY:this.configEditor.removeCategory(i.nodeAPFId);u=d[6];var D=this.oModel.getData().aConfigDetails[f].configData[1].categories;D.splice(u,1);this.oModel.getData().aConfigDetails[f].configData[1].categories=D;s=d.slice(0,3);n=s.join("/");break;case x.NAVIGATIONTARGET:this.configEditor.removeNavigationTarget(i.nodeAPFId);h=d[6];var I=this.oModel.getData().aConfigDetails[f].configData[2].navTargets;I.splice(h,1);this.oModel.getData().aConfigDetails[f].configData[2].navTargets=I;s=d.slice(0,3);n=s.join("/");break;case x.STEP:var T=this.configEditor.getCategoriesForStep(i.nodeAPFId);var v=i.nodeContext.split("/");f=v[2];T.forEach(function(e){a.configEditor.removeCategoryStepAssignment(e,i.nodeAPFId);a.oModel.getData().aConfigDetails[f].configData[1].categories.forEach(function(t,o){if(t.id===e){a.oModel.getData().aConfigDetails[f].configData[1].categories[o].steps.forEach(function(e,t){if(e.id===i.nodeAPFId){var n=a.oModel.getData().aConfigDetails[f].configData[1].categories[o].steps;n.splice(t,1);a.oModel.getData().aConfigDetails[f].configData[1].categories[o].steps=n}})}})});s=d.slice(0,7);n=s.join("/");break;case x.REPRESENTATION:u=d[6];C=d[8];var b=this.oModel.getData().aConfigDetails[f].configData[1].categories[u].steps[C].id;var m=this.configEditor.getStep(b);var N=this.configEditor.getCategoriesForStep(b);m.removeRepresentation(i.nodeAPFId);N.forEach(function(e){a.oModel.getData().aConfigDetails[f].configData[1].categories.forEach(function(t,o){if(t.id===e){a.oModel.getData().aConfigDetails[f].configData[1].categories[o].steps.forEach(function(e,t){if(e.id===b){a.oModel.getData().aConfigDetails[f].configData[1].categories[o].steps[t].representations.forEach(function(e,n){if(e.id===i.nodeAPFId){var r=a.oModel.getData().aConfigDetails[f].configData[1].categories[o].steps[t].representations;r.splice(n,1);a.oModel.getData().aConfigDetails[f].configData[1].categories[o].steps[t].representations=r}})}})}})});s=d.slice(0,9);n=s.join("/");break;case x.CONFIGURATION:var y=false;if(i.nodeAPFId.indexOf("newConfig")===0){y=true}if(!y){this.configurationHandler.removeConfiguration(i.nodeAPFId,function(e){var i;var o=a.oModel.getData().aConfigDetails;a._deleteConfigNavTargetTexts(parseInt(f,10),o.length);var n=a.configurationHandler.getList().length>0?true:false;o.splice(f,1);a.oModel.getData().aConfigDetails=o;a.oModel.updateBindings();if(t){var s=a.oTreeInstance.getParentNodeContext(a.oTreeInstance.getAPFTreeNodeContext(a.selectedNode));g.getRouterFor(a).navTo(a.selectedNode._getBindingContext().getObject().type,s,true)}else{a.clearTitleAndBreadCrumb();a.byId("idConfigDetailData").removeAllContent();if(n){i=(new r).addStyleClass("noConfigSelected");i.setText(a.oCoreApi.getText("noConfigSelected"));i.placeAt(a.byId("idConfigDetailData"));a.toolbarController.disableCopyDeleteButton();a._enableDisableExportAndExecuteButton(false)}else{i=(new r).addStyleClass("addNewConfig");i.setText(a.oCoreApi.getText("addNewConfig"));i.placeAt(a.byId("idConfigDetailData"));a.toolbarController.disableCopyDeleteButton();a._enableDisableExportAndExecuteButton(false)}}})}else{var S;var A=a.oModel.getData().aConfigDetails;A.splice(f,1);a.oModel.getData().aConfigDetails=A;a.oModel.updateBindings();if(t){var E=a.oTreeInstance.getParentNodeContext(a.oTreeInstance.getAPFTreeNodeContext(a.selectedNode));g.getRouterFor(a).navTo(a.selectedNode._getBindingContext().getObject().type,E,true)}else{a.clearTitleAndBreadCrumb();a.byId("idConfigDetailData").removeAllContent();var P=this.configurationHandler.getList().length>0?true:false;if(P){S=(new r).addStyleClass("noConfigSelected");S.setText(a.oCoreApi.getText("noConfigSelected"));S.placeAt(a.byId("idConfigDetailData"));a.toolbarController.disableCopyDeleteButton();a._enableDisableExportAndExecuteButton(false)}else{S=(new r).addStyleClass("addNewConfig");S.setText(a.oCoreApi.getText("addNewConfig"));S.placeAt(a.byId("idConfigDetailData"));a.toolbarController.disableCopyDeleteButton();a._enableDisableExportAndExecuteButton(false)}}}break;default:break}if(t){this.bNavDeletionMode=true}if(i.nodeObjectType!==x.CONFIGURATION){this.configEditor.setIsUnsaved();this.clearTitleAndBreadCrumb();this.byId("idConfigDetailData").removeAllContent();n=t||n;o=this.oTreeInstance.getModel().getContext(n);this.oModel.updateBindings();this.selectedNode=this.oTreeInstance.getItemNodeByContextWithoutExpand(o.sPath);this.bProgramaticSelection=false;this.oTreeInstance.setSelectedItem(this.selectedNode);if(t){this.selectedNode.getBindingContext().getObject().isSelected=true;this.oModel.updateBindings()}}var M=this.toolbarController.confirmationDialog===undefined?false:this.toolbarController.confirmationDialog.isOpen;if(M&&!t){this.toolbarController.confirmationDialog.close()}},handleNavBack:function(){var e;var t=this;if(this.byId("idConfigDetailData").getContent().length>=1){e=typeof this.byId("idConfigDetailData").getContent()[0].getController==="function"?this.byId("idConfigDetailData").getContent()[0].getController():undefined}this.selectedNode=this.oTreeInstance.getSelectedItem();this.oSelectedNodeDetails=this.oTreeInstance.getAPFTreeNodeContext(this.selectedNode);this.oParentNodeDetails=this.oTreeInstance.getParentNodeContext(this.oSelectedNodeDetails);var i=a.getInstance();var o;if(e!==undefined){o=typeof e.getValidationState==="function"?e.getValidationState.call(e):true}else{o=true}this.bIsSaved=this.configEditor?this.configEditor.isSaved():undefined;var n=t.configurationHandler.getList().length>0?true:false;var r=function(e){if(this.selectedNode){this.selectedNode=null}this.oModel=new C({aConfigDetails:[]});this.getView().setModel(this.oModel);this.configEditor=undefined;this.navTargetTextsTable={};window.history.go(-1)};if(n){var s=t.bIsSaved===undefined?true:t.bIsSaved;if(!o){i.throwMandatoryPopup(t,{yes:function(){t.configEditor=t.configurationHandler.restoreMemorizedConfiguration(e.getView().getViewData().oParams.arguments.configId);if(t.bIsSaved===false&&t.configEditor){t.configEditor.setIsUnsaved()}var a=t._navMandatoryResetState(t);var o=t.configurationHandler.getList();if(a.bIsSaved===false&&o.length>0){i.throwLossOfDataPopup(t,{yes:function(e){e();r.call(t)},no:function(){if(t.configId.indexOf(x.ISNEWCONFIG)===0){t._navHandleExpandDelete.call(t,{},{configId:t.configId},t.oParentNodeDetails)}r.call(t)}})}else{r.call(t)}}});return}else if(!s&&o){i.throwLossOfDataPopup(t,{yes:function(e){e();r.call(t)},no:function(){t.configurationHandler.resetConfiguration(t.configId);if(t.configId.indexOf(x.ISNEWCONFIG)===0){t._navHandleExpandDelete.call(t,{},{configId:t.configId},t.oParentNodeDetails)}r.call(t)}});return}}r.call(t)},handleSavePress:function(){var e,t;var i=this;this.selectedNode=this.oTreeInstance.getSelectedItems();if(this.selectedNode){var o=this.selectedNode[0].getBindingContext().sPath;var n=o.split("/");t=n[2]}if(this.byId("idConfigDetailData").getContent().length>=1){e=typeof this.byId("idConfigDetailData").getContent()[0].getController==="function"?this.byId("idConfigDetailData").getContent()[0].getController():undefined}var r=function(){var i=this;var a;i.configEditor.save(function(o,n,r){if(r===undefined){i.configurationHandler.memorizeConfiguration(e.getView().getViewData().oParams.arguments.configId);i.oModel.getData().aConfigDetails[t].AnalyticalConfiguration=o;i.oModel.updateBindings();i.oSelectedNodeDetails=i.oTreeInstance.getAPFTreeNodeContext(i.selectedNode[0]);i.oParentNodeDetails=i.oTreeInstance.getParentNodeContext(i.oSelectedNodeDetails);i.navigateToDifferntView(i.oParentNodeDetails,i.oSelectedNodeDetails,true,false);a=i.oCoreApi.createMessageObject({code:"11513"});i.oCoreApi.putMessage(a)}else{a=i.oCoreApi.createMessageObject({code:"11514"});i.oCoreApi.putMessage(a)}})};var s=a.getInstance();var d;if(e!==undefined){d=typeof e.getValidationState==="function"?e.getValidationState.call(e):true}else{d=true}var l=this.configEditor?I({},this.configEditor):undefined;this.bIsSaved=l?l.isSaved():undefined;var g=false;if(!d){s.throwMandatoryPopup(i,{yes:function(){i.configEditor=i.configurationHandler.restoreMemorizedConfiguration(e.getView().getViewData().oParams.arguments.configId);if(i.bIsSaved===false&&i.configEditor){i.configEditor.setIsUnsaved()}i._navMandatoryResetState(i);r.call(i)}});g=true}if(!g){r.call(this);this.toolbarController.closeDialog()}},_handleExportButtonPress:function(){var e;if(this.byId("idConfigDetailData").getContent().length>=1){e=typeof this.byId("idConfigDetailData").getContent()[0].getController==="function"?this.byId("idConfigDetailData").getContent()[0].getController():undefined}var t=function(){if(!this.exportConfigurationDialog){d.load({id:"idExportConfigurationFragment",name:"sap.apf.modeler.ui.fragment.exportConfiguration",controller:this}).then(function(t){this.exportConfigurationDialog=t;this.getView().addDependent(this.exportConfigurationDialog);this._setExportConfigDialogText();this._addStyleClassForExportDialog();this.configurationHandler.memorizeConfiguration(e.getView().getViewData().oParams.arguments.configId);b("sapUiSizeCompact",this.getView(),this.exportConfigurationDialog);this.exportConfigurationDialog.open()}.bind(this))}else{b("sapUiSizeCompact",this.getView(),this.exportConfigurationDialog);this.exportConfigurationDialog.open()}};this._performExportOrExecute(t.bind(this))},handlePublishPress:function(){if(this.oCoreApi.isUsingCloudFoundryProxy()){D.showShareDialog(this.oCoreApi,this)}},_enableDisableExportAndExecuteButton:function(e){this.byId("idExportbutton").setEnabled(e);this.byId("idExecuteButton").setEnabled(e);this.byId("idPublishbutton").setEnabled(e)},_setExportConfigDialogText:function(){d.byId("idExportConfigurationFragment","idExportConfigDialog").setTitle(this.oCoreApi.getText("exportConfig"));d.byId("idExportConfigurationFragment","idDownloadConfig").setText(this.oCoreApi.getText("downloadConfig"));d.byId("idExportConfigurationFragment","idDownloadTextProperty").setText(this.oCoreApi.getText("downloadTextProperty"));d.byId("idExportConfigurationFragment","idCloseButton").setText(this.oCoreApi.getText("close"))},_addStyleClassForExportDialog:function(){d.byId("idExportConfigurationFragment","idDownloadConfig").addStyleClass("configLink");d.byId("idExportConfigurationFragment","idDownloadTextProperty").addStyleClass("textPropertyLink")},_handleCloseOfExportDialog:function(){if(this.exportConfigurationDialog.isOpen()){this.exportConfigurationDialog.close()}},_handleOpenConfigLinkPress:function(){this.configurationHandler.exportConfiguration(this.configId,function(e,t){h.save(e,t,"json","application/json","utf-8")})},_handleOpenTextsLinkPress:function(){var e=this.configurationHandler.getConfiguration(this.configId).AnalyticalConfigurationName;var t=this.configurationHandler.exportTexts(this.configId);h.save(t,e,"properties","text/plain","utf-8")},_performExportOrExecute:function(e){var t,i,o,n,s,d,l,g;var f=false;var c=true;var u=this;u.selectedNode=u.oTreeInstance.getSelectedItem();u.oSelectedNodeDetails=u.oTreeInstance.getAPFTreeNodeContext(u.selectedNode);u.oParentNodeDetails=u.oTreeInstance.getParentNodeContext(u.oSelectedNodeDetails);var h=a.getInstance();if(this.byId("idConfigDetailData").getContent().length>=1){t=typeof this.byId("idConfigDetailData").getContent()[0].getController==="function"?this.byId("idConfigDetailData").getContent()[0].getController():undefined}if(t!==undefined){c=typeof t.getValidationState==="function"?t.getValidationState.call(t):true}var C=this.configEditor?I({},this.configEditor):undefined;this.bIsSaved=C?C.isSaved():undefined;var p=function(e){u.byId("idConfigDetailData").removeAllContent();if(e){l=(new r).addStyleClass("noConfigSelected");l.setText(u.oCoreApi.getText("noConfigSelected"))}else{l=(new r).addStyleClass("addNewConfig");l.setText(u.oCoreApi.getText("addNewConfig"))}l.placeAt(u.byId("idConfigDetailData"));u.toolbarController.disableCopyDeleteButton();u._enableDisableExportAndExecuteButton(false)};if(!c){h.throwMandatoryPopup(u,{yes:function(){u.configEditor=u.configurationHandler.restoreMemorizedConfiguration(t.getView().getViewData().oParams.arguments.configId);if(u.bIsSaved===false&&u.configEditor){u.configEditor.setIsUnsaved()}o=u._navMandatoryResetState(u);n=u.configurationHandler.getList().length>0?true:false;if(n){if(o.bIsSaved===false){i()}else{if(u.oParentNodeDetails.configId.indexOf("newConfig")!==0){e()}}}else{p(n)}}});f=true}i=function(){h.throwLossOfDataPopup(u,{yes:function(t){u._navSaveState(function(){t(function(t){if(u.selectedNode){s=u.selectedNode._getBindingContext().sPath;g=s.split("/");d=g[2]}u.oModel.getData().aConfigDetails[d].AnalyticalConfiguration=u.configId;u.oModel.updateBindings();e()})})},no:function(){if(u.configId.indexOf(x.ISNEWCONFIG)===0){u._navHandleExpandDelete.call(u,{},{configId:u.configId},u.oParentNodeDetails);u.clearTitleAndBreadCrumb();u.byId("idConfigDetailData").removeAllContent();n=u.configurationHandler.getList().length>0?true:false;p(n)}else{u._navConfigResetState(u,function(){u._navHandleExpandDelete.call(u,u.oSelectedNodeDetails,u.oParentNodeDetails);e()})}}})};if(u.bIsSaved===false&&c){i();f=true}if(!f){e()}},handleExecuteButtonPress:function(){var e=this.oTreeInstance.getSelectedItem();var t=function(){var t=this.oTreeInstance.getAPFTreeNodeContext(e);var i=this.oTreeInstance.getParentNodeContext(t);this.oCoreApi.navigateToGenericRuntime(i.appId,i.configId,p);this.configurationHandler.memorizeConfiguration(i.configId)};this._performExportOrExecute(t.bind(this))},getStepConfigDataBysPath:function(e){var t=e.split("/");var i=t[2],a=t[4],o=t[6],n=t[8];var r=this.oModel.getData().aConfigDetails[i].configData[a].categories[o].steps[n];return r}})});
//# sourceMappingURL=configurationList.controller.js.map