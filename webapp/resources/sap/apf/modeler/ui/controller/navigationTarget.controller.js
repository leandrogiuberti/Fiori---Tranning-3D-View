sap.ui.define(["sap/apf/modeler/ui/utils/constants","sap/apf/modeler/ui/utils/nullObjectChecker","sap/apf/modeler/ui/utils/optionsValueModelBuilder","sap/apf/modeler/ui/utils/staticValuesBuilder","sap/apf/modeler/ui/utils/textPoolHelper","sap/apf/modeler/ui/utils/viewValidator","sap/m/MessageBox","sap/ui/core/mvc/Controller","sap/ui/core/mvc/View","sap/ui/core/mvc/ViewType","sap/ui/thirdparty/jquery"],function(e,t,i,a,n,o,r,s,d,c,jQuery){"use strict";var g,l,u,f,v,p,m,b;var I;var y=n.TranslationFormatMap.NAVTARGET_TITLE;function T(e){e.byId("idNavigationTargetHeaderLabel").setText(l("basicData"));e.byId("idSemanticObjectLabel").setText(l("semanticObject"));e.byId("idActionLabel").setText(l("action"));e.byId("idDescriptionLabel").setText(l("navigationTargetTitle"));e.byId("idNavigationParametersHeaderLabel").setText(l("navigationParametersHeader"));e.byId("idNavigationTargetTypeHeaderLabel").setText(l("navigationTargetType"));e.byId("idNavigationTargetTypeLabel").setText(l("assignmentType"));e.byId("idAssignedStepsLabel").setText(l("assignedSteps"));e.byId("idContextMapping").setText(l("contextMapping"))}function h(e){var i;if(g&&g.arguments&&g.arguments.navTargetId){p=v.getNavigationTarget(g.arguments.navTargetId)}if(!t.checkIsNotUndefined(p)){i=v.createNavigationTarget();p=v.getNavigationTarget(i);E(e)}}function S(e){var t=p.getTitleKey()?l("navigationTargetTitle"):l("navigationTargetTitle")+" ("+l("default")+")";e.byId("idDescriptionLabel").setText(t);e.byId("idDescriptionLabel").setTooltip(t);e.byId("idUseDynamicParametersCheckBoxLabel").setText(l("useDynamicParametersLabel"))}async function N(t){var i,a;var n={oTextReader:l,oConfigurationHandler:f,oConfigurationEditor:v,oParentObject:p,getCalatogServiceUri:t.getView().getViewData().getCalatogServiceUri,oCoreApi:t.getView().getViewData().oCoreApi};i=await s.create({name:"sap.apf.modeler.ui.controller.navTargetContextMapping"});a=await d.create({viewName:"sap.apf.modeler.ui.view.requestOptions",type:c.XML,id:t.createId("idContextMappingView"),viewData:n,controller:i});t.getView().attachEvent(e.events.UPDATESUBVIEWINSTANCESONRESET,a.getController().updateSubViewInstancesOnReset.bind(a.getController()));a.addStyleClass("formTopPadding");t.byId("idContextMappingVBox").insertItem(a);I=0;var o=p.getAllNavigationParameters();if(o.length>0){o.forEach(function(e){A(t,e)})}else{A(t)}}function A(e,t){var i=new sap.ui.controller("sap.apf.modeler.ui.controller.navigationTargetParameter");var a=new sap.ui.view({viewName:"sap.apf.modeler.ui.view.navigationTargetParameter",type:c.XML,id:e.createId("idNavigationTargetParameter"+I),viewData:{oTextReader:l,oParentController:e,oNavigationTarget:p,parameter:t,oConfigurationEditor:v},controller:i});e.byId("idNavigationParameterBox").addItem(a);I++;V(e)}function V(e){e.byId("idNavigationParameterBox").getItems().forEach(function(e){e.getController().checkVisibilityOfPlusMinus()})}function x(e){var a=jQuery.Deferred();b.getAllAvailableSemanticObjects(function(n,o){if(o===undefined){var r=i.prepareModel(n,n.length);e.byId("idSemanticObjectField").setModel(r);if(t.checkIsNotNullOrUndefinedOrBlank(p.getSemanticObject())){e.byId("idSemanticObjectField").setValue(p.getSemanticObject())}a.resolve()}else{j(e,o,"11504")}});return a.promise()}function C(e){var t,a;a=jQuery.Deferred();t=i.prepareModel([],0);e.byId("idActionField").setModel(t);w(undefined,e);D(e).then(function(e){a.resolve(e)});e.byId("idActionField").setValue(p.getAction());return a.promise()}function D(e){var a,n,o,r;r=new jQuery.Deferred;n=p.getSemanticObject();if(t.checkIsNotUndefined(n)){o=b.getSemanticActions(n);o.then(function(t){a=i.prepareModel(t.semanticActions,t.semanticActions.length);e.byId("idActionField").setModel(a);r.resolve(t)},function(t){j(e,t,"11505")})}return r.promise()}function w(e,i){var a,n,o;var r=p.getTitleKey();if(t.checkIsNotUndefined(r)){n=i.getView().getViewData().oConfigurationHandler.getTextPool().get(r).TextElementDescription;i.byId("idDescription").setValue(n)}else{var s=e?e:i.byId("idActionField").getModel().getData().Objects;if(s&&t.checkIsNotNullOrBlank(p.getAction())){for(o=0;o<s.length;o++){if(s[o].id===p.getAction()){a=s[o].text;break}}}n=a?a:p.getSemanticObject();i.byId("idDescription").setValue(n)}}function P(e){var t=new a(l,i);var n=t.getNavTargetTypeData();e.byId("idNavigationTargetTypeField").setModel(n);var o=p.isStepSpecific()?l("stepSpecific"):l("globalNavTargets");e.byId("idNavigationTargetTypeField").setSelectedKey(o)}function O(e){var t=p.isStepSpecific()?l("stepSpecific"):l("globalNavTargets");if(t===l("stepSpecific")){F(e,true);var a=[];var n=v.getSteps();var o,r;for(o=0;o<n.length;o++){r={};r.stepKey=n[o].getId();r.stepName=u.get(n[o].getTitleId()).TextElementDescription;a.push(r)}var s=i.prepareModel(a,a.length);e.byId("idAssignedStepsCombo").setModel(s);var d=v.getStepsAssignedToNavigationTarget(p.getId());e.byId("idAssignedStepsCombo").setSelectedKeys(d)}}function E(e){var t={id:p.getId(),icon:p.isGlobal()?"sap-icon://overview-chart":"sap-icon://pushpin-off"};if(e.byId("idDescription").getValue()){t.name=e.byId("idDescription").getValue()}b.updateSelectedNode(t)}function M(e){var t=l("navigationTarget")+": "+e.byId("idDescription").getValue();b.updateTitleAndBreadCrumb(t)}function U(e){var t={key:p.getId(),value:e.byId("idDescription").getValue()};b.setNavigationTargetName(t)}function F(e,t){e.byId("idAssignedStepsLabel").setVisible(t);e.byId("idAssignedStepsCombo").setVisible(t)}function j(e,t,i){var a=b.createMessageObject({code:i});a.setPrevious(t);b.putMessage(a)}function B(){var e=v.getStepsAssignedToNavigationTarget(p.getId());var t,i;for(t=0;t<e.length;t++){i=v.getStep(e[t]);i.removeNavigationTarget(p.getId())}}return s.extend("sap.apf.modeler.ui.controller.navigationTarget",{onInit:function(){this._pOnInit=this.onInitAsync()},whenInitialized:function(){return Promise.resolve(this._pOnInit)},onInitAsync:async function(){var e=this;b=e.getView().getViewData();f=b.oConfigurationHandler;v=b.oConfigurationEditor;u=f.getTextPool();l=b.getText;g=b.oParams;if(!v){f.loadConfiguration(g.arguments.configId,function(e){v=e})}T(e);m=new o(e.getView());m.addFields(["idSemanticObjectField","idActionField"]);h(e);await N(e);e.setDetailData()},onAfterRendering:function(){var e=this;if(e.getView().byId("idSemanticObjectField").getValue().length===0){e.getView().byId("idSemanticObjectField").focus()}},setDetailData:function(){var e=this;x(e).then(function(){C(e).then(function(t){w(t.semanticActions,e)})});S(e);P(e);O(e);var t=p.getUseDynamicParameters();if(t){this.getView().byId("idUseDynamicParametersCheckBox").setSelected(true)}else{this.getView().byId("idUseDynamicParametersCheckBox").setSelected(false)}},updateSubViewInstancesOnReset:function(t){var i=this;v=t;p=v.getNavigationTarget(p.getId());i.getView().fireEvent(e.events.UPDATESUBVIEWINSTANCESONRESET,{oConfigurationEditor:v,oParentObject:p})},handleChangeSemanticObjectValue:function(e){var i,a=this;i=e.getParameter("value").trim();p.setTitleKey(undefined);if(t.checkIsNotNullOrBlank(i)){p.setSemanticObject(i);D(a).then(function(e){if(e.semanticActions.length>0){p.setAction(a.byId("idActionField").getModel().getData().Objects[0].id);a.byId("idActionField").setSelectedKey(e.semanticActions[0].id)}else{a.byId("idActionField").setValue("")}w(e.semanticActions,a);S(a);E(a);M(a);U(a)})}v.setIsUnsaved()},handleChangeofAction:function(e){var i,a=this;i=e.getParameter("value");p.setTitleKey(undefined);if(t.checkIsNotNullOrBlank(i)){p.setAction(i)}w(undefined,a);S(a);E(a);M(a);U(a);v.setIsUnsaved()},handleChangeForTitleText:function(){var e=this,t;var i=e.byId("idDescription").getValue();if(i.trim().length===0){t=undefined;p.setTitleKey(t);w(undefined,e);S(e);E(e);M(e);U(e);v.setIsUnsaved()}else{e.getView().getViewData().oConfigurationHandler.getTextPool().setTextAsPromise(i,y).done(function(t){p.setTitleKey(t);S(e);e.byId("idDescription").setValue(i);E(e);M(e);U(e);v.setIsUnsaved()})}},handleSuggestions:function(e){var t=new n.SuggestionTextHandler(u);t.manageSuggestionTexts(e,y)},handleChangeOfNavigationTargetType:function(){var e=this;v.setIsUnsaved();var t=e.byId("idNavigationTargetTypeField").getSelectedKey();if(t===l("stepSpecific")){p.setStepSpecific();O(e)}else{p.setGlobal();F(e,false);e.byId("idAssignedStepsCombo").setSelectedKeys([]);B()}E(e,e.byId("idDescription").getValue())},handleChangeForAssignedSteps:function(){var e=this;v.setIsUnsaved();var t=e.byId("idAssignedStepsCombo").getSelectedKeys();var i=v.getStepsAssignedToNavigationTarget(p.getId());i.forEach(function(e){if(t.indexOf(e)===-1){var i=v.getStep(e);i.removeNavigationTarget(p.getId())}});t.forEach(function(e){if(i.indexOf(e)===-1){var t=v.getStep(e);t.addNavigationTarget(p.getId())}})},getValidationState:function(){var e=this;var t=true;e.byId("idNavigationParameterBox").getItems().forEach(function(e){if(!e.getController().validate()){t=false}});return m.getValidationState()&&e.byId("idContextMappingView").getController().getValidationState()&&t},getNavigationParameters:function(){return this.byId("idNavigationParameterBox").getItems()},addNavigationParameter:function(){A(this)},removeNavigationParameter:function(e){this.byId("idNavigationParameterBox").removeItem(e);V(this)},handleChangeForUseDynamicParameters:function(){var e=this.byId("idUseDynamicParametersCheckBox").getSelected();p.setUseDynamicParameters(e)},onExit:function(){var e=this;e.byId("idContextMappingView").destroy()},displayHelpAboutDynamicParameters:function(){var e=l("explanationOfDynamicParameters");var t=l("titleDynamicParameters");r.show(e,{icon:r.Icon.INFORMATION,title:t,actions:[r.Action.CLOSE]})}})});
//# sourceMappingURL=navigationTarget.controller.js.map