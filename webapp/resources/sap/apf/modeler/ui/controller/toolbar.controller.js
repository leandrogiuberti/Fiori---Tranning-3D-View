/*!
* SAP APF Analysis Path Framework
*
* (c) Copyright 2012-2018 SAP SE. All rights reserved
*/
sap.ui.define(["sap/apf/modeler/ui/utils/constants","sap/apf/modeler/ui/utils/navigationHandler","sap/apf/modeler/ui/utils/textPoolHelper","sap/base/util/deepExtend","sap/base/util/extend","sap/m/Label","sap/m/Text","sap/ui/core/Fragment","sap/ui/core/Popup","sap/ui/core/UIComponent","sap/ui/core/mvc/Controller","sap/ui/model/Filter","sap/ui/model/FilterOperator","sap/ui/model/json/JSONModel","sap/ui/core/syncStyleClass"],function(e,t,i,n,o,a,s,r,g,d,f,c,l,p,I){"use strict";const C=g.Dock;return f.extend("sap.apf.modeler.ui.controller.toolbar",{onInit:function(){this.oCoreApi=this.getView().getViewData().oConfigListInstance.oCoreApi;this.oConfigListInstance=this.getView().getViewData().oConfigListInstance;this._setDisplayText()},_setDisplayText:function(){this.byId("idAddButton").setText(this.oCoreApi.getText("addButton"));this.byId("idCopyButton").setText(this.oCoreApi.getText("copyButton"));this.byId("idDeleteButton").setText(this.oCoreApi.getText("deleteButton"));this.byId("idMoveUp").setTooltip(this.oCoreApi.getText("moveUp"));this.byId("idMoveDown").setTooltip(this.oCoreApi.getText("moveDown"))},enableCopyDeleteButton:function(){if(!this.byId("idCopyButton").getEnabled()){this.byId("idCopyButton").setEnabled(true)}if(!this.byId("idDeleteButton").getEnabled()){this.byId("idDeleteButton").setEnabled(true)}},disableCopyDeleteButton:function(){if(this.byId("idCopyButton").getEnabled()){this.byId("idCopyButton").setEnabled(false)}if(this.byId("idDeleteButton").getEnabled()){this.byId("idDeleteButton").setEnabled(false)}},_setAddMenuText:function(){r.byId("idAddMenuFragment","idNewConfig").setText(this.oCoreApi.getText("newConfiguration"));r.byId("idAddMenuFragment","idNewFacetFilter").setText(this.oCoreApi.getText("newFacetFilter"));r.byId("idAddMenuFragment","idNewCategory").setText(this.oCoreApi.getText("newCategory"));r.byId("idAddMenuFragment","idNewNavigationTarget").setText(this.oCoreApi.getText("newNavigationTarget"));r.byId("idAddMenuFragment","idStep").setText(this.oCoreApi.getText("step"));r.byId("idAddMenuFragment","idNewStep").setText(this.oCoreApi.getText("newStep"));r.byId("idAddMenuFragment","idExistingStep").setText(this.oCoreApi.getText("existingStep"));r.byId("idAddMenuFragment","idHierarchicalStep").setText(this.oCoreApi.getText("hierarchicalStep"));r.byId("idAddMenuFragment","idNewRepresentation").setText(this.oCoreApi.getText("newRepresentation"))},_setExistingStepDialogText:function(){r.byId("idExistingStepDialogFragment","idExistingStepDialog").setTitle(this.oCoreApi.getText("existingStepDialogTitle"))},_enableDisableAddMenuItems:function(t,i){var n;var o=i.getItems();var a,s={};if(this.oConfigListInstance.configEditor){n=Object.keys(this.oConfigListInstance.configEditor.getFilterOption())[0]}if(this.oConfigListInstance.configurationHandler.getList().length===0||t===null){a="default"}else{a=t.nodeObjectType}s["default"]=1;s[e.configurationObjectTypes.CONFIGURATION]=4;s[e.configurationObjectTypes.FACETFILTER]=4;s[e.configurationObjectTypes.SMARTFILTERBAR]=4;s[e.configurationObjectTypes.CATEGORY]=5;s[e.configurationObjectTypes.STEP]=6;s[e.configurationObjectTypes.REPRESENTATION]=6;s[e.configurationObjectTypes.NAVIGATIONTARGET]=4;o.forEach(function(t,i){if(i<s[a]){t.setEnabled(true);if(n!==e.configurationObjectTypes.FACETFILTER&&i===1){t.setEnabled(false)}}else{t.setEnabled(false)}})},_handlePressAddButton:function(e){var i;var o=this,a=true;if(this.oConfigListInstance.getView().byId("idConfigDetailData").getContent().length>=1){i=typeof this.oConfigListInstance.getView().byId("idConfigDetailData").getContent()[0].getController==="function"?this.oConfigListInstance.getView().byId("idConfigDetailData").getContent()[0].getController():undefined}e.getSource().$().blur();var s=t.getInstance();if(i!==undefined){a=typeof i.getValidationState==="function"?i.getValidationState.call(i):true}var r=this.oConfigListInstance.configEditor?n({},this.oConfigListInstance.configEditor):undefined;this.oConfigListInstance.bIsSaved=r?r.isSaved():undefined;var g=false;var d=this.oConfigListInstance.oTreeInstance.getAPFTreeNodeContext(this.oConfigListInstance.oTreeInstance.getSelectedItem());var f=e.getSource();var c=function(){this._pAddMenu??=o.loadFragment({autoPrefixId:false,id:"idAddMenuFragment",name:"sap.apf.modeler.ui.fragment.addMenu"}).then(e=>{this.addMenu=e});this._pAddMenu.then(()=>{this._setAddMenuText();this._enableDisableAddMenuItems(d,this.addMenu);this.addMenu.open(false,f,C.BeginTop,C.BeginBottom,f)})};if(!a){s.throwMandatoryPopup(o.oConfigListInstance,{yes:function(){var e=o.oConfigListInstance.oTreeInstance.getParentNodeContext(d);o.oConfigListInstance.configEditor=o.oConfigListInstance.configurationHandler.restoreMemorizedConfiguration(e.configId);if(o.oConfigListInstance.bIsSaved===false&&o.oConfigListInstance.configEditor){o.oConfigListInstance.configEditor.setIsUnsaved()}var t=o.oConfigListInstance._navMandatoryResetState(o.oConfigListInstance);if(!t.isNewView){c.call(o)}}});g=true}if(!g){c.call(o)}},_handleAddMenuItemPress:function(t){var i=this.addMenu.getItems();var n=t.getParameters("item");var o;var a={"idAddMenuFragment--idNewFacetFilter":e.configurationObjectTypes.FACETFILTER,"idAddMenuFragment--idNewCategory":e.configurationObjectTypes.CATEGORY,"idAddMenuFragment--idNewStep":e.configurationObjectTypes.STEP,"idAddMenuFragment--idHierarchicalStep":e.configurationObjectTypes.STEP,"idAddMenuFragment--idNewRepresentation":e.configurationObjectTypes.REPRESENTATION,"idAddMenuFragment--idNewConfig":e.configurationObjectTypes.CONFIGURATION,"idAddMenuFragment--idNewNavigationTarget":e.configurationObjectTypes.NAVIGATIONTARGET,default:e.configurationObjectTypes.CONFIGURATION};i.forEach(function(e){if(e.getId()===n.id){o=a[e.getId()]}else if(e.getSubmenu()){e.getSubmenu().getItems().forEach(function(e){if(e.getId()===n.id){o=a[e.getId()]}})}});var s=false;if(n.id==="idAddMenuFragment--idExistingStep"){this._handleAddExistingStepPress()}else if(n.id!=="idAddMenuFragment--idStep"&&o!==undefined){if(n.id==="idAddMenuFragment--idHierarchicalStep"){s=true}this.oConfigListInstance.oTreeInstance.addNodeInTree(o,undefined,s)}},_copyConfiguration:function(t,i){var n=this.oConfigListInstance.configurationHandler.getConfiguration(t);var o={},a;o.AnalyticalConfiguration=n.AnalyticalConfiguration;o.name="< "+n.AnalyticalConfigurationName+" >";o.Application=n.Application;o.type=e.configurationObjectTypes.CONFIGURATION;o.bIsLoaded=false;o.bToggleState=false;o.isSelected=true;o.expanded=true;o.selectable=true;o.hasExpander=true;this.oConfigListInstance.oModel.getData().aConfigDetails.push(o);this.oConfigListInstance.oModel.updateBindings();a=this.oConfigListInstance.oTreeInstance.getModel().getContext(i);this.oConfigListInstance.selectedNode=this.oConfigListInstance.oTreeInstance.getItemNodeByContextWithoutExpand(a.sPath);this.oConfigListInstance.modelUpdateDeferred[this.oConfigListInstance.oModel.getData().aConfigDetails.length-1]=new jQuery.Deferred;var s={appId:this.oConfigListInstance.appId,configId:t};d.getRouterFor(this.oConfigListInstance).navTo(o.type,s,true)},_handlePressCopyButton:function(o){var s=jQuery.Deferred();var r,g;var d=this,f=true;if(this.oConfigListInstance.getView().byId("idConfigDetailData").getContent().length>=1){r=typeof this.oConfigListInstance.getView().byId("idConfigDetailData").getContent()[0].getController==="function"?this.oConfigListInstance.getView().byId("idConfigDetailData").getContent()[0].getController():undefined}o.getSource().$().blur();var c=t.getInstance();if(r!==undefined){f=typeof r.getValidationState==="function"?r.getValidationState.call(r):true}var l=this.oConfigListInstance.configEditor?n({},this.oConfigListInstance.configEditor):undefined;this.oConfigListInstance.bIsSaved=l?l.isSaved():undefined;var p=false;var I=function(){var t=this;var o;var a=this.oTreeInstance.getAPFTreeNodeContext(this.oTreeInstance.getSelectedItem()||this.selectedNode);this.selectedNode=this.oTreeInstance.getSelectedItem()||this.selectedNode;var r,f,c,l,p,I,C,u,h,T;c=a.nodeContext;switch(a.nodeObjectType){case e.configurationObjectTypes.FACETFILTER:var v=this.oCoreApi.getText("copyOf")+"  "+a.nodeTitle;var D=this.configEditor.copyFacetFilter(a.nodeAPFId);var m=this.configEditor.getFacetFilter(D);var L=i.TranslationFormatMap.FACETFILTER_LABEL;this.oTextPool.setTextAsPromise(v,L).done(function(e){m.setLabelKey(e);p=c.split("/");g=p[2];I=p[6];var t=this.oModel.getData().aConfigDetails[g].configData[0].filters[I];t.isSelected=false;var i=n({},t);i.id=D;i.name="< "+v+" >";i.isSelected=true;l=this.oModel.getData().aConfigDetails[g].configData[0].filters.length;this.oModel.getData().aConfigDetails[g].configData[0].filters.push(i);p[6]=l;f=p.join("/");Q()}.bind(this));break;case e.configurationObjectTypes.CATEGORY:var y=this.oCoreApi.getText("copyOf")+"  "+a.nodeTitle;var b=this.configEditor.copyCategory(a.nodeAPFId);var A=i.TranslationFormatMap.CATEGORY_TITLE;this.oTextPool.setTextAsPromise(y,A).done(function(e){var i={labelKey:e};this.configEditor.setCategory(i,b);p=c.split("/");g=p[2];C=p[6];var a=[];var s=this.configEditor.getSteps();s.forEach(function(e){if(t.configEditor.getCategoriesForStep(e.getId())[0]===b){a.push(e.getId())}});var r=this.oModel.getData().aConfigDetails[g].configData[1].categories[C];r.isSelected=false;var d=n({},r);if(d.steps){for(var I=0;I<d.steps.length;I++){d.steps[I].id=a[I];var u=t.configEditor.getStep(a[I]);o=u.getRepresentations();if(d.steps[I].representations){for(var h=0;h<d.steps[I].representations.length;h++){d.steps[I].representations[h].id=o[h].getId()}}}}d.id=b;d.name="< "+y+" >";d.isSelected=true;l=this.oModel.getData().aConfigDetails[g].configData[1].categories.length;this.oModel.getData().aConfigDetails[g].configData[1].categories.push(d);p[6]=l;f=p.join("/");Q()}.bind(this));break;case e.configurationObjectTypes.NAVIGATIONTARGET:var E=this.oCoreApi.getText("copyOf")+"  "+a.nodeTitle;var S=this.configEditor.copyNavigationTarget(a.nodeAPFId);p=c.split("/");g=p[2];u=p[6];var x=this.oModel.getData().aConfigDetails[g].configData[2].navTargets[u];x.isSelected=false;var F=n({},x);F.id=S;F.name="< "+E+" >";F.isSelected=true;l=this.oModel.getData().aConfigDetails[g].configData[2].navTargets.length;this.oModel.getData().aConfigDetails[g].configData[2].navTargets.push(F);p[6]=l;f=p.join("/");Q();d.oConfigListInstance._setNavigationTargetName({configIndexInTree:g});break;case e.configurationObjectTypes.STEP:var O=this.oCoreApi.getText("copyOf")+"  "+a.nodeTitle;var N=this.configEditor.copyStep(a.nodeAPFId);var M=this.configEditor.getCategoriesForStep(N);var w=this.configEditor.getStep(N);var P=i.TranslationFormatMap.STEP_TITLE;this.oTextPool.setTextAsPromise(O,P).done(function(e){var t;w.setTitleId(e);p=c.split("/");g=p[2];C=p[6];h=p[8];var i=this.oModel.getData().aConfigDetails[g].configData[1].categories[C].steps[h];i.isSelected=false;var a=n({},i);o=w.getRepresentations();a.id=N;a.name="< "+O+" >";if(a.representations){for(t=0;t<a.representations.length;t++){a.representations[t].id=o[t].getId()}}l=this.oModel.getData().aConfigDetails[g].configData[1].categories[C].steps.length;p[8]=l;f=p.join("/");for(var s=0;s<M.length;s++){var r=n({},a);var I={arguments:{configId:d.oConfigListInstance.configId,categoryId:M[s]}};var u=d.oConfigListInstance.getSPathFromURL(I).sPath.split("/");var T=u[6];this.oModel.getData().aConfigDetails[g].configData[1].categories[T].steps.push(r)}this.oModel.getData().aConfigDetails[g].configData[1].categories[C].steps[l].isSelected=true;Q()}.bind(this));break;case e.configurationObjectTypes.REPRESENTATION:p=c.split("/");g=p[2];C=p[6];h=p[8];T=p[10];var R=this.oModel.getData().aConfigDetails[g].configData[1].categories[C].steps[h].id;var _=this.configEditor.getStep(R);var j=this.configEditor.getCategoriesForStep(R);this.oModel.getData().aConfigDetails[g].configData[1].categories[C].steps[h].representations[T].isSelected=false;var B=this.oModel.getData().aConfigDetails[g].configData[1].categories[C].steps[h].representations[T];var V=n({},B);var U=_.copyRepresentation(V.id);V.id=U;l=this.oModel.getData().aConfigDetails[g].configData[1].categories[C].steps[h].representations.length;p[10]=l;f=p.join("/");for(var G=0;G<j.length;G++){var k=n({},V);var H={arguments:{configId:d.oConfigListInstance.configId,categoryId:j[G],stepId:R}};var Y=d.oConfigListInstance.getSPathFromURL(H).sPath.split("/");var z=Y[6];var K=Y[8];this.oModel.getData().aConfigDetails[g].configData[1].categories[z].steps[K].representations.push(k)}this.oModel.getData().aConfigDetails[g].configData[1].categories[C].steps[h].representations[l].isSelected=true;Q();break;case e.configurationObjectTypes.CONFIGURATION:var W=this.oCoreApi.getText("copyOf")+"  "+a.nodeTitle;p=c.split("/");g=p[2];var $=this.oModel.getData().aConfigDetails[g];$.isSelected=false;p[2]=this.oModel.getData().aConfigDetails.length;f=p.join("/");this.configurationHandler.copyConfiguration(a.nodeAPFId,function(e){var n={AnalyticalConfigurationName:W};var o=t.configurationHandler.setConfiguration(n,e);t.configTitle=W;t.configurationHandler.loadConfiguration(o,function(e){var n=t.configTitle;var o=i.TranslationFormatMap.APPLICATION_TITLE;t.configurationHandler.getTextPool().setTextAsPromise(n,o).done(function(t){e.setApplicationTitle(t)})});d._copyConfiguration(e,f)});break;default:break}function Q(){t.oModel.updateBindings();r=t.oTreeInstance.getModel().getContext(f);t.selectedNode=t.oTreeInstance.getItemNodeByContextWithoutExpand(r.sPath);var e=t.oTreeInstance.getAPFTreeNodeContext(t.selectedNode);var i=t.oTreeInstance.getParentNodeContext(e);t.navigateToDifferntView(i,e);t.configEditor.setIsUnsaved();s.resolve()}};var C=function(){var e=(new a).addStyleClass("noConfigSelected");e.setText(d.oConfigListInstance.oCoreApi.getText("noConfigSelected"));e.placeAt(d.oConfigListInstance.byId("idConfigDetailData"));d.oConfigListInstance.toolbarController.disableCopyDeleteButton();d.oConfigListInstance._enableDisableExportAndExecuteButton()};var u;if(!f){c.throwMandatoryPopup(d.oConfigListInstance,{yes:function(){var e=d.oConfigListInstance.oTreeInstance.getAPFTreeNodeContext(d.oConfigListInstance.oTreeInstance.getSelectedItem());var t=d.oConfigListInstance.oTreeInstance.getParentNodeContext(e);d.oConfigListInstance.bIsDifferntConfig=d.oConfigListInstance.oTreeInstance.isConfigurationSwitched(d.oConfigListInstance.oPreviousSelectedNode,d.oConfigListInstance.selectedNode);d.oConfigListInstance.configEditor=d.oConfigListInstance.configurationHandler.restoreMemorizedConfiguration(t.configId);if(d.oConfigListInstance.bIsSaved===false&&d.oConfigListInstance.configEditor){d.oConfigListInstance.configEditor.setIsUnsaved()}if(d.oConfigListInstance.bIsDifferntConfig===false){var i=typeof d.oConfigListInstance.getView().byId("idConfigDetailData").getContent()[0].getController==="function"?d.oConfigListInstance.getView().byId("idConfigDetailData").getContent()[0].getController():undefined;var n=d.oConfigListInstance._isNewSubView(i.getView().getViewData().oParams);if(!n){I.call(d.oConfigListInstance);d.oConfigListInstance._navHandleExpandDelete.call(d.oConfigListInstance,d.oConfigListInstance.oSelectedNodeDetails,t)}else{d.oConfigListInstance.handleConfirmDeletion()}}else{var o=d.oConfigListInstance._navMandatoryResetState(d.oConfigListInstance);if(!o.isNewView){if(o.bIsSaved===false){u(d.oConfigListInstance)}else{I.call(d.oConfigListInstance)}}}}});p=true}var h;if(r.getView().getViewData().oParams.name==="configuration"){h=true}u=function(t){c.throwLossOfDataPopup(t,{yes:function(e){d.oConfigListInstance._navSaveState(function(){e(function(e){if(d.oConfigListInstance.selectedNode){var t=d.oConfigListInstance.selectedNode._getBindingContext().sPath;var i=t.split("/");var n=i[2]}d.oConfigListInstance.oModel.getData().aConfigDetails[n].AnalyticalConfiguration=d.oConfigListInstance.configId;d.oConfigListInstance.oModel.updateBindings();I.call(d.oConfigListInstance)})})},no:function(){var t={appId:d.oConfigListInstance.appId,configId:d.oConfigListInstance.configId};var i=typeof d.oConfigListInstance.getView().byId("idConfigDetailData").getContent()[0].getController==="function"?d.oConfigListInstance.getView().byId("idConfigDetailData").getContent()[0].getController():undefined;var n=i.getView().getViewData().oParams.name==="configuration"?true:false;if(d.oConfigListInstance.configId.indexOf(e.configurationObjectTypes.ISNEWCONFIG)===0){d.oConfigListInstance._navHandleExpandDelete.call(d.oConfigListInstance,{},t,n);d.oConfigListInstance.clearTitleAndBreadCrumb();d.oConfigListInstance.byId("idConfigDetailData").removeAllContent();C()}else{d.oConfigListInstance._navConfigResetState(d.oConfigListInstance,function(){I.call(d.oConfigListInstance)})}}})};if(d.oConfigListInstance.bIsSaved===false&&f&&h){u(d.oConfigListInstance);p=true}if(!p){I.call(d.oConfigListInstance)}return s.promise()},_handlePressDeleteButton:function(t){var i;var n=this.oConfigListInstance.oTreeInstance.getAPFTreeNodeContext(this.oConfigListInstance.oTreeInstance.getSelectedItem());var o=this.oCoreApi.getText(n.nodeObjectType);t.getSource().$().blur();if(n.nodeObjectType===e.configurationObjectTypes.STEP){i=this.oCoreApi.getText("confirmStepDeletion",[n.nodeTitle])}else{i=this.oCoreApi.getText("confirmDeletion",[o,n.nodeTitle])}this._openDeleteConfirmationDialog(i)},_openDeleteConfirmationDialog:function(e){var t=this;var i=o(t.oConfigListInstance,{closeDialog:t.closeDialog.bind(t)});this._pConfirmationDialog??=r.load({id:"idConfigConfirmationDialogFragment",name:"sap.apf.modeler.ui.fragment.deleteConfirmationDialog",controller:i}).then(e=>{this.confirmationDialog=e;this.getView().addDependent(e)});this._pConfirmationDialog.then(()=>{this._setConfirmationDialogText();var t=new s;t.setText(e);this.confirmationDialog.removeAllContent();this.confirmationDialog.addContent(t);this.confirmationDialog.addAriaDescribedBy(t);I("sapUiSizeCompact",this.getView(),this.confirmationDialog);this.confirmationDialog.open()})},closeDialog:function(){if(this.confirmationDialog&&this.confirmationDialog.isOpen()){this.confirmationDialog.close()}},_setConfirmationDialogText:function(){r.byId("idConfigConfirmationDialogFragment","idDeleteConfirmation").setTitle(this.oCoreApi.getText("confirmation"));r.byId("idConfigConfirmationDialogFragment","idDeleteButton").setText(this.oCoreApi.getText("deleteButton"));r.byId("idConfigConfirmationDialogFragment","idCancelButtonDialog").setText(this.oCoreApi.getText("cancel"))},_handlePressMoveUpButton:function(){this.bIsDown=false;var e=this.oConfigListInstance.oTreeInstance.getSelectedItem();if(e!==null){var t=this.oConfigListInstance.oTreeInstance.getAPFTreeNodeContext(e);if(t!==undefined){this._moveUpOrDown(t,this.bIsDown)}}},_handlePressMoveDownButton:function(){this.bIsDown=true;var e=this.oConfigListInstance.oTreeInstance.getSelectedItem();if(e!==null){var t=this.oConfigListInstance.oTreeInstance.getAPFTreeNodeContext(e);if(t!==undefined){this._moveUpOrDown(t,this.bIsDown)}}},_moveUpOrDown:function(t,i){var n=t.nodeObjectType;var o=t.nodeAPFId;var a=t.nodeContext;var s=a.split("/")[2];var r,g,d,f,c;var l=false;var p=a.split("/")[a.split("/").length-1];switch(n){case e.configurationObjectTypes.FACETFILTER:r=this.oConfigListInstance.oModel.getData().aConfigDetails[s].configData[0].filters;c=r.length;if(i){if(parseInt(p,10)!==c-1){this.oConfigListInstance.configEditor.moveFacetFilterUpOrDown(o,1);g=parseInt(p,10)+1;l=true}}else{if(parseInt(p,10)!==0){this.oConfigListInstance.configEditor.moveFacetFilterUpOrDown(o,-1);g=parseInt(p,10)-1;l=true}}break;case e.configurationObjectTypes.CATEGORY:r=this.oConfigListInstance.oModel.getData().aConfigDetails[s].configData[1].categories;c=r.length;if(i){if(parseInt(p,10)!==c-1){this.oConfigListInstance.configEditor.moveCategoryUpOrDown(o,1);g=parseInt(p,10)+1;l=true}}else{if(parseInt(p,10)!==0){this.oConfigListInstance.configEditor.moveCategoryUpOrDown(o,-1);g=parseInt(p,10)-1;l=true}}break;case e.configurationObjectTypes.NAVIGATIONTARGET:r=this.oConfigListInstance.oModel.getData().aConfigDetails[s].configData[2].navTargets;c=r.length;if(i){if(parseInt(p,10)!==c-1){this.oConfigListInstance.configEditor.moveNavigationTargetUpOrDown(o,1);g=parseInt(p,10)+1;l=true}}else{if(parseInt(p,10)!==0){this.oConfigListInstance.configEditor.moveNavigationTargetUpOrDown(o,-1);g=parseInt(p,10)-1;l=true}}break;case e.configurationObjectTypes.STEP:var I=a.split("/")[6];var C=this.oConfigListInstance.oModel.getData().aConfigDetails[s].configData[1].categories[I];r=C.steps;c=r.length;if(i){if(parseInt(p,10)!==c-1){this.oConfigListInstance.configEditor.moveCategoryStepAssignmentUpOrDown(C.id,o,1);g=parseInt(p,10)+1;l=true}}else{if(parseInt(p,10)!==0){this.oConfigListInstance.configEditor.moveCategoryStepAssignmentUpOrDown(C.id,o,-1);g=parseInt(p,10)-1;l=true}}break;case e.configurationObjectTypes.REPRESENTATION:var u=this.oConfigListInstance.oTreeInstance.getSelectedItem();var h=u.getParentNode();var T=this.oConfigListInstance.oTreeInstance.getAPFTreeNodeContext(h).nodeAPFId;var v=this.oConfigListInstance.configEditor.getStep(T);I=a.split("/")[6];var D=a.split("/")[8];r=this.oConfigListInstance.oModel.getData().aConfigDetails[s].configData[1].categories[I].steps[D].representations;c=r.length;if(i){if(parseInt(p,10)!==c-1){v.moveRepresentationUpOrDown(o,1);g=parseInt(p,10)+1;l=true}}else{if(parseInt(p,10)!==0){v.moveRepresentationUpOrDown(o,-1);g=parseInt(p,10)-1;l=true}}break;default:break}if(l){d=r[p];f=r[g];r[g]=d;r[p]=f;this.oConfigListInstance.oModel.updateBindings();this.oConfigListInstance.configEditor.setIsUnsaved()}},_handleAddExistingStepPress:function(){var e=this;var t=this.oConfigListInstance.oTreeInstance.getAPFTreeNodeContext(this.oConfigListInstance.oTreeInstance.getSelectedItem());var i=this.oConfigListInstance.oTreeInstance.getParentNodeContext(t).categoryId;var n=this.oConfigListInstance.configEditor.getStepsNotAssignedToCategory(i);var o;var a=[];n.forEach(function(t){var i={};var n=e.oConfigListInstance.configEditor.getStep(t);o=e.oConfigListInstance.oTextPool.get(n.getTitleId()).TextElementDescription;i.id=t;i.name=o;a.push(i)});var s=new p({existingStepData:a});this._pAddExistingStepDialog??=this.loadFragment({autoPrefixId:false,id:"idExistingStepDialogFragment",name:"sap.apf.modeler.ui.fragment.existingStepDialog"}).then(e=>this.addExistingStepDialog=e);this._pAddExistingStepDialog.then(()=>{this._setExistingStepDialogText();this.addExistingStepDialog.setModel(s);this.addExistingStepDialog.open()})},_handleExistingStepDialogOK:function(t){var i=e.configurationObjectTypes.STEP;var n=t.getParameters("listItem").selectedItems;var o=n.length;var a=this.oConfigListInstance.oTreeInstance.getAPFTreeNodeContext(this.oConfigListInstance.oTreeInstance.getSelectedItem());var s=this.oConfigListInstance.oTreeInstance.getParentNodeContext(a).categoryId;var r=[];for(var g=0;g<o;g++){var d=t.getParameters("selectedItems").selectedContexts[g].sPath.split("/")[2];var f=t.getSource().getModel().getData().existingStepData[d];var c=this.oConfigListInstance.configEditor.getStep(f.id);this.oConfigListInstance.configEditor.addCategoryStepAssignment(s,f.id);var l=c.getRepresentations();var p=l.length;var I=[];for(var C=0;C<p;C++){var u={};u.id=l[C].getId();u.name=l[C].getRepresentationType();u.icon=this._getRepresentationIcon(u.name);I.push(u)}var h={};h.step=f;h.representations=I;h.noOfReps=p;r.push(h)}if(o!==0){var T={noOfSteps:o,aExistingStepsToBeAdded:r};this.oConfigListInstance.oTreeInstance.addNodeInTree(i,T)}},_getRepresentationIcon:function(e){var t;var i=this.oCoreApi.getRepresentationTypes();for(var n=0;n<i.length;n++){if(e===i[n].id){t=i[n].picture;break}}return t},_handleExistingStepDialogSearch:function(e){var t=e.getParameter("value");var i=new c("name",l.Contains,t);var n=e.getSource().getBinding("items");n.filter([i])},_handleExistingStepDialogClose:function(e){if(this.addExistingStepDialog){e.getSource().getBinding("items").filter([])}}})},true);
//# sourceMappingURL=toolbar.controller.js.map