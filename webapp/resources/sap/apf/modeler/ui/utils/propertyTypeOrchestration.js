/*!
 * SAP APF Analysis Path Framework
 *
 * (c) Copyright 2012-2018 SAP SE. All rights reserved
 */
sap.ui.define(["sap/apf/modeler/ui/utils/constants"],function(e){"use strict";function r(){var r=[];this._getPropertyTypeRows=function(){return r};this.getPropertyTypeRow=function(e){return r.filter(function(r){return r.controlId===e})[0]};this.getPropertyTypeRowByPropertyName=function(e){return r.filter(function(r){return r.propertyRowInformation.sProperty===e})[0]};this.getSelectedProperties=function(){var e=[];this._getPropertyTypeRows().forEach(function(r){e.push(r.propertyRowInformation.sProperty)});return e};this.updatePropertyTypeRow=function(e,r){this.getPropertyTypeRow(e).propertyRowInformation.sProperty=r};this.getAggregationRole=function(){if(r.length===0){return null}return t._mapPropertyType2AggregationRole(r[0].sPropertyType)};this.getPropertyInformationList=function(){var r=this;var t=[];this._getPropertyTypeRows().forEach(function(o){var n=o.propertyRowInformation.sProperty;var a;switch(r._getPropertyTypeRows()[0].sPropertyType){case e.propertyTypes.DIMENSION:case e.propertyTypes.LEGEND:a=o.oView.oViewData.oRepresentationHandler.oRepresentation.getDimensionTextLabelKey(n);break;case e.propertyTypes.MEASURE:a=o.oView.oViewData.oRepresentationHandler.oRepresentation.getMeasureTextLabelKey(n);break;case e.propertyTypes.PROPERTY:a=o.oView.oViewData.oRepresentationHandler.oRepresentation.getPropertyTextLabelKey(n);break;case e.propertyTypes.HIERARCHIALCOLUMN:a=o.oView.oViewData.oRepresentationHandler.oRepresentation.getHierarchyPropertyTextLabelKey(n);break;default:a=null;break}if(n!==o.oView.getController().oTextReader("none")){t.push({sProperty:n,sKind:o.propertyRowInformation.sContext,sTextLabelKey:a,sLabelDisplayOption:o.oView.oViewData.oRepresentationHandler.oRepresentation.getLabelDisplayOption(n),sMeasureDisplayOption:o.oView.oViewData.oRepresentationHandler.oRepresentation.getMeasureDisplayOption(n)})}});return t};this.getSortPropertyInformationList=function(e){return this._getPropertyTypeRows().filter(function(e){var r=e.propertyRowInformation.sProperty;return r!==e.oView.getController().oTextReader("none")}).map(function(r){return{property:r.propertyRowInformation.sProperty,ascending:r.oView.getController().byId(e).getSelectedKey()==="true"?true:false}})};this.addPropertyTypeReference=function(e,t,o,n){r.push({controlId:e,propertyRowInformation:t,sPropertyType:o,oView:n})};this.removePropertyTypeReference=function(e){r.forEach(function(t,o){if(t.controlId===e){r.splice(o,1)}})};this.updateAllDropDownsAsPromise=function(){return new Promise(function(e){o(e)})};function o(e){var o=[];r.forEach(function(e){o.push(t._updateDropDownOfAControl(e))});Promise.all(o).then(function(){e()})}this.updateAllSelectControlsForPropertyType=function(e,r){var t=this;return new Promise(function(n){if(e&&r){if(t.isSwapCase(e,r)){t._swapPropertiesBetweenControls(e,r).then(function(){o(n)})}else{t.updatePropertyTypeRow(e,r);o(n)}}else{o(n)}})};this.isSwapCase=function(r,o){return t._mapPropertyType2AggregationRole(this.getPropertyTypeRow(r).sPropertyType)===e.aggregationRoles.MEASURE&&t._isPropertyAlreadySelected(this.getSelectedProperties(),o)};this._swapPropertiesBetweenControls=function(e,r){var t=this;return new Promise(function(o){var n=t.getPropertyTypeRow(e);var a;var i=n.propertyRowInformation.sProperty;t._getPropertyTypeRows().forEach(function(e){if(e.propertyRowInformation.sProperty===r){a=t.getPropertyTypeRow(e.controlId)}});a.propertyRowInformation.sProperty=i;n.propertyRowInformation.sProperty=r;t.updateAllDropDownsAsPromise().then(function(){a.oView.getController().setDetailData();o()})})}}var t={_updateDropDownOfAControl:function(r){var o=new Promise(function(o){var n=t._mapPropertyType2AggregationRole(r.sPropertyType);var a=r.oView.getViewData();var i=r.oView.getViewData().oPropertyOrchestration;var p=a.oStepPropertyMetadataHandler;var s=a.oParentObject.getId();var y=r.propertyRowInformation.sProperty;var l=r.propertyRowInformation.bMandatory;var u=p.oStep;var f=u.getType()==="hierarchicalStep";if(f&&r.sPropertyType===e.propertyTypes.REPRESENTATIONSORT){n=e.aggregationRoles.MEASURE}t.getConsumableAndAvailablePropertiesAsPromise(s,n,p).then(function(e){var a=r.oView.getController();a.removeAllItemsFromDropDownList();var p=i.getSelectedProperties();var s=t._relativeComplement(e.available,p);a.setItemsOfDropDownList(s,e.available,y,l,n);o()})});return o},getPropertyListAndSelectedKey:function(e,r,t,o,n){function a(e,r){return e.indexOf(r)!==-1}function i(e,r){return a(r.available,e)?e:n([e],t.oTextReader)[0]}function p(e){return e!==t.oTextReader("none")&&e!==undefined}var s=JSON.parse(JSON.stringify(e));var y=i(r,o);if(p(r)&&!a(e,r)){s=e.concat(y)}if(!t.oView.oViewData.oPropertyTypeData.bMandatory){s.splice(0,0,t.oTextReader("none"))}return{aAllProperties:s,sSelectedKey:y}},_mapPropertyType2AggregationRole:function(r){switch(r){case e.propertyTypes.DIMENSION:case e.propertyTypes.LEGEND:return e.aggregationRoles.DIMENSION;case e.propertyTypes.MEASURE:return e.aggregationRoles.MEASURE;default:return null}},getConsumableAndAvailablePropertiesAsPromise:function(e,r,t){var o=new Promise(function(o){t.getEntityTypeMetadataAsPromise().then(function(n){var a=t.oStep;a.getConsumablePropertiesForRepresentation(e).then(function(e){var a=e.consumable.filter(function(e){var o=t.getPropertyMetadata(n,e);return!r||o&&o["aggregation-role"]===r});var i=e.available.filter(function(e){var o=t.getPropertyMetadata(n,e);return!r||o&&o["aggregation-role"]===r});o({available:i,consumable:a})})})});return o},_relativeComplement:function(e,r){var t=JSON.parse(JSON.stringify(e));r.forEach(function(e){t=t.filter(function(r){return r!==e})});return t},_isPropertyAlreadySelected:function(e,r){function t(e,r){return e.indexOf(r)!==-1}return t(e,r)},PropertyTypeOrchestration:r};return t});
//# sourceMappingURL=propertyTypeOrchestration.js.map