/*!
* SAP APF Analysis Path Framework
*
* (c) Copyright 2012-2018 SAP SE. All rights reserved
*/
sap.ui.define(["sap/apf/modeler/ui/utils/constants","sap/apf/utils/exportToGlobal","sap/base/util/isEmptyObject","sap/m/Tree","sap/m/TreeRenderer"],function(e,t,a,n,i){"use strict";var s=n.extend("sap.apf.modeler.ui.utils.APFTree",{metadata:{events:{},properties:{translationFunction:{},defaultRepresentationType:{},applicationId:{}}},previousSelectedItem:null,renderer:function(e,t){i.render(e,t)},setTranslationFunction:function(e){this.fnTranslationFunction=e},setDefaultRepresentationType:function(e){this.defaultRepresentationType=e},setApplicationId:function(e){this.applicationId=e},getAPFTreeNodeContext:function(e){if(e){var t=e?e._getBindingContext():undefined;var a=t.getObject()?t.getObject().type:undefined;var n;if(t.getObject()&&t.getObject().id){n=t.getObject().id}else if(t.getObject()&&t.getObject().AnalyticalConfiguration){n=t.getObject().AnalyticalConfiguration}return{oNode:e,nodeContext:t.sPath,nodeObjectType:a,nodeTitle:e.getTitle(),nodeAPFId:n}}return null},getItemNodeByContext:function(e){var t=this;var a=e.split("/");switch(a.length){case 3:t.expandToLevel(0);break;case 7:t.expandToLevel(2);break;case 9:t.expandToLevel(3);break;case 11:t.expandToLevel(4);break;default:break}for(var n=0;n<this.getItems().length;n++){var i=this.getItems()[n];if(i._getBindingContext().sPath===e){return i}}return null},getItemNodeByContextWithoutExpand:function(e){for(var t=0;t<this.getItems().length;t++){var a=this.getItems()[t];if(a._getBindingContext().sPath===e){return a}}return null},getParentNodeContext:function(t){var a=this.getModel();if(t!==null){var n=t.nodeContext.split("/")[2];var i=a.getData().aConfigDetails[n]?a.getData().aConfigDetails[n].AnalyticalConfiguration:undefined;var s;var o=t.nodeContext.split("/")[6];var g=t.nodeContext.split("/")[6];var r=t.nodeContext.split("/")[6];var d=t.nodeContext.split("/")[8];var c={};if(t!==null){switch(t.nodeObjectType){case e.configurationObjectTypes.FACETFILTER:c.facetFilterId=a.getData().aConfigDetails[n].configData[0].filters[g].id;c.configId=i;c.configurationName=a.getData().aConfigDetails[n].name;c.facetFilterName=a.getData().aConfigDetails[n].configData[0].filters[g].name;break;case e.configurationObjectTypes.SMARTFILTERBAR:c.smartFilterId=a.getData().aConfigDetails[n].configData[0].filters[g].id;c.configId=i;c.configurationName=a.getData().aConfigDetails[n].name;c.smartFilterName=a.getData().aConfigDetails[n].configData[0].filters[g].name;break;case e.configurationObjectTypes.CATEGORY:if(a.getData().aConfigDetails[n].configData!=undefined){c.categoryId=a.getData().aConfigDetails[n].configData[1].categories[o].id;c.configId=i;c.configurationName=a.getData().aConfigDetails[n].name;c.categoryName=a.getData().aConfigDetails[n].configData[1].categories[o].name}break;case e.configurationObjectTypes.STEP:c.configId=i;c.categoryId=a.getData().aConfigDetails[n].configData[1].categories[o].id;c.stepId=a.getData().aConfigDetails[n].configData[1].categories[o].steps[d].id;c.configurationName=a.getData().aConfigDetails[n].name;c.categoryName=a.getData().aConfigDetails[n].configData[1].categories[o].name;c.stepName=a.getData().aConfigDetails[n].configData[1].categories[o].steps[d].name;break;case e.configurationObjectTypes.REPRESENTATION:s=t.oNode;c.configId=i;c.categoryId=a.getData().aConfigDetails[n].configData[1].categories[o].id;c.stepId=a.getData().aConfigDetails[n].configData[1].categories[o].steps[d].id;c.representationId=s._getBindingContext().getObject().id;c.configurationName=a.getData().aConfigDetails[n].name;c.categoryName=a.getData().aConfigDetails[n].configData[1].categories[o].name;c.stepName=a.getData().aConfigDetails[n].configData[1].categories[o].steps[d].name;c.representationName=s._getBindingContext().getObject().name;break;case e.configurationObjectTypes.CONFIGURATION:c.configId=t.oNode._getBindingContext().getObject().AnalyticalConfiguration;c.configurationName=t.oNode._getBindingContext().getObject().name;break;case e.configurationObjectTypes.NAVIGATIONTARGET:c.navTargetId=a.getData().aConfigDetails[n].configData[2].navTargets[r].id;c.configId=i;c.configurationName=a.getData().aConfigDetails[n].name;c.navTargetName=a.getData().aConfigDetails[n].configData[2].navTargets[r].name;break;default:break}if(a.getData().aConfigDetails&&a.getData().aConfigDetails[n]){c.appId=a.getData().aConfigDetails[n].Application}}return c}},isConfigurationSwitched:function(e,t){var n=false,i,s;var o=this.getParentNodeContext(this.getAPFTreeNodeContext(e));var g=this.getParentNodeContext(this.getAPFTreeNodeContext(t));i=o?o.configId:undefined;if(o&&!a(o)&&o.configId===undefined){s=this.getAPFTreeNodeContext(e).nodeContext.split("/")[2];i=this.getModel().getData().aConfigDetails[s].AnalyticalConfiguration}if(i!==undefined&&i!==g.configId){n=true}return n},removeSelectionOnTree:function(e){var t=this.getSelectedItem();if(e){e._getBindingContext().getObject().isSelected=false;e.setSelected(false)}else if(t){t._getBindingContext().getObject().isSelected=false;t.setSelected(false)}this.getModel().updateBindings()},setSelectionOnTree:function(e){this.selectedNode=this.getItemNodeByContextWithoutExpand(e);var t=this.getSelectedItem();if(t!==this.selectedNode){if(t&&t._getBindingContext().getObject()){t.getBindingContext().getObject().isSelected=false;t.setSelected(false)}this.setSelectedItem(this.selectedNode)}},_scrollTreeToNewNode:function(e){if(e&&e.$().length!==0){jQuery(e.$())[0].scrollIntoView()}},setSelectedNode:function(e){this.setSelectedItem(e.getItemNodeContext());this.getModel().updateBindings();this._scrollTreeToNewNode(e)},addNodeInTree:function(t,a,n){var i;var s=this.getAPFTreeNodeContext(this.getSelectedItem());var o=s?s.nodeContext.split("/")[2]:undefined;var g=s?s.nodeContext.split("/")[6]:undefined;var r=s?s.nodeContext.split("/")[8]:undefined;i=["_add",t].join("");this[i](o,g,r,a,n);var d=this._getObjectNodesArray(t,o,g,r);var c=d[d.length-1];if(c!==undefined){if(t!==e.configurationObjectTypes.CONFIGURATION){this.onItemExpanderPressed(c,true)}this.setSelectedItem(c)}},_getObjectNodesArray:function(t,a,n,i){var s=[];switch(t){case e.configurationObjectTypes.CONFIGURATION:s=this.getItems();break;case e.configurationObjectTypes.FACETFILTER:this.expandToLevel(2);var o=this.getSelectedItem().getId();var g=o.split("-");var r=g.length;var d=g[r-1];var c=this.getItems()[parseInt(d,10)+1].getItemNodeContext().children.length;if(this.getItems()[parseInt(d,10)+1].getItemNodeContext().context.sPath==="/aConfigDetails/"+a+"/configData/0"){for(var f=1;f<c;f++){s.push(this.getItems()[parseInt(d,10)+1+f])}}this.expandToLevel(1);break;case e.configurationObjectTypes.CATEGORY:this.expandToLevel(2);var o=this.getSelectedItem().getId();var g=o.split("-");var r=g.length;var d=g[r-1];if(this.getItems()[parseInt(d,10)+1].getItemNodeContext().context.sPath==="/aConfigDetails/"+a+"/configData/0"){var c=this.getItems()[parseInt(d,10)+1].getItemNodeContext().children.length;var l=parseInt(d,10)+2+c;var p=this.getItems()[parseInt(l,10)].getItemNodeContext().children.length;for(var f=1;f<p;f++){s.push(this.getItems()[parseInt(l,10)+1+f])}}this.expandToLevel(1);break;case e.configurationObjectTypes.STEP:break;case e.configurationObjectTypes.REPRESENTATION:break;case e.configurationObjectTypes.NAVIGATIONTARGET:this.expandToLevel(2);var o=this.getSelectedItem().getId();var g=o.split("-");var r=g.length;var d=g[r-1];if(this.getItems()[parseInt(d,10)+1].getItemNodeContext().context.sPath==="/aConfigDetails/"+a+"/configData/0"){var c=this.getItems()[parseInt(d,10)+1].getItemNodeContext().children.length;var l=parseInt(d,10)+2+c;var p=this.getItems()[l].getItemNodeContext().children.length;var D=l+p+1;var u=this.getItems()[D].getItemNodeContext().children.length;for(var f=1;f<u;f++){s.push(this.getItems()[D+1+f])}}this.expandToLevel(1);break;default:break}return s},_addconfiguration:function(){var t=this;this.configNewIndex=this.configNewIndex||1;var a=this.getModel();var n;n="I"+this.configNewIndex;this.configNewIndex++;var i=[],s=[],o=[],g=[];i.push({filters:s,name:t.fnTranslationFunction("facetFilters"),isSelected:false,expanded:false,selectable:false});i.push({categories:o,name:t.fnTranslationFunction("categories"),isSelected:false,expanded:false,selectable:false});i.push({navTargets:g,name:t.fnTranslationFunction("navigationTargets"),isSelected:false,expanded:false,selectable:false});var r={};r.configData=i;var d=this.fnTranslationFunction("newConfiguration");var c={name:"< "+d+" >",type:e.configurationObjectTypes.CONFIGURATION,AnalyticalConfiguration:"newConfig"+n,Application:this.applicationId,configData:i,bIsLoaded:true,isSelected:false,expanded:false,selectable:true};a.getData().aConfigDetails.push(c);a.updateBindings()},_addfacetFilter:function(t){var a=this.getModel();var n=this.fnTranslationFunction("newFacetFilter");var i=a.getData().aConfigDetails[t].configData[0].filters.length;var s={name:"< "+n+" >",type:e.configurationObjectTypes.FACETFILTER,id:"newFilter"+i,isSelected:false,selectable:true};a.getData().aConfigDetails[t].expanded=true;a.getData().aConfigDetails[t].configData[0].expanded=true;a.getData().aConfigDetails[t].configData[0].filters.push(s);a.updateBindings()},_addnavigationTarget:function(t){var a=this.getModel();var n=this.fnTranslationFunction("newNavigationTarget");var i=a.getData().aConfigDetails[t].configData[2].navTargets.length;var s={name:"< "+n+" >",type:e.configurationObjectTypes.NAVIGATIONTARGET,id:"newNavTarget"+i,isSelected:false,selectable:true};a.getData().aConfigDetails[t].expanded=true;a.getData().aConfigDetails[t].configData[2].expanded=true;a.getData().aConfigDetails[t].configData[2].navTargets.push(s);a.updateBindings()},_addcategory:function(t){var a=this.getModel();var n=this.fnTranslationFunction("newCategory");var i=a.getData().aConfigDetails[t].configData[1].categories.length;var s={name:"< "+n+" >",type:e.configurationObjectTypes.CATEGORY,id:"newCategory"+i,isSelected:false,expanded:false,selectable:true};a.getData().aConfigDetails[t].expanded=true;a.getData().aConfigDetails[t].configData[1].expanded=true;a.getData().aConfigDetails[t].configData[1].categories.push(s);a.updateBindings()},_addstep:function(t,a,n,i,s){var o=this.getModel();var g;var s=s&&s===true?true:false;if(o.getData().aConfigDetails[t].configData[1].categories[a].steps===undefined){o.getData().aConfigDetails[t].configData[1].categories[a].steps=[]}if(!i){var r=o.getData().aConfigDetails[t].configData[1].categories[a].steps.length;var d=this.fnTranslationFunction("newStep");g={name:"< "+d+" >",type:e.configurationObjectTypes.STEP,id:"newStep"+r,isSelected:false,expanded:false,selectable:true,bIsHierarchicalStep:s};o.getData().aConfigDetails[t].expanded=true;o.getData().aConfigDetails[t].configData[1].expanded=true;o.getData().aConfigDetails[t].configData[1].categories[a].expanded=true;o.getData().aConfigDetails[t].configData[1].categories[a].steps.push(g)}else{var c,f,l;for(f=0;f<i.noOfSteps;f++){c={name:i.aExistingStepsToBeAdded[f].step.name,type:e.configurationObjectTypes.STEP,id:i.aExistingStepsToBeAdded[f].step.id,isSelected:false,expanded:false,selectable:true,icon:s===true?"sap-icon://drill-down":"sap-icon://step"};o.getData().aConfigDetails[t].configData[1].categories[a].steps.push(c);if(i.aExistingStepsToBeAdded[f].noOfReps!==0){n=o.getData().aConfigDetails[t].configData[1].categories[a].steps.length-1;for(l=0;l<i.aExistingStepsToBeAdded[f].noOfReps;l++){var p={id:i.aExistingStepsToBeAdded[f].representations[l].id,name:i.aExistingStepsToBeAdded[f].representations[l].name,icon:i.aExistingStepsToBeAdded[f].representations[l].icon};this._addrepresentation(t,a,n,p)}}}}o.updateBindings()},_addrepresentation:function(t,a,n,i){var s=this.getModel();var o=this;var g;if(i===undefined){var r=this.getAPFTreeNodeContext(this.getSelectedItem());if(r.nodeObjectType===e.configurationObjectTypes.REPRESENTATION){g=this.getParentNodeContext(r,s).stepId}else if(r.nodeObjectType===e.configurationObjectTypes.STEP){g=r.nodeAPFId}var d=[];s.getData().aConfigDetails[t].configData[1].categories.forEach(function(e,a){if(s.getData().aConfigDetails[t].configData[1].categories[a].steps){s.getData().aConfigDetails[t].configData[1].categories[a].steps.forEach(function(e,t){var n={};if(e.id===g){n.stepIndex=t;n.categoryIndex=a;d.push(n)}})}});d.forEach(function(a){if(s.getData().aConfigDetails[t].configData[1].categories[a.categoryIndex].steps[a.stepIndex].representations===undefined){s.getData().aConfigDetails[t].configData[1].categories[a.categoryIndex].steps[a.stepIndex].representations=[]}var n=s.getData().aConfigDetails[t].configData[1].categories[a.categoryIndex].steps[a.stepIndex].representations.length;var i={name:o.fnTranslationFunction(o.defaultRepresentationType),type:e.configurationObjectTypes.REPRESENTATION,id:"newRepresentation"+n,isSelected:false,selectable:true};s.getData().aConfigDetails[t].expanded=true;s.getData().aConfigDetails[t].configData[1].expanded=true;s.getData().aConfigDetails[t].configData[1].categories[a.categoryIndex].expanded=true;s.getData().aConfigDetails[t].configData[1].categories[a.categoryIndex].steps[a.stepIndex].expanded=true;s.getData().aConfigDetails[t].configData[1].categories[a.categoryIndex].steps[a.stepIndex].representations.push(i)})}else{if(s.getData().aConfigDetails[t].configData[1].categories[a].steps[n].representations===undefined){s.getData().aConfigDetails[t].configData[1].categories[a].steps[n].representations=[]}var c={name:i.name,type:e.configurationObjectTypes.REPRESENTATION,id:i.id,isSelected:false,selectable:true,icon:i.icon};s.getData().aConfigDetails[t].configData[1].categories[a].steps[n].representations.push(c)}s.updateBindings()}});t("sap.apf.modeler.ui.utils.APFTree",s);return s},true);
//# sourceMappingURL=APFTree.js.map