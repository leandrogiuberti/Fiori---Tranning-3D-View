/*!
 * SAP APF Analysis Path Framework
 *
 * (c) Copyright 2012-2014 SAP AG. All rights reserved
 */
sap.ui.define(["sap/apf/ui/instance","sap/apf/core/instance","sap/apf/core/messageHandler","sap/apf/core/messageDefinition","sap/apf/core/constants","sap/apf/core/utils/filterSimplify","sap/apf/utils/utils","sap/apf/utils/filter","sap/apf/utils/exportToGlobal","sap/apf/utils/externalContext","sap/apf/utils/startFilterHandler","sap/apf/utils/startFilter","sap/apf/utils/filterIdHandler","sap/apf/utils/serializationMediator","sap/apf/utils/navigationHandler","sap/apf/utils/startParameter","sap/apf/messageCallbackForStartup","sap/apf/ui/representations/RepresentationInterfaceProxy","sap/base/Log","sap/m/App","sap/m/Text","sap/ui/thirdparty/datajs","sap/ui/thirdparty/jquery"],function(t,e,r,n,a,i,s,o,c,u,f,p,l,d,g,h,m,v,C,P,F,A,jQuery){"use strict";function S(o,c,S){var y;var x;var H;var R;var b;var T;var M;var k;var E;var w;var q;var I;var j;var L=true;var B=jQuery.Deferred();var z=new jQuery.Deferred;var N;var O;this.type="api";this.constants={};this.constants.eventTypes=a.eventTypes;this.destroy=function(){y.activateOnErrorHandling(false);y.setMessageCallback(undefined);y.setLifeTimePhaseShutdown();if(I&&I.destroy){I.destroy()}if(x){x.destroy()}I=undefined;x=undefined;y=undefined;H=undefined;R=undefined};this.activateOnErrorHandling=function(t){return x.activateOnErrorHandling(t)};this.getStartParameterFacade=function(){return x.getStartParameterFacade()};this.getLogMessages=function(){return x.getLogMessages()};this.createStep=function(t,e,r){return x.createStep(t,e,r)};this.getActiveStep=function(){return x.getActiveStep()};this.getCategories=function(){return x.getCategories()};this.getSteps=function(){return x.getSteps()};this.getStepTemplates=function(){return x.getStepTemplates()};this.getFacetFilterConfigurations=function(){return x.getFacetFilterConfigurations()};this.getApplicationConfigProperties=function(){return x.getApplicationConfigProperties()};this.moveStepToPosition=function(t,e,r){return x.moveStepToPosition(t,e,r)};this.removeStep=function(t,e){return x.removeStep(t,e)};this.resetPath=function(){return x.resetPath()};this.setActiveStep=function(t){return x.setActiveStep(t)};this.stepIsActive=function(t){return x.stepIsActive(t)};this.updatePath=function(t){return x.updatePath(t)};this.getApfLocation=function(){return x.getUriGenerator().getApfLocation()};this.readPaths=function(t){return x.readPaths(t)};this.savePath=function(t,e,r){x.savePath(t,e,r)};this.openPath=function(t,e,r){return x.openPath(t,e,r)};this.deletePath=function(t,e){return x.deletePath(t,e)};this.addFacetFilter=function(t){I.getLayoutView().getController().addFacetFilter(t)};this.getEventCallback=function(t){return I.getEventCallback(t)};this.putMessage=function(t){return x.putMessage(t)};this.createMessageObject=function(t){return x.createMessageObject(t)};this.getTextHtmlEncoded=function(t,e){return x.getTextHtmlEncoded(t,e)};this.getTextNotHtmlEncoded=function(t,e){return x.getTextNotHtmlEncoded(t,e)};if(!S){this.loadApplicationConfig=function(t){x.loadApplicationConfig(t)}}else{this.loadApplicationConfig=function(t){}}this.createFilter=function(){return x.createFilter()};this.addPathFilter=function(t){return M.add(t)};this.updatePathFilter=function(t,e){M.update(t,e)};this.getPathFilter=function(t){return M.get(t)};this.createReadRequest=function(t){return x.createReadRequest(t)};this.createReadRequestByRequiredFilter=function(t){return x.createReadRequestByRequiredFilter(t)};this.selectionChanged=function(t){I.selectionChanged(t)};this.createApplicationLayout=function(){if(!N){N=(new P).addStyleClass("sapApf")}return N};this.startApf=function(){var t;var e=this;var r=this.createApplicationLayout();z.done(function(){try{if(this.fnBeforeApfStartupCallback&&typeof this.fnBeforeApfStartupCallback==="function"){this.fnBeforeApfStartupCallback.apply(o,[this])}B.resolve();I.createApplicationLayout(r).then(function(){t=R.checkMode();var r=I.handleStartup(t);r.done(function(){if(e.fnAfterApfStartupCallback&&typeof e.fnAfterApfStartupCallback==="function"){e.fnAfterApfStartupCallback.apply(o,[e])}y.setLifeTimePhaseRunning()})})}catch(t){L=false}}.bind(this));return r};this.addMasterFooterContent=function(t){return I.addMasterFooterContentRight(t)};this.setEventCallback=function(t,e){switch(t){case a.eventTypes.contextChanged:I.setEventCallback(t,e);return true;case a.eventTypes.printTriggered:I.setEventCallback(t,e);return true;case a.eventTypes.format:this.customFormat(e);return true;default:return false}};this.customFormat=function(t){I.setCustomFormatExit(t)};this.setCallbackBeforeApfStartup=function(t){this.fnBeforeApfStartupCallback=t};this.setCallbackAfterApfStartup=function(t){this.fnAfterApfStartupCallback=t};this.getPropertyValuesOfExternalContext=function(t){var e=jQuery.Deferred();T.getCombinedContext().then(function(r){var n=r.getFilterTermsForProperty(t);var a=[];n.forEach(function(t){var e={Low:t.getValue(),Option:t.getOp(),High:t.getHighValue()};a.push(e)});e.resolve(a)});return e.promise()};this.startupSucceeded=function(){return L};if(o&&o.getInjections instanceof Function){if(!c){c={}}jQuery.extend(c,c,o.getInjections())}H=new(c&&c.constructors&&c.constructors.StartParameter||h)(o,S);y=new(c&&c.constructors&&c.constructors.MessageHandler||r);y.activateOnErrorHandling(true);y.setLifeTimePhaseStartup();y.loadConfig(n,true);j=c&&c.functions&&c.functions.messageCallbackForStartup||m;y.setMessageCallback(j);if(c&&c.functions&&c.functions.isUsingCloudFoundryProxy){O=c.functions.isUsingCloudFoundryProxy}else{O=function(){return false}}try{x=new(c&&c.constructors&&c.constructors.CoreInstance||e.constructor)({functions:{isUsingCloudFoundryProxy:O,getCumulativeFilter:function(){return b.getCumulativeFilter()},getCombinedContext:function(){return T.getCombinedContext()},ajax:c&&c.functions&&c.functions.ajax,serializeApfState:function(t,e){return q.serialize(t,e)},deserializeApfState:function(t){return q.deserialize(t)},odataRequest:c&&c.functions&&c.functions.odataRequest,getComponentName:function(){if(S&&S.manifest&&S.manifest["sap.app"]){return S.manifest["sap.app"].id}return o.getMetadata().getComponentName()}},instances:{messageHandler:y,startParameter:H,datajs:c&&c.instances&&c.instances.datajs||A,component:o},constructors:{Request:c&&c.constructors&&c.constructors.Request,Metadata:c&&c.constructors&&c.constructors.Metadata,MetadataFactory:c&&c.constructors&&c.constructors.MetadataFactory,ResourcePathHandler:c&&c.constructors&&c.constructors.ResourcePathHandler,TextResourceHandler:c&&c.constructors&&c.constructors.TextResourceHandler,SessionHandler:c&&c.constructors&&c.constructors.SessionHandler,Persistence:c&&c.constructors&&c.constructors.Persistence,AnalysisPathProxy:c&&c.constructors&&c.constructors.AnalysisPathProxy},manifests:S,exits:c&&c.exits,coreProbe:c&&c.coreProbe,corePromise:z});E={instances:{startParameter:H,component:o,messageHandler:y},functions:{getConfigurationProperties:x.getApplicationConfigProperties,ajax:x.ajax}};T=new(c&&c.constructors&&c.constructors.ExternalContext||u)(E);k={functions:{getFacetFilterConfigurations:x.getFacetFilterConfigurations,getReducedCombinedContext:x.getReducedCombinedContext,createRequest:x.getFunctionCreateRequest()},instances:{messageHandler:y,onBeforeApfStartupPromise:B.promise()},constructors:{StartFilter:p}};b=new(c&&c.constructors&&c.constructors.StartFilterHandler||f)(k);w={functions:{setRestrictionByProperty:b.setRestrictionByProperty,getRestrictionByProperty:b.getRestrictionByProperty},instances:{messageHandler:y}};M=new(c&&c.constructors&&c.constructors.FilterIdHandler||l)(w);q=new(c&&c.constructors&&c.constructors.SerializationMediator||d)({instances:{coreApi:x,filterIdHandler:M,startFilterHandler:b,messageHandler:y}});var U={constructors:{FilterReduction:i.FilterReduction},functions:{getCumulativeFilterUpToActiveStep:x.getCumulativeFilterUpToActiveStep,getNavigationTargets:x.getNavigationTargets,getActiveStep:x.getActiveStep,createRequest:x.getFunctionCreateRequest(),getXappStateId:x.getStartParameterFacade().getXappStateId,isFilterReductionActive:x.getStartParameterFacade().isFilterReductionActive,getAllParameterEntitySetKeyProperties:x.getMetadataFacade().getAllParameterEntitySetKeyProperties},instances:{messageHandler:y,component:o,serializationMediator:q}};R=new(c&&c.constructors&&c.constructors.NavigationHandler||g)(U);I=new(c&&c.constructors&&c.constructors.UiInstance||t)({oCoreApi:x,oFilterIdHandler:M,oSerializationMediator:q,oNavigationHandler:R,oComponent:o,oStartParameter:H,oStartFilterHandler:b,functions:c&&c.functions||{},exits:c&&c.exits||{}})}catch(t){L=false;this.startApf=function(){return new F({text:""})};this.loadApplicationConfig=function(){return""};C.error("Caught exception during creation of APF API")}if(x){x.createRepresentation=function(t,e){var r=t.replaceAll(".","/");var n=sap.ui.requireSync(r)||s.extractFunctionFromModulePathString(t);var a=new v(x,I);return new n(a,e)}}if(c&&c.probe&&typeof c.probe==="function"){c.probe({apfApi:this,coreApi:x,component:o,uiApi:I,messageHandler:y,serializationMediator:q,navigationHandler:R,startParameter:H,injectedFunctionsNavigationHandler:U&&U.functions,startFilterHandler:b,externalContext:T,filterIdHandler:M,corePromise:z})}}c("sap.apf.Api",S);return S},true);
//# sourceMappingURL=api.js.map