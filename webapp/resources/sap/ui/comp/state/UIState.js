/*!
 * SAPUI5
 * (c) Copyright 2025 SAP SE. All rights reserved.
 */
sap.ui.define(["sap/base/i18n/Formatting","sap/ui/comp/library","sap/ui/base/ManagedObject","sap/ui/comp/odata/MetadataAnalyser","sap/ui/core/Locale","sap/ui/model/odata/AnnotationHelper","sap/ui/model/Context","sap/base/util/isEmptyObject"],function(e,t,r,a,n,i,o,s){"use strict";var u=r.extend("sap.ui.comp.state.UIState",{metadata:{library:"sap.ui.comp",properties:{presentationVariant:{type:"object"},selectionVariant:{type:"object"},variantName:{type:"string"},valueTexts:{type:"object"},semanticDates:{type:"object"},tableSettings:{type:"object"}}}});u._getFilterNamesWithValuesForCurrentLanguage=function(t){var r=[],a=new n(e.getLanguageTag()).getLanguage();if(t&&t.Texts){t.Texts.some(function(e){if(e.Language===a){e.PropertyTexts.forEach(function(e){var t,a=false;for(var n=0;n<r.length;n++){if(r[n].filterName===e.PropertyName){t=r[n];a=true;break}}if(e.PropertyName&&e.ValueTexts&&Object.keys(e.ValueTexts).length>0){e.ValueTexts.forEach(function(r){if(!t){t={filterName:e.PropertyName,keys:[]}}t.keys.push(r.PropertyValue)})}if(!a&&t&&t.keys.length){r.push(t)}});return true}return false})}return r};u._getFilterNamesWithValuesFromSelectOption=function(e,t){var r=[];if(e&&e.SelectOptions){e.SelectOptions.forEach(function(e){var a=t?t.indexOf(e.PropertyName)<0:true;if(a){var n={filterName:e.PropertyName,keys:[]};e.Ranges.forEach(function(e){if(e.Option==="EQ"&&e.Sign==="I"){n.keys.push(e.Low)}});r.push(n)}})}return r};u._determineFiltersWithOnlyKeyValues=function(e,t){var r,a,n=[];e=e||[];t=t||[];t.forEach(function(t){var i={filterName:t.filterName,keys:[]};a=null;e.some(function(e){if(t.filterName===e.filterName){a=e}return a!==null});for(var o=0;o<t.keys.length;o++){r=false;if(a){for(var s=0;s<a.keys.length;s++){if(t.keys[o]===a.keys[s]){r=true;break}}}if(!r){i.keys.push(t.keys[o])}}if(i.keys.length){n.push(i)}});return n};u.determineFiltersWithOnlyKeyValues=function(e,t,r){var a=u._getFilterNamesWithValuesForCurrentLanguage(e);var n=u._getFilterNamesWithValuesFromSelectOption(t,r);return u._determineFiltersWithOnlyKeyValues(a,n)};u.calculateValueTexts=function(t,r){var a=null;var i=function(t,r){var i=null;if(!a){a={Texts:[{ContextUrl:"",Language:new n(e.getLanguageTag()).getLanguage(),PropertyTexts:[]}]}}for(var o=0;o<a.Texts[0].PropertyTexts.length;o++){if(a.Texts[0].PropertyTexts[o].PropertyName===t){i=a.Texts[0].PropertyTexts[o];break}}if(!i){i={PropertyName:t,ValueTexts:[]};a.Texts[0].PropertyTexts.push(i)}i.ValueTexts.push({PropertyValue:r.key,Text:r.text})};if(r&&t&&t.SelectOptions){t.SelectOptions.forEach(function(e){if(r[e.PropertyName]){if(r[e.PropertyName].ranges){r[e.PropertyName].ranges.forEach(function(t){if(t.hasOwnProperty("text")){i(e.PropertyName,t)}})}if(r[e.PropertyName].items){r[e.PropertyName].items.forEach(function(t){if(t.hasOwnProperty("text")){i(e.PropertyName,t)}})}}})}return a};u.enrichWithValueTexts=function(t,r){var a=false,i,o,s,u=t;o=new n(e.getLanguageTag()).getLanguage().toLowerCase();if(r&&r.Texts){r.Texts.some(function(e){if(e.Language&&e.Language.toLowerCase()===o){i=e}return i!==null});if(i&&i.PropertyTexts){if(!s){s=JSON.parse(t)}i.PropertyTexts.forEach(function(e){var t=s[e.PropertyName];if(t&&t.ranges&&e.ValueTexts){e.ValueTexts.forEach(function(r){var n=null,i=-1;if(r.Text){t.ranges.some(function(e,t){if(!e.exclude&&e.operation==="EQ"&&e.value1===r.PropertyValue){n=e;i=t}return n!=null})}if(n){a=true;if(!t.items){t.items=[]}t.items.push({key:r.PropertyValue,text:r.Text});s[e.PropertyName].ranges.splice(i,1)}})}});if(a){u=JSON.stringify(s)}}}return u};u.createFromSelectionAndPresentationVariantAnnotation=function(e,t,r){var n={};if(t&&t.SelectOptions&&t.SelectOptions.length){n.SelectOptions=t.SelectOptions.map(function(e){return{PropertyName:e.PropertyName.PropertyPath,Ranges:e.Ranges.map(function(e){var t=new o(null,"/");return{Sign:a.getSelectionRangeSignType([e.Sign.EnumMember]),Option:a.getSelectionRangeOptionType([e.Option.EnumMember]),Low:e.Low&&i.format(t,e.Low)||undefined,High:e.High&&i.format(t,e.High)||undefined}})}})}if(t&&t.Parameters&&t.Parameters.length){n.Parameters=t.Parameters.map(function(e){var t=new o(null,"/");return{PropertyName:e.PropertyName.PropertyPath,PropertyValue:e.PropertyValue&&i.format(t,e.PropertyValue)||undefined}})}var l={};if(r&&r.lineItemAnnotation){if(!l.Visualizations){l.Visualizations=[]}var f=[];if(r.lineItemAnnotation.fields){var p=r.lineItemAnnotation.labels;var c=r.lineItemAnnotation.urlInfo;var m=r.lineItemAnnotation.importance;var y=r.lineItemAnnotation.criticality;r.lineItemAnnotation.fields.forEach(function(e){var t={Value:e};t.Label=p[e]?p[e]:null;t.IconUrl=c[e]?c[e]:null;t.Importance=m[e]?m[e]:null;t.Criticality=y[e]?y[e]:null;f.push(t)})}l.Visualizations.push({Type:"LineItem",Content:f})}if(r&&r.chartAnnotation){if(!l.Visualizations){l.Visualizations=[]}l.Visualizations.push({Type:"Chart",Content:{ChartType:r.chartAnnotation.chartType,Measures:r.chartAnnotation.measureFields,MeasureAttributes:Object.keys(r.chartAnnotation.measureAttributes).map(function(e){return{Measure:e,Role:r.chartAnnotation.measureAttributes[e].role}}),Dimensions:r.chartAnnotation.dimensionFields,DimensionAttributes:Object.keys(r.chartAnnotation.dimensionAttributes).map(function(e){return{Dimension:e,Role:r.chartAnnotation.dimensionAttributes[e].role}})}})}if(r&&r.maxItems){l.MaxItems=parseInt(r.maxItems)}if(r&&r.sortOrderFields){l.SortOrder=r.sortOrderFields.map(function(e){return{Property:e.name,Descending:e.descending}})}if(r&&r.groupByFields){l.GroupBy=r.groupByFields}if(r&&r.requestAtLeastFields){l.RequestAtLeast=r.requestAtLeastFields}return new u({presentationVariant:!s(l)?l:undefined,selectionVariant:!s(n)?n:undefined,variantName:e?e:undefined})};u.calcSemanticDates=function(e,t){var r=null;var a=function(e,t){var a=null;if(!r){r={Dates:[]}}for(var n=0;n<r.Dates.length;n++){if(r.Dates[n].PropertyName===e){a=r.Dates[n];break}}if(!a){a={PropertyName:e,Data:t.conditionTypeInfo.data};r.Dates.push(a)}};if(t&&e&&e.SelectOptions){e.SelectOptions.forEach(function(e){if(t[e.PropertyName]){if(t[e.PropertyName].ranges){if(t[e.PropertyName].hasOwnProperty("conditionTypeInfo")){a(e.PropertyName,t[e.PropertyName])}}}})}return r};u.enrichWithSemanticDates=function(e,t){var r=false,a,n=e;if(t&&t.Dates){if(!a){a=JSON.parse(e)}t.Dates.forEach(function(e){var t=a[e.PropertyName];if(t&&t.ranges&&e.Data){r=true;if(!t.items){t.items=[]}t.ranges[0].semantic=e.Data}});if(r){n=JSON.stringify(a)}}return n};return u});
//# sourceMappingURL=UIState.js.map