/*!
 * SAPUI5
 * (c) Copyright 2025 SAP SE. All rights reserved.
 */
sap.ui.define(["sap/m/VariantManagement","sap/ui/model/base/ManagedObjectModel","sap/ui/base/ManagedObjectObserver","sap/base/Log","./SmartVariantManagementMediator"],function(e,t,a,i,n){"use strict";const r=n.extend("sap.ui.comp.smartvariants.SmartVariantManagementBase",{metadata:{interfaces:["sap.m.IOverflowToolbarContent"],library:"sap.ui.comp",designtime:"sap/ui/comp/designtime/smartvariants/SmartVariantManagementBase.designtime",properties:{standardItemAuthor:{type:"string",group:"Misc",defaultValue:"SAP"},initialSelectionKey:{type:"string",group:"Misc",defaultValue:null},lifecycleSupport:{type:"boolean",group:"Misc",defaultValue:false}}},renderer:{apiVersion:2}});r.prototype.init=function(){n.prototype.init.apply(this);this._mVariants={};this.STANDARDVARIANTKEY="*standard*";this._mTranslatablePromises={};this.addStyleClass("sapUiCompVarMngmt");this.setStandardVariantKey(this.STANDARDVARIANTKEY);this._oObserver=new a(this._observeChanges.bind(this));this._oObserver.observe(this,{properties:["standardItemText"]});this.setDefaultVariantKey(this.getStandardVariantKey());this.setPopoverTitle(this.oResourceBundle.getText("VARIANT_MANAGEMENT_VARIANTS"));this._setStandardVariantKey(this.STANDARDVARIANTKEY)};r.prototype._observeChanges=function(e){if(e.type==="property"){if(this._mTranslatablePromises[e.name]&&this._mTranslatablePromises[e.name].fnResolve){this._mTranslatablePromises[e.name].fnResolve(e.current)}else if(!this._mTranslatablePromises[e.name]){this._mTranslatablePromises[e.name]={promise:Promise.resolve(e.current)}}}};r.prototype._createEmbeddedVM=function(){n.prototype._createEmbeddedVM.apply(this);this._oVM.attachCancel(this._onCancel,this);this._oVM.attachManageCancel(this._onManageCancel,this)};r.prototype._destroyEmbeddedVM=function(){if(this._oVM){this._oVM.detachCancel(this._onCancel,this);this._oVM.detachManageCancel(this._onManageCancel,this)}n.prototype._destroyEmbeddedVM.apply(this)};r.prototype._onCancel=function(e){if(this._fGetDataForKeyUser){this._fGetDataForKeyUser();this._cleanUpSaveForKeyUser()}};r.prototype._onSave=function(e){const t=e.getParameters();if(this._fGetDataForKeyUser){this._prepareSaveAsKeyUserData(t);return}n.prototype._onSave.apply(this,arguments)};r.prototype._onManage=function(e){const t=e.getParameters();if(this._fGetDataForKeyUser){this._prepareManageKeyUserData(t);return}this.fireManage(t)};r.prototype._onManageCancel=function(e){if(this._fGetDataForKeyUser){this._fGetDataForKeyUser();this._cleanUpManageViewsForKeyUser()}};r.prototype._onSelect=function(e){if(!this._fGetDataForKeyUser){this.setModified(false)}n.prototype._onSelect.apply(this,arguments)};r.prototype._getStandardVariantItemName=function(){const e="standardItemText";if(this.getBindingInfo(e)){return this._waitForTranslation(e)}else{return Promise.resolve(this._determineStandardVariantName())}};r.prototype._waitForTranslation=function(e){if(!this._mTranslatablePromises[e]){let t=null;const a=new Promise(e=>{t=e});this._mTranslatablePromises[e]={promise:a,fnResolve:t}}return this._mTranslatablePromises[e].promise};r.prototype.setInitialSelectionKey=function(e){return this.setSelectionKey(e)};r.prototype.getInitialSelectionKey=function(){return this.getSelectionKey()};r.prototype._prepareSaveAsKeyUserData=function(e){try{this._getContentAsync().then(t=>{const a={default:e.def,executeOnSelection:e.execute,type:this._getPersoControllerType(),text:e.name,contexts:e.contexts,content:t};this._fGetDataForKeyUser(a);this._cleanUpSaveForKeyUser()})}catch(e){i.error("'_prepareSaveAsKeyUserData' throws an exception:"+e.message);this._fGetDataForKeyUser();this._cleanUpSaveForKeyUser()}};r.prototype._prepareManageKeyUserData=function(e){const t={};let a=false;if(e.hasOwnProperty("def")){const a=e.def;if(a!==this._oVM._sOriginalDefaultKey){t.default=a}}if(e.hasOwnProperty("deleted")){e.deleted.forEach(e=>{if(!t[e]){t[e]={}}t[e].deleted=true;if(this.getSelectionKey()===e){a=true}})}if(e.hasOwnProperty("exe")){e.exe.forEach(e=>{if(!t[e.key]){t[e.key]={}}t[e.key].executeOnSelection=e.exe})}if(e.hasOwnProperty("fav")){e.fav.forEach(e=>{if(!t[e.key]){t[e.key]={}}t[e.key].favorite=e.visible})}if(e.hasOwnProperty("renamed")){e.renamed.forEach(e=>{if(!t[e.key]){t[e.key]={}}t[e.key].name=e.name})}if(e.hasOwnProperty("contexts")){e.contexts.forEach(e=>{if(!t[e.key]){t[e.key]={}}t[e.key].contexts=e.contexts})}if(a){this.activateVariant(this.getStandardVariantKey())}this._fGetDataForKeyUser(t);this._cleanUpManageViewsForKeyUser()};r.prototype._updateLayerSpecificInformations=function(){this.getVariants().forEach(e=>{const t=this._getVariantById(e.getKey());if(t){e.setRemove(t.isDeleteEnabled(this._sLayer));e.setRename(t.isRenameEnabled(this._sLayer))}})};r.prototype.getPersonalizableControlPersistencyKey=function(){if(this.isPageVariant()){return this.getPersistencyKey()}const e=this._getAllPersonalizableControls();if(e&&e.length===1){return this._getControlPersKey(e[0])}return null};r.prototype.getPresentVariantId=function(){return this.getCurrentVariantId()?this.getCurrentVariantId():this.STANDARDVARIANTKEY};r.prototype.getPresentVariantText=function(){return this._oVM.getSelectedVariantText(this.getPresentVariantId())};r.prototype.getPresentVariantContent=function(){return this._getContentAsync()};r.prototype._getPersoController=function(){return this._oPersoControl};r.prototype._getPersoControllerType=function(){if(this.isPageVariant()){return"page"}const e=this._getAllPersonalizableControls();if(e&&e.length===1){return e[0].type}return null};r.prototype._getViewByName=function(e){let t;const a=e.trim();const i=this.getVariants();for(let e=0;e<i.length;e++){t=i[e].getText().trim();if(t===a){return i[e]}}return null};r.prototype.getViewIdByName=function(e){const t=this._getViewByName(e);return t?t.getKey():null};r.prototype._isDuplicateSaveAs=function(e){const t=e.trim();if(!t){return true}const a=this._determineStandardVariantName();if(a===t){return true}return this._getViewByName(t)?true:false};r.prototype.isNameDuplicate=function(e){const t=e.trim();return this._isDuplicateSaveAs(t)};r.prototype.isNameTooLong=function(t){const a=t.trim();return a.length>e.MAX_NAME_LEN};r.prototype._executeOnSelectForStandardVariantByXML=function(e){this.bExecuteOnSelectForStandardViaXML=e};r.prototype.getExecuteOnSelectForStandardVariant=function(){let e=false;const t=this.getItemByKey(this.getStandardVariantKey());if(t){e=t.getExecuteOnSelect()}return e||this.bExecuteOnSelectForStandardViaXML};r.prototype.openManageViewsDialogForKeyUser=function(e,t,a=false){this._sLayer=e.layer;this._fGetDataForKeyUser=t;this._updateLayerSpecificInformations();let i=true;if(a){i=false}this._oVM.openManagementDialog(i,e.rtaStyleClass,e.contextSharingComponentContainer)};r.prototype.getTitle=function(){return this._oVM.getTitle()};r.prototype.refreshTitle=function(){this._oVM.refreshTitle()};r.prototype.enteringDesignMode=function(){this.setDesignTimeMode(true)};r.prototype.leavingDesignMode=function(){this.setDesignTimeMode(false)};r.prototype.setDesignTimeMode=function(e){this.oModel.setVariantsEditable(!e,this.oContext?.path);return this._oVM.setDesignMode(e)};r.prototype.getManageDialog=function(){if(this._oVM){return this._oVM.oManagementDialog}return null};r.prototype.openSaveAsDialogForKeyUser=function(e,t,a){this._fGetDataForKeyUser=t;this._oVM.openSaveAsDialog(e,a)};r.prototype._cleanUpSaveForKeyUser=function(){if(this._oRolesComponentContainer){this.oSaveDialog.removeContent(this._oRolesComponentContainer)}this._cleanUpKeyUser()};r.prototype.getDefaultVariantId=function(){return this.getDefaultVariantKey()};r.prototype.setDefaultVariantId=function(e){this.setDefaultVariantKey(e)};r.prototype.activateVariant=function(e){this.setCurrentVariantKey(e);this.setModified(false);this.fireSelect({key:e})};r.prototype.getAllVariants=function(){const e=this.oModel.getVariants();const t=[];if(!e||e.length<1){return t}e.forEach(e=>{t.push(this._getVariantById(e.key))});return t};r.prototype.updateVariant=function(e){this.oModel.updateVariant(e)};r.prototype.addVariant=function(e,t){this._createVariantItem(e);if(t){this.setDefaultVariantId(e.getVariantId())}};r.prototype._insertVariantItem=function(e,t){let a=0;const i=this.oModel.getVariants();if(e.getVariantId()===this.STANDARDVARIANTKEY){t.author=this.getStandardItemAuthor()}else{a=this._getIdxSorted(e.getName())}i.splice(a,0,t);this.oModel.setVariants(i)};r.prototype.removeVariant=function(e){if(e.variantId){this.oModel.removeVariant(e.variantId);delete this._mVariants[e.variantId]}if(e.previousVariantId){this.activateVariant(e.previousVariantId)}if(e.previousDefault){this.setDefaultVariantId(e.previousDefault)}};r.prototype.removeWeakVariant=function(e){if(e.variantId){this.oModel.removeVariant(e.variantId);delete this._mVariants[e.variantId]}if(e.previousVariantId){this.setSelectionKey(e.previousVariantId)}if(e.previousDirtyFlag){this.setModified(e.previousDirtyFlag)}if(e.previousDefault){this.setDefaultVariantId(e.previousDefault)}};r.prototype._cleanUpManageViewsForKeyUser=function(){this._destroyManageDialog();this._cleanUpKeyUser()};r.prototype._cleanUpKeyUser=function(){this.setShowShare(this._bShowShare);this._fGetDataForKeyUser=null;this._sLayer=null;this._oRolesComponentContainer=null};r.prototype._getContentAsync=function(){return Promise.resolve(this._fetchContentAsync())};r.prototype.exit=function(){this._oObserver.disconnect();this._oObserver=undefined;this._mTranslatablePromises=null;this._mVariants=null;if(this._oManagedObjectModel){this._oManagedObjectModel.destroy();this._oManagedObjectModel=undefined}this._fRegisteredApplyAutomaticallyOnStandardVariant=null;n.prototype.exit.apply(this)};return r});
//# sourceMappingURL=SmartVariantManagementBase.js.map