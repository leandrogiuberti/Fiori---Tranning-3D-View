/*!
 * SAPUI5
 * (c) Copyright 2025 SAP SE. All rights reserved.
 */
sap.ui.define(["sap/base/i18n/Localization","sap/ui/base/Object","sap/ui/core/date/UI5Date","sap/ui/model/Filter","sap/ui/model/FilterOperator","sap/ui/comp/util/DateTimeUtil","sap/ui/comp/util/FormatUtil","sap/ui/comp/util/FilterUtil","sap/ui/comp/library"],function(e,i,t,n,a,l,o,s,r){"use strict";var f=r.smartfilterbar.FilterType,u=r.valuehelpdialog.ValueHelpRangeOperation;var c=i.extend("sap.ui.comp.smartfilterbar.FilterProviderUtils");c.FIELD_NAME_REGEX=/\./g;c.BASIC_SEARCH_FIELD_ID="_BASIC_SEARCH_FIELD";c.BASIC_FILTER_AREA_ID="_BASIC";c.FILTER_MODEL_NAME="fi1t3rM0d31";c.CUSTOM_FIELDS_MODEL_PROPERTY="_CUSTOM";c.ASSOCIATE_VALUE_LISTS="AssociateValueLists";c.INTL_TIMEZONE=Intl.DateTimeFormat().resolvedOptions().timeZone;c.UI_TIMEZONE=e.getTimezone();c._getStringEmptyFilter=function(e,i,t){var l=t?a.NE:a.EQ,o=i&&i.type==="Edm.Guid"?"00000000-0000-0000-0000-000000000000":"";if(i&&i.nullable==="false"){return new n(e,l,o)}else if(i&&i.isDigitSequence){return new n(e,l,i.ui5Type.formatValue("","string",true))}return new n({and:!!t,filters:[new n(e,l,o),new n(e,l,null)]})};c._getFieldMetadata=function(e,i){var t=null;e.some(function(e){if(e&&e.fields){e.fields.some(function(e){if(e&&e.fieldName===i){t=e}return t!==null})}return t!==null});return t};c._getAnalyticalFieldMetadata=function(e,i){var t=null;e.some(function(e){if(e&&e.fieldName===i){t=e}return t!==null});return t};c._getTimezone=function(e,i){var t=e&&e.find(function(e){return e.key===i});if(t){return t.value}return null};c.adaptTime=function(e,i){var t;if(!(e instanceof Date)||!i){return e}if(i.filterRestriction===f.single&&i.control&&i.control.isA("sap.m.DynamicDateRange")){return l.normalizeDate(e,true)}if(i.displayFormat==="Date"){return l.normalizeDate(e,true)}t=parseInt(i.precision);return l.adaptPrecision(e,t)};c.generateFilters=function(e,i,r,f){var p=[],d=null,T=null,m=null,E=null,g=c.FIELD_NAME_REGEX,I=null,w,h,D=null,_=0,v=0,O,F,C,M,U,y,L,S,N,A,x,V=[],B,R,z,Q,b;if(r){O=r.dateSettings;F=r.useContainsAsDefault;C=r.stringFields;M=r.timeFields;L=r.dateTimeOffsetValueFields;V=r.viewMetadataData||[];S=r.dateTimeOffsetWithTimeZone}if(e){if(i){v=e.length;while(v--){y=false;N=false;E=e[v];A=this._getTimezone(S,E);x=c._getFieldMetadata(V,E);if(x&&x.isCustomFilterField){continue}if(x){Q=x.isConstant;b=x.isInitialValueSignificant}if(E&&E!==c.BASIC_SEARCH_FIELD_ID){D=null;U=false;if(F&&C){if(C.indexOf(E)>-1){U=true}}else if(M&&M.indexOf(E)>-1){y=true}else if(L&&L.indexOf(E)>-1){N=true}I=i[E];E=E.replace(g,"/");if(I&&I.hasOwnProperty("low")){if(I.low&&I.high){w=I.low;h=I.high;if(!N&&O&&O.UTC&&w instanceof Date&&h instanceof Date){w=l.localToUtc(w);h=l.localToUtc(h)}w=c.adaptTime(w,x);h=c.adaptTime(h,x);p.push(new n(E,a.BT,w,h))}else if(I.low){if(I.low instanceof Date){w=I.low;if(!N&&O&&O.UTC){w=l.localToUtc(w)}w=c.adaptTime(w,x);p.push(new n(E,a.EQ,w))}else if(typeof I.low==="string"){if(N&&x){D=o.parseDateTimeOffsetInterval(I.low);D[0]=x.ui5Type.parseValue(D[0],"string");if(D.length===1){D[1]=I.low}if(D.length===2){D[1]=x.ui5Type.parseValue(D[1],"string");D[1].setMilliseconds(999)}}else{D=o.parseFilterNumericIntervalData(I.low)}if(D&&D.length===2){D[0]=c.adaptTime(D[0],x);D[1]=c.adaptTime(D[1],x);var P=new n(E,a.BT,D[0],D[1]);if(N){P=o.adaptMilliseconds(P,x.precision,a.BT)}p.push(P)}else if(D&&D.length===1){I[0]=c.adaptTime(I[0],x);p.push(new n(E,a.EQ,D[0]))}else{p.push(new n(E,U?a.Contains:a.EQ,I.low))}}}}else if(I&&I.hasOwnProperty("items")){d=[];m=[];T=null;if(I&&I.hasOwnProperty("ranges")){D=I.ranges;_=D.length;while(_--){B=D[_];w=B.value1;h=B.value2;if(y){if(w instanceof Date){w=o.getEdmTimeFromDate(w)}if(h instanceof Date){h=o.getEdmTimeFromDate(h)}}else if(x&&x.isCalendarDate){if(w instanceof Date){w=x.ui5Type.parseValue(w)}if(h instanceof Date){h=x.ui5Type.parseValue(h)}}else if(!N&&O&&O.UTC){if(w instanceof Date){w=l.localToUtc(w)}if(h instanceof Date){h=l.localToUtc(h);h.setMilliseconds(999)}}else if(N&&A){if(w){w=l.toTimezone(w,A);if(c.UI_TIMEZONE!==c.INTL_TIMEZONE){w=t.getInstance(w)}w=l.localToUtc(w);if(!B.exclude&&(B.operation===a.LT||B.operation===a.LE)||B.exclude&&(B.operation===a.GT||B.operation===a.GE)){w.setMilliseconds(999)}}if(h){h=l.toTimezone(h,A);if(c.UI_TIMEZONE!==c.INTL_TIMEZONE){h=t.getInstance(h)}h=l.localToUtc(h);h.setMilliseconds(999)}}else if(N&&!A){if(w){if(O&&O.UTC){w=l.uiTimezoneToUtc(w);w=l.localToUtc(w)}else{w=l.toTimezone(w,c.INTL_TIMEZONE)}if(!B.exclude&&(B.operation===a.LT||B.operation===a.LE)||B.exclude&&(B.operation===a.GT||B.operation===a.GE)){w.setMilliseconds(999)}}if(h){if(O&&O.UTC){h=l.uiTimezoneToUtc(h);h=l.localToUtc(h)}else{h=l.toTimezone(h,c.INTL_TIMEZONE)}h.setMilliseconds(999)}}w=c.adaptTime(w,x);h=c.adaptTime(h,x);R=B.exclude?m:d;if(B.operation===u.Empty||I?.conditionTypeInfo?.data?.operation==="NODATE"){if(x&&["Edm.DateTime","Edm.DateTimeOffset"].indexOf(x.type)>-1){R.push(new n(E,B.exclude?a.NE:a.EQ,null))}else{R.push(c._getStringEmptyFilter(E,x,B.exclude))}}else if(N){z=B.operation;if(x.filterRestriction==="auto"&&B.operation===a.EQ){h=new Date(w);h.setMilliseconds(999);h=c.adaptTime(h,x);z=a.BT}z=B.exclude?s.getTransformedExcludeOperation(z):z;var P=new n(E,z,w,h);if(x){P=o.adaptMilliseconds(P,x.precision,z)}d.push(P)}else{if(B.operation!==a.BT&&B.operation!==a.NB){h=undefined}z=B.exclude?s.getTransformedExcludeOperation(B.operation):B.operation;R.push(new n(E,z,w,h))}}if(m.length){T=new n(m,true)}}D=I.items;_=D.length;const e=[];while(_--){const i=D[_].key;if(!e.includes(i)){d.push(new n(E,a.EQ,i));e.push(i)}}if(I.value||I.value===0||I.value===false){if(typeof I.value==="string"){I.value=I.value.trim()}d.push(new n(E,U?a.Contains:a.EQ,I.value))}else if(I.value===""&&Q&&b){d.push(new n(E,U?a.Contains:a.EQ,I.value))}if(d.length){if(T){p.push(new n([new n(d,false),T],true))}else{p.push(new n(d,false))}}else if(T){p.push(T)}}else if(x&&x.control&&x.control.isA("sap.m.ComboBox")&&this.isValueSignificant(x)){if(I===null&&x.control.getSelectedKey()===""){I=""}if(x.control.getSelectedItem()){I=c.adaptTime(I,x);p.push(new n(E,U?a.Contains:a.EQ,I))}}else if(I||I===0||I===false){if(typeof I==="string"){I=I.trim()}if(I&&I instanceof Date){if(y){I=o.getEdmTimeFromDate(I)}else if(!N&&O&&O.UTC){I=l.localToUtc(I)}}if(x?.type==="Edm.Boolean"){if(I==="false"){I=false}else if(I==="true"){I=true}}if(I||I===0||I===false){I=c.adaptTime(I,x);p.push(new n(E,U?a.Contains:a.EQ,I))}}else if(I===""&&Q&&b){p.push(new n(E,U?a.Contains:a.EQ,I))}}}}}if(f==="mdcFilterPanel"){return p}return p.length>1?[new n(p,true)]:p};c.isValueSignificant=function(e){var i=e["com.sap.vocabularies.Common.v1.ValueList"]&&e["com.sap.vocabularies.Common.v1.ValueList"].Parameters,t;if(i){t=i.find(function(e){return e.hasOwnProperty("InitialValueIsSignificant")})}if(t&&t["InitialValueIsSignificant"]){return t["InitialValueIsSignificant"].Bool.toLocaleLowerCase()==="true"}return false};return c});
//# sourceMappingURL=FilterProviderUtils.js.map