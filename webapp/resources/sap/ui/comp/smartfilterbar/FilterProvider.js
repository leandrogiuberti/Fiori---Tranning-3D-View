/*!
 * SAPUI5
 * (c) Copyright 2025 SAP SE. All rights reserved.
 */
sap.ui.define(["sap/ui/core/Lib","sap/ui/core/date/UI5Date","sap/ui/comp/util/DateTimeUtil","sap/m/DateTimePicker","sap/m/Select","sap/ui/core/Item","sap/ui/comp/odata/ComboBox","sap/m/DatePicker","sap/m/DateRangeSelection","sap/m/TimePicker","sap/m/Input","sap/ui/comp/smartfilterbar/SFBMultiComboBox","sap/ui/comp/smartfilterbar/SFBMultiInput","sap/ui/comp/smartfilterbar/SortingUtil","sap/ui/comp/smartfilterbar/SFBSearchField","sap/m/Token","sap/ui/comp/odata/MetadataAnalyser","sap/ui/comp/odata/FiscalMetadata","sap/ui/comp/providers/ValueHelpProvider","sap/ui/comp/providers/ValueListProvider","sap/ui/model/json/JSONModel","sap/ui/comp/odata/ODataType","sap/ui/comp/util/FormatUtil","sap/ui/base/EventProvider","sap/ui/comp/util/IdentifierUtil","sap/ui/comp/providers/TokenParser","sap/ui/core/format/DateFormat","sap/ui/comp/library","sap/ui/core/library","sap/ui/model/analytics/odata4analytics","sap/ui/model/FilterOperator","sap/base/Log","sap/base/security/encodeURL","sap/base/util/merge","sap/ui/comp/smartfilterbar/FilterProviderUtils","sap/ui/comp/filterbar/VariantConverterFrom","sap/ui/comp/odata/CalendarMetadata"],function(e,t,i,a,n,r,o,s,l,d,u,f,h,p,c,m,_,g,y,F,D,T,v,C,S,V,A,M,P,I,E,N,B,b,x,w,R){"use strict";var O=M.smartfilterbar.ControlType;var L=M.smartfilterbar.DisplayBehaviour;var k=M.smartfilterbar.FilterType;var H=P.ValueState;var U=M.smartfilterbar.MandatoryType;var W=function(e){this._bInitialized=false;this._bPending=true;this._bConsiderAnalyticalParameters=false;this._bAttachInitializedDone=false;this.aFilterAnnotations=[];var t;if(e){this._sSmartContainerId=e.smartContainerId;this._sContext=e.context;this._oParentODataModel=e.model;this._sServiceURL=e.serviceUrl;this._sBasicSearchFieldName=e.basicSearchFieldName;this._isBasicSearchEnabled=e.enableBasicSearch;this._bUseContainsAsDefault=e.useContainsAsDefaultFilter==="true";this.sEntityType=e.entityType;this.sEntitySet=e.entitySet;this._isRunningInValueHelpDialog=e.isRunningInValueHelpDialog;this._oAdditionalConfiguration=e.additionalConfiguration;this.sDefaultDropDownDisplayBehaviour=e.defaultDropDownDisplayBehaviour;this.sDefaultTokenDisplayBehaviour=e.defaultTokenDisplayBehaviour;this.mDefaultFilterBarExpanded=e.defaultFilterBarExpanded;this.mDefaultShowAllFilters=e.defaultShowAllFilters;this.bShowSelectAll=e.showSelectAll==="true";this.sDefaultSingleFieldDisplayBehaviour=e.defaultSingleFieldDisplayBehaviour;if(typeof e.dateFormatSettings==="string"){try{this._oDateFormatSettings=e.dateFormatSettings?JSON.parse(e.dateFormatSettings):undefined}catch(e){}}else{this._oDateFormatSettings=e.dateFormatSettings}if(!this._oDateFormatSettings){this._oDateFormatSettings={}}if(!this._oDateFormatSettings.hasOwnProperty("UTC")){this._oDateFormatSettings["UTC"]=true}if(typeof e.calendarWeekSettings==="string"){this._oCalendarWeekSettings=e.calendarWeekSettings?e.calendarWeekSettings:undefined}if(!this._oCalendarWeekSettings){this._oCalendarWeekSettings=undefined}t=e.showCurrentDateButton;if(typeof t==="string"){this._oShowCurrentDateButton=t&&t==="true"?t&&true:undefined}if(typeof t==="boolean"){this._oShowCurrentDateButton=t}if(!this._oShowCurrentDateButton){this._oShowCurrentDateButton=undefined}this._oSmartTable=e.smartTable;this._oSmartFilter=e.smartFilter;this.filterBarClass=e.filterBarClass;this._bConsiderAnalyticalParameters=e.considerAnalyticalParameters;this._bUseDateRangeType=e.useDateRangeType;this._bConsiderSelectionVariants=e.considerSelectionVariants;this._aConsiderNavigations=e.considerNavigations;this._bSuppressValueListsAssociation=e.suppressValueListsAssociation;this._aConstParams=this._getConstParams();this._aSignificantParams=this._getSignificantParams()}this.sFilterModelName=x.FILTER_MODEL_NAME;this._sBasicFilterAreaID=x.BASIC_FILTER_AREA_ID;this._aAnalyticalParameters=[];this._aFilterBarViewMetadata=[];this._oFilterBarViewMetadataExtend={};this._aFilterBarFieldNames=[];this._aFilterBarMultiValueFieldMetadata=[];this._aFilterBarSingleValueWithValueListFieldMetadata=[];this._aFilterBarDropdownFieldMetadata=[];this._aFilterBarStringDateFieldNames=[];this._aFilterBarDateFieldNames=[];this._aFilterBarTimeFieldNames=[];this._aFilterBarTimeIntervalFieldNames=[];this._aFilterBarDateTimeMultiValueFieldNames=[];this._aFilterBarStringFieldNames=[];this._aFilterBarDateTimeFieldNames=[];this._aFilterBarDateTimeOffsetWithTimezoneFieldNames=[];this._aFilterBarNumericFieldMetadata=[];this._sSingleInputsTextArrangementData={};this._sInputsWithCompositeKeysData={};this._oNotValidatedSingleFields={};this._oSingleFieldSetFromFilterData={};this._aFieldGroupAnnotation=[];this._oMetadataAnalyser=new _(this._oParentODataModel||this._sServiceURL);this.oModel=new D;this._aValueListProvider=[];this._aValueHelpDialogProvider=[];this._mTokenHandler={};this._mConditionTypeFields={};this._aSelectionVariants=[];this._oParameterization=null;this._oNonAnaParameterization=null;this._aPromises=[]};W._reduceRangesForParameters=function(e){if(e.ranges&&e.ranges.length>1){var t=e.ranges.find(function(e){return e.semantic!==undefined});if(t){e.ranges=[t]}if(e.ranges.length>1){e.ranges=[e.ranges[0]]}}};W.prototype._getConstParams=function(){return this._oSmartFilter&&this._oSmartFilter.data&&this._oSmartFilter.data("hiddenFields")||null};W.prototype._getSignificantParams=function(){return this._oSmartFilter&&this._oSmartFilter.data&&this._oSmartFilter.data("significantFields")||null};W._createFilterProvider=function(e){var t=new W(e);return t._intialiseMetadata()};W.prototype._addLineItemNavigationFields=function(e,t){var i=this._oSmartTable._oTableProvider,a,n,r,o;if(i._aODataFieldMetadata&&i._oLineItemAnnotation){a=i._oLineItemAnnotation.fields;if(a){n=a.length}while(n--){r=a[n];if(r&&r.indexOf("/")>=0){o=i._oMetadataAnalyser.extractNavigationPropertyField(r,i.sEntitySet);if(o){if(o.description){o.description=o.parentPropertyName+"/"+o.description}if(o.unit){o.unit=o.parentPropertyName+"/"+o.unit}this._aFilterBarViewMetadata[0].fields.push(o);t[0].fields.push(o)}}}}};W.prototype._intialiseMetadata=function(){var e,t,i,a,n,r,o,s,l,d,u,f,h;this._aPromises=[];this._aFilterBarViewMetadata.push({groupName:this._sBasicFilterAreaID,index:0,fields:[]});if(!this.sEntitySet&&this.sEntityType){(function(){this.sEntitySet=this._oMetadataAnalyser.getEntitySetNameFromEntityTypeName(this.sEntityType)}).bind(this)()}this.sEntityType=this._oMetadataAnalyser.getEntityTypeNameFromEntitySetName(this.sEntitySet);r=this._oMetadataAnalyser.getAllFilterableFieldsByEntitySetName(this.sEntitySet,this._bConsiderAnalyticalParameters,this._aConsiderNavigations);this.aAllFields=this._oMetadataAnalyser.getFieldsByEntitySetName(this.sEntitySet);if(this._sContext==="mdcFilterPanel"&&this._oSmartTable&&!this._oSmartTable._isAnalyticalTable){var p=this._oMetadataAnalyser.getEntityTypeNameFromEntitySetName(this.sEntitySet);this._addLineItemNavigationFields(p,r)}if(r){this._updateDisplayBehaviour();this._aFieldGroupAnnotation=this._oMetadataAnalyser.getFieldGroupsByFilterFacetsAnnotation(this.sEntityType);a=this._oMetadataAnalyser.getSelectionFieldsAnnotation(this.sEntityType);if(a&&a.selectionFields){this._aSelectionFields=a.selectionFields}if(this._aFieldGroupAnnotation){e=this._aFieldGroupAnnotation.length;for(o=0;o<e;o++){n=this._aFieldGroupAnnotation[o];u=this._createGroupMetadata(n);u.index=this._aFilterBarViewMetadata.length;this._aFilterBarViewMetadata.push(u)}}e=r.length;for(o=0;o<e;o++){n=r[o];t=n.fields.length;u=this._createGroupMetadata(n);this._aFilterBarViewMetadata.push(u);for(s=0;s<t;s++){l=n.fields[s];if(l.type.indexOf("Edm.")===0){d=this._createFieldMetadata(l);u.fields.push(d);this._aFilterBarFieldNames.push(d.fieldName)}}i=n.hiddenFields&&n.hiddenFields.length;if(this._isRunningInValueHelpDialog&&i){for(s=0;s<i;s++){l=n.hiddenFields[s];if(l.type.indexOf("Edm.")===0){d=this._createFieldMetadata(l);u.hiddenFields.push(d)}}}}}h=this._getAdditionalConfigurationForCustomGroups(r);e=h.length;for(s=0;s<e;s++){u=this._createGroupMetadataForCustomGroup(h[s]);if(u){this._aFilterBarViewMetadata.push(u)}}f=this._getAdditionalConfigurationForCustomFilterFields();t=f.length;for(s=0;s<t;s++){d=this._createFieldMetadataForCustomFilterFields(f[s]);if(d){this._aFilterBarViewMetadata[0].fields.push(d)}}if(this._hasBasicSearch()){d=this._createBasicSearchFieldMetadata();this._aFilterBarViewMetadata[0].fields.push(d)}if(this._bConsiderAnalyticalParameters||!this._isRunningInValueHelpDialog){this._createParameters()}return new Promise(function(e){Promise.all(this._aPromises).then(function(){if(this._bConsiderSelectionVariants){this._createSelectionVariants()}this._applyGroupId();this._applyIndexes();this._createInitialModel(true);this._initializeConditionTypeFields();this.setPending(this.isPending());this._bInitialized=true;e(this)}.bind(this))}.bind(this))};W.prototype._createSelectionVariants=function(){this._aSelectionVariants=this._oMetadataAnalyser.getSelectionVariantAnnotationList(this.sEntityType)};W.prototype._createParameters=function(){if(this._oMetadataAnalyser.isSemanticAggregation(this.sEntityType)){if(this._bConsiderAnalyticalParameters){var e=sap.ui.require("sap/ui/model/analytics/odata4analytics");if(e){this._createAnalyticalParameters(e)}else{var t=new Promise(function(e){sap.ui.require(["sap/ui/model/analytics/odata4analytics"],function(t){this._createAnalyticalParameters(t);e()}.bind(this))}.bind(this));this._aPromises.push(t)}}}else{this._createNonAnalyticalParameters()}};W.prototype._createAnalyticalParameters=function(e){this._oParameterization=this._getAnalyticParameterization(e);this._createAnalyticParameters(this._oParameterization)};W.prototype._getAnalyticParameterization=function(e){var t,i;try{t=new e.Model(new e.Model.ReferenceByModel(this._oParentODataModel))}catch(e){throw"Failed to instantiate analytical extensions for given OData model: "+e.message}i=t&&t.findQueryResultByName(this.sEntitySet);return i&&i.getParameterization()};W.prototype._createNonAnalyticalParameters=function(){if(this.sEntitySet){this._oNonAnaParameterization=this._oMetadataAnalyser.getParametersByEntitySetName(this.sEntitySet);if(this._oNonAnaParameterization){this._createParametersByEntitySetName(this._oNonAnaParameterization.entitySetName,this._oNonAnaParameterization.parameters)}}};W.prototype.attachPendingChange=function(e){this._attachEvent("PendingChange",e)};W.prototype.detachPendingChange=function(e){this._detachEvent("PendingChange",e)};W.prototype.setPending=function(e){var t=this._bPending!==e;this._bPending=e;if(t){var i={};i.pending=e;this._fireEvent("PendingChange",i)}};W.prototype.isPending=function(){if(!this._bInitialized){return true}for(var e in this._mConditionTypeFields){if(this._mConditionTypeFields[e].conditionType.isPending()){return true}}return false};W.prototype._updateDisplayBehaviour=function(){this._sTextArrangementDisplayBehaviour=this._oMetadataAnalyser.getTextArrangementValue(this.sEntityType);if(!this.sDefaultDropDownDisplayBehaviour){if(this._sTextArrangementDisplayBehaviour){this.sDefaultDropDownDisplayBehaviour=this._sTextArrangementDisplayBehaviour}else{this.sDefaultDropDownDisplayBehaviour=L.descriptionAndId}}if(!this.sDefaultTokenDisplayBehaviour){if(this._sTextArrangementDisplayBehaviour){this.sDefaultTokenDisplayBehaviour=this._sTextArrangementDisplayBehaviour}else{this.sDefaultTokenDisplayBehaviour=L.descriptionAndId}}if(!this.sDefaultSingleFieldDisplayBehaviour){if(this._sTextArrangementDisplayBehaviour){this.sDefaultSingleFieldDisplayBehaviour=this._sTextArrangementDisplayBehaviour}else{this.sDefaultSingleFieldDisplayBehaviour=L.descriptionAndId}}};W.prototype._hasBasicSearch=function(){return this._isBasicSearchEnabled};W.prototype._getAdditionalConfigurationForCustomFilterFields=function(){var e,t,i,a;if(!this._oAdditionalConfiguration){return[]}e=this._oAdditionalConfiguration.getControlConfiguration();if(!this._aFilterBarFieldNames||!this._aFilterBarFieldNames.length){return e}a=[];t=e.length;for(i=0;i<t;i++){if(this._aFilterBarFieldNames.indexOf(e[i].key)<0){a.push(e[i])}}return a};W.prototype._getAdditionalConfigurationForCustomGroups=function(e){var t,i,a,n,r,o,s,l;if(!this._oAdditionalConfiguration){return[]}t=this._oAdditionalConfiguration.getGroupConfiguration();if(!e||!e.length){return t}r=[];a=e.length;i=t.length;for(n=0;n<i;n++){s=false;for(o=0;o<a;o++){l=e[o].groupName||e[o].groupEntitySetName;if(l===t[n].key){s=true;break}}if(!s){r.push(t[n])}}return r};W.prototype._createInitialModelForField=function(e,i,a){var n=false,r,o,s=false,l=false,d=null,u=null,f,h=null,p=[],c=[];if(!i||i.isCustomFilterField){return}if(i.filterRestriction!==k.multiple){l=true}if((i.filterType==="date"||i.filterType==="time"||i.filterType==="datetime")&&!i.isFiscalDate&&!i.isCalendarType){n=true}if(a){r=i.defaultFilterValues;s=r&&r.length;if(!s){if(i.defaultPropertyValue&&i.isParameter){o=i.defaultPropertyValue;if(i.filterType==="numeric"){o=this._getType(i).parseValue(o,"string")}r=[{low:o}];s=true}else if(i.defaultFilterValue){o=i.defaultFilterValue;r=[{low:o,high:o,operator:"EQ",sign:"I"}];s=true}}}var m=this._oAdditionalConfiguration?this._oAdditionalConfiguration.getControlConfigurationByKey(i.fieldName):null;if(i.hasFixedValues||m&&m.controlType===O.dropDownList){this._aFilterBarDropdownFieldMetadata.push(i)}if(i.filterRestriction===k.single&&!this._isSingleDynamicDateEnabled(i)){if(s){o=r[0];d=n?this._createDateTimeValue(i,o.low):o.low}if(i.type==="Edm.String"&&i.hasValueListAnnotation&&!i.hasFixedValues&&i.controlType!=="dropDownList"){this._aFilterBarSingleValueWithValueListFieldMetadata.push(i);if(!s&&i.control){i.control.setValue("")}}e[i.fieldName]=d}else if(i.filterRestriction===k.interval&&i.type!=="Edm.Time"){if(s){o=r[0];d=n?this._createDateTimeValue(i,o.low):o.low;u=n?this._createDateTimeValue(i,o.high):o.high}e[i.fieldName]={low:d,high:u}}else{if(s){f=r.length;while(f--){o=r[f];if(l){h={exclude:o.sign==="E",operation:o.operator==="CP"?"Contains":o.operator,keyField:i.fieldName,value1:n?this._createDateTimeValue(i,o.low):o.low,value2:n?null:o.high};if(i.filterType==="time"&&o.high){h.value2=t.getInstance(o.high)}}else{h={key:n?this._createDateTimeValue(i,o.low):o.low,text:n?"":o.low}}p.push(h)}}this._aFilterBarMultiValueFieldMetadata.push(i);e[i.fieldName]={value:null};if(l){c=p.slice(0);p=[];e[i.fieldName].ranges=c}e[i.fieldName].items=p;this._updateMultiValueControl(i.control,p,c)}};W.prototype._createDateTimeValue=function(e,i){switch(e.type){case"Edm.Time":if(i.indexOf("PT")===0){return this._getTime(i)}else{N.error("Default value for "+e.fieldName+" could not be parsed.")}break;case"Edm.DateTime":if(typeof i=="string"&&e.displayFormat&&e.displayFormat.toLowerCase()=="date"){var a=i.split("T");i=a[0]+"T00:00:00";return t.getInstance(i)}else{N.error("Default value for "+e.fieldName+" could not be parsed.")}break;case"Edm.DateTimeOffset":return t.getInstance(i);default:N.error("Default value for "+e.fieldName+" could not be parsed.")}};W.prototype._createInitialModel=function(e){var t,i,a,n,r,o,s,l;t={};this._bCreatingInitialModel=true;this._aFilterBarMultiValueFieldMetadata=[];this._aFilterBarSingleValueWithValueListFieldMetadata=[];this._aFilterBarDropdownFieldMetadata=[];if(this._aFilterBarViewMetadata){i=this._aFilterBarViewMetadata.length;for(s=0;s<i;s++){r=this._aFilterBarViewMetadata[s];a=r.fields.length;for(o=0;o<a;o++){this._createInitialModelForField(t,r.fields[o],e)}n=r.hiddenFields&&r.hiddenFields.length;if(this._isRunningInValueHelpDialog&&n){for(o=0;o<n;o++){this._createInitialModelForField(t,r.hiddenFields[o],e)}}}}if(this._aCustomFieldMetadata){for(l=0;l<this._aCustomFieldMetadata.length;l++){this._createInitialModelForField(t,this._aCustomFieldMetadata[l],false)}}if(this._aAnalyticalParameters){a=this._aAnalyticalParameters.length;for(o=0;o<a;o++){this._createInitialModelForField(t,this._aAnalyticalParameters[o],e)}}this.oModel&&this.oModel.setData(t);if(!e){this._clearConditionTypeFields()}this._updateConditionTypeFields();this._bCreatingInitialModel=false};W.prototype._setTokenTooltip=function(e,t){if(!e||!t){return}if(typeof t!=="string"){try{t=t.toString()}catch(e){}}e.setTooltip(t)};W.prototype._updateMultiValueControl=function(e,t,a,n,r){var o=0,s=null,l=null,d=null,u=null,p=null,c,_,g,y;if(e&&t){o=t.length;if(e instanceof h){s=[];while(o--){const i=new m,a=Object.keys(this._getInputsWithCompositeKeysData()),r=t[o],l=r.text||r.key,d=n?.name;if(a?.includes(d)){const e=this._getInputsWithCompositeKeysData(d);e.forEach(e=>{if(e.key===r.key&&r.text?.includes(e.text)){i.data("compositeKey",e.compositeKey)}})}i.setKey(t[o].key);i.setText(l);this._setTokenTooltip(i,l);if(e.getMetadata()&&e.getMetadata()?.getName()==="sap.ui.comp.smartfilterbar.SFBMultiInput"){i.getTextForCopy=e._getTextForCopy.bind(e,i)}s.push(i)}if(a){o=a.length;while(o--){d=a[o];if((d.value1===""||d.value1===null)&&d.operation===E.EQ){y=w.convertOption(d.operation,d.value1);d.operation=y.op;d.tokenText=v.getFormattedRangeText(d.operation,null,null,d.exclude);d.value1=y.v}if(d.tokenText){u=d.tokenText}else{c=d.value1;_=d.value2;if(n){var F=true;var D=["date","datetime","time"];if(D.indexOf(n.filterType)>-1){g=this._getType(n);if(g){if(c){if(n.filterType==="time"){c=i.dateToEdmTime(i.localToUtc(c))}c=g.formatValue(c,"string",F)}if(_){if(n.filterType==="time"){_=i.dateToEdmTime(i.localToUtc(_))}_=g.formatValue(_,"string",F)}}}else if(n.filterType==="numeric"){g=this._getType(n);if(g){if(c!==""&&c!==undefined){if(typeof c==="string"&&!isNaN(c)){c=parseFloat(c);d.value1=c}c=g.formatValue(c,"string")}if(_!==""&&_!==undefined){if(typeof _==="string"&&!isNaN(_)){_=parseFloat(_);d.value2=_}_=g.formatValue(_,"string")}}}else if(n.filterType==="boolean"){g=this._getType(n);if(g){if(c!==""&&c!==undefined&&c==="false"){c=g.formatValue(false,"string")}else{c=g.formatValue(c,"string")}if(_!==""&&_!==undefined&&_==="false"){_=g.formatValue(false,"string")}else{_=g.formatValue(c,"string")}}}else{var T=n.isCalendarDate||n.isFiscalDate||n.isCalendarType||(c instanceof Date||_ instanceof Date);if(T){g=this._getType(n);if(c){c=g.formatValue(c,"string")}if(_){_=g.formatValue(_,"string")}}}}u=v.getFormattedRangeText(d.operation,c,_,d.exclude)}l=new m;l.setText(u);this._setTokenTooltip(l,u);l.data("range",d);s.push(l)}}e.setTokens(s);e.fireTokenUpdate()}else if(e instanceof f){p=[];if(t.length>0){while(o--){p.push(t[o].key)}}else if(r){p.push(r)}e.setSelectedKeys(p)}}};W.prototype._updateSingleValueControl=function(e){var t=e.control,i=e.fieldName,a=e.displayBehaviour||this.sDefaultSingleFieldDisplayBehaviour,n=this.oModel.getData(),r=n[i],o=r,s=this._getSingleInputsTextArrangementData(i);if(s&&s.key===r&&s.key!==s.text){o=v.getFormattedExpressionFromDisplayBehaviour(a,s.key,s.text);delete this._oNotValidatedSingleFields[i]}var l=this._aValueListProvider.find(function(e){return e.sFieldName===i});t.setValue(o);if(r&&r===o){this._oSingleFieldSetFromFilterData[i]=true;if(l&&l.bInitialised){l._fetchSingleFieldDescription(r);delete this._oNotValidatedSingleFields[i]}else{this._oNotValidatedSingleFields[i]=r}}if(s&&l&&r!==o){l&&l._abortPendingValidations()}};W.prototype._applyIndexes=function(){if(!this._aFilterBarViewMetadata){return}this._aFilterBarViewMetadata=p.groupSorting(this._aFilterBarViewMetadata)};W.prototype._applyGroupId=function(){var e=Array.isArray(this._aFilterBarViewMetadata)?this._aFilterBarViewMetadata.length:0,t,i,a,n,r,o;for(n=0;n<e;n++){if(!this._aFilterBarViewMetadata[n].fields){continue}t=this._aFilterBarViewMetadata[n].fields.length;for(r=0;r<t;r++){a=this._aFilterBarViewMetadata[n].fields[r];if(a&&a.groupId&&a.groupId!==this._aFilterBarViewMetadata[n].groupName){i=undefined;for(o=0;o<e;o++){if(this._aFilterBarViewMetadata[o].groupName===a.groupId){i=this._aFilterBarViewMetadata[o];break}}if(i){this._aFilterBarViewMetadata[n].fields.splice(r,1);r--;t--;i.fields=i.fields||[];i.fields.push(a)}}}}};W.prototype._createFilterControlId=function(e){var t=this._oSmartFilter?this._oSmartFilter.getId():"FilterPanel";var i=S.replace(e.groupId||"");var a=S.replace(e.fieldName);var n=e.customColumnKey&&S.replace(e.customColumnKey);if(n){a+=n}if(this._sSmartContainerId){a=this._sSmartContainerId+"-"+a}return t+"-filterItemControl"+i+"-"+a};W.prototype._createGroupMetadata=function(e){var t,i=null,a;a=e.groupName||e.groupEntitySetName;if(this._oAdditionalConfiguration){i=this._oAdditionalConfiguration.getGroupConfigurationByKey(a)}t={};t.groupName=a;t.groupLabel=this._getGroupLabel(e,i);t.fields=[];t.hiddenFields=[];t.index=this._getGroupIndex(i);return t};W.prototype._createGroupMetadataForCustomGroup=function(e){var t;t={};t.groupName=e.key;t.groupLabel=e.label;t.fields=[];t.index=this._getGroupIndex(e);return t};W.prototype._getTime=function(e){var t=A.getTimeInstance({pattern:"'PT'hh'H'mm'M'ss'S'"});return t.parse(e)};W.prototype._checkMetadataDefaultValue=function(e){var t=e.defaultFilterValue||e.defaultPropertyValue;if(t){try{if(e.type==="Edm.Time"&&t.indexOf("PT")===0){this._getTime(t)}else{this._getType(e)}}catch(t){e.defaultPropertyValue=null;e.defaultFilterValue=null;N.error("default value for "+e.fieldName+" could not be parsed.")}}};W.prototype._getType=function(e){var t,i={},a={},n={};if(e.ui5Type){return e.ui5Type}if(e.precision||e.scale){a.precision=e.precision;a.scale=e.scale}if(e.maxLength){a.maxLength=e.maxLength}if(e.displayFormat){a.displayFormat=e.displayFormat}if(e.isDigitSequence&&!e.isFiscalDate&&!e.fiscalType){a.isDigitSequence=e.isDigitSequence}if(e.isCalendarDate){n.isCalendarDate=true}if(e.isCalendarType&&!e.isCalendarDate){n.isCalendarType=true;n.calendarType=e.calendarType}if(e.isFiscalDate&&e.fiscalType){n.isFiscalDate=true;n.fiscalType=e.fiscalType}if(e.filterType==="date"||e.filterType==="time"||e.filterType==="datetime"||e.isCalendarDate){i=Object.assign({},this._oDateFormatSettings,{UTC:false})}t=T.getType(e.type,i,a,n);return t};W.prototype._setControlDisplayFormat=function(e,t){var i;if(!t){return}i=t.style||t.pattern;if(!i){return}e.setDisplayFormat(i)};W.prototype._setControlCalendarWeekSetting=function(e,t){if(!t){return}if(typeof e.setCalendarWeekNumbering==="function"){e.setCalendarWeekNumbering(t)}};W.prototype._setShowCurrentDateButton=function(e,t){if(!t){return}if(typeof e.setShowCurrentDateButton==="function"){e.setShowCurrentDateButton(t)}};W.prototype._createControl=function(t){var i,p,c=false,m,_,g=t.type!=="Edm.String"||t.isFiscalDate||t.isCalendarType||t.isDigitSequence;if(t.customControl){if(t["com.sap.vocabularies.Common.v1.DocumentationRef"]&&!t.customControl.data("sap-ui-DocumentationRef")){this._setControlDocumentationRef(t.customControl,t["com.sap.vocabularies.Common.v1.DocumentationRef"])}return t.customControl}p=this._getType(t);i=new t.fControlConstructor(this._createFilterControlId(t));i._oFieldViewMetadata=t;if(i._oFieldViewMetadata["com.sap.vocabularies.Common.v1.DocumentationRef"]){this._setControlDocumentationRef(i,i._oFieldViewMetadata["com.sap.vocabularies.Common.v1.DocumentationRef"])}if(t.fControlConstructor===l){this._setControlDisplayFormat(i,this._oDateFormatSettings);this._setControlCalendarWeekSetting(i,this._oCalendarWeekSettings);this._setShowCurrentDateButton(i,this._oShowCurrentDateButton);if(t.isCalendarDate){i.bindProperty("dateValue",{path:this.sFilterModelName+">/"+t.fieldName+"/low",type:p});i.bindProperty("secondDateValue",{path:this.sFilterModelName+">/"+t.fieldName+"/high",type:p})}else{i.bindProperty("dateValue",this.sFilterModelName+">/"+t.fieldName+"/low");i.bindProperty("secondDateValue",this.sFilterModelName+">/"+t.fieldName+"/high")}}else if(t.fControlConstructor===o||t.fControlConstructor===n){if(i.setForceSelection){i.setForceSelection(true)}if(t.fControlConstructor===n){if(!this.oResourceBundle){this.oResourceBundle=e.getResourceBundleFor("sap.ui.comp")}i.addItem(new r({key:"",text:this.oResourceBundle.getText("NO_BOOLEAN_VALUE_SELECTED")}));i.addItem(new r({key:false,text:p.formatValue(false,"string")}));i.addItem(new r({key:true,text:p.formatValue(true,"string")}))}else{this._associateValueList(i,"items",t,false,this._getSuppressValueListsAssociation());i.attachSelectionChange(function(){if(this._bUpdatingFilterData||this._bCreatingInitialModel){return}i.fireChange({filterChangeReason:t.fieldName,value:""})}.bind(this));if(i.isA("sap.ui.comp.odata.ComboBox")){i.useHighlightItemsWithContains=function(){return true};i.attachSelectedKeyChange(function(){if(i.data("__validationError")){i.data("__validationError",null);i.setValueState(H.None)}})}}i.bindProperty("selectedKey",this.sFilterModelName+">/"+t.fieldName)}else if(t.fControlConstructor===f){this._associateValueList(i,"items",t,false,this._getSuppressValueListsAssociation());i.attachSelectionChange(function(e){if(this._bUpdatingFilterData||this._bCreatingInitialModel){return}var i=e.getSource(),a=null,n=[],r;a=i.getSelectedItems();if(a){r=a.length;while(r--){n.push({key:a[r].getKey(),text:a[r].getText()})}}if(this.oModel){this.oModel.setProperty("/"+t.fieldName+"/items",n)}if(!e.getParameter("stopChangePropagation")){i.fireChange({filterChangeReason:t.fieldName,value:""})}}.bind(this));i.bindProperty("value",this.sFilterModelName+">/"+t.fieldName+"/value")}else if(t.fControlConstructor===h){if(t.controlType===O.date||t.type==="Edm.Time"||t.type==="Edm.DateTimeOffset"){i.setValueHelpOnly&&i.setValueHelpOnly(true);if(t.filterRestriction===k.interval){this._associateValueHelpDialog(i,t,false,false)}else{this._associateValueHelpDialog(i,t,true,true)}this._setControlCalendarWeekSetting(i,this._oCalendarWeekSettings);this._setShowCurrentDateButton(i,this._oShowCurrentDateButton)}else{if(t.hasValueHelpDialog){this._associateValueHelpDialog(i,t,t.filterRestriction!==k.multiple,true)}else{i.setShowValueHelp(false)}i.bindProperty("value",{path:this.sFilterModelName+">/"+t.fieldName+"/value",type:p})}this._handleMultiInput(i,t,p)}else if(t.fControlConstructor===u){if(t.filterRestriction===k.interval){c=true;i.bindProperty("value",this.sFilterModelName+">/"+t.fieldName+"/low");if(!this.oResourceBundle){this.oResourceBundle=e.getResourceBundleFor("sap.ui.comp")}if(!this.sIntervalPlaceholder){this.sIntervalPlaceholder=this.oResourceBundle.getText("INTERVAL_PLACEHOLDER_TEXT")}i.setPlaceholder(this.sIntervalPlaceholder)}else if(t.hasValueListAnnotation){i.attachChange(function(e){var a=e.getParameter("value");i.__sValidationText="";if(!a){this.oModel.setProperty("/"+t.fieldName,"")}}.bind(this))}else{i.bindProperty("value",{path:this.sFilterModelName+">/"+t.fieldName,type:p})}if(t.hasValueHelpDialog){i.setShowValueHelp(true);if(c&&g){i.setValueHelpOnly&&i.setValueHelpOnly(true)}this._associateValueHelpDialog(i,t,false,false)}}else if(t.isCalendarDate){this._setControlDisplayFormat(i,this._oDateFormatSettings);this._setControlCalendarWeekSetting(i,this._oCalendarWeekSettings);this._setShowCurrentDateButton(i,this._oShowCurrentDateButton);i.bindProperty("dateValue",{path:this.sFilterModelName+">/"+t.fieldName,type:p})}else if(t.fControlConstructor===s){i.bindProperty("dateValue",this.sFilterModelName+">/"+t.fieldName);this._setControlDisplayFormat(i,this._oDateFormatSettings);this._setControlCalendarWeekSetting(i,this._oCalendarWeekSettings);this._setShowCurrentDateButton(i,this._oShowCurrentDateButton)}else if(t.fControlConstructor===d||t.fControlConstructor===a){i.bindProperty("dateValue",this.sFilterModelName+">/"+t.fieldName);if(this._oDateFormatSettings&&this._oDateFormatSettings.style){i.setDisplayFormat(this._oDateFormatSettings.style)}this._setControlCalendarWeekSetting(i,this._oCalendarWeekSettings);this._setShowCurrentDateButton(i,this._oShowCurrentDateButton)}if(i instanceof s){i.attachChange(function(t){var a=t.getParameter("valid");i.data("__mandatoryEmpty",null);if(a){i.setValueState(H.None);i.setValueStateText()}else{var n=i._parseValue(t.getParameter("newValue")),r=this._getSelectedDateRange(n);i.setValueState(H.Error);if(r[0]&&r[1]){var o=e.getResourceBundleFor("sap.ui.comp"),s=this._getDateFieldOutOfRangeErrorText(i,r,p,o);i.setValueStateText(s)}else if(p){try{p.parseValue("foo","string")}catch(e){i.setValueStateText(e.message)}}}}.bind(this))}if(t.hasTypeAhead){if(t.hasValueListAnnotation){i.setShowSuggestion(true)}i.setFilterSuggests(false);this._associateValueList(i,"suggestionRows",t,true,this._getSuppressValueListsAssociation())}if(t.displayFormat==="UpperCase"&&t.controlType!==O.dropDownList&&i.attachChange&&i.getValue&&i.setValue){i.attachChange(function(e){var a=i.getValue();if(a&&!t.hasValueListAnnotation){i.setValue(a.toUpperCase())}});if(this._mTokenHandler[i.getId()]&&this._mTokenHandler[i.getId()].parser){var y=this._mTokenHandler[i.getId()].parser;y.getKeyFields()[0].displayFormat=t.displayFormat}}if(i instanceof u){if(t.maxLength){m=parseInt(t.maxLength);if(!isNaN(m)){if(this._mTokenHandler[i.getId()]&&this._mTokenHandler[i.getId()].parser){var y=this._mTokenHandler[i.getId()].parser;y.getKeyFields()[0].maxLength=m}else{if(!t.hasValueListAnnotation&&!c){i.setMaxLength(m)}}}}if(t.isCalendarType&&t.calendarType){i.setPlaceholder(p.formatter.getPattern())}if(t.isFiscalDate){i.setPlaceholder(p.formatter.getPattern())}var F=t.filterRestriction==="auto"||t.filterRestriction==="multi-value"||t.filterRestriction==="multiple";if(t.type==="Edm.String"&&F&&(this._oSmartFilter&&!this._oSmartFilter.getDisableSearchMatchesPatternWarning())){i.attachLiveChange(this._oSmartFilter._onLiveChangeValidateSymbols.bind(this._oSmartFilter))}}_=function(e){var t=e.getParameter("exception");var a=e.getParameter("element");if(i&&a&&i.getId()===a.getId()){if(t){if(i.setValueStateText){i.setValueStateText(t.message)}}if(i.setValueState){i.setValueState(H.Error)}i.data("__mandatoryEmpty",null)}};i.attachParseError(_);i.attachFormatError(_);i.attachValidationError(_);i.attachValidationSuccess(function(e){var t=e.getParameter("element");if(i&&t&&i.getId()===t.getId()){if(i.setValueState){i.setValueState(H.None)}if(i.setValueStateText){i.setValueStateText()}i.data("__mandatoryEmpty",null);delete i.__sValidationText}});if(t.fControlConstructor===o||t.fControlConstructor===f){i.setFilterFunction(function(e,t){RegExp.escape=function(e){return e.replace(/[-/\\^$*+?.()|[\]{}]/g,"\\$&")};var i=RegExp.escape(e);var a=new RegExp(i,"i");return t.getText().match(new RegExp(a,"i"))||t.getKey().match(new RegExp(a,"i"))})}return i};W.prototype._getControlConstructor=function(e,t){var i=u,r,p,c;c=t?t+e.fieldName:e.fieldName;if(e.isCustomFilterField){i=undefined}else{r=e.filterRestriction===k.single;p=e.filterRestriction===k.interval;if(e.controlType===O.date){if(r&&!this._isSingleDynamicDateEnabled(e)){i=s}else{i=p?l:h}if(e.isCalendarDate){this._aFilterBarStringDateFieldNames.push(c)}else{this._aFilterBarDateFieldNames.push(c)}if(e.filterRestriction===k.multiple){this._aFilterBarDateTimeMultiValueFieldNames.push(c)}}else if(e.controlType===O.dropDownList){if(r){i=this._isBooleanWithFixedValuedButWithoutValueListAnnotation(e)?n:o}else{i=f}if(!r){e.filterRestriction=k.multiple}}else if(e.type==="Edm.Time"){if(r){i=d}else{i=h}this._aFilterBarTimeFieldNames.push(c);if(p){this._aFilterBarTimeIntervalFieldNames.push(c)}else if(e.filterRestriction===k.multiple){this._aFilterBarDateTimeMultiValueFieldNames.push(c)}}else if(!p&&e.controlType===O.dateTimePicker){if(r){i=a}else{i=h}this._aFilterBarDateTimeFieldNames.push(c);if(e.filterRestriction===k.multiple){this._aFilterBarDateTimeMultiValueFieldNames.push(c)}}else if(p&&e.type==="Edm.DateTimeOffset"){var m=this._getFilterTimeZone(c);if(m){var g={key:c,value:m};this._aFilterBarDateTimeOffsetWithTimezoneFieldNames.push(g)}this._aFilterBarDateTimeFieldNames.push(c)}else if(r&&_.isNumber(e)){this._aFilterBarNumericFieldMetadata.push(c)}else if(!r&&!p){i=h}}return i};W.prototype._handleTokenUpdate=function(e,t){this._tokenUpdate({control:t.control,fieldViewMetadata:t.fieldViewMetadata,removedTokens:e&&e.getParameter("removedTokens")})};W.prototype._tokenUpdate=function(e){var t=e.removedTokens,a=e.control,n=e.fieldViewMetadata,r,o=[],s,l,d,u=[],f="/"+n.fieldName;if(this._bUpdatingFilterData||this._bCreatingInitialModel){return}r=a.getTokens();if(t){r=r.filter(function(e){return t.indexOf(e)===-1})}if(Array.isArray(r)&&r.length>0){s=r.length;while(s--){l=r[s];d=l.data("range");if(d){d.tokenText=l.getText();if(n.customColumnKey){d.customColumnKey=n.customColumnKey}if(d&&l.getKey().indexOf("range_")===0){if(n.type==="Edm.Time"){if(d.value1&&(d.value1.ms||d.value1.ms===0)){d.value1=i.utcToLocal(i.edmTimeToDate(d.value1))}if(d.value2&&(d.value2.ms||d.value2.ms===0)){d.value2=i.utcToLocal(i.edmTimeToDate(d.value2))}}}u.push(d)}else{o.push({key:l.getKey(),text:l.getText()})}}}if(this.oModel){this.oModel.setProperty(f+"/items",o);this.oModel.setProperty(f+"/ranges",u)}if(a.__bValidatingToken){delete a.__bValidatingToken}if(!a._pendingAutoTokenGeneration){a.fireChange({filterChangeReason:n.fieldName,value:""})}};W.prototype._handleMultiInput=function(t,i,a){t._setFilterProvider(this);t._setFieldViewMetadata(i);t.attachTokenUpdate({control:t,fieldViewMetadata:i},this._handleTokenUpdate,this);var n,r=i.type==="Edm.DateTime"&&i.displayFormat==="Date";if(i.hasValueListAnnotation||i.type==="Edm.String"||r){t.attachEvent("_validateOnPaste",function(o){var s=o.getParameter("textRows"),l=o.getParameter("texts"),d,u,f,h,p,c,m,_;f=s?s.length:0;u=l?l.length:0;if(f<=1&&u>1){o.preventDefault();return}if(f>1){o.preventDefault();d=this.oModel.getProperty("/"+i.fieldName);_=d.ranges||[];t.setValue("");while(f--){h=s[f][0];if(h){if(h.length>i.maxLength){if(!c){c=e.getResourceBundleFor("sap.ui.comp")}t.setValueState(H.Error);t.data("__validationError",true);if(p){t.setValueStateText(c.getText("FIELD_PASTE_MULTIPLE_ERRORS"));return}else{t.setValueStateText(c.getText("FIELD_PASTE_SINGLE_ERROR",[h,f+1,i.maxLength]));p=true}_=[]}m=null;if(i.isUpperCase){h=h.toUpperCase()}if(r){n=this._getDateValue(h,a);if(isNaN(n.getDate())){continue}else{m=h;h=n}}var g=V._createRangeByText(h);_.push(Object.assign({keyField:i.fieldName,tokenText:m,value1:h,value2:null},g))}}if(p){return}this.oModel.setProperty("/"+i.fieldName+"/ranges",_);this._updateMultiValueControl(t,d.items,_,i)}}.bind(this))}};W.prototype._associateValueHelpDialog=function(e,t,i,a){var n=t.visibleInAdvancedArea||t.groupId===x.BASIC_FILTER_AREA_ID;if(this._getSuppressValueListsAssociation()&&n){this._attachEventOnce(x.ASSOCIATE_VALUE_LISTS,function(){this._associateValueHelpDialogHandler(e,t,i,a)}.bind(this))}else{this._associateValueHelpDialogHandler(e,t,i,a)}};W.prototype._addToParams=function(e,t,i){if(t==="true"||t==="false"){e[i]=t==="true"}else if(typeof t==="object"&&t!==null&&Object.keys(t).length>0){e[i]=t[e.fieldName]==="true"}else if(t!==undefined&&t!==null){N.error("customData for "+i+" is not of type boolean or object")}};W.prototype._associateValueHelpDialogHandler=function(e,t,i,a){var n,r,o={fieldName:t.fieldName,control:e,model:this._oParentODataModel,filterModel:this.oModel,filterProvider:this,dateFormatSettings:this._oDateFormatSettings,calendarWeekSettings:this._oCalendarWeekSettings,showCurrentDateButton:this._oShowCurrentDateButton,fieldViewMetadata:t,displayFormat:t.displayFormat,displayBehaviour:t.displayBehaviour,loadAnnotation:t.hasValueListAnnotation,fullyQualifiedFieldName:t.fullName,metadataAnalyser:this._oMetadataAnalyser,preventInitialDataFetchInValueHelpDialog:t.preventInitialDataFetchInValueHelpDialog,supportMultiSelect:a,supportRanges:i,isSingleIntervalRange:t.filterRestriction===k.interval,isSearchExpressionFilterRestriction:t.filterRestriction===k.searchExpression,isUnrestrictedFilter:t.filterRestriction!==k.multiple,type:t.filterType,maxLength:t.maxLength,scale:t.scale,precision:t.precision,context:this._oSmartFilter?"SmartFilterBar":"mdcFilterPanel",filterBarClass:this.filterBarClass,defaultOperation:t.conditionPanelDefaultOperation,enabledMultiSelectionPlugin:!this.bShowSelectAll,_onBeforeOpenValueHelpDialog:function(e){if(this._oSmartFilter){this._oSmartFilter.fireEvent("_beforeOpenVHD",e)}}.bind(this)};if(o.isSearchExpressionFilterRestriction){r={defaultOperation:_._getSearchExpressionTypeOperations().string[0],typeOperations:_._getSearchExpressionTypeOperations(),rangeOperationsKeys:_._getSearchExpressionRangeOperationsKeys()}}if(t.isCalendarDate){o.oType=this._getType(t)}if(this.mDefaultFilterBarExpanded){this._addToParams(o,this.mDefaultFilterBarExpanded,"defaultFilterBarExpanded")}if(this.mDefaultShowAllFilters){this._addToParams(o,this.mDefaultShowAllFilters,"defaultShowAllFilters")}var s=new y(o);s.attachValueListChanged(function(e){if(this._oSmartFilter){this._oSmartFilter.fireFilterChange(e);this._oSmartFilter.validateMandatoryFields()}}.bind(this));if(t.visibleInAdvancedArea||t.groupId===x.BASIC_FILTER_AREA_ID){this.aFilterAnnotations.push(s.loadAnnotation().then(function(e){this._enrichFieldViewMetadata(t,e)}.bind(this)))}this._aValueHelpDialogProvider.push(s);if(i&&e.addValidator){n=new V(r);n.addKeyField({key:t.fieldName,label:t.label,type:t.filterType,oType:t.ui5Type});if(t.filterType==="numeric"){n.setDefaultOperation("EQ")}n.associateInput(e);this._mTokenHandler[e.getId()]={parser:n}}};W.prototype._determineFieldLabel=function(e){var t,i=e.label;if(this._oSmartFilter&&this._oSmartFilter.determineFilterItemByName){t=this._oSmartFilter.determineFilterItemByName(e.name,e.groupName);if(t){i=t.getLabel()}}return i};W.prototype._associateValueList=function(e,t,i,a,n){var r=i.visibleInAdvancedArea||i.groupId===x.BASIC_FILTER_AREA_ID,o={control:e,aggregation:t,fieldViewMetadata:i,hasTypeAhead:a,annotaionIsToBeLoaded:r};if(n&&r){this._attachEventOnce(x.ASSOCIATE_VALUE_LISTS,function(){this._associateValueListHandler(o)}.bind(this))}else{this._associateValueListHandler(o)}};W.prototype._associateValueListHandler=function(e){var t,i,a=e.control,n=e.aggregation,r=e.fieldViewMetadata,o=e.hasTypeAhead,s=e.annotaionIsToBeLoaded;if(this._oSmartFilter&&!this._bAttachInitializedDone&&new URLSearchParams(window.location.search).get("sap-ui-comp-filterbar-data-defer")){var l=this._oParentODataModel;this._sDeferredGroupId="sapUiCompFilterBarData";var d=l.getDeferredGroups?this._oParentODataModel.getDeferredGroups():null;if(d!==null){d.push(this._sDeferredGroupId);l.setDeferredGroups(d);var u=function(){l.submitChanges({groupId:this._sDeferredGroupId});var e=l.getDeferredGroups().filter(function(e){return e!==this._sDeferredGroupId}.bind(this));l.setDeferredGroups(e);delete this._sDeferredGroupId;this._oSmartFilter.detachInitialized(u)}.bind(this);this._oSmartFilter.attachInitialized(u);this._bAttachInitializedDone=true}}if(r.hasValueListAnnotation){t=new F({fieldName:r.fieldName,control:a,model:this._oParentODataModel,filterModel:this.oModel,filterProvider:this,displayFormat:r.displayFormat,dateFormatSettings:this._oDateFormatSettings,fieldViewMetadata:r,displayBehaviour:r.displayBehaviour,loadAnnotation:true,fullyQualifiedFieldName:r.fullName,metadataAnalyser:this._oMetadataAnalyser,type:r.filterType,aggregation:n,typeAheadEnabled:o,bShowAllSuggestionsButton:r.hasValueHelpDialog,enableShowTableSuggestionValueHelp:r.hasValueHelpDialog,deferredGroupId:this._sDeferredGroupId,context:this._sContext?this._sContext:"SmartFilterBar",fieldHistoryEnabled:r.historyEnabled!==undefined?r.historyEnabled:true,fieldHistoryEnabledInitial:r.historyEnabledInitial!==undefined?r.historyEnabledInitial:true,considerPresentationVariant:this._oSmartFilter?.getConsiderPresentationVariant()});t.attachValueListChanged(function(e){if(this._oSmartFilter){this._oSmartFilter.fireFilterChange(e);this._oSmartFilter.validateMandatoryFields()}}.bind(this));if(s){i=t.loadAnnotation().then(function(e){this._enrichFieldViewMetadata(r,e)}.bind(this));a.data("__loadVLPromise",i);this.aFilterAnnotations.push(i)}this._aValueListProvider.push(t)}else if(this._mTokenHandler[a.getId()]&&this._mTokenHandler[a.getId()].parser&&r.filterRestriction!=="searchExpression"){this._mTokenHandler[a.getId()].parser.setDefaultOperation("EQ")}};W.prototype._createAnalyticParameters=function(e){var t,i;if(e){i=e.getAllParameterNames();t=e.getEntitySet();if(t){this._createParametersByEntitySetName(t.getQName(),i)}}};W.prototype._createParametersByEntitySetName=function(e,t){var i,a=this._oMetadataAnalyser.getFieldsByEntitySetName(e);for(var n=0;n<a.length;n++){if(t.indexOf(a[n].name)>=0){i=this._createAnalyticParameterMetadata(a[n]);if(i&&i.visible){if(this._oNonAnaParameterization&&i.isCustomFilterField){continue}this._aAnalyticalParameters.push(i)}}}};W.prototype._createAnalyticParameterMetadata=function(e){var t,i=M.ANALYTICAL_PARAMETER_PREFIX,a=function(e){return e.type==="Edm.String"&&e["sap:parameter"]==="optional"};e.filterRestriction="single-value";t=this._createFieldMetadata(e,i);if(t){t.fieldName=i+e.name;t.isMandatory=a(t)?false:true;t.isParameter=true;t.visibleInAdvancedArea=true}else{N.error("_createAnalyticParameterMetadata issue with property: "+e.name)}return t};W.prototype.getAnalyticParameters=function(){return this._aAnalyticalParameters};W.prototype.getSelectionVariants=function(){return this._aSelectionVariants};W.prototype.getAnalyticBindingPath=function(){var e,t=[],i=this.getAnalyticParameters();i.forEach(function(e){t.push(e.fieldName)});e=this.getFilledFilterData(t);if(this._oParameterization){return this._createAnalyticBindingPath(i,e)}else{return this._createNonAnalyticBindingPath(i,e)}};W.prototype._createAnalyticBindingPath=function(e,t){var a,n="",r;r=this._getParameterizationRequest(this._oParameterization);if(r){e.forEach(function(e){a=t[e.fieldName];if(!a&&a!==0){a=""}else if(e.type==="Edm.Time"&&a instanceof Date){if(this._oDateFormatSettings&&!this._oDateFormatSettings.UTC){a=i.utcToLocal(a)}a=i.localToUtc(a);a={__edmType:"Edm.Time",ms:a.valueOf()}}else if(e.type==="Edm.DateTime"&&t[e.fieldName]&&t[e.fieldName].conditionTypeInfo&&t[e.fieldName].ranges&&t[e.fieldName].ranges[0]){a=t[e.fieldName].ranges[0].value1;if(this._oDateFormatSettings&&this._oDateFormatSettings.UTC&&a instanceof Date){a=i.localToUtc(a)}}else if(e.type!=="Edm.DateTimeOffset"&&this._oDateFormatSettings&&this._oDateFormatSettings.UTC&&a instanceof Date){a=i.localToUtc(a)}r.setParameterValue(e.name,a)}.bind(this));n=r.getURIToParameterizationEntry()+"/"+this._oParameterization.getNavigationPropertyToQueryResult()}return n};W.prototype._createNonAnalyticBindingPath=function(e,t){var a,n="",r="";if(this._oNonAnaParameterization){n="/"+this._oNonAnaParameterization.entitySetName+"(";e.forEach(function(e){a=t[e.fieldName];if(!a){a=""}else if(e.type==="Edm.Time"&&a instanceof Date){a=i.localToUtc(a);a={__edmType:"Edm.Time",ms:a.valueOf()}}else if(e.type==="Edm.DateTime"&&t[e.fieldName]&&t[e.fieldName].conditionTypeInfo&&t[e.fieldName].ranges&&t[e.fieldName].ranges[0]){a=t[e.fieldName].ranges[0].value1;if(this._oDateFormatSettings&&this._oDateFormatSettings.UTC&&a instanceof Date){a=i.localToUtc(a)}}else if(e.type!=="Edm.DateTimeOffset"&&this._oDateFormatSettings&&this._oDateFormatSettings.UTC&&a instanceof Date){a=i.localToUtc(a)}n+=r+e.name+"="+B(this._oParentODataModel.formatValue(a,e.type));r=","}.bind(this));n+=")/"+this._oNonAnaParameterization.navPropertyName}return n};W.prototype._getParameterizationRequest=function(){return this._oParameterization?new I.ParameterizationRequest(this._oParameterization):null};W.prototype._constructContextUrl=function(e,t){var i=e._getServerUrl();if(i&&i.lastIndexOf("/")===i.length-1){i=i.substr(0,i.length-1)}return i+e.sServiceUrl+"/$metadata#"+t};W.prototype.getFilterContextUrl=function(){var e,t=null;if(this._oParentODataModel&&this._oParentODataModel.isA("sap.ui.model.odata.v2.ODataModel")&&this._oParentODataModel.getMetaModel()){e=this._oParentODataModel.getMetaModel().getODataEntitySet(this.sEntitySet);if(e){t=this._constructContextUrl(this._oParentODataModel,e.name)}}return t};W.prototype.getParameterContextUrl=function(){var e,t=null;if(this._oParentODataModel&&this._oParentODataModel.isA("sap.ui.model.odata.v2.ODataModel")&&this._oParentODataModel.getMetaModel()){if(this._oParameterization&&this._oParameterization.getEntitySet()){e=this._oParameterization.getEntitySet().getQName()}else if(this._oNonAnaParameterization){e=this._oNonAnaParameterization.entitySetName}if(e){t=this._constructContextUrl(this._oParentODataModel,e)}}return t};W.prototype._createFieldMetadata=function(e,i){var a,n,r,o,s;e.fieldName=this._getFieldName(e);e.fieldNameOData=e.fieldName.replace(x.FIELD_NAME_REGEX,"/");n=this._oAdditionalConfiguration?this._oAdditionalConfiguration.getControlConfigurationByKey(e.fieldName):null;a=Object.assign({},e);a.filterRestriction=this._getFilterRestriction(e.filterRestriction,n);this._updateValueListMetadata(a,e);a.hasValueHelpDialog=this._hasValueHelpDialog(a,n);a.isConstant=Array.isArray(this._aConstParams)&&this._aConstParams.indexOf(e.fieldName)!==-1;a.isInitialValueSignificant=Array.isArray(this._aSignificantParams)&&this._aSignificantParams.indexOf(e.fieldName)!==-1;if(n){a.preventInitialDataFetchInValueHelpDialog=this._getPreventInitialDataFetchInValueHelpDialog(a,n);a.conditionPanelDefaultOperation=n.conditionPanelDefaultOperation;if(n.displayBehaviour&&n.displayBehaviour!=="auto"){a.displayBehaviour=n.displayBehaviour}a.isCustomFilterField=!!n.customControl;a.visibleInAdvancedArea=!!n.visibleInAdvancedArea;a.defaultFilterValues=n.defaultFilterValues;a.customControl=n.customControl;r=n.conditionType;a.width=this._getWidth(n);a.isVisible=this._isVisible(n);a.historyEnabled=n.historyEnabled;a.historyEnabledInitial=n.historyEnabledInitial;a.hasValidation=n.hasValidation}else{a.preventInitialDataFetchInValueHelpDialog=this._getPreventInitialDataFetchInValueHelpDialog(a);a.isVisible=true;a.isCustomFilterField=false;a.visibleInAdvancedArea=false;a.hasValidation=true}a.controlType=this._getControlType(a,n);a.label=this._getLabel(e,n);a.isMandatory=this._isMandatory(e,n);a.groupId=this._getGroupID(e,n);a.index=this._getIndex(e,n);a.fControlConstructor=this._getControlConstructor(a,i);a.isFiscalDate=g.isFiscalValue(a);a.isCalendarType=R.isCalendarValue(a);a.fiscalType=g.getFiscalAnnotationType(a);a.calendarType=R.getCalendarAnnotationType(a);if(a.isFiscalDate){g.updateViewMetadata(a)}if(a.isCalendarType&&a.calendarType){R.updateViewMetadata(a)}a.filterType=this._getFilterType(a);a.hasTypeAhead=this._hasTypeAhead(a,e,n);a.ui5Type=this._getType(a);if(a.ui5Type&&a.ui5Type.isA("sap.ui.model.odata.type.DateTime")){a.ui5Type.formatValue(t.getInstance(),"string");a.ui5Type.oFormat.oFormatOptions.UTC=false}a.fCreateControl=function(e){var t;e.control=this._createControl(e);t=this.oModel.getData()[e.fieldName];if(t){this._updateMultiValueControl(e.control,t.items,t.ranges,e);var i=this._aFilterBarSingleValueWithValueListFieldMetadata.some(function(t){return t.name===e.fieldName||M.ANALYTICAL_PARAMETER_PREFIX+t.name===a.fieldName});if(i){this._updateSingleValueControl(e)}}}.bind(this);this._applyWidth(a);if(a.type==="Edm.String"){this._aFilterBarStringFieldNames.push(a.fieldName)}a.conditionType=null;var d=a.filterRestriction===k.single&&(a.type==="Edm.DateTime"&&a.displayFormat==="Date"||a.type==="Edm.String"&&a.isCalendarDate);var u=a.type==="Edm.DateTimeOffset"&&a.filterRestriction==="interval";if(!r&&this._bUseDateRangeType&&(a.fControlConstructor===l||d||u)){r="sap.ui.comp.config.condition.DateRangeType"}if(r){o="";if(typeof r==="object"){if(this._bUseDateRangeType&&!r.module&&a.fControlConstructor===l||d||u){r.module="sap.ui.comp.config.condition.DateRangeType"}o=r.module}else{o=r;r=null}try{o=o.replace(/\./g,"/");var f=sap.ui.require(o);if(f){this._enhanceConditionTypeInfo(f,o,r,a,i)}else{s=new Promise(function(e){sap.ui.require([o],function(t){this._enhanceConditionTypeInfo(t,o,r,a,i);e()}.bind(this))}.bind(this));this._aPromises.push(s)}}catch(e){N.error("Module "+o+" could not be loaded")}}else{this._checkMetadataDefaultValue(a)}return a};W.prototype._requireConditionType=function(e,t,i){var e=e.replace(/\./g,"/");var a=sap.ui.require(e);if(a){this._enhanceConditionTypeInfo(a,e,t,i)}else{sap.ui.require([e],function(a){this._enhanceConditionTypeInfo(a,e,t,i)}.bind(this))}};W.prototype._enhanceConditionTypeInfo=function(e,t,i,a,n){var r=e;var o=n===M.ANALYTICAL_PARAMETER_PREFIX&&a.fieldName.indexOf(M.ANALYTICAL_PARAMETER_PREFIX)===-1?n+a.fieldName:a.fieldName;if(this._sContext==="mdcFilterPanel"&&t!=="sap/ui/comp/config/condition/DateRangeType"){return}a.conditionType=new r(o,this,a);this._mConditionTypeFields[o]=a;a.calendarWeekNumbering=this._oCalendarWeekSettings;a.showCurrentDateButton=this._oShowCurrentDateButton;if(i&&!this._bUseDateRangeType){if(a.defaultValue&&n===M.ANALYTICAL_PARAMETER_PREFIX){i=Object.assign({},i,{defaultDate:a.defaultValue})}a.conditionType.applySettings(i)}if(this._bUseDateRangeType&&i&&n!==M.ANALYTICAL_PARAMETER_PREFIX){a.conditionType.applySettings(i)}if(this._bUseDateRangeType&&n===M.ANALYTICAL_PARAMETER_PREFIX&&(a.defaultValue||i&&i.defaultOperation)){var s={defaultDate:a.defaultValue};i=Object.assign({},s,i);a.conditionType.applySettings(i)}this._checkMetadataDefaultValue(a)};W.prototype._getFilterType=function(e){return v._getFilterType(e)};W.prototype._updateValueListMetadata=function(e,t){e.hasValueListAnnotation=t["sap:value-list"]!==undefined;if(e.hasValueListAnnotation){e.hasFixedValues=t["sap:value-list"]==="fixed-values"}else if(t["com.sap.vocabularies.Common.v1.ValueList"]){e.hasValueListAnnotation=true;e.hasFixedValues=this._oMetadataAnalyser.getValueListSemantics(t["com.sap.vocabularies.Common.v1.ValueList"])==="fixed-values";if(!e.hasFixedValues){e.hasFixedValues=_.isValueListWithFixedValues(t)}}};W.prototype._createBasicSearchFieldMetadata=function(){var t;var i=e.getResourceBundleFor("sap.ui.comp");t={};t.filterRestriction=k.single;t.name=x.BASIC_SEARCH_FIELD_ID;t.fieldName=x.BASIC_SEARCH_FIELD_ID;t.label=undefined;t.isMandatory=false;t.isVisible=true;t.groupId=x.BASIC_FILTER_AREA_ID;t.index=-1;t.control=new c(this._oSmartFilter.getId()+"-btnBasicSearch",{showSearchButton:true});if(!this._isRunningInValueHelpDialog){t.control.setPlaceholder(i.getText("FILTER_BAR_BSEARCH_PLACE_HOLDER"))}t.control.bindProperty("value",this.sFilterModelName+">/"+t.fieldName);this._oBasicSearchControl=t.control;return t};W.prototype._applyWidth=function(e){if(e&&e.width&&e.control&&typeof e.control.setWidth==="function"){e.control.setWidth(e.width)}};W.prototype._createFieldMetadataForCustomFilterFields=function(e){var t;if(!e||!e.customControl){return undefined}t={};t.name=e.key;t.fieldName=e.key;t.label=e.label;t.visibleInAdvancedArea=!!(e&&e.visibleInAdvancedArea);t.isVisible=this._isVisible(e);t.groupId=e.groupId;t.isMandatory=this._isMandatory(undefined,e);t.index=e.index;t.width=this._getWidth(e);t.control=e.customControl;t.isCustomFilterField=true;this._applyWidth(t);return t};W.prototype._getFieldName=function(e){if(!e.parentPropertyName){return e.name}else{return e.parentPropertyName+"."+e.name}};W.prototype._getPreventInitialDataFetchInValueHelpDialog=function(e,t){if(t&&!t.isSetPreventInitialDataFetchInValueHelpDialog){return t.preventInitialDataFetchInValueHelpDialog}if(_.isValueList(e)&&e["com.sap.vocabularies.Common.v1.ValueList"]&&e["com.sap.vocabularies.Common.v1.ValueList"].FetchValues){return e["com.sap.vocabularies.Common.v1.ValueList"].FetchValues.Int!=="1"}return false};W.prototype._hasValueHelpDialog=function(e,t){var i=true;if(t){if(t.controlType===O.dropDownList){i=false}else if(t.hasValueHelpDialog!==true){i=false}}if(e&&!e.hasValueListAnnotation){if(e.filterRestriction===k.single||e.filterRestriction===k.multiple){i=false}}return i};W.prototype._isVisible=function(e){if(e&&e.isVisible===false){return false}return true};W.prototype._getWidth=function(e){if(e&&e.width){return e.width}return undefined};W.prototype._isMandatory=function(e,t){if(t&&t.mandatory!==U.auto){return t.mandatory===U.mandatory}if(e){return e.requiredFilterField}return false};W.prototype._getFilterRestriction=function(e,t){if(t&&t.filterType&&t.filterType!==k.auto){return t.filterType}switch(e){case"single-value":return k.single;case"multi-value":return k.multiple;case"interval":return k.interval;case"search-expression":return k.searchExpression;default:return k.auto}};W.prototype._getControlType=function(e,t){var i;if(t&&t.controlType&&t.controlType!==O.auto){i=t.controlType}else if(e.type==="Edm.DateTime"&&e.displayFormat==="Date"||e.isCalendarDate){i=O.date}else if(e.type==="Edm.DateTimeOffset"){i=O.dateTimePicker}else if(e.hasValueListAnnotation&&e.hasFixedValues){i=O.dropDownList}else if(this._isBooleanWithFixedValuedButWithoutValueListAnnotation(e)){i=O.dropDownList}else{i=O.input}return i};W.prototype._isBooleanWithFixedValuedButWithoutValueListAnnotation=function(e){if(e.type==="Edm.Boolean"&&!e.hasFixedValues&&!e.hasValueListAnnotation&&e.filterRestriction==="single"){return true}return false};W.prototype._getGroupID=function(e,t){if(t&&t.groupId){return t.groupId}else if(e&&(e.requiredFilterField||this._aSelectionFields&&this._aSelectionFields.indexOf(e.fieldNameOData)>-1)){return this._sBasicFilterAreaID}return this._getGroupIDFromFieldGroup(e)};W.prototype._getGroupIDFromFieldGroup=function(e){var t=0,i=null,a;if(e&&this._aFieldGroupAnnotation&&this._aFieldGroupAnnotation.length){t=this._aFieldGroupAnnotation.length;while(t--){i=this._aFieldGroupAnnotation[t];if(i&&i.fields&&i.fields.indexOf(e.fieldNameOData)>-1){a=i.groupName;break}}}return a};W.prototype._getLabel=function(e,t){if(t&&t.label){return t.label}return this._getLabelFromFieldGroup(e)||e.fieldLabel||e.fieldName};W.prototype._getLabelFromFieldGroup=function(e){var t=0,i=null,a;if(e&&this._aFieldGroupAnnotation&&this._aFieldGroupAnnotation.length){t=this._aFieldGroupAnnotation.length;while(t--){i=this._aFieldGroupAnnotation[t];if(i&&i.fields&&i.fields.indexOf(e.fieldNameOData)>-1){a=i.labels[e.fieldNameOData];break}}}return a};W.prototype._getIndex=function(e,t){if(t&&t.index>=0){return t.index}else if(this._aSelectionFields&&this._aSelectionFields.indexOf(e.fieldNameOData)>-1){return this._aSelectionFields.indexOf(e.fieldNameOData)}return this._getIndexFromFieldGroup(e)};W.prototype._getIndexFromFieldGroup=function(e){var t=0,i=null,a;if(e&&this._aFieldGroupAnnotation&&this._aFieldGroupAnnotation.length){t=this._aFieldGroupAnnotation.length;while(t--){i=this._aFieldGroupAnnotation[t];if(i&&i.fields){a=i.fields.indexOf(e.fieldNameOData);if(a>-1){break}a=undefined}}}return a};W.prototype._getGroupIndex=function(e){if(e&&(e.index||e.index===0)){return e.index}};W.prototype._getGroupLabel=function(e,t){if(t&&t.label){return t.label}return e.groupLabel||e.groupName||e.groupEntitySetName};W.prototype._hasTypeAhead=function(e,t,i){var a;a=true;if(i){a=i.hasTypeAhead}else if(t.type!=="Edm.String"){return false}if(!(e.fControlConstructor===u||e.fControlConstructor===h)){return false}return a};W.prototype.getModel=function(){return this.oModel};W.prototype.getFilterBarViewMetadata=function(){return this._aFilterBarViewMetadata};W.prototype._getFilterBarViewMetadataExtend=function(){return this._oFilterBarViewMetadataExtend};W.prototype.getAssociatedValueHelpProviders=function(){return this._aValueHelpDialogProvider};W.prototype.getAssociatedValueListProviders=function(){return this._aValueListProvider};W.prototype.getParameters=function(){var e,t=null;if(this.oModel){t=this.oModel.getProperty("/"+x.BASIC_SEARCH_FIELD_ID)}if(this._sBasicSearchFieldName||t){e={custom:{}};if(this._sBasicSearchFieldName){e.custom["search-focus"]=this._sBasicSearchFieldName}e.custom["search"]=t||""}return e};W.prototype.getFilters=function(e){var t=null;if(this.oModel){t=this.oModel.getData()}return x.generateFilters(e,t,{dateSettings:this._oDateFormatSettings,useContainsAsDefault:this._bUseContainsAsDefault,stringFields:this._aFilterBarStringFieldNames,timeFields:this._aFilterBarTimeFieldNames,dateTimeOffsetValueFields:this._aFilterBarDateTimeFieldNames,dateTimeOffsetWithTimeZone:this._aFilterBarDateTimeOffsetWithTimezoneFieldNames,viewMetadataData:this._aFilterBarViewMetadata},this._sContext)};W.prototype.getFilterData=function(){return this.oModel?this.oModel.getData():null};W.prototype.getFilterDataAsString=function(){return this.oModel?this.oModel.getJSON():null};W.prototype.getFilledFilterData=function(e){var t,i={},a,n,r;t=this.oModel?this.oModel.getData():null;if(t&&e){a=e.length;while(a--){n=e[a];if(n&&n!==x.BASIC_SEARCH_FIELD_ID){r=t[n];if(r&&r.hasOwnProperty("low")){if(r.low){i[n]=r}}else if(r&&r.hasOwnProperty("items")){if(r.value&&typeof r.value==="string"){r.value=r.value.trim()}if(r.items.length||r.ranges&&r.ranges.length||r.value||typeof r.value==="boolean"){i[n]=r}}else if(r||r===0){if(typeof r==="string"){r=r.trim()}if(r||r===0){i[n]=r}}}if(a===0){n=x.CUSTOM_FIELDS_MODEL_PROPERTY;r=t[n];if(r){i[n]=r}}}}return b({},i)};W.prototype.getFilledFilterDataAsString=function(e){return JSON.stringify(this.getFilledFilterData(e))};W.prototype.setFilterData=function(e,t){var i=null,a=null,n=null;if(this.oModel&&e){this._bUpdatingFilterData=true;try{if(t){this._createInitialModel(false)}i=this._parseFilterData(e,t);if(i){this.oModel.setData(i,true);a=[];var r=arguments[2];if(r){a.push(r)}for(n in i){a.push(n)}this._handleFilterDataUpdate(a,arguments[3])}}finally{this._bUpdatingFilterData=false}}};W.prototype.setFilterDataAsString=function(e,t){if(e){this.setFilterData(JSON.parse(e),t)}};W.prototype._parseFilterData=function(e,t){return W.parseFilterData(this.oModel.getData(),e,{stringDateFields:this._aFilterBarStringDateFieldNames,dateFields:this._aFilterBarDateFieldNames,timeFields:this._aFilterBarTimeFieldNames,timeIntervalFields:this._aFilterBarTimeIntervalFieldNames,dateTimeMultiValueFields:this._aFilterBarDateTimeMultiValueFieldNames,conditionTypeFields:this._mConditionTypeFields,dateTimeOffsetValueFields:this._aFilterBarDateTimeFieldNames,dateTimeOffsetWithTimeZone:this._aFilterBarDateTimeOffsetWithTimezoneFieldNames,viewMetadataData:this._aFilterBarViewMetadata,filterProvider:this},t)};W.prototype._handleFilterDataUpdate=function(e,t){var i=0,a,n,t=t===undefined?false:t,r=this.oModel.getData();var o=function(e,t){var i=t;e.forEach(function(e){t.forEach(function(a){if(a.operation===E.EQ&&a.value1===e.key){i.splice(t.indexOf(a),1)}})});return i};if(this._aFilterBarMultiValueFieldMetadata){i=this._aFilterBarMultiValueFieldMetadata.length;while(i--){if(r){a=this._aFilterBarMultiValueFieldMetadata[i];if(e.indexOf(a.fieldName)>-1){n=r[a.fieldName];if(n){if(n.items&&n.items.length>0&&n.ranges&&n.ranges.length>0){n.ranges=o(n.items,n.ranges)}this._updateMultiValueControl(a.control,n.items,n.ranges,a,n.value)}}}}this._updateConditionTypeFields()}if(this._aFilterBarSingleValueWithValueListFieldMetadata&&r&&!t){this._aFilterBarSingleValueWithValueListFieldMetadata.forEach(function(t){var i=t.control,a=t.fieldName;if(!i||_.isHiddenFilter(t)&&this._sContext!=="mdcFilterPanel"){return}if(e.includes(a)){this._updateSingleValueControl(t)}else if(!r[a]){i.setValue("");i.__sValidationText=""}}.bind(this))}};W.prototype.clear=function(){this._createInitialModel(false)};W.prototype.reset=function(){this._createInitialModel(true)};W.prototype._initializeConditionTypeFields=function(){var e=function(e){this.setPending(this.isPending())}.bind(this);for(var t in this._mConditionTypeFields){this._mConditionTypeFields[t].conditionType.initialize(this.oModel.getData()[t],this._sContext);if(this._mConditionTypeFields[t].conditionType.getAsync()){this._mConditionTypeFields[t].conditionType.attachPendingChange(e)}}};W.prototype._updateConditionTypeFields=function(){var e=this._oldData;var t=this.oModel.getData();this._oldData=b({},t);if(e!==undefined){var i=[],a;for(a in t){var n=JSON.stringify(t[a]);var r=JSON.stringify(e[a]);if(n!==r){i.push(a)}}if(i.length>0){for(a in this._mConditionTypeFields){this._mConditionTypeFields[a].conditionType.providerDataUpdated(i,t)}}}};W.prototype._clearConditionTypeFields=function(){var e=this.oModel.getData();for(var t in this._mConditionTypeFields){if(!e[t]){this._mConditionTypeFields[t].conditionType.initialize({})}else{this._mConditionTypeFields[t].conditionType.initialize(e[t],this._sContext)}}};W.prototype._validateConditionTypeFields=function(e){var t=false;for(var i in this._mConditionTypeFields){var a=this._mConditionTypeFields[i].conditionType.validate(e);if(!a&&!t){t=true}}return t};W.prototype._getFieldMetadata=function(e){return x._getFieldMetadata(this.getFilterBarViewMetadata(),e)};W.prototype._getSelectedDateRange=function(e){if(!Array.isArray(e)){e=[e,e]}return e};W.prototype._getDateFieldOutOfRangeErrorText=function(e,t,i,a){var n=e.getMinDate()||e._oMinDate,r=e.getMaxDate()||e._oMaxDate;if(t[0].getTime()<n.getTime()){return a.getText("FILTER_BAR_DATE_FIELD_MIN_DATE_ERROR",[i.formatValue(n,"string")])}if(t[1].getTime()>r.getTime()){return a.getText("FILTER_BAR_DATE_FIELD_MAX_DATE_ERROR",[i.formatValue(r,"string")])}};W.generateFilters=function(e,t,i){return x.generateFilters(e,t,i)};W.parseFilterData=function(e,a,n,r){var o={},s=null,l=null,d=null,u,f,h,p,c,m,_,g,y,F,D,T,v,C,S;if(n){m=n.stringDateFields;_=n.dateFields;g=n.timeFields;y=n.timeIntervalFields;F=n.dateTimeMultiValueFields;s=n.conditionTypeFields||{};D=n.dateTimeOffsetValueFields;T=n.viewMetadataData||[];C=n.filterProvider||null}if(!m){m=[]}if(!_){_=[]}if(!g){g=[]}if(!y){y=[]}if(!F){F=[]}if(!D){D=[]}if(e&&a){f=Object.assign({},a,true);for(l in f){v=x._getFieldMetadata(T,l);if(e.hasOwnProperty(l)&&l!==x.CUSTOM_FIELDS_MODEL_PROPERTY){d=e[l];u=f[l];if(l in s){if(s[l]&&typeof u==="string"){var V=t.getInstance(u);if(V instanceof Date&&!isNaN(V)){s[l].conditionType.initialize({value1:V},this._sContext)}else if(s[l].type==="Edm.String"&&s[l].ui5Type&&typeof s[l].ui5Type.formatValue==="function"){var V=s[l].ui5Type.formatValue(u);s[l].conditionType.initialize({value1:V})}}else if(u&&(u.low||u.low===0)&&(u.high||u.high===0)){var A=t.getInstance(u.low),M=t.getInstance(u.high);if(A instanceof Date&&!isNaN(A)&&M instanceof Date&&!isNaN(M)){s[l].conditionType.initialize({value1:A,value2:M})}else if(s[l].type==="Edm.String"&&s[l].ui5Type&&typeof s[l].ui5Type.formatValue==="function"){var A=s[l].ui5Type.formatValue(u.low),M=s[l].ui5Type.formatValue(u.high);s[l].conditionType.initialize({value1:A,value2:M})}}else if(u&&"conditionTypeInfo"in u){if(s[l].isParameter){this._reduceRangesForParameters(u)}else if(u.ranges&&u.ranges.length>0){c=u.ranges[u.ranges.length-1];if(c){if(u.conditionTypeInfo.data.operation==="DATE"){u.conditionTypeInfo.data.value1=c.value1}else if(u.conditionTypeInfo.data.operation==="DATERANGE"){u.conditionTypeInfo.data.value1=c.value1;u.conditionTypeInfo.data.value2=c.value2}}}s[l].conditionType.initialize(u)}else if(u&&!("conditionTypeInfo"in u)&&u.ranges){if(s[l].isParameter){this._reduceRangesForParameters(u)}s[l].conditionType.initialize(u)}}else if(d&&d.hasOwnProperty("low")){o[l]=u;if(u){if((u.low||u.low===0)&&(u.high||u.high===0)){if(_.indexOf(l)>-1||g.indexOf(l)>-1){if(!(u.low instanceof Date)){o[l].low=t.getInstance(u.low)}if(!(u.high instanceof Date)){o[l].high=t.getInstance(u.high)}}else if(C&&v&&D.indexOf(l)>-1&&u.low&&u.high){o[l].low=v.ui5Type.formatValue(t.getInstance(u.low),"string")+"-"+v.ui5Type.formatValue(t.getInstance(u.high),"string");o[l].high=null}else if(m.indexOf(l)===-1){o[l].low=u.low+"-"+u.high;o[l].high=null}}else if((u.low||u.low===0||u.value)&&!u.high){if(!u.low&&u.value){u.low=u.value}if((_.indexOf(l)>-1||g.indexOf(l)>-1||D.indexOf(l)>-1)&&!(u.low instanceof Date)){if(C&&v&&D.indexOf(l)>-1&&v.filterRestriction==="interval"&&(u.low.indexOf("-")<0||u.low.indexOf("Z")>0)){o[l].low=v.ui5Type.formatValue(t.getInstance(u.low),"string")}else{S=Date.parse(u.low);if(!Number.isNaN(S)){o[l].low=t.getInstance(S)}o[l].low=u.low}}o[l].high=null}}}else if(d&&d.hasOwnProperty("items")){if(u&&(u.items||u.ranges)){if(u.ranges&&u.ranges.length){if(y.indexOf(l)>-1){p=u.ranges.length;for(h=0;h<p;h++){c=u.ranges[h];if(!c.exclude&&(c.operation==="EQ"||c.operation==="BT")){break}c=null}if(c){if(c.value1&&typeof c.value1==="string"){c.value1=t.getInstance(c.value1)}if(c.value2&&typeof c.value2==="string"){c.value2=t.getInstance(c.value2)}o[l]={ranges:[c],items:[],value:""}}continue}else if(_.indexOf(l)>-1||g.indexOf(l)>-1||D.indexOf(l)>-1){p=u.ranges.length;for(h=0;h<p;h++){c=u.ranges[h];if(c.value1&&typeof c.value1==="string"){c.value1=t.getInstance(c.value1)}if(c.value2&&typeof c.value2==="string"){c.value2=t.getInstance(c.value2)}}}else if(v&&v.isCalendarDate){p=u.ranges.length;for(h=0;h<p;h++){c=u.ranges[h];if(c.value1&&typeof c.value1==="string"&&!c.value1.match(/([1-9][0-9]{3,}|0[0-9]{3})(0[1-9]|1[0-2])(0[1-9]|[12][0-9]|3[01])/)){c.value1=v.ui5Type.parseValue(t.getInstance(c.value1),"date")}if(c.value2&&typeof c.value2==="string"&&!c.value2.match(/([1-9][0-9]{3,}|0[0-9]{3})(0[1-9]|1[0-2])(0[1-9]|[12][0-9]|3[01])/)){c.value2=v.ui5Type.parseValue(t.getInstance(c.value2),"date")}}}else if(v&&v.filterType==="boolean"){p=u.ranges.length;for(h=0;h<p;h++){c=u.ranges[h];if(c.hasOwnProperty("value1")){if(typeof c.value1==="string"){c.value1=c.value1==="true"}}if(c.hasOwnProperty("value2")){if(typeof c.value2==="string"){c.value2=c.value2==="true"}}}}}o[l]=u;if(!r&&o[l].ranges){for(h=0;h<o[l].ranges.length;h++){o[l].ranges[h].tokenText=null}}}else if(typeof u==="string"||typeof u==="boolean"||typeof u==="number"||u instanceof Date){if(u&&(_.indexOf(l)>-1||g.indexOf(l)>-1)){if(typeof u==="string"){u=t.getInstance(u)}o[l]={ranges:[{exclude:false,operation:"EQ",keyField:l,value1:u,value2:null}],items:[],value:""}}else{o[l]={value:u,items:[]}}}}else{o[l]=null;if(typeof u==="string"||typeof u==="boolean"||typeof u==="number"||u instanceof Date){if(typeof u==="string"&&(_.indexOf(l)>-1||g.indexOf(l)>-1||D.indexOf(l)>-1)){o[l]=t.getInstance(u)}else{o[l]=u}}else if(u&&(u.value||u.value===0||u.value===false)){o[l]=u.value}else if(u&&u.items&&u.items.length){o[l]=u.items[0].key}else if(u&&u.ranges&&u.ranges.length){p=u.ranges.length;for(h=0;h<p;h++){c=u.ranges[h];if(!c.exclude&&c.operation==="EQ"){break}c=null}if(c&&c.value1){if(typeof c.value1==="string"&&(_.indexOf(l)>-1||g.indexOf(l)>-1||D.indexOf(l)>-1)){o[l]=t.getInstance(c.value1)}else{o[l]=c.value1}}if(c===null&&u.conditionTypeInfo&&u.conditionTypeInfo.data&&u.conditionTypeInfo.data.operation==="DATE"&&u.conditionTypeInfo.data.value1&&i._isValidDateObject(u.conditionTypeInfo.data.value1)){o[l]=u.conditionTypeInfo.data.value1}}}}else if(r||l===x.CUSTOM_FIELDS_MODEL_PROPERTY){o[l]=f[l]}}}return o};W.prototype._attachEvent=function(e,t){if(!this._oEventProvider){this._oEventProvider=new C}this._oEventProvider.attachEvent(e,t)};W.prototype._attachEventOnce=function(e,t){if(!this._oEventProvider){this._oEventProvider=new C}this._oEventProvider.attachEventOnce(e,t)};W.prototype._detachEvent=function(e,t){if(!this._oEventProvider){return}this._oEventProvider.detachEvent(e,t)};W.prototype._fireEvent=function(e,t){if(!this._oEventProvider){return}this._oEventProvider.fireEvent(e,t||{})};W.prototype._getSuppressValueListsAssociation=function(){return this._bSuppressValueListsAssociation};W.prototype._getCurrentValidationPromises=function(){return this._aValueListProvider.concat(this._aValueHelpDialogProvider).reduce(function(e,t){return e.concat(t._getCurrentValidationPromises())},[])};W.prototype._enrichFieldViewMetadata=function(e,t){var i,a,n,r,o,s,l={},d="com.sap.vocabularies.Common.v1.ValueList";if(t===undefined||e===undefined){return}a=e["groupName"];n=e["fullName"];r=t.primaryValueListAnnotation!==undefined;o=Array.isArray(t.additionalAnnotations)&&t.additionalAnnotations.length>0;if(r){l[d]=t.primaryValueListAnnotation.annotation}if(o){for(i=0;i<t.additionalAnnotations.length;i++){s=t.additionalAnnotations[i];l[d+"#"+s.qualifier]=s.annotation}}if(r||o){if(this._oFilterBarViewMetadataExtend[a]===undefined){this._oFilterBarViewMetadataExtend[a]={}}if(this._oFilterBarViewMetadataExtend[a][n]===undefined){this._oFilterBarViewMetadataExtend[a][n]={}}this._oFilterBarViewMetadataExtend[a][n]=l}};W.prototype._isSingleDynamicDateEnabled=function(e){var t=this._bUseDateRangeType&&(e.type==="Edm.DateTime"&&e.displayFormat==="Date"||e.type==="Edm.String"&&e.isCalendarDate);if(t){return true}var i=this._oAdditionalConfiguration?this._oAdditionalConfiguration.getControlConfigurationByKey(e.fieldName)||this._oAdditionalConfiguration.getControlConfigurationByKey(e.name):null;var a=i&&this._sContext!=="mdcFilterPanel"&&(i.conditionType==="sap.ui.comp.config.condition.DateRangeType"||i.conditionType&&i.conditionType&&typeof i.conditionType==="object"&&i.conditionType.module==="sap.ui.comp.config.condition.DateRangeType")&&(e.type==="Edm.DateTime"||e.type==="Edm.String"&&e.isCalendarDate);return a};W.prototype._setSingleInputsTextArrangementData=function(e){this._sSingleInputsTextArrangementData=Object.assign({},e);return this};W.prototype._setSingleInputsTextArrangementFieldData=function(e,t,i){this._sSingleInputsTextArrangementData[e]={key:t,text:i};return this};W.prototype._setInputsWithCompositeKeysData=function(e){this._sInputsWithCompositeKeysData=Object.assign({},e);return this};W.prototype._setInputsWithCompositeKeysFieldData=function(e,t){this._sInputsWithCompositeKeysData[e]=t;return this};W.prototype._getInputsWithCompositeKeysData=function(e){if(e){return this._sInputsWithCompositeKeysData[e]}return this._sInputsWithCompositeKeysData};W.prototype._getSingleInputsTextArrangementData=function(e){if(e){return this._sSingleInputsTextArrangementData[e]}return this._sSingleInputsTextArrangementData};W.prototype._getFilterTimeZone=function(e){var t=this._oAdditionalConfiguration,i=t?t.getControlConfigurationByKey(e):null,a=null;if(i){a=i.timezone}return a};W.prototype._setControlDocumentationRef=function(e,t){if(t?.String&&e){sap.ui.require(["sap/ui/core/fieldhelp/FieldHelpUtil"],function(i){i.setDocumentationRef(e,t.String)})}};W.prototype.destroy=function(){var e=function(e){var t;if(e){t=e.length;while(t--){e[t].destroy()}}};this._oParentODataModel=null;this._aAnalyticalParameters=null;this._aFilterBarViewMetadata=null;this._oFilterBarViewMetadataExtend=null;this._oParameterization=null;this._oNonAnaParameterization=null;this._aFilterBarFieldNames=null;this._aFilterBarStringDateFieldNames=null;this._aFilterBarDateFieldNames=null;this._aFilterBarTimeFieldNames=null;this._aFilterBarTimeIntervalFieldNames=null;this._aFilterBarDateTimeMultiValueFieldNames=null;this._aFilterBarStringFieldNames=null;this._aFilterBarMultiValueFieldMetadata=null;this._aFilterBarDropdownFieldMetadata=null;this._aFilterBarNumericFieldMetadata=null;this._sSingleInputsTextArrangementData=null;this._sInputsWithCompositeKeysData=null;this._oNotValidatedSingleFields={};this._oSingleFieldSetFromFilterData={};this._aFilterBarDateTimeFieldNames=null;this._aFilterBarDateTimeOffsetWithTimezoneFieldNames=null;this._aFieldGroupAnnotation=null;this._aSelectionFields=null;this._aSelectionVariants=null;if(this._oBasicSearchControl&&this._oBasicSearchControl.destroy){this._oBasicSearchControl.destroy()}this._oBasicSearchControl=null;if(this._oMetadataAnalyser&&this._oMetadataAnalyser.destroy){this._oMetadataAnalyser.destroy()}this._oMetadataAnalyser=null;e(this._aValueHelpDialogProvider);this._aValueHelpDialogProvider=null;e(this._aValueListProvider);this._aValueListProvider=null;if(this._mTokenHandler){for(var t in this._mTokenHandler){var i=this._mTokenHandler[t];if(i.parser){i.parser.destroy();i.parser=null}}delete this._mTokenHandler}this.oResourceBundle=null;this.sIntervalPlaceholder=null;this.sDefaultDropDownDisplayBehaviour=null;this.sDefaultTokenDisplayBehaviour=null;this.sDefaultSingleFieldDisplayBehaviour=null;this._oSmartFilter=null;if(this._oEventProvider){if(this._oEventProvider.destroy){this._oEventProvider.destroy()}this._oEventProvider=null}for(var a in this._mConditionTypeFields){this._mConditionTypeFields[a].conditionType.destroy()}this._mConditionTypeFields=null;if(this.oModel){this.oModel.destroy();this.oModel=null}this._aPromises=[];this.bIsDestroyed=true};return W},true);
//# sourceMappingURL=FilterProvider.js.map