/*!
 * SAPUI5
 * (c) Copyright 2025 SAP SE. All rights reserved.
 */
(function(){"use strict";var t=sap.ui.require("sap/ui/performance/Measurement");if(t&&t.getActive()){t.start("SmartChartInit","Measurement of SmartChart init time")}})();sap.ui.define(["sap/ui/core/Element","sap/ui/core/Lib","sap/ui/thirdparty/jquery","sap/ui/comp/library","sap/ui/comp/util/DateTimeUtil","sap/m/Button","sap/m/Text","sap/m/FlexItemData","sap/m/OverflowToolbar","sap/m/OverflowToolbarButton","sap/m/OverflowToolbarToggleButton","sap/m/ToolbarSeparator","sap/m/ToolbarSpacer","sap/m/VBox","sap/ui/comp/providers/ChartProvider","sap/ui/comp/smartfilterbar/FilterProvider","sap/ui/comp/smartvariants/SmartVariantManagement","sap/ui/comp/smartvariants/PersonalizableInfo","sap/ui/model/json/JSONModel","sap/ui/model/Sorter","sap/ui/model/Filter","sap/ui/model/FilterOperator","sap/ui/comp/personalization/Util","sap/ui/Device","sap/ui/comp/odata/ODataModelUtil","sap/ui/comp/odata/MetadataAnalyser","sap/ui/comp/state/UIState","sap/m/SelectionDetails","sap/m/SelectionDetailsItem","sap/m/SelectionDetailsItemLine","sap/m/Title","sap/ui/comp/util/FormatUtil","sap/ui/comp/navpopover/SmartLink","sap/ui/core/InvisibleText","sap/m/OverflowToolbarLayoutData","sap/m/library","sap/ui/comp/personalization/Controller","sap/ui/comp/personalization/ChartWrapper","sap/ui/comp/navpopover/SemanticObjectController","sap/ui/performance/Measurement","sap/base/Log","sap/base/util/merge","sap/ui/core/CustomData","sap/ui/core/ResizeHandler","sap/ui/comp/util/FullScreenUtil","sap/ui/comp/util/FilterUtil","sap/ui/core/library","sap/ui/core/ShortcutHintsMixin","sap/ui/events/KeyCodes","sap/ui/base/DesignTime","sap/ui/core/date/UI5Date","sap/ui/mdc/chart/SelectionButton","sap/ui/mdc/chart/SelectionButtonItem","sap/ui/mdc/chart/SelectionButtonDisplay","sap/ui/core/InvisibleMessage","sap/ui/mdc/chart/ToolbarControlFactory","sap/ui/core/theming/Parameters","sap/m/IllustratedMessage","sap/ui/mdc/chart/Util"],function(t,e,jQuery,i,a,r,o,s,n,l,h,u,c,p,d,_,f,m,g,y,C,b,v,T,S,D,B,V,P,M,w,I,O,A,F,x,L,R,N,E,U,z,j,H,k,q,K,Z,G,$,W,Q,X,J,Y,tt,et,it,at){"use strict";var rt=x.ToolbarDesign;var ot=x.ListMode;var st=x.ListType;var nt=x.PlacementType;var lt=i.personalization.ChangeType;var ht=i.personalization.ResetType;var ut=i.smartchart.SelectionMode;var ct=K.TitleLevel;const{IllustratedMessageType:pt}=x;var dt;var _t;var ft;var mt;var gt;var yt;var Ct;var bt;var vt;var Tt;var St;var Dt;var Bt;var Vt;var Pt;var Mt;var wt=p.extend("sap.ui.comp.smartchart.SmartChart",{metadata:{library:"sap.ui.comp",designtime:"sap/ui/comp/designtime/smartchart/SmartChart.designtime",properties:{entitySet:{type:"string",group:"Misc",defaultValue:null},smartFilterId:{type:"string",group:"Misc",defaultValue:null},ignoredFields:{type:"string",group:"Misc",defaultValue:null},requestAtLeastFields:{type:"string",group:"Misc",defaultValue:null},ignoreFromPersonalisation:{type:"string",group:"Misc",defaultValue:null},chartType:{type:"string",group:"Misc",defaultValue:null},ignoredChartTypes:{type:"string",group:"Misc",defaultValue:null},useVariantManagement:{type:"boolean",group:"Misc",defaultValue:true},useChartPersonalisation:{type:"boolean",group:"Misc",defaultValue:true},header:{type:"string",group:"Misc",defaultValue:null},headerLevel:{type:"sap.ui.core.TitleLevel",group:"Appearance",defaultValue:ct.Auto},headerStyle:{type:"sap.ui.core.TitleLevel",group:"Appearance",defaultValue:ct.Auto},persistencyKey:{type:"string",group:"Misc",defaultValue:null},currentVariantId:{type:"string",group:"Misc",defaultValue:null},enableAutoBinding:{type:"boolean",group:"Misc",defaultValue:false},chartBindingPath:{type:"string",group:"Misc",defaultValue:null},showDrillButtons:{type:"boolean",group:"Misc",defaultValue:true},showZoomButtons:{type:"boolean",group:"Misc",defaultValue:true},showSemanticNavigationButton:{type:"boolean",group:"Misc",defaultValue:true},showVariantManagement:{type:"boolean",group:"Misc",defaultValue:true},showDownloadButton:{type:"boolean",group:"Misc",defaultValue:false},showDetailsButton:{type:"boolean",group:"Misc",defaultValue:false},showDrillBreadcrumbs:{type:"boolean",group:"Misc",defaultValue:false},showChartTooltip:{type:"boolean",group:"Misc",defaultValue:true},showLegendButton:{type:"boolean",group:"Misc",defaultValue:true},legendVisible:{type:"boolean",group:"Misc",defaultValue:true},selectionMode:{type:"sap.ui.comp.smartchart.SelectionMode",group:"Misc",defaultValue:ut.Multi},showFullScreenButton:{type:"boolean",group:"Misc",defaultValue:true},useTooltip:{type:"boolean",group:"Misc",defaultValue:true},useListForChartTypeSelection:{type:"boolean",group:"Misc",defaultValue:true},showChartTypeSelectionButton:{type:"boolean",group:"Misc",defaultValue:true},noData:{type:"string",group:"Misc",defaultValue:null},showToolbar:{type:"boolean",group:"Misc",defaultValue:true},toolbarStyle:{type:"sap.m.ToolbarStyle",group:"Appearance"},showDimensionsTitle:{type:"boolean",group:"Misc",defaultValue:true},showMeasuresTitle:{type:"boolean",group:"Misc",defaultValue:true},activateTimeSeries:{type:"boolean",group:"Misc",defaultValue:false},notAssignedText:{type:"string",group:"Misc",defaultValue:""}},associations:{smartVariant:{type:"sap.ui.core.Control",multiple:false}},aggregations:{toolbar:{type:"sap.m.Toolbar",multiple:false},semanticObjectController:{type:"sap.ui.comp.navpopover.SemanticObjectController",multiple:false},selectionDetailsItemActions:{type:"sap.ui.core.Item",multiple:true},selectionDetailsActions:{type:"sap.ui.core.Item",multiple:true},selectionDetailsActionGroups:{type:"sap.ui.core.Item",multiple:true}},events:{initialise:{},initialized:{},beforeRebindChart:{},dataReceived:{},afterVariantInitialise:{},afterVariantSave:{parameters:{currentVariantId:{type:"string"}}},afterVariantApply:{parameters:{currentVariantId:{type:"string"},variantContext:{type:"string"}}},showOverlay:{},fullScreenToggled:{parameters:{fullScreen:{type:"boolean"}}},selectionDetailsActionPress:{parameters:{action:{type:"sap.ui.core.Item"},itemContexts:{type:"sap.ui.model.Context"},level:{type:"sap.m.SelectionDetailsActionLevel"}}},chartDataChanged:{parameters:{changeTypes:{type:"object"}}},uiStateChange:{}}},renderer:{apiVersion:2}});wt.prototype.init=function(){p.prototype.init.call(this);this.addStyleClass("sapUiCompSmartChart");this.setFitContainer(true);this._oChartTypeModel=null;var t=new g({items:[]});this.setModel(t,"$smartChartTypes");this._oRb=e.getResourceBundleFor("sap.ui.comp");this._oMDCRb=e.getResourceBundleFor("sap.ui.mdc");if(!this.getLayoutData()){this.setLayoutData(new s({growFactor:1,baseSize:"auto"}))}};wt.prototype._getVariantManagementControl=function(e){var i=null;if(e){if(typeof e==="string"){i=t.getElementById(e)}else{i=e}if(i){if(!(i instanceof f)){U.error("Control with the id="+typeof e.getId=="function"?e.getId():e+" not of expected type");return null}}}return i};wt.prototype._createVariantManagementControl=function(){if(this._oVariantManagement||!this.getUseVariantManagement()&&!this.getUseChartPersonalisation()||!this.getPersistencyKey()){return}var t=new m({type:"chart",keyName:"persistencyKey",dataSource:this.getEntitySet()});t.setControl(this);var e=this.getSmartVariant();if(e){this._oVariantManagement=this._getVariantManagementControl(e)}else if(this._oSmartFilter&&this._oSmartFilter.data("pageVariantPersistencyKey")){e=this._oSmartFilter.getSmartVariant();if(e){this._oVariantManagement=this._getVariantManagementControl(e)}}else{this._oVariantManagement=new f(this.getId()+"-variant",{showShare:true});if(this._headerText){this._oVariantManagement.setShowAsText(!!this._headerText.getText());this._oVariantManagement.setHeaderLevel(this.getHeaderLevel());this._oVariantManagement.setTitleStyle(this.getHeaderStyle())}}if(this._oVariantManagement){if(!this._oVariantManagement.isPageVariant()){this._oVariantManagement.setVisible(this.getShowVariantManagement())}this._oVariantManagement.addPersonalizableControl(t);this._oVariantManagement.attachSave(this._variantSaved,this);this._oVariantManagement.attachAfterSave(this._variantAfterSave,this);this._oVariantManagement.initialise(this._variantInitialised,this)}};wt.prototype._variantInitialised=function(){if(!this._oCurrentVariant){this._oCurrentVariant="STANDARD"}this.fireAfterVariantInitialise();if(this._oVariantManagement&&!this._oVariantManagement.getEnabled()){this._checkAndTriggerBinding()}};wt.prototype._variantSaved=function(){if(this._oPersController){this._oPersController.setPersonalizationData(this._oCurrentVariant,true)}};wt.prototype._variantAfterSave=function(){this.fireAfterVariantSave({currentVariantId:this.getCurrentVariantId()})};wt.prototype.setUseTooltip=function(t){this.setProperty("useTooltip",t,true);this._createTooltipOrPopover();return this};wt.prototype._createTooltipOrPopover=function(){if(this.getUseTooltip()&&this.getShowChartTooltip()){this._toggleChartTooltipVisibility(true)}else{this._createPopover()}};wt.prototype._createPopover=function(){if(this._oChart){if(!Tt&&!this._bVizPopoverRequested){Tt=sap.ui.require("sap/viz/ui5/controls/Popover");if(!Tt){sap.ui.require(["sap/viz/ui5/controls/Popover"],It.bind(this));this._bVizPopoverRequested=true}}if(!this._oPopover&&Tt&&!this._oChart._getVizFrame()._connectPopover){this._oPopover=new Tt({})}if(this._oPopover){this._oPopover.connect(this._oChart.getVizUid())}}};function It(t){Tt=t;this._bVizPopoverRequested=false;if(!this._bIsBeingDestroyed){this._createPopover()}}wt.prototype._destroyPopover=function(){if(this._oPopover){this._oPopover.destroy();this._oPopover=null}};wt.prototype.setUseVariantManagement=function(t){this.setProperty("useVariantManagement",t,true);if(this._oPersController){this._oPersController.setResetToInitialTableState(!t)}return this};wt.prototype.setToolbar=function(t){if(this._oToolbar){this.removeItem(this._oToolbar)}this._oToolbar=t;this._oToolbar.setLayoutData(new s({shrinkFactor:0}));this.insertItem(this._oToolbar,0);this._oToolbar.setVisible(this.getShowToolbar());this._oToolbar.setStyle(this.getToolbarStyle());return this};wt.prototype.getToolbar=function(){return this._oToolbar};wt.prototype.setHeader=function(t){this.setProperty("header",t,true);this._refreshHeaderText();return this};wt.prototype.setHeaderLevel=function(t){this.setProperty("headerLevel",t,true);this._refreshHeaderText();return this};wt.prototype.setHeaderStyle=function(t){this.setProperty("headerStyle",t,true);this._refreshHeaderText();return this};wt.prototype._refreshHeaderText=function(){if(!this._headerText){return}var t=this.getHeader();this._headerText.setText(t);this._headerText.setVisible(!!t);this._headerText.setLevel(this.getHeaderLevel());this._headerText.setTitleStyle(this.getHeaderStyle());if(this._oVariantManagement&&!this._oVariantManagement.isPageVariant()){this._oVariantManagement.setShowAsText(!!t);this._oVariantManagement.setHeaderLevel(this.getHeaderLevel());this._oVariantManagement.setTitleStyle(this.getHeaderStyle())}this._oSeparator?.setVisible(!!t)};wt.prototype._createToolbar=function(){if(!this._oToolbar){this._oToolbar=new n(this.getId()+"__toolbar",{design:rt[et.get({name:"_sap_ui_comp_SmartChart_ToolbarDesign"})]});this._oToolbar.addStyleClass("sapUiCompSmartChartToolbar");this._oToolbar.addStyleClass("sapMTBHeader-CTX");this._oToolbar.setLayoutData(new s({shrinkFactor:0}));this.insertItem(this._oToolbar,0);this._oToolbar.setVisible(this.getShowToolbar());this._oToolbar.setStyle(this.getToolbarStyle())}};wt.prototype.onThemeChanged=function(){if(this._oToolbar){const t=rt[et.get({name:"_sap_ui_comp_SmartChart_ToolbarDesign"})];this._oToolbar.setDesign(t)}};wt.prototype._createToolbarContent=function(){this._addVariantManagementToToolbar();this._addSeparatorToToolbar();this._addHeaderToToolbar();this._addSpacerToToolbar();this._addSemanticNavigationButton();this._addDetailsButton();this._addDrillUpDownButtons();this._addLegendButton();this._addZoomInOutButtons();this._addDownloadButton();this._addPersonalisationToToolbar();this._addFullScreenButton();this._addChartTypeToToolbar();if(this._oToolbar&&(this._oToolbar.getContent().length===0||this._oToolbar.getContent().length===1&&this._oToolbar.getContent()[0]instanceof c)){this.removeItem(this._oToolbar);this._oToolbar.destroy();this._oToolbar=null}};wt.prototype.setShowVariantManagement=function(t){this.setProperty("showVariantManagement",t);if(this._oVariantManagement&&this._oVariantManagement.isPageVariant()){this._oVariantManagement.setVisible(t)}return this};wt.prototype.setShowDetailsButton=function(t){this.setProperty("showDetailsButton",t);if(this._oSelectionDetails){this._oSelectionDetails.setVisible(t);if(this._oDrillDownTextButton){this._oDrillDownTextButton.setVisible(t)}this._setBehaviorTypeForDataSelection()}if(this._oDrillDownButton){this._oDrillDownButton.setVisible(!t)}return this};wt.prototype.setShowChartTypeSelectionButton=function(t){this.setProperty("showChartTypeSelectionButton",t);if(this._oChartTypeButton){this._oChartTypeButton.setVisible(t)}return this};wt.prototype.setShowDownloadButton=function(t){this.setProperty("showDownloadButton",t);if(this._oDownloadButton){this._oDownloadButton.setVisible(t)}return this};wt.prototype.setShowDrillBreadcrumbs=function(t){this.setProperty("showDrillBreadcrumbs",t);if(this._oDrillBreadcrumbs){this._oDrillBreadcrumbs.setVisible(t)}if(this._oDrillUpButton){this._oDrillUpButton.setVisible(!t)}return this};wt.prototype.setShowChartTooltip=function(t){this.setProperty("showChartTooltip",t);this._toggleChartTooltipVisibility(t);return this};wt.prototype._setBehaviorTypeForDataSelection=function(){if(this.getShowDetailsButton()){this._oChart.setVizProperties({interaction:{behaviorType:"noHoverBehavior"}})}else if(this._oChart.getVizProperties().interaction.behaviorType){var t=this._oChart.getVizProperties().interaction;delete t.behaviorType;this._oChart.setVizProperties({interaction:t})}};wt.prototype._addDrillBreadcrumbs=function(){if(!this._oDrillBreadcrumbs&&this.getShowDrillBreadcrumbs()&&!this._bDoFullyInitializeChart){if(this._oChart){this._oDrillBreadcrumbs=tt.createDrillBreadcrumbs(this.getId(),{visible:this.getShowDrillBreadcrumbs(),linkPressed:function(t){const e=t.getParameter("index");this._oChart.drillUp(e+1);this._oChart.fireDeselectData(t);this._updateDrillBreadcrumbs()}.bind(this)}).addStyleClass("sapUiCompSmartChartBreadcrumbs");this.insertItem(this._oDrillBreadcrumbs,1);this._updateDrillBreadcrumbs();this._oChart.attachDrilledUp(function(t){this._updateDrillBreadcrumbs()}.bind(this));this._oChart.attachDrilledDown(function(t){this._updateDrillBreadcrumbs()}.bind(this))}}};wt.prototype.getDrillStackFilters=function(){var t=this._oChart.getDrillStack();var e=[];var i=function(t){if(!t){return}if(t&&t.sPath&&t.sOperator){e.push(t)}if(t.aFilters){t.aFilters.forEach(function(t){i(t)})}};t.forEach(function(t){i(t.filter)});return e};wt.prototype._getDrillStackDimensions=function(){var t=this._oChart.getDrillStack();var e=[];t.forEach(function(t){t.dimension.forEach(function(t){if(t!=null&&t!=""&&e.indexOf(t)==-1){e.push(t)}})});return e};wt.prototype._updateDrillBreadcrumbs=function(){if(!this._oDrillBreadcrumbs||!this.getShowDrillBreadcrumbs()){return}const t=this._oChart.getDrillStack();const e=[];let i=true;if(t){t.forEach(function(t,a){const r=t.dimension.length;const o=t.dimension[r-1];const s=this._oChart.getDimensionByName(o);if(r>0&&typeof s!="undefined"){const t=s.getLabel();e.push({key:o,text:t});i=true}else if(a==0){this._oDrillBreadcrumbs.setVisible(false);i=false}}.bind(this))}if(i){this._oDrillBreadcrumbs.update(e)}};wt.prototype._addDetailsButton=function(){this._oSelectionDetails=new V(this.getId()+"-selectionDetails",{visible:this.getShowDetailsButton(),customData:[new j({key:"sap-ui-custom-settings",value:{"sap.ui.dt":{designtime:"sap/ui/comp/designtime/smartchart/SmartChartDetails.designtime"}}})]});this._oSelectionDetails.registerSelectionDetailsItemFactory([],function(t,e,i,a){var r=[];var o=function(t){if(t){return t instanceof Object?t:t.toString()}else{return t}};for(var s=0;s<t.length;s++){r.push(new M({label:t[s].label,value:o(t[s].value),unit:t[s].unit}))}return new P({enableNav:function(){if(this._determineSemanticObjectsforDetailsPopover(e,i).length>0){return true}else{return false}}.bind(this)(),lines:r}).setBindingContext(i)}.bind(this));this._oSelectionDetails.attachNavigate(function(t){if(t.getParameter("direction")==="back"){t.getParameter("content").destroy()}else{this._navigateToSemanticObjectDetails(t)}}.bind(this));this._oSelectionDetails.attachActionPress(function(t){var e=[];t.getParameter("items").forEach(function(t){e.push(t.getBindingContext())});this.fireSelectionDetailsActionPress({id:t.getParameter("id"),action:t.getParameter("action"),itemContexts:e,level:t.getParameter("level")})}.bind(this));this._oSelectionDetails.attachBeforeOpen(function(t){var e=this._oSelectionDetails.getItems();e.forEach(function(t){var e=this._getDetailsActionsClones();e.selectionDetailsItemActions.forEach(function(e){t.addAction(e)})}.bind(this));var i=this._getDetailsActionsClones().selectionDetailsActions;this._oSelectionDetails.removeAllActions();i.forEach(function(t){this._oSelectionDetails.addAction(t)}.bind(this));var a=this._getDetailsActionsClones().selectionDetailsActionGroups;this._oSelectionDetails.removeAllActionGroups();a.forEach(function(t){this._oSelectionDetails.addActionGroup(t)}.bind(this))}.bind(this));this._oSelectionDetails.attachBeforeClose(function(t){this._oSelectionDetails.setPopoverModal(false);if(this._oPanel){this._oPanel.destroy()}}.bind(this));this._oToolbar.addContent(this._oSelectionDetails);this._addDrillDownTextButton()};wt.prototype._getDetailsActionsClones=function(){var t={selectionDetailsItemActions:[],selectionDetailsActions:[],selectionDetailsActionGroups:[]};this.getSelectionDetailsItemActions().forEach(function(e){t.selectionDetailsItemActions.push(e.clone())});this.getSelectionDetailsActions().forEach(function(e){t.selectionDetailsActions.push(e.clone())});this.getSelectionDetailsActionGroups().forEach(function(e){t.selectionDetailsActionGroups.push(e.clone())});return t};wt.prototype._addDownloadButton=function(){if(!this._oDownloadButton){this._oDownloadButton=new l(this.getId()+"btnDownload",{type:"Transparent",text:this._oRb.getText("CHART_DOWNLOADBTN_TEXT"),tooltip:this._oRb.getText("CHART_DOWNLOADBTN_TOOLTIP"),icon:"sap-icon://download",visible:this.getShowDownloadButton(),enabled:false,press:function(t){if(window.navigator&&window.navigator.msSaveOrOpenBlob){var e=new window.Blob([this._getVizFrame().exportToSVGString()],{type:"image/svg+xml"});window.navigator.msSaveOrOpenBlob(e)}else{this._downloadChartPNG()}}.bind(this)});this._oToolbar.addContent(this._oDownloadButton)}};wt.prototype._downloadChartSVG=function(){var t=this.getHeader();var e=document.createElement("a");e.setAttribute("href","data:image/svg+xml,"+encodeURIComponent(this._getVizFrame().exportToSVGString()));e.setAttribute("download",t?t:"Chart"+".svg");e.click()};wt.prototype._downloadChartPNG=function(){var t=this.getHeader();var e=this._getVizFrame().exportToSVGString();var i=document.createElement("canvas");var a=i.getContext("2d");var r=new Image;r.width=i.width=document.getElementById(this._oChart.getId()).offsetWidth;r.height=i.height=document.getElementById(this._oChart.getId()).offsetHeight;r.onload=function(){a.drawImage(r,0,0);var e=document.createElement("a");e.setAttribute("href",i.toDataURL());e.setAttribute("download",t?t:"Chart"+".png");e.click()};r.setAttribute("crossOrigin","anonymous");r.src="data:image/svg+xml,"+encodeURIComponent(e)};wt.prototype._addFullScreenButton=function(){var t;if(this.getShowFullScreenButton()){t=new l(this.getId()+"-btnFullScreen",{type:"Transparent",press:function(){this._toggleFullScreen(!this.bFullScreen)}.bind(this),enabled:false});this.oFullScreenButton=t;this._renderFullScreenButton();this._oToolbar.addContent(t)}};wt.prototype._addZoomInOutButtons=function(){const t=this.getId();this._oZoomInButton=tt.createZoomInBtn(t,{visible:this.getShowZoomButtons(),enabled:false,press:function(t){if(this._oChart){this._oChart.zoom({direction:"in"});this._oZoomInPressed=true;this._toggleZoomButtonEnablement()}}.bind(this)});this._oZoomOutButton=tt.createZoomOutBtn(t,{visible:this.getShowZoomButtons(),enabled:false,press:function(t){if(this._oChart){this._oChart.zoom({direction:"out"});this._oZoomOutPressed=true;this._toggleZoomButtonEnablement()}}.bind(this)});this._oToolbar.addContent(this._oZoomInButton);this._oToolbar.addContent(this._oZoomOutButton)};wt.prototype._toggleZoomButtonEnablement=function(){var t=this._oChart.getZoomInfo().currentZoomLevel;if(t===undefined){return}else if(t===null){this._oZoomOutButton.setEnabled(false);this._oZoomInButton.setEnabled(false)}else if(t===0){if(this._oZoomOutPressed){this._oZoomInButton.focus();this._oZoomOutPressed=false}this._oZoomOutButton.setEnabled(false);this._oZoomInButton.setEnabled(true)}else if(t===1){if(this._oZoomInPressed){this._oZoomOutButton.focus();this._oZoomInPressed=false}this._oZoomInButton.setEnabled(false);this._oZoomOutButton.setEnabled(true)}else{if(this._oZoomOutButton.getEnabled()==false){this._oZoomOutButton.setEnabled(true)}if(this._oZoomInButton.getEnabled()==false){this._oZoomInButton.setEnabled(true)}}};wt.prototype.setShowZoomButtons=function(t){this.setProperty("showZoomButtons",t);if(this._oZoomInButton){this._oZoomInButton.setVisible(t)}if(this._oZoomOutButton){this._oZoomOutButton.setVisible(t)}return this};wt.prototype.setShowFullScreenButton=function(t){this.setProperty("showFullScreenButton",t);if(this.oFullScreenButton){this.oFullScreenButton.setVisible(t)}return this};wt.prototype.setLegendVisible=function(t){this.setProperty("legendVisible",t);this._setLegendVisible(t);return this};wt.prototype._setLegendVisible=function(t){var e=this._getVizFrame();if(e){e.setLegendVisible(t)}};wt.prototype._getVizFrame=function(){var t=null;if(this._oChart){t=this._oChart.getAggregation("_vizFrame")}return t};wt.prototype._addLegendButton=function(){const t=this.getId();this._oLegendButton=tt.createLegendBtn(t,{visible:this.getShowLegendButton(),enabled:false,press:function(){this.setLegendVisible(!this.getLegendVisible())}.bind(this),pressed:this.getLegendVisible()});this._oToolbar.addContent(this._oLegendButton)};wt.prototype.setShowLegendButton=function(t){this.setProperty("showLegendButton",t);if(this._oLegendButton){this._oLegendButton.setVisible(t)}return this};wt.prototype.setShowSemanticNavigationButton=function(t){this.setProperty("showSemanticNavigationButton",t);if(this._oSemanticalNavButton){this._oSemanticalNavButton.setVisible(t)}else{if(t){this._addSemanticNavigationButton()}}return this};wt.prototype._addSemanticNavigationButton=function(){var e=this;if(!this._oSemanticalNavButton&&this.getShowSemanticNavigationButton()&&this._oToolbar){this._oSemanticalNavButton=new r(this.getId()+"-btnNavigation",{type:"Transparent",text:this._oRb.getText("CHART_SEMNAVBTN"),tooltip:this._oRb.getText("CHART_SEMNAVBTN_TOOLTIP"),visible:this.getShowSemanticNavigationButton(),enabled:false});this._oSmartLink=new O({navigationTargetsObtainedCallback:function(e){const i=e.mainNavigation;if(i){const a=t.getElementById(e.originalId);const r=a.getBindingContext();const o=r.getObject();const s=this._getField(a.getFieldName());const n=I.getTextsFromDisplayBehaviour(s.displayBehaviour,o[s.name],o[s.description]);i.setDescription(n.secondText);return Promise.resolve({mainNavigationId:n.firstText,mainNavigation:i})}return Promise.resolve()}});var i=this.getSemanticObjectController();if(i){this._oSmartLink.setSemanticObjectController(i)}this._oSemanticalNavButton.attachPress(t=>{if(this._aSemanticObjects&&this._aSemanticObjects.length>0){if(this._aSemanticObjects.length===1){var i=D.getSemanticObjectsFromProperty(this._aSemanticObjects[0]);if(i){this._oSmartLink.setFieldName(this._aSemanticObjects[0].name);this._oSmartLink.setSemanticObject(i.defaultSemanticObject);this._oSmartLink.setAdditionalSemanticObjects(i.additionalSemanticObjects);this._oSmartLink.getFieldInfo().open(this._oSemanticalNavButton,t)}}else{e._semanticObjectList(this._aSemanticObjects,this._oSmartLink)}}});if(this._oChart){this._attachDataPointHandling()}else{this.attachInitialized(function(){this._attachDataPointHandling()}.bind(this))}var a=this._indexOfSpacerOnToolbar();this._oToolbar.insertContent(this._oSemanticalNavButton,a+1)}};wt.prototype._attachDataPointHandling=function(){if(this._oChart){this._oChart.attachDeselectData(function(){this._aSemanticObjects=this._setSelectionDataPointHandling(this._oSmartLink)}.bind(this));this._oChart.attachSelectData(function(){this._aSemanticObjects=this._setSelectionDataPointHandling(this._oSmartLink)}.bind(this))}};wt.prototype.setSelectionMode=function(t){this.setProperty("selectionMode",t);if(this._oChart){this._oChart.setSelectionMode(t)}return this};wt.prototype._setSelectionDataPointHandling=function(t){var e=this._setSelectionDataPoint(t);if(e&&e.length>0){this._oSemanticalNavButton.setEnabled(true)}else{this._oSemanticalNavButton.setEnabled(false)}return e};wt.prototype._setSemanticObjectsContext=function(t){var e,i,a=null;e=t.getParameter("item").getBindingContext();if(e){i=e.getObject();if(i){a=this._determineSemanticObjectsforDetailsPopover(i,e)}}return a};wt.prototype._setSelectionDataPoint=function(t){var e,i,a=null,r;var o=this._oChart.getSelectedDataPoints();if(!o||!o.dataPoints||o.dataPoints.length===0){return a}if(o.dataPoints.length===1){e=o.dataPoints[0].context;if(e){i=e.getObject();if(i){a=this._determineSemanticObjects(i,e);if(a&&a.length>0){t.setBindingContext(e)}}}return a}r=[];for(var s=0;s<o.dataPoints.length;s++){e=o.dataPoints[s].context;if(e){i=e.getObject();if(i){r.push(i)}}}if(r&&r.length>0){a=this._condensBasedOnSameValue(r);if(a&&a.length>0){t.setBindingContext(o.dataPoints[o.dataPoints.length-1].context)}}return a};wt.prototype._condensBasedOnSameValue=function(t){var e=null,i,a,r;e=this._determineSemanticObjects(t[0]);if(e&&e.length>0){for(var o=0;o<e.length;o++){a=e[o];r=a.name;if(this._bAllValuesAreEqual(t,r)){if(!i){i=[]}i.push(a)}}e=i}return e};wt.prototype._bAllValuesAreEqual=function(t,e){var i,a;for(var r=0;r<t.length;r++){i=t[r];if(r===0){a=i[e];continue}if(a!=i[e]){return false}}return true};wt.prototype._semanticObjectList=function(t,e){var i,a,r,o;if(this._oChart){if((!Dt||!Bt||!Vt)&&!this._bSemanticObjectListRequested){Dt=sap.ui.require("sap/m/ResponsivePopover");Bt=sap.ui.require("sap/m/List");Vt=sap.ui.require("sap/m/StandardListItem");if(!Dt||!Bt||!Vt){sap.ui.require(["sap/m/ResponsivePopover","sap/m/List","sap/m/StandardListItem"],Ot.bind(this));this._bSemanticObjectListRequested=true;this._oSemanticObjectListAttr={object:t,nav:e}}}if(!Dt||!Bt||!Vt){return}a=new Bt({mode:ot.SingleSelectMaster,selectionChange:t=>{if(t&&t.mParameters&&t.mParameters.listItem){var a=t.mParameters.listItem.data("semObj");if(a){e.setFieldName(t.mParameters.listItem.data("fieldName"));e.setSemanticObject(a.defaultSemanticObject);e.setAdditionalSemanticObjects(a.additionalSemanticObjects);e.getFieldInfo().open(this._oSemanticalNavButton,t)}}i.close()}});for(var s=0;s<t.length;s++){o=t[s];r=new Vt({title:o.fieldLabel,type:st.Active});r.data("semObj",D.getSemanticObjectsFromProperty(o));r.data("fieldName",o.name);a.addItem(r)}i=new Dt({title:this._oRb.getText("CHART_SEMNAVBTN"),showHeader:false,contentWidth:"12rem",placement:nt.Left});i.addContent(a);i.openBy(this._oSemanticalNavButton)}};function Ot(t,e,i){Dt=t;Bt=e;Vt=i;this._bSemanticObjectListRequested=false;if(!this._bIsBeingDestroyed){this._semanticObjectList(this._oSemanticObjectListAttr.object,this._oSemanticObjectListAttr.nav)}delete this._oSemanticObjectListAttr}wt.prototype._semanticObjectListForDetails=function(t,e){var i,a,r;if(!this._oChart){return undefined}i=new Bt({mode:ot.SingleSelectMaster,rememberSelections:false,itemPress:function(t){if(t&&t.mParameters&&t.mParameters.listItem){var i=t.mParameters.listItem.data("semObj");if(i){const a=t.mParameters.listItem.data("fieldName");this._createSemanticObjectDetails(a,e,i)}}}.bind(this)});N.getDistinctSemanticObjects().then(function(o){for(var s=0;s<t.length;s++){r=t[s];if(r["com.sap.vocabularies.Common.v1.SemanticObject"]&&r["com.sap.vocabularies.Common.v1.SemanticObject"].String&&N.hasDistinctSemanticObject([r["com.sap.vocabularies.Common.v1.SemanticObject"].String],o)){a=new Vt({title:r.fieldLabel,type:st.Navigation});a.setBindingContext(e);a.data("semObj",D.getSemanticObjectsFromProperty(r));a.data("fieldName",r.name);i.addItem(a)}}});return i};wt.prototype._determineSemanticObjects=function(t,e){var i,a,r=[];if(t){for(i in t){if(i){a=this._getField(i);if(a&&a.isDimension&&a.isSemanticObject){r.push(a)}}}}if(r){r.sort(function(t,e){return t.fieldLabel.localeCompare(e.fieldLabel)})}return r};wt.prototype._determineSemanticObjectsforDetailsPopover=function(t,e){var i,a,r=[];if(t){for(i in t){if(i){a=this._getField(i);if(a&&a.isDimension&&a.isSemanticObject){r.push(a)}}}}if(r){r.sort(function(t,e){return t.fieldLabel.localeCompare(e.fieldLabel)})}return r};wt.prototype._addDrillUpDownButtons=function(){if(this.getShowDrillButtons()){this._oDrillUpButton=new l(this.getId()+"-btnDrillUp",{type:"Transparent",tooltip:this._oRb.getText("CHART_DRILLUPBTN_TOOLTIP"),text:this._oRb.getText("CHART_DRILLUPBTN_TEXT"),icon:"sap-icon://drill-up",press:function(){if(this._oChart){this._oChart.drillUp()}}.bind(this),visible:!this.getShowDrillBreadcrumbs(),enabled:false});const t=this.getId();this._oDrillDownButton=tt.createDrillDownBtn(t,{visible:!this.getShowDetailsButton(),enabled:false,display:J.Icon,icon:"sap-icon://drill-down",beforeOpen:this._prepareDrillDown.bind(this),itemSelected:this._performDrillDown.bind(this)});this._oToolbar.addContent(this._oDrillUpButton);this._oToolbar.addContent(this._oDrillDownButton)}};wt.prototype._addDrillDownTextButton=function(){this._oDrillDownTextButton=tt.createDrillDownBtn(this.getId()+"-btnDrillDownText",{visible:this.getShowDetailsButton(),enabled:false,beforeOpen:this._prepareDrillDown.bind(this),itemSelected:this._performDrillDown.bind(this)});this._oToolbar.addContent(this._oDrillDownTextButton)};wt.prototype.setShowDrillButtons=function(t){this.setProperty("showDrillButtons",t);if(this._oDrillUpButton){this._oDrillUpButton.setVisible(t)}if(this._oDrillDownButton){this._oDrillDownButton.setVisible(t)}return this};wt.prototype._triggerSearchInPopover=function(t,e){if(!t||!e){return}var i=t.getParameter("newValue");var a=[];if(i){a=new C("text","Contains",i)}e.getBinding("items").filter(a)};wt.prototype._prepareDrillDown=function(t){const e=t.getSource();const i=new X({key:"{$smartChartDrilldown>text}",text:"{$smartChartDrilldown>text}"});const a=this._getDrillStackDimensions();const r=this._getSortedDimensions();var o={items:[]};for(var s=0;s<r.length;s++){const t=r[s];if(a.indexOf(t.getName())>-1){continue}const e=this._oChartProvider.getViewField(t.getName());if(!e.filterable&&this._oChart.getSelectedDataPoints().count>0){continue}o.items.push({text:t.getLabel()})}const n=new g;n.setSizeLimit(1e3);n.setData(o);e.setModel(n,"$smartChartDrilldown");e.bindAggregation("items",{path:"$smartChartDrilldown>/items",template:i});e.setSelectedItemKey("");e.setSearchEnabled(e.getModel("$smartChartDrilldown").getData().items.length>7)};wt.prototype._performDrillDown=function(t){const e=t.getParameter("item").key;var i=this._getSortedDimensions();var a=i.filter(function(t){return t.getLabel()===e});var r=a.length===1?a[0]:null;if(r){this._oChart.drillDown(r)}};wt.prototype._updateDrillDownTextButton=function(){const t=this._oChart.getDimensions().length;const e=this._oChart.getVisibleDimensions().length;this._oDrillDownTextButton.setEnabled(!(t==0||t==e))};wt.prototype._navigateToSemanticObjectDetails=function(t){var e=this._setSemanticObjectsContext(t);if(e&&e.length>0){if(e.length===1){var i=D.getSemanticObjectsFromProperty(e[0]);if(i){var a=t.getParameter("item");this._createSemanticObjectDetails(e[0].name,a.getBindingContext(),i)}}else{var r=t.getParameter("item").getBindingContext();if((!Bt||!Vt)&&!this._bObjectListRequested){Bt=sap.ui.require("sap/m/List");Vt=sap.ui.require("sap/m/StandardListItem");if(!Bt||!Vt){sap.ui.require(["sap/m/List","sap/m/StandardListItem"],At.bind(this));this._bObjectListRequested=true;this._oObjectListAttr={context:r,objects:e}}}if(Bt&&Vt){var o=this._semanticObjectListForDetails(e,r);this._oSelectionDetails.navTo(this._oRb.getText("CHART_SEMNAVBTN"),o)}}}};wt.prototype._createSemanticObjectDetails=async function(t,e,i){const a=new O({fieldName:t,semanticObject:i.defaultSemanticObject,additionalSemanticObjects:i.additionalSemanticObjects,navigationTargetsObtainedCallback:function(i){const a=i.mainNavigation;if(a){var r=e.getObject();var o=this._getField(t);var s=I.getTextsFromDisplayBehaviour(o.displayBehaviour,r[o.name],r[o.description]);a.setDescription(s.secondText);return Promise.resolve({mainNavigationId:s.firstText,mainNavigation:a})}return Promise.resolve()}});a.setParent(this);try{const t=await a.getFieldInfo().getContent();this._oPanel=t;const e=await a.getFieldInfo().checkDirectNavigation({getSource:()=>{}});if(e){t.destroy()}else{t.attachBeforeSelectionDialogOpen(()=>{this._oSelectionDetails.setPopoverModal(true)});t.attachAfterSelectionDialogClose(()=>{this._oSelectionDetails.setPopoverModal(false)});this._oSelectionDetails.navTo("",t)}}catch(t){U.error("NavigationContainer could not be determined: "+t)}};function At(t,e){Bt=t;Vt=e;this._bObjectListRequested=false;if(!this._bIsBeingDestroyed){var i=this._semanticObjectListForDetails(this._oObjectListAttr.objects,this._oObjectListAttr.context);this._oSelectionDetails.navTo(this._oRb.getText("CHART_SEMNAVBTN"),i)}delete this._oObjectListAttr}wt.prototype._addHeaderToToolbar=function(){if(this._oToolbar){if(!this._headerText){this._headerText=new w({})}this._refreshHeaderText();this._oToolbar.insertContent(this._headerText,0)}};wt.prototype._addSeparatorToToolbar=function(){if(this.getUseVariantManagement()&&this._oVariantManagement&&!this._oVariantManagement.isPageVariant()){this._oSeparator=new u;this._oToolbar.insertContent(this._oSeparator,0);if(!this._oToolbar.getHeight()){this._oToolbar.setHeight("auto")}}else if(this._oSeparator){this._oToolbar.removeContent(this._oSeparator)}};wt.prototype._addVariantManagementToToolbar=function(){if(this._oVariantManagement&&!this._oVariantManagement.isPageVariant()){if(this.getUseVariantManagement()){this._oToolbar.insertContent(this._oVariantManagement,0)}else if(this._oVariantManagement){this._oToolbar.removeContent(this._oVariantManagement)}}};wt.prototype._addSpacerToToolbar=function(){if(this._indexOfSpacerOnToolbar()===-1){this._oToolbar.addContent(new c)}};wt.prototype._indexOfSpacerOnToolbar=function(){var t=this._oToolbar.getContent(),e,i;if(t){i=t.length;e=0;for(e;e<i;e++){if(t[e]instanceof c){return e}}}return-1};wt.prototype._getP13NSettings=function(){return{dimeasure:{visible:true,payload:{availableChartTypes:this.getAvailableChartTypes()}},sort:{visible:true},filter:{visible:true},contentWidth:"48rem"}};wt.prototype._addPersonalisationToToolbar=function(){if(this.getUseChartPersonalisation()){if(!this._oChartPersonalisationButton){this._oChartPersonalisationButton=tt.createSettingsBtn(this.getId(),{enabled:false,press:function(t){if(this._oPersController){this._oPersController.openDialog(this._getP13NSettings())}}.bind(this)})}this._oToolbar.addContent(this._oChartPersonalisationButton)}else if(this._oChartPersonalisationButton){this._oToolbar.removeContent(this._oChartPersonalisationButton)}};wt.prototype.onkeydown=function(t){if(t.isMarked()){return}if((t.metaKey||t.ctrlKey)&&t.which===G.COMMA){var e=this._oChartPersonalisationButton;if(e&&e.getVisible()&&e.getEnabled()){e.firePress();t.setMarked();t.preventDefault()}}};wt.prototype.getVariantManagement=function(){return this._oVariantManagement};wt.prototype.openDialogForKeyUser=function(t,e){this._fGetDataForKeyUser=e;var i=this._getP13NSettings();i.styleClass=t;i.showReset=false;if(!this._oPersController){this._bDoFullyInitializeChart=true;this.getChartAsync().then(function(){this._oPersController.openDialog(i);this._oPersController.attachDialogAfterClose(function(t){delete this._bDoFullyInitializeChart;this._bFullyInitialzeChart=true}.bind(this))}.bind(this))}else{this._oPersController.openDialog(i)}};wt.prototype._cleanUpKeyUser=function(){this._fGetDataForKeyUser=null};wt.prototype._createKeyUserChange=function(){return[{selectorControl:this._oVariantManagement._getPersoController(),changeSpecificData:{changeType:"variantContent",content:{key:this._oVariantManagement.getSelectionKey(),persistencyKey:this.getPersistencyKey(),content:this.fetchVariant()}}}]};wt.prototype._addChartTypeToToolbar=function(){this._oChartTypeButton=this._createChartTypeButton();this._oToolbar.addContent(this._oChartTypeButton)};wt.prototype._createChartTypeButton=function(){const t=this.getId();var e=tt.createChartTypeBtn(t,{visible:this.getShowChartTypeSelectionButton(),enabled:false,selectedItemKey:this.getChartType(),beforeOpen:function(t){const e=t.getSource();const i=new X({key:"{$smartChartTypes>key}",text:"{$smartChartTypes>text}",icon:"{$smartChartTypes>icon}"});e.setModel(this.getModel("$smartChartTypes"),"$smartChartTypes");e.bindAggregation("items",{path:"$smartChartTypes>/items",template:i});e.setSearchEnabled(e.getModel("$smartChartTypes").getData().items.length>7)}.bind(this),itemSelected:function(t){const e=t.getParameter("item").key;this._setChartType(e)}.bind(this)});return e};var Ft={bar:"sap-icon://horizontal-bar-chart",bullet:"sap-icon://horizontal-bullet-chart",bubble:"sap-icon://bubble-chart",column:"sap-icon://vertical-bar-chart",combination:"sap-icon://business-objects-experience",dual_bar:"sap-icon://horizontal-bar-chart",dual_column:"sap-icon://vertical-bar-chart",dual_combination:"sap-icon://business-objects-experience",dual_horizontal_combination:"sap-icon://business-objects-experience",dual_horizontal_stacked_combination:"sap-icon://business-objects-experience",dual_line:"sap-icon://line-chart",dual_stacked_bar:"sap-icon://full-stacked-chart",dual_stacked_column:"sap-icon://vertical-stacked-chart",dual_stacked_combination:"sap-icon://business-objects-experience",donut:"sap-icon://donut-chart",heatmap:"sap-icon://heatmap-chart",horizontal_stacked_combination:"sap-icon://business-objects-experience",line:"sap-icon://line-chart",pie:"sap-icon://pie-chart",scatter:"sap-icon://scatter-chart",stacked_bar:"sap-icon://full-stacked-chart",stacked_column:"sap-icon://vertical-stacked-chart",stacked_combination:"sap-icon://business-objects-experience",treemap:"sap-icon://Chart-Tree-Map",vertical_bullet:"sap-icon://vertical-bullet-chart","100_dual_stacked_bar":"sap-icon://full-stacked-chart","100_dual_stacked_column":"sap-icon://vertical-stacked-chart","100_stacked_bar":"sap-icon://full-stacked-chart","100_stacked_column":"sap-icon://full-stacked-column-chart",waterfall:"sap-icon://vertical-waterfall-chart",horizontal_waterfall:"sap-icon://horizontal-waterfall-chart"};wt.prototype._rerenderControlInFullscreen=function(){if(this.bFullScreen){this._oChart.setLayoutData(new s({baseSize:"100%"}))}};wt.prototype._getMatchingIcon=function(t){var e=Ft[t];if(!e){e=""}return e};wt.prototype._enrichPassedButton=function(t,e,i){if(!t){return}if(i===undefined){i=e;var a=this._retrieveChartTypeDescription(e);if(a&&a.text){i=a.text}}t.data("chartType",e);var r=this._getMatchingIcon(e);t.setIcon(r?r:"sap-icon://vertical-bar-chart");var o=this._oChart.getChartType()===e?"CHART_TYPE_TOOLTIP":"CHART_TYPE_UNSEL_TOOLTIP";t.setTooltip(this._oRb.getText(o,[i]))};wt.prototype._updateAvailableChartType=function(){var t=this,e,i,a=[];e=this.getModel("$smartChartTypes");if(!e){return}i={items:a};var r=this._oChart.getChartType();this.getAvailableChartTypes().forEach(function(e){var i={key:e.key,text:e.text,icon:t._getMatchingIcon(e.key),selected:r===e.key};a.push(i)});e.setData(i);if(this._oSegmentedButton){this._updateVisibilityOfChartTypes(this._oSegmentedButton)}this._updateVizTooltipFormatter()};wt.prototype._createPersonalizationController=function(){if(this._oPersController){return}var e=this.data("p13nDialogSettings");if(typeof e==="string"){try{e=JSON.parse(e)}catch(t){e=null}}e=this._setIgnoreFromPersonalisationToSettings(e);e=e||{};var i=R.createChartWrapper(this._oChart,this._oChart.data("p13nData"),this._aColumnKeysOrdered);if(this.$()&&this.$().closest(".sapUiSizeCompact").length>0){this._oChart.addStyleClass("sapUiSizeCompact")}this._oPersController=new L(this.getId()+"-persoController",{table:i,setting:e,resetToInitialTableState:!this.getUseVariantManagement(),afterP13nModelDataChange:this._personalisationModelDataChange.bind(this)});this._oPersController.attachDialogConfirmedReset(function(){if(this._oDrillBreadcrumbs){this._updateDrillBreadcrumbs()}var e=t.getElementById(this.getId()+"-btnChartType");if(e){this._enrichPassedButton(e,this._oChart.getChartType())}}.bind(this));this._oPersController.attachDialogAfterClose(function(t){if(this._fGetDataForKeyUser){if(t.getParameter("cancel")){this._fGetDataForKeyUser([])}this._cleanUpKeyUser()}}.bind(this))};wt.prototype._setIgnoreFromPersonalisationToSettings=function(t){var e=v.createArrayFromString(this.getIgnoreFromPersonalisation());if(e.length){if(!t){t={}}var i=function(i){if(!t[i]){t[i]={}}t[i].ignoreColumnKeys=e};i("dimeasure");i("filter");i("sort")}return t};wt.prototype._personalisationModelDataChange=function(t){this._oCurrentVariant=t.getParameter("persistentData");if(this._fGetDataForKeyUser){this._fGetDataForKeyUser(this._createKeyUserChange())}var e=t.getParameter("runtimeDeltaDataChangeType");var i=this._getChangeStatus(e);if(i===lt.Unchanged){return}this._fireChartDataChanged(e);if(!this._bApplyingVariant){if(!this.getUseVariantManagement()){this._persistPersonalisation()}else if(this._oVariantManagement){this._oVariantManagement.currentVariantSetModified(true)}}this._updateAvailableChartType();this._toggleIllustratedMessage();this._enrichPassedButton(this._oChartTypeButton,this._oChart.getChartType());this._updateDrillDownTextButton();this._checkDimensionColoring();if(this.getActivateTimeSeries()&&!this._bDisableTimeseriesUTC&&!this._oChart.getVizProperties().general.showAsUTC){try{if(!this._oChart.getVizProperties().general.showAsUTC){this._oChart.setVizProperties({general:{showAsUTC:true}})}if(this._bWorkaroundVizFormatter){this._oChart.setVizProperties({timeAxis:{levelConfig:{day:{visible:true,formatString:"MediumDay"},month:{visible:true,formatString:"MediumMonth"}}}})}}catch(t){U.error("Couldn't set showAsUTC=true")}}if(i===lt.TableChanged){if(this._oSemanticalNavButton){this._oSemanticalNavButton.setEnabled(false)}}else if(i===lt.ModelChanged&&this._isChartBound()){if(this._oSmartFilter){this._oSmartFilter.search()}else{this._reBindChart()}}if(this._oDrillBreadcrumbs){this._updateDrillBreadcrumbs()}this.fireUiStateChange()};wt.prototype._toggleIllustratedMessage=function(){this._bInvalidChartType=false;if(!this._oChart?.getBlocked()){const t=this._oVBox;const e=this._oChart.getAvailableChartTypes().unavailable;const i=this._oChart.getChartType();const a=e.findIndex(t=>t.chart===i);if(a!==-1){t?.setVisible(true);this._oChart.setVisible(false);const r=e[a].error;this._sErrorMsg=at.getErrorMessageForMissingMeasuresAndDimensions(i,r);this._oIllustratedMessage?.setDescription(this._sErrorMsg);this._bInvalidChartType=true}else{t?.setVisible(false);this._oChart.setVisible(true)}}};wt.prototype._isChartBound=function(){if(this._bIsChartBound){return true}if(this._oChart){return this._oChart.isBound("data")}return false};wt.prototype._fireChartDataChanged=function(t){var e={dimeasure:false,filter:false,sort:false};for(var i in t){if(t[i]!=="Unchanged"){e[i]=true}}this.fireChartDataChanged({changeTypes:e})};wt.prototype._getChangeStatus=function(t){if(!t){return lt.ModelChanged}if(t.sort===lt.ModelChanged||t.filter===lt.ModelChanged||t.dimeasure===lt.ModelChanged||t.group===lt.ModelChanged){return lt.ModelChanged}if(t.sort===lt.TableChanged||t.filter===lt.TableChanged||t.dimeasure===lt.TableChanged||t.group===lt.TableChanged){return lt.TableChanged}return lt.Unchanged};wt.prototype.setEntitySet=function(t){this.setProperty("entitySet",t);this._initialiseMetadata();return this};wt.prototype.propagateProperties=function(){p.prototype.propagateProperties.apply(this,arguments);this._initialiseMetadata()};wt.prototype._initialiseMetadata=function(){if(!this._bMetadataIsInitialised){S.handleModelInit(this,this._onMetadataInitialised,true)}};wt.prototype._onMetadataInitialised=function(){this._bMetaModelLoadAttached=false;if(!this._bMetadataIsInitialised){this._listenToSmartFilter();this._createToolbar();this._createVariantManagementControl();this._createToolbarContent();this._bMetadataIsInitialised=true;if(this._bInitialiseEventInUse){this._initialiseInnerChart()}if(E.getActive()){E.end("SmartChartInit")}if(!this._oVariantManagement||this._oVariantManagement&&this._bVariantInitialised){this._checkAndTriggerBinding()}}};wt.prototype._checkAndTriggerBinding=function(){if(!this._bAutoBindingTriggered){this._bAutoBindingTriggered=true;if(this.getEnableAutoBinding()){if(this._oSmartFilter){this._oSmartFilter.search()}else{this._reBindChart()}}else if(!this._oChart){this._createTempNoData()}}};wt.prototype._createTempNoData=function(){var t=new o({text:this.getNoData()});this._oNoDataStruct=new p({items:[t],justifyContent:"Center",alignItems:"Center",height:"100%"});this.insertItem(this._oNoDataStruct,2)};wt.prototype._createChartProvider=function(){var t,e;e=this.getEntitySet();t=this.getModel();if(t&&!this._bChartCreated){this._aAlwaysSelect=[];this._aInitialSorters=[];this._addDrillBreadcrumbs();this._bChartCreated=true}if(t&&e){this._oChartProvider=new d({entitySet:e,ignoredFields:this.getIgnoredFields(),dateFormatSettings:this.data("dateFormatSettings"),defaultDropDownDisplayBehaviour:this.data("defaultDimensionDisplayBehaviour"),skipAnnotationParse:this.data("skipAnnotationParse"),chartQualifier:this.data("chartQualifier"),presentationVariantQualifier:this.data("presentationVariantQualifier"),model:t,chartLibrary:dt,criticalityType:Pt,notAssignedText:this.getNotAssignedText()})}};wt.prototype._listenToSmartFilter=function(){this._fetchSmartFilter();if(this._oSmartFilter){this._oSmartFilter.attachSearch(this._reBindChart,this);this._oSmartFilter.attachFilterChange(this._filterChangeEvent,this)}};wt.prototype.setNoData=function(t){if(this._oChart){this._oChart.setCustomMessages({NO_DATA:t})}this.setProperty("noData",t);return this};wt.prototype.getNoData=function(){var t=this.getProperty("noData");if(!this.getProperty("noData")){if(!this._oChart){this._fetchSmartFilter();if(this._oSmartFilter){t=this._oRb.getText("CHART_NO_DATA")}else{t=this._oRb.getText("CHART_NO_DATA_WITHOUT_FILTERBAR")}}else{t=this._oRb.getText("CHART_NO_RESULTS")}}return t};wt.prototype._fetchSmartFilter=function(){var t=null;t=this.getSmartFilterId();this._oSmartFilter=this._findControl(t)};wt.prototype._filterChangeEvent=function(){if(this._isChartBound()&&this._oSmartFilter&&!this._oSmartFilter.getLiveMode()&&!this._oSmartFilter.isDialogOpen()){this._showOverlay(true)}};wt.prototype._adjustOverlayHeight=function(){if(T.browser.safari||T.browser.chrome){var t=this._oChart.$(),e=t.find(".sapUiCompSmartChartOverlay");if(e.length===1){e.height(t.height())}}};wt.prototype._renderOverlay=function(t){if(this._oChart){var e=this._oChart.$(),i=e.find(".sapUiCompSmartChartOverlay");if(t&&i.length===0){i=jQuery("<div>").addClass("sapUiOverlay sapUiCompSmartChartOverlay").css("z-index","1");e.append(i);this._adjustOverlayHeight();this.sOverlayResizeListenerId=H.register(e,this._adjustOverlayHeight.bind(this))}else if(!t){i.remove();H.deregister(this.sOverlayResizeListenerId)}}};wt.prototype.showOverlay=function(t){this._showOverlay(t)};wt.prototype._showOverlay=function(t){if(t){var e={show:true};this.fireShowOverlay({overlay:e});t=e.show}this._hasOverlay=t;this._renderOverlay(t)};wt.prototype._findControl=function(e){var i,a;if(e){i=t.getElementById(e);if(!i){a=this._getView();if(a){i=a.byId(e)}}}return i};wt.prototype._getView=function(){if(!this._oView){var t=this.getParent();while(t){if(t.isA("sap.ui.core.mvc.View")){this._oView=t;break}t=t.getParent()}}return this._oView};wt.prototype._updateInResultDimensions=function(){var t=this._getInResultDimensionTotal();var e=function(t){var e=this._oChart.getInResultDimensions();if(e.length!=t.length){return false}for(var i=0,a=e.length;i<a;i++){if(e[i]!=t[i]){return false}}return true}.bind(this);if(t.length>0&&!e(t)){this._oChart.setInResultDimensions(t)}};wt.prototype._initialiseInnerChart=function(){this._createChart();this._createChartProvider();if(this._oChartProvider){this._oChartViewMetadata=this._oChartProvider.getChartViewMetadata();if(this._oChartViewMetadata){this._assignData();this._createContent();this._createPersonalizationController();this._oChart.attachRenderComplete(this._toggleZoomButtonEnablement,this);this._oSelectionDetails.attachSelectionHandler("_selectionDetails",this._oChart);this._enrichPassedButton(this._oChartTypeButton,this._oChart.getChartType());this._enableToolbarButtons();this._checkDimensionColoring();this._updateDrillBreadcrumbs();this.bIsInitialised=true;this.fireInitialise();this.fireInitialized();this.applyVariant(this.fetchVariant())}}};wt.prototype._enableToolbarButtons=function(){if(this._bDoFullyInitializeChart){return}if(this._oDrillUpButton&&this._oDrillDownButton){this._oDrillUpButton.setEnabled(true);this._oDrillDownButton.setEnabled(true)}if(this._oDrillDownTextButton){this._updateDrillDownTextButton()}if(this._oLegendButton){this._oLegendButton.setEnabled(true)}if(this._oZoomInButton&&this._oZoomOutButton){this._oZoomInButton.setEnabled(true);this._oZoomOutButton.setEnabled(true)}if(this._oDownloadButton){this._oDownloadButton.setEnabled(true)}if(this._oChartPersonalisationButton){this._oChartPersonalisationButton.setEnabled(true)}if(this.oFullScreenButton){this.oFullScreenButton.setEnabled(true)}if(this._oChartTypeButton){this._oChartTypeButton.setEnabled(true)}};wt.prototype.rebindChart=function(){if(!this._bMetadataIsInitialised){U.error("rebindChart method called before the metadata is initialized. Please execute the UI5 Support Assistant 'SmartChart' rules to get more information",this.getId(),"sap.ui.comp.smartChart")}this._reBindChart()};wt.prototype._reBindChart=function(t){var i,a,r=[],o,s,n,l={},h={preventChartBind:false};if(!this._oChart){if((!dt||!_t||!ft||!gt||!yt||!Ct||!bt||!vt||!St||!mt||!Pt||!Mt)&&!this._bChartRequested){dt=sap.ui.require("sap/chart/library");_t=sap.ui.require("sap/chart/Chart");ft=sap.ui.require("sap/chart/ColoringType");gt=sap.ui.require("sap/chart/data/Dimension");yt=sap.ui.require("sap/chart/data/HierarchyDimension");Ct=sap.ui.require("sap/chart/data/TimeDimension");bt=sap.ui.require("sap/chart/data/Measure");vt=sap.ui.require("sap/chart/data/MeasureSemantics");St=sap.ui.require("sap/viz/ui5/controls/VizTooltip");mt=sap.ui.require("sap/viz/ui5/format/ChartFormatter");Pt=sap.ui.require("sap/chart/coloring/CriticalityType");Mt=sap.ui.require("sap/chart/TimeUnitType");if(!dt||!_t||!ft||!gt||!yt||!Ct||!bt||!vt||!St||!mt||!Pt||!Mt){e.load({name:"sap.chart"}).then(function(){sap.ui.require(["sap/chart/library","sap/chart/Chart","sap/chart/ColoringType","sap/chart/data/Dimension","sap/chart/data/HierarchyDimension","sap/chart/data/TimeDimension","sap/chart/data/Measure","sap/chart/data/MeasureSemantics","sap/viz/ui5/controls/VizTooltip","sap/viz/ui5/format/ChartFormatter","sap/chart/coloring/CriticalityType","sap/chart/TimeUnitType"],function(e,i,a,r,o,s,n,l,h,u,c,p){dt=e;_t=i;ft=a;gt=r;yt=o;Ct=s;bt=n;vt=l;St=h;mt=u;Pt=c;Mt=p;this._bChartRequested=false;if(!this._bIsBeingDestroyed){this._reBindChart(t)}}.bind(this));this._bChartRequested=true}.bind(this))}}if(!dt||!_t||!ft||!gt||!yt||!Ct||!bt||!vt||!St||!mt||!Pt||!Mt){return}this._initialiseInnerChart()}this._bTriggerAnnouncement=t?.getId&&t.getId()==="search";if(this._bFullyInitialzeChart){this._enableToolbarButtons();this._addDrillBreadcrumbs();delete this._bFullyInitialzeChart}i=this._getChartPersonalisationData()||{};o=i.filters;s=i.excludeFilters;n=i.sorters;if(this._oSmartFilter){a=this._oSmartFilter.getFilters();l=this._oSmartFilter.getParameters()||{}}if(a&&a.length){if(s){r=[new C([a[0],s],true)]}else{r=a}}else if(s){r=[s]}if(o){o=r.concat(o)}else{o=r}this._updateInResultDimensions();l["entitySet"]=this.getEntitySet();if(!n){n=[]}h.filters=o;h.sorter=n;h.parameters=l;h.events={};this.fireBeforeRebindChart({bindingParams:h});if(!h.preventChartBind&&this._oChartViewMetadata){n=h.sorter;o=h.filters;l=h.parameters;this._oChart.setBusy(true);this._bDataLoadPending=true;wt._addBindingListener(h,"change",this._onDataLoadComplete.bind(this));wt._addBindingListener(h,"dataReceived",this._onDataReceived.bind(this));var u={path:this.getChartBindingPath()||"/"+this.getEntitySet(),parameters:l,filters:o,events:h.events};if(!this._isChartBound()){u.sorter=n}if(h.length){u.length=h.length}else{var c=this._oChartProvider.getMaxItems();if(c>0){u.length=c}}this._oChart.bindData(u);if(this._isChartBound()){this._oChart.getBinding("data").sort(n)}this._showOverlay(false);this._bIsChartBound=true}};wt.prototype._validateSorters=function(t){var e=[];var i=this._oChart.getVisibleDimensions().concat(this._oChart.getVisibleMeasures());if(t){t.forEach(function(t){i.forEach(function(i){if(t.sPath===i){e.push(t)}})})}return e};wt.prototype._onDataReceived=function(t){if(t&&t.getParameter&&t.getParameter("__simulateAsyncAnalyticalBinding")){return}this._onDataLoadComplete(t,true);try{this.fireDataReceived(t)}catch(t){}};wt._addBindingListener=function(t,e,i){if(!t.events){t.events={}}if(!t.events[e]){t.events[e]=i}else{var a=t.events[e];t.events[e]=function(){i.apply(this,arguments);a.apply(this,arguments)}}};wt.prototype._onDataLoadComplete=function(t,e){if(this._oSemanticalNavButton){this._oSemanticalNavButton.setEnabled(false)}if(this._bDataLoadPending||e){this._bDataLoadPending=false;this._updateAvailableChartType();this._oChart.setBusy(false);if(this._bTriggerAnnouncement){this._bTriggerAnnouncement=false;this._announceUpdate(this._oChart.getChartType(),this.getHeader(),this._oChart.getVisibleDimensions().length,this._oChart.getVisibleMeasures().length)}}};wt.prototype._announceUpdate=function(t,e,i,a){const r=Y.getInstance();if(r){const o=this._oRb;const s=this._getChartTypes();t=s[t]||t;let n=o.getText("CHART_ANNOUNCEMENT_UPDATED",[e,t]);let l;if(i&&a){if(i===1&&a===1){l="CHART_ANNOUNCEMENT_DIMMEA_11_UPDATED"}else if(i>1&&a===1){l="CHART_ANNOUNCEMENT_DIMMEA_N1_UPDATED"}else if(i===1&&a>1){l="CHART_ANNOUNCEMENT_DIMMEA_1N_UPDATED"}else{l="CHART_ANNOUNCEMENT_DIMMEA_NN_UPDATED"}n+=" "+o.getText(l,[i,a])}r.announce(n)}};wt.prototype._assignData=function(){if(this._oChartViewMetadata&&this._oChart){this._oChart.resetLayout();if(this._oChartViewMetadata.measureFields&&this._oChartViewMetadata.measureFields.length>0){this._oChart.setVisibleMeasures(this._oChartViewMetadata.measureFields)}if(this._oChartViewMetadata.dimensionFields&&this._oChartViewMetadata.dimensionFields.length>0){this._oChart.setVisibleDimensions(this._oChartViewMetadata.dimensionFields)}if(!this.getChartType()&&this._oChartViewMetadata.chartType){this._setChartType(this._oChartViewMetadata.chartType)}}};wt.prototype._createP13nObject=function(t){if(t.sortable&&t.sorted){var e={columnKey:t.name,operation:t.sortOrder};if(t.sortIndex!=null){this._aInitialSorters.splice(t.sortIndex,0,e)}else{this._aInitialSorters.push(e)}}return{columnKey:t.name,leadingProperty:t.name,additionalProperty:t.additionalProperty,sortProperty:t.sortable?t.name:undefined,filterProperty:t.filterable?t.name:undefined,fullName:t.hasValueListAnnotation?t.fullName:null,type:t.filterType,typeInstance:t.modelType,maxLength:t.maxLength,precision:t.precision,scale:t.scale,isMeasure:t.isMeasure,isDimension:t.isDimension,isHierarchyDimension:t.isHierarchyDimension,hierarchyLevel:t.hierarchyLevel,aggregationRole:t.aggregationRole,label:t.label,tooltip:t.quickInfo,sorted:t.sorted,sortOrder:t.sortOrder,criticality:t.valueCriticality}};wt.prototype._createContent=function(){var t,e=0,i,a,r,o=[],s;var n=[];this._aColumnKeysOrdered=[];Object.assign(this._aColumnKeysOrdered,this._oChartViewMetadata.dimensionFields);this._aColumnKeysOrdered=this._aColumnKeysOrdered.concat(this._oChartViewMetadata.measureFields);e=this._oChartViewMetadata.fields.length;var l=this._oChartViewMetadata.dimensionFields||[];var h=this._oChartViewMetadata.measureFields||[];for(t=0;t<e;t++){a=null;i=this._oChartViewMetadata.fields[t];i.label=i.fieldLabel||i.name;if(this._aColumnKeysOrdered.indexOf(i.name)===-1){this._aColumnKeysOrdered.push(i.name)}if(this._oChart.getDimensionByName(i.name)===undefined&&this._oChart.getMeasureByName(i.name)===undefined){s=this._createP13nObject(i);r={name:i.name,label:i.label,tooltip:i.quickInfo}}if(i.inResult){this._aAlwaysSelect.push(i.name)}if(i.isDimension||i.isHierarchyDimension||l.indexOf(i.name)!=-1){if(this._oChart.getDimensionByName(i.name)===undefined){if(i.isDimension){if(i.isTimeDimension&&this.getActivateTimeSeries()){a=new Ct(r);var u=i.timeUnitType;if(Mt.hasOwnProperty(i.timeUnitType)){a.setTimeUnit(Mt[u])}if(!this._bDisableTimeseriesUTC){try{a._setIsUTC(true)}catch(t){U.error("Couldn't set UTC settings on TimeDimension")}}}else{a=new gt(r)}}else{r.level=i.hierarchyLevel;a=new yt(r)}this._oChart.addDimension(a);if(i.isTimeDimension&&this.getActivateTimeSeries()){if(i.customFormatter){a.setTextFormatter(i.customFormatter)}}else if(i.description){a.setTextProperty(i.description);a.setTextFormatter(I.getFormatterFunctionFromDisplayBehaviour(i.displayBehaviour,false,this))}else if(i.customFormatter){if(i.timezone){a.setTextProperty(i.timezone)}a.setTextFormatter(i.customFormatter)}else if(i.isDimension){a.setTextFormatter(function(t,e){if(t===""){return this.getNotAssignedText()}else{return t}}.bind(this))}}else{var c=this._oChart.getDimensionByName(i.name).data("p13nData");if(c){this._oChart.getDimensionByName(i.name).data("p13nData",typeof c==="string"?JSON.parse(c):c)}}}else if(i.isMeasure||h.indexOf(i.name)!=-1){if(this._oChart.getMeasureByName(i.name)===undefined){a=new bt(r);this._oChart.addMeasure(a);if(i.dataPoint){n.push({dataPoint:i.dataPoint,measure:a})}if(i.unit){a.setUnitBinding(i.unit)}}else{var c=this._oChart.getMeasureByName(i.name).data("p13nData");if(c){this._oChart.getMeasureByName(i.name).data("p13nData",typeof c==="string"?JSON.parse(c):c)}}}else if(i.sortable||i.filterable){o.push(s)}if(a){if(i.role){a.setRole(i.role)}a.data("p13nData",s)}}if(this._oChart){this._oChart.data("p13nData",o)}if(n.length>0){this._enrichFromDataPoints(n)}};wt.prototype._getField=function(t){var e,i,a;if(t&&this._oChartViewMetadata&&this._oChartViewMetadata.fields){a=this._oChartViewMetadata.fields.length;for(i=0;i<a;i++){e=this._oChartViewMetadata.fields[i];if(e.name===t){return e}}}return null};wt.prototype.attachInitialise=function(t,e,i){this.attachEvent("initialise",t,e,i);this._bInitialiseEventInUse=true;sap.ui.getCore().loadLibrary("sap.chart");dt=sap.ui.requireSync("sap/chart/library");_t=sap.ui.requireSync("sap/chart/Chart");ft=sap.ui.requireSync("sap/chart/ColoringType");gt=sap.ui.requireSync("sap/chart/data/Dimension");yt=sap.ui.requireSync("sap/chart/data/HierarchyDimension");Ct=sap.ui.requireSync("sap/chart/data/TimeDimension");bt=sap.ui.requireSync("sap/chart/data/Measure");vt=sap.ui.requireSync("sap/chart/data/MeasureSemantics");St=sap.ui.requireSync("sap/viz/ui5/controls/VizTooltip");mt=sap.ui.requireSync("sap/viz/ui5/format/ChartFormatter");Pt=sap.ui.requireSync("sap/chart/coloring/CriticalityType");Mt=sap.ui.requireSync("sap/chart/TimeUnitType");if(this._bMetadataIsInitialised){this._initialiseInnerChart()}U.error("The event 'initialise' is deprecated, please use 'initialized' instead");return this};wt.prototype._createChart=function(){if(this._oNoDataStruct){this._oNoDataStruct.destroy()}var t=this.getItems(),e=t?t.length:0,i,a=this;var r;this._bDisableTimeseriesUTC=true;while(e--){i=t[e];if(i instanceof _t){break}i=null}if(i){this._oChart=i;try{r=this.data("dateFormatSettings")?JSON.parse(this.data("dateFormatSettings")):{};if(r.hasOwnProperty("UTC")){this._bDisableTimeseriesUTC=!r["UTC"]}if(r.hasOwnProperty("style")&&r["style"].toLowerCase()=="medium"){this._bWorkaroundVizFormatter=true}}catch(t){}}else{var o={uiConfig:{applicationSet:"fiori"},busyIndicatorDelay:0,vizProperties:{title:{text:""},plotArea:{scrollbar:{forceToShowInMobile:true},dataLabel:{hideWhenOverlap:false}},general:{groupData:false},valueAxis:{title:{visible:a.getShowMeasuresTitle()}},categoryAxis:{title:{visible:a.getShowDimensionsTitle()},layout:{autoHeight:true,autoWidth:true}}},selectionMode:this.getSelectionMode(),width:"100%"};try{r=this.data("dateFormatSettings")?JSON.parse(this.data("dateFormatSettings")):{};if(r.hasOwnProperty("UTC")){o.vizProperties.general.showAsUTC=!!r["UTC"];this._bDisableTimeseriesUTC=!r["UTC"];if(r.hasOwnProperty("style")&&r["style"].toLowerCase()=="medium"){o.vizProperties.timeAxis={levelConfig:{day:{visible:true,formatString:"MediumDay"},month:{visible:true,formatString:"MediumMonth"}}};this._bWorkaroundVizFormatter=true}}}catch(t){}this._oChart=new _t(o);const t=this._createUIErrorForInvalidChartType();this._oVBox=new p({items:[t],justifyContent:"Center",alignItems:"Center",height:"100%",width:"100%",visible:false});if(this.getHeight()){this._oChart.setHeight("100%")}this._toggleChartTooltipVisibility(this.getShowChartTooltip());this._setBehaviorTypeForDataSelection();this.insertItem(this._oChart,2);this.insertItem(this._oVBox,3)}if(T.browser.safari||T.browser.chrome||T.browser.firefox){this.addStyleClass("sapUiCompSmartChartInnerChartHeight")}this.setLegendVisible(this.getLegendVisible());if(!this._oChart.getLayoutData()){var n={growFactor:1};var l=this.getLayoutData();if(l&&l.getBaseSize){n.baseSize=l.getBaseSize()}else{n.baseSize="100%"}this._oChart.setLayoutData(new s(n))}if(this.getChartType()){this._setChartType(this.getChartType())}this._oChart.attachRenderComplete(function(){if(this._hasOverlay){setTimeout(function(){this._showOverlay(true)}.bind(this),0)}this._oChart.getLayoutData().setGrowFactor(1)}.bind(this));this._oChart.setCustomMessages({NO_DATA:this.getNoData()});this._createTooltipOrPopover()};wt.prototype._createUIErrorForInvalidChartType=function(){const t=this._oMDCRb.getText("chart.INVALID_CHART_TYPE_ERROR_MESSAGE_TITLE");const e=this._oMDCRb.getText("chart.INVALID_CHART_TYPE_DEFAULT_ERROR_MESSAGE_DESCRIPTION");this._oIllustratedMessage=new it({enableVerticalResponsiveness:true,title:t,illustrationType:pt.NoChartData,description:e,additionalContent:[new r({text:this._oMDCRb.getText("chart.CHANGE_SETTINGS"),press:function(t){this._oChartPersonalisationButton?.firePress?.()}.bind(this)}),new r({text:this._oMDCRb.getText("chart.SELECT_ANOTHER_CHART_TYPE"),press:function(t){this._oChartTypeButton?.firePress?.()}.bind(this)}).addStyleClass("sapUiTinyMarginBegin")]});return this._oIllustratedMessage};wt.prototype._toggleChartTooltipVisibility=function(t){if(this._oChart){if(t){if(!this._vizTooltip){this._vizTooltip=new St}this._vizTooltip.connect(this._oChart.getVizUid())}else if(this._vizTooltip){this._vizTooltip.destroy()}}};wt.prototype._updateVizTooltipFormatter=function(){if(this._vizTooltip){if(this._oChart.getChartType().match(/100/)!==null){this._vizTooltip.setFormatString(mt.DefaultPattern.STANDARDPERCENT_MFD2)}else{this._vizTooltip.setFormatString(mt.DefaultPattern.STANDARDFLOAT)}}};wt.prototype.getChart=function(){if(!this._oChart&&this._bMetadataIsInitialised){sap.ui.getCore().loadLibrary("sap.chart");dt=sap.ui.requireSync("sap/chart/library");_t=sap.ui.requireSync("sap/chart/Chart");ft=sap.ui.requireSync("sap/chart/ColoringType");gt=sap.ui.requireSync("sap/chart/data/Dimension");yt=sap.ui.requireSync("sap/chart/data/HierarchyDimension");Ct=sap.ui.requireSync("sap/chart/data/TimeDimension");bt=sap.ui.requireSync("sap/chart/data/Measure");vt=sap.ui.requireSync("sap/chart/data/MeasureSemantics");St=sap.ui.requireSync("sap/viz/ui5/controls/VizTooltip");mt=sap.ui.requireSync("sap/viz/ui5/format/ChartFormatter");Pt=sap.ui.requireSync("sap/chart/coloring/CriticalityType");Mt=sap.ui.requireSync("sap/chart/TimeUnitType");this._initialiseInnerChart()}else if(!this._bMetadataIsInitialised){U.error("Accesing the inner chart before the metadata is initialized will not work. Instead, wait for the initialized event!")}U.error("This function is deprecated, please use getChartAsync instead");return this._oChart};wt.prototype.getChartAsync=function(){if(!this._oChart&&this._bMetadataIsInitialised){return new Promise(function(t,e){sap.ui.require(["sap/chart/library","sap/chart/Chart","sap/chart/ColoringType","sap/chart/data/Dimension","sap/chart/data/HierarchyDimension","sap/chart/data/TimeDimension","sap/chart/data/Measure","sap/chart/data/MeasureSemantics","sap/viz/ui5/controls/VizTooltip","sap/viz/ui5/format/ChartFormatter","sap/chart/coloring/CriticalityType","sap/chart/TimeUnitType"],function(){dt=arguments[0];_t=arguments[1];ft=arguments[2];gt=arguments[3];yt=arguments[4];Ct=arguments[5];bt=arguments[6];vt=arguments[7];St=arguments[8];mt=arguments[9];Pt=arguments[10];Mt=arguments[11];this._bChartRequested=false;if(!this._oChart){this._initialiseInnerChart()}if(this._oChart){t(this._oChart)}else{e("The inner chart couldn't be created")}}.bind(this))}.bind(this))}else if(!this._bMetadataIsInitialised){U.error("Accessing the inner chart before the metadata is initialized will not work. Instead, wait for the initialized event!");return Promise.reject(new Error("Accessing the inner chart before the metadata is initialized will not work. Instead, wait for the initialized event!"))}else{return Promise.resolve(this._oChart)}};wt.prototype._getChartTypes=function(){var t;try{t=dt.api.getChartTypes()}catch(e){t={};U.error("sap.chart.api.getChartTypes throws an exception.\n"+e.toString())}return t};wt.prototype.getAvailableChartTypes=function(){var t,e,i=[],a,r={},o,s;if(this._oChart){o=this.getIgnoredChartTypes();if(this.getActivateTimeSeries()){o=o.concat(this._oChartProvider.getIgnoredChartTypesForTimeSeries())}s=v.createArrayFromString(o);r=this._getChartTypes();a=this._oChart.getAvailableChartTypes().available;if(a){for(t=0;t<a.length;t++){e=a[t].chart;if(s.indexOf(e)<0){i.push({key:e,text:r[e]})}}}}return i};wt.prototype._retrieveChartTypeDescription=function(t){var e=this._getChartTypes();return{key:t,text:e[t]}};wt.prototype._setChartType=function(t){if(this._oChart){var e=this._oChart.getHeight();this._oChart.setChartType(t);this._aDetailsEntries=[];this._toggleMeasureUnitBinding(t,this._oChart.getMeasures());this._oChart.setHeight(e)}};wt.prototype._toggleMeasureUnitBinding=function(t,e){if(typeof e!="undefined"&&e instanceof Array){if(t.substring(0,4)==="100_"){e.forEach(function(t){t.setUnitBinding()})}else if(this._oChartProvider){var i=this._oChartProvider._aODataFieldMetadata;e.forEach(function(t){for(var e=i.length-1;e>=0;e--){if(i[e].name==t.getName()){var a=i[e];var r=a["Org.OData.Measures.V1.ISOCurrency"]?.Path;if(r){t.setUnitBinding(r)}else{r=a["Org.OData.Measures.V1.Unit"]?.Path;if(r){t.setUnitBinding(r)}}break}}})}}};wt.prototype._getDimensions=function(){var t=[];if(this._oChart){t=this._oChart.getDimensions()}return t};wt.prototype._getVisibleDimensions=function(){var t=[];if(this._oChart){t=this._oChart.getVisibleDimensions()}return t};wt.prototype._getMeasures=function(){var t=[];if(this._oChart){t=this._oChart.getMeasures()}return t};wt.prototype._getVisibleMeasures=function(){var t=[];if(this._oChart){t=this._oChart.getVisibleMeasures()}return t};wt.prototype._getSortedDimensions=function(){var t=[];if(this._oChart){t=this._oChart.getDimensions();if(t){t.sort(function(t,e){if(t.getLabel()&&e.getLabel()){return t.getLabel().localeCompare(e.getLabel())}})}}return t};wt.prototype.fetchVariant=function(){if(this._oCurrentVariant==="STANDARD"||this._oCurrentVariant===null){return{}}var t=this._processDateFiltersForVariant(this._oCurrentVariant);return t};wt.prototype.applyVariant=function(t,e){this._oCurrentVariant=t;if(this._oCurrentVariant==="STANDARD"){this._oCurrentVariant=null}this._bApplyingVariant=true;if(this._oPersController){if(this._oCurrentVariant===null||jQuery.isEmptyObject(this._oCurrentVariant)){this._oPersController.resetPersonalization(ht.ResetFull)}else{this._oPersController.setPersonalizationData(this._oCurrentVariant,true)}}this._bApplyingVariant=false;this.fireAfterVariantApply({currentVariantId:this.getCurrentVariantId(),variantContext:e})};wt.prototype._processDateFiltersForVariant=function(t){if(!this._oPersController){return t}var e=v.getColumnKeysOfType("date",this._oPersController._oColumnHelper.getColumnMap()),i=v.getColumnKeysOfType("time",this._oPersController._oColumnHelper.getColumnMap());if(e.length===0||!(t&&t.filter&&t.filter.filterItems)){return t}var r=t.filter.filterItems.map(function(t){if(e.concat(i).includes(t.columnKey)&&this._oChartProvider&&this._oChartProvider.getIsUTCDateHandlingEnabled()){t=Object.assign({},t);if(t.value1 instanceof Date){t.value1=a.localToUtc(t.value1).toISOString();t.value1=t.value1.slice(0,-1)}if(t.value2 instanceof Date){t.value2=a.localToUtc(t.value2).toISOString();t.value2=t.value2.slice(0,-1)}}return t},this);t=Object.assign({},t,{filter:Object.assign({},t.filter,{filterItems:r})});return t};wt.prototype.variantsInitialized=function(){this._bVariantInitialised=true;this._checkAndTriggerBinding()};wt.prototype.getUiState=function(){if(!this.isInitialised()){U.error("SmartChart: Called getUiState() before inner structure was initialized. This will force a synchronous load of dependencies.");this.getChart()}var t=this._oPersController?this._oPersController.getDataSuiteFormatSnapshot():null;return new B({presentationVariant:{ContextUrl:"",MaxItems:this._oChartProvider?this._oChartProvider.getMaxItems():undefined,SortOrder:t?t.SortOrder:[],GroupBy:t?t.GroupBy:[],Total:t?t.Total:[],RequestAtLeast:this._getInResultDimensionTotal(),Visualizations:t?t.Visualizations:[]},selectionVariant:{SelectOptions:t?t.SelectOptions:[]},variantName:this.getCurrentVariantId()})};wt.prototype.setUiState=function(t){if(this._oPersController){var e=this._oVariantManagement&&t.getVariantName()?this._oVariantManagement.getVariantContent(this,t.getVariantName()):{};this._oPersController.setDataSuiteFormatSnapshot(z({},t.getPresentationVariant(),t.getSelectionVariant()),e,true)}this._setInResultDimensionFromVariant(t)};wt.prototype.setUiStateAsVariant=function(t,e){if(this._oPersController){this._oPersController.setPersonalizationDataAsDataSuiteFormat(z({},t.getPresentationVariant(),t.getSelectionVariant()),true)}this._setInResultDimensionFromVariant(t);if(this._oVariantManagement){this.fireAfterVariantApply({currentVariantId:this.getCurrentVariantId(),variantContext:e})}};wt.prototype._setInResultDimensionFromVariant=function(t){if(t.getPresentationVariant()&&this._oChart){this._oChart.setInResultDimensions(t.getPresentationVariant().RequestAtLeast)}else{this._oUiStateRequestAtLeast=t.getPresentationVariant().RequestAtLeast}};wt.prototype.setRequestAtLeastFields=function(t){this.setProperty("requestAtLeastFields",t);if(this._oChart){this._updateInResultDimensions()}return this};wt.prototype._getInResultDimensionTotal=function(){var t=[];if(this.getRequestAtLeastFields()){t=this.getRequestAtLeastFields().split(",")}t=t.concat(this._aAlwaysSelect);if(this._oChart){t=t.concat(this._oChart.getInResultDimensions())}if(this._oUiStateRequestAtLeast){t.concat(this._oUiStateRequestAtLeast);this._oUiStateRequestAtLeast=null}return t.filter(function(t,e,i){return e==i.indexOf(t)})};wt.prototype._getFieldByKey=function(t){var e,i=null;if(this._oChartViewMetadata&&this._oChartViewMetadata.fields){for(e=0;e<this._oChartViewMetadata.fields.length;e++){i=this._oChartViewMetadata.fields[e];if(t===i.name){return i}}return null}};wt.prototype._getByKey=function(t,e){var i,a,r,o;if(t){a=t.length;for(i=0;i<a;i++){r=t[i];o=r.data("p13nData");if(o&&o.columnKey===e){return r}}}return null};wt.prototype._getDimensionByKey=function(t){if(this._oChart){return this._getByKey(this._oChart.getDimensions(),t)}return null};wt.prototype._getMeasureByKey=function(t){if(this._oChart){return this._getByKey(this._oChart.getMeasures(),t)}return null};wt.prototype._getChartObjByKey=function(t){var e=this._getDimensionByKey(t);if(!e){e=this._getMeasureByKey(t)}return e};wt.prototype._getPathFromColumnKeyAndProperty=function(t,e){var i=null,a,r;a=this._getChartObjByKey(t);if(a){r=a.data("p13nData");if(r){i=r[e]}}return i};wt.prototype._getChartPersonalisationData=function(){var t=function(t){return t};if(!this._oCurrentVariant){return null}var e=[],i=[],r=[],o,s,n,l,h;if(this._oCurrentVariant.sort){s=this._oCurrentVariant.sort.sortItems}else{s=this._aInitialSorters}if(s){s.forEach(function(i){var a=i.operation==="Descending";n=t(i.columnKey);e.push(new y(n,a))},this)}if(this._oCurrentVariant.filter){this._oCurrentVariant.filter.filterItems.forEach(function(e){var o=e.operation;var s=e.value1;var u=e.value2;n=e.columnKey;var c=this._oChartViewMetadata?.fields?.find(function(t){return t.name===n});if(c?.filterType==="time"){if(s instanceof Date){s=I.getEdmTimeFromDate(s)}if(u instanceof Date){u=I.getEdmTimeFromDate(u)}}else{h=c?.filterType==="datetime";if(h){s=s?W.getInstance(s):s;u=u?W.getInstance(u):u}if(!h&&s instanceof Date&&this._oChartProvider&&this._oChartProvider.getIsUTCDateHandlingEnabled()){s=a.localToUtc(s);u=u?a.localToUtc(u):u}if(h&&(c.filterRestriction=="interval"||c.filterRestriction=="auto")){if(o==="EQ"){o="BT";u=new Date(s);u.setMilliseconds(999)}else if(o==="LT"||o==="LE"){s.setMilliseconds(999)}else if(o==="BT"&&s&&u){u.setMilliseconds(999)}}}n=t(n);var p=function(t,e,i){if(i==="Empty"){i=e?q.getTransformedExcludeOperation("EQ"):"EQ";t.push(new C(n,i,""));if(c&&c.isNullable){t.push(new C(n,i,null))}}else{i=e?q.getTransformedExcludeOperation(i):i;l=new C(n,i,s,u);if(h&&c?.precision){l=I.adaptMilliseconds(l,c.precision,i)}t.push(l)}};p(e.exclude?r:i,e.exclude,o)},this);if(r.length){o=new C(r,true)}}return{filters:i,excludeFilters:o,sorters:e}};wt.prototype._persistPersonalisation=function(){var t="Personalisation";if(!$.isDesignModeEnabled()&&this._oVariantManagement&&!this._oVariantManagement.isPageVariant()){var e=this._oVariantManagement.getViewIdByName(t);if(e===null){e=this.getCurrentVariantId()}if(!this._bSaving){this._bSaving=true;this._oVariantManagement.fireSave({name:t,implicit:true,global:false,overwrite:!!e,key:e,def:true});delete this._bSaving}}};wt.prototype.getCurrentVariantId=function(){var t="";if(this._oVariantManagement){t=this._oVariantManagement.getCurrentVariantId()}return t};wt.prototype.setCurrentVariantId=function(t){if(this._oVariantManagement&&!this._oVariantManagement.isPageVariant()){this._oVariantManagement.setCurrentVariantId(t)}else{U.error("sap.ui.comp.smartchart.SmartChart.prototype.setCurrentVariantId: VariantManagement does not exist or is a page variant")}return this};wt.prototype._adjustHeight=function(){if(this._oChart){var t=0,e=0;var i=this.getDomRef()?this.getDomRef().offsetHeight:0;if(i===0){return}if(this._oToolbar&&this._oToolbar.getDomRef()){t=this._oToolbar.getDomRef().offsetHeight}if(this._oDrillBreadcrumbs&&this._oDrillBreadcrumbs.getDomRef()){var a=this._oDrillBreadcrumbs.getDomRef().parentNode?this._oDrillBreadcrumbs.getDomRef().parentNode:this._oDrillBreadcrumbs.getDomRef();e=a.offsetHeight}var r=i-t-e;this._oChart.setHeight(r+"px");this._updateDrillBreadcrumbs();if(this._hasOverlay){setTimeout(function(){this._showOverlay(true)}.bind(this),0)}}};wt.prototype._toggleFullScreen=function(t,e){if(!this.oFullScreenButton||t===this.bFullScreen&&!e){return}if(t==true&&this._oChart){this._sChartHeight=this._oChart.getHeight();this._oChart.setHeight("100%")}this.bFullScreen=t;k.toggleFullScreen(this,this.bFullScreen,this.oFullScreenButton,this._toggleFullScreen,"sapContrastPlus",true);if(!t){this._adjustHeight()}this._renderFullScreenButton();this.fireFullScreenToggled({fullScreen:t});if(t==false&&this._oChart){this._oChart.setHeight(this._sChartHeight)}};wt.prototype._renderFullScreenButton=function(){this.oFullScreenButton.setTooltip(this.bFullScreen?this._oRb.getText("CHART_MINIMIZEBTN_TOOLTIP"):this._oRb.getText("CHART_MAXIMIZEBTN_TOOLTIP"));this.oFullScreenButton.setText(this.bFullScreen?this._oRb.getText("CHART_MINIMIZEBTN_TEXT"):this._oRb.getText("CHART_MAXIMIZEBTN_TEXT"));this.oFullScreenButton.setIcon(this.bFullScreen?"sap-icon://exit-full-screen":"sap-icon://full-screen")};wt.prototype._enrichFromDataPoints=function(t){var e=t.length;var i=[];var a={};for(var r=0;r<e;r++){this._interpretDataPoint(t[r].dataPoint,t[r].measure,a,i)}if(i.length>0){this._oChart.setActiveColoring({coloring:ft.Criticality,parameters:{measure:i}});this._oChart.setColorings({Criticality:{MeasureValues:a}})}};wt.prototype._interpretDataPoint=function(t,e,i,a){this._setSemanticPatterns(t,e);if(e.setBoundaryValues){this._setBoundaryValues(t,e)}if(t.Criticality||t.CriticalityCalculation){i[t.Value.Path]=this._oChartProvider.provideSemanticColoring(t);a.push(t.Value.Path)}};wt.prototype._setSemanticPatterns=function(t,e){var i=t.TargetValue?t.TargetValue.Path:null;var a=t.ForecastValue?t.ForecastValue.Path:null;e.setSemantics(vt.Actual);if(i!=null){var r=this._oChart.getMeasureByName(i);if(r){r.setSemantics(vt.Reference)}else{U.error("sap.ui.comp.SmartChart: "+t.TargetValue.Path+" is not a valid measure")}}if(a){var o=this._oChart.getMeasureByName(a);if(o){o.setSemantics(vt.Projected)}else{U.error("sap.ui.comp.SmartChart: "+t.ForecastValue.Path+" is not a valid measure")}}e.setSemanticallyRelatedMeasures({referenceValueMeasure:i,projectedValueMeasure:a})};wt.prototype._setBoundaryValues=function(t,e){var i={};if(t.MinimumValue){i.minimum=t.MinimumValue}if(t.MaximumValue){i.maximum=t.MaximumValue}if(i.minimum||i.maximum){e.setBoundaryValues(i)}};wt.prototype.isInitialised=function(){return!!this.bIsInitialised};wt.prototype.exit=function(){this._oRb=null;if(this._oChartTypePopover){this._oChartTypePopover.destroy();this._oChartTypePopover=null}if(this._oDrilldownPopover){this._oDrilldownPopover.destroy();this._oDrilldownPopover=null}if(this._oSmartFilter){this._oSmartFilter.detachSearch(this._reBindChart,this);this._oSmartFilter.detachFilterChange(this._filterChangeEvent,this)}if(this._oChartProvider&&this._oChartProvider.destroy){this._oChartProvider.destroy()}this._oChartProvider=null;if(this._oPersController&&this._oPersController.destroy){this._oPersController.destroy()}if(this._oSegmentedButton){this._oSegmentedButton.removeAllButtons();this._oButtonChart1.destroy();this._oButtonChart2.destroy();this._oButtonChart3.destroy();this._oButtonChart4.destroy();this._oButtonChart5.destroy();this._oButtonChart1=null;this._oButtonChart2=null;this._oButtonChart3=null;this._oButtonChart4=null;this._oButtonChart5=null}this._oPersController=null;if(this._oVariantManagement){this._oVariantManagement.detachSave(this._variantSaved,this);this._oVariantManagement.detachAfterSave(this._variantAfterSave,this);if(!this._oVariantManagement.isPageVariant()&&this._oVariantManagement.destroy){this._oVariantManagement.destroy()}}this._oVariantManagement=null;this._destroyPopover();k.cleanUpFullScreen(this);if(this._oDetailsPopover){this._oDetailsPopover.destroy();if(this._oRelatedAppsMasterList){this._oRelatedAppsMasterList.destroy()}}if(this._oChart){this._oChart.detachRenderComplete(this._toggleZoomButtonEnablement,this)}this._oCurrentVariant=null;this._oChartViewMetadata=null;this._aAlwaysSelect=null;this._aInitialSorters=null;this._oSmartFilter=null;this._oToolbar=null;this._oChartPersonalisationButton=null;this._oView=null;this._oChart=null;this._bDisableTimeseriesUTC=null;this._bWorkaroundVizFormatter=null;p.prototype.exit.apply(this,arguments)};wt.prototype._processResizeHandler=function(t){if(t){this.sResizeListenerId=null;if(T.system.desktop){this.sResizeListenerId=H.register(this,this._adjustHeight.bind(this))}else{T.orientation.attachHandler(this._adjustHeight,this);T.resize.attachHandler(this._adjustHeight,this)}}else if(T.system.desktop&&this.sResizeListenerId){H.deregister(this.sResizeListenerId);this.sResizeListenerId=null}else{T.orientation.detachHandler(this._adjustHeight,this);T.resize.detachHandler(this._adjustHeight,this)}};wt.prototype.setShowToolbar=function(t){if(this._oToolbar){this._oToolbar.setVisible(t)}return this.setProperty("showToolbar",t,true)};wt.prototype.setToolbarStyle=function(t){if(this._oToolbar){this._oToolbar.setStyle(t)}return this.setProperty("toolbarStyle",t,true)};wt.prototype.setShowDimensionsTitle=function(t){if(this._oChart){this._oChart.setVizProperties({categoryAxis:{title:{visible:t}}})}return this.setProperty("showDimensionsTitle",t,true)};wt.prototype.setShowMeasuresTitle=function(t){if(this._oChart){this._oChart.setVizProperties({valueAxis:{title:{visible:t}}})}return this.setProperty("showMeasuresTitle",t,true)};wt.prototype._checkDimensionColoring=function(){var t=this._getVisibleDimensions(),e,i={Criticality:{DimensionValues:{}}},a;for(var r=0;r<t.length;r++){e=this._getField(t[r]);a=this._oChartProvider.calculateDimensionColoring(e);if(a){if(this._sColoringDimension!=e.name){i.Criticality.DimensionValues[e.name]=a;this._oChart.setActiveColoring({coloring:ft.Criticality,parameters:{dimension:e.name}});this._oChart.setColorings(i);this._sColoringDimension=e.name}return}}};wt.prototype.getIdForLabel=function(){if(this._headerText){return this._headerText.getId()}return p.prototype.getIdForLabel.apply(this,[])};return wt});
//# sourceMappingURL=SmartChart.js.map