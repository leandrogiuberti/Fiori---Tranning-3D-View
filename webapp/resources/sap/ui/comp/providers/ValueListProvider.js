/*!
 * SAPUI5
 * (c) Copyright 2025 SAP SE. All rights reserved.
 */
sap.ui.define(["sap/ui/core/Lib","sap/ui/core/library","sap/ui/comp/library","sap/m/library","sap/ui/comp/odata/MetadataAnalyser","sap/ui/comp/util/DateTimeUtil","sap/ui/core/SeparatorItem","sap/m/GroupHeaderListItem","sap/m/Column","sap/m/ColumnListItem","sap/m/Text","sap/m/Token","./BaseValueListProvider","sap/ui/core/ListItem","sap/ui/model/Filter","sap/ui/model/Sorter","sap/ui/model/json/JSONModel","sap/ui/model/FilterOperator","sap/ui/comp/util/FormatUtil","sap/ui/comp/historyvalues/HistoryValuesProvider","sap/ui/comp/historyvalues/HistoryOptOutProvider","sap/ui/comp/historyvalues/Constants","sap/m/ComboBox","sap/m/MultiComboBox","sap/m/Select","sap/base/util/deepEqual","sap/ui/Device","sap/base/Log","sap/base/util/values","sap/m/Label","sap/base/strings/whitespaceReplacer","sap/ui/comp/smartfilterbar/FilterProviderUtils","sap/base/util/Deferred"],function(t,e,i,o,s,r,n,a,l,h,u,d,p,g,c,m,f,_,y,S,C,v,F,P,D,b,V,I,A,w,T,B,L){"use strict";var R=i.smartfilterbar.DisplayBehaviour;var H=o.PopinDisplay;var M=o.WrappingType;var E=e.ValueState;var x=t.getResourceBundleFor("sap.ui.comp").getText("SEARCH_FIELD_VALIDATION_WARNING_MESSAGE");var N={Recommendations:10,RecentlyUsed:20,Others:30};var O="list";var k=p.extend("sap.ui.comp.providers.ValueListProvider",{constructor:function(e){if(e){this.sAggregationName=e.aggregation;this.bTypeAheadEnabled=!!e.typeAheadEnabled;this.bEnableShowTableSuggestionValueHelp=e.enableShowTableSuggestionValueHelp===undefined?true:e.enableShowTableSuggestionValueHelp;this.dropdownItemKeyType=e.dropdownItemKeyType;this.sDeferredGroupId=e.deferredGroupId;this._fieldHistoryEnabled=e.fieldHistoryEnabled;this._fieldHistoryEnabledInitial=e.fieldHistoryEnabledInitial;this._bSuggestionsEnabled=this._getSuggestionsEnabled();this.bShowAllSuggestionsButton=e.bShowAllSuggestionsButton}this._aRecommendations=[];this._oRecommendationListPromise=Promise.resolve();this._oResourceBundle=t.getResourceBundleFor("sap.ui.comp");this._groupHeaderFactory=this._groupHeaderFactory.bind(this);this._pendingValidationCount=0;this._bConsiderPresentationVariant=typeof e.considerPresentationVariant==="undefined"?true:e.considerPresentationVariant;p.apply(this,arguments);this._onInitialise()}});k.prototype._onInitialise=function(){if(!this.bTypeAheadEnabled){this.oAfterRenderingEventDelegate={onAfterRendering:this._onMetadataInitialised};this.oControl.addEventDelegate(this.oAfterRenderingEventDelegate,this)}else if(this.oControl.attachSuggest){this._fSuggest=function(t){this.oControl=t.getSource();if(!this.bInitialised){return}if(!this.isDisableSearchMatchesPatternWarning()&&this.oControl.getValueState&&this.oControl.getValueState()===E.Warning&&this.oControl.getValueStateText&&this.oControl.getValueStateText()===x){return}if(!this._oTemplate||!this.oControl.data("_hassuggestionTemplate")){this._createSuggestionTemplate()}var e=t.getParameter("suggestValue");this._fetchData(e)}.bind(this);this.oControl.attachSuggest(this._fSuggest);if(!this.oFilterModel){var t=this;var e=this.oControl.setParent;this.oControl.setParent=function(i,o,s){var r=this.getParent();var n=e.apply(this,arguments);i=this.getParent();var a=!(i&&r===null);if(i!==r&&a){t.unbindAggregation()}return n}}this._handleSelect()}this.oControl.setModel(new f,O);this._setupHistoryValues();this._setupRecommendations()};k.prototype._onMetadataInitialised=function(){if(this.bInitialised){if(this.oAfterRenderingEventDelegate){this.oControl.removeEventDelegate(this.oAfterRenderingEventDelegate)}if(this.oPrimaryValueListAnnotation){this._oPresentationVariant=this._handlePresentationVariantSortOrderAnnotation();if(this.sAggregationName&&this.sAggregationName=="suggestionRows"){this._createSuggestionTemplate()}else{this._createDropDownTemplate()}this._fetchData();if(this._isControlDropdown()){if(this.mOutParams&&Object.keys(this.mOutParams).length>1){this._handleOutParameters()}if(this.mInParams&&Object.keys(this.mInParams).length>1){this._handleInParameters()}}}else{I.error("ValueListProvider","Missing primary ValueListAnnotation for "+(this._sFullyQualifiedFieldName||this.sFieldName))}if(this.oAfterRenderingEventDelegate){delete this.oAfterRenderingEventDelegate}}};k.prototype._onAnnotationLoad=function(t){var e=p.prototype._onAnnotationLoad.call(this,t);if(!this._isControlSupportedForHistory(this.oControl)){return e}if(this._shouldHaveRecommendations()||this._shouldHaveHistory()){this._oHistoryValuesProvider?.getHistoryEnabled().then(t=>{if(t){this._setupSuggestionInteractions()}})}if(this.sContext==="SmartFilterBar"&&this._hasNotValidatedSingleField(this.sFieldName)){this._validateInput(this.oFilterProvider._oNotValidatedSingleFields[this.sFieldName],undefined,true);this.oFilterProvider._oNotValidatedSingleFields[this.sFieldName]=""}return e};k.prototype._isSortable=function(t){if(this.oPrimaryValueListAnnotation){for(var e=0;e<this.oPrimaryValueListAnnotation.valueListFields.length;e++){if(this.oPrimaryValueListAnnotation.valueListFields[e].name===t){return this.oPrimaryValueListAnnotation.valueListFields[e].sortable!==false}}return false}return false};k.prototype._createDropDownTemplate=function(){if(this.dropdownItemKeyType&&this.dropdownItemKeyType.oFormatOptions){this.dropdownItemKeyType.oFormatOptions.bFixedKey=true}var t=[{path:this._resolveSuggestionBindingPath(this.sKey),type:this.dropdownItemKeyType}],e=this.sValueListsDDLBDisplayBehaviour||this.sDDLBDisplayBehaviour,i=this.oControl.getBinding("realValue")&&this.oControl.getBinding("realValue").getType();if(this.oControl.isA("sap.ui.comp.IDropDownTextArrangement")&&this.sValueListsDDLBDisplayBehaviour&&this.sValueListsDDLBDisplayBehaviour!==this.sDDLBDisplayBehaviour){this.oControl.setTextArrangement(this.sDDLBDisplayBehaviour)}if(this.sDescription){t.push({path:this._resolveSuggestionBindingPath(this.sDescription)})}if(this.sContext==="SmartField"&&s.getIsTimezoneProperty(this._fieldViewMetadata)){this._oTemplate=new g({key:{path:this._resolveSuggestionBindingPath(this.sKey),parts:[{value:null},{path:this._resolveSuggestionBindingPath(this.sKey)}],type:this.dropdownItemKeyType||i},text:{parts:[{value:null},{path:this._resolveSuggestionBindingPath(this.sKey)}],type:this.dropdownItemKeyType||i}})}else{this._oTemplate=new g({key:{path:this._resolveSuggestionBindingPath(this.sKey),type:this.dropdownItemKeyType},text:{parts:t,formatter:function(t,i){var o=y.getFormatterFunctionFromDisplayBehaviour(e),s=o(t,i);return T(s)}}})}if(this._oRecommendationListAnnotation){this._oTemplate.bindProperty("additionalText",{path:this._resolveSuggestionBindingPath(this._oRecommendationListAnnotation.rankProperty)})}this._oSorter=null;var o=this._isSortable(this.sKey),r=this._isSortable(this.sDescription);if(this._oPresentationVariant){if(this._oPresentationVariant._bIsPresentationVariantSortPathInVHDEntityType&&this._oPresentationVariant._bIsPresentationVariantSortOrderPropertySortable){this._oSorter=new m(this._oPresentationVariant.sPresentationVariantSortPath,this._oPresentationVariant.sortOrderFields[0].descending)}else{I.error("ValueListProvider","Is Presentation Variant SortOrder property path part of EntityType = "+this._oPresentationVariant._bIsPresentationVariantSortPathInVHDEntityType+". Is property sortable ="+this._oPresentationVariant._bIsPresentationVariantSortOrderPropertySortable)}}else{if(this.sDDLBDisplayBehaviour===R.idOnly||this.sDDLBDisplayBehaviour===R.idAndDescription||this.sDDLBDisplayBehaviour===R.descriptionAndId){if(o){this._oSorter=new m(this.sKey)}}else{if(r){this._oSorter=new m(this.sDescription)}else if(this.sDescription!==this.sKey&&o){this._oSorter=new m(this.sKey)}}}};k.prototype._createSuggestionTemplate=function(){var t=0,e=0,i=0,o=this._aHighImportanceCols||this._aRecommendationCols||this._aCols,s;this._oTemplate=new h;if(o){this.oControl.removeAllSuggestionColumns();e=o.length;for(t=0;t<e;t++){var r=false,n="1px",a=o[t].suggestionsWidth;if(V.system.phone){a=undefined;if(t>=2){r=true;n=(t+1)*10+"rem"}}this.oControl.addSuggestionColumn(new l({header:new w({wrapping:true,wrappingType:M.Hyphenated,text:o[t].label}),demandPopin:r,popinDisplay:H.Inline,minScreenWidth:n,width:a}));if(o[t].isTimezone){s={path:this._resolveSuggestionBindingPath(o[t].template),parts:[{value:null},{path:this._resolveSuggestionBindingPath(o[t].template)}],type:o[t].oType}}else{s={path:this._resolveSuggestionBindingPath(o[t].template),type:o[t].oType,formatter:function(t){return T(t)}}}if(Array.isArray(o[t].template)){s={parts:[{path:this._resolveSuggestionBindingPath(o[t].template[0])},{path:this._resolveSuggestionBindingPath(o[t].template[1])}],formatter:function(t,e,i){var o=y.getFormatterFunctionFromDisplayBehaviour(t),s=o(e,i);return T(s)}.bind(this,o[t].displayBehaviour)}}this._oTemplate.addCell(new w({wrapping:true,text:s}));if(a){i+=parseFloat(a.substring(0,a.length-2))}}if(i>0){this.oControl.setProperty("maxSuggestionWidth",i+e+"em",true)}if(e===1){this.oControl._setSeparateSuggestions(false)}}this.oControl.data("_hassuggestionTemplate",true);if(this.oControl&&this.oControl._oSuggestionTable){this.oControl._oSuggestionTable.addStyleClass("sapUiCompValueListProviderTable")}};k.prototype._handleRowSelect=function(t,e,i){var o,s,r,n=i&&typeof i.getPath==="function"&&i.getPath()||"";if(t){o=t[this.sKey];s=t[this.sDescription]}if(o||o===""){if(this.oControl.addToken){s=T(y.getFormattedExpressionFromDisplayBehaviour(this.sTokenDisplayBehaviour,o,s));r=new d;r.setKey(o);r.setText(s);r.setTooltip(s);r.data("row",t);if(this.oControl.getMetadata()&&this.oControl.getMetadata()?.getName()==="sap.ui.comp.smartfilterbar.SFBMultiInput"){r.getTextForCopy=this.oControl._getTextForCopy.bind(this.oControl,r)}if(e){e(r)}if(this.oControl.getValue()===""){this.oControl.setValue("")}delete this.oControl.__sValidationText}else{if(this.sContext==="SmartField"&&this._selectedODataRowHandler){this._selectedODataRowHandler(o,t,n)}this.setValue(o);if(this.sContext==="SmartFilterBar"||this.sContext==="mdcFilterPanel"){this.oControl.setValue(y.getFormattedExpressionFromDisplayBehaviour(this.sSingleFieldDisplayBehaviour,o,s));this.oControl.setValueState("None");this.oFilterProvider.oModel.setProperty("/"+this.sFieldName,o);this.oFilterProvider._setSingleInputsTextArrangementFieldData(this.sFieldName,o,s);if(!this.oFilterProvider._oSingleFieldSetFromFilterData[this.sFieldName]){this.oControl.fireChange({value:o,validated:true})}delete this.oFilterProvider._oSingleFieldSetFromFilterData[this.sFieldName]}if(this.sContext!=="SmartFilterBar"){this.oControl.fireChange({value:o,validated:true})}}}if(this.fnAsyncWritePromise){this.fnAsyncWritePromise().then(this._calculateAndSetFilterOutputData.bind(this,[t]))}else{this._calculateAndSetFilterOutputData([t])}};k.prototype._multiInputValidator=function(t){if(!this.bInitialised){return}if(this._aValidators){var e;this._aValidators.some(function(i){e=i(t);return e},this);if(e){return e}}var i=t.suggestionObject,o,s=t.text;if(i){var r=this._getSuggestionsModelName(),n=i.getBindingContext(r);o=n.getObject();this._handleRowSelect(o,t.asyncCallback,n)}else if(s){this._validateInput(s,t.asyncCallback)}};k.prototype._resetErrorState=function(){if(this.oControl.data("__validationError")){this.oControl.data("__validationError",null);this.oControl.setValueStateText("");this.oControl.setValueState("None")}};k.prototype._setErrorState=function(){this.oControl.setValueStateText(this._oResourceBundle.getText("VALUELIST_NOT_UNIQUE_ERROR"));this.oControl.setValueState(E.Error);this.oControl.data("__validationError",true)};k.prototype._onFilterError=function(t,e){this._resetErrorState();delete this.oControl.__bValidatingToken;if(!e){this._afterTokenValidate()}t()};k.prototype._onFilterSuccess=function(t,e,i,o,s,r,n){var a,l=t;if(!this.oControl||!this._pendingValidationCount&&!this.oControl.hasOwnProperty("__bValidatingToken")){return}delete this.oControl.__bValidatingToken;this._pendingValidationCount--;if(t){if(t.results?.length===1){this.oControl._iDescriptionCount=1;l=t.results[0];this._resetErrorState()}else if(s&&this.sContext==="SmartFilterBar"){this._pendingValidationCount++;a=new Promise(function(t,i){this.oODataModel.read("/"+this.sValueListEntitySetName,{filters:r,urlParameters:n,success:function(i){this._onFilterSuccess(i,e,t,o)}.bind(this),error:function(){this._onFilterError(t,o)}.bind(this)})}.bind(this));this._removeValidationPromise(this._aValidationPromises.length-1);this._addValidationPromise(a)}else if(!s&&t.results?.length>1){this.oControl._iDescriptionCount=t.results.length;if(this.sContext==="SmartFilterBar"&&this._fieldViewMetadata.filterRestriction==="single"){if(t.results.length>1){this.oFilterProvider.oModel.setProperty("/"+this.sFieldName,t.results[0][this.sKey])}if(!l.results){this._oHistoryValuesProvider&&this._oHistoryValuesProvider.setFieldData([l])}}this._resetErrorState()}else{this._setErrorState()}if(l&&l[this.sKey]){this.oControl._pendingAutoTokenGeneration=true;this._handleRowSelect(l,e);this.oControl._pendingAutoTokenGeneration=false}}if(!o){this._afterTokenValidate()}i()};k.prototype._validateInput=function(t,e,i){var o,s=[],r=this.oControl,n,a,l=false;if(this.sDisplayFormat==="UpperCase"){t=t.toUpperCase()}if(r.__sValidationText!==t){r.__sValidationText=t;if(t===this._truncateSearchText(t)){r.__bValidatingToken=true;this._calculateFilterInputData();if(this.mFilterInputData&&this.aFilterField){var h={dateSettings:this._oDateFormatSettings};if(this.oFilterProvider){h.useContainsAsDefault=this.oFilterProvider._bUseContainsAsDefault;h.stringFields=this.oFilterProvider._aFilterBarStringFieldNames;h.timeFields=this.oFilterProvider._aFilterBarTimeFieldNames;h.dateTimeOffsetValueFields=this.oFilterProvider._aFilterBarDateTimeFieldNames;h.dateTimeOffsetWithTimeZone=this.oFilterProvider._aFilterBarDateTimeOffsetWithTimezoneFieldNames;h.viewMetadataData=this.oFilterProvider._aFilterBarViewMetadata}s=B.generateFilters(this.aFilterField,this.mFilterInputData,h)}if(this._getDisplayBehaviour()==="descriptionOnly"&&this.sDescription&&this.sContext==="SmartFilterBar"){a=this.sDescription;l=true}else{a=this.sKey}s.push(new c(a,_.EQ,t));if(this.bSupportBasicSearch){n={"search-focus":a}}if(!e){this._abortPendingValidations()}this._pendingValidationCount++;o=new Promise(function(o,r){this._oValidationRead=this.oODataModel.read("/"+this.sValueListEntitySetName,{filters:s,urlParameters:n,success:function(r){if(l&&r.results?.length!==1){s.splice(s.length-1,1,new c(this.sKey,_.EQ,t))}this._onFilterSuccess(r,e,o,i,l,s,n)}.bind(this),error:function(){this._onFilterError(o,i)}.bind(this)})}.bind(this));this._addValidationPromise(o)}else if(this.sContext==="SmartFilterBar"&&this._fieldViewMetadata.filterRestriction==="single"){this._setErrorState()}}else{if(r.data("__validationError")){this._setErrorState()}}};k.prototype._fetchSingleFieldDescription=function(t){var e=[],i;if(this.sDisplayFormat==="UpperCase"){t=t.toUpperCase()}if(t===this._truncateSearchText(t)){this._calculateFilterInputData();if(this.mFilterInputData&&this.aFilterField){e=B.generateFilters(this.aFilterField,this.mFilterInputData)}e.push(new c(this.sKey,_.EQ,t));if(this.bSupportBasicSearch){i={"search-focus":this.sKey}}this._abortPendingValidations();this._oSingleFieldDescriptionRead=this.oODataModel.read("/"+this.sValueListEntitySetName,{filters:e,urlParameters:i,success:function(t){if(!this.oControl){return}if(t?.results&&t?.results?.length===1){this.oControl._iDescriptionCount=1;if(this.oControl.data("__validationError")){this.oControl.data("__validationError",null);this.oControl.setValueState("None")}var e=t.results[0],i=e[this.sKey],o=e[this.sDescription];Promise.all(this._aValidationPromises).then(()=>{this.oControl.setValue(y.getFormattedExpressionFromDisplayBehaviour(this.sSingleFieldDisplayBehaviour,i,o));this.oFilterProvider.oModel.setProperty("/"+this.sFieldName,i)})}else{this.oControl._iDescriptionCount=t?.results?.length||0;this.oControl.setValueState("Error");this.oControl.data("__validationError",true)}}.bind(this)})}};k.prototype._validateStringSingleWithValueList=function(t){var e,i;if(t.getParameter("validated")){return}e=t.getParameter("value");if(e===""||e===undefined){return}if(this.sSingleFieldDisplayBehaviour==="idAndDescription"){i=/^([\S\s]+?)\s\([\S\s]+\)$/.exec(e)}else if(this.sSingleFieldDisplayBehaviour==="descriptionAndId"){i=/^[\S\s]+\s\(([\S\s]+?)\)$/.exec(e)}if(Array.isArray(i)&&i[1]){e=i[1]}this._validateInput(e)};k.prototype._abortPendingValidations=function(){if(this._oSingleFieldDescriptionRead?.abort){this._oSingleFieldDescriptionRead.abort()}if(this._oValidationRead?.abort&&this._pendingValidationCount>0){this._oValidationRead.abort();this._pendingValidationCount--}};k.prototype._afterTokenValidate=function(){if(this.oFilterProvider&&this.oFilterProvider._oSmartFilter&&this.oFilterProvider._oSmartFilter.bIsSearchPending&&this.oFilterProvider._oSmartFilter.search){if(this.oFilterProvider._oSmartFilter.getLiveMode&&this.oFilterProvider._oSmartFilter.getLiveMode()){return}this.oFilterProvider._oSmartFilter.search()}};k.prototype._onSuggestionItemSelected=function(t){var e,i=t.getParameter("selectedRow");if(i){var o=this._getSuggestionsModelName();e=i.getBindingContext(o);this._handleRowSelect(e.getObject(),null,e)}};k.prototype._setFilterOutputDataFromSelectedRow=function(t){var e,i,o;if(t){e=this._getSuggestionsModelName();i=t.getBindingContext(e);o=i.getObject();this._calculateAndSetFilterOutputData([o])}};k.prototype._onMultiComboBoxItemSelected=function(t){if(!t.getParameter("selected")){return}var e=t.getParameter("changedItem");this._setFilterOutputDataFromSelectedRow(e)};k.prototype._onComboBoxItemSelected=function(t){var e=t.getParameter("value"),i=t.getParameter("newValue"),o=t.getParameter("filterChangeReason");if(o&&!e&&!i){return}var s=this.oControl.getSelectedItem();this._setFilterOutputDataFromSelectedRow(s)};k.prototype._handleSelect=function(){if(this.oControl.addValidator){this._aValidators=this.oControl&&this.oControl.isA("sap.m.MultiInput")?this.oControl.getValidators().slice():[];this.oControl.removeAllValidators();this._fValidator=this._multiInputValidator.bind(this);this.oControl.addValidator(this._fValidator)}else if(this.oControl.attachSuggestionItemSelected){this.oControl.attachSuggestionItemSelected(this._onSuggestionItemSelected,this)}if(this.oControl.setRowResultFunction){this.oControl.setRowResultFunction(function(t){var e,i="",o=this._getSuggestionsModelName();if(t){e=t.getBindingContext(o)}if(e&&this.sKey){i=e.getProperty(this.sKey)}if(i&&this.sContext=="SmartField"&&s.getIsTimezoneProperty(this._fieldViewMetadata)){i=this.oControl.getBinding("value").getType().formatValue([null,i],"string")}return i}.bind(this))}};k.prototype._filterDropdownRowsByInParameters=function(){this._calculateFilterInputData();if(this.mFilterInputData&&this.aFilterField&&this.aFilterField.length>0){this._fetchData();this._mLastFilterInputData=this.mFilterInputData;if(!this.oControl.isA("sap.m.Select")){this._cleanupControlSelection()}}};k.prototype.isInSmartFilterBar=function(){return!!this.oFilterModel};k.prototype.isDisableSearchMatchesPatternWarning=function(){if(this._disableSearchMatchesPatternWarning===undefined&&this.isInSmartFilterBar()&&this.oFilterProvider&&this.oFilterProvider._oSmartFilter){this._disableSearchMatchesPatternWarning=this.oFilterProvider._oSmartFilter.getDisableSearchMatchesPatternWarning()}return this._disableSearchMatchesPatternWarning};k.prototype._isControlDropdown=function(t){if(!t){t=this.oControl}return!!(t.isA("sap.m.MultiComboBox")||t.isA("sap.m.ComboBox"))||t.isA("sap.m.Select")};k.prototype._cleanupControlSelection=function(){if(this.oControl.isA("sap.m.MultiComboBox")){this.oControl.setSelectedKeys(null);if(this.isInSmartFilterBar()){this.oFilterModel.setProperty("/"+this.sFieldName+"/items",[])}}else{this.oControl.setSelectedKey(null);this.oControl.clearSelection()}};k.prototype._openDropdown=function(){if(this.oControl.isA("sap.m.MultiComboBox")){P.prototype.open.apply(this.oControl,arguments)}else if(this.oControl.isA("sap.m.ComboBox")){F.prototype.open.apply(this.oControl,arguments)}else if(this.oControl.isA("sap.m.Select")){D.prototype.open.apply(this.oControl,arguments)}};k.prototype._handleOutParameters=function(){if(this.oControl.isA("sap.m.MultiComboBox")){this.oControl.attachSelectionChange(this._onMultiComboBoxItemSelected,this)}else if(this.oControl.isA("sap.m.ComboBox")||this.oControl.isA("sap.m.Select")){this.oControl.attachChange(this._onComboBoxItemSelected,this)}};k.prototype._handleInParameters=function(){this.oControl.setBusyIndicatorDelay(0);this._calculateFilterInputData();this._mLastFilterInputData=this.mFilterInputData;this.oControl.open=function(){this._calculateFilterInputData();if(b(this._mLastFilterInputData,this.mFilterInputData)){this._openDropdown();return}this._filterDropdownRowsByInParameters();this._openDropdown()}.bind(this);this.oControl.addEventDelegate({onmousedown:function(t){if(this.oControl.getArrowIcon&&t.target===this.oControl.getArrowIcon().getFocusDomRef()){this._bSkipFocusIn=true}}.bind(this),onmouseup:function(t){if(this._bSkipFocusIn&&(this.oControl.getArrowIcon&&t.target===this.oControl.getArrowIcon().getFocusDomRef())){this.oControl.open()}this._bSkipFocusIn=false}.bind(this),onfocusin:function(t){if(this._bSkipFocusIn){return t}setTimeout(function(){this._calculateFilterInputData();if(b(this._mLastFilterInputData,this.mFilterInputData)){return}this._filterDropdownRowsByInParameters()}.bind(this));return t}.bind(this)})};k.prototype._updateBindings=function(){this._calculateFilterInputData();if(!this._mLastFilterInputData||b(this._mLastFilterInputData,this.mFilterInputData)){return}this._filterDropdownRowsByInParameters()};k.prototype._primaryValueListAnnotationChanged=function(t){var e=this.oControl,i=this._oMetadataAnalyser,o,s,r=[],n=e.getBindingContext()&&e.getBindingContext().getPath();if(n){o=e.getModel()&&e.getModel().getContext(n);s=i.getPropertyContextByPath(this._sFullyQualifiedFieldName);r=i._getODataValueListRelevantQualifiers(s,o)}if(r.length>0&&(!r.includes(this.oPrimaryValueListAnnotation.qualifier)||r.includes("")&&this.oPrimaryValueListAnnotation.qualifier!=="")){i.getValueListAnnotationLazy(this._sFullyQualifiedFieldName,n).then(function(i){if(e.oParent&&e.oParent._oFactory){e.oParent._oFactory._initValueList(i)}this._onAnnotationLoad(i);this._rebindInnerControlSuggestions();this._fetchData(t)}.bind(this));return true}return false};k.prototype._prepareValueListSearchParameters=function(t){var e={},i=[],o,r=this._getBindingLength(),n="";if(s.hasValueListRelevantQualifiers(this._fieldViewMetadata)&&this._primaryValueListAnnotationChanged(t)){return}if(this.sDDLBDisplayBehaviour==="descriptionOnly"&&this.sDescription){o=this.sDescription}else{o=this.sKey}t=t||"";if(this.bTypeAheadEnabled){if(t&&this.sDisplayFormat==="UpperCase"){t=t.toUpperCase()}if(this.bSupportBasicSearch){if(this._shouldHaveRecommendations()||this._shouldHaveHistory()){e={"search-focus":o,search:t}}else{e.custom={"search-focus":o,search:t}}}this._calculateFilterInputData();if(this.mFilterInputData&&this.aFilterField){i=B.generateFilters(this.aFilterField,this.mFilterInputData,{dateSettings:this._oDateFormatSettings})}if(!this.bSupportBasicSearch){if(this._fieldViewMetadata&&this._fieldViewMetadata.filterType==="numc"){i.push(new c(o,_.Contains,t))}else{n=this._truncateSearchText(t);if(n===t){i.push(new c(o,_.StartsWith,n))}}}r=10}e["$top"]=r;e["$skip"]=0;if(!this.sValueListEntitySetName){I.error("ValueListProvider","Empty sValueListEntitySetName for "+this.sAggregationName+" binding! (missing primaryValueListAnnotation)")}if(this.sDeferredGroupId){e["batchGroupId"]=this.sDeferredGroupId}if(this.aSelect&&this.aSelect.length){e["$select"]=this.aSelect.toString()}return{mParams:e,aFilters:i,sSearchTextTruncated:n,length:r}};k.prototype._fetchData=function(t){var{mParams:e,aFilters:i,sSearchTextTruncated:o,length:s}=this._prepareValueListSearchParameters(t),r,n,a;if(this.bTypeAheadEnabled&&!this.bSupportBasicSearch&&!(this._fieldViewMetadata&&this._fieldViewMetadata.filterType==="numc")&&!(o===t)){this.oControl.closeSuggestions();return}if(!(this._shouldHaveRecommendations()||this._shouldHaveHistory())||!this._isControlSupportedForHistory(this.oControl)){if(this.bTypeAheadEnabled&&this.bEnableShowTableSuggestionValueHelp&&this._isSuggestionEnabled()){n={dataReceived:function(t){var e=t.getSource(),i;if(e){i=e.getLength();if(i&&i<=s){this.oControl.setShowTableSuggestionValueHelp(false)}else if(!this.bShowAllSuggestionsButton){this.oControl.setShowTableSuggestionValueHelp(false)}else{this.oControl.setShowTableSuggestionValueHelp(true)}}}.bind(this)}}else if(!this._isSuggestionEnabled()&&this.oControl.setShowTableSuggestionValueHelp&&this.oControl.setShowSuggestion){this.oControl.setShowTableSuggestionValueHelp(false);this.oControl.setShowSuggestion(false)}else if(this.bTypeAheadEnabled){this.oControl.setShowTableSuggestionValueHelp(false)}if(this.aSelect&&this.aSelect.length){e["select"]=this.aSelect.toString();delete e["$select"]}if(this._isControlDropdown(this.oControl)&&(this.mInParams&&Object.keys(this.mInParams).length>=1||this.mConstParams&&Object.keys(this.mConstParams).length>=1)){if(!n){a=new L;this.oControl.data("__dataReceivedPromise",a.promise);this.oControl.setBusy(true);n={dataReceived:function(t){a.resolve();this.oControl.setBusy(false);this._resetValueState(t);this._applyValueIfNeeded()}.bind(this)}}this._calculateFilterInputData();if(this.mFilterInputData&&this.aFilterField){i=B.generateFilters(this.aFilterField,this.mFilterInputData,{dateSettings:this._oDateFormatSettings,viewMetadataData:this._createViewMetadataData()})}}this.oControl.bindAggregation(this.sAggregationName,{path:"/"+this.sValueListEntitySetName,length:s,parameters:e,filters:i,sorter:this._oSorter,events:n,template:this._oTemplate,templateShareable:true});return}this._bindInnerControlSuggestions();var l=this;r=new Promise(function(t,o){if(!l.sValueListEntitySetName||!l._isSuggestionEnabled()&&!l._isControlDropdown()){t({results:[]});return}if(!l._isSuggestionEnabled()){t({results:[]});return}l.oODataModel.read("/"+l.sValueListEntitySetName,{urlParameters:e,filters:i,sorters:l._oSorter&&[l._oSorter],success:function(e){t(e)},error:function(t){o(t)}})});var h=Promise.resolve([]);if(this._shouldHaveHistory()){h=l._oHistoryValuesProvider.getFieldData()}Promise.all([r,this._oRecommendationListPromise,h]).then(function(t){var e=[],i=[],o=[],r=[],n=l._getSuggestionsModelName(),a=l.oControl;if(!a){return}var h=a.getModel(n);if(Array.isArray(t[0]&&t[0].results)){i=l._addSuggestionsToGroup(t[0].results,N.Others)}if(Array.isArray(t[1]&&t[1].results)){o=l._addSuggestionsToGroup(t[1].results,N.Recommendations)}if(l._shouldHaveHistory()&&Array.isArray(t[2])){r=l._addSuggestionsToGroup(t[2],N.RecentlyUsed);r=l._parseHistoryJsonDates(r)}e=e.concat(o).concat(r).concat(i);e=l._getDistinctSuggestions(e);e=e.filter(l._filterSuggestionsWithInParams.bind(l,l.mFilterInputData));l._showSuggestionsMoreButton(i.length>=s);if(l.oControl.isA("sap.m.MultiInput")){l.oControl._oSuggPopover._oProposedItem=null}h.setData(e)})};k.prototype._getSuggestionsData=function(){return new Promise((t,e)=>{var{mParams:i,aFilters:o}=this._prepareValueListSearchParameters();if(this._isControlDropdown(this.oControl)&&(this.mInParams&&Object.keys(this.mInParams).length>=1||this.mConstParams&&Object.keys(this.mConstParams).length>=1)){this._calculateFilterInputData();if(this.mFilterInputData&&this.aFilterField){o=B.generateFilters(this.aFilterField,this.mFilterInputData,{dateSettings:this._oDateFormatSettings,viewMetadataData:this._createViewMetadataData()})}}this.oODataModel.read("/"+this.sValueListEntitySetName,{urlParameters:i,filters:o,sorters:this._oSorter&&[this._oSorter],success:e=>{t(e.results.map(t=>({key:t[this.sKey],description:t[this.sDescription]})))},error:function(t){e(t)}})})};k.prototype._createViewMetadataData=function(){var t=this.mConstParams&&Object.keys(this.mConstParams),e=this.oPrimaryValueListAnnotation.aInitialValueIsSignificantFields,i=[];if(Array.isArray(this.aFilterField)&&this.aFilterField.length>0){i=this.aFilterField.map(function(i){var o={};o.name=i;o.fieldName=i;o.isConstant=Array.isArray(t)&&t.indexOf(i)!==-1;o.isInitialValueSignificant=Array.isArray(e)&&e.indexOf(i)!==-1;return o})}return[{fields:i}]};k.prototype._resetValueState=function(t){var e=t.getParameter("data"),i=e&&e.results,o;if(this.oControl.isA("sap.m.ComboBox")&&i){for(o=0;o<i.length;o++){if(i[o][this.sKey]==this.oControl.getSelectedKey()&&this.oControl.getValueState()===E.Error){this.oControl.setValueState(E.None)}}}};k.prototype._applyValueIfNeeded=function(){var t=this.oControl,e,i,o;if(!t.isA("sap.m.ComboBox")){return}e=t.getKeys();i=t.getSelectedKey();o=t.getValue();if(o&&!i&&e.indexOf(o)!==-1){t.setSelectedKey(o)}};k.prototype._isSuggestionEnabled=function(){return this._bSuggestionsEnabled};k.prototype._sortRecommendations=function(t,e){var i=this._oRecommendationListAnnotation.rankProperty,o=parseFloat(t[i]),s=parseFloat(e[i]);return s-o};k.prototype._showSuggestionsMoreButton=function(t){if(!this.bTypeAheadEnabled){return}if(this.bEnableShowTableSuggestionValueHelp){this.oControl.setShowTableSuggestionValueHelp(t)}else{this.oControl.setShowTableSuggestionValueHelp(false)}};k.prototype._addSuggestionsToGroup=function(t,e){if(!t){return[]}return t.map(function(t){var i={};i[v.getSuggestionsGroupPropertyName()]=e;return Object.assign({},t,i)})};k.prototype._groupHeaderFactory=function(t){var e=this._getGroupHeaderTitle(t.key);if(this._isControlDropdown()){return new n({key:v.getHistoryPrefix()+t.key+".key",text:e})}return new a({title:e})};k.prototype._getGroupHeaderTitle=function(t){switch(t){case N.Recommendations:return this._oResourceBundle.getText("VALUELIST_RECOMMENDATIONS_TITLE");case N.RecentlyUsed:return this._oResourceBundle.getText("VALUELIST_RECENTLY_USED_TITLE");default:return this._oResourceBundle.getText("VALUELIST_OTHERS_TITLE")}};k.prototype._getGroupHeaderSorter=function(){if(this._groupHeaderSorter){return this._groupHeaderSorter}this._groupHeaderSorter=new m({path:v.getSuggestionsGroupPropertyName(),descending:false,group:function(t){return t.getProperty(v.getSuggestionsGroupPropertyName())}});return this._groupHeaderSorter};k.prototype._getDistinctSuggestions=function(t){var e={},i=[],o=this._aHighImportanceCols||this._aCols,s=o&&o.reduce(function(t,e){return t.concat(e.template)},[]);if(!s&&t.length>0){s=Object.keys(t[0])}t.forEach(function(t){var o=s.reduce(function(e,i){e.push([i,t[i]]);return e},[]);var r=o.toString();if(!e[r]){i.push(t);e[r]={index:i.length-1}}else if(e[r]&&Number.isInteger(e[r].index)){var n=e[r].index,a=i[n][v.getSuggestionsGroupPropertyName()];if(a!==N.Others){i[e[r].index][v.getForcedVisiblePropertyName()]=true}}},this);return i};k.prototype._resolveRecommendationListAnnotationData=function(t){var e=t.fieldsToDisplay,i,o,s;this._aRecommendationCols=[];this.aRecommendationSelect=[];for(var r=0;r<e.length;r++){i=e[r];o=this._getColumnConfigFromField(i);if(i.visible){this._aRecommendationCols.push(o);this.aRecommendationSelect.push(i.name)}}if(this._aHighImportanceCols&&this._oRecommendationListAnnotation){s=this._oRecommendationListAnnotation.rankField[0];s=this._getColumnConfigFromField(s);this._aHighImportanceCols.push(s)}};k.prototype._setupRecommendations=function(){if(!this._shouldHaveRecommendations()||!this._isControlSupportedForHistory(this.oControl)){return}this._resolveRecommendationListAnnotationData(this._getRecommendationListAnnotation());this._fetchRecommendations()};k.prototype._shouldHaveRecommendations=function(){return s.isRecommendationList(this._fieldViewMetadata)};k.prototype._getRecommendationListAnnotation=function(){if(!this._oRecommendationListAnnotation){var t=this._oMetadataAnalyser._getRecommendationListAnnotation(this._sFullyQualifiedFieldName);this._oRecommendationListAnnotation=this._oMetadataAnalyser._enrichRecommendationListAnnotation(t)}return this._oRecommendationListAnnotation};k.prototype._fetchRecommendations=function(){var t=this;this._oRecommendationListPromise=new Promise(function(e,i){t.oODataModel.read("/"+t._oRecommendationListAnnotation.path,{urlParameters:{$skip:0,$top:5,$select:t.aRecommendationSelect.toString()},sorter:t._oSorter,success:function(i){var o=t._addSuggestionsToGroup(i.results,N.Recommendations),s=t._getSuggestionsModelName(),r=t.oControl.getModel(s),n=r.getData(),a=o.sort(t._sortRecommendations.bind(t));t._aRecommendations=a;if(Array.isArray(n)){a=[].concat(n).concat(a)}r.setData(a);t._showSuggestionsMoreButton(false);e(i)},error:function(t){i(t)}})})};k.prototype._createHistoryValuesProvider=function(){return new S(this.oControl,this._sFullyQualifiedFieldName)};k.prototype._createHistoryOptOutProvider=function(){return C.createOptOutSettingPage()};k.prototype._setupHistoryValues=function(){if(!this._shouldHaveHistory()||!this._isControlSupportedForHistory(this.oControl)){return}this._oHistoryValuesProvider=this._createHistoryValuesProvider();this._createHistoryOptOutProvider();this._oHistoryValuesProvider.getHistoryEnabled().then(function(t){if(!t||!this._oHistoryValuesProvider){return}this._oHistoryValuesProvider.attachChangeListener();this._oHistoryValuesProvider.attachEvent("fieldUpdated",this._onHistoryFieldUpdated,this);this._oHistoryValuesProvider.getFieldData().then(this._onHistoryDataInitialized.bind(this))}.bind(this))};k.prototype._onHistoryDataInitialized=function(t){this._updateModelHistoryData(t);return t};k.prototype._onHistoryFieldUpdated=function(t){var e=t.getParameter("fieldData")||[];if(this.oControl.isA("sap.m.Input")){this._updateModelHistoryData(e);setTimeout(function(){this.oControl&&this.oControl._oSuggPopover._oPopover.close()}.bind(this),50);return}this._updateModelHistoryData(e);if(this.oControl.isA("sap.m.ComboBox")){setTimeout(function(){this.oControl&&this.oControl._oSuggestionPopover._oPopover.close()}.bind(this))}};k.prototype._updateModelHistoryData=function(t){if(!this.oControl){return}t=this._parseHistoryJsonDates(t);var e=[],i=this._addSuggestionsToGroup(t,N.RecentlyUsed),o=this._getSuggestionsModelName(),s=this.oControl.getModel(o),r=s.getData();if(!Array.isArray(r)){r=[]}e=this._getDistinctSuggestions(e.concat(i).concat(r));s.setData(e);this._showSuggestionsMoreButton(false)};k.prototype._getShellConfig=function(){var t=window["sap-ushell-config"];if(t){return t.apps}return null};k.prototype._getSuggestionsEnabled=function(){var t=this._getShellConfig(),e;if(t){e=t.inputFieldSuggestions}if(e){return e.enabled}return true};k.prototype._getUShellContainer=function(){return sap.ui.require("sap/ushell/Container")};k.prototype._shouldHaveHistory=function(){if(!this._fieldHistoryEnabled||!this._fieldViewMetadata||!this._sFullyQualifiedFieldName||!this.oControl||this._isControlDropdown()&&(this._fieldHistoryEnabledInitial||this._fieldHistoryEnabledInitial===undefined)&&this._fieldHistoryEnabled){return false}var t=this._getShellConfig(),e,i;if(t){e=t.inputFieldHistory}if(e){i=e.enabled}var o=this._getUShellContainer();return o&&i&&!s.isPotentiallySensitive(this._fieldViewMetadata)};k.prototype._bindInnerControlSuggestions=function(){if(this.sAggregationName&&this.oControl.isBound(this.sAggregationName)){return}this._rebindInnerControlSuggestions()};k.prototype._rebindInnerControlSuggestions=function(){if(this.sAggregationName&&this.sAggregationName==="suggestionRows"){this._createSuggestionTemplate()}else{this._createDropDownTemplate()}var t={path:this._getSuggestionsModelName()+">/",template:this._oTemplate,templateShareable:true,length:this._getBindingLength()};t.groupHeaderFactory=this._groupHeaderFactory;t.sorter=this._getGroupHeaderSorter();if(this.sAggregationName){this.oControl.bindAggregation(this.sAggregationName,t)}};k.prototype._setupSuggestionInteractions=function(){if(this.sAggregationName==="suggestionRows"){this._setupInputSuggestionInteractions();return}this._setupComboBoxSuggestionInteractions()};k.prototype._setupInputSuggestionInteractions=function(){var t=this.oControl;t.setFilterSuggests(true);t.setFilterFunction(function(t,e){var i=this._getSuggestionsModelName(),o=e.getBindingContext(i).getObject(),s=o[this.sKey],r=o[this.sDescription],n=y.getFormatterFunctionFromDisplayBehaviour(this.sDDLBDisplayBehaviour),a=n(s,r);if(o[v.getForcedVisiblePropertyName()]||o[v.getSuggestionsGroupPropertyName()]===N.Others){return true}t=t.replace(/\*$/,"");t=t.replace(/^\*/,"");var l=Object.keys(o).some(function(e){var i=o[e]+"";return i.toLowerCase().indexOf(t.toLowerCase())!==-1});var h=a&&a.toLowerCase().indexOf(t.toLowerCase())!==-1;return l||h}.bind(this));t.attachLiveChange(function(t){var e=t.getParameter("value"),i=[N.RecentlyUsed,N.Recommendations];if(e===""){this.oControl._oSuggPopover._oPopover.close();this._showInitialSuggestions(i)}},this);t.addEventDelegate({onmousedown:function(e){if(this.oControl.getAggregation("_suggestionPopup")&&this.oControl.getAggregation("_suggestionPopup").isOpen()||e.target.tagName!=="INPUT"){return}this._bindInnerControlSuggestions();if(this._oHistoryValuesProvider){this._oHistoryValuesProvider.getFieldData().then(function(e){this._updateModelHistoryData(e);this._showInitialSuggestions("suggestionRows",t.getValue())}.bind(this))}},onkeyup:function(e){this._bindInnerControlSuggestions();if(e.keyCode!==9){return}if(this._oHistoryValuesProvider){this._oHistoryValuesProvider.getFieldData().then(function(e){this._updateModelHistoryData(e);this._showInitialSuggestions("suggestionRows",t.getValue())}.bind(this))}}},this);if(t.isA("sap.m.MultiInput")||!this._shouldHaveRecommendations()){return}t.attachSuggestionItemSelected(function(t){var e=this._getSuggestionsModelName(),i=t.getParameter("selectedRow"),o;if(i){var s=i.getBindingContext(e).getObject();o=s&&s[this.sKey]}if(this._isNotRecommendationItemSelected("suggestionRows",o)){this._setControlValueState(E.Warning)}else{this._setControlValueState(E.None)}},this)};k.prototype._setupComboBoxSuggestionInteractions=function(){var t=this.oControl;t.setShowSecondaryValues(true);t.addEventDelegate({onmousedown:function(e){if(this.oControl.getPicker()&&this.oControl.getPicker().isOpen()||e.target.tagName!=="INPUT"){return}this._bindInnerControlSuggestions();setTimeout(function(){this._showInitialSuggestions("items",t.getValue())}.bind(this))},onkeyup:function(e){this._bindInnerControlSuggestions();if(e.keyCode!==9){return}setTimeout(function(){this._showInitialSuggestions("items",t.getValue())}.bind(this))}},this);if(t.isA("sap.m.MultiComboBox")||!this._shouldHaveRecommendations()){return}t.attachChange(function(t){if(this._isNotRecommendationItemSelected("items",t.getParameter("value"))){this._setControlValueState(E.Warning)}else{this._setControlValueState(E.None)}},this)};k.prototype._isNotRecommendationItemSelected=function(t,e){return this._findSuggestionItemGroup(t,e)!==N.Recommendations};k.prototype._findSuggestionItemGroup=function(t,e){var i=this.oControl.getBinding(t),o=i?i.getCurrentContexts():[],s;for(var r=0;r<o.length;r++){var n=o[r].getObject(),a=n[this.sKey],l=n[this.sDescription];if(a===e||l===e){s=n;break}}return s?s[v.getSuggestionsGroupPropertyName()]:null};k.prototype._setControlValueState=function(t){this.oControl.setValueState(t?t:E.None);this.oControl.setValueStateText(" ")};k.prototype._showInitialSuggestions=function(t,e){var i=this,o=[N.RecentlyUsed,N.Recommendations],s=[N.RecentlyUsed],r=[];if(this._isNotRecommendationItemSelected(t,e)){r=o}else if(this._shouldHaveHistory()){r=s}this._calculateFilterInputData();this.oControl.showItems(function(t,e){var o=i._getSuggestionsModelName(),s=e.getBindingContext(o),n=s?s.getObject():{},a=n[v.getSuggestionsGroupPropertyName()];return i._filterSuggestionsWithInParams(i.mFilterInputData,n)&&r.indexOf(a)!==-1})};k.prototype._filterSuggestionsWithInParams=function(t,e){if(!t||t.length===0){return true}return Object.keys(t).every(function(i){var o=e[i];var s=t[i];if(!o){return true}if(typeof s==="string"){return s===o}if(typeof s==="object"&&s.items&&s.items.length>0){return s.items.some(function(t){return t.key===o})}return true})};k.prototype._getSuggestionsModelName=function(){var t;if(!this._isControlSupportedForHistory(this.oControl)){return t}if(this._shouldHaveRecommendations()||this._shouldHaveHistory()){t=O}return t};k.prototype._resolveSuggestionBindingPath=function(t){var e=this._getSuggestionsModelName();if(e){t=e+">"+t}return t};k.prototype._isControlSupportedForHistory=function(t){if(!t){return false}if(t.isA("sap.ui.comp.smartfield.DisplayComboBox")){return false}if(t.isA("sap.m.ComboBox")||t.isA("sap.m.MultiComboBox")||t.isA("sap.m.Input")||t.isA("sap.m.MultiInput")){return true}return false};k.prototype._getBindingLength=function(){var t=300;if(this.oODataModel&&this.oODataModel.iSizeLimit&&this.oODataModel.iSizeLimit>t){t=this.oODataModel.iSizeLimit}return t};k.prototype._parseHistoryJsonDates=function(t){return t.map(function(t){return Object.keys(t).reduce(function(e,i){if(r._hasJsonDateString(t[i])){e[i]=r._parseJsonDateString(t[i])}else{e[i]=t[i]}return e},{})})};k.prototype._truncateSearchText=function(t){var e=-1;if(this._sMaxLength){e=parseInt(this._sMaxLength)}else if(this._fieldViewMetadata&&this._fieldViewMetadata.maxLength){e=parseInt(this._fieldViewMetadata.maxLength)}if(e>-1&&t.length>e){t=t.substr(0,e)}return t};k.prototype._handlePresentationVariantSortOrderAnnotation=function(){var t,e,i=this.oPrimaryValueListAnnotation.valueListEntityName;if(!this._bConsiderPresentationVariant){return false}if(!this._oMetadataAnalyser){this._oMetadataAnalyser=new s(this.oODataModel);this._bCleanupMetadataAnalyser=true}t=this._oMetadataAnalyser._getPresentationVariantQualifierForVHD(i);e=this._oMetadataAnalyser.getPresentationVariantAnnotation(i,t);if(e&&e.sortOrderFields.length!==0){e.sPresentationVariantSortPath=e.sortOrderFields[0].name;this._oMetadataAnalyser._getEntityDefinition(i).property.forEach(function(t){if(t.name===e.sPresentationVariantSortPath){e._bIsPresentationVariantSortPathInVHDEntityType=true}});this.oPrimaryValueListAnnotation.fields.forEach(function(t){if(t.name===e.sPresentationVariantSortPath&&t.sortable===true){e._bIsPresentationVariantSortOrderPropertySortable=true}})}return e};k.prototype._hasNotValidatedSingleField=function(t){return this.oFilterProvider&&this.oFilterProvider._oNotValidatedSingleFields&&this.oFilterProvider._oNotValidatedSingleFields[t]};k.prototype.unbindAggregation=function(){if(this.oControl){this.oControl.unbindAggregation(this.sAggregationName)}return this};k.prototype.destroy=function(){if(this.oControl){if(this.oControl.detachSuggest&&this._fSuggest){this.oControl.detachSuggest(this._fSuggest);this._fSuggest=null}if(this.oControl.removeValidator&&this._fValidator){this.oControl.removeValidator(this._fValidator);this._fValidator=null}else if(this.oControl.detachSuggestionItemSelected){this.oControl.detachSuggestionItemSelected(this._onSuggestionItemSelected,this)}if(this.oControl.detachChange){this.oControl.detachChange(this._validateStringSingleWithValueList,this)}this.oControl.unbindAggregation(this.sAggregationName);this.oControl.data("_hassuggestionTemplate",false);delete this.oControl.__sValidationText;delete this.oControl.__bValidatingToken;delete this.oControl._iDescriptionCount}if(this._oHistoryValuesProvider){this._oHistoryValuesProvider.destroy();this._oHistoryValuesProvider=null}p.prototype.destroy.apply(this,arguments);if(this.oJsonModel){this.oJsonModel.destroy();this.oJsonModel=null}if(this._oTemplate){this._oTemplate.destroy()}this._oTemplate=null;this.sAggregationName=null;this.bTypeAheadEnabled=null;this._oSorter=null;this._oResourceBundle=null};return k});
//# sourceMappingURL=ValueListProvider.js.map