/*!
 * SAPUI5
 * (c) Copyright 2025 SAP SE. All rights reserved.
 */
sap.ui.define(["sap/ui/comp/library","sap/ui/base/ManagedObject","sap/m/Token","sap/m/library","sap/ui/comp/util/FormatUtil","sap/ui/core/Core","sap/ui/core/Lib"],function(e,t,a,r,o,n,i){"use strict";var p=e.valuehelpdialog.ValueHelpRangeOperation;var s=r.P13nConditionOperation;var l={default:[s.EQ,s.BT,s.LT,s.LE,s.GT,s.GE,s.NotEQ,s.NotBT,s.NotLT,s.NotLE,s.NotGT,s.NotGE],string:[s.Empty,s.NotEmpty,s.Contains,s.EQ,s.BT,s.StartsWith,s.EndsWith,s.LT,s.LE,s.GT,s.GE,s.NotEQ,s.NotContains,s.NotStartsWith,s.NotEndsWith,s.NotBT,s.NotLT,s.NotLE,s.NotGT,s.NotGE],date:[s.Empty,s.NotEmpty,s.EQ,s.BT,s.LT,s.LE,s.GT,s.GE,s.NotEQ,s.NotBT,s.NotLT,s.NotLE,s.NotGT,s.NotGE],time:[s.EQ,s.BT,s.LT,s.LE,s.GT,s.GE,s.NotEQ,s.NotBT,s.NotLT,s.NotLE,s.NotGT,s.NotGE],numeric:[s.EQ,s.BT,s.LT,s.LE,s.GT,s.GE,s.NotEQ,s.NotBT,s.NotLT,s.NotLE,s.NotGT,s.NotGE],numc:[s.Contains,s.EQ,s.BT,s.EndsWith,s.LT,s.LE,s.GT,s.GE,s.Empty,s.NotContains,s.NotEQ,s.NotBT,s.NotEndsWith,s.NotLT,s.NotLE,s.NotGT,s.NotGE],boolean:[s.EQ]};var u=[s.Empty,s.BT,s.EQ,s.Contains,s.StartsWith,s.EndsWith,s.LT,s.LE,s.GT,s.GE,s.NotEmpty,s.NotBT,s.NotEQ,s.NotContains,s.NotStartsWith,s.NotEndsWith,s.NotLT,s.NotLE,s.NotGT,s.NotGE];var f=function(e){var t=e&&e.rangeOperationsKeys||u;this._aKeyFields=[];this._sDefaultOperation=typeof e==="string"&&e||e&&e.defaultOperation&&e.defaultOperation||undefined;this._mTypeOperations=e&&e.typeOperations||l;this._initRangeOperations(t)};function g(e){var t=this.re.exec(e),a=t[1],r=t[2];if(t){if(a&&a.trim){a=a.trim()}if(r&&r.trim){r=r.trim()}return[a,r]}return[]}f.rangeOperations={};f.rangeOperations[s.Empty]={regex:new RegExp("^"+o.getFormattedRangeText(p.Empty,null,null,false)+"$","i"),operator:s.Empty,example:o.getFormattedRangeText(p.Empty,null,null,false),template:o.getFormattedRangeText(p.Empty,null,null,false),exclude:false,parse:function(e){return[]}};f.rangeOperations[s.BT]={regex:/^([^!].*)\.\.\.(.+)$/,operator:s.BT,example:"foo...bar",template:"$0...$1",exclude:false,parse:g};f.rangeOperations[s.EQ]={regex:/^\=(.+)$/,operator:s.EQ,example:"=foo",template:"=$0",exclude:false};f.rangeOperations[s.Contains]={regex:/^\*(.+)\*$/,operator:s.Contains,example:"*foo*",template:"*$0*",exclude:false};f.rangeOperations[s.StartsWith]={regex:/^([^\*!].*)\*$/,operator:s.StartsWith,example:"foo*",template:"$0*",exclude:false};f.rangeOperations[s.EndsWith]={regex:/^\*(.*[^\*])$/,operator:s.EndsWith,example:"*foo",template:"*$0",exclude:false};f.rangeOperations[s.LT]={regex:/^\<([^\=].*)$/,operator:s.LT,example:"< foo",template:"<$0",exclude:false};f.rangeOperations[s.LE]={regex:/^\<\=(.+)$/,operator:s.LE,example:"<=foo",template:"<=$0",exclude:false};f.rangeOperations[s.GT]={regex:/^\>([^\=].*)$/,operator:s.GT,example:"> foo",template:">$0",exclude:false};f.rangeOperations[s.GE]={regex:/^>=(.+)$/,operator:s.GE,example:">=foo",template:">=$0",exclude:false};f.rangeOperations[s.NotEmpty]={regex:new RegExp("^"+o.getFormattedRangeText(p.Empty,null,null,true).replace("(","\\(").replace(")","\\)")+"$","i"),operator:s.NotEmpty,example:o.getFormattedRangeText(p.Empty,null,null,true),template:o.getFormattedRangeText(p.Empty,null,null,true),exclude:true,parse:function(e){return[]}};f.rangeOperations[s.NotBT]={regex:/^![(]?(.+)\.\.\.([^)]+)[)]?$/,operator:s.NotBT,example:"!foo...bar",template:"!($0...$1)",exclude:true,parse:g};f.rangeOperations[s.NotEQ]={regex:/^![(]?=(.+?)[)]?$/,operator:s.NotEQ,example:"!=foo",template:"!(=$0)",exclude:true};f.rangeOperations[s.NotContains]={regex:/^![(]?\*(.+)\*[)]?$/,operator:s.NotContains,example:"!*foo*",template:"!(*$0*)",exclude:true};f.rangeOperations[s.NotStartsWith]={regex:/^![(]?([^\\*].*)\*[)]?$/,operator:s.NotStartsWith,example:"!foo*",template:"!($0*)",exclude:true};f.rangeOperations[s.NotEndsWith]={regex:/^![(]?\*([^\*)]*)[)]?$/,operator:s.NotEndsWith,example:"!*foo",template:"!(*$0)",exclude:true};f.rangeOperations[s.NotLT]={regex:/^![(]?<([^=].*?)[)]?$/,operator:s.NotLT,example:"!<foo",template:"!(<$0)",exclude:true};f.rangeOperations[s.NotLE]={regex:/^![(]?<=(.+?)[)]?$/,operator:s.NotLE,example:"!<=foo",template:"!(<=$0)",exclude:true};f.rangeOperations[s.NotGT]={regex:/^![(]?>([^=].*?)[)]?$/,operator:s.NotGT,example:"!>foo",template:"!(>$0)",exclude:true};f.rangeOperations[s.NotGE]={regex:/^![(]?>=(.+?)[)]?$/,operator:s.NotGE,example:"!>=foo",template:"!(>=$0)",exclude:true};f.excludeOperationsMapping={};f.excludeOperationsMapping[s.NotEmpty]=s.Empty;f.excludeOperationsMapping[s.NotLT]=s.LT;f.excludeOperationsMapping[s.NotLE]=s.LE;f.excludeOperationsMapping[s.NotGT]=s.GT;f.excludeOperationsMapping[s.NotGE]=s.GE;f.excludeOperationsMapping[s.NotContains]=s.Contains;f.excludeOperationsMapping[s.NotStartsWith]=s.StartsWith;f.excludeOperationsMapping[s.NotEndsWith]=s.EndsWith;f.excludeOperationsMapping[s.NotBT]=s.BT;f.excludeOperationsMapping[s.NotEQ]=s.EQ;f.prototype._initRangeOperations=function(e){e.forEach(function(e){this.createOperation(f.rangeOperations[e])},this)};f.prototype.destroy=function(){if(this._oInput&&!this._oInput.bIsDestroyed){this._oInput.removeValidator(this._validator);if(this._aOrgValidators&&this._aOrgValidators.length>0){this._oInput.addValidator(this._aOrgValidators)}this._oInput=null}this._aOrgValidators=null;this._aKeyFields=null;this._mTypeOperations=null};f.prototype.setDefaultOperation=function(e){this._sDefaultOperation=e};f.prototype.getDefaultOperation=function(){return this._sDefaultOperation};f.prototype.getOperations=function(){return this._mOperations};f.prototype.getOperation=function(e){return this._mOperations&&this._mOperations[e]};f.prototype._getKeyFieldByLabel=function(e){var t;this._aKeyFields.some(function(a){if(a.label.toUpperCase()===e.toUpperCase()){t=a}},this);return t};f.prototype.addKeyField=function(e){this._aKeyFields.push(e)};f.prototype.getKeyFields=function(){return this._aKeyFields};f.prototype.addTypeOperations=function(e,t){this._mTypeOperations[e]=t};f.prototype.removeTypeOperations=function(e){delete this._mTypeOperations[e]};f.prototype.getTypeOperations=function(e){return this._mTypeOperations[e]||this._mTypeOperations["default"]};f.prototype.createOperation=function(e){var t=e.operator,a=e.example,r=e.regex,o=e.template,n=e.parse,i=e.exclude;if(!this._mOperations){this._mOperations={}}this._mOperations[t]={key:t,example:a,re:r,template:o,exclude:i,parser:this,match:function(e,t){var a=this.re.exec(e);if(a){var r=this.parse(e);if(t){r.forEach(function(e){if(t.hasOwnProperty("maxLength")&&t.maxLength>=0&&e.length>t.maxLength){a=null}if(t.oType){try{e=t.oType.parseValue(e,"string");t.oType.validateValue(e)}catch(e){a=null}}},this)}}return a},parse:n||function(e){var t=this.re.exec(e);if(t){var a=t[1]||t[2];if(a&&a.trim){a=a.trim()}return[a]}return[]},getFilledTemplate:function(e,t){var a=this.parse(e);var r=[];var o="";for(var n=0;n<a.length;n++){r[n]=this.formatValue(a[n],false,t)}o=f._templateReplace(this.template,r);return o},getConditionData:function(e,t){var a={};a.exclude=this.exclude;if(this.exclude){a.operation=f.excludeOperationsMapping[this.key];if(!a.operation){a.operation=this.key}}else{a.operation=this.key}var r=this.parse(e);for(var o=0;o<r.length;o++){a["value"+(o+1)]=this.formatValue(r[o],true,t)}return a},formatValue:function(e,t,a){if(!a){return e}if(a.hasOwnProperty("maxLength")){if(a.maxLength>=0){e=e.substring(0,a.maxLength)}}if(a.displayFormat){if(a.displayFormat==="UpperCase"){e=e.toUpperCase()}}if(a.oType){try{e=a.oType.parseValue(e,"string");a.oType.validateValue(e)}catch(e){return"ERROR"}if(!t){e=a.oType.formatValue(e,"string")}}return e}};return this._mOperations[t]};f.prototype.removeOperation=function(e){delete this._mOperations[e]};f.prototype.removeAllOperations=function(){var e=Object.keys(this._mOperations);e.forEach(function(e){delete this._mOperations[e]},this)};f.prototype.getTranslatedText=function(e,t,a){var r=t.key;e=e!=="default"?"_"+e.toUpperCase()+"_":"";if(e==="_STRING_"||e==="_BOOLEAN_"||e==="_NUMC_"){e=""}if(e==="_TIME_"){e="_DATE_"}if(!a){a="sap.m"}r="CONDITIONPANEL_OPTION"+e+r;var o=i.getResourceBundleFor(a).getText(r)||r;if(o.startsWith("CONDITIONPANEL_OPTION")){r="CONDITIONPANEL_OPTION"+t.key;o=i.getResourceBundleFor(a).getText(r)}return o};f.prototype.associateInput=function(e){this._oInput=e;this._aOrgValidators=this._oInput&&this._oInput.isA("sap.m.MultiInput")?this._oInput.getValidators().slice():[];this._oInput.removeAllValidators();this._oInput.addValidator(this._validator.bind(this))};f.prototype._validator=function(e){if(this._aOrgValidators){var t;this._aOrgValidators.some(function(a){t=a(e);return t},this);if(t){return t}}if(e.text){return this._onValidate(e.text)}return null};f._templateReplace=function(e,t){return e.replace(/\$\d/g,function(e){return t[parseInt(e.substr(1))]})};f.prototype._onValidate=function(e){var r=this._aKeyFields.length>0?this._aKeyFields[0]:null;if(this._oInput._getIsSuggestionPopupOpen&&this._oInput._getIsSuggestionPopupOpen()&&this._oInput._oSuggestionsTable&&this._oInput._oSuggestionsTable.getSelectedItem()){return null}if(r){var o=/^\w+\:\s/.exec(e);if(o){var n=o[0];var i=this._getKeyFieldByLabel(n.slice(0,n.indexOf(":")));if(i){r=i;e=e.slice(o[0].length).trim()}}}var p=r&&r.type||"default";var l=this.getTypeOperations(p);var u=function(e,o){if(e.match(o,r)){var n=e.getConditionData(o,r);n.keyField=r?r.key:null;if(r.hasOwnProperty("maxLength")&&r.maxLength===1){if([s.Contains,s.EndsWith,s.StartsWith].indexOf(e.key)!==-1){return}}if(p==="numc"){if([s.Contains,s.EndsWith].indexOf(e.key)!==-1){n.value1=r.oType.formatValue(n.value1,"string")}}var i=(r&&r.label&&this._aKeyFields.length>1?r.label+": ":"")+e.getFilledTemplate(o,r);i=t.escapeSettingsValue(i);return new a({text:i,tooltip:i}).data("range",n)}return null}.bind(this);var g;if(l.some(function(t){g=u(this._mOperations[t],e);return g},this)){return g}if(this._sDefaultOperation&&this._mOperations[this._sDefaultOperation]){e=f._templateReplace(this._mOperations[this._sDefaultOperation].template,[e]);return u(this._mOperations[this._sDefaultOperation],e)}return null};f._createRangeByText=function(e){var t=f._matchOperationFromText(e);if(!t){return{exclude:false,operation:s.EQ,tokenText:null,value1:e,value2:null}}var a=t;var r=false;if(f.excludeOperationsMapping[t]){a=f.excludeOperationsMapping[t];r=true}var o=a===s.BT?true:false;return f._getRangeByTextAndOperation(e,a,r,o)};f._matchOperationFromText=function(e){var t=[];for(var a in f.rangeOperations){if(f.rangeOperations[a].regex.test(e)){t.push(a)}}if(t.length===0){return null}if(t.length>1){if(e===o.getFormattedRangeText(p.Empty,null,null,false)&&t.indexOf(f.rangeOperations[s.Empty].operator)>-1){t=[f.rangeOperations[s.Empty].operator]}if(e===o.getFormattedRangeText(p.Empty,null,null,true)&&t.indexOf(f.rangeOperations[s.NotEmpty].operator)>-1){t=[f.rangeOperations[s.NotEmpty].operator]}if(t.indexOf(f.rangeOperations[s.NotContains].operator)>-1&&t.indexOf(f.rangeOperations[s.NotStartsWith].operator)>-1){return f.rangeOperations[s.NotContains].operator}}return t[0]};f._getRangeByTextAndOperation=function(e,t,a,r){var o=[];if(a&&e.startsWith("!(")&&e.endsWith(")")){e=e.slice(2,-1)}var n=f.rangeOperations[t].template;if(r){o=e.split("...");return{exclude:a,operation:t,value1:o[0],value2:o[1]}}else{var i=n.indexOf("$0");var p=i+2;if(p===n.length){e=e.slice(i)}else{p=n.length-p;e=e.slice(i,-p)}return{exclude:a,operation:t,value1:e,value2:null}}};return f},true);
//# sourceMappingURL=TokenParser.js.map