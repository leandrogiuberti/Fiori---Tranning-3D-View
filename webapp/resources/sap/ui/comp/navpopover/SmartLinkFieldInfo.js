/*!
 * SAPUI5
 * (c) Copyright 2025 SAP SE. All rights reserved.
 */
sap.ui.define(["sap/ui/mdc/Link","./Util","./Panel","sap/ui/mdc/link/Panel","sap/ui/layout/form/SimpleForm","sap/m/Title","sap/ui/core/Lib","sap/ui/layout/library"],(t,e,n,i,o,a,s,r)=>{"use strict";const{ResponsiveGridLayout:l}=r.form.SimpleFormLayout;const c=t.extend("sap.ui.comp.navpopover.SmartLinkFieldInfo",{metadata:{properties:{delegate:{type:"object",defaultValue:{name:"sap/ui/comp/navpopover/SmartLinkDelegate",payload:{}}}}}});c.prototype.init=function(){t.prototype.init.apply(this,arguments)};c.prototype.open=async function(t,e){const n=this.getParent();let i=n.getFieldName();if(!i?.length){const t=n.getBinding("text");if(t){if(t.getBindings){i=t.getBindings()[0].getPath()}else{i=t.getPath()}}n.setFieldName(i)}t=t?t:n;if(!t){throw new Error("sap.ui.comp.navpopover.SmartLinkFieldInfo: popover can not be open because the control is undefined")}const o=this.getPopover();if(o&&o.isOpen()){return Promise.resolve()}if(!this._oGetContentPromise){this._oGetContentPromise=this.getContent(()=>this.getPopover())}const a=await this._oGetContentPromise;if(!this._oGetContentPromise){a.destroy();return Promise.resolve()}const s=await this.checkDirectNavigation(e);if(s===false){const e=await this._createPopover(a);if(e){e.openBy(t);e.attachAfterOpen(()=>{this.firePopoverAfterOpen()});e.attachAfterClose(()=>{this._oGetContentPromise=undefined})}}else{a.destroy();this._oGetContentPromise=undefined}return Promise.resolve()};c.prototype.getContent=async function(t){if(!this.awaitControlDelegate()){throw new Error("sap.ui.comp.navpopover.SmartLinkFieldInfo: control delegate is not set - could not load LinkItems from delegate.")}const i=this.getParent();const o=this._getSourceControl();const a=o.getId?.()??o;const s=i.getSemanticObject();const r=await this.awaitControlDelegate();const l=this._getControlBindingContext();const c=l?.getPath()??null;const p=i.getModel();const g=await e.retrieveSemanticObjectMapping(i.getFieldName(),p,c);i._setSemanticAttributes(r._calculateSemanticAttributes(g,this,l));let f=i._getSemanticAttributes();const h=await r._fireBeforePopoverOpens(f,s,a,this);f=h.semanticAttributes;const u=h.appStateKey;i._setSemanticAttributes(f);i._setAppStateKey(u);const m=this.retrieveAdditionalContent();const d=r.fetchNavigationTargets(this,l);const v=await Promise.all([d,m]);const[_,y]=v;const P=y.length===2?y[1]:[];const C=i._getTextOfDom&&i._getTextOfDom()||r.getSemanticObjectValue(i);let b=await r._fireNavigationTargetsObtained(C,s,f,a,P,_,this);b=await r._transformNavigationTargets(b);i._setMainNavigation(b.mainNavigation);i._setMainNavigationId(b.mainNavigationId);const w=b.availableActions??[];const N=r._updateVisibilityOfAvailableActions(w,this);i._setExtraContent(b.extraContent);if(b.extraContent){y[1]=b.extraContent}this._setConvertedLinkItems(w);const S=this._getInternalModel().getProperty("/linkItems");if(y.length===1&&!S.length){y.push(this._getNoContent())}const x=await this._getContent(N,y,t,n);x.setEnablePersonalization(r._getEnableAvailableActionsPersonalization(w,this));return x};c.prototype._getNoContent=function(){const t=new o({layout:l,content:[new a({text:s.getResourceBundleFor("sap.ui.mdc").getText("info.POPOVER_MSG_NO_CONTENT")})]});t.addStyleClass("mdcbaseinfoPanelDefaultAdditionalContent");return t};c.prototype.checkDirectNavigation=async function(t){const e=this.getParent();const n=this._getInternalModel().getProperty("/linkItems");const o=e.getExtraContent();if(o||n.length>1){return false}const a=e.getMainNavigation();const s=async n=>{t.oSource=n;const o=await this._beforeNavigationCallback(t);if(o){i.navigate(n.internalHref??n.href);const t={text:n.text??n.title,href:n.href,internalHref:n.internalHref};e.fireInnerNavigate(t)}return o};if(n.length===1&&!a.href?.length){return await s(n[0])}if(n.length===0&&a.href?.length){return await s(a)}return false};c.prototype.exit=function(){t.prototype.exit.apply(this,arguments);this._oGetContentPromise=undefined;this.getPopover()?.destroy()};return c});
//# sourceMappingURL=SmartLinkFieldInfo.js.map