/*!
 * SAPUI5
 * (c) Copyright 2025 SAP SE. All rights reserved.
 */
sap.ui.define(["sap/ui/thirdparty/jquery","sap/ui/comp/library","sap/ui/core/Element","./Factory","sap/ui/model/json/JSONModel","sap/ui/comp/odata/MetadataAnalyser","sap/ui/model/BindingMode","sap/base/Log","sap/base/util/merge","./Util"],function(jQuery,t,e,i,n,a,o,r,s,c){"use strict";let p;var g=e.extend("sap.ui.comp.navpopover.SemanticObjectController",{metadata:{library:"sap.ui.comp",properties:{ignoredFields:{type:"string",group:"Misc",defaultValue:null},prefetchNavigationTargets:{type:"boolean",group:"Misc",defaultValue:false},fieldSemanticObjectMap:{type:"object",group:"Misc",defaultValue:null},entitySet:{type:"string",group:"Misc",defaultValue:null},contactAnnotationPaths:{type:"object",defaultValue:null},enableAvailableActionsPersonalization:{type:"object",defaultValue:null},mapFieldToSemanticObject:{type:"boolean"},forceLinkRendering:{type:"object",defaultValue:null},beforeNavigationCallback:{type:"function"},replaceSmartLinkNavigationTargetsObtained:{type:"boolean",defaultValue:false},navigationTargetsObtainedCallback:{type:"function"}},events:{navigationTargetsObtained:{parameters:{mainNavigation:{type:"sap.ui.comp.navpopover.LinkData"},actions:{type:"sap.ui.comp.navpopover.LinkData[]"},ownNavigation:{type:"sap.ui.comp.navpopover.LinkData"},popoverForms:{type:"sap.ui.layout.form.SimpleForm[]"},semanticObject:{type:"string"},semanticAttributes:{type:"object"},originalId:{type:"string"},show:{type:"function"}}},beforePopoverOpens:{parameters:{semanticObject:{type:"string"},semanticAttributes:{type:"object"},semanticAttributesOfSemanticObjects:{type:"object"},setSemanticAttributes:{type:"function"},setAppStateKey:{type:"function"},originalId:{type:"string"},open:{type:"function"}}},navigate:{parameters:{text:{type:"string"},href:{type:"string"},semanticObject:{type:"string"},semanticAttributes:{type:"object"},originalId:{type:"string"}}},prefetchDone:{parameters:{semanticObjects:{type:"object"}}}}}});g.oSemanticObjects={};g.oNavigationTargetActions={};g.bHasPrefetchedDistinctSemanticObjects=false;g.bHasPrefetchedNavigationTargetActions=false;g.oPromise=null;g.oPromiseActions=null;g.prototype.init=function(){g.prefetchDistinctSemanticObjects();this._proxyOnBeforePopoverOpens=this._onBeforePopoverOpens.bind(this);this._proxyOnTargetsObtained=this._onTargetsObtained.bind(this);if(!this._proxyOnNavigate){this._proxyOnNavigate=this._onNavigate.bind(this)}this._aRegisteredControls=[]};g.prototype.isControlRegistered=function(t){return this._aRegisteredControls.indexOf(t)>-1};g.prototype.registerControl=function(t){let e=t&&t.isA("sap.ui.comp.navpopover.SmartLink");if(t&&t.isA("sap.ui.comp.navpopover.NavigationPopoverHandler")){e=true}if(!e){r.warning("sap.ui.comp.navpopover.SemanticObjectController: "+(t&&t.getMetadata?t.getMetadata():"parameter")+" is neither of SmartLink nor of NavigationPopoverHandler instance");return}if(!e){r.warning("sap.ui.comp.navpopover.SemanticObjectController: "+(t?.getMetadata?.()||"parameter")+" is not of SmartLink instance");return}if(this.isControlRegistered(t)){return}if(t.attachBeforePopoverOpens){t.attachBeforePopoverOpens(this._proxyOnBeforePopoverOpens)}if(t.attachNavigationTargetsObtained){t.attachNavigationTargetsObtained(this._proxyOnTargetsObtained)}if(t.isA("sap.ui.comp.navpopover.NavigationPopoverHandler")&&t.attachInnerNavigate){t.attachInnerNavigate(this._proxyOnNavigate)}this._aRegisteredControls.push(t)};g.prototype.unregisterControl=function(t){if(!t){return}if(!this.isControlRegistered(t)){return}if(t.detachBeforePopoverOpens){t.detachBeforePopoverOpens(this._proxyOnBeforePopoverOpens)}if(t.detachNavigationTargetsObtained){t.detachNavigationTargetsObtained(this._proxyOnTargetsObtained)}if(t.isA("sap.ui.comp.navpopover.NavigationPopoverHandler")&&t.detachInnerNavigate){t.detachInnerNavigate(this._proxyOnNavigate)}this._aRegisteredControls.splice(this._aRegisteredControls.indexOf(t),1)};g.prototype.setEnableAvailableActionsPersonalization=function(t){this.setProperty("enableAvailableActionsPersonalization",t,true);return this};g.prototype._onBeforePopoverOpens=function(t){var e=t.getParameters();if(this.hasListeners("beforePopoverOpens")){this.fireBeforePopoverOpens({semanticObject:e.semanticObject,semanticAttributes:e.semanticAttributes,semanticAttributesOfSemanticObjects:e.semanticAttributesOfSemanticObjects,setSemanticAttributes:e.setSemanticAttributes,setAppStateKey:e.setAppStateKey,originalId:e.originalId,open:e.open})}else{e.open()}};g.prototype._onTargetsObtained=function(t){const e=t.getParameters();if(!this.hasListeners("navigationTargetsObtained")){e.show();return}this.fireNavigationTargetsObtained({mainNavigation:e.mainNavigation,actions:e.actions,ownNavigation:e.ownNavigation,popoverForms:e.popoverForms,semanticObject:e.semanticObject,semanticAttributes:e.semanticAttributes,originalId:e.originalId,show:e.show})};g.prototype._onNavigate=function(t){if(t){var e=t.getParameters();var i={text:e.text,href:e.href,originalId:e.originalId,semanticObject:e.semanticObject,semanticAttributes:e.semanticAttributes};if(this.getBeforeNavigationCallback()&&!t.getSource().getBeforeNavigationCallback()){this.getBeforeNavigationCallback()(s({},i)).then(function(t){if(t===true){this.fireNavigate(e);c.navigate(e.internalHref)}}.bind(this))}else{this.fireNavigate(e);c.navigate(e.internalHref)}}};g.prototype.setIgnoredState=function(t){r.error("SemanticObjectController.setIgnoredState is deprecated as of version 1.42!")};g.prototype.setPrefetchNavigationTargets=function(t){this.setProperty("prefetchNavigationTargets",t);if(t!==true){return this}r.error("sap.ui.comp.navpopover.SemanticObjectController: Please be aware that in case of a large amount of semantic objects the performance may suffer significantly and the received links will be created out of context");var e=this;g.getDistinctSemanticObjects().then(function(t){g.getNavigationTargetActions(t).then(function(t){e.firePrefetchDone({semanticObjects:t})})});return this};g.prototype.getFieldSemanticObjectMap=function(){var t=this.getProperty("fieldSemanticObjectMap");if(t){return t}if(!this.getEntitySet()){r.warning("sap.ui.comp.navpopover.SemanticObjectController: FieldSemanticObjectMap is not set on SemanticObjectController, retrieval without EntitySet not possible");return null}var e=new a(this.getModel());t=e.getFieldSemanticObjectMap(this.getEntitySet());if(t){this.setProperty("fieldSemanticObjectMap",t,true)}return t};g.prototype.getEntitySet=function(){var t=this.getProperty("entitySet");if(t){return t}var e=this.getParent();while(e){if(e.getEntitySet){t=e.getEntitySet();if(t){this.setProperty("entitySet",t,true);break}}e=e.getParent()}return t};g.prototype.hasSemanticObjectLinks=function(t){return g.hasDistinctSemanticObject([t],g.oSemanticObjects)};g.prefetchDistinctSemanticObjects=function(){g.getJSONModel();if(!g.bHasPrefetchedDistinctSemanticObjects){g.getDistinctSemanticObjects()}};g.prototype._getDistinctSemanticObjects=function(){return g.getDistinctSemanticObjects()};g.getDistinctSemanticObjects=function(){if(g.bHasPrefetchedDistinctSemanticObjects){return Promise.resolve(g.oSemanticObjects)}if(!g.oPromise){g.oPromise=i.getServiceAsync("Navigation").then(function(t){if(!t){r.error("sap.ui.comp.navpopover.SemanticObjectController: Service 'Navigation' could not be obtained");g.bHasPrefetchedDistinctSemanticObjects=true;return{}}return t.getSemanticObjects().then(function(t){t.forEach(function(t){g.oSemanticObjects[t]={}});var e=g.getJSONModel();e.setProperty("/distinctSemanticObjects",g.oSemanticObjects);g.bHasPrefetchedDistinctSemanticObjects=true;return g.oSemanticObjects},function(){r.error("sap.ui.comp.navpopover.SemanticObjectController: getSemanticObjects() of service 'Navigation' failed");g.bHasPrefetchedDistinctSemanticObjects=true;return{}})})}return g.oPromise};g.prototype._getNavigationTargetActions=function(t){return g.getNavigationTargetActions(t)};g.getNavigationTargetActions=function(t){if(g.bHasPrefetchedNavigationTargetActions){return Promise.resolve(g.oNavigationTargetActions)}if(!g.oPromiseLinks){var e=i.getServiceAsync("Navigation");var n=i.getServiceAsync("URLParsing");g.oPromiseLinks=Promise.all([e,n]).then(function(e){var i=e[0];var n=e[1];if(!i||!n){r.error("sap.ui.comp.navpopover.SemanticObjectController: Service 'Navigation' or 'URLParsing' could not be obtained");g.bHasPrefetchedNavigationTargetActions=true;return{}}var a=Object.keys(t);var o=a.map(function(t){return{semanticObject:t}});return i.getLinks(o).then(function(t){a.forEach(function(e,i){g.oNavigationTargetActions[e]=[];t[i].forEach(function(t){var i=n.parseShellHash(t.intent);if(i&&i.semanticObject===e){g.oNavigationTargetActions[e].push(i.action)}})});var e=g.getJSONModel();e.setProperty("/navigationTargetActions",g.oNavigationTargetActions);g.bHasPrefetchedNavigationTargetActions=true;return g.oNavigationTargetActions},function(){r.error("sap.ui.comp.navpopover.SemanticObjectController: getLinks() of service 'Navigation' failed");g.bHasPrefetchedNavigationTargetActions=true;return{}})})}return g.oPromiseLinks};g.hasDistinctSemanticObject=function(t,e){return t.some(function(t){return!!e[t]})};g.getJSONModel=function(){if(p&&!jQuery.isEmptyObject(p.getData())){return p}p=new n({distinctSemanticObjects:{}});p.setDefaultBindingMode(o.OneTime);p.setSizeLimit(1e3);return p};g.destroyDistinctSemanticObjects=function(){g.oSemanticObjects={};g.oNavigationTargetActions={};g.oPromise=null;g.oPromiseActions=null;g.bHasPrefetchedDistinctSemanticObjects=false;g.bHasPrefetchedNavigationTargetActions=false;if(p){p.destroy()}};return g});
//# sourceMappingURL=SemanticObjectController.js.map