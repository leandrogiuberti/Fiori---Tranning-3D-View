/*!
 * SAPUI5
 * (c) Copyright 2025 SAP SE. All rights reserved.
 */
sap.ui.define(["sap/base/i18n/Localization","sap/ui/comp/library","./Factory","./LinkData","sap/ui/core/Lib","sap/ui/core/Locale","sap/base/Log"],function(t,e,n,i,r,a,o){"use strict";var c={getContactAnnotationPath:function(t,e){var n=t?t.getContactAnnotationPath():undefined;if(n===undefined&&e&&e.getContactAnnotationPaths()&&e.getContactAnnotationPaths()[t.getFieldName()]!==undefined){n=e.getContactAnnotationPaths()[t.getFieldName()]}return n},getForceLinkRendering:function(t,e){if(!t){return undefined}return t.getForceLinkRendering()||!!(e&&e.getForceLinkRendering()&&e.getForceLinkRendering()[t.getFieldName()])},getStorableAvailableActions:function(t){return t?t.filter(function(t){if(!t){return false}if(t.getKey&&t.getKey()!==undefined){return true}return t.key!==undefined}):[]},sortArrayAlphabetical:function(e){var n;try{n=new a(t.getLanguageTag()).toString();if(typeof window.Intl!=="undefined"){var i=window.Intl.Collator(n,{numeric:true});e.sort(function(t,e){return i.compare(t,e)})}else{e.sort(function(t,e){return t.localeCompare(e,n,{numeric:true})})}}catch(t){}},retrieveNavigationTargets:async function(t,e,a,c,s,u,l,f,v,g){const m={mainNavigation:undefined,ownNavigation:undefined,availableActions:[]};const[p,b]=await Promise.all([n.getServiceAsync("Navigation"),n.getServiceAsync("URLParsing")]);if(!p||!b){o.error("Service 'Navigation' or 'URLParsing' could not be obtained");return m}const d=[t].concat(e.filter(e=>e!==t));const h=d.map(function(t){return{semanticObject:t,params:s?s[t]:undefined,appStateKey:a,ui5Component:c,sortResultsBy:"text"}});const y=await p.getLinks(h);if(!y||!y.length){return m}const P=await p.getPrimaryIntent(t,h[0]);const O=P?b.parseShellHash(P.intent):null;const S=await this.retrieveSemanticObjectUnavailableActions(l,f,v);let A=await p.getHref();if(A&&A.indexOf("?")!==-1){A=A.split("?")[0]}if(A){A+="?"}const j=function(t,e){return!!S&&!!S[t]&&S[t].indexOf(e)>-1};y[0].forEach(t=>{const e=b.parseShellHash(t.intent);const n=this._getKey(e);const a=t.intent.indexOf(A)===0;const o=j(e.semanticObject,e.action);if(!a&&o){return}const c=new i({key:n,href:t.intent,visible:true,isSuperiorAction:this._isSuperiorAction(t)});c.setText(t.text);if(a){m.ownNavigation=c;return}if(O?.action&&e?.action&&e.action===O.action){c.setText(r.getResourceBundleFor("sap.ui.comp").getText("POPOVER_FACTSHEET"));m.mainNavigation=c}else{m.availableActions.push(c)}if(g){g.addSemanticObjectIntent(e.semanticObject,{text:c.text,intent:c.intent})}});if(!m.mainNavigation&&typeof u==="string"){var C=new i({visible:true});C.setText(u);m.mainNavigation=C}var x=[];for(var _=1;_<d.length;_++){x=x.concat(y[_])}x.forEach(t=>{var e=b.parseShellHash(t.intent);if(j(e.semanticObject,e.action)){return}var n=new i({key:this._getKey(e),href:t.intent,visible:true,isSuperiorAction:this._isSuperiorAction(t)});n.setText(t.text);m.availableActions.push(n);if(g){g.addSemanticObjectIntent(e.semanticObject,{text:t.text,intent:t.intent})}});return m},_getKey:t=>t.semanticObject&&t.action?t.semanticObject+"-"+t.action:undefined,_isSuperiorAction:t=>t.tags&&t.tags.indexOf("superiorAction")>-1,retrieveSemanticObjectMapping:function(t,e,n){return this._getEntityTypeAnnotationOfProperty(t,e,n).then(function(t){if(!t){return Promise.resolve(null)}if(!t[0]["com.sap.vocabularies.Common.v1.SemanticObjectMapping"]){return Promise.resolve(null)}var i=this._getSemanticObjectMappingsOfProperty(t[0],this._getSemanticObjectsOfProperty(t[0],e,n));var r={};for(var a in i){r[i[a].name]=i[a].mapping}return Promise.resolve(r)}.bind(this))},retrieveSemanticObjectUnavailableActions:function(t,e,n){return this._getEntityTypeAnnotationOfProperty(t,e,n).then(function(t){if(!t){return Promise.resolve(null)}if(!t[0]["com.sap.vocabularies.Common.v1.SemanticObjectUnavailableActions"]){return Promise.resolve(null)}var i=this._getSemanticObjectUnavailableActionsOfProperty(t[0],this._getSemanticObjectsOfProperty(t[0],e,n));var r={};for(var a in i){r[i[a].name]=i[a].unavailableActions}return Promise.resolve(r)}.bind(this))},oNavigationPromise:undefined,navigate:function(t){if(t.indexOf("#")===0&&n.getUShellContainer()){var e=this;if(!e.oNavigationPromise){e.oNavigationPromise=n.getServiceAsync("Navigation").then(function(n){n.navigate({target:{shellHash:t.substring(1)}});e.oNavigationPromise=undefined})}}else{window.location.href=t}},_getEntityTypeAnnotationOfProperty:function(t,e,n){if(!t){return Promise.resolve(null)}if(!e||!e.getMetaModel()){return Promise.resolve(null)}var i=e.getMetaModel();return i.loaded().then(function(){var e;try{e=i.getMetaContext(n)}catch(t){o.error("sap.ui.comp.navpopover.Util._getEntityTypeAnnotationOfProperty: binding path '"+n+"' is not valid. Error has been caught: "+t);return Promise.resolve(null)}if(!e){return Promise.resolve(null)}var r=e.getProperty(e.getPath());if(!r.property){return Promise.resolve(null)}var a=r.property.filter(function(e){return e.name===t});if(a.length!==1){return Promise.resolve(null)}return Promise.resolve(a)})},_getSemanticObjectsOfProperty:function(t,e,n){var i={};for(var r in t){var a=r.split("#")[0];var o=r.split("#")[1]||"";if(a.startsWith("com.sap.vocabularies.Common.v1.SemanticObject")&&a.endsWith("com.sap.vocabularies.Common.v1.SemanticObject")){i[o]={name:t[r]["Path"]?e.getProperty(n+"/"+t[r]["Path"]):t[r]["String"],mapping:undefined}}}return i},_getSemanticObjectMappingsOfProperty:function(t,e){var n=function(t){var e={};if(Array.isArray(t)){t.forEach(function(t){e[t.LocalProperty.PropertyPath]=t.SemanticObjectProperty.String})}return e};for(var i in t){var r=i.split("#")[0];var a=i.split("#")[1]||"";if(r.startsWith("com.sap.vocabularies.Common.v1.SemanticObjectMapping")&&r.endsWith("com.sap.vocabularies.Common.v1.SemanticObjectMapping")){if(e[a]){e[a].mapping=n(t[i])}}}return e},_getSemanticObjectUnavailableActionsOfProperty:function(t,e){var n=function(t){var e=[];if(Array.isArray(t)){t.forEach(function(t){e.push(t.String)})}return e};for(var i in t){var r=i.split("#")[0];var a=i.split("#")[1]||"";if(r.startsWith("com.sap.vocabularies.Common.v1.SemanticObjectUnavailableActions")&&r.endsWith("com.sap.vocabularies.Common.v1.SemanticObjectUnavailableActions")){if(e[a]){e[a].unavailableActions=n(t[i])}}}return e}};return c},true);
//# sourceMappingURL=Util.js.map