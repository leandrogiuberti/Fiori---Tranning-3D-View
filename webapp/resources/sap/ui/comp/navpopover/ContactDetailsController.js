/*!
 * SAPUI5
 * (c) Copyright 2025 SAP SE. All rights reserved.
 */
sap.ui.define(["sap/ui/comp/library","sap/ui/core/Element","sap/ui/core/Lib","sap/ui/layout/form/SimpleForm","sap/m/Title","sap/m/Label","sap/m/Text","sap/m/Image","sap/m/Link","sap/ui/base/ManagedObjectObserver","sap/ui/comp/odata/MetadataAnalyser","sap/base/Log","sap/ui/layout/library","sap/ui/core/library","sap/base/util/merge"],function(e,t,r,n,o,i,a,s,p,u,d,l,c,f,m){"use strict";var h=f.TitleLevel;var v=c.form.SimpleFormLayout;var b=t.extend("sap.ui.comp.navpopover.ContactDetailsController",{metadata:{library:"sap.ui.comp"}});b.prototype.init=function(){this._oObserver=null};b.prototype.exit=function(){if(this._oObserver){this._oObserver.disconnect();this._oObserver=null}};b.prototype.getBindingPath4ContactAnnotation=function(e,t,r){if(t===undefined||t===null||!e){return Promise.resolve(null)}if(!this.getModel()){return Promise.resolve(null)}if(!this.getModel().getMetaModel()){return Promise.resolve(null)}var n=this.getModel().getMetaModel();return n.loaded().then(function(){var o;try{n.getMetaContext(e)}catch(t){l.error("sap.ui.comp.navpopover.ContactDetailsController.getBindingPath4ContactAnnotation: binding path '"+e+"' is not valid. Error has been caught: "+t);return null}try{o="/"+t+"('"+r+"')";n.getMetaContext(o);return o}catch(e){}try{o=t?e+"/"+t:e;n.getMetaContext(o);return o}catch(r){l.error("sap.ui.comp.navpopover.ContactDetailsController.getBindingPath4ContactAnnotation: the path of sContactAnnotationPath '"+e+"/"+t+"' is not valid. Error has been caught: "+r);return null}})};b.prototype.getContactDetailsAnnotation=function(e){if(!e){return null}var t=new d(this.getModel());var r=t.getContactAnnotation(e);if(!r){return null}return r};b.prototype.getContactDetailsContainers=function(e){var t=this.getContactDetailsAnnotation(e);if(!t){return[]}var i=[];var a=[];var s=[];var p;this._oObserver=new u(function(e){if(e.type==="property"&&e.name==="visible"){var t=false;for(var r=1;r<p.getContent().length;r++){if(p.getContent()[r].getLabelFor&&p.getContent()[r].getLabelFor()){continue}if(p.getContent()[r].getVisible()){t=true}}p.setVisible(t)}});var d=r.getResourceBundleFor("sap.ui.comp");this.addProperty2ExpandAndSelect("photo",t,e,a,s);this._addPhoto("photo",t,e,i,this._oObserver);this.addProperty2ExpandAndSelect("fn",t,e,a,s);this._addLabeledText("fn",d.getText("POPOVER_CONTACT_SECTION_NAME"),t,e,i,this._oObserver);this.addProperty2ExpandAndSelect("role",t,e,a,s);this._addLabeledText("role",d.getText("POPOVER_CONTACT_SECTION_ROLE"),t,e,i,this._oObserver);this.addProperty2ExpandAndSelect("title",t,e,a,s);this._addLabeledText("title",d.getText("POPOVER_CONTACT_SECTION_JOBTITLE"),t,e,i,this._oObserver);this.addProperty2ExpandAndSelect("org",t,e,a,s);this._addLabeledText("org",d.getText("POPOVER_CONTACT_SECTION_DEPARTMENT"),t,e,i,this._oObserver);this._addEmails(t,e,a,s,i,this._oObserver);this._addTels(t,e,a,s,i,this._oObserver);this._addAddresses(t,e,a,s,i,this._oObserver);if(!i.length){return[]}i.splice(0,0,new o({text:r.getResourceBundleFor("sap.ui.comp").getText("POPOVER_CONTACT_SECTION_TITLE"),level:h.H2}));p=new n({maxContainerCols:1,editable:false,layout:v.ResponsiveGridLayout,content:i});p.addStyleClass("sapuicompContactDetailsForm");this._requestData(p,e,a,s);return[p]};b.prototype._addPhoto=function(e,t,r,n,o){if(!t[e]){return}var i=r+"/"+t[e].Path;if(this.isPropertyHidden(i)){return}var a=new s({src:{path:i},visible:{path:i,formatter:function(e){return!!e}},decorative:false});a.addStyleClass("sapUiIcon");a.addStyleClass("navigationPopoverThumbnail");o.observe(a,{properties:["visible"]});n.push(a)};b.prototype._addLabeledText=function(e,t,r,n,o,s){if(!r[e]){return}var p=n+"/"+r[e].Path;if(this.isPropertyHidden(p)){return}var u=new a({text:{path:p},visible:{path:p,formatter:function(e){return!!e}}});var d=new i({text:t,labelFor:u.getId()});s.observe(u,{properties:["visible"]});o.push(d);o.push(u)};b.prototype._addEmails=function(e,t,n,o,i,a){if(!e.email||!e.email.length){return}var s=r.getResourceBundleFor("sap.ui.comp");var p=m([],e.email);p.filter(function(e){return!e.processed&&e.type&&(e.type.EnumMember.indexOf("com.sap.vocabularies.Communication.v1.ContactInformationType/preferred")>-1||e.type.EnumMember.indexOf("com.sap.vocabularies.Communication.v1.ContactInformationType/work")>-1)}).sort(function(e,t){if(e.type.EnumMember.indexOf("com.sap.vocabularies.Communication.v1.ContactInformationType/preferred")>-1&&t.type.EnumMember.indexOf("com.sap.vocabularies.Communication.v1.ContactInformationType/preferred")<0){return-1}if(t.type.EnumMember.indexOf("com.sap.vocabularies.Communication.v1.ContactInformationType/preferred")>-1&&e.type.EnumMember.indexOf("com.sap.vocabularies.Communication.v1.ContactInformationType/preferred")<0){return 1}return 0}).forEach(function(e){this.addProperty2ExpandAndSelect("address",e,t,n,o);this._addLabeledEmail("address",s.getText("POPOVER_CONTACT_SECTION_EMAIL"),e,t,i,a);e.processed=true},this)};b.prototype._addTels=function(e,t,n,o,i,a){if(!e.tel||!e.tel.length){return}var s=r.getResourceBundleFor("sap.ui.comp");var p=m([],e.tel);p.filter(function(e){return!e.processed&&e.type&&e.type.EnumMember.indexOf("com.sap.vocabularies.Communication.v1.PhoneType/work")>-1}).sort(function(e,t){if(e.type.EnumMember.indexOf("com.sap.vocabularies.Communication.v1.PhoneType/preferred")>-1){return-1}if(t.type.EnumMember.indexOf("com.sap.vocabularies.Communication.v1.PhoneType/preferred")>-1){return 1}return 0}).forEach(function(e){this.addProperty2ExpandAndSelect("uri",e,t,n,o);this._addLabeledTel("uri",s.getText("POPOVER_CONTACT_SECTION_PHONE"),e,t,i,a);e.processed=true},this);p.filter(function(e){return!e.processed&&e.type&&e.type.EnumMember.indexOf("com.sap.vocabularies.Communication.v1.PhoneType/cell")>-1}).sort(function(e,t){if(e.type.EnumMember.indexOf("com.sap.vocabularies.Communication.v1.PhoneType/preferred")>-1){return-1}if(t.type.EnumMember.indexOf("com.sap.vocabularies.Communication.v1.PhoneType/preferred")>-1){return 1}return 0}).forEach(function(e){this.addProperty2ExpandAndSelect("uri",e,t,n,o);this._addLabeledTel("uri",s.getText("POPOVER_CONTACT_SECTION_MOBILE"),e,t,i,a);e.processed=true},this);p.filter(function(e){return!e.processed&&e.type&&e.type.EnumMember.indexOf("com.sap.vocabularies.Communication.v1.PhoneType/fax")>-1}).sort(function(e,t){if(e.type.EnumMember.indexOf("com.sap.vocabularies.Communication.v1.PhoneType/preferred")>-1){return-1}if(t.type.EnumMember.indexOf("com.sap.vocabularies.Communication.v1.PhoneType/preferred")>-1){return 1}return 0}).forEach(function(e){this.addProperty2ExpandAndSelect("uri",e,t,n,o);this._addLabeledTel("uri",s.getText("POPOVER_CONTACT_SECTION_FAX"),e,t,i,a);e.processed=true},this);p.filter(function(e){return!e.processed&&e.type&&e.type.EnumMember.indexOf("com.sap.vocabularies.Communication.v1.PhoneType/preferred")>-1}).forEach(function(e){this.addProperty2ExpandAndSelect("uri",e,t,n,o);this._addLabeledTel("uri",s.getText("POPOVER_CONTACT_SECTION_PHONE"),e,t,i,a);e.processed=true},this)};b.prototype._addAddresses=function(e,t,n,o,i,a){if(!e.adr||!e.adr.length){return}var s=r.getResourceBundleFor("sap.ui.comp");var p=m([],e.adr);p.filter(function(e){return!e.processed&&e.type&&(e.type.EnumMember.indexOf("com.sap.vocabularies.Communication.v1.ContactInformationType/preferred")>-1||e.type.EnumMember.indexOf("com.sap.vocabularies.Communication.v1.ContactInformationType/work")>-1)}).sort(function(e,t){if(e.type.EnumMember.indexOf("com.sap.vocabularies.Communication.v1.ContactInformationType/preferred")>-1&&t.type.EnumMember.indexOf("com.sap.vocabularies.Communication.v1.ContactInformationType/preferred")<0){return-1}if(t.type.EnumMember.indexOf("com.sap.vocabularies.Communication.v1.ContactInformationType/preferred")>-1&&e.type.EnumMember.indexOf("com.sap.vocabularies.Communication.v1.ContactInformationType/preferred")<0){return 1}return 0}).forEach(function(e){this._addLabeledAddress(s.getText("POPOVER_CONTACT_SECTION_ADR"),e,t,n,o,i,a);e.processed=true},this)};b.prototype._addLabeledAddress=function(e,t,r,n,o,s,p){var u=[];["street","code","locality","region","country"].forEach(function(e){this.addProperty2ExpandAndSelect(e,t,r,n,o);var i;if(t[e]){i=r+"/"+t[e].Path}u.push(i&&!this.isPropertyHidden(i)?{path:i}:{path:"$notExisting"})},this);if(!u.length){return}var d=new a({text:{parts:u,formatter:function(e,t,r,n,o){var i=[];if(e){i.push(e)}if(t&&r){i.push(t+" "+r)}else{if(t){i.push(t)}if(r){i.push(r)}}if(n){i.push(n)}if(o){i.push(o)}return i.join(", ")}},visible:{parts:u,formatter:function(e,t,r,n,o){return!!(e||t||r||n||o)}}});var l=new i({text:e,labelFor:d.getId()});p.observe(d,{properties:["visible"]});s.push(l);s.push(d)};b.prototype._addLabeledTel=function(e,t,r,n,o,a){if(!r[e]||!n){return}var s=n+"/"+r[e].Path;if(this.isPropertyHidden(s)){return}var u=new p({href:{path:s,formatter:function(e){return e?"tel:"+e:e}},text:{path:s},visible:{path:s,formatter:function(e){return!!e}}});var d=new i({text:t,labelFor:u.getId()});a.observe(u,{properties:["visible"]});o.push(d);o.push(u)};b.prototype._addLabeledEmail=function(e,t,r,n,o,a){if(!r[e]||!n){return}var s=n+"/"+r[e].Path;if(this.isPropertyHidden(s)){return}var u=new p({href:{path:s,formatter:function(e){return e?"mailto:"+e:e}},text:{path:s},visible:{path:s,formatter:function(e){return!!e}}});var d=new i({text:t,labelFor:u.getId()});a.observe(u,{properties:["visible"]});o.push(d);o.push(u)};b.prototype.addProperty2ExpandAndSelect=function(e,t,r,n,o){if(!t[e]||!r){return}var i=r+"/"+t[e].Path;if(!i){return}if(i.indexOf("/")!==0){throw"sap.ui.comp.navpopover.ContactDetailsController.addProperty2ExpandAndSelect: the path of sBindingPathOfProperty '"+i+"' is not valid."}var a=i.split("/");a.shift();a.shift();var s=a.join("/");if(s){o.push(s)}a.pop();var p=a.join("/");if(!p){return}var u=n.filter(function(e){return e===p});if(!u.length){n.push(p)}};b.prototype.isPropertyHidden=function(e){var t;if(!this.getModel()){l.error("sap.ui.comp.navpopover.ContactDetailsController.isPropertyHidden: the model does not exist");return false}if(!this.getModel().getMetaModel()){l.error("sap.ui.comp.navpopover.ContactDetailsController.isPropertyHidden: the model should be the ODataModel");return false}try{t=this.getModel().getMetaModel().getMetaContext(e)}catch(t){l.error("sap.ui.comp.navpopover.ContactDetailsController.isPropertyHidden: the path of property path '"+e+"' is not valid. Error has been caught: "+t);return false}var r=t.getProperty(t.getPath());return d.isHidden(r)};b.prototype._requestData=function(e,t,r,n){var o={};if(r.length){o.expand=r.join(",")}if(n.length){o.select=n.join(",")}var i="/"+t.split("/")[1];e.bindObject({path:i,parameters:o,events:{change:function(){e.invalidate()}}})};return b});
//# sourceMappingURL=ContactDetailsController.js.map