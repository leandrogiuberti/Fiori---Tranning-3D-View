/*
 * SAPUI5
 * (c) Copyright 2025 SAP SE. All rights reserved.
 */
sap.ui.define(["sap/ui/model/SimpleType","sap/ui/core/format/NumberFormat","sap/ui/model/odata/type/Boolean","sap/ui/comp/smartfield/type/Double","sap/ui/comp/smartfield/type/DateTime","sap/ui/comp/odata/type/StringDate","sap/ui/comp/odata/type/FiscalDate","sap/ui/comp/odata/type/NumericText","sap/ui/comp/smartfield/type/DateTimeOffset","sap/ui/model/odata/type/DateTimeWithTimezone","sap/ui/comp/smartfield/type/Decimal","sap/ui/comp/smartfield/type/Int16","sap/ui/comp/smartfield/type/Int32","sap/ui/comp/smartfield/type/Int64","sap/ui/comp/smartfield/type/Byte","sap/ui/comp/smartfield/type/SByte","sap/ui/comp/smartfield/type/String","sap/ui/comp/smartfield/type/StringNullable","sap/ui/comp/smartfield/type/TextArrangementString","sap/ui/comp/smartfield/type/TextArrangementGuid","sap/ui/comp/smartfield/type/AbapBool","sap/ui/comp/smartfield/type/Currency","sap/ui/comp/smartfield/type/Time","sap/ui/comp/smartfield/type/Guid","sap/ui/comp/odata/MetadataAnalyser","sap/ui/comp/odata/FiscalMetadata","sap/ui/comp/smartfield/type/Unit","sap/ui/comp/smartfield/type/IanaTextArrangement","sap/ui/comp/odata/type/CalendarDate","sap/ui/comp/odata/CalendarMetadata","sap/ui/comp/library","sap/base/util/merge"],function(e,t,n,r,i,a,o,s,p,u,l,m,c,f,y,g,d,h,C,v,T,x,D,_,F,w,O,S,b,A,L,E){"use strict";var I=L.numericEdmTypes;var P=function(e){this._oParent=e};P.prototype.getType=function(t,T,x,O){O=O||{};var L=this._oParent.getBindingInfo("value"),E=L&&L.binding&&L.binding.getType(),P=O.composite&&E instanceof e;if(E&&!P){return N(E)}if(t&&t.property&&t.property.type){if(!E){x=this.getConstraints(t.property,x);T=this.getFormatOptions(t.property,T)}if(I.indexOf(t.property.type)!==-1&&x.nullable===false){T.parseEmptyValueToZero=true}switch(t.property.type){case"Edm.Boolean":return new n(T,x);case"Edm.Double":return new r(T,x);case"Edm.Decimal":case"Edm.Single":return new l(T,this._getDecimalConstraints(t,x));case"Edm.Int16":return new m(T,x);case"Edm.Int32":return new c(T,x);case"Edm.Int64":return new f(T,x);case"Edm.Byte":return new y(T,x);case"Edm.SByte":return new g(T,x);case"Edm.DateTimeOffset":if(this.isWithTimeZone(t)){return new u(T)}return new p(T,x);case"Edm.DateTime":return new i(T,this._getDateTimeConstraints(t,x));case"Edm.String":if(!E){x=this._getStringConstraints(t,x)}if(E&&!x){x=E.oConstraints}var B=A.getCalendarAnnotationType(t.property);if(B&&!O.composite){return new b(T,x,{calendarType:B})}if(this.isCalendarDate(t)&&!O.composite){return new a(T)}var M=w.getFiscalAnnotationType(t.property);if(M&&!O.composite){return new o(T,x,{fiscalType:M})}if(x&&x.isDigitSequence&&!O.composite){return new s(T,x)}if(O.composite&&this.isTimeZone(t)){T=Object.assign({},T,this._getTextArrangementFormatOptions());return new S(T,x,this._getTextArrangementOptions(O))}if(O.composite){T=Object.assign({},T,this._getTextArrangementFormatOptions());x=this._getTextArrangementConstraints(t,x,T);if(x.isDigitSequence){return[new C(T,x,this._getTextArrangementOptions(O),this._oParent),new s(T,x)]}else{return new C(T,x,this._getTextArrangementOptions(O),this._oParent)}}if(this.isTimeZone(t)){return new u(T)}if(t.isStringNullable){return new h(T,x)}return new d(T,x,this._oParent);case"Edm.Time":return new D(T,x);case"Edm.Guid":var V={},k=this._getTextArrangementFormatOptions();if(F.hasTextArrangementAnnotation(t.property)&&k&&k.textArrangement==="descriptionOnly"){V={validateException:{resourceBundle:"sap.ui.comp",text:"ENTER_AN_EXISTING_DESCRIPTION"}}}if(O.composite){T=Object.assign({},T,this._getTextArrangementFormatOptions());return new v(T,x,this._getTextArrangementOptions(O))}return new _(T,x,V);default:return null}}return null};function N(e){var t=e.parseValue,n=e.destroy;e.parseValue=function(e,n){var r=t.apply(this,arguments);if(typeof this.oFieldControl==="function"){this.oFieldControl(e,n)}return r};e.destroy=function(){n.apply(this,arguments);this.oFieldControl=null};return e}P.prototype.getConstraints=function(e,t){return Object.assign({},t,{nullable:F.isNullable(e),skipDecimalsValidation:F.isSkippingMeasuredQuantityCheck(e)})};P.prototype.getFormatOptions=function(e,t){var n={};if(F.isUpperCase(e)){n.displayFormat="UpperCase"}return Object.assign({},t,n)};P.prototype.cloneType=function(e){const t=e.getMetadata().getClass();return new t(e.oFormatOptions?E({},e.oFormatOptions):undefined,e.oConstraints?E({},e.oConstraints):undefined)};P.prototype._getDateTimeConstraints=function(e,t){var n={},r;if(e.property["sap:display-format"]==="Date"||this.isCalendarDate(e)){n={displayFormat:"Date"}}for(r in t){n[r]=t[r]}return n};P.prototype.getMaxLength=function(e,t){var n=[],r,i=0;if(t&&t.constraints){if(t.constraints.maxLength&&t.constraints.maxLength>-1){n.push(t.constraints.maxLength)}}if(t&&t.type&&t.type.oConstraints){if(t.type.oConstraints.maxLength&&t.type.oConstraints.maxLength>-1){n.push(t.type.oConstraints.maxLength)}}if(e&&e.property&&e.property.maxLength){var a=parseInt(e.property.maxLength);if(a>-1){n.push(a)}}var o=this._oParent.getMaxLength();if(o>0){n.push(o)}var s=n.length;while(s--){r=n[s];if(r>0){if(i>0){if(r<i){i=r}}else{i=r}}}return i};P.prototype._getDecimalConstraints=function(e,t){var n=e.property;t=t||{};if(n.precision){t.precision=parseInt(n.precision)}if(n.scale){t.scale=parseInt(n.scale)}if(n["sap:variable-scale"]){t.variableScale=n["sap:variable-scale"]==="true"}return t};P.prototype._getTextArrangementFormatOptions=function(){return{textArrangement:this._oParent.getControlFactory()._getDisplayBehaviourConfiguration()}};P.prototype._getTextArrangementConstraints=function(e,t,n){var r=Object.assign({},t),i,a=e.valueListAnnotation;if(a&&n&&n.textArrangement==="descriptionOnly"){i=a.fields.find(function(e){return e.name===a.descriptionField});if(i!==undefined&&parseInt(i.maxLength)>parseInt(t.maxLength)){r.keyMaxLength=r.maxLength;r.maxLength=t.maxLength;r.descriptionMaxLength=i.maxLength}}return r};P.prototype._getStringConstraints=function(e,t){t=t||{};var n=this._oParent.getBindingInfo("value"),r=this.getMaxLength(e,n),i;if(n&&n.type&&n.type.oConstraints){if(n.type.oConstraints.equals){i=n.type.oConstraints.equals}}if(r>0||i){if(r>0){t.maxLength=r}if(i){t.equals=i}}if(F.isDigitSequence(e.property)){t.isDigitSequence=true}return t};P.prototype._getTextArrangementOptions=function(e){var t=this._oParent.getControlFactory().oTextArrangementDelegate;return{keyField:e.keyField,descriptionField:e.descriptionField,valueListNoValidation:e.valueListNoValidation,valueList:e.valueList,onBeforeValidateValue:t.onBeforeValidateValue.bind(t),delegate:e.delegate,clientSideMandatoryCheck:this._oParent.getClientSideMandatoryCheck()}};P.prototype.isCalendarDate=function(e){var t=e.property["com.sap.vocabularies.Common.v1.IsCalendarDate"];if(t&&t.Bool){return t.Bool?t.Bool!=="false":true}return false};P.prototype.isTimeZone=function(e){return e.property["com.sap.vocabularies.Common.v1.IsTimezone"]&&e.property["com.sap.vocabularies.Common.v1.IsTimezone"].Bool!=="false"};P.prototype.isWithTimeZone=function(e){return e.property["com.sap.vocabularies.Common.v1.Timezone"]?true:false};P.prototype.getDisplayFormatter=function(e,t){t=t||{};if(t.currency){return this.getCurrencyDisplayFormatter(t)}else if(t.type&&t.type.oConstraints&&t.type.oConstraints.scale&&e.scale){e.scale=t.type.oConstraints.scale}return this.getUOMDisplayFormatter(e,t)};P.prototype.getCurrencyDisplayFormatter=function(e){var t={showMeasure:false,emptyString:NaN},n;this._enhanceFormatOptions(t);n=new x(t);return function(t,r,i){var a,o,s,p,u,l=this&&this.oParent&&this.oParent.oParent,m=l&&l.isA("sap.ui.comp.smartfield.SmartField")&&l.isFormContextType();if(!t||!r||r==="*"){return""}if(!e.currency){a=t+=" ";return a}if(isNaN(parseFloat(t))){return t.toString()+" "}a=n.formatValue([t,r,i],"string");p=i&&i[r]&&i[r].digits;s=n&&n.oOutputFormat&&n.oOutputFormat.oLocaleData.getCurrencyDigits(r);o=p||s;if(o===0&&!m){a+=" "}u=3-o;if(u&&!m&&a){a=a.padEnd(a.length+u," ")}else{a+=" "}if(e.mask){return P.maskValue(a)}return a}};P.prototype.getUOMDisplayFormatter=function(e,t){var n={showMeasure:false,emptyString:NaN},r;this._enhanceFormatOptions(n);r=new O(n,{scale:e&&e.scale?e.scale:0});return function(e,n,i){var a,o,s=this&&this.oParent&&this.oParent.oParent,p=s&&s.isA("sap.ui.comp.smartfield.SmartField")&&s.isFormContextType();if(!e&&e!==0||!n&&n!==""||n==="*"){return""}if(isNaN(parseFloat(e))){return e.toString()+" "}a=r.formatValue([e,n,i],"string");o=i&&i[n]&&i[n].UnitSpecificScale;if((o===0||o===null)&&!p){a+=" "}if(!p&&s&&s.getControlContext&&s.getControlContext()===""&&a&&o){a=a.padEnd(a.length+1," ")}if(p){a+=" "}if(t&&t.mask){return P.maskValue(a)}return a}};P.maskValue=function(e){if(e){return e.replace(new RegExp(".","igm"),"*")}return e};P.prototype.getCurrencyType=function(e){if(e){var t=this._getDecimalConstraints(e),n=this.getConstraints(e.property,t),r=B(n),i=M(t);this._enhanceFormatOptions(r);return new x(r,this.getConstraints(e.property,i))}return null};P.prototype.getUoMType=function(e){var t=["edm.int16","edm.int32","edm.byte","edm.double"];if(e){var n=this._getDecimalConstraints(e),r=this.getConstraints(e.property,n),i=B(r);if(t.includes(e.property.type.toLowerCase())){i.parseAsString=false;r.type=e.property.type}this._enhanceFormatOptions(i);return new O(i,r)}return null};function B(e){var t=e.nullable?null:0;return{showMeasure:false,parseAsString:true,emptyString:t,precision:e.precision}}function M(e){return{precision:e.precision,scale:e.scale,variableScale:e.variableScale}}P.prototype.getAbapBoolean=function(){return new T};P.prototype.destroy=function(){this._oParent=null};P.prototype._enhanceFormatOptions=function(e){var t=this._getCustomDataConfiguration();if(typeof t.preserveDecimals==="boolean"){e.preserveDecimals=t.preserveDecimals}};P.prototype._getCustomDataConfiguration=function(){var e={},t;if(this._oParent){t=this._oParent.data("preserveDecimals");if(t){e.preserveDecimals=t==="true"}}return e};return P},true);
//# sourceMappingURL=ODataTypes.js.map