/*
 * SAPUI5
 * (c) Copyright 2025 SAP SE. All rights reserved.
 */
sap.ui.define(["sap/ui/comp/smartfield/BindingUtil","sap/ui/core/Lib","sap/ui/model/ParseException","sap/base/strings/capitalize","sap/base/util/isPlainObject","sap/ui/comp/library"],function(t,e,i,r,o,n){"use strict";var a=n.numericEdmTypes;var s=function(e,i){this._bIsDestroyed=false;this._oBinding=new t;this._oStoredProperties={};this._bVisibleSet=false;this._bEditableSet=false;this._bMandatorySet=false;this._bUomEditableSet=false;this._oStoredBindings={};this._oParent=e;this._oHelper=i;this._oAnnotation=i.oAnnotation};s.prototype.getPropertyNames=function(t){if(t){return["editable","visible"]}return["editable","visible","mandatory"]};s.prototype.getControlFormatters=function(t,e){var i,o,n,a={};if(t&&e){o=e.length;while(o--){n=e[o];i="_get"+r(n);if(this[i]){a[n]=this[i](t,this._oParent.getBindingInfo(n))}}}return a};s.prototype._getEditable=function(t,e,i){if(i===undefined){i="editable"}var n,a=this._oParent["get"+r(i)](),s=-1,p=-1,l=-1,d=-1,u=this;var f={length:0};if(i==="uomEditable"){this._bUomEditableSet=true}else{this._bEditableSet=true}if(!e){n=this._oParent["get"+r(i)]();this._oStoredProperties[i]=n;this._oStoredBindings.editable=null}else if(this._oStoredBindings.editable===undefined){this._oStoredBindings.editable=e}return{path:function(){var i=[],r,o=0;if(!t.property||!t.property.property){return[""]}r=u._oAnnotation.getFieldControlPath(t.property.property);if(r){i.push(u._toPath(t,r));s=o;o++}if(t.entitySet["sap:updatable-path"]){if(t.toRoleAssociationEndMultiplicity==="1"){i.push(u._toPath(t,t.entitySet["sap:updatable-path"]))}else{i.push(t.entitySet["sap:updatable-path"])}p=o;o++}if(e){l=o;u._oBinding.getBindingParts(e,i,f);o=o+f.length}if(t&&t.navigationPath&&!u._oParent._getEditableForNotExpandedNavigation()){i.push(t.navigationPath);d=o;o++}if(o>0){return i}return[""]},formatter:function h(_,y,g,b){if(u._bIsDestroyed){return false}if(!u._oAnnotation){return false}var c=this||u._oParent;var m;if(c&&typeof c.getBindingContext==="function"){m=c.getBindingContext()}var P=m&&m.getObject(),S=P&&P.__metadata,v=!!(S&&S.created),E=t.property&&t.property.property,B=s>-1?arguments[s]:null;if(v&&S.created.functionImport){if(B===1){return false}if(E["com.sap.vocabularies.Common.v1.FieldControl"]?.EnumMember==="com.sap.vocabularies.Common.v1.FieldControlType/ReadOnly"||E["com.sap.vocabularies.UI.v1.ReadOnly"]){return false}return true}if(P&&E){if(v){if(c.data("ignoreInsertRestrictions")==="true"){return true}if(!u._getCreatableStatic(t)){return false}}else if(!u._getUpdatableStatic(t)){return false}}var C=[];if(s>-1){C.push(arguments[s]!==1)}if(p>-1&&(!P||!S||!v)&&arguments[p]!==undefined&&arguments[p]!==null){C.push(!!arguments[p])}if(l>-1){if(e.formatter){C.push(u._execFormatter(e.formatter,arguments,l,f.length))}else{C.push(!!arguments[l])}}if(d>-1){C.push(!!arguments[d])}if(C.length===0){var A=c&&c.getBinding(i),I=c&&c.getBindingPath(i),M=I==="",O=!!A&&A.isInitial(),T=_==null;if(T&&M&&(m&&!m.isTransient()||m===undefined)){n=u._oParent["get"+r(i)]()}else if(M&&o(_)&&P&&E&&u._getCreatableStatic(t)&&u._getUpdatableStatic(t)){n=u._oParent["get"+r(i)]()}else if(!O&&T){n=true}else if(!O&&a&&m&&m.isTransient()&&P&&E&&u._getCreatableStatic(t)){n=true}else if(!O&&!T&&M&&!o(_)){n=_}C.push(n)}return u._compare(C,false,true)}}};s.prototype._execFormatter=function(t,e,i,r){var o=[],n;if(i>-1&&r>-1){for(n=0;n<r;n++){o.push(e[i+n])}}return t.apply(this._oParent,o)};s.prototype._getCreatableStatic=function(t){var e=this._oAnnotation.canCreateEntitySet(t.entitySet),i=this._oAnnotation.canCreateProperty(t.property.property),r=t.ignoreInsertRestrictions;return(e||r)&&i};s.prototype._getUpdatableStatic=function(t){return this._oAnnotation.canUpdateEntitySet(t.entitySet)&&this._oAnnotation.canUpdateProperty(t.property.property)};s.prototype._compare=function(t,e,i){var r,o=t.length;for(r=0;r<o;r++){if(t[r]===e){return e}}return i};s.prototype._getUIVisible=function(t){const e=this._oHelper.getEdmProperty(t),i=!!t.functionImportProperty,r=this._oAnnotation.getVisible(e)==="true";if(!i){return r}return this._oAnnotation.getVisible(t.functionImportProperty)==="true"};s.prototype._getVisible=function(t,e,i){if(i===undefined){i="visible"}var n,a=-1,s=-1,p=this;var l={length:0};this._bVisibleSet=true;if(!e){n=this._oParent["get"+r(i)]();this._oStoredProperties[i]=n;this._oStoredBindings.visible=null}else if(this._oStoredBindings.visible===undefined){this._oStoredBindings.visible=e}return{path:function(){var i=[],r,o=0;if(!t.property||!t.property.property){return[""]}r=p._oAnnotation.getUIHiddenPath(t.property.property);if(!r){r=p._oAnnotation.getFieldControlPath(t.property.property)}if(r){i.push(p._toPath(t,r));s=o;o++}if(e){a=o;p._oBinding.getBindingParts(e,i,l);o=o+l.length}if(o>0){return i}return[""]},formatter:function d(u,f){if(p._bIsDestroyed){return false}if(!p._oAnnotation){return false}var h=this||p._oParent,_=t.property&&t.property.property;if(_&&!p._getUIVisible(t)||p._oAnnotation.getUIHiddenPath(_)&&u===true){return false}var y=[];if(s>-1){y.push(arguments[s]!==0);h._fieldControlValue=u}if(a>-1){if(e.formatter){y.push(p._execFormatter(e.formatter,arguments,a,l.length))}else{y.push(!!arguments[a])}}if(y.length==0){var g=h&&h.getBinding(i),b=h&&h.getBindingPath(i),c=b==="",m=!!g&&g.isInitial(),P=u==null,S;if(m&&P&&c){S=n}else if(!m&&P){S=true}else if(!m&&!P&&c&&!o(u)){S=u}else{S=p._oParent["get"+r(i)]()}y.push(S)}return p._compare(y,false,true)}}};s.prototype._getMandatory=function(t,e){var i=-1,r=-1,o=this;var n={length:0};this._bMandatorySet=true;if(!e){this._oStoredProperties.mandatory=this._oParent.getMandatory();this._oStoredBindings.mandatory=null}else if(this._oStoredBindings.mandatory===undefined){this._oStoredBindings.mandatory=e}return{path:function(){var a=[],s,p=0;if(!t.property||!t.property.property){return[""]}s=o._oAnnotation.getFieldControlPath(t.property.property);if(s){a.push(o._toPath(t,s));r=p;p++}if(e){i=p;o._oBinding.getBindingParts(e,a,n);p=p+n.length}if(p>0){return a}return[""]},formatter:function a(s,p){var l=t.property&&t.property.property,d=[],u,f,h;if(l&&l.nullable!==undefined){h=l&&l.nullable==="false"?true:false}if(o._bIsDestroyed){return true}u=r>-1;if(u){if(arguments[r]===7){h=true}else if(arguments[r]===3){h=false}}if(l&&o._oAnnotation){if(o._oAnnotation.isStaticMandatory(l)){h=true}else if(o._oAnnotation.isStaticOptional(l)){h=false}}if(h!==undefined){d.push(h)}f=i>-1;if(f){if(e.formatter){d.push(o._execFormatter(e.formatter,arguments,i,n.length))}else{d.push(!!arguments[i])}}if(d.length===0||l&&l.nullable==="true"&&!u&&!f){d.push(o._oParent.getMandatory())}return o._compare(d,true,false)}}};s.prototype._toPath=function(t,e){if(t.property.complex){return t.path.replace(t.property.property.name,e)}if(t.navigationPath){return t.navigationPath+"/"+e}return e};s.prototype.getMandatoryCheck=function(t,r){if(t){switch(t.property.type){case"Edm.DateTimeOffset":case"Edm.DateTime":case"Edm.Time":case"Edm.String":case"Edm.Decimal":case"Edm.Double":case"Edm.Float":case"Edm.Single":case"Edm.Int16":case"Edm.Int32":case"Edm.Int64":case"Edm.Byte":case"Edm.SByte":case"Edm.Guid":return function(o,n){var s,p=e.getResourceBundleFor("sap.ui.comp"),l=r?o==null:o===""||o==null,d=a.indexOf(t.property.type)!==-1;if(l){if(this._oParent&&this._oParent.getComputedTextLabel&&this._oParent.getComputedTextLabel()){s=p.getText("MANDATORY_FIELD_WITH_LABEL_ERROR",[this._oParent.getComputedTextLabel()])}else{s=p.getText("MANDATORY_FIELD_ERROR")}if(this._oAnnotation&&(d&&!this._oAnnotation.isStaticMandatory(t.property))&&(!this._oAnnotation.isNullable(t.property)&&!this._oAnnotation.isStaticOptional(t.property)&&(this._oParent&&this._oParent._fieldControlValue!==3))&&(this._oParent.getClientSideMandatoryCheck()||t.property.type!=="Edm.String")){throw new i(s)}if(this._oParent.getClientSideMandatoryCheck()&&this._oParent.getMandatory()){throw new i(s)}}}.bind(this)}}};s.prototype.getUOMEditState=function(t){var e,i,r,o=0,n;n=this._oParent.getBindingInfo("editable");e=this._getEditable(t,n);r={model:t.model,path:this._oHelper.getUOMPath(t),entitySet:t.entitySet,entityType:t.entityType,property:{property:t.annotations.uom.property,complex:t.property.complex,typePath:this._oHelper.getUOMTypePath(t)}};i=this._getEditable(r,this._oParent.getBindingInfo("uomEditable"),"uomEditable");return{path:function(){var t=e.path(),r=i.path();if(t[0]===""&&r===""){return[""]}o=t.length;return t.concat(r)},formatter:function t(r,n,a,s){var p=[],l,d,u,f=arguments.length;for(l=0;l<o;l++){p.push(arguments[l])}d=e.formatter.apply(null,p);p=[];for(l=0;l<f;l++){p.push(arguments[l])}for(l=0;l<o;l++){p.shift()}u=i.formatter.apply(null,p);if(!u&&!d){return 0}return 1}}};s.prototype.hasUomEditState=function(t){var e;if(t&&t.annotations&&t.annotations.uom){e=this._oParent.getControlProposal&&this._oParent.getControlProposal();if(e){if(e.getControlType()==="ObjectNumber"){return true}if(e.getObjectStatus()){return true}}return this._oParent.getProposedControl&&this._oParent.getProposedControl()==="ObjectNumber"}return false};s.prototype.bindProperties=function(t){var e={propertiesNames:this.getPropertyNames()};t=Object.assign(e,t);var i=t.propertiesNames,r=t.metadata;if(i.length){var o=this.getControlFormatters(r,i);for(var n in o){var a=this._oBinding.fromFormatter(r.model,o[n]);this._oParent.bindProperty(n,a)}}};s.prototype.destroy=function(){if(this._oBinding){this._oBinding.destroy();this._oBinding=null}this._oAnnotation=null;var t=this._oParent;if(t&&!t._bInDestroy){var e=true;for(var i in this._oStoredProperties){t.unbindProperty(i,e);var o="set"+r(i),n=t[o];if(typeof n==="function"){n.call(t,this._oStoredProperties[i])}}if(this._oStoredProperties){if(!this._oStoredProperties.editable&&this._bEditableSet){t.unbindProperty("editable")}if(!this._oStoredProperties.visible&&this._bVisibleSet){t.unbindProperty("visible")}if(!this._oStoredProperties.mandatory&&this._bMandatorySet){t.unbindProperty("mandatory")}if(!this._oStoredProperties.uomEditable&&this._bUomEditableSet){t.unbindProperty("uomEditable")}}if(this._oStoredBindings){if(this._oStoredBindings.editable){t.bindProperty("editable",this._oStoredBindings.editable)}if(this._oStoredBindings.visible){t.bindProperty("visible",this._oStoredBindings.visible)}if(this._oStoredBindings.mandatory){t.bindProperty("mandatory",this._oStoredBindings.mandatory)}if(this._oStoredBindings.uomEditable){t.bindProperty("uomEditable",this._oStoredBindings.uomEditable)}}}this._oStoredProperties=null;this._oStoredBindings=null;this._oParent=null;this._oHelper=null;this._bIsDestroyed=true;this._bEditableSet=false;this._bMandatorySet=false;this._bVisibleSet=false;this._bUomEditableSet=false};return s},true);
//# sourceMappingURL=FieldControl.js.map