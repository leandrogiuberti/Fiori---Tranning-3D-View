/*!
 * SAPUI5
 * (c) Copyright 2025 SAP SE. All rights reserved.
 */
sap.ui.define(["./BaseController","sap/m/library","sap/ui/comp/library","./Util","sap/base/util/merge"],function(t,e,r,o,n){"use strict";var s=t.extend("sap.ui.comp.personalization.SortController",{constructor:function(r,o){t.apply(this,arguments);this.setType(e.P13nPanelType.sort);this.setItemType(e.P13nPanelType.sort+"Items")},metadata:{events:{afterSortModelDataChange:{}}}});s.prototype.setTable=function(e){t.prototype.setTable.apply(this,arguments);if(this.getTableType()===r.personalization.TableType.ResponsiveTable){e.detachEvent("_sort",this._onSort,this);e.attachEvent("_sort",this._onSort,this)}else if(e&&e.detachSort&&e.detachSort){e.detachSort(this._onSort,this);e.attachSort(this._onSort,this)}};s.prototype.getColumn2Json=function(t,e,r){if(!o.isSortable(t)){return null}if(!t.getSorted||t.getSorted&&!t.getSorted()){return null}if(!t.getSortOrder||t.getSortOrder()==="None"){return null}return{columnKey:e,operation:t.getSortOrder()}};s.prototype.getColumn2JsonTransient=function(t,e,r,n){if(!o.isSortable(t)){return null}return{columnKey:e,text:r,tooltip:n!==r?n:undefined}};s.prototype.handleIgnore=function(t,e){t.sort.sortItems.splice(e,1)};s.prototype.syncJson2Table=function(t){var e=this.getColumnMap();var o=n({},e);this.fireBeforePotentialTableChange();if(this.getTableType()===r.personalization.TableType.AnalyticalTable||this.getTableType()===r.personalization.TableType.Table||this.getTableType()===r.personalization.TableType.TreeTable){t.sort.sortItems.forEach(function(t){var r=e[t.columnKey];if(!r){return}if(t.operation===undefined){return}if(!r.getSorted()){r.setSorted(true)}if(r.getSortOrder()!==t.operation){r.setSortOrder(t.operation)}delete o[t.columnKey]});for(var s in o){var a=o[s];if(a&&a.getSorted()){a.setSorted(false)}if(a&&a.getSortOrder()!=="None"){a.setSortOrder("None")}}}this.fireAfterPotentialTableChange()};s.prototype.getDataSuiteFormat2Json=function(t){var e=this.createControlDataStructure();if(!t.SortOrder||!t.SortOrder.length){return e}e.sort.sortItems=t.SortOrder.map(function(t){return{columnKey:t.Property,operation:t.Descending?"Descending":"Ascending"}});return e};s.prototype.getDataSuiteFormatSnapshot=function(t){var e=this.getUnionData(this.getControlDataInitial(),this.getControlData());if(!e.sort||!e.sort.sortItems||!e.sort.sortItems.length){return}t.SortOrder=e.sort.sortItems.map(function(t){return{Property:t.columnKey,Descending:t.operation==="Descending"}})};s.prototype._onSort=function(t){t.preventDefault();this._updateInternalModel(o.getColumnKey(t.getParameter("column")),t.getParameter("sortOrder"),t.getParameter("columnAdded"));this.syncJson2Table(this.getControlData());this.fireAfterSortModelDataChange()};s.prototype._updateInternalModel=function(t,e,r){if(!t||e!=="Descending"&&e!=="Ascending"&&e!=="None"){return}if(!r){this.getInternalModel().setProperty("/controlData/sort/sortItems",[])}var n=this.getControlData();if(e!="None"){var s=o.getIndexByKey("columnKey",t,n.sort.sortItems);s=s>-1?s:n.sort.sortItems.length;this.getInternalModel().setProperty("/controlData/sort/sortItems/"+s+"/",{columnKey:t,operation:e})}this.updateControlDataBaseFromJson(n)};s.prototype._hasSortableColumns=function(){return o.hasSortableColumns(this.getColumnMap())};s.prototype.retrieveAdaptationUI=function(t){if(!o.hasSortableColumns(this.getColumnMap())){return null}return new Promise(function(t){sap.ui.require(["sap/m/p13n/SortPanel"],function(e){var r=this.getAdaptationData();var o=new e;o.setP13nData(r);this.oPanel=o;o.attachChange(function(t){var e=o.getP13nData(true);var r=this.getControlDataReduce();r.sort.sortItems=e.map(function(t){return{columnKey:t.name,operation:t.descending?"Descending":"Ascending"}});this.setControlDataReduce2Model(r);this.fireAfterPotentialModelChange({json:r})}.bind(this));t(o)}.bind(this))}.bind(this))};s.prototype._transformAdaptationData=function(e,r){var o=t.prototype._transformAdaptationData.apply(this,arguments);o.sorted=!!e;o.descending=e?e.operation==="Descending":false;return o};s.prototype._sortAdaptationData=function(t){this._getP13nBuilder().sortP13nData({visible:"sorted",position:"position"},t)};s.prototype._getPresenceAttribute=function(){return"sorted"};s.prototype.getChangeType=function(t,e){if(!e||!e.sort||!e.sort.sortItems){return r.personalization.ChangeType.Unchanged}var o=JSON.stringify(t.sort.sortItems)!==JSON.stringify(e.sort.sortItems);return o?r.personalization.ChangeType.ModelChanged:r.personalization.ChangeType.Unchanged};s.prototype.getChangeData=function(t,e){var r=t?.sort?.sortItems,n=e?.sort?.sortItems,s=r?.length>0&&n?.length>0;if(!t||!t.sort||!r){return{sort:{sortItems:[]}}}if(!e||!e.sort||!e.sort.sortItems){return{sort:o.copy(t.sort)}}if(JSON.stringify(r)!==JSON.stringify(e.sort.sortItems)){return{sort:o.copy(t.sort)}}if(s){if(JSON.stringify(r)===JSON.stringify(n)&&JSON.stringify(n)===JSON.stringify(this.getControlDataInitial().sort.sortItems)){return{sort:o.copy(t.sort)}}}return null};s.prototype.getUnionData=function(t,e){if(!e||!e.sort||!e.sort.sortItems){return{sort:o.copy(t.sort)}}return{sort:o.copy(e.sort)}};s.prototype.exit=function(){t.prototype.exit.apply(this,arguments);var e=this.getTable();if(e&&e.detachSort){e.detachSort(this._onSort,this)}};return s});
//# sourceMappingURL=SortController.js.map