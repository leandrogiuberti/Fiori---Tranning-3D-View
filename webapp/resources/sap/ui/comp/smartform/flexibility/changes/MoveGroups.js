/*!
 * SAPUI5
 * (c) Copyright 2025 SAP SE. All rights reserved.
 */
sap.ui.define(["sap/base/Log","sap/ui/core/Element","sap/ui/core/util/reflection/JsControlTreeModifier","sap/ui/fl/changeHandler/condenser/Classification"],function(e,n,t,r){"use strict";var o={};o._checkCompleteChangeContentConditions=function(e){if(!e.movedElements){throw new Error("oSpecificChangeInfo.movedElements attribute required")}if(e.movedElements.length===0){throw new Error("MovedElements array is empty")}e.movedElements.forEach(function(e){if(!e.id){throw new Error("MovedElements element has no id attribute")}if(typeof e.targetIndex!=="number"){throw new Error("Index attribute at MovedElements element is no number")}})};o._buildStableChangeInfo=function(e){var n=e.source.id;var t=e.target.id;var r={changeType:e.changeType,selector:{id:n},targetId:t!==n?t:null};r[e.changeType]=[];e.movedElements.forEach(function(n){r[e.changeType].push({id:n.id,sourceIndex:n.sourceIndex,index:n.targetIndex})});return r};o.applyChange=function(n,t,r){function o(n,r){if(!n){return Promise.reject(new Error("No change instance"))}var o=n.getContent();return Promise.resolve().then(r.getAggregation.bind(r,t,"groups")).then(function(n){if(!n){e.error("Object has no smartform elements aggregation",r.getId(t))}if(!o||!o.moveGroups||o.moveGroups.length===0){return Promise.reject(new Error("Change format invalid"))}return undefined})}function i(e,n,t,r){if(!e.selector&&!e.id){return Promise.reject(new Error("Change format invalid - moveGroups element has no id attribute"))}if(typeof e.index!=="number"){return Promise.reject(new Error("Change format invalid - moveGroups element index attribute is no number"))}return Promise.resolve(n.bySelector(e.selector||e.id,t,r))}var s=r.modifier;var a=r.view;var u=r.appComponent;var c=[];function d(n,r){if(!r){return Promise.resolve(e.warning("Group to move not found"))}return Promise.resolve().then(s.findIndexInParentAggregation.bind(s,r)).then(function(e){if(e===n.index&&typeof n.sourceIndex==="number"){e=n.sourceIndex}c.push({selector:s.getSelector(r,u),index:e})}).then(s.removeAggregation.bind(s,t,"groups",r,a)).then(s.insertAggregation.bind(s,t,"groups",r,n.index))}return o(n,s).then(function(){var e=n.getContent();return e.moveGroups.reduce(function(e,n){return e.then(i.bind(null,n,s,u,a)).then(function(e){return d(n,e)})},Promise.resolve())}).then(function(){n.setRevertData({movedGroups:c})})};o.completeChangeContent=function(e,r,o){this._checkCompleteChangeContentConditions(r);r=this._buildStableChangeInfo(r);var i={moveGroups:[]};var s=r.moveGroups.map(function(e){var r=n.getElementById(e.id);var s=t.getSelector(r,o.appComponent);i.moveGroups.push({selector:s,sourceIndex:e.sourceIndex,index:e.index});return r});e.addDependentControl(s,"movedGroups",o);e.setContent(i)};o.revertChange=function(e,n,t){var r=t.appComponent;var o=t.view;var i=t.modifier;var s=e.getRevertData().movedGroups;return s.reduce(function(e,t){var s=i.bySelector(t.selector,r,o);return e.then(i.removeAggregation.bind(i,n,"groups",s,o)).then(i.insertAggregation.bind(i,n,"groups",s,t.index))},Promise.resolve()).then(function(){e.resetRevertData()})};o.getChangeVisualizationInfo=function(e){var n=e.getContent();return{affectedControls:[n.moveGroups[0].selector],dependentControls:[n.moveGroups[0].selector.source||e.getSelector()]}};o.getCondenserInfo=function(e,n){const t=e.getContent();const o=n.modifier;const i=n.appComponent;const s=n.view;const a=o.bySelector(t.moveGroups[0].selector,i,s);const u=a.getParent().getParent();return{affectedControl:t.moveGroups[0].selector,classification:r.Move,sourceContainer:u.getId(),targetContainer:u.getId(),sourceIndex:t.moveGroups[0].sourceIndex,sourceAggregation:"groups",targetAggregation:"groups",setTargetIndex(e,n){const t=e.getContent();t.moveGroups[0].index=n;e.setContent(t)},getTargetIndex(e){return e.getContent().moveGroups[0].index},setIndexInRevertData(e,n){const t=e.getRevertData();t.movedGroups[0].index=n;e.setRevertData(t)}}};return o},true);
//# sourceMappingURL=MoveGroups.js.map