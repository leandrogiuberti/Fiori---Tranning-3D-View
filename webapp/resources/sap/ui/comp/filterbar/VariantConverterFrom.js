/*!
 * SAPUI5
 * (c) Copyright 2025 SAP SE. All rights reserved.
 */
sap.ui.define(["sap/ui/comp/library","sap/ui/core/date/UI5Date","sap/ui/comp/util/DateTimeUtil","sap/m/DatePicker","sap/m/DateRangeSelection","sap/base/Log","sap/ui/core/format/DateFormat"],function(e,t,i,a,r,n,l){"use strict";var o=e.ANALYTICAL_PARAMETER_PREFIX;var s=e.smartfilterbar.FilterType;var f=e.valuehelpdialog.ValueHelpRangeOperation;var c=function(){};c.prototype.convert=function(e,t,i){var a=null,r=null,n;if(e){this._bStrictMode=i;n=JSON.parse(e);if(t&&t.getFilterBarViewMetadata&&n){this._sBasicSearchName=null;this._sBasicSearchValue=null;if(t.getBasicSearchName){this._sBasicSearchName=t.getBasicSearchName()}a={};if(n.Parameters){this._addParameters(n.Parameters,t,a)}if(n.SelectOptions){this._addSelectOptions(n.SelectOptions,t,a)}r={payload:null,variantId:null};r.payload=JSON.stringify(a);if(n.SelectionVariantID){r.variantId=n.SelectionVariantID}if(this._sBasicSearchValue){r.basicSearch=this._sBasicSearchValue}}}return r};c.prototype.retrieveVariantId=function(e){var t=null;var i;if(e){i=JSON.parse(e);if(i&&i.SelectionVariantID){t=i.SelectionVariantID}}return t};c.prototype._getParameterMetaData=function(e,t,i){if(this._bStrictMode){return this._getParameterMetaDataStrictMode(e,t)}return this._getParameterMetaDataNonStrictMode(e,t,i)};c.prototype._getFilter=function(e,t){var i,a,r,n;n=t.getFilterBarViewMetadata();if(n){for(i=0;i<n.length;i++){r=n[i];for(a=0;a<r.fields.length;a++){if(e===r.fields[a].fieldName){return r.fields[a]}}}}return null};c.prototype._getParameter=function(e,t){var i,a;if(t.getAnalyticalParameters){a=t.getAnalyticalParameters();if(a){for(i=0;i<a.length;i++){if(e===a[i].fieldName){return a[i]}}}}return null};c.prototype._getParameterWithInnerPrefix=function(e,t){var i=e;if(e.indexOf(o)!==0){i=o+e}return this._getParameter(i,t)};c.prototype._getParameterMetaDataStrictMode=function(e,t){var i=this._getExactFilterParameterMatch(e,t);if(i){return i}return null};c.prototype._getParameterMetaDataNonStrictMode=function(e,t,i){var a,r,n,l,s=e,f=false,c=function(){return f&&s===l||!f&&s!==l};if(e.indexOf(o)===0){s=e.substr(o.length);f=true}if(s.indexOf("P_")===0){r=s;n=s.substr(2)}else{r="P_"+s;n=s}if(s!==r){l=r}else if(s!==n){l=n}a=this._getExactParameterMatch(s,t);if(a){return a}a=this._getExactParameterMatch(l,t);if(a){return a}if(c()){a=this._getFilter(n,t);if(a){return a}}return null};c.prototype._getExactParameterMatch=function(e,t){var i;i=this._getParameterWithInnerPrefix(e,t);if(i){return i}return null};c.prototype._getExactFilterParameterMatch=function(e,t){var i,a;i=this._getFilter(e,t);if(i){return i}a=this._getParameterWithInnerPrefix(e,t);if(a){return a}return null};c.prototype._addParameters=function(e,t,i){var a;var r,l;var o;for(a=0;a<e.length;a++){l=e[a].PropertyValue;r=e[a].PropertyName;if(this._sBasicSearchName&&r===this._sBasicSearchName){this._sBasicSearchValue=l;continue}o=this._getParameterMetaData(r,t,true);if(o){t.determineControlByName(r);this._addAccordingMetaData(i,t,o,l)}else{n.error("neither metadata nor custom information for filter '"+r+"'")}}};c.prototype._addSelectOptions=function(e,t,i){var a;var r,l;var o,s;for(a=0;a<e.length;a++){r=e[a].PropertyName;l=e[a].Ranges;if(this._sBasicSearchName&&r===this._sBasicSearchName){if(l&&l.length>0){this._sBasicSearchValue=l[0].Low}continue}t.determineControlByName(r);o=this._getParameterMetaData(r,t,false);if(o){s=o.control;this._addRangesAccordingMetaData(i,t,o,l,s)}else{n.error("neither metadata nor custom information for filter '"+r+"'")}}};c.convertOption=function(e,t,i){var a;switch(e){case"CP":a=f.Contains;if(t){var r=t.indexOf("*");var l=t.lastIndexOf("*");if(r>-1){if(r===0&&l!==t.length-1){a=f.EndsWith;t=t.substring(1,t.length)}else if(r!==0&&l===t.length-1){a=f.StartsWith;t=t.substring(0,t.length-1)}else{t=t.substring(1,t.length-1)}}}break;case"EQ":var o=i?.type;if(o){var s=o==="Edm.String"?true:false}if(!s&&t===""||t===null){a=f.Empty;t=null}else{a=e}break;case"BT":case"LE":case"GE":case"GT":case"LT":a=e;break;default:n.error("Suite Option is not supported '"+e+"'");a=undefined;t=undefined}return{op:a,v:t}};c.prototype._getYearMonthDatePattern=function(e){var t=e.match(/^([0-9]{4})([0-9]{2})([0-9]{2})$/);if(t){return[t[1],t[2],t[3]]}};c.prototype._getTimeZoneFormat=function(e){return e.split(/[\s+-]/)[0]};c.prototype._createDateObject=function(e){var i,a,r,n,l,o,s,f;if(!e){return}i=e.split(".");a=i[0];r=i[1];if(r){r=this._getTimeZoneFormat(r)}l=a.split("T");f=l[0].split("-");if(f.length===1){n=this._getYearMonthDatePattern(f[0]);if(n){f=n}}if(l.length<2){o=t.getInstance(f[0],f[1]-1,f[2])}else{s=l[1].split(":");o=t.getInstance(f[0],f[1]-1,f[2],s[0],s[1],s[2],r?r:0)}o.setFullYear(f[0]);return o};c.prototype._addRangesAccordingMetaData=function(e,t,o,u,d,m){var h,p;var g=function(e,t,a,r){if(t&&t.isInUTCMode&&a.indexOf("PT")===-1&&e.filterType==="date"){if(t.isInUTCMode()){a=a.split("T")[0]+"T00:00:00"}else if(!t.isInUTCMode()&&a.split("T").length===1){a+="T00:00:00"}}if(a.indexOf("Z")!==a.length-1){if(t&&t.isInUTCMode&&!t.isInUTCMode()){r=i.localToUtc(this._createDateObject(a)).toJSON()}else{r=this._createDateObject(a).toJSON()}}else{n.error("Property '"+e.fieldName+"' was added with zulu time zone information.")}return r}.bind(this);var v=function(e){var t=l.getTimeInstance({pattern:"'PT'hh'H'mm'M'ss'S'"});return t.parse(e)};var _=function(e){var i=e;if(e&&o){if(o.filterType==="numeric"){if(o.type==="Edm.Decimal"||o.type==="Edm.Float"||o.type==="Edm.Double"||o.type==="Edm.Single"){i=parseFloat(e)}else{i=parseInt(e)}}else{switch(o.type){case"Edm.DateTime":i=g(o,t,e,i);break;case"Edm.Time":if(e.indexOf("PT")===0){i=v(e)}else{i=g(o,t,e,i)}break;case"Edm.String":if(o.isCalendarDate&&!o.calendarType&&!(o.filterType==="stringdate"&&o.controlType==="date")){i=g(o,t,e,i)}break;case"Edm.DateTimeOffset":i=e;break;case"Edm.Date":var a=e.split("T"),r=a[1];if(r){r=this._getTimeZoneFormat(r)}i=r?a[0]+"T"+r:e;break;default:i=e;break}}}return i};var y=function(t,i){var a,r,n;for(a=0;a<i.length;a++){n=c.convertOption(i[a].Option,i[a].Low);if(n&&n.op){r={exclude:i[a].Sign==="E",operation:n.op,keyField:t,value1:_(n.v),value2:_(i[a].High)};if(!e[t]){e[t]={ranges:[],items:[],value:null}}e[t].ranges.push(r)}}};var S=function(e){for(var t=0;t<e.length;t++){if(e[t].Sign==="E"){return true}}return false};if(u&&u.length>0){if(o.isCustomFilterField){if(!e._CUSTOM){e._CUSTOM={}}if(Array.isArray(u)&&u.length>1){e._CUSTOM[o.fieldName]=u.map(function(e){return e.Low})}else{e._CUSTOM[o.fieldName]=u[0].Low}return}if(o.conditionType){for(h=0;h<u.length;h++){if(!u[h].High){u[h].High=u[h].Low}}y(o.fieldName,u);return}if(o.filterRestriction===s.single){if(!u[0].Low&&d&&d instanceof a){e[o.fieldName]=null}else{e[o.fieldName]=_(u[0].Low)}}else if(o.filterRestriction===s.interval){if(d&&d instanceof r){if(u[0].Low&&u[0].High){e[o.fieldName]={low:_(u[0].Low),high:_(u[0].High)}}else if(u[0].Low&&!u[0].High){e[o.fieldName]={low:_(u[0].Low),high:_(u[0].Low)}}else if(!u[0].Low&&u[0].High){e[o.fieldName]={low:_(u[0].High),high:_(u[0].High)}}else{e[o.fieldName]={low:null,high:null}}}else{if(o.type==="Edm.Time"){y(o.fieldName,u)}else if(o.type==="Edm.DateTimeOffset"&&u[0].Option==="EQ"){e[o.fieldName]={low:u[0].Low===undefined?null:_(u[0].Low),high:null}}else{e[o.fieldName]={low:u[0].Low===undefined?null:_(u[0].Low),high:u[0].High===undefined?null:_(u[0].High)}}}}else if(o.filterRestriction===s.multiple){e[o.fieldName]={ranges:[],items:[],value:null};var T=o.type==="Edm.DateTimeOffset"||o.isCalendarDate||o.type==="Edm.DateTime"||o.type==="Edm.Time";var M=d&&d.isA("sap.m.MultiInput")&&S(u);if(d&&!T&&(d.isA("sap.m.MultiComboBox")||d.isA("sap.m.MultiInput"))&&!M){var N;for(h=0;h<u.length;h++){N=_(u[h].Low);if(u[h].Option==="EQ"&&N===""){p={op:u[h].Option,v:N}}else{p=c.convertOption(u[h].Option,N)}if(p.op===f.EQ){e[o.fieldName].items.push({key:_(p.v)})}}}else{y(o.fieldName,u)}}else{y(o.fieldName,u)}n.warning("potential reduced information for filter '"+o.fieldName+"'")}else{n.warning("no Ranges-section found for filter '"+o.fieldName+"'")}};c.prototype._addAccordingMetaData=function(e,t,i,a){var r=i.type==="Edm.DateTime"?"":a;var n=[{Sign:"I",Low:a,High:r,Option:"EQ"}];this._addRangesAccordingMetaData(e,t,i,n)};return c},true);
//# sourceMappingURL=VariantConverterFrom.js.map