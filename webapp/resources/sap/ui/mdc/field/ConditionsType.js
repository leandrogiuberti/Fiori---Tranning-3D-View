/*!
 * OpenUI5
 * (c) Copyright 2025 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["sap/ui/core/Lib","sap/ui/mdc/field/ConditionType","sap/ui/mdc/field/ConditionTypeMixin","sap/ui/mdc/condition/Condition","sap/ui/mdc/condition/ConditionValidateException","sap/ui/mdc/condition/FilterOperatorUtil","sap/ui/mdc/enums/ConditionValidated","sap/ui/mdc/enums/FieldDisplay","sap/ui/mdc/enums/OperatorName","sap/ui/model/SimpleType","sap/ui/model/FormatException","sap/ui/model/ParseException","sap/ui/model/ValidateException","sap/base/util/merge","sap/ui/base/SyncPromise","sap/ui/core/util/PasteHelper"],(t,e,i,o,n,s,r,a,l,u,p,d,h,c,f,y)=>{"use strict";const m=u.extend("sap.ui.mdc.field.ConditionsType",{constructor:function(i,o){u.apply(this,arguments);this.sName="Conditions";i=g(i);this._oConditionType=new e(i,this.oConstraints);this._oResourceBundle=t.getResourceBundleFor("sap.ui.mdc")}});m.prototype.destroy=function(){u.prototype.destroy.apply(this,arguments);if(this._oConditionType){this._oConditionType.destroy();this._oConditionType=undefined}this._bDestroyed=true};m.prototype.setFormatOptions=function(t){u.prototype.setFormatOptions.apply(this,arguments);t=g(t);if(this._oConditionType){this._oConditionType.setFormatOptions(t)}};function g(t){t=c({},t);if(t.asyncParsing){delete t.asyncParsing}return t}m.prototype.setConstraints=function(t){u.prototype.setConstraints.apply(this,arguments);if(this._oConditionType){this._oConditionType.setConstraints(this.oConstraints)}};m.prototype.formatValue=function(t,e){if(t==undefined||t==null||this._bDestroyed){return null}if(!Array.isArray(t)){throw new p("No valid conditions provided")}let i;if(!e||e==="string"||e==="any"){i=""}else if(e==="float"||e==="int"){i=0}if(this._getNoFormatting()){return this._getKeepValue()||i}const o=this._getMaxConditions();const n=[];const s=function(t,e){return f.resolve().then(()=>this._oConditionType.formatValue(t,e))};if(t.length===0){let t=s.call(this,null,e);const i=this._getValueHelp();const o=this.oFormatOptions.emptyAllowed;if(o&&i?.isRestrictedToFixedValues()){t=t.then(t=>{const e=this._getDelegate();const n=this.oFormatOptions.control;const s=this.oFormatOptions.bindingContext;const r=this._getValueType();return f.resolve().then(()=>e.getDescription(n,i,null,undefined,undefined,s,undefined,undefined,undefined,n,r,o)).then(t=>typeof t==="object"?t.description:t)})}n.push(t)}else{for(let i=0;i<t.length;i++){n.push(s.call(this,t[i],e));if(o>0&&i>=o-1){break}}}return f.all(n).then(t=>_.call(this,t,i)).unwrap()};function _(t,e){for(let i=0;i<t.length;i++){if(e){e=e+this._oResourceBundle.getText("field.SEPARATOR")+t[i]}else if(t[i]){e=t[i]}}return e}m.prototype.parseValue=function(t,e){if(this._bDestroyed){return null}if(this._getNoFormatting()&&t===""){return this.oFormatOptions.getConditions?this.oFormatOptions.getConditions():[]}return this._parseValueToIndex(t,e,-1)};m.prototype._parseValueToIndex=function(t,e,i){const o=this._getValueType();const n=this._getDefaultOperator(this._getOperators(),o);const s=n&&n.name===l.BT;const r=this._getMultipleLines();const u=r||e&&e!=="string"?[[t]]:y.getPastedDataAs2DArray(t);if(u.length>1||u.length===1&&u[0].length>1){const t=s?o:this._getDefaultType();const e=[{property:"value",type:o},{property:"additionalValue",type:t}];return this._fnReturnPromise(y.parse(u,e).then(e=>{if(e.errors){if(e.errors.length===1){throw new d(e.errors[0].message)}else{throw new d(this._oResourceBundle.getText("field.PASTE_ERROR"))}}return Promise.resolve(this._getDelegate().parsePasteDataToConditions(this.oFormatOptions.control,e.parsedData,{defaultOperator:n,valueType:o,additionalValueType:t})).then(t=>{const e=t.map(t=>typeof t==="string"?this._oConditionType._parseValue(t,"string",false,a.Value):t);let o=this.oFormatOptions.getConditions&&this.oFormatOptions.getConditions();e.forEach((t,e)=>{o=v.call(this,t,o,i>=0?i+e:i,true)});return o})}))}else{return C.call(this,t,e,i)}};function C(t,e,i){const o=function(t,e){return this._oConditionType.parseValue(t,e)};const n=function(t){throw t};return T.call(this,[t],e,i,o,n)}function T(t,e,i,o,n){const s=[];for(let i=0;i<t.length;i++){s.push(o.call(this,t[i],e))}const r=f.all(s).then(t=>{let e=this.oFormatOptions.getConditions&&this.oFormatOptions.getConditions();for(let o=0;o<t.length;o++){e=v.call(this,t[o],e,i,false);if(i>=0){i++}}return e}).catch(t=>{n.call(this,t)}).unwrap();return this._fnReturnPromise(r)}function v(t,e,i,o){const n=this._isUnit(this.oFormatOptions.valueType);const s=this._getMaxConditions();const r=this._getValueHelp();const a=this._getDelegate();const u=this.oFormatOptions.control;if(s!==1&&this.oFormatOptions.getConditions){if(t){if(this._isCompositeType(this.oFormatOptions.valueType)&&!n&&e.length===1&&(e[0].values[0][0]===null||e[0].values[0][0]===undefined||e[0].values[0][1]===null||e[0].values[0][1]===undefined)&&(t.values[0][0]!==null&&t.values[0][0]!==undefined&&t.values[0][1]!==null&&t.values[0][1]!==undefined)){e.splice(0,1)}if(a.indexOfCondition(u,r,t,e)===-1){if(i>=0&&e.length>i){e.splice(i,0,t)}else{e.push(t)}}else if(!o){throw new d(this._oResourceBundle.getText("field.CONDITION_ALREADY_EXIST",[this._oConditionType.formatValue(t)]))}if(s>0&&s<e.length){e.splice(0,e.length-s)}}return e}else if(n&&this.oFormatOptions.getConditions&&e.length>1){const i=t&&t.values[0][1];const o=t&&t.inParameters;const n=t&&t.outParameters;const s=t&&t.payload;for(let r=0;r<e.length;r++){e[r].values[0][1]=i;if(i===undefined){e[r].values[0][0]=t.values[0][0]}e[r].values[0].splice(2);if(e[r].operator===l.BT){e[r].values[1][1]=i;if(i===undefined){e[r].values[1][0]=t.values[0][0]}e[r].values[1].splice(2)}if(o||e[r].inParameters){e[r].inParameters=o}if(n||e[r].outParameters){e[r].outParameters=n}if(s||e[r].payload){e[r].payload=s}}if(e.length===0){e.push(t)}return e}else if(t){return[t]}else{return[]}}m.prototype.validateValue=function(t){if(t===undefined||t===null||this._bDestroyed){return}if(!Array.isArray(t)){throw new n("No valid conditions provided",undefined,undefined,t)}let e;try{for(let i=0;i<t.length;i++){e=t[i];this._oConditionType.validateValue(e)}const i=this._getMaxConditions();const o=this.oFormatOptions.emptyAllowed||!this.oFormatOptions.hasOwnProperty("emptyAllowed")&&i!==1;if(t.length===0&&!o){this._oConditionType.validateValue(null)}}catch(i){if(i instanceof n){i.setConditions(t)}else if(i instanceof h){throw new n(i.message,i.violatedConstraints,c({},e))}throw i}};i.call(m.prototype);return m});
//# sourceMappingURL=ConditionsType.js.map