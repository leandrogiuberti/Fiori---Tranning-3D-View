/*!
 * OpenUI5
 * (c) Copyright 2025 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["sap/ui/core/Element","sap/m/MultiInput","sap/m/Tokenizer","sap/ui/mdc/field/FieldMultiInputRenderer","sap/ui/Device","sap/ui/base/ManagedObjectObserver"],(e,t,i,n,o,s)=>{"use strict";const r=t.extend("sap.ui.mdc.field.FieldMultiInput",{metadata:{library:"sap.ui.mdc",properties:{ariaAttributes:{type:"object",defaultValue:{},byValue:true}}},renderer:n});r.prototype.init=function(){t.prototype.init.apply(this,arguments);const e=this.getAggregation("tokenizer");e._fillClipboard=d;e._handleNMoreIndicator=function(e){const t=this.getBinding("tokens");const n=t.getLength();const o=this.getTokens().length;const s=n-o;return i.prototype._handleNMoreIndicator.apply(this,[e+s])};e._handleNMoreIndicatorPress=function(){const e=this.getParent();l.call(e);return i.prototype._handleNMoreIndicatorPress.apply(this,arguments)};this._oObserver=new s(c.bind(this));this._oObserver.observe(this,{properties:["ariaAttributes"]})};r.prototype.exit=function(){t.prototype.exit.apply(this,arguments);this._oObserver.disconnect();this._oObserver=undefined};r.prototype.onfocusin=function(e){if(e.srcControl.isA("sap.m.Token")){const t=this.indexOfToken(e.srcControl);if(t>=0){this._iRestoreTokenFocus=this.getTokens().length-t}if(this._oUpdateBindingTimer||this._bUpdateBinding){this.bDeletePressed=false;this.iFocusedIndexBeforeUpdate=0}l.call(this,true);e.setMark("doNotOpenOnFocus",true)}else{delete this._iRestoreTokenFocus;l.call(this,false)}t.prototype.onfocusin.apply(this,arguments)};r.prototype.ontap=function(e){if(e.target.classList.contains("sapMTokenizerIndicator")){e.setMark("tokenizerMoreIndicatorTap")}t.prototype.ontap.apply(this,arguments)};r.prototype.onAfterRendering=function(){const{bDeletePressed:e,bTokensUpdated:i}=this;const n=this.iFocusedIndexBeforeUpdate;let o=false;if(this._oUpdateBindingTimer){this.bTokensUpdated=false;this.bDeletePressed=false;o=true}else if(this._bUpdateBinding&&this._iRestoreTokenFocus!==undefined){this.iFocusedIndexBeforeUpdate=this.getTokens().length-this._iRestoreTokenFocus;delete this._iRestoreTokenFocus;delete this._bUpdateBinding;this.bDeletePressed=true;const e=this.getAggregation("tokenizer");if(e._oSelectionOrigin){e._oSelectionOrigin=e.getTokens()[this.iFocusedIndexBeforeUpdate]}o=true}t.prototype.onAfterRendering.apply(this,arguments);if(o){this.bDeletePressed=e;this.iFocusedIndexBeforeUpdate=n;this.bTokensUpdated=i}};r.prototype.shouldSuggetionsPopoverOpenOnMobile=function(i){const n=this.getParent();const o=n?.getValueHelp?.();const s=o&&e.getElementById(o);if(s?.getTypeahead()){return false}else{return t.prototype.shouldSuggetionsPopoverOpenOnMobile.apply(this,arguments)}};let a=false;async function d(e){if(!navigator.clipboard){throw new Error(this+" requires a secure context in order to access the clipboard API.")}if(!a){const e=this.getSelectedTokens();if(e.length===0){return}a=true;const t=this.getBindingInfo("tokens").model;const i=e.map(e=>{const i=e.getBinding("text").getType();const n=e.getBindingContext(t).getObject();return i.getTextForCopy(n)}).join("\r\n");const n="<table><tr>"+e.map(e=>"<td>"+e.getText()+"</td>").join("</tr><tr>")+"</tr></table>";if(p()){const e="text/html";const t="text/plain";const o=new ClipboardItem({[t]:new Blob([i],{type:t}),[e]:new Blob([n],{type:e})});await navigator.clipboard.write([o])}else{await navigator.clipboard.writeText(i)}if(a){a=false}}}function p(){return Boolean(o.system.desktop&&window.ClipboardItem&&navigator.clipboard?.write)}function l(e){const t=this.getBindingInfo("tokens");if(!this._oUpdateBindingTimer&&(t.length||t.startIndex)){const i=()=>{let e=t.template;let i=true;if(t.templateShareable!==true){e=e.clone();i=false}this._bUpdateBinding=true;this.bindAggregation("tokens",{path:t.path,model:t.model,template:e,templateShareable:i})};if(e){const e=this.getBinding("tokens");const n=e.getLength();if(n>=t.length){this._oUpdateBindingTimer=setTimeout(()=>{delete this._oUpdateBindingTimer;i()},200)}}else{i()}}}function c(e){if(e.name==="ariaAttributes"){if(e.current.aria?.activedescendant!==e.old.aria?.activedescendant){const t=this.getFocusDomRef();if(!e.current.aria?.activedescendant){t.removeAttribute("aria-activedescendant")}else{t.setAttribute("aria-activedescendant",e.current.aria.activedescendant)}}}}r.prototype._onValueHelpRequested=function(){this._bValueHelpOpen=false};return r});
//# sourceMappingURL=FieldMultiInput.js.map