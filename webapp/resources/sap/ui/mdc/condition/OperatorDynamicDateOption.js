/*!
 * OpenUI5
 * (c) Copyright 2025 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["sap/m/DynamicDateOption","sap/m/DynamicDateValueHelpUIType","sap/m/DynamicDateRange","sap/m/Input","sap/ui/mdc/enums/BaseType","sap/ui/mdc/enums/FieldDisplay","sap/ui/mdc/enums/OperatorName","sap/ui/mdc/enums/OperatorValueType","sap/ui/mdc/util/DateUtil","sap/ui/mdc/util/loadModules","sap/ui/model/json/JSONModel","sap/ui/model/FormatException","sap/ui/model/ParseException","sap/ui/model/ValidateException","sap/ui/core/library","sap/ui/core/Lib","sap/base/i18n/Localization"],(e,t,s,a,o,n,r,i,p,l,u,y,c,f,d,h,g)=>{"use strict";const{ValueState:m}=d;let T;let v;let _=h.getResourceBundleFor("sap.ui.mdc");g.attachChange(()=>{_=h.getResourceBundleFor("sap.ui.mdc")});const B=e.extend("sap.ui.mdc.condition.OperatorDynamicDateOption",{metadata:{library:"sap.ui.mdc",properties:{operator:{type:"object"},type:{type:"object"},baseType:{type:"sap.ui.mdc.enums.BaseType"}}}});B.prototype.exit=function(){e.prototype.exit.apply(this,arguments);if(this._oModel){this._oModel.destroy();this._oModel=undefined;this._mChangeHandler=undefined}if(this._aUITypes){for(let e=0;e<this._aUITypes.length;e++){this._aUITypes[e].destroy()}this._aUITypes=undefined}};B.prototype.applySettings=function(){e.prototype.applySettings.apply(this,arguments);const t=[];const s=this.getBaseType();if(s===o.DateTime){if(!v){t.push("sap/m/DateTimePicker")}}else if(!T){t.push("sap/m/DatePicker")}if(t.length>0){return l(t).then(e=>{if(s===o.DateTime){v=e[0]}else{T=e[0]}})}};B.prototype.validateProperty=function(t,s){if(t==="operator"&&s&&(typeof s!=="object"||!s.isA||!s.isA("sap.ui.mdc.condition.Operator"))){throw new Error('"'+s+'" is of type '+typeof s+", expected "+'sap.ui.mdc.condition.Operator for property "'+t+'" of '+this)}else if(t==="type"&&s&&(typeof s!=="object"||!s.isA||!s.isA("sap.ui.model.Type"))){throw new Error('"'+s+'" is of type '+typeof s+", expected "+'sap.ui.model.Type for property "'+t+'" of '+this)}return e.prototype.validateProperty.apply(this,arguments)};B.prototype.isRange=function(){const e=this.getOperator();return e.isA("sap.ui.mdc.condition.RangeOperator")};B.prototype.getText=function(e){const t=this.getOperator();if(t.name===r.Empty){return _.getText("operators.Empty.longText.date",undefined,true)}else{const e=this.getBaseType();return t.getLongText(e)}};B.prototype.getValueHelpUITypes=function(e){if(!this._aUITypes){const e=this.getOperator();let s=this.getType();const a=this.getBaseType();this._aUITypes=[];for(const n of e.valueTypes){if(n===i.Self){let e;if(a===o.DateTime){e="datetime"}else{e="date"}this._aUITypes.push(new t({type:e}))}else if(!n||n===i.Static){continue}else{s=e._createLocalType(n,s);if(s.isA("sap.ui.model.type.Integer")||s.isA("sap.ui.model.odata.type.Int")){this._aUITypes.push(new t({type:"int"}))}else{this._aUITypes.push(new t({type:"custom"}))}}}}return this._aUITypes};B.prototype.createValueHelpUI=function(e,t){let s=e.getValue();const n=this.getOperator();let r=this.getType();const l=this.getKey();const y=e.getId();if(!s||s.operator!==l){s={operator:l,values:[]};if(n.valueDefaults){s.values=n.valueDefaults}}O.call(this,e);if(!e.aControlsByParameters){e.aControlsByParameters={}}e.aControlsByParameters[l]=[];let c=function(e){t(this)}.bind(this);for(let f=0;f<n.valueTypes.length;f++){const d=n.valueTypes[f];const h=this.getBaseType();let g;if(!d){continue}if(!e.aControlsByParameters[l][f]){if(n.createControl){if(!this._oModel){c=function(e){const t=e.getParameter("path");const s=t.split("/");const a=s[0]||s[1];if(this._mChangeHandler&&this._mChangeHandler[a]){this._mChangeHandler[a](this)}}.bind(this);this._oModel=new u;this._oModel.attachPropertyChange({},c,this);this._mChangeHandler={}}const a=this._oModel.getData();a[y]={value0:s&&s.values[0],value1:s&&s.values[1]};this._mChangeHandler[y]=t;if(d!==i.Self){r=n._createLocalType(d,r)}const o=n.createControl(r,"internal>/"+y+"/value"+f,f,y+"-"+f);o.setModel(this._oModel,"internal");e.aControlsByParameters[l].push(o)}else if(d===i.Self){if(s&&s.values[f]){g=p.typeToDate(s.values[f],r,h)}const t=r.getFormatOptions();let a;if(h===o.DateTime){a=v}else{a=T}const n=new a(y+"-"+f,{dateValue:g,displayFormat:t.style||t.pattern,displayFormatType:t.calendarType,change:c});e.aControlsByParameters[l].push(n)}else if(typeof d==="object"){r=n._createLocalType(n.valueTypes[f],r);const t=r.formatValue(s&&s.values[f],"string");const o=new a(y+"-"+f,{value:t,change:c});e.aControlsByParameters[l].push(o)}}}return e.aControlsByParameters[l]};B.prototype.validateValueHelpUI=function(e){const t=this.getKey();const s=this.getOperator();const a=this.getType();let o;let n=true;let r=m.None;let i;let p=0;try{o=this.getValueHelpOutput(e);for(p=0;p<o.values.length;p++){const e=o.values[p];if(e===undefined||e===null){n=false}}s.validate(o.values,a)}catch(e){n=false;r=m.Error;i=e.message;if(e&&!(e instanceof c)&&!(e instanceof f)){throw e}}if(!s.createControl){for(p=0;p<e.aControlsByParameters[t].length;p++){const s=e.aControlsByParameters[t][p];if(s.setValueState){s.setValueState(r);s.setValueStateText(i)}}}return n};B.prototype.getValueHelpOutput=function(e){const t=this.getKey();const s={operator:t,values:[]};const a=this.getOperator();let o=this.getType();const n=this.getBaseType();const r=e.getId();for(let l=0;l<a.valueTypes.length;l++){if(!a.valueTypes[l]||a.valueTypes[l]===i.Static){continue}const u=e.aControlsByParameters[t][l];if(u){let e;if(a.createControl){e=this._oModel?this._oModel.getProperty("/"+r+"/value"+l):null}else if(a.valueTypes[l]===i.Self){if(!u.isValidValue()){throw new c}e=u.getDateValue();if(e){e=p.dateToType(e,o,n)}}else{e=u.getValue();o=a._createLocalType(a.valueTypes[l],o);e=o.parseValue(e,"string")}s.values.push(e)}}return s};B.prototype.getGroupHeader=function(){const t=this.getOperator();if(t.name===r.Empty){return _.getText("VALUEHELP.OPERATOR.GROUP3",undefined,true)}else{const e=this.getBaseType();const s=t.getGroup(e);if(s&&s.text){return s.text}}return e.prototype.getGroupHeader.apply(this,arguments)};B.prototype.getGroup=function(){const t=this.getOperator();if(t.name===r.Empty){return"901"}else{const s=this.getBaseType();const a=t.getGroup(s);if(a){return a.id}return e.prototype.getGroup.apply(this,arguments)}};B.prototype.toDates=function(e){const t=this.getOperator();const s=this.getType();const a=this.getBaseType();let o;let n=0;if(t.isA("sap.ui.mdc.condition.RangeOperator")){o=t._getRange(e&&e.values,s,a);for(n=0;n<o.length;n++){o[n]=p.typeToDate(o[n],s,a)}}else if(t.valueTypes.length===0){o=[]}else if(t.valueTypes[0]===i.Self){o=[];for(n=0;n<e.values.length;n++){o.push(e.values[n]?p.typeToDate(e.values[n],s,a):e.values[n])}if(o.length===1){o.push(o[0])}}else if([i.Self,i.Static].indexOf(t.valueTypes[0])===-1){throw new Error("Cannot convert to date, use RangeOperator")}return o};B.prototype.format=function(e){const t=this.getOperator();if(t.name===r.Empty){return _.getText("operators.Empty.tokenText.date",undefined,true)}else{const s=this.getType();const a=this.getBaseType();return t.format(e,s,n.Value,undefined,undefined,undefined,undefined,undefined,a)}};B.prototype.parse=function(e){const t=this.getOperator();const a=this.getType();const o=this.getBaseType();if(t.name===r.Empty&&e===s.prototype._stripValue(_.getText("operators.Empty.tokenText.date",undefined,true))){return{operator:this.getKey(),values:[]}}else if(e&&t.test(e,o)){const s={};s.operator=this.getKey();s.values=t.parse(e,a,n.Value,undefined,undefined,undefined,undefined,undefined,o);return s}};B.prototype.enhanceFormattedValue=function(e,t){return false};function O(e){const t=this.getKey();if(e&&e.aControlsByParameters&&e.aControlsByParameters[t]){for(const s of e.aControlsByParameters[t]){if(!s.bIsDestroyed){s.destroy()}}delete e.aControlsByParameters[t]}}return B});
//# sourceMappingURL=OperatorDynamicDateOption.js.map