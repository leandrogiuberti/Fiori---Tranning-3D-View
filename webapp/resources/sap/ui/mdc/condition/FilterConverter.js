/*!
 * OpenUI5
 * (c) Copyright 2025 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["sap/ui/mdc/condition/FilterOperatorUtil","sap/ui/mdc/enums/BaseType","sap/ui/model/Filter","sap/ui/model/FilterOperator","sap/base/Log"],(e,t,r,i,n)=>{"use strict";const l={createConditionTypesMapFromFilterBar:function(e,t){const r={};for(const i in e){if(t){const e=t._getPropertyByName(i);let n;if(e&&e.typeConfig){n=e.typeConfig.typeInstance}else{const e=t._getFilterField(i);if(e){const t=e.getFormatOptions();if(t.originalDateType){n=t.originalDateType}else{n=t.valueType}}}r[i]={type:n}}}return r},createFilters:function(s,o,a,f){let u,p,c,h,g,y,F;const d=[];const A=function(e,t,n){if([i.Any,i.All].includes(e.getOperator())){return{filter:null,anyAllFilters:[e]}}else if(!e.getPath()&&e.getFilters()){const i=[];let l=[];e.getFilters().forEach(e=>{const r=A(e,t,n);if(r.filter){i.push(r.filter)}if(r.anyAllFilters.length>0){l=l.concat(r.anyAllFilters)}});let s;if(i.length===1){[s]=i}else if(i.length>1){s=new r({filters:i,and:e.isAnd()})}return{filter:s,anyAllFilters:l}}else if(e.getPath()===t){e.sPath=n;return{filter:e,anyAllFilters:[]}}return e};const w=function(e,t,n){const[l,s,o,a]=t.split(/([\*\+]\/)/);if(s&&e.length>0){let f;if(e.length===1){[f]=e}else if(e.length>1){f=new r({filters:e,and:n})}if(f){const e="L1";if(!a){const a=A(f,t,e+"/"+o);let u;if(a.filter){u=new r({path:l,operator:s==="*/"&&!n?i.Any:i.All,variable:e,condition:a.filter})}if(a.anyAllFilters.length>0){if(u){a.anyAllFilters.push(u);u=new r({filters:a.anyAllFilters,and:n})}else if(a.anyAllFilters.length===1){[u]=a.anyAllFilters}else{u=new r({filters:a.anyAllFilters,and:n})}}return[u]}else{throw new Error("FilterConverter: not supported binding "+t)}}}return e};for(const i in s){p=[];c=[];const l=s[i];if(i==="$search"){continue}let a;let A=true;let v=t.String;if(o){if(o[i]){a=o[i].type;A=o[i].caseSensitive;v=o[i].baseType||t.String;if(!a){n.warning("FilterConverter","Not able to retrieve the type of path '"+i+"!")}}}for(u=0;u<l.length;u++){F=l[u];h=e.getOperator(F.operator);if(!h){continue}try{g=h.getModelFilter(F,i,a,A,v)}catch(e){if(e){n.error("FilterConverter",e)}else{n.error("FilterConverter","Not able to convert the condition for path '"+i+"' into a filter! The type is missing!")}continue}if(!h.exclude){if(g.sPath==="$search"){continue}const e=/^\*(.+)\*$/.exec(g.sPath);if(e){const t=e[1].split(",");for(let e=0;e<t.length;e++){p.push(new r({path:t[e],operator:g.sOperator,value1:g.oValue1,caseSensitive:f}))}continue}p.push(g)}else{c.push(g)}}p=w(p,i,false);c=w(c,i,true);g=undefined;if(p.length===1){g=p[0]}else if(p.length>1){g=new r({filters:p,and:false})}if(g){c.unshift(g)}y=undefined;if(c.length===1){y=c[0]}else if(c.length>1){y=new r({filters:c,and:true})}if(y){d.push(y)}}if(d.length===1){g=d[0]}else if(d.length>1){g=new r({filters:d,and:true})}else{g=null}n.info("FilterConverter",l.prettyPrintFilters(g));return g},prettyPrintFilters:function(e){let t;if(!e){return"no filters set"}if(e._bMultiFilter){t="";const{bAnd:r}=e;e.aFilters.forEach((e,i,n)=>{t+=l.prettyPrintFilters(e);if(n.length-1!=i){t+=r?" and ":" or "}},this);return"("+t+")"}else{if(e.sOperator===i.Any||e.sOperator===i.All){t=e.sVariable?e.sVariable+":":"";t=t+e.sPath+" "+e.sOperator+" "+l.prettyPrintFilters(e.oCondition)}else{if(e.bCaseSensitive===false){t="tolower("+e.sPath+") "+e.sOperator+" tolower('"+e.oValue1+"')"}else{t=e.sPath+" "+e.sOperator+" '"+e.oValue1+"'"}if([i.BT,i.NB].indexOf(e.sOperator)>=0){t+="...'"+e.oValue2+"'"}}return t}}};return l},true);
//# sourceMappingURL=FilterConverter.js.map