/*!
 * OpenUI5
 * (c) Copyright 2025 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["sap/ui/mdc/flexibility/Util","sap/ui/fl/changeHandler/Base","sap/ui/fl/changeHandler/condenser/Classification","sap/ui/fl/changeHandler/common/ChangeCategories"],(e,t,n,i)=>{"use strict";const r={beforeAddItem:function(e,t,n,i){return e.addItem(n,t,i)},afterRemoveItem:function(e,t,n,i){return e.removeItem(n,t,i)},findItem:function(e,t,n){return Promise.resolve()},beforeApply:function(e,t,n){return},afterApply:function(e,t,n){return},determineAggregation:function(e,t){let n;return Promise.resolve().then(e.getControlMetadata.bind(e,t)).then(i=>{n=i.getDefaultAggregation().name;return e.getAggregation(t,n)}).then(e=>({name:n,items:e}))},getChangeVisualizationInfo:function(e,t){return{}},_getExistingAggregationItem:function(e,t,n){const i=t.modifier;return this.determineAggregation(i,n).then(t=>{let n;const r=t.items;if(r){n=this.findItem(i,r,e.name)}return n})},_getOperationText:function(e){return e?"reverted ":"applied "},_getChangeTypeText:function(e){return e?"add":"remove"},_applyAdd:function(n,i,r,a){const o=a===e.REVERT;this.beforeApply(n.getChangeType(),i,o);const g=r.modifier,s=o?n.getRevertData():n.getContent();const d=s.name;let l;let h;let c;let f;const m=this.determineAggregation(g,i).then(e=>{c=e;h=c.items;l=s.index>-1?s.index:h.length;return this._getExistingAggregationItem(s,r,i)}).then(t=>{if(t){return t}else{return g.getProperty(i,"delegate").then(t=>e.getModule(t.name)).then(e=>this.beforeAddItem(e,d,i,r,s)).then(e=>e)}}).then(e=>{if(!e){throw new Error("No item in"+c.name+"  created. Change to "+this._getChangeTypeText(!o)+"cannot be "+this._getOperationText(o)+"at this moment")}if(h.indexOf(e)<0){g.insertAggregation(i,c.name,e,l)}else{return t.markAsNotApplicable("The specified change is already existing - change appliance ignored",true)}f=e.getId?e.getId():e.id;return e}).then(()=>{if(o){n.resetRevertData()}else{n.setRevertData({name:s.name,index:l,item:f})}this.afterApply(n.getChangeType(),i,o)});return m},_applyRemove:function(n,i,r,a){const o=a===e.REVERT;this.beforeApply(n.getChangeType(),i,o);const g=r.modifier,s=o?n.getRevertData():n.getContent();let d;let l;let h;let c;const f=this.determineAggregation(g,i).then(e=>{d=e;return this._getExistingAggregationItem(s,r,i)}).then(e=>{h=e;if(!h){return t.markAsNotApplicable("The specified change is already existing - change appliance ignored",true)}else{return g.findIndexInParentAggregation(h)}}).then(e=>{l=e;return g.removeAggregation(i,d.name,h)}).then(()=>g.getProperty(i,"delegate").then(t=>e.getModule(t.name)).then(e=>this.afterRemoveItem(e,h,i,r).then(e=>{if(e&&h){c=g.getId(h);g.destroy(h,"KeepDom")}this.afterApply(n.getChangeType(),i,o)}))).then(()=>{if(o){n.resetRevertData()}else{n.setRevertData({name:s.name,index:l,item:c})}});return f},_applyMove:function(n,i,r,a){let o;const g=a===e.REVERT;this.beforeApply(n.getChangeType(),i,g);if(this._bSupressFlickering){this._delayInvalidate(i)}const s=r.modifier;const d=g?n.getRevertData():n.getContent();let l;let h;let c;const f=this.determineAggregation(s,i).then(e=>{h=e;return this._getExistingAggregationItem(d,r,i)}).then(e=>{l=e}).then(()=>{if(!l){return t.markAsNotApplicable("The specified change is already existing - change appliance ignored",true)}else{o=l.getId?l.getId():l.id;return s.findIndexInParentAggregation(l)}}).then(e=>{c=e;if(i.moveColumn){return i.moveColumn(l,d.index)}else{return s.removeAggregation(i,h.name,l).then(()=>s.insertAggregation(i,h.name,l,d.index))}}).then(()=>{if(g){n.resetRevertData()}else{n.setRevertData({name:d.name,index:c,item:o})}this.afterApply(n.getChangeType(),i,g)});return f},_removeIndexFromChange:function(e){const t=e.getContent();delete t.index;e.setContent(t)},createAddChangeHandler:function(){return e.createChangeHandler({apply:this._applyAdd.bind(this),revert:this._applyRemove.bind(this),getCondenserInfo:function(e,t){const i=t.modifier.bySelector(e.getSelector(),t.appComponent);return this.determineAggregation(t.modifier,i).then(t=>({affectedControl:{idIsLocal:false,id:e.getRevertData().item},targetContainer:e.getSelector(),targetAggregation:t.name,classification:n.Create,setTargetIndex:function(e,t){e.getContent().index=t},getTargetIndex:function(e){return e.getContent().index}}))}.bind(this),getChangeVisualizationInfo:this.getChangeVisualizationInfo.bind(this)})},createRemoveChangeHandler:function(t){return e.createChangeHandler({apply:this._applyRemove.bind(this),complete:this._removeIndexFromChange.bind(this),revert:this._applyAdd.bind(this),getCondenserInfo:function(e,t){const i=t.modifier.bySelector(e.getSelector(),t.appComponent);return this.determineAggregation(t.modifier,i).then(t=>({affectedControl:{idIsLocal:false,id:e.getRevertData().item},targetContainer:e.getSelector(),targetAggregation:t.name,classification:n.Destroy,sourceIndex:e.getRevertData().index,setIndexInRevertData:function(e,t){const n=e.getRevertData();n.index=t;e.setRevertData(n)}}))}.bind(this),getChangeVisualizationInfo:this.getChangeVisualizationInfo.bind(this)})},createMoveChangeHandler:function(t){return e.createChangeHandler({apply:this._applyMove.bind(this),revert:this._applyMove.bind(this),getCondenserInfo:function(e,t){const i=t.modifier.bySelector(e.getSelector(),t.appComponent);return this.determineAggregation(t.modifier,i).then(t=>({affectedControl:{idIsLocal:false,id:e.getRevertData().item},targetContainer:e.getSelector(),targetAggregation:t.name,classification:n.Move,sourceIndex:e.getRevertData().index,sourceContainer:e.getSelector(),sourceAggregation:t.name,setTargetIndex:function(e,t){e.getContent().index=t},getTargetIndex:function(e){return e.getContent().index},setIndexInRevertData:function(e,t){const n=e.getRevertData();n.index=t;e.setRevertData(n)}}))}.bind(this),getChangeVisualizationInfo:this.getChangeVisualizationInfo.bind(this)})}};return r});
//# sourceMappingURL=ItemBaseFlex.js.map