/*!
 * OpenUI5
 * (c) Copyright 2025 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["sap/base/util/merge","sap/ui/mdc/flexibility/Util","sap/ui/fl/changeHandler/Base","sap/ui/fl/changeHandler/condenser/Classification","sap/ui/fl/changeHandler/common/ChangeCategories","./helpers/addKeyOrName"],(e,t,n,o,r,i)=>{"use strict";const s=function(e,t,n,o){if(o){e.resetRevertData()}else{e.setRevertData(n)}};const a=function(e,n,o,r){return new Promise((a,c)=>{const g=r===t.REVERT;const d=o.modifier;const l=i(g?e.getRevertData():e.getContent());Promise.resolve().then(d.getProperty.bind(d,n,"sortConditions")).then(t=>{const o=t?t.sorters:[];const r={key:l.key,name:l.key,descending:l.descending};o.splice(l.index,0,r);t={sorters:o};d.setProperty(n,"sortConditions",t);s(e,n,r,g);a()}).catch(e=>{c(e)})})};const c=function(e,o,r,a){return new Promise((c,g)=>{const d=r.modifier;const l=a===t.REVERT;const f=i(l?e.getRevertData():e.getContent());Promise.resolve().then(d.getProperty.bind(d,o,"sortConditions")).then(t=>{const r=t?t.sorters:[];if(!r){g()}const a=r.filter(e=>i(e).key===f.key);const p=r.indexOf(a[0]);if(p>-1){r.splice(p,1)}else{return n.markAsNotApplicable("The specified change is already existing - change appliance ignored",true)}t={sorters:r};d.setProperty(o,"sortConditions",t);s(e,o,f,l);c()}).catch(e=>{g(e)})})};const g=function(n,o,r,a){return new Promise((c,g)=>{const d=a===t.REVERT;const l=r.modifier;const f=i(d?n.getRevertData():n.getContent());Promise.resolve().then(l.getProperty.bind(l,o,"sortConditions")).then(t=>{const r=t?t.sorters:[];const a=r.filter(e=>i(e).key===f.key);const g=r.indexOf(a[0]);r.splice(f.index,0,r.splice(g,1)[0]);t={sorters:r};l.setProperty(o,"sortConditions",t);const p=e({},f);p.index=g;s(n,o,p,d);c()}).catch(e=>{g(e)})})};const d=function(e,n){const o=i(e.getContent());const s=n.byId(e.getSelector().id);const a={descriptionPayload:{}};let c;const g=[o.key];if(e.getChangeType()==="addSort"){a.descriptionPayload.category=r.ADD;if(o.descending){c="chart.SORT_ADD_CHANGE_DESC"}else{c="chart.SORT_ADD_CHANGE_ASC"}g.push(o.index)}else if(e.getChangeType()==="removeSort"){a.descriptionPayload.category=r.REMOVE;c="chart.SORT_DEL_CHANGE"}else{a.descriptionPayload.category=r.MOVE;c="chart.SORT_MOVE_CHANGE";g.push(e.getRevertData().index);g.push(o.index)}const d=s?.getPropertyHelper()?.getProperty(o.key);if(d){g.splice(0,1,d.label)}return t.getMdcResourceText(c,g).then(e=>{a.descriptionPayload.description=e;a.updateRequired=true;return a})};const l={};l.addSort=t.createChangeHandler({apply:a,revert:c,getCondenserInfo:function(e,t){return{affectedControl:{id:i(e.getContent()).key},affectedControlIdProperty:"name",targetContainer:e.getSelector(),targetAggregation:"sorters",customAggregation:t.modifier.bySelector(e.getSelector(),t.appComponent).getSortConditions().sorters,classification:o.Create,setTargetIndex:function(e,t){e.getContent().index=t},getTargetIndex:function(e){return e.getContent().index}}},getChangeVisualizationInfo:d});l.removeSort=t.createChangeHandler({apply:c,revert:a,getCondenserInfo:function(e,t){return{affectedControl:{id:i(e.getContent()).key},affectedControlIdProperty:"name",targetContainer:e.getSelector(),targetAggregation:"sorters",customAggregation:t.modifier.bySelector(e.getSelector(),t.appComponent).getSortConditions().sorters,classification:o.Destroy,sourceIndex:e.getRevertData().index,setIndexInRevertData:function(e,t){const n=e.getRevertData();n.index=t;e.setRevertData(n)}}},getChangeVisualizationInfo:d});l.moveSort=t.createChangeHandler({apply:g,revert:g,getCondenserInfo:function(e,t){return{affectedControl:{id:i(e.getContent()).key},affectedControlIdProperty:"name",targetContainer:e.getSelector(),targetAggregation:"sorters",classification:o.Move,sourceIndex:e.getRevertData().index,customAggregation:t.modifier.bySelector(e.getSelector(),t.appComponent).getSortConditions().sorters,sourceContainer:e.getSelector(),sourceAggregation:"sorters",setTargetIndex:function(e,t){e.getContent().index=t},getTargetIndex:function(e){return e.getContent().index},setIndexInRevertData:function(e,t){const n=e.getRevertData();n.index=t;e.setRevertData(n)}}},getChangeVisualizationInfo:d});return l});
//# sourceMappingURL=SortFlex.js.map