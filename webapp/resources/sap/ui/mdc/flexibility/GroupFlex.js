/*!
 * OpenUI5
 * (c) Copyright 2025 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["./Util","sap/ui/fl/changeHandler/Base","sap/ui/fl/changeHandler/condenser/Classification","sap/ui/fl/changeHandler/common/ChangeCategories","./helpers/addKeyOrName"],(e,t,n,o,r)=>{"use strict";const i=function(e,t,n,o){if(o){e.resetRevertData()}else{e.setRevertData(n)}};const a=function(n,o,a,s){return new Promise((g,c)=>{const d=s===e.REVERT;const p=a.modifier;const l=r(d?n.getRevertData():n.getContent());Promise.resolve().then(p.getProperty.bind(p,o,"groupConditions")).then(e=>{const a=e?e.groupLevels:[];const s={key:l.key,name:l.key};const c=a.findIndex(e=>r(e).key===l.key);if(c<0){a.splice(l.index,0,s)}else{return t.markAsNotApplicable("The specified change is already existing - change appliance ignored",true)}e={groupLevels:a};p.setProperty(o,"groupConditions",e);i(n,o,s,d);g()}).catch(e=>{c(e)})})};const s=function(n,o,a,s){return new Promise((g,c)=>{const d=s===e.REVERT;const p=a.modifier;const l=r(d?n.getRevertData():n.getContent());Promise.resolve().then(p.getProperty.bind(p,o,"groupConditions")).then(e=>{const a=e?e.groupLevels:[];if(!a){c()}const s=a.findIndex(e=>r(e).key===l.key);if(s>-1){a.splice(s,1)}else{return t.markAsNotApplicable("The specified change is already existing - change appliance ignored",true)}e={groupLevels:a};p.setProperty(o,"groupConditions",e);i(n,o,l,d);g()}).catch(e=>{c(e)})})};const g=function(t,n,o,a){return new Promise((s,g)=>{const c=a===e.REVERT;const d=o.modifier;const p=r(c?t.getRevertData():t.getContent());Promise.resolve().then(d.getProperty.bind(d,n,"groupConditions")).then(e=>{const o=e?e.groupLevels:[];const a=o.findIndex(e=>r(e).key===p.key);o.splice(p.index,0,o.splice(a,1)[0]);e={groupLevels:o};d.setProperty(n,"groupConditions",e);i(t,n,p,c);s()}).catch(e=>{g(e)})})};const c=function(t,n){const i=r(t.getContent());const a=n.byId(t.getSelector().id);let s;const g=[i.key];const c={descriptionPayload:{}};if(t.getChangeType()==="addGroup"){c.descriptionPayload.category=o.ADD;s="table.GROUP_ITEM_ADD_CHANGE";g.push(i.index)}else if(t.getChangeType()==="removeGroup"){c.descriptionPayload.category=o.REMOVE;s="table.GROUP_ITEM_DEL_CHANGE"}else if(t.getChangeType()==="moveGroup"){c.descriptionPayload.category=o.MOVE;s="table.GROUP_ITEM_MOVE_CHANGE";g.push(t.getRevertData().index);g.push(i.index)}if(a){const e=a.getPropertyHelper()?.getProperty(i.key);if(e){g.splice(0,1,e.label)}}return e.getMdcResourceText(s,g).then(e=>{c.descriptionPayload.description=e;c.updateRequired=true;return c})};const d={};d.addGroup=e.createChangeHandler({apply:a,revert:s,getCondenserInfo:function(e,t){const o=r(e.getContent());return{affectedControl:{id:o.key},affectedControlIdProperty:"name",targetContainer:e.getSelector(),targetAggregation:"groupLevels",customAggregation:t.modifier.bySelector(e.getSelector(),t.appComponent).getGroupConditions().groupLevels,classification:n.Create,setTargetIndex:function(e,t){e.getContent().index=t},getTargetIndex:function(e){return e.getContent().index}}},getChangeVisualizationInfo:c});d.removeGroup=e.createChangeHandler({apply:s,revert:a,getCondenserInfo:function(e,t){const o=r(e.getContent());return{affectedControl:{id:o.key},affectedControlIdProperty:"name",targetContainer:e.getSelector(),targetAggregation:"groupLevels",customAggregation:t.modifier.bySelector(e.getSelector(),t.appComponent).getGroupConditions().groupLevels,classification:n.Destroy,sourceIndex:e.getRevertData().index,setIndexInRevertData:function(e,t){const n=e.getRevertData();n.index=t;e.setRevertData(n)}}},getChangeVisualizationInfo:c});d.moveGroup=e.createChangeHandler({apply:g,revert:g,getCondenserInfo:function(e,t){const o=r(e.getContent());return{affectedControl:{id:o.key},affectedControlIdProperty:"name",targetContainer:e.getSelector(),targetAggregation:"groupLevels",classification:n.Move,sourceIndex:e.getRevertData().index,customAggregation:t.modifier.bySelector(e.getSelector(),t.appComponent).getGroupConditions().groupLevels,sourceContainer:e.getSelector(),sourceAggregation:"groupLevels",setTargetIndex:function(e,t){e.getContent().index=t},getTargetIndex:function(e){return e.getContent().index},setIndexInRevertData:function(e,t){const n=e.getRevertData();n.index=t;e.setRevertData(n)}}},getChangeVisualizationInfo:c});return d});
//# sourceMappingURL=GroupFlex.js.map