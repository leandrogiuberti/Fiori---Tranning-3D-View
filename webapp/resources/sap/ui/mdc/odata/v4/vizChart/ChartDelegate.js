/*!
 * OpenUI5
 * (c) Copyright 2025 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["sap/ui/core/Element","sap/ui/core/Lib","sap/ui/mdc/odata/v4/ChartDelegate","sap/m/Text","sap/base/Log","sap/ui/mdc/odata/v4/util/DelegateUtil","sap/ui/mdc/chart/Item","sap/ui/model/Sorter","sap/ui/mdc/chart/ChartImplementationContainer","sap/ui/base/ManagedObjectObserver","sap/ui/mdc/p13n/panels/ChartItemPanel","sap/m/p13n/MessageStrip","sap/ui/mdc/FilterBarDelegate","sap/ui/mdc/chart/PropertyHelper","sap/ui/thirdparty/jquery","sap/ui/mdc/enums/ChartItemRoleType","sap/base/util/merge","sap/m/IllustratedMessage","sap/m/library","sap/m/Button","sap/ui/mdc/chart/Util"],(t,e,a,r,n,i,s,o,l,u,c,g,h,d,jQuery,p,_,f,y,m,C)=>{"use strict";const{IllustratedMessageType:b}=y;const I=Object.assign({},a);I._oMDCRb=e.getResourceBundleFor("sap.ui.mdc");const D=new window.WeakMap;let S;let P;let M;let T;let w;I._getState=function(t){if(D.has(t)){return D.get(t)}if(t){n.info("Couldn't get state for "+t.getId())}};I._setState=function(t,e){D.set(t,e)};I._deleteState=function(t){if(this._getState(t)){if(this._getState(t).vizTooltip){this._getState(t).vizTooltip.destroy()}if(this._getState(t).observer){this._getState(t).observer.disconnect();this._getState(t).observer=null}}return D.delete(t)};I._getChart=function(t){if(D.has(t)){return D.get(t).innerChart}if(t){n.info("Couldn't get state for "+t.getId())}return undefined};I._setChart=function(t,e){if(D.has(t)){D.get(t).innerChart=e}else{D.set(t,{innerChart:e})}};I._getInnerStructure=function(t){if(D.has(t)){return D.get(t).innerStructure}if(t){n.info("Couldn't get state for "+t.getId())}return undefined};I._setInnerStructure=function(t,e){if(D.has(t)){D.get(t).innerStructure=e}else{D.set(t,{innerStructure:e})}};I.getFilterDelegate=function(){return h};I.addCondition=function(t,e,a){return Promise.resolve()};I.removeCondition=function(t,e,a){return Promise.resolve()};I._getBindingInfoFromState=function(t){if(D.has(t)){const e=D.get(t).bindingInfo;if(e){delete e.events}return e}if(t){n.info("Couldn't get state for "+t.getId())}return undefined};I._setBindingInfoForState=function(t,e){if(D.has(t)){D.get(t).bindingInfo=e}else{D.set(t,{bindingInfo:e})}};I._setUpChartObserver=function(t){const e=this._getState(t);if(!e.observer){e.observer=new u(t=>{if(t.type==="destroy"){this.exit(t.object)}})}e.observer.observe(t,{destroy:true})};I.exit=function(t){if(this._getInnerStructure(t)){this._getInnerStructure(t).destroy()}if(this._oNoDataContent){this._oNoDataContent=null}if(this._oIllustratedMessage){this._oIllustratedMessage=null}this._deleteState(t)};I.zoomIn=function(t){const e=this._getChart(t);if(e){e.zoom({direction:"in"})}};I.zoomOut=function(t){const e=this._getChart(t);if(e){e.zoom({direction:"out"})}};I.getZoomState=function(t){if(this._getChart(t)){const e=this._getChart(t).getZoomInfo();if(e&&e.hasOwnProperty("currentZoomLevel")&&e.currentZoomLevel!=null&&e.enabled){return{enabled:e.enabled,enabledZoomIn:e.currentZoomLevel<1,enabledZoomOut:e.currentZoomLevel>0}}}return{enabled:false}};I.getInnerChartSelectionHandler=function(t){return{eventId:"_selectionDetails",listener:this._getChart(t)}};I.getChartTypeLayoutConfig=function(){if(this._aChartTypeLayout){return this._aChartTypeLayout}const t=[p.axis1,p.category,p.series];const e=[p.axis1,p.axis2,p.category,p.series];const a=[p.axis1,p.category,p.category2];const r=[p.axis1,p.axis2,p.axis3,p.category,p.series];this._aChartTypeLayout=[{key:"column",allowedLayoutOptions:t},{key:"bar",allowedLayoutOptions:t},{key:"line",allowedLayoutOptions:t},{key:"combination",allowedLayoutOptions:t},{key:"pie",allowedLayoutOptions:t},{key:"donut",allowedLayoutOptions:t},{key:"dual_column",allowedLayoutOptions:e},{key:"dual_bar",allowedLayoutOptions:e},{key:"dual_line",allowedLayoutOptions:e},{key:"stacked_bar",allowedLayoutOptions:t},{key:"scatter",allowedLayoutOptions:e},{key:"bubble",allowedLayoutOptions:r},{key:"heatmap",allowedLayoutOptions:a},{key:"bullet",allowedLayoutOptions:t},{key:"vertical_bullet",allowedLayoutOptions:t},{key:"dual_stacked_bar",allowedLayoutOptions:e},{key:"100_stacked_bar",allowedLayoutOptions:t},{key:"stacked_column",allowedLayoutOptions:t},{key:"dual_stacked_column",allowedLayoutOptions:e},{key:"100_stacked_column",allowedLayoutOptions:t},{key:"dual_combination",allowedLayoutOptions:e},{key:"dual_horizontal_combination",allowedLayoutOptions:e},{key:"dual_horizontal_combination",allowedLayoutOptions:e},{key:"dual_stacked_combination",allowedLayoutOptions:e},{key:"dual_horizontal_stacked_combination",allowedLayoutOptions:e},{key:"stacked_combination",allowedLayoutOptions:t},{key:"100_dual_stacked_bar",allowedLayoutOptions:t},{key:"100_dual_stacked_column",allowedLayoutOptions:t},{key:"horizontal_stacked_combination",allowedLayoutOptions:t},{key:"waterfall",allowedLayoutOptions:a},{key:"horizontal_waterfall",allowedLayoutOptions:a}];return this._aChartTypeLayout};I.getAdaptionUI=function(t){return Promise.resolve(this._setupAdaptionUI(t))};I._setupAdaptionUI=function(t){let e=this.getChartTypeLayoutConfig().find(e=>e.key===t.getChartType());const a={chartType:t.getChartType(),invalidChartType:this._bInvalidChartType,errorMessage:this._sErrorMsg};if(!e){const a=[p.axis1,p.axis2,p.axis3,p.category,p.category2,p.series];e={key:t.getChartType(),allowedLayoutOptions:a}}const r=[{kind:"Groupable"},{kind:"Aggregatable"}];e.templateConfig=r;const n={panelConfig:e,errorConfig:a};const i=new c(n);if(t.getChartType()==="heatmap"){i.setMessageStrip(new g({text:this._oMDCRb.getText("chart.PERSONALIZATION_DIALOG_MEASURE_WARNING"),type:"Warning"}))}return i};I.setLegendVisible=function(t,e){if(this._getChart(t)){this._getChart(t).setVizProperties({legend:{visible:e},sizeLegend:{visible:e}})}else{n.error("Could not set legend visibility since inner chart is not yet initialized!")}};I._getSorterForItem=function(t,e){if(t.getType()==="aggregatable"){return new o(this._getAggregatedMeasureNameForMDCItem(t),e.descending)}else if(t.getType()==="groupable"){return new o(this.getInternalChartNameFromPropertyNameAndKind(e.key,"groupable",t.getParent()),e.descending)}};I.insertItemToInnerChart=function(t,e,a){if(e.getType()==="groupable"){const r=this.getInternalChartNameFromPropertyNameAndKind(e.getPropertyKey(),"groupable",t);const n=this._getChart(t).getDimensionByName(r);if(!n){this.createInnerDimension(t,e)}else{n.setLabel(e.getLabel());n.setRole(e.getRole()?e.getRole():"category")}const i=t._bDrillDown;if(i&&n){this._getChart(t).drillDown(n);t._bDrillDown=false}else if(!i){const e=this._getChart(t).getVisibleDimensions();e.splice(a,0,r);this._getChart(t).setVisibleDimensions(e)}}else if(e.getType()==="aggregatable"){this.createInnerMeasure(t,e);const r=this._getChart(t).getVisibleMeasures();r.splice(a,0,this._getAggregatedMeasureNameForMDCItem(e));this._getChart(t).setVisibleMeasures(r)}this._prepareColoringForItem(t,e).then(()=>{this._updateColoring(t,this._getChart(t).getVisibleDimensions(),this._getChart(t).getVisibleMeasures())});this._updateSemanticalPattern(t)};I.removeItemFromInnerChart=function(t,e){if(e.getType()==="groupable"&&this._getChart(t).getVisibleDimensions().includes(this.getInternalChartNameFromPropertyNameAndKind(e.getPropertyKey(),"groupable",t))){if(this._getState(t).inResultDimensions.length>0){this._getChart(t).setInResultDimensions(this._getState(t).inResultDimensions)}if(t._iDrillUpIndex){this._getChart(t).drillUp(t._iDrillUpIndex);t._iDrillUpIndex=0}else{let e=t.getItems().filter(t=>t.getType()==="groupable");e=e.map(function(e){return this.getInternalChartNameFromPropertyNameAndKind(e.getPropertyKey(),"groupable",t)}.bind(this));this._getChart(t).setVisibleDimensions(e)}}else if(e.getType()==="aggregatable"&&this._getChart(t).getVisibleMeasures().includes(this._getAggregatedMeasureNameForMDCItem(e))){const a=[];t.getItems().filter(t=>t.getType()==="aggregatable").filter(t=>t!==e).forEach(t=>{a.push(this._getAggregatedMeasureNameForMDCItem(t))});this._getChart(t).setVisibleMeasures(a);this._getChart(t).removeMeasure(this._getChart(t).getMeasureByName(this._getAggregatedMeasureNameForMDCItem(e)))}this._updateColoring(t,this._getChart(t).getVisibleDimensions(),this._getChart(t).getVisibleMeasures());this._updateSemanticalPattern(t)};I.addItem=function(t,e,a,r){if(t.getModel){return Promise.resolve(this._createMDCChartItem(e,t,r))}};I.removeItem=function(t,e){return Promise.resolve(true)};I._createMDCChartItem=function(t,e,a){return this._getPropertyInfosByName(t,e).then(t=>{if(!t){return null}return this._createMDCItemFromProperty(t,e.getId(),a)})};I._createMDCItemFromProperty=function(t,e,a){if(t.groupable){return new s(e+"--GroupableItem--"+t.key,{propertyKey:t.key,label:t.label,type:"groupable",role:a?a:"category"})}if(t.aggregatable){return new s(e+"--AggregatableItem--"+t.key,{propertyKey:t.key,label:t.label,type:"aggregatable",role:a?a:"axis1"})}return null};I.initializeInnerChart=function(t){return new Promise((e,a)=>{this._loadChart().then(a=>{if(!t.isDestroyed()){let a;this._setInnerStructure(t,new l(t.getId()+"--implementationContainer",{}));t.addStyleClass("sapUiMDCChartTempTextOuter");if(t.getNoData()){this._getInnerStructure(t).setChartNoDataContent(t.getNoData())}else{a=new r({text:t.getNoDataText()});this._getInnerStructure(t).addStyleClass("sapUiMDCChartTempText");this._getInnerStructure(t).setNoDataContent(a)}this._setUpChartObserver(t);e(this._getInnerStructure(t))}})})};I.changedNoDataStruct=function(t,e){const a=this._getInnerStructure(t);if(a){a.setChartNoDataContent(e);a.invalidate()}};I._createContentFromItems=function(t){return new Promise((e,a)=>{const r=[];const i=[];const s=[];const o=[];t.getItems().forEach((e,a)=>{i.push(this._getPropertyInfosByName(e.getPropertyKey(),t).then(a=>{if(!a){n.error("sap.ui.mdc.Chart: Item "+e.getPropertyKey()+" has no property info representing it in the metadata. Make sure the name is correct and the metadata is defined correctly. Skipping the item!");return}switch(e.getType()){case"groupable":s.push(this.getInternalChartNameFromPropertyNameAndKind(e.getPropertyKey(),"groupable",t));this._addInnerDimension(t,e,a);break;case"aggregatable":o.push(this._getAggregatedMeasureNameForMDCItem(e));this._addInnerMeasure(t,e,a);break;default:n.error("MDC Chart Item "+e.getId()+" with label "+e.getLabel()+' has no known type. Supported typed are: "groupable" & "aggregatable"')}r.push(this._prepareColoringForItem(t,e))}))});Promise.all(i).then(()=>{this._getState(t).aColMeasures.forEach(e=>{if(this._getState(t).aInSettings.indexOf(e)==-1){r.push(new Promise((a,r)=>{t._getPropertyByNameAsync(e).then(function(r){const n=this.getPropertyAttribute(t,r,"aggregationMethod");const i=this.getPropertyAttribute(t,r,"path");const s=this.getInternalChartNameFromPropertyNameAndKind(e,"aggregatable",t);const l={name:s,label:r.label,role:r.role||"axis1"};if(n&&i){l.analyticalInfo={propertyPath:i,with:n}}const u=this.getPropertyAttribute(t,r,"unitPath");if(u){l.unitBinding=u}const c=new T(l);o.push(c);this._getChart(t).addMeasure(c);a()})}))}});Promise.all(r).then(()=>{this._getChart(t).setVisibleDimensions(s);this._getChart(t).setVisibleMeasures(o);const a=t.getDelegate().inResultDimensions;if(a&&a instanceof Array&&a.length!=0){const e=[];a.forEach(a=>{e.push(this._getPropertyInfosByName(a,t).then(e=>{const a=I.innerDimensionFactory(t,undefined,e);this._getChart(t).addDimension(a);const r=this.getInternalChartNameFromPropertyNameAndKind(e.key,"groupable",t);this._getState(t).inResultDimensions.push(r)}))});Promise.all(e).then(()=>{this._getChart(t).setInResultDimensions(this._getState(t).inResultDimensions)})}this._updateColoring(t,s,o);this._updateSemanticalPattern(t);e()})})})};I.getInnerChart=function(t){return this._getChart(t)};I._prepareColoringForItem=function(t,e){return this._addCriticality(t,e).then(()=>{this._getState(e.getParent()).aInSettings.push(e.getPropertyKey());if(e.getType()==="aggregatable"){this._getPropertyInfosByName(e.getPropertyKey(),e.getParent()).then(a=>{this._getAdditionalColoringMeasuresForItem(t,a).forEach(t=>{const a=this._getState(e.getParent());if(a.aColMeasures?.indexOf(t)==-1){a.aColMeasures.push(t)}})})}})};I._getAdditionalColoringMeasuresForItem=function(t,e){let a=[];const r=this.getPropertyAttribute(t,e,"datapoint");const n=r?.criticality||null;if(n?.DynamicThresholds){a=n.DynamicThresholds.usedMeasures}return a};I._addCriticality=function(t,e){return this._getPropertyInfosByName(e.getPropertyKey(),e.getParent()).then(a=>{const r=this.getPropertyAttribute(t,a,"datapoint");const n=this.getPropertyAttribute(t,a,"criticality");if(n||r?.criticality){const r=this._getState(e.getParent()).oColorings||{Criticality:{DimensionValues:{},MeasureValues:{}}};const i={};if(e.getType()=="groupable"){const t=n||[];for(const e in t){i[e]={Values:t[e]}}const a=this.getInternalChartNameFromPropertyNameAndKind(e.getPropertyKey(),"groupable",e.getParent());r.Criticality.DimensionValues[a]=i}else{const n=this.getPropertyAttribute(t,a,"datapoint");const s=n?.criticality||[];for(const t in s){i[t]=s[t]}const o=this.getInternalChartNameFromPropertyNameAndKind(e.getPropertyKey(),"aggregatable",e.getParent());r.Criticality.MeasureValues[o]=i}const s=this._getState(e.getParent());s.oColorings=r;this._setState(e.getParent(),s)}})};I._updateColoring=function(t,e,a){const r=this._getChart(t);const n=this._getState(t);const i=jQuery.extend(true,{},n.oColorings);if(i&&i.Criticality){let t;for(let a=0;a<e.length;a++){const r=e[a];if(n.oColorings.Criticality.DimensionValues[r]){t={coloring:"Criticality",parameters:{dimension:r}};delete i.Criticality.MeasureValues;break}}if(!t){delete i.Criticality.DimensionValues;for(const t in i.Criticality.MeasureValues){if(a.indexOf(t)==-1){delete i.Criticality.MeasureValues[t]}}t={coloring:"Criticality",parameters:{measure:a}}}if(t){r.setColorings(i);r.setActiveColoring(t)}}};I._updateSemanticalPattern=function(t){const e=this._getChart(t).getVisibleMeasures();e.forEach(e=>{const a=this.getPropertyFromNameAndKind(e,"aggregatable",t);if(!a){return}const r=this.getPropertyAttribute(t,a,"datapoint");if(r){if(r.targetValue||r.foreCastValue){const a=this._getChart(t).getMeasureByName(e);a.setSemantics("actual");if(r.targetValue!=null){const e=this._getChart(t).getMeasureByName(r.targetValue);if(e){e.setSemantics("reference")}else{n.error("sap.ui.mdc.Chart: "+r.targetValue+" is not a valid measure")}}if(r.foreCastValue){const e=this._getChart(t).getMeasureByName(r.foreCastValue);if(e){e.setSemantics("projected")}else{n.error("sap.ui.comp.SmartChart: "+r.ForecastValue.Path+" is not a valid measure")}}a.setSemanticallyRelatedMeasures({referenceValueMeasure:r.targetValue,projectedValueMeasure:r.foreCastValue})}}})};I.mMatchingIcon={bar:"sap-icon://horizontal-bar-chart",bullet:"sap-icon://horizontal-bullet-chart",bubble:"sap-icon://bubble-chart",column:"sap-icon://vertical-bar-chart",combination:"sap-icon://business-objects-experience",dual_bar:"sap-icon://horizontal-bar-chart",dual_column:"sap-icon://vertical-bar-chart",dual_combination:"sap-icon://business-objects-experience",dual_horizontal_combination:"sap-icon://business-objects-experience",dual_horizontal_stacked_combination:"sap-icon://business-objects-experience",dual_line:"sap-icon://line-chart",dual_stacked_bar:"sap-icon://full-stacked-chart",dual_stacked_column:"sap-icon://vertical-stacked-chart",dual_stacked_combination:"sap-icon://business-objects-experience",donut:"sap-icon://donut-chart",heatmap:"sap-icon://heatmap-chart",horizontal_stacked_combination:"sap-icon://business-objects-experience",line:"sap-icon://line-chart",pie:"sap-icon://pie-chart",scatter:"sap-icon://scatter-chart",stacked_bar:"sap-icon://full-stacked-chart",stacked_column:"sap-icon://vertical-stacked-chart",stacked_combination:"sap-icon://business-objects-experience",treemap:"sap-icon://Chart-Tree-Map",vertical_bullet:"sap-icon://vertical-bullet-chart","100_dual_stacked_bar":"sap-icon://full-stacked-chart","100_dual_stacked_column":"sap-icon://vertical-stacked-chart","100_stacked_bar":"sap-icon://full-stacked-chart","100_stacked_column":"sap-icon://full-stacked-column-chart",waterfall:"sap-icon://vertical-waterfall-chart",horizontal_waterfall:"sap-icon://horizontal-waterfall-chart"};I.getChartTypeInfo=function(t){const a=t.getChartType(),r=e.getResourceBundleFor("sap.ui.mdc"),n=e.getResourceBundleFor("sap.chart");const i={icon:I.mMatchingIcon[a],text:r.getText("chart.CHART_TYPE_TOOLTIP",[n.getText("info/"+a)])};return i};I.getAvailableChartTypes=function(t){const a=[];if(this._getChart(t)){const r=this._getChart(t).getAvailableChartTypes().available;const n=e.getResourceBundleFor("sap.chart");for(let t=0;t<r.length;t++){const e=r[t].chart;a.push({key:e,icon:I.mMatchingIcon[e],text:n.getText("info/"+e)})}}return a};I.getDrillStack=function(t){const e=Object.assign([],this._getChart(t).getDrillStack());e.forEach(e=>{e.dimension=e.dimension.map(e=>{const a=this.getPropertyFromNameAndKind(e,"groupable",t);if(a){return a.key}else{n.error("MDC Chart Delegate: Couldn't map chart dimension to groupable property: "+e);return e}})});return e};I.getSortedDimensions=function(t){return new Promise((e,a)=>{if(t.isPropertyHelperFinal()){e(this._sortPropertyDimensions(t.getPropertyHelper().getProperties()))}else{t.finalizePropertyHelper().then(()=>{e(this._sortPropertyDimensions(t.getPropertyHelper().getProperties()))})}})};I._sortPropertyDimensions=function(t){const e=t.filter(t=>t.groupable);if(e){e.sort((t,e)=>{if(t.label&&e.label){return t.label.localeCompare(e.label)}})}return e};I.getDrillableItems=function(t){const e=t.getItems().filter(t=>t.getType()==="groupable");return e};I.setChartType=function(t,e){this._getChart(t).setChartType(e);this._getInnerStructure(t)?.setShowNoDataStruct?.(false)};I.createInnerChartContent=function(t,e){return new Promise((a,r)=>{this._setChart(t,new S({id:t.getId()+"--innerChart",chartType:"column",height:"100%",width:"100%",isAnalytical:true,vizProperties:{plotArea:{scrollbar:{forceToShowInMobile:true}}}}));const i=this._getChart(t);i.addDelegate({onAfterRendering:this._toggleIllustratedMessage.bind(this,t)});i.setCustomMessages({NO_DATA:t.getNoDataText()});this._getState(t).inResultDimensions=[];this._getInnerStructure(t).removeStyleClass("sapUiMDCChartTempText");t.removeStyleClass("sapUiMDCChartTempTextOuter");t.addStyleClass("sapUiMDCChartGrid");const s=this._getState(t);s.aColMeasures=[];s.aInSettings=[];this._setState(t,s);this._createContentFromItems(t).then(()=>{i.attachRenderComplete(()=>{if(this._getState(t).toolbarUpdateRequested){t._updateToolbar();this._getState(t).toolbarUpdateRequested=false}});this._getInnerStructure(t).setContent(i);this._getInnerStructure(t).setShowNoDataStruct(false);s.dataLoadedCallback=e;this._setState(t,s);let r;if(this._getBindingInfo){r=this._getBindingInfo(t);n.warning("mdc ChartDelegate","calling the private delegate._getBindingInfo. Please make the function public!")}else{r=this.getBindingInfo(t)}this.updateBindingInfo(t,r);this._performInitialBind(t,r);a()})})};I._toggleIllustratedMessage=function(t){const e=this._getChart(t);this._bInvalidChartType=false;if(e&&!e.getBlocked()){const a=e.getChartType?.();const r=this._getInnerStructure(t);const n=e.getAvailableChartTypes().unavailable;const i=n.findIndex(t=>t.chart===a);if(!r){return}if(i!==-1){this._oNoDataContent=r.getNoDataContent();const e=this._getIllustratedMessage(t);r.setShowNoDataStruct(true);const s=n[i].error;this._sErrorMsg=C.getErrorMessageForMissingMeasuresAndDimensions(a,s);e.setDescription(this._sErrorMsg);this._bInvalidChartType=true;r.setNoDataContent(e)}else{if(this._oNoDataContent&&this._oNoDataContent!==r.getNoDataContent()){r.setNoDataContent(this._oNoDataContent)}r.setShowNoDataStruct(false)}}};I._performInitialBind=function(t,e){if(t&&e&&this._getChart(t)){this._addBindingListener(e,"dataReceived",this._onDataLoadComplete.bind(t));this._getChart(t).bindData(e);this._setBindingInfoForState(t,e);const a=this._getState(t);a.innerChartBound=true;this._checkForMeasureWarning(t)}};I.requestToolbarUpdate=function(t){if(t.getItems().length===0){t._updateToolbar();return}this._getState(t).toolbarUpdateRequested=true};I.createInnerDimension=function(t,e){this._getPropertyInfosByName(e.getPropertyKey(),t).then(a=>{this._addInnerDimension(t,e,a)})};I.createInnerMeasure=function(t,e){this._getPropertyInfosByName(e.getPropertyKey(),t).then(a=>{this._addInnerMeasure(t,e,a)})};I._addInnerDimension=function(t,e,a){const r=this.innerDimensionFactory(t,e,a);this._getChart(t).addDimension(r);if(t._bDrillDown){this._getChart(t).drillDown(r);t._bDrillDown=false}};I.innerDimensionFactory=function(t,e,a){let r;const n=this.getInternalChartNameFromPropertyNameAndKind(e?.getPropertyKey()||a.key,"groupable",t);let i={name:n,role:e?.getRole()||a.role,label:e?.getLabel()||a.label,textFormatter:this.formatText.bind(a)};const s=this.getPropertyAttribute(t,a,"timeUnitType");if(s){i=_(i,{timeUnit:s});r=new M(i)}else{r=new P(i)}const o=this.getPropertyAttribute(t,a,"textProperty");if(o){r.setTextProperty(o);r.setDisplayText(true)}return r};I._addInnerMeasure=function(t,e,a){const r=this.innerMeasureFactory(t,e,a);this._getChart(t).addMeasure(r)};I.fetchConfigurationForVizchart=function(t,e,a){return null};I.getPropertyAttribute=function(t,e,a){let r=e.hasOwnProperty(a)?e[a]:null;if(!r){r=this.fetchConfigurationForVizchart(t,e.key,a)}return r};I.innerMeasureFactory=function(t,e,a){const r=this.getPropertyAttribute(t,a,"aggregationMethod");const n=this.getPropertyAttribute(t,a,"path");const i={name:this._getAggregatedMeasureNameForMDCItem(e),label:e?.getLabel()||a.label,role:e?.getRole()||a.role||"axis1"};if(r&&n){i.analyticalInfo={propertyPath:n,with:r}}const s=this.getPropertyAttribute(t,a,"unitPath");if(s){i.unitBinding=s}return new T(i)};I.rebind=function(t,e){if(t&&e&&this._getChart(t)){this._addBindingListener(e,"dataReceived",this._onDataLoadComplete.bind(t));this._getInnerStructure(t).setShowNoDataStruct(false);if(e.binding){e.binding.bHasAnalyticalInfo=true}this._getChart(t).bindData(e);this._setBindingInfoForState(t,e);const a=this._getState(t);a.innerChartBound=true}};I._checkForMeasureWarning=function(t){if(!t.getNoData()){return}const e=t.getItems().filter(t=>t.getType()==="aggregatable");if(e.length===0){this._getInnerStructure(t).setShowNoDataStruct(true);t.setBusy(false)}else{this._getInnerStructure(t).setShowNoDataStruct(false)}};I.getBindingInfo=function(t){if(this._getBindingInfoFromState(t)){return this._getBindingInfoFromState(t)}const e=t.getDelegate().payload;const a="/"+e.collectionName;const r={path:a};return r};I.getInnerChartBound=function(t){const e=this._getState(t);return!!e?.innerChartBound};I.updateBindingInfo=function(t,e){N(t,e);e.filters=this.getFilters(t);e.sorter=this.getSorters(t)};function N(e,a){const r=t.getElementById(e.getFilter());if(!r){return}const n=r.getConditions();const s=r.getSearch instanceof Function?r.getSearch():"";if(n){const t=i.getParametersInfo(r,n);if(t){a.path=t}}if(!a.parameters){a.parameters={}}a.parameters["$search"]=s||undefined}I.getSorters=function(t){let e;const a=t.getSortConditions()?t.getSortConditions().sorters:[];a.forEach(a=>{const r=t.getItems().find(t=>t.getPropertyKey()===a.key);if(!r){return}const n=this._getSorterForItem(r,a);if(e){e.push(n)}else{e=[n]}});return e};I._getAggregatedMeasureNameForMDCItem=function(t){return this.getInternalChartNameFromPropertyNameAndKind(t.getPropertyKey(),"aggregatable",t.getParent())};I.getInternalChartNameFromPropertyNameAndKind=function(t,e,a){return t};I.getPropertyFromNameAndKind=function(t,e,a){return a.getPropertyHelper().getProperty(t)};I.setChartTooltipVisibility=function(t,e){if(this._getChart(t)){if(e){if(!this._getState(t).vizTooltip){const e=this._getState(t);e.vizTooltip=new w;this._setState(t,e)}this._getState(t).vizTooltip.connect(this._getChart(t).getVizUid())}else if(this._getState(t).vizTooltip){this._getState(t).vizTooltip.destroy()}}else{n.error("Trying to set chart tooltip while inner chart was not yet initialized")}};I._loadChart=function(){return new Promise(t=>{const a=["sap/chart/Chart","sap/chart/data/Dimension","sap/chart/data/TimeDimension","sap/chart/data/Measure","sap/viz/ui5/controls/VizTooltip"];function r(e,a,r,n,i){S=e;P=a;M=r;T=n;w=i;t()}e.load({name:"sap.viz"}).then(()=>{sap.ui.require(a,r)})})};I.getPropertyHelperClass=function(){return d};I.formatText=function(t,e){return t};I.setNoDataText=function(t,e){this._getChart(t).setCustomMessages({NO_DATA:e})};I.showOverlay=function(t,e){if(this._getInnerStructure(t)){this._getInnerStructure(t).showOverlay(e)}};I._getPropertyInfosByName=function(t,e){return e._getPropertyByNameAsync(t)};I._getModel=function(t){const e=t.getDelegate().payload;return t.getModel(e.model)};I._addBindingListener=function(t,e,a){if(!t.events){t.events={}}if(!t.events[e]){t.events[e]=a}else{const r=t.events[e];t.events[e]=function(){a.apply(this,arguments);r.apply(this,arguments)}}};I._getIllustratedMessage=function(t){if(this._oIllustratedMessage){return this._oIllustratedMessage}else{const e=this._oMDCRb.getText("chart.INVALID_CHART_TYPE_ERROR_MESSAGE_TITLE");const a=this._oMDCRb.getText("chart.INVALID_CHART_TYPE_DEFAULT_ERROR_MESSAGE_DESCRIPTION");this._oIllustratedMessage=new f({enableVerticalResponsiveness:true,illustrationType:b.NoChartData,title:e,description:a,additionalContent:[new m({text:this._oMDCRb.getText("chart.CHANGE_SETTINGS"),press:function(e){t._oSettingsBtn?.firePress?.()}}),new m({text:this._oMDCRb.getText("chart.SELECT_ANOTHER_CHART_TYPE"),press:function(e){t._oChartTypeBtn?.firePress?.()}}).addStyleClass("sapUiTinyMarginBegin")]});return this._oIllustratedMessage}};I._onDataLoadComplete=function(t){const e=this.getControlDelegate()._getInnerStructure(this);if(this.getNoData()){if(t.getSource()&&t.getSource().getCurrentContexts().length===0){e.setShowNoDataStruct(true)}else{e.setShowNoDataStruct(false)}}this._innerChartDataLoadComplete(t);const a=this.getControlDelegate()._getChart(this);this._announceUpdate(this.getChartType(),this.getHeader(),a.getVisibleDimensions().length,a.getVisibleMeasures().length)};return I});
//# sourceMappingURL=ChartDelegate.js.map