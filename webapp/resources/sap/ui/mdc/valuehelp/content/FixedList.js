/*!
 * OpenUI5
 * (c) Copyright 2025 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["sap/ui/core/Lib","sap/ui/mdc/valuehelp/base/ListContent","sap/ui/mdc/util/loadModules","sap/ui/mdc/enums/ConditionValidated","sap/ui/mdc/enums/OperatorName","sap/ui/mdc/enums/ValueHelpSelectionType","sap/ui/model/ParseException","sap/base/util/deepEqual"],(t,e,i,s,n,o,a,l)=>{"use strict";let r;const c=e.extend("sap.ui.mdc.valuehelp.content.FixedList",{metadata:{library:"sap.ui.mdc",interfaces:["sap.ui.mdc.valuehelp.base.ITypeaheadContent","sap.ui.mdc.valuehelp.base.IDialogContent"],properties:{groupable:{type:"boolean",group:"Appearance",defaultValue:false},filterList:{type:"boolean",group:"Appearance",defaultValue:true},emptyText:{type:"string",group:"Data",defaultValue:""},restrictedToFixedValues:{type:"boolean",group:"Data",defaultValue:false}},aggregations:{items:{type:"sap.ui.mdc.valuehelp.content.FixedListItem",multiple:true,singularName:"item"},_emptyItem:{type:"sap.ui.mdc.valuehelp.content.FixedListItem",multiple:false,visibility:"hidden"}},defaultAggregation:"items",events:{}}});c.prototype.init=function(){e.prototype.init.apply(this,arguments);this._oResourceBundle=t.getResourceBundleFor("sap.ui.mdc");this._iNavigateIndex=-1;this._oObserver.observe(this,{properties:["emptyText"]})};c.prototype.exit=function(){if(this._oManagedObjectModel){this._oManagedObjectModel.destroy();delete this._oManagedObjectModel}e.prototype.exit.apply(this,arguments)};c.prototype.getContent=function(){return this._retrievePromise("content",()=>i(["sap/m/List","sap/m/DisplayListItem","sap/m/library","sap/ui/model/Filter","sap/ui/model/Sorter","sap/ui/model/base/ManagedObjectModel","sap/base/strings/whitespaceReplacer","sap/ui/mdc/valuehelp/content/FixedListItem"]).then(t=>{if(this.isDestroyStarted()){return null}const[e,i,s,n,o,a,l,c]=t;r=c;this._oManagedObjectModel=new a(this);this._oManagedObjectModel._getObject=function(t,e,i){const s=this.getRootObject();const n=s.getConfig();const o=n.emptyAllowed;if(o&&s.getEmptyText()){if(e?.isA("sap.ui.model.Context")){t=this.resolve(t,e)}if(t?.startsWith("/items")){const e=t.split("/");const n=s.getAggregation("_emptyItem");const o=s.getItems();let a=o;a.unshift(n);i?.push({path:"/",node:this._oObject});i?.push({path:"items",node:a});if(e.length>2){const t=Number(e[2]);a=o[t];i?.push({path:e[2],node:a});if(e.length>3){const t=a.getMetadata().getManagedProperty(e[3]);if(t){a=t.get(a);i?.push({path:e[3],node:a})}}}return a}}return a.prototype._getObject.apply(this,arguments)};F.call(this,this.getEmptyText());const u=new i(this.getId()+"-item",{type:s.ListType.Active,label:{path:"$help>text",formatter:l},value:{path:"$help>additionalText",formatter:l},valueTextDirection:"{$help>textDirection}"}).addStyleClass("sapMComboBoxNonInteractiveItem");const p=new n({path:"text",test:d.bind(this),caseSensitive:true});let g;if(this.getGroupable()){g=new o("groupKey",false,m.bind(this))}const f=new e(this.getId()+"-List",{width:"100%",showNoData:false,mode:s.ListMode.SingleSelectMaster,rememberSelections:false,items:{path:"$help>/items",template:u,filters:p,sorter:g,templateShareable:false},itemPress:h.bind(this)}).addStyleClass("sapMComboBoxBaseList").addStyleClass("sapMComboBoxList");f.applyAriaRole("listbox");f.setModel(this._oManagedObjectModel,"$help");this.setAggregation("displayContent",f,true);y.call(this);return f}))};c.prototype._handleFirstMatchSuggest=function(){const t=this.isTypeahead();const e=u.call(this)?.getItems();const i=this.getFilterValue();const s=this.getUseFirstMatch();if(t&&s&&e?.length&&i){const t=this.getValueHelpDelegate();const s=t.isFilteringCaseSensitive(this.getValueHelpInstance(),this);const n=t.getFirstMatch(this.getValueHelpInstance(),this,{value:this.getFilterValue(),checkDescription:!!this.getDescriptionPath(),control:this.getControl(),caseSensitive:s});if(n){const t=e.find(t=>t.getBindingContext("$help")===n);const o=I.call(this,t);const a=this.createCondition(x.call(this,o),b.call(this,o));const l=this.getListBinding()?.getCurrentContexts();const r=l?.length;this.fireTypeaheadSuggested({condition:a,filterValue:i,itemId:t?.getId(),items:r,caseSensitive:s})}}};function u(){return this.getAggregation("displayContent")}function h(t){const e=t.getParameter("listItem");const i=e.getSelected();if(i){const t=I.call(this,e);const i=x.call(this,t);const s=b.call(this,t);p.call(this,i,s);this.fireSelect({type:o.Set,conditions:this.getConditions()});this.fireConfirm()}}function p(t,e){const i=t===null?null:this.createCondition(t,e);const s=i?[i]:[];const n=this.getConditions();if(l(s,n)){y.call(this)}else{this.setProperty("conditions",s,true)}return i}function d(t){const e=this.getFilterList();return!e||g.call(this,t,this.getFilterValue())}function g(t,e){return!e||typeof e==="string"&&(this.getCaseSensitive()?t.startsWith(e):t.toLowerCase().startsWith(e.toLowerCase()))}function f(){const t=u.call(this);const e=this.getListBinding();if(this._iNavigateIndex>=0){this.setProperty("conditions",[],true);this._iNavigateIndex=-1;t.setFakeFocus()}if(t){e.update();t.updateItems();t.invalidate();this._handleFirstMatchSuggest();y.call(this)}}function m(t){const e=t.getProperty("groupKey");const i=t.getProperty("groupText");return{key:e,text:i}}function y(){const t=u.call(this);if(t){const e=this.getConditions();let i;let o=false;const a=this.getParent().isOpen();if(e.length>0&&(e[0].validated===s.Validated||e[0].operator===n.EQ)){i=e[0].values[0]}const l=t.getItems();l.forEach((s,n)=>{if(s.isA("sap.m.DisplayListItem")){const n=I.call(this,s);if(e.length>0&&x.call(this,n)===i||e.length===0&&x.call(this,n)===null){s.setSelected(true);if(a&&!s.hasStyleClass("sapMLIBFocused")){t.setFakeFocus(s)}}else if(e.length===0&&this._iNavigateIndex<0&&!o&&this._sHighlightId===s.getId()){s.setSelected(true);o=true}else{s.setSelected(false);if(a&&s.hasStyleClass("sapMLIBFocused")){t.setFakeFocus()}}}})}}function I(t){return this._oManagedObjectModel.getProperty(t.getBindingContextPath())}function v(t){return this._oManagedObjectModel.getProperty(t.getPath())}function x(t){const e=t.getBinding("key");if(e){return e.getInternalValue()}else if(t===this.getAggregation("_emptyItem")){return null}else{return t.getKey()}}function b(t){const e=t.getBinding("text");if(e&&!e.getFormatter()){return e.getInternalValue()}else{return t.getText()}}c.prototype.getItemForValue=function(t){return this.getContent().then(()=>{if((t.value==null||t.value===undefined)&&t.parsedValue!==null){return null}else if(t.parsedValue===null){let e=this.getEmptyText();if(e&&t.emptyAllowed){const t=this.getBinding("emptyText");if(t){e=t.getInternalValue()}return{key:null,description:e}}else{return null}}else if(!t.value&&t.checkDescription){return null}const e=this.getItems();let i;let s=0;let n;let o;for(s=0;s<e.length;s++){i=e[s];n=x.call(this,i);o=b.call(this,i);if(t.checkKey&&l(n,t.parsedValue)||t.checkDescription&&(l(o,t.parsedDescription)||i.getText()===t.value)){return{key:n,description:o}}}if(t.checkKey&&t.value===""){return null}if(this.getUseFirstMatch()&&!t.exactMatch){const e=this.getValueHelpDelegate().getFirstMatch(this.getValueHelpInstance(),this,t);if(e){return this.getItemFromContext(e)}}const r=this._oResourceBundle.getText("valuehelp.VALUE_NOT_EXIST",[t.value]);const c=t.exception||a;throw new c(r)})};c.prototype.getItemFromContext=function(t,e){const i=v.call(this,t);const s=x.call(this,i);const n=b.call(this,i);return{key:s,description:n}};c.prototype.isValidationSupported=function(t){return true};c.prototype.isSearchSupported=function(){return true};c.prototype.handleConditionsUpdate=function(t){if(this._iNavigateIndex>=0&&!this._bConditionSetByNavigate){const t=this.getConditions();const e=u.call(this);const i=e.getSelectedItem();const s=i&&I.call(this,i);if(t.length!==1||!x.call(this,s)===t[0].values[0]){this._iNavigateIndex=-1}}y.call(this)};c.prototype.handleFilterValueUpdate=function(t){f.call(this);e.prototype.handleFilterValueUpdate.apply(this,arguments)};c.prototype.removeVisualFocus=function(){const t=u.call(this);t?.removeStyleClass("sapMListFocus")};c.prototype.setVisualFocus=function(){const t=u.call(this);if(!t?.hasStyleClass("sapMListFocus")){t?.addStyleClass("sapMListFocus")}};c.prototype.navigate=function(t){const e=u.call(this);if(!e){return}const i=e.getItems();const s=i.length;const n=this._iNavigateIndex>=0?i[this._iNavigateIndex]:e.getSelectedItem();let o=0;const a=this.getFilterList();const l=this.getFilterValue();let r=false;const c=this.getParent().isOpen();if(!a&&!n){let e=0;if(t>=0){for(e=0;e<i.length;e++){if(!i[e].isA("sap.m.GroupHeaderListItem")&&g.call(this,i[e].getLabel(),l)){o=e;break}}}else{for(e=i.length-1;e>=0;e--){if(!i[e].isA("sap.m.GroupHeaderListItem")&&g.call(this,i[e].getLabel(),l)){o=e;break}}}}else if(n){o=e.indexOfItem(n);o=o+t}else if(t>=0){o=t-1}else{o=s+t}if(t===9999){o=s-1}if(t===-9999){o=0}let h;if(o<0){o=0;h=true;r=true}else if(o>=s-1){o=s-1;h=false}else{h=t>=0}const d=function(){while(i[o]&&i[o].isA("sap.m.GroupHeaderListItem")){if(h){o++}else{o--}}};if(!c||t===0){d();if(o<0||o>s-1){h=!h;r=o<0;o=o<0?0:s-1;d()}}const f=i[o];if(f){const t=this.getUseFirstMatch();if(f!==n||t&&!r||this._iNavigateIndex!==o&&!r){let t,i,s;this._iNavigateIndex=o;if(c){e.scrollToIndex(o);e.setFakeFocus(f)}if(f.isA("sap.m.GroupHeaderListItem")){this._bConditionSetByNavigate=true;this.setProperty("conditions",[],true);delete this._bConditionSetByNavigate;this.fireNavigated({condition:undefined,itemId:f.getId(),leaveFocus:false})}else{t=I.call(this,f);i=x.call(this,t);s=b.call(this,t);this._bConditionSetByNavigate=true;const e=p.call(this,i,s);delete this._bConditionSetByNavigate;const n=this.getValueHelpDelegate();const o=n.isFilteringCaseSensitive(this.getValueHelpInstance(),this);this.fireNavigated({condition:e,itemId:f.getId(),leaveFocus:false,caseSensitive:o})}if(c){this.setVisualFocus();this.fireVisualFocusSet()}}else if(r){this._iNavigateIndex=-1;this.fireNavigated({condition:undefined,itemId:undefined,leaveFocus:r})}}};c.prototype.onShow=function(t){return e.prototype.onShow.apply(this,arguments).then(()=>{const t=u.call(this);let e;if(!t){return null}const i=t.getSelectedItem();if(i){const s=t.indexOfItem(i);t.scrollToIndex(s);e=i.getId()}const s=this.getListBinding()?.getCurrentContexts();const n=s?.length;return{itemId:e,items:n}})};c.prototype.onHide=function(){this.removeVisualFocus();const t=u.call(this);t?.setFakeFocus();this._iNavigateIndex=-1};c.prototype.getValueHelpIcon=function(){if(this.getUseAsValueHelp()){return"sap-icon://slim-arrow-down"}else{return null}};c.prototype.getAriaAttributes=function(t){return{contentId:this.getId()+"-List",ariaHasPopup:"listbox",roleDescription:null,valueHelpEnabled:false,autocomplete:this.getUseFirstMatch()?"both":"none"}};c.prototype.shouldOpenOnClick=function(){return this.getRestrictedToFixedValues()||!this.getFilterList()};c.prototype.isFocusInHelp=function(){return false};c.prototype.isSingleSelect=function(t){return true};c.prototype.isNavigationEnabled=function(t){return this.getItems().length>0};c.prototype.onConnectionChange=function(){this._iNavigateIndex=-1};c.prototype.getListBinding=function(){const t=u.call(this);return t&&t.getBinding("items")};c.prototype.getKeyPath=function(){return"key"};c.prototype.getDescriptionPath=function(){return"text"};c.prototype.setHighlightId=function(t){if(this._sHighlightId!==t){this._sHighlightId=t;y.call(this)}};c.prototype.destroyItems=function(){const t=u.call(this);t?.destroyItems();return this.destroyAggregation("items")};c.prototype.observeChanges=function(t){if(t.name==="emptyText"){F.call(this,t.current);this._oManagedObjectModel?.checkUpdate(true,true);y.call(this)}else if(t.name==="config"&&t.current?.emptyAllowed!==t.old?.emptyAllowed){this._oManagedObjectModel?.checkUpdate(true,true);y.call(this)}e.prototype.observeChanges.apply(this,arguments)};c.prototype.isRestrictedToFixedValues=function(){return this.getRestrictedToFixedValues()};function F(t){if(t&&r&&this._oManagedObjectModel){if(!this.getAggregation("_emptyItem")){const t=new r(this.getId()+"-emptyItem",{key:null,text:{path:"$help>/emptyText"}});this.setAggregation("_emptyItem",t,true);t.setModel(this._oManagedObjectModel,"$help")}}else{this.destroyAggregation("_emptyItem",true)}}return c});
//# sourceMappingURL=FixedList.js.map