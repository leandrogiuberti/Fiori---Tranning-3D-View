/*!
 * OpenUI5
 * (c) Copyright 2025 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["sap/base/util/Deferred","sap/ui/mdc/util/loadModules","sap/base/future","sap/ui/mdc/util/PropertyHelperUtil"],(e,r,t,i)=>{"use strict";const o={};o.init=function(r){return function(){this._oPropertyHelper=null;this._oPropertyHelperDeferred=new e;this._oApplySettingsDeferred=new e;this._bPropertyHelperFinal=false;this._oPropertiesFinalizedDeferred=new e;this._bPropertyHelperInitializing=false;this._sPropertyInfoStore=null;if(r){r.apply(this,arguments)}}};o.applySettings=function(e){return function(){if(e){e.apply(this,arguments)}if(!this._bPropertyHelperInitializing&&this._sPropertyInfoStore&&(!arguments[0]||!arguments[0].hasOwnProperty(this._sPropertyInfoStore))){s.call(this,[],false)}this._oApplySettingsDeferred.resolve(this);return this}};o.initPropertyHelper=function(e,r,t){if(e){this._setPropertyHelperClass(e)}return s.call(this,r,t)};o.updatePropertyHelper=function(e,r){return s.call(this,e,r)};o.finalizePropertyHelper=function(){this._pHelperFinalizationPromise=this._pHelperFinalizationPromise||l(this).then(e=>s.call(this,e,true));return this._pHelperFinalizationPromise};o.propertiesFinalized=function(){return this._oPropertiesFinalizedDeferred.promise};o.isPropertyHelperFinal=function(){return this._bPropertyHelperFinal};o.awaitPropertyHelper=function(){if(this._oPropertyHelperDeferred){return this._oPropertyHelperDeferred.promise}else{return Promise.resolve()}};o.getPropertyHelper=function(){return this._oPropertyHelper};o.exit=function(e){return function(){this._oPropertyHelper=null;this._oPropertyHelperDeferred=null;this._oApplySettingsDeferred=null;this._bPropertyHelperFinal=null;this._bPropertyHelperInitializing=null;this._pHelperFinalizationPromise=null;this._oPropertyHelperClass=null;this._sPropertyInfoStore=null;if(this._oPropertyInfoStoreMutatorOverride){this[this._oPropertyInfoStoreMutatorOverride.key]=this._oPropertyInfoStoreMutatorOverride.mutator;this._oPropertyInfoStoreMutatorOverride=null}if(e){e.apply(this,arguments)}}};o._setupPropertyInfoStore=function(e){const r=this.getMetadata().getAllProperties();const t=r&&r[e];if(!t){throw new Error("PropertyHelperMixin: Property '"+e+"' not found.")}const i=this.getMetadata().getJSONKeys()[e];this._oPropertyInfoStoreMutatorOverride={key:i._sMutator,mutator:this[i._sMutator]};this[i._sMutator]=function(){this._oPropertyInfoStoreMutatorOverride.mutator.apply(this,arguments);if(!this._bPropertyHelperFinal){s.call(this,this[i._sGetter](),false)}return this};this._sPropertyInfoStore=e};o._setPropertyHelperClass=function(e){if(this._oPropertyHelper||this._bPropertyHelperInitializing){throw new Error("PropertyHelper already initializing/ed.")}if(e&&(!e.getMetadata||!e.getMetadata().isA("sap.ui.mdc.util.PropertyHelper"))){throw new Error("The custom property helper class must be sap.ui.mdc.util.PropertyHelper or a subclass of it.")}this._oPropertyHelperClass=e};o._getPropertyByName=function(e){return this._oPropertyHelper&&this._oPropertyHelper.getProperty(e)};o._getPropertyByNameAsync=function(e){const r=this._getPropertyByName(e);if(!r){return this.finalizePropertyHelper().then(r=>this._getPropertyByName(e))}return Promise.resolve(r)};function s(e,r){if(!this.isDestroyed()){if(this._bPropertyHelperInitializing&&typeof e!=="undefined"){return this._oPropertyHelperDeferred.promise.then(()=>n.call(this,e,r))}if(this._oPropertyHelper&&typeof e!=="undefined"){return n.call(this,e,r).then(()=>this._oPropertyHelperDeferred?.promise)}if(!this._oPropertyHelper){p.call(this,e,r)}}return this._oPropertyHelperDeferred?.promise}function p(e,r){this._bPropertyHelperInitializing=true;if(r||!e){r=true;this._pHelperFinalizationPromise=this._oPropertyHelperDeferred.promise}let o;return this._oApplySettingsDeferred.promise.then(()=>this.initControlDelegate()).then(t=>{o=t;return r?l(this):e}).then(e=>{if(this.isDestroyed()){return[]}return h.call(this,e).then(()=>e)}).then(e=>{if(this.isDestroyed()){return[]}return a(this,o).then(r=>[e,r])}).then(e=>{const r=i.checkValidationExceptions();return Promise.resolve(e.concat(r))}).then(e=>{if(this.isDestroyed()){return undefined}if(Array.isArray(e)===false){return undefined}const[i,o,s]=e;if(s){t.errorThrows(`PropertyInfo validation is disabled for control ${this.getId()}.`,{suffix:`Migrate this control's propertyInfo to avoid breaking changes in the future.`})}this._oPropertyHelper=new o(i,this,undefined);this._bPropertyHelperInitializing=false;if(r){this._bPropertyHelperFinal=true;this._oPropertiesFinalizedDeferred.resolve()}return this._oPropertyHelperDeferred.resolve(this._oPropertyHelper)}).catch(e=>this._oPropertyHelperDeferred&&this._oPropertyHelperDeferred.reject(e))}function n(e,r){if(this._bPropertyHelperFinal){throw new Error("This property helper is already final and cannot be updated further.")}return h.call(this,e).then(t=>{this._oPropertyHelper.setProperties(e);this._bPropertyHelperFinal=r||this._bPropertyHelperFinal;if(this._bPropertyHelperFinal){this._oPropertiesFinalizedDeferred.resolve()}return this._oPropertyHelper})}function l(e){return e.initControlDelegate().then(()=>{const r=e.getControlDelegate(e);return r.fetchProperties(e).then(r=>{if(e.isDestroyed()){return[]}return r})})}function a(e,t){if(t&&typeof t.getPropertyHelperClass==="function"){const r=t.getPropertyHelperClass();const i=e._oPropertyHelperClass?e._oPropertyHelperClass.getMetadata().getName():"sap.ui.mdc.util.PropertyHelper";if(!r||!r.getMetadata||!r.getMetadata().isA(i)){throw new Error("The property helper class must be "+i+" or a subclass of it.")}return Promise.resolve(r)}if(e._oPropertyHelperClass){return Promise.resolve(e._oPropertyHelperClass)}return r("sap/ui/mdc/util/PropertyHelper").then(e=>e[0])}function h(e){const r=[];e?.forEach(e=>{if(e.dataType&&r.indexOf(e.dataType)===-1){r.push(e.dataType)}});return this.getTypeMap().retrieveDataTypeClasses(r)}return function(){this.init=o.init(this.init);this.exit=o.exit(this.exit);this.applySettings=o.applySettings(this.applySettings);this.initPropertyHelper=o.initPropertyHelper;this.awaitPropertyHelper=o.awaitPropertyHelper;this.getPropertyHelper=o.getPropertyHelper;this.finalizePropertyHelper=o.finalizePropertyHelper;this.isPropertyHelperFinal=o.isPropertyHelperFinal;this.propertiesFinalized=o.propertiesFinalized;this._getPropertyByName=o._getPropertyByName;this._getPropertyByNameAsync=o._getPropertyByNameAsync;this._setPropertyHelperClass=o._setPropertyHelperClass;this._setupPropertyInfoStore=o._setupPropertyInfoStore}});
//# sourceMappingURL=PropertyHelperMixin.js.map