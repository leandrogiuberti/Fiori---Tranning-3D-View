/*
 * ! SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.define(["jquery.sap.global","sap/ui/core/Element","./ArrayUtilities"],function(jQuery,e,t){"use strict";var i=e.extend("sap.ui.vtm.TreeCollections",{getTreeItem:function(e){if(!e){return null}if(typeof e==="string"){var t=this._treeItemsById.get(e);if(!t){throw e+" was not found in tree with tree id "+this.getId()}return t}return e},getTreeItemId:function(e){if(!e){return null}return typeof e==="string"?e:e.id},updateCollections:function(e,t){t=t!==false;var i=this._parentIdsById;var r=this._includedTreeItems;var n=this._excludedTreeItems;this._treeItemsById=new Map;this._parentIdsById=new Map;this._treeItemsBySceneNodeId=new sap.ui.vtm.Lookup;this._includedTreeItems=[];this._excludedTreeItems=[];var d=this._parentIdsById;var s=false;var u=function(e,c,l){var a=e.id;if(!a){throw"id is not set for tree item with name "+e.name}if(this._treeItemsById.has(a)){throw a+" is not unique in the tree"}var I;if(l){this._excludedTreeItems.push(e);if(t&&n&&!s){I=this._excludedTreeItems.length-1;if(I>=n.length||n[I]!=e){s=true}}}else{this._includedTreeItems.push(e);if(t&&r&&!s){I=this._includedTreeItems.length-1;if(I>=r.length||r[I]!=e){s=true}}}this._treeItemsById.set(a,e);if(c){if(!c.id){throw"id is not set for tree item with name "+c.name}d.set(a,c.id);if(t&&i&&!s){if(i.get(a)!==c.id){s=true}}}else if(t&&i&&!s){if(i.get(a)){s=true}}if(e.includedChildren){e.includedChildren.forEach(function(t){u(t,e,l)})}if(e.excludedChildren){e.excludedChildren.forEach(function(t){u(t,e,true)})}if(e.sceneNodeIds){sap.ui.vtm.TreeItemUtilities.getSceneNodeIds(e).forEach(function(t){this._treeItemsBySceneNodeId.addValue(t,e)}.bind(this))}}.bind(this);e.forEach(function(e){u(e,null)});if(t&&!s){if(r&&r.length!==this._includedTreeItems.length){s=true}if(n&&n.length!==this._excludedTreeItems.length){s=true}}return t&&s},updateTreeItemsBySceneNodeId:function(e){this._treeItemsBySceneNodeId=new sap.ui.vtm.Lookup;sap.ui.vtm.TreeItemUtilities.traverseTree(e,function(e){sap.ui.vtm.TreeItemUtilities.getSceneNodeIds(e).forEach(function(t){this._treeItemsBySceneNodeId.addValue(t,e)}.bind(this));return sap.ui.vtm.ChildCollectionType.IncludedAndExcluded}.bind(this))},getItem:function(e){return this._treeItemsById.get(e)},isIncludedItem:function(e){e=this.getTreeItem(e);return this._includedTreeItems.indexOf(e)!==-1},isExcludedItem:function(e){e=this.getTreeItem(e);return this._excludedTreeItems.indexOf(e)!==-1},getItemsBySceneNodeId:function(e,t){e=sap.ui.vtm.ArrayUtilities.wrap(e);if(!e.length){return[]}t=t||sap.ui.vtm.TreeItemType.Included;var i=function(e,t){switch(t){case sap.ui.vtm.TreeItemType.IncludedOrExcluded:return true;case sap.ui.vtm.TreeItemType.Included:return this.isIncludedItem(e);case sap.ui.vtm.TreeItemType.Excluded:return this.isExcludedItem(e);default:throw"Unexpected sap.ui.vtm.TreeItemType value "+t}}.bind(this);var r=[];e.forEach(function(e){var n=this._treeItemsBySceneNodeId.getValues(e);n.forEach(function(e){if(r.indexOf(e)===-1&&i(e,t)){r.push(e)}})}.bind(this));return r},getParentItem:function(e){var t=this.getTreeItemId(e);var i=this._parentIdsById.get(t);if(!i){return undefined}return this._treeItemsById.get(i)},getDescendantItems:function(e,t){e=this.getTreeItem(e);t=t||sap.ui.vtm.TreeItemType.Included;var i=[];switch(t){case sap.ui.vtm.TreeItemType.IncludedOrExcluded:sap.ui.vtm.TreeItemUtilities.traverseBranch(e,function(t){if(t!==e){i.push(t)}return sap.ui.vtm.ChildCollectionType.IncludedAndExcluded});break;case sap.ui.vtm.TreeItemType.Included:sap.ui.vtm.TreeItemUtilities.traverseBranch(e,function(t){if(t===e){return this.isIncludedItem(t)?sap.ui.vtm.ChildCollectionType.Included:sap.ui.vtm.ChildCollectionType.None}else{i.push(t);return sap.ui.vtm.ChildCollectionType.Included}}.bind(this));break;case sap.ui.vtm.TreeItemType.Excluded:sap.ui.vtm.TreeItemUtilities.traverseBranch(e,function(t){if(t===e){return sap.ui.vtm.ChildCollectionType.IncludedAndExcluded}else{if(this.isExcludedItem(t)){i.push(t)}return sap.ui.vtm.ChildCollectionType.IncludedAndExcluded}}.bind(this));break;default:throw"Unexpected sap.ui.vtm.TreeItemType value "+t}return i},getAncestorItems:function(e){e=this.getTreeItem(e);var t=[];var i=this.getParentItem(e.id);while(i){t.push(i);i=this.getParentItem(i.id)}return t.reverse()},getAllItems:function(e){e=e||sap.ui.vtm.TreeItemType.Included;switch(e){case sap.ui.vtm.TreeItemType.IncludedOrExcluded:return this._includedTreeItems.concat(this._excludedTreeItems);case sap.ui.vtm.TreeItemType.Included:return this._includedTreeItems.slice();case sap.ui.vtm.TreeItemType.Excluded:return this._excludedTreeItems.slice();default:throw"Unexpected sap.ui.vtm.TreeItemType value "+e}}});return i});
//# sourceMappingURL=TreeCollections.js.map