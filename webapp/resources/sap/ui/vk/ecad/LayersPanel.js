/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.define(["sap/m/VBox","sap/m/Button","sap/m/SearchField","sap/m/OverflowToolbar","sap/m/ToolbarLayoutData","sap/m/ToolbarSpacer","sap/m/Label","sap/m/Table","sap/m/Column","sap/m/ColumnListItem","sap/m/IllustratedMessage","sap/m/IllustratedMessageType","sap/m/plugins/ColumnResizer","sap/ui/core/Control","sap/ui/core/Element","sap/ui/core/Icon","sap/ui/core/library","sap/ui/model/json/JSONModel","../Core","./VisibilityType","../getResourceBundle","sap/m/library"],function(e,t,n,i,s,o,a,r,l,c,h,d,u,p,_,f,g,m,y,E,b,S){"use strict";const C=S.Sticky;const L=S.FlexRendertype;function T(e){const t=new Map;const n=e.getSceneMetadata();const i=n.find(e=>e.category==="ecad"&&e.tag==="Layers");if(i){const e=i.value.split("|");e.forEach(function(e){const i=n.find(t=>t.category===e&&t.tag==="Index");if(i){t.set(e,i.value)}})}return t}function w(e){if(e.hiddenElements.size===0){return E.Visible}else if(e.hiddenElements.size<e.elements.size){return E.Partial}return E.Hidden}function I(e){const t=e?.userData?.metadata??{};if(t.length){const e=new Map;t.forEach(function(t){if(t.category==="ecad"){e.set(t.tag,t.value)}});return e}return null}var x=p.extend("sap.ui.vk.ecad.LayersPanel",{metadata:{library:"sap.ui.vk",properties:{width:{type:"sap.ui.core.CSSSize",defaultValue:"auto"},height:{type:"sap.ui.core.CSSSize",defaultValue:"100%"}},aggregations:{content:{type:"sap.ui.core.Control",multiple:false}},associations:{contentConnector:{type:"sap.ui.vk.ContentConnector",multiple:false},viewStateManager:{type:"sap.ui.vk.ViewStateManagerBase",multiple:false}},events:{contentChanged:{enableEventBubbling:true}}},renderer:{apiVersion:2,render:function(e,t){e.openStart("div",t);e.class("sapUiSizeCompact");const n=t.getWidth();if(n!=null){e.style("width",n)}const i=t.getHeight();if(i!=null){e.style("height",i)}e.openEnd();e.renderControl(t.getAggregation("content"));e.close("div")}},constructor:function(e,t){p.apply(this,arguments);y.observeAssociations(this)}});const B={Hidden:"sap-icon://status-inactive",Partial:"sap-icon://vk-icons/partially-visible-layer",Visible:"sap-icon://rhombus-milestone-2"};const V={Component:"2",Net:"4"};x.prototype.onSetViewStateManager=function(e){this._manager=e;e.attachVisibilityChanged(this._onVisibilityChanged,this);this._refresh()};x.prototype.onUnsetViewStateManager=function(e){this._manager=null;e.detachVisibilityChanged(this._onVisibilityChanged,this);this._refresh()};x.prototype.onSetContentConnector=function(e){e.attachContentReplaced(this._onContentReplaced,this);this._setContent(e.getContent())};x.prototype.onUnsetContentConnector=function(e){this._setContent(null);e.detachContentReplaced(this._onContentReplaced,this)};x.prototype.init=function(){if(p.prototype.init){p.prototype.init.apply(this)}const _=this;this._searchField=new n({layoutData:new s({shrinkable:true,maxWidth:"400px"}),search:function(e){_._onSearch.call(_,e.getParameter("query"))}});this._showButton=new t({enabled:false,icon:B.Visible,text:b().getText("LAYERS_PANEL_SHOW_BUTTON"),tooltip:b().getText("LAYERS_PANEL_SHOW_BUTTON_TOOLTIP"),press:this._onShowLayers.bind(this)});this._hideButton=new t({enabled:false,icon:B.Hidden,text:b().getText("LAYERS_PANEL_HIDE_BUTTON"),tooltip:b().getText("LAYERS_PANEL_HIDE_BUTTON_TOOLTIP"),press:this._onHideLayers.bind(this)});this._table=new r({visible:false,mode:"MultiSelect",includeItemInSelection:true,sticky:[C.HeaderToolbar,C.ColumnHeaders],selectionChange:this._updateButtons.bind(this),headerToolbar:new i({content:[this._searchField,new o,this._showButton,this._hideButton]}),dependents:[new u],columns:[new l({minScreenWidth:"10rem",hAlign:g.TextAlign.Begin,header:new a({text:b().getText("LAYERS_PANEL_NAME_COLUMN")})}),new l({minScreenWidth:"6rem",hAlign:g.TextAlign.Center,header:new a({text:b().getText("LAYERS_PANEL_VISIBLE_COLUMN")})})],items:{path:"/",template:new c({vAlign:"Middle",cells:[new a({text:"{name}"}),new f({src:{path:"",formatter:function(e){switch(w(e)){case E.Hidden:return B.Hidden;case E.Partial:return B.Partial;default:return B.Visible}}},tooltip:{path:"",formatter:function(e){switch(w(e)){case E.Hidden:return b().getText("LAYERS_PANEL_VISIBLE_COLUMN_HIDDEN_TOOLTIP");case E.Partial:return b().getText("LAYERS_PANEL_VISIBLE_COLUMN_PARTIAL_TOOLTIP");default:return b().getText("LAYERS_PANEL_VISIBLE_COLUMN_VISIBLE_TOOLTIP")}}}})]})}});this._message=new h({illustrationType:d.NoData,enableVerticalResponsiveness:true});const y=new e({height:"100%",renderType:L.Bare,items:[this._table,this._message]});this.setAggregation("content",y);this._scene=null;this._model=new m;this._table.setModel(this._model);this._skipEvent=false};x.prototype.exit=function(){this._model.destroy();this._model=null;p.prototype.exit?.apply(this)};x.prototype.getControl=function(){return this._table};x.prototype._refresh=function(){if(!this._scene||!this._manager){this._model?.setData([]);this._updateMessage();return}this._initialLayerIndex=1;const e=new Map;this._scanTree(e,this._scene.getRootElement());const t=T(this._scene);t.forEach(function(t,n){const i=e.get(n);if(i){i.index=+t}},this);const n=e.values().toArray();n.sort((e,t)=>e.index-t.index);this._model.setSizeLimit(n.length);this._model.setData(n);this._table.setModel(this._model);this._updateMessage();this.fireContentChanged()};x.prototype._setScene=function(e){this._scene=e?.isECADScene()?e:null;this._refresh()};x.prototype._addToLayer=function(e,t,n){let i=e.get(t);if(!i){i={name:t,index:this._initialLayerIndex++,elements:new Map,hiddenElements:new Set};e.set(t,i)}if(this._manager.getVisibilityState(n)===false){i.hiddenElements.add(n.uid)}i.elements.set(n.uid,n)};x.prototype._scanTree=function(e,t){const n=I(t);if(n){const i=n.get("layer");if(i){this._addToLayer(e,i,t);return}}t.children.forEach(t=>this._scanTree(e,t))};x.prototype._setContent=function(e){if(e&&!this.getViewStateManager()){const e=_.getElementById(this.getContentConnector());if(e){const t=e.getDefaultViewStateManager();if(t){this.setViewStateManager(t)}}}this._setScene(e);return this};x.prototype._onContentReplaced=function(e){this._setContent(e.getParameter("newContent"))};x.prototype._updateButtons=function(){let e=false;let t=false;const n=this._table.getSelectedItems();n.forEach(function(n){const i=n.getBindingContext().getObject();const s=w(i);if(s===E.Visible){e=true}else if(s===E.Hidden){t=true}else{e=t=true}},this);this._showButton.setEnabled(t);this._hideButton.setEnabled(e)};x.prototype._onShowLayers=function(){const e=[];const t=this._table.getSelectedItems();t.forEach(function(t){const n=t.getBindingContext().getObject();if(n.hiddenElements.size>0){n.hiddenElements.clear();n.elements.forEach(function(t){e.push(t)},this)}},this);this._skipEvent=true;this._manager.setVisibilityState(e,true,true,true);this._model.updateBindings(true);this._updateButtons()};x.prototype._onHideLayers=function(){const e=[];const t=this._table.getSelectedItems();t.forEach(function(t){const n=t.getBindingContext().getObject();if(n.hiddenElements.size!==n.elements.size){n.hiddenElements.clear();n.elements.forEach(function(t){n.hiddenElements.add(t.uid);e.push(t)},this)}},this);this._skipEvent=true;this._manager.setVisibilityState(e,false,true,true);this._model.updateBindings(true);this._updateButtons()};x.prototype._onSearch=function(e){if(e!==""){const t=[];this._table.getItems().forEach(function(n){if(n.getBindingContext().getObject().name.lastIndexOf(e)!==-1){t.push(n)}},this);if(t.length>0){this._table.removeSelections(true,false);t.forEach(function(e){this._table.setSelectedItem(e)},this);this._table.fireSelectionChange({listItems:t})}}};x.prototype._onVisibilityChanged=function(e){if(this._skipEvent){this._skipEvent=false;return}const t=this._model.getData();const n=e.getParameter("hidden");const i=e.getParameter("visible");const s=(e,n)=>{e.forEach(function(e){const i=I(e);const s=i?.get("layer");if(s){const s=i?.get("type");const o=s===V.Component?[e]:[e].concat(e.children);o.forEach(function(e){for(let i=0;i<t.length;++i){if(t[i].elements.has(e.uid)){if(n){t[i].hiddenElements.delete(e.uid)}else{t[i].hiddenElements.add(e.uid)}break}}})}},this)};s(n,false);s(i,true);this._model.updateBindings(true);this._updateButtons()};x.prototype._updateMessage=function(){const e=this._table.getItems().length>0;this._table.setVisible(e);this._message.setVisible(!e)};return x});
//# sourceMappingURL=LayersPanel.js.map