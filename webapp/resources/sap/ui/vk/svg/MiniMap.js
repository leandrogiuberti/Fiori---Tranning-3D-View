/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.define(["sap/ui/core/Control","sap/ui/core/Element"],function(t,e){"use strict";const i=t.extend("sap.ui.vk.svg.MiniMap",{metadata:{library:"sap.ui.vk",properties:{maxWidth:{type:"int",defaultValue:"320"},maxHeight:{type:"int",defaultValue:"320"}},associations:{viewport:{type:"sap.ui.vk.svg.Viewport",multiple:false},viewStateManager:{type:"sap.ui.vk.ViewStateManagerBase",multiple:false}},events:{sizeChanged:{parameters:{width:{type:"int"},height:{type:"int"}}}}},renderer:{apiVersion:2,render:function(t,e){t.openStart("div",e);t.class("sapUiVkMiniMapView");t.openEnd();t.close("div")}}});i.prototype.init=function(){t.prototype.init.call(this);this._sceneBBox=null;this._width=this._height=0;this._lockPosition={x:-16,y:16};this._canvas=document.createElement("canvas");this._canvas.classList.add("sapUiVkMiniMapViewCanvas");this._rect=document.createElement("div");this._rect.classList.add("sapUiVkMiniMapViewAreaRect");this.attachBrowserEvent(sap.ui.Device.browser.firefox?"DOMMouseScroll":"mousewheel",this._onMouseWheel,this)};i.prototype.exit=function(){this.setViewport(null);this.setViewStateManager(null)};i.prototype.setViewport=function(t){const i=e.getElementById(this.getViewport());i?.detachResize(this._updateRectPosition,this);i?.detachCameraChanged(this._updateRectPosition,this);this.setAssociation("viewport",t);t?.attachCameraChanged(this._updateRectPosition,this);t?.attachResize(this._updateRectPosition,this)};i.prototype.setViewStateManager=function(t){const i=e.getElementById(this.getViewStateManager());i?.detachVisibilityChanged(this._onContentUpdate,this);i?.detachTintColorChanged(this._onContentUpdate,this);this.setAssociation("viewStateManager",t);t?.attachVisibilityChanged(this._onContentUpdate,this);t?.attachTintColorChanged(this._onContentUpdate,this)};i.prototype._updateRectPosition=function(){const t=e.getElementById(this.getViewport());const i=this._sceneBBox;if(!t||!i){return}const n=t._getViewBox();const o=this._width/i[2];const s=this._height/i[3];const a=(n[0]-i[0])*o;const h=(n[1]-i[1])*s;this._rect.style.left=a+"px";this._rect.style.top=h+"px";this._rect.style.width=n[2]*o+"px";this._rect.style.height=n[3]*s+"px"};i.prototype._onMouseWheel=function(t){const i=e.getElementById(this.getViewport());if(!i){return}const n=this.getDomRef().getBoundingClientRect();const o=t.pageX-n.x;const s=t.pageY-n.y;if(o<0||o>=this._width||s<0||s>=this._height){return}let a=t.originalEvent.detail?t.originalEvent.detail*-40:t.originalEvent.wheelDelta;if(!t.originalEvent.touches){a=Math.min(Math.max(a,-20),20)}i.beginGesture(i._width*.5,i._height*.5);i.zoom(Math.pow(2,a/960));i.endGesture();t.setMarked();t.preventDefault()};i.prototype.ontouchstart=function(t){const i=e.getElementById(this.getViewport());const n=this._sceneBBox;const o=this.getParent()?.getDomRef();if(!i||!n||!o){return}if(t.button===2){const e=i.getDomRef()?.getBoundingClientRect();const n=o.getBoundingClientRect();if(!e||!n){return}const s={x:t.pageX,y:t.pageY,elementX:parseInt(o.style.left,10)||0,elementY:parseInt(o.style.top,10)||0};let a;const h=t=>{if(t.buttons!==2){a();return}let i=s.elementX+t.pageX-s.x;let h=s.elementY+t.pageY-s.y;i=Math.min(Math.max(i,e.x),e.x+e.width-n.width-1);h=Math.min(Math.max(h,e.y),e.y+e.height-n.height-1);o.style.left=i+"px";o.style.top=h+"px";const r=i-e.x;const c=h-e.y;const p=e.x+e.width-(i+n.width);const l=e.y+e.height-(h+n.height);this._lockPosition.x=r<p?r:-p;this._lockPosition.y=c<l?c:-l;t.setMarked();t.preventDefault()};const r=jQuery(document);a=t=>{r.off("mousemove",h);r.off("mouseup",a);o.style.cursor=null};r.on("mousemove",h);r.on("mouseup",a);o.style.cursor="grab";return}const s=t=>{const e=this.getDomRef().getBoundingClientRect();const o=i._getViewBox();const s=t.pageX-e.x;const a=t.pageY-e.y;const h=o[0]+o[2]*.5-n[0]-s*n[2]/this._width;const r=o[1]+o[3]*.5-n[1]-a*n[3]/this._height;if(h!==0||r!==0){const t=i.getCamera();i.pan(h*t.zoom,r*t.zoom)}t.setMarked();t.preventDefault()};i.beginGesture(i._width*.5,i._height*.5);s(t);const a=jQuery(document);const h=t=>{a.off("mousemove",s);a.off("mouseup",h);o.style.cursor=null;i.endGesture()};a.on("mousemove",s);a.on("mouseup",h);o.style.cursor="crosshair"};i.prototype.oncontextmenu=function(t){t.preventDefault();t.stopPropagation()};i.prototype._onContentUpdate=function(){const t=e.getElementById(this.getViewport());const i=t?._svgElement;const n=this.getDomRef();if(!i||!n){return}const o=i.getBBox();let s=this._sceneBBox;if(!s||!s[2]||!s[3]){s=this._sceneBBox=[o.x,o.y,o.width,o.height]}else{s[2]=Math.max(s[0]+s[2],o.x+o.width);s[3]=Math.max(s[1]+s[3],o.y+o.height);s[0]=Math.min(s[0],o.x);s[1]=Math.min(s[1],o.y);s[2]-=s[0];s[3]-=s[1]}const a=s[2]>0&&s[3]>0?s[2]/s[3]:1;const h=this.getMaxWidth();const r=this.getMaxHeight();const c=this._width=Math.min(h,Math.round(h*a));const p=this._height=Math.min(r,Math.round(r/a));n.style.width=c+"px";n.style.height=p+"px";this.fireSizeChanged({width:c,height:p});this._updateRectPosition();const l=i.getAttribute("width");const d=i.getAttribute("height");const g=i.getAttribute("viewBox");i.setAttribute("width",c+"px");i.setAttribute("height",p+"px");i.setAttribute("viewBox",s.join(" "));const u=(new XMLSerializer).serializeToString(i);const m="data:image/svg+xml; charset=utf8, "+encodeURIComponent(u);i.setAttribute("width",l);i.setAttribute("height",d);i.setAttribute("viewBox",g);const f=this._canvas;const w=window.devicePixelRatio||1;f.width=c*w;f.height=p*w;const y=new Image;y.src=m;y.onload=function(){const e=f.getContext("2d");const i=e.createLinearGradient(0,0,0,f.height);i.addColorStop(0,t.getBackgroundColorTop());i.addColorStop(1,t.getBackgroundColorBottom());e.fillStyle=i;e.fillRect(0,0,f.width,f.height);e.drawImage(y,0,0,f.width,f.height)}};i.prototype.onAfterRendering=function(){const t=this.getDomRef();t.appendChild(this._canvas);t.appendChild(this._rect);this._onContentUpdate()};return i});
//# sourceMappingURL=MiniMap.js.map