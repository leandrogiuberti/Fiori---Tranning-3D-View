/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.define(["./Element","./Path","sap/base/util/uid"],function(t,e,i){"use strict";const n=10;const s=11;const a=12;var o=function(e){e=e||{};t.call(this,e);this.type="Text";this.text=e.text;this.content=e.content||(e.children?v(e.children,e.textStyles):[]);this.style=e.style||{};this.style.size=this.style.size||"1em";this.x=e.x||0;this.y=e.y||0;["dx","dy","textAnchor","alignmentBaseline","pivot","anchor"].forEach(t=>{if(e[t]!=null){this[t]=e[t]}});this.fillStyle=e.fillStyle||{colour:[0,0,0,1]};this.lineStyle=e.lineStyle||{colour:[0,0,0,0],width:1};if(this.style.fill){this.fillStyle.veid="t"+this.style.veid;this.fillStyle.colour=this.style.fill}if(this.style.stroke){this.lineStyle.veid="t"+this.style.veid;this.lineStyle.colour=this.style.stroke}this.setMaterial(e.material)};o.prototype=Object.assign(Object.create(t.prototype),{constructor:o});o.prototype.tagName=function(){return"text"};o.prototype.defaultFillAlpha=1;var r=document.createElement("canvas");var f=r.getContext("2d");o.prototype._expandBoundingBox=function(t,e){if(this.domRef){var i=this.domRef.getBBox();if(i){this._expandBoundingBoxCE(t,e,i.x+i.width*.5,i.y+i.height*.5,i.width*.5,i.height*.5);return}}function n(t){var e="";for(var i=0,s=t.length;i<s;i++){var a=t[i];if(a.text){e+=a.text}if(a.content){e+=n(a.content)}}return e}var s=isNaN(this.strokeWidth)?0:this.strokeWidth*.5;f.font=this.style.size+" "+(this.style.fontFace||"Arial");var a=f.measureText((this.text?this.text:"")+(this.content?n(this.content):""));var o=a.width*.5+s;var r=(a.actualBoundingBoxAscent||this.style.size)*.5+s;this._expandBoundingBoxCE(t,e,this.x+o,this.y-r,o,r)};function l(t,e,i){if(t.size){e("font-size",t.size)}if(t.fontFace){e("font-family",t.fontFace)}if(t.fontStyle){e("font-style",t.fontStyle)}if(t.fontWeight){e("font-weight",t.fontWeight)}if(t.textDecoration){e("text-decoration",t.textDecoration)}if(!i){if(t.fill){e("fill",t.fill)}if(t.stroke){e("stroke",t.stroke)}}}o.prototype._setSpecificAttributes=function(t){t("x",this.x);t("y",this.y);if(this.dx){t("dx",this.dx)}if(this.dy){t("dy",this.dy)}if(this.textAnchor){t("text-anchor",this.textAnchor)}if(this.alignmentBaseline){t("alignment-baseline",this.alignmentBaseline)}l(this.style,t,true)};function h(t,e){if(t.x!==undefined){e("x",t.x)}if(t.y!==undefined){e("y",t.y)}if(t.dx){e("dx",t.dx)}if(t.dy){e("dy",t.dy)}}function c(t,i){if(!t||t.length===0){return}var o=i.attr.bind(i);for(var r=0,f=t.length;r<f;r++){var d=t[r];switch(d.type){case n:case undefined:case"text":i.text(d.text);break;case s:case"span":i.openStart("tspan");h(d,o);if(d.style){l(d.style,o)}i.openEnd();if(d.text){i.text(d.text)}c(d.content,i);i.close("tspan");break;case a:case"path":i.openStart("textPath");h(d,o);if(d.style){l(d.style,o)}if(!d.path&&d.pathSegments){d.path=new e({segments:d.pathSegments})}var x=d.path;if(x instanceof e){i.attr("href","#"+x.uid);i.openEnd();i.openStart(x.tagName());i.attr("id",x.uid);x._setSpecificAttributes(o);i.openEnd();i.close(x.tagName())}else{i.openEnd()}if(d.text){i.text(d.text)}c(d.content,i);i.close("textPath");break;default:break}}}o.prototype._renderContent=function(t){if(this.text){t.text(this.text)}c(this.content,t)};function d(i,o){if(!i||i.length===0){return}var r,f;for(var c=0,x=i.length;c<x;c++){var p=i[c];switch(p.type){case n:case undefined:case"text":o.append(p.text);break;case s:case"span":r=document.createElementNS(t._svgNamespace,"tspan");f=r.setAttribute.bind(r);h(p,f);if(p.style){l(p.style,f)}if(p.text){r.append(p.text)}d(p.content,r);o.append(r);break;case a:case"path":r=document.createElementNS(t._svgNamespace,"textPath");f=r.setAttribute.bind(r);h(p,f);if(p.style){l(p.style,f)}if(!p.path&&p.pathSegments){p.path=new e({segments:p.pathSegments})}var y=p.path;if(y instanceof e){r.setAttribute("href","#"+y.uid);var u=document.createElementNS(t._svgNamespace,y.tagName());u.setAttribute("id",y.uid);y._setSpecificAttributes(u.setAttribute.bind(u));r.append(u)}if(p.text){r.append(p.text)}d(p.content,r);o.append(r);break;default:break}}}o.prototype._createContent=function(t){if(this.text){t.append(this.text)}d(this.content,t)};function x(t){let e;switch(typeof t){case"number":e=t;break;case"string":if(t.endsWith("pt")){e=parseFloat(t)*4/3}else if(t.endsWith("em")){e=parseFloat(t)*16}else{e=parseFloat(t)}break;default:e=0;break}return typeof e==="number"&&isFinite(e)?e:0}function p(t){var e=[];for(var i=0;i<t.childNodes.length;i++){var a=t.childNodes[i];if(a.data!==undefined){e.push({type:n,text:a.data})}else if(a.childNodes.length>0){var o={type:s,content:p(a)};var r=a.style;var f={};if(r.fontSize){f.size=r.fontSize}if(r.fontFamily){f.fontFace=r.fontFamily.replaceAll('"',"'")}if(r.textDecoration){f.textDecoration=r.textDecoration}if(r.color){f.fill=r.color}switch(a.tagName){case"EM":f.fontStyle="italic";break;case"STRONG":f.fontWeight="bold";break;default:break}if(Object.keys(f).length){o.style=f}e.push(o)}}return e}function y(t){var e=0;for(var i=0;i<t.length;i++){var n=t[i];var s=n.style&&n.style.size;if(s!==undefined){s=x(s);if(typeof s=="number"&&isFinite(s)){e=Math.max(e,s)}}if(n.content){e=Math.max(e,y(n.content))}}return e}o.prototype.setHtmlTextContent=function(t){var e=document.createElement("html");e.innerHTML=t;var i=[];var a=e.getElementsByTagName("body");var o=a.length>0?a[0].childNodes:[];for(var r=0,f=this.y;r<o.length;r++){var l=o[r];if(l.childNodes.length>0){var h=p(l);var c;if(l.nodeName==="P"){c=Math.max(y(h),x(this.style.size));f+=r>0?c:0}i.push({type:s,x:x(l.style.paddingLeft)+this.x,y:f,content:p(l)});if(l.nodeName==="P"){f+=c*.25}}else if(l.data){i.push({type:n,text:l.data})}}delete this.text;this.content=i;this.invalidate()};function u(t,e){var i="";var o=[];for(var r=0;r<t.length;r++){var f=t[r];switch(f.type){case n:case undefined:case"text":i+=f.text;break;case s:case"span":case a:case"path":var l=f.style;if(!e||f.y!==undefined||f.dy!==undefined){o.push("p");i+='<p style="text-align: left;';if(f.x){i+=" padding-left: "+(typeof f.x==="number"?f.x+"px":f.x)+";"}i+='">'}if(l){if(l.textDecoration||l.size||l.fontFace||l.fill){o.push("span");i+='<span style="';if(l.textDecoration){i+="text-decoration: "+l.textDecoration+";"}if(l.size){i+="font-size: "+x(l.size)*.75+"pt;"}if(l.fill){i+="color: "+l.fill+";"}if(l.fontFace){i+="font-family: "+l.fontFace+";"}i+='">'}if(l.fontStyle==="italic"){o.push("em");i+="<em>"}if(l.fontWeight==="bold"){o.push("strong");i+="<strong>"}}if(o.length===0){o.push("span");i+="<span>"}if(f.text){i+=f.text}i+=u(f.content,true);var h=o.pop();while(h!==undefined){i+="</"+h+">";h=o.pop()}break;default:break}}return i}o.prototype.getHtmlTextContent=function(){var t=u(this.content,false);return this.text?this.text+t:t};function v(t,e){var i=[];for(var o=0;o<t.length;o++){var r=t[o];switch(r.type){case undefined:case"text":i.push({type:n,text:r.text});break;default:case"span":case"path":var f={type:r.type==="path"?a:s};if(r.x!==undefined){f.x=r.x}if(r.y!==undefined){f.x=r.y}if(r.dx!==undefined){f.x=r.dx}if(r.dy!==undefined){f.x=r.dy}if(r.style_id){f.style=e.get(r.style_id)}if(r.text){f.text=r.text}if(r.children){f.content=v(r.children,e)}i.push(f);break}}return i}function m(t,e){var o=[];for(var r=0;r<t.length;r++){var f=t[r];switch(f.type){case n:case undefined:o.push({text:f.text});break;case s:case"span":case a:case"path":var l={type:"span"};if(f.x!==undefined){l.x=f.x}if(f.y!==undefined){l.y=f.y}if(f.dx!==undefined){l.dx=f.dx}if(f.dy!==undefined){l.dy=f.dy}if(f.text){l.text=f.text}var h=f.style;if(h){h.veid=h.veid||i();l["style_id"]=h.veid;e.push(h)}if(f.content){l.children=m(f.content,e)}o.push(l);break;default:break}}return o}o.prototype._getParametricShape=function(e,n,s){var a=t.prototype._getParametricShape.call(this,e,n,s);a.type="text";if(a.s){a.s[1]*=-1}if(this.x){a.x=this.x}if(this.y){a.y=this.y}if(this.dx){a.dx=this.dx}if(this.dy){a.dy=this.dy}var o=this.style;if(o){o.veid=o.veid||i();a["style_id"]=o.veid;s.push(o)}if(this.text){a.text=this.text}a.children=m(this.content,s);return a};o.prototype.copy=function(e,i){t.prototype.copy.call(this,e,i);this.text=e.text;this.content=e.content;this.style=e.style;this.x=e.x;this.y=e.y;if(e.dx){this.dx=e.dx}if(e.dy){this.dy=e.dy}return this};t.prototype.setCustomText=function(t){if(t==null||t.text==null&&t.htmlText==null){this.customText=null;return this}const e=this.customText=new o({text:t.text,pivot:t.pivot??[.5,.5],anchor:t.anchor??[.5,.5],style:{size:t.size??"0px",fontFace:t.fontFamily??t.fontFace??"Arial",fontStyle:t.fontStyle,fontWeight:t.fontWeight,textDecoration:t.textDecoration,fill:t.fill??"black"}});if(t.htmlText){e.setHtmlTextContent(t.htmlText)}e.userData.customText=true;return this};return o});
//# sourceMappingURL=Text.js.map