/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.define(["sap/ui/base/EventProvider","sap/ui/core/RenderManager","sap/ui/core/ResizeHandler","./NativeViewport"],function(t,e,i,n){"use strict";var o=t.extend("sap.ui.vk.RedlineGesturesHandler",{metadata:{library:"sap.ui.vk",publicMethods:["beginGesture","move","endGesture","click","doubleClick","contextMenu","getViewport"]},constructor:function(t){this._redlineDesign=t;this._x=0;this._y=0;this._d=0;this._zoomFactor=1;this._gesture=false}});o.prototype.destroy=function(){this._redlineDesign=null;this._rect=null;this._gesture=false};o.prototype._getOffset=function(t){var e=t.getBoundingClientRect();return{x:e.left+window.pageXOffset,y:e.top+window.pageYOffset}};o.prototype._inside=function(t,e){var i=e.getDomRef(),n=false;if(i!==null){var o=this._getOffset(i);var r={x:o.x,y:o.y,width:i.getBoundingClientRect().width,height:i.getBoundingClientRect().height};n=t.x>=r.x&&t.x<=r.x+r.width&&t.y>=r.y&&t.y<=r.y+r.height}return n};o.prototype._onresize=function(t){this._gesture=false};o.prototype.beginGesture=function(t){var e=this.getViewport();if(this._inside(t,e)){this._gesture=true;this._x=t.x;this._y=t.y;this._d=t.d;this._initd=t.d;t.handled=true}return this};o.prototype._pan=function(t){var e=this.getViewport(),i=t.x-this._x,n=t.y-this._y;if(i||n){this._x=t.x;this._y=t.y;var o=e.getPanningRatio();e.firePan({deltaX:i*o,deltaY:n*o});e.getRedlineElements().forEach(function(t){t.setOriginX(t.getOriginX()+e._toVirtualSpace(i));t.setOriginY(t.getOriginY()+e._toVirtualSpace(n))});this._manualRender(e)}};o.prototype._zoom=function(t){var e=this.getViewport(),i=1;var o=t.d-this._d;this._d=t.d;if(this._initd>0){i=1+o*(1/this._initd)}else if(t.n===2){if(t.points[0].y>t.points[1].y){i=Math.max(1-o*.005,.333)}else{i=Math.min(1+o*.005,3)}}i=Math.min(Math.max(i,.88),1.12);var r=e._getTargetViewport();var s=32;var a=1/8;if(r instanceof n){s=r._getZoomInLimit();a=r._getZoomOutLimit();this._zoomFactor=r._getZoomFactor()}i=Math.min(Math.max(this._zoomFactor*i,a),s)/this._zoomFactor;this._zoomFactor*=i;var h=this._getOffset(e.getDomRef());var u=1-i,g=e._toVirtualSpace(t.x-h.x,t.y-h.y);e.getRedlineElements().forEach(function(t){t.applyZoom(i);var e=t.getOriginX(),n=t.getOriginY();e+=(g.x-e)*u;n+=(g.y-n)*u;t.setOriginX(e);t.setOriginY(n)});this._manualRender(e);e.fireZoom({originX:t.x-h.x,originY:t.y-h.y,zoomFactor:i})};o.prototype.move=function(t){if(this.getViewport().getDomRef()){if(t.n===1||t.n===2){this._pan(t)}if(t.n===2&&!t.buttons){this._zoom(t)}}t.handled=true;return this};o.prototype._manualRender=function(t){var i=(new e).getInterface();t.getRedlineElements().forEach(function(t){t.render(i)});i.flush(t.getDomRef(),false,false);i.destroy();var n=t.$();n.html(n.html())};o.prototype.endGesture=function(t){this._gesture=false;t.handled=true;return this};o.prototype.contextMenu=function(t){t.handled=true};o.prototype.getViewport=function(){return this._redlineDesign};return o});
//# sourceMappingURL=RedlineGesturesHandler.js.map