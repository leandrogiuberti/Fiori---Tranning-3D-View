/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.define(["sap/ui/core/Element","./Core","./Scene"],function(e,t,i){"use strict";var n=e.extend("sap.ui.vk.ViewManager",{metadata:{library:"sap.ui.vk",associations:{contentConnector:{type:"sap.ui.vk.ContentConnector"},animationPlayer:{type:"sap.ui.vk.AnimationPlayer"}}},constructor:function(i,n){e.apply(this,arguments);this._scene=null;this._activeView=null;this._cancelPlayingViewGroup=false;t.observeLifetime(this);t.observeAssociations(this)}});n.prototype._setScene=function(e){if(this._scene!==e){this._scene=e;if(e){var t=e.getInitialView();if(t){this.activateView(t,true,true)}}}return this};n.prototype.getActiveView=function(){return this._activeView};n.prototype._getNextView=function(e,t){var i=this._scene;if(!t){t=i.findViewGroupByView(e)}var n;var a=-1;if(!t){n=i.getViews();a=n.indexOf(e)}else{n=t.getViews();a=t.indexOfView(e)}if(a<0){return undefined}else if(a>=n.length-1){return undefined}a++;return n[a]};n.prototype._setContent=function(e){var t=null;if(e&&e instanceof i){t=e}this._setScene(t)};n.prototype.onSetContentConnector=function(e){e.attachContentReplaced(this._onContentReplaced,this);this._setContent(e.getContent())};n.prototype.onUnsetContentConnector=function(e){this._setContent(null);e.detachContentReplaced(this._onContentReplaced,this)};n.prototype._onContentReplaced=function(e){this._setContent(e.getParameter("newContent"))};n.prototype.activateView=function(e,t,i){if(i==null){i=false}if(t==null){t=false}return this._activateView(e,null,t,i,false)};n.prototype.playViewGroup=function(t,i,n){this._cancelPlayingViewGroup=false;if(t===this.getActiveView()){var a=e.getElementById(this.getAnimationPlayer());if(a){if(a.getTime()>=a.getTotalDuration()){a.setTime(0)}}return this._play(t,i,true,n)}this._activateView(t,i,false,false,true,n);return this};n.prototype.stopPlayingViewGroup=function(){this._cancelPlayingViewGroup=true;var t=e.getElementById(this.getAnimationPlayer());if(t){t.stop()}return this};n.prototype._play=function(i,n,a,o){var s=t.getEventBus();var r=e.getElementById(this.getAnimationPlayer());var u=r!=null&&i.hasAnimation()&&i.getAutoPlayAnimation();if(a){var c=function(){if(this._cancelPlayingViewGroup){return}var e=this._getNextView(i,n);if(e){this._activateView(e,n,false,false,a)}else{s.publish("sap.ui.vk","procedureFinished")}}.bind(this);var l=function(e,t,i){if(i.source!==r){return}if(i.stopped){s.unsubscribe("sap.ui.vk","animationPlayStateChanged",l,this);if(i.endOfAnimation){c()}}};if(u){s.subscribe("sap.ui.vk","animationPlayStateChanged",l,this)}else{setTimeout(c,o)}}if(u){r.play()}};n.prototype._activateView=function(i,n,a,o,s,r){var u=e.getElementById(this.getAnimationPlayer());if(u){u.stop()}this._cancelPlayingViewGroup=false;var c=this;return new Promise(function(e,u){var l=t.getEventBus();c._activeView=i;var p=function(t,a,u){if(u.view!==i){return}l.unsubscribe("sap.ui.vk","readyForAnimation",p,c);if(!c._cancelPlayingViewGroup&&!o){c._play(i,n,s,r)}e({view:i})};l.subscribe("sap.ui.vk","readyForAnimation",p,c);l.publish("sap.ui.vk","activateView",{source:c,view:i,skipCameraTransitionAnimation:a,playViewGroup:s})})};return n});
//# sourceMappingURL=ViewManager.js.map