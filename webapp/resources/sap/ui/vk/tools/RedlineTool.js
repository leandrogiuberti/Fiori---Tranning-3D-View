/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.define(["sap/base/Log","./Tool","./RedlineToolHandler","./RedlineToolGizmo","../Redline","../RedlineElementRectangle","../RedlineElementEllipse","../RedlineElementFreehand","../RedlineElementLine","../RedlineElementText"],function(e,t,i,n,r,o,a,s,l,p){"use strict";var d=t.extend("sap.ui.vk.tools.RedlineTool",{metadata:{library:"sap.ui.vk",properties:{editable:{type:"boolean",defaultValue:true}},events:{elementCreated:{parameters:{element:"object"}},elementClicked:{parameters:{elementId:"string"}},elementHovered:{parameters:{elementId:"string"}}},aggregations:{redlineElements:{type:"sap.ui.vk.RedlineElement",multiple:true,forwarding:{getter:"getGizmo",aggregation:"redlineElements",forwardBinding:true}}}},constructor:function(e,n){if(d._instance){return d._instance}t.apply(this,arguments);this._viewport=null;this._handler=new i(this);d._instance=this;return this}});d.prototype.init=function(){if(t.prototype.init){t.prototype.init.call(this)}this.setFootprint(["sap.ui.vk.svg.Viewport","sap.ui.vk.threejs.Viewport","sap.ui.vk.dvl.Viewport","sap.ui.vk.NativeViewport","sap.ui.vk.pdf.Viewport"]);this.setAggregation("gizmo",new n)};d.prototype.exit=function(){d._instance=null};d.prototype.setActive=function(e,i,n){t.prototype.setActive.call(this,e,i,n);var r=this._viewport;if(r){if(e){if(r._activateRedline){r._activateRedline()}else if(r.getMetadata().getName()==="sap.ui.vk.threejs.Viewport"&&r._viewportGestureHandler){r._viewportGestureHandler._activateRedline()}r._redlineHandler=this._handler;this._handler._zoomFactor=1;this._gizmo=this.getGizmo();if(this._gizmo){this._gizmo.show()}this._addLocoHandler()}else{this._removeLocoHandler();if(this._gizmo){this._gizmo.hide();this._gizmo=null}delete r._redlineHandler;if(r._deactivateRedline){r._deactivateRedline()}else if(r.getMetadata().getName()==="sap.ui.vk.threejs.Viewport"&&r._viewportGestureHandler){r._viewportGestureHandler._deactivateRedline()}}}return this};var u={rectangle:o,ellipse:a,freehand:s,line:l,text:p};var m={rect:o,ellipse:a,path:s,line:l,text:p};d.prototype.startAdding=function(e){this.getGizmo()._startAdding(e);return this};d.prototype.stopAdding=function(){this.getGizmo()._stopAdding(false);return this};d.prototype.exportJSON=function(){return this.getGizmo().getRedlineElements().map(function(e){return e.exportJSON()})};d.prototype.importJSON=function(t){var i=this.getGizmo();t=Array.isArray(t)?t:[t];t.forEach(function(t){var n=u[t.type];if(n){i.addRedlineElement((new n).importJSON(t))}else{e.warning("Unsupported JSON element type "+t.type)}});i.rerender();return this};d.prototype.exportSVG=function(){var e=document.createElementNS(r.svgNamespace,"svg");this.getGizmo().getRedlineElements().map(function(t){e.appendChild(t.exportSVG())});return e};d.prototype.importSVG=function(t){var i=this.getGizmo();t.childNodes.forEach(function(t){if(t.getAttribute){var n=m[t.tagName];if(n){i.addRedlineElement((new n).importSVG(t))}else{e.warning("Unsupported SVG element type "+n)}}});i.rerender();return this};d.prototype.queueCommand=function(e){if(this._addLocoHandler()){if(this.isViewportType("sap.ui.vk.threejs.Viewport")||this.isViewportType("sap.ui.vk.NativeViewport")){e()}}return this};d.prototype.onElementClicked=function(e){this.fireElementClicked({elementId:e.getParameter("elementId")})};return d});
//# sourceMappingURL=RedlineTool.js.map