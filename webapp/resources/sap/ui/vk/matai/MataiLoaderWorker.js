/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
(function(){"use strict";console.log("MataiLoaderWorker started.");var e={calls:[],transferable:[],lastFlushTime:null};function t(t,i){var n=e.calls;n.push(t);if(Array.isArray(i)){i.forEach(function(t){e.transferable.push(t)})}if(n.length>=1e4){r()}else if(e.lastFlushTime==null){e.lastFlushTime=performance.now()}else{var o=performance.now();if(o-e.lastFlushTime>=500){r()}}}function r(){e.lastFlushTime=performance.now();var t=e.calls.splice(0);if(t.length>0){var r=e.transferable.splice(0);self.postMessage(t,r)}}function i(e){r();self.postMessage(e)}function n(e){this.sceneBuilderId=e}n.prototype.setScene=function(e){e.cameraId=e.cameraRef;t({sceneBuilderId:this.sceneBuilderId,method:"setScene",args:[e]})};function o(e){var t=[];for(var r in e){var i=r.indexOf("/");if(i>=0){var n=[];var o=e[r];if(o){for(var s in o){n.push({name:s,value:o[s]})}}t.push({source:r.substr(0,i),type:r.substr(i+1),fields:n})}}return t}n.prototype.createNode=function(e){const r=[e.transform.buffer];if(e.objectTransform){r.push(e.objectTransform.buffer)}e.parentId=e.parentRef;if(e.transformType===1){e.transformType="BILLBOARD_VIEW"}else if(e.transformType===257){e.transformType="LOCK_TOVIEWPORT"}e.sid=e.nodeRef;if(e.contentType===2){e.contentType="PMI"}else if(e.contentType===18){e.contentType="Hotspot"}else{e.contentType=undefined}if(e.veids){e.veids=o(e.veids)}t({sceneBuilderId:this.sceneBuilderId,method:"createNode",args:[e]},r)};n.prototype.createSubMesh=function(e){var r=[e.boundingBox.buffer];if(e.transform){r.push(e.transform.buffer)}t({sceneBuilderId:this.sceneBuilderId,method:"insertSubmesh",args:[{meshId:e.meshRef,materialId:e.materialRef,transform:e.transform,lods:[{id:e.geometryId,flags:e.flags,pointCount:e.pointCount,elementCount:e.elementCount,boundingBox:e.boundingBox}]}]},r)};n.prototype.createSubMeshes=function(e){const r=[];e.forEach(e=>{e.submeshes.forEach(e=>{r.push(e.lods[0].boundingBox.buffer);if(e.transform){r.push(e.transform.buffer)}})});t({sceneBuilderId:this.sceneBuilderId,method:"setSubmeshes",args:[e]},r)};n.prototype.setMeshGeometry=function(e){var r=[e.data.index.buffer,e.data.position.buffer];if(e.data.normal){r.push(e.data.normal.buffer)}if(e.data.uv){r.push(e.data.uv.buffer)}if(e.data.colors){r.push(e.data.colors.buffer)}t({sceneBuilderId:this.sceneBuilderId,method:"setGeometry",args:[{id:e.geometryId,isPolyline:(e.flags&1)>0,isPointCloud:(e.flags&32)>0,data:{indices:e.data.index,points:e.data.position,normals:e.data.normal,colors:e.data.colors,uvs:e.data.uv}}]},r)};n.prototype.insertMesh=function(e,r){t({sceneBuilderId:this.sceneBuilderId,method:"setMeshNode",args:[e,r]})};n.prototype.createTextAnnotation=function(e){e.coordinateSpace=0;e.nodeId=e.nodeRef;e.fontFace=e.font;e.shape=e.style;t({sceneBuilderId:this.sceneBuilderId,method:"createAnnotation",args:[e]})};n.prototype.createTextNote=function(e){e.coordinateSpace=2;e.nodeId=e.nodeRef;e.id=e.nodeRef;e.sid=e.targetNodeRef;e.fontFace=e.font;e.shape=e.style;t({sceneBuilderId:this.sceneBuilderId,method:"createAnnotation",args:[e]})};n.prototype.createImageNote=function(e){e.properlyAligned=true;e.nodeId=e.nodeRef;e.labelMaterialId=e.materialRef;t({sceneBuilderId:this.sceneBuilderId,method:"createImageNote",args:[e]})};n.prototype.insertLeaderLine=function(e){var r=[];for(var i=0;i<e.points.length;i+=3){var n=[e.points[i],e.points[i+1],e.points[i+2]];r.push(n)}e.points=r;e.annotationId=e.nodeRef;e.nodeId=e.nodeRef;e.startPointSid=e.targetNodeRef;e.materialId=e.materialRef;e.startPointHeadStyle=e.startPointStyle;e.endPointHeadStyle=e.endPointStyle;e.pointHeadConstant=e.styleConstant;t({sceneBuilderId:this.sceneBuilderId,method:"insertLeaderLine",args:[e]})};n.prototype.setParametricContent=function(e,r){r.materialID=r.materialID||undefined;var i=[];if(r.t){i.push(r.t.buffer)}if(r.r){i.push(r.r.buffer)}if(r.s){i.push(r.s.buffer)}if(r.segments){r.segments.forEach(function(e){if(e.points){i.push(e.points.buffer)}})}var n=r.lineStyle;if(n){if(n.colour){i.push(n.colour.buffer)}}var o=r.fillStyle;if(o){if(o.colour){i.push(o.colour.buffer)}if(o.start){i.push(o.start.buffer)}if(o.end){i.push(o.end.buffer)}if(o.radii){i.push(o.radii.buffer)}if(o.gradient){i.push(o.gradient.buffer)}if(o.gradientTransform){i.push(o.gradientTransform.buffer)}}t({sceneBuilderId:this.sceneBuilderId,method:"setParametricContent",args:[e,r]},i)};n.prototype.createCamera=function(e){e.ortho=e.projection==="orthographic";e.near=e.nearClip;e.far=e.farClip;e.fov=e.fov*Math.PI/180;e.zoom=e.orthoZoomFactor;e.id=e.cameraRef;var r=[e.origin.buffer,e.up.buffer,e.target.buffer];if(e.matrix){r.push(e.matrix.buffer)}e.notUseDirectionVector=true;t({sceneBuilderId:this.sceneBuilderId,method:"createCamera",args:[e]},r)};n.prototype.insertCamera=function(e,r){t({sceneBuilderId:this.sceneBuilderId,method:"insertCamera",args:[e,r]})};n.prototype.createViewportGroup=function(e){e.id=e.viewportGroupRef;if(e.veids){e.veids=o(e.veids)}t({sceneBuilderId:this.sceneBuilderId,method:"insertViewGroup",args:[e]})};n.prototype.finalizePlaybacks=function(e){e.viewGroupId=e.viewportGroupRef;t({sceneBuilderId:this.sceneBuilderId,method:"setAnimationPlaybacks",args:[e]})};n.prototype.insertModelView=function(e){e.viewGroupId=e.viewportGroupRef;e.viewId=e.modelViewRef;e.thumbnailId=e.thumbnail;e.cameraId=e.cameraRef;e.navigationMode=["NoChange","Orbit","NoChange","Turntable","Zoom","Pan"][e.navigationMode]||"NoChange";t({sceneBuilderId:this.sceneBuilderId,method:"insertView",args:[e]})};n.prototype.setModelViewVisibilitySet=function(e){e.viewId=e.modelViewRef;t({sceneBuilderId:this.sceneBuilderId,method:"setModelViewVisibilitySet",args:[e]})};n.prototype.insertModelViewHighlight=function(e){e.viewId=e.modelViewRef;t({sceneBuilderId:this.sceneBuilderId,method:"insertModelViewHighlight",args:[e]})};n.prototype.createThumbnail=function(e){e.imageId=e.imageRef;t({sceneBuilderId:this.sceneBuilderId,method:"createThumbnail",args:[e]})};n.prototype.createDetailView=function(e){e.nodeId=e.nodeRef;e.detailViewId=e.detailViewRef;e.cameraId=e.cameraRef;e.attachment=e.attachmentPoint;var r=[e.origin.buffer,e.size.buffer];if(e.attachment){r.push(e.attachment.buffer)}if(e.visibleNodes){r.push(e.visibleNodes.buffer)}if(e.targetNodes){r.push(e.targetNodes.buffer)}e.properlyAligned=true;t({sceneBuilderId:this.sceneBuilderId,method:"createDetailView",args:[e]},r)};n.prototype.createMaterial=function(e){e.id=e.materialRef;var r=[e.ambientColour.buffer,e.diffuseColour.buffer,e.specularColour.buffer,e.emissiveColour.buffer];if(e.lineColour&&e.lineDashPattern){r.push(e.lineColour.buffer,e.lineDashPattern.buffer)}if(e.textures){for(var i=0;i<e.textures.length;i++){var n=e.textures[i];var o="texture"+n.type.charAt(0).toUpperCase()+n.type.slice(1);e[o]={imageId:n.imageRef,matrix:n.matrix,uvHorizontalScale:n.scaleX,uvVerticalScale:n.scaleY,uvHorizontalOffset:n.offsetX,uvVerticalOffset:n.offsetY,uvRotationAngle:n.angle,influence:n.amount,filterMode:n.filterMode,uvHorizontalTilingEnabled:n.repeatX,uvVerticalTilingEnabled:n.repeatY,uvClampToBordersEnabled:n.clampToBorder,inverted:n.invert,modulate:n.modulate}}}t({sceneBuilderId:this.sceneBuilderId,method:"createMaterial",args:[e]},r)};n.prototype.createImage=function(e){e.id=e.imageRef;e.binaryData=e.data;t({sceneBuilderId:this.sceneBuilderId,method:"createImage",args:[e]},[e.binaryData.buffer])};n.prototype.progress=function(e){t({sceneBuilderId:this.sceneBuilderId,method:"progress",args:[e]})};n.prototype.insertThrustline=function(e){e.thrustlineId=e.thrustlineRef;e.materialId=e.material;t({sceneBuilderId:this.sceneBuilderId,method:"insertThrustline",args:[e]})};n.prototype.insertAnimationGroup=function(e){t({sceneBuilderId:this.sceneBuilderId,method:"insertAnimationGroup",args:[e]})};n.prototype.insertAnimation=function(e){t({sceneBuilderId:this.sceneBuilderId,method:"insertAnimation",args:[e]})};n.prototype.insertAnimationTarget=function(e){t({sceneBuilderId:this.sceneBuilderId,method:"insertAnimationTarget",args:[e]})};n.prototype.insertAnimationTrack=function(e){t({sceneBuilderId:this.sceneBuilderId,method:"insertAnimationTrack",args:[e]})};n.prototype.finalizeAnimation=function(e){t({sceneBuilderId:this.sceneBuilderId,method:"setAnimationTracks",args:[e]})};n.prototype.requestReferencedFile=function(e){i({sceneBuilderId:this.sceneBuilderId,event:"referencedFileRequested",fileName:e.FileName,veId:e.VEID,veVersion:e.VEVersion})};var s=new Map;self.onmessage=function(e){const{method:t,args:r}=e.data;switch(t){case"createRuntime":console.log("MataiLoaderWorker starting runtime.");sap.ve.matai.createRuntime({prefixURL:r.scriptDirectory}).then(function(e){console.log("MataiLoaderWorker runtime created.");self.matai=e;self.postMessage({event:"runtimeCreated"})});break;case"createContext":{const e=new n(r.sceneBuilderId);const t=new Map;const o={sceneBuilder:e,files:t};const a=`${t.size}.vds`;t.set(r.fileName,a);s.set(r.sceneBuilderId,o);const d=self.matai.createContext(e,r.buffer,a,r.locale,"");i({event:"contextCreated",sceneBuilderId:r.sceneBuilderId,result:d});break}case"destroyContext":{const{sceneBuilder:e}=s.get(r.sceneBuilderId);s.delete(r.sceneBuilderId);self.matai.destroyContext(e);break}case"loadFile":{const{sceneBuilder:e}=s.get(r.sceneBuilderId);const t=self.matai.loadFile(e);i({event:"fileLoaded",sceneBuilderId:r.sceneBuilderId,result:t});break}case"loadReferencedFile":{const{sceneBuilder:e,files:t}=s.get(r.sceneBuilderId);const n=`${t.size}.vds`;t.set(r.fileName,n);const o=self.matai.loadReferencedFile(e,r.buffer,n,r.veId,r.veVersion);i({event:"referencedFileLoaded",sceneBuilderId:r.sceneBuilderId,fileName:r.fileName,result:o});break}case"buildScene":{const{sceneBuilder:e}=s.get(r.sceneBuilderId);const t=self.matai.buildScene(e);i({sceneBuilderId:r.sceneBuilderId,event:"sceneBuilt",result:t});break}default:{break}}};console.log("MataiLoaderWorker initialized.")})();
//# sourceMappingURL=MataiLoaderWorker.js.map