/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.define(["./library","sap/ui/core/Core","sap/ui/core/Control","sap/ui/model/json/JSONModel","./Scene","./ContentResource","./ContentConnector","./dvl/ContentManager","./FlexibleControl","sap/m/VBox","sap/m/FlexItemData","sap/ui/layout/Splitter","sap/ui/layout/SplitterLayoutData","./DvlException","./Messages","sap/m/ProgressIndicator","./Notifications","./ViewStateManager","./Toolbar","./SceneTree","./StepNavigation","./ViewGallery","./ViewManager","./AnimationPlayer","./Viewport","./NativeViewport","./RedlineDesign","./SelectionMode","./DrawerToolbar","./pdf/PageGallery","./ecad/LayersPanel","./ecad/ElementsPanel","./getResourceBundle","./cssColorToColor","./colorToCSSColor","./abgrToColor","./colorToABGR","sap/base/Log","sap/base/i18n/Localization","sap/ui/core/StaticArea"],function(e,t,i,n,s,a,o,r,l,p,h,u,c,d,g,_,y,v,b,f,m,w,C,S,P,V,T,E,M,A,I,R,N,G,D,k,L,x,B,H){"use strict";var z=i.extend("sap.ui.vk.Viewer",{metadata:{library:"sap.ui.vk",properties:{enableSceneTree:{type:"boolean",defaultValue:true},showSceneTree:{type:"boolean",defaultValue:true},enableStepNavigation:{type:"boolean",defaultValue:true},enableNotifications:{type:"boolean",defaultValue:true},showStepNavigation:{type:"boolean",defaultValue:false},showStepNavigationThumbnails:{type:"boolean",defaultValue:true},overlayStepNavigation:{type:"boolean",defaultValue:false},enableLayersPanel:{type:"boolean",defaultValue:true},showLayersPanel:{type:"boolean",defaultValue:true},enableElementsPanel:{type:"boolean",defaultValue:true},showElementsPanel:{type:"boolean",defaultValue:true},enablePageGallery:{type:"boolean",defaultValue:true},showPageGallery:{type:"boolean",defaultValue:true},enableToolbar:{type:"boolean",defaultValue:true},enableProgressIndicator:{type:"boolean",defaultValue:true},showDrawerToolbar:{type:"boolean",defaultValue:true},enableMiniMap:{type:"boolean",defaultValue:true},showMiniMap:{type:"boolean",defaultValue:false},width:{type:"sap.ui.core.CSSSize",defaultValue:null},height:{type:"sap.ui.core.CSSSize",defaultValue:null},toolbarTitle:{type:"string",defaultValue:""},shouldTrackVisibilityChanges:{type:"boolean",defaultValue:false},recursiveSelection:{type:"boolean",defaultValue:false},runtimeSettings:{type:"object",defaultValue:{}},webGLContextAttributes:{type:"object",defaultValue:{antialias:true,alpha:true,premultipliedAlpha:false}},hotspotsEnabled:{type:"boolean",defaultValue:true},showAllHotspots:{type:"boolean",defaultValue:false},hotspotColorABGR:{type:"int",defaultValue:1493172411},hotspotColor:{type:"sap.ui.core.CSSColor",defaultValue:"rgba(89, 0, 0, 0.73)"}},aggregations:{contentResources:{type:"sap.ui.vk.ContentResource",forwarding:{getter:"_getContentConnector",aggregation:"contentResources"}},progressIndicator:{type:"sap.m.ProgressIndicator",multiple:false,visibility:"hidden"},layout:{type:"sap.m.VBox",multiple:false,visibility:"hidden"},contentConnector:{type:"sap.ui.vk.ContentConnector",multiple:false,visibility:"hidden"},viewStateManager:{type:"sap.ui.vk.ViewStateManager",multiple:false,visibility:"hidden"}},defaultAggregation:"contentResources",events:{contentResourceChangesProcessed:{},sceneLoadingSucceeded:{parameters:{scene:{type:"sap.ui.vk.Scene"}}},sceneLoadingFailed:{parameters:{reason:{type:"object"}}},sceneDestroying:{parameters:{scene:{type:"sap.ui.vk.Scene"},preventGarbageCollection:{type:"function"}}},selectionChanged:{parameters:{selected:{type:"any[]"},unselected:{type:"any[]"}}},fullScreen:{parameters:{isFullScreen:{type:"boolean"}}},urlClicked:{parameters:{nodeRef:"any",url:"string"}},nodeClicked:{parameters:{nodeRef:"any",x:"int",y:"int"}}}},renderer:{apiVersion:2,render:function(e,t){e.openStart("div",t);e.class("sapVizKitViewer");if(t.getWidth()){e.style("width",t.getWidth())}if(t.getHeight()){e.style("height",t.getHeight())}e.openEnd();e.renderControl(t._layout);e.renderControl(t._progressIndicator);e.close("div")}},constructor:function(e,t){i.apply(this,arguments);Object.assign(this._data,{sceneTree:{supported:false,enabled:this.getEnableSceneTree(),visible:this.getShowSceneTree()},stepNavigation:{supported:false,enabled:this.getEnableStepNavigation(),visible:this.getShowStepNavigation()},layersPanel:{supported:false,enabled:this.getEnableLayersPanel(),visible:this.getShowLayersPanel()},elementsPanel:{supported:false,enabled:this.getEnableElementsPanel(),visible:this.getShowElementsPanel()},pageGallery:{supported:false,enabled:this.getEnablePageGallery(),visible:this.getShowPageGallery(),currentPageIndex:0},miniMap:{supported:false,enabled:this.getEnableMiniMap(),visible:this.getShowMiniMap()},toolbar:{title:this.getToolbarTitle(),enabled:this.getEnableToolbar()},drawerToolbar:{visible:this.getShowDrawerToolbar()},hotspots:{supported:false,enabled:this.getHotspotsEnabled(),showAll:this.getShowAllHotspots(),colorABGR:this.getHotspotColorABGR(),color:this.getHotspotColor()},shouldTrackVisibilityChanges:this.getShouldTrackVisibilityChanges(),recursiveSelection:this.getRecursiveSelection()})}});z.prototype.applySettings=function(e){this._inApplySettings=true;i.prototype.applySettings.apply(this,arguments);delete this._inApplySettings};z.prototype.init=function(){if(i.prototype.init){i.prototype.init.apply(this)}this._contentConnector=new o(this.getId()+"-contentconnector");this.setAggregation("contentConnector",this._contentConnector);this._contentConnector.attachContentReplaced(this._handleContentReplaced,this);this._contentConnector.attachContentChangesStarted(this._handleContentChangesStarted,this);this._contentConnector.attachContentChangesFinished(this._handleContentChangesFinished,this);this._contentConnector.attachContentChangesProgress(this._handleContentChangesProgress,this);this._data={sceneTree:{},stepNavigation:{},layersPanel:{},elementsPanel:{},pageGallery:{},miniMap:{},toolbar:{},drawerToolbar:{},hotspots:{}};this._model=new n(this._data);this._model.attachPropertyChange(function(e){const t=e.getParameter("value");switch(e.getParameter("path")){case"/sceneTree/visible":this.setShowSceneTree(t);break;case"/stepNavigation/visible":this.setShowStepNavigation(t);break;case"/layersPanel/visible":this.setShowLayersPanel(t);break;case"/elementsPanel/visible":this.setShowElementsPanel(t);break;case"/pageGallery/visible":this.setShowPageGallery(t);break;case"/miniMap/visible":this.setShowMiniMap(t);break;case"/hotspots/showAll":this.setShowAllHotspots(t);break;case"/hotspots/colorABGR":this.setHotspotColorABGR(t);break;case"/hotspots/color":this.setHotspotColor(t);break;default:break}},this);this.setModel(this._model,"_internal");this._viewStateManager=new v(this.getId()+"-viewstatemanager",{shouldTrackVisibilityChanges:"{_internal>/shouldTrackVisibilityChanges}",recursiveSelection:"{_internal>/recursiveSelection}",contentConnector:this._contentConnector});this.setAggregation("viewStateManager",this._viewStateManager);x.debug("sap.ui.vk.Viewer.init() called.");this._animationPlayer=new S({viewStateManager:this._viewStateManager});this._viewManager=new C({contentConnector:this._contentConnector,animationPlayer:this._animationPlayer});this._viewStateManager.setViewManager(this._viewManager);this._mainScene=null;this._busyIndicatorCounter=0;this._viewport=null;this._nativeViewport=null;this._redlineDesign=null;this._stepNavigation=null;this._sceneTree=null;this._drawerToolbar=null;this._pageGallery=null;this._layersPanel=null;this._elementsPanel=null;this._staticAreaParent=null;this._staticAreaNextSibling=null;this.attachBrowserEvent("fullscreenchange",this._handleFullscreenChange,this);this._toolbar=new b({title:"{_internal>/toolbar/title}",visible:"{_internal>/toolbar/enabled}",viewer:this});this._stackedViewport=new l(this.getId()+"-stackedViewport",{width:"100%",height:"100%",layout:"Stacked",layoutData:new c({size:"auto",minSize:200})});this._splitter=new u(this.getId()+"-splitter",{layoutData:new h({growFactor:1,minHeight:"200px"}),contentAreas:[this._stackedViewport]}).addStyleClass("sapUiVizKitSplitter");this._messagePopover=new y(`${this.getId()}-notifications`,{visible:true});this._messagePopover.attachAllMessagesCleared(this._updateLayout,this);this._messagePopover.attachMessageAdded(this._updateLayout,this);this._layout=new p(this.getId()+"-vbox",{height:"100%",items:[this._toolbar,this._splitter,this._messagePopover]}).addStyleClass("sapUiVizKitLayout");this.setAggregation("layout",this._layout);this.setTooltip(N().getText("VIEWER_TITLE"));if(this.getEnableProgressIndicator()){this._progressIndicator=new _({displayAnimation:false,displayOnly:true,visible:false}).addStyleClass("sapUiVizKitProgressIndicator");this.setAggregation("progressIndicator",this._progressIndicator)}B.attachChange(this._onLocalizationChanged)};z.prototype.exit=function(){x.debug("sap.ui.vk.Viewer.exit() called.");B.detachChange(this._onLocalizationChanged);this._viewport?.destroy();this._viewport=null;this._nativeViewport?.destroy();this._nativeViewport=null;this._setMainScene(null);this._toolbar=null;this._messagePopover=null;this._sceneTree=null;this._stepNavigation=null;this._drawerToolbar=null;this._componentsState=null;this._viewStateManager=null;this._contentConnector=null;this._viewManager=null;this._model=null;this._staticAreaParent=null;this._staticAreaNextSibling=null;this.detachBrowserEvent("fullscreenchange",this._handleFullscreenChange,this);if(i.prototype.exit){i.prototype.exit.apply(this)}};z.prototype._handleFullscreenChange=function(e){const t=this.getDomRef();if(e.target===this.getDomRef()||this._staticAreaParent!=null){const i=H.getDomRef();if(i==null){return}if(document.fullscreenElement===this.getDomRef()){this._staticAreaParent=i.parentElement;this._staticAreaNextSibling=i.nextSibling;t.insertBefore(i,t.firstChild);this._toolbar._enterFullScreenButton.setTooltip(N().getText("EXIT_FULLSCREEN"));e.stopImmediatePropagation()}else if(this._staticAreaParent!=null){this._staticAreaParent.insertBefore(i,this._staticAreaNextSibling);this._staticAreaParent=this._staticAreaNextSibling=null;this._toolbar._enterFullScreenButton.setTooltip(N().getText("ENTER_FULLSCREEN"));if(document.fullscreenElement!=null){e.stopImmediatePropagation()}}}};z.prototype._setMainScene=function(e){this._sceneTree?.destroy();this._sceneTree=null;if(this._stepNavigation){this._layout.removeItem(this._stepNavigation);this._viewport?.removeContent(this._stepNavigation);this._stepNavigation.destroy();this._stepNavigation=null}this._layersPanel?.destroy();this._layersPanel=null;this._elementsPanel?.destroy();this._elementsPanel=null;this._pageGallery?.destroy();this._pageGallery=null;this._mainScene=e instanceof s?e:null;const t=e?.getMetadata?.().getName()==="sap.ui.vk.svg.Scene";const i=t&&e.isECADScene();const n=e?.isA?.("sap.ui.vk.pdf.Document");const a=this._data;a.sceneTree.supported=a.stepNavigation.supported=e instanceof s&&!i;a.layersPanel.supported=a.elementsPanel.supported=i;a.hotspots.supported=t&&!i;a.miniMap.supported=t;a.pageGallery.supported=n;this._model?.updateBindings();if(this._mainScene){if(a.sceneTree.supported&&a.sceneTree.enabled){this._sceneTree=new f({layoutData:new c({size:"320px",minSize:200}),viewStateManager:this._viewStateManager,contentConnector:this._contentConnector})}if(a.stepNavigation.supported&&a.stepNavigation.enabled){this._instantiateStepNavigation()}if(a.layersPanel.supported&&a.layersPanel.enabled){this._layersPanel=new I({layoutData:new c({size:"320px",minSize:200}),contentConnector:this._contentConnector,viewStateManager:this._viewStateManager})}if(a.elementsPanel.supported&&a.elementsPanel.enabled){this._elementsPanel=new R({contentConnector:this._contentConnector,viewStateManager:this._viewStateManager,layoutData:new c({size:"320px",minSize:200})})}}if(a.pageGallery.supported){a.pageGallery.currentPageIndex=0;this._pageGallery=new A({layoutData:new c({size:"320px",minSize:200}),contentConnector:this._contentConnector,currentPageIndex:"{_internal>/pageGallery/currentPageIndex}"})}return this};z.prototype.getGraphicsCore=function(){return this._mainScene instanceof e.dvl.Scene?this._mainScene.getGraphicsCore():null};z.prototype.getScene=function(){return this._mainScene};z.prototype.getViewStateManager=function(){return this._viewStateManager};z.prototype.getViewport=function(){if(!this._viewport){this._viewport=new P(this.getId()+"-viewport",{viewStateManager:this._viewStateManager,selectionMode:E.Exclusive,contentConnector:this._contentConnector,showAllHotspots:"{_internal>/hotspots/showAll}",hotspotColorABGR:"{_internal>/hotspots/colorABGR}",hotspotColor:"{_internal>/hotspots/color}"});this._drawerToolbar=new M({visible:"{_internal>/drawerToolbar/visible}",expanded:true,viewport:this._viewport});this._viewport.addContent(this._drawerToolbar)}return this._viewport};z.prototype.getNativeViewport=function(){if(this._nativeViewport){return this._nativeViewport}var t=this.getViewport().getImplementation();return t instanceof e.NativeViewport?t:null};z.prototype.getToolbar=function(){return this._toolbar};z.prototype.getSceneTree=function(){return this._sceneTree};z.prototype.getRedlineDesign=function(){return this._redlineDesign};z.prototype.setEnableSceneTree=function(e){this.setProperty("enableSceneTree",e,true);this._data.sceneTree.enabled=e;this._model.updateBindings();return this};z.prototype.setShowSceneTree=function(e){this.setProperty("showSceneTree",e,true);this._data.sceneTree.visible=e;this._model.updateBindings();this._updateLayout();return this};z.prototype.setEnableStepNavigation=function(e){this.setProperty("enableStepNavigation",e,true);this._data.stepNavigation.enabled=e;this._model.updateBindings();return this};z.prototype.setShowStepNavigation=function(e){this.setProperty("showStepNavigation",e,true);this._data.stepNavigation.visible=e;this._model.updateBindings();return this};z.prototype.setEnableLayersPanel=function(e){this.setProperty("enableLayersPanel",e,true);this._data.layersPanel.enabled=e;this._model.updateBindings();return this};z.prototype.setShowLayersPanel=function(e){this.setProperty("showLayersPanel",e,true);this._data.layersPanel.visible=e;this._model.updateBindings();this._updateLayout();return this};z.prototype.setEnableElementsPanel=function(e){this.setProperty("enableElementsPanel",e,true);this._data.elementsPanel.enabled=e;this._model.updateBindings();return this};z.prototype.setShowElementsPanel=function(e){this.setProperty("showElementsPanel",e,true);this._data.elementsPanel.visible=e;this._model.updateBindings();this._updateLayout();return this};z.prototype.setEnablePageGallery=function(e){this.setProperty("enablePageGallery",e,true);this._data.pageGallery.enabled=e;this._model.updateBindings();return this};z.prototype.setShowPageGallery=function(e){this.setProperty("showPageGallery",e,true);this._data.pageGallery.visible=e;this._model.updateBindings();this._updateLayout();return this};z.prototype.setEnableMiniMap=function(e){this.setProperty("enableMiniMap",e,true);this._data.miniMap.enabled=e;this._model.updateBindings();this._updateLayout();return this};z.prototype.setShowMiniMap=function(e){this.setProperty("showMiniMap",e,true);this._data.miniMap.visible=e;this._model.updateBindings();this._updateLayout();return this};z.prototype.setToolbarTitle=function(e){this.setProperty("toolbarTitle",e,true);this._data.toolbar.title=e;this._model.updateBindings();return this};z.prototype.setEnableToolbar=function(e){this.setProperty("enableToolbar",e,true);this._data.toolbar.enabled=e;this._model.updateBindings();return this};z.prototype.setShowDrawerToolbar=function(e){this.setProperty("showDrawerToolbar",e,true);this._data.drawerToolbar.visible=e;this._model.updateBindings();return this};z.prototype.setHotspotsEnabled=function(e){this.setProperty("hotspotsEnabled",e,true);this._data.hotspots.enabled=e;this._model.updateBindings();return this};z.prototype.setShowAllHotspots=function(e){this.setProperty("showAllHotspots",e,true);this._data.hotspots.showAll=e;this._model.updateBindings();return this};z.prototype._setHotspotColor=function(e,t){this.setProperty("hotspotColorABGR",e,true);this.setProperty("hotspotColor",t,true);this._data.hotspots.colorABGR=e;this._data.hotspots.color=t;this._model.updateBindings();return this};z.prototype.setHotspotColorABGR=function(e){return this._setHotspotColor(e,D(k(e)))};z.prototype.setHotspotColor=function(e){return this._setHotspotColor(L(G(e)),e)};z.prototype.setShouldTrackVisibilityChanges=function(e){this.setProperty("shouldTrackVisibilityChanges",e,true);this._data.shouldTrackVisibilityChanges=e;this._model.updateBindings();return this};z.prototype.setRecursiveSelection=function(e){this.setProperty("recursiveSelection",e,true);this._data.recursiveSelection=e;this._model.updateBindings();return this};z.prototype.setEnableNotifications=function(e){this.setProperty("enableNotifications",e,true);this._messagePopover.setVisible(false);this._updateLayout();return this};z.prototype.activateFullScreenMode=function(){const e=this.getDomRef();if(document.fullscreenElement===e){document.exitFullscreen()}else{e.requestFullscreen()}return this};z.prototype.setRuntimeSettings=function(e){if(this._inApplySettings){this.setProperty("runtimeSettings",e,true);r.setRuntimeSettings(e)}else{x.error(N().getText(g.VIT29.summary),g.VIT29.code,"sap.ui.vk.Viewer")}return this};z.prototype.setWebGLContextAttributes=function(e){if(this._inApplySettings){this.setProperty("webGLContextAttributes",e,true);r.setWebGLContextAttributes(e)}else{x.error(N().getText(g.VIT30.summary),g.VIT30.code,"sap.ui.vk.Viewer")}return this};z.prototype.invalidate=function(e){if(e instanceof a){this._contentConnector.invalidate(e);return}i.prototype.invalidate.apply(this,arguments)};z.prototype._getContentConnector=function(){return this._contentConnector};z.prototype.isTreeBinding=function(e){return e==="contentResources"};z.prototype.setBusy=function(e){if(e){if(this._busyIndicatorCounter===0){this.setBusyIndicatorDelay(0);i.prototype.setBusy.call(this,true)}this._busyIndicatorCounter+=1}else{this._busyIndicatorCounter-=1;if(this._busyIndicatorCounter==0){i.prototype.setBusy.call(this,false)}}};z.prototype._setSplitterContent=function(e,t,i){if(e){e.setVisible(t);if(t){if(this._splitter.indexOfContentArea(e)<0){this._splitter.insertContentArea(e,i?this._splitter.getContentAreas().length:0)}}else if(this._splitter.indexOfContentArea(e)>=0){this._splitter.removeContentArea(e)}}};z.prototype._updateLayout=function(){const e=this._data;this._setSplitterContent(this._sceneTree,e.sceneTree.visible&&e.sceneTree.enabled);this._setSplitterContent(this._layersPanel,e.layersPanel.visible&&e.layersPanel.enabled);this._setSplitterContent(this._elementsPanel,e.elementsPanel.visible&&e.elementsPanel.enabled,true);this._setSplitterContent(this._pageGallery,e.pageGallery.visible&&e.pageGallery.enabled);this._messagePopover?.setVisible(this.getEnableNotifications()&&this._messagePopover.getAggregation("_messagePopover").getItems().length>0);if(e.miniMap.supported&&this._viewport?.getImplementation()?.getMetadata().getName()==="sap.ui.vk.svg.Viewport"){this._viewport.getImplementation().getMiniMap()[e.miniMap.visible&&e.miniMap.enabled?"open":"close"]()}};z.prototype._instantiateStepNavigation=function(){var e=this._mainScene.getMetadata().getName();if(e==="sap.ui.vk.dvl.Scene"){this._stepNavigation=new m({visible:"{_internal>/stepNavigation/visible}",showThumbnails:this.getShowStepNavigationThumbnails(),contentConnector:this._contentConnector});this._layout.insertItem(this._stepNavigation,3)}if(this._stepNavigation==null&&(e==="sap.ui.vk.threejs.Scene"||e==="sap.ui.vk.svg.Scene")){this._stepNavigation=new w({visible:"{_internal>/stepNavigation/visible}",host:this.getViewport(),contentConnector:this._contentConnector,viewManager:this._viewManager,animationPlayer:this._animationPlayer});if(!this.getOverlayStepNavigation()){this._layout.insertItem(this._stepNavigation,3)}else{this._stepNavigation.addStyleClass("sapVizKitViewGallery");this._viewport.addContent(this._stepNavigation)}}return this};z.prototype._showViewport=function(){const e=this.getViewport();this._nativeViewport?.setVisible(false);this._stackedViewport.removeAllContent();this._stackedViewport.addContent(e);e.setVisible(true);return this};z.prototype._showNativeViewport=function(){if(!this._nativeViewport){this._nativeViewport=new V(this.getId()+"-nativeViewport",{limitZoomOut:true,contentConnector:this._contentConnector})}this._viewport?.setVisible(false);this._stackedViewport.removeAllContent();this._stackedViewport.addContent(this._nativeViewport);this._nativeViewport.setVisible(true);return this};z.prototype.setDecryptionHandler=function(e){this._contentConnector.setDecryptionHandler(e);return this};z.prototype.setAuthorizationHandler=function(e){this._contentConnector.setAuthorizationHandler(e);return this};z.prototype.setConsumptionScenario=function(e){this._contentConnector.setConsumptionScenario(e);return this};z.prototype._instantiateRedlineDesign=function(e){var t=this.getViewport().getImplementation();if(t&&t.getVisible()){var i=t&&t.getVisible()?t:null;var n=i.getOutputSize();this._redlineDesign=new T({visible:false,virtualTop:n.top,virtualLeft:n.left,virtualSideLength:n.sideLength,redlineElements:e});this._redlineDesign._setTargetViewport(i)}return this};z.prototype.activateRedlineDesign=function(t){var i=this.getViewport().getImplementation();if(i._activateRedline){i._activateRedline()}else if(i instanceof e.threejs.Viewport){i._viewportGestureHandler._activateRedline()}t=t||[];this._instantiateRedlineDesign(t);this.getRedlineDesign().placeAt(this._stackedViewport);this.getRedlineDesign().setVisible(true);var n=function(e){var t=e.getParameter("deltaX"),n=e.getParameter("deltaY");i.queueCommand(function(){i.pan(t,n);i.endGesture()})};var s=function(e){var t=e.getParameter("originX"),n=e.getParameter("originY"),s=e.getParameter("zoomFactor");i.queueCommand(function(){i.beginGesture(t,n);i.zoom(s);i.endGesture()})};var a=function(e){var t=e.getParameter("deltaX"),n=e.getParameter("deltaY");i.queueCommand(function(){i._viewportGestureHandler._cameraController.beginGesture(t,n);i._viewportGestureHandler._cameraController.pan(t,n);i._viewportGestureHandler._cameraController.endGesture()})};var o=function(e){var t=e.getParameter("originX"),n=e.getParameter("originY"),s=e.getParameter("zoomFactor");i.queueCommand(function(){i._viewportGestureHandler._cameraController.beginGesture(t,n);i._viewportGestureHandler._cameraController.zoom(s);i._viewportGestureHandler._cameraController.endGesture()})};if((i instanceof e.NativeViewport||i instanceof e.dvl.Viewport)&&i.getVisible()){this.getRedlineDesign().attachEvent("pan",n.bind(this));this.getRedlineDesign().attachEvent("zoom",s.bind(this))}else if(i instanceof e.threejs.Viewport&&i.getVisible()){this.getRedlineDesign().attachEvent("pan",a.bind(this));this.getRedlineDesign().attachEvent("zoom",o.bind(this))}else{x.error("Error: Viewport not supported")}return this};z.prototype.destroyRedlineDesign=function(){if(this.getRedlineDesign()){var t=this.getViewport().getImplementation();if(t._deactivateRedline){t._deactivateRedline()}else if(t instanceof e.threejs.Viewport){t._viewportGestureHandler._deactivateRedline()}this.getRedlineDesign().destroy();this._redlineDesign=null}return this};z.prototype._removeProgressIndicator=function(){this._progressIndicator.setVisible(false);this._progressIndicator.setDisplayValue("");this._progressIndicator.setPercentValue(0);this._progressIndicator.rerender()};z.prototype._handleContentReplaced=function(e){var t=e.getParameter("newContent");if(t instanceof s||t instanceof HTMLImageElement||t instanceof HTMLObjectElement||t?.isA?.("sap.ui.vk.pdf.Document")){this._showViewport();if(this.getRedlineDesign()){this.getRedlineDesign().updatePanningRatio()}this._setMainScene(t)}else{this._setMainScene(null);if(this._viewport){this._viewport.setVisible(false)}if(this._nativeViewport){this._nativeViewport.setVisible(false)}this._stackedViewport.removeAllContent()}};z.prototype._handleContentChangesStarted=function(e){this.setBusy(true);if(this.getEnableProgressIndicator()){this._progressIndicator.setPercentValue(0);this._progressIndicator.setVisible(true);this._progressIndicator.rerender()}};z.prototype._handleContentChangesFinished=function(e){x.info("Finished");this.setBusy(false);var t=e.getParameter("content");if(t){if(this._pageGallery){const e=this._viewport.getImplementation();if(e?.getMetadata().getName()==="sap.ui.vk.pdf.Viewport"){e.bindProperty("currentPageIndex","_internal>/pageGallery/currentPageIndex")}}this.fireSceneLoadingSucceeded({scene:t})}var i=e.getParameter("failureReason");if(i){this.fireSceneLoadingFailed({reason:i});this._showNativeViewport();var n=N().getText("VIEWER_UNKNOWN_CONTENT_RESOURCE_TYPE_CAUSE");if(i.errorMessage===n){this._nativeViewport.loadFailed()}else{var s=N().getText("VIEWPORT_MESSAGEERRORLOADINGFILE");this._nativeViewport.loadFailed(s)}(Array.isArray(i)?i:[i]).forEach(function(e){x.error(N().getText(g.VIT13.summary),e.errorMessage,"sap.ui.vk.Viewer")})}if(i||this._progressIndicator.getPercentValue()===0){this._removeProgressIndicator()}this.fireContentResourceChangesProcessed();this._updateLayout()};var F=N().getText("PROGRESS_INDICATOR_TOTAL_PERCENT_DONE");z.prototype._handleContentChangesProgress=function(e){if(!this._progressIndicator.getVisible()){return}var t=e.getParameter("percentage");var i=e.getParameter("phase");this._progressIndicator.setPercentValue(t);this._progressIndicator.setDisplayValue(i+" / "+F+": "+(t?Math.floor(t)+"%":""));if(t>=100){this._removeProgressIndicator()}else{this._progressIndicator.rerender()}};z.prototype._handleContentDestroying=function(e){this.fireSceneDestroying({scene:e.getParameter("content").scene,preventGarbageCollection:e.getParameter("preventGarbageCollection")})};z.prototype._onLocalizationChanged=function(e){F=N().getText("PROGRESS_INDICATOR_TOTAL_PERCENT_DONE")};return z});
//# sourceMappingURL=Viewer.js.map