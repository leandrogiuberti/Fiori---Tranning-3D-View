//@ui5-bundle sap/ui/vk/library-preload.js
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/AnimationInterpolationType", ["sap/ui/base/DataType"],function(e){"use strict";var i={Discrete:"Discrete",Cubic:"Cubic",Linear:"Linear"};e.registerEnum("sap.ui.vk.AnimationInterpolationType",i);return i});
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/AnimationMath", ["sap/base/Log","./glMatrix","./AnimationTrackType","./AnimationTrackValueType"],function(a,t,e,r){"use strict";var i="sap.ui.vk.AnimationMath";var n={};n.clamp11=function(a){return Math.max(-1,Math.min(1,a))};n.neutralAngleAxisToGlMatrixQuat=function(a){return t.quat.setAxisAngle(t.quat.create(),t.vec3.fromValues(a[0],a[1],a[2]),a[3])};n.neutralEulerToGlMatrixQuat=function(a){var e=1,r=1,i=1,n=1;switch(a[3]){case 6:r=-1;n=-1;break;case 18:r=-1;i=-1;break;case 33:e=-1;n=-1;break;case 36:e=-1;i=-1;break;case 24:i=-1;n=-1;break;case 9:e=-1;r=-1;break;default:}var l=a[0];var u=a[1];var s=a[2];var o=Math.cos(l/2);var v=Math.sin(l/2);var c=Math.cos(u/2);var h=Math.sin(u/2);var M=Math.cos(s/2);var f=Math.sin(s/2);var m=v*c*M+e*o*h*f;var b=o*h*M+r*v*c*f;var p=o*c*f+i*v*h*M;var k=o*c*M+n*v*h*f;return t.quat.fromValues(m,b,p,k)};n.threeQuatToNeutralEuler=function(a,e){var r=t.mat4.fromQuat(t.mat4.create(),t.quat.fromValues(a.x,a.y,a.z,a.w));var i=r[0],l=r[4],u=r[8];var s=r[1],o=r[5],v=r[9];var c=r[2],h=r[6],M=r[10];var f=0,m=0,b=0;var p=.9999999;switch(e){case 6:m=Math.asin(n.clamp11(u));if(Math.abs(u)<p){f=Math.atan2(-v,M);b=Math.atan2(-l,i)}else{f=Math.atan2(h,o)}break;case 18:f=Math.asin(-n.clamp11(v));if(Math.abs(v)<p){m=Math.atan2(u,M);b=Math.atan2(s,o)}else{m=Math.atan2(-c,i)}break;case 33:f=Math.asin(n.clamp11(h));if(Math.abs(h)<p){m=Math.atan2(-c,M);b=Math.atan2(-l,o)}else{b=Math.atan2(s,i)}break;case 36:m=Math.asin(-n.clamp11(c));if(Math.abs(c)<p){f=Math.atan2(h,M);b=Math.atan2(s,i)}else{b=Math.atan2(-l,o)}break;case 24:b=Math.asin(n.clamp11(s));if(Math.abs(s)<p){f=Math.atan2(-v,o);m=Math.atan2(-c,i)}else{m=Math.atan2(u,M)}break;case 9:b=Math.asin(-n.clamp11(l));if(Math.abs(l)<p){f=Math.atan2(h,o);m=Math.atan2(u,i)}else{f=Math.atan2(-v,M)}break;default:}var k=[f,m,b,e];return k};n.neutralQuatToGlMatrixQuat=function(a){return t.quat.fromValues(a[0],a[1],a[2],a[3])};n.glMatrixQuatToNeutral=function(a){return[a[0],a[1],a[2],a[3]]};n.getModulatedAngularValue=function(a){return a-a%(2*Math.PI)};n.equalMatrices=function(a,t,e){for(var r=0;r<a.elements.length;r++){if(Math.abs(a.elements[r]-t.elements[r])>e){return false}}return true};n.interpolate=function(){var l=t.quat;var u=t.vec3;var s=l.create();var o=l.create();var v=u.create();return function(c,h,M,f,m,b,p){var k=h.value;var g=M.value;var T={};var A;var d;var x;var y=1e-4;switch(c){case r.Quaternion:A=n.neutralQuatToGlMatrixQuat(k);d=n.neutralQuatToGlMatrixQuat(g);x=t.quat.slerp(t.quat.create(),A,d,f);if(p!=null){x=t.quat.multiply(t.quat.create(),x,t.quat.invert(t.quat.create(),n.neutralQuatToGlMatrixQuat(p)))}T.value=n.glMatrixQuatToNeutral(x);break;case r.Euler:var Q=[n.interpolateScalarLinear(k[0],g[0],f),n.interpolateScalarLinear(k[1],g[1],f),n.interpolateScalarLinear(k[2],g[2],f),k[3]];if(p!=null){Q[0]-=p[0];Q[1]-=p[1];Q[2]-=p[2]}T[r.Euler]=Q;x=n.neutralEulerToGlMatrixQuat(Q);T.value=n.glMatrixQuatToNeutral(x);break;case r.AngleAxis:var q;var z;var L;var S;var w;var G;var V;l.identity(s);if(p===true){for(z=m.getKeysCount()-1;z>=0;z--){q=m.getKey(z);if(q===M){break}l.setAxisAngle(o,u.copy(v,q.value),-q.value[3]);l.multiply(s,o,s)}S=g[0];w=g[1];G=g[2];V=(f-1)*g[3]}else{for(z=0,L=m.getKeysCount();z<L;z++){q=m.getKey(z);if(q===M){break}l.setAxisAngle(o,u.copy(v,q.value),q.value[3]);l.multiply(s,o,s)}S=g[0];w=g[1];G=g[2];V=f*g[3]}T[r.AngleAxis]=[S,w,G,V];l.setAxisAngle(o,u.set(v,S,w,G),V);l.multiply(s,o,s);T.value=n.glMatrixQuatToNeutral(s);break;case r.Vector3:T.value=[n.interpolateScalarLinear(k[0],g[0],f),n.interpolateScalarLinear(k[1],g[1],f),n.interpolateScalarLinear(k[2],g[2],f)];if(p!=null){switch(b){case e.Translate:T.value[0]-=p[0];T.value[1]-=p[1];T.value[2]-=p[2];break;case e.Scale:if(Math.abs(p[0])<y||Math.abs(p[1])<y||Math.abs(p[2])<y){a.error("The scale factor for reverse relative animation is too small","["+p[0]+", "+p[1]+", "+p[2]+"]",i)}else{T.value[0]/=p[0];T.value[1]/=p[1];T.value[2]/=p[2]}break;default:break}}break;default:T.value=n.interpolateScalarLinear(k,g,f);if(p!=null){switch(b){case e.Opacity:if(Math.abs(p)<y){a.warning("The opacity factor for reverse relative animation is too small","["+p+"]",i)}else{T.value/=p}break;default:break}}break}return T}}();n.interpolateScalarLinear=function(a,t,e){return a+e*(t-a)};n.cartesianToPolar=function(a){var t={azimuth:0,elevation:0,radius:1};if(Array.isArray(a)&&a.length===3){var e=a[0];var r=a[1];var i=a[2];var n=e*e+i*i;if(n>0){t.azimuth=Math.acos(i/Math.sqrt(n))*(e<0?-1:1)}t.radius=Math.sqrt(e*e+r*r+i*i);if(t.radius>0){t.elevation=Math.asin(r/t.radius)}}return t};n.polarToCartesian=function(a){var t=[0,0,1];var e="radius"in a?a.radius:1;t[0]=e*Math.cos(a.elevation)*Math.sin(a.azimuth);t[1]=e*Math.sin(a.elevation);t[2]=e*Math.cos(a.elevation)*Math.cos(a.azimuth);return t};n.cartesianToPolar=function(a){var t={azimuth:0,elevation:0,radius:1};if(Array.isArray(a)&&a.length===3){var e=a[0];var r=a[1];var i=a[2];var n=e*e+i*i;if(n>0){t.azimuth=Math.acos(i/Math.sqrt(n))*(e<0?-1:1)}t.radius=Math.sqrt(e*e+r*r+i*i);if(t.radius>0){t.elevation=Math.asin(r/t.radius)}}return t};n.polarToCartesian=function(a){var t=[0,0,1];var e="radius"in a?a.radius:1;t[0]=e*Math.cos(a.elevation)*Math.sin(a.azimuth);t[1]=e*Math.sin(a.elevation);t[2]=e*Math.cos(a.elevation)*Math.cos(a.azimuth);return t};return n});
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/AnimationPlayback", ["sap/ui/base/EventProvider","./AnimationSequence","./AnimationTrackType","sap/ui/vk/uuidv4"],function(e,t,i,s){"use strict";var n=e.extend("sap.ui.vk.AnimationPlayback",{constructor:function(e,t){if(typeof e==="object"){t=e;e=undefined}if(e==null){e=s()}this._sequence=t&&t.sequence?t.sequence:undefined;this._jsonData={};this._jsonData.id=e;this._jsonData.startTime=t&&t.startTime?t.startTime:0;this._jsonData.sequence=this._sequence?this._sequence.getJSONData():undefined;this._jsonData.timeScale=t&&t.timeScale?t.timeScale:1;this._jsonData.preDelay=t&&t.preDelay?t.preDelay:0;this._jsonData.postDelay=t&&t.postDelay?t.postDelay:0;this._jsonData.repeats=t&&t.repeats?t.repeats:1;this._jsonData.reversed=t&&t.reversed?t.reversed:false;this._jsonData.infinite=t&&t.infinite?t.infinite:false}});n.prototype.setJSONModel=function(e){this._model=e;if(this._sequence){this._sequence.setJSONModel(e)}return this};n.prototype.getId=function(){return this._jsonData.id};n.prototype.getStartTime=function(){return this._jsonData.startTime};n.prototype.setStartTime=function(e){this._jsonData.startTime=e;if(this._model){this._model.updateBindings()}return this};n.prototype.getSequence=function(){return this._sequence};n.prototype.setSequence=function(e){this._sequence=e;this._jsonData.sequence=e.getJSONData();if(this._model){this._model.updateBindings()}return this};n.prototype.getTimeScale=function(){return this._jsonData.timeScale};n.prototype.setTimeScale=function(e){this._jsonData.timeScale=e;if(this._model){this._model.updateBindings()}return this};n.prototype.getPreDelay=function(){return this._jsonData.preDelay};n.prototype.setPreDelay=function(e){this._jsonData.preDelay=e;if(this._model){this._model.updateBindings()}return this};n.prototype.getPostDelay=function(){return this._jsonData.postDelay};n.prototype.setPostDelay=function(e){this._jsonData.postDelay=e;if(this._model){this._model.updateBindings()}return this};n.prototype.getRepeats=function(){return this._jsonData.repeats};n.prototype.setRepeats=function(e){this._jsonData.repeats=e;if(this._model){this._model.updateBindings()}return this};n.prototype.getReversed=function(){return this._jsonData.reversed};n.prototype.setReversed=function(e){this._jsonData.reversed=e;if(this._model){this._model.updateBindings()}return this};n.prototype.getInfinite=function(){return this._jsonData.infinite};n.prototype.setInfinite=function(e){this._jsonData.infinite=e;if(this._model){this._model.updateBindings()}return this};n.prototype.getDuration=function(){var e=this._sequence?this._sequence.getDuration():0;return this._jsonData.preDelay+this._jsonData.postDelay+e*this._jsonData.repeats*this._jsonData.timeScale};n.prototype.getJSONData=function(){return this._jsonData};n.prototype.getNodeBoundaryProperty=function(e,t,i){var s;var n;if(i){n=this._nodeEndPropertiesMap}else{n=this._nodeStartPropertiesMap}if(n){var r=n.get(e);if(r){s=r[t]}}return s};n.prototype._hasCompleteNodesBoundaryProperties=function(){if(!this._nodeEndPropertiesMap||!this._nodeEndPropertiesMap.size||!this._nodeStartPropertiesMap||!this._nodeStartPropertiesMap.size){return false}return true};n.prototype._clearNodesBoundaryProperties=function(){if(this._nodeEndPropertiesMap){this._nodeEndPropertiesMap.clear()}if(this._nodeStartPropertiesMap){this._nodeStartPropertiesMap.clear()}};n.prototype._setCurrentNodesPropertiesAsBoundary=function(e,t,i){if(!i&&(this._nodeEndPropertiesMap&&this._nodeEndPropertiesMap.size&&t||this._nodeStartPropertiesMap&&this._nodeStartPropertiesMap.size&&!t)){return}var s;if(t){if(!this._nodeEndPropertiesMap){this._nodeEndPropertiesMap=new Map}else{this._nodeEndPropertiesMap.clear()}s=this._nodeEndPropertiesMap}else{if(!this._nodeStartPropertiesMap){this._nodeStartPropertiesMap=new Map}else{this._nodeStartPropertiesMap.clear()}s=this._nodeStartPropertiesMap}var n=this.getSequence();if(n){n._getCurrentNodesProperties(e,s)}};n.prototype._getNodeEndPropertiesMap=function(){return this._nodeEndPropertiesMap};n.prototype._getNodeStartPropertiesMap=function(){return this._nodeStartPropertiesMap};return n});
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/AnimationPlayer", ["sap/ui/core/Element","./Core","./AnimationMath","./AnimationTrackType","./AnimationTrackValueType","./glMatrix"],function(e,t,a,i,r,n){"use strict";var o=e.extend("sap.ui.vk.AnimationPlayer",{metadata:{library:"sap.ui.vk",associations:{viewStateManager:{type:"sap.ui.vk.ViewStateManagerBase",multiple:false}},events:{viewActivated:{type:"sap.ui.vk.View"},beforeTimeChanged:{time:{type:"float"},nextTime:{type:"float"},currentPlayback:{type:"sap.ui.vk.AnimationPlayback"},nextPlayback:{type:"sap.ui.vk.AnimationPlayback"}},timeChanged:{time:{type:"float"},previousTime:{type:"float"},currentPlayback:{type:"sap.ui.vk.AnimationPlayback"},previousPlayback:{type:"sap.ui.vk.AnimationPlayback"}},stateChanged:{playing:{type:"boolean"},stopped:{type:"boolean"},endOfAnimation:{type:"boolean"}}}},constructor:function(a,i){e.apply(this,arguments);t.observeLifetime(this)}});o.prototype._getViewStateManager=function(){var t=this.getViewStateManager();return t?e.getElementById(t):undefined};o.prototype.init=function(){this._step=this._step.bind(this);this._playbackCollection=null;this._currentPlayback=null;this._time=0;this._nodeChanges=new Map;t.getEventBus().subscribe("sap.ui.vk","readyForAnimation",this._onViewApplied,this);t.getEventBus().subscribe("sap.ui.vk","sequenceChanged",this._onSequenceChanged,this);t.getEventBus().subscribe("sap.ui.vk","playbacksChanged",this._onPlaybacksChanged,this);t.getEventBus().subscribe("sap.ui.vk","trackChanged",this._onTrackChanged,this);t.getEventBus().subscribe("sap.ui.vk","nodeAnimationRemoved",this._onNodeAnimationRemoved,this)};o.prototype.exit=function(){this._playbackCollection=null;this._currentPlayback=null;t.getEventBus().unsubscribe("sap.ui.vk","readyForAnimation",this._onViewApplied,this);t.getEventBus().unsubscribe("sap.ui.vk","sequenceChanged",this._onSequenceChanged,this);t.getEventBus().unsubscribe("sap.ui.vk","playbacksChanged",this._onPlaybacksChanged,this);t.getEventBus().unsubscribe("sap.ui.vk","trackChanged",this._onTrackChanged,this);t.getEventBus().unsubscribe("sap.ui.vk","nodeAnimationRemoved",this._onNodeAnimationRemoved,this)};o.prototype._onViewApplied=function(e,t,a){if(a.source==null||a.source.getId()!==this.getViewStateManager()){return}var i=a.view;var r=a.ignoreAnimationPosition;this.activateView(i,r)};o.prototype._onSequenceChanged=function(e,t,a){if(this._currentPlayback){var i=this._getViewStateManager();var r=this._currentPlayback.getSequence();if(i&&r){if(r.getId()===a.sequenceId){i.setJoints(r.getJoint(),this._currentPlayback)}}}this._clearPlaybackBoundaryProperties();this._setPlaybackBoundaryProperties()};o.prototype._resetNodesAnimation=function(e,t){if(!Array.isArray(e)){e=[e]}var a=this._getViewStateManager();e.forEach(function(e){if(t){a.resetNodeProperty(e,t)}else{a.resetNodeProperty(e);a.resetNodeProperty(e,i.Opacity)}})};o.prototype._onPlaybacksChanged=function(e,t,a){if(a.operation==="playbackRemoved"&&this._currentPlayback&&this._currentPlayback===a.playback&&this._currentPlayback.getSequence()){var i=this._currentPlayback.getSequence().getNodeAnimation();var r=i.map(function(e){return e.nodeRef});this._resetNodesAnimation(r)}this._clearPlaybackBoundaryProperties()};o.prototype._onTrackChanged=function(e,t,a){if(a.emptyTrack&&this._currentPlayback){var r=this._getViewStateManager();var n=this._currentPlayback.getSequence();if(r&&n){var o=n.getNodeAnimation();o.forEach(function(e){for(var t in i){var n=i[t];var o=e[n];if(o&&o.getId()===a.trackId){r.resetNodeProperty(e.nodeRef,n);return}}})}this._setPlaybackBoundaryProperties()}};o.prototype._onNodeAnimationRemoved=function(e,t,a){if(this._currentPlayback){var i=this._getViewStateManager();var r=this._currentPlayback.getSequence();if(i&&r){if(r.getId()===a.sequenceId){i.setJoints(r.getJoint(),this._currentPlayback);this._resetNodesAnimation(a.nodeRefs,a.property)}}}this._clearPlaybackBoundaryProperties()};o.prototype.getAnimatedProperty=function(e,t){var a={};var r=this._getViewStateManager();if(!r){return null}if(t!==i.Opacity){var n=r.getTransformationWorld(e);if(t===i.Rotate){a.world=n.quaternion}else if(t===i.Translate){a.world=n.translation}else{a.world=n.scale}}var o=this._nodeChanges.get(e);if(!o||o[t]===undefined){a.offsetToPrevious=null;a.offsetToRest=null;if(t===i.Opacity){a.absolute=r.getOpacity(e);a.totalOpacity=r.getTotalOpacity(e)}else{var s=r.getTransformation(e);if(t===i.Rotate){a.absolute=s.quaternion}else if(t===i.Translate){a.absolute=s.translation}else{a.absolute=s.scale}}return a}if(t===i.Opacity){var l=o[t];a.offsetToRest=l;a.offsetToPrevious=o.offsetToPrevious[t];a.opacity=o.absolute.opacity;a.totalOpacity=o["totalOpacity"];return a}var u=o[t];a.offset=u;if(t===i.Rotate){a.absolute=o.absolute.quaternion}else if(t===i.Translate){a.absolute=o.absolute.translate}else{a.absolute=o.absolute.scale}a.offsetToPrevious=o.offsetToPrevious[t];a.offsetToRest=o[t];return a};o.prototype.setTime=function(e,t,a){this._setPlaybackBoundaryProperties();this._setTime(e,t,a);return this};o.prototype._setTime=function(e,t,a){var r=this._time;var n=this._currentPlayback;if(!this._playbackCollection||!Array.isArray(this._playbackCollection.getPlaybacks())){this._currentPlayback=undefined;this._time=0}else{if(t!=null){e=this._getAbsoluteTime(e,t)}var o=this._getViewStateManager();var s=this._currentPlayback;var l;if(e<0||e>this.getTotalDuration()){l=undefined}else if(t!=null){l=this._playbackCollection.getPlayback(t)}else{l=this._findPlaybackByAbsoluteTime(e)}var u=false;if(l&&l.getReversed()){if(this._currentPlayback&&l.getJSONData().startTime>this._currentPlayback.getJSONData().startTime){u=true}}else if(l&&this._currentPlayback&&l.getJSONData().startTime<this._currentPlayback.getJSONData().startTime){u=true}if(!a&&(e!==this._time||l!==this._currentPlayback)){this.fireBeforeTimeChanged({time:this._time,nextTime:e,currentPlayback:this._currentPlayback,nextPlayback:l})}this._time=e;this._currentPlayback=l;if(o&&this._currentPlayback&&s!==this._currentPlayback){var c=this._currentPlayback.getSequence();if(c){o.setJoints(c.getJoint(),this._currentPlayback)}}else if(!this._currentPlayback||!this._currentPlayback.getSequence()){o.setJoints(undefined)}if(o){var f={nodeRefs:[],positions:[]};var y={nodeRefs:[],opacities:[]};this._collectNodeChanges();this._nodeChanges.forEach(function(e,t){var a={rtranslate:e.rtranslate,rscale:e.rscale,rrotate:e.rrotate,Euler:e.Euler,ropacity:e.offsetToPrevious&&e.offsetToPrevious.ropacity?e.offsetToPrevious.ropacity:e.ropacity};o.setInterpolatedRelativeValues(t,a);var r=o.getRestTransformation(t);var n=o._addToTransformation(r,e.rtranslate,e.rrotate,e.rscale,e.originalRotationType,e.Euler);if(n){f.nodeRefs.push(t);f.positions.push(n);e.absolute={};e.absolute.translate=n.translation;e.absolute.scale=n.scale;e.absolute.quaternion=n.quaternion}if(u&&e[i.Opacity]===undefined){e[i.Opacity]=1;t.userData.opacity=undefined}if(e[i.Opacity]!==undefined){var s=o.getRestOpacity(t);if(s===0){s=1}var l=e[i.Opacity]*s;t.userData.animatedOpacity=true;e.absolute={};e.absolute.opacity=l;y.nodeRefs.push(t);y.opacities.push(l)}},this);o.setTransformation(f.nodeRefs,f.positions);o.setOpacity(y.nodeRefs,y.opacities);o._propagateOpacityToJointChildren(y.nodeRefs,y.opacities);o._setJointNodeMatrix();this._nodeChanges.forEach(function(e,t){if(e[i.Opacity]!==undefined){e.totalOpacity=o.getTotalOpacity(t)}},this)}}if(!a&&(this._time!==r||this._currentPlayback!==n)){this.fireTimeChanged({time:this._time,previousTime:r,currentPlayback:this._currentPlayback,previousPlayback:n})}};o.prototype.getTime=function(){return this._time};o.prototype.getCurrentPlayback=function(){return this._currentPlayback};o.prototype.getCurrentPlaybackTime=function(){var e=this._time;var t=this._playbackCollection.getPlaybacks();if(!Array.isArray(t)||!this.getCurrentPlayback()){return-1}var a=0;while(t[a]!=this.getCurrentPlayback()){e-=t[a].getDuration();a++}return e};o.prototype.getStartTime=function(e){if(!this._playbackCollection){return undefined}if(typeof e==="number"){e=this._playbackCollection.getPlayback(e)}return e?e.getStartTime():undefined};o.prototype.getTotalDuration=function(){if(!this._playbackCollection){return 0}var e=0;this._playbackCollection.getPlaybacks().forEach(function(t){e+=t.getDuration()});return e};o.prototype._step=function(e){this._frameId=undefined;if(!this._lastFrameTimestamp){this._lastFrameTimestamp=e}var t=e-this._lastFrameTimestamp;this._lastFrameTimestamp=e;var a=this.getTime()+t/1e3;var i=a>=0&&a<=this.getTotalDuration();if(a>this.getTotalDuration()){a=this.getTotalDuration()}this.setTime(a);if(i){this._frameId=window.requestAnimationFrame(this._step)}else{this.stop()}};o.prototype._interpolate=function(e,t,i,n,o){if(!t.before&&!t.after){return undefined}if(!t.before){t.before=t.after}if(!t.after){if(e===r.AngleAxis){t.after={value:[0,0,1,0],time:t.before.time}}else{t.after=t.before}}var s;if(t.before.time===t.after.time){s=1}else{s=(t.time-t.before.time)/(t.after.time-t.before.time)}return a.interpolate(e,t.before,t.after,s,i,n,o)};o.getBoundaryKey=function(e,t){var i=e.getKeysCount();if(!i){return null}var n;if(t){n=e.getKey(0)}else{n=e.getKey(i-1)}var o=e.getKeysType();var s,l={};if(o===r.Euler){l[o]=n.value;s=a.neutralEulerToGlMatrixQuat(n.value);l.value=a.glMatrixQuatToNeutral(s);l.time=n.time}else if(o===r.Quaternion){s=a.neutralQuatToGlMatrixQuat(n.value);l.value=a.glMatrixQuatToNeutral(s);l.time=n.time}else if(o!==r.AngleAxis){l.value=n.value;l.time=n.time}else{var u;var c=1;if(t){u=n;if(i>1){u=e.getKey(1);c=0}}else{u=n;if(i>1){n=e.getKey(i-2)}}l=a.interpolate(o,n,u,c,e);l.time=t?n.time:u.time}return l};o.prototype._getKeyFramesBracket=function(e,t){var a=t.getKeysCount();if(a===0){return null}var i={time:e,before:undefined,after:undefined};for(var r=0;r<a;r++){var n=t.getKey(r);if(n.time===e){i.before=i.after=n;break}else if(n.time>e){i.before=r===0?undefined:t.getKey(r-1);i.after=n;break}}if(!i.before&&!i.after&&a>0){i.before=t.getKey(a-1)}if(a>1&&(!i.after&&t.isCycleForward()||!i.before&&t.isCycleBackward())){var o=t.getKey(0).time;var s=t.getKey(a-1).time-o;var l=Math.floor((e-o)/s);var u=e-s*l;return this._getKeyFramesBracket(u,t)}return i};o.prototype._collectNodeChangesFromPlaybackBoundaryKeys=function(e,t,a){var r=t.getSequence();if(!r){return}var n=r.getNodeAnimation();if(!n){return}var o=this._getViewStateManager();var s=this;var l=function(t,a,r){if(!t||!a||r===undefined||r===null){return}var n=e.get(t);if(n&&n.hasOwnProperty(a)){return}if(!n){n={};e.set(t,n)}if(!n.offsetToPrevious){n.offsetToPrevious={}}if(a===i.Opacity){n[a]=r;if(!n.offsetToPrevious[a]){var l=o.getOpacity(t);var u=o.getRestOpacity(t);if(u===0){u=1}if(u>0&&(l!==undefined||l!==null)){var c=o._getEndPropertyInPreviousPlayback(t,a,s._currentPlayback);if(c){l/=c}n.offsetToPrevious[a]=l/u}else{n.offsetToPrevious[a]=1}}}else{n[a]=r.slice();var f=o.getRelativeTransformation(t);if(a===i.Scale){if(!n.offsetToPrevious[a]){n.offsetToPrevious[a]=f.scale.slice();var y=o._getEndPropertyInPreviousPlayback(t,a,s._currentPlayback);if(y){n.offsetToPrevious[a][0]/=y[0];n.offsetToPrevious[a][1]/=y[1];n.offsetToPrevious[a][2]/=y[2]}}}if(a===i.Translate){if(!n.offsetToPrevious[a]){n.offsetToPrevious[a]=f.translation.slice();var h=o._getEndPropertyInPreviousPlayback(t,a,s._currentPlayback);if(h){n.offsetToPrevious[a][0]-=h[0];n.offsetToPrevious[a][1]-=h[1];n.offsetToPrevious[a][2]-=h[2]}}}if(a===i.Rotate){n.offsetToPrevious[a]=[0,0,1,0]}else if(!n.offsetToPrevious[a]){n.offsetToPrevious[a]=[0,0,0]}}};var u;if(a){u=t._getNodeEndPropertiesMap()}else{u=t._getNodeStartPropertiesMap()}if(!u){return}var c=this._currentPlayback&&this._currentPlayback.getSequence();if(c){u.forEach(function(e,t){for(var a in e){if(c._isNodePropertyDefined(t,a)){continue}l(t,a,e[a])}},this)}};o.prototype._collectSequenceNodeChanges=function(e,t,o){var s=o.getSequence();var l=s&&s.getNodeAnimation();if(!l){return}var u=this._getViewStateManager();var c=function(e,s,l,c){if(!e||!s||!l||l.value===undefined||l.value===null){return}var f=t.get(e);if(!f){f={};t.set(e,f)}if(!f.animationProperties){f.animationProperties={}}f.animationProperties[s]=true;if(c){f.originalRotationType=c}if(!f.offsetToPrevious){f.offsetToPrevious={}}var y;if(s===i.Opacity){f[s]=l.value;f.offsetToPrevious[s]=l.value;y=u._getEndPropertyInPreviousPlayback(e,s,o,true);if(y){f[s]*=y}}else{f[s]=l.value.slice();f.offsetToPrevious[s]=l.value.slice();y=u._getEndPropertyInPreviousPlayback(e,s,o);if(y){if(s===i.Translate){f[s][0]+=y[0];f[s][1]+=y[1];f[s][2]+=y[2]}else if(s===i.Scale){f[s][0]*=y[0];f[s][1]*=y[1];f[s][2]*=y[2]}}}if(c===r.Euler||c===r.AngleAxis){f[c]=l[c].slice();f.offsetToPrevious[s]=l[c].slice();if(y){var h=a.neutralQuatToGlMatrixQuat(y);var p=a.neutralQuatToGlMatrixQuat(f[s]);var g=n.quat.multiply(n.quat.create(),p,h);f[s]=a.glMatrixQuatToNeutral(g)}}};var f=o.getReversed();var y=s.getDuration();l.forEach(function(t){var a;for(var n in i){var o=i[n];var s=t[o];if(s&&s.getKeysCount()>0){a=this._getKeyFramesBracket(e,s);if(!a){return}var l=s.getKeysType();var u=null;if(f){if(l===r.AngleAxis){u=this._interpolate(l,a,s,o,true)}else{var h=this._getKeyFramesBracket(y,s);var p=this._interpolate(l,h,s,o);u=this._interpolate(l,a,s,o,p.value)}}else{u=this._interpolate(l,a,s,o)}if(o===i.Rotate){c(t.nodeRef,o,u,l)}else{c(t.nodeRef,o,u)}}}},this)};o.prototype._collectPlaybackNodeChanges=function(e,t,a){var i=a.getSequence();if(!i){return}var r=e-a.getStartTime();if(r<0){return}var n=i.getDuration()*a.getTimeScale()*a.getRepeats();var o=(r-a.getPreDelay())/a.getTimeScale();var s=1e-4;if(o>0&&o%i.getDuration()===0){o=i.getDuration()}else if(o>i.getDuration()+s){o=o%i.getDuration()}else if(o>i.getDuration()){o=i.getDuration()}o=a.getReversed()?i.getDuration()-o:o;if(r<a.getPreDelay()){this._collectSequenceNodeChanges(0,t,a)}else if(r>a.getPreDelay()+n){this._collectSequenceNodeChanges(i.getDuration()*a.getRepeats(),t,a)}else{this._collectSequenceNodeChanges(o,t,a)}};o.prototype._collectNodeChanges=function(){this._nodeChanges.clear();if(!this._currentPlayback){return}var e=this._playbackCollection.getPlaybacks();var t=this.getTime();var a;var i=0;for(a=0;a<e.length;a++){if(this._currentPlayback&&this._currentPlayback!==e[a]){continue}this._collectPlaybackNodeChanges(t,this._nodeChanges,e[a]);i=a}if(!this._currentPlayback.getReversed()){for(a=i-1;a>=0;a--){this._collectNodeChangesFromPlaybackBoundaryKeys(this._nodeChanges,e[a],true)}for(a=i+1;a<e.length;a++){this._collectNodeChangesFromPlaybackBoundaryKeys(this._nodeChanges,e[a],false)}}else{for(a=i+1;a<e.length;a++){this._collectNodeChangesFromPlaybackBoundaryKeys(this._nodeChanges,e[a],false)}for(a=i-1;a>=0;a--){this._collectNodeChangesFromPlaybackBoundaryKeys(this._nodeChanges,e[a],true)}}};o.prototype._clearPlaybackBoundaryProperties=function(){if(!this._playbackCollection){return}var e=this._playbackCollection.getPlaybacks();for(var t=0;e&&t<e.length;t++){var a=e[t];if(!a){continue}a._clearNodesBoundaryProperties()}};o.prototype._setPlaybackBoundaryProperties=function(e){if(!this._playbackCollection){return}var t=this._time;var a=this._currentPlayback;var i=false;var r=this._playbackCollection.getPlaybacks();var n;var o=0;var s,l;if(e){this._clearPlaybackBoundaryProperties()}for(n=0;n<r.length;n++){s=r[n];if(!s){continue}var u=this._getViewStateManager();l=s.getSequence();if(u&&l){if(!e&&s._hasCompleteNodesBoundaryProperties()){continue}o=s.getPreDelay();this._setTime(o,n,true);s._setCurrentNodesPropertiesAsBoundary(u,false,e);o+=l.getDuration()*s.getTimeScale()*s.getRepeats();this._setTime(o,n,true);s._setCurrentNodesPropertiesAsBoundary(u,true,e);i=true}}if(i){if(!a){this._time=t;this._setTime(this._time,null,true);this._currentPlayback=a}else{var c=-1;var f=0;for(n=0;n<r.length;n++){s=r[n];if(s===a){c=n;break}var y=0;l=s.getSequence();if(l){y=l.getDuration()*s.getTimeScale()*s.getRepeats()}f+=s.getPreDelay()+y+s.getPostDelay()}if(c!==-1){var h=t-f;this._setTime(h,c,true)}}}};o.prototype.play=function(){this._lastFrameTimestamp=undefined;this._frameId=this._frameId||window.requestAnimationFrame(this._step);t.getEventBus().publish("sap.ui.vk","animationPlayStateChanged",{source:this,view:this._playbackCollection,playing:true,stopped:false,endOfAnimation:false});this.fireStateChanged({playing:true,stopped:false});return this};o.prototype.stop=function(){if(this._frameId){window.cancelAnimationFrame(this._frameId);this._frameId=undefined}this._lastFrameTimestamp=undefined;this.fireStateChanged({playing:false,stopped:true,endOfAnimation:this.getTime()>=this.getTotalDuration()});t.getEventBus().publish("sap.ui.vk","animationPlayStateChanged",{source:this,view:this._playbackCollection,playing:false,stopped:true,endOfAnimation:this.getTime()>=this.getTotalDuration()});return this};o.prototype.activateView=function(e,t){this.stop();var a=this._getViewStateManager();var i=e.getPlaybacks();if(i&&i.length>0){for(var r=0;r<i.length;r++){var n=i[r];var o=n.getSequence();if(o){a._convertTracksToRelative(o,n.getReversed())}}}if(!t){this._playbackCollection=e}else{this._playbackCollection=undefined}this._currentPlayback=undefined;this.setTime(0);if(t){this._playbackCollection=e}this.fireViewActivated({view:e});return this};o.prototype._getAbsoluteTime=function(e,t){if(!this._playbackCollection||!Array.isArray(this._playbackCollection.getPlaybacks())){return-1}var a=this._playbackCollection.getPlaybacks();if(t<0||t>=a.length){return-1}var i=this._playbackCollection.getPlayback(t);if(!i||i.getDuration()<e||e<0){return-1}var r=e;var n=0;while(n<t){var o=a[n].getDuration();r+=o;n++}return r};o.prototype._findPlaybackByAbsoluteTime=function(e){if(!this._playbackCollection||!Array.isArray(this._playbackCollection.getPlaybacks())){return undefined}var t=this._playbackCollection.getPlaybacks();var a=-1;var i=-1;t.forEach(function(e,t){if(e.getStartTime()>i){a=t;i=e.getStartTime()}});var r=0;while(r<t.length){var n=t[r].getDuration();var o=t[r].getStartTime();if(r!==a&&e>=o&&e<o+n||r===a&&e>=o&&e<=o+n){return t[r]}r++}return undefined};return o});
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/AnimationRotateType", ["sap/ui/base/DataType"],function(e){"use strict";var i={AngleAxis:"AngleAxis",Euler:"Euler",Quaternion:"Quaternion"};e.registerEnum("sap.ui.vk.AnimationRotateType",i);return i});
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/AnimationSequence", ["sap/ui/base/Object","./AnimationTrackType","./findIndexInArray","./AnimationPlayer","./AnimationTrack","./Core"],function(t,e,n,i,a,o){"use strict";var s=t.extend("sap.ui.vk.AnimationSequence",{constructor:function(t,e){this._jsonData={};this._jsonData.id=t;this._jsonData.name=e&&e.name?e.name:"";this._jsonData.duration=e&&e.duration?e.duration:1;this._jsonData.joints=[];this._jsonData.nodes=[];this._trackMap=new Map}});s.prototype.setJSONModel=function(t){this._model=t;return this};s.prototype.getId=function(){return this._jsonData.id};s.prototype.getName=function(){return this._jsonData.name};s.prototype.setName=function(t){this._jsonData.name=t;if(this._model){this._model.updateBindings()}return this};s.prototype.getDuration=function(){return this._jsonData.duration};s.prototype.setDuration=function(t,e){this._jsonData.duration=t;if(this._model){this._model.updateBindings()}if(!e){this._fireSequenceChanged()}return this};s.prototype._findJointIndex=function(t,e){var i=this._jsonData.joints.filter(function(t){return t.node&&t.parent});return n(i,function(n){return(t?n.parent==t:true)&&(e?n.node==e:true)})};s.prototype.setJoint=function(t,e){if(!Array.isArray(t)){t=[t]}t.forEach(function(t){var e=this._findJointIndex(t.parent,t.node);if(e<0){if(!t.parentSid&&t.parent&&t.parent.userData&&t.parent.userData.treeNode){t.parentSid=t.parent.userData.treeNode.sid}if(!t.nodeSid&&t.node&&t.node.userData&&t.node.userData.treeNode){t.nodeSid=t.node.userData.treeNode.sid}t.type="RELATIVE";this._jsonData.joints.push(t)}},this);if(this._model){this._model.updateBindings()}if(!e){this._fireSequenceChanged()}return this};s.prototype.getJoint=function(t){var e;if(!t||!t.parent&&!t.node){e=this._jsonData.joints}else if(t&&t.node){e=this._jsonData.joints.filter(function(e){return e.node==t.node&&(t.parent?e.parent==t.parent:true)})}else if(t&&t.parent&&!t.node){e=this._jsonData.joints.filter(function(e){return e.parent==t.parent})}return e};s.prototype.removeJoint=function(t){var e=[];if(!t){this._jsonData.joints.forEach(function(t){e.push(t.node)});this._jsonData.joints.splice(0)}else if(t&&(t.node||t.parent)){var n;do{n=this._findJointIndex(t.parent,t.node);if(n>=0){e.push(this._jsonData.joints[n].node);this._jsonData.joints.splice(n,1)}}while(n>=0)}if(this._model){this._model.updateBindings()}if(e.length){o.getEventBus().publish("sap.ui.vk","nodeAnimationRemoved",{nodeRefs:e,sequenceId:this._jsonData.id})}return this};s.prototype._findNodeIndex=function(t){return n(this._jsonData.nodes,function(e){return e?e.nodeRef==t:true})};s.prototype.getNodeAnimation=function(t,n){var i=function(t,n){var i=this._findNodeIndex(t);var a,o;if(i!==-1){a=this._jsonData.nodes[i]}if(a){if(n){if(a[n]){o=this._trackMap.get(a[n])}}else{o={nodeRef:t};for(var s in e){var r=e[s];if(a[r]){o[r]=this._trackMap.get(a[r])}}}}return o}.bind(this);var a;if(t&&!Array.isArray(t)){return i(t,n)}else if(!t){a=[];this._jsonData.nodes.forEach(function(t){a.push(i(t.nodeRef,n))},this)}else{a=[];t.forEach(function(t){a.push(i(t,n))},this)}return a};s.prototype.setNodeAnimation=function(t,e,n,i){var a=this._findNodeIndex(t);var o;if(a!==-1){o=this._jsonData.nodes[a]}if(!o){o={};o.nodeRef=t;if(t.userData&&t.userData.treeNode){o.sid=t.userData.treeNode.sid}this._jsonData.nodes.push(o)}o[e]=n.getJSONData();this._trackMap.set(n.getJSONData(),n);n.setJSONModel(this._model);if(this._model){this._model.updateBindings()}if(!i){this._fireSequenceChanged()}return this};s.prototype.removeNodeAnimation=function(t,e,n){var i=this._findNodeIndex(t);if(i===-1){return this}var a=this._jsonData.nodes[i];var s;if(!e){for(var r in a){s=this._trackMap.get(a[r]);if(s){s.setJSONModel(null);this._trackMap.delete(a[r])}}this._jsonData.nodes.splice(i,1)}else{s=this._trackMap.get(a[e]);if(s){s.setJSONModel(null);this._trackMap.delete(a[e]);delete a[e]}}if(this._model){this._model.updateBindings()}if(!n){o.getEventBus().publish("sap.ui.vk","nodeAnimationRemoved",{nodeRefs:[t],property:e,sequenceId:this._jsonData.id})}return this};s.prototype.resetDuration=function(t){var e=0;this._jsonData.nodes.forEach(function(t){var n;for(var i in t){if(i==="sid"){continue}var a=this._trackMap.get(t[i]);if(a){if(a.getKeysCount()){var o=a.getKey(a.getKeysCount()-1);n=o.time}if(n&&n>e){e=n}}}},this);if(e>0){this._jsonData.duration=e;if(this._model){this._model.updateBindings()}}if(!t){this._fireSequenceChanged()}return this};s.prototype.getNodesBoundaryValues=function(t){var e=new Map;var n=function(t,n,i){var a=e.get(t);if(!a){a={};e.set(t,a)}a[n]=i};this._jsonData.nodes.forEach(function(e){for(var a in e){if(a==="sid"){continue}var o=this._trackMap.get(e[a]);if(o&&o.getKeysCount()){var s=i.getBoundaryKey(o,t);n(e.nodeRef,a,s.value)}}}.bind(this));return e};s.prototype._fireSequenceChanged=function(){o.getEventBus().publish("sap.ui.vk","sequenceChanged",{sequenceId:this._jsonData.id})};s.prototype._isNodePropertyDefined=function(t,e){var n=this.getNodeAnimation(t,e);if(n&&n.getKeysCount()){return true}var i={node:t};var a=this.getJoint(i);if(a&&a.length){return true}return false};s.prototype._getCurrentNodesProperties=function(t,n){this._jsonData.nodes.forEach(function(i){var a={};var o=t.getRelativeTransformation(i.nodeRef);for(var s in i){if(s===e.Rotate){a[e.Rotate]=o.quaternion.slice()}else if(s===e.Translate){a[e.Translate]=o.translation.slice()}else if(s===e.Scale){a[e.Scale]=o.scale.slice()}else if(s===e.Opacity){var r=t.getOpacity(i.nodeRef);var d=t.getRestOpacity(i.nodeRef);if(r!==null&&r!==undefined){if(!d){d=1}a[e.Opacity]=r/d}}}n.set(i.nodeRef,a)});this._jsonData.joints.forEach(function(i){if(!i.node||!i.parent){return}var a={};var o=t.getRelativeTransformation(i.node);a[e.Rotate]=o.quaternion.slice();a[e.Translate]=o.translation.slice();a[e.Scale]=o.scale.slice();var s=t.getOpacity(i.node);var r=t.getRestOpacity(i.node);if(s!==null&&s!==undefined){if(!r){r=1}a[e.Opacity]=s/r}n.set(i.node,a)})};s.prototype.getJSONData=function(){return this._jsonData};return s});
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/AnimationTimeSlider", ["sap/m/Slider","./AnimationTimeSliderRenderer"],function(t,e){"use strict";var i=t.extend("sap.ui.vk.AnimationTimeSlider",{metadata:{library:"sap.ui.vk"}});i.prototype.init=function(){if(t.prototype.init){t.prototype.init.call(this)}};i.prototype.handleAnimationStarted=function(t){this.setProgress(true);this.setValue(0);this.setStep(.1)};i.prototype.handleAnimationUpdated=function(t){var e=t.getParameter("value");this.setValue(e)};i.prototype.handleAnimationFinished=function(t){this.setValue(100)};return i});
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/AnimationTimeSliderRenderer", ["sap/m/SliderRenderer"],function(e){"use strict";return e},true);
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/AnimationTrack", ["sap/ui/base/Object","./AnimationTrackValueType","./findIndexInArray","./Core"],function(t,e,i,s){"use strict";var n=t.extend("sap.ui.vk.AnimationTrack",{constructor:function(t,i){this._jsonData={};this._jsonData.id=t;this._jsonData.type=i&&i.trackValueType?i.trackValueType:e.Scalar;this._jsonData.keys=[];this._jsonData.cycleForward=!!(i&&i.cycleForward);this._jsonData.cycleBackward=!!(i&&i.cycleBackward);this._jsonData.infinite=!!(i&&i.infinite);this._jsonData._isAbsoluteValue=i&&i.isAbsoluteValue?i.isAbsoluteValue:false}});n.prototype.setJSONModel=function(t){this._model=t;return this};n.prototype.getIsAbsoluteValue=function(){return this._jsonData._isAbsoluteValue};n.prototype.setIsAbsoluteValue=function(t){this._jsonData._isAbsoluteValue=t};n.prototype.getId=function(){return this._jsonData.id};n.prototype.getKeysType=function(){return this._jsonData.type};n.prototype.setKeysType=function(t){if(this.getKeysCount()>0){return false}this._jsonData.type=t;return true};n.prototype.isCycleForward=function(){return this._jsonData.cycleForward};n.prototype.setCycleForward=function(t){this._jsonData.cycleForward=t;if(this._model){this._model.updateBindings()}return this};n.prototype.isCycleBackward=function(){return this._jsonData.cycleBackward};n.prototype.setCycleBackward=function(t){this._jsonData.cycleBackward=t;if(this._model){this._model.updateBindings()}return this};n.prototype.isInfinite=function(){return this._jsonData.infinite};n.prototype.setInfinite=function(t){this._jsonData.infinite=t;if(this._model){this._model.updateBindings()}return this};n.prototype.getKeysCount=function(){return this._jsonData.keys.length};n.prototype.getKey=function(t){if(t<0||t>=this._jsonData.keys.length){return undefined}return this._jsonData.keys[t]};n.prototype.updateKey=function(t,e,i){if(t>=0||t<this._jsonData.keys.length){this._jsonData.keys[t].value=e;if(this._model){this._model.updateBindings()}}if(!i){this._fireTrackChanged()}return this};n.prototype.removeKey=function(t,e){var i=false;if(t>=0||t<this._jsonData.keys.length){this._jsonData.keys.splice(t,1);if(this._jsonData.keys.length===0){i=true}if(this._model){this._model.updateBindings()}}if(!e){this._fireTrackChanged(i)}return this};n.prototype.findKeyIndex=function(t){var e=-1;if(this._jsonData.keys.length===1){e=0}else if(this._jsonData.keys.length>1){for(var i=1;i<this._jsonData.keys.length;i++){var s=this.getKey(i-1);var n=this.getKey(i);if(t>=s.time&&t<=n.time){e=t-s.time<n.time-t?i-1:i;break}}}return e};n.prototype.insertKey=function(t,e,s){var n=i(this._jsonData.keys,function(e){return e.time===t});if(n<0){this._jsonData.keys.push({time:t,value:e});this._jsonData.keys.sort(function(t,e){return t.time-e.time})}else{this.updateKey(n,e,true);if(this._model){this._model.updateBindings()}}if(!s){this._fireTrackChanged()}return this};n.prototype._fireTrackChanged=function(t){s.getEventBus().publish("sap.ui.vk","trackChanged",{trackId:this._jsonData.id,emptyTrack:t})};n.prototype.getJSONData=function(){return this._jsonData};return n});
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/AnimationTrackType", ["sap/ui/base/DataType"],function(a){"use strict";var r={Rotate:"rrotate",Translate:"rtranslate",Scale:"rscale",Opacity:"ropacity",Color:"color"};a.registerEnum("sap.ui.vk.AnimationTrackType",r);return r});
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/AnimationTrackValueType", ["sap/ui/base/DataType"],function(e){"use strict";var a={Scalar:"Scalar",Vector3:"Vector3",AngleAxis:"AngleAxis",Quaternion:"Quaternion",Euler:"Euler"};e.registerEnum("sap.ui.vk.AnimationTrackValueType",a);return a});
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/AnimationTrackValueTypeSize", ["./AnimationTrackValueType"],function(e){"use strict";var r={};r.get=function(r){switch(r){case e.Vector3:return 3;case e.AngleAxis:return 4;case e.Quaternion:return 4;case e.Euler:return 4;default:return 1}};return r},true);
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/Annotation", ["sap/ui/core/Control","./Core","./AnnotationStyle","./NodeUtils","./TransformationMatrix","sap/m/FormattedText","sap/ui/core/Element","sap/ui/richtexteditor/RichTextEditor","sap/ui/richtexteditor/library","./AnnotationRenderer"],function(i,t,d,e,A,l,n,h,Z,a){"use strict";var I=i.extend("sap.ui.vk.Annotation",{metadata:{library:"sap.ui.vk",properties:{annotationId:"string",name:"string",nodeRef:"any",text:{type:"string",defaultValue:""},style:{type:"sap.ui.vk.AnnotationStyle",defaultValue:d.Default},display:{type:"boolean",defaultValue:false},animate:{type:"boolean",defaultValue:true},animationDelay:{type:"float",defaultValue:-1},selected:{type:"boolean",defaultValue:false},editable:{type:"boolean",defaultValue:false},xCoordinate:{type:"float",defaultValue:0},yCoordinate:{type:"float",defaultValue:0},xOffset:{type:"float",defaultValue:0},yOffset:{type:"float",defaultValue:0},height:{type:"float"},width:{type:"float"}},associations:{viewport:{type:"sap.ui.vk.Viewport",multiple:false}},aggregations:{textEditor:{type:"sap.ui.core.Control",multiple:false}}},constructor:function(t,d){i.apply(this,arguments);if(this._viewport==null){this._topLimit=-.5;this._leftLimit=-.5}}});I.prototype.setViewport=function(i){this.setAssociation("viewport",i);this._viewport=n.getElementById(this.getViewport());if(this._viewport.getSafeArea().getDomRef()){var t=this._viewport.getSafeArea().getDomRef().getBoundingClientRect();var d=this._viewport.getDomRef().getBoundingClientRect();var e=d.left-t.left;var A=d.top-t.top;var l=this._viewport.normalizeRectangle(0,0,e,A);this._topLimit=-.5+l.height;this._leftLimit=-.5+l.width}};I.prototype._firePositionChanged=function(i){t.getEventBus().publish("sap.ui.vk","annotationPositionChanged",{annotation:i,x:i.getXCoordinate(),y:i.getYCoordinate()})};I.prototype._fireSizeChanged=function(i,d,e){t.getEventBus().publish("sap.ui.vk","annotationSizeChanged",{annotation:i,width:d,height:e})};I.prototype.getTargetNodes=function(){this._targetNodes=this._targetNodes||[];return this._targetNodes};I.prototype.getAttachmentNode=function(){return this._attachmentNode};I.prototype.setAttachmentNode=function(i){this._attachmentNode=i;if(i){this.invalidate()}};I.prototype.getDisplay=function(){if(this.getNodeRef()){var i=n.getElementById(this._viewport.getViewStateManager());return i.getVisibilityState(this.getNodeRef())}return this.getProperty("display")};I.prototype.setDisplay=function(i){if(this.getProperty("display")===i){return this}this.setProperty("display",i,true);var t=this.getDomRef();if(t){this._reverse=!i;this.invalidate()}return this};I.prototype.getSelected=function(){if(this.getNodeRef()){var i=n.getElementById(this._viewport.getViewStateManager());return i.getSelectionState(this.getNodeRef())}return this.getProperty("selected")};I.prototype.setSelected=function(i){this.setProperty("selected",i,!this.getEditable());if(i){this._setMaxZ()}var t=n.getElementById(this._viewport.getViewStateManager());var d=this.getNodeRef();if(t.getSelectionState(d)!==i){if(i){t.setSelectionStates(d,[])}else{t.setSelectionStates([],d)}}var e=this;var A=function(i){var t=e._textDiv.getDomRef();if(t==null){return}i.stopPropagation();t.scrollTo(t.scrollLeft+i.deltaX,t.scrollTop+i.deltaY)};if(i){this._localScroll=A;document.addEventListener("wheel",A,true)}else{if(this._localScroll){document.removeEventListener("wheel",this._localScroll,true)}this._localScroll=undefined}this._moving=false;return this};I.prototype.setAnnotationId=function(i){var t=this.getAnnotationId();this.setProperty("annotationId",i,true);if(this._viewport&&this.sourceData){this._viewport.getScene().setAnnotationPersistentId(this.sourceData.annotation,i);var d=this._viewport.getCurrentView();if(d!=null){d.getNodeInfos().forEach(function(d){if(d.annotationId===t){d.annotationId=i}})}}};I.prototype._getNodeRefScreenCenter=function(i,t){var d=e.centerOfNodes([t]);return i.projectToScreen(d[0],d[1],d[2],i.getCamera())};I.prototype._getSortIndex=function(i){this.zIndex=this.zIndex||"auto";var t=this.getTargetNodes()[0];if(t){var d=e.centerOfNodes([t]);var A=i.projectToScreen(d[0],d[1],d[2],i.getCamera());this.zIndex=Math.floor(1e4*(1-A.depth))}return this.zIndex};I.prototype._getOpacity=function(){if(this._viewport){var i=this.zIndex;var t=[];this._viewport.getAnnotations().forEach(function(i){if(i.getDisplay()===true){t.push(i)}});if(t.length>1){var d=Array.from(t,function(i){return i.zIndex});var e=Math.max.apply(null,d);var A=Math.min.apply(null,d);return.7+(i-A)*.3/(e-A)}}return 1};I.prototype._updateBlocked=function(){var i=this.getTargetNodes()[0];if(this.getDisplay()&&i){var t=this._viewport;const Z=t._getViewStateManagerThreeJS();var d=this._getNodeRefScreenCenter(t,i);var e=t.hitTest(d.x,d.y);var A=this.getDomRef();if(Z.getVisibilityState(i)==false){A.style.visibility="hidden"}else{A.style.visibility="visible"}if(e&&A){var l=[];i._vkTraverseMeshNodes(function(i){l.push(i)});if(l.indexOf(e.object)>=0){A.style.visibility="visible"}else{var n=Z.getTransformationWorld(e.object).translation;var h=t.projectToScreen(n[0],n[1],n[2],t.getCamera());if(h.depth<d.depth){A.style.visibility="hidden"}}}}return this.getDisplay()};I.prototype.setName=function(i){this.setProperty("name",i);if(this.getNodeRef()){this.getNodeRef().name=i}};I.prototype.getName=function(){if(this.getNodeRef()){return this.getNodeRef().name}return this.getProperty("name")};I.prototype.setText=function(i){this.setProperty("text",i,true);if(this.sourceData){this.sourceData.annotation.text={html:i}}if(this.getTextEditor()){this._textDiv.value=i;return this}if(this._textDiv==null){this._textDiv=new l({width:this._textWidth?this._textWidth+"px":"auto",height:this._textHeight?this._textHeight+"px":"auto"});this._textDiv.addStyleClass("sapUiVizKitAnnotationText")}if(this.getAnimate()&&(this.getStyle()===d.Random||this.getStyle()===d.Expand)){this._setSpanText(i)}else{this._textDiv.setHtmlText(i)}this._textDiv.invalidate();this.update();return this};I.prototype._setSpanText=function(i){if(this.getTextEditor()){return this}var t="";for(var d=0;d<i.length;d++){if(i[d]==="<"){t+="<";while(i[d]!==">"){d++;t+=i[d]}}if(i[d]==="&"){t+='<span class="sapThemeVITAnnotation">&';while(i[d]!==";"){d++;t+=i[d]}t+="</span>"}else if(i[d]!==">"){t+='<span class="sapThemeVITAnnotation">';t+=i[d];t+="</span>"}}this._textDiv.setHtmlText(t);return this};I.prototype.setStyle=function(i){this.setProperty("style",i);if(this.sourceData){this.sourceData.annotation.style=i}this.setText(this.getText())};I.prototype.setAnimate=function(i){this.setProperty("animate",i);if(this.sourceData){this.sourceData.annotation.animate=i}this.setText(this.getText())};I.prototype._setMaxZ=function(){var i=this.getDomRef();if(i){var t=Math.max.apply(null,this._viewport.getAnnotations().map(function(i){return i.zIndex||1}));if(!this.zIndex||this.zIndex<t){this.zIndex=t+1}i.style.zIndex=this.zIndex}};I.prototype.onclick=function(i){if(this.getTextEditor()==null&&!this._moving){if(this._firstClick){t.getEventBus().publish("sap.ui.vk","annotationDoubleClicked",{annotation:this});this._firstClick=false}else{this._firstClick=true;setTimeout(function(){if(this._firstClick){this._firstClick=false;this._viewport.tapObject(this.getNodeRef())}}.bind(this),250)}}i.stopPropagation()};I.prototype.openEditor=function(){if(!this.getEditable()){return null}var i=new h({editorType:Z.EditorType.TinyMCE4,width:this._textDiv.getWidth(),height:this._textDiv.getHeight(),value:this.getText()});if(this._textDiv){this._textDiv.destroy()}i.addStyleClass("sapUiVizKitRichTextEditor");this._textDiv=i;this.setTextEditor(i);return i};I.prototype.closeEditor=function(){if(this.getTextEditor()==null){return}var i=this._textDiv.getValue();this.destroyTextEditor();this._textDiv=null;this.setText(i)};I.prototype.onAfterRendering=function(){var i=this.getDomRef();if(i){this._initialOffsetWidth=i.offsetWidth;this._initialOffsetHeight=i.offsetHeight;if(!this.getDisplay()){i.style.visibility="hidden"}if(this.getAnimate()&&this.getAnimationDelay()>0){i.style.animationDelay=this.getAnimationDelay()+"s"}if(this._textDiv){var t=this._textDiv.getDomRef();if(t){var e=this.getAnimationDelay();if(e===-1){e=0}var A="";var l=t.getElementsByTagName("span");var n;var h=[];for(var Z=0;Z<l.length;Z++){if(l[Z].className==="sapThemeVITAnnotation"){h.push(l[Z].style)}}if(this.getStyle()===d.Random){A=this.getAnimate()?"annotationRandomTextSpan":"annotationStatic";for(var a=0;a<h.length;a++){n=h[a];var I=e+Math.random()+"s";n.animationName=A;n.animationDuration="4s";n.animationTimingFunction="linear";n.animationDelay=I;n.animationIterationCount="1";n.animationDirection="alternate";n.animationFillMode="both"}}else if(this.getStyle()===d.Expand){A=this.getAnimate()?"annotationExpandTextSpan":"annotationStatic";for(var m=0;m<h.length;m++){n=h[m];n.animationName=A;n.animationDuration=.1/h.length*(m+1)+"s";n.animationTimingFunction="linear";n.animationDelay=e+.5+"s"}}}}this.setXCoordinate(this.getXCoordinate());this.setYCoordinate(this.getYCoordinate());this.setWidth(this.getWidth());this.setHeight(this.getHeight());this.update()}this.setEditableState(this.getEditable()&&this.getSelected());if(this.zIndex){i.style.zIndex=this.zIndex}};I.prototype.setEditable=function(i){if(this.getEditable()==i){return}this.setProperty("editable",i);if(this.sourceData){this.sourceData.annotation.editable=i}this._previousState=this._previousState||{};var t=this.getDomRef();if(t&&i){var d=t.getBoundingClientRect();this._previousState.x=d.x;this._previousState.y=d.y}};I.prototype.setHeight=function(i){if(i<0){return}this.setProperty("height",i,true);if(this.getNodeRef()){this.getNodeRef().scale.setY(i)}if(this._viewport&&this._textDiv&&this._textDiv.getDomRef()){var t=this._textDiv.getDomRef();var d=this._viewport.deNormalizeRectangle(0,0,0,i);var e=d.height;if(this._textDiv.getNativeApi){if(this._resized){t.style.height="calc("+d.height+"px)"}else{t.style.height="calc("+d.height+"px + 0.6rem)"}}else{t.style.height="calc("+d.height+"px - 1rem)"}var A=t.getBoundingClientRect();var l=this._viewport.getDomRef().getBoundingClientRect();if(t.clientHeight<t.scrollHeight){t.style.height="calc("+t.scrollHeight+"px - 1rem)";e=t.scrollHeight}if(e+A.y>l.y+l.height){t.style.height=Math.round(l.y+l.height-A.y).toString()+"px"}this._textDiv.setHeight(t.style.height)}};I.prototype.setWidth=function(i){if(i<0){return}this.setProperty("width",i,true);if(this.getNodeRef()){this.getNodeRef().scale.setX(i)}if(this._viewport&&this._textDiv&&this._textDiv.getDomRef()){var t=this._viewport.deNormalizeRectangle(0,0,i,0);var d=this._textDiv.getDomRef();var e=t.width;if(this._textDiv.getNativeApi){if(this._resized){d.style.width="calc("+t.width+"px)"}else{d.style.width="calc("+t.width+"px + 0.6rem)"}}else{d.style.width="calc("+t.width+"px - 1rem)"}if(d.clientWidth<d.scrollWidth){d.style.maxWidth=d.style.width}else{d.style.maxWidth=d.style.width}var A=d.getBoundingClientRect();var l=this._viewport.getDomRef().getBoundingClientRect();if(e+A.x+26>l.x+l.width){d.style.width=Math.round(l.x+l.width-A.x-26).toString()+"px"}this._textDiv.setWidth(d.style.width)}};I.prototype.setXCoordinate=function(i){if(this._viewport&&this._textDiv&&this._textDiv.getDomRef()){if(i<this._leftLimit){i=this._leftLimit}var t=this._viewport.normalizeRectangle(0,0,96,0);if(i>-this._leftLimit-t.width){i=-this._leftLimit-t.width}if(i<this._leftLimit){i=this._leftLimit}var d=this._viewport.deNormalizeRectangle(i,0,0,0);this.getDomRef().style.left=d.x+"px"}this.setProperty("xCoordinate",i,true);if(this.getNodeRef()){this.getNodeRef().position.setX(i)}};I.prototype.setYCoordinate=function(i){if(this._viewport&&this._textDiv&&this._textDiv.getDomRef()){var t=this._textDiv.getDomRef();var d=this._viewport.normalizeRectangle(0,0,0,t.clientHeight);if(t.scrollHeight>t.clientHeight||d.height>1){t.style.setProperty("--overflow","auto")}if(i<this._topLimit){i=this._topLimit}if(i>-this._topLimit-d.height){i=-this._topLimit-d.height}if(i<this._topLimit){i=this._topLimit}var e=this._viewport.deNormalizeRectangle(0,i,0,0);this.getDomRef().style.top=e.y+"px"}this.setProperty("yCoordinate",i,true);if(this.getNodeRef()){this.getNodeRef().position.setY(i)}};I.prototype._resizeEnd=function(){this._handleViewportStop();var i=this._textDiv.getDomRef();var t=this._viewport.normalizeRectangle(0,0,i.clientWidth,i.clientHeight);this._resized=true;this.setWidth(t.width);this.setHeight(t.height);this._fireSizeChanged(this,t.width,t.height)};I.prototype.setEditableState=function(i){if(!i){this.ontouchstart=null;return}var t=new Map;var d=[];var e=this._viewport;var A=function(){d=e.getAnnotations().filter(function(i){return i.getEditable()&&i.getSelected()});d.forEach(function(i){var d=window.getComputedStyle(i._textDiv.getDomRef());var e=parseInt(d.width.slice(0,-2),10);var A=parseInt(d.height.slice(0,-2),10);var l=parseInt(d.maxWidth.slice(0,-2),10);t.set(i.getAnnotationId(),{width:e,height:A,maxWidth:l})})};var l=this;var n=this.getDomRef();var h=n.childNodes;var Z={strategies:{sapUiVizKitAnnotationElement0:c,sapUiVizKitAnnotationElement1:g,sapUiVizKitAnnotationElement2:o,sapUiVizKitAnnotationElement3:G,sapUiVizKitAnnotationElement4:N,sapUiVizKitAnnotationElement5:Y,sapUiVizKitAnnotationElement6:b,sapUiVizKitAnnotationElement7:p},resize:a};this.ontouchstart=function(i){var t=i||event;t.stopPropagation();A();var e=Z.strategies[t.targetTouches[0].target.className];if(e){Z.resize(t,e)}else{l._previousState.offsetTop=l._offsetTop;l._previousState.offsetLeft=l._offsetTop;d.forEach(function(i){i._initialX=t.clientX?t.clientX:t.targetTouches[0].clientX;i._initialY=t.clientY?t.clientY:t.targetTouches[0].clientY});var n=function(i){t=i||event;l._viewport._viewportGestureHandler._gesture=false;t.stopPropagation();d.forEach(function(i){i._moving=true;var d=t.clientX?t.clientX:t.targetTouches[0].clientX;var e=t.clientY?t.clientY:t.targetTouches[0].clientY;i._currentX=d-i._initialX;i._currentY=e-i._initialY;m(i._currentX,i._currentY,i.getDomRef());i.update()})};var h=function(i){t=i||event;t.stopPropagation();d.forEach(function(i){i._handleViewportStop()});document.removeEventListener("mousemove",n);document.removeEventListener("mouseup",h);document.removeEventListener("touchmove",n);document.removeEventListener("touchend",h)};document.addEventListener("mousemove",n);document.addEventListener("mouseup",h);document.addEventListener("touchmove",n);document.addEventListener("touchend",h);l.update()}};function a(i,e){var A=i.clientX?i.clientX:i.targetTouches[0].clientX;var n=i.clientY?i.clientY:i.targetTouches[0].clientY;var Z=A-h[0].offsetLeft;var a=n-h[0].offsetTop;var I=jQuery(i.currentTarget).control()[0]._viewport.$();var m=jQuery("iframe[id$='-textarea_ifr']");if(m.length){var c=jQuery("<div></div>");c.attr("id","rte_ifr_cov");c.css({position:"absolute"});c.css({opacity:0});c.css({top:I.offset().top,left:I.offset().left});c.height(I.height());c.width(I.width());jQuery("body").append(c[0])}document.onmousemove=function(i){l._viewport._viewportGestureHandler._gesture=false;var t=i||event;var A=t.clientX?t.clientX:t.targetTouches[0].clientX;var n=t.clientY?t.clientY:t.targetTouches[0].clientY;var h=A-Z;var I=n-a;d.forEach(function(i){i._moving=true;e(i,h,I);i.update()})};document.onmouseup=function(){var i=jQuery("#rte_ifr_cov");if(i){i.remove()}d.forEach(function(i){var d=t.get(i.getAnnotationId());d.width=i._textWidth;d.height=i._textHeight;d.maxWidth=i._textMaxWidth;i._resizeEnd()});document.onmousemove=null;document.onmouseup=null;document.ontouchmove=null;document.ontouchend=null};document.ontouchmove=document.onmousemove;document.ontouchend=document.onmouseup}var I=function(i,t,d,e){var A=i._textDiv.getDomRef();if(t){i._textWidth=t;A.style.width=i._textWidth+"px";i._textDiv.setProperty("width",A.style.width,true)}if(d){i._textMaxWidth=d;A.style.maxWidth=i._textMaxWidth+"px"}if(e){i._textHeight=e;A.style.height=i._textHeight+"px";i._textDiv.setProperty("height",A.style.height,true)}};function c(i,d,e){I(i,t.get(i.getAnnotationId()).width-d,t.get(i.getAnnotationId()).maxWidth-d,t.get(i.getAnnotationId()).height-e);i._currentX=d;i._currentY=e;m(d,e,i.getDomRef())}function g(i,d,e){I(i,null,null,t.get(i.getAnnotationId()).height-e);i._currentX=0;i._currentY=e;m(0,e,i.getDomRef())}function o(i,d,e){I(i,t.get(i.getAnnotationId()).width+d,t.get(i.getAnnotationId()).maxWidth+d,t.get(i.getAnnotationId()).height-e);i._currentX=0;i._currentY=e;m(0,e,i.getDomRef())}function G(i,d,e){I(i,t.get(i.getAnnotationId()).width+d,t.get(i.getAnnotationId()).maxWidth+d,null)}function N(i,d,e){I(i,t.get(i.getAnnotationId()).width+d,t.get(i.getAnnotationId()).maxWidth+d,t.get(i.getAnnotationId()).height+e)}function Y(i,d,e){I(i,null,null,t.get(i.getAnnotationId()).height+e)}function b(i,d,e){I(i,t.get(i.getAnnotationId()).width-d,t.get(i.getAnnotationId()).maxWidth-d,t.get(i.getAnnotationId()).height+e);i._currentX=d;i._currentY=0;m(d,0,i.getDomRef())}function p(i,d,e){I(i,t.get(i.getAnnotationId()).width-d,t.get(i.getAnnotationId()).maxWidth-d,null);i._currentX=d;i._currentY=0;m(d,0,i.getDomRef())}};I.prototype.update=function(){var i=this.getDomRef();if(!i){return}var t=this._updateBlocked();if(this.getProperty("display")!=t){this.setDisplay(t)}if(!this.getText()){i.style.display=this.getDisplay()?"block":"none"}var e=this.getSelected();if(this.getProperty("selected")!=e){this.setSelected(e)}var A=i.childNodes[8];var l=i.childNodes[9];if(this.getWidth()&&!this._moving){this.setWidth(this.getWidth())}if(this.getHeight()&&!this._moving){this.setHeight(this.getHeight())}this._resized=false;if(!this.getAnimate()){i.style.setProperty("--animation-name","annotationStatic")}var n=this.getTargetNodes()[0];var h=n?this._getNodeRefScreenCenter(this._viewport,n):{x:0,y:0,depth:0};var Z=this._viewport.getDomRef().getBoundingClientRect();if(this.getAttachmentNode()){var a=this._getNodeRefScreenCenter(this._viewport,this.getAttachmentNode());if(a.depth>1){a.x=Z.width+1e3}var I=this._viewport.normalizeRectangle(a.x,a.y,0,0);this.setXCoordinate(I.x+this.getXOffset());this.setYCoordinate(I.y+this.getYOffset())}var m=this._viewport.deNormalizeRectangle(this.getXCoordinate(),this.getYCoordinate(),0,0);if(this.getEditable()&&this.getSelected()){if(this._previousState.x===undefined){var g=i.getBoundingClientRect();this._previousState.x=g.x;this._previousState.y=g.y}i.style.left=this._previousState.x-Z.x+"px";i.style.top=this._previousState.y-Z.y+"px"}else{switch(this.getStyle()){case d.Default:i.childNodes[0].style.visibility="hidden";i.childNodes[1].style.visibility="hidden";i.childNodes[2].style.visibility="hidden";i.childNodes[3].style.visibility="hidden";i.childNodes[4].style.visibility="hidden";break;case d.Explode:i.childNodes[0].style.visibility="hidden";i.childNodes[1].style.visibility="hidden";i.childNodes[2].style.visibility="hidden";break;case d.Square:i.childNodes[0].style.visibility="hidden";i.childNodes[1].style.visibility="hidden";i.childNodes[2].style.visibility="hidden";break;case d.Random:i.childNodes[0].style.visibility="hidden";break;default:break}}if(n){var o=h.x-m.x;var G=h.y-m.y;if(this._moving){o-=this._currentX;G-=this._currentY}A.style.left=o+"px";A.style.top=G+"px";var N=new Map([[d.Default,{isElbow:true,toHeight:.5}],[d.Explode,{isElbow:true,toHeight:.5}],[d.Square,{isElbow:false,toHeight:.95}],[d.Random,{isElbow:false,toHeight:.5}],[d.Expand,{isElbow:true,toHeight:.5}]]).get(this.getStyle());c(A,i,i.childNodes[10],{isElbow:N.isElbow,toHeight:N.toHeight})}else{A.style.visibility="hidden";l.style.visibility="hidden"}var Y=this.getNodeRef();this.setXCoordinate(Y?Y.position.x:this.getProperty("xCoordinate"));this.setYCoordinate(Y?Y.position.y:this.getProperty("yCoordinate"))};I.prototype._handleViewportStop=function(){setTimeout(function(){this._moving=false;this.update()}.bind(this),300);var i=this.getDomRef();var t=window.getComputedStyle(i);var d=i.style.transform;i.style.transform="";this._currentX=0;this._currentY=0;var e=parseFloat(d.substring(d.indexOf("(")+1,d.indexOf(",")));var A=parseFloat(d.substring(d.indexOf(",")+1,d.indexOf(")")));if(e||A){i.style.left=parseFloat(t.left)+e+"px";i.style.top=parseFloat(t.top)+A+"px";this._offsetTop=i.offsetTop;this._offsetLeft=i.offsetLeft;var l=this._viewport.normalizeRectangle(this._offsetLeft,this._offsetTop,0,0);this.setXCoordinate(l.x);this.setYCoordinate(l.y);this._firePositionChanged(this)}};function m(i,t,d){d.style.transform="translate("+i+"px, "+t+"px)"}function c(i,t,d,e){e=e||{};var A=i.getBoundingClientRect();var l=t.getBoundingClientRect();var n=A.x-l.x+A.width/2;var h=A.y-l.y+A.height/2;var Z=n<0?0:l.width;var a=l.height*(e.toHeight||.5);if(n<0&&!t.classList.contains("leaderlineLeft")){t.classList.remove("leaderlineRight");t.classList.add("leaderlineLeft")}if(n>=0&&!t.classList.contains("leaderlineRight")){t.classList.remove("leaderlineLeft");t.classList.add("leaderlineRight")}var I=Math.min(n,Z);var m=Math.min(h,a);d.style.left=I+"px";d.style.top=m+"px";d.style.width=Math.abs(Z-n)+"px";d.style.height=Math.abs(a-h)+"px";var c=Z>n?0:n-Z;var g=a>h?0:h-a;var o=Z-n;var G=a-h;var N="M"+c+" "+g+"v"+G+"h"+o;if(n>0&&n<l.width){N="M"+c+" "+g+"h"+o+"v"+G+"h-2"}if(!e.isElbow){N="M"+c+" "+g+"l"+o+" "+G}var Y=d.childNodes[0];if(N!==Y.getAttribute("d")){Y.setAttribute("d",N);Y.style.setProperty("--stroke-dasharray",Y.getTotalLength());Y.style.setProperty("--stroke-dashoffset",Y.getTotalLength())}}I.prototype.setLeaderLine=function(i,t,d){var e=t.getBoundingClientRect();var A=i.offsetTop+i.offsetHeight/2;var l=e.height/2;var n=i.offsetLeft+i.offsetWidth/2;var h=0;if(n>h){h=e.width}var Z=Math.abs(l-A);var a=Math.abs(h-n);var I=Math.sqrt(Z*Z+a*a);var m=180/Math.PI*Math.acos(Z/I);var c,g;if(l>A){c=(l-A)/2+A}else{c=(A-l)/2+l}if(h>n){g=(h-n)/2+n}else{g=(n-h)/2+h}if(A<l&&n<h||l<A&&h<n||A>l&&n>h||l>A&&h>n){m*=-1}c-=I/2;d.style.transform="rotate("+m+"deg)";d.style.top=c+"px";d.style.left=g+"px";d.style.height=I+"px"};I.prototype.getTransform=function(){var i=this.getNodeRef();i.updateMatrix();return A.convertTo4x3(i.matrix.elements)};I.prototype.setTransform=function(i){var t=this.getNodeRef();t.position.set(i[9],i[10],i[11]);t.scale.set(i[0],i[4],i[8]);t.updateMatrix();this.setXCoordinate(t.position.x);this.setYCoordinate(t.position.y);this.setWidth(t.scale.x);this.setHeight(t.scale.y);this.update();return this};I.prototype.updateNodeId=function(i){var t=this.getNodeRef();t.userData.nodeId=i;this.sourceData.annotation.nodeId=i;this._viewport.getScene().setNodePersistentId(t,i);return this};I.prototype.setInitialOffset=function(){var i=this.getTargetNodes().values().next().value;var t={x:0,y:0,width:.1,height:.08};if(i&&this.getXCoordinate()===0&&this.getYCoordinate()===0){var d=this._getNodeRefScreenCenter(this._viewport,i);var e=this._viewport.getDomRef().getBoundingClientRect();var A=d.x>=e.width/2?d.x-150:d.x+50;var l=d.y>=e.height/2?d.y+20:d.y-120;t=this._viewport.normalizeRectangle(A,l,0,0)}if(t.x<-.5){t.x=-.5}else if(t.x>.5){t.x=.4}if(t.y<-.5){t.y=-.5}else if(t.y>.5){t.y=.35}this.setTransform([.1,0,0,0,.08,0,0,0,1,t.x,t.y,0]);return this};I.prototype.fitToText=function(i,t){if(this._textDiv==null||this._textDiv.getDomRef()==null){return this}var d=document.createElement("div");d.style.setProperty("whiteSpace","nowrap","important");d.style.setProperty("visibility","hidden","important");d.style.setProperty("position","absolute");if(i!=null){d.style.maxWidth=i+"px"}if(t!=null){d.style.maxHeight=t+"px"}d.innerHTML=this._textDiv.getDomRef().innerHTML;document.body.appendChild(d);d.style.setProperty("width","calc("+d.clientWidth+"px + 1rem)");d.style.setProperty("height","calc("+d.clientHeight+"px + 1rem)");var e=this._viewport.normalizeRectangle(0,0,d.clientWidth,d.clientHeight);document.body.removeChild(d);this.setWidth(e.width);this.setHeight(e.height);return this};I.getStyles=function(){var i=[{style:d.Default,darkThemeSrc:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAGAAAABACAYAAADlNHIOAAAABGdBTUEAALGPC/xhBQAACktpQ0NQc1JHQiBJRUM2MTk2Ni0yLjEAAEiJnVNnVFPpFj333vRCS4iAlEtvUhUIIFJCi4BUaaISkgChhBgSQOyIqMCIoiKCFRkUccDREZCxIoqFQbH3AXkIKOPgKDZU3g/eGn2z5r03b/avvfY5Z53vnH0+AEZgsESahaoBZEoV8ogAHzw2Lh4ndwMKVCCBA4BAmC0LifSPAgDg+/Hw7IgAH/gCBODNbUAAAG7YBIbhOPx/UBfK5AoAJAwApovE2UIApBAAMnIVMgUAMgoA7KR0mQIAJQAAWx4bFw+AagEAO2WSTwMAdtIk9wIAtihTKgJAowBAJsoUiQDQDgBYl6MUiwCwYAAoypGIcwGwmwBgkqHMlABg7wCAnSkWZAMQGABgohALUwEI9gDAkEdF8AAIMwEojJSveNJXXCHOUwAA8LJki+WSlFQFbiG0xB1cXbl4oDg3Q6xQ2IQJhOkCuQjnZWXKBNLFAJMzAwCARnZEgA/O9+M5O7g6O9s42jp8taj/GvyLiI2L/5c/r8IBAQCE0/VF+7O8rBoA7hgAtvGLlrQdoGUNgNb9L5rJHgDVQoDmq1/Nw+H78fBUhULmZmeXm5trKxELbYWpX/X5nwl/AV/1s+X78fDf14P7ipMFygwFHhHggwuzMrKUcjxbJhCKcZs/HvHfLvzzd0yLECeL5WKpUIxHS8S5EmkKzsuSiiQKSZYUl0j/k4l/s+wPmLxrAGDVfgb2QltQu8oG7JcuILDogCXsAgDkd9+CqdEQBgAxBoOTdw8AMPmb/x1oGQCg2ZIUHACAFxGFC5XynMkYAQCACDRQBTZogz4YgwXYgCO4gDt4gR/MhlCIgjhYAEJIhUyQQy4shVVQBCWwEbZCFeyGWqiHRjgCLXACzsIFuALX4BY8gF4YgOcwCm9gHEEQMsJEWIg2YoCYItaII8JFZiF+SDASgcQhiUgKIkWUyFJkNVKClCNVyF6kHvkeOY6cRS4hPcg9pA8ZRn5DPqAYykDZqB5qhtqhXNQbDUKj0PloCroIzUcL0Q1oJVqDHkKb0bPoFfQW2os+R8cwwOgYBzPEbDAuxsNCsXgsGZNjy7FirAKrwRqxNqwTu4H1YiPYewKJwCLgBBuCOyGQMJcgJCwiLCeUEqoIBwjNhA7CDUIfYZTwmcgk6hKtiW5EPjGWmELMJRYRK4h1xGPE88RbxAHiGxKJxCGZk1xIgaQ4UhppCamUtJPURDpD6iH1k8bIZLI22ZrsQQ4lC8gKchF5O/kQ+TT5OnmA/I5CpxhQHCn+lHiKlFJAqaAcpJyiXKcMUsapalRTqhs1lCqiLqaWUWupbdSr1AHqOE2dZk7zoEXR0miraJW0Rtp52kPaKzqdbkR3pYfTJfSV9Er6YfpFeh/9PUODYcXgMRIYSsYGxn7GGcY9xismk2nG9GLGMxXMDcx65jnmY+Y7FZaKrQpfRaSyQqVapVnlusoLVaqqqaq36gLVfNUK1aOqV1VH1KhqZmo8NYHacrVqteNqd9TG1FnqDuqh6pnqpeoH1S+pD2mQNcw0/DREGoUa+zTOafSzMJYxi8cSslazalnnWQNsEtuczWensUvY37G72aOaGpozNKM18zSrNU9q9nIwjhmHz8nglHGOcG5zPkzRm+I9RTxl/ZTGKdenvNWaquWlJdYq1mrSuqX1QRvX9tNO196k3aL9SIegY6UTrpOrs0vnvM7IVPZU96nCqcVTj0y9r4vqWulG6C7R3afbpTump68XoCfT2653Tm9En6PvpZ+mv0X/lP6wActgloHEYIvBaYNnuCbujWfglXgHPmqoaxhoqDTca9htOG5kbjTXqMCoyeiRMc2Ya5xsvMW43XjUxMAkxGSpSYPJfVOqKdc01XSbaafpWzNzsxiztWYtZkPmWuZ883zzBvOHFkwLT4tFFjUWNy1JllzLdMudltesUCsnq1Sraqur1qi1s7XEeqd1zzTiNNdp0mk10+7YMGy8bXJsGmz6bDm2wbYFti22L+xM7OLtNtl12n22d7LPsK+1f+Cg4TDbocChzeE3RytHoWO1483pzOn+01dMb53+cob1DPGMXTPuOrGcQpzWOrU7fXJ2cZY7NzoPu5i4JLrscLnDZXPDuKXci65EVx/XFa4nXN+7Obsp3I64/epu457uftB9aKb5TPHM2pn9HkYeAo+9Hr2z8FmJs/bM6vU09BR41ng+8TL2EnnVeQ16W3qneR/yfuFj7yP3OebzlufGW8Y744v5BvgW+3b7afjN9avye+xv5J/i3+A/GuAUsCTgTCAxMChwU+Advh5fyK/nj852mb1sdkcQIygyqCroSbBVsDy4LQQNmR2yOeThHNM50jktoRDKD90c+ijMPGxR2I/hpPCw8OrwpxEOEUsjOiNZkQsjD0a+ifKJKot6MNdirnJue7RqdEJ0ffTbGN+Y8pjeWLvYZbFX4nTiJHGt8eT46Pi6+LF5fvO2zhtIcEooSrg933x+3vxLC3QWZCw4uVB1oWDh0URiYkziwcSPglBBjWAsiZ+0I2lUyBNuEz4XeYm2iIbFHuJy8WCyR3J58lCKR8rmlOFUz9SK1BEJT1IleZkWmLY77W16aPr+9ImMmIymTEpmYuZxqYY0XdqRpZ+Vl9Ujs5YVyXoXuS3aumhUHiSvy0ay52e3KtgKmaJLaaFco+zLmZVTnfMuNzr3aJ56njSva7HV4vWLB/P9879dQlgiXNK+1HDpqqV9y7yX7V2OLE9a3r7CeEXhioGVASsPrKKtSl/1U4F9QXnB69Uxq9sK9QpXFvavCVjTUKRSJC+6s9Z97e51hHWSdd3rp6/fvv5zsaj4col9SUXJx1Jh6eVvHL6p/GZiQ/KG7jLnsl0bSRulG29v8tx0oFy9PL+8f3PI5uYt+JbiLa+3Ltx6qWJGxe5ttG3Kbb2VwZWt2022b9z+sSq16la1T3XTDt0d63e83SnaeX2X167G3Xq7S3Z/2CPZc3dvwN7mGrOain2kfTn7ntZG13Z+y/22vk6nrqTu037p/t4DEQc66l3q6w/qHixrQBuUDcOHEg5d+873u9ZGm8a9TZymksNwWHn42feJ398+EnSk/Sj3aOMPpj/sOMY6VtyMNC9uHm1JbeltjWvtOT77eHube9uxH21/3H/C8ET1Sc2TZadopwpPTZzOPz12RnZm5GzK2f72he0PzsWeu9kR3tF9Puj8xQv+F851eneevuhx8cQlt0vHL3Mvt1xxvtLc5dR17Cenn451O3c3X3W52nrN9Vpbz8yeU9c9r5+94Xvjwk3+zSu35tzquT339t07CXd674ruDt3LuPfyfs798QcrHxIfFj9Se1TxWPdxzc+WPzf1Ovee7PPt63oS+eRBv7D/+T+y//FxoPAp82nFoMFg/ZDj0Ilh/+Frz+Y9G3guez4+UvSL+i87Xli8+OFXr1+7RmNHB17KX078VvpK+9X+1zNet4+FjT1+k/lm/G3xO+13B95z33d+iPkwOJ77kfyx8pPlp7bPQZ8fTmROTPwTA5jz/IzFdaUAAAAgY0hSTQAAeiYAAICEAAD6AAAAgOgAAHUwAADqYAAAOpgAABdwnLpRPAAAAAlwSFlzAAALEwAACxMBAJqcGAAAEFRpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDkuMC1jMDAwIDc5LjE3MWMyN2ZhYiwgMjAyMi8wOC8xNi0yMjozNTo0MSAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bWxuczpkYz0iaHR0cDovL3B1cmwub3JnL2RjL2VsZW1lbnRzLzEuMS8iIHhtbG5zOnhtcE1NPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvbW0vIiB4bWxuczpzdEV2dD0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL3NUeXBlL1Jlc291cmNlRXZlbnQjIiB4bWxuczpzdFJlZj0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL3NUeXBlL1Jlc291cmNlUmVmIyIgeG1sbnM6cGhvdG9zaG9wPSJodHRwOi8vbnMuYWRvYmUuY29tL3Bob3Rvc2hvcC8xLjAvIiB4bWxuczp0aWZmPSJodHRwOi8vbnMuYWRvYmUuY29tL3RpZmYvMS4wLyIgeG1sbnM6ZXhpZj0iaHR0cDovL25zLmFkb2JlLmNvbS9leGlmLzEuMC8iIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIDIxLjEgKE1hY2ludG9zaCkiIHhtcDpDcmVhdGVEYXRlPSIyMDIwLTAzLTI2VDExOjEwOjAyKzEzOjAwIiB4bXA6TWV0YWRhdGFEYXRlPSIyMDIyLTEyLTE1VDE0OjM2OjQ5KzEzOjAwIiB4bXA6TW9kaWZ5RGF0ZT0iMjAyMi0xMi0xNVQxNDozNjo0OSsxMzowMCIgZGM6Zm9ybWF0PSJpbWFnZS9wbmciIHhtcE1NOkluc3RhbmNlSUQ9InhtcC5paWQ6MzFjMjU4NjMtOTkwNi00ZjdhLWIxODUtYjE0ZjM2YTU3NGY2IiB4bXBNTTpEb2N1bWVudElEPSJhZG9iZTpkb2NpZDpwaG90b3Nob3A6NjRmMzNiZmItNGYxZi00YTQyLTgzY2ItY2JhZjRmMWI0Njc0IiB4bXBNTTpPcmlnaW5hbERvY3VtZW50SUQ9InhtcC5kaWQ6ZWU1NTEwZjgtNmI2ZC00NDJhLTkwOTMtMzQ4NmNlNDA0ZDU0IiBwaG90b3Nob3A6Q29sb3JNb2RlPSIzIiB0aWZmOk9yaWVudGF0aW9uPSIxIiB0aWZmOlhSZXNvbHV0aW9uPSI3MjAwMDAvMTAwMDAiIHRpZmY6WVJlc29sdXRpb249IjcyMDAwMC8xMDAwMCIgdGlmZjpSZXNvbHV0aW9uVW5pdD0iMiIgZXhpZjpDb2xvclNwYWNlPSI2NTUzNSIgZXhpZjpQaXhlbFhEaW1lbnNpb249Ijk2IiBleGlmOlBpeGVsWURpbWVuc2lvbj0iNjQiPiA8eG1wTU06SGlzdG9yeT4gPHJkZjpTZXE+IDxyZGY6bGkgc3RFdnQ6YWN0aW9uPSJjcmVhdGVkIiBzdEV2dDppbnN0YW5jZUlEPSJ4bXAuaWlkOmVlNTUxMGY4LTZiNmQtNDQyYS05MDkzLTM0ODZjZTQwNGQ1NCIgc3RFdnQ6d2hlbj0iMjAyMC0wMy0yNlQxMToxMDowMisxMzowMCIgc3RFdnQ6c29mdHdhcmVBZ2VudD0iQWRvYmUgUGhvdG9zaG9wIDIxLjEgKE1hY2ludG9zaCkiLz4gPHJkZjpsaSBzdEV2dDphY3Rpb249InNhdmVkIiBzdEV2dDppbnN0YW5jZUlEPSJ4bXAuaWlkOjEyYTg4Mjg4LWYzOWItNDU4My04M2FlLTk0NTExY2FjZGU5OCIgc3RFdnQ6d2hlbj0iMjAyMC0wMy0yNlQxNDoxNTozMisxMzowMCIgc3RFdnQ6c29mdHdhcmVBZ2VudD0iQWRvYmUgUGhvdG9zaG9wIDIxLjEgKE1hY2ludG9zaCkiIHN0RXZ0OmNoYW5nZWQ9Ii8iLz4gPHJkZjpsaSBzdEV2dDphY3Rpb249InNhdmVkIiBzdEV2dDppbnN0YW5jZUlEPSJ4bXAuaWlkOmEwMDkzM2E5LTA4NzctNDRlYi04YThmLTZlZDYyZjA1ZDhlZCIgc3RFdnQ6d2hlbj0iMjAyMC0wMy0yNlQxNDozNDo1NCsxMzowMCIgc3RFdnQ6c29mdHdhcmVBZ2VudD0iQWRvYmUgUGhvdG9zaG9wIDIxLjEgKE1hY2ludG9zaCkiIHN0RXZ0OmNoYW5nZWQ9Ii8iLz4gPHJkZjpsaSBzdEV2dDphY3Rpb249ImNvbnZlcnRlZCIgc3RFdnQ6cGFyYW1ldGVycz0iZnJvbSBhcHBsaWNhdGlvbi92bmQuYWRvYmUucGhvdG9zaG9wIHRvIGltYWdlL3BuZyIvPiA8cmRmOmxpIHN0RXZ0OmFjdGlvbj0iZGVyaXZlZCIgc3RFdnQ6cGFyYW1ldGVycz0iY29udmVydGVkIGZyb20gYXBwbGljYXRpb24vdm5kLmFkb2JlLnBob3Rvc2hvcCB0byBpbWFnZS9wbmciLz4gPHJkZjpsaSBzdEV2dDphY3Rpb249InNhdmVkIiBzdEV2dDppbnN0YW5jZUlEPSJ4bXAuaWlkOjlmZGE3OTBiLTZlODQtNGVmNS1hNGYxLTg0ZWFiMGIwNWJjOCIgc3RFdnQ6d2hlbj0iMjAyMC0wMy0yNlQxNDozNDo1NCsxMzowMCIgc3RFdnQ6c29mdHdhcmVBZ2VudD0iQWRvYmUgUGhvdG9zaG9wIDIxLjEgKE1hY2ludG9zaCkiIHN0RXZ0OmNoYW5nZWQ9Ii8iLz4gPHJkZjpsaSBzdEV2dDphY3Rpb249InNhdmVkIiBzdEV2dDppbnN0YW5jZUlEPSJ4bXAuaWlkOmFiMmM1Y2ExLWUzYTQtNGViMi1hODg5LTBmNzUwOWVlYmJhNiIgc3RFdnQ6d2hlbj0iMjAyMi0xMi0xNVQwODoyNjowMSsxMzowMCIgc3RFdnQ6c29mdHdhcmVBZ2VudD0iQWRvYmUgUGhvdG9zaG9wIDI0LjAgKE1hY2ludG9zaCkiIHN0RXZ0OmNoYW5nZWQ9Ii8iLz4gPHJkZjpsaSBzdEV2dDphY3Rpb249ImNvbnZlcnRlZCIgc3RFdnQ6cGFyYW1ldGVycz0iZnJvbSBpbWFnZS9wbmcgdG8gYXBwbGljYXRpb24vdm5kLmFkb2JlLnBob3Rvc2hvcCIvPiA8cmRmOmxpIHN0RXZ0OmFjdGlvbj0iZGVyaXZlZCIgc3RFdnQ6cGFyYW1ldGVycz0iY29udmVydGVkIGZyb20gaW1hZ2UvcG5nIHRvIGFwcGxpY2F0aW9uL3ZuZC5hZG9iZS5waG90b3Nob3AiLz4gPHJkZjpsaSBzdEV2dDphY3Rpb249InNhdmVkIiBzdEV2dDppbnN0YW5jZUlEPSJ4bXAuaWlkOjZiOTY1MjJmLTA3OTYtNDZhMS1iY2JjLTM2ZmJhYzIyNmQ4OSIgc3RFdnQ6d2hlbj0iMjAyMi0xMi0xNVQwODoyNjowMSsxMzowMCIgc3RFdnQ6c29mdHdhcmVBZ2VudD0iQWRvYmUgUGhvdG9zaG9wIDI0LjAgKE1hY2ludG9zaCkiIHN0RXZ0OmNoYW5nZWQ9Ii8iLz4gPHJkZjpsaSBzdEV2dDphY3Rpb249InNhdmVkIiBzdEV2dDppbnN0YW5jZUlEPSJ4bXAuaWlkOjFjMjlhMTg2LWMyOTYtNDNkZC1iM2EwLTZiMzdjODQ3ZmI0OCIgc3RFdnQ6d2hlbj0iMjAyMi0xMi0xNVQxNDozNjo0OSsxMzowMCIgc3RFdnQ6c29mdHdhcmVBZ2VudD0iQWRvYmUgUGhvdG9zaG9wIDI0LjAgKE1hY2ludG9zaCkiIHN0RXZ0OmNoYW5nZWQ9Ii8iLz4gPHJkZjpsaSBzdEV2dDphY3Rpb249ImNvbnZlcnRlZCIgc3RFdnQ6cGFyYW1ldGVycz0iZnJvbSBhcHBsaWNhdGlvbi92bmQuYWRvYmUucGhvdG9zaG9wIHRvIGltYWdlL3BuZyIvPiA8cmRmOmxpIHN0RXZ0OmFjdGlvbj0iZGVyaXZlZCIgc3RFdnQ6cGFyYW1ldGVycz0iY29udmVydGVkIGZyb20gYXBwbGljYXRpb24vdm5kLmFkb2JlLnBob3Rvc2hvcCB0byBpbWFnZS9wbmciLz4gPHJkZjpsaSBzdEV2dDphY3Rpb249InNhdmVkIiBzdEV2dDppbnN0YW5jZUlEPSJ4bXAuaWlkOjMxYzI1ODYzLTk5MDYtNGY3YS1iMTg1LWIxNGYzNmE1NzRmNiIgc3RFdnQ6d2hlbj0iMjAyMi0xMi0xNVQxNDozNjo0OSsxMzowMCIgc3RFdnQ6c29mdHdhcmVBZ2VudD0iQWRvYmUgUGhvdG9zaG9wIDI0LjAgKE1hY2ludG9zaCkiIHN0RXZ0OmNoYW5nZWQ9Ii8iLz4gPC9yZGY6U2VxPiA8L3htcE1NOkhpc3Rvcnk+IDx4bXBNTTpEZXJpdmVkRnJvbSBzdFJlZjppbnN0YW5jZUlEPSJ4bXAuaWlkOjFjMjlhMTg2LWMyOTYtNDNkZC1iM2EwLTZiMzdjODQ3ZmI0OCIgc3RSZWY6ZG9jdW1lbnRJRD0iYWRvYmU6ZG9jaWQ6cGhvdG9zaG9wOjIyOTFjN2Q1LTdiMGYtNmI0YS1iMDNmLTZjMjlkMjBmZGI5MCIgc3RSZWY6b3JpZ2luYWxEb2N1bWVudElEPSJ4bXAuZGlkOmVlNTUxMGY4LTZiNmQtNDQyYS05MDkzLTM0ODZjZTQwNGQ1NCIvPiA8cGhvdG9zaG9wOkRvY3VtZW50QW5jZXN0b3JzPiA8cmRmOkJhZz4gPHJkZjpsaT5hZG9iZTpkb2NpZDpwaG90b3Nob3A6MjI5MWM3ZDUtN2IwZi02YjRhLWIwM2YtNmMyOWQyMGZkYjkwPC9yZGY6bGk+IDxyZGY6bGk+YWRvYmU6ZG9jaWQ6cGhvdG9zaG9wOjhhZDQ0NTBlLTdmZjUtYmU0Mi05ZjUwLThhNGQwZWE1ODJhZTwvcmRmOmxpPiA8L3JkZjpCYWc+IDwvcGhvdG9zaG9wOkRvY3VtZW50QW5jZXN0b3JzPiA8L3JkZjpEZXNjcmlwdGlvbj4gPC9yZGY6UkRGPiA8L3g6eG1wbWV0YT4gPD94cGFja2V0IGVuZD0iciI/Pt0YsxsAAAKNSURBVHic7duxbtpAHAbwz7TpgBu17hLaJRt5AqRsvELeoKO9VfILWDxCN1tiSN+AV2CrxOaRrUtJljqlrYdK5TIAqmPOJiS2vrP5/6QT5AjH6f+Fu2AbSykFwdNhT+DYSQBkEgDZS01f2aZg1TURg9VaD10AGI1Gp7r+IAie+3qNU1KLX1WMb2n+C1I4zr/0Q1VSJ9kDyLRLUM732mfRHB+qHlDeAWQSAJkEQCYBkEkAZBIAmQRAJgGQSQBkEgCZBEAmAZBJAGSUACzLep9vZf1hGHZt2+5lx7BtuxeGYbfseU3wmMPRlVNKLYB14bb3849leZ6XzufzF47jnCVJcus4zpnrun88z0v3jWe6x5wRq+18QL5g+wo4HA7fzWazV4PB4O90Ov2xb7waZM8HtPOMWNky4rpuulqt4LpuypibhnpCe8C4AJRSi23LPxZFUbfT6SCKoi5jbhrWgW2HcQEU8X3/NI7jkzRNb+I4PvF9X3u1QtNQNuEy+aVHKbUIw7A7Ho/t5XJ5AwBJktzatt3r9/v/thtxU1E34QZ67ia885zGLEFtJQGQSQBkEgCZBEAmAZBJAGQSAJkEQCYBkEkAZBIAmQRAJl/Sezo5GtoGRd8Tfq3rD4Lgd73TMU9JLSoZv2gJKvz9Sl61Waqsx84SpHsHHGORy9RaD9kDyCQAMgmATAIgkwDITA7gEsA1gLtMu970t4bJAXgALgB8AnC+ub3Y9LeG7oOYKe6wLvqXTN9HAJ8BvCXMpwo7H8RMD+AcwM9M3xsA3za3TdWog3FXBT8felm4Se0B466Ozpjg/3o/wbr43uZ+a5i8BF1iXfCrTN8EQAjgK2E+tTA5gKNg+h7QehIAmQRAdg/eDtBlcYbovwAAAABJRU5ErkJggg==",lightThemeSrc:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAGAAAABACAYAAADlNHIOAAAABGdBTUEAALGPC/xhBQAACktpQ0NQc1JHQiBJRUM2MTk2Ni0yLjEAAEiJnVNnVFPpFj333vRCS4iAlEtvUhUIIFJCi4BUaaISkgChhBgSQOyIqMCIoiKCFRkUccDREZCxIoqFQbH3AXkIKOPgKDZU3g/eGn2z5r03b/avvfY5Z53vnH0+AEZgsESahaoBZEoV8ogAHzw2Lh4ndwMKVCCBA4BAmC0LifSPAgDg+/Hw7IgAH/gCBODNbUAAAG7YBIbhOPx/UBfK5AoAJAwApovE2UIApBAAMnIVMgUAMgoA7KR0mQIAJQAAWx4bFw+AagEAO2WSTwMAdtIk9wIAtihTKgJAowBAJsoUiQDQDgBYl6MUiwCwYAAoypGIcwGwmwBgkqHMlABg7wCAnSkWZAMQGABgohALUwEI9gDAkEdF8AAIMwEojJSveNJXXCHOUwAA8LJki+WSlFQFbiG0xB1cXbl4oDg3Q6xQ2IQJhOkCuQjnZWXKBNLFAJMzAwCARnZEgA/O9+M5O7g6O9s42jp8taj/GvyLiI2L/5c/r8IBAQCE0/VF+7O8rBoA7hgAtvGLlrQdoGUNgNb9L5rJHgDVQoDmq1/Nw+H78fBUhULmZmeXm5trKxELbYWpX/X5nwl/AV/1s+X78fDf14P7ipMFygwFHhHggwuzMrKUcjxbJhCKcZs/HvHfLvzzd0yLECeL5WKpUIxHS8S5EmkKzsuSiiQKSZYUl0j/k4l/s+wPmLxrAGDVfgb2QltQu8oG7JcuILDogCXsAgDkd9+CqdEQBgAxBoOTdw8AMPmb/x1oGQCg2ZIUHACAFxGFC5XynMkYAQCACDRQBTZogz4YgwXYgCO4gDt4gR/MhlCIgjhYAEJIhUyQQy4shVVQBCWwEbZCFeyGWqiHRjgCLXACzsIFuALX4BY8gF4YgOcwCm9gHEEQMsJEWIg2YoCYItaII8JFZiF+SDASgcQhiUgKIkWUyFJkNVKClCNVyF6kHvkeOY6cRS4hPcg9pA8ZRn5DPqAYykDZqB5qhtqhXNQbDUKj0PloCroIzUcL0Q1oJVqDHkKb0bPoFfQW2os+R8cwwOgYBzPEbDAuxsNCsXgsGZNjy7FirAKrwRqxNqwTu4H1YiPYewKJwCLgBBuCOyGQMJcgJCwiLCeUEqoIBwjNhA7CDUIfYZTwmcgk6hKtiW5EPjGWmELMJRYRK4h1xGPE88RbxAHiGxKJxCGZk1xIgaQ4UhppCamUtJPURDpD6iH1k8bIZLI22ZrsQQ4lC8gKchF5O/kQ+TT5OnmA/I5CpxhQHCn+lHiKlFJAqaAcpJyiXKcMUsapalRTqhs1lCqiLqaWUWupbdSr1AHqOE2dZk7zoEXR0miraJW0Rtp52kPaKzqdbkR3pYfTJfSV9Er6YfpFeh/9PUODYcXgMRIYSsYGxn7GGcY9xismk2nG9GLGMxXMDcx65jnmY+Y7FZaKrQpfRaSyQqVapVnlusoLVaqqqaq36gLVfNUK1aOqV1VH1KhqZmo8NYHacrVqteNqd9TG1FnqDuqh6pnqpeoH1S+pD2mQNcw0/DREGoUa+zTOafSzMJYxi8cSslazalnnWQNsEtuczWensUvY37G72aOaGpozNKM18zSrNU9q9nIwjhmHz8nglHGOcG5zPkzRm+I9RTxl/ZTGKdenvNWaquWlJdYq1mrSuqX1QRvX9tNO196k3aL9SIegY6UTrpOrs0vnvM7IVPZU96nCqcVTj0y9r4vqWulG6C7R3afbpTump68XoCfT2653Tm9En6PvpZ+mv0X/lP6wActgloHEYIvBaYNnuCbujWfglXgHPmqoaxhoqDTca9htOG5kbjTXqMCoyeiRMc2Ya5xsvMW43XjUxMAkxGSpSYPJfVOqKdc01XSbaafpWzNzsxiztWYtZkPmWuZ883zzBvOHFkwLT4tFFjUWNy1JllzLdMudltesUCsnq1Sraqur1qi1s7XEeqd1zzTiNNdp0mk10+7YMGy8bXJsGmz6bDm2wbYFti22L+xM7OLtNtl12n22d7LPsK+1f+Cg4TDbocChzeE3RytHoWO1483pzOn+01dMb53+cob1DPGMXTPuOrGcQpzWOrU7fXJ2cZY7NzoPu5i4JLrscLnDZXPDuKXci65EVx/XFa4nXN+7Obsp3I64/epu457uftB9aKb5TPHM2pn9HkYeAo+9Hr2z8FmJs/bM6vU09BR41ng+8TL2EnnVeQ16W3qneR/yfuFj7yP3OebzlufGW8Y744v5BvgW+3b7afjN9avye+xv5J/i3+A/GuAUsCTgTCAxMChwU+Advh5fyK/nj852mb1sdkcQIygyqCroSbBVsDy4LQQNmR2yOeThHNM50jktoRDKD90c+ijMPGxR2I/hpPCw8OrwpxEOEUsjOiNZkQsjD0a+ifKJKot6MNdirnJue7RqdEJ0ffTbGN+Y8pjeWLvYZbFX4nTiJHGt8eT46Pi6+LF5fvO2zhtIcEooSrg933x+3vxLC3QWZCw4uVB1oWDh0URiYkziwcSPglBBjWAsiZ+0I2lUyBNuEz4XeYm2iIbFHuJy8WCyR3J58lCKR8rmlOFUz9SK1BEJT1IleZkWmLY77W16aPr+9ImMmIymTEpmYuZxqYY0XdqRpZ+Vl9Ujs5YVyXoXuS3aumhUHiSvy0ay52e3KtgKmaJLaaFco+zLmZVTnfMuNzr3aJ56njSva7HV4vWLB/P9879dQlgiXNK+1HDpqqV9y7yX7V2OLE9a3r7CeEXhioGVASsPrKKtSl/1U4F9QXnB69Uxq9sK9QpXFvavCVjTUKRSJC+6s9Z97e51hHWSdd3rp6/fvv5zsaj4col9SUXJx1Jh6eVvHL6p/GZiQ/KG7jLnsl0bSRulG29v8tx0oFy9PL+8f3PI5uYt+JbiLa+3Ltx6qWJGxe5ttG3Kbb2VwZWt2022b9z+sSq16la1T3XTDt0d63e83SnaeX2X167G3Xq7S3Z/2CPZc3dvwN7mGrOain2kfTn7ntZG13Z+y/22vk6nrqTu037p/t4DEQc66l3q6w/qHixrQBuUDcOHEg5d+873u9ZGm8a9TZymksNwWHn42feJ398+EnSk/Sj3aOMPpj/sOMY6VtyMNC9uHm1JbeltjWvtOT77eHube9uxH21/3H/C8ET1Sc2TZadopwpPTZzOPz12RnZm5GzK2f72he0PzsWeu9kR3tF9Puj8xQv+F851eneevuhx8cQlt0vHL3Mvt1xxvtLc5dR17Cenn451O3c3X3W52nrN9Vpbz8yeU9c9r5+94Xvjwk3+zSu35tzquT339t07CXd674ruDt3LuPfyfs798QcrHxIfFj9Se1TxWPdxzc+WPzf1Ovee7PPt63oS+eRBv7D/+T+y//FxoPAp82nFoMFg/ZDj0Ilh/+Frz+Y9G3guez4+UvSL+i87Xli8+OFXr1+7RmNHB17KX078VvpK+9X+1zNet4+FjT1+k/lm/G3xO+13B95z33d+iPkwOJ77kfyx8pPlp7bPQZ8fTmROTPwTA5jz/IzFdaUAAAAgY0hSTQAAeiYAAICEAAD6AAAAgOgAAHUwAADqYAAAOpgAABdwnLpRPAAAAAlwSFlzAAALEwAACxMBAJqcGAAAEAhpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDkuMC1jMDAwIDc5LjE3MWMyN2ZhYiwgMjAyMi8wOC8xNi0yMjozNTo0MSAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bWxuczpkYz0iaHR0cDovL3B1cmwub3JnL2RjL2VsZW1lbnRzLzEuMS8iIHhtbG5zOnhtcE1NPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvbW0vIiB4bWxuczpzdEV2dD0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL3NUeXBlL1Jlc291cmNlRXZlbnQjIiB4bWxuczpzdFJlZj0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL3NUeXBlL1Jlc291cmNlUmVmIyIgeG1sbnM6cGhvdG9zaG9wPSJodHRwOi8vbnMuYWRvYmUuY29tL3Bob3Rvc2hvcC8xLjAvIiB4bWxuczp0aWZmPSJodHRwOi8vbnMuYWRvYmUuY29tL3RpZmYvMS4wLyIgeG1sbnM6ZXhpZj0iaHR0cDovL25zLmFkb2JlLmNvbS9leGlmLzEuMC8iIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIDIxLjEgKE1hY2ludG9zaCkiIHhtcDpDcmVhdGVEYXRlPSIyMDIwLTAzLTI2VDExOjEwOjAyKzEzOjAwIiB4bXA6TWV0YWRhdGFEYXRlPSIyMDIyLTEyLTE1VDEwOjEzOjE0KzEzOjAwIiB4bXA6TW9kaWZ5RGF0ZT0iMjAyMi0xMi0xNVQxMDoxMzoxNCsxMzowMCIgZGM6Zm9ybWF0PSJpbWFnZS9wbmciIHhtcE1NOkluc3RhbmNlSUQ9InhtcC5paWQ6NTJjODA3YzItZmRmZC00NTk1LTlkZjMtY2FmYzRiNmQxMWYyIiB4bXBNTTpEb2N1bWVudElEPSJhZG9iZTpkb2NpZDpwaG90b3Nob3A6YmM5ZjBiNTItOTcyYi04MjQ2LThhZjgtNmRlMGQwNGM2ZTllIiB4bXBNTTpPcmlnaW5hbERvY3VtZW50SUQ9InhtcC5kaWQ6ZWU1NTEwZjgtNmI2ZC00NDJhLTkwOTMtMzQ4NmNlNDA0ZDU0IiBwaG90b3Nob3A6Q29sb3JNb2RlPSIzIiB0aWZmOk9yaWVudGF0aW9uPSIxIiB0aWZmOlhSZXNvbHV0aW9uPSI3MjAwMDAvMTAwMDAiIHRpZmY6WVJlc29sdXRpb249IjcyMDAwMC8xMDAwMCIgdGlmZjpSZXNvbHV0aW9uVW5pdD0iMiIgZXhpZjpDb2xvclNwYWNlPSI2NTUzNSIgZXhpZjpQaXhlbFhEaW1lbnNpb249Ijk2IiBleGlmOlBpeGVsWURpbWVuc2lvbj0iNjQiPiA8eG1wTU06SGlzdG9yeT4gPHJkZjpTZXE+IDxyZGY6bGkgc3RFdnQ6YWN0aW9uPSJjcmVhdGVkIiBzdEV2dDppbnN0YW5jZUlEPSJ4bXAuaWlkOmVlNTUxMGY4LTZiNmQtNDQyYS05MDkzLTM0ODZjZTQwNGQ1NCIgc3RFdnQ6d2hlbj0iMjAyMC0wMy0yNlQxMToxMDowMisxMzowMCIgc3RFdnQ6c29mdHdhcmVBZ2VudD0iQWRvYmUgUGhvdG9zaG9wIDIxLjEgKE1hY2ludG9zaCkiLz4gPHJkZjpsaSBzdEV2dDphY3Rpb249InNhdmVkIiBzdEV2dDppbnN0YW5jZUlEPSJ4bXAuaWlkOjEyYTg4Mjg4LWYzOWItNDU4My04M2FlLTk0NTExY2FjZGU5OCIgc3RFdnQ6d2hlbj0iMjAyMC0wMy0yNlQxNDoxNTozMisxMzowMCIgc3RFdnQ6c29mdHdhcmVBZ2VudD0iQWRvYmUgUGhvdG9zaG9wIDIxLjEgKE1hY2ludG9zaCkiIHN0RXZ0OmNoYW5nZWQ9Ii8iLz4gPHJkZjpsaSBzdEV2dDphY3Rpb249InNhdmVkIiBzdEV2dDppbnN0YW5jZUlEPSJ4bXAuaWlkOmEwMDkzM2E5LTA4NzctNDRlYi04YThmLTZlZDYyZjA1ZDhlZCIgc3RFdnQ6d2hlbj0iMjAyMC0wMy0yNlQxNDozNDo1NCsxMzowMCIgc3RFdnQ6c29mdHdhcmVBZ2VudD0iQWRvYmUgUGhvdG9zaG9wIDIxLjEgKE1hY2ludG9zaCkiIHN0RXZ0OmNoYW5nZWQ9Ii8iLz4gPHJkZjpsaSBzdEV2dDphY3Rpb249ImNvbnZlcnRlZCIgc3RFdnQ6cGFyYW1ldGVycz0iZnJvbSBhcHBsaWNhdGlvbi92bmQuYWRvYmUucGhvdG9zaG9wIHRvIGltYWdlL3BuZyIvPiA8cmRmOmxpIHN0RXZ0OmFjdGlvbj0iZGVyaXZlZCIgc3RFdnQ6cGFyYW1ldGVycz0iY29udmVydGVkIGZyb20gYXBwbGljYXRpb24vdm5kLmFkb2JlLnBob3Rvc2hvcCB0byBpbWFnZS9wbmciLz4gPHJkZjpsaSBzdEV2dDphY3Rpb249InNhdmVkIiBzdEV2dDppbnN0YW5jZUlEPSJ4bXAuaWlkOjlmZGE3OTBiLTZlODQtNGVmNS1hNGYxLTg0ZWFiMGIwNWJjOCIgc3RFdnQ6d2hlbj0iMjAyMC0wMy0yNlQxNDozNDo1NCsxMzowMCIgc3RFdnQ6c29mdHdhcmVBZ2VudD0iQWRvYmUgUGhvdG9zaG9wIDIxLjEgKE1hY2ludG9zaCkiIHN0RXZ0OmNoYW5nZWQ9Ii8iLz4gPHJkZjpsaSBzdEV2dDphY3Rpb249InNhdmVkIiBzdEV2dDppbnN0YW5jZUlEPSJ4bXAuaWlkOmFiMmM1Y2ExLWUzYTQtNGViMi1hODg5LTBmNzUwOWVlYmJhNiIgc3RFdnQ6d2hlbj0iMjAyMi0xMi0xNVQwODoyNjowMSsxMzowMCIgc3RFdnQ6c29mdHdhcmVBZ2VudD0iQWRvYmUgUGhvdG9zaG9wIDI0LjAgKE1hY2ludG9zaCkiIHN0RXZ0OmNoYW5nZWQ9Ii8iLz4gPHJkZjpsaSBzdEV2dDphY3Rpb249ImNvbnZlcnRlZCIgc3RFdnQ6cGFyYW1ldGVycz0iZnJvbSBpbWFnZS9wbmcgdG8gYXBwbGljYXRpb24vdm5kLmFkb2JlLnBob3Rvc2hvcCIvPiA8cmRmOmxpIHN0RXZ0OmFjdGlvbj0iZGVyaXZlZCIgc3RFdnQ6cGFyYW1ldGVycz0iY29udmVydGVkIGZyb20gaW1hZ2UvcG5nIHRvIGFwcGxpY2F0aW9uL3ZuZC5hZG9iZS5waG90b3Nob3AiLz4gPHJkZjpsaSBzdEV2dDphY3Rpb249InNhdmVkIiBzdEV2dDppbnN0YW5jZUlEPSJ4bXAuaWlkOjZiOTY1MjJmLTA3OTYtNDZhMS1iY2JjLTM2ZmJhYzIyNmQ4OSIgc3RFdnQ6d2hlbj0iMjAyMi0xMi0xNVQwODoyNjowMSsxMzowMCIgc3RFdnQ6c29mdHdhcmVBZ2VudD0iQWRvYmUgUGhvdG9zaG9wIDI0LjAgKE1hY2ludG9zaCkiIHN0RXZ0OmNoYW5nZWQ9Ii8iLz4gPHJkZjpsaSBzdEV2dDphY3Rpb249InNhdmVkIiBzdEV2dDppbnN0YW5jZUlEPSJ4bXAuaWlkOjZkNTdlZDg5LWMxZDgtNGFkNS1iNTgzLTU0NWI1N2QyM2RjNCIgc3RFdnQ6d2hlbj0iMjAyMi0xMi0xNVQxMDoxMzoxNCsxMzowMCIgc3RFdnQ6c29mdHdhcmVBZ2VudD0iQWRvYmUgUGhvdG9zaG9wIDI0LjAgKE1hY2ludG9zaCkiIHN0RXZ0OmNoYW5nZWQ9Ii8iLz4gPHJkZjpsaSBzdEV2dDphY3Rpb249ImNvbnZlcnRlZCIgc3RFdnQ6cGFyYW1ldGVycz0iZnJvbSBhcHBsaWNhdGlvbi92bmQuYWRvYmUucGhvdG9zaG9wIHRvIGltYWdlL3BuZyIvPiA8cmRmOmxpIHN0RXZ0OmFjdGlvbj0iZGVyaXZlZCIgc3RFdnQ6cGFyYW1ldGVycz0iY29udmVydGVkIGZyb20gYXBwbGljYXRpb24vdm5kLmFkb2JlLnBob3Rvc2hvcCB0byBpbWFnZS9wbmciLz4gPHJkZjpsaSBzdEV2dDphY3Rpb249InNhdmVkIiBzdEV2dDppbnN0YW5jZUlEPSJ4bXAuaWlkOjUyYzgwN2MyLWZkZmQtNDU5NS05ZGYzLWNhZmM0YjZkMTFmMiIgc3RFdnQ6d2hlbj0iMjAyMi0xMi0xNVQxMDoxMzoxNCsxMzowMCIgc3RFdnQ6c29mdHdhcmVBZ2VudD0iQWRvYmUgUGhvdG9zaG9wIDI0LjAgKE1hY2ludG9zaCkiIHN0RXZ0OmNoYW5nZWQ9Ii8iLz4gPC9yZGY6U2VxPiA8L3htcE1NOkhpc3Rvcnk+IDx4bXBNTTpEZXJpdmVkRnJvbSBzdFJlZjppbnN0YW5jZUlEPSJ4bXAuaWlkOjZkNTdlZDg5LWMxZDgtNGFkNS1iNTgzLTU0NWI1N2QyM2RjNCIgc3RSZWY6ZG9jdW1lbnRJRD0iYWRvYmU6ZG9jaWQ6cGhvdG9zaG9wOjIyOTFjN2Q1LTdiMGYtNmI0YS1iMDNmLTZjMjlkMjBmZGI5MCIgc3RSZWY6b3JpZ2luYWxEb2N1bWVudElEPSJ4bXAuZGlkOmVlNTUxMGY4LTZiNmQtNDQyYS05MDkzLTM0ODZjZTQwNGQ1NCIvPiA8cGhvdG9zaG9wOkRvY3VtZW50QW5jZXN0b3JzPiA8cmRmOkJhZz4gPHJkZjpsaT5hZG9iZTpkb2NpZDpwaG90b3Nob3A6OGFkNDQ1MGUtN2ZmNS1iZTQyLTlmNTAtOGE0ZDBlYTU4MmFlPC9yZGY6bGk+IDwvcmRmOkJhZz4gPC9waG90b3Nob3A6RG9jdW1lbnRBbmNlc3RvcnM+IDwvcmRmOkRlc2NyaXB0aW9uPiA8L3JkZjpSREY+IDwveDp4bXBtZXRhPiA8P3hwYWNrZXQgZW5kPSJyIj8+VYU64wAAArlJREFUeJztm7GO2kAQhmeQlVQJiCaRUlyRB7DQUvgxqNKliZQyZXr6dFSuTpborvKDsLL8ACmuI8VF5tIkwWJSBC6cwZC7W/jXMJ9kIUbyajyfPWt5bRYRUnC00AmcOyoAjAoAE1QDzFw7KYgIHzYd/zh0PTYELHn+1IFPiLpa/HIxOFfvgphZzvFMfyiu6qRzAJi6FnRHv99/cYxEmsBkMvnheky9AsCoADAqAIwKAKMCwKgAMCoAjAoAowLAqAAwKgCMCgCjAsDsfRp6CKy1t9WYMeZlXTzP8/dlWX4xxrxeG2MaBMHnMAzHdfu5z9w9EAGr4lhrb6uF2la4MAzHWZa9tdZeG2MurLXXrVYrDsNwvG8832lMC+r1ekNmzq2135g57/V6Q3ROLoBcAbtYbyfVszkIgsv5fB4FQXB5/Mw22bVgX0d1GdM7AbtaSFmWH4hIlr/p0ZKq4aFrwtuENaYFZVk2FJHQGPNKRMIsy4bonFzg3RVQvaNZ3QUtFouPxpg3y9iFtXaa5/nX1UTcVPa+lqKL8v9YX5R/zGsp2/ZpTAs6VVQAGBUARgWAUQFgVAAYFQBGBYBRAWBUABgVAEYFgFEBYPQjvUeiT0NPhK0LMsz8bFtcRH4fNh3/qKuFK+pWxOo+Qj7H1uTkg+w6NgRo/7/PoeuhcwAYFQBGBYBRAWBUABhvBTBzl5lHzDxl5p/L3xEzd9G5OUVEvNyIaBRFkSRJIkVRSJIkEkWRENEIndsTjkk2YuikdiQ7TZJE1kmSRIhois7NpYCNh3G+wMzzoiiCdrt9F5vNZtTpdEry8J3W/0Ua9DDuJk3Te4Hl/xsR4aZu1YP0+Uy6iuP4ExHRYDCgNE0pjmMioitsWm7xuQV1iWhIRO+IqENEBf0t/lBEvsMSc4y3As4Fn+eAs0AFgFEBYP4AGCek2ueplPYAAAAASUVORK5CYII="},{style:d.Explode,darkThemeSrc:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAGAAAABACAYAAADlNHIOAAAABGdBTUEAALGPC/xhBQAACktpQ0NQc1JHQiBJRUM2MTk2Ni0yLjEAAEiJnVNnVFPpFj333vRCS4iAlEtvUhUIIFJCi4BUaaISkgChhBgSQOyIqMCIoiKCFRkUccDREZCxIoqFQbH3AXkIKOPgKDZU3g/eGn2z5r03b/avvfY5Z53vnH0+AEZgsESahaoBZEoV8ogAHzw2Lh4ndwMKVCCBA4BAmC0LifSPAgDg+/Hw7IgAH/gCBODNbUAAAG7YBIbhOPx/UBfK5AoAJAwApovE2UIApBAAMnIVMgUAMgoA7KR0mQIAJQAAWx4bFw+AagEAO2WSTwMAdtIk9wIAtihTKgJAowBAJsoUiQDQDgBYl6MUiwCwYAAoypGIcwGwmwBgkqHMlABg7wCAnSkWZAMQGABgohALUwEI9gDAkEdF8AAIMwEojJSveNJXXCHOUwAA8LJki+WSlFQFbiG0xB1cXbl4oDg3Q6xQ2IQJhOkCuQjnZWXKBNLFAJMzAwCARnZEgA/O9+M5O7g6O9s42jp8taj/GvyLiI2L/5c/r8IBAQCE0/VF+7O8rBoA7hgAtvGLlrQdoGUNgNb9L5rJHgDVQoDmq1/Nw+H78fBUhULmZmeXm5trKxELbYWpX/X5nwl/AV/1s+X78fDf14P7ipMFygwFHhHggwuzMrKUcjxbJhCKcZs/HvHfLvzzd0yLECeL5WKpUIxHS8S5EmkKzsuSiiQKSZYUl0j/k4l/s+wPmLxrAGDVfgb2QltQu8oG7JcuILDogCXsAgDkd9+CqdEQBgAxBoOTdw8AMPmb/x1oGQCg2ZIUHACAFxGFC5XynMkYAQCACDRQBTZogz4YgwXYgCO4gDt4gR/MhlCIgjhYAEJIhUyQQy4shVVQBCWwEbZCFeyGWqiHRjgCLXACzsIFuALX4BY8gF4YgOcwCm9gHEEQMsJEWIg2YoCYItaII8JFZiF+SDASgcQhiUgKIkWUyFJkNVKClCNVyF6kHvkeOY6cRS4hPcg9pA8ZRn5DPqAYykDZqB5qhtqhXNQbDUKj0PloCroIzUcL0Q1oJVqDHkKb0bPoFfQW2os+R8cwwOgYBzPEbDAuxsNCsXgsGZNjy7FirAKrwRqxNqwTu4H1YiPYewKJwCLgBBuCOyGQMJcgJCwiLCeUEqoIBwjNhA7CDUIfYZTwmcgk6hKtiW5EPjGWmELMJRYRK4h1xGPE88RbxAHiGxKJxCGZk1xIgaQ4UhppCamUtJPURDpD6iH1k8bIZLI22ZrsQQ4lC8gKchF5O/kQ+TT5OnmA/I5CpxhQHCn+lHiKlFJAqaAcpJyiXKcMUsapalRTqhs1lCqiLqaWUWupbdSr1AHqOE2dZk7zoEXR0miraJW0Rtp52kPaKzqdbkR3pYfTJfSV9Er6YfpFeh/9PUODYcXgMRIYSsYGxn7GGcY9xismk2nG9GLGMxXMDcx65jnmY+Y7FZaKrQpfRaSyQqVapVnlusoLVaqqqaq36gLVfNUK1aOqV1VH1KhqZmo8NYHacrVqteNqd9TG1FnqDuqh6pnqpeoH1S+pD2mQNcw0/DREGoUa+zTOafSzMJYxi8cSslazalnnWQNsEtuczWensUvY37G72aOaGpozNKM18zSrNU9q9nIwjhmHz8nglHGOcG5zPkzRm+I9RTxl/ZTGKdenvNWaquWlJdYq1mrSuqX1QRvX9tNO196k3aL9SIegY6UTrpOrs0vnvM7IVPZU96nCqcVTj0y9r4vqWulG6C7R3afbpTump68XoCfT2653Tm9En6PvpZ+mv0X/lP6wActgloHEYIvBaYNnuCbujWfglXgHPmqoaxhoqDTca9htOG5kbjTXqMCoyeiRMc2Ya5xsvMW43XjUxMAkxGSpSYPJfVOqKdc01XSbaafpWzNzsxiztWYtZkPmWuZ883zzBvOHFkwLT4tFFjUWNy1JllzLdMudltesUCsnq1Sraqur1qi1s7XEeqd1zzTiNNdp0mk10+7YMGy8bXJsGmz6bDm2wbYFti22L+xM7OLtNtl12n22d7LPsK+1f+Cg4TDbocChzeE3RytHoWO1483pzOn+01dMb53+cob1DPGMXTPuOrGcQpzWOrU7fXJ2cZY7NzoPu5i4JLrscLnDZXPDuKXci65EVx/XFa4nXN+7Obsp3I64/epu457uftB9aKb5TPHM2pn9HkYeAo+9Hr2z8FmJs/bM6vU09BR41ng+8TL2EnnVeQ16W3qneR/yfuFj7yP3OebzlufGW8Y744v5BvgW+3b7afjN9avye+xv5J/i3+A/GuAUsCTgTCAxMChwU+Advh5fyK/nj852mb1sdkcQIygyqCroSbBVsDy4LQQNmR2yOeThHNM50jktoRDKD90c+ijMPGxR2I/hpPCw8OrwpxEOEUsjOiNZkQsjD0a+ifKJKot6MNdirnJue7RqdEJ0ffTbGN+Y8pjeWLvYZbFX4nTiJHGt8eT46Pi6+LF5fvO2zhtIcEooSrg933x+3vxLC3QWZCw4uVB1oWDh0URiYkziwcSPglBBjWAsiZ+0I2lUyBNuEz4XeYm2iIbFHuJy8WCyR3J58lCKR8rmlOFUz9SK1BEJT1IleZkWmLY77W16aPr+9ImMmIymTEpmYuZxqYY0XdqRpZ+Vl9Ujs5YVyXoXuS3aumhUHiSvy0ay52e3KtgKmaJLaaFco+zLmZVTnfMuNzr3aJ56njSva7HV4vWLB/P9879dQlgiXNK+1HDpqqV9y7yX7V2OLE9a3r7CeEXhioGVASsPrKKtSl/1U4F9QXnB69Uxq9sK9QpXFvavCVjTUKRSJC+6s9Z97e51hHWSdd3rp6/fvv5zsaj4col9SUXJx1Jh6eVvHL6p/GZiQ/KG7jLnsl0bSRulG29v8tx0oFy9PL+8f3PI5uYt+JbiLa+3Ltx6qWJGxe5ttG3Kbb2VwZWt2022b9z+sSq16la1T3XTDt0d63e83SnaeX2X167G3Xq7S3Z/2CPZc3dvwN7mGrOain2kfTn7ntZG13Z+y/22vk6nrqTu037p/t4DEQc66l3q6w/qHixrQBuUDcOHEg5d+873u9ZGm8a9TZymksNwWHn42feJ398+EnSk/Sj3aOMPpj/sOMY6VtyMNC9uHm1JbeltjWvtOT77eHube9uxH21/3H/C8ET1Sc2TZadopwpPTZzOPz12RnZm5GzK2f72he0PzsWeu9kR3tF9Puj8xQv+F851eneevuhx8cQlt0vHL3Mvt1xxvtLc5dR17Cenn451O3c3X3W52nrN9Vpbz8yeU9c9r5+94Xvjwk3+zSu35tzquT339t07CXd674ruDt3LuPfyfs798QcrHxIfFj9Se1TxWPdxzc+WPzf1Ovee7PPt63oS+eRBv7D/+T+y//FxoPAp82nFoMFg/ZDj0Ilh/+Frz+Y9G3guez4+UvSL+i87Xli8+OFXr1+7RmNHB17KX078VvpK+9X+1zNet4+FjT1+k/lm/G3xO+13B95z33d+iPkwOJ77kfyx8pPlp7bPQZ8fTmROTPwTA5jz/IzFdaUAAAAgY0hSTQAAeiYAAICEAAD6AAAAgOgAAHUwAADqYAAAOpgAABdwnLpRPAAAAAlwSFlzAAALEwAACxMBAJqcGAAAEFRpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDkuMC1jMDAwIDc5LjE3MWMyN2ZhYiwgMjAyMi8wOC8xNi0yMjozNTo0MSAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bWxuczpkYz0iaHR0cDovL3B1cmwub3JnL2RjL2VsZW1lbnRzLzEuMS8iIHhtbG5zOnhtcE1NPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvbW0vIiB4bWxuczpzdEV2dD0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL3NUeXBlL1Jlc291cmNlRXZlbnQjIiB4bWxuczpzdFJlZj0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL3NUeXBlL1Jlc291cmNlUmVmIyIgeG1sbnM6cGhvdG9zaG9wPSJodHRwOi8vbnMuYWRvYmUuY29tL3Bob3Rvc2hvcC8xLjAvIiB4bWxuczp0aWZmPSJodHRwOi8vbnMuYWRvYmUuY29tL3RpZmYvMS4wLyIgeG1sbnM6ZXhpZj0iaHR0cDovL25zLmFkb2JlLmNvbS9leGlmLzEuMC8iIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIDIxLjEgKE1hY2ludG9zaCkiIHhtcDpDcmVhdGVEYXRlPSIyMDIwLTAzLTI2VDExOjEwOjAyKzEzOjAwIiB4bXA6TWV0YWRhdGFEYXRlPSIyMDIyLTEyLTE1VDE0OjMzOjQ3KzEzOjAwIiB4bXA6TW9kaWZ5RGF0ZT0iMjAyMi0xMi0xNVQxNDozMzo0NysxMzowMCIgZGM6Zm9ybWF0PSJpbWFnZS9wbmciIHhtcE1NOkluc3RhbmNlSUQ9InhtcC5paWQ6MGQyNDYxZGYtZjhjNi00ZDgwLWFiZmQtMjI1ZGE2N2RjZGYzIiB4bXBNTTpEb2N1bWVudElEPSJhZG9iZTpkb2NpZDpwaG90b3Nob3A6MDZhMDRlNzItMzI2Zi01MTQyLWI2NDUtYTkyNjEyMzJmNmJiIiB4bXBNTTpPcmlnaW5hbERvY3VtZW50SUQ9InhtcC5kaWQ6ZWU1NTEwZjgtNmI2ZC00NDJhLTkwOTMtMzQ4NmNlNDA0ZDU0IiBwaG90b3Nob3A6Q29sb3JNb2RlPSIzIiB0aWZmOk9yaWVudGF0aW9uPSIxIiB0aWZmOlhSZXNvbHV0aW9uPSI3MjAwMDAvMTAwMDAiIHRpZmY6WVJlc29sdXRpb249IjcyMDAwMC8xMDAwMCIgdGlmZjpSZXNvbHV0aW9uVW5pdD0iMiIgZXhpZjpDb2xvclNwYWNlPSI2NTUzNSIgZXhpZjpQaXhlbFhEaW1lbnNpb249Ijk2IiBleGlmOlBpeGVsWURpbWVuc2lvbj0iNjQiPiA8eG1wTU06SGlzdG9yeT4gPHJkZjpTZXE+IDxyZGY6bGkgc3RFdnQ6YWN0aW9uPSJjcmVhdGVkIiBzdEV2dDppbnN0YW5jZUlEPSJ4bXAuaWlkOmVlNTUxMGY4LTZiNmQtNDQyYS05MDkzLTM0ODZjZTQwNGQ1NCIgc3RFdnQ6d2hlbj0iMjAyMC0wMy0yNlQxMToxMDowMisxMzowMCIgc3RFdnQ6c29mdHdhcmVBZ2VudD0iQWRvYmUgUGhvdG9zaG9wIDIxLjEgKE1hY2ludG9zaCkiLz4gPHJkZjpsaSBzdEV2dDphY3Rpb249InNhdmVkIiBzdEV2dDppbnN0YW5jZUlEPSJ4bXAuaWlkOjEyYTg4Mjg4LWYzOWItNDU4My04M2FlLTk0NTExY2FjZGU5OCIgc3RFdnQ6d2hlbj0iMjAyMC0wMy0yNlQxNDoxNTozMisxMzowMCIgc3RFdnQ6c29mdHdhcmVBZ2VudD0iQWRvYmUgUGhvdG9zaG9wIDIxLjEgKE1hY2ludG9zaCkiIHN0RXZ0OmNoYW5nZWQ9Ii8iLz4gPHJkZjpsaSBzdEV2dDphY3Rpb249InNhdmVkIiBzdEV2dDppbnN0YW5jZUlEPSJ4bXAuaWlkOmEwMDkzM2E5LTA4NzctNDRlYi04YThmLTZlZDYyZjA1ZDhlZCIgc3RFdnQ6d2hlbj0iMjAyMC0wMy0yNlQxNDozNDo1NCsxMzowMCIgc3RFdnQ6c29mdHdhcmVBZ2VudD0iQWRvYmUgUGhvdG9zaG9wIDIxLjEgKE1hY2ludG9zaCkiIHN0RXZ0OmNoYW5nZWQ9Ii8iLz4gPHJkZjpsaSBzdEV2dDphY3Rpb249ImNvbnZlcnRlZCIgc3RFdnQ6cGFyYW1ldGVycz0iZnJvbSBhcHBsaWNhdGlvbi92bmQuYWRvYmUucGhvdG9zaG9wIHRvIGltYWdlL3BuZyIvPiA8cmRmOmxpIHN0RXZ0OmFjdGlvbj0iZGVyaXZlZCIgc3RFdnQ6cGFyYW1ldGVycz0iY29udmVydGVkIGZyb20gYXBwbGljYXRpb24vdm5kLmFkb2JlLnBob3Rvc2hvcCB0byBpbWFnZS9wbmciLz4gPHJkZjpsaSBzdEV2dDphY3Rpb249InNhdmVkIiBzdEV2dDppbnN0YW5jZUlEPSJ4bXAuaWlkOjlmZGE3OTBiLTZlODQtNGVmNS1hNGYxLTg0ZWFiMGIwNWJjOCIgc3RFdnQ6d2hlbj0iMjAyMC0wMy0yNlQxNDozNDo1NCsxMzowMCIgc3RFdnQ6c29mdHdhcmVBZ2VudD0iQWRvYmUgUGhvdG9zaG9wIDIxLjEgKE1hY2ludG9zaCkiIHN0RXZ0OmNoYW5nZWQ9Ii8iLz4gPHJkZjpsaSBzdEV2dDphY3Rpb249InNhdmVkIiBzdEV2dDppbnN0YW5jZUlEPSJ4bXAuaWlkOmFiMmM1Y2ExLWUzYTQtNGViMi1hODg5LTBmNzUwOWVlYmJhNiIgc3RFdnQ6d2hlbj0iMjAyMi0xMi0xNVQwODoyNjowMSsxMzowMCIgc3RFdnQ6c29mdHdhcmVBZ2VudD0iQWRvYmUgUGhvdG9zaG9wIDI0LjAgKE1hY2ludG9zaCkiIHN0RXZ0OmNoYW5nZWQ9Ii8iLz4gPHJkZjpsaSBzdEV2dDphY3Rpb249ImNvbnZlcnRlZCIgc3RFdnQ6cGFyYW1ldGVycz0iZnJvbSBpbWFnZS9wbmcgdG8gYXBwbGljYXRpb24vdm5kLmFkb2JlLnBob3Rvc2hvcCIvPiA8cmRmOmxpIHN0RXZ0OmFjdGlvbj0iZGVyaXZlZCIgc3RFdnQ6cGFyYW1ldGVycz0iY29udmVydGVkIGZyb20gaW1hZ2UvcG5nIHRvIGFwcGxpY2F0aW9uL3ZuZC5hZG9iZS5waG90b3Nob3AiLz4gPHJkZjpsaSBzdEV2dDphY3Rpb249InNhdmVkIiBzdEV2dDppbnN0YW5jZUlEPSJ4bXAuaWlkOjZiOTY1MjJmLTA3OTYtNDZhMS1iY2JjLTM2ZmJhYzIyNmQ4OSIgc3RFdnQ6d2hlbj0iMjAyMi0xMi0xNVQwODoyNjowMSsxMzowMCIgc3RFdnQ6c29mdHdhcmVBZ2VudD0iQWRvYmUgUGhvdG9zaG9wIDI0LjAgKE1hY2ludG9zaCkiIHN0RXZ0OmNoYW5nZWQ9Ii8iLz4gPHJkZjpsaSBzdEV2dDphY3Rpb249InNhdmVkIiBzdEV2dDppbnN0YW5jZUlEPSJ4bXAuaWlkOjcwYmZhZDkwLWI1OTUtNDU5My05ZmI0LTFkYTE1ZmZkZDczYiIgc3RFdnQ6d2hlbj0iMjAyMi0xMi0xNVQxNDozMzo0NysxMzowMCIgc3RFdnQ6c29mdHdhcmVBZ2VudD0iQWRvYmUgUGhvdG9zaG9wIDI0LjAgKE1hY2ludG9zaCkiIHN0RXZ0OmNoYW5nZWQ9Ii8iLz4gPHJkZjpsaSBzdEV2dDphY3Rpb249ImNvbnZlcnRlZCIgc3RFdnQ6cGFyYW1ldGVycz0iZnJvbSBhcHBsaWNhdGlvbi92bmQuYWRvYmUucGhvdG9zaG9wIHRvIGltYWdlL3BuZyIvPiA8cmRmOmxpIHN0RXZ0OmFjdGlvbj0iZGVyaXZlZCIgc3RFdnQ6cGFyYW1ldGVycz0iY29udmVydGVkIGZyb20gYXBwbGljYXRpb24vdm5kLmFkb2JlLnBob3Rvc2hvcCB0byBpbWFnZS9wbmciLz4gPHJkZjpsaSBzdEV2dDphY3Rpb249InNhdmVkIiBzdEV2dDppbnN0YW5jZUlEPSJ4bXAuaWlkOjBkMjQ2MWRmLWY4YzYtNGQ4MC1hYmZkLTIyNWRhNjdkY2RmMyIgc3RFdnQ6d2hlbj0iMjAyMi0xMi0xNVQxNDozMzo0NysxMzowMCIgc3RFdnQ6c29mdHdhcmVBZ2VudD0iQWRvYmUgUGhvdG9zaG9wIDI0LjAgKE1hY2ludG9zaCkiIHN0RXZ0OmNoYW5nZWQ9Ii8iLz4gPC9yZGY6U2VxPiA8L3htcE1NOkhpc3Rvcnk+IDx4bXBNTTpEZXJpdmVkRnJvbSBzdFJlZjppbnN0YW5jZUlEPSJ4bXAuaWlkOjcwYmZhZDkwLWI1OTUtNDU5My05ZmI0LTFkYTE1ZmZkZDczYiIgc3RSZWY6ZG9jdW1lbnRJRD0iYWRvYmU6ZG9jaWQ6cGhvdG9zaG9wOjIyOTFjN2Q1LTdiMGYtNmI0YS1iMDNmLTZjMjlkMjBmZGI5MCIgc3RSZWY6b3JpZ2luYWxEb2N1bWVudElEPSJ4bXAuZGlkOmVlNTUxMGY4LTZiNmQtNDQyYS05MDkzLTM0ODZjZTQwNGQ1NCIvPiA8cGhvdG9zaG9wOkRvY3VtZW50QW5jZXN0b3JzPiA8cmRmOkJhZz4gPHJkZjpsaT5hZG9iZTpkb2NpZDpwaG90b3Nob3A6MjI5MWM3ZDUtN2IwZi02YjRhLWIwM2YtNmMyOWQyMGZkYjkwPC9yZGY6bGk+IDxyZGY6bGk+YWRvYmU6ZG9jaWQ6cGhvdG9zaG9wOjhhZDQ0NTBlLTdmZjUtYmU0Mi05ZjUwLThhNGQwZWE1ODJhZTwvcmRmOmxpPiA8L3JkZjpCYWc+IDwvcGhvdG9zaG9wOkRvY3VtZW50QW5jZXN0b3JzPiA8L3JkZjpEZXNjcmlwdGlvbj4gPC9yZGY6UkRGPiA8L3g6eG1wbWV0YT4gPD94cGFja2V0IGVuZD0iciI/Ptfq2U8AAAKSSURBVHic7ZtBbqMwFEA/melIg+mC2TQzB8gNso66rtprwJoLoNwCpJyiPUFWLLKDXQ7QtJsiZTyONNLEs4giVcgQEoy+Hf6TkCIn+Vj/xf4QbEdKCQQeI+wODB0SgAwJQOaroq2pKDh9dcRges2HSgDM5/NbVXscx13PZx0NufitI76juAqSMMxf+rloyRPVAGSUU1CF1957YQ+/dAekEYAMCUBGJYAKcDu05IlGADIkABkSgAwJQIYEIEMCkCEByJAAZEgAMiQAGRQBjuP8rB5N7UmSuIyx8ecYjLFxkiRu0/dsoM3f0dqRUm4ADok7vq6+95kwDMV6vf7i+/5dWZbvvu/fBUHwJwxDcSqe6aieiFXp7XlANWGnEjibzX6sVqtv0+n073K5/DgVrweu/3lA0zQSBIHY7/cQBIHA6FsfGCdASrk5HtX30jR1R6MRpGnqYvStD4wTUEcURbd5nt8IId7yPL+Joki5WsE2UIpwE9WpR0q5SZLEXSwWbLvdvgEAlGX5zhgbTyaTf8dCbCuoRdhCrr8IDw0SgAwJQIYEIEMCkCEByJAAZEgAMiQAGRKAjEoAbRxuh5Y80QhAhgQgQ5v0Loc26V0DdfuEPVV7HMe83+6YR0MutMSvm4JqP6/lrHbRlI8nAHjpErxuj1jdMUTqcvEEAM8A8NglONWAy3kBDRJIQDc6SyAB3ekkgQTo4WIJJEAfF0kwVkCWZfeccwGHy0AJAJJzLrIsu0fuWhNnS2izMAsFzrnwPO+7on3neZ7pa0Mf4SDh5H2CsQLA/hvCVhJsFWAbtRKMW5zbEhtGQCuMLcKc89057bZirICiKB6qyeac74qieMDqUx+YXAMGgbEjYCiQAGRIADL/AeLd68Q29Hp3AAAAAElFTkSuQmCC",lightThemeSrc:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAGAAAABACAYAAADlNHIOAAAABGdBTUEAALGPC/xhBQAACktpQ0NQc1JHQiBJRUM2MTk2Ni0yLjEAAEiJnVNnVFPpFj333vRCS4iAlEtvUhUIIFJCi4BUaaISkgChhBgSQOyIqMCIoiKCFRkUccDREZCxIoqFQbH3AXkIKOPgKDZU3g/eGn2z5r03b/avvfY5Z53vnH0+AEZgsESahaoBZEoV8ogAHzw2Lh4ndwMKVCCBA4BAmC0LifSPAgDg+/Hw7IgAH/gCBODNbUAAAG7YBIbhOPx/UBfK5AoAJAwApovE2UIApBAAMnIVMgUAMgoA7KR0mQIAJQAAWx4bFw+AagEAO2WSTwMAdtIk9wIAtihTKgJAowBAJsoUiQDQDgBYl6MUiwCwYAAoypGIcwGwmwBgkqHMlABg7wCAnSkWZAMQGABgohALUwEI9gDAkEdF8AAIMwEojJSveNJXXCHOUwAA8LJki+WSlFQFbiG0xB1cXbl4oDg3Q6xQ2IQJhOkCuQjnZWXKBNLFAJMzAwCARnZEgA/O9+M5O7g6O9s42jp8taj/GvyLiI2L/5c/r8IBAQCE0/VF+7O8rBoA7hgAtvGLlrQdoGUNgNb9L5rJHgDVQoDmq1/Nw+H78fBUhULmZmeXm5trKxELbYWpX/X5nwl/AV/1s+X78fDf14P7ipMFygwFHhHggwuzMrKUcjxbJhCKcZs/HvHfLvzzd0yLECeL5WKpUIxHS8S5EmkKzsuSiiQKSZYUl0j/k4l/s+wPmLxrAGDVfgb2QltQu8oG7JcuILDogCXsAgDkd9+CqdEQBgAxBoOTdw8AMPmb/x1oGQCg2ZIUHACAFxGFC5XynMkYAQCACDRQBTZogz4YgwXYgCO4gDt4gR/MhlCIgjhYAEJIhUyQQy4shVVQBCWwEbZCFeyGWqiHRjgCLXACzsIFuALX4BY8gF4YgOcwCm9gHEEQMsJEWIg2YoCYItaII8JFZiF+SDASgcQhiUgKIkWUyFJkNVKClCNVyF6kHvkeOY6cRS4hPcg9pA8ZRn5DPqAYykDZqB5qhtqhXNQbDUKj0PloCroIzUcL0Q1oJVqDHkKb0bPoFfQW2os+R8cwwOgYBzPEbDAuxsNCsXgsGZNjy7FirAKrwRqxNqwTu4H1YiPYewKJwCLgBBuCOyGQMJcgJCwiLCeUEqoIBwjNhA7CDUIfYZTwmcgk6hKtiW5EPjGWmELMJRYRK4h1xGPE88RbxAHiGxKJxCGZk1xIgaQ4UhppCamUtJPURDpD6iH1k8bIZLI22ZrsQQ4lC8gKchF5O/kQ+TT5OnmA/I5CpxhQHCn+lHiKlFJAqaAcpJyiXKcMUsapalRTqhs1lCqiLqaWUWupbdSr1AHqOE2dZk7zoEXR0miraJW0Rtp52kPaKzqdbkR3pYfTJfSV9Er6YfpFeh/9PUODYcXgMRIYSsYGxn7GGcY9xismk2nG9GLGMxXMDcx65jnmY+Y7FZaKrQpfRaSyQqVapVnlusoLVaqqqaq36gLVfNUK1aOqV1VH1KhqZmo8NYHacrVqteNqd9TG1FnqDuqh6pnqpeoH1S+pD2mQNcw0/DREGoUa+zTOafSzMJYxi8cSslazalnnWQNsEtuczWensUvY37G72aOaGpozNKM18zSrNU9q9nIwjhmHz8nglHGOcG5zPkzRm+I9RTxl/ZTGKdenvNWaquWlJdYq1mrSuqX1QRvX9tNO196k3aL9SIegY6UTrpOrs0vnvM7IVPZU96nCqcVTj0y9r4vqWulG6C7R3afbpTump68XoCfT2653Tm9En6PvpZ+mv0X/lP6wActgloHEYIvBaYNnuCbujWfglXgHPmqoaxhoqDTca9htOG5kbjTXqMCoyeiRMc2Ya5xsvMW43XjUxMAkxGSpSYPJfVOqKdc01XSbaafpWzNzsxiztWYtZkPmWuZ883zzBvOHFkwLT4tFFjUWNy1JllzLdMudltesUCsnq1Sraqur1qi1s7XEeqd1zzTiNNdp0mk10+7YMGy8bXJsGmz6bDm2wbYFti22L+xM7OLtNtl12n22d7LPsK+1f+Cg4TDbocChzeE3RytHoWO1483pzOn+01dMb53+cob1DPGMXTPuOrGcQpzWOrU7fXJ2cZY7NzoPu5i4JLrscLnDZXPDuKXci65EVx/XFa4nXN+7Obsp3I64/epu457uftB9aKb5TPHM2pn9HkYeAo+9Hr2z8FmJs/bM6vU09BR41ng+8TL2EnnVeQ16W3qneR/yfuFj7yP3OebzlufGW8Y744v5BvgW+3b7afjN9avye+xv5J/i3+A/GuAUsCTgTCAxMChwU+Advh5fyK/nj852mb1sdkcQIygyqCroSbBVsDy4LQQNmR2yOeThHNM50jktoRDKD90c+ijMPGxR2I/hpPCw8OrwpxEOEUsjOiNZkQsjD0a+ifKJKot6MNdirnJue7RqdEJ0ffTbGN+Y8pjeWLvYZbFX4nTiJHGt8eT46Pi6+LF5fvO2zhtIcEooSrg933x+3vxLC3QWZCw4uVB1oWDh0URiYkziwcSPglBBjWAsiZ+0I2lUyBNuEz4XeYm2iIbFHuJy8WCyR3J58lCKR8rmlOFUz9SK1BEJT1IleZkWmLY77W16aPr+9ImMmIymTEpmYuZxqYY0XdqRpZ+Vl9Ujs5YVyXoXuS3aumhUHiSvy0ay52e3KtgKmaJLaaFco+zLmZVTnfMuNzr3aJ56njSva7HV4vWLB/P9879dQlgiXNK+1HDpqqV9y7yX7V2OLE9a3r7CeEXhioGVASsPrKKtSl/1U4F9QXnB69Uxq9sK9QpXFvavCVjTUKRSJC+6s9Z97e51hHWSdd3rp6/fvv5zsaj4col9SUXJx1Jh6eVvHL6p/GZiQ/KG7jLnsl0bSRulG29v8tx0oFy9PL+8f3PI5uYt+JbiLa+3Ltx6qWJGxe5ttG3Kbb2VwZWt2022b9z+sSq16la1T3XTDt0d63e83SnaeX2X167G3Xq7S3Z/2CPZc3dvwN7mGrOain2kfTn7ntZG13Z+y/22vk6nrqTu037p/t4DEQc66l3q6w/qHixrQBuUDcOHEg5d+873u9ZGm8a9TZymksNwWHn42feJ398+EnSk/Sj3aOMPpj/sOMY6VtyMNC9uHm1JbeltjWvtOT77eHube9uxH21/3H/C8ET1Sc2TZadopwpPTZzOPz12RnZm5GzK2f72he0PzsWeu9kR3tF9Puj8xQv+F851eneevuhx8cQlt0vHL3Mvt1xxvtLc5dR17Cenn451O3c3X3W52nrN9Vpbz8yeU9c9r5+94Xvjwk3+zSu35tzquT339t07CXd674ruDt3LuPfyfs798QcrHxIfFj9Se1TxWPdxzc+WPzf1Ovee7PPt63oS+eRBv7D/+T+y//FxoPAp82nFoMFg/ZDj0Ilh/+Frz+Y9G3guez4+UvSL+i87Xli8+OFXr1+7RmNHB17KX078VvpK+9X+1zNet4+FjT1+k/lm/G3xO+13B95z33d+iPkwOJ77kfyx8pPlp7bPQZ8fTmROTPwTA5jz/IzFdaUAAAAgY0hSTQAAeiYAAICEAAD6AAAAgOgAAHUwAADqYAAAOpgAABdwnLpRPAAAAAlwSFlzAAALEwAACxMBAJqcGAAAEAhpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDkuMC1jMDAwIDc5LjE3MWMyN2ZhYiwgMjAyMi8wOC8xNi0yMjozNTo0MSAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bWxuczpkYz0iaHR0cDovL3B1cmwub3JnL2RjL2VsZW1lbnRzLzEuMS8iIHhtbG5zOnhtcE1NPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvbW0vIiB4bWxuczpzdEV2dD0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL3NUeXBlL1Jlc291cmNlRXZlbnQjIiB4bWxuczpzdFJlZj0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL3NUeXBlL1Jlc291cmNlUmVmIyIgeG1sbnM6cGhvdG9zaG9wPSJodHRwOi8vbnMuYWRvYmUuY29tL3Bob3Rvc2hvcC8xLjAvIiB4bWxuczp0aWZmPSJodHRwOi8vbnMuYWRvYmUuY29tL3RpZmYvMS4wLyIgeG1sbnM6ZXhpZj0iaHR0cDovL25zLmFkb2JlLmNvbS9leGlmLzEuMC8iIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIDIxLjEgKE1hY2ludG9zaCkiIHhtcDpDcmVhdGVEYXRlPSIyMDIwLTAzLTI2VDExOjEwOjAyKzEzOjAwIiB4bXA6TWV0YWRhdGFEYXRlPSIyMDIyLTEyLTE1VDEwOjE0OjIxKzEzOjAwIiB4bXA6TW9kaWZ5RGF0ZT0iMjAyMi0xMi0xNVQxMDoxNDoyMSsxMzowMCIgZGM6Zm9ybWF0PSJpbWFnZS9wbmciIHhtcE1NOkluc3RhbmNlSUQ9InhtcC5paWQ6MzViZDEyMDQtNjA1MS00YTJhLTliY2EtYjQ3MDVjMmRmMDhiIiB4bXBNTTpEb2N1bWVudElEPSJhZG9iZTpkb2NpZDpwaG90b3Nob3A6ZWQ2M2JhNzMtNjkxMC0yODQwLTgxNGEtN2U2ZGI0NTE3NjhmIiB4bXBNTTpPcmlnaW5hbERvY3VtZW50SUQ9InhtcC5kaWQ6ZWU1NTEwZjgtNmI2ZC00NDJhLTkwOTMtMzQ4NmNlNDA0ZDU0IiBwaG90b3Nob3A6Q29sb3JNb2RlPSIzIiB0aWZmOk9yaWVudGF0aW9uPSIxIiB0aWZmOlhSZXNvbHV0aW9uPSI3MjAwMDAvMTAwMDAiIHRpZmY6WVJlc29sdXRpb249IjcyMDAwMC8xMDAwMCIgdGlmZjpSZXNvbHV0aW9uVW5pdD0iMiIgZXhpZjpDb2xvclNwYWNlPSI2NTUzNSIgZXhpZjpQaXhlbFhEaW1lbnNpb249Ijk2IiBleGlmOlBpeGVsWURpbWVuc2lvbj0iNjQiPiA8eG1wTU06SGlzdG9yeT4gPHJkZjpTZXE+IDxyZGY6bGkgc3RFdnQ6YWN0aW9uPSJjcmVhdGVkIiBzdEV2dDppbnN0YW5jZUlEPSJ4bXAuaWlkOmVlNTUxMGY4LTZiNmQtNDQyYS05MDkzLTM0ODZjZTQwNGQ1NCIgc3RFdnQ6d2hlbj0iMjAyMC0wMy0yNlQxMToxMDowMisxMzowMCIgc3RFdnQ6c29mdHdhcmVBZ2VudD0iQWRvYmUgUGhvdG9zaG9wIDIxLjEgKE1hY2ludG9zaCkiLz4gPHJkZjpsaSBzdEV2dDphY3Rpb249InNhdmVkIiBzdEV2dDppbnN0YW5jZUlEPSJ4bXAuaWlkOjEyYTg4Mjg4LWYzOWItNDU4My04M2FlLTk0NTExY2FjZGU5OCIgc3RFdnQ6d2hlbj0iMjAyMC0wMy0yNlQxNDoxNTozMisxMzowMCIgc3RFdnQ6c29mdHdhcmVBZ2VudD0iQWRvYmUgUGhvdG9zaG9wIDIxLjEgKE1hY2ludG9zaCkiIHN0RXZ0OmNoYW5nZWQ9Ii8iLz4gPHJkZjpsaSBzdEV2dDphY3Rpb249InNhdmVkIiBzdEV2dDppbnN0YW5jZUlEPSJ4bXAuaWlkOmEwMDkzM2E5LTA4NzctNDRlYi04YThmLTZlZDYyZjA1ZDhlZCIgc3RFdnQ6d2hlbj0iMjAyMC0wMy0yNlQxNDozNDo1NCsxMzowMCIgc3RFdnQ6c29mdHdhcmVBZ2VudD0iQWRvYmUgUGhvdG9zaG9wIDIxLjEgKE1hY2ludG9zaCkiIHN0RXZ0OmNoYW5nZWQ9Ii8iLz4gPHJkZjpsaSBzdEV2dDphY3Rpb249ImNvbnZlcnRlZCIgc3RFdnQ6cGFyYW1ldGVycz0iZnJvbSBhcHBsaWNhdGlvbi92bmQuYWRvYmUucGhvdG9zaG9wIHRvIGltYWdlL3BuZyIvPiA8cmRmOmxpIHN0RXZ0OmFjdGlvbj0iZGVyaXZlZCIgc3RFdnQ6cGFyYW1ldGVycz0iY29udmVydGVkIGZyb20gYXBwbGljYXRpb24vdm5kLmFkb2JlLnBob3Rvc2hvcCB0byBpbWFnZS9wbmciLz4gPHJkZjpsaSBzdEV2dDphY3Rpb249InNhdmVkIiBzdEV2dDppbnN0YW5jZUlEPSJ4bXAuaWlkOjlmZGE3OTBiLTZlODQtNGVmNS1hNGYxLTg0ZWFiMGIwNWJjOCIgc3RFdnQ6d2hlbj0iMjAyMC0wMy0yNlQxNDozNDo1NCsxMzowMCIgc3RFdnQ6c29mdHdhcmVBZ2VudD0iQWRvYmUgUGhvdG9zaG9wIDIxLjEgKE1hY2ludG9zaCkiIHN0RXZ0OmNoYW5nZWQ9Ii8iLz4gPHJkZjpsaSBzdEV2dDphY3Rpb249InNhdmVkIiBzdEV2dDppbnN0YW5jZUlEPSJ4bXAuaWlkOmFiMmM1Y2ExLWUzYTQtNGViMi1hODg5LTBmNzUwOWVlYmJhNiIgc3RFdnQ6d2hlbj0iMjAyMi0xMi0xNVQwODoyNjowMSsxMzowMCIgc3RFdnQ6c29mdHdhcmVBZ2VudD0iQWRvYmUgUGhvdG9zaG9wIDI0LjAgKE1hY2ludG9zaCkiIHN0RXZ0OmNoYW5nZWQ9Ii8iLz4gPHJkZjpsaSBzdEV2dDphY3Rpb249ImNvbnZlcnRlZCIgc3RFdnQ6cGFyYW1ldGVycz0iZnJvbSBpbWFnZS9wbmcgdG8gYXBwbGljYXRpb24vdm5kLmFkb2JlLnBob3Rvc2hvcCIvPiA8cmRmOmxpIHN0RXZ0OmFjdGlvbj0iZGVyaXZlZCIgc3RFdnQ6cGFyYW1ldGVycz0iY29udmVydGVkIGZyb20gaW1hZ2UvcG5nIHRvIGFwcGxpY2F0aW9uL3ZuZC5hZG9iZS5waG90b3Nob3AiLz4gPHJkZjpsaSBzdEV2dDphY3Rpb249InNhdmVkIiBzdEV2dDppbnN0YW5jZUlEPSJ4bXAuaWlkOjZiOTY1MjJmLTA3OTYtNDZhMS1iY2JjLTM2ZmJhYzIyNmQ4OSIgc3RFdnQ6d2hlbj0iMjAyMi0xMi0xNVQwODoyNjowMSsxMzowMCIgc3RFdnQ6c29mdHdhcmVBZ2VudD0iQWRvYmUgUGhvdG9zaG9wIDI0LjAgKE1hY2ludG9zaCkiIHN0RXZ0OmNoYW5nZWQ9Ii8iLz4gPHJkZjpsaSBzdEV2dDphY3Rpb249InNhdmVkIiBzdEV2dDppbnN0YW5jZUlEPSJ4bXAuaWlkOjhiNTE0YjFiLWE5N2ItNGQ3NS1iNzU0LThjNjk4ZDlhNmU1ZSIgc3RFdnQ6d2hlbj0iMjAyMi0xMi0xNVQxMDoxNDoyMSsxMzowMCIgc3RFdnQ6c29mdHdhcmVBZ2VudD0iQWRvYmUgUGhvdG9zaG9wIDI0LjAgKE1hY2ludG9zaCkiIHN0RXZ0OmNoYW5nZWQ9Ii8iLz4gPHJkZjpsaSBzdEV2dDphY3Rpb249ImNvbnZlcnRlZCIgc3RFdnQ6cGFyYW1ldGVycz0iZnJvbSBhcHBsaWNhdGlvbi92bmQuYWRvYmUucGhvdG9zaG9wIHRvIGltYWdlL3BuZyIvPiA8cmRmOmxpIHN0RXZ0OmFjdGlvbj0iZGVyaXZlZCIgc3RFdnQ6cGFyYW1ldGVycz0iY29udmVydGVkIGZyb20gYXBwbGljYXRpb24vdm5kLmFkb2JlLnBob3Rvc2hvcCB0byBpbWFnZS9wbmciLz4gPHJkZjpsaSBzdEV2dDphY3Rpb249InNhdmVkIiBzdEV2dDppbnN0YW5jZUlEPSJ4bXAuaWlkOjM1YmQxMjA0LTYwNTEtNGEyYS05YmNhLWI0NzA1YzJkZjA4YiIgc3RFdnQ6d2hlbj0iMjAyMi0xMi0xNVQxMDoxNDoyMSsxMzowMCIgc3RFdnQ6c29mdHdhcmVBZ2VudD0iQWRvYmUgUGhvdG9zaG9wIDI0LjAgKE1hY2ludG9zaCkiIHN0RXZ0OmNoYW5nZWQ9Ii8iLz4gPC9yZGY6U2VxPiA8L3htcE1NOkhpc3Rvcnk+IDx4bXBNTTpEZXJpdmVkRnJvbSBzdFJlZjppbnN0YW5jZUlEPSJ4bXAuaWlkOjhiNTE0YjFiLWE5N2ItNGQ3NS1iNzU0LThjNjk4ZDlhNmU1ZSIgc3RSZWY6ZG9jdW1lbnRJRD0iYWRvYmU6ZG9jaWQ6cGhvdG9zaG9wOjIyOTFjN2Q1LTdiMGYtNmI0YS1iMDNmLTZjMjlkMjBmZGI5MCIgc3RSZWY6b3JpZ2luYWxEb2N1bWVudElEPSJ4bXAuZGlkOmVlNTUxMGY4LTZiNmQtNDQyYS05MDkzLTM0ODZjZTQwNGQ1NCIvPiA8cGhvdG9zaG9wOkRvY3VtZW50QW5jZXN0b3JzPiA8cmRmOkJhZz4gPHJkZjpsaT5hZG9iZTpkb2NpZDpwaG90b3Nob3A6OGFkNDQ1MGUtN2ZmNS1iZTQyLTlmNTAtOGE0ZDBlYTU4MmFlPC9yZGY6bGk+IDwvcmRmOkJhZz4gPC9waG90b3Nob3A6RG9jdW1lbnRBbmNlc3RvcnM+IDwvcmRmOkRlc2NyaXB0aW9uPiA8L3JkZjpSREY+IDwveDp4bXBtZXRhPiA8P3hwYWNrZXQgZW5kPSJyIj8+RoRIaQAAAqNJREFUeJztm7GO00AQhuePLKhA6Jo7ieIewbI2BS+RK+koQOIR6N3T5QHuiuuo0PEaWVl+AAq6XHESOhqOWB4KDESO18nF68w6nk+yrGyczWQ+z+7KjsHMpMgxkQ5g7KgAYVSAMFG9AYBzUmBm9BtOePSdjw0BFU+7dnxEuHLx4KNz1FdBAHiMZ/pj8ZUnnQOEcQ1B/5hOp88OEcgQWCwWP3z3qRUgjAoQZkOATsC74StPWgHCqABhVIAwKkAYFSCMChBGBQijAoRRAcKoAGG2Xg3tA2vtfb3NGPPc1Z7n+ZuiKD4aY87W+lhGUfQhjuNr1+f8R+6fjRsydfq8HG2tvV9PVP31OlmWpWVZvjXGnFtrv00mk6skSdK2/nwz6svRSZKkAHJr7S2AvJ78oSIyBLWxPpzUz+Yoii5Xq9WrKIouDx9ZPwQnoG0IKYriHRFxtf98sKB6ZDBDUJZlKTPHxphTZo6zLEulY/JBcBVQX9H8XQWVZfneGPOyaju31i7zPP8ax/G1TKR+EF0FDY1Rr4KOFRUgjAoQRgUIowKEUQHCqABhVIAwKkAYFSDMhoC2Z6KU//jKk1aAMCpAGH1Ib0/0Ib0jofGGDIAnTe3M/KvfcMLDlQtfuCrgwbGNEWcuAMy6dt74jJhr6/plQ6QlFxdEdNNVgs4Be8LMX8iDBBXQAR8SVEBHukpQAR7oIkEFeGJfCcEKAHACYA5gCeBntZ8DOJGOzcVeEpg5yI2I5kTEDdtcOrYdYp9Vsc62Hbv1n3FSAFgS0WnDW7fMfNbQHhRVBdwQ0UVVGc3HBSxgRc2XSgpHe8g4JYT8Q+6ouQLuhlABuxLsJExEnx7ZPkhCroC02r8mohdE9J3+JD9tPHqgBDsHjIWQh6BRoAKEUQHC/AatzyrxOPjbVwAAAABJRU5ErkJggg=="},{style:d.Square,darkThemeSrc:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAGAAAABACAYAAADlNHIOAAAABGdBTUEAALGPC/xhBQAACktpQ0NQc1JHQiBJRUM2MTk2Ni0yLjEAAEiJnVNnVFPpFj333vRCS4iAlEtvUhUIIFJCi4BUaaISkgChhBgSQOyIqMCIoiKCFRkUccDREZCxIoqFQbH3AXkIKOPgKDZU3g/eGn2z5r03b/avvfY5Z53vnH0+AEZgsESahaoBZEoV8ogAHzw2Lh4ndwMKVCCBA4BAmC0LifSPAgDg+/Hw7IgAH/gCBODNbUAAAG7YBIbhOPx/UBfK5AoAJAwApovE2UIApBAAMnIVMgUAMgoA7KR0mQIAJQAAWx4bFw+AagEAO2WSTwMAdtIk9wIAtihTKgJAowBAJsoUiQDQDgBYl6MUiwCwYAAoypGIcwGwmwBgkqHMlABg7wCAnSkWZAMQGABgohALUwEI9gDAkEdF8AAIMwEojJSveNJXXCHOUwAA8LJki+WSlFQFbiG0xB1cXbl4oDg3Q6xQ2IQJhOkCuQjnZWXKBNLFAJMzAwCARnZEgA/O9+M5O7g6O9s42jp8taj/GvyLiI2L/5c/r8IBAQCE0/VF+7O8rBoA7hgAtvGLlrQdoGUNgNb9L5rJHgDVQoDmq1/Nw+H78fBUhULmZmeXm5trKxELbYWpX/X5nwl/AV/1s+X78fDf14P7ipMFygwFHhHggwuzMrKUcjxbJhCKcZs/HvHfLvzzd0yLECeL5WKpUIxHS8S5EmkKzsuSiiQKSZYUl0j/k4l/s+wPmLxrAGDVfgb2QltQu8oG7JcuILDogCXsAgDkd9+CqdEQBgAxBoOTdw8AMPmb/x1oGQCg2ZIUHACAFxGFC5XynMkYAQCACDRQBTZogz4YgwXYgCO4gDt4gR/MhlCIgjhYAEJIhUyQQy4shVVQBCWwEbZCFeyGWqiHRjgCLXACzsIFuALX4BY8gF4YgOcwCm9gHEEQMsJEWIg2YoCYItaII8JFZiF+SDASgcQhiUgKIkWUyFJkNVKClCNVyF6kHvkeOY6cRS4hPcg9pA8ZRn5DPqAYykDZqB5qhtqhXNQbDUKj0PloCroIzUcL0Q1oJVqDHkKb0bPoFfQW2os+R8cwwOgYBzPEbDAuxsNCsXgsGZNjy7FirAKrwRqxNqwTu4H1YiPYewKJwCLgBBuCOyGQMJcgJCwiLCeUEqoIBwjNhA7CDUIfYZTwmcgk6hKtiW5EPjGWmELMJRYRK4h1xGPE88RbxAHiGxKJxCGZk1xIgaQ4UhppCamUtJPURDpD6iH1k8bIZLI22ZrsQQ4lC8gKchF5O/kQ+TT5OnmA/I5CpxhQHCn+lHiKlFJAqaAcpJyiXKcMUsapalRTqhs1lCqiLqaWUWupbdSr1AHqOE2dZk7zoEXR0miraJW0Rtp52kPaKzqdbkR3pYfTJfSV9Er6YfpFeh/9PUODYcXgMRIYSsYGxn7GGcY9xismk2nG9GLGMxXMDcx65jnmY+Y7FZaKrQpfRaSyQqVapVnlusoLVaqqqaq36gLVfNUK1aOqV1VH1KhqZmo8NYHacrVqteNqd9TG1FnqDuqh6pnqpeoH1S+pD2mQNcw0/DREGoUa+zTOafSzMJYxi8cSslazalnnWQNsEtuczWensUvY37G72aOaGpozNKM18zSrNU9q9nIwjhmHz8nglHGOcG5zPkzRm+I9RTxl/ZTGKdenvNWaquWlJdYq1mrSuqX1QRvX9tNO196k3aL9SIegY6UTrpOrs0vnvM7IVPZU96nCqcVTj0y9r4vqWulG6C7R3afbpTump68XoCfT2653Tm9En6PvpZ+mv0X/lP6wActgloHEYIvBaYNnuCbujWfglXgHPmqoaxhoqDTca9htOG5kbjTXqMCoyeiRMc2Ya5xsvMW43XjUxMAkxGSpSYPJfVOqKdc01XSbaafpWzNzsxiztWYtZkPmWuZ883zzBvOHFkwLT4tFFjUWNy1JllzLdMudltesUCsnq1Sraqur1qi1s7XEeqd1zzTiNNdp0mk10+7YMGy8bXJsGmz6bDm2wbYFti22L+xM7OLtNtl12n22d7LPsK+1f+Cg4TDbocChzeE3RytHoWO1483pzOn+01dMb53+cob1DPGMXTPuOrGcQpzWOrU7fXJ2cZY7NzoPu5i4JLrscLnDZXPDuKXci65EVx/XFa4nXN+7Obsp3I64/epu457uftB9aKb5TPHM2pn9HkYeAo+9Hr2z8FmJs/bM6vU09BR41ng+8TL2EnnVeQ16W3qneR/yfuFj7yP3OebzlufGW8Y744v5BvgW+3b7afjN9avye+xv5J/i3+A/GuAUsCTgTCAxMChwU+Advh5fyK/nj852mb1sdkcQIygyqCroSbBVsDy4LQQNmR2yOeThHNM50jktoRDKD90c+ijMPGxR2I/hpPCw8OrwpxEOEUsjOiNZkQsjD0a+ifKJKot6MNdirnJue7RqdEJ0ffTbGN+Y8pjeWLvYZbFX4nTiJHGt8eT46Pi6+LF5fvO2zhtIcEooSrg933x+3vxLC3QWZCw4uVB1oWDh0URiYkziwcSPglBBjWAsiZ+0I2lUyBNuEz4XeYm2iIbFHuJy8WCyR3J58lCKR8rmlOFUz9SK1BEJT1IleZkWmLY77W16aPr+9ImMmIymTEpmYuZxqYY0XdqRpZ+Vl9Ujs5YVyXoXuS3aumhUHiSvy0ay52e3KtgKmaJLaaFco+zLmZVTnfMuNzr3aJ56njSva7HV4vWLB/P9879dQlgiXNK+1HDpqqV9y7yX7V2OLE9a3r7CeEXhioGVASsPrKKtSl/1U4F9QXnB69Uxq9sK9QpXFvavCVjTUKRSJC+6s9Z97e51hHWSdd3rp6/fvv5zsaj4col9SUXJx1Jh6eVvHL6p/GZiQ/KG7jLnsl0bSRulG29v8tx0oFy9PL+8f3PI5uYt+JbiLa+3Ltx6qWJGxe5ttG3Kbb2VwZWt2022b9z+sSq16la1T3XTDt0d63e83SnaeX2X167G3Xq7S3Z/2CPZc3dvwN7mGrOain2kfTn7ntZG13Z+y/22vk6nrqTu037p/t4DEQc66l3q6w/qHixrQBuUDcOHEg5d+873u9ZGm8a9TZymksNwWHn42feJ398+EnSk/Sj3aOMPpj/sOMY6VtyMNC9uHm1JbeltjWvtOT77eHube9uxH21/3H/C8ET1Sc2TZadopwpPTZzOPz12RnZm5GzK2f72he0PzsWeu9kR3tF9Puj8xQv+F851eneevuhx8cQlt0vHL3Mvt1xxvtLc5dR17Cenn451O3c3X3W52nrN9Vpbz8yeU9c9r5+94Xvjwk3+zSu35tzquT339t07CXd674ruDt3LuPfyfs798QcrHxIfFj9Se1TxWPdxzc+WPzf1Ovee7PPt63oS+eRBv7D/+T+y//FxoPAp82nFoMFg/ZDj0Ilh/+Frz+Y9G3guez4+UvSL+i87Xli8+OFXr1+7RmNHB17KX078VvpK+9X+1zNet4+FjT1+k/lm/G3xO+13B95z33d+iPkwOJ77kfyx8pPlp7bPQZ8fTmROTPwTA5jz/IzFdaUAAAAgY0hSTQAAeiYAAICEAAD6AAAAgOgAAHUwAADqYAAAOpgAABdwnLpRPAAAAAlwSFlzAAALEwAACxMBAJqcGAAAEFRpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDkuMC1jMDAwIDc5LjE3MWMyN2ZhYiwgMjAyMi8wOC8xNi0yMjozNTo0MSAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bWxuczpkYz0iaHR0cDovL3B1cmwub3JnL2RjL2VsZW1lbnRzLzEuMS8iIHhtbG5zOnhtcE1NPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvbW0vIiB4bWxuczpzdEV2dD0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL3NUeXBlL1Jlc291cmNlRXZlbnQjIiB4bWxuczpzdFJlZj0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL3NUeXBlL1Jlc291cmNlUmVmIyIgeG1sbnM6cGhvdG9zaG9wPSJodHRwOi8vbnMuYWRvYmUuY29tL3Bob3Rvc2hvcC8xLjAvIiB4bWxuczp0aWZmPSJodHRwOi8vbnMuYWRvYmUuY29tL3RpZmYvMS4wLyIgeG1sbnM6ZXhpZj0iaHR0cDovL25zLmFkb2JlLmNvbS9leGlmLzEuMC8iIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIDIxLjEgKE1hY2ludG9zaCkiIHhtcDpDcmVhdGVEYXRlPSIyMDIwLTAzLTI2VDExOjEwOjAyKzEzOjAwIiB4bXA6TWV0YWRhdGFEYXRlPSIyMDIyLTEyLTE1VDE0OjMwOjI2KzEzOjAwIiB4bXA6TW9kaWZ5RGF0ZT0iMjAyMi0xMi0xNVQxNDozMDoyNisxMzowMCIgZGM6Zm9ybWF0PSJpbWFnZS9wbmciIHhtcE1NOkluc3RhbmNlSUQ9InhtcC5paWQ6NDVmM2Q0YmQtMjFiNi00NDc2LTlhZTEtOTYxNGY5OTgzZWQwIiB4bXBNTTpEb2N1bWVudElEPSJhZG9iZTpkb2NpZDpwaG90b3Nob3A6NTMwMmI4MGEtODllNC0wNzQwLTk0NjktZjg1OWEzYjk1MjNhIiB4bXBNTTpPcmlnaW5hbERvY3VtZW50SUQ9InhtcC5kaWQ6ZWU1NTEwZjgtNmI2ZC00NDJhLTkwOTMtMzQ4NmNlNDA0ZDU0IiBwaG90b3Nob3A6Q29sb3JNb2RlPSIzIiB0aWZmOk9yaWVudGF0aW9uPSIxIiB0aWZmOlhSZXNvbHV0aW9uPSI3MjAwMDAvMTAwMDAiIHRpZmY6WVJlc29sdXRpb249IjcyMDAwMC8xMDAwMCIgdGlmZjpSZXNvbHV0aW9uVW5pdD0iMiIgZXhpZjpDb2xvclNwYWNlPSI2NTUzNSIgZXhpZjpQaXhlbFhEaW1lbnNpb249Ijk2IiBleGlmOlBpeGVsWURpbWVuc2lvbj0iNjQiPiA8eG1wTU06SGlzdG9yeT4gPHJkZjpTZXE+IDxyZGY6bGkgc3RFdnQ6YWN0aW9uPSJjcmVhdGVkIiBzdEV2dDppbnN0YW5jZUlEPSJ4bXAuaWlkOmVlNTUxMGY4LTZiNmQtNDQyYS05MDkzLTM0ODZjZTQwNGQ1NCIgc3RFdnQ6d2hlbj0iMjAyMC0wMy0yNlQxMToxMDowMisxMzowMCIgc3RFdnQ6c29mdHdhcmVBZ2VudD0iQWRvYmUgUGhvdG9zaG9wIDIxLjEgKE1hY2ludG9zaCkiLz4gPHJkZjpsaSBzdEV2dDphY3Rpb249InNhdmVkIiBzdEV2dDppbnN0YW5jZUlEPSJ4bXAuaWlkOjEyYTg4Mjg4LWYzOWItNDU4My04M2FlLTk0NTExY2FjZGU5OCIgc3RFdnQ6d2hlbj0iMjAyMC0wMy0yNlQxNDoxNTozMisxMzowMCIgc3RFdnQ6c29mdHdhcmVBZ2VudD0iQWRvYmUgUGhvdG9zaG9wIDIxLjEgKE1hY2ludG9zaCkiIHN0RXZ0OmNoYW5nZWQ9Ii8iLz4gPHJkZjpsaSBzdEV2dDphY3Rpb249InNhdmVkIiBzdEV2dDppbnN0YW5jZUlEPSJ4bXAuaWlkOmEwMDkzM2E5LTA4NzctNDRlYi04YThmLTZlZDYyZjA1ZDhlZCIgc3RFdnQ6d2hlbj0iMjAyMC0wMy0yNlQxNDozNDo1NCsxMzowMCIgc3RFdnQ6c29mdHdhcmVBZ2VudD0iQWRvYmUgUGhvdG9zaG9wIDIxLjEgKE1hY2ludG9zaCkiIHN0RXZ0OmNoYW5nZWQ9Ii8iLz4gPHJkZjpsaSBzdEV2dDphY3Rpb249ImNvbnZlcnRlZCIgc3RFdnQ6cGFyYW1ldGVycz0iZnJvbSBhcHBsaWNhdGlvbi92bmQuYWRvYmUucGhvdG9zaG9wIHRvIGltYWdlL3BuZyIvPiA8cmRmOmxpIHN0RXZ0OmFjdGlvbj0iZGVyaXZlZCIgc3RFdnQ6cGFyYW1ldGVycz0iY29udmVydGVkIGZyb20gYXBwbGljYXRpb24vdm5kLmFkb2JlLnBob3Rvc2hvcCB0byBpbWFnZS9wbmciLz4gPHJkZjpsaSBzdEV2dDphY3Rpb249InNhdmVkIiBzdEV2dDppbnN0YW5jZUlEPSJ4bXAuaWlkOjlmZGE3OTBiLTZlODQtNGVmNS1hNGYxLTg0ZWFiMGIwNWJjOCIgc3RFdnQ6d2hlbj0iMjAyMC0wMy0yNlQxNDozNDo1NCsxMzowMCIgc3RFdnQ6c29mdHdhcmVBZ2VudD0iQWRvYmUgUGhvdG9zaG9wIDIxLjEgKE1hY2ludG9zaCkiIHN0RXZ0OmNoYW5nZWQ9Ii8iLz4gPHJkZjpsaSBzdEV2dDphY3Rpb249InNhdmVkIiBzdEV2dDppbnN0YW5jZUlEPSJ4bXAuaWlkOmFiMmM1Y2ExLWUzYTQtNGViMi1hODg5LTBmNzUwOWVlYmJhNiIgc3RFdnQ6d2hlbj0iMjAyMi0xMi0xNVQwODoyNjowMSsxMzowMCIgc3RFdnQ6c29mdHdhcmVBZ2VudD0iQWRvYmUgUGhvdG9zaG9wIDI0LjAgKE1hY2ludG9zaCkiIHN0RXZ0OmNoYW5nZWQ9Ii8iLz4gPHJkZjpsaSBzdEV2dDphY3Rpb249ImNvbnZlcnRlZCIgc3RFdnQ6cGFyYW1ldGVycz0iZnJvbSBpbWFnZS9wbmcgdG8gYXBwbGljYXRpb24vdm5kLmFkb2JlLnBob3Rvc2hvcCIvPiA8cmRmOmxpIHN0RXZ0OmFjdGlvbj0iZGVyaXZlZCIgc3RFdnQ6cGFyYW1ldGVycz0iY29udmVydGVkIGZyb20gaW1hZ2UvcG5nIHRvIGFwcGxpY2F0aW9uL3ZuZC5hZG9iZS5waG90b3Nob3AiLz4gPHJkZjpsaSBzdEV2dDphY3Rpb249InNhdmVkIiBzdEV2dDppbnN0YW5jZUlEPSJ4bXAuaWlkOjZiOTY1MjJmLTA3OTYtNDZhMS1iY2JjLTM2ZmJhYzIyNmQ4OSIgc3RFdnQ6d2hlbj0iMjAyMi0xMi0xNVQwODoyNjowMSsxMzowMCIgc3RFdnQ6c29mdHdhcmVBZ2VudD0iQWRvYmUgUGhvdG9zaG9wIDI0LjAgKE1hY2ludG9zaCkiIHN0RXZ0OmNoYW5nZWQ9Ii8iLz4gPHJkZjpsaSBzdEV2dDphY3Rpb249InNhdmVkIiBzdEV2dDppbnN0YW5jZUlEPSJ4bXAuaWlkOjlmZTZlYzA5LTk4MDctNDE5OC1hNWZlLTUxNmZkOTg3ZDNiMyIgc3RFdnQ6d2hlbj0iMjAyMi0xMi0xNVQxNDozMDoyNisxMzowMCIgc3RFdnQ6c29mdHdhcmVBZ2VudD0iQWRvYmUgUGhvdG9zaG9wIDI0LjAgKE1hY2ludG9zaCkiIHN0RXZ0OmNoYW5nZWQ9Ii8iLz4gPHJkZjpsaSBzdEV2dDphY3Rpb249ImNvbnZlcnRlZCIgc3RFdnQ6cGFyYW1ldGVycz0iZnJvbSBhcHBsaWNhdGlvbi92bmQuYWRvYmUucGhvdG9zaG9wIHRvIGltYWdlL3BuZyIvPiA8cmRmOmxpIHN0RXZ0OmFjdGlvbj0iZGVyaXZlZCIgc3RFdnQ6cGFyYW1ldGVycz0iY29udmVydGVkIGZyb20gYXBwbGljYXRpb24vdm5kLmFkb2JlLnBob3Rvc2hvcCB0byBpbWFnZS9wbmciLz4gPHJkZjpsaSBzdEV2dDphY3Rpb249InNhdmVkIiBzdEV2dDppbnN0YW5jZUlEPSJ4bXAuaWlkOjQ1ZjNkNGJkLTIxYjYtNDQ3Ni05YWUxLTk2MTRmOTk4M2VkMCIgc3RFdnQ6d2hlbj0iMjAyMi0xMi0xNVQxNDozMDoyNisxMzowMCIgc3RFdnQ6c29mdHdhcmVBZ2VudD0iQWRvYmUgUGhvdG9zaG9wIDI0LjAgKE1hY2ludG9zaCkiIHN0RXZ0OmNoYW5nZWQ9Ii8iLz4gPC9yZGY6U2VxPiA8L3htcE1NOkhpc3Rvcnk+IDx4bXBNTTpEZXJpdmVkRnJvbSBzdFJlZjppbnN0YW5jZUlEPSJ4bXAuaWlkOjlmZTZlYzA5LTk4MDctNDE5OC1hNWZlLTUxNmZkOTg3ZDNiMyIgc3RSZWY6ZG9jdW1lbnRJRD0iYWRvYmU6ZG9jaWQ6cGhvdG9zaG9wOjIyOTFjN2Q1LTdiMGYtNmI0YS1iMDNmLTZjMjlkMjBmZGI5MCIgc3RSZWY6b3JpZ2luYWxEb2N1bWVudElEPSJ4bXAuZGlkOmVlNTUxMGY4LTZiNmQtNDQyYS05MDkzLTM0ODZjZTQwNGQ1NCIvPiA8cGhvdG9zaG9wOkRvY3VtZW50QW5jZXN0b3JzPiA8cmRmOkJhZz4gPHJkZjpsaT5hZG9iZTpkb2NpZDpwaG90b3Nob3A6MjI5MWM3ZDUtN2IwZi02YjRhLWIwM2YtNmMyOWQyMGZkYjkwPC9yZGY6bGk+IDxyZGY6bGk+YWRvYmU6ZG9jaWQ6cGhvdG9zaG9wOjhhZDQ0NTBlLTdmZjUtYmU0Mi05ZjUwLThhNGQwZWE1ODJhZTwvcmRmOmxpPiA8L3JkZjpCYWc+IDwvcGhvdG9zaG9wOkRvY3VtZW50QW5jZXN0b3JzPiA8L3JkZjpEZXNjcmlwdGlvbj4gPC9yZGY6UkRGPiA8L3g6eG1wbWV0YT4gPD94cGFja2V0IGVuZD0iciI/PoTh4bYAAAI7SURBVHic7dtPbptAGAXwh9t0wTQLuonTA/gGXvsEyTECay6AuAVUPkV7Aq+9Y+kD1MmmSE7DIlI9XVSWKMX/MPQZ5/0kSw4m49H3NDM2YxxrLYRnwO7AW6cAyBQA2Xt2By7WF6d+cX2wTvlPjQAyBUCmAMgUAJkC6MbdoSc6+ibcujsAXwHcA/i272SNgHYdVXxAAbTp6OIDCqAtjYoPKIA2NC4+oABOdVLxAV0LaqZ8nefBNi4+UB+APpcep3HxgS0jII7j67rjURT9POXN+iiO44/VY9Etnttqv+6LmAXg1Jwrf2ulTlqEyQ5ZhL933ov++Nx2gxoBZAqATAGQKQAyBUCmAMgUAJkCIFMAZAqATAGQKQAyBUBGCcBxnNvqY9fxJElcY8yw3IYxZpgkibvr//qAsidsrV0Cfwq3eV59rSwIgmKxWLzzPO8mz/Mnz/NufN9/CYKg2NfeuTtkR6yz/YBqwfYVcDKZfJrP5x/G4/HrbDb7sa+9DpT3Ay5zR2zXNOL7frFer+H7fsHoWxfOLgBr7XLzqL6Wpqk7GAyQpqnL6FsXzi6AbcIwvM6y7Kooiscsy67CMKz95UbfnN0Ps6pTj7V2mSSJO51OzWq1egSAPM+fjDHD0Wj0a7MQ9xV1Ee6hy1+E3xoFQKYAyBQAmQIgUwBkCoBMAZApADIFQKYAyBQAmQIg0016zelq6CXYdp/wP/fGArpPuCyKolba3zYFyWFOnoLqRoDm//9IawCZAiBTAGS/ASn/tOZ3KbsPAAAAAElFTkSuQmCC",lightThemeSrc:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAGAAAABACAYAAADlNHIOAAAABGdBTUEAALGPC/xhBQAACktpQ0NQc1JHQiBJRUM2MTk2Ni0yLjEAAEiJnVNnVFPpFj333vRCS4iAlEtvUhUIIFJCi4BUaaISkgChhBgSQOyIqMCIoiKCFRkUccDREZCxIoqFQbH3AXkIKOPgKDZU3g/eGn2z5r03b/avvfY5Z53vnH0+AEZgsESahaoBZEoV8ogAHzw2Lh4ndwMKVCCBA4BAmC0LifSPAgDg+/Hw7IgAH/gCBODNbUAAAG7YBIbhOPx/UBfK5AoAJAwApovE2UIApBAAMnIVMgUAMgoA7KR0mQIAJQAAWx4bFw+AagEAO2WSTwMAdtIk9wIAtihTKgJAowBAJsoUiQDQDgBYl6MUiwCwYAAoypGIcwGwmwBgkqHMlABg7wCAnSkWZAMQGABgohALUwEI9gDAkEdF8AAIMwEojJSveNJXXCHOUwAA8LJki+WSlFQFbiG0xB1cXbl4oDg3Q6xQ2IQJhOkCuQjnZWXKBNLFAJMzAwCARnZEgA/O9+M5O7g6O9s42jp8taj/GvyLiI2L/5c/r8IBAQCE0/VF+7O8rBoA7hgAtvGLlrQdoGUNgNb9L5rJHgDVQoDmq1/Nw+H78fBUhULmZmeXm5trKxELbYWpX/X5nwl/AV/1s+X78fDf14P7ipMFygwFHhHggwuzMrKUcjxbJhCKcZs/HvHfLvzzd0yLECeL5WKpUIxHS8S5EmkKzsuSiiQKSZYUl0j/k4l/s+wPmLxrAGDVfgb2QltQu8oG7JcuILDogCXsAgDkd9+CqdEQBgAxBoOTdw8AMPmb/x1oGQCg2ZIUHACAFxGFC5XynMkYAQCACDRQBTZogz4YgwXYgCO4gDt4gR/MhlCIgjhYAEJIhUyQQy4shVVQBCWwEbZCFeyGWqiHRjgCLXACzsIFuALX4BY8gF4YgOcwCm9gHEEQMsJEWIg2YoCYItaII8JFZiF+SDASgcQhiUgKIkWUyFJkNVKClCNVyF6kHvkeOY6cRS4hPcg9pA8ZRn5DPqAYykDZqB5qhtqhXNQbDUKj0PloCroIzUcL0Q1oJVqDHkKb0bPoFfQW2os+R8cwwOgYBzPEbDAuxsNCsXgsGZNjy7FirAKrwRqxNqwTu4H1YiPYewKJwCLgBBuCOyGQMJcgJCwiLCeUEqoIBwjNhA7CDUIfYZTwmcgk6hKtiW5EPjGWmELMJRYRK4h1xGPE88RbxAHiGxKJxCGZk1xIgaQ4UhppCamUtJPURDpD6iH1k8bIZLI22ZrsQQ4lC8gKchF5O/kQ+TT5OnmA/I5CpxhQHCn+lHiKlFJAqaAcpJyiXKcMUsapalRTqhs1lCqiLqaWUWupbdSr1AHqOE2dZk7zoEXR0miraJW0Rtp52kPaKzqdbkR3pYfTJfSV9Er6YfpFeh/9PUODYcXgMRIYSsYGxn7GGcY9xismk2nG9GLGMxXMDcx65jnmY+Y7FZaKrQpfRaSyQqVapVnlusoLVaqqqaq36gLVfNUK1aOqV1VH1KhqZmo8NYHacrVqteNqd9TG1FnqDuqh6pnqpeoH1S+pD2mQNcw0/DREGoUa+zTOafSzMJYxi8cSslazalnnWQNsEtuczWensUvY37G72aOaGpozNKM18zSrNU9q9nIwjhmHz8nglHGOcG5zPkzRm+I9RTxl/ZTGKdenvNWaquWlJdYq1mrSuqX1QRvX9tNO196k3aL9SIegY6UTrpOrs0vnvM7IVPZU96nCqcVTj0y9r4vqWulG6C7R3afbpTump68XoCfT2653Tm9En6PvpZ+mv0X/lP6wActgloHEYIvBaYNnuCbujWfglXgHPmqoaxhoqDTca9htOG5kbjTXqMCoyeiRMc2Ya5xsvMW43XjUxMAkxGSpSYPJfVOqKdc01XSbaafpWzNzsxiztWYtZkPmWuZ883zzBvOHFkwLT4tFFjUWNy1JllzLdMudltesUCsnq1Sraqur1qi1s7XEeqd1zzTiNNdp0mk10+7YMGy8bXJsGmz6bDm2wbYFti22L+xM7OLtNtl12n22d7LPsK+1f+Cg4TDbocChzeE3RytHoWO1483pzOn+01dMb53+cob1DPGMXTPuOrGcQpzWOrU7fXJ2cZY7NzoPu5i4JLrscLnDZXPDuKXci65EVx/XFa4nXN+7Obsp3I64/epu457uftB9aKb5TPHM2pn9HkYeAo+9Hr2z8FmJs/bM6vU09BR41ng+8TL2EnnVeQ16W3qneR/yfuFj7yP3OebzlufGW8Y744v5BvgW+3b7afjN9avye+xv5J/i3+A/GuAUsCTgTCAxMChwU+Advh5fyK/nj852mb1sdkcQIygyqCroSbBVsDy4LQQNmR2yOeThHNM50jktoRDKD90c+ijMPGxR2I/hpPCw8OrwpxEOEUsjOiNZkQsjD0a+ifKJKot6MNdirnJue7RqdEJ0ffTbGN+Y8pjeWLvYZbFX4nTiJHGt8eT46Pi6+LF5fvO2zhtIcEooSrg933x+3vxLC3QWZCw4uVB1oWDh0URiYkziwcSPglBBjWAsiZ+0I2lUyBNuEz4XeYm2iIbFHuJy8WCyR3J58lCKR8rmlOFUz9SK1BEJT1IleZkWmLY77W16aPr+9ImMmIymTEpmYuZxqYY0XdqRpZ+Vl9Ujs5YVyXoXuS3aumhUHiSvy0ay52e3KtgKmaJLaaFco+zLmZVTnfMuNzr3aJ56njSva7HV4vWLB/P9879dQlgiXNK+1HDpqqV9y7yX7V2OLE9a3r7CeEXhioGVASsPrKKtSl/1U4F9QXnB69Uxq9sK9QpXFvavCVjTUKRSJC+6s9Z97e51hHWSdd3rp6/fvv5zsaj4col9SUXJx1Jh6eVvHL6p/GZiQ/KG7jLnsl0bSRulG29v8tx0oFy9PL+8f3PI5uYt+JbiLa+3Ltx6qWJGxe5ttG3Kbb2VwZWt2022b9z+sSq16la1T3XTDt0d63e83SnaeX2X167G3Xq7S3Z/2CPZc3dvwN7mGrOain2kfTn7ntZG13Z+y/22vk6nrqTu037p/t4DEQc66l3q6w/qHixrQBuUDcOHEg5d+873u9ZGm8a9TZymksNwWHn42feJ398+EnSk/Sj3aOMPpj/sOMY6VtyMNC9uHm1JbeltjWvtOT77eHube9uxH21/3H/C8ET1Sc2TZadopwpPTZzOPz12RnZm5GzK2f72he0PzsWeu9kR3tF9Puj8xQv+F851eneevuhx8cQlt0vHL3Mvt1xxvtLc5dR17Cenn451O3c3X3W52nrN9Vpbz8yeU9c9r5+94Xvjwk3+zSu35tzquT339t07CXd674ruDt3LuPfyfs798QcrHxIfFj9Se1TxWPdxzc+WPzf1Ovee7PPt63oS+eRBv7D/+T+y//FxoPAp82nFoMFg/ZDj0Ilh/+Frz+Y9G3guez4+UvSL+i87Xli8+OFXr1+7RmNHB17KX078VvpK+9X+1zNet4+FjT1+k/lm/G3xO+13B95z33d+iPkwOJ77kfyx8pPlp7bPQZ8fTmROTPwTA5jz/IzFdaUAAAAgY0hSTQAAeiYAAICEAAD6AAAAgOgAAHUwAADqYAAAOpgAABdwnLpRPAAAAAlwSFlzAAALEwAACxMBAJqcGAAAEAhpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDkuMC1jMDAwIDc5LjE3MWMyN2ZhYiwgMjAyMi8wOC8xNi0yMjozNTo0MSAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bWxuczpkYz0iaHR0cDovL3B1cmwub3JnL2RjL2VsZW1lbnRzLzEuMS8iIHhtbG5zOnhtcE1NPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvbW0vIiB4bWxuczpzdEV2dD0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL3NUeXBlL1Jlc291cmNlRXZlbnQjIiB4bWxuczpzdFJlZj0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL3NUeXBlL1Jlc291cmNlUmVmIyIgeG1sbnM6cGhvdG9zaG9wPSJodHRwOi8vbnMuYWRvYmUuY29tL3Bob3Rvc2hvcC8xLjAvIiB4bWxuczp0aWZmPSJodHRwOi8vbnMuYWRvYmUuY29tL3RpZmYvMS4wLyIgeG1sbnM6ZXhpZj0iaHR0cDovL25zLmFkb2JlLmNvbS9leGlmLzEuMC8iIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIDIxLjEgKE1hY2ludG9zaCkiIHhtcDpDcmVhdGVEYXRlPSIyMDIwLTAzLTI2VDExOjEwOjAyKzEzOjAwIiB4bXA6TWV0YWRhdGFEYXRlPSIyMDIyLTEyLTE1VDEwOjA0OjMzKzEzOjAwIiB4bXA6TW9kaWZ5RGF0ZT0iMjAyMi0xMi0xNVQxMDowNDozMysxMzowMCIgZGM6Zm9ybWF0PSJpbWFnZS9wbmciIHhtcE1NOkluc3RhbmNlSUQ9InhtcC5paWQ6YWJhM2M1ODQtYjYyMS00ZWMyLWI0ZTUtMmU0MGZjZmIyYTM5IiB4bXBNTTpEb2N1bWVudElEPSJhZG9iZTpkb2NpZDpwaG90b3Nob3A6MjZhZGY2ODMtOGU3ZC05MDQyLTg0NDMtYTkwMDZjZWQwYTMwIiB4bXBNTTpPcmlnaW5hbERvY3VtZW50SUQ9InhtcC5kaWQ6ZWU1NTEwZjgtNmI2ZC00NDJhLTkwOTMtMzQ4NmNlNDA0ZDU0IiBwaG90b3Nob3A6Q29sb3JNb2RlPSIzIiB0aWZmOk9yaWVudGF0aW9uPSIxIiB0aWZmOlhSZXNvbHV0aW9uPSI3MjAwMDAvMTAwMDAiIHRpZmY6WVJlc29sdXRpb249IjcyMDAwMC8xMDAwMCIgdGlmZjpSZXNvbHV0aW9uVW5pdD0iMiIgZXhpZjpDb2xvclNwYWNlPSI2NTUzNSIgZXhpZjpQaXhlbFhEaW1lbnNpb249Ijk2IiBleGlmOlBpeGVsWURpbWVuc2lvbj0iNjQiPiA8eG1wTU06SGlzdG9yeT4gPHJkZjpTZXE+IDxyZGY6bGkgc3RFdnQ6YWN0aW9uPSJjcmVhdGVkIiBzdEV2dDppbnN0YW5jZUlEPSJ4bXAuaWlkOmVlNTUxMGY4LTZiNmQtNDQyYS05MDkzLTM0ODZjZTQwNGQ1NCIgc3RFdnQ6d2hlbj0iMjAyMC0wMy0yNlQxMToxMDowMisxMzowMCIgc3RFdnQ6c29mdHdhcmVBZ2VudD0iQWRvYmUgUGhvdG9zaG9wIDIxLjEgKE1hY2ludG9zaCkiLz4gPHJkZjpsaSBzdEV2dDphY3Rpb249InNhdmVkIiBzdEV2dDppbnN0YW5jZUlEPSJ4bXAuaWlkOjEyYTg4Mjg4LWYzOWItNDU4My04M2FlLTk0NTExY2FjZGU5OCIgc3RFdnQ6d2hlbj0iMjAyMC0wMy0yNlQxNDoxNTozMisxMzowMCIgc3RFdnQ6c29mdHdhcmVBZ2VudD0iQWRvYmUgUGhvdG9zaG9wIDIxLjEgKE1hY2ludG9zaCkiIHN0RXZ0OmNoYW5nZWQ9Ii8iLz4gPHJkZjpsaSBzdEV2dDphY3Rpb249InNhdmVkIiBzdEV2dDppbnN0YW5jZUlEPSJ4bXAuaWlkOmEwMDkzM2E5LTA4NzctNDRlYi04YThmLTZlZDYyZjA1ZDhlZCIgc3RFdnQ6d2hlbj0iMjAyMC0wMy0yNlQxNDozNDo1NCsxMzowMCIgc3RFdnQ6c29mdHdhcmVBZ2VudD0iQWRvYmUgUGhvdG9zaG9wIDIxLjEgKE1hY2ludG9zaCkiIHN0RXZ0OmNoYW5nZWQ9Ii8iLz4gPHJkZjpsaSBzdEV2dDphY3Rpb249ImNvbnZlcnRlZCIgc3RFdnQ6cGFyYW1ldGVycz0iZnJvbSBhcHBsaWNhdGlvbi92bmQuYWRvYmUucGhvdG9zaG9wIHRvIGltYWdlL3BuZyIvPiA8cmRmOmxpIHN0RXZ0OmFjdGlvbj0iZGVyaXZlZCIgc3RFdnQ6cGFyYW1ldGVycz0iY29udmVydGVkIGZyb20gYXBwbGljYXRpb24vdm5kLmFkb2JlLnBob3Rvc2hvcCB0byBpbWFnZS9wbmciLz4gPHJkZjpsaSBzdEV2dDphY3Rpb249InNhdmVkIiBzdEV2dDppbnN0YW5jZUlEPSJ4bXAuaWlkOjlmZGE3OTBiLTZlODQtNGVmNS1hNGYxLTg0ZWFiMGIwNWJjOCIgc3RFdnQ6d2hlbj0iMjAyMC0wMy0yNlQxNDozNDo1NCsxMzowMCIgc3RFdnQ6c29mdHdhcmVBZ2VudD0iQWRvYmUgUGhvdG9zaG9wIDIxLjEgKE1hY2ludG9zaCkiIHN0RXZ0OmNoYW5nZWQ9Ii8iLz4gPHJkZjpsaSBzdEV2dDphY3Rpb249InNhdmVkIiBzdEV2dDppbnN0YW5jZUlEPSJ4bXAuaWlkOmFiMmM1Y2ExLWUzYTQtNGViMi1hODg5LTBmNzUwOWVlYmJhNiIgc3RFdnQ6d2hlbj0iMjAyMi0xMi0xNVQwODoyNjowMSsxMzowMCIgc3RFdnQ6c29mdHdhcmVBZ2VudD0iQWRvYmUgUGhvdG9zaG9wIDI0LjAgKE1hY2ludG9zaCkiIHN0RXZ0OmNoYW5nZWQ9Ii8iLz4gPHJkZjpsaSBzdEV2dDphY3Rpb249ImNvbnZlcnRlZCIgc3RFdnQ6cGFyYW1ldGVycz0iZnJvbSBpbWFnZS9wbmcgdG8gYXBwbGljYXRpb24vdm5kLmFkb2JlLnBob3Rvc2hvcCIvPiA8cmRmOmxpIHN0RXZ0OmFjdGlvbj0iZGVyaXZlZCIgc3RFdnQ6cGFyYW1ldGVycz0iY29udmVydGVkIGZyb20gaW1hZ2UvcG5nIHRvIGFwcGxpY2F0aW9uL3ZuZC5hZG9iZS5waG90b3Nob3AiLz4gPHJkZjpsaSBzdEV2dDphY3Rpb249InNhdmVkIiBzdEV2dDppbnN0YW5jZUlEPSJ4bXAuaWlkOjZiOTY1MjJmLTA3OTYtNDZhMS1iY2JjLTM2ZmJhYzIyNmQ4OSIgc3RFdnQ6d2hlbj0iMjAyMi0xMi0xNVQwODoyNjowMSsxMzowMCIgc3RFdnQ6c29mdHdhcmVBZ2VudD0iQWRvYmUgUGhvdG9zaG9wIDI0LjAgKE1hY2ludG9zaCkiIHN0RXZ0OmNoYW5nZWQ9Ii8iLz4gPHJkZjpsaSBzdEV2dDphY3Rpb249InNhdmVkIiBzdEV2dDppbnN0YW5jZUlEPSJ4bXAuaWlkOmVjNmI5ODJjLWNjMzYtNGQwNi1hNGY4LTljNDMyZTM0MDA4ZSIgc3RFdnQ6d2hlbj0iMjAyMi0xMi0xNVQxMDowNDozMysxMzowMCIgc3RFdnQ6c29mdHdhcmVBZ2VudD0iQWRvYmUgUGhvdG9zaG9wIDI0LjAgKE1hY2ludG9zaCkiIHN0RXZ0OmNoYW5nZWQ9Ii8iLz4gPHJkZjpsaSBzdEV2dDphY3Rpb249ImNvbnZlcnRlZCIgc3RFdnQ6cGFyYW1ldGVycz0iZnJvbSBhcHBsaWNhdGlvbi92bmQuYWRvYmUucGhvdG9zaG9wIHRvIGltYWdlL3BuZyIvPiA8cmRmOmxpIHN0RXZ0OmFjdGlvbj0iZGVyaXZlZCIgc3RFdnQ6cGFyYW1ldGVycz0iY29udmVydGVkIGZyb20gYXBwbGljYXRpb24vdm5kLmFkb2JlLnBob3Rvc2hvcCB0byBpbWFnZS9wbmciLz4gPHJkZjpsaSBzdEV2dDphY3Rpb249InNhdmVkIiBzdEV2dDppbnN0YW5jZUlEPSJ4bXAuaWlkOmFiYTNjNTg0LWI2MjEtNGVjMi1iNGU1LTJlNDBmY2ZiMmEzOSIgc3RFdnQ6d2hlbj0iMjAyMi0xMi0xNVQxMDowNDozMysxMzowMCIgc3RFdnQ6c29mdHdhcmVBZ2VudD0iQWRvYmUgUGhvdG9zaG9wIDI0LjAgKE1hY2ludG9zaCkiIHN0RXZ0OmNoYW5nZWQ9Ii8iLz4gPC9yZGY6U2VxPiA8L3htcE1NOkhpc3Rvcnk+IDx4bXBNTTpEZXJpdmVkRnJvbSBzdFJlZjppbnN0YW5jZUlEPSJ4bXAuaWlkOmVjNmI5ODJjLWNjMzYtNGQwNi1hNGY4LTljNDMyZTM0MDA4ZSIgc3RSZWY6ZG9jdW1lbnRJRD0iYWRvYmU6ZG9jaWQ6cGhvdG9zaG9wOjIyOTFjN2Q1LTdiMGYtNmI0YS1iMDNmLTZjMjlkMjBmZGI5MCIgc3RSZWY6b3JpZ2luYWxEb2N1bWVudElEPSJ4bXAuZGlkOmVlNTUxMGY4LTZiNmQtNDQyYS05MDkzLTM0ODZjZTQwNGQ1NCIvPiA8cGhvdG9zaG9wOkRvY3VtZW50QW5jZXN0b3JzPiA8cmRmOkJhZz4gPHJkZjpsaT5hZG9iZTpkb2NpZDpwaG90b3Nob3A6OGFkNDQ1MGUtN2ZmNS1iZTQyLTlmNTAtOGE0ZDBlYTU4MmFlPC9yZGY6bGk+IDwvcmRmOkJhZz4gPC9waG90b3Nob3A6RG9jdW1lbnRBbmNlc3RvcnM+IDwvcmRmOkRlc2NyaXB0aW9uPiA8L3JkZjpSREY+IDwveDp4bXBtZXRhPiA8P3hwYWNrZXQgZW5kPSJyIj8+bzx8FQAAAe1JREFUeJztnDFSwkAYhd9zHC0sLDiDB7C0t8VDWKjjRTyAjVpwCG3tPYRnoKPRwmdB4ihuDIbgA3zfTAaygd2d/yO7yS4bSkLwseWuwH8nAsxEgJltdwU2ljuWO9cz8fNuzgAzEWAmAsxEgJkIWAIkh3N/NnfC3SDZdGgI4B7AiaSHtnxyBvTLr4IPRECffAQfwFzBByKgLzoFH4iAPugcfCACFmWh4AO5CurGp3EenpeDP29cvw3GkQ2DSOED3X7Z7fTLr2kaDd0tFiy9LlLYOkJyp5D8Ur9ZtAX51gSRlKTGu4wwpa84pRM2EwFmIsBMBJiJADMRYCYCzESAmQgwEwFmIsBMBJiJADMRYCYCzFgEkNTs1pJ+SnIyk8eE5OlP31sHLOsD6omM0qRGaZJD0ojkAcmxpAHJMYBrSaO2/FYd64zYbFltZZN8BHAE4EnScVt+y2RjZ8RampEbTOt888fVWhorJ0AS661w+ALAW/W6EaycgCZIXgE4lLQH4LDaX3tWbpHebNMjidXVzqWk/SptUF0FPdcd8bqSv6V0ZGM74f9GBJiJADMRYCYCzESAmQgwEwFmIsBMBJiJADMRYCYCzESAmQgwU5yQaVgbm3XCS6BpRuyllPjDQ4pCR/KsCDPpA8xEgJkIMPMOoaG9maMqnmAAAAAASUVORK5CYII="},{style:d.Random,darkThemeSrc:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAGAAAABACAYAAADlNHIOAAAABGdBTUEAALGPC/xhBQAACktpQ0NQc1JHQiBJRUM2MTk2Ni0yLjEAAEiJnVNnVFPpFj333vRCS4iAlEtvUhUIIFJCi4BUaaISkgChhBgSQOyIqMCIoiKCFRkUccDREZCxIoqFQbH3AXkIKOPgKDZU3g/eGn2z5r03b/avvfY5Z53vnH0+AEZgsESahaoBZEoV8ogAHzw2Lh4ndwMKVCCBA4BAmC0LifSPAgDg+/Hw7IgAH/gCBODNbUAAAG7YBIbhOPx/UBfK5AoAJAwApovE2UIApBAAMnIVMgUAMgoA7KR0mQIAJQAAWx4bFw+AagEAO2WSTwMAdtIk9wIAtihTKgJAowBAJsoUiQDQDgBYl6MUiwCwYAAoypGIcwGwmwBgkqHMlABg7wCAnSkWZAMQGABgohALUwEI9gDAkEdF8AAIMwEojJSveNJXXCHOUwAA8LJki+WSlFQFbiG0xB1cXbl4oDg3Q6xQ2IQJhOkCuQjnZWXKBNLFAJMzAwCARnZEgA/O9+M5O7g6O9s42jp8taj/GvyLiI2L/5c/r8IBAQCE0/VF+7O8rBoA7hgAtvGLlrQdoGUNgNb9L5rJHgDVQoDmq1/Nw+H78fBUhULmZmeXm5trKxELbYWpX/X5nwl/AV/1s+X78fDf14P7ipMFygwFHhHggwuzMrKUcjxbJhCKcZs/HvHfLvzzd0yLECeL5WKpUIxHS8S5EmkKzsuSiiQKSZYUl0j/k4l/s+wPmLxrAGDVfgb2QltQu8oG7JcuILDogCXsAgDkd9+CqdEQBgAxBoOTdw8AMPmb/x1oGQCg2ZIUHACAFxGFC5XynMkYAQCACDRQBTZogz4YgwXYgCO4gDt4gR/MhlCIgjhYAEJIhUyQQy4shVVQBCWwEbZCFeyGWqiHRjgCLXACzsIFuALX4BY8gF4YgOcwCm9gHEEQMsJEWIg2YoCYItaII8JFZiF+SDASgcQhiUgKIkWUyFJkNVKClCNVyF6kHvkeOY6cRS4hPcg9pA8ZRn5DPqAYykDZqB5qhtqhXNQbDUKj0PloCroIzUcL0Q1oJVqDHkKb0bPoFfQW2os+R8cwwOgYBzPEbDAuxsNCsXgsGZNjy7FirAKrwRqxNqwTu4H1YiPYewKJwCLgBBuCOyGQMJcgJCwiLCeUEqoIBwjNhA7CDUIfYZTwmcgk6hKtiW5EPjGWmELMJRYRK4h1xGPE88RbxAHiGxKJxCGZk1xIgaQ4UhppCamUtJPURDpD6iH1k8bIZLI22ZrsQQ4lC8gKchF5O/kQ+TT5OnmA/I5CpxhQHCn+lHiKlFJAqaAcpJyiXKcMUsapalRTqhs1lCqiLqaWUWupbdSr1AHqOE2dZk7zoEXR0miraJW0Rtp52kPaKzqdbkR3pYfTJfSV9Er6YfpFeh/9PUODYcXgMRIYSsYGxn7GGcY9xismk2nG9GLGMxXMDcx65jnmY+Y7FZaKrQpfRaSyQqVapVnlusoLVaqqqaq36gLVfNUK1aOqV1VH1KhqZmo8NYHacrVqteNqd9TG1FnqDuqh6pnqpeoH1S+pD2mQNcw0/DREGoUa+zTOafSzMJYxi8cSslazalnnWQNsEtuczWensUvY37G72aOaGpozNKM18zSrNU9q9nIwjhmHz8nglHGOcG5zPkzRm+I9RTxl/ZTGKdenvNWaquWlJdYq1mrSuqX1QRvX9tNO196k3aL9SIegY6UTrpOrs0vnvM7IVPZU96nCqcVTj0y9r4vqWulG6C7R3afbpTump68XoCfT2653Tm9En6PvpZ+mv0X/lP6wActgloHEYIvBaYNnuCbujWfglXgHPmqoaxhoqDTca9htOG5kbjTXqMCoyeiRMc2Ya5xsvMW43XjUxMAkxGSpSYPJfVOqKdc01XSbaafpWzNzsxiztWYtZkPmWuZ883zzBvOHFkwLT4tFFjUWNy1JllzLdMudltesUCsnq1Sraqur1qi1s7XEeqd1zzTiNNdp0mk10+7YMGy8bXJsGmz6bDm2wbYFti22L+xM7OLtNtl12n22d7LPsK+1f+Cg4TDbocChzeE3RytHoWO1483pzOn+01dMb53+cob1DPGMXTPuOrGcQpzWOrU7fXJ2cZY7NzoPu5i4JLrscLnDZXPDuKXci65EVx/XFa4nXN+7Obsp3I64/epu457uftB9aKb5TPHM2pn9HkYeAo+9Hr2z8FmJs/bM6vU09BR41ng+8TL2EnnVeQ16W3qneR/yfuFj7yP3OebzlufGW8Y744v5BvgW+3b7afjN9avye+xv5J/i3+A/GuAUsCTgTCAxMChwU+Advh5fyK/nj852mb1sdkcQIygyqCroSbBVsDy4LQQNmR2yOeThHNM50jktoRDKD90c+ijMPGxR2I/hpPCw8OrwpxEOEUsjOiNZkQsjD0a+ifKJKot6MNdirnJue7RqdEJ0ffTbGN+Y8pjeWLvYZbFX4nTiJHGt8eT46Pi6+LF5fvO2zhtIcEooSrg933x+3vxLC3QWZCw4uVB1oWDh0URiYkziwcSPglBBjWAsiZ+0I2lUyBNuEz4XeYm2iIbFHuJy8WCyR3J58lCKR8rmlOFUz9SK1BEJT1IleZkWmLY77W16aPr+9ImMmIymTEpmYuZxqYY0XdqRpZ+Vl9Ujs5YVyXoXuS3aumhUHiSvy0ay52e3KtgKmaJLaaFco+zLmZVTnfMuNzr3aJ56njSva7HV4vWLB/P9879dQlgiXNK+1HDpqqV9y7yX7V2OLE9a3r7CeEXhioGVASsPrKKtSl/1U4F9QXnB69Uxq9sK9QpXFvavCVjTUKRSJC+6s9Z97e51hHWSdd3rp6/fvv5zsaj4col9SUXJx1Jh6eVvHL6p/GZiQ/KG7jLnsl0bSRulG29v8tx0oFy9PL+8f3PI5uYt+JbiLa+3Ltx6qWJGxe5ttG3Kbb2VwZWt2022b9z+sSq16la1T3XTDt0d63e83SnaeX2X167G3Xq7S3Z/2CPZc3dvwN7mGrOain2kfTn7ntZG13Z+y/22vk6nrqTu037p/t4DEQc66l3q6w/qHixrQBuUDcOHEg5d+873u9ZGm8a9TZymksNwWHn42feJ398+EnSk/Sj3aOMPpj/sOMY6VtyMNC9uHm1JbeltjWvtOT77eHube9uxH21/3H/C8ET1Sc2TZadopwpPTZzOPz12RnZm5GzK2f72he0PzsWeu9kR3tF9Puj8xQv+F851eneevuhx8cQlt0vHL3Mvt1xxvtLc5dR17Cenn451O3c3X3W52nrN9Vpbz8yeU9c9r5+94Xvjwk3+zSu35tzquT339t07CXd674ruDt3LuPfyfs798QcrHxIfFj9Se1TxWPdxzc+WPzf1Ovee7PPt63oS+eRBv7D/+T+y//FxoPAp82nFoMFg/ZDj0Ilh/+Frz+Y9G3guez4+UvSL+i87Xli8+OFXr1+7RmNHB17KX078VvpK+9X+1zNet4+FjT1+k/lm/G3xO+13B95z33d+iPkwOJ77kfyx8pPlp7bPQZ8fTmROTPwTA5jz/IzFdaUAAAAgY0hSTQAAeiYAAICEAAD6AAAAgOgAAHUwAADqYAAAOpgAABdwnLpRPAAAAAlwSFlzAAALEwAACxMBAJqcGAAAEFRpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDkuMC1jMDAwIDc5LjE3MWMyN2ZhYiwgMjAyMi8wOC8xNi0yMjozNTo0MSAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bWxuczpkYz0iaHR0cDovL3B1cmwub3JnL2RjL2VsZW1lbnRzLzEuMS8iIHhtbG5zOnhtcE1NPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvbW0vIiB4bWxuczpzdEV2dD0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL3NUeXBlL1Jlc291cmNlRXZlbnQjIiB4bWxuczpzdFJlZj0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL3NUeXBlL1Jlc291cmNlUmVmIyIgeG1sbnM6cGhvdG9zaG9wPSJodHRwOi8vbnMuYWRvYmUuY29tL3Bob3Rvc2hvcC8xLjAvIiB4bWxuczp0aWZmPSJodHRwOi8vbnMuYWRvYmUuY29tL3RpZmYvMS4wLyIgeG1sbnM6ZXhpZj0iaHR0cDovL25zLmFkb2JlLmNvbS9leGlmLzEuMC8iIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIDIxLjEgKE1hY2ludG9zaCkiIHhtcDpDcmVhdGVEYXRlPSIyMDIwLTAzLTI2VDExOjEwOjAyKzEzOjAwIiB4bXA6TWV0YWRhdGFEYXRlPSIyMDIyLTEyLTE1VDE0OjI5OjMzKzEzOjAwIiB4bXA6TW9kaWZ5RGF0ZT0iMjAyMi0xMi0xNVQxNDoyOTozMysxMzowMCIgZGM6Zm9ybWF0PSJpbWFnZS9wbmciIHhtcE1NOkluc3RhbmNlSUQ9InhtcC5paWQ6ZWU1YjljNDgtZDBmMi00MjYwLWI2ODMtMGY1YWFlZjQ2MzM3IiB4bXBNTTpEb2N1bWVudElEPSJhZG9iZTpkb2NpZDpwaG90b3Nob3A6ZDA3OTQ0YjYtNDQ5Zi01NjRlLWI2ZWItMGM0NGEzMjA5ZTgzIiB4bXBNTTpPcmlnaW5hbERvY3VtZW50SUQ9InhtcC5kaWQ6ZWU1NTEwZjgtNmI2ZC00NDJhLTkwOTMtMzQ4NmNlNDA0ZDU0IiBwaG90b3Nob3A6Q29sb3JNb2RlPSIzIiB0aWZmOk9yaWVudGF0aW9uPSIxIiB0aWZmOlhSZXNvbHV0aW9uPSI3MjAwMDAvMTAwMDAiIHRpZmY6WVJlc29sdXRpb249IjcyMDAwMC8xMDAwMCIgdGlmZjpSZXNvbHV0aW9uVW5pdD0iMiIgZXhpZjpDb2xvclNwYWNlPSI2NTUzNSIgZXhpZjpQaXhlbFhEaW1lbnNpb249Ijk2IiBleGlmOlBpeGVsWURpbWVuc2lvbj0iNjQiPiA8eG1wTU06SGlzdG9yeT4gPHJkZjpTZXE+IDxyZGY6bGkgc3RFdnQ6YWN0aW9uPSJjcmVhdGVkIiBzdEV2dDppbnN0YW5jZUlEPSJ4bXAuaWlkOmVlNTUxMGY4LTZiNmQtNDQyYS05MDkzLTM0ODZjZTQwNGQ1NCIgc3RFdnQ6d2hlbj0iMjAyMC0wMy0yNlQxMToxMDowMisxMzowMCIgc3RFdnQ6c29mdHdhcmVBZ2VudD0iQWRvYmUgUGhvdG9zaG9wIDIxLjEgKE1hY2ludG9zaCkiLz4gPHJkZjpsaSBzdEV2dDphY3Rpb249InNhdmVkIiBzdEV2dDppbnN0YW5jZUlEPSJ4bXAuaWlkOjEyYTg4Mjg4LWYzOWItNDU4My04M2FlLTk0NTExY2FjZGU5OCIgc3RFdnQ6d2hlbj0iMjAyMC0wMy0yNlQxNDoxNTozMisxMzowMCIgc3RFdnQ6c29mdHdhcmVBZ2VudD0iQWRvYmUgUGhvdG9zaG9wIDIxLjEgKE1hY2ludG9zaCkiIHN0RXZ0OmNoYW5nZWQ9Ii8iLz4gPHJkZjpsaSBzdEV2dDphY3Rpb249InNhdmVkIiBzdEV2dDppbnN0YW5jZUlEPSJ4bXAuaWlkOmEwMDkzM2E5LTA4NzctNDRlYi04YThmLTZlZDYyZjA1ZDhlZCIgc3RFdnQ6d2hlbj0iMjAyMC0wMy0yNlQxNDozNDo1NCsxMzowMCIgc3RFdnQ6c29mdHdhcmVBZ2VudD0iQWRvYmUgUGhvdG9zaG9wIDIxLjEgKE1hY2ludG9zaCkiIHN0RXZ0OmNoYW5nZWQ9Ii8iLz4gPHJkZjpsaSBzdEV2dDphY3Rpb249ImNvbnZlcnRlZCIgc3RFdnQ6cGFyYW1ldGVycz0iZnJvbSBhcHBsaWNhdGlvbi92bmQuYWRvYmUucGhvdG9zaG9wIHRvIGltYWdlL3BuZyIvPiA8cmRmOmxpIHN0RXZ0OmFjdGlvbj0iZGVyaXZlZCIgc3RFdnQ6cGFyYW1ldGVycz0iY29udmVydGVkIGZyb20gYXBwbGljYXRpb24vdm5kLmFkb2JlLnBob3Rvc2hvcCB0byBpbWFnZS9wbmciLz4gPHJkZjpsaSBzdEV2dDphY3Rpb249InNhdmVkIiBzdEV2dDppbnN0YW5jZUlEPSJ4bXAuaWlkOjlmZGE3OTBiLTZlODQtNGVmNS1hNGYxLTg0ZWFiMGIwNWJjOCIgc3RFdnQ6d2hlbj0iMjAyMC0wMy0yNlQxNDozNDo1NCsxMzowMCIgc3RFdnQ6c29mdHdhcmVBZ2VudD0iQWRvYmUgUGhvdG9zaG9wIDIxLjEgKE1hY2ludG9zaCkiIHN0RXZ0OmNoYW5nZWQ9Ii8iLz4gPHJkZjpsaSBzdEV2dDphY3Rpb249InNhdmVkIiBzdEV2dDppbnN0YW5jZUlEPSJ4bXAuaWlkOmFiMmM1Y2ExLWUzYTQtNGViMi1hODg5LTBmNzUwOWVlYmJhNiIgc3RFdnQ6d2hlbj0iMjAyMi0xMi0xNVQwODoyNjowMSsxMzowMCIgc3RFdnQ6c29mdHdhcmVBZ2VudD0iQWRvYmUgUGhvdG9zaG9wIDI0LjAgKE1hY2ludG9zaCkiIHN0RXZ0OmNoYW5nZWQ9Ii8iLz4gPHJkZjpsaSBzdEV2dDphY3Rpb249ImNvbnZlcnRlZCIgc3RFdnQ6cGFyYW1ldGVycz0iZnJvbSBpbWFnZS9wbmcgdG8gYXBwbGljYXRpb24vdm5kLmFkb2JlLnBob3Rvc2hvcCIvPiA8cmRmOmxpIHN0RXZ0OmFjdGlvbj0iZGVyaXZlZCIgc3RFdnQ6cGFyYW1ldGVycz0iY29udmVydGVkIGZyb20gaW1hZ2UvcG5nIHRvIGFwcGxpY2F0aW9uL3ZuZC5hZG9iZS5waG90b3Nob3AiLz4gPHJkZjpsaSBzdEV2dDphY3Rpb249InNhdmVkIiBzdEV2dDppbnN0YW5jZUlEPSJ4bXAuaWlkOjZiOTY1MjJmLTA3OTYtNDZhMS1iY2JjLTM2ZmJhYzIyNmQ4OSIgc3RFdnQ6d2hlbj0iMjAyMi0xMi0xNVQwODoyNjowMSsxMzowMCIgc3RFdnQ6c29mdHdhcmVBZ2VudD0iQWRvYmUgUGhvdG9zaG9wIDI0LjAgKE1hY2ludG9zaCkiIHN0RXZ0OmNoYW5nZWQ9Ii8iLz4gPHJkZjpsaSBzdEV2dDphY3Rpb249InNhdmVkIiBzdEV2dDppbnN0YW5jZUlEPSJ4bXAuaWlkOjE4NDI0N2UzLTVlNTUtNDk0Ny05MDc4LWZlYzNiMzhjNjVkNCIgc3RFdnQ6d2hlbj0iMjAyMi0xMi0xNVQxNDoyOTozMysxMzowMCIgc3RFdnQ6c29mdHdhcmVBZ2VudD0iQWRvYmUgUGhvdG9zaG9wIDI0LjAgKE1hY2ludG9zaCkiIHN0RXZ0OmNoYW5nZWQ9Ii8iLz4gPHJkZjpsaSBzdEV2dDphY3Rpb249ImNvbnZlcnRlZCIgc3RFdnQ6cGFyYW1ldGVycz0iZnJvbSBhcHBsaWNhdGlvbi92bmQuYWRvYmUucGhvdG9zaG9wIHRvIGltYWdlL3BuZyIvPiA8cmRmOmxpIHN0RXZ0OmFjdGlvbj0iZGVyaXZlZCIgc3RFdnQ6cGFyYW1ldGVycz0iY29udmVydGVkIGZyb20gYXBwbGljYXRpb24vdm5kLmFkb2JlLnBob3Rvc2hvcCB0byBpbWFnZS9wbmciLz4gPHJkZjpsaSBzdEV2dDphY3Rpb249InNhdmVkIiBzdEV2dDppbnN0YW5jZUlEPSJ4bXAuaWlkOmVlNWI5YzQ4LWQwZjItNDI2MC1iNjgzLTBmNWFhZWY0NjMzNyIgc3RFdnQ6d2hlbj0iMjAyMi0xMi0xNVQxNDoyOTozMysxMzowMCIgc3RFdnQ6c29mdHdhcmVBZ2VudD0iQWRvYmUgUGhvdG9zaG9wIDI0LjAgKE1hY2ludG9zaCkiIHN0RXZ0OmNoYW5nZWQ9Ii8iLz4gPC9yZGY6U2VxPiA8L3htcE1NOkhpc3Rvcnk+IDx4bXBNTTpEZXJpdmVkRnJvbSBzdFJlZjppbnN0YW5jZUlEPSJ4bXAuaWlkOjE4NDI0N2UzLTVlNTUtNDk0Ny05MDc4LWZlYzNiMzhjNjVkNCIgc3RSZWY6ZG9jdW1lbnRJRD0iYWRvYmU6ZG9jaWQ6cGhvdG9zaG9wOjIyOTFjN2Q1LTdiMGYtNmI0YS1iMDNmLTZjMjlkMjBmZGI5MCIgc3RSZWY6b3JpZ2luYWxEb2N1bWVudElEPSJ4bXAuZGlkOmVlNTUxMGY4LTZiNmQtNDQyYS05MDkzLTM0ODZjZTQwNGQ1NCIvPiA8cGhvdG9zaG9wOkRvY3VtZW50QW5jZXN0b3JzPiA8cmRmOkJhZz4gPHJkZjpsaT5hZG9iZTpkb2NpZDpwaG90b3Nob3A6MjI5MWM3ZDUtN2IwZi02YjRhLWIwM2YtNmMyOWQyMGZkYjkwPC9yZGY6bGk+IDxyZGY6bGk+YWRvYmU6ZG9jaWQ6cGhvdG9zaG9wOjhhZDQ0NTBlLTdmZjUtYmU0Mi05ZjUwLThhNGQwZWE1ODJhZTwvcmRmOmxpPiA8L3JkZjpCYWc+IDwvcGhvdG9zaG9wOkRvY3VtZW50QW5jZXN0b3JzPiA8L3JkZjpEZXNjcmlwdGlvbj4gPC9yZGY6UkRGPiA8L3g6eG1wbWV0YT4gPD94cGFja2V0IGVuZD0iciI/PuaRfCQAAAJWSURBVHic7ZtNjtowGIY/059FXBbpBqYH4AasOcHMMZqsc4GIC7BORpxi5gSs2bHkAGVm00i0zaJScRcIDQrEQOLoDcP7SJGQrXyxvgfbSewoY4wQHB10A24dCgBDAWA+lpTbJgbVRENaTKO5KBMg4/G4e6w8juO617wqLHn45SK+KrkLMnJ7//RLcZIjzgFgSoegPX403orr4ZvrgOwBYCgADAWAoQAwFACGAsBQABgKAEMBYCgADAWAoQAwFAAGIkApdVc8bOVJknha6/5+DK11P0kSz3beNXDO62jnGGNWItvE7X4X6/YJwzBfLpcffN/vZVn26vt+LwiCP2EY5qfitZ3DFbFH9Vbw3ShpcD2gmLBTCRyNRl/n8/nn4XD4dzab/TwVrwG26wGHOapM6+YA2zASBEG+2WwkCIIc0bYmaJ0AY8xqdxTr0jT1Op2OpGnqIdrWBIdzwLZLtW5RPoqi7mKx+JTn+Yvv+70oirqTycTJzoSLcZgjyCRsozj0GGNWSZJ40+lUr9frFxGRLMtetdb9wWDwbzcRXyvnbEvhovwb+4vy3JbyHqAAMBQAhgLAUAAYCgBDAWAoAAwFgKEAMBQAhgLAUAAYfqRXHb4NfQ/YvhP+cqw8juPfzTWnfVjy4CS+bQgqPcfJla8HWy4eROS5TvCyIUhZjlujLA8PIvIkIvd1gnMOqM6zOJBAAfWoLYEC6lNLAgW4obIECnBHJQkU4JaLJZQ9B5B63MujejpaU9hNzR7QDGc/nFEAGAoAQwFgKAAM74LAsAeAoQAwFADmP2XnwRUGPpopAAAAAElFTkSuQmCC",lightThemeSrc:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAGAAAABACAYAAADlNHIOAAAABGdBTUEAALGPC/xhBQAACktpQ0NQc1JHQiBJRUM2MTk2Ni0yLjEAAEiJnVNnVFPpFj333vRCS4iAlEtvUhUIIFJCi4BUaaISkgChhBgSQOyIqMCIoiKCFRkUccDREZCxIoqFQbH3AXkIKOPgKDZU3g/eGn2z5r03b/avvfY5Z53vnH0+AEZgsESahaoBZEoV8ogAHzw2Lh4ndwMKVCCBA4BAmC0LifSPAgDg+/Hw7IgAH/gCBODNbUAAAG7YBIbhOPx/UBfK5AoAJAwApovE2UIApBAAMnIVMgUAMgoA7KR0mQIAJQAAWx4bFw+AagEAO2WSTwMAdtIk9wIAtihTKgJAowBAJsoUiQDQDgBYl6MUiwCwYAAoypGIcwGwmwBgkqHMlABg7wCAnSkWZAMQGABgohALUwEI9gDAkEdF8AAIMwEojJSveNJXXCHOUwAA8LJki+WSlFQFbiG0xB1cXbl4oDg3Q6xQ2IQJhOkCuQjnZWXKBNLFAJMzAwCARnZEgA/O9+M5O7g6O9s42jp8taj/GvyLiI2L/5c/r8IBAQCE0/VF+7O8rBoA7hgAtvGLlrQdoGUNgNb9L5rJHgDVQoDmq1/Nw+H78fBUhULmZmeXm5trKxELbYWpX/X5nwl/AV/1s+X78fDf14P7ipMFygwFHhHggwuzMrKUcjxbJhCKcZs/HvHfLvzzd0yLECeL5WKpUIxHS8S5EmkKzsuSiiQKSZYUl0j/k4l/s+wPmLxrAGDVfgb2QltQu8oG7JcuILDogCXsAgDkd9+CqdEQBgAxBoOTdw8AMPmb/x1oGQCg2ZIUHACAFxGFC5XynMkYAQCACDRQBTZogz4YgwXYgCO4gDt4gR/MhlCIgjhYAEJIhUyQQy4shVVQBCWwEbZCFeyGWqiHRjgCLXACzsIFuALX4BY8gF4YgOcwCm9gHEEQMsJEWIg2YoCYItaII8JFZiF+SDASgcQhiUgKIkWUyFJkNVKClCNVyF6kHvkeOY6cRS4hPcg9pA8ZRn5DPqAYykDZqB5qhtqhXNQbDUKj0PloCroIzUcL0Q1oJVqDHkKb0bPoFfQW2os+R8cwwOgYBzPEbDAuxsNCsXgsGZNjy7FirAKrwRqxNqwTu4H1YiPYewKJwCLgBBuCOyGQMJcgJCwiLCeUEqoIBwjNhA7CDUIfYZTwmcgk6hKtiW5EPjGWmELMJRYRK4h1xGPE88RbxAHiGxKJxCGZk1xIgaQ4UhppCamUtJPURDpD6iH1k8bIZLI22ZrsQQ4lC8gKchF5O/kQ+TT5OnmA/I5CpxhQHCn+lHiKlFJAqaAcpJyiXKcMUsapalRTqhs1lCqiLqaWUWupbdSr1AHqOE2dZk7zoEXR0miraJW0Rtp52kPaKzqdbkR3pYfTJfSV9Er6YfpFeh/9PUODYcXgMRIYSsYGxn7GGcY9xismk2nG9GLGMxXMDcx65jnmY+Y7FZaKrQpfRaSyQqVapVnlusoLVaqqqaq36gLVfNUK1aOqV1VH1KhqZmo8NYHacrVqteNqd9TG1FnqDuqh6pnqpeoH1S+pD2mQNcw0/DREGoUa+zTOafSzMJYxi8cSslazalnnWQNsEtuczWensUvY37G72aOaGpozNKM18zSrNU9q9nIwjhmHz8nglHGOcG5zPkzRm+I9RTxl/ZTGKdenvNWaquWlJdYq1mrSuqX1QRvX9tNO196k3aL9SIegY6UTrpOrs0vnvM7IVPZU96nCqcVTj0y9r4vqWulG6C7R3afbpTump68XoCfT2653Tm9En6PvpZ+mv0X/lP6wActgloHEYIvBaYNnuCbujWfglXgHPmqoaxhoqDTca9htOG5kbjTXqMCoyeiRMc2Ya5xsvMW43XjUxMAkxGSpSYPJfVOqKdc01XSbaafpWzNzsxiztWYtZkPmWuZ883zzBvOHFkwLT4tFFjUWNy1JllzLdMudltesUCsnq1Sraqur1qi1s7XEeqd1zzTiNNdp0mk10+7YMGy8bXJsGmz6bDm2wbYFti22L+xM7OLtNtl12n22d7LPsK+1f+Cg4TDbocChzeE3RytHoWO1483pzOn+01dMb53+cob1DPGMXTPuOrGcQpzWOrU7fXJ2cZY7NzoPu5i4JLrscLnDZXPDuKXci65EVx/XFa4nXN+7Obsp3I64/epu457uftB9aKb5TPHM2pn9HkYeAo+9Hr2z8FmJs/bM6vU09BR41ng+8TL2EnnVeQ16W3qneR/yfuFj7yP3OebzlufGW8Y744v5BvgW+3b7afjN9avye+xv5J/i3+A/GuAUsCTgTCAxMChwU+Advh5fyK/nj852mb1sdkcQIygyqCroSbBVsDy4LQQNmR2yOeThHNM50jktoRDKD90c+ijMPGxR2I/hpPCw8OrwpxEOEUsjOiNZkQsjD0a+ifKJKot6MNdirnJue7RqdEJ0ffTbGN+Y8pjeWLvYZbFX4nTiJHGt8eT46Pi6+LF5fvO2zhtIcEooSrg933x+3vxLC3QWZCw4uVB1oWDh0URiYkziwcSPglBBjWAsiZ+0I2lUyBNuEz4XeYm2iIbFHuJy8WCyR3J58lCKR8rmlOFUz9SK1BEJT1IleZkWmLY77W16aPr+9ImMmIymTEpmYuZxqYY0XdqRpZ+Vl9Ujs5YVyXoXuS3aumhUHiSvy0ay52e3KtgKmaJLaaFco+zLmZVTnfMuNzr3aJ56njSva7HV4vWLB/P9879dQlgiXNK+1HDpqqV9y7yX7V2OLE9a3r7CeEXhioGVASsPrKKtSl/1U4F9QXnB69Uxq9sK9QpXFvavCVjTUKRSJC+6s9Z97e51hHWSdd3rp6/fvv5zsaj4col9SUXJx1Jh6eVvHL6p/GZiQ/KG7jLnsl0bSRulG29v8tx0oFy9PL+8f3PI5uYt+JbiLa+3Ltx6qWJGxe5ttG3Kbb2VwZWt2022b9z+sSq16la1T3XTDt0d63e83SnaeX2X167G3Xq7S3Z/2CPZc3dvwN7mGrOain2kfTn7ntZG13Z+y/22vk6nrqTu037p/t4DEQc66l3q6w/qHixrQBuUDcOHEg5d+873u9ZGm8a9TZymksNwWHn42feJ398+EnSk/Sj3aOMPpj/sOMY6VtyMNC9uHm1JbeltjWvtOT77eHube9uxH21/3H/C8ET1Sc2TZadopwpPTZzOPz12RnZm5GzK2f72he0PzsWeu9kR3tF9Puj8xQv+F851eneevuhx8cQlt0vHL3Mvt1xxvtLc5dR17Cenn451O3c3X3W52nrN9Vpbz8yeU9c9r5+94Xvjwk3+zSu35tzquT339t07CXd674ruDt3LuPfyfs798QcrHxIfFj9Se1TxWPdxzc+WPzf1Ovee7PPt63oS+eRBv7D/+T+y//FxoPAp82nFoMFg/ZDj0Ilh/+Frz+Y9G3guez4+UvSL+i87Xli8+OFXr1+7RmNHB17KX078VvpK+9X+1zNet4+FjT1+k/lm/G3xO+13B95z33d+iPkwOJ77kfyx8pPlp7bPQZ8fTmROTPwTA5jz/IzFdaUAAAAgY0hSTQAAeiYAAICEAAD6AAAAgOgAAHUwAADqYAAAOpgAABdwnLpRPAAAAAlwSFlzAAALEwAACxMBAJqcGAAAEAhpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDkuMC1jMDAwIDc5LjE3MWMyN2ZhYiwgMjAyMi8wOC8xNi0yMjozNTo0MSAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bWxuczpkYz0iaHR0cDovL3B1cmwub3JnL2RjL2VsZW1lbnRzLzEuMS8iIHhtbG5zOnhtcE1NPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvbW0vIiB4bWxuczpzdEV2dD0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL3NUeXBlL1Jlc291cmNlRXZlbnQjIiB4bWxuczpzdFJlZj0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL3NUeXBlL1Jlc291cmNlUmVmIyIgeG1sbnM6cGhvdG9zaG9wPSJodHRwOi8vbnMuYWRvYmUuY29tL3Bob3Rvc2hvcC8xLjAvIiB4bWxuczp0aWZmPSJodHRwOi8vbnMuYWRvYmUuY29tL3RpZmYvMS4wLyIgeG1sbnM6ZXhpZj0iaHR0cDovL25zLmFkb2JlLmNvbS9leGlmLzEuMC8iIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIDIxLjEgKE1hY2ludG9zaCkiIHhtcDpDcmVhdGVEYXRlPSIyMDIwLTAzLTI2VDExOjEwOjAyKzEzOjAwIiB4bXA6TWV0YWRhdGFEYXRlPSIyMDIyLTEyLTE1VDEwOjEwOjU3KzEzOjAwIiB4bXA6TW9kaWZ5RGF0ZT0iMjAyMi0xMi0xNVQxMDoxMDo1NysxMzowMCIgZGM6Zm9ybWF0PSJpbWFnZS9wbmciIHhtcE1NOkluc3RhbmNlSUQ9InhtcC5paWQ6NzYzYTE2YWQtM2NhNC00NzZkLWE4MmQtOWZkZDkxZTg3NDRjIiB4bXBNTTpEb2N1bWVudElEPSJhZG9iZTpkb2NpZDpwaG90b3Nob3A6MTk3ZmFhNjMtZjQzMy1lOTQ0LWJlZDQtMzMxZGM4MzhmOTlkIiB4bXBNTTpPcmlnaW5hbERvY3VtZW50SUQ9InhtcC5kaWQ6ZWU1NTEwZjgtNmI2ZC00NDJhLTkwOTMtMzQ4NmNlNDA0ZDU0IiBwaG90b3Nob3A6Q29sb3JNb2RlPSIzIiB0aWZmOk9yaWVudGF0aW9uPSIxIiB0aWZmOlhSZXNvbHV0aW9uPSI3MjAwMDAvMTAwMDAiIHRpZmY6WVJlc29sdXRpb249IjcyMDAwMC8xMDAwMCIgdGlmZjpSZXNvbHV0aW9uVW5pdD0iMiIgZXhpZjpDb2xvclNwYWNlPSI2NTUzNSIgZXhpZjpQaXhlbFhEaW1lbnNpb249Ijk2IiBleGlmOlBpeGVsWURpbWVuc2lvbj0iNjQiPiA8eG1wTU06SGlzdG9yeT4gPHJkZjpTZXE+IDxyZGY6bGkgc3RFdnQ6YWN0aW9uPSJjcmVhdGVkIiBzdEV2dDppbnN0YW5jZUlEPSJ4bXAuaWlkOmVlNTUxMGY4LTZiNmQtNDQyYS05MDkzLTM0ODZjZTQwNGQ1NCIgc3RFdnQ6d2hlbj0iMjAyMC0wMy0yNlQxMToxMDowMisxMzowMCIgc3RFdnQ6c29mdHdhcmVBZ2VudD0iQWRvYmUgUGhvdG9zaG9wIDIxLjEgKE1hY2ludG9zaCkiLz4gPHJkZjpsaSBzdEV2dDphY3Rpb249InNhdmVkIiBzdEV2dDppbnN0YW5jZUlEPSJ4bXAuaWlkOjEyYTg4Mjg4LWYzOWItNDU4My04M2FlLTk0NTExY2FjZGU5OCIgc3RFdnQ6d2hlbj0iMjAyMC0wMy0yNlQxNDoxNTozMisxMzowMCIgc3RFdnQ6c29mdHdhcmVBZ2VudD0iQWRvYmUgUGhvdG9zaG9wIDIxLjEgKE1hY2ludG9zaCkiIHN0RXZ0OmNoYW5nZWQ9Ii8iLz4gPHJkZjpsaSBzdEV2dDphY3Rpb249InNhdmVkIiBzdEV2dDppbnN0YW5jZUlEPSJ4bXAuaWlkOmEwMDkzM2E5LTA4NzctNDRlYi04YThmLTZlZDYyZjA1ZDhlZCIgc3RFdnQ6d2hlbj0iMjAyMC0wMy0yNlQxNDozNDo1NCsxMzowMCIgc3RFdnQ6c29mdHdhcmVBZ2VudD0iQWRvYmUgUGhvdG9zaG9wIDIxLjEgKE1hY2ludG9zaCkiIHN0RXZ0OmNoYW5nZWQ9Ii8iLz4gPHJkZjpsaSBzdEV2dDphY3Rpb249ImNvbnZlcnRlZCIgc3RFdnQ6cGFyYW1ldGVycz0iZnJvbSBhcHBsaWNhdGlvbi92bmQuYWRvYmUucGhvdG9zaG9wIHRvIGltYWdlL3BuZyIvPiA8cmRmOmxpIHN0RXZ0OmFjdGlvbj0iZGVyaXZlZCIgc3RFdnQ6cGFyYW1ldGVycz0iY29udmVydGVkIGZyb20gYXBwbGljYXRpb24vdm5kLmFkb2JlLnBob3Rvc2hvcCB0byBpbWFnZS9wbmciLz4gPHJkZjpsaSBzdEV2dDphY3Rpb249InNhdmVkIiBzdEV2dDppbnN0YW5jZUlEPSJ4bXAuaWlkOjlmZGE3OTBiLTZlODQtNGVmNS1hNGYxLTg0ZWFiMGIwNWJjOCIgc3RFdnQ6d2hlbj0iMjAyMC0wMy0yNlQxNDozNDo1NCsxMzowMCIgc3RFdnQ6c29mdHdhcmVBZ2VudD0iQWRvYmUgUGhvdG9zaG9wIDIxLjEgKE1hY2ludG9zaCkiIHN0RXZ0OmNoYW5nZWQ9Ii8iLz4gPHJkZjpsaSBzdEV2dDphY3Rpb249InNhdmVkIiBzdEV2dDppbnN0YW5jZUlEPSJ4bXAuaWlkOmFiMmM1Y2ExLWUzYTQtNGViMi1hODg5LTBmNzUwOWVlYmJhNiIgc3RFdnQ6d2hlbj0iMjAyMi0xMi0xNVQwODoyNjowMSsxMzowMCIgc3RFdnQ6c29mdHdhcmVBZ2VudD0iQWRvYmUgUGhvdG9zaG9wIDI0LjAgKE1hY2ludG9zaCkiIHN0RXZ0OmNoYW5nZWQ9Ii8iLz4gPHJkZjpsaSBzdEV2dDphY3Rpb249ImNvbnZlcnRlZCIgc3RFdnQ6cGFyYW1ldGVycz0iZnJvbSBpbWFnZS9wbmcgdG8gYXBwbGljYXRpb24vdm5kLmFkb2JlLnBob3Rvc2hvcCIvPiA8cmRmOmxpIHN0RXZ0OmFjdGlvbj0iZGVyaXZlZCIgc3RFdnQ6cGFyYW1ldGVycz0iY29udmVydGVkIGZyb20gaW1hZ2UvcG5nIHRvIGFwcGxpY2F0aW9uL3ZuZC5hZG9iZS5waG90b3Nob3AiLz4gPHJkZjpsaSBzdEV2dDphY3Rpb249InNhdmVkIiBzdEV2dDppbnN0YW5jZUlEPSJ4bXAuaWlkOjZiOTY1MjJmLTA3OTYtNDZhMS1iY2JjLTM2ZmJhYzIyNmQ4OSIgc3RFdnQ6d2hlbj0iMjAyMi0xMi0xNVQwODoyNjowMSsxMzowMCIgc3RFdnQ6c29mdHdhcmVBZ2VudD0iQWRvYmUgUGhvdG9zaG9wIDI0LjAgKE1hY2ludG9zaCkiIHN0RXZ0OmNoYW5nZWQ9Ii8iLz4gPHJkZjpsaSBzdEV2dDphY3Rpb249InNhdmVkIiBzdEV2dDppbnN0YW5jZUlEPSJ4bXAuaWlkOmI5M2NlMTNiLWQyMzAtNDkzMy1iM2MyLTc1YzVmMzMxYjk1NyIgc3RFdnQ6d2hlbj0iMjAyMi0xMi0xNVQxMDoxMDo1NysxMzowMCIgc3RFdnQ6c29mdHdhcmVBZ2VudD0iQWRvYmUgUGhvdG9zaG9wIDI0LjAgKE1hY2ludG9zaCkiIHN0RXZ0OmNoYW5nZWQ9Ii8iLz4gPHJkZjpsaSBzdEV2dDphY3Rpb249ImNvbnZlcnRlZCIgc3RFdnQ6cGFyYW1ldGVycz0iZnJvbSBhcHBsaWNhdGlvbi92bmQuYWRvYmUucGhvdG9zaG9wIHRvIGltYWdlL3BuZyIvPiA8cmRmOmxpIHN0RXZ0OmFjdGlvbj0iZGVyaXZlZCIgc3RFdnQ6cGFyYW1ldGVycz0iY29udmVydGVkIGZyb20gYXBwbGljYXRpb24vdm5kLmFkb2JlLnBob3Rvc2hvcCB0byBpbWFnZS9wbmciLz4gPHJkZjpsaSBzdEV2dDphY3Rpb249InNhdmVkIiBzdEV2dDppbnN0YW5jZUlEPSJ4bXAuaWlkOjc2M2ExNmFkLTNjYTQtNDc2ZC1hODJkLTlmZGQ5MWU4NzQ0YyIgc3RFdnQ6d2hlbj0iMjAyMi0xMi0xNVQxMDoxMDo1NysxMzowMCIgc3RFdnQ6c29mdHdhcmVBZ2VudD0iQWRvYmUgUGhvdG9zaG9wIDI0LjAgKE1hY2ludG9zaCkiIHN0RXZ0OmNoYW5nZWQ9Ii8iLz4gPC9yZGY6U2VxPiA8L3htcE1NOkhpc3Rvcnk+IDx4bXBNTTpEZXJpdmVkRnJvbSBzdFJlZjppbnN0YW5jZUlEPSJ4bXAuaWlkOmI5M2NlMTNiLWQyMzAtNDkzMy1iM2MyLTc1YzVmMzMxYjk1NyIgc3RSZWY6ZG9jdW1lbnRJRD0iYWRvYmU6ZG9jaWQ6cGhvdG9zaG9wOjIyOTFjN2Q1LTdiMGYtNmI0YS1iMDNmLTZjMjlkMjBmZGI5MCIgc3RSZWY6b3JpZ2luYWxEb2N1bWVudElEPSJ4bXAuZGlkOmVlNTUxMGY4LTZiNmQtNDQyYS05MDkzLTM0ODZjZTQwNGQ1NCIvPiA8cGhvdG9zaG9wOkRvY3VtZW50QW5jZXN0b3JzPiA8cmRmOkJhZz4gPHJkZjpsaT5hZG9iZTpkb2NpZDpwaG90b3Nob3A6OGFkNDQ1MGUtN2ZmNS1iZTQyLTlmNTAtOGE0ZDBlYTU4MmFlPC9yZGY6bGk+IDwvcmRmOkJhZz4gPC9waG90b3Nob3A6RG9jdW1lbnRBbmNlc3RvcnM+IDwvcmRmOkRlc2NyaXB0aW9uPiA8L3JkZjpSREY+IDwveDp4bXBtZXRhPiA8P3hwYWNrZXQgZW5kPSJyIj8+zaFqWgAAAk5JREFUeJztmzGOEzEUhv0iCypoQaLYggNYI6fgEssNaJCAE9Cn5wIsxTa5AFquEWs0B6DYbmmXaskoj2ITEc2OJ0vsmX+S/J80suQoztP75tnWeCKqagiOCTqAU4cCwFAAGNvWKSLRhUFVpb9wxkffuWgVsOZp6uBHQiwPdzkGl7ZdkIjoqd3p/0uuHHENANM1BRljjJlOp8+GCOQQWCwWv3OPyQoAQwFgKAAMBYChADAUAIYCwFAAGAoAQwFgKAAMBYChADA7n4b2QQjhttnnvX8e66+q6l1d11+89y+3xrix1n52zs1j38sfeX4gAjbJCSHcNhPVljjn3Lwsy9chhGvv/VkI4XoymXx1zs13jTd2Hk5B30T14r4dPpw4RVHMRKQKIfwSkaooihksmIw5glRAF9vTSfNuttZeLpfLN9bay+Ej64fRCeiaQuq6fm+M0XX7fbCgeuThFPRRRT7dt8OHE6csy5mqOu/9C1V1ZVnOYMFkzNHoKqC5o9nsglar1Qfv/at131kI4aaqqp+bhfhQ2flaCg/l/7F9KM/XUo4ECgBDAWAoAAwFgKEAMBQAhgLAUAAYCgBDAWAoAAwFgOGf9PaET0OPhOiBjIg8aetX1T/9hTM+YnnIRVcF3EWuUyOaBxE5Tx28VYCqSuxK/cFDoyMPb40xV6kSuAbsiar+MBkkUEACOSRQQCKpEiggAykSKCAT+0qggIzsI6H1UQRJQ0TO9cJctX7YeJ2RFdAD60p4FBQAhgLAUAAYCgDDXRAYVgAYCgBDAWD+Ahq8ETBRdAhNAAAAAElFTkSuQmCC"},{style:d.Expand,darkThemeSrc:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAGAAAABACAYAAADlNHIOAAAABGdBTUEAALGPC/xhBQAACktpQ0NQc1JHQiBJRUM2MTk2Ni0yLjEAAEiJnVNnVFPpFj333vRCS4iAlEtvUhUIIFJCi4BUaaISkgChhBgSQOyIqMCIoiKCFRkUccDREZCxIoqFQbH3AXkIKOPgKDZU3g/eGn2z5r03b/avvfY5Z53vnH0+AEZgsESahaoBZEoV8ogAHzw2Lh4ndwMKVCCBA4BAmC0LifSPAgDg+/Hw7IgAH/gCBODNbUAAAG7YBIbhOPx/UBfK5AoAJAwApovE2UIApBAAMnIVMgUAMgoA7KR0mQIAJQAAWx4bFw+AagEAO2WSTwMAdtIk9wIAtihTKgJAowBAJsoUiQDQDgBYl6MUiwCwYAAoypGIcwGwmwBgkqHMlABg7wCAnSkWZAMQGABgohALUwEI9gDAkEdF8AAIMwEojJSveNJXXCHOUwAA8LJki+WSlFQFbiG0xB1cXbl4oDg3Q6xQ2IQJhOkCuQjnZWXKBNLFAJMzAwCARnZEgA/O9+M5O7g6O9s42jp8taj/GvyLiI2L/5c/r8IBAQCE0/VF+7O8rBoA7hgAtvGLlrQdoGUNgNb9L5rJHgDVQoDmq1/Nw+H78fBUhULmZmeXm5trKxELbYWpX/X5nwl/AV/1s+X78fDf14P7ipMFygwFHhHggwuzMrKUcjxbJhCKcZs/HvHfLvzzd0yLECeL5WKpUIxHS8S5EmkKzsuSiiQKSZYUl0j/k4l/s+wPmLxrAGDVfgb2QltQu8oG7JcuILDogCXsAgDkd9+CqdEQBgAxBoOTdw8AMPmb/x1oGQCg2ZIUHACAFxGFC5XynMkYAQCACDRQBTZogz4YgwXYgCO4gDt4gR/MhlCIgjhYAEJIhUyQQy4shVVQBCWwEbZCFeyGWqiHRjgCLXACzsIFuALX4BY8gF4YgOcwCm9gHEEQMsJEWIg2YoCYItaII8JFZiF+SDASgcQhiUgKIkWUyFJkNVKClCNVyF6kHvkeOY6cRS4hPcg9pA8ZRn5DPqAYykDZqB5qhtqhXNQbDUKj0PloCroIzUcL0Q1oJVqDHkKb0bPoFfQW2os+R8cwwOgYBzPEbDAuxsNCsXgsGZNjy7FirAKrwRqxNqwTu4H1YiPYewKJwCLgBBuCOyGQMJcgJCwiLCeUEqoIBwjNhA7CDUIfYZTwmcgk6hKtiW5EPjGWmELMJRYRK4h1xGPE88RbxAHiGxKJxCGZk1xIgaQ4UhppCamUtJPURDpD6iH1k8bIZLI22ZrsQQ4lC8gKchF5O/kQ+TT5OnmA/I5CpxhQHCn+lHiKlFJAqaAcpJyiXKcMUsapalRTqhs1lCqiLqaWUWupbdSr1AHqOE2dZk7zoEXR0miraJW0Rtp52kPaKzqdbkR3pYfTJfSV9Er6YfpFeh/9PUODYcXgMRIYSsYGxn7GGcY9xismk2nG9GLGMxXMDcx65jnmY+Y7FZaKrQpfRaSyQqVapVnlusoLVaqqqaq36gLVfNUK1aOqV1VH1KhqZmo8NYHacrVqteNqd9TG1FnqDuqh6pnqpeoH1S+pD2mQNcw0/DREGoUa+zTOafSzMJYxi8cSslazalnnWQNsEtuczWensUvY37G72aOaGpozNKM18zSrNU9q9nIwjhmHz8nglHGOcG5zPkzRm+I9RTxl/ZTGKdenvNWaquWlJdYq1mrSuqX1QRvX9tNO196k3aL9SIegY6UTrpOrs0vnvM7IVPZU96nCqcVTj0y9r4vqWulG6C7R3afbpTump68XoCfT2653Tm9En6PvpZ+mv0X/lP6wActgloHEYIvBaYNnuCbujWfglXgHPmqoaxhoqDTca9htOG5kbjTXqMCoyeiRMc2Ya5xsvMW43XjUxMAkxGSpSYPJfVOqKdc01XSbaafpWzNzsxiztWYtZkPmWuZ883zzBvOHFkwLT4tFFjUWNy1JllzLdMudltesUCsnq1Sraqur1qi1s7XEeqd1zzTiNNdp0mk10+7YMGy8bXJsGmz6bDm2wbYFti22L+xM7OLtNtl12n22d7LPsK+1f+Cg4TDbocChzeE3RytHoWO1483pzOn+01dMb53+cob1DPGMXTPuOrGcQpzWOrU7fXJ2cZY7NzoPu5i4JLrscLnDZXPDuKXci65EVx/XFa4nXN+7Obsp3I64/epu457uftB9aKb5TPHM2pn9HkYeAo+9Hr2z8FmJs/bM6vU09BR41ng+8TL2EnnVeQ16W3qneR/yfuFj7yP3OebzlufGW8Y744v5BvgW+3b7afjN9avye+xv5J/i3+A/GuAUsCTgTCAxMChwU+Advh5fyK/nj852mb1sdkcQIygyqCroSbBVsDy4LQQNmR2yOeThHNM50jktoRDKD90c+ijMPGxR2I/hpPCw8OrwpxEOEUsjOiNZkQsjD0a+ifKJKot6MNdirnJue7RqdEJ0ffTbGN+Y8pjeWLvYZbFX4nTiJHGt8eT46Pi6+LF5fvO2zhtIcEooSrg933x+3vxLC3QWZCw4uVB1oWDh0URiYkziwcSPglBBjWAsiZ+0I2lUyBNuEz4XeYm2iIbFHuJy8WCyR3J58lCKR8rmlOFUz9SK1BEJT1IleZkWmLY77W16aPr+9ImMmIymTEpmYuZxqYY0XdqRpZ+Vl9Ujs5YVyXoXuS3aumhUHiSvy0ay52e3KtgKmaJLaaFco+zLmZVTnfMuNzr3aJ56njSva7HV4vWLB/P9879dQlgiXNK+1HDpqqV9y7yX7V2OLE9a3r7CeEXhioGVASsPrKKtSl/1U4F9QXnB69Uxq9sK9QpXFvavCVjTUKRSJC+6s9Z97e51hHWSdd3rp6/fvv5zsaj4col9SUXJx1Jh6eVvHL6p/GZiQ/KG7jLnsl0bSRulG29v8tx0oFy9PL+8f3PI5uYt+JbiLa+3Ltx6qWJGxe5ttG3Kbb2VwZWt2022b9z+sSq16la1T3XTDt0d63e83SnaeX2X167G3Xq7S3Z/2CPZc3dvwN7mGrOain2kfTn7ntZG13Z+y/22vk6nrqTu037p/t4DEQc66l3q6w/qHixrQBuUDcOHEg5d+873u9ZGm8a9TZymksNwWHn42feJ398+EnSk/Sj3aOMPpj/sOMY6VtyMNC9uHm1JbeltjWvtOT77eHube9uxH21/3H/C8ET1Sc2TZadopwpPTZzOPz12RnZm5GzK2f72he0PzsWeu9kR3tF9Puj8xQv+F851eneevuhx8cQlt0vHL3Mvt1xxvtLc5dR17Cenn451O3c3X3W52nrN9Vpbz8yeU9c9r5+94Xvjwk3+zSu35tzquT339t07CXd674ruDt3LuPfyfs798QcrHxIfFj9Se1TxWPdxzc+WPzf1Ovee7PPt63oS+eRBv7D/+T+y//FxoPAp82nFoMFg/ZDj0Ilh/+Frz+Y9G3guez4+UvSL+i87Xli8+OFXr1+7RmNHB17KX078VvpK+9X+1zNet4+FjT1+k/lm/G3xO+13B95z33d+iPkwOJ77kfyx8pPlp7bPQZ8fTmROTPwTA5jz/IzFdaUAAAAgY0hSTQAAeiYAAICEAAD6AAAAgOgAAHUwAADqYAAAOpgAABdwnLpRPAAAAAlwSFlzAAALEwAACxMBAJqcGAAAEFRpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDkuMC1jMDAwIDc5LjE3MWMyN2ZhYiwgMjAyMi8wOC8xNi0yMjozNTo0MSAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bWxuczpkYz0iaHR0cDovL3B1cmwub3JnL2RjL2VsZW1lbnRzLzEuMS8iIHhtbG5zOnhtcE1NPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvbW0vIiB4bWxuczpzdEV2dD0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL3NUeXBlL1Jlc291cmNlRXZlbnQjIiB4bWxuczpzdFJlZj0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL3NUeXBlL1Jlc291cmNlUmVmIyIgeG1sbnM6cGhvdG9zaG9wPSJodHRwOi8vbnMuYWRvYmUuY29tL3Bob3Rvc2hvcC8xLjAvIiB4bWxuczp0aWZmPSJodHRwOi8vbnMuYWRvYmUuY29tL3RpZmYvMS4wLyIgeG1sbnM6ZXhpZj0iaHR0cDovL25zLmFkb2JlLmNvbS9leGlmLzEuMC8iIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIDIxLjEgKE1hY2ludG9zaCkiIHhtcDpDcmVhdGVEYXRlPSIyMDIwLTAzLTI2VDExOjEwOjAyKzEzOjAwIiB4bXA6TWV0YWRhdGFEYXRlPSIyMDIyLTEyLTE1VDE0OjM5OjIzKzEzOjAwIiB4bXA6TW9kaWZ5RGF0ZT0iMjAyMi0xMi0xNVQxNDozOToyMysxMzowMCIgZGM6Zm9ybWF0PSJpbWFnZS9wbmciIHhtcE1NOkluc3RhbmNlSUQ9InhtcC5paWQ6NTBhMTllMjgtZmQzYS00MDcxLTg4NmYtZmFlZmFiYjhiYWIzIiB4bXBNTTpEb2N1bWVudElEPSJhZG9iZTpkb2NpZDpwaG90b3Nob3A6NGY5MTczOWEtNDM0Ny0yMzRhLTkyOTYtYTUzZmRlMzI1YzJmIiB4bXBNTTpPcmlnaW5hbERvY3VtZW50SUQ9InhtcC5kaWQ6ZWU1NTEwZjgtNmI2ZC00NDJhLTkwOTMtMzQ4NmNlNDA0ZDU0IiBwaG90b3Nob3A6Q29sb3JNb2RlPSIzIiB0aWZmOk9yaWVudGF0aW9uPSIxIiB0aWZmOlhSZXNvbHV0aW9uPSI3MjAwMDAvMTAwMDAiIHRpZmY6WVJlc29sdXRpb249IjcyMDAwMC8xMDAwMCIgdGlmZjpSZXNvbHV0aW9uVW5pdD0iMiIgZXhpZjpDb2xvclNwYWNlPSI2NTUzNSIgZXhpZjpQaXhlbFhEaW1lbnNpb249Ijk2IiBleGlmOlBpeGVsWURpbWVuc2lvbj0iNjQiPiA8eG1wTU06SGlzdG9yeT4gPHJkZjpTZXE+IDxyZGY6bGkgc3RFdnQ6YWN0aW9uPSJjcmVhdGVkIiBzdEV2dDppbnN0YW5jZUlEPSJ4bXAuaWlkOmVlNTUxMGY4LTZiNmQtNDQyYS05MDkzLTM0ODZjZTQwNGQ1NCIgc3RFdnQ6d2hlbj0iMjAyMC0wMy0yNlQxMToxMDowMisxMzowMCIgc3RFdnQ6c29mdHdhcmVBZ2VudD0iQWRvYmUgUGhvdG9zaG9wIDIxLjEgKE1hY2ludG9zaCkiLz4gPHJkZjpsaSBzdEV2dDphY3Rpb249InNhdmVkIiBzdEV2dDppbnN0YW5jZUlEPSJ4bXAuaWlkOjEyYTg4Mjg4LWYzOWItNDU4My04M2FlLTk0NTExY2FjZGU5OCIgc3RFdnQ6d2hlbj0iMjAyMC0wMy0yNlQxNDoxNTozMisxMzowMCIgc3RFdnQ6c29mdHdhcmVBZ2VudD0iQWRvYmUgUGhvdG9zaG9wIDIxLjEgKE1hY2ludG9zaCkiIHN0RXZ0OmNoYW5nZWQ9Ii8iLz4gPHJkZjpsaSBzdEV2dDphY3Rpb249InNhdmVkIiBzdEV2dDppbnN0YW5jZUlEPSJ4bXAuaWlkOmEwMDkzM2E5LTA4NzctNDRlYi04YThmLTZlZDYyZjA1ZDhlZCIgc3RFdnQ6d2hlbj0iMjAyMC0wMy0yNlQxNDozNDo1NCsxMzowMCIgc3RFdnQ6c29mdHdhcmVBZ2VudD0iQWRvYmUgUGhvdG9zaG9wIDIxLjEgKE1hY2ludG9zaCkiIHN0RXZ0OmNoYW5nZWQ9Ii8iLz4gPHJkZjpsaSBzdEV2dDphY3Rpb249ImNvbnZlcnRlZCIgc3RFdnQ6cGFyYW1ldGVycz0iZnJvbSBhcHBsaWNhdGlvbi92bmQuYWRvYmUucGhvdG9zaG9wIHRvIGltYWdlL3BuZyIvPiA8cmRmOmxpIHN0RXZ0OmFjdGlvbj0iZGVyaXZlZCIgc3RFdnQ6cGFyYW1ldGVycz0iY29udmVydGVkIGZyb20gYXBwbGljYXRpb24vdm5kLmFkb2JlLnBob3Rvc2hvcCB0byBpbWFnZS9wbmciLz4gPHJkZjpsaSBzdEV2dDphY3Rpb249InNhdmVkIiBzdEV2dDppbnN0YW5jZUlEPSJ4bXAuaWlkOjlmZGE3OTBiLTZlODQtNGVmNS1hNGYxLTg0ZWFiMGIwNWJjOCIgc3RFdnQ6d2hlbj0iMjAyMC0wMy0yNlQxNDozNDo1NCsxMzowMCIgc3RFdnQ6c29mdHdhcmVBZ2VudD0iQWRvYmUgUGhvdG9zaG9wIDIxLjEgKE1hY2ludG9zaCkiIHN0RXZ0OmNoYW5nZWQ9Ii8iLz4gPHJkZjpsaSBzdEV2dDphY3Rpb249InNhdmVkIiBzdEV2dDppbnN0YW5jZUlEPSJ4bXAuaWlkOmFiMmM1Y2ExLWUzYTQtNGViMi1hODg5LTBmNzUwOWVlYmJhNiIgc3RFdnQ6d2hlbj0iMjAyMi0xMi0xNVQwODoyNjowMSsxMzowMCIgc3RFdnQ6c29mdHdhcmVBZ2VudD0iQWRvYmUgUGhvdG9zaG9wIDI0LjAgKE1hY2ludG9zaCkiIHN0RXZ0OmNoYW5nZWQ9Ii8iLz4gPHJkZjpsaSBzdEV2dDphY3Rpb249ImNvbnZlcnRlZCIgc3RFdnQ6cGFyYW1ldGVycz0iZnJvbSBpbWFnZS9wbmcgdG8gYXBwbGljYXRpb24vdm5kLmFkb2JlLnBob3Rvc2hvcCIvPiA8cmRmOmxpIHN0RXZ0OmFjdGlvbj0iZGVyaXZlZCIgc3RFdnQ6cGFyYW1ldGVycz0iY29udmVydGVkIGZyb20gaW1hZ2UvcG5nIHRvIGFwcGxpY2F0aW9uL3ZuZC5hZG9iZS5waG90b3Nob3AiLz4gPHJkZjpsaSBzdEV2dDphY3Rpb249InNhdmVkIiBzdEV2dDppbnN0YW5jZUlEPSJ4bXAuaWlkOjZiOTY1MjJmLTA3OTYtNDZhMS1iY2JjLTM2ZmJhYzIyNmQ4OSIgc3RFdnQ6d2hlbj0iMjAyMi0xMi0xNVQwODoyNjowMSsxMzowMCIgc3RFdnQ6c29mdHdhcmVBZ2VudD0iQWRvYmUgUGhvdG9zaG9wIDI0LjAgKE1hY2ludG9zaCkiIHN0RXZ0OmNoYW5nZWQ9Ii8iLz4gPHJkZjpsaSBzdEV2dDphY3Rpb249InNhdmVkIiBzdEV2dDppbnN0YW5jZUlEPSJ4bXAuaWlkOmFmN2U1YmE2LTY4ZmMtNDcwZi05NjJmLTAwMDMwM2E0Y2U2MiIgc3RFdnQ6d2hlbj0iMjAyMi0xMi0xNVQxNDozOToyMysxMzowMCIgc3RFdnQ6c29mdHdhcmVBZ2VudD0iQWRvYmUgUGhvdG9zaG9wIDI0LjAgKE1hY2ludG9zaCkiIHN0RXZ0OmNoYW5nZWQ9Ii8iLz4gPHJkZjpsaSBzdEV2dDphY3Rpb249ImNvbnZlcnRlZCIgc3RFdnQ6cGFyYW1ldGVycz0iZnJvbSBhcHBsaWNhdGlvbi92bmQuYWRvYmUucGhvdG9zaG9wIHRvIGltYWdlL3BuZyIvPiA8cmRmOmxpIHN0RXZ0OmFjdGlvbj0iZGVyaXZlZCIgc3RFdnQ6cGFyYW1ldGVycz0iY29udmVydGVkIGZyb20gYXBwbGljYXRpb24vdm5kLmFkb2JlLnBob3Rvc2hvcCB0byBpbWFnZS9wbmciLz4gPHJkZjpsaSBzdEV2dDphY3Rpb249InNhdmVkIiBzdEV2dDppbnN0YW5jZUlEPSJ4bXAuaWlkOjUwYTE5ZTI4LWZkM2EtNDA3MS04ODZmLWZhZWZhYmI4YmFiMyIgc3RFdnQ6d2hlbj0iMjAyMi0xMi0xNVQxNDozOToyMysxMzowMCIgc3RFdnQ6c29mdHdhcmVBZ2VudD0iQWRvYmUgUGhvdG9zaG9wIDI0LjAgKE1hY2ludG9zaCkiIHN0RXZ0OmNoYW5nZWQ9Ii8iLz4gPC9yZGY6U2VxPiA8L3htcE1NOkhpc3Rvcnk+IDx4bXBNTTpEZXJpdmVkRnJvbSBzdFJlZjppbnN0YW5jZUlEPSJ4bXAuaWlkOmFmN2U1YmE2LTY4ZmMtNDcwZi05NjJmLTAwMDMwM2E0Y2U2MiIgc3RSZWY6ZG9jdW1lbnRJRD0iYWRvYmU6ZG9jaWQ6cGhvdG9zaG9wOjIyOTFjN2Q1LTdiMGYtNmI0YS1iMDNmLTZjMjlkMjBmZGI5MCIgc3RSZWY6b3JpZ2luYWxEb2N1bWVudElEPSJ4bXAuZGlkOmVlNTUxMGY4LTZiNmQtNDQyYS05MDkzLTM0ODZjZTQwNGQ1NCIvPiA8cGhvdG9zaG9wOkRvY3VtZW50QW5jZXN0b3JzPiA8cmRmOkJhZz4gPHJkZjpsaT5hZG9iZTpkb2NpZDpwaG90b3Nob3A6MjI5MWM3ZDUtN2IwZi02YjRhLWIwM2YtNmMyOWQyMGZkYjkwPC9yZGY6bGk+IDxyZGY6bGk+YWRvYmU6ZG9jaWQ6cGhvdG9zaG9wOjhhZDQ0NTBlLTdmZjUtYmU0Mi05ZjUwLThhNGQwZWE1ODJhZTwvcmRmOmxpPiA8L3JkZjpCYWc+IDwvcGhvdG9zaG9wOkRvY3VtZW50QW5jZXN0b3JzPiA8L3JkZjpEZXNjcmlwdGlvbj4gPC9yZGY6UkRGPiA8L3g6eG1wbWV0YT4gPD94cGFja2V0IGVuZD0iciI/PrPGZq4AAAJ/SURBVHic7ZuxjqJAGMc/iFtoZhuK9a5e3+Di1pa+hC3hAaiPeE9BsNxun8DS3mxDbX/uFiTmVre4y3CFmmNhgOjC/Qf4fslEGWSYfD/nG8KAEccxMThMdAe6DgsAwwLA9BR1RZOCUVdHNKbWeKgE0Hw+v1XVe5732fM1joJY/KqifUNxFRRTN//pl1JJnHgOAKNMQUniOP75PzrSBAzD+Fp1mzwCwLAAMCwADAsAwwLAsAAwLAAMCwDDAsCwADAsAAwLAMMCwEAEmKb5JV2K6n3f7wshhsk2hBBD3/f7Rcc1gdLb0XUgpdwSHQN3/p7el8RxnPfNZtOzLOsuiqJXy7LuHMc5OI7zXtae7pSuiNW5HpAOWFkAJ5OJtV6vb8bj8e/VahWVtVc1qfWAdq6IFaUR27YPUkqybfuA6JuC+IryAe0ESCm355LeFwTBwDRNCoJggOibAuPCkkE7AXm4rnsbhmFvv9+/hGHYc11X+bRC04BMwkWkU4+Ucuv7fn+xWAx2u90LEVEURa9CiOFoNPpznoibCnQSbhoVTMKZYxqTgtoKCwDDAsCwADAsAAwLAMMCwLAAMCwADAsAwwLAsAAwLAAMv6R3PXw3tA3kvScsVPWe573V2x39KIhFJe3npaDc31dy1mZRZTwyKUg1AroY5CJqjQfPAWBYABgWAIYFgGEBYLR7MCvBNyKaEdE0Ubckokcieob0qAZ0HgEzIronou9E9HD6vD/VtwadR8CUjkF/Om2fP39gulMPOo8AomPKUW1f81i4DiWD7gKmOduXPhauU/mAziloSf/y/ZKOwZ9RdlQ0GtXNOF3oxFWQzgI6ge5zQOthAWBYAJi/tpT89Cm0y3kAAAAASUVORK5CYII=",lightThemeSrc:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAGAAAABACAYAAADlNHIOAAAABGdBTUEAALGPC/xhBQAACktpQ0NQc1JHQiBJRUM2MTk2Ni0yLjEAAEiJnVNnVFPpFj333vRCS4iAlEtvUhUIIFJCi4BUaaISkgChhBgSQOyIqMCIoiKCFRkUccDREZCxIoqFQbH3AXkIKOPgKDZU3g/eGn2z5r03b/avvfY5Z53vnH0+AEZgsESahaoBZEoV8ogAHzw2Lh4ndwMKVCCBA4BAmC0LifSPAgDg+/Hw7IgAH/gCBODNbUAAAG7YBIbhOPx/UBfK5AoAJAwApovE2UIApBAAMnIVMgUAMgoA7KR0mQIAJQAAWx4bFw+AagEAO2WSTwMAdtIk9wIAtihTKgJAowBAJsoUiQDQDgBYl6MUiwCwYAAoypGIcwGwmwBgkqHMlABg7wCAnSkWZAMQGABgohALUwEI9gDAkEdF8AAIMwEojJSveNJXXCHOUwAA8LJki+WSlFQFbiG0xB1cXbl4oDg3Q6xQ2IQJhOkCuQjnZWXKBNLFAJMzAwCARnZEgA/O9+M5O7g6O9s42jp8taj/GvyLiI2L/5c/r8IBAQCE0/VF+7O8rBoA7hgAtvGLlrQdoGUNgNb9L5rJHgDVQoDmq1/Nw+H78fBUhULmZmeXm5trKxELbYWpX/X5nwl/AV/1s+X78fDf14P7ipMFygwFHhHggwuzMrKUcjxbJhCKcZs/HvHfLvzzd0yLECeL5WKpUIxHS8S5EmkKzsuSiiQKSZYUl0j/k4l/s+wPmLxrAGDVfgb2QltQu8oG7JcuILDogCXsAgDkd9+CqdEQBgAxBoOTdw8AMPmb/x1oGQCg2ZIUHACAFxGFC5XynMkYAQCACDRQBTZogz4YgwXYgCO4gDt4gR/MhlCIgjhYAEJIhUyQQy4shVVQBCWwEbZCFeyGWqiHRjgCLXACzsIFuALX4BY8gF4YgOcwCm9gHEEQMsJEWIg2YoCYItaII8JFZiF+SDASgcQhiUgKIkWUyFJkNVKClCNVyF6kHvkeOY6cRS4hPcg9pA8ZRn5DPqAYykDZqB5qhtqhXNQbDUKj0PloCroIzUcL0Q1oJVqDHkKb0bPoFfQW2os+R8cwwOgYBzPEbDAuxsNCsXgsGZNjy7FirAKrwRqxNqwTu4H1YiPYewKJwCLgBBuCOyGQMJcgJCwiLCeUEqoIBwjNhA7CDUIfYZTwmcgk6hKtiW5EPjGWmELMJRYRK4h1xGPE88RbxAHiGxKJxCGZk1xIgaQ4UhppCamUtJPURDpD6iH1k8bIZLI22ZrsQQ4lC8gKchF5O/kQ+TT5OnmA/I5CpxhQHCn+lHiKlFJAqaAcpJyiXKcMUsapalRTqhs1lCqiLqaWUWupbdSr1AHqOE2dZk7zoEXR0miraJW0Rtp52kPaKzqdbkR3pYfTJfSV9Er6YfpFeh/9PUODYcXgMRIYSsYGxn7GGcY9xismk2nG9GLGMxXMDcx65jnmY+Y7FZaKrQpfRaSyQqVapVnlusoLVaqqqaq36gLVfNUK1aOqV1VH1KhqZmo8NYHacrVqteNqd9TG1FnqDuqh6pnqpeoH1S+pD2mQNcw0/DREGoUa+zTOafSzMJYxi8cSslazalnnWQNsEtuczWensUvY37G72aOaGpozNKM18zSrNU9q9nIwjhmHz8nglHGOcG5zPkzRm+I9RTxl/ZTGKdenvNWaquWlJdYq1mrSuqX1QRvX9tNO196k3aL9SIegY6UTrpOrs0vnvM7IVPZU96nCqcVTj0y9r4vqWulG6C7R3afbpTump68XoCfT2653Tm9En6PvpZ+mv0X/lP6wActgloHEYIvBaYNnuCbujWfglXgHPmqoaxhoqDTca9htOG5kbjTXqMCoyeiRMc2Ya5xsvMW43XjUxMAkxGSpSYPJfVOqKdc01XSbaafpWzNzsxiztWYtZkPmWuZ883zzBvOHFkwLT4tFFjUWNy1JllzLdMudltesUCsnq1Sraqur1qi1s7XEeqd1zzTiNNdp0mk10+7YMGy8bXJsGmz6bDm2wbYFti22L+xM7OLtNtl12n22d7LPsK+1f+Cg4TDbocChzeE3RytHoWO1483pzOn+01dMb53+cob1DPGMXTPuOrGcQpzWOrU7fXJ2cZY7NzoPu5i4JLrscLnDZXPDuKXci65EVx/XFa4nXN+7Obsp3I64/epu457uftB9aKb5TPHM2pn9HkYeAo+9Hr2z8FmJs/bM6vU09BR41ng+8TL2EnnVeQ16W3qneR/yfuFj7yP3OebzlufGW8Y744v5BvgW+3b7afjN9avye+xv5J/i3+A/GuAUsCTgTCAxMChwU+Advh5fyK/nj852mb1sdkcQIygyqCroSbBVsDy4LQQNmR2yOeThHNM50jktoRDKD90c+ijMPGxR2I/hpPCw8OrwpxEOEUsjOiNZkQsjD0a+ifKJKot6MNdirnJue7RqdEJ0ffTbGN+Y8pjeWLvYZbFX4nTiJHGt8eT46Pi6+LF5fvO2zhtIcEooSrg933x+3vxLC3QWZCw4uVB1oWDh0URiYkziwcSPglBBjWAsiZ+0I2lUyBNuEz4XeYm2iIbFHuJy8WCyR3J58lCKR8rmlOFUz9SK1BEJT1IleZkWmLY77W16aPr+9ImMmIymTEpmYuZxqYY0XdqRpZ+Vl9Ujs5YVyXoXuS3aumhUHiSvy0ay52e3KtgKmaJLaaFco+zLmZVTnfMuNzr3aJ56njSva7HV4vWLB/P9879dQlgiXNK+1HDpqqV9y7yX7V2OLE9a3r7CeEXhioGVASsPrKKtSl/1U4F9QXnB69Uxq9sK9QpXFvavCVjTUKRSJC+6s9Z97e51hHWSdd3rp6/fvv5zsaj4col9SUXJx1Jh6eVvHL6p/GZiQ/KG7jLnsl0bSRulG29v8tx0oFy9PL+8f3PI5uYt+JbiLa+3Ltx6qWJGxe5ttG3Kbb2VwZWt2022b9z+sSq16la1T3XTDt0d63e83SnaeX2X167G3Xq7S3Z/2CPZc3dvwN7mGrOain2kfTn7ntZG13Z+y/22vk6nrqTu037p/t4DEQc66l3q6w/qHixrQBuUDcOHEg5d+873u9ZGm8a9TZymksNwWHn42feJ398+EnSk/Sj3aOMPpj/sOMY6VtyMNC9uHm1JbeltjWvtOT77eHube9uxH21/3H/C8ET1Sc2TZadopwpPTZzOPz12RnZm5GzK2f72he0PzsWeu9kR3tF9Puj8xQv+F851eneevuhx8cQlt0vHL3Mvt1xxvtLc5dR17Cenn451O3c3X3W52nrN9Vpbz8yeU9c9r5+94Xvjwk3+zSu35tzquT339t07CXd674ruDt3LuPfyfs798QcrHxIfFj9Se1TxWPdxzc+WPzf1Ovee7PPt63oS+eRBv7D/+T+y//FxoPAp82nFoMFg/ZDj0Ilh/+Frz+Y9G3guez4+UvSL+i87Xli8+OFXr1+7RmNHB17KX078VvpK+9X+1zNet4+FjT1+k/lm/G3xO+13B95z33d+iPkwOJ77kfyx8pPlp7bPQZ8fTmROTPwTA5jz/IzFdaUAAAAgY0hSTQAAeiYAAICEAAD6AAAAgOgAAHUwAADqYAAAOpgAABdwnLpRPAAAAAlwSFlzAAALEwAACxMBAJqcGAAAEAhpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDkuMC1jMDAwIDc5LjE3MWMyN2ZhYiwgMjAyMi8wOC8xNi0yMjozNTo0MSAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bWxuczpkYz0iaHR0cDovL3B1cmwub3JnL2RjL2VsZW1lbnRzLzEuMS8iIHhtbG5zOnhtcE1NPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvbW0vIiB4bWxuczpzdEV2dD0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL3NUeXBlL1Jlc291cmNlRXZlbnQjIiB4bWxuczpzdFJlZj0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL3NUeXBlL1Jlc291cmNlUmVmIyIgeG1sbnM6cGhvdG9zaG9wPSJodHRwOi8vbnMuYWRvYmUuY29tL3Bob3Rvc2hvcC8xLjAvIiB4bWxuczp0aWZmPSJodHRwOi8vbnMuYWRvYmUuY29tL3RpZmYvMS4wLyIgeG1sbnM6ZXhpZj0iaHR0cDovL25zLmFkb2JlLmNvbS9leGlmLzEuMC8iIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIDIxLjEgKE1hY2ludG9zaCkiIHhtcDpDcmVhdGVEYXRlPSIyMDIwLTAzLTI2VDExOjEwOjAyKzEzOjAwIiB4bXA6TWV0YWRhdGFEYXRlPSIyMDIyLTEyLTE1VDEwOjA3OjUzKzEzOjAwIiB4bXA6TW9kaWZ5RGF0ZT0iMjAyMi0xMi0xNVQxMDowNzo1MysxMzowMCIgZGM6Zm9ybWF0PSJpbWFnZS9wbmciIHhtcE1NOkluc3RhbmNlSUQ9InhtcC5paWQ6NDM2MWVlMzItNjFiZS00ZTMyLTk2N2YtNzc0ZTY0NDQ4OGRlIiB4bXBNTTpEb2N1bWVudElEPSJhZG9iZTpkb2NpZDpwaG90b3Nob3A6YmVhMGZhMTEtN2UxNi0zZTQ0LTgxMTItMmM1MTJmNjk1MTE0IiB4bXBNTTpPcmlnaW5hbERvY3VtZW50SUQ9InhtcC5kaWQ6ZWU1NTEwZjgtNmI2ZC00NDJhLTkwOTMtMzQ4NmNlNDA0ZDU0IiBwaG90b3Nob3A6Q29sb3JNb2RlPSIzIiB0aWZmOk9yaWVudGF0aW9uPSIxIiB0aWZmOlhSZXNvbHV0aW9uPSI3MjAwMDAvMTAwMDAiIHRpZmY6WVJlc29sdXRpb249IjcyMDAwMC8xMDAwMCIgdGlmZjpSZXNvbHV0aW9uVW5pdD0iMiIgZXhpZjpDb2xvclNwYWNlPSI2NTUzNSIgZXhpZjpQaXhlbFhEaW1lbnNpb249Ijk2IiBleGlmOlBpeGVsWURpbWVuc2lvbj0iNjQiPiA8eG1wTU06SGlzdG9yeT4gPHJkZjpTZXE+IDxyZGY6bGkgc3RFdnQ6YWN0aW9uPSJjcmVhdGVkIiBzdEV2dDppbnN0YW5jZUlEPSJ4bXAuaWlkOmVlNTUxMGY4LTZiNmQtNDQyYS05MDkzLTM0ODZjZTQwNGQ1NCIgc3RFdnQ6d2hlbj0iMjAyMC0wMy0yNlQxMToxMDowMisxMzowMCIgc3RFdnQ6c29mdHdhcmVBZ2VudD0iQWRvYmUgUGhvdG9zaG9wIDIxLjEgKE1hY2ludG9zaCkiLz4gPHJkZjpsaSBzdEV2dDphY3Rpb249InNhdmVkIiBzdEV2dDppbnN0YW5jZUlEPSJ4bXAuaWlkOjEyYTg4Mjg4LWYzOWItNDU4My04M2FlLTk0NTExY2FjZGU5OCIgc3RFdnQ6d2hlbj0iMjAyMC0wMy0yNlQxNDoxNTozMisxMzowMCIgc3RFdnQ6c29mdHdhcmVBZ2VudD0iQWRvYmUgUGhvdG9zaG9wIDIxLjEgKE1hY2ludG9zaCkiIHN0RXZ0OmNoYW5nZWQ9Ii8iLz4gPHJkZjpsaSBzdEV2dDphY3Rpb249InNhdmVkIiBzdEV2dDppbnN0YW5jZUlEPSJ4bXAuaWlkOmEwMDkzM2E5LTA4NzctNDRlYi04YThmLTZlZDYyZjA1ZDhlZCIgc3RFdnQ6d2hlbj0iMjAyMC0wMy0yNlQxNDozNDo1NCsxMzowMCIgc3RFdnQ6c29mdHdhcmVBZ2VudD0iQWRvYmUgUGhvdG9zaG9wIDIxLjEgKE1hY2ludG9zaCkiIHN0RXZ0OmNoYW5nZWQ9Ii8iLz4gPHJkZjpsaSBzdEV2dDphY3Rpb249ImNvbnZlcnRlZCIgc3RFdnQ6cGFyYW1ldGVycz0iZnJvbSBhcHBsaWNhdGlvbi92bmQuYWRvYmUucGhvdG9zaG9wIHRvIGltYWdlL3BuZyIvPiA8cmRmOmxpIHN0RXZ0OmFjdGlvbj0iZGVyaXZlZCIgc3RFdnQ6cGFyYW1ldGVycz0iY29udmVydGVkIGZyb20gYXBwbGljYXRpb24vdm5kLmFkb2JlLnBob3Rvc2hvcCB0byBpbWFnZS9wbmciLz4gPHJkZjpsaSBzdEV2dDphY3Rpb249InNhdmVkIiBzdEV2dDppbnN0YW5jZUlEPSJ4bXAuaWlkOjlmZGE3OTBiLTZlODQtNGVmNS1hNGYxLTg0ZWFiMGIwNWJjOCIgc3RFdnQ6d2hlbj0iMjAyMC0wMy0yNlQxNDozNDo1NCsxMzowMCIgc3RFdnQ6c29mdHdhcmVBZ2VudD0iQWRvYmUgUGhvdG9zaG9wIDIxLjEgKE1hY2ludG9zaCkiIHN0RXZ0OmNoYW5nZWQ9Ii8iLz4gPHJkZjpsaSBzdEV2dDphY3Rpb249InNhdmVkIiBzdEV2dDppbnN0YW5jZUlEPSJ4bXAuaWlkOmFiMmM1Y2ExLWUzYTQtNGViMi1hODg5LTBmNzUwOWVlYmJhNiIgc3RFdnQ6d2hlbj0iMjAyMi0xMi0xNVQwODoyNjowMSsxMzowMCIgc3RFdnQ6c29mdHdhcmVBZ2VudD0iQWRvYmUgUGhvdG9zaG9wIDI0LjAgKE1hY2ludG9zaCkiIHN0RXZ0OmNoYW5nZWQ9Ii8iLz4gPHJkZjpsaSBzdEV2dDphY3Rpb249ImNvbnZlcnRlZCIgc3RFdnQ6cGFyYW1ldGVycz0iZnJvbSBpbWFnZS9wbmcgdG8gYXBwbGljYXRpb24vdm5kLmFkb2JlLnBob3Rvc2hvcCIvPiA8cmRmOmxpIHN0RXZ0OmFjdGlvbj0iZGVyaXZlZCIgc3RFdnQ6cGFyYW1ldGVycz0iY29udmVydGVkIGZyb20gaW1hZ2UvcG5nIHRvIGFwcGxpY2F0aW9uL3ZuZC5hZG9iZS5waG90b3Nob3AiLz4gPHJkZjpsaSBzdEV2dDphY3Rpb249InNhdmVkIiBzdEV2dDppbnN0YW5jZUlEPSJ4bXAuaWlkOjZiOTY1MjJmLTA3OTYtNDZhMS1iY2JjLTM2ZmJhYzIyNmQ4OSIgc3RFdnQ6d2hlbj0iMjAyMi0xMi0xNVQwODoyNjowMSsxMzowMCIgc3RFdnQ6c29mdHdhcmVBZ2VudD0iQWRvYmUgUGhvdG9zaG9wIDI0LjAgKE1hY2ludG9zaCkiIHN0RXZ0OmNoYW5nZWQ9Ii8iLz4gPHJkZjpsaSBzdEV2dDphY3Rpb249InNhdmVkIiBzdEV2dDppbnN0YW5jZUlEPSJ4bXAuaWlkOjZiOGEyNGM2LTk0MjMtNDVlMS1iYmM1LTlkN2YzNmE0ZWI4NSIgc3RFdnQ6d2hlbj0iMjAyMi0xMi0xNVQxMDowNzo1MysxMzowMCIgc3RFdnQ6c29mdHdhcmVBZ2VudD0iQWRvYmUgUGhvdG9zaG9wIDI0LjAgKE1hY2ludG9zaCkiIHN0RXZ0OmNoYW5nZWQ9Ii8iLz4gPHJkZjpsaSBzdEV2dDphY3Rpb249ImNvbnZlcnRlZCIgc3RFdnQ6cGFyYW1ldGVycz0iZnJvbSBhcHBsaWNhdGlvbi92bmQuYWRvYmUucGhvdG9zaG9wIHRvIGltYWdlL3BuZyIvPiA8cmRmOmxpIHN0RXZ0OmFjdGlvbj0iZGVyaXZlZCIgc3RFdnQ6cGFyYW1ldGVycz0iY29udmVydGVkIGZyb20gYXBwbGljYXRpb24vdm5kLmFkb2JlLnBob3Rvc2hvcCB0byBpbWFnZS9wbmciLz4gPHJkZjpsaSBzdEV2dDphY3Rpb249InNhdmVkIiBzdEV2dDppbnN0YW5jZUlEPSJ4bXAuaWlkOjQzNjFlZTMyLTYxYmUtNGUzMi05NjdmLTc3NGU2NDQ0ODhkZSIgc3RFdnQ6d2hlbj0iMjAyMi0xMi0xNVQxMDowNzo1MysxMzowMCIgc3RFdnQ6c29mdHdhcmVBZ2VudD0iQWRvYmUgUGhvdG9zaG9wIDI0LjAgKE1hY2ludG9zaCkiIHN0RXZ0OmNoYW5nZWQ9Ii8iLz4gPC9yZGY6U2VxPiA8L3htcE1NOkhpc3Rvcnk+IDx4bXBNTTpEZXJpdmVkRnJvbSBzdFJlZjppbnN0YW5jZUlEPSJ4bXAuaWlkOjZiOGEyNGM2LTk0MjMtNDVlMS1iYmM1LTlkN2YzNmE0ZWI4NSIgc3RSZWY6ZG9jdW1lbnRJRD0iYWRvYmU6ZG9jaWQ6cGhvdG9zaG9wOjIyOTFjN2Q1LTdiMGYtNmI0YS1iMDNmLTZjMjlkMjBmZGI5MCIgc3RSZWY6b3JpZ2luYWxEb2N1bWVudElEPSJ4bXAuZGlkOmVlNTUxMGY4LTZiNmQtNDQyYS05MDkzLTM0ODZjZTQwNGQ1NCIvPiA8cGhvdG9zaG9wOkRvY3VtZW50QW5jZXN0b3JzPiA8cmRmOkJhZz4gPHJkZjpsaT5hZG9iZTpkb2NpZDpwaG90b3Nob3A6OGFkNDQ1MGUtN2ZmNS1iZTQyLTlmNTAtOGE0ZDBlYTU4MmFlPC9yZGY6bGk+IDwvcmRmOkJhZz4gPC9waG90b3Nob3A6RG9jdW1lbnRBbmNlc3RvcnM+IDwvcmRmOkRlc2NyaXB0aW9uPiA8L3JkZjpSREY+IDwveDp4bXBtZXRhPiA8P3hwYWNrZXQgZW5kPSJyIj8+Ng/hYAAAAmVJREFUeJztmztu20AURe8NjKRIIUFeQxbgjumzAFVZgKsgQPbgLr3SsDJYu+IC0mcR2YAaBRTgIj/kpjAV2BQp+kPmjqR3gAHBETh8nEPNDPCGlITAxzN3AMdOCDATAsycNCtIdk4KkjhuOOkxdn9sCah58dSGD4iuvvgxRONsroJI6hjf9IcyVD/FHGAmBJgJAWZCgJkQYCYEmAkBZkKAmRBgJgSYCQFmQoCZEGAmBJgJAWYsAkiqWXrqz0leN9q4Jnm+67p9oCsjNiqbREZbUqMtySHpkuQrkitJpyRXAD5JuuxrL3WsGbHmvfruTfIzgNcAvkh609femBxsRqxnGMlxE3P+n8NqpW3o6yvNNpITIImb0vLzOwB/6qOd27Hep7S1kZyALkh+BHAm6SWAs/p877FMwrto/k0lsV7tvJc0qetO61XQ181EvK/EtpRH8ph+artmb4agQyUEmAkBZkKAmRBgJgSYCQFmQoCZEGAmBJgJAWZCgJkQYCYEmAkBZloTMiSft9VL+jluOOnR1RdD0ZUR6/oI+RgTNYN8kN3FloDIht1l7P6IOcBMCDATAsyEADMhwEyyAkjOSC5ILkl+r48LkjN3bIMiKckCYJFlmYqiUFVVKopCWZYJwMId2xOeSVt17qB2BLssikK3KYpCAJbu2IYUsLU1MRVI/qqq6mQymfyrW6/XmE6nv5Hgntb7oj3amrgqy/JORX2+0gO3hadUmg+Z8pt0lef5BwCYz+coyxJ5ngPAlTesYUl5CJoBuADwFsAUQIWbzr+Q9M0W2MAkK+BYSHkOOApCgJkQYOYv4nG+qvJR/IYAAAAASUVORK5CYII="}];return i};I.createAnnotation=function(i,t){var d=function(i){if(!i){return""}return i.replaceAll(/(\{|\})/g,"\\$1")};var e=new I({viewport:t,annotationId:i.annotation.id,nodeRef:i.node,style:i.annotation.style,animate:i.annotation.animate===undefined?true:i.annotation.animate,editable:!!i.annotation.editable,name:i.node.name,text:d(i.annotation.text&&i.annotation.text.html),xCoordinate:i.node.position.x,yCoordinate:i.node.position.y,width:i.node.scale.x,height:i.node.scale.y});e._attachmentNode=i.attachment;if(i.targetNodes){i.targetNodes.forEach(function(i){e.getTargetNodes().push(i)})}e.sourceData=i;return e};I.prototype._getBackgroundColor=function(){var i="rgba(221, 221, 221, 0.5)";var t=this.sourceData.annotation;if(t.label&&t.label.colour){var d=t.label.colour;i="rgba("+d[0]*255+", "+d[1]*255+", "+d[2]*255+", "+d[3]+")"}return i};return I});
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/AnnotationRenderer", [],function(){"use strict";var t={apiVersion:2};t.render=function(t,e){t.openStart("div",e);var n=e.getEditable()&&e.getSelected()?"Editing":e.getStyle();t.class("sapUiVizKitAnnotation"+n);if(e._reverse===true){t.class("sapUiVizKitAnnotationReverse")}t.openEnd();for(var i=0;i<8;i++){t.openStart("div");t.class("sapUiVizKitAnnotationElement"+i);t.openEnd();t.close("div")}t.openStart("div");t.class("sapUiVizKitAnnotationNode"+n);t.openEnd();t.close("div");t.openStart("div");t.class("sapUiVizKitAnnotationLeader"+n);t.openEnd();t.close("div");t.openStart("svg");t.attr("xmlns","http://www.w3.org/2000/svg");t.class("sapUiVizKitAnnotationSVG"+n);t.openEnd();t.openStart("path");t.openEnd();t.close("path");t.close("svg");if(e._textDiv){t.renderControl(e._textDiv)}t.close("div")};return t},true);
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/AnnotationStyle", ["sap/ui/base/DataType"],function(a){"use strict";var e={Default:"Default",Explode:"Explode",Square:"Square",Random:"Random",Expand:"Expand"};a.registerEnum("sap.ui.vk.AnnotationStyle",e);return e},true);
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/BaseNodeProxy", ["sap/ui/base/Object"],function(a){"use strict";var e=a.extend("sap.ui.vk.BaseNodeProxy",{metadata:{library:"sap.ui.vk",abstract:true}});return e});
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/BillboardBorderLineStyle", ["sap/ui/base/DataType"],function(t){"use strict";var o={None:"None",Solid:"Solid",Dash:"Dash",Dot:"Dot",DashDot:"DashDot",DashDotDot:"DashDotDot"};t.registerEnum("sap.ui.vk.BillboardBorderLineStyle",o);return o},true);
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/BillboardCoordinateSpace", ["sap/ui/base/DataType"],function(e){"use strict";var r={Viewport:"Viewport",Screen:"Screen",World:"World"};e.registerEnum("sap.ui.vk.BillboardCoordinateSpace",r);return r},true);
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/BillboardHorizontalAlignment", ["sap/ui/base/DataType"],function(e){"use strict";var t={Left:"left",Center:"center",Right:"right"};e.registerEnum("sap.ui.vk.BillboardHorizontalAlignment",t);return t},true);
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/BillboardStyle", ["sap/ui/base/DataType"],function(e){"use strict";var a={RectangularShape:"RectangularShape",CircularShape:"CircularShape",None:"None",TextGlow:"TextGlow"};e.registerEnum("sap.ui.vk.BillboardStyle",a);return a},true);
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/BillboardTextEncoding", ["sap/ui/base/DataType"],function(e){"use strict";var t={PlainText:"PlainText",HtmlText:"HtmlText"};e.registerEnum("sap.ui.vk.BillboardTextEncoding",t);return t},true);
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/Camera", ["sap/ui/base/ManagedObject"],function(e){"use strict";var t=e.extend("sap.ui.vk.Camera",{metadata:{library:"sap.ui.vk",properties:{position:{type:"float[]",defaultValue:[0,0,0]},targetDirection:{type:"float[]",defaultValue:[1,0,0]},upDirection:{type:"float[]",defaultValue:[0,1,0]},nearClipPlane:{type:"float",defaultValue:.1},farClipPlane:{type:"float",defaultValue:1}}}});t.prototype.getCameraRef=function(){return null};t.prototype.getIsModified=function(){return!!this._isModified};t.prototype.setIsModified=function(e){this._isModified=e};return t});
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/CameraFOVBindingType", ["sap/ui/base/DataType"],function(i){"use strict";var a={Minimum:"minimum",Maximum:"maximum",Horizontal:"horizontal",Vertical:"vertical"};i.registerEnum("sap.ui.vk.CameraFOVBindingType",a);return a},true);
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/CameraProjectionType", ["sap/ui/base/DataType"],function(e){"use strict";var r={Perspective:"perspective",Orthographic:"orthographic"};e.registerEnum("sap.ui.vk.CameraProjectionType",r);return r},true);
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/ContainerBase", ["./library","sap/ui/core/Control","sap/ui/core/IconPool","sap/ui/core/Popup","sap/ui/core/ResizeHandler","sap/ui/core/delegate/ScrollEnablement","sap/ui/Device","sap/m/library","sap/m/Label","sap/m/OverflowToolbar","sap/m/OverflowToolbarButton","sap/m/Button","sap/m/OverflowToolbarToggleButton","sap/m/ToggleButton","sap/m/SegmentedButton","sap/m/SegmentedButtonItem","sap/m/ToolbarSpacer","sap/m/OverflowToolbarLayoutData","./ContainerBaseRenderer","./MapContainerButtonType","./getResourceBundle","sap/base/util/uid","sap/base/Log"],function(t,e,n,o,i,s,a,r,l,u,c,h,p,d,g,f,S,_,C,m,y,v,b){"use strict";var B=e.extend("sap.ui.vk.ContainerBase",{metadata:{library:"sap.ui.vk",properties:{showFullScreen:{type:"boolean",group:"Misc",defaultValue:true},showSettings:{type:"boolean",group:"Misc",defaultValue:true},showSelection:{type:"boolean",group:"Misc",defaultValue:true},fullScreen:{type:"boolean",group:"Misc",defaultValue:false},title:{type:"string",group:"Misc",defaultValue:""},autoAdjustHeight:{type:"boolean",group:"Misc",defaultValue:false}},defaultAggregation:"content",aggregations:{content:{type:"sap.ui.vk.ContainerContent",multiple:true,singularName:"content"},toolbar:{type:"sap.m.Toolbar",multiple:false,visibility:"hidden"}},associations:{ariaDescribedBy:{type:"sap.ui.core.Control",multiple:true,singularName:"ariaDescribedBy"},ariaLabelledBy:{type:"sap.ui.core.Control",multiple:true,singularName:"ariaLabelledBy"}},events:{contentChange:{parameters:{selectedItemId:"string"}},settingsPressed:{}}}});B.prototype.switchContent=function(t){this.setSelectedContent(t);this.rerender()};B.prototype.updateContainer=function(){this._contentChanged=true;this.rerender()};B.prototype.setSelectedContent=function(t){this._oSelectedContent=t};B.prototype.getSelectedContent=function(){return this._oSelectedContent};B.prototype.init=function(){this._selectionState="SINGLE";this._firstTime=true;this._aContentIcons=[];this._selectedContent=null;this._oSelectedContent=null;this._bSegmentedButtonSaveSelectState=false;this._oMenu=null;this._customButtons=[];var t=new _({priority:sap.m.OverflowToolbarPriority.High});var e=sap.m.ButtonType.Transparent;this._oFullScreenButton=new c({layoutData:t,type:e,icon:"sap-icon://full-screen",text:y().getText("CONTAINERBASE_FULLSCREEN"),tooltip:y().getText("CONTAINERBASE_FULLSCREEN"),press:function(){this._bSegmentedButtonSaveSelectState=true;this._toggleFullScreen()}.bind(this)});this._oSettingsButton=new c({layoutData:t.clone(),type:e,icon:"sap-icon://action-settings",text:y().getText("CONTAINERBASE_SETTINGS"),tooltip:y().getText("CONTAINERBASE_SETTINGS"),press:function(){this._bSegmentedButtonSaveSelectState=true;this.fireSettingsPressed()}.bind(this)});this._oSelectionButtonSingle=new f({icon:"sap-icon://map-container/selection-single",tooltip:y().getText("CONTAINERBASE_MENU_SINGLE"),press:this._handleSelection.bind(this,"SINGLE")});this._oSelectionButtonRectangle=new f({icon:"sap-icon://map-container/selection-rectangle",tooltip:y().getText("CONTAINERBASE_MENU_RECT"),press:this._handleSelection.bind(this,"RECT")});this._oSelectionButtonLasso=new f({icon:"sap-icon://map-container/selection-lasso",tooltip:y().getText("CONTAINERBASE_MENU_LASSO"),press:this._handleSelection.bind(this,"LASSO")});this._selectionMenu=new g({items:[this._oSelectionButtonSingle,this._oSelectionButtonRectangle,this._oSelectionButtonLasso]});this._oPopup=new o({modal:true,shadow:false,autoClose:false});this._oContentSegmentedButton=new g({layoutData:t.clone(),select:this._onContentButtonSelect.bind(this)});this._oContTitle=new l;this._oToolbar=new u({width:"auto"}).addStyleClass("sapUiVkContainerBaseToolbar");this.setAggregation("toolbar",this._oToolbar);this.sResizeListenerId=null;if(a.system.desktop){this.sResizeListenerId=i.register(this,jQuery.proxy(this._performHeightChanges,this))}else{a.orientation.attachHandler(this._performHeightChanges,this);a.resize.attachHandler(this._performHeightChanges,this)}var s=[{name:"selection-lasso",unicode:"E000"},{name:"selection-rectangle",unicode:"E001"},{name:"selection-single",unicode:"E002"}],r="map-container",h="map-container";s.forEach(function(t){n.addIcon(t.name,r,h,t.unicode)})};B.prototype.exit=function(){if(this._oFullScreenButton){this._oFullScreenButton.destroy();this._oFullScreenButton=undefined}if(this._oPopup){this._oPopup.destroy();this._oPopup=undefined}if(this._oContentSegmentedButton){this._oContentSegmentedButton.destroy();this._oContentSegmentedButton=undefined}if(this._oSelectedContent){this._oSelectedContent.destroy();this._oSelectedContent=undefined}if(this._oToolbar){this._oToolbar.destroy();this._oToolbar=undefined}if(a.system.desktop&&this.sResizeListenerId){i.deregister(this.sResizeListenerId);this.sResizeListenerId=null}else{a.orientation.detachHandler(this._performHeightChanges,this);a.resize.detachHandler(this._performHeightChanges,this)}};B.prototype.setFullScreen=function(t){if(this._firstTime){return}if(this.getFullScreen()==t){return}var e=this.getProperty("fullScreen");if(e!==t){this._toggleFullScreen()}};B.prototype.onAfterRendering=function(){var t=this;if(this.sResizeListenerId===null&&a.system.desktop){this.sResizeListenerId=i.register(this,jQuery.proxy(this._performHeightChanges,this))}if(this.getAutoAdjustHeight()||this.getFullScreen()){setTimeout(function(){t._performHeightChanges()},500)}this._firstTime=false;if(this.getSelectedContent()!==null){var e=this.getSelectedContent().getContent();if(e instanceof sap.ui.vbm.GeoMap||e instanceof sap.ui.vbm.AnalyticMap){if(this.getShowSelection()){if(this._selectionState==="LASSO"){e.setLassoSelection(true)}else if(this._selectionState==="RECT"){e.setRectangularSelection(true)}else if(this._selectionState==="SINGLE"){e.setRectangularSelection(false);e.setLassoSelection(false)}}}}};B.prototype.onBeforeRendering=function(){var t=this;if(t._contentChanged){t._contentChange()}t._oToolbar.getContent().forEach(function(e){var n=e.getId();var o=e["getPressed"]?e.getPressed():null;for(var i in t._customButtons){if(t._customButtons[i].button&&t._customButtons[i].button.getId()==n){t._customButtons[i].toggled=o}}});t._oToolbar.removeAllContent();t._addToolbarContent()};B.prototype.setTitle=function(t){this._oContTitle.setText(t);this.setProperty("title",t,true)};B.prototype.addContent=function(t){this.addAggregation("content",t);this._contentChanged=true};B.prototype.insertContent=function(t,e){this.insertAggregation("content",t,e);this._contentChanged=true};B.prototype.updateContent=function(){this.updateAggregation("content");this._contentChanged=true};B.prototype._toggleFullScreen=function(){var t=this.getProperty("fullScreen");var e;var n;var o;if(t){this._closeFullScreen();this.setProperty("fullScreen",false,true);o=this.getSelectedContent().getContent();e=o.getId();o.setWidth("100%");n=this._contentHeight[e];if(n){o.setHeight(n)}this.invalidate()}else{var i=this.getAggregation("content");this._contentHeight={};if(i){for(var s=0;s<i.length;s++){o=i[s].getContent();e=o.getId();if(jQuery.isFunction(o.getHeight)){n=o.getHeight()}else{n=0}this._contentHeight[e]=n}}this._openFullScreen(true);this.setProperty("fullScreen",true,true)}var a=t?"sap-icon://full-screen":"sap-icon://exit-full-screen";this._oFullScreenButton.setIcon(a);this._oFullScreenButton.focus()};B.prototype._openFullScreen=function(t){if(t!==null&&t===true){this._oScrollEnablement=new s(this,this.getId()+"-wrapper",{horizontal:true,vertical:true})}this.$content=this.$();if(this.$content){this.$tempNode=jQuery("<div></div>");this.$content.before(this.$tempNode);this._$overlay=jQuery("<div id='"+v()+"'></div>");this._$overlay.addClass("sapUiVkContainerBaseOverlay");this._$overlay.append(this.$content);this._oPopup.setContent(this._$overlay)}else{b.warning("Overlay: content does not exist or contains more than one child")}this._oPopup.open(200,undefined,undefined,jQuery("body"))};B.prototype._closeFullScreen=function(){if(this._oScrollEnablement!==null){this._oScrollEnablement.destroy();this._oScrollEnablement=null}this.$tempNode.replaceWith(this.$content);this._oToolbar.setDesign(sap.m.ToolbarDesign.Auto);this._oPopup.close();this._$overlay.remove()};B.prototype._performHeightChanges=function(){if(this.getAutoAdjustHeight()||this.getFullScreen()){var t=this.$();if(t.find(".sapUiVkContainerBaseToolbarArea").children()[0]&&t.find(".sapUiVkContainerBaseContentArea").children()[0]){var e=this.getSelectedContent().getContent();if(e.getDomRef().offsetWidth!==this.getDomRef().clientWidth){this.rerender()}}}};B.prototype._switchContent=function(t){var e=this._findContentById(t);this.setSelectedContent(e);this.fireContentChange({selectedItemId:t});this.rerender()};B.prototype._contentChange=function(){var t=this.getContent();this._oContentSegmentedButton.removeAllButtons();this._destroyButtons(this._aContentIcons);this._aContentIcons=[];if(t.length===0){this._oContentSegmentedButton.removeAllButtons();this._setDefaultOnSegmentedButton();this.switchContent(null)}if(t){for(var e=0;e<t.length;e++){var n=t[e].getContent();if(n.setWidth){n.setWidth("100%")}var o=new f({icon:t[e].getIcon(),tooltip:t[e].getTitle(),key:n.getId()});this._aContentIcons.push(o);this._oContentSegmentedButton.addItem(o);if(e===0){this.setSelectedContent(t[e])}}}this._contentChanged=false};B.prototype._onContentButtonSelect=function(t){var e=t.getParameter("key");this._switchContent(e)};B.prototype._findContentById=function(t){var e=null;var n=this.getAggregation("content");if(n){for(var o=0;!e&&o<n.length;o++){if(n[o].getContent().getId()===t){e=n[o]}}}return e};B.prototype._addToolbarContent=function(){this._oToolbar.addContent(new S);if(this._aContentIcons.length>1){this._oToolbar.addContent(this._oContentSegmentedButton)}if(this.getSelectedContent()!==null){var t=this.getSelectedContent().getContent();if(t instanceof sap.ui.vbm.GeoMap||t instanceof sap.ui.vbm.AnalyticMap){if(this.getShowSelection()){this._oToolbar.addContent(this._selectionMenu)}}}this._customButtons.forEach(function(t){if(t.visible){var e={type:sap.m.ButtonType.Transparent,layoutData:new _({priority:sap.m.OverflowToolbarPriority.High})};if("active"in t){e.enabled=t.active}if("icon"in t){e.icon=t.icon}if("activeIcon"in t){e.activeIcon=t.activeIcon}if("text"in t){e.text=t.text}if("tooltip"in t){e.tooltip=t.tooltip}if("press"in t){e.press=t.press}switch(t.type){case m.Click:t.button=t.overflow?new c(e):new h(e);break;default:if("toggled"in t){e.pressed=t.toggled}t.button=t.overflow?new p(e):new d(e);break}this._oToolbar.addContent(t.button)}},this);if(this.getShowSettings()){this._oToolbar.addContent(this._oSettingsButton)}if(!a.system.phone&&this.getShowFullScreen()){this._oToolbar.addContent(this._oFullScreenButton)}};B.prototype._setDefaultOnSegmentedButton=function(){if(!this._bSegmentedButtonSaveSelectState){this._oContentSegmentedButton.setSelectedButton(null)}this._bSegmentedButtonSaveSelectState=false};B.prototype._destroyButtons=function(t){t.forEach(function(t){t.destroy()})};B.prototype._handleSelection=function(t){var e=this.getSelectedContent().getContent();if(e instanceof sap.ui.vbm.GeoMap||e instanceof sap.ui.vbm.AnalyticMap){if(t==="LASSO"){e.setLassoSelection(true);this._selectionState=t}else if(t==="RECT"){e.setRectangularSelection(true);this._selectionState=t}else if(t==="SINGLE"){e.setRectangularSelection(false);e.setLassoSelection(false);this._selectionState=t}}};return B});
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/ContainerBaseRenderer", function(){"use strict";var e={apiVersion:2};e.render=function(e,r){var t=r.getTooltip_AsString();var a=r.getTitle();var o=r.getAriaLabelledBy();var i=r.getAriaDescribedBy();e.openStart("div",r);e.attr("role",sap.ui.core.AccessibleRole.Group);if(a){e.attr("aria-label",a)}else if(t){e.attr("aria-label",t)}if(o&&o.length>0){e.attr("aria-labelledby",o.join(" "))}if(i&&i.length>0){e.attr("aria-describedby",i.join(" "))}e.class("sapUiVkContainerBase");e.openEnd();e.openStart("div");e.attr("id",r.getId()+"-wrapper");e.attr("role",sap.ui.core.AccessibleRole.Presentation);e.class("sapUiVkContainerBaseWrapper");e.openEnd();this.writeContentArea(e,r);this.writeToolbarArea(e,r);e.close("div");e.close("div")};e.writeContentArea=function(e,r){var t=r.getSelectedContent();e.openStart("div");e.class("sapUiVkContainerBaseContentArea");e.attr("role",sap.ui.core.AccessibleRole.Img);e.openEnd();if(t!==null){e.renderControl(t)}else if(r.getContent().length>0){t=r.getContent()[0];e.renderControl(t)}e.close("div")};e.writeToolbarArea=function(e,r){e.openStart("div");e.class("sapUiVkContainerBaseToolbarArea");e.attr("role",sap.ui.core.AccessibleRole.Group);e.openEnd();e.renderControl(r._oToolbar);e.close("div")};return e},true);
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/ContainerContent", ["./library","sap/ui/core/Control","./ContainerContentRenderer"],function(t,e,n){"use strict";var i=e.extend("sap.ui.vk.ContainerContent",{metadata:{library:"sap.ui.vk",properties:{icon:{type:"string",group:"Misc",defaultValue:null},title:{type:"string",group:"Misc",defaultValue:null}},aggregations:{content:{type:"sap.ui.core.Control",multiple:false}}}});i.prototype.setContent=function(t){if(t instanceof sap.ui.vbm.GeoMap){t.setNavcontrolVisible(false);t.setWidth("100%");t.setHeight("100%")}this.setAggregation("content",t);return this};return i});
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/ContainerContentRenderer", function(){"use strict";var e={apiVersion:2};e.render=function(e,n){e.renderControl(n.getContent())};return e},true);
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/ContentConnector", ["sap/base/Log","sap/ui/base/ManagedObjectObserver","sap/ui/core/Element","./ContentResource","./ContentType","./Core","./getResourceBundle","./Messages"],function(e,t,n,a,s,o,r,i){"use strict";var c=n.prototype;var u=n.extend("sap.ui.vk.ContentConnector",{metadata:{library:"sap.ui.vk",aggregations:{contentResources:{type:"sap.ui.vk.ContentResource",bindable:"bindable"},viewStateManagers:{type:"sap.ui.vk.ViewStateManagerBase"},defaultViewStateManager:{type:"sap.ui.vk.ViewStateManagerBase",multiple:false,visibility:"hidden"},contentManagers:{type:"sap.ui.vk.ContentManager",visibility:"hidden"}},defaultAggregation:"contentResources",events:{contentChangesStarted:{parameters:{}},contentChangesFinished:{parameters:{content:{type:"any"},failureReason:{type:"any"}}},contentChangesProgress:{parameters:{phase:{type:"string"},percentage:{type:"float"},source:{type:"any"}}},contentLoadingFinished:{parameters:{source:{type:"any"},node:{type:"any"}}},contentReplaced:{parameters:{newContent:{type:"any"},oldContent:{type:"any"}}},contentDestroying:{parameters:{content:{type:"any"},preventGarbageCollection:{type:"function"}}}}},constructor:function(e,t){this._inLoading=false;this._delayContentResourcesUpdate=false;this._scheduleContentResourcesUpdateTimerId=null;this._content=null;this._contentManager=null;this._decryptionHandler=null;this._authorizationHandler=null;this._consumptionScenario=null;this._retryCount=1;c.constructor.apply(this,arguments);o.observeLifetime(this)}});u.prototype.isTreeBinding=function(e){return e==="contentResources"};u.prototype.init=function(){if(c.init){c.init.call(this)}this._selfObserver=new t(this._observeChanges.bind(this));this._selfObserver.observe(this,{aggregations:["contentResources","viewStateManagers"]})};u.prototype.destroy=function(){this._selfObserver.disconnect();this._selfObserver=null;if(this._scheduleContentResourcesUpdateTimerId){clearTimeout(this._scheduleContentResourcesUpdateTimerId);this._scheduleContentResourcesUpdateTimerId=null}this._delayContentResourcesUpdate=false;this._setContent(null,null);c.destroy.call(this)};u.prototype._observeChanges=function(e){if(e.name==="contentResources"){this._scheduleContentResourcesUpdate()}else if(e.name==="viewStateManagers"){if(e.mutation==="insert"){e.child.setContentConnector(this)}else if(e.mutation==="remove"){e.child.setContentConnector(null)}}};u.prototype.invalidate=function(e){if(e instanceof a){this._scheduleContentResourcesUpdate();return}c.invalidate.apply(this,arguments)};u.prototype._scheduleContentResourcesUpdate=function(){if(this._inLoading){this._delayContentResourcesUpdate=true;return this}if(!this._scheduleContentResourcesUpdateTimerId){this._scheduleContentResourcesUpdateTimerId=setTimeout(function(){this._scheduleContentResourcesUpdateTimerId=null;var t=this.getContentResources();if(t.length>0){this._collectContentResourceSourceTypeInformation(t).then(function(n){if(n.dimensions.length>1){setTimeout(function(){this.fireContentChangesStarted();this._setContent(null,null);this.fireContentChangesFinished({content:null,failureReason:{errorMessage:r().getText(i.VIT17.cause)}});e.error(r().getText(i.VIT17.summary),i.VIT17.code,"sap.ui.vk.ContentConnector")}.bind(this),0)}else if(n.contentManagerClassNames.length>1){setTimeout(function(){this.fireContentChangesStarted();this._setContent(null,null);this.fireContentChangesFinished({content:null,failureReason:{errorMessage:r().getText(i.VIT35.cause)}});e.error(r().getText(i.VIT35.summary),i.VIT35.code,"sap.ui.vk.ContentConnector")}.bind(this),0)}else if(n.contentManagerClassNames.length===0){setTimeout(function(){this.fireContentChangesStarted();this._setContent(null,null);this.fireContentChangesFinished({content:null,failureReason:{errorMessage:r().getText(i.VIT36.cause)}});e.error(r().getText(i.VIT36.summary),i.VIT36.code,"sap.ui.vk.ContentConnector")}.bind(this),0)}else if(n.contentManagerClassNames.length===1){var a=this;this._getContentManagerByClassName(n.contentManagerClassNames[0]).then(function(e){if(a._contentManager&&e!==a._contentManager){a.fireContentChangesStarted();a._setContent(null,null);a.fireContentChangesFinished({content:null})}e.loadContent(a._content,t)})}}.bind(this))}else{setTimeout(function(){this.fireContentChangesStarted();this._setContent(null,null);this.fireContentChangesFinished({content:null})}.bind(this),0)}}.bind(this),0)}return this};u.prototype._handleContentChangesStarted=function(e){this._inLoading=true;this.fireContentChangesStarted()};u.prototype._handleContentChangesFinished=function(e){var t=e.getParameter("content");this._setContent(t,e.getSource());this.fireContentChangesFinished({content:t,failureReason:e.getParameter("failureReason")});this._inLoading=false;if(this._delayContentResourcesUpdate){this._delayContentResourcesUpdate=false;this._scheduleContentResourcesUpdate()}};u.prototype._handleContentChangesProgress=function(e){this.fireContentChangesProgress({phase:e.getParameter("phase"),source:e.getParameter("source"),percentage:e.getParameter("percentage")})};u.prototype._handleContentLoadingFinished=function(e){this.fireContentLoadingFinished({source:e.getParameter("source"),node:e.getParameter("node")})};u.prototype._getContentManagerByClassName=function(e){var t;var n=this.getAggregation("contentManagers",[]);for(var a=0,s=n.length;a<s;++a){t=n[a];if(t.getMetadata().getName()===e){return Promise.resolve(t)}}var o=this;return new Promise(function(t,n){sap.ui.require([e.replaceAll(".","/")],function(e){var n=new e;o.addAggregation("contentManagers",n);n.attachContentChangesStarted(o._handleContentChangesStarted,o);n.attachContentChangesFinished(o._handleContentChangesFinished,o);n.attachContentChangesProgress(o._handleContentChangesProgress,o);n.attachContentLoadingFinished(o._handleContentLoadingFinished,o);o._assignDecryptionHandler([n]);o._assignAuthorizationHandler([n]);o._assignConsumptionScenario([n]);o._assignRetryCount([n]);t(n)})})};u.prototype.getContent=function(){return this._content};u.prototype.getContentManager=function(){return this._contentManager};u.prototype.getDefaultViewStateManager=function(){return this.getAggregation("defaultViewStateManager")};u.prototype._assignDecryptionHandler=function(e){for(var t=0;t<e.length;t++){e[t].setDecryptionHandler(this._decryptionHandler)}};u.prototype._assignAuthorizationHandler=function(e){for(var t=0;t<e.length;t++){e[t].setAuthorizationHandler(this._authorizationHandler)}};u.prototype._assignConsumptionScenario=function(e){for(var t=0;t<e.length;t++){e[t].setConsumptionScenario(this._consumptionScenario)}};u.prototype._assignRetryCount=function(e){for(var t=0;t<e.length;t++){e[t].setRetryCount(this._retryCount)}};u.prototype.setDecryptionHandler=function(e){this._decryptionHandler=e;this._assignDecryptionHandler(this.getAggregation("contentManagers",[]));return this};u.prototype.setAuthorizationHandler=function(e){this._authorizationHandler=e;this._assignAuthorizationHandler(this.getAggregation("contentManagers",[]));return this};u.prototype.setConsumptionScenario=function(e){this._consumptionScenario=e;this._assignConsumptionScenario(this.getAggregation("contentManagers",[]));return this};u.prototype.setRetryCount=function(e){this._retryCount=Math.max(e,0);this._assignRetryCount(this.getAggregation("contentManagers",[]));return this};u.prototype._setContent=function(e,t){var n=this._content;var a=this._contentManager;if(n!==e){this._content=e;this._contentManager=t;this.destroyAggregation("defaultViewStateManager");if(t){var s=t.getMetadata().getName();var o;switch(s){case"sap.ui.vk.threejs.ContentManager":o="sap.ui.vk.threejs.ViewStateManager";break;case"sap.ui.vk.dvl.ContentManager":o="sap.ui.vk.dvl.ViewStateManager";break;case"sap.ui.vk.svg.ContentManager":o="sap.ui.vk.svg.ViewStateManager";break;case"sap.ui.vk.pdf.ContentManager":o="sap.ui.vk.pdf.ViewStateManager";break;default:break}if(o){var r=sap.ui.require(o.replaceAll(".","/"));var i=new r(this.getId()+"-defaultviewstatemanager",{contentConnector:this});this.setAggregation("defaultViewStateManager",i)}}this.fireContentReplaced({oldContent:n,newContent:e});if(n){var c=false;this.fireContentDestroying({content:n,preventGarbageCollection:function(e){c=e}});a.destroyContent(n);if(!c){a.collectGarbage()}}}return this};u.prototype.updateContent=async function(e){const t=this.getContentResources();const n=this.getContentManager();const a=this.getContent();if(t.length===0||n==null||a==null){throw new Error("No content is loaded.")}const s=await n.updateContent(t,a,e);this.fireEvent("_contentUpdated",{result:s});return s};async function l(t){const n=t.getSourceType()?.toLowerCase();const a=t.getSource();const o=t.getVeid()??"";if(n!=="auto"||typeof a!=="string"||o===""){return null}const r=`${a}${a.endsWith("/")?"":"/"}scenes/${o}/info`;try{const e=await fetch(r);if(!e.ok){return null}const{contentType:n}=await e.json();switch(n){case s.IMAGE2D:case s.IMAGE360:case s.MATERIAL:case s.MODEL3D:case s.NAVIGATION:case s.SYMBOL:t.setEffectiveSourceType("stream");return{dimension:3,contentManagerClassName:"sap.ui.vk.threejs.ContentManager"};case s.DRAWING2D:case s.ECAD:t.setEffectiveSourceType(n===s.ECAD?"ecad":"stream2d");return{dimension:2,contentManagerClassName:"sap.ui.vk.svg.ContentManager"};case s.PDF:t.setEffectiveSourceType("stream");return{dimension:2,contentManagerClassName:"sap.ui.vk.pdf.ContentManager"};default:return null}}catch(t){e.error("Failed to resolve content resource type automatically.",t,"sap.ui.vk.ContentConnector")}return null}const g=[{pattern:/(^threejs[:.])|(^(threejs|stream|vds4)$)/,dimension:3,contentManagerClassName:"sap.ui.vk.threejs.ContentManager"},{pattern:/^vdsl?$/,dimension:3,contentManagerClassName:"sap.ui.vk.threejs.ContentManager"},{pattern:/^(png|jpg|jpeg|gif|bmp|tiff?|svg)$/,dimension:2,contentManagerClassName:"sap.ui.vk.ImageContentManager"},{pattern:/^(stream2d|vds4-2d|ecad)$/,dimension:2,contentManagerClassName:"sap.ui.vk.svg.ContentManager"},{pattern:/^(pdf)$/,dimension:2,contentManagerClassName:"sap.ui.vk.pdf.ContentManager"},l];(function(){g[1].contentManagerClassName="sap.ui.vk.dvl.ContentManager"})();async function h(e){const t=e.getSourceType()?.toLowerCase();let n=null;for(const a of g.slice()){if(typeof a==="function"){try{n=await a(e);break}catch{continue}}else if(typeof a.pattern==="string"){if(a.pattern.toLowerCase()===t){n=a;break}}else if(a.pattern instanceof RegExp){if(a.pattern.test(t)){n=a;break}}}if(n==null){return null}else{return{dimension:n.dimension,contentManagerClassName:n.contentManagerClassName,settings:n.settings}}}u.addContentManagerResolver=function(e){if(typeof e==="function"){g.unshift(e)}else{g.unshift({pattern:e.pattern,dimension:e.dimension,contentManagerClassName:e.contentManagerClassName,settings:e.settings})}return this};u.removeAllContentManagerResolvers=function(){g=[];return this};u.removeContentManagerResolver=function(e){var t=typeof e==="function",n=typeof e==="string",a=e instanceof RegExp,s=typeof e==="object"&&!a;for(var o=0,r=g.length;o<r;++o){if(t&&g[o]===e){g.splice(o,1);return true}else if(typeof g[o]==="object"){if(s){if(e.pattern&&g[o].pattern===e.pattern){g.splice(o,1);return true}}else if(a){if(g[o].pattern.source===e.source){g.splice(o,1);return true}}else if(n){if(g[o].pattern instanceof RegExp){if(g[o].pattern.source===e){g.splice(o,1);return true}}else if(g[o].pattern===e){g.splice(o,1);return true}}}}return false};u.prototype._collectContentResourceSourceTypeInformation=async function(e){var t=false;var n=false;var a={};var s={};var o=[];e.forEach(function e(t){o.push(t);t.getContentResources().forEach(e)});const r=await Promise.all(o.map(async function(e){const o=await h(e);if(o==null){if(e.getSourceType()){n=true}else{t=true}}else{a[o.dimension]=true;s[o.contentManagerClassName]=true}return o}));for(const[e,t]of r.entries()){if(t!=null){o[e]._contentManagerResolver=t}}return{noSourceTypes:t,unknownSourceTypes:n,dimensions:Object.getOwnPropertyNames(a).toSorted().map(Number),contentManagerClassNames:Object.getOwnPropertyNames(s)}};return u});
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/ContentManager", ["sap/ui/base/ManagedObject"],function(t){"use strict";var e=t.extend("sap.ui.vk.ContentManager",{metadata:{abstract:true,library:"sap.ui.vk",events:{contentChangesStarted:{parameters:{}},contentChangesFinished:{parameters:{content:{type:"any"},failureReason:{type:"object"}}},contentChangesProgress:{parameters:{phase:{type:"string"},percentage:{type:"float"},source:{type:"any"}}},contentLoadingFinished:{parameters:{source:{type:"any"},node:{type:"any"}}}}}});var n=e.getMetadata().getParent().getClass().prototype;e.prototype.init=function(){if(n.init){n.init.call(this)}this._decryptionHandler=null;this._authorizationHandler=null;this._consumptionScenario=null;this._retryCount=1};e.prototype.destroyContent=function(t){return this};e.prototype.collectGarbage=function(){return this};e.prototype.createOrthographicCamera=function(){return null};e.prototype.createPerspectiveCamera=function(){return null};e.prototype.destroyCamera=function(t){return this};e.prototype.setDecryptionHandler=function(t){this._decryptionHandler=t;return this};e.prototype.setAuthorizationHandler=function(t){this._authorizationHandler=t;return this};e.prototype.setConsumptionScenario=function(t){this._consumptionScenario=t;return this};e.prototype.setRetryCount=function(t){this._retryCount=Math.max(t,0);return this};e.prototype.updateContent=async function(t,e,n){};return e});
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/ContentResource", ["sap/ui/base/ManagedObject","./ContentResourceSourceTypeToCategoryMap"],function(e,t){"use strict";var o=e.extend("sap.ui.vk.ContentResource",{metadata:{library:"sap.ui.vk",properties:{source:"any",sourceType:"string",sourceId:"string",localMatrix:"float[]",name:"string",password:"string",useSecureConnection:{type:"boolean",defaultValue:true},veid:"string",includeHidden:{type:"boolean",defaultValue:true},includeAnimation:{type:"boolean",defaultValue:true},pushPMI:{type:"boolean",defaultValue:false},metadataFilter:"string",activateView:"string",enableLogger:{type:"boolean",defaultValue:false},pushViewGroups:{type:"boolean",defaultValue:true},includeBackground:{type:"boolean",defaultValue:true},includeParametric:{type:"boolean",defaultValue:true},includeMetadata:{type:"boolean",defaultValue:false},includeUsageId:{type:"sap.ui.vk.IncludeUsageIdType",defaultValue:false},dependencyLoader:"any"},aggregations:{contentResources:"sap.ui.vk.ContentResource"}},constructor:function(t,o,r){e.apply(this,arguments);this._effectiveSourceType=undefined}});o.prototype.isTreeBinding=function(e){return e==="contentResources"};o.prototype.destroy=function(){e.prototype.destroy.call(this)};o.prototype.setLocalMatrix=function(e){var t=this.getNodeProxy();if(t){t.setLocalMatrix(e)}this.setProperty("localMatrix",e,true);return this};o.prototype.getSourceProperties=function(){return this._shadowContentResource&&this._shadowContentResource.sourceProperties||{}};o.prototype.getNodeProxy=function(){return this._shadowContentResource&&this._shadowContentResource.nodeProxy||null};o.collectCategories=function(e){var o=[];var r={};function n(e){var a=(e.getSourceType()||"").toLowerCase();if(a){var u=t[a]||"unknown";if(!r.hasOwnProperty(u)){r[u]=true;o.push(u)}}e.getContentResources().forEach(n)}e.forEach(n);return o};o.prototype.getEffectiveSourceType=function(){return this._effectiveSourceType??this.getSourceType()};o.prototype.setEffectiveSourceType=function(e){this._effectiveSourceType=e};return o});
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/ContentResourceSourceCategory", ["sap/ui/base/DataType"],function(e){"use strict";var r={"3D":"3D","2D":"2D"};e.registerEnum("sap.ui.vk.ContentResourceSourceCategory",r);return r},true);
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/ContentResourceSourceTypeToCategoryMap", ["./ContentResourceSourceCategory"],function(e){"use strict";var D={vds:e["3D"],vdsl:e["3D"],cgm:e["3D"],png:e["2D"],jpg:e["2D"],jpeg:e["2D"],gif:e["2D"],bmp:e["2D"],tiff:e["2D"],tif:e["2D"],svg:e["2D"]};return D},true);
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/ContentType", ["sap/ui/base/DataType"],function(e){"use strict";const D={MODEL3D:"3DModel",IMAGE2D:"2DImage",IMAGE360:"360Image",DRAWING2D:"2DDrawing",NAVIGATION:"Navigation",FOLDER:"Folder",SYMBOL:"Symbol",MATERIAL:"Material",PDF:"PDF",ECAD:"ECAD"};e.registerEnum("sap.ui.vk.ContentType",D);return D});
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/Core", ["sap/base/strings/capitalize","sap/base/util/each","sap/ui/base/ManagedObject","sap/ui/base/ManagedObjectObserver","sap/ui/core/Element","sap/ui/core/EventBus","./library"],function(t,e,i,s,n,o,r){"use strict";var a=i.extend("sap.ui.vk.Core",{metadata:{library:"sap.ui.vk",aggregations:{eventBus:{type:"sap.ui.core.EventBus",multiple:false,visibility:"hidden"}}},constructor:function(){if(r.getCore){return r.getCore()}i.call(this);var t=this;r.getCore=function(){return t};this.setAggregation("eventBus",new o);return this}});a.prototype.getEventBus=function(){return this.getAggregation("eventBus")};function c(e,i){if(i.multiple){return(e==="insert"?"onAdd":"onRemove")+t(i.singularName)}else{return(e==="insert"?"onSet":"onUnset")+t(i.name)}}function u(i,s,n){var o=n.getId();i.forEach(function(i){e(i.getMetadata().getAllAssociations(),function(e,r){if(n.isA(r.type)){var a=i["get"+t(e)]();if(a===o||Array.isArray(a)&&a.indexOf(o)>=0){var u=i[c(s,r)];if(typeof u==="function"){u.call(i,n)}}}})})}a.prototype.observeLifetime=function(t){if(!this._lifetimeObserver){this._lifetimeObserver=new s(function(t){if(t.type==="destroy"&&this._objectsWithAssociations){u(this._objectsWithAssociations.slice(),"remove",t.object)}}.bind(this))}this._lifetimeObserver.observe(t,{destroy:true});if(this._objectsWithAssociations){u(this._objectsWithAssociations.slice(),"insert",t)}return this};a.prototype.observeAssociations=function(i){if(!i.getId()){throw new Error("To observe an object it must have an ID.")}if(!this._objectsWithAssociations){var o=this;this._objectsWithAssociations=[];this._associationObserver=new s(function(i){var s=o._objectsWithAssociations.indexOf(i.object);if(s<0){return}if(i.type==="destroy"){e(i.object.getMetadata().getAllAssociations(),function(e,s){var n;var o=t(s.name);if(s.multiple){n=i.object["removeAll"+o];if(typeof n==="function"){n.call(i.object)}}else{n=i.object["set"+o];if(typeof n==="function"){n.call(i.object,null)}}});o._objectsWithAssociations.splice(s,1)}else if(i.type==="association"){var r=i.object.getMetadata().getAllAssociations()[i.name];var a=i.object[c(i.mutation,r)];if(typeof a==="function"){if(Array.isArray(i.ids)){i.ids.map(function(t){return n.getElementById(t)}).filter(function(t){return t!=null}).forEach(a.bind(i.object))}else{var u=n.getElementById(i.ids);if(u){a.call(i.object,u)}}}}})}if(this._objectsWithAssociations.indexOf(i)<0){this._objectsWithAssociations.push(i);this._associationObserver.observe(i,{associations:true,destroy:true});e(i.getMetadata().getAllAssociations(),function(e,s){var o=i[c("insert",s)];if(typeof o==="function"){var r=i["get"+t(e)]();if(Array.isArray(r)){r.map(function(t){return n.getElementById(t)}).filter(function(t){return t!=null}).forEach(o.bind(i))}else{var a=n.getElementById(r);if(a){o.call(i,a)}}}})}return this};return new a});
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/DetailViewShape", ["sap/ui/base/DataType"],function(e){"use strict";var i={Box:"Box",Circle:"Circle",CircleLine:"CircleLine",CirclePointer:"CirclePointer",CircleArrow:"CircleArrow",CircleBubbles:"CircleBubbles",BoxLine:"BoxLine",BoxNoOutline:"BoxNoOutline",SolidPointer:"SolidPointer",SolidArrow:"SolidArrow"};e.registerEnum("sap.ui.vk.DetailViewShape",i);return i},true);
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/DetailViewType", ["sap/ui/base/DataType"],function(e){"use strict";var a={DetailView:"DetailView",Cutaway:"Cutaway"};e.registerEnum("sap.ui.vk.DetailViewType",a);return a},true);
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/DownloadManager", ["sap/ui/base/EventProvider","./Messages","./getResourceBundle","sap/base/Log"],function(e,t,s,r){"use strict";var i=e.extend("sap.ui.vk.DownloadManager",{metadata:{library:"sap.ui.vk",events:{itemSucceeded:{parameters:{source:{type:"any"},response:{type:"object"}}},itemProgress:{parameters:{source:{type:"any"},loaded:{type:"int"},total:{type:"int"}}},itemFailed:{parameters:{source:{type:"any"},status:{type:"any"},statusText:{type:"string"}}},allItemsCompleted:{}}},constructor:function(t,s,r,i){e.apply(this);this._maxParallelTasks=s||5;this._sourcesToProcess=t.slice();this._sourcesBeingProcessed=[];this._authorizationHandler=r;this._retryCount=i!==undefined?Math.max(i,0):1}});i.prototype.start=function(){while(this._pickAndDispatchTask()){}return this};i.prototype.queue=function(e){this._sourcesToProcess.push(e);this._pickAndDispatchTask();return this};i.prototype._pickAndDispatchTask=function(){if(this._sourcesToProcess.length>0&&this._sourcesBeingProcessed.length<this._maxParallelTasks){var e=this._sourcesToProcess.shift();this._sourcesBeingProcessed.push(e);var t=this;if(this._authorizationHandler){this._authorizationHandler(e).then(function(s){var r=null;if(s!=null){r=s.token_type+" "+s.access_token}var i=s?s.tenant_uuid:null;t._runTask(e,r,i)}).catch(function(s){t.fireItemFailed({source:e,status:0,statusText:s});t._taskFinished(e);if(t._queueIsEmpty()){t.fireAllItemsCompleted()}})}else{this._runTask(e)}return true}return false};i.prototype._taskFinished=function(e){var t=this._sourcesBeingProcessed.indexOf(e);if(t>=0){this._sourcesBeingProcessed.splice(t,1)}return this};i.prototype._queueIsEmpty=function(){return this._sourcesToProcess.length===0&&this._sourcesBeingProcessed.length===0};i.prototype._runTask=function(e,i,o){var a=this;if(typeof e==="string"){var n=this._retryCount;(function t(){var s=new XMLHttpRequest;s.onerror=function(i){if(s.status===0){if(n-- >0){r.info("Could not retrieve '"+e+"' due to network error.","Retrying ("+(a._retryCount-n)+" of "+a._retryCount+" attempts)...","sap.ui.vk.DownloadManager");t();return}}a._taskFinished(e);a._pickAndDispatchTask();a.fireItemFailed({source:e,status:s.status,statusText:s.statusText});if(a._queueIsEmpty()){a.fireAllItemsCompleted()}};s.onload=function(i){switch(s.status){case 408:case 425:case 429:case 500:case 502:case 503:case 504:if(n-- >0){r.info("Could not retrieve '"+e+"' as request failed with HTTP status "+s.status+": "+s.statusText,"Retrying ("+(a._retryCount-n)+" of "+a._retryCount+" attempts)...","sap.ui.vk.DownloadManager");t();return}break;default:break}a._taskFinished(e);a._pickAndDispatchTask();if(s.status===200||s.status===0){a.fireItemSucceeded({source:e,response:s.response})}else{a.fireItemFailed({source:e,status:s.status,statusText:s.statusText})}if(a._queueIsEmpty()){a.fireAllItemsCompleted()}};s.onprogress=function(t){a.fireItemProgress({source:e,loaded:t.loaded,total:t.total})};s.open("GET",e,true);s.responseType="arraybuffer";if(i){s.setRequestHeader("Authorization",i)}if(o){s.setRequestHeader("X-TenantUuid",o)}s.send(null)})()}else if(e instanceof File){var u=new FileReader;u.onload=function(t){a._taskFinished(e);a._pickAndDispatchTask();a.fireItemSucceeded({source:e,response:u.result});if(a._queueIsEmpty()){a.fireAllItemsCompleted()}};u.onerror=function(t){a._taskFinished(e);a._pickAndDispatchTask();a.fireItemFailed({source:e,status:u.error.name,statusText:u.error.message});if(a._queueIsEmpty()){a.fireAllItemsCompleted()}};u.onprogress=function(t){a.fireItemProgress({source:e.name,loaded:t.loaded,total:t.total})};u.readAsArrayBuffer(e)}else{r.error(s().getText(t.VIT5.summary),t.VIT5.code,"sap.ui.vk.DownloadManager")}return this};i.prototype.attachItemSucceeded=function(e,t,s){return this.attachEvent("itemSucceeded",e,t,s)};i.prototype.detachItemSucceeded=function(e,t){return this.detachEvent("itemSucceeded",e,t)};i.prototype.fireItemSucceeded=function(e,t,s){return this.fireEvent("itemSucceeded",e,t,s)};i.prototype.attachItemFailed=function(e,t,s){return this.attachEvent("itemFailed",e,t,s)};i.prototype.detachItemFailed=function(e,t){return this.detachEvent("itemFailed",e,t)};i.prototype.fireItemFailed=function(e,t,s){return this.fireEvent("itemFailed",e,t,s)};i.prototype.attachAllItemsCompleted=function(e,t,s){return this.attachEvent("allItemsCompleted",e,t,s)};i.prototype.detachAllItemsCompleted=function(e,t){return this.detachEvent("allItemsCompleted",e,t)};i.prototype.fireAllItemsCompleted=function(e,t,s){return this.fireEvent("allItemsCompleted",e,t,s)};i.prototype.attachItemProgress=function(e,t,s){return this.attachEvent("itemProgress",e,t,s)};i.prototype.detachItemProgress=function(e,t){return this.detachEvent("itemProgress",e,t)};i.prototype.fireItemProgress=function(e,t,s){return this.fireEvent("itemProgress",e,t,s)};return i});
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/DrawerToolbar", ["./library","./Core","sap/ui/core/library","sap/ui/core/Element","./DrawerToolbarRenderer","sap/ui/core/Control","sap/ui/core/IconPool","sap/ui/core/ResizeHandler","sap/ui/core/InvisibleText","sap/ui/Device","sap/m/VBox","sap/m/HBox","sap/m/FlexItemData","sap/m/OverflowToolbar","sap/ui/core/Icon","sap/m/OverflowToolbarButton","sap/m/Button","sap/m/Input","sap/m/Text","sap/m/ToolbarSeparator","sap/m/OverflowToolbarToggleButton","sap/m/OverflowToolbarMenuButton","./tools/RectSelectTool","./tools/CrossSectionTool","sap/m/Menu","sap/m/MenuItem","./NavigationMode","./ZoomTo","./getResourceBundle","./ToggleMenuButton","./ToggleMenuItem","./Viewport","./DrawerToolbarButton","sap/ui/base/ManagedObjectObserver","sap/ui/core/Core","./tools/HighlightMeasurementTool","./tools/CalibrateDistanceMeasurementTool","./tools/DeleteMeasurementTool","./tools/DistanceMeasurementTool","./tools/AngleMeasurementTool","./tools/AreaMeasurementTool","./thirdparty/three","sap/m/library"],function(e,t,i,o,n,s,a,r,l,u,c,g,h,_,d,m,p,T,f,v,I,w,b,P,x,E,M,S,y,V,B,O,C,R,A,D,N,F,z,L,k,U,W){"use strict";const H=W.ToolbarDesign;const G=W.ButtonType;const Z=W.FlexRendertype;const K=W.FlexAlignItems;const Q=W.FlexAlignContent;const X=i.TextAlign;const j=i.ValueState;const Y=W.InputType;var q=s.extend("sap.ui.vk.DrawerToolbar",{metadata:{library:"sap.ui.vk",properties:{expanded:{type:"boolean",defaultValue:true},navigationMode:{type:"sap.ui.vk.NavigationMode",defaultValue:M.Turntable}},aggregations:{content:{type:"sap.ui.core.Control",multiple:true,forwarding:{getter:"_getToolbar",aggregation:"content",forwardBinding:true}},_container:{type:"sap.m.VBox",multiple:false,visibility:"hidden"}},associations:{viewport:{type:"sap.ui.vk.ViewportBase",multiple:false}},events:{expanded:{parameters:{expand:{type:"boolean"}}}}},constructor:function(e,t){s.apply(this,arguments)}});var J=[{name:"show",unicode:"e900"},{name:"hide",unicode:"e901"},{name:"turntable",unicode:"e902"},{name:"orbit",unicode:"e903"},{name:"pan",unicode:"e904"},{name:"zoom",unicode:"e905"},{name:"fit-to-view",unicode:"e906"},{name:"rectangular-selection",unicode:"e907"},{name:"predefined-views",unicode:"e93c"},{name:"predefined-views-left",unicode:"e94b"},{name:"predefined-views-right",unicode:"e94c"},{name:"predefined-views-top",unicode:"e94d"},{name:"predefined-views-bottom",unicode:"e949"},{name:"predefined-views-front",unicode:"e94a"},{name:"predefined-views-back",unicode:"e948"},{name:"cross-section",unicode:"e913"},{name:"cross-section-x",unicode:"e914"},{name:"cross-section-y",unicode:"e916"},{name:"cross-section-z",unicode:"e915"},{name:"reverse-direction",unicode:"e917"},{name:"distance-measurement",unicode:"e92b"},{name:"angle-measurement",unicode:"e926"},{name:"area-measurement",unicode:"e963"},{name:"settings",unicode:"e909"},{name:"calibrate-distance",unicode:"e968"},{name:"toggle-pmi",unicode:"e96d"},{name:"fit-to-page",unicode:"e96e"},{name:"fit-to-width",unicode:"e96f"},{name:"flip-board-vertically",unicode:"e973"},{name:"flip-board-horizontally",unicode:"f976"},{name:"partially-visible-layer",unicode:"e974"},{name:"partially-visible-element",unicode:"f975"},{name:"rotate-board-cw",unicode:"e970"},{name:"rotate-board-ccw",unicode:"e971"}];var $="vk-icons";var ee="vk-icons";J.forEach(function(e){a.addIcon(e.name,$,ee,e.unicode)});var te="sap-icon://vk-icons/";q.prototype.init=function(){if(s.prototype.init){s.prototype.init.apply(this)}this._measurementsToggleButton=null;this._distanceMeasurementItem=null;this._angleMeasurementItem=null;this._areaMeasurementItem=null;this._deleteMeasurementItem=null;this._measurementSettingsItem=null;this._calibrateDistanceMeasurementItem=null;this._itemsVisibility=new Map;this._itemsVisibilityObserver=new R(this._itemVisibilityChanged.bind(this));this._toolbar=new _({asyncMode:true,width:"auto",design:H.Solid,layoutData:new h({growFactor:0,shrinkFactor:0}),content:this.createButtons()}).addStyleClass("drawerToolbarMaxWidth").data("help-id","sapUiVkToolbar",true);this._toolbar.ontouchstart=function(e){e.setMarked()};this._toolbarObserver=new R(this._toolbarContentChanged.bind(this));this._toolbarObserver.observe(this._toolbar,{aggregations:["content"]});this._container=new c({renderType:Z.Bare,alignContent:Q.Center,alignItems:K.Center,items:[this._toolbar,new d({src:"sap-icon://navigation-up-arrow",tooltip:this._getTooltip(),press:function(e){this._toggleExpanded();this._updateTooltip(e.getSource())}.bind(this),layoutData:new h({growFactor:0,shrinkFactor:0})}).addStyleClass("drawerToolbarIcon")]}).data("help-id","sapUiVkToolbarContainer",true);this.setAggregation("_container",this._container);this._rectSelectTool=new b;this._distanceMeasurementTool=new z({enabled:[function(e){if(this._measurementsToggleButton.getDefaultItem()===this._distanceMeasurementItem.getId()){this._measurementsToggleButton.setPressed(e.getParameter("enabled"))}},this]});this._angleMeasurementTool=new L({enabled:[function(e){if(this._measurementsToggleButton.getDefaultItem()===this._angleMeasurementItem.getId()){this._measurementsToggleButton.setPressed(e.getParameter("enabled"))}},this]});this._areaMeasurementTool=new k({enabled:[function(e){if(this._measurementsToggleButton.getDefaultItem()===this._areaMeasurementItem.getId()){this._measurementsToggleButton.setPressed(e.getParameter("enabled"))}},this]});this._deleteMeasurementTool=new F({enabled:[function(e){if(this._measurementsToggleButton.getDefaultItem()===this._deleteMeasurementItem.getId()){this._measurementsToggleButton.setPressed(e.getParameter("enabled"));if(this._getViewport().getMeasurementSurface().getMeasurements().length===0){this._measurementsToggleButton.setDefaultItem(this._distanceMeasurementItem)}}},this]});this._calibrateDistanceMeasurementTool=new N({enabled:[function(e){if(this._measurementsToggleButton.getDefaultItem()===this._calibrateDistanceMeasurementItem.getId()){var t=e.getParameter("enabled");this._measurementsToggleButton.setPressed(t);if(!t){this._measurementsToggleButton.setDefaultItem(this._distanceMeasurementItem)}}},this]});this._highlightMeasurementTool=new D;var e=[this._distanceMeasurementTool,this._angleMeasurementTool,this._areaMeasurementTool,this._deleteMeasurementTool,this._calibrateDistanceMeasurementTool];function i(t){var i=e.find(function(e){return e.getActive()});this._highlightMeasurementTool.setActive(i==null,this._getViewport())}e.forEach(function(e){e.attachEnabled(i,this)},this);var o=t.getEventBus();o.subscribe("sap.ui.vk","viewActivated",this._onViewActivated,this);o.subscribe("sap.ui.vk","readyForAnimation",this._onReadyForAnimation,this)};q.prototype.exit=function(){o.getElementById(this.getViewport())?.detachResize(this._onViewportResize,this);var e=t.getEventBus();e.unsubscribe("sap.ui.vk","readyForAnimation",this._onReadyForAnimation,this);e.unsubscribe("sap.ui.vk","viewActivated",this._onViewActivated,this);this._distanceMeasurementTool.destroy();this._distanceMeasurementTool=null;this._angleMeasurementTool.destroy();this._angleMeasurementTool=null;this._highlightMeasurementTool.destroy();this._highlightMeasurementTool=null;this._areaMeasurementTool.destroy();this._areaMeasurementTool=null;this._deleteMeasurementTool.destroy();this._deleteMeasurementTool=null;this._calibrateDistanceMeasurementTool.destroy();this._calibrateDistanceMeasurementTool=null;this._measurementsToggleButton=null;this._distanceMeasurementItem=null;this._angleMeasurementItem=null;this._areaMeasurementItem=null;this._deleteMeasurementItem=null;this._measurementSettingsItem=null;this._calibrateDistanceMeasurementItem=null;this._toolbarObserver.disconnect();this._toolbarObserver=null;this._toolbar.destroy();this._toolbar=null};q.prototype._onViewportResize=function(e){this._toolbar.onLayoutDataChange()};q.prototype.setViewport=function(e){o.getElementById(this.getViewport())?.detachResize(this._onViewportResize,this);this.setAssociation("viewport",e);e?.attachResize(this._onViewportResize,this);e?.attachEvent("documentReplaced",{},this._onDocumentReplaced,this);e?.attachEvent("pageChanged",{},this._onPageChanged,this)};q.prototype._onDocumentReplaced=function(e){this._pdfDocument=e.getParameter("newDocument");if(this._pdfDocument==null){this._pdfTotalPages=0;this._totalPageCountText.setText("0");this._currentPageIndexInput.setValue("");this._currentPageIndexInput.setEnabled(false);this._previousPageButton.setEnabled(false);this._nextPageButton.setEnabled(false);this._zoomInButton.setEnabled(false);this._zoomOutButton.setEnabled(false);this._zoomToFitPageButton.setEnabled(false);this._zoomToFitPageWidthButton.setEnabled(false)}else{this._pdfTotalPages=this._pdfDocument.pageCount;this._totalPageCountText.setText(`${this._pdfTotalPages}`);this._currentPageIndexInput.setEnabled(true);this._previousPageButton.setEnabled(this._pdfPageIndex!==0);this._nextPageButton.setEnabled(this._pdfPageIndex+1!==this._pdfTotalPages);this._zoomInButton.setEnabled(true);this._zoomOutButton.setEnabled(true);this._zoomToFitPageButton.setEnabled(true);this._zoomToFitPageWidthButton.setEnabled(true)}};q.prototype._onPageChanged=function(e){this._pdfPageIndex=e.getParameter("newPageIndex");this._invisPageIndex.setText(y().getText("PAGE_COUNT_INPUT",[this._pdfPageIndex+1,this._pdfTotalPages]));this._currentPageIndexInput.setValue(this._pdfPageIndex+1);this._currentPageIndexInput.setValueState(j.None);this._previousPageButton.setEnabled(this._pdfPageIndex!==0);this._nextPageButton.setEnabled(this._pdfPageIndex+1!==this._pdfTotalPages)};q.prototype._toolbarContentChanged=function(){var e=this._toolbar.getContent();for(var t=0;t<e.length;t++){if(e[t].getMetadata().getName()=="sap.m.ToolbarSeparator"){if(e[t-1]==undefined||e[t+1]==undefined||e[t-1].getMetadata().getName()=="sap.m.ToolbarSeparator"){this._toolbar.removeContent(t)}}}};q.prototype._itemVisibilityChanged=function(e){if(!this._ignoreVisibilityChange){this._itemsVisibility.set(e.object,e.current)}};function ie(e){return e?e.getMetadata().getName()==="sap.ui.vk.threejs.Viewport":false}function oe(e){return e?e.getMetadata().getName()==="sap.ui.vk.svg.Viewport":false}function ne(e){return e?e.getMetadata().getName()==="sap.ui.vk.NativeViewport":false}function se(e){return e?e.getMetadata().getName()==="sap.ui.vk.pdf.Viewport":false}function ae(e){return e?oe(e)&&e.isECAD():false}function re(e){var t=e.getCurrentView&&e.getCurrentView();var i=t&&t.getDimension();return ie(e)&&!e._redlineHandler&&!e._isPlanarActivated()&&i!==2}q.prototype._getViewport=function(){var e=o.getElementById(this.getViewport());e=e instanceof O&&e.getImplementation()||e;return e&&(ie(e)||oe(e)||ne(e)||se(e))?e:null};q.prototype._getViewStateManager=function(){var e=o.getElementById(this.getViewport());var t=e.getViewStateManager();if(t){return o.getElementById(t)}return null};var le=[null,(new U.Quaternion).setFromAxisAngle(new U.Vector3(0,1,0),0),(new U.Quaternion).setFromAxisAngle(new U.Vector3(0,1,0),Math.PI),(new U.Quaternion).setFromAxisAngle(new U.Vector3(0,1,0),-Math.PI/2),(new U.Quaternion).setFromAxisAngle(new U.Vector3(0,1,0),Math.PI/2),(new U.Quaternion).setFromAxisAngle(new U.Vector3(1,0,0),-Math.PI/2),(new U.Quaternion).setFromAxisAngle(new U.Vector3(1,0,0),Math.PI/2)];q.prototype.createButtons=function(){var e=this;var t=y();var i=new V({type:G.Transparent,tooltip:t.getText("CROSS_SECTION_TOOLTIP"),items:[new B({icon:te+"cross-section-x",text:t.getText("CROSS_SECTION_X"),key:0}),new B({icon:te+"cross-section-y",text:t.getText("CROSS_SECTION_Y"),key:1}),new B({icon:te+"cross-section-z",text:t.getText("CROSS_SECTION_Z"),key:2}),new B({icon:te+"reverse-direction",text:t.getText("CROSS_SECTION_REVERSE"),startsSection:true,toggleable:false,press:function(t){var i=e._getViewport();if(i&&e._crossSectionTool&&e._crossSectionTool.getActive()){e._crossSectionTool.setFlip(!e._crossSectionTool.getFlip())}}})],itemToggled:function(t){var i=e._getViewport();if(i&&e._crossSectionTool){var o=t.getParameter("newItem");e._crossSectionTool.setActive(o!=null,i);if(o){var n=parseInt(o.getKey(),10);if(n>=0&&n<3){e._crossSectionTool.setAxis(n)}}}}});i.vitId=C.CrossSection;var n=new I({icon:te+"turntable",type:G.Transparent,text:t.getText("TURNTABLE_TOOLTIP"),tooltip:t.getText("TURNTABLE_TOOLTIP"),press:function(t){e.setNavigationMode(M.Turntable)}});n.vitId=C.Turntable;var s=new I({icon:te+"orbit",type:G.Transparent,text:t.getText("ORBIT_TOOLTIP"),tooltip:t.getText("ORBIT_TOOLTIP"),pressed:false,press:function(t){e.setNavigationMode(M.Orbit)}});s.vitId=C.Orbit;var a=new I({icon:te+"pan",type:G.Transparent,text:t.getText("PAN_TOOLTIP"),tooltip:t.getText("PAN_TOOLTIP"),press:function(t){e.setNavigationMode(M.Pan)}});a.vitId=C.Pan;var r=new I({icon:te+"zoom",type:G.Transparent,text:t.getText("ZOOM_TOOLTIP"),tooltip:t.getText("ZOOM_TOOLTIP"),press:function(){e.setNavigationMode(M.Zoom)}});r.vitId=C.Zoom;this._gestureButtons=[n,s,a,r];var u=new m({icon:te+"show",type:G.Transparent,text:t.getText("SHOW_TOOLTIP"),tooltip:t.getText("SHOW_TOOLTIP"),press:function(){var t=e._getViewStateManager();if(t){var i=[];t.enumerateSelection(function(e){i.push(e)});t.setVisibilityState(i,true,false)}}});u.vitId=C.Show;var c=new m({icon:te+"hide",type:G.Transparent,text:t.getText("HIDE_TOOLTIP"),tooltip:t.getText("HIDE_TOOLTIP"),press:function(){var t=e._getViewStateManager();if(t){var i=[];t.enumerateSelection(function(e){i.push(e)});t.setVisibilityState(i,false,false)}}});c.vitId=C.Hide;this._fitToView=new m({icon:te+"fit-to-view",type:G.Transparent,text:t.getText("FIT_TO_VIEW"),tooltip:t.getText("FIT_TO_VIEW"),press:function(){var t=o.getElementById(e.getViewport());t=t instanceof O&&t.getImplementation()||t;if(t){t.zoomTo(S.All,null,.5,0)}}});this._fitToView.vitId=C.FitToView;this._fitToViewSeparator=new v;this._fitToViewSeparator.vitId=C.FitToViewSeparator;this._rectSelectionButton=new I({icon:te+"rectangular-selection",type:G.Transparent,text:t.getText("RECTANGULAR_SELECTION_TOOLTIP"),tooltip:t.getText("RECTANGULAR_SELECTION_TOOLTIP")});this._rectSelectionButton.vitId=C.RectangularSelection;var h=new w({icon:te+"predefined-views",activeIcon:te+"predefined-views",type:G.Transparent,text:t.getText("PREDEFINED_VIEW_MENUBUTTONTOOLTIP"),tooltip:t.getText("PREDEFINED_VIEW_MENUBUTTONTOOLTIP"),menu:new x({items:[new E({icon:te+"predefined-views",text:t.getText("PREDEFINED_VIEW_INITIAL")}),new E({icon:te+"predefined-views-front",text:t.getText("PREDEFINED_VIEW_FRONT"),startsSection:true}),new E({icon:te+"predefined-views-back",text:t.getText("PREDEFINED_VIEW_BACK")}),new E({icon:te+"predefined-views-left",text:t.getText("PREDEFINED_VIEW_LEFT")}),new E({icon:te+"predefined-views-right",text:t.getText("PREDEFINED_VIEW_RIGHT")}),new E({icon:te+"predefined-views-top",text:t.getText("PREDEFINED_VIEW_TOP")}),new E({icon:te+"predefined-views-bottom",text:t.getText("PREDEFINED_VIEW_BOTTOM")})]}).attachItemSelected(function(t){var i=e._getViewport();if(i){var o=t.getParameters("item").item;var n=this.indexOfItem(o);i._viewportGestureHandler.setView(le[n],1e3)}})});h.vitId=C.PredefinedViews;var _=new m({icon:"sap-icon://full-screen",type:G.Transparent,press:()=>{const e=this._getViewport();const t=e.getDomRef();if(document.fullscreenElement===t){document.exitFullscreen()}else{t.requestFullscreen()}}}).addStyleClass("sapUiVkFullScreenDrawerToolbarButton");_.vitId=C.FullScreen;_.getTooltip=()=>{const e=this._getViewport().getDomRef();if(document.fullscreenElement===e){return t.getText("EXIT_FULLSCREEN")}else{return t.getText("ENTER_FULLSCREEN")}};this._distanceMeasurementItem=new B({icon:te+"distance-measurement",text:t.getText("MEASUREMENTS_DISTANCE_MENUITEM")});this._angleMeasurementItem=new B({icon:te+"angle-measurement",text:t.getText("MEASUREMENTS_ANGLE_MENUITEM")});this._areaMeasurementItem=new B({icon:te+"area-measurement",text:t.getText("MEASUREMENTS_AREA_MENUITEM")});this._deleteMeasurementItem=new B({icon:"sap-icon://delete",text:t.getText("MEASUREMENTS_DELETE_MENUITEM")});this._calibrateDistanceMeasurementItem=new B({icon:te+"calibrate-distance",text:t.getText("MEASUREMENTS_CALIBRATE_DISTANCE_MENUITEM")});this._measurementSettingsItem=new B({startsSection:true,icon:te+"settings",text:t.getText("MEASUREMENTS_SETTINGS_MENUITEM"),toggleable:false});this._measurementsToggleButton=new V({type:G.Transparent,tooltip:t.getText("MEASUREMENTS_TOOLTIP"),items:[this._distanceMeasurementItem,this._angleMeasurementItem,this._areaMeasurementItem,this._deleteMeasurementItem,this._calibrateDistanceMeasurementItem,this._measurementSettingsItem],itemToggled:function(t){const i=e._getViewport();const o=t.getParameter("oldItem");const n=t.getParameter("newItem");const s=i.getMeasurementSurface();for(const e of s.getMeasurementsUnderConstruction()){s.cancelMeasurementConstruction(e)}if(o===e._distanceMeasurementItem){e._distanceMeasurementTool.setActive(false,i)}else if(o===e._angleMeasurementItem){e._angleMeasurementTool.setActive(false,i)}else if(o===e._areaMeasurementItem){e._areaMeasurementTool.setActive(false,i)}else if(o===e._deleteMeasurementItem){e._deleteMeasurementTool.setActive(false,i)}else if(o===e._calibrateDistanceMeasurementItem){e._calibrateDistanceMeasurementTool.setActive(false,i)}const a=i.getTools();let r;if(n===e._distanceMeasurementItem){r=e._distanceMeasurementTool}else if(n===e._angleMeasurementItem){r=e._angleMeasurementTool}else if(n===e._areaMeasurementItem){r=e._areaMeasurementTool}else if(n===e._deleteMeasurementItem){r=e._deleteMeasurementTool}else if(n===e._calibrateDistanceMeasurementItem){r=e._calibrateDistanceMeasurementTool}if(r!=null){if(a.indexOf(r.getId())<0){i.addTool(r)}r.setActive(true,i)}},itemSelected:function(t){var i=e._getViewport();var o=t.getParameter("item");if(o===e._measurementSettingsItem){e._distanceMeasurementTool.setActive(false,i);e._angleMeasurementTool.setActive(false,i);e._areaMeasurementTool.setActive(false,i);e._deleteMeasurementTool.setActive(false,i);e._calibrateDistanceMeasurementTool.setActive(false,i);e._distanceMeasurementTool.showSettingsDialog(i)}},beforeMenuOpen:function(){var t=e._getViewport();var i=t.getMeasurementSurface();var o=i.getMeasurements().length>0;e._deleteMeasurementItem.setEnabled(o);var n=i.getMeasurements().some(function(e){return e.isDistance});e._calibrateDistanceMeasurementItem.setEnabled(n)}});this._measurementsToggleButton.vitId=C.Measurements;this._zoomInButton=new m({icon:"sap-icon://zoom-in",tooltip:t.getText("ZOOM_IN_TOOLTIP"),enabled:false,press:()=>{const e=this._getViewport();const{left:t,top:i,right:o,bottom:n}=e.getDomRef("page").getBoundingClientRect();e.zoom(1.1,(t+o)/2,(i+n)/2)}});this._zoomInButton.vitId=C.ZoomIn;this._zoomOutButton=new m({icon:"sap-icon://zoom-out",tooltip:t.getText("ZOOM_OUT_TOOLTIP"),enabled:false,press:()=>{const e=this._getViewport();const{left:t,top:i,right:o,bottom:n}=e.getDomRef("page").getBoundingClientRect();e.zoom(1/1.1,(t+o)/2,(i+n)/2)}});this._zoomOutButton.vitId=C.ZoomOut;this._zoomToFitPageButton=new m({icon:te+"fit-to-page",tooltip:t.getText("FIT_TO_PAGE_TOOLTIP"),enabled:false,press:()=>this._getViewport().zoomToFitPage()});this._zoomToFitPageButton.vitId=C.FitToPage;this._zoomToFitPageWidthButton=new m({icon:te+"fit-to-width",tooltip:t.getText("FIT_TO_WIDTH_TOOLTIP"),enabled:false,press:()=>this._getViewport().zoomToFitPageWidth()});this._zoomToFitPageWidthButton.vitId=C.FitToWidth;this._previousPageButton=new m({type:G.Transparent,tooltip:t.getText("PREVIOUS_PAGE_TOOLTIP"),icon:"sap-icon://navigation-left-arrow",enabled:false,press:()=>{this._getViewport().setCurrentPageIndex(this._pdfPageIndex-1)}});this._nextPageButton=new m({type:G.Transparent,tooltip:t.getText("NEXT_PAGE_TOOLTIP"),icon:"sap-icon://navigation-right-arrow",enabled:false,press:()=>{this._getViewport().setCurrentPageIndex(this._pdfPageIndex+1)}});this._invisPageIndex=new l;this._currentPageIndexInput=new T({ariaLabelledBy:this._invisPageIndex,type:Y.Number,enabled:false,submit:e=>{const t=e.getParameter("value");if(t<1||t>this._pdfTotalPages){return}this._getViewport().setCurrentPageIndex(t-1)},liveChange:e=>{const t=e.getParameter("value");const i=t.replaceAll(".","");this._currentPageIndexInput.setValue(i);if(i<1||i>this._pdfTotalPages){this._currentPageIndexInput.setValueState(j.Error);this._currentPageIndexInput.setValueStateText(y().getText(i===""?"PAGE_COUNT_EMPTY":"PAGE_COUNT_ERROR",[i]))}else{this._currentPageIndexInput.setValueState(j.None)}}}).addStyleClass("sapVizKitPageGalleryToolbarCurrentPageIndex").addEventDelegate({onfocusout:()=>{const e=this._currentPageIndexInput.getValue();if(e<1||e>this._pdfTotalPages){return}this._getViewport().setCurrentPageIndex(e-1)}});const d=new f({text:"/",wrapping:false,textAlign:X.Center}).addStyleClass("sapVizKitPageGalleryToolbarSlash");this._totalPageCountText=new f({text:"0",wrapping:false});const p=new v;p.vitId=C.PageNavigationSeparator;this._pageNavigation=new g({renderType:Z.Bare,alignItems:"Center",items:[this._previousPageButton,this._invisPageIndex,this._currentPageIndexInput,d,this._totalPageCountText,this._nextPageButton]}).addStyleClass("sapVizKitPageGalleryPageNavigation");this.addEventDelegate({onAfterRendering:()=>{const e=this._currentPageIndexInput.getDomRef("inner");if(e!=null){const t=parseFloat(window.getComputedStyle(e).minWidth);this._currentPageIndexInput.setWidth(Math.max(t,this._totalPageCountText.getDomRef().offsetWidth+12)+"px")}}});this._pageNavigation.vitId=C.PageNavigation;this._measurementsSeparator=new v;this._measurementsSeparator.vitId=C.MeasurementsSeparator;this._togglePmiButton=new I({pressed:true,icon:te+"toggle-pmi",type:G.Transparent,text:t.getText("PMI_TOOLTIP"),tooltip:t.getText("PMI_TOOLTIP"),press:function(){var t=e._getViewport();if(t){t.setShowPMI(this.getPressed());t.setShouldRenderFrame()}}});this._togglePmiButton.vitId=C.PMI;this._togglePmiButtonSeparator=new v;this._togglePmiButtonSeparator.vitId=C.PMISeparator;var b=new m({type:G.Transparent,tooltip:t.getText("ROTATE_BOARD_CW"),icon:"sap-icon://vk-icons/rotate-board-cw",press:function(){if(ae(e._getViewport())){e._getViewport().rotatePcbCW()}}});b.vitId=C.RotateCW;var P=new m({type:G.Transparent,tooltip:t.getText("ROTATE_BOARD_CCW"),icon:"sap-icon://vk-icons/rotate-board-ccw",press:function(){if(ae(e._getViewport())){e._getViewport().rotatePcbCCW()}}});P.vitId=C.RotateCCW;var R=new m({type:G.Transparent,tooltip:t.getText("FLIP_BOARD"),icon:"sap-icon://vk-icons/flip-board-horizontally",press:function(){if(ae(e._getViewport())){e._getViewport().flipPcb()}}});R.vitId=C.Flip;var A=new v;A.vitId=C.EcadSeparator;var D=new v;D.vitId=C.CrossSectionSeparator;var N=new v;N.vitId=C.PredefinedViewsSeparator;var F=new v;F.vitId=C.ShowHideSeparator;this._rectSelectSeparator=new v;this._rectSelectSeparator.vitId=C.RectangularSelectionSeparator;this._itemsShowHideSelect=[u,c,F,this._rectSelectionButton,this._rectSelectSeparator];this._itemTurntable=this._gestureButtons[0];this._itemPan=this._gestureButtons[2];this._itemZoom=this._gestureButtons[3];this._pdfItems=[this._zoomInButton,this._zoomOutButton,this._zoomToFitPageButton,this._zoomToFitPageWidthButton,p,this._pageNavigation];this._items3D=[this._gestureButtons[1],i,D,h,N];this._gestureButtonsSeparator=new v;this._gestureButtonsSeparator.vitId=C.GestureButtonsSeparator;var z=[u,c,F,this._togglePmiButton,this._togglePmiButtonSeparator,this._gestureButtons[0],this._gestureButtons[1],this._gestureButtons[2],this._gestureButtons[3],this._gestureButtonsSeparator,this._measurementsToggleButton,this._measurementsSeparator,P,b,R,A,this._fitToView,this._fitToViewSeparator,this._rectSelectionButton,this._rectSelectSeparator,i,D,h,N,_,this._zoomInButton,this._zoomOutButton,this._zoomToFitPageButton,this._zoomToFitPageWidthButton,p,this._pageNavigation];this._notPdfItems=[r,this._gestureButtonsSeparator,this._fitToViewSeparator,this._togglePmiButton,this._togglePmiButtonSeparator,this._measurementsSeparator,this._measurementsToggleButton,this._fitToView,this._fitToViewSeparator,this._rectSelectionButton,this._rectSelectSeparator,_];this._ecadItems=[P,b,R,A];this._notEcadItems=[this._togglePmiButton,this._togglePmiButtonSeparator,this._gestureButtons[0],this._gestureButtons[1],this._measurementsToggleButton,this._measurementsSeparator,i,D,h,N,this._zoomInButton,this._zoomOutButton,this._zoomToFitPageButton,this._zoomToFitPageWidthButton,p,this._pageNavigation];z.forEach(function(e){this._itemsVisibility.set(e,true);this._itemsVisibilityObserver.observe(e,{properties:["visible"]})}.bind(this));return z};var ue=["drawerToolbarIconTurntable","drawerToolbarIconOrbit","drawerToolbarIconPan","drawerToolbarIconZoom"];var ce=function(e,t){this.viewport=e;this._toolbar=t;this._mode=1;this._gesture=false;this._x=0;this._y=0};function ge(e,t){ue.forEach(function(i,o){if(e.hasStyleClass(i)&&o!==t){e.removeStyleClass(i)}else if(o===t){e.addStyleClass(i)}})}function he(e){var t=e.viewport;var i=e._mode;var o=t.hasStyleClass(ue[i])?i:-1;e._isScrolling=true;if(o!==3){ge(t,3);setTimeout(function(){e._isScrolling=false;ge(t,o)},500)}}ce.prototype.beginGesture=function(e){this._gesture=true;if(this._mode<3){this._x=e.points[0].x;this._y=e.points[0].y}else{this._x=e.x;this._y=e.y}if(e.scroll){he(this)}if(this._toolbar._rectSelectionButton.getPressed()||e.event&&(u.os.macintosh?e.event.metaKey:e.event.ctrlKey)){var t=this.viewport.getDomRef().getBoundingClientRect();this._selectionRect={x1:this._x-t.left,y1:this._y-t.top,x2:this._x-t.left,y2:this._y-t.top}}};ce.prototype.endGesture=function(){this._gesture=false;if(this._selectionRect&&(this._selectionRect.x1!==this._selectionRect.x2||this._selectionRect.y1!==this._selectionRect.y2)){this._toolbar._rectSelectTool._select(this._selectionRect.x1,this._selectionRect.y1,this._selectionRect.x2,this._selectionRect.y2,this.viewport,this.viewport.getScene(),this.viewport.getCamera());this._selectionRect=null;this.viewport.setSelectionRect(null)}else if(!this._isScrolling){ge(this.viewport,-1)}};ce.prototype.move=function(e){if(this._gesture){if(e.n==1){var t=e.points[0];if(this._selectionRect){var i=this.viewport.getDomRef().getBoundingClientRect();this._selectionRect.x2=t.x-i.left;this._selectionRect.y2=t.y-i.top;this.viewport.setSelectionRect(this._selectionRect)}else{ge(this.viewport,this._mode);var o=t.x-this._x;var n=t.y-this._y;switch(this._mode){case 0:this.viewport.rotate(o,n,true);break;case 1:this.viewport.rotate(o,n,false);break;case 2:this.viewport.pan(o,n);break;case 3:this.viewport.zoom(1+n*.005);break;default:break}this._x=t.x;this._y=t.y}e.handled=true}else if(!(ie(this.viewport)&&this.viewport._isPanoramicActivated())&&e.n==2&&!this._isScrolling){ge(this.viewport,2)}else if(ie(this.viewport)&&this.viewport._isPanoramicActivated()&&e.n==2&&!this._isScrolling){ge(this.viewport,0)}}};ce.prototype.hover=function(){};ce.prototype.getViewport=function(){return this.viewport};q.prototype.setNavigationMode=function(e){if(!e||e===M.NoChange){e=this.getNavigationMode()}var t=this._getViewport();if(t){if(!re(t)){if(e!==M.Pan&&e!==M.Zoom){e=M.Pan}}else if(ie(t)&&t._isPanoramicActivated()){if(e!==M.Turntable&&e!==M.Zoom){e=M.Turntable}}}this.setProperty("navigationMode",e,true);var i=[M.Turntable,M.Orbit,M.Pan,M.Zoom].indexOf(e);this._gestureButtons.forEach(function(e,t){e.setPressed(t===i)});if(t!=null&&!t.isA("sap.ui.vk.pdf.Viewport")){if(!this._cameraHandler||this._cameraHandler.getViewport()!==t){this._cameraHandler=new ce(t,this);t._loco?.addHandler(this._cameraHandler,0)}this._cameraHandler._mode=i}};q.prototype._getToolbar=function(){return this._toolbar};q.prototype._getTooltip=function(){return y().getText(this.getExpanded()?"COLLAPSE_TOOLTIP":"EXPAND_TOOLTIP")};q.prototype._updateTooltip=function(e){e.setTooltip(this._getTooltip())};q.prototype._toggleExpanded=function(){var e=!this.getExpanded();this.setExpanded(e);this.fireExpanded({expand:e})};q.prototype.setExpanded=function(e){this.setProperty("expanded",e,true);var t=this.getDomRef();if(t){if(!e){t.classList.add("drawerToolbarCollapsed");t.classList.remove("drawerToolbarExpanded");this._container.addStyleClass("vboxCollapsed")}else{t.classList.add("drawerToolbarExpanded");t.classList.remove("drawerToolbarCollapsed");this._container.removeStyleClass("vboxCollapsed")}}return this};q.prototype._onViewActivated=function(e,t,i){if(i&&i.view&&i.source&&i.source===this._getViewport()){this.invalidate()}};q.prototype._onReadyForAnimation=function(e,t,i){var o=this._getViewport();if(i?.view&&i.source&&i.source===o?._getViewStateManagerThreeJS?.()){this.invalidate()}};q.prototype.onBeforeRendering=function(){var e=this._getViewport();this._container.setVisible(!!e);if(e){var t=re(e);var i=ie(e)&&e._isPanoramicActivated();var o=ne(e);var n=se(e);var s=ae(e);this._ignoreVisibilityChange=true;this._itemsShowHideSelect.forEach(function(e){e.setVisible(!o&&!n&&this._itemsVisibility.get(e))}.bind(this));this._itemTurntable.setVisible(t&&this._itemsVisibility.get(this._itemTurntable));this._itemPan.setVisible(!i&&!n&&this._itemsVisibility.get(this._itemPan));this._items3D.forEach(function(e){e.setVisible(t&&!i&&this._itemsVisibility.get(e))}.bind(this));this._pdfItems.forEach(e=>{e.setVisible(n&&this._itemsVisibility.get(e))});this._notPdfItems.forEach(e=>{e.setVisible(!n&&this._itemsVisibility.get(e))});this._ecadItems.forEach(e=>e.setVisible(s&&this._itemsVisibility.get(e)));if(s){this._notEcadItems.forEach(e=>e.setVisible(false))}this._ignoreVisibilityChange=false;if(t&&!i){this._crossSectionTool=this._crossSectionTool||new P;e.addTool(this._crossSectionTool)}this.setNavigationMode(M.NoChange)}};q.prototype.setPageNavigationEnabled=function(e){this._previousPageButton.setEnabled(e);this._currentPageIndexInput.setEnabled(e);this._nextPageButton.setEnabled(e)};return q});
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/DrawerToolbarButton", ["sap/ui/base/DataType"],function(e){"use strict";var a={CrossSection:"VIT-Cross-Section",CrossSectionSeparator:"VIT-Cross-Section-Separator",Turntable:"VIT-Turntable",Orbit:"VIT-Orbit",Pan:"VIT-Pan",Zoom:"VIT-Zoom",GestureButtonsSeparator:"VIT-Gesture-Buttons-Separator",Show:"VIT-Show",Hide:"VIT-Hide",ShowHideSeparator:"VIT-Show-Hide-Separator",FitToView:"VIT-Fit-To-View",FitToViewSeparator:"VIT-Fit-To-View-Separator",RectangularSelection:"VIT-Rectangular-Selection",RectangularSelectionSeparator:"VIT-Rectangular-Selection-Separator",PredefinedViews:"VIT-Predefined-Views",PredefinedViewsSeparator:"VIT-Predefined-Views-Separator",FullScreen:"VIT-Fullscreen",Measurements:"VIT-Measurements",MeasurementsSeparator:"VIT-Measurements-Separator",PMI:"VIT-PMI",PMISeparator:"VIT-PMI-Separator",ZoomIn:"VIT-Zoom-In",ZoomOut:"VIT-Zoom-Out",FitToPage:"VIT-Fit-To-Page",FitToWidth:"VIT-Fit-To-Width",PageNavigationSeparator:"VIT-Page-Navigation-Separator",PageNavigation:"VIT-Page-Navigation",RotateCW:"VIT-Rotate-CW",RotateCCW:"VIT-Rotate-CCW",Flip:"VIT-Flip",EcadSeparator:"VIT-ECAD-Separator"};e.registerEnum("sap.ui.vk.DrawerToolbarButton",a);return a});
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/DrawerToolbarRenderer", [],function(){"use strict";var e={apiVersion:2};e.render=function(e,r){e.openStart("div",r);e.class("drawerToolbar");if(!r.getExpanded()){e.class("drawerToolbarCollapsed")}else{e.class("drawerToolbarExpanded")}e.openEnd();e.renderControl(r._container);e.close("div")};return e},true);
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/DvlException", ["sap/ui/base/Exception"],function(e){"use strict";var t=function(e,t){this.name="DvlException";this.code=e;this.message=t};t.prototype=Object.create(e.prototype);return t});
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/FlexibleControl", ["./library","sap/ui/core/Control","sap/ui/core/EnabledPropagator","./FlexibleControlRenderer"],function(e,t,a,r){"use strict";var o=t.extend("sap.ui.vk.FlexibleControl",{metadata:{library:"sap.ui.vk",properties:{width:{type:"sap.ui.core.CSSSize",group:"Dimension",defaultValue:null},height:{type:"sap.ui.core.CSSSize",group:"Dimension",defaultValue:null},layout:{type:"string",group:"Behavior",defaultValue:"Stacked"},enabled:{type:"boolean",group:"Behavior",defaultValue:true}},defaultAggregation:"content",aggregations:{content:{type:"sap.ui.core.Control",multiple:true,singularName:"content"}},designTime:true}});a.call(o.prototype);return o});
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/FlexibleControlLayoutData", ["sap/ui/core/LayoutData"],function(e){"use strict";var i=e.extend("sap.ui.vk.FlexibleControlLayoutData",{metadata:{library:"sap.ui.vk",properties:{size:{type:"sap.ui.core.CSSSize",group:"Dimension",defaultValue:"auto"},minSize:{type:"sap.ui.core.CSSSize",group:"Dimension",defaultValue:"0px"},marginTop:{type:"sap.ui.core.CSSSize",group:"Dimension",defaultValue:"0px"},marginBottom:{type:"sap.ui.core.CSSSize",group:"Dimension",defaultValue:"0px"}}}});return i});
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/FlexibleControlRenderer", [],function(){"use strict";var t={apiVersion:2};t.render=function(t,e){var i=t;i.openStart("div",e);i.class("sapUiFlexControl");if(e.getWidth()&&e.getWidth()!=""){i.style("width",e.getWidth())}if(e.getHeight()&&e.getHeight()!=""){i.style("height",e.getHeight())}i.openEnd();var g=e.getContent();var a=e.getLayout();var n="sapUiFlexCellStacked";if(a=="Vertical"){n="sapUiFlexCellVertical"}for(var r=0;r<g.length;r++){var o=g[r];i.openStart("div");i.attr("id",e.getId()+"Content_"+r);i.class(n);var l=o.getLayoutData();if(l&&a!="Stacked"){if(l.getSize()&&l.getSize()!=""){i.style("height",l.getSize())}if(l.getMinSize()&&l.getMinSize()!=""){i.style("min-height",l.getMinSize())}if(l.getMarginTop()&&l.getMarginTop()!=""){i.style("margin-top",l.getMarginTop())}if(l.getMarginBottom()&&l.getMarginBottom()!=""){i.style("margin-bottom",l.getMarginBottom())}}i.openEnd();i.renderControl(o);i.close("div")}i.close("div")};return t},true);
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/Highlight", ["sap/ui/base/Object"],function(t){"use strict";var i=t.extend("sap.ui.vk.Highlight",{constructor:function(t,i){this._id=t;this._name=i&&i.name?i.name:"";this._duration=i&&i.duration?i.duration:0;this._cycles=i&&i.cycles?i.cycles:0;this._colours=i?.colours??[];this._opacities=i?.opacities??[];this._type=i?.type}});function s(t,i){const s=t%i/i;return s<.5?s*2:2-s*2}i.prototype.evaluate=function(t){const i={isCompleted:true};let o=1;if(this._duration>0){if(this._cycles>0&&t>=this._duration*this._cycles){o=s(this._duration*this._cycles,this._duration)}else{o=s(t,this._duration);i.isCompleted=false}}if(this._opacities?.length>0){if(o>=1||this._opacities.length<2){i.opacity=this._opacities[0]}else if(o<=0){i.opacity=this._opacities[1]}else{i.opacity=this._opacities[0]*o+this._opacities[1]*(1-o)}}if(this._colours?.length>0){if(o>=1||this._colours.length<2){i.color=this._colours[0]}else if(o<=0){i.color=this._colours[1]}else{i.color=[this._colours[0][0]*o+this._colours[1][0]*(1-o),this._colours[0][1]*o+this._colours[1][1]*(1-o),this._colours[0][2]*o+this._colours[1][2]*(1-o),this._colours[0][3]*o+this._colours[1][3]*(1-o)]}}return i};i.prototype.isFadeInOut=function(){return this._type?.startsWith("Fade")===true};i.prototype.isFadeOut=function(){return this._type==="FadeOut"};return i});
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/HighlightDisplayState", [],function(){"use strict";var n=function(){};n.playing="playing";n.pausing="pausing";n.stopped="stopped";return n});
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/ImageContentManager", ["./Messages","./ContentManager","./getResourceBundle","sap/m/Image"],function(e,t,n,i){"use strict";var s=t.extend("sap.ui.vk.ImageContentManager",{metadata:{library:"sap.ui.vk"}});var o=s.getMetadata().getParent().getClass().prototype;s.prototype.init=function(){if(o.init){o.init.call(this)}this._handleLoadSucceededProxy=this._handleLoadSucceeded.bind(this);this._handleLoadFailedProxy=this._handleLoadFailed.bind(this)};s.prototype.exit=function(){if(o.exit){o.exit.call(this)}};s.prototype.loadContent=function(e,t){if(t.length!==1){setTimeout(function(){this.fireContentChangesStarted();this.fireContentChangesFinished({content:null,failureReason:{errorMessage:n().getText("IMAGECONTENTMANAGER_ONLY_LOAD_SINGLE_IMAGE")}})}.bind(this),0)}else if(t[0].getContentResources().length>0){setTimeout(function(){this.fireContentChangesStarted();this.fireContentChangesFinished({content:null,failureReason:{errorMessage:n().getText("IMAGECONTENTMANAGER_CANNOT_LOAD_IMAGE_HIERARCHY")}})}.bind(this),0)}else{var s=t[0],o=s.getSource(),r=s.getSourceType(),a=null;if(s._contentManagerResolver&&s._contentManagerResolver.settings&&s._contentManagerResolver.settings.loader){a=s._contentManagerResolver.settings.loader}if(o instanceof File){var d=new FileReader;d.onload=function(t){this._loadImageFromUrl(e,d.result,r,a)}.bind(this);d.readAsDataURL(o)}else{var l=new i({src:o});o=l.getSrc();l.destroy();this._loadImageFromUrl(e,o,r,a)}}};s.prototype._addEventListeners=function(e){e.addEventListener("load",this._handleLoadSucceededProxy);e.addEventListener("error",this._handleLoadFailedProxy)};s.prototype._removeEventListeners=function(e){e.removeEventListener("error",this._handleLoadFailedProxy);e.removeEventListener("load",this._handleLoadSucceededProxy)};s.prototype._addSvgQuirks=function(e){e.style.setProperty("visibility","collapse");e.style.setProperty("width","0");e.style.setProperty("height","0");e.style.setProperty("position","absolute");document.body.appendChild(e);return this};s.prototype._removeSvgQuirks=function(e){e.parentElement.removeChild(e);e.style.removeProperty("visibility");e.style.removeProperty("width");e.style.removeProperty("height");e.style.removeProperty("position");return this};s.prototype._loadImageFromUrl=function(e,t,i,s){this.fireContentChangesStarted();switch(i.toLowerCase()){case"svg":var o=document.createElement("object");this._addEventListeners(o);o.type="image/svg+xml";o.data=t;o.className="SVGImage";this._addSvgQuirks(o);break;case"jpg":case"jpeg":case"png":case"gif":case"bmp":case"tif":case"tiff":var r=document.createElement("img");this._addEventListeners(r);if(s){var a=this;s(t).then(function(e){r.src=e},function(e){a.fireContentChangesFinished({content:null,failureReason:{errorMessage:e}})})}else{r.src=t}break;default:setTimeout(function(){this.fireContentChangesFinished({content:null,failureReason:{errorMessage:n().getText("IMAGECONTENTMANAGER_UNSUPPORTED_IMAGE_TYPE"),sourcesFailedToDownload:[{source:t}]}})}.bind(this),0);break}};s.prototype._handleLoadSucceeded=function(e){var t=e.target;this._removeEventListeners(t);if(t instanceof HTMLObjectElement){this._removeSvgQuirks(t)}this.fireContentChangesFinished({content:t})};s.prototype._handleLoadFailed=function(e){var t=e.target;this._removeEventListeners(t);if(t instanceof HTMLObjectElement){this._removeSvgQuirks(t)}this.fireContentChangesFinished({content:null,failureReason:{errorMessage:n().getText("IMAGECONTENTMANAGER_IMAGE_LOAD_FAILED"),sourcesFailedToDownload:[{source:t instanceof HTMLImageElement?t.src:t.data}]}})};return s});
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/IncludeUsageIdType", ["sap/ui/base/DataType"],function(e){"use strict";var r=e.createType("sap.ui.vk.IncludeUsageIdType",{isValid:function(e){if(typeof e==="boolean"){return true}if(typeof e==="string"){return e.trim().length>0}if(Array.isArray(e)){return e.every(function(e){return typeof e==="string"&&e.trim().length>0})}return false}},e.getType("any"));r.to$expandQueryParameter=function(e){function r(e){e=e.replaceAll("'","''");return e.indexOf(".")!==-1||e.indexOf(",")!==-1?"'"+e+"'":e}if(Array.isArray(e)){return e.map(function(e){return"usageId."+r(e)})}else if(typeof e==="string"){return["usageId."+r(e)]}else if(e){return["usageId"]}else{return[]}};return r},true);
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/JointUtils", ["./glMatrix"],function(e){"use strict";var n=e.mat4;var t=e.glMatrix.ARRAY_TYPE;var a={recalculateJoints:function(e,a,r){var i;if(r.length===16){i=r}else{i=new t(16);n.fromRotationTranslationScale(i,r.quaternion||[0,0,0,1],r.translation||[0,0,0],r.scale||[1,1,1])}var l=new t(16);n.invert(l,i);var o=new t(16);var s=[];e.forEach(function(e){if(!e.node||!e.parent){return}if(e.parent===a){n.multiply(o,l,e.node.matrixWorld.elements)}else if(e.node===a){n.invert(o,e.parent.matrixWorld.elements);n.multiply(o,o,i)}else{return}n.getTranslation(e.translation,o);n.getScaling(e.scale,o);n.scale(o,o,[1/e.scale[0],1/e.scale[1],1/e.scale[2]]);n.getRotation(e.quaternion,o);s.push(e)});return s}};return a});
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/LayerProxy", ["sap/ui/base/Object"],function(a){"use strict";var e=a.extend("sap.ui.vk.LayerProxy",{metadata:{library:"sap.ui.vk",abstract:true}});return e});
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/LeaderLineMarkStyle", ["sap/ui/base/DataType"],function(e){"use strict";var r={None:"None",Point:"Point",Arrow:"Arrow"};e.registerEnum("sap.ui.vk.LeaderLineMarkStyle",r);return r},true);
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/LegendItem", ["sap/m/StandardListItem","./LegendItemRenderer"],function(e,a){"use strict";var t=e.extend("sap.ui.vk.LegendItem",{metadata:{library:"sap.ui.vk",properties:{color:{type:"sap.ui.core.CSSColor",group:"Appearance",defaultValue:null},semanticSpotType:{type:"sap.ui.vbm.SemanticType",group:"Behavior",defaultValue:null}},aggregations:{}}});return t});
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/LegendItemRenderer", ["sap/m/StandardListItemRenderer","sap/ui/core/Renderer"],function(e,a){"use strict";var i=a.extend(e);i.apiVersion=2;i.renderLIContent=function(a,i){var r=i.getColor();var s=i.getSemanticSpotType();var n=null;if(r){a.openStart("span");a.class("sapUiVkLegendItemSquare");a.style("background-color",r);a.openEnd();a.close("span")}if(s){switch(s){case sap.ui.vbm.SemanticType.Error:n=sap.ui.require.toUrl("sap/ui/vbm/themes/base/img/Pin_Red.png");break;case sap.ui.vbm.SemanticType.Warning:n=sap.ui.require.toUrl("sap/ui/vbm/themes/base/img/Pin_Orange.png");break;case sap.ui.vbm.SemanticType.Success:n=sap.ui.require.toUrl("sap/ui/vbm/themes/base/img/Pin_Green.png");break;case sap.ui.vbm.SemanticType.Default:n=sap.ui.require.toUrl("sap/ui/vbm/themes/base/img/Pin_Blue.png");break;case sap.ui.vbm.SemanticType.Inactive:n=sap.ui.require.toUrl("sap/ui/vbm/themes/base/img/Pin_Grey.png");break;default:break}if(n){i.addStyleClass("sapUiVkLegendItemSpotType");i.setIcon(n)}}e.renderLIContent(a,i)};return i},true);
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/ListPanel", ["./library","./ListPanelRenderer","sap/ui/core/Control","sap/m/library","sap/m/ListBase","sap/m/Panel","sap/m/Toolbar","sap/m/Title","sap/m/Button"],function(e,t,o,i,s,r,n,a,d){"use strict";var p=o.extend("sap.ui.vk.ListPanel",{metadata:{library:"sap.ui.vk",properties:{headerText:{type:"string",group:"Misc"},headerIcon:{type:"sap.ui.core.URI",group:"Misc"},expanded:{type:"boolean",group:"Misc",defaultValue:true},expandAnimation:{type:"boolean",group:"Misc",defaultValue:true},selectionMode:{type:"sap.m.ListMode",group:"Misc",defaultValue:sap.m.ListMode.MultiSelect}},aggregations:{items:{type:"sap.m.ListItemBase",multiple:true,singularName:"item"},panel:{type:"sap.m.Panel",multiple:false,visibility:"hidden"}},events:{headerIconPress:{},expand:{},selectionChange:{parameters:{listItem:{type:"sap.m.ListItemBase"},listItems:{type:"sap.m.ListItemBase[]"},selected:{type:"boolean"}}},itemPress:{parameters:{listItem:{type:"sap.m.ListItemBase"},srcControl:{type:"sap.ui.core.Control"}}}}}});p.prototype.getSelectedItem=function(){return this._oList.getSelectedItem()};p.prototype.setSelectedItem=function(e,t,o){this._oList.setSelectedItem(e,t,o)};p.prototype.getSelectedItems=function(){return this._oList.getSelectedItems()};p.prototype.init=function(){this._oList=new s({mode:this.getSelectionMode(),itemPress:this.fireItemPress.bind(this),selectionChange:this.fireSelectionChange.bind(this)});this._oPanel=new r({expandable:true,expanded:true,expandAnimation:true,headerToolbar:new n({active:false}),content:[this._oList],expand:this.fireExpand.bind(this)});this._oPanel.getHeaderToolbar().addStyleClass("sapUiVkLPTb");this.setAggregation("panel",this._oPanel,true);this._oHeaderIcon=null;this._oHeaderText=null;this._bHeaderToolbarChanged=true};p.prototype.exit=function(){this._destroyControl(this._oList);this._destroyControl(this._oPanel);this._destroyControl(this._oHeaderIcon);this._destroyControl(this._oHeaderText)};p.prototype.getItems=function(){return this._oList.getItems()};p.prototype.addItem=function(e){return this._oList.addItem(e)};p.prototype.insertItem=function(e,t){return this._oList.insertItem(e,t)};p.prototype.removeItem=function(e){return this._oList.removeItem(e)};p.prototype.removeAllItems=function(){return this._oList.removeAllItems()};p.prototype.setHeaderText=function(e){if(!this._oHeaderText){this._oHeaderText=new a}this._oHeaderText.setText(e);this._bHeaderToolbarChanged=true;if(this._oHeaderIcon){this._oHeaderIcon.setTooltip(e);this._oHeaderIcon.addAriaLabelledBy(this._oHeaderText);this._oHeaderIcon.addAriaDescribedBy(this._oHeaderText)}return this.setProperty("headerText",e)};p.prototype.getExpanded=function(){return this._oPanel.getExpanded()};p.prototype.setExpanded=function(e){return this._oPanel.setExpanded(e)};p.prototype.getExpandAnimation=function(){return this._oPanel.getExpandAnimation()};p.prototype.setExpandAnimation=function(e){return this._oPanel.setExpandAnimation(e)};p.prototype.setHeaderIcon=function(e){if(!this._oHeaderIcon){this._oHeaderIcon=new d({press:this.fireHeaderIconPress.bind(this),type:sap.m.ButtonType.Transparent,tooltip:this.getHeaderText()})}this._oHeaderIcon.setIcon(e);this._bHeaderToolbarChanged=true;if(this._oHeaderText){this._oHeaderIcon.addAriaLabelledBy(this._oHeaderText)}return this.setProperty("headerIcon",e)};p.prototype.setSelectionMode=function(e){this._oList.setMode(e);return this.setProperty("selectionMode",e)};p.prototype.onBeforeRendering=function(){if(this._bHeaderToolbarChanged){var e=this._oPanel.getHeaderToolbar();e.removeAllContent();if(this._oHeaderIcon){e.addContent(this._oHeaderIcon)}if(this._oHeaderText){e.addContent(this._oHeaderText)}this._bHeaderToolbarChanged=false}};p.prototype._destroyControl=function(e){if(e){e.destroy();e=undefined}};return p});
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/ListPanelRenderer", function(){"use strict";var e={apiVersion:2};e.render=function(e,n){var r=n._oPanel;r.addStyleClass("sapUiVkListPanel");e.openStart("div",n);e.attr("role",sap.ui.core.AccessibleRole.Presentation);e.openEnd();e.renderControl(r);e.close("div")};return e},true);
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/ListPanelStack", ["./library","sap/ui/core/Control","sap/ui/layout/library","sap/ui/layout/VerticalLayout","./ListPanelStackRenderer"],function(t,e,o,n,a){"use strict";var i=e.extend("sap.ui.vk.ListPanelStack",{metadata:{library:"sap.ui.vk",properties:{width:{type:"sap.ui.core.CSSSize",group:"Misc",defaultValue:"100%"},expanded:{type:"boolean",group:"Misc",defaultValue:true},expandAnimation:{type:"boolean",group:"Misc",defaultValue:true},collapsible:{type:"boolean",group:"Misc",defaultValue:true}},aggregations:{content:{type:"sap.ui.vk.ListPanel",multiple:true,singularName:"content"},layout:{type:"sap.ui.layout.VerticalLayout",multiple:false,visibility:"hidden"}}}});i.prototype.init=function(){this._oLayout=new n;this._oLayout.addStyleClass("sapUiVkLPSTrans");this.setAggregation("layout",this._oLayout,true);this._bFirstTime=true};i.prototype.exit=function(){if(this._oLayout){this._oLayout.destroy();this._oLayout=undefined}};i.prototype.getContent=function(){return this._oLayout.getContent()};i.prototype.addContent=function(t){t.attachExpand(this._onContentExpand.bind(this));t.attachHeaderIconPress(this._onContentHeaderIconPress.bind(this));return this._oLayout.addContent(t)};i.prototype.removeContent=function(t){return this._oLayout.removeContent(t)};i.prototype.insertContent=function(t,e){return this._oLayout.insertContent(t,e)};i.prototype.removeAllContent=function(){return this._oLayout.removeAllContent()};i.prototype.getWidth=function(){return this._oLayout.getWidth()};i.prototype.setWidth=function(t){this.setProperty("width",t,true);return this._oLayout.setWidth(t)};i.prototype.setExpanded=function(t){if(t!=this.getExpanded()){if(t){this._expand()}else{this._collapse()}}return this};i.prototype.setExpandAnimation=function(t){this._oLayout.removeStyleClass("sapUiVkLPSTrans");if(t){this._oLayout.addStyleClass("sapUiVkLPSTrans")}return this.setProperty("expandAnimation",t,true)};i.prototype.onBeforeRendering=function(){if(this._bFirstTime){var t=false;var e=this.getContent();for(var o=0;o<e.length;++o){if(e[o].getExpanded()){t=true}}this.setExpanded(t);this._bFirstTime=false}};i.prototype.onAfterRendering=function(){if(!this.getExpanded()){this._updateCollapsedLayoutWidth()}};i.prototype._onContentExpand=function(t){var e=false;var o=this._oLayout.getContent();for(var n=0;n<o.length;++n){if(o[n].getExpanded()){e=true}}this.setExpanded(e)};i.prototype._onContentHeaderIconPress=function(t){var e=t.oSource.getExpanded()?false:true;t.oSource.setExpanded(e);var o=false;var n=this._oLayout.getContent();for(var a=0;a<n.length;++a){if(n[a].getExpanded()){o=true;break}}this.setExpanded(o)};i.prototype._expand=function(){this._oLayout.removeStyleClass("sapUiVkLPSCollapse");this._oLayout.setWidth(this.getProperty("width"));this.setProperty("expanded",true,true)};i.prototype._collapse=function(){if(!this.getCollapsible()){return}var t=this.getContent();for(var e=0;e<t.length;++e){t[e].setExpanded(false)}this._oLayout.addStyleClass("sapUiVkLPSCollapse");this._updateCollapsedLayoutWidth();this.setProperty("expanded",false,true)};i.prototype._updateCollapsedLayoutWidth=function(){if(this._oLayout.$().closest(".sapUiSizeCompact").length===0){this._oLayout.setWidth("3rem")}else{this._oLayout.setWidth("2.5rem")}};return i});
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/ListPanelStackRenderer", function(){"use strict";var e={apiVersion:2};e.render=function(e,t){t._oLayout.addStyleClass("sapUiVkListPanelStack");e.renderControl(t._oLayout)};return e},true);
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/Loco", ["sap/ui/thirdparty/jquery","sap/ui/base/Object"],function(jQuery,t){"use strict";const e=250;const i=0;const n=1;const s=2;const o=4;const h=8;const r=16;const c=t.extend("sap.ui.vk.Loco",{metadata:{library:"sap.ui.vk"},constructor:function(e){if(c._instance&&this.viewport===e){return c._instance}t.apply(this);this._handlers=[];this._gesture=false;this._n=0;this._touchStart=0;this._touchOrigin={x:0,y:0};this._touchMoved=false;this._clickTimer=0;this._clickFunc=null;if(e){this._attachViewportEventHandlers(e)}c._instance=this;return this}});c.prototype.destroy=function(){if(this._clickTimer>0){clearTimeout(this._clickTimer);this._clickTimer=0;this._clickFunc=null}this._handlers.length=0;this._detachViewportEventHandlers()};function u(t){const e=[];const n={points:e,buttons:t.buttons??i,handled:false,passEvent:false,event:t,timeStamp:t.timeStamp,scroll:t.wheelDelta};if(t.touches?.length>0){for(const i of t.touches){e.push({x:i.pageX,y:i.pageY})}}else if(t.pageX!=null){e.push({x:t.pageX,y:t.pageY})}else{e.push({x:t.originalEvent.pageX,y:t.originalEvent.pageY})}if(t.buttons&s&&e.length===1){e.push(e[0])}const{x:o,y:h}=e[0];n.n=e.length;if(n.n===2){const{x:t,y:i}=e[1];const s=o-t;const r=h-i;n.x=(o+t)*.5;n.y=(h+i)*.5;n.d=Math.sqrt(s*s+r*r)}else{n.x=o;n.y=h;n.d=0}return n}c.prototype._attachViewportEventHandlers=function(t){this.viewport=t;t.addEventDelegate(this);if(sap.ui.Device.support.touch){t.attachBrowserEvent("touchmove",this._onpointermove,this)}t.attachBrowserEvent("mousemove",this._onpointermove,this);t.attachBrowserEvent(sap.ui.Device.browser.firefox?"DOMMouseScroll":"mousewheel",this._onscroll,this)};c.prototype._detachViewportEventHandlers=function(){const t=this.viewport;if(t==null){return}t.detachBrowserEvent(sap.ui.Device.browser.firefox?"DOMMouseScroll":"mousewheel",this._onscroll,this);t.detachBrowserEvent("mousemove",this._onpointermove,this);if(sap.ui.Device.support.touch){t.detachBrowserEvent("touchmove",this._onpointermove,this)}t.removeEventDelegate(this);this.viewport=null};c.prototype.ontouchstart=function(t){if(!t.isMarked()){const e=u(t);if(this._gesture){this._endGesture(e);e.handled=false}this._beginGesture(e)}};c.prototype.ontouchend=function(t){const e=u(t);if(e.buttons!==i){const t=jQuery(document);const e=t=>{this._move(u(t))};const i=n=>{this._endGesture(u(n));t.off("mousemove",e);t.off("mouseup",i)};t.on("mousemove",e);t.on("mouseup",i);return}this._endGesture(e);if(t.touches.length>0){e.handled=false;this._beginGesture(e)}};c.prototype.ontap=function(t){if(!t.isMarked()&&!this._touchMoved){const i=u(t);if(this._clickTimer>0){this._click(i,true)}else{this._clickFunc=this._click.bind(this,i,false);this._clickTimer=setTimeout(this._clickFunc,e)}}};c.prototype.oncontextmenu=function(t){this._contextMenu(u(t))};c.prototype.onkeyup=function(t){this._keyEventHandler(t)};c.prototype._onpointermove=function(t){this._move(u(t))};c.prototype._onscroll=function(t){if(!t.isMarked()){const{originalEvent:e,buttons:i}=t;let n=e.detail?e.detail*-40:e.wheelDelta;if(!e.touches){n=Math.min(Math.max(n,-20),20)}const s={x:e.pageX,y:e.pageY,d:0,buttons:i,scroll:n,n:2,points:[{x:e.pageX,y:e.pageY},{x:e.pageX,y:e.pageY}],handled:false,passEvent:false,timeStamp:t.timeStamp};this._beginGesture(s);s.points[0].y-=n*.2;s.points[1].y+=n*.2;s.d=Math.pow(2,n/640);s.handled=false;this._move(s);s.handled=false;this._endGesture(s);if(s.handled){t.setMarked();if(!s.passEvent){t.preventDefault()}}}};c.prototype.addHandler=function(t,e){if(this.viewport==null){this._attachViewportEventHandlers(t.getViewport())}t.priority=e??0;const i=this._handlers;if(!i.includes(t)){i.push(t)}i.sort((t,e)=>t.priority-e.priority);return this};c.prototype.removeHandler=function(t){const e=this._handlers.indexOf(t);if(e>=0){this._handlers.splice(e,1)}return this};c.prototype._handleInput=function(t,e){const i=this._handlers;for(let n=i.length-1;n>=0&&!e.handled;n--){i[n][t]?.(e)}if(e.handled&&e.event&&!e.passEvent){e.event.preventDefault()}};c.prototype._beginGesture=function(t){this._handleInput("beginGesture",t);this._touchStart=t.timeStamp;this._touchMoved=false;this._gesture=true;this._touchOrigin.x=t.x;this._touchOrigin.y=t.y;this._n=t.n};c.prototype._move=function(t){this._clickFunc?.();if(this._gesture&&this._n===t.n){if(!this._touchMoved){this._touchMoved=t.timeStamp-this._touchStart>200&&(Math.abs(this._touchOrigin.x-t.x)>3||Math.abs(this._touchOrigin.y-t.y)>3)}this._handleInput("move",t)}else{this._handleInput("hover",t)}};c.prototype._endGesture=function(t){if(!this._gesture){return}this._handleInput("endGesture",t);this._gesture=false};c.prototype._click=function(t,e){if(this._clickTimer>0){clearTimeout(this._clickTimer);this._clickTimer=0;this._clickFunc=null}this._handleInput(e?"doubleClick":"click",t)};c.prototype._contextMenu=function(t){this._handleInput("contextMenu",t)};c.prototype._keyEventHandler=function(t){this._handleInput("keyEventHandler",t)};return c});
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/MapContainer", ["./ContainerBase","sap/ui/core/IconPool","sap/ui/vbm/lib/sapvbi","sap/ui/Device","sap/ui/model/json/JSONModel","sap/ui/layout/VerticalLayout","./MapContainerRenderer","./MapContainerButtonType","./getResourceBundle","sap/m/Toolbar","sap/m/ScrollContainer","sap/m/Button","sap/m/ToggleButton","sap/m/OverflowToolbarLayoutData","sap/m/Text","sap/m/HBox","sap/m/Popover","sap/m/Image"],function(t,e,o,n,i,a,s,r,p,l,c,u,h,d,m,f,y,v){"use strict";var _=t.extend("sap.ui.vk.MapContainer",{metadata:{library:"sap.ui.vk",properties:{showNavbar:{type:"boolean",group:"Misc",defaultValue:true},showHome:{type:"boolean",group:"Misc",defaultValue:true},showMapLayer:{type:"boolean",group:"Misc",defaultValue:true},showRectangularZoom:{type:"boolean",group:"Misc",defaultValue:true},showZoom:{type:"boolean",group:"Misc",defaultValue:true}},aggregations:{listPanelStack:{type:"sap.ui.vk.ListPanelStack",multiple:false},scrollCont:{type:"sap.m.ScrollContainer",multiple:false,visibility:"hidden"}},associations:{},events:{}}});_.prototype.init=function(){t.prototype.init.apply(this,arguments);var e=new i;e.setData({rectZoom:false});this.setModel(e,"rectZoom");this._oNavbar=new l({width:"auto"});this._oScrollCont=new c({horizontal:false,vertical:true,focusable:false});this.setAggregation("scrollCont",this._oScrollCont,true);this._oHomeButton=new u({icon:"sap-icon://home",type:sap.m.ButtonType.Transparent,tooltip:p().getText("MAPCONTAINER_HOME"),press:this._onNavbarHome.bind(this)});this._oRectZoomButton=new h({icon:"sap-icon://draw-rectangle",type:sap.m.ButtonType.Transparent,pressed:"{rectZoom>/rectZoom}",tooltip:p().getText("MAPCONTAINER_RECT_ZOOM")}).setModel(e,"rectZoom");this._oZoomInButton=new u({icon:"sap-icon://add",type:sap.m.ButtonType.Transparent,tooltip:p().getText("MAPCONTAINER_ZOOMIN"),press:this._onNavbarZoomIn.bind(this)});this._oZoomOutButton=new u({icon:"sap-icon://less",type:sap.m.ButtonType.Transparent,tooltip:p().getText("MAPCONTAINER_ZOOMOUT"),press:this._onNavbarZoomOut.bind(this)});if(n.system.phone){this._oMenuOpenButton=new u({layoutData:new d({priority:sap.m.OverflowToolbarPriority.NeverOverflow}),icon:"sap-icon://menu2",type:sap.m.ButtonType.Transparent,tooltip:p().getText("CONTAINERBASE_MENU"),press:function(){this._bSegmentedButtonSaveSelectState=true;this._showListPanelStack()}.bind(this),visible:false});this._oMenuCloseButton=new u({type:sap.m.ButtonType.Transparent,icon:"sap-icon://nav-back",press:function(){this._bSegmentedButtonSaveSelectState=true;this._hideListPanelStack()}.bind(this)})}this.addStyleClass("sapUiVkMapContainer")};_.prototype.exit=function(){if(this._oNavbar){this._oNavbar.destroy();this._oNavbar=undefined}if(this._oScrollCont){this._oScrollCont.destroy();this._oScrollCont=undefined}t.prototype.exit.apply(this,arguments)};_.prototype.getListPanelStack=function(){return this._oScrollCont.getContent()[0]};_.prototype.setListPanelStack=function(t){if(n.system.phone){t.setCollapsible(false);t.setWidth("100%");this._oMenuOpenButton.setVisible(true)}this._oScrollCont.removeAllContent();return this._oScrollCont.addContent(t)};_.prototype.onBeforeRendering=function(){t.prototype.onBeforeRendering.apply(this,arguments);this._oNavbar.removeAllContent();this._shouldRenderMapLayerSwitch=false;var e=this.getSelectedContent();if(e!==null){var o=e.getContent();this._isInstanceGeoAnalytic=o instanceof sap.ui.vbm.GeoMap||o instanceof sap.ui.vbm.AnalyticMap;if(this._isInstanceGeoAnalytic){if(this.getShowHome()){this._oNavbar.addContent(this._oHomeButton)}if(!n.system.phone&&this.getShowRectangularZoom()){this._oNavbar.addContent(this._oRectZoomButton)}if(this.getShowZoom()){this._oNavbar.addContent(this._oZoomInButton);this._oNavbar.addContent(this._oZoomOutButton)}this._shouldRenderListPanel=true}else{this._shouldRenderListPanel=false}this._isSupportingMapLayerSwitch=o instanceof sap.ui.vbm.GeoMap&&!(o instanceof sap.ui.vbm.AnalyticMap);if(this._isSupportingMapLayerSwitch&&o.getMapConfiguration()!==null&&this.getShowMapLayer()){var i=o.getMapConfiguration();var a=[].concat(i.MapLayerStacks);if(a.length>1){this._currentText=(new m).addStyleClass("mapLayerSelectedText");this.addDependent(this._currentText);this._box=(new f).addStyleClass("mapContainerHboxPopover");this._popover=new y({enableScrolling:false,placement:sap.m.PlacementType.Horizontal,content:this._box,showHeader:false});this._selectionMap=new v({press:function(t){if(this._popover.isOpen()){this._popover.close()}else{this._popover.openBy(this._selectionMap)}}.bind(this)}).addStyleClass("mapLayerPopoverItem");this.addDependent(this._selectionMap);this._shouldRenderMapLayerSwitch=true}}}};_.prototype.onAfterRendering=function(){if(n.system.phone){var e=document.getElementById(this.getId()+"-LPW");this.getDomRef().appendChild(e)}t.prototype.onAfterRendering.apply(this,arguments);if(this._shouldRenderMapLayerSwitch){var o=this.getSelectedContent().getContent();var i=o.getMapConfiguration();var s=[].concat(i.MapLayerStacks);var r=o.mVBIContext.GetMainScene();s.forEach(function(t){var e=o.mVBIContext.m_MapLayerStackManager.GetMapLayerStack(t.name);var n=new v({alt:t.name,press:function(i){this._popover.close();this._currentText.setText(t.name);this._selectionMap.setAlt(t.name);o.setRefMapLayerStack(t.name);if(n.getSrc()){this._selectionMap.setSrc(n.getSrc())}else{r.GetPreviewImage(e,function(t){this._selectionMap.setSrc(t.src)}.bind(this))}}.bind(this)}).addStyleClass("layerType");r.GetPreviewImage(e,function(t){n.setSrc(t.src)});var i=new m({text:t.name}).addStyleClass("mapLayerPopoverItemText");var s=new a;s.addContent(n);s.addContent(i);this._box.addItem(s)},this);this._currentText.setText(o.getRefMapLayerStack());this._selectionMap.setAlt(o.getRefMapLayerStack());r.GetPreviewImage(r.m_MapLayerStack,function(t){this._selectionMap.setSrc(t.src)}.bind(this))}};_.prototype.setToolbarItem=function(t){if(!t||!t.id){return null}var e;for(var o=0;o<this._customButtons.length;++o){if(t.id===this._customButtons[o].id){e=this._customButtons[o];e.index=o;this._customButtons.splice(o,1);break}}if(!e){e={id:t.id,visible:true,active:true,index:this._customButtons.length,type:r.Click}}if("index"in t){e.index=t.index}if("visible"in t){e.visible=t.visible}if("overflow"in t){e.overflow=t.overflow}if("active"in t){e.active=t.active}if("text"in t){e.text=t.text}if("tooltip"in t){e.tooltip=t.tooltip}if("icon"in t){e.icon=t.icon}if("activeIcon"in t){e.activeIcon=t.activeIcon}if("press"in t){e.press=t.press}if("toggled"in t){e.toggled=t.toggled;if(e.button){e.button.setPressed(t.toggled)}}if("type"in t){e.type=t.type}if(e.index>this._customButtons.length){e.index=this._customButtons.length}else if(e.index<0){e.index=0}this._customButtons.splice(e.index,0,e);this.invalidate();return e};_.prototype.setSelectedContent=function(e){var o;if(this._oSelectedContent){if((o=this._oSelectedContent.getContent())instanceof sap.ui.vbm.GeoMap){o.unbindProperty("rectZoom","rectZoom>/rectZoom")}}t.prototype.setSelectedContent.apply(this,arguments);var n=this._oSelectedContent.getContent();if(n instanceof sap.ui.vbm.GeoMap){n.bindProperty("rectZoom","rectZoom>/rectZoom")}};_.prototype._addToolbarContent=function(){if(n.system.phone){this._oToolbar.addContent(this._oMenuOpenButton)}t.prototype._addToolbarContent.apply(this,arguments)};_.prototype._onNavbarZoomIn=function(t){var e=this.getSelectedContent().getContent();if(e.getZoomlevel&&e.setZoomlevel&&e.setEnableAnimation){e.setEnableAnimation(true);e.setZoomlevel(e.getZoomlevel()+1)}};_.prototype._onNavbarZoomOut=function(t){var e=this.getSelectedContent().getContent();if(e.getZoomlevel&&e.setZoomlevel&&e.setEnableAnimation){e.setEnableAnimation(true);e.setZoomlevel(e.getZoomlevel()-1)}};_.prototype._onNavbarHome=function(t){var e=this.getSelectedContent().getContent();if(e.goToStartPosition){e.goToStartPosition()}};_.prototype._showListPanelStack=function(){jQuery("#"+this.getId()+"-LPW").addClass("sapUiVkMapContainerLPWIn");jQuery("#"+this.getId()+"-wrapper").addClass("sapUiVkMapContainerMapOut")};_.prototype._hideListPanelStack=function(){jQuery("#"+this.getId()+"-LPW").removeClass("sapUiVkMapContainerLPWIn");jQuery("#"+this.getId()+"-wrapper").removeClass("sapUiVkMapContainerMapOut")};return _});
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/MapContainerButtonType", ["sap/ui/base/DataType"],function(e){"use strict";var i={Click:"Click",Toggle:"Toggle"};e.registerEnum("sap.ui.vk.MapContainerButtonType",i);return i},true);
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/MapContainerRenderer", ["./ContainerBaseRenderer","sap/ui/core/Renderer","sap/ui/Device"],function(e,r,o){"use strict";var a=r.extend(e);a.apiVersion=2;a.writeToolbarArea=function(r,a){r.openStart("div");r.class("sapUiVkMapContainerOverlay");r.attr("role",sap.ui.core.AccessibleRole.Presentation);r.openEnd();if(a.getShowNavbar()){r.openStart("div");r.class("sapUiVkMapContainerNavbarArea");r.attr("role",sap.ui.core.AccessibleRole.Presentation);r.openEnd();if(a.getShowMapLayer()&&a._shouldRenderMapLayerSwitch){r.renderControl(a._currentText);r.renderControl(a._selectionMap)}r.openStart("div");r.class("sapUiVkMapContainerNavbarContainer");r.attr("role",sap.ui.core.AccessibleRole.Navigation);r.openEnd();r.renderControl(a._oNavbar);r.close("div");r.close("div")}if(!o.system.phone&&a._shouldRenderListPanel){a._oScrollCont.addStyleClass("sapUiVkMapContainerListPanelArea");r.renderControl(a._oScrollCont)}e.writeToolbarArea(r,a);r.close("div");if(o.system.phone){r.openStart("div");r.attr("id",a.getId()+"-LPW");r.class("sapUiVkMapContainerLPW");r.openEnd();r.renderControl(a._oMenuCloseButton);a._oScrollCont.addStyleClass("sapUiVkMapContainerListPanelArea");r.renderControl(a._oScrollCont);r.close("div")}};return a},true);
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/Material", ["sap/ui/base/Object"],function(t){"use strict";var e=t.extend("sap.ui.vk.Material",{metadata:{library:"sap.ui.vk",abstract:true}});e.prototype.getName=function(){return this._name};e.prototype.setName=function(t){this._name=t;return this};e.prototype.getAmbientColour=function(){return this._ambientColour??"rgba(0, 0, 0, 1)"};e.prototype.setAmbientColour=function(t){this._ambientColour=t??"rgba(0, 0, 0, 1)";return this};e.prototype.getDiffuseColour=function(){return this._diffuseColour??"rgba(0, 0, 0, 1)"};e.prototype.setDiffuseColour=function(t){this._diffuseColour=t??"rgba(0, 0, 0, 1)";return this};e.prototype.getSpecularColour=function(){return this._specularColour??"rgba(0, 0, 0, 1)"};e.prototype.setSpecularColour=function(t){this._specularColour=t??"rgba(0, 0, 0, 1)";return this};e.prototype.getEmissiveColour=function(){return this._emissiveColour??"rgba(0, 0, 0, 1)"};e.prototype.setEmissiveColour=function(t){this._emissiveColour=t??"rgba(0, 0, 0, 1)";return this};e.prototype.getOpacity=function(){return this._opacity??1};e.prototype.setOpacity=function(t){this._opacity=t??1;return this};e.prototype.getGlossiness=function(){return this._opacity??0};e.prototype.setGlossiness=function(t){this._glossiness=t??0;return this};e.prototype.getLineColour=function(){return this._lineColour??"rgba(0, 0, 0, 1)"};e.prototype.setLineColour=function(t){this._lineColour=t??"rgba(0, 0, 0, 1)";return this};e.prototype.getLineWidth=function(){return this._lineWidth??0};e.prototype.setLineWidth=function(t){this._lineWidth=t??0;return this};e.prototype.getTextureDiffuse=function(){return this._textureDiffuse};e.prototype.setTextureDiffuse=function(t){this._textureDiffuse=t;return this};e.prototype.getTextureBump=function(){return this._textureBump};e.prototype.setTextureBump=function(t){this._textureBump=t;return this};e.prototype.getTextureOpacity=function(){return this._textureOpacity};e.prototype.setTextureOpacity=function(t){this._textureOpacity=t;return this};e.prototype.getTextureReflection=function(){return this._textureReflection};e.prototype.setTextureReflection=function(t){this._textureReflection=t;return this};e.prototype.getTextureEmissive=function(){return this._textureEmissive};e.prototype.setTextureEmissive=function(t){this._textureEmissive=t;return this};e.prototype.getTextureAmbientOcclusion=function(){return this._textureAmbientOcclusion};e.prototype.setTextureAmbientOcclusion=function(t){this._textureAmbientOcclusion=t;return this};return e});
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/Messages", [],function(){"use strict";var E={VIT1:{summary:"NATIVEVIEWPORT_MSG_NOTBELOADED_SUMMARY",cause:"NATIVEVIEWPORT_MSG_NOTBELOADED_NOTFOUND_CAUSE",resolution:"NATIVEVIEWPORT_MSG_NOTBELOADED_NOTFOUND_CHECKEXISTS_RESOLUTION",code:"VIT1"},VIT2:{summary:"NATIVEVIEWPORT_MSG_NOTBELOADED_SUMMARY",cause:"NATIVEVIEWPORT_MSG_NOTBELOADED_NOTFOUND_CAUSE",resolution:"NATIVEVIEWPORT_MSG_NOTBELOADED_NOTFOUND_CHECKEXISTS_RESOLUTION",code:"VIT2"},VIT3:{summary:"NATIVEVIEWPORT_MSG_NOTBELOADED_SUMMARY",cause:"NATIVEVIEWPORT_MSG_NOTBELOADED_UNSUPPORTEDFILEFORMAT_CAUSE",resolution:"NATIVEVIEWPORT_MSG_NOTBELOADED_UNSUPPORTEDFILEFORMAT_CHECKFILEFORMAT_RESOLUTION",code:"VIT3"},VIT4:{summary:"NATIVEVIEWPORT_MSG_NOTBELOADED_SUMMARY",cause:"NATIVEVIEWPORT_MSG_NOTBELOADED_UNSUPPORTEDFILEFORMAT_CAUSE",resolution:"NATIVEVIEWPORT_MSG_NOTBELOADED_UNSUPPORTEDFILEFORMAT_CHECKFILEFORMAT_RESOLUTION",code:"VIT4"},VIT5:{summary:"DOWNLOADMANAGER_MSG_NOTBELOADED_SUMMARY",cause:"DOWNLOADMANAGER_MSG_NOTBELOADED_VALUESOURCEUNSUPPORTED_CAUSE",resolution:"DOWNLOADMANAGER_MSG_NOTBELOADED_VALUESOURCEUNSUPPORTED_CHECKSOURCEISURLORFILE_RESOLUTION",code:"VIT5"},VIT6:{summary:"NODEHIERARCHY_MSG_COULDNOTSEARCHNODES_SUMMARY",cause:"NODEHIERARCHY_MSG_COULDNOTSEARCHNODES_INVALIDQUERY_CAUSE",resolution:"NODEHIERARCHY_MSG_COULDNOTSEARCHNODES_INVALIDQUERY_SPECIFYVALUEPROPERTY_RESOLUTION",code:"VIT6"},VIT7:{summary:"NODEHIERARCHY_MSG_COULDNOTSEARCHNODES_SUMMARY",cause:"NODEHIERARCHY_MSG_COULDNOTSEARCHNODES_PREDICATENOTSPECIFIED_CAUSE",resolution:"NODEHIERARCHY_MSG_COULDNOTSEARCHNODES_PREDICATENOTSPECIFIED_SPECIFYPREDICATE_RESOLUTION",code:"VIT7"},VIT8:{summary:"NODEHIERARCHY_MSG_COULDNOTSEARCHNODES_SUMMARY",cause:"NODEHIERARCHY_MSG_COULDNOTSEARCHNODES_INCORRECTPREDICATEVALUE_CAUSE",resolution:"NODEHIERARCHY_MSG_COULDNOTSEARCHNODES_INCORRECTPREDICATEVALUE_INVALIDPREDICATE_RESOLUTION",code:"VIT8"},VIT9:{summary:"NODEHIERARCHY_MSG_COULDNOTSEARCHNODES_SUMMARY",cause:"NODEHIERARCHY_MSG_COULDNOTSEARCHNODES_INCORRECTPREDICATEVALUE_CAUSE",resolution:"NODEHIERARCHY_MSG_COULDNOTSEARCHNODES_INCORRECTPREDICATEVALUE_INVALIDPREDICATE_RESOLUTION",code:"VIT9"},VIT10:{summary:"NODEHIERARCHY_MSG_COULDNOTSEARCHNODES_SUMMARY",cause:"NODEHIERARCHY_MSG_COULDNOTSEARCHNODES_NOMETADATASPECIFIED_CAUSE",resolution:"NODEHIERARCHY_MSG_COULDNOTSEARCHNODES_NOMETADATASPECIFIED_SPECIFYMETADATACATEGORY_RESOLUTION",code:"VIT10"},VIT11:{summary:"OVERLAY_MSG_EVENTHANDLERFAILED_SUMMARY",cause:"OVERLAY_MSG_EVENTHANDLERFAILED_UNSUPPORTEDEVENTTYPE_CAUSE",resolution:"OVERLAY_MSG_EVENTHANDLERFAILED_UNSUPPORTEDEVENTTYPE_CHECKEVENTTYPE_RESOLUTION",code:"VIT11"},VIT12:{summary:"STEPNAVIGATION_MSG_STEPCOULDNOTBEPLAYED_SUMMARY",cause:"STEPNAVIGATION_MSG_STEPCOULDNOTBEPLAYED_INCORRECTSTEPEVENTTYPE_CAUSE",resolution:"STEPNAVIGATION_MSG_STEPCOULDNOTBEPLAYED_INCORRECTSTEPEVENTTYPE_CHECKSTEPEVENTTYPEVALUE_RESOLUTION",code:"VIT12"},VIT13:{summary:"VIEWER_MSG_CONTENTRESOURCESNOTLOADED_SUMMARY",cause:"VIEWER_MSG_CONTENTRESOURCESNOTLOADED_NONEXISTINGORUNSUPPORTEDFILE_CAUSE",resolution:"VIEWER_MSG_CONTENTRESOURCESNOTLOADED_NONEXISTINGORUNSUPPORTEDFILE_CHECKFILEEXISTSANDIFSUPPORT_RESOLUTION",code:"VIT13"},VIT14:{summary:"VIEWER_MSG_FAILEDTOBUILDSCENE_SUMMARY",cause:"VIEWER_MSG_FAILEDTOBUILDSCENE_COULDNOTCREATESCENE_CAUSE",resolution:"VIEWER_MSG_FAILEDTOBUILDSCENE_COULDNOTCREATESCENE_RELOADORSELECTANOTHERFILE_RESOLUTION",code:"VIT14"},VIT15:{summary:"VIEWER_MSG_ERRORLOADINGMULTIPLEFILES_SUMMARY",cause:"VIEWER_MSG_ERRORLOADINGMULTIPLEFILES_LOADINGMULTIPLE2DNOTSUPPORTED_CAUSE",resolution:"VIEWER_MSG_ERRORLOADINGMULTIPLEFILES_LOADINGMULTIPLE2DNOTSUPPORTED_LOADONE2D_RESOLUTION",code:"VIT15"},VIT16:{summary:"VIEWER_MSG_NOTBELOADED_SUMMARY",cause:"VIEWER_MSG_NOTBELOADED_NONATIVESUPPORT_CAUSE",resolution:"VIEWER_MSG_NOTBELOADED_NONATIVESUPPORT_CHECKFILEFORMATSUPPORT_RESOLUTION",code:"VIT16"},VIT17:{summary:"VIEWER_MSG_ERRORLOADINGMULTIPLEFILES_SUMMARY",cause:"VIEWER_MSG_ERRORLOADINGMULTIPLEFILES_COMBINATIONOF2D3DNOTSUPPORTED_CAUSE",resolution:"VIEWER_MSG_ERRORLOADINGMULTIPLEFILES_COMBINATIONOF2D3DNOTSUPPORTED_MULTIPLESUPPORTFOR3DONLY_RESOLUTION",code:"VIT17"},VIT19:{summary:"VIEWPORT_MSG_COULDNOTSETCAMERAPROJECTION_SUMMARY",cause:"VIEWPORT_MSG_COULDNOTSETCAMERAPROJECTION_SPECIFIEDCAMERAPROJECTIONNOTSUPPORTED_CAUSE",resolution:"VIEWPORT_MSG_COULDNOTSETCAMERAPROJECTION_SPECIFIEDCAMERAPROJECTIONNOTSUPPORTED_CHECKPROJECTIONTYPESUPPORTED_RESOLUTION",code:"VIT19"},VIT20:{summary:"DOWNLOADMANAGER_MSG_VDS4_BETA_WARNING_SUMMARY",cause:"DOWNLOADMANAGER_MSG_VDS4_BETA_WARNING_CAUSE",resolution:"DOWNLOADMANAGER_MSG_VDS4_BETA_WARNING_RESOLUTION",code:"VIT20"},VIT21:{summary:"VIEWER_MSG_FAILEDTOBUILDSCENE_SUMMARY",cause:"VIEWER_MSG_FAILEDTOBUILDSCENE_MISSINGPASSWORD_CAUSE",resolution:"VIEWER_MSG_FAILEDTOBUILDSCENE_MISSINGPASSWORD_PROVIDEPASSWORD_RESOLUTION",code:"VIT21"},VIT22:{summary:"GRAPHICSCORE_MSG_VDSL_NOFILEPROPERTY_SUMMARY",cause:"GRAPHICSCORE_MSG_VDSL_EMPTY_CAUSE",resolution:"GRAPHICSCORE_MSG_VDSL_FIRSTLINE_WRONGFORMAT_RESOLUTION",code:"VIT22"},VIT23:{summary:"GRAPHICSCORE_MSG_VDSL_FIRSTLINE_WRONGFORMAT_SUMMARY",cause:"GRAPHICSCORE_MSG_VDSL_WRONGFORMAT_CAUSE",resolution:"GRAPHICSCORE_MSG_VDSL_FIRSTLINE_WRONGFORMAT_RESOLUTION",code:"VIT23"},VIT24:{summary:"GRAPHICSCORE_MSG_VDSL_RELATIVE_IN_LOCAL_SUMMARY",cause:"GRAPHICSCORE_MSG_VDSL_WRONGFORMAT_CAUSE",resolution:"GRAPHICSCORE_MSG_VDSL_RELATIVE_IN_LOCAL_RESOLUTION",code:"VIT24"},VIT25:{summary:"GRAPHICSCORE_MSG_VDS3ENCRYPTED_SUMMARY",cause:"GRAPHICSCORE_MSG_VDS3ENCRYPTED_CAUSE",resolution:"GRAPHICSCORE_MSG_VDS3ENCRYPTED_RESOLUTION",code:"VIT25"},VIT26:{summary:"VIEWPORT_UNSUPPORTED_STEP_INDEX_SUMMARY",cause:"VIEWPORT_UNSUPPORTED_STEP_INDEX_CAUSE",resolution:"VIEWPORT_UNSUPPORTED_STEP_INDEX_RESOLUTION",code:"VIT26"},VIT27:{summary:"VIEWPORT_UNSUPPORTED_PROCEDURE_INDEX_SUMMARY",cause:"VIEWPORT_UNSUPPORTED_PROCEDURE_INDEX_CAUSE",resolution:"VIEWPORT_UNSUPPORTED_PROCEDURE_INDEX_RESOLUTION",code:"VIT27"},VIT28:{summary:"VIEWPORT_UNSUPPORTED_VISIBILITY_MODE_SUMMARY",cause:"VIEWPORT_UNSUPPORTED_VISIBILITY_MODE_CAUSE",resolution:"VIEWPORT_UNSUPPORTED_VISIBILITY_MODE_RESOLUTION",code:"VIT28"},VIT29:{summary:"VIEWER_RUNTIME_SETTINGS_NOT_CHANGEABLE_SUMMARY",cause:"VIEWER_RUNTIME_SETTINGS_NOT_CHANGEABLE_CAUSE",resolution:"VIEWER_RUNTIME_SETTINGS_NOT_CHANGEABLE_RESOLUTION",code:"VIT29"},VIT30:{summary:"VIEWER_WEBGLCONTEXTATTRIBUTES_NOT_CHANGEABLE_SUMMARY",cause:"VIEWER_WEBGLCONTEXTATTRIBUTES_NOT_CHANGEABLE_CAUSE",resolution:"VIEWER_WEBGLCONTEXTATTRIBUTES_NOT_CHANGEABLE_RESOLUTION",code:"VIT30"},VIT31:{summary:"VIEWPORT_UNSUPPORTED_RESET_OPTIONS_SUMMARY",cause:"VIEWPORT_UNSUPPORTED_RESET_OPTIONS_CAUSE",resolution:"VIEWPORT_UNSUPPORTED_RESET_OPTIONS_RESOLUTION",code:"VIT31"},VIT32:{summary:"VIEWPORT_UNSUPPORTED_VISIBILITY_TRACKING_SUMMARY",cause:"VIEWPORT_UNSUPPORTED_VISIBILITY_TRACKING_CAUSE",resolution:"VIEWPORT_UNSUPPORTED_VISIBILITY_TRACKING_RESOLUTION",code:"VIT32"},VIT33:{summary:"VIEWER_SOURCE_FAILED_TO_DOWNLOAD_SUMMARY",cause:"VIEWER_SOURCE_FAILED_TO_DOWNLOAD_CAUSE",resolution:"VIEWER_SOURCE_FAILED_TO_DOWNLOAD_RESOLUTION",code:"VIT33"},VIT34:{summary:"VIEWER_SOURCE_FAILED_TO_LOAD_SUMMARY",cause:"VIEWER_SOURCE_FAILED_TO_LOAD_CAUSE",resolution:"VIEWER_SOURCE_FAILED_TO_LOAD_RESOLUTION",code:"VIT34"},VIT35:{summary:"VIEWER_MSG_ERRORLOADINGMULTIPLEFILES_SUMMARY",cause:"VIEWER_MSG_ERRORLOADINGMULTIPLEFILES_COMBINATIONOFDIFFRENTCONTENTMANAGERSNOTSUPPORTED_CAUSE",resolution:"VIEWER_MSG_ERRORLOADINGMULTIPLEFILES_COMBINATIONOFDIFFRENTCONTENTMANAGERSNOTSUPPORTED_MULTIPLESUPPORTFORSAMECONTENTMANAGER_RESOLUTION",code:"VIT35"},VIT36:{summary:"VIEWER_UNKNOWN_CONTENT_RESOURCE_TYPE_SUMMARY",cause:"VIEWER_UNKNOWN_CONTENT_RESOURCE_TYPE_CAUSE",resolution:"VIEWER_UNKNOWN_CONTENT_RESOURCE_TYPE_RESOLUTION",code:"VIT36"},VIT37:{summary:"VIEWER_MSG_FAILEDTOLOADCONTENT_SUMMARY",cause:"VIEWER_MSG_FAILEDTOLOADCONTENT_URLORAUTHENTICATION_CAUSE",resolution:"VIEWER_MSG_FAILEDTOLOADCONTENT_URLORAUTHENTICATION_RESOLUTION",code:"VIT37"}};return E},true);
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/NativeViewport", ["./library","sap/ui/core/Control","sap/ui/core/ResizeHandler","./Core","./Loco","./ViewportBase","./ViewportHandler","./Messages","./NativeViewportRenderer","./getResourceBundle","sap/base/util/uid","sap/base/Log"],function(t,e,i,s,r,n,o,h,a,l,d,u){"use strict";var _=n.extend("sap.ui.vk.NativeViewport",{metadata:{library:"sap.ui.vk",properties:{limitZoomOut:{type:"boolean",group:"Behavior",defaultValue:false}},events:{resize:{parameters:{oldSize:"object",size:"object"}},move:{parameters:{pan:"object",zoom:"float"}}}},constructor:function(t,i){e.apply(this,arguments);this._canvas=null;this._canvas=document.createElement("div");this._canvas.style.textAlign="left";this._canvas.id=d();this._resizeListenerId=null;this._viewportHandler=new o(this);this._loco=new r(this);this._loco.addHandler(this._viewportHandler,-1);this._reset();this._svgid=this.getId()+"-svg";s.observeAssociations(this)}});_.prototype.init=function(){this.setBackgroundColorTop("transparent");this.setBackgroundColorBottom("transparent")};_.prototype.destroy=function(){this._loco.removeHandler(this._viewportHandler);this._viewportHandler.destroy();this._loco.destroy();this._loco=null;if(this._resizeListenerId){i.deregister(this._resizeListenerId);this._resizeListenerId=null}e.prototype.destroy.call(this)};_.prototype.onBeforeRendering=function(){if(this._resizeListenerId){i.deregister(this._resizeListenerId);this._resizeListenerId=null}};_.prototype.onAfterRendering=function(){if(this._canvas){var t=this.getDomRef();if(t.childNodes.length>0){t.insertBefore(this._canvas,t.childNodes[0])}else{t.appendChild(this._canvas)}this._resizeListenerId=i.register(this,this._handleResize.bind(this));this._handleResize({size:{width:t.clientWidth,height:t.clientHeight}})}};_.prototype.setShouldRenderFrame=function(){this.invalidate()};_.prototype._handleResize=function(t){this.fireResize({oldSize:t.oldSize,size:t.size});if(this._s===0||this._svgError){this.zoomTo()}else{this._update()}};_.prototype._reset=function(){this._img=null;this._svg=null;this._svgError=null;this._imageW=0;this._imageH=0;this._bestFitScale=0;this._s=0;this._x=0;this._y=0;this._gx=0;this._gy=0;this._canvas.style.visibility="hidden";while(this._canvas.lastChild){this._canvas.removeChild(this._canvas.lastChild)}};_.prototype._update=function(){var t=this._svgError||this._img||this._svg;if(t){var e=this._x-(this._imageW-this._canvas.clientWidth)/2;var i=this._y-(this._imageH-this._canvas.clientHeight)/2;var s="matrix("+this._s+",0,0,"+this._s+","+e+","+i+")";t.style.transform=s;t.style.webkitTransform=s;t.style.msTransform=s;t.style.MozTransform=s;t.style.OTransform=s}};_.prototype.zoomTo=function(){if(this._isRedlineActivated&&!this._redlineHandler){u.info("zoomTo() method is disabled when Redlining is activated");return this}if(this._svgError){this._imageW=550;this._imageH=512}else if(this._svg){this._svg.width=1024;this._imageW=this._svg.clientWidth;this._imageH=this._svg.clientHeight}else if(this._img){this._imageW=this._img.width;this._imageH=this._img.height}else{return this}if(!this._imageW||!this._imageH||!this._canvas.clientWidth||!this._canvas.clientHeight){return this}var t=Math.min(this._canvas.clientWidth/this._imageW,this._canvas.clientHeight/this._imageH);if(this._redlineHandler){this._redlineHandler.pan(-this._x,-this._y);this._redlineHandler.zoom(t/this._s,this._canvas.clientWidth*.5,this._canvas.clientHeight*.5)}this._bestFitScale=t;this._s=t;this._x=0;this._y=0;this._update();this._canvas.style.visibility="visible";return this};_.prototype.loadUrl=function(t,e,i,s,r){if(/^(svg)$/.test(r.toLowerCase())){this._reset();this._svg=document.createElement("object");this._svg.setAttribute("type","image/svg+xml");this._svg.setAttribute("data",t);this._svg.setAttribute("id",this._svgid);this._svg.setAttribute("class","SVGImage");this._svg.setAttribute("width",1024);this._canvas.appendChild(this._svg);var n=document.createElement("div");n.style.position="absolute";n.style.top=0;n.style.left=0;n.style.height="100%";n.style.width="100%";this._canvas.appendChild(n);this._svg.onload=function(){this._svg.onload=null;setTimeout(function(){this.zoomTo();if(e){e()}}.bind(this),0)}.bind(this);this._svg.onerror=function(){u.error(l().getText(h.VIT1.summary),h.VIT1.code,"sap.ui.vk.NativeViewport");this._reset();if(i){i()}}.bind(this);this._svg.src=t;return this}else if(/^(jpg|jpeg|png|gif|bmp|tif|tiff)$/.test(r.toLowerCase())){this._reset();this._img=new Image;this._img.draggable=false;this._img.onload=function(){setTimeout(function(){this.zoomTo();this._canvas.appendChild(this._img);if(e){e()}}.bind(this),0)}.bind(this);this._img.onerror=function(){u.error(l().getText(h.VIT2.summary),h.VIT2.code,"sap.ui.vk.NativeViewport");if(i){i()}};this._img.src=t;return this}else{u.error(l().getText(h.VIT3.summary),h.VIT3.code,"sap.ui.vk.NativeViewport");if(i){i()}return this}};_.prototype.loadFailed=function(t){this._reset();this._svgError=document.createElement("div");this._svgError.className="svgErrorContainer";var e="http://www.w3.org/2000/svg";this._svgErrorElement=document.createElementNS(e,"svg");this._svgErrorElement.setAttribute("width","550px");this._svgErrorElement.setAttribute("height","512px");this._svgErrorElement.setAttribute("viewBox","-244 -244 512 512");this._svgErrorElement.setAttribute("enable-background","new -244 -244 512 512");this._svgErrorElement.setAttribute("id","SVGError");var i=document.createElementNS(e,"rect");i.setAttribute("fill","#FFFFFF");i.setAttribute("x","-244");i.setAttribute("y","-244");i.setAttribute("width","512");i.setAttribute("height","512");i.setAttribute("opacity","0.1");this._svgErrorElement.appendChild(i);var s=document.createElementNS(e,"path");s.setAttribute("fill","#474747");s.setAttribute("d","M12.833,89.742c-70.781,0-128.366-57.584-128.366-128.366c0-70.781,57.584-128.365,128.366-128.365 s128.365,57.584,128.365,128.365C141.198,32.158,83.614,89.742,12.833,89.742z M12.833-146.989 c-59.753,0-108.366,48.612-108.366,108.365c0,59.752,48.613,108.366,108.366,108.366S121.198,21.129 121.198-38.624 C121.198-98.376,72.586-146.989,12.833-146.989z");s.setAttribute("opacity","0.3");this._svgErrorElement.appendChild(s);var r=document.createElementNS(e,"rect");r.setAttribute("fill","#474747");r.setAttribute("x","-2.167");r.setAttribute("y","-120.847");r.setAttribute("width","30");r.setAttribute("height","119.447");r.setAttribute("fill","#474747");r.setAttribute("opacity","0.3");this._svgErrorElement.appendChild(r);var n=document.createElementNS(e,"rect");n.setAttribute("fill","#474747");n.setAttribute("x","-2.167");n.setAttribute("y","13.6");n.setAttribute("width","30");n.setAttribute("height","30");n.setAttribute("opacity","0.3");this._svgErrorElement.appendChild(n);var o=document.createElementNS(e,"path");o.setAttribute("fill","#474747");o.setAttribute("d","M10.833,87.33c-70.781,0-128.366-57.584-128.366-128.365c0-70.781,57.584-128.365,128.366-128.365 s128.365,57.584,128.365,128.365C139.198,29.746,81.614,87.33,10.833,87.33z M10.833-149.4 c-59.753,0-108.366,48.612-108.366,108.365S-48.92,67.33,10.833,67.33S119.198,18.718,119.198-41.035S70.586-149.4,10.833-149.4z");this._svgErrorElement.appendChild(o);var h=document.createElementNS(e,"rect");h.setAttribute("fill","#474747");h.setAttribute("x","-4.167");h.setAttribute("y","-123.259");h.setAttribute("width","30");h.setAttribute("height","119.447");h.setAttribute("fill","#474747");this._svgErrorElement.appendChild(h);var a=document.createElementNS(e,"rect");a.setAttribute("fill","#474747");a.setAttribute("x","-4.167");a.setAttribute("y","11.188");a.setAttribute("width","30");a.setAttribute("height","30");a.setAttribute("fill","#474747");this._svgErrorElement.appendChild(a);var d=document.createElementNS(e,"text");d.setAttribute("id","textError");d.setAttribute("left","auto");d.setAttribute("right","auto");d.setAttribute("y","150");d.setAttribute("x","10");d.setAttribute("display","block");d.setAttribute("text-anchor","middle");d.setAttribute("fill","#474747");d.style.fontFamily="Arial";d.setAttribute("font-size","32");d.textContent=t?t:l().getText("VIEWPORT_MESSAGEUNSUPPORTEDFILEFORMAT");this._svgErrorElement.appendChild(d);this._svgError.appendChild(this._svgErrorElement);this.zoomTo();this._canvas.appendChild(this._svgError);return this};_.prototype.beginGesture=function(t,e){this._gx=(t-this._canvas.clientWidth/2-this._x)/this._s;this._gy=(e-this._canvas.clientHeight/2-this._y)/this._s;return this};_.prototype.endGesture=function(){this._gx=0;this._gy=0;return this};_.prototype.pan=function(t,e){if(this._svgError){return this}if(this._redlineHandler){this._redlineHandler.pan(t,e)}this._x+=t;this._y+=e;this._update();this.fireMove({pan:{x:t,y:e},zoom:1});return this};_.prototype.rotate=function(t,e){return this.pan(t,e)};_.prototype._getZoomInLimit=function(){return 500};_.prototype._getZoomOutLimit=function(){return this.getLimitZoomOut()?this._bestFitScale*.25:1e-4};_.prototype._getZoomFactor=function(){return this._s};_.prototype.zoom=function(t){if(this._svgError){return this}var e=this._gx*this._s;var i=this._gy*this._s;var s=this._s;this._s=Math.min(Math.max(this._s*t,this._getZoomOutLimit()),this._getZoomInLimit());t=this._s/s;if(this._redlineHandler){this._redlineHandler.zoom(t)}var r=this._gx*this._s;var n=this._gy*this._s;var o=e-r;var h=i-n;this._x+=o;this._y+=h;this._update();this.fireMove({pan:{x:o,y:h},zoom:t});return this};_.prototype.tap=function(t,e,i){if(i){this.zoomTo()}return this};_.prototype.queueCommand=function(t){t();return this};_.prototype.getViewInfo=function(){var t={};t.camera=[this._s,0,0,this._s,this._x,this._y];return t};_.prototype.setViewInfo=function(t){if(this._svgError){return this}var e=t.camera;this._s=e[0];this._x=e[4];this._y=e[5];this._update();return this};_.prototype.getOutputSize=function(){var t=this.getDomRef().getBoundingClientRect();return{left:t.width/2,top:t.height/2,sideLength:1024}};_.prototype.onSetContentConnector=function(t){t.attachContentReplaced(this._onContentReplaced,this);this._setImage(t.getContent())};_.prototype.onUnsetContentConnector=function(t){this._setImage(null);t.detachContentReplaced(this._onContentReplaced,this)};_.prototype._onContentReplaced=function(t){this._setImage(t.getParameter("newContent"))};_.prototype._setImage=function(t){this._reset();if(t instanceof HTMLObjectElement){this._svg=t;t.setAttribute("id",this._svgid);t.onload=function(){t.onload=null;setTimeout(function(){this.zoomTo()}.bind(this),0)}.bind(this);this._canvas.appendChild(t);var e=document.createElement("div");e.style.position="absolute";e.style.top=0;e.style.left=0;e.style.height="100%";e.style.width="100%";this._canvas.appendChild(e)}else if(t instanceof HTMLImageElement){this._img=t;t.draggable=false;setTimeout(function(){this.zoomTo();this._canvas.appendChild(t)}.bind(this),0)}return this};var c=2;var p=2;[{key:"left",dx:-p,dy:0},{key:"right",dx:+p,dy:0},{key:"up",dx:0,dy:-p},{key:"down",dx:0,dy:+p}].forEach(function(t){_.prototype["onsap"+t.key]=function(e){this.beginGesture(this.$().width()/2,this.$().height()/2);this.pan(t.dx,t.dy);this.endGesture();e.preventDefault();e.stopPropagation()}});[{key:"left",dx:-c,dy:0},{key:"right",dx:+c,dy:0},{key:"up",dx:0,dy:-c},{key:"down",dx:0,dy:+c}].forEach(function(t){_.prototype["onsap"+t.key+"modifiers"]=function(e){if(e.shiftKey&&!(e.ctrlKey||e.altKey||e.metaKey)){this.beginGesture(this.$().width()/2,this.$().height()/2);this.rotate(t.dx,t.dy);this.endGesture();e.preventDefault();e.stopPropagation()}}});[{key:"minus",d:.98},{key:"plus",d:1.02}].forEach(function(t){_.prototype["onsap"+t.key]=function(e){this.beginGesture(this.$().width()/2,this.$().height()/2);this.zoom(t.d);this.endGesture();e.preventDefault();e.stopPropagation()}});_.prototype._activateRedline=function(){this._isRedlineActivated=true};_.prototype._deactivateRedline=function(){this._isRedlineActivated=false};return _});
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/NativeViewportRenderer", [],function(){"use strict";var e={apiVersion:2};e.render=function(e,r){e.openStart("div",r);e.class("sapVizKitNativeViewport");e.attr("tabindex",0);e.style("background-image","linear-gradient("+r.getBackgroundColorTop()+","+r.getBackgroundColorBottom()+")");e.openEnd();r.renderTools(e);r.renderContent(e);e.close("div")};return e},true);
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/NavigationMode", ["sap/ui/base/DataType"],function(a){"use strict";var e={NoChange:"NoChange",Turntable:"Turntable",Orbit:"Orbit",Pan:"Pan",Zoom:"Zoom"};a.registerEnum("sap.ui.vk.NavigationMode",e);return e},true);
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/NodeContentType", ["sap/ui/base/DataType"],function(e){"use strict";var n={Regular:"Regular",Reference:"Reference",Annotation:"Annotation",Background:"Background",Symbol:"Symbol",Hotspot:"Hotspot",PMI:"PMI",PointCloudGroup:"PointCloudGroup",SvgImage:"SvgImage",DynamicContent:"DynamicContent"};e.registerEnum("sap.ui.vk.NodeContentType",n);return n},true);
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/NodeHierarchy", ["sap/ui/base/ManagedObject","./Messages","./getResourceBundle","sap/base/util/array/uniqueSort","sap/base/Log"],function(e,t,r,n,a){"use strict";var i=e.extend("sap.ui.vk.NodeHierarchy",{metadata:{library:"sap.ui.vk",abstract:true,events:{changed:{},nodeCreated:{parameters:{nodeRef:{type:"any"},nodeId:{type:"string"}}},nodeRemoving:{parameters:{nodeRef:{type:"any"},nodeId:{type:"string"}}},nodeReplaced:{parameters:{ReplacedNodeRef:{type:"any"},ReplacementNodeRef:{type:"any"},ReplacedNodeId:{type:"string"},ReplacementNodeId:{type:"string"}}},nodeUpdated:{parameters:{nodeRef:{type:"any"},nodeId:{type:"string"}}}}}});i.prototype.findNodesById=function(e){if(e.fields.some(function(e){return!e.caseSensitive})){e=jQuery.extend(true,{},e);e.fields.forEach(function(e){if(!e.caseSensitive){e.value=e.value.toLowerCase()}})}var n=function(e,n,i,s){var o;e=e||"equals";s=s||"";var d=n?i:i.toLowerCase();switch(e){case"equals":o=d===s;break;case"contains":o=d.indexOf(s)!==-1;break;case"startsWith":o=d.indexOf(s)===0;break;default:o=false;a.error(r().getText(t.VIT8.summary),t.VIT8.code,"sap.ui.vk.dvl.NodeHierarchy")}return o};var i=function(e,t){return!e.some(function(e){return t.name===e.name?n(t.predicate,t.caseSensitive,e.value,t.value):false})};var s=function(e,t){return e.source===t.source&&e.type===t.type&&!e.fields.some(i.bind(undefined,t.fields))};var o=this.findNodesByName();var d=o.filter(function(t){var r=this.createNodeProxy(t);var n=r.getVeIds();this.destroyNodeProxy(r);return n.some(s.bind(undefined,e))}.bind(this));return d};i.prototype.findNodesByMetadata=function(e){var i=function(e,t,r,n,a,i){if(e&&e.hasOwnProperty(t)){var s=e[t];if(s.hasOwnProperty(r)){var o=s[r];if(!i){o=o.toLowerCase()}return n.some(a.bind(undefined,o))}}return false};var s=function(e,t){return e&&e.hasOwnProperty(t)};var o=function(e,t,r,n,a,i,s){var o=this._baseNodeProxyPool.borrowObject();var d=e.filter(function(e){o.init(this,e);var d=o.getNodeMetadata();var u=t(d,r,n,a,i,s);o.reset();return u}.bind(this));this._baseNodeProxyPool.returnObject(o);return d};var d=this.findNodesByName(),u=[];if(e===undefined||e===null||jQuery.isEmptyObject(e)){u=d}else if(e.category!==null&&e.category!==undefined&&e.category!==""){var c,f,y,p,l=!!(e&&e.caseSensitive);if(e.key===undefined||e.key===null){c=s}else{f=e.value;y=e.predicate||"equals";if(f===undefined||f===null){f="";y="contains"}if(!Array.isArray(f)){f=[f]}if(!l){f=f.map(function(e){return e.toLowerCase()})}switch(y){case"equals":p=function(e,t){return e===t};break;case"contains":p=function(e,t){return e.indexOf(t)!==-1};break;case"startsWith":p=function(e,t){return e.indexOf(t)===0};break;default:a.error(r().getText(t.VIT9.summary),t.VIT9.code,"sap.ui.vk.dvl.NodeHierarchy")}c=i}u=o.bind(this)(d,c,e.category,e.key,f,p,l)}else{a.error(r().getText(t.VIT10.summary),t.VIT10.code,"sap.ui.vk.dvl.NodeHierarchy")}return n(u)};i.prototype._appendAncestors=function(e,t){t=t?new Set(t):null;var r=new Set(e);e.forEach(function(e){var n=this.getAncestors(e);n.forEach(function(e){if(t===null||!t.has(e)){r.add(e)}})},this);return Array.from(r)};i.prototype.getHotspotNodeIds=function(){return this.getHotspotNodeRefs()};return i});
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/NodeProxy", ["sap/ui/base/ManagedObject"],function(t){"use strict";var e=t.extend("sap.ui.vk.NodeProxy",{metadata:{library:"sap.ui.vk",properties:{nodeRef:"any",veIds:"object[]",name:"string",localMatrix:{type:"float[]",bindable:"bindable"},worldMatrix:{type:"float[]",bindable:"bindable"},material:{type:"sap.ui.vk.Material"},opacity:{type:"float",bindable:"bindable"},tintColorABGR:{type:"int",bindable:"bindable"},tintColor:{type:"sap.ui.core.CSSColor",bindable:"bindable"},nodeMetadata:"object",hasChildren:"boolean",closed:"boolean"}}});e.prototype.setClosed=function(t){return this};e.prototype.setHasChildren=function(t){return this};e.prototype.setName=function(t){return this};e.prototype.setNodeId=function(t){return this};e.prototype.setNodeMetadata=function(t){return this};e.prototype.setVeIds=function(t){return this};e.prototype.assignMaterial=function(t){return this};e.prototype.getLocalTranslate=function(){return[0,0,0]};e.prototype.getLocalScale=function(){return[1,1,1]};e.prototype.getLocalRotationInQuaternion=function(){return[1,0,0,1]};e.prototype.getLocalRotationInAngleAxis=function(){return[1,0,0,0]};e.prototype.getLocalRotationInEuler=function(){return[0,0,0,0]};return e});
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/NodeUtils", ["./glMatrix"],function(r){"use strict";var e={centerOfNodes:function(e,a){function u(e,a,u,n,t,m,N){var I=[];I.push(r.vec3.fromValues(e,a,u));I.push(r.vec3.fromValues(e,a,m));I.push(r.vec3.fromValues(e,t,u));I.push(r.vec3.fromValues(e,t,m));I.push(r.vec3.fromValues(n,a,u));I.push(r.vec3.fromValues(n,a,m));I.push(r.vec3.fromValues(n,t,u));I.push(r.vec3.fromValues(n,t,m));var f=Number.MAX_SAFE_INTEGER;var i=Number.MAX_SAFE_INTEGER;var s=Number.MAX_SAFE_INTEGER;var o=-Number.MAX_SAFE_INTEGER;var v=-Number.MAX_SAFE_INTEGER;var E=-Number.MAX_SAFE_INTEGER;var x=r.vec3.create();I.forEach(function(e){r.vec3.transformMat4(x,e,N);if(x[0]<f){f=x[0]}if(x[1]<i){i=x[1]}if(x[2]<s){s=x[2]}if(x[0]>o){o=x[0]}if(x[1]>v){v=x[1]}if(x[2]>E){E=x[2]}});return[f,i,s,o,v,E]}var n={x:Number.NEGATIVE_INFINITY,y:Number.NEGATIVE_INFINITY,z:Number.NEGATIVE_INFINITY};var t={x:Number.POSITIVE_INFINITY,y:Number.POSITIVE_INFINITY,z:Number.POSITIVE_INFINITY};var m=false;e.forEach(function(r){r.traverse(function(r){var e=r.userData.boundingBox;var a=null;if(!e&&r.geometry){var N=r.userData.renderGroup;if(N&&N.boundingBox){a=N.boundingBox}else{e=r.geometry.boundingBox}}var I=null;if(a){I=u(a[0],a[1],a[2],a[3],a[4],a[5],r.matrixWorld.elements)}else if(e){var f=e.min;var i=e.max;I=u(f.x,f.y,f.z,i.x,i.y,i.z,r.matrixWorld.elements)}if(I){t.x=Math.min(t.x,I[0]);t.y=Math.min(t.y,I[1]);t.z=Math.min(t.z,I[2]);n.x=Math.max(n.x,I[3]);n.y=Math.max(n.y,I[4]);n.z=Math.max(n.z,I[5]);m=true}})});if(!m){return[0,0,0]}return[Math.abs(n.x-t.x)/2+t.x,Math.abs(n.y-t.y)/2+t.y,Math.abs(n.z-t.z)/2+t.z]}};return e});
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/Notifications", ["sap/base/Log","./library","sap/ui/core/Control","./Messages","./NotificationsRenderer","./getResourceBundle","sap/m/ToggleButton","sap/m/MessagePopover","sap/m/Button","sap/m/MessageItem","sap/m/library"],function(e,t,s,i,o,a,r,g,l,n,p){"use strict";const v=p.ButtonType;var d=s.extend("sap.ui.vk.Notifications",{metadata:{library:"sap.ui.vk",publicMethods:["clearAllMessages"],aggregations:{_messagePopover:{type:"sap.m.MessagePopover",multiple:false,visibility:"hidden"},_messagePopoverToggleButton:{type:"sap.m.ToggleButton",multiple:false,visibility:"hidden"}},events:{allMessagesCleared:{},messageAdded:{}}}});d.prototype.init=function(){if(s.prototype.init){s.prototype.init.call(this)}var t;var i=new r({icon:"sap-icon://message-popup",type:v.Emphasized,tooltip:a().getText("MESSAGEPOPOVERBUTTON"),text:"0",press:function(e){if(i.getPressed()){t.openBy(i)}else{t.close()}}});i.addStyleClass("messagePopoverButton");this.setAggregation("_messagePopoverToggleButton",i);t=new g(`${this.getId()}-messagePopover`,{headerButton:new l({text:a().getText("MESSAGEPOPOVER_CLEARBUTTON"),type:v.Emphasized,tooltip:a().getText("MESSAGEPOPOVER_CLEARBUTTON"),press:function(e){t.getParent().clearAllMessages()}}),afterClose:i.setPressed.bind(i,false)});t.addStyleClass("sapVizKitNotificationPopover");this.setAggregation("_messagePopover",t);e.addLogListener(this)};d.prototype.exit=function(){e.removeLogListener(this);if(s.prototype.exit){s.prototype.exit.call(this)}};d.prototype.onLogEntry=function(t){if(t.component.startsWith("sap.ui.vk")&&(t.level===e.Level.WARNING||t.level===e.Level.ERROR||t.level===e.Level.FATAL)){var s=t.details,o,r,g;if(i[t.details]){s=a().getText(i[t.details].summary);o=a().getText(i[t.details].cause);r=a().getText(i[t.details].resolution);g=a().getText("ERROR_DESCRIPTION_CODE")}var l=a().getText("ERROR_DESCRIPTION_COMPONENT");var p=a().getText("ERROR_DESCRIPTION_DATE");var v=a().getText("ERROR_DESCRIPTION_TIME");var d=a().getText("ERROR_DESCRIPTION_LEVEL");var R=a().getText("ERROR_DESCRIPTION_MESSAGE");var T=a().getText("ERROR_DESCRIPTION_CAUSE");var E=a().getText("ERROR_DESCRIPTION_RESOLUTION");var b="<div><b>"+l+":</b><br>"+t.component+"</div><br>"+"<div><b>"+p+":</b><br>"+t.date+"</div><br>"+(g?"<div><b>"+g+":</b><br>"+t.details+"</div><br>":"")+"<div><b>"+v+":</b><br>"+t.time.slice(0,t.time.indexOf("."))+"</div><br>"+"<div><b>"+d+":</b><br>"+t.level+"</div><br>"+"<div><b>"+R+":</b><br>"+s+"</div><br>"+(o?"<div><b>"+T+":</b><br>"+o+"</div><br>":"")+(r?"<div><b>"+E+":</b><br>"+r+"</div>":"");var m=new n({markupDescription:true,title:t.message,description:b});var u=this.getAggregation("_messagePopover");u.addItem(m);this.getAggregation("_messagePopoverToggleButton").setText(u.getItems().length);this.fireMessageAdded()}};d.prototype.clearAllMessages=function(){var e=this.getAggregation("_messagePopover");e.removeAllItems();e.close();this.getAggregation("_messagePopoverToggleButton").setText(e.getItems().length);this.fireAllMessagesCleared();return this};return d});
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/NotificationsRenderer", [],function(){"use strict";var e={apiVersion:2};e.render=function(e,n){e.openStart("div",n);e.class("sapVizKitNotifications");e.openEnd();e.renderControl(n.getAggregation("_messagePopoverToggleButton"));e.close("div")};return e},true);
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/ObjectType", ["sap/ui/base/DataType"],function(e){"use strict";var t={PMI:0,Hotspot:1,DynamicContent:2};e.registerEnum("sap.ui.vk.ObjectType",t);return t},true);
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/OrthographicCamera", ["./Camera"],function(a){"use strict";var r=a.extend("sap.ui.vk.OrthographicCamera",{metadata:{library:"sap.ui.vk",properties:{zoomFactor:{type:"float"}}}});return r});
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/OutputSettings", ["sap/ui/core/Element","./getResourceBundle"],function(t,e){"use strict";var i=t.extend("sap.ui.vk.OutputSettings",{metadata:{library:"sap.ui.vk",properties:{width:{type:"float"},height:{type:"float"},dpi:{type:"float"}}}});return i});
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/Overlay", ["./library","sap/ui/core/Control","sap/ui/vbm/library","sap/ui/vbm/VBI","sap/ui/unified/Menu","./Messages","./OverlayRenderer","./getResourceBundle","./OverlayArea","sap/base/Log"],function(e,t,i,n,a,o,r,s,h,l){"use strict";var d=t.extend("sap.ui.vk.Overlay",{metadata:{library:"sap.ui.vk",properties:{zoomOnResize:{type:"boolean",group:"Behavior",defaultValue:true}},aggregations:{areas:{type:"sap.ui.vk.OverlayArea",multiple:true,singularName:"area"}},associations:{target:{type:"sap.ui.core.Control",multiple:false}},events:{click:{parameters:{clientX:{type:"int"},clientY:{type:"int"},pos:{type:"string"}}},contextMenu:{parameters:{pos:{type:"string"},menu:{type:"sap.ui.unified.Menu"}}}}}});d.prototype.getPositionInteractive=function(e,t){if(!this.mIACreateCB&&t&&typeof t==="function"){this.mIACreateCB=t;var i="POS";if(e){i+="ARRAY"}var n={SAPVB:{Automation:{Call:{handler:"OBJECTCREATIONHANDLER",name:"CreateObject",object:"MainScene",scene:"MainScene",instance:"",Param:{name:"data","#":"{"+i+"}"}}}}};this._load(n);return true}else{return false}};d.prototype.openContextMenu=function(e){this._openContextMenu("Overlay",this,e)};d.prototype.setPanAndZoom=function(e,t,i){if(e===0&&t===0&&i===1){return}var n=this.mVBIContext.GetMainScene();this.totalCenterOffset.dx+=e;this.totalCenterOffset.dy+=t;if(i===1){n.MoveMap(e,t)}else{var a=n.m_Canvas[0];var o=a.m_nExactLOD+Math.log(i)*Math.LOG2E;n.ZoomToGeoPosition(VBI.MathLib.DegToRad([.5,.5]),o);n.MoveMap(this.totalCenterOffset.dx,this.totalCenterOffset.dy)}};d.prototype.reset=function(){this.totalCenterOffset.dx=this.totalCenterOffset.dy=0;var e=this.mVBIContext.GetMainScene();if(e){e.ZoomToGeoPosition(VBI.MathLib.DegToRad([.5,.5]),this.initialZoom)}return this};d.prototype.init=function(){this.aLoadQueue=null;this.oTargetDomRef=null;this.mVBIContext=new VBI.VBIContext(this);this.resizeID="";this.resizeIDTarget="";this.bVosDirty=true;this.bWindowsDirty=true;this.bSceneDirty=true;this.bDataDeltaUpdate=false;this.bHandleDataChangeActive=false;this.bForceDataUpdate=false;this.mAddMenuItems=[];this.totalCenterOffset={dx:0,dy:0};this.initialZoom=10};d.prototype.exit=function(){if(this.mVBIContext){this.mVBIContext.clear()}if(this.resizeID!=""){sap.ui.core.ResizeHandler.deregister(this.resizeID);this.resizeID=""}if(this.resizeIDTarget!=""){sap.ui.core.ResizeHandler.deregister(this.resizeIDTarget);this.resizeIDTarget=""}};d.prototype.resize=function(e){var t=this.oControl!=undefined?this.oControl:this;var i=t.mVBIContext;if(i){var n=i.GetMainScene();if(n){if(t.getZoomOnResize()&&e&&e.oldSize.width>0){var a=Math.log(e.size.width/e.oldSize.width)*Math.LOG2E;n.ZoomToGeoPosition(n.GetCenterPos(),n.GetCurrentZoomlevel()+a,false,true,true)}n.resizeCanvas(e,true,true)}}};d.prototype.setTarget=function(e){if(!e){return}this.setAssociation("target",e);this.reset();if(e instanceof sap.m.Image){e.addDelegate({onAfterRendering:function(t){this.oTargetDomRef=e.getDomRef();this.oTargetDomRef.addEventListener("load",this._adaptSizeOfTarget.bind(this))}.bind(this)})}else{e.addDelegate({onAfterRendering:function(t){this.oTargetDomRef=e.getDomRef();this._adaptSizeOfTarget()}.bind(this)})}if(this.resizeIDTarget!=""){sap.ui.core.ResizeHandler.deregister(this.resizeIDTarget);this.resizeIDTarget=""}this.resizeIDTarget=sap.ui.core.ResizeHandler.register(e,this._adaptSizeOfTarget.bind(this))};d.prototype._adaptSizeOfTarget=function(){var e=this.oTargetDomRef;var t=this.getDomRef();if(e){try{var i=jQuery(e);var n={top:i.offset().top,left:i.offset().left,width:i.outerWidth(),height:i.outerHeight()};jQuery(t).width(n.width).height(n.height).css("position","absolute");jQuery(t).css("top","0px").css("left","0px").css("visibility","")}catch(e){l.error(e)}}else{jQuery(t).css("position","fixed").width("0px").height("0px").css("top","0px").css("left","0px").css("visibility","hidden")}};d.prototype.onAfterRendering=function(){if(this.$oldContent.length>0){this.$().append(this.$oldContent)}this._adaptSizeOfTarget();if(this.aLoadQueue){var e;for(e=0;e<this.aLoadQueue.length;++e){this._load(this.aLoadQueue[e])}this.aLoadQueue=null}if(this.resizeID==""){this.resize();this.resizeID=sap.ui.core.ResizeHandler.register(this,this.resize)}var t=this.getId();if(this.mVBIContext.m_Windows){this.mVBIContext.m_Windows.Awake(t)}};d.prototype.onBeforeRendering=function(){this.$oldContent=sap.ui.core.RenderManager.findPreservedContent(this.getId())};d.prototype.invalidate=function(e){this.bSceneDirty=true;if(e instanceof h){this.bVosDirty=true;this.bDataDeltaUpdate=this.bHandleDataChangeActive}sap.ui.core.Control.prototype.invalidate.apply(this,arguments)};d.prototype._load=function(e){if(!this.isRendered()){if(!this.aLoadQueue){this.aLoadQueue=[]}this.aLoadQueue.push(e);return}this._loadHtml(e)};d.prototype._loadHtml=function(e){var t=this.getId();var i=null;if(typeof e=="string"){i=JSON.parse(e.indexOf("{")?e.substr(e.indexOf("{")):e)}else if(typeof e=="object"){i=e}if(!i){return}if(!i["SAPVB"]){var n;if(this.mVBIContext&&(n=new VBI.Adaptor(this.mVBIContext).CreateLoadData(i))){this.loadHtml(n);return}else{return}}var a=false;var o=false;var r=false;if(jQuery.type(i)=="object"){if(i.SAPVB){if(i.SAPVB.Config){this.mVBIContext.GetConfig().load(i.SAPVB.Config,this.mVBIContext)}if(i.SAPVB.Resources){this.mVBIContext.GetResources().load(i.SAPVB.Resources,this.mVBIContext)}if(i.SAPVB.DataTypes){if(!this.mVBIContext["m_DataTypeProvider"]){this.mVBIContext["m_DataTypeProvider"]=new VBI.DataTypeProvider}this.mVBIContext["m_DataTypeProvider"].load(i.SAPVB.DataTypes,this.mVBIContext)}if(i.SAPVB.Data){if(!this.mVBIContext["m_DataProvider"]){this.mVBIContext["m_DataProvider"]=new VBI.DataProvider}this.mVBIContext["m_DataProvider"].load(i.SAPVB.Data,this.mVBIContext);a=true}if(i.SAPVB.Windows){if(!this.mVBIContext["m_Windows"]){this.mVBIContext["m_Windows"]=new VBI.Windows}this.mVBIContext["m_Windows"].load(i.SAPVB.Windows,this.mVBIContext);r=true}if(i.SAPVB.Actions){if(!this.mVBIContext["m_Actions"]){this.mVBIContext["m_Actions"]=new VBI.Actions}this.mVBIContext["m_Actions"].load(i.SAPVB.Actions,this.mVBIContext)}if(i.SAPVB.Automation){if(!this.mVBIContext["m_Automations"]){this.mVBIContext["m_Automations"]=new VBI.Automations}this.mVBIContext["m_Automations"].load(i.SAPVB.Automation,this.mVBIContext)}if(i.SAPVB.Menus){if(!this.mVBIContext["m_Menus"]){this.mVBIContext["m_Menus"]=new VBI.Menus}this.mVBIContext["m_Menus"].load(i.SAPVB.Menus,this.mVBIContext)}if(i.SAPVB.Scenes){if(!this.mVBIContext["m_SceneManager"]){this.mVBIContext["m_SceneManager"]=new VBI.SceneManager}this.mVBIContext["m_SceneManager"].load(i.SAPVB.Scenes,this.mVBIContext);o=true}}if(a){if(this.mVBIContext["m_Windows"]){this.mVBIContext["m_Windows"].NotifyDataChange()}}if(o||r){if(this.mVBIContext["m_Windows"]){this.mVBIContext["m_Windows"].Awake(t)}}if(o||a){if(this.mVBIContext["m_Windows"]){this.mVBIContext["m_Windows"].RenderAsync()}}}};d.prototype._openContextMenu=function(e,t,i){if(i&&i.vbi_data&&i.vbi_data.VBIName=="DynContextMenu"){if(!this.mVBIContext["m_Menus"]){this.mVBIContext["m_Menus"]=new window.VBI.Menus}for(var n=0;n<this.mAddMenuItems.length;++n){i.addItem(this.mAddMenuItems[n])}this.mVBIContext.m_Menus.m_menus.push(i);this._loadHtml({SAPVB:{version:"2.0",Automation:{Call:{earliest:"0",handler:"CONTEXTMENUHANDLER",instance:t.sId,name:"SHOW",object:e,refID:"CTM",Param:[{name:"x","#":t.mClickPos[0]},{name:"y","#":t.mClickPos[1]},{name:"scene","#":"MainScene"}]}}}})}this.mAddMenuItems=[]};d.prototype._update=function(){var e={SAPVB:{}};if(this.bSceneDirty){this._updateScene(e)}this._updateWindows(e);if(e.SAPVB.Actions){var t=this._getActionArray();for(var i=0;i<t.length;i++){e.SAPVB.Actions.Set.Action.push(t[i])}}return this._minimizeApp(e)};d.prototype._minimizeApp=function(e){var t,i;var n;i=null;if(!this.bWindowsDirty){n=(t=e)&&(t=t.SAPVB)&&(t=t.Windows)&&(i=JSON.stringify(t))&&i==this.mCurWindows&&delete e.SAPVB.Windows;if(!n){this.mCurWindows=i?i:this.mCurWindows}}else{this.bWindowsDirty=false}i=null;n=(t=e)&&(t=t.SAPVB)&&(t=t.Scenes)&&(i=JSON.stringify(t))&&i==this.mCurScenes&&delete e.SAPVB.Scenes;if(!n){this.mCurScenes=i?i:this.mCurScenes}i=null;n=(t=e)&&(t=t.SAPVB)&&(t=t.Actions)&&(i=JSON.stringify(t))&&i==this.mCurActions&&delete e.SAPVB.Actions;if(!n){this.mCurActions=i?i:this.mCurActions}i=null;n=(t=e)&&(t=t.SAPVB)&&(t=t.DataTypes)&&(i=JSON.stringify(t))&&i==this.mCurDataTypes&&delete e.SAPVB.DataTypes;if(!n){this.mCurDataTypes=i?i:this.mCurDataTypes}if(!this.bForceDataUpdate){i=null;n=(t=e)&&(t=t.SAPVB)&&(t=t.Data)&&(i=JSON.stringify(t))&&i==this.mCurData&&delete e.SAPVB.Data;if(!n){this.mCurData=i?i:this.mCurData}}else{this.bForceDataUpdate=false}return e};d.prototype._updateWindows=function(e){e.SAPVB.Windows={Set:[{name:"Main",Window:{id:"Main",caption:"MainWindow",type:"geo",refParent:"",refScene:"MainScene",modal:"true"}}]}};d.prototype._updateScene=function(e){var t=[];var i=[];var n=[];var a=[];this._updateVOData(t,i,n,a);var o=JSON.stringify(t);var r=true;if(!this.saVO){(((e.SAPVB.Scenes={}).Set={}).SceneGeo={id:"MainScene",scaleVisible:"false",navControlVisible:"false",VisualFrame:{minLOD:5},NavigationDisablement:{move:"true",zoom:"true"},initialZoom:this.initialZoom.toString(),initialStartPosition:"0.5;0.5;0"}).VO=t}else if(this.bRefMapLayerStackDirty||!(this.saVO===o)){e.SAPVB.Scenes=this._getSceneVOdelta(JSON.parse(this.m_saVO),t)}else{r=false}this.saVO=o;if(this.bDataDeltaUpdate){e.SAPVB.Data=[];for(var s=0;s<i.length;++s){e.SAPVB.Data.push({Set:{name:i[s].name,type:"N",N:i[s]}})}}else{((e.SAPVB.Data={}).Set={}).N=i}if(r){((e.SAPVB.DataTypes={}).Set={}).N=n}((e.SAPVB.Actions={}).Set={}).Action=a;this.bSceneDirty=this.bVosDirty=this.bDataDeltaUpdate=false};d.prototype._isEventRegistered=function(e,t){var i=this.getAggregation(e);if(!i){return false}for(var n=0;n<i.length;++n){var a=i[n];if(a.hasListeners(t)){return true}}return false};d.prototype._getTemplateBindingInfo=function(e){var t=this.getBindingInfo(e);if(t&&t.template){return t.template.mBindingInfos}return undefined};d.prototype._getBindInfo=function(e){var t={};var i=this._getTemplateBindingInfo(e);t.C=i?i.hasOwnProperty("color"):true;t.CB=i?i.hasOwnProperty("colorBorder"):true;t.DCH=i?i.hasOwnProperty("deltaColorHot"):true;t.CS=i?i.hasOwnProperty("colorSelect"):true;t.CNS=i?i.hasOwnProperty("colorNonSelect"):true;t.TT=i?i.hasOwnProperty("tooltip"):true;t.M=i?i.hasOwnProperty("changeable"):true;t.hasTemplate=i?true:false;return t};d.prototype._updateVOData=function(e,t,i,n){var a,o;this.AreaBindInfo=a=this.AreaBindInfo?this.AreaBindInfo:this._getBindInfo("areas");o=a.hasTemplate?this.getBindingInfo("areas").template:null;var r={id:"OverlayArea",datasource:"OverlayArea",type:"{00100000-2012-0004-B001-F311DE491C77}"};r["posarray.bind"]=r.id+".P";if(a.C){r["color.bind"]=r.id+".C"}else{r.color=o.getColor()}if(a.CB){r["colorBorder.bind"]=r.id+".C"}else{r.colorBorder=o.getColorBorder()}if(a.DCH){r["hotDeltaColor.bind"]=r.id+".DCH"}else{r.hotDeltaColor=o.getDeltaColorHot()}if(a.CS){r["colorSelect.bind"]=r.id+".C"}else{r.colorSelect=o.getColorSelect()}if(a.CNS){r["colorNonSelect.bind"]=r.id+".C"}else{r.colorNonSelect=o.getColorNonSelect()}if(!a.M){r["VB:c"]=o.getChangeable()}e.push(r);var s={name:r.id,key:"K"};s.A=[{name:"K",alias:"K",type:"string"},{name:"VB:s",alias:"VB:s",type:"boolean"},{name:"P",alias:"P",type:"vectorarray",changeable:"true"}];if(a.C){s.A.push({name:"C",alias:"C",type:"color"})}if(a.CB){s.A.push({name:"CB",alias:"CB",type:"string"})}if(a.DCH){s.A.push({name:"DCH",alias:"DCH",type:"string"})}if(a.CS){s.A.push({name:"CS",alias:"CS",type:"string"})}if(a.CNS){s.A.push({name:"CNS",alias:"CNS",type:"string"})}if(a.TT){s.A.push({name:"TT",alias:"TT",type:"string"})}i.push(s);var h=r.id;if(this._isEventRegistered("areas","click")){n.push({id:h+"1",name:"click",refScene:"MainScene",refVO:h,refEvent:"Click",AddActionProperty:[{name:"pos"}]})}if(this._isEventRegistered("areas","contextMenu")){n.push({id:h+"2",name:"contextMenu",refScene:"MainScene",refVO:h,refEvent:"ContextMenu"})}if(this._isEventRegistered("areas","edgeClick")){n.push({id:h+"7",name:"edgeClick",refScene:"MainScene",refVO:h,refEvent:"EdgeClick"})}n.push({id:h+"4",name:"handleMoved",refScene:"MainScene",refVO:h,refEvent:"HandleMoved"});n.push({id:h+"5",name:"handleContextMenu",refScene:"MainScene",refVO:h,refEvent:"HandleContextMenu"});n.push({id:h+"8",name:"edgeContextMenu",refScene:"MainScene",refVO:h,refEvent:"EdgeContextMenu"});if(this._isEventRegistered("areas","handleClick")){n.push({id:h+"6",name:"handleClick",refScene:"MainScene",refVO:h,refEvent:"HandleClick"})}var l={name:r.id,E:[]};var d=this.getAreas();for(var f=0;f<d.length;++f){l.E.push(d[f].getDataElement())}t.push(l)};d.prototype._getSceneVOdelta=function(e,t){var i=[];var n=[];var a={};for(var o=0,r=e.length;o<r;++o){a[e[o].id]=e[o]}for(var s=0;s<t.length;++s){if(a[t[s].id]){if(JSON.stringify(t[s])!=JSON.stringify(a[t[s].id])){n.push({id:t[s].id,type:"VO"});i.push(t[s])}}else{i.push(t[s])}delete a[t[s].id]}for(var h in a){n.push({id:h,type:"VO"})}var l={Merge:{name:"MainScene",type:"SceneGeo",SceneGeo:{id:"MainScene"}}};if(n.length){l.Merge.SceneGeo.Remove=n}if(i.length){l.Merge.SceneGeo.VO=i}return l};d.prototype._getActionArray=function(){var e=[];if(this.mEventRegistry["click"]){e.push({id:"Overlay1",name:"click",refScene:"MainScene",refVO:"Map",refEvent:"Click",AddActionProperty:[{name:"pos"}]})}if(this.mEventRegistry["contextMenu"]){e.push({id:"Overlay2",name:"contextMenu",refScene:"MainScene",refVO:"Map",refEvent:"ContextMenu",AddActionProperty:[{name:"pos"}]})}e.push({id:"Overlay3",name:"GetPosComplete",refScene:"MainScene",refVO:"General",refEvent:"CreateComplete"});return e};d.prototype._handleChangedData=function(e){try{this.bHandleDataChangeActive=true;if(e&&e.length){for(var t=0,i;t<e.length;++t){i=e[t];if(i.E&&i.E.length){for(var n=0,a,o;n<i.E.length;++n){a=i.E[n];o=this._findInstance(a.K);if(o){o.handleChangedData(a)}}}}}this.bHandleDataChangeActive=false}catch(e){this.bHandleDataChangeActive=false;throw e}};d.prototype._findInstance=function(e){var t=e.indexOf(".")!==-1?e.split(".")[1]:e;var i=this.getAreas();for(var n=0;n<i.length;++n){var a=i[n];if(a.getId()===t){return a}}return null};d.prototype._handleAggregationEvent=function(e){var t;if(t=this._findInstance(e.Action.instance)){try{t.handleEvent(e)}catch(e){l.error(s().getText(o.VIT11.summary),o.VIT11.code,"sap.ui.vk.Overlay")}}};d.prototype.isRendered=function(){return this.getDomRef()?true:false};d.prototype.fireSubmit=function(e){var t=JSON.parse(e.data);if(t.Data&&t.Data.Merge){this._handleChangedData(t.Data.Merge.N)}if(t.Action.object==="OverlayArea"){this._handleAggregationEvent(t)}else{var i=t.Action.name,n;if(i==="click"||i==="contextMenu"){n=[t.Action.Params.Param[0]["#"],t.Action.Params.Param[1]["#"]]}switch(i){case"GetPosComplete":if(this.mIACreateCB){try{this.mIACreateCB(t.Action.Params.Param[0]["#"]);this.mIACreateCB=null}catch(e){this.mIACreateCB=null;throw e}}break;case"click":this.fireClick({clientX:n[0],clientY:n[1],pos:t.Action.AddActionProperties.AddActionProperty[0]["#"]});break;case"contextMenu":if(this.mVBIContext.m_Menus){this.mVBIContext.m_Menus.deleteMenu("DynContextMenu")}var o=new a;o["vbi_data"]={};o["vbi_data"].menuRef="CTM";o["vbi_data"].VBIName="DynContextMenu";this.mClickPos=n;this.fireContextMenu({pos:t.Action.AddActionProperties.AddActionProperty[0]["#"],menu:o});break;default:break}}};d.prototype.fireRender=function(e){};d.prototype.fireMove=function(e){};d.prototype.fireZoom=function(e){};d.prototype.fireOpenWindow=function(e){};d.prototype.fireCloseWindow=function(e){};return d});
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/OverlayArea", ["sap/ui/core/Element","sap/ui/unified/Menu","sap/ui/unified/MenuItem","./getResourceBundle"],function(e,t,i,n){"use strict";var a=e.extend("sap.ui.vk.OverlayArea",{metadata:{library:"sap.ui.vk",properties:{key:{type:"string",group:"Misc",defaultValue:null},position:{type:"string",group:"Misc",defaultValue:null},color:{type:"sap.ui.core.CSSColor",group:"Misc",defaultValue:"rgba(200, 50, 50, 0.3)"},colorBorder:{type:"sap.ui.core.CSSColor",group:"Misc",defaultValue:"rgba(200, 50, 50, 1.0)"},colorSelect:{type:"string",group:"Misc",defaultValue:null},colorNonSelect:{type:"string",group:"Misc",defaultValue:null},deltaColorHot:{type:"string",group:"Misc",defaultValue:"RHLSA(0;1.3;1.0;1.0)"},select:{type:"boolean",group:"Misc",defaultValue:false},changeable:{type:"boolean",group:"Misc",defaultValue:false}},events:{click:{clientX:{type:"int"},clientY:{type:"int"}},contextMenu:{parameters:{menu:{type:"sap.ui.unified.Menu"}}},edgeClick:{parameters:{index:{type:"int"}}},edgeContextMenu:{parameters:{index:{type:"int"},menu:{type:"sap.ui.unified.Menu"}}},handleMoved:{},handleContextMenu:{parameters:{index:{type:"int"},menu:{type:"sap.ui.unified.Menu"}}},handleClick:{index:{type:"int"}}}}});a.prototype.openContextMenu=function(e){this.getParent().openContextMenu("OverlayArea",this,e)};a.prototype.getDataElement=function(){var e={};var t=this.getParent().AreaBindInfo;e.K=this.getId();if(t.C){e.C=this.getColor()}if(t.CB){e.CB=this.getColorBorder()}if(t.DCH){e.DCH=this.getDeltaColorHot()}if(t.CS){e.CS=this.getColorSelect()}if(t.CNS){e.CNS=this.getColorNonSelect()}if(t.TT){e.TT=this.getTooltip()}e["VB:s"]=this.getSelect();e.P=this.getPosition();if(t.M){e["VB:c"]=this.getChangeable()}return e};a.prototype.handleChangedData=function(e){if(e.P){this.setPosition(e.P)}};a.prototype.handleEvent=function(e){var a=e.Action.name;var o="fire"+a[0].toUpperCase()+a.slice(1);if(a==="contextMenu"||a==="edgeContextMenu"||a==="handleContextMenu"){var r=this.getParent();this.mClickPos=[e.Action.Params.Param[0]["#"],e.Action.Params.Param[1]["#"]];if(r.mVBIContext.m_Menus){r.mVBIContext.m_Menus.deleteMenu("DynContextMenu")}var s=new t;s["vbi_data"]={};s["vbi_data"].menuRef="CTM";s["vbi_data"].VBIName="DynContextMenu";if(this.getChangeable()){if(a==="edgeContextMenu"){var l=e.Action.Params.Param[2]["#"];r.mAddMenuItems.push(new i({text:n().getText("OVL_AREA_EDGE_SPLIT"),select:this._handleCtxFunction.bind(this,"SPLIT",l)}))}else if(a==="handleContextMenu"){var u=e.Action.Params.Param[2]["#"];r.mAddMenuItems.push(new i({text:n().getText("OVL_AREA_HANDLE_REMOVE"),select:this._handleCtxFunction.bind(this,"REMOVE",u)}))}}if(this.hasListeners(a)){if(a==="contextMenu"){this.firecontextMenu({menu:s})}else{this[o]({index:e.Action.Params.Param[2]["#"],menu:s})}}else{r._openContextMenu(e.Action.object,this,s)}}else if(a=="click"){this.mClickPos=e.Action.AddActionProperties.AddActionProperty[0]["#"];this.fireClick({clientX:e.Action.Params.Param[0]["#"],clientY:e.Action.Params.Param[1]["#"]})}else if(a.indexOf("Click")>-1){this[o]({index:e.Action.Params.Param[2]["#"]})}else{this[o]()}};a.prototype.getKey=function(){var e=this.getProperty("key");if(!e){e=this.getId()}return e};a.prototype._handleCtxFunction=function(e,t){var i=this.getPosition().split(";");var n=t*3;if(e==="REMOVE"){i.splice(n,3)}else if(e==="SPLIT"){var a=[i[n],i[n+1]];var o=n+3<i.length?[i[n+3],i[n+4]]:[i[0],i[1]];var r=[parseFloat(a[0])+(o[0]-a[0])/2,parseFloat(a[1])+(o[1]-a[1])/2];i.splice(n+3,0,r[0].toString(),r[1].toString(),"0")}this.setPosition(i.toString().replace(/,/g,";"))};return a});
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/OverlayRenderer", function(){"use strict";var e={apiVersion:2};e.render=function(e,i){e.openStart("div",i);e.class("sapUiVkOverlay");e.openEnd();e.close("div");var n;if(n=i._update()){i._load(n)}};return e},true);
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/PerspectiveCamera", ["./Camera"],function(e){"use strict";var a=e.extend("sap.ui.vk.PerspectiveCamera",{metadata:{library:"sap.ui.vk",properties:{fov:{type:"float"}}}});return a});
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/ProgressIndicator", ["sap/m/ProgressIndicator","./ProgressIndicatorRenderer"],function(r,e){"use strict";var s=r.extend("sap.ui.vk.ProgressIndicator");return s});
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/ProgressIndicatorRenderer", ["sap/m/ProgressIndicatorRenderer"],function(e){"use strict";return e},true);
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/Redline", [],function(){"use strict";var e={ElementType:{Line:"line",Rectangle:"rectangle",Ellipse:"ellipse",Freehand:"freehand",Text:"text",Comment:"comment"},svgNamespace:"http://www.w3.org/2000/svg"};return e},true);
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/RedlineCollaboration", ["sap/ui/core/Element","./Core","sap/ui/vk/tools/RedlineTool","./RedlineConversation","sap/ui/vk/uuidv4","sap/ui/vk/RedlineUpgradeManager"],function(e,t,i,n,o,r){"use strict";var s=e.extend("sap.ui.vk.RedlineCollaboration",{metadata:{library:"sap.ui.vk",aggregations:{conversations:{singularName:"conversation",type:"sap.ui.vk.RedlineConversation",multiple:true}},associations:{viewport:{type:"sap.ui.vk.Viewport",multiple:false},activeConversation:{type:"sap.ui.vk.RedlineConversation",multiple:false},activeComment:{type:"sap.ui.vk.RedlineComment",multiple:false}},events:{elementCreated:{parameters:{element:"object"}},elementClicked:{parameters:{elementId:"string"}},elementHovered:{parameters:{elementId:"string"}},conversationActivating:{parameters:{conversation:"sap.ui.vk.RedlineConversation"}},conversationActivated:{parameters:{conversation:"sap.ui.vk.RedlineConversation",viewportLocked:"boolean"}}}},constructor:function(t,i){e.apply(this,arguments);if(typeof t==="object"){i=t;t=undefined}this._elementId=i&&i.elementId?i.elementId:o()}});s.prototype.init=function(){this._header=new Map};s.prototype.exit=function(){if(this._tool){this._tool.setActive(false);this._tool.destroy();this._tool=null}var t=e.getElementById(this.getViewport());if(t){if(t.dettachCameraChanged){t.dettachCameraChanged(this._onCameraChanged,this)}var i=t.getMeasurementSurface();i.detachMeasurementsAdded(this._onmMeasurementsAdded,this);i.detachMeasurementsRemoving(this._onMeasurementsRemoving,this);i.detachScaleChanged(this._onMeasurementsScaleChanged,this)}};s.prototype.getElementId=function(){return this._elementId};s.prototype.setViewport=function(e){this.setAssociation("viewport",e);if(!this._tool){this._tool=new i;this._tool.attachElementCreated(this._onElementCreated,this);this._tool.attachElementClicked(this._onElementClicked,this);this._tool.attachElementHovered(this._onElementHovered,this)}else{this._tool.setActive(false,e)}e.addTool(this._tool);if(e.attachCameraChanged){e.attachCameraChanged(this._onCameraChanged,this)}var t=e.getMeasurementSurface();t?.attachMeasurementsAdded(this._onMeasurementsAdded,this);t?.attachMeasurementsRemoving(this._onMeasurementsRemoving,this);t?.attachScaleChanged(this._onMeasurementsScaleChanged,this);return this};s.prototype._onCameraChanged=function(){const t=e.getElementById(this.getActiveConversation());if(t?.getViewInfo()){t.setViewInfo(this._getViewInfo())}};s.prototype._onMeasurementsAdded=function(t){var i=t.getParameter("measurements");if(this.getActiveConversation()){var n=e.getElementById(this.getActiveConversation());var o;if(this.getActiveComment()){o=e.getElementById(this.getActiveComment())}i.forEach(function(e){var t=e.toJSON();n.addMeasurement(t);if(o){o.addMeasurement(t.id)}},this)}};s.prototype._onMeasurementsRemoving=function(t){var i=t.getParameter("measurements");if(this.getActiveConversation()){var n=e.getElementById(this.getActiveConversation());i.forEach(function(e){var t=e.getId();n.removeMeasurement(t);var i=n.getComments();i.forEach(function(e){e.removeMeasurement(t)})})}};s.prototype._onMeasurementsScaleChanged=function(t){var i=t.getParameter("newScale");if(this.getActiveConversation()){var n=e.getElementById(this.getActiveConversation());n.setMeasurementScale(i)}};s.prototype._onElementHovered=function(e){this.fireElementHovered({elementId:e.getParameter("elementId")})};s.prototype._onElementCreated=function(t){var i=t.getParameter("element");if(i){if(this.getActiveConversation()){var n=e.getElementById(this.getActiveConversation());n.addContent(i);this._tool.destroyRedlineElements();n._activate(this._tool)}if(this.getActiveComment()){var o=e.getElementById(this.getActiveComment());o.addContent(i)}}this.fireElementCreated({element:i})};s.prototype._onElementClicked=function(e){this.fireElementClicked({elementId:e.getParameter("elementId")})};s.prototype.setHeaderProperty=function(e,t){this._header.set(e,t);return this};s.prototype.getHeaderProperty=function(e){return this._header.get(e)};s.prototype.removeHeaderProperty=function(e){this._header.delete(e);return this};s.prototype.createConversation=function(e){var t=new n({conversationName:e});this.addConversation(t);this.setActiveConversation(t);return t};s.prototype.setActiveConversation=function(i,n=true){var o=e.getElementById(this.getActiveConversation());if(o){if(n&&o.getViewInfo()){o.setViewInfo(this._getViewInfo())}o._deactivate()}this.setAssociation("activeConversation",i);var r=e.getElementById(this.getViewport());if(!r){return this}if(!i){this._tool.setActive(false,r);return this}this.fireConversationActivating({conversation:i});this._tool.destroyRedlineElements();if(r.isA("sap.ui.vk.pdf.Viewport")){const e=i.getPageId();if(e>=0){r.setCurrentPageIndex(e)}if(!this._tool.getActive()){this._tool.setActive(true,r)}}else if(i.getViewInfo()){var s=e.getElementById(r.getContentConnector()).getContent();const o=s.getViews().find(e=>e.getViewId()===i.getViewId());if(o&&n){t.getEventBus().subscribe("sap.ui.vk","readyForAnimation",this._readyForAnimation,this);var a=e.getElementById(r.getViewStateManager());var l=e.getElementById(a.getViewManager());this._activatingView=true;if(this._tool.getActive()){this._tool.setActive(false,r)}l.activateView(o,true,true);this._tool.setActive(true,r)}else{if(!this._tool.getActive()){this._tool.setActive(true,r)}r.setViewInfo(i.getViewInfo())}}else if(this._tool.getActive()){this._tool.setActive(false,r)}if(i.getContent()){i._activate(this._tool)}if(i.getMeasurements()){var h=i.getMeasurements();r.getMeasurementSurface()?.fromJSON({measurements:h,scale:i.getMeasurementScale()},true);r.setShouldRenderFrame()}this.fireConversationActivated({conversation:i,viewportLocked:this._tool.getActive()});return this};s.prototype._readyForAnimation=function(){var i=e.getElementById(this.getViewport());if(!i){return}var n=e.getElementById(this.getActiveConversation());if(n){var o=e.getElementById(i.getViewStateManager()).getAnimationPlayer();o.setTime(n.getAnimationOffset());var r=n.getViewInfo();if(i.getCamera()&&i.getCamera().getCameraRef()){var s=i.getCamera().getCameraRef();if(r.camera.view&&s&&!s.view){s.view=r.camera.view;s.view.enabled=true}}i.setViewInfo(r)}this._activatingView=false;t.getEventBus().unsubscribe("sap.ui.vk","readyForAnimation",this._readyForAnimation,this)};s.prototype.createElement=function(t){var i=e.getElementById(this.getActiveConversation());var n=e.getElementById(this.getViewport());if(!n){return t}if(i){if(n.isA("sap.ui.vk.pdf.Viewport")){i.setPageId(n.getCurrentPageIndex())}else if(!i.getViewInfo()){i.setViewId(n.getCurrentView().getViewId());i.setViewInfo(this._getViewInfo());i.setAnimationOffset(e.getElementById(n.getViewStateManager()).getAnimationPlayer().getTime())}}if(!this._tool.getActive()){this._tool.setActive(true,n)}this._tool.startAdding(t);return t};s.prototype.deactivateRedlineDrawing=function(){if(this._tool){this._tool.stopAdding()}return this};s.prototype.removeElement=function(t){var i=e.getElementById(this.getActiveConversation());if(i){i.removeContent(t);this._tool.destroyRedlineElements();i._activate(this._tool)}return this};s.prototype._normalizeElementsArray=function(e){var t=[];var i=this.getActiveRedlineElements();if(Array.isArray(e)){for(var n=0;n<e.length;n++){if(e[n]instanceof sap.ui.vk.RedlineElement){t.push(e[n])}else{for(var o=0;o<i.length;o++){if(e[n]===i[o].getElementId()){t.push(i[o])}}}}}else if(e instanceof sap.ui.vk.RedlineElement){t.push(e)}else{for(var r=0;r<i.length;r++){if(e===i[r].getElementId()){t.push(i[r])}}}return t};s.prototype.setHighlight=function(e,t){if(!e){return this}var i=this._normalizeElementsArray(e);for(var n=0;n<i.length;n++){var o=i[n];o.setHalo(true);if(t){o.setHaloColor(t)}else if(this._tool._haloColor){o.setHaloColor(this._tool._haloColor)}else{o.setHaloColor("rgba(255, 0, 0, 1)")}}this._tool.getGizmo().rerender();return this};s.prototype.setDefaultHighlightColor=function(e){if(e){this._tool._haloColor=e}return this};s.prototype.clearHighlight=function(e){if(!e){return this}var t=this._normalizeElementsArray(e);for(var i=0;i<t.length;i++){t[i].setHalo(false)}this._tool.getGizmo().rerender();return this};s.prototype.addStyleClass=function(e){if(e&&this._tool){this._tool.getGizmo().addStyleClass(e)}return this};s.prototype.removeStyleClass=function(e){if(e&&this._tool){this._tool.getGizmo().removeStyleClass(e)}return this};s.prototype.toggleStyleClass=function(e){if(e&&this._tool){this._tool.getGizmo().toggleStyleClass(e)}return this};s.prototype._getViewInfo=function(){var t=e.getElementById(this.getViewport());if(!t||t.isA("sap.ui.vk.pdf.Viewport")){return null}var i={camera:{matrices:true},visibility:true,selection:true};var n=t.getViewInfo(i);return n};s.prototype.freezeView=function(){var t=e.getElementById(this.getActiveConversation());var i=e.getElementById(this.getViewport());if(!i){return this}if(!this._tool.getActive()){this._tool.setActive(true,i)}if(t){if(i.isA("sap.ui.vk.pdf.Viewport")){t.setPageId(i.getCurrentPageIndex())}else if(!t.getViewInfo()){t.setViewId(i.getCurrentView().getViewId());t.setViewInfo(this._getViewInfo());t.setAnimationOffset(e.getElementById(i.getViewStateManager()).getAnimationPlayer().getTime())}}return this};s.prototype.unfreezeView=function(){var t=e.getElementById(this.getActiveConversation());if(t){var i=t.getComments();if(this._tool.getActive()&&this._tool.getRedlineElements().length===0&&(i.length===0||i.length===1&&!i[0].getText())){this._tool.setActive(false);t.setViewInfo(null)}}return this};s.prototype.getActiveRedlineElements=function(){if(this._tool){var e=this._tool.getRedlineElements();return e}return[]};s.prototype._createConversationFromJSON=function(e){var t=new n;var i=t.importJSON(e);this.addConversation(t);return i};s.prototype.importJSON=function(e){e=r.upgrade(e);var t=new Set;this.setActiveConversation(null);this.destroyConversations();this.setActiveComment(null);var i=Object.entries(e.header);for(var n=0;n<i.length;n++){this.setHeaderProperty(i[n][0],i[n][1])}this._elementId=this.getHeaderProperty("elementId");var o=e.conversations;if(o){for(var s=0;s<o.length;s++){var a=this._createConversationFromJSON(o[s]);a.forEach(t.add,t)}}var l=this.getHeaderProperty("initialConversation");var h=this.getConversations();var v;if(h){for(var g=0;g<h.length;g++){if(h[g].getElementId()===l){v=h[g];break}}}this.setActiveConversation(v);return t};s.prototype.exportJSON=function(){const t=e.getElementById(this.getActiveConversation())?.getElementId()??"";this.setHeaderProperty("initialConversation",t);if(!this.getHeaderProperty("elementId")){this.setHeaderProperty("elementId",this._elementId)}var i={schemaVersion:"1.0",header:Object.fromEntries(this._header),conversations:this.getConversations().map(e=>e.exportJSON())};return i};return s});
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/RedlineConversation", ["sap/ui/core/Element","sap/ui/base/ManagedObjectObserver","sap/ui/vk/uuidv4","sap/ui/vk/RedlineElementComment"],function(e,t,n,s){"use strict";var i=e.extend("sap.ui.vk.RedlineConversation",{metadata:{library:"sap.ui.vk",properties:{conversationName:{type:"string"},timestamp:{type:"int"},viewId:{type:"string",defaultValue:""},viewInfo:{type:"any",defaultValue:null},animationOffset:{type:"float",defaultValue:0},measurementScale:{type:"float",defaultValue:1},pageId:{type:"int",defaultValue:-1}},aggregations:{comments:{singularName:"comment",type:"sap.ui.vk.RedlineElementComment",multiple:true}}},constructor:function(t,s){e.apply(this,arguments);if(typeof t==="object"){s=t;t=undefined}this._elementId=s&&s.elementId?s.elementId:n()}});i.prototype.getElementId=function(){return this._elementId};i.prototype.addContent=function(e){if(!this._elements){this._elements=new Map}var t;var n;if(e instanceof sap.ui.vk.RedlineElement){t=e.getElementId();n=e.exportJSON()}else{t=e.elementId;n=e}this._elements.set(t,n);return this};i.prototype.removeContent=function(e){if(this._elements){var t;if(e instanceof sap.ui.vk.RedlineElement){t=e.getElementId()}else if(typeof e==="string"){t=e}else{t=e.elementId}this._elements.delete(t)}return this};i.prototype.getContent=function(){var e=[];if(this._elements){e=Array.from(this._elements.values())}return e};i.prototype.addMeasurement=function(e){if(!this._measurements){this._measurements=new Map}this._measurements.set(e.id,e);return this};i.prototype.removeMeasurement=function(e){if(this._measurements){var t;if(typeof e==="string"){t=e}else{t=e.id}this._measurements.delete(t)}return this};i.prototype.getMeasurements=function(){var e=[];if(this._measurements){e=Array.from(this._measurements.values())}return e};i.prototype._activate=function(e){var n=this;if(!this._objectObserver){var s=function(e){if(e.type==="property"){n.addContent(e.object)}};this._objectObserver=new t(s)}this._objectObserver.disconnect();e.importJSON(this.getContent());var i=e.getRedlineElements();for(var r=0;r<i.length;r++){this._objectObserver.observe(i[r],{properties:true})}};i.prototype._deactivate=function(){if(this._objectObserver){this._objectObserver.disconnect()}};i.prototype._createCommentFromJSON=function(e){var t=new s;var n=t.importJSON(e);this.addComment(t);return n};i.prototype.exportJSON=function(){if(this.getContent()){this.getContent().forEach(function(e){if(!e.createTimestamp){e.createTimestamp=Date.now()}if(e.deletedByUser){e.deleteTimestamp=Date.now()}})}const e={conversationId:this.getElementId(),conversationName:this.getConversationName(),timestamp:this.getTimestamp()?this.getTimestamp():Date.now(),measurementScale:this.getMeasurementScale(),comments:this.getComments().map(function(e){return e.exportJSON()}),content:this.getContent(),measurements:this.getMeasurements()};const t=this.getPageId();if(t>=0){e.pageId=t}else{e.sceneView=this.getViewId();e.viewInfo=this.getViewInfo();e.animationOffset=this.getAnimationOffset()}return e};i.prototype.importJSON=function(e){var t=new Set;if(e.hasOwnProperty("conversationId")){this._elementId=e.conversationId}if(e.hasOwnProperty("conversationName")){this.setConversationName(e.conversationName)}if(e.hasOwnProperty("timestamp")){this.setTimestamp(e.timestamp)}if(e.hasOwnProperty("sceneView")){this.setViewId(e.sceneView)}if(e.hasOwnProperty("viewInfo")){this.setViewInfo(e.viewInfo)}if(e.hasOwnProperty("animationOffset")){this.setAnimationOffset(e.animationOffset)}if(e.hasOwnProperty("measurementScale")){this.setMeasurementScale(e.measurementScale)}if(e.hasOwnProperty("comments")){var n=e.comments;if(n){for(var s=0;s<n.length;s++){var i=this._createCommentFromJSON(n[s]);if(i){t.add(i)}}}}if(e.hasOwnProperty("content")){var r=e.content;if(r){for(var a=0;a<r.length;a++){var o=r[a].createdByUser;if(o){t.add(o)}var m=r[a].deletedByUser;if(m){t.add(m)}this.addContent(r[a])}}}if(e.hasOwnProperty("measurements")){var f=e.measurements;if(f){for(var p=0;p<f.length;p++){this.addMeasurement(f[p])}}}if(e.hasOwnProperty("pageId")){this.setPageId(e.pageId)}return t};return i});
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/RedlineDesign", ["sap/ui/core/Control","./RedlineSurface","./RedlineElement","./RedlineGesturesHandler","./RedlineDesignHandler","./Loco","./RedlineDesignRenderer"],function(e,t,i,n,s,o,r){"use strict";var a=t.extend("sap.ui.vk.RedlineDesign",{metadata:{library:"sap.ui.vk",events:{elementCreated:{parameters:{element:"object"}}},aggregations:{activeElementInstance:{type:"sap.ui.vk.RedlineElement",multiple:false,visibility:"hidden"}}}});a.prototype.init=function(){this._isAddingModeActive=false;this._isDrawingOn=false;this._activeElementInstance=null;this.addStyleClass("sapUiVizkitRedlineInteractionMode");this._gestureHandler=new n(this);this._designHandler=new s(this);this._loco=new o(this)};a.prototype.exit=function(){this._loco.destroy();this._loco=null;t.prototype.exit?.call(this)};a.prototype.onBeforeRendering=function(){if(this._loco){this._loco.removeHandler(this._gestureHandler);this._loco.removeHandler(this._designHandler)}};a.prototype.onAfterRendering=function(){var e=this.getDomRef();e.style.width="100%";e.style.height="100%";if(this._isAddingModeActive){this._loco.addHandler(this._designHandler)}else{this._loco.addHandler(this._gestureHandler)}this.updatePanningRatio()};a.prototype.startAdding=function(e){this._isAddingModeActive=true;this._activeElementInstance=e;this.setAggregation("activeElementInstance",this._activeElementInstance);this.addStyleClass("sapUiVizkitRedlineDesignMode");this.removeStyleClass("sapUiVizkitRedlineInteractionMode");return this};a.prototype.stopAdding=function(){this._isAddingModeActive=false;this._isDrawingOn=false;this.setAggregation("activeElementInstance",null);this._activeElementInstance=null;this.addStyleClass("sapUiVizkitRedlineInteractionMode");this.removeStyleClass("sapUiVizkitRedlineDesignMode");return this};a.prototype._getOffset=function(e){var t=e.getBoundingClientRect();return{x:t.left+window.pageXOffset,y:t.top+window.pageYOffset}};a.prototype._getTargetViewport=function(){return this._targetViewport};a.prototype._setTargetViewport=function(e){this._targetViewport=e;this._targetViewport.attachEvent("resize",this,this._onresize,this)};a.prototype._onresize=function(e){var t=e.oSource.getOutputSize();this.setProperty("virtualLeft",t.left,true);this.setProperty("virtualTop",t.top,true);this.setProperty("virtualSideLength",t.sideLength,true);this.invalidate()};return a});
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/RedlineDesignHandler", ["sap/ui/base/EventProvider","sap/ui/core/RenderManager","sap/ui/core/ResizeHandler"],function(e,t,n){"use strict";var i=e.extend("sap.ui.vk.RedlineDesignHandler",{metadata:{library:"sap.ui.vk",publicMethods:["beginGesture","move","endGesture","click","doubleClick","contextMenu","getViewport"]},constructor:function(e){this._redlineDesign=e;this._x=0;this._y=0;this._gesture=false}});i.prototype.destroy=function(){this._redlineDesign=null;this._rect=null;this._gesture=false};i.prototype._getOffset=function(e){var t=e.getBoundingClientRect();return{x:t.left+window.pageXOffset,y:t.top+window.pageYOffset}};i.prototype._inside=function(e,t){var n=t.getDomRef(),i=false;if(n!==null){var r=this._getOffset(n);var s={x:r.x,y:r.y,width:n.getBoundingClientRect().width,height:n.getBoundingClientRect().height};i=e.x>=s.x&&e.x<=s.x+s.width&&e.y>=s.y&&e.y<=s.y+s.height}return i};i.prototype._onresize=function(e){this._gesture=false};i.prototype.beginGesture=function(e){var n=this.getViewport();if(this._inside(e,n)&&n._activeElementInstance){this._gesture=true;this._x=e.x;this._y=e.y;n._isDrawingOn=true;var i=n.getDomRef();var r=n._toVirtualSpace(e.x-i.getBoundingClientRect().left-window.pageXOffset,e.y-i.getBoundingClientRect().top-window.pageYOffset);n._activeElementInstance.setOriginX(r.x);n._activeElementInstance.setOriginY(r.y);var s=(new t).getInterface();n._activeElementInstance.render(s);s.flush(n.getDomRef(),false,true);s.destroy();var a=n.$();a.html(a.html());e.handled=true}return this};i.prototype.move=function(e){var t=this.getViewport();if(t._activeElementInstance&&t._isDrawingOn){var n=t.getDomRef().getBoundingClientRect(),i=e.x-n.left-window.pageXOffset,r=e.y-n.top-window.pageYOffset;t._activeElementInstance.edit(i,r);e.handled=true}return this};i.prototype.endGesture=function(e){var t=this.getViewport();this._gesture=false;if(t._activeElementInstance){t.addRedlineElement(t._activeElementInstance);t.fireElementCreated({element:t._activeElementInstance});t.stopAdding();e.handled=true}return this};i.prototype.contextMenu=function(e){e.handled=true};i.prototype.getViewport=function(){return this._redlineDesign};return i});
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/RedlineDesignRenderer", ["./RedlineSurfaceRenderer","sap/ui/core/Renderer"],function(e,n){"use strict";var r=n.extend(e);r.apiVersion=2;r.render=function(n,r){e.render.call(this,n,r)};r.renderAfterRedlineElements=function(e,n){if(n._activeElementInstance&&n._isDrawingOn){n._activeElementInstance.render(e)}};return r},true);
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/RedlineElement", ["sap/ui/core/Element","sap/ui/vk/uuidv4"],function(t,e){"use strict";var r=t.extend("sap.ui.vk.RedlineElement",{metadata:{library:"sap.ui.vk",properties:{originX:{type:"float",defaultValue:0},originY:{type:"float",defaultValue:0},opacity:{type:"float",defaultValue:1},strokeWidth:{type:"float",defaultValue:2},strokeColor:{type:"sap.ui.core.CSSColor",defaultValue:"#e6600d"},strokeDashArray:{type:"float[]",defaultValue:[]},halo:{type:"boolean",defaultValue:false},haloColor:{type:"string",defaultValue:"rgba(255, 0, 0, 1)"},createdByUser:{type:"any",defaultValue:""},createTimestamp:{type:"int",defaultValue:null},deletedByUser:{type:"any",defaultValue:""},deleteTimestamp:{type:"int",defaultValue:null},suppress:{type:"boolean",defaultValue:false},elementId:{type:"string",defaultValue:null}}},constructor:function(r,i){t.apply(this,arguments);if(typeof r==="object"){i=r;r=undefined}this.setElementId(i&&i.elementId?i.elementId:e())}});r.prototype.applyZoom=function(){};r.prototype.render=function(t){this.renderElement(t,this.getHalo())};r.prototype.renderElement=function(t,e){};r.prototype._colorToArray=function(t){var e=t.replace(/[^\d,.]/g,"").split(",");if(!e[3]){e.push(1)}return e};r.prototype._getHaloFilter=function(t){var e=this._colorToArray(this.getHaloColor());var r=e.join("");return"url(#halo"+r+")"};r.prototype.setHalo=function(t){this.setProperty("halo",t,true);var e=this.getDomRef();if(e){if(t){e.setAttribute("filter",this._getHaloFilter())}else{e.removeAttribute("filter")}}};r.prototype.exportJSON=function(){var t={originX:this.getOriginX(),originY:this.getOriginY(),opacity:this.getOpacity(),strokeColor:this.getStrokeColor(),strokeWidth:this.getStrokeWidth(),elementId:this.getElementId(),halo:this.getHalo(),haloColor:this.getHaloColor(),createdByUser:this.getCreatedByUser(),createTimestamp:this.getCreateTimestamp(),deletedByUser:this.getDeletedByUser(),deleteTimestamp:this.getDeleteTimestamp(),suppress:this.getSuppress()};if(this.getStrokeDashArray().length>0){t["strokeDashArray"]=this.getStrokeDashArray()}return t};r.prototype.importJSON=function(t){if(t.hasOwnProperty("originX")){this.setOriginX(t.originX)}if(t.hasOwnProperty("originY")){this.setOriginY(t.originY)}if(t.hasOwnProperty("opacity")){this.setOpacity(t.opacity)}if(t.hasOwnProperty("strokeColor")){this.setStrokeColor(t.strokeColor)}if(t.hasOwnProperty("strokeWidth")){this.setStrokeWidth(t.strokeWidth)}if(t.hasOwnProperty("strokeDashArray")){this.setStrokeDashArray(t.strokeDashArray)}if(t.hasOwnProperty("elementId")){this.setElementId(t.elementId)}if(t.hasOwnProperty("halo")){this.setHalo(t.halo)}if(t.hasOwnProperty("haloColor")){this.setHaloColor(t.haloColor)}if(t.hasOwnProperty("createdByUser")){this.setCreatedByUser(t.createdByUser)}if(t.hasOwnProperty("createTimestamp")){this.setCreateTimestamp(t.createTimestamp)}if(t.hasOwnProperty("deletedByUser")){this.setDeletedByUser(t.deletedByUser)}if(t.hasOwnProperty("deleteTimestamp")){this.setDeleteTimestamp(t.deleteTimestamp)}if(t.hasOwnProperty("suppress")){this.setSuppress(t.suppress)}return this};r.prototype.exportSVG=function(){return null};r.prototype.importSVG=function(t){if(t.getAttribute("x")){this.setOriginX(parseFloat(t.getAttribute("x")))}if(t.getAttribute("y")){this.setOriginY(parseFloat(t.getAttribute("y")))}if(t.getAttribute("opacity")){this.setOpacity(parseFloat(t.getAttribute("opacity")))}if(t.getAttribute("stroke")){this.setStrokeColor(t.getAttribute("stroke"))}if(t.getAttribute("stroke-width")){this.setStrokeWidth(parseFloat(t.getAttribute("stroke-width")))}if(t.getAttribute("stroke-dasharray")){this.setStrokeDashArray(t.getAttribute("stroke-dasharray").split(",").map(parseFloat))}if(t.getAttribute("data-sap-element-id")){this.setElementId(t.getAttribute("data-sap-element-id"))}this.setHalo(t.getAttribute("data-sap-halo")==="true");return this};return r});
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/RedlineElementComment", ["sap/ui/core/Element","sap/ui/vk/uuidv4"],function(e,t){"use strict";var n=e.extend("sap.ui.vk.RedlineElementComment",{metadata:{library:"sap.ui.vk",properties:{text:{type:"string",defaultValue:""},createdByUser:{type:"any",defaultValue:""},createTimestamp:{type:"int",defaultValue:null}}},constructor:function(n,s){e.apply(this,arguments);if(typeof n==="object"){s=n;n=undefined}this._elementId=s&&s.elementId?s.elementId:t()}});n.prototype.getElementId=function(){return this._elementId};n.prototype.getContent=function(){if(!this._elements){this._elements=new Set}var e=Array.from(this._elements);return e};n.prototype.addContent=function(e){if(!this._elements){this._elements=new Set}if(e instanceof sap.ui.vk.RedlineElement){var t=e.getElementId();this._elements.add(t)}else{this._elements.add(e)}return this};n.prototype.removeContent=function(e){if(this._elements){var t;if(e instanceof sap.ui.vk.RedlineElement){t=e.getElementId()}else{t=e}this._elements.delete(t)}return this};n.prototype.addMeasurement=function(e){if(!this._measurements){this._measurements=new Set}this._measurements.add(e);return this};n.prototype.getMeasurements=function(){if(!this._measurements){this._measurements=new Set}var e=Array.from(this._measurements);return e};n.prototype.removeMeasurement=function(e){if(this._measurements){this._measurements.delete(e)}return this};n.prototype.clearContent=function(){if(this._elements){this._elements.clear()}return this};n.prototype.exportJSON=function(){var e={elementId:this.getElementId(),createdByUser:this.getCreatedByUser(),createTimestamp:this.getCreateTimestamp()?this.getCreateTimestamp():Date.now(),text:this.getText(),content:this.getContent(),measurements:this.getMeasurements()};return e};n.prototype.importJSON=function(e){if(e.hasOwnProperty("elementId")){this._elementId=e.elementId}if(e.hasOwnProperty("createTimestamp")){this.setCreateTimestamp(e.createTimestamp)}if(e.hasOwnProperty("text")){this.setText(e.text)}if(e.hasOwnProperty("content")){var t=e.content;if(t){for(var n=0;n<t.length;n++){this.addContent(t[n])}}}if(e.hasOwnProperty("createdByUser")){this.setCreatedByUser(e.createdByUser);return e.createdByUser}if(e.hasOwnProperty("measurements")){var s=e.measurements;if(s){for(var r=0;r<s.length;r++){this.addMeasurement(s[r])}}}return undefined};return n});
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/RedlineElementEllipse", ["./RedlineElement","./Redline","sap/base/Log"],function(t,e,i){"use strict";var r=t.extend("sap.ui.vk.RedlineElementEllipse",{metadata:{library:"sap.ui.vk",properties:{radiusX:{type:"float",defaultValue:1e-4},radiusY:{type:"float",defaultValue:1e-4},fillColor:{type:"sap.ui.core.CSSColor",defaultValue:"rgba(0, 0, 0, 0)"}}}});r.prototype.edit=function(t,e,i){var r=this.getParent(),s=r._toVirtualSpace(t,e),a=Math.abs(s.x-this._initialX),o=Math.abs(s.y-this._initialY);if(i){a=o=Math.max(a,o)}this.setOriginX((s.x+this._initialX)/2);this.setOriginY((s.y+this._initialY)/2);this.setRadiusX(a*.5);this.setRadiusY(o*.5);return this};r.prototype.applyZoom=function(t){this.setProperty("radiusX",this.getRadiusX()*t,true);this.setProperty("radiusY",this.getRadiusY()*t,true);return this};r.prototype.setRadiusX=function(t){this.setProperty("radiusX",t,true);var e=this.getDomRef();if(e){e.setAttribute("rx",this.getParent()._toPixelSpace(t))}};r.prototype.setRadiusY=function(t){this.setProperty("radiusY",t,true);var e=this.getDomRef();if(e){e.setAttribute("ry",this.getParent()._toPixelSpace(t))}};r.prototype.setOriginX=function(t){this.setProperty("originX",t,true);var e=this.getDomRef();if(e){e.setAttribute("cx",this.getParent()._toPixelSpace(this.getOriginX(),this.getOriginY()).x)}};r.prototype.setOriginY=function(t){this.setProperty("originY",t,true);var e=this.getDomRef();if(e){e.setAttribute("cy",this.getParent()._toPixelSpace(this.getOriginX(),this.getOriginY()).y)}};r.prototype.renderElement=function(t,e){var i=this.getParent();this._initialX=this.getOriginX();this._initialY=this.getOriginY();t.openStart("ellipse",this);var r=i._toPixelSpace(this.getOriginX(),this.getOriginY());t.attr("cx",r.x);t.attr("cy",r.y);t.attr("rx",i._toPixelSpace(this.getRadiusX()));t.attr("ry",i._toPixelSpace(this.getRadiusY()));t.attr("fill",this.getFillColor());t.attr("stroke",this.getStrokeColor());t.attr("stroke-width",this.getStrokeWidth());if(this.getStrokeDashArray().length>0){t.attr("stroke-dasharray",this.getStrokeDashArray().toString())}t.attr("opacity",this.getOpacity());if(e){t.attr("filter",this._getHaloFilter())}t.openEnd();t.close("ellipse")};r.prototype.exportJSON=function(){return jQuery.extend(true,t.prototype.exportJSON.call(this),{type:e.ElementType.Ellipse,version:1,radiusX:this.getRadiusX(),radiusY:this.getRadiusY(),fillColor:this.getFillColor()})};r.prototype.importJSON=function(r){if(r.type===e.ElementType.Ellipse){if(r.version===1){t.prototype.importJSON.call(this,r);if(r.hasOwnProperty("radiusX")){this.setRadiusX(r.radiusX)}if(r.hasOwnProperty("radiusY")){this.setRadiusY(r.radiusY)}if(r.hasOwnProperty("fillColor")){this.setFillColor(r.fillColor)}}else{i.error("wrong version number")}}else{i.error("Redlining JSON import: Wrong element type")}return this};r.prototype.exportSVG=function(){var t=document.createElementNS(e.svgNamespace,"ellipse");t.setAttribute("x",this.getOriginX());t.setAttribute("y",this.getOriginY());t.setAttribute("rx",this.getRadiusX());t.setAttribute("ry",this.getRadiusY());t.setAttribute("fill",this.getFillColor());t.setAttribute("stroke",this.getStrokeColor());t.setAttribute("stroke-width",this.getStrokeWidth());if(this.getStrokeDashArray().length>0){t.setAttribute("stroke-dasharray",this.getStrokeDashArray().toString())}if(this.getOpacity()<1){t.setAttribute("opacity",this.getOpacity())}t.setAttribute("data-sap-element-id",this.getElementId());t.setAttribute("data-sap-halo",this.getHalo());return t};r.prototype.importSVG=function(e){if(e.tagName==="ellipse"){t.prototype.importSVG.call(this,e);if(e.getAttribute("rx")){this.setRadiusX(parseFloat(e.getAttribute("rx")))}if(e.getAttribute("ry")){this.setRadiusY(parseFloat(e.getAttribute("ry")))}if(e.getAttribute("fill")){this.setFillColor(e.getAttribute("fill"))}}else{i("Redlining SVG import: Wrong element type")}return this};return r});
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/RedlineElementFreehand", ["./RedlineElement","./Redline","sap/base/Log"],function(t,e,r){"use strict";var i=t.extend("sap.ui.vk.RedlineElementFreehand",{metadata:{library:"sap.ui.vk",properties:{path:{type:"float[]",defaultValue:null}}}});i.prototype.setPath=function(t){this.setProperty("path",t,true);var e=this.getDomRef();if(e){e.setAttribute("d",this._getProcessedPath())}};i.prototype.edit=function(t,e){var r=this.getParent();var i=r._toVirtualSpace(t,e);var s=this.getPath()||[];s.push(i.x-this.getOriginX(),i.y-this.getOriginY());this.setPath(s);var a=this.getDomRef();if(a){a.setAttribute("d",this._getProcessedPath())}return this};i.prototype.applyZoom=function(t){this.setProperty("path",this.getPath().map(function(e){return e*t}),true);return this};i.prototype._getProcessedPath=function(){var t=this.getParent(),e=t._toPixelSpace(this.getOriginX(),this.getOriginY());var r="";(this.getPath()||[]).forEach(function(i,s){i=t._toPixelSpace(i);if(s===0){r+="M "+(e.x+i)}else if(s===1){r+=" "+(e.y+i)}else{r+=" "+(s%2===0?"L "+(e.x+i):e.y+i)}});return r};i.prototype.renderElement=function(t,e){t.openStart("path",this);t.attr("d",this._getProcessedPath());t.attr("stroke",this.getStrokeColor());t.attr("stroke-width",this.getStrokeWidth());if(this.getStrokeDashArray().length>0){t.attr("stroke-dasharray",this.getStrokeDashArray().toString())}t.attr("opacity",this.getOpacity());t.attr("fill","none");if(e){t.attr("filter",this._getHaloFilter())}t.openEnd();t.close("path")};i.prototype.exportJSON=function(){return jQuery.extend(true,t.prototype.exportJSON.call(this),{type:e.ElementType.Freehand,version:1,path:(this.getPath()||[]).slice()})};i.prototype.importJSON=function(i){if(i.type===e.ElementType.Freehand){if(i.version===1){t.prototype.importJSON.call(this,i);if(i.hasOwnProperty("path")){this.setPath(i.path.slice())}}else{r.error("wrong version number")}}else{r.error("Redlining JSON import: Wrong element type")}return this};i.prototype.exportSVG=function(){var t=document.createElementNS(e.svgNamespace,"path");t.setAttribute("x",this.getOriginX());t.setAttribute("y",this.getOriginY());t.setAttribute("d",this.getPath());t.setAttribute("fill","none");t.setAttribute("stroke",this.getStrokeColor());t.setAttribute("stroke-width",this.getStrokeWidth());if(this.getStrokeDashArray().length>0){t.setAttribute("stroke-dasharray",this.getStrokeDashArray().toString())}if(this.getOpacity()<1){t.setAttribute("opacity",this.getOpacity())}t.setAttribute("data-sap-element-id",this.getElementId());t.setAttribute("data-sap-halo",this.getHalo());return t};i.prototype.importSVG=function(e){if(e.tagName==="path"){t.prototype.importSVG.call(this,e);if(e.getAttribute("d")){this.setPath(e.getAttribute("d").split(",").map(parseFloat))}}else{r.error("Redlining SVG import: Wrong element type")}return this};return i});
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/RedlineElementLine", ["./RedlineElement","./Redline","sap/base/Log"],function(t,e,r){"use strict";var i=t.extend("sap.ui.vk.RedlineElementLine",{metadata:{library:"sap.ui.vk",properties:{deltaX:{type:"float",defaultValue:0},deltaY:{type:"float",defaultValue:0},endArrowHead:{type:"boolean",defaultValue:false}}}});i.prototype.edit=function(t,e){var r=this.getParent(),i=r._toVirtualSpace(t,e);this.setDeltaX(i.x-this.getOriginX());this.setDeltaY(i.y-this.getOriginY());return this};i.prototype.applyZoom=function(t){this.setProperty("deltaX",this.getDeltaX()*t,true);this.setProperty("deltaY",this.getDeltaY()*t,true);return this};i.prototype.getP2=function(t){return this.getParent()._toPixelSpace(this.getOriginX()+this.getDeltaX(),this.getOriginY()+this.getDeltaY())};i.prototype.setDeltaX=function(t){this.setProperty("deltaX",t,true);var e=this.getDomRef();if(e){e.setAttribute("x2",this.getP2().x)}};i.prototype.setDeltaY=function(t){this.setProperty("deltaY",t,true);var e=this.getDomRef();if(e){e.setAttribute("y2",this.getP2().y)}};i.prototype.renderElement=function(t,e){var r=this.getParent()._toPixelSpace(this.getOriginX(),this.getOriginY());var i=this.getP2();t.openStart("line",this);t.attr("x1",r.x);t.attr("y1",r.y);t.attr("x2",i.x);t.attr("y2",i.y);t.attr("stroke",this.getStrokeColor());t.attr("stroke-width",this.getStrokeWidth());if(this.getStrokeDashArray().length>0){t.attr("stroke-dasharray",this.getStrokeDashArray().toString())}t.attr("opacity",this.getOpacity());if(e){t.attr("filter",this._getHaloFilter())}if(this.getEndArrowHead()){var a=this._colorToArray(this.getStrokeColor()).join("");t.attr("marker-end","url(#endArrowHead"+a+")")}t.openEnd();t.close("line")};i.prototype.getLength=function(){var t=this.getDomRef();if(t){return t.getTotalLength()}return 0};i.prototype.exportJSON=function(){return jQuery.extend(true,t.prototype.exportJSON.call(this),{type:e.ElementType.Line,version:1,deltaX:this.getDeltaX(),deltaY:this.getDeltaY(),endArrowHead:this.getEndArrowHead()})};i.prototype.importJSON=function(i){if(i.type===e.ElementType.Line){if(i.version===1){t.prototype.importJSON.call(this,i);if(i.hasOwnProperty("deltaX")){this.setDeltaX(i.deltaX)}if(i.hasOwnProperty("deltaY")){this.setDeltaY(i.deltaY)}if(i.hasOwnProperty("endArrowHead")){this.setEndArrowHead(i.endArrowHead)}}else{r.error("wrong version number")}}else{r.error("Redlining JSON import: Wrong element type")}return this};i.prototype.exportSVG=function(){var t=document.createElementNS(e.svgNamespace,"line");t.setAttribute("x1",this.getOriginX());t.setAttribute("y1",this.getOriginY());t.setAttribute("x2",this.getOriginX()+this.getDeltaX());t.setAttribute("y2",this.getOriginY()+this.getDeltaY());t.setAttribute("stroke",this.getStrokeColor());t.setAttribute("stroke-width",this.getStrokeWidth());if(this.getStrokeDashArray().length>0){t.setAttribute("stroke-dasharray",this.getStrokeDashArray().toString())}if(this.getOpacity()<1){t.setAttribute("opacity",this.getOpacity())}t.setAttribute("data-sap-element-id",this.getElementId());t.setAttribute("data-sap-halo",this.getHalo());t.setAttribute("data-sap-end-arrow",this.getEndArrowHead());return t};i.prototype.importSVG=function(e){if(e.tagName==="line"){t.prototype.importSVG.call(this,e);if(e.getAttribute("x1")){this.setOriginX(parseFloat(e.getAttribute("x1")))}if(e.getAttribute("y1")){this.setOriginY(parseFloat(e.getAttribute("y1")))}if(e.getAttribute("x2")){this.setDeltaX(parseFloat(e.getAttribute("x2"))-this.getOriginX())}if(e.getAttribute("y2")){this.setDeltaY(parseFloat(e.getAttribute("y2"))-this.getOriginY())}if(e.getAttribute("data-sap-end-arrow")){this.setEndArrowHead(e.getAttribute("data-sap-end-arrow")==="true")}}else{r("Redlining SVG import: Wrong element type")}return this};return i});
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/RedlineElementRectangle", ["./RedlineElement","./Redline","sap/base/Log"],function(t,e,i){"use strict";var r=t.extend("sap.ui.vk.RedlineElementRectangle",{metadata:{library:"sap.ui.vk",properties:{width:{type:"float",defaultValue:.001},height:{type:"float",defaultValue:.001},fillColor:{type:"sap.ui.core.CSSColor",defaultValue:"rgba(0, 0, 0, 0)"}}}});r.prototype.init=function(){t.prototype.init.apply(this);this._originX=0;this._originY=0};r.prototype.setOriginX=function(t){this.setProperty("originX",t,true);this._originX=t};r.prototype.setOriginY=function(t){this.setProperty("originY",t,true);this._originY=t};r.prototype.edit=function(t,e,i){var r=this.getParent(),o=r._toVirtualSpace(t,e),s=o.x-this._originX,h=o.y-this._originY;if(i){if(Math.abs(s)>Math.abs(h)){if(s<0&&h<0||s>0&&h>0){h=s}else{h=-s}o.y=h+this._originY}else{if(s<0&&h<0||s>0&&h>0){s=h}else{s=-h}o.x=s+this._originX}}this.setProperty("originX",s<0?o.x:this._originX,true);this.setProperty("originY",h<0?o.y:this._originY,true);this.setWidth(Math.abs(s));this.setHeight(Math.abs(h));this.rerender();return this};r.prototype.applyZoom=function(t){this.setProperty("width",this.getWidth()*t,true);this.setProperty("height",this.getHeight()*t,true);return this};r.prototype.setWidth=function(t){this.setProperty("width",t,true);var e=this.getDomRef();if(e){e.setAttribute("width",this.getParent()._toPixelSpace(t))}};r.prototype.setHeight=function(t){this.setProperty("height",t,true);var e=this.getDomRef();if(e){e.setAttribute("height",this.getParent()._toPixelSpace(t))}};r.prototype.renderElement=function(t,e){var i=this.getParent();t.openStart("rect",this);var r=i._toPixelSpace(this.getOriginX(),this.getOriginY());t.attr("x",r.x);t.attr("y",r.y);t.attr("width",i._toPixelSpace(this.getWidth()));t.attr("height",i._toPixelSpace(this.getHeight()));t.attr("fill",this.getFillColor());t.attr("stroke",this.getStrokeColor());t.attr("stroke-width",this.getStrokeWidth());if(this.getStrokeDashArray().length>0){t.attr("stroke-dasharray",this.getStrokeDashArray().toString())}t.attr("opacity",this.getOpacity());if(e){t.attr("filter",this._getHaloFilter())}t.openEnd();t.close("rect")};r.prototype.exportJSON=function(){return jQuery.extend(true,t.prototype.exportJSON.call(this),{type:e.ElementType.Rectangle,version:1,width:this.getWidth(),height:this.getHeight(),fillColor:this.getFillColor()})};r.prototype.importJSON=function(r){if(r.type===e.ElementType.Rectangle){if(r.version===1){t.prototype.importJSON.call(this,r);if(r.hasOwnProperty("width")){this.setWidth(r.width)}if(r.hasOwnProperty("height")){this.setHeight(r.height)}if(r.hasOwnProperty("fillColor")){this.setFillColor(r.fillColor)}}else{i("wrong version number")}}else{i("Redlining JSON import: Wrong element type")}return this};r.prototype.exportSVG=function(){var t=document.createElementNS(e.svgNamespace,"rect");t.setAttribute("x",this.getOriginX());t.setAttribute("y",this.getOriginY());t.setAttribute("height",this.getHeight());t.setAttribute("width",this.getWidth());t.setAttribute("fill",this.getFillColor());t.setAttribute("stroke",this.getStrokeColor());t.setAttribute("stroke-width",this.getStrokeWidth());if(this.getStrokeDashArray().length>0){t.setAttribute("stroke-dasharray",this.getStrokeDashArray().toString())}if(this.getOpacity()<1){t.setAttribute("opacity",this.getOpacity())}t.setAttribute("data-sap-element-id",this.getElementId());t.setAttribute("data-sap-halo",this.getHalo());return t};r.prototype.importSVG=function(e){if(e.tagName==="rect"){t.prototype.importSVG.call(this,e);if(e.getAttribute("width")){this.setWidth(parseFloat(e.getAttribute("width")))}if(e.getAttribute("height")){this.setHeight(parseFloat(e.getAttribute("height")))}if(e.getAttribute("fill")){this.setFillColor(e.getAttribute("fill"))}}else{i("Redlining SVG import: Wrong element type")}return this};return r});
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/RedlineElementText", ["./RedlineElement","./Redline","sap/base/Log"],function(t,e,i){"use strict";var r=t.extend("sap.ui.vk.RedlineElementText",{metadata:{library:"sap.ui.vk",properties:{text:{type:"string",defaultValue:"Text"},font:{type:"string",defaultValue:""},fontSize:{type:"float",defaultValue:32},fillColor:{type:"sap.ui.core.CSSColor",defaultValue:"rgba(0,0,0,0)"},width:{type:"float",defaultValue:300},height:{type:"float",defaultValue:0}}}});r.prototype.edit=function(t,e){var i=this.getParent(),r=i._toVirtualSpace(t,e);this.setOriginX(r.x);this.setOriginY(r.y);this.rerender();return this};r.prototype.applyZoom=function(t){this.setFontSize(this.getFontSize()*t);this.setWidth(this.getWidth()*t);this.setHeight(this.getHeight()*t);return this};r.prototype.renderElement=function(t,e){var i=this.getParent();if(i==null){return}var r=i._toPixelSpace(this.getOriginX(),this.getOriginY());t.openStart("foreignObject",this);t.attr("x",r.x);t.attr("y",r.y);t.attr("width","1");t.attr("height","1");if(e){t.attr("filter",this._getHaloFilter())}t.style("overflow","visible");t.openEnd();t.openStart("textArea");t.attr("spellcheck",false);if(this.getFont()){t.style("font-family",this.getFont())}t.style("font-size",`calc(${this.getFontSize()}px * var(--sapUiVizKitRedlineScale, 1))`);t.style("color",this.getFillColor());t.style("opacity",this.getOpacity());t.style("background","transparent");t.style("border-style","none");t.style("resize","none");t.style("width",`calc(${this.getWidth()}px * var(--sapUiVizKitRedlineScale, 1))`);t.style("height",`calc(${this.getHeight()||this.getFontSize()*1.2}px * var(--sapUiVizKitRedlineScale, 1))`);t.openEnd();t.text(this.getText());t.close("textArea");t.close("foreignObject")};r.prototype.exportJSON=function(){return jQuery.extend(true,t.prototype.exportJSON.call(this),{type:e.ElementType.Text,version:1,text:this.getText(),font:this.getFont(),fontSize:this.getFontSize(),fillColor:this.getFillColor(),width:this.getWidth(),height:this.getHeight()})};r.prototype.importJSON=function(r){if(r.type===e.ElementType.Text){if(r.version===1){t.prototype.importJSON.call(this,r);if(r.hasOwnProperty("text")){this.setText(r.text)}if(r.hasOwnProperty("font")){this.setFont(r.font)}if(r.hasOwnProperty("fontSize")){this.setFontSize(r.fontSize)}if(r.hasOwnProperty("fillColor")){this.setFillColor(r.fillColor)}if(r.hasOwnProperty("width")){this.setWidth(r.width)}if(r.hasOwnProperty("height")){this.setHeight(r.height)}}else{i.error("wrong version number")}}else{i.error("Redlining JSON import: Wrong element type")}return this};r.prototype.exportSVG=function(){var t=document.createElementNS(e.svgNamespace,"text");t.setAttribute("x",this.getOriginX());t.setAttribute("y",this.getOriginY());if(this.getFont()){t.setAttribute("font-family",this.getFont())}t.setAttribute("font-size",this.getFontSize());t.setAttribute("fill",this.getFillColor());t.setAttribute("stroke",this.getStrokeColor());t.setAttribute("stroke-width",this.getStrokeWidth());if(this.getStrokeDashArray().length>0){t.setAttribute("stroke-dasharray",this.getStrokeDashArray().toString())}if(this.getOpacity()<1){t.setAttribute("opacity",this.getOpacity())}t.setAttribute("data-sap-element-id",this.getElementId());t.setAttribute("data-sap-halo",this.getHalo());t.setAttribute("width",this.getWidth());t.setAttribute("height",this.getHeight());t.textContent=this.getText();return t};r.prototype.importSVG=function(e){if(e.tagName==="text"){t.prototype.importSVG.call(this,e);if(e.getAttribute("x")){this.setOriginX(parseFloat(e.getAttribute("x")))}if(e.getAttribute("y")){this.setOriginY(parseFloat(e.getAttribute("y")))}if(e.textContent){this.setText(e.textContent)}if(e.getAttribute("font-family")){this.setFont(e.getAttribute("font-family"))}if(e.getAttribute("font-size")){this.setFontSize(parseFloat(e.getAttribute("font-size")))}if(e.getAttribute("fill")){this.setFillColor(e.getAttribute("fill"))}if(e.getAttribute("width")){this.setWidth(parseFloat(e.getAttribute("width")))}if(e.getAttribute("height")){this.setHeight(parseFloat(e.getAttribute("height")))}}else{i("Redlining SVG import: Wrong element type")}return this};return r});
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/RedlineGesturesHandler", ["sap/ui/base/EventProvider","sap/ui/core/RenderManager","sap/ui/core/ResizeHandler","./NativeViewport"],function(t,e,i,n){"use strict";var o=t.extend("sap.ui.vk.RedlineGesturesHandler",{metadata:{library:"sap.ui.vk",publicMethods:["beginGesture","move","endGesture","click","doubleClick","contextMenu","getViewport"]},constructor:function(t){this._redlineDesign=t;this._x=0;this._y=0;this._d=0;this._zoomFactor=1;this._gesture=false}});o.prototype.destroy=function(){this._redlineDesign=null;this._rect=null;this._gesture=false};o.prototype._getOffset=function(t){var e=t.getBoundingClientRect();return{x:e.left+window.pageXOffset,y:e.top+window.pageYOffset}};o.prototype._inside=function(t,e){var i=e.getDomRef(),n=false;if(i!==null){var o=this._getOffset(i);var r={x:o.x,y:o.y,width:i.getBoundingClientRect().width,height:i.getBoundingClientRect().height};n=t.x>=r.x&&t.x<=r.x+r.width&&t.y>=r.y&&t.y<=r.y+r.height}return n};o.prototype._onresize=function(t){this._gesture=false};o.prototype.beginGesture=function(t){var e=this.getViewport();if(this._inside(t,e)){this._gesture=true;this._x=t.x;this._y=t.y;this._d=t.d;this._initd=t.d;t.handled=true}return this};o.prototype._pan=function(t){var e=this.getViewport(),i=t.x-this._x,n=t.y-this._y;if(i||n){this._x=t.x;this._y=t.y;var o=e.getPanningRatio();e.firePan({deltaX:i*o,deltaY:n*o});e.getRedlineElements().forEach(function(t){t.setOriginX(t.getOriginX()+e._toVirtualSpace(i));t.setOriginY(t.getOriginY()+e._toVirtualSpace(n))});this._manualRender(e)}};o.prototype._zoom=function(t){var e=this.getViewport(),i=1;var o=t.d-this._d;this._d=t.d;if(this._initd>0){i=1+o*(1/this._initd)}else if(t.n===2){if(t.points[0].y>t.points[1].y){i=Math.max(1-o*.005,.333)}else{i=Math.min(1+o*.005,3)}}i=Math.min(Math.max(i,.88),1.12);var r=e._getTargetViewport();var s=32;var a=1/8;if(r instanceof n){s=r._getZoomInLimit();a=r._getZoomOutLimit();this._zoomFactor=r._getZoomFactor()}i=Math.min(Math.max(this._zoomFactor*i,a),s)/this._zoomFactor;this._zoomFactor*=i;var h=this._getOffset(e.getDomRef());var u=1-i,g=e._toVirtualSpace(t.x-h.x,t.y-h.y);e.getRedlineElements().forEach(function(t){t.applyZoom(i);var e=t.getOriginX(),n=t.getOriginY();e+=(g.x-e)*u;n+=(g.y-n)*u;t.setOriginX(e);t.setOriginY(n)});this._manualRender(e);e.fireZoom({originX:t.x-h.x,originY:t.y-h.y,zoomFactor:i})};o.prototype.move=function(t){if(this.getViewport().getDomRef()){if(t.n===1||t.n===2){this._pan(t)}if(t.n===2&&!t.buttons){this._zoom(t)}}t.handled=true;return this};o.prototype._manualRender=function(t){var i=(new e).getInterface();t.getRedlineElements().forEach(function(t){t.render(i)});i.flush(t.getDomRef(),false,false);i.destroy();var n=t.$();n.html(n.html())};o.prototype.endGesture=function(t){this._gesture=false;t.handled=true;return this};o.prototype.contextMenu=function(t){t.handled=true};o.prototype.getViewport=function(){return this._redlineDesign};return o});
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/RedlineSurface", ["./library","sap/ui/core/Control","./Loco","./RedlineGesturesHandler","./RedlineSurfaceRenderer","./Redline","sap/base/Log"],function(e,t,i,n,a,r,l){"use strict";var o=t.extend("sap.ui.vk.RedlineSurface",{metadata:{library:"sap.ui.vk",aggregations:{redlineElements:{type:"sap.ui.vk.RedlineElement"}},properties:{virtualLeft:{type:"float"},virtualTop:{type:"float"},virtualSideLength:{type:"float"},panningRatio:{type:"float",defaultValue:1}},events:{pan:{parameters:{deltaX:"float",deltaY:"float"}},zoom:{parameters:{originX:"float",originY:"float",zoomFactor:"float"}}}}});o.prototype.init=function(){};o.prototype.onAfterRendering=function(){};o.prototype.exportJSON=function(){return this.getRedlineElements().map(function(e){return e.exportJSON()})};o.prototype.importJSON=function(e){if(!Array.isArray(e)){e=[e]}e.forEach(function(e){var t;switch(e.type){case r.ElementType.Rectangle:t=sap.ui.vk.RedlineElementRectangle;break;case r.ElementType.Ellipse:t=sap.ui.vk.RedlineElementEllipse;break;case r.ElementType.Freehand:t=sap.ui.vk.RedlineElementFreehand;break;case r.ElementType.Line:t=sap.ui.vk.RedlineElementLine;break;case r.ElementType.Text:t=sap.ui.vk.RedlineElementText;break;default:l.warning("Unsupported JSON element type "+e.type)}if(t!=null){this.addRedlineElement((new t).importJSON(e))}}.bind(this));return this};o.prototype._toVirtualSpace=function(e,t){if(arguments.length===1){return e/this.getVirtualSideLength()}else{return{x:(e-this.getVirtualLeft())/this.getVirtualSideLength(),y:(t-this.getVirtualTop())/this.getVirtualSideLength()}}};o.prototype._toPixelSpace=function(e,t){if(arguments.length===1){return e*this.getVirtualSideLength()}else{return{x:e*this.getVirtualSideLength()+this.getVirtualLeft(),y:t*this.getVirtualSideLength()+this.getVirtualTop()}}};o.prototype.setPanningRatio=function(e){this.setProperty("panningRatio",e,true)};o.prototype.updatePanningRatio=function(){var e=this.getVirtualLeft(),t=this.getVirtualTop(),i=this.getDomRef(),n=i.getBoundingClientRect(),a=n.height,r=n.width,l;if(e===0&&(a<r&&t<0||a>r&&t>0)){l=a/r}else{l=1}this.setPanningRatio(l);return this};o.prototype.exportSVG=function(){var e=document.createElementNS(r.svgNamespace,"svg");this.getRedlineElements().map(function(t){e.appendChild(t.exportSVG())});return e};o.prototype.importSVG=function(e){e.childNodes.forEach(function(e){if(e.getAttribute){var t;switch(e.tagName){case"rect":t=sap.ui.vk.RedlineElementRectangle;break;case"ellipse":t=sap.ui.vk.RedlineElementEllipse;break;case"path":t=sap.ui.vk.RedlineElementFreehand;break;case"line":t=sap.ui.vk.RedlineElementLine;break;case"text":t=sap.ui.vk.RedlineElementText;break;default:l.warning("Unsupported SVG element type "+t)}if(t){this.addRedlineElement((new t).importSVG(e))}}}.bind(this));return this};return o});
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/RedlineSurfaceRenderer", [],function(){"use strict";var e={apiVersion:2};e.render=function(e,n){e.openStart("svg",n);e.class("sapUiVizkitRedlineSurface");e.openEnd();e.openStart("defs");e.openEnd();e.openStart("filter");e.attr("id","halo");e.attr("filterUnits","userSpaceOnUse");e.openEnd();e.openStart("feGaussianBlur");e.attr("in","SourceAlpha");e.attr("stdDeviation","4");e.attr("result","blur");e.openEnd();e.close("feGaussianBlur");e.openStart("feMerge");e.openEnd();e.openStart("feMergeNode");e.attr("in","blur");e.openEnd();e.close("feMergeNode");e.openStart("feMergeNode");e.attr("in","SourceGraphic");e.openEnd();e.close("feMergeNode");e.close("feMerge");e.close("filter");e.close("defs");n.getRedlineElements().forEach(function(n){n.render(e)});this.renderAfterRedlineElements(e,n);e.close("svg")};e.renderAfterRedlineElements=function(e,n){};return e},true);
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/RedlineUpgradeManager", [],function(){"use strict";var e={};e.schemaVersions=[{version:"1.0"}];e.currentSchema=e.schemaVersions[e.schemaVersions.length-1];e.upgrade=function(r){return e._upgradeIfRequired(r)};e._upgradeIfRequired=function(r){var s;if(r.hasOwnProperty("schemaVersion")){r.schemaVersion=r.schemaVersion?r.schemaVersion:"1.0"}else{r.schemaVersion="1.0"}if(e.currentSchema.version!==r.schemaVersion){var n=e.schemaVersions.find(function(e){return e.version===r.schemaVersion});if(n&&n.upgradeFunction){s=n.upgradeFunction(r);s.schemaVersion=n.upgradeTargetVersion;s=e._upgradeIfRequired(s)}else{throw"There is no rule to upgrade Redline JSON from schema version "+r.schemaVersion}}else{s=r}return s};return e});
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/RenderMode", ["sap/ui/base/DataType"],function(e){"use strict";var t={Default:"Default",XRay:"XRay",LineIllustration:"LineIllustration",ShadedIllustration:"ShadedIllustration",SolidOutline:"SolidOutline"};e.registerEnum("sap.ui.vk.RenderMode",t);return t},true);
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/RotationType", ["sap/ui/base/DataType"],function(e){"use strict";var i={Quaternion:"Quaternion",AngleAxis:"AngleAxis",Euler:"Euler"};e.registerEnum("sap.ui.vk.RotationType",i);return i},true);
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/SafeArea", ["sap/ui/core/Control","sap/ui/vk/SafeAreaRenderer"],function(t,e){"use strict";var i=t.extend("sap.ui.vk.SafeArea",{metadata:{library:"sap.ui.vk",aggregations:{settingsControl:{type:"sap.ui.core.Control",multiple:false}}},constructor:function(e,i){t.apply(this,arguments)}});i.prototype.onAfterRendering=function(){this.resize()};i.prototype.resize=function(){var t=this.getDomRef();var e=this.getParent();if(!t||!e){return}var i=e.getDomRef().getBoundingClientRect();var s=i.width/i.height;var o=s;var r=e.getCurrentView();if(r&&r.getAspectRatio()&&r.getAspectRatio()>0&&r.getAspectRatio()<25){o=r.getAspectRatio()}var l=i.height;var a=i.width;if(s>o){t.style.height=l-4+"px";t.style.width=l*o-4+"px";t.style.left=(a-(l*o-4))/2+"px";t.style.top=""}else if(s<o){t.style.height=a/o-4+"px";t.style.width=a-4+"px";t.style.top=(l-(a/o-4))/2+"px";t.style.left=""}else{t.style.height=l-4+"px";t.style.width=a-4+"px"}if(this.getSettingsControl()){var p=this.getSettingsControl().getDomRef();var n=window.getComputedStyle(document.getElementById(this.getSettingsControl().sId));var g=n.height;p.style.position="absolute";if(s<o&&(l-parseFloat(t.style.height))/2>parseFloat(g)){p.style.bottom=parseFloat(t.style.height)+2+"px";p.style.left="-2px";p.style.top=""}else{p.style.top="0px";p.style.left="0px";p.style.bottom=""}}};return i});
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/SafeAreaRenderer", [],function(){"use strict";var e={apiVersion:2};e.render=function(e,t){e.openStart("div",t);var i=t.getParent();if(i){if(i.getShowSafeArea()){e.class("sapVizKitSafeAreaVisible")}else{e.class("sapVizKitSafeAreaNotVisible")}}e.openEnd();if(t.getSettingsControl()){e.renderControl(t.getSettingsControl())}e.close("div")};return e},true);
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/Scene", ["sap/ui/base/ManagedObject","./AnimationSequence","./AnimationTrack","./ViewGroup","./View","./Highlight"],function(e,t,i,s,r,n){"use strict";var u=e.extend("sap.ui.vk.Scene",{metadata:{library:"sap.ui.vk",abstract:true,properties:{doubleSided:{type:"boolean",defaultValue:false}}}});u.prototype.getInitialView=function(){return null};u.prototype.createSequence=function(e,i){var s=new t(e,i);this.addSequence(s);return s};u.prototype.getSequences=function(){if(!this._sequences){this._sequences=[]}return this._sequences};u.prototype.findSequence=function(e){if(!this._sequences){return undefined}return this._sequences.find(function(t){return t.getId()===e})};u.prototype.addSequence=function(e){if(!this._sequences){this._sequences=[]}this._sequences.push(e);return this};u.prototype.insertSequence=function(e,t){if(!this._sequences){this._sequences=[]}if(t<0){t=0}else if(t!==0&&t>=this._sequences.length){t=this._sequences.length}this._sequences.splice(t,0,e);return this};u.prototype.indexOfSequence=function(e){if(!this._sequences){return-1}return this._sequences.indexOf(e)};u.prototype.removeSequence=function(e){if(this._sequences){var t=this.indexOfSequence(e);if(t>=0){this._sequences.splice(t,1)}}return this};u.prototype.removeSequences=function(){if(this._sequences){this._sequences.splice(0)}return this};u.prototype.createTrack=function(e,t){var s=new i(e,t);this.addTrack(s);return s};u.prototype.getTracks=function(){if(!this._tracks){this._tracks=[]}return this._tracks};u.prototype.findTrack=function(e){if(!this._tracks){return undefined}return this._tracks.find(function(t){return t.getId()===e})};u.prototype.addTrack=function(e){if(!this._tracks){this._tracks=[]}this._tracks.push(e);return this};u.prototype.insertTrack=function(e,t){if(!this._tracks){this._tracks=[]}if(t<0){t=0}else if(t!==0&&t>=this._tracks.length){t=this._tracks.length}this._tracks.splice(t,0,e);return this};u.prototype.indexOfTrack=function(e){if(!this._tracks){return-1}return this._tracks.findIndex(function(t){return t==e})};u.prototype.removeTrack=function(e){if(this._tracks){var t=this.indexOfTrack(e);if(t>=0){this._tracks.splice(t,1)}}return this};u.prototype.removeTracks=function(){if(this._tracks){this._tracks.splice(0)}return this};u.prototype.getViewGroups=function(){if(!this._viewGroups){this._viewGroups=[]}return this._viewGroups};u.prototype.createViewGroup=function(e){if(!this._viewGroups){this._viewGroups=[]}var t=new s(e);this._viewGroups.push(t);return t};u.prototype.indexOfViewGroup=function(e){if(!this._viewGroups){return-1}return this._viewGroups.find(function(t){return t==e})};u.prototype.insertViewGroup=function(e,t){if(!this._viewGroups){this._viewGroups=[]}if(t<0){t=0}else if(t!==0&&t>=this._viewGroups.length){t=this._viewGroups.length}this._viewGroups.splice(t,0,e);return this};u.prototype.removeViewGroup=function(e){var t=this.indexOfViewGroup(e);if(t>=0){this._viewGroups.splice(t,1)}return this};u.prototype.removeViewGroups=function(){this._viewGroups.splice(0);return this};u.prototype.findViewGroupByView=function(e){var t;if(this._viewGroups){for(var i=0;i<this._viewGroups.length;i++){if(this._viewGroups[i].indexOfView(e)>=0){t=this._viewGroups[i];break}}}return t};u.prototype.getViews=function(){if(!this._views){this._views=[]}return this._views};u.prototype.createView=function(e){if(!this._views){this._views=[]}var t=new r(e);this._views.push(t);return t};u.prototype.removeView=function(e){if(!this._views){return this}var t=this.getViewGroups();if(Array.isArray(t)){t.forEach(function(t){t.removeView(e)})}var i=this._views.indexOf(e);if(i>=0){this._views.splice(i,1)}return this};u.prototype.createHighlight=function(e,t){var i=new n(e,t);if(!this._highlights){this._highlights=new Map}this._highlights.set(e,i);return i};u.prototype.getHighlight=function(e){var t;if(this._highlights){t=this._highlights.get(e)}return t};u.prototype.removeHighlight=function(e){if(this._highlights){this._highlights.delete(e)}return this};u.prototype._metadata=null;u.prototype.setSceneMetadata=function(e){this._metadata=e;return this};u.prototype.getSceneMetadata=function(e){return this._metadata};u.prototype.isECADScene=function(){return this._metadata?.some(({category:e,tag:t,value:i})=>e==="ecad"&&t==="version"&&i==="8")};return u});
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/SceneTree", ["./library","sap/ui/core/Control","sap/ui/core/Element","sap/ui/table/TreeTable","sap/ui/table/rowmodes/Auto","sap/ui/table/Column","sap/ui/model/json/JSONModel","sap/ui/core/Core","sap/ui/core/ResizeHandler","sap/m/Label","sap/m/Title","sap/m/SearchField","sap/m/Toolbar","sap/m/ToolbarLayoutData","sap/m/ToolbarSpacer","sap/m/Text","sap/ui/core/Icon","./Core","./ViewStateManager","./SceneTreeRenderer","./getResourceBundle","sap/ui/core/library","sap/m/library"],function(e,t,i,n,a,s,r,o,h,l,d,c,u,g,p,_,f,S,y,C,T,E,b){"use strict";var w=t.extend("sap.ui.vk.SceneTree",{metadata:{library:"sap.ui.vk",properties:{title:{type:"string",defaultValue:T().getText("SCENETREE_TITLE")},showTitle:{type:"boolean",defaultValue:true},showSearchField:{type:"boolean",defaultValue:true},legacyVisibilityMode:{type:"boolean",defaultValue:false}},aggregations:{treeTable:{type:"sap.ui.table.TreeTable",multiple:false}},associations:{contentConnector:{type:"sap.ui.vk.ContentConnector",multiple:false},viewStateManager:{type:"sap.ui.vk.ViewStateManagerBase",multiple:false}},events:{contentChanged:{enableEventBubbling:true}}},constructor:function(e,i){t.apply(this,arguments);S.observeAssociations(this)}});var m="sap-icon://show",v="sap-icon://hide";var x=T().getText("SCENETREE_VISIBILITYSTATEVISIBLE"),I=T().getText("SCENETREE_VISIBILITYSTATEHIDDEN");w.prototype._createNodeForSceneTree=function(e,t,i){var n=i.getVisibilityState(t);return{name:e,id:t,visible:n}};w.prototype.setScene=function(e,t){this.setViewStateManager(t);this._setScene(e)};w.prototype._setScene=function(e){this._scene=e;this.refresh()};w.prototype.init=function(){if(t.prototype.init){t.prototype.init.apply(this)}var e=this;this._title=new d({width:"100%",textAlign:E.TextAlign.Center,text:this.getTitle()});this._searchField=new c({layoutData:new g({shrinkable:true,maxWidth:"400px"}),search:function(t){var i=t.getParameter("query"),n=e._scene.getDefaultNodeHierarchy(),a=e._viewStateManager;if(n&&a){var s=!i?[]:n.findNodesByName({value:i,predicate:"contains"});var r=new Set(s);var o=[];a.enumerateSelection(function(e){if(!r.has(e)){o.push(e)}});a.setSelectionStates(s,o,false);e._treeItemCountText.setText(T().getText("SCENETREE_SELECTED_SCENE_TREE_ITEM_INFO",[s.length]))}}});this._toolbar=new u({content:[this._title,new p,this._searchField]});var i=new f({src:m,tooltip:x,press:function(t){var i=this.getSrc()!==m;this.setSrc(i?m:v);this.setTooltip(i?T().getText("SCENETREE_VISIBILITYSTATEVISIBLEALL"):T().getText("SCENETREE_VISIBILITYSTATEHIDDENALL"));e._toggleVisibilityForAllChildren(e._model.getData(),i)}});this._tree=new n({extension:this._toolbar,columnHeaderHeight:32,columns:[new s({label:new l({text:T().getText("SCENETREE_NAME")}),tooltip:T().getText("SCENETREE_NAME"),template:new _({text:"{name}",maxLines:1,tooltip:"{name}"}),resizable:false}),new s(this.getId()+"-visibilityColumn",{label:i,template:new f({src:{path:"",formatter:function(e){if(!e){return null}return e.visible?m:v}},tooltip:{path:"",formatter:function(e){if(!e){return null}return e.visible?x:I}},press:function(t){var i=e._tree.getContextByIndex(this.getParent().getIndex());var n=i?i.getObject():null;if(n){e._viewStateManager.setVisibilityState(n.id,!n.visible,e.getLegacyVisibilityMode(),e.getLegacyVisibilityMode())}}}),width:"2.25em",resizable:false,hAlign:"Center"})],enableSelectAll:false,selectionMode:"MultiToggle",selectionBehavior:"RowSelector",rowMode:new a});this.setAggregation("treeTable",this._tree);this._treeItemCountText=new _({text:T().getText("SCENETREE_SELECTED_SCENE_TREE_ITEM_INFO",[this._tree.getSelectedIndices().length])}).addStyleClass("sapUiTinyMargin");const o=new u({design:b.ToolbarDesign.Info,content:[this._treeItemCountText]});this._tree.addExtension(o);this.attachContentChanged(function(e){i.setSrc(m);i.setTooltip(x)});this._scene=null;this._syncing=false;this._updateSelectionTimer=0;this._updateVisibilityTimer=0;this._model=new r;this._tree.setModel(this._model);this._tree.bindRows({path:"/"});this._tree.attachRowSelectionChange(this._handleRowSelectionChange.bind(this));this._tree.attachFirstVisibleRowChanged(this._updateSelection.bind(this));this._tree.getBinding("rows").attachChange(this._dataChange.bind(this))};w.prototype.setTitle=function(e){this.setProperty("title",e,true);this._title.setText(e);return this};w.prototype.setShowTitle=function(e){this.setProperty("showTitle",e,true);this._title.setVisible(e);this._updateTitleBar();return this};w.prototype.setShowSearchField=function(e){this.setProperty("showSearchField",e,true);this._searchField.setVisible(e);this._updateTitleBar();return this};w.prototype._updateTitleBar=function(){this._tree.removeExtension(this._toolbar);if(this.getShowTitle()||this.getShowSearchField()){this._tree.addExtension(this._toolbar)}this._handleResize()};w.prototype.onBeforeRendering=function(){this._tree.setVisible(true);if(!this._resizeListenerId){this._resizeListenerId=h.register(this,this._handleResize.bind(this))}};w.prototype._handleRowSelectionChange=function(e){if(this._syncing||this._tree.getBinding("rows")._aSelectedContexts!=undefined){return}var t=[];var i=[];var n=e.getParameter("rowIndices");for(var a in n){var s=n[a];var r=this._tree.getContextByIndex(s);var o=r?r.getObject().id:null;if(o){(this._tree.isIndexSelected(s)?t:i).push(o)}}this._viewStateManager.setSelectionStates(t,i);const h=this._tree.getBinding("rows").getSelectedContexts();this._treeItemCountText.setText(T().getText("SCENETREE_SELECTED_SCENE_TREE_ITEM_INFO",[h.length]))};w.prototype._onSelectionChanged=function(e){if(this._syncing){return}function t(e,t){var i=e.getBinding("rows");if(i){for(var n=e.getFirstVisibleRow(),a=Math.min(n+e.getRowMode().getComputedRowCounts().count,i.getLength());n<a;n++){var s=i.getContextByIndex(n);if(s&&s.getObject().id===t){return true}}}return false}var i=e.getParameter("selected");this._treeItemCountText.setText(T().getText("SCENETREE_SELECTED_SCENE_TREE_ITEM_INFO",[i.length]));if(i.length===1&&!t(this._tree,i[0])){if(this._updateSelectionTimer>0){clearTimeout(this._updateSelectionTimer);this._updateSelectionTimer=0}this._expandToNode(i[0],this._updateSelection.bind(this))}else if(this._updateSelectionTimer===0){this._updateSelectionTimer=setTimeout(this._updateSelection.bind(this),0)}};w.prototype._updateSelection=function(){this._updateSelectionTimer=0;if(this._syncing){return}this._syncing=true;var e=this._viewStateManager,t=this._tree,i=t.getBinding("rows");if(e&&i){for(var n=t.getFirstVisibleRow(),a=Math.min(n+t.getRowMode().getComputedRowCounts().count,i.getLength());n<a;n++){var s=i.getContextByIndex(n);if(s){var r=s.getObject().id;if(r){var o=e.getSelectionState(r);if(o!=t.isIndexSelected(n)){t[o?"addSelectionInterval":"removeSelectionInterval"](n,n)}}}}}this._syncing=false};w.prototype._expandToNode=function(e,t){var i={tree:this._tree,rows:this._tree.getBinding("rows"),index:0,nodeRef:e,ancestors:new Set(this._scene.getDefaultNodeHierarchy().getAncestors(e)),callback:t};function n(e,t,i){var n=e.getFirstVisibleRow(),a=e.getRowMode().getComputedRowCounts().count;if(t<n||t>=n+a){n=Math.min(Math.max(t-(a>>1),0),i-a);e.setFirstVisibleRow(n)}}function a(e,t){if(t&&t.getParameter("reason")!=="expand"){return}var i=e.rows.getLength();while(e.index<i){var a=e.rows.getContextByIndex(e.index);if(!a){break}var s=a.getObject().id;if(s===e.nodeRef){n(e.tree,e.index,i);break}if(e.ancestors.has(s)&&!e.tree.isExpanded(e.index)){e.tree.expand(e.index++);return}e.index++}e.rows.detachChange(e.expandHandlerProxy);e.callback()}i.expandHandlerProxy=a.bind(this,i);i.rows.attachChange(i.expandHandlerProxy);a(i)};w.prototype._dataChange=function(e){var t=e.getParameter("reason");if((t==="expand"||t==="collapse")&&this._updateSelectionTimer===0){this._updateSelectionTimer=setTimeout(this._updateSelection.bind(this),0)}};w.prototype._toggleVisibilityForAllChildren=function(e,t){var i=e.hasOwnProperty("children")?e.children:e;for(var n=0;i[n]!=null;n++){this._viewStateManager.setVisibilityState(i[n].id,t,true)}};w.prototype._onVisibilityChanged=function(e){if(this._updateVisibilityTimer===0){this._updateVisibilityTimer=setTimeout(this._updateVisibility.bind(this),0)}};w.prototype._updateVisibility=function(){this._updateVisibilityTimer=0;this._getNodeVisibilityRecursive(this._model.getData());this._tree.getModel().refresh(true)};w.prototype._getNodeVisibilityRecursive=function(e){if(e.id!=null){e.visible=this._viewStateManager.getVisibilityState(e.id)}var t=e.hasOwnProperty("children")?e.children:e;for(var i=0;t[i]!=null;i++){this._getNodeVisibilityRecursive(t[i])}};w.prototype._handleResize=function(e){this._updateSelection()};w.prototype.refresh=function(){const e=this._scene?.getDefaultNodeHierarchy?.();if(!e||!this._viewStateManager?.getNodeHierarchy()){this._model.setData([]);return}var t=[];var i=function(t,n){n.forEach(function(n){if(n.userData&&n.userData.skipIt){i(t,e.getChildren(n))}else{var a=e.createNodeProxy(n);var s=this._createNodeForSceneTree(a.getName(),a.getNodeRef(),this._viewStateManager);t.push(s);e.destroyNodeProxy(a);s.children=[];i(s.children,e.getChildren(n))}}.bind(this))}.bind(this);i(t,e.getChildren());this._model.setData(t);this._tree.setModel(this._model);this._tree.bindRows({path:"/",parameters:{arrayNames:["children"]}});this._tree.getBinding("rows").attachChange(this._dataChange.bind(this));this.fireContentChanged()};w.prototype.onSetViewStateManager=function(e){this._viewStateManager=e;e.attachNodeHierarchyReplaced(this._onNodeHierarchyReplaced,this);e.attachSelectionChanged(this._onSelectionChanged,this);e.attachVisibilityChanged(this._onVisibilityChanged,this);this.refresh()};w.prototype.onUnsetViewStateManager=function(e){this._viewStateManager=null;e.detachVisibilityChanged(this._onVisibilityChanged,this);e.detachSelectionChanged(this._onSelectionChanged,this);e.detachNodeHierarchyReplaced(this._onNodeHierarchyReplaced,this);this.refresh()};w.prototype._onNodeHierarchyReplaced=function(e){this.refresh()};w.prototype._setContent=function(e){if(e&&!this.getViewStateManager()){var t=i.getElementById(this.getContentConnector());if(t){var n=t.getDefaultViewStateManager();if(n){this.setViewStateManager(n)}}}this._setScene(e);return this};w.prototype.onSetContentConnector=function(e){e.attachContentReplaced(this._onContentReplaced,this);e.attachContentChangesFinished(this._onContentChangesFinished,this);this._setContent(e.getContent())};w.prototype.onUnsetContentConnector=function(e){this._setContent(null);e.detachContentChangesFinished(this._onContentChangesFinished,this);e.detachContentReplaced(this._onContentReplaced,this)};w.prototype._onContentReplaced=function(e){this._setContent(e.getParameter("newContent"))};w.prototype._onContentChangesFinished=function(e){this.refresh()};return w});
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/SceneTreeRenderer", [],function(){"use strict";var e={apiVersion:2};e.render=function(e,n){e.openStart("div",n);e.class("sapUiSizeCompact");e.class("sapUiVkSceneTree");e.openEnd();e.renderControl(n.getAggregation("treeTable"));e.close("div")};return e},true);
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/SelectionDisplayMode", ["sap/ui/base/DataType"],function(i){"use strict";var e={Highlight:"Highlight",Outline:"Outline"};i.registerEnum("sap.ui.vk.SelectionDisplayMode",e);return e},true);
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/SelectionMode", ["sap/ui/base/DataType"],function(e){"use strict";var i={None:"none",Exclusive:"exclusive",Sticky:"sticky"};e.registerEnum("sap.ui.vk.SelectionMode",i);return i},true);
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/Smart2DHandler", ["sap/ui/base/EventProvider","sap/ui/core/ResizeHandler"],function(t,e){"use strict";var i=t.extend("sap.ui.vk.Smart2DHandler",{metadata:{library:"sap.ui.vk",publicMethods:["beginGesture","move","endGesture","click","doubleClick","contextMenu","getViewport"]},constructor:function(t,e){this._viewport=t;this._rect=null;this._x=0;this._y=0;this._gesture=false;this._hitEndTimer=0;this._lastRender=0;this._viewport.attachEvent("resize",this,this._onresize);this._viewStateManager=e;this._previousColoring={nodeRef:null,nodeId:null,color:null}}});i.prototype.destroy=function(){this._viewport=null;this._rect=null;this._gesture=false;this._viewport.detachEvent("resize",this,this._onresize);this._viewStateManager=null;this._previousColoring=null};i.prototype._getOffset=function(t){var e=t.getBoundingClientRect();var i={x:e.left+window.pageXOffset,y:e.top+window.pageYOffset};return i};i.prototype._inside=function(t){var e=this._viewport.getDomRef();if(e==null){return false}var i=this._getOffset(e);this._rect={x:i.x,y:i.y,w:e.offsetWidth,h:e.offsetHeight};return t.x>=this._rect.x&&t.x<=this._rect.x+this._rect.w&&t.y>=this._rect.y&&t.y<=this._rect.y+this._rect.h};i.prototype._onresize=function(t){this._gesture=false;this._rect=null};i.prototype.beginGesture=function(t){if(this._inside(t)){this._gesture=true;this._x=t.x;this._y=t.y}};i.prototype.callbackHover=function(){var t=this._viewStateManager.getNodeHierarchy();this._lastRender=Date.now();this._hitEndTimer=0;var e=this._viewport.hitTest(this._x,this._y);if(this._highlightedNodeRef!==e){if(this._highlightedNodeRef!==sap.ve.dvl.DVLID_INVALID){var i=this._highlightedNodeRef===this._previousColoring.nodeRef?this._previousColoring.color:0;this._viewport.showHotspots(this._highlightedNodeRef,true,i)}if(t.getHotspotNodeRefs().indexOf(e)!==-1){var o=t.createNodeProxy(e);this._previousColoring={nodeRef:e,nodeId:e,color:o.getTintColorABGR()};t.destroyNodeProxy(o);this._viewport.showHotspots(e,true)}this._highlightedNodeRef=e}this._viewport.renderFrame()};i.prototype.hover=function(t){if(t.n==1&&this._inside(t)){this._x=t.x-this._rect.x;this._y=t.y-this._rect.y;if(!this.getViewport().getShowAllHotspots()){var e=Date.now();if(e-this._lastRender>20){this.callbackHover()}if(this._hitEndTimer!=0){clearTimeout(this._hitEndTimer)}this._hitEndTimer=setTimeout(this.callbackHover.bind(this),20)}t.handled=true}};i.prototype.move=function(t){if(this._gesture&&t.n==1){this._viewport.pan(t.x-this._x,t.y-this._y);this._x=t.x;this._y=t.y;t.handled=true}};i.prototype.endGesture=function(t){this._gesture=false};i.prototype.click=function(t){};i.prototype.doubleClick=function(t){};i.prototype.contextMenu=function(t){};i.prototype.getViewport=function(){return this._viewport};return i});
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/StepNavigation", ["sap/ui/core/Control","./library","./Core","./Messages","./DvlException","./ContentConnector","./StepNavigationRenderer","./dvl/GraphicsCoreApi","./dvl/getPointer","./dvl/getJSONObject","./dvl/Scene","./getResourceBundle","sap/base/Log","sap/ui/core/Core","sap/ui/core/ListItem","sap/ui/core/CustomData","sap/ui/model/json/JSONModel","sap/m/Button","sap/m/ToggleButton","sap/m/Toolbar","sap/m/ScrollContainer","sap/m/Select","sap/m/ToolbarSpacer","sap/m/Text","sap/m/Bar","sap/m/ResponsivePopover","sap/m/HBox","sap/m/Image","sap/m/FlexItemData"],function(e,t,s,n,o,r,i,a,p,l,u,c,d,h,g,f,S,v,I,y,P,T,m,A,b,M,E,C,x){"use strict";var N=e.extend("sap.ui.vk.StepNavigation",{metadata:{library:"sap.ui.vk",properties:{settings:"object",width:{type:"sap.ui.core.CSSSize",defaultValue:"100%"},height:{type:"sap.ui.core.CSSSize",defaultValue:"100%"},showThumbnails:{type:"boolean",group:"Appearance",defaultValue:true},showToolbar:{type:"boolean",group:"Appearance",defaultValue:true},showStepInfo:{type:"boolean",group:"Appearance",defaultValue:false}},publicMethods:["setScene","playStep","pauseStep","playAllSteps","getStep","getNextStep","getPreviousStep","getProceduresAndSteps","refresh","clear"],associations:{contentConnector:{type:"sap.ui.vk.ContentConnector"}},aggregations:{procedureItemTemplate:{type:"sap.ui.core.Item",multiple:false},stepInfoPopup:{type:"sap.ui.core.Control",multiple:false},layout:{type:"sap.m.Toolbar",multiple:false},thumbnailsContainer:{type:"sap.m.ScrollContainer",multiple:false}},events:{resize:{parameters:{oldSize:"object",size:"object"}},stepChanged:{parameters:{clientId:"object",type:"object",stepId:"object"}}}},constructor:function(t,n){e.apply(this,arguments);s.observeAssociations(this)}});N.prototype._onStepEvent=function(e){var t=this.getSettings();this.instanceSettings.currentStepId=e.stepId;switch(e.type){case sap.ve.dvl.DVLSTEPEVENT.DVLSTEPEVENT_FINISHED:t.currentStepFinished=true;t.currentStepPaused=false;t.playAllActive=false;t.isPlaying=false;this._togglePlayPause(true);break;case sap.ve.dvl.DVLSTEPEVENT.DVLSTEPEVENT_SWITCHED:case sap.ve.dvl.DVLSTEPEVENT.DVLSTEPEVENT_STARTED:t.currentStepId=e.stepId;t.currentStepFinished=false;this._highlightStep(e.stepId);if(t.currentStepPaused){this.pauseStep()}break;case sap.ve.dvl.DVLSTEPEVENT.DVLSTEPEVENT_PLAYING:if(this.getShowStepInfo()&&this.stepMessagePopup&&!this.stepMessagePopup.isOpen()){this._highlightStep(e.stepId)}break;default:d.error(c().getText(n.VIT12.summary),n.VIT12.code,"sap.ui.vk.StepNavigation")}this.fireStepChanged({clientId:e.clientId,type:e.type,stepId:e.stepId})};N.prototype.setScene=function(e){if(this._scene){this.oDvl.Client.detachStepEvent(this._onStepEvent,this);this.oDvl=null}if(e){var t=e.getMetadata().getName();if(t!=="sap.ui.vk.dvl.Scene"){return}}this._scene=e;this.instanceSettings={};if(this._scene){this.oDvl=e.getGraphicsCore().getApi(a.LegacyDvl);this.oDvl.Client.attachStepEvent(this._onStepEvent,this)}delete this._procedures;var s=this.getProcedureList();var n=this.getSettings();n.reset();s.unbindItems();s.setSelectedItem(s.getFirstItem());if(n.stepInfo.stepMessagePopup){if(n.stepInfo.stepMessagePopup.isOpen()){n.stepInfo.stepMessagePopup.close()}n.stepInfo.stepMessagePopup.destroy();n.stepInfo.stepMessagePopup=null;this.getShowStepInfoButton().setText(c().getText("STEP_NAV_STEPDESCRIPTIONHEADING"))}var o=this._getStepThumbnails();this.oModel.setData(o);this._togglePlayPause(true);this._refreshControl();this.refresh()};N.prototype.init=function(){this._emptyThumbnail="iVBORw0KGgoAAAANSUhEUgAAAE4AAAA8CAYAAADIQIzXAAAACXBIWXMAAAsTAAALEwEAmpwYAAAFFmlUWHRYTUw6Y29tLmFkb2JlLnhtcAAAAAAAPD94cGFja2V0IGJlZ2luPSLvu78iIGlkPSJXNU0wTXBDZWhpSHpyZVN6TlRjemtjOWQiPz4gPHg6eG1wbWV0YSB4bWxuczp4PSJhZG9iZTpuczptZXRhLyIgeDp4bXB0az0iQWRvYmUgWE1QIENvcmUgNS42LWMxNDAgNzkuMTYwNDUxLCAyMDE3LzA1LzA2LTAxOjA4OjIxICAgICAgICAiPiA8cmRmOlJERiB4bWxuczpyZGY9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkvMDIvMjItcmRmLXN5bnRheC1ucyMiPiA8cmRmOkRlc2NyaXB0aW9uIHJkZjphYm91dD0iIiB4bWxuczp4bXA9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC8iIHhtbG5zOmRjPSJodHRwOi8vcHVybC5vcmcvZGMvZWxlbWVudHMvMS4xLyIgeG1sbnM6cGhvdG9zaG9wPSJodHRwOi8vbnMuYWRvYmUuY29tL3Bob3Rvc2hvcC8xLjAvIiB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIgeG1sbnM6c3RFdnQ9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZUV2ZW50IyIgeG1wOkNyZWF0b3JUb29sPSJBZG9iZSBQaG90b3Nob3AgQ0MgKE1hY2ludG9zaCkiIHhtcDpDcmVhdGVEYXRlPSIyMDE4LTA2LTA1VDEzOjU1OjAzKzEyOjAwIiB4bXA6TW9kaWZ5RGF0ZT0iMjAxOC0wNi0wNVQxNDowMDo1MCsxMjowMCIgeG1wOk1ldGFkYXRhRGF0ZT0iMjAxOC0wNi0wNVQxNDowMDo1MCsxMjowMCIgZGM6Zm9ybWF0PSJpbWFnZS9wbmciIHBob3Rvc2hvcDpDb2xvck1vZGU9IjMiIHBob3Rvc2hvcDpJQ0NQcm9maWxlPSJzUkdCIElFQzYxOTY2LTIuMSIgeG1wTU06SW5zdGFuY2VJRD0ieG1wLmlpZDoyNGZiYjQ5MS1mNzFkLTRmMTgtODA2Zi1iYjcxZjhhZTdhNjAiIHhtcE1NOkRvY3VtZW50SUQ9InhtcC5kaWQ6MjRmYmI0OTEtZjcxZC00ZjE4LTgwNmYtYmI3MWY4YWU3YTYwIiB4bXBNTTpPcmlnaW5hbERvY3VtZW50SUQ9InhtcC5kaWQ6MjRmYmI0OTEtZjcxZC00ZjE4LTgwNmYtYmI3MWY4YWU3YTYwIj4gPHhtcE1NOkhpc3Rvcnk+IDxyZGY6U2VxPiA8cmRmOmxpIHN0RXZ0OmFjdGlvbj0iY3JlYXRlZCIgc3RFdnQ6aW5zdGFuY2VJRD0ieG1wLmlpZDoyNGZiYjQ5MS1mNzFkLTRmMTgtODA2Zi1iYjcxZjhhZTdhNjAiIHN0RXZ0OndoZW49IjIwMTgtMDYtMDVUMTM6NTU6MDMrMTI6MDAiIHN0RXZ0OnNvZnR3YXJlQWdlbnQ9IkFkb2JlIFBob3Rvc2hvcCBDQyAoTWFjaW50b3NoKSIvPiA8L3JkZjpTZXE+IDwveG1wTU06SGlzdG9yeT4gPC9yZGY6RGVzY3JpcHRpb24+IDwvcmRmOlJERj4gPC94OnhtcG1ldGE+IDw/eHBhY2tldCBlbmQ9InIiPz6QcBQiAAAGO0lEQVR4nO2ca1MbRxaGn+6emR7dzMUEOxRbla04H+LE+f+/YlO1oWIiA8IGhGQZJCSkkeZ28mEsOxtYRxoGIVx6vwip5tI8OrfuPho1DuIzoMZK82igxkEsDz2KxygNDB56EI9QA/3QI3isWoHLqRW4nHLmOdgYg1IgX0E6USp7TZKUNJVP72fVXOCiKEJEUPPeZUklIhhj0Hp+Y5gJnFIKx9EcHBxzeXmJtTbPOJdKIkIcx7x48QObm0+YTJK5zp/b4iaTyVw3WFZNwaVpmuv8uWOc4zg4zlynLaXko2/mDTuFEJBHki2KjM13AqeUIkkSoiieOystUiKgtcJ13cKueSdwYRiyvr7O8+fPiOMUWE7LM8YQBAHNZhMoxvLuBC5JYqz12dhcyz5YTm6gYDQscXZ2lr19aHBTV5UUoihd2ljneYYwDAu95mrKlVMrcDn1qAqyLDtqXFehFCQJxPF8FX9RWig4EXAcgzFZTJx3cu2XDEkMvd6AJEkol8uUKx5xJMRxutCSaGHgRMB1DXGcMByOqVQqwOwJxfMMve6Ak5MTrq+vSdMUz/PY2dnh22+f4zh6ofAWEuNEwPUMIsL+/mt+/fU/XF1d4Vk906qEtYbBYMje3h69Xg/HcbDWEscx9Xqdw6MG2ii0XpzJ3Ts4ETBGYwy8e3dCt9vFdV0ajSPCMMH3zUzwWq0WaZpSLpc/1WGu61KplGm3WvS6fTxvcbnu3u+ktcL1FCfvzmk2m1QqFXzfZzwOqP9RJ0kEx/n/w8iq/pjB4BrP8264ttYGgPE4gAXGuHsH51lN67zD4eEBruugtUZE8P0SnU6Hs7NzHFfNYHVfPmDRtfe9gRMB6xtGw5Dj4wbWWhzH+R+LKZVKtFrnBMMQv3S7y6Zpil9yqFSqhGF4Y7qUpsmnay1yyncv4ESy0mE0GrO3t0eayq1u5rouURSx/8c+cZTieTfhiQgI7O7u4jgOo9GIKaE4jhmNRuzu7rKx8YQwzLcomUeFgxMRrG9IYuH17/tMJmOstbeWHZnL+vT7VzQax2jDrZkxDBOqVZ+XL3+kVqsxmYSMx2OUUnz//Qu+++5fJImQposzuULruKxWc1AK3rw5ZDgcUqlUvliriQjlcoV2u8Xm5lOebq0xDpIb9dhkkrC+8YSfq6/o9XrEcUy1WqVa84lCIUkecQFsjMI4cFA/pt1u/SO0qbTWGGM4OjqkWv0Fax0mk5vwxkGCMZqtrXVQkCYwGWcxbtELqYW6qutpTk/anDVPKZfLM58nInieJQgCDg+PUCqr/f4upbJkMR4nRKGgTZaArG8+Zusi/5svqzBwntVcXlzx9m0D31q0nu/SmcuW6XTec3raxvXUjSwpkq0B+iWD1ormWZs39SPety/QOvvccWYrqO+qQlxVabgeBNTr9WwP1nVzLWoqpbDWcnr6ls3NDcoVj3GQuaIxOoMJdN5f0GyeMxj0SdOUdrvN2toaW99ssbmxiV9yQCCKJPf23z+psBg3HI6I4xjf93OvBIsIrusSBAEHB2/46eeXWGtQGpIYPnS6dD50uPhwkVmeX0IphYjQ7/fpdrtUq1W2t7+hVntCpVLF2vuxwMLAGWMwxty5RUJEKJVK9Ho9Dg8avPjh33x43+X8vEm/n7Xy2Y+hQEQ+fUnT7oIwDGk0jnEch1KpxM7ODtvbTwtv21jKhczP8Lr89t8R19dDIKv5/nrMbZpumIsIl5eXKKXYfva08DEuJTjISpQ0TRmNRnieO7fFTOOl53n3Mr6lBTd1+SI3kYvUarMmp1bgcmoFLqdW4HJqBS6nCsuqItn0Jk3TpekRno7nPlQYuCms7HU5wEGxzYR/VQHgsoHVajVevfplaawNPneVQ/Ff5Z3AZUVq9rfnGaw/+xrcwjSdmRW8WX0ncJ5nGQz6vP69vrS9cfC5j08pVZhH3AmcMYYoihiNRkvlon+XiHzsclqSHuDpgL6GH4zMq1Udl1MzW5xS2SJhEIyWOp7NKhEhiqKszssRZWYGlyTC9vYzarUaxiztatQcygp23/dJcvy6Xo2DuM8MDzMQEax1UF+Zc+fczB7M4aqKMHyYftv7Vp6C4Cuzn8VpBS6nVuByavXAlpxygCarRwTNq8GfDrbV1CI5dZUAAAAASUVORK5CYII=";if(e.prototype.init){e.prototype.init.call(this)}if(this.getSettings()==undefined){this.setSettings(new this._settings)}this._scene=null;this.oModel=new S;this._layout=new y({design:sap.m.ToolbarDesign.Solid});this.setAggregation("layout",this._layout);if(this.getShowThumbnails()){this._thumbnailsScroller=new P(this.getId()+"-scroller",{width:"100%",horizontal:true,vertical:false});this.setAggregation("thumbnailsContainer",this._thumbnailsScroller)}this.playPreviousButton=new v(this.getId()+"-playPreviousButton",{type:sap.m.ButtonType.Transparent,icon:"sap-icon://slim-arrow-left",tooltip:c().getText("STEP_NAV_PREVIOUSSTEPBUTTON"),press:function(e){var t=this.getSettings();var s=this.getPreviousStep(t.currentProcedureIndex);if(s){t.currentStepPaused=false;this.playStep(s.id,true,t.playAllActive);this._togglePlayPause(false)}}.bind(this)});this.playNextButton=new v(this.getId()+"-playNextButton",{type:sap.m.ButtonType.Transparent,icon:"sap-icon://slim-arrow-right",tooltip:c().getText("STEP_NAV_NEXTSTEPBUTTON"),press:function(e){var t=this.getSettings();var s=this.getNextStep(t.currentProcedureIndex);if(s){t.currentStepPaused=false;this.playStep(s.id,true,t.playAllActive);this._togglePlayPause(false)}}.bind(this)});this.playOptionButton=new v(this.getId()+"-playOptionButton",{type:sap.m.ButtonType.Transparent,icon:"sap-icon://media-play",tooltip:c().getText("STEP_NAV_PLAYBUTTON_PLAY"),visible:true,press:function(e){var t=this.getPlayMenuButton().getSelectedKey();var s=this.getSettings();var n=null;switch(t){case"0":if(!s.currentStepId){n=this.getNextStep(s.currentProcedureIndex);if(n){s.currentStepId=n.id}else{return}}s.playAllActive=false;this.playStep(s.currentStepId,!s.currentStepPaused,s.playAllActive);s.isPlaying=true;s.currentStepPaused=false;this._togglePlayPause(false);break;case"1":s.playAllActive=true;s.currentStepPaused=false;this.playAllSteps(s.currentProcedureId);s.isPlaying=true;this._togglePlayPause(false);break;case"2":if(!s.currentStepId){n=this.getNextStep(s.currentProcedureIndex);if(n){s.currentStepId=n.id}else{return}}s.playAllActive=true;var o=!s.currentStepPaused;s.currentStepPaused=false;this.playStep(s.currentStepId,o,s.playAllActive);s.isPlaying=true;this._togglePlayPause(false);break;default:break}}.bind(this)});this.procedureList=new T(this.getId()+"-procedureList",{tooltip:c().getText("STEP_NAV_PROCEDURESLISTHEADING"),selectedKey:"0",type:sap.m.SelectType.Default,enabled:true,width:"30%",autoAdjustWidth:true,change:function(e){var t=this.getProcedureList();var s=this.getSettings();s.currentProcedureIndex=0;s.currentProcedureId=this.instanceSettings.currentProcedureId=t.getSelectedKey();s.currentStepId=this.instanceSettings.currentStepId=null;for(var n=0;n<this.oModel.oData.procedures.length;n++){if(this.oModel.oData.procedures[n].id==s.currentProcedureId){s.currentProcedureIndex=n;s.currentProcedure=this.oModel.oData.procedures[n];break}}if(s.stepInfo.stepMessagePopup){if(s.stepInfo.stepMessagePopup.isOpen()){s.stepInfo.stepMessagePopup.close()}s.stepInfo.stepMessagePopup.destroy();s.stepInfo.stepMessagePopup=null}this._refreshItems()}.bind(this)});this.procedureList.addStyleClass("sapVizKitStepNavigationProcedureList");this.setAggregation("procedureItemTemplate",(new g).bindProperty("text","name").bindProperty("key","id").bindProperty("tooltip","name"));this.playMenuButton=new T(this.getId()+"-playMenuButtonIcon",{selectedKey:"0",type:sap.m.SelectType.Default,tooltip:c().getText("STEP_NAV_PLAYMENU_PLAYOPTIONS"),enabled:true,autoAdjustWidth:false,items:[new g({key:"0",icon:"sap-icon://media-play",text:c().getText("STEP_NAV_PLAYMENU_PLAY"),tooltip:c().getText("STEP_NAV_PLAYMENU_PLAY")}),new g({key:"1",icon:"sap-icon://media-play",text:c().getText("STEP_NAV_PLAYMENU_PLAYALL"),tooltip:c().getText("STEP_NAV_PLAYMENU_PLAYALL")}),new g({key:"2",icon:"sap-icon://media-play",text:c().getText("STEP_NAV_PLAYMENU_PLAYALLREMAINING"),tooltip:c().getText("STEP_NAV_PLAYMENU_PLAYALLREMAINING")})]});this.playMenuButton.addStyleClass("sapVizKitStepNavigationPlayOptionsSelect");this.pauseButton=new v(this.getId()+"-pauseButton",{type:sap.m.ButtonType.Transparent,icon:"sap-icon://media-pause",visible:false,tooltip:c().getText("STEP_NAV_PLAYMENU_PAUSE"),press:function(e){var t=this.getSettings();this.pauseStep();t.currentStepPaused=true;t.isPlaying=false;this._togglePlayPause(true)}.bind(this)});this.showStepInfoButton=new I(this.getId()+"-showStepInfoButton",{icon:"sap-icon://hide",type:sap.m.ButtonType.Transparent,pressed:false,text:c().getText("STEP_NAV_STEPDESCRIPTIONHEADING"),tooltip:c().getText("STEP_NAV_STEPDESCRIPTIONHEADING"),press:function(e){var t=e.getSource();if(t.getPressed()){this.setShowStepInfo(true);t.setIcon("sap-icon://show");t.setTooltip(c().getText("STEP_NAV_HIDESTEPDESCRIPTIONBUTTON"));var s=this.getSettings();if(s.currentStepId){this._highlightStep(s.currentStepId)}}else{this.setShowStepInfo(false);t.setIcon("sap-icon://hide");t.setTooltip(c().getText("STEP_NAV_SHOWSTEPDESCRIPTIONBUTTON"));if(this.stepMessagePopup&&this.stepMessagePopup.isOpen()){this.stepMessagePopup.close()}}}.bind(this)});this._layout.addContent(this.playPreviousButton).addContent(this.playOptionButton).addContent(this.pauseButton).addContent(this.playMenuButton).addContent(this.procedureList).addContent(this.showStepInfoButton).addContent(new m).addContent(this.playNextButton)};N.prototype.onSetContentConnector=function(e){e.attachContentReplaced(this._onContentReplaced,this);this._setContent(e.getContent())};N.prototype.onUnsetContentConnector=function(e){this._setContent(null);e.detachContentReplaced(this._onContentReplaced,this)};N.prototype._onContentReplaced=function(e){this._setContent(e.getParameter("newContent"))};N.prototype.getScroller=function(){return this._thumbnailsScroller};N.prototype.getProcedureList=function(){var e=this.getId()+"-procedureList";var t=this._layout;var s=h.byId(e);return t.getContent()[t.indexOfContent(s)]};N.prototype.getPlayMenuButton=function(){var e=this.getId()+"-playMenuButtonIcon";var t=this._layout;var s=h.byId(e);return t.getContent()[t.indexOfContent(s)]};N.prototype.getPlayOptionButton=function(){var e=this.getId()+"-playOptionButton";var t=this._layout;var s=h.byId(e);return t.getContent()[t.indexOfContent(s)]};N.prototype.getPauseButton=function(){var e=this.getId()+"-pauseButton";var t=this._layout;var s=h.byId(e);return t.getContent()[t.indexOfContent(s)]};N.prototype.getPlayNextButton=function(){var e=this.getId()+"-playNextButton";var t=this._layout;var s=h.byId(e);return t.getContent()[t.indexOfContent(s)]};N.prototype.getPlayPreviousButton=function(){var e=this.getId()+"-playPreviousButton";var t=this._layout;var s=h.byId(e);return t.getContent()[t.indexOfContent(s)]};N.prototype.getShowStepInfoButton=function(){var e=this.getId()+"-showStepInfoButton";var t=this._layout;var s=h.byId(e);return t.getContent()[t.indexOfContent(s)]};N.prototype._settings=function(){return{enabled:false,toggle:{addCss:function(e,t,s,n){if(!this.targets[e]){this.targets[e]={type:"css",property:t,onValue:s,offValue:n}}},addMethod:function(e,t,s,n,o){var r=e.getId();if(!this.targets[r]){this.targets[r]={type:"method",target:e,method:t,onValue:s,offValue:n,useJQuery:o}}},targets:{}},currentProcedureIndex:0,currentProcedureId:"",currentProcedure:null,currentStepId:null,currentStep:null,currentStepPaused:false,isPlaying:false,currentStepFinished:true,playAllActive:false,showToolbar:true,showThumbnails:true,portfolioMode:false,reset:function(){this.currentStep=null;this.currentProcedure=null;this.currentProcedureIndex=0;this.currentProcedureId="";this.currentStepId=null;this.currentStepPaused=false;this.currentStepFinished=true;this.playAllActive=false;this.portfolioMode=false},stepInfo:{lastTop:null,lastLeft:null,stepMessagePopup:null,openPopup:function(e,t,s,n){this._customHeaderText=this._customHeaderText||new A({width:"100%",textAlign:sap.ui.core.TextAlign.Center}).addStyleClass("sapVizKitStepNavigationPopoverTitle");this._customHeaderText.setText(e);this._customHeaderText.setTooltip(e);this._customHeader=this._customHeader||new b({contentLeft:[this._customHeaderText]});this._textContent=this._textContent||new A({});this._textContent.addStyleClass("sapVizKitStepNavigationPopoverContent");this._textContent.setText(t);this.stepMessagePopup=this.stepMessagePopup||new M({placement:n,showCloseButton:true,verticalScrolling:true,contentHeight:"10%",contentWidth:"30%",content:[this._textContent],customHeader:this._customHeader});this.stepMessagePopup.addStyleClass("sapVizKitStepNavigationPopoverStepInfo");this.stepMessagePopup.openBy(s)}}}};N.prototype.refresh=function(e){d.info("StepNavigation refresh() called.");if(this.getVisible()&&(this["_getStepThumbnails"]&&this._scene!=null)){var t=this.getProcedureList();var s=this.getSettings();s.reset();t.setSelectedItem(t.getFirstItem());var n=this._getStepThumbnails();if(s.stepInfo.stepMessagePopup){if(s.stepInfo.stepMessagePopup.isOpen()){s.stepInfo.stepMessagePopup.close()}s.stepInfo.stepMessagePopup.destroy();s.stepInfo.stepMessagePopup=null}this.oModel.setData(n);this._togglePlayPause(true);this._refreshControl()}else if(this.getVisible()){this._refreshControl()}return true};N.prototype.clear=function(){d.info("StepNavigation clear() called.");return true};N.prototype.onBeforeRendering=function(){if(this.getShowToolbar()){var e=this.getProcedureList();e.setModel(this.oModel);var t=this.getProcedureItemTemplate();e.bindItems("/procedures",t)}};N.prototype.onAfterRendering=function(){var e=this.getSettings();this._togglePlayPause(!e.isPlaying);if(e.currentStepId){this._highlightStep(e.currentStepId)}};var D={onAfterRendering:function(e){e.srcControl.focus();e.srcControl.removeEventDelegate(this)}};N.prototype._togglePlayPause=function(e){this.togglePlayPauseActive=true;if(this.getSettings().showToolbar){var t=this.getPlayOptionButton(),s=this.getPauseButton();if(e){if(h.getCurrentFocusedControlId()===s.getId()){t.addEventDelegate(D)}s.setVisible(false);t.setVisible(true)}else{if(h.getCurrentFocusedControlId()===t.getId()){s.addEventDelegate(D)}t.setVisible(false);s.setVisible(true)}}};N.prototype._refreshControl=function(){if(!this.oModel.oData.procedures){return}var e=this.getProcedureList();var t=this.getProcedureItemTemplate();var s=this.getSettings();if(s.stepInfo.stepMessagePopup){if(s.stepInfo.stepMessagePopup.isOpen()){s.stepInfo.stepMessagePopup.close()}s.stepInfo.stepMessagePopup.destroy();s.stepInfo.stepMessagePopup=null;this.getShowStepInfoButton().setText(c().getText("STEP_NAV_STEPDESCRIPTIONHEADING"))}e.unbindItems();if(this.oModel.oData.procedures.length>0){var n=this.oModel.oData.procedures[0];if(this.getShowToolbar()){e.bindItems("/procedures",t);e.selectedKey=n.id;e.enabled=true}this._refreshItems()}else{if(this.getShowToolbar()){e.bindItems("/procedures",t);e.enabled=false}if(this.getShowThumbnails()){var o=this.getScroller();o.destroyContent()}}};N.prototype._refreshItems=function(){var e=this;var t=[];var s=this.getProcedureList();var n=e.getSettings();var o=new E;if(!n.currentProcedure){n.currentProcedure=e.oModel.oData.procedures[n.currentProcedureIndex];s.setSelectedItem(s.getFirstItem())}if(n.currentProcedureId!=""||e.oModel.oData.procedures.length>0){if(e.getShowThumbnails()){var r=e.getScroller();r.removeAllContent();t=e.oModel.oData.procedures[n.currentProcedureIndex].steps;var i=function(t){n.currentStepPaused=false;var s=h.byId(t.getSource().getId());e.playStep(s.getCustomData()[0].getValue("stepId"));n.playAllActive=false;e._togglePlayPause(false)};var a=function(e){var t=80;var s=e.getSource();var n=s.getDomRef().width;var o=s.getDomRef().height;var r=n/o;if(n>o){s.setWidth(t+"px");s.setHeight(t/r+"px")}else{s.setHeight(t+"px");s.setWidth(t*r+"px")}};for(var p=0;p<t.length;p++){var l=new C({alt:t[p].name,src:"data:image/"+t[p].thumbnailType+";base64,"+t[p].thumbnailData,densityAware:false,tooltip:t[p].name,press:i.bind(e),load:a,layoutData:new x({shrinkFactor:0})});l.data("stepId",t[p].id);l.addCustomData(new f({key:"stepId",value:t[p].id}));l.addStyleClass("sapVizKitStepNavigationStepItem");o.addItem(l)}r.addContent(o)}}};N.prototype._getPopupPlacement=function(e){var t=null;var s=0;while(e){s+=e.offsetTop;e=e.offsetParent}if(s>200){t=sap.m.PlacementType.Top}else{t=sap.m.PlacementType.Bottom}return t};N.prototype._isScrollingNecessary=function(e,t){var s;if(e&&t){var n=jQuery(e).offset().left+jQuery(e).width();var o=jQuery(t).width();if(n-jQuery(e).width()<0){s=true}else if(o-n<jQuery(e).width()){s=true}else{s=false}}else{s=false}return s};N.prototype._scrollToItem=function(e,t){var s={},n=jQuery(e).offset(),o=jQuery(t).scrollLeft();s.scrollLeft=n.left+(o-jQuery(t).offset().left);s.scrollLeft-=parseInt(jQuery(e).css("marginLeft"),10)||0;s.scrollLeft-=parseInt(jQuery(e).css("borderLeftWidth"),10)||0;jQuery(t).animate(s,50)};N.prototype._highlightStep=function(e){var t=this;if(t.getVisible()){var s=t.getSettings();var n=t.getStep(0,s.currentProcedureIndex,e);if(!s.currentProcedure){s.currentProcedure=t.oModel.oData.procedures[t.oSettings.currentProcedureIndex]}var o=t.getShowStepInfoButton();var r;var i=document.getElementById(o.getId());r=t._getPopupPlacement(i);if(t.getShowStepInfo()){s.stepInfo.openPopup.call(this,n.name,n.description,o,r)}else if(s.stepInfo.stepMessagePopup&&s.stepInfo.stepMessagePopup.isOpen()){s.stepInfo.stepMessagePopup.close()}if(t.getShowThumbnails()){var a=t.getScroller();var p=a.getContent()[0].getItems();for(var l=0;l<p.length;l++){if(p[l].getCustomData()[0].getValue("stepId")==e){p[l].addStyleClass("selected");if(t._isScrollingNecessary(p[l].$()[0],jQuery("#"+a.sId)[0])){t._scrollToItem(p[l].$()[0],jQuery("#"+a.sId)[0])}}else{p[l].removeStyleClass("selected")}}}}};N.prototype.getProceduresAndSteps=function(){return this._getStepThumbnails()};N.prototype._getStepThumbnails=function(){var e=function(e,t,s){var n,o,r;try{var i=t.Scene.RetrieveThumbnail(e,s.id);if(i===sap.ve.dvl.DVLRESULT.NOTFOUND){n=this._emptyThumbnail}else{n=p(i)}r=n.substring(0,3);if(r==="iVB"){o="png"}else{o="jpg"}s.thumbnailData=n;s.thumbnailType=o}catch(e){if(e.code!==sap.ve.dvl.DVLRESULT.NOTFOUND){d.error(e.message,e.code,"sap.ui.vk.StepNavigation")}s.thumbnailData=null;s.thumbnailType=null}};var t=this._retrieveProcedures();if(t.sceneId!=null){t.procedures.forEach(function(s){s.steps.forEach(e.bind(this,t.sceneId,this.oDvl))},this);t.portfolios.forEach(function(s){s.steps.forEach(e.bind(this,t.sceneId,this.oDvl))},this);t.hasThumbnails=true}this._procedures=t;return t};N.prototype._retrieveProcedures=function(e){var t=this;var s={};if(!t._procedures){s={sceneId:null,hasThumbnails:false,procedures:[],portfolios:[]}}else{s=t._procedures}if(t._scene&&s.sceneId!=(e||t._scene._dvlSceneRef)){var n=e||t._scene._dvlSceneRef;if(n!=null){s={sceneId:null,hasThumbnails:false,procedures:[],portfolios:[]};try{var r=l(t.oDvl.Scene.RetrieveProcedures(n));if(r!=null){s.hasThumbnails=false;s.sceneId=t._scene._dvlSceneRef;s.procedures=r.procedures;s.portfolios=r.portfolios}}catch(e){if(!(e instanceof o&&e.code===sap.ve.dvl.DVLRESULT.NOTIMPLEMENTED)){throw e}}}}return s};N.prototype.getStep=function(e,t,s){var n=this;var o=n.oDvl.Settings.LastLoadedSceneId;var r=null;if(o!=null){t=t!=null?t:0;var i=s?s:n.instanceSettings.currentStepId;var a=n._retrieveProcedures(o);var p=a.procedures[t];if(p&&p.steps.length>0){r=p.steps[0]}else{return null}if(i!=""){for(var l=0;l<p.steps.length;l++){var u=p.steps[l];if(u.id==i){var c=l+e;if(c<p.steps.length&&c>=0){r=p.steps[c]}else{r=null}break}}}}return r};N.prototype.pauseStep=function(){var e=this;var t=e.oDvl.Settings.LastLoadedSceneId;if(t!=null){e.oDvl.Scene.PauseCurrentStep(t)}};N.prototype._stepCount=function(e){var t=this;var s=t.oDvl.Settings.LastLoadedSceneId;var n=0;if(s!=null){var o=t._retrieveProcedures(s);for(var r=0;r<o.procedures.length;r++){if(o.procedures[r].id==e){n=o.procedures[r].steps.length;break}else if(e==null){n+=o.procedures[r].steps.length}}}return n};N.prototype.getPreviousStep=function(e){var t=this;return t.getStep(-1,e)};N.prototype.getNextStep=function(e){var t=this;return t.getStep(1,e)};N.prototype.playStep=function(e,t,s){var n=this;var o=n.oDvl.Settings.LastLoadedSceneId;if(o!=null){n.instanceSettings.currentStepId=e;n.oDvl.Scene.ActivateStep(o,e,t!=null?t:true,s!=null?s:false)}};N.prototype.playAllSteps=function(e){var t=this;var s=t.oDvl.Settings.LastLoadedSceneId;if(s!=null){var n=t._retrieveProcedures(s);var o=0;if(e!=null&&n.procedures.length>1){for(var r=0;r<n.procedures.length;r++){if(n.procedures[r].id==e){o=r;break}}}if(n.procedures.length>0){var i=n.procedures[o].steps[0];if(i){t.instanceSettings.currentStepId=i.id;t.oDvl.Scene.ActivateStep(s,i.id,true,true)}}}};N.prototype._setContent=function(e){if(this._bIsBeingDestroyed){return this}var t=null;if(e&&e instanceof u){t=e}this.setScene(t);return this};return N});
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/StepNavigationRenderer", [],function(){"use strict";var t={apiVersion:2};t.render=function(e,i){if(!i.getVisible()){return}if(i.getShowToolbar()||i.getShowThumbnails){var r=i.getWidth()!=="auto"?i.getWidth():"100%";var n=i.getHeight()!=="auto"?i.getHeight():"auto";e.openStart("div",i);e.style("width",r);e.style("height",n);e.class("sapVizKitStepNavigation");var o=i.getTooltip_AsString();if(o){e.attr("title",o)}if(!i.getVisible()){e.style("visibility","hidden")}e.openEnd();e.renderControl(i.getAggregation("layout"));if(i.getShowThumbnails()){t._renderScrollerDiv(e,i)}e.close("div")}};t._renderScrollerDiv=function(t,e){t.renderControl(e.getAggregation("thumbnailsContainer"))};return t},true);
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/Texture", ["sap/ui/base/ManagedObject"],function(e){"use strict";var t=e.extend("sap.ui.vk.Texture",{metadata:{library:"sap.ui.vk",properties:{filterMode:{type:"int",defaultValue:0},uvRotationAngle:{type:"float",defaultValue:0},uvHorizontalOffset:{type:"float",defaultValue:0},uvVerticalOffset:{type:"float",defaultValue:0},uvHorizontalScale:{type:"float",defaultValue:0},uvVerticalScale:{type:"float",defaultValue:0},uvHorizontalTilingEnabled:{type:"boolean",defaultValue:true},uvVerticalTilingEnabled:{type:"boolean",defaultValue:true}}}});t.prototype.load=function(e){return this};t.prototype.getTextRef=function(){return null};return t});
/*!
* SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
*/
sap.ui.predefine("sap/ui/vk/ToggleMenuButton", ["./library","sap/ui/core/Control","sap/m/library","sap/m/Button","sap/m/ButtonRenderer","sap/m/OverflowToolbarToggleButton","sap/m/Menu","sap/ui/core/Element","sap/ui/core/EnabledPropagator","sap/ui/core/IconPool","sap/ui/core/library","sap/ui/core/Popup","sap/ui/Device","sap/ui/events/KeyCodes","./ToggleMenuButtonRenderer"],function(e,t,o,r,n,i,s,a,p,u,l,g,f,h,d){"use strict";var c=l.TextDirection;var m=o.ButtonType;var y=g.Dock;var B=t.extend("sap.ui.vk.ToggleMenuButton",{metadata:{interfaces:["sap.m.IOverflowToolbarContent"],library:"sap.ui.vk",properties:{type:{type:"sap.m.ButtonType",group:"Appearance",defaultValue:m.Default},width:{type:"sap.ui.core.CSSSize",group:"Misc",defaultValue:null},enabled:{type:"boolean",group:"Behavior",defaultValue:true},iconDensityAware:{type:"boolean",group:"Misc",defaultValue:true},menuPosition:{type:"sap.ui.core.Popup.Dock",group:"Misc",defaultValue:y.BeginBottom},textDirection:{type:"sap.ui.core.TextDirection",group:"Appearance",defaultValue:c.Inherit},pressed:{type:"boolean",group:"Data",defaultValue:false}},aggregations:{_menu:{type:"sap.m.Menu",multiple:false,visibility:"hidden"},_toggleButton:{type:"sap.m.OverflowToolbarToggleButton",multiple:false,visibility:"hidden"},_arrowButton:{type:"sap.m.Button",multiple:false,visibility:"hidden"},items:{type:"sap.ui.vk.ToggleMenuItem",multiple:true,forwarding:{getter:"_getMenu",aggregation:"items",forwardBinding:true}}},associations:{defaultItem:{type:"sap.ui.vk.ToggleMenuItem",multiple:false},ariaDescribedBy:{type:"sap.ui.core.Control",multiple:true,singularName:"ariaDescribedBy"},ariaLabelledBy:{type:"sap.ui.core.Control",multiple:true,singularName:"ariaLabelledBy"}},events:{beforeMenuOpen:{},itemToggled:{parameters:{oldItem:{type:"sap.ui.vk.ToggleMenuItem"},newItem:{type:"sap.ui.vk.ToggleMenuItem"}}},itemSelected:{parameters:{item:{type:"sap.ui.vk.ToggleMenuItem"}}}}}});p.call(B.prototype);B.prototype.init=function(){if(t.init){t.init.call(this)}var e=new s({id:this.getId()+"-menu"});e.attachClosed(this._menuClosed,this);e.attachItemSelected(this._menuItemSelected,this);this.setAggregation("_menu",e);var o=new i({id:this.getId()+"-toggleButton",width:"100%",tooltip:this.getTooltip(),press:function(){var e=a.getElementById(this.getDefaultItem());if(e){this.fireItemToggled(this.getPressed()?{newItem:e,oldItem:null}:{newItem:null,oldItem:e})}}.bind(this)}).addStyleClass("sapUiVkTMBText");this.setAggregation("_toggleButton",o);var n=new r({id:this.getId()+"-arrowButton",icon:"sap-icon://slim-arrow-down",tooltip:this.getTooltip(),ariaHasPopup:l.aria.HasPopup.Menu,press:function(){this._handleArrowPress()}.bind(this)}).addStyleClass("sapUiVkTMBArrow");this.setAggregation("_arrowButton",n)};B.prototype._getMenu=function(){return this.getAggregation("_menu")};B.prototype._getToggleButton=function(){return this.getAggregation("_toggleButton")};B.prototype._getArrowButton=function(){return this.getAggregation("_arrowButton")};B.prototype.onAfterRendering=function(){var e=this._getToggleButton().$(),t=this._getArrowButton().$();e.attr("tabindex","-1");t.attr("tabindex","-1");e.removeAttr("title");t.removeAttr("title");e.removeAttr("aria-describedby");t.removeAttr("aria-describedby")};B.prototype._handleArrowPress=function(e){var t=this._getMenu(),o={zero:"0 0",plus2_right:"0 +2",minus2_right:"0 -2",plus2_left:"+2 0",minus2_left:"-2 0"};this.fireBeforeMenuOpen();if(this._popupOpened){this._getMenu().close();this._popupOpened=false;return}if(!t.getTitle()){t.setTitle(this.getText())}var r=[this,e];switch(this.getMenuPosition()){case y.BeginTop:r.push(y.BeginBottom,y.BeginTop,o.plus2_right);break;case y.BeginCenter:r.push(y.BeginCenter,y.BeginCenter,o.zero);break;case y.LeftTop:r.push(y.RightBottom,y.LeftBottom,o.plus2_left);break;case y.LeftCenter:r.push(y.RightCenter,y.LeftCenter,o.plus2_left);break;case y.LeftBottom:r.push(y.RightTop,y.LeftTop,o.plus2_left);break;case y.CenterTop:r.push(y.CenterBottom,y.CenterTop,o.plus2_left);break;case y.CenterCenter:r.push(y.CenterCenter,y.CenterCenter,o.zero);break;case y.CenterBottom:r.push(y.CenterTop,y.CenterBottom,o.minus2_right);break;case y.RightTop:r.push(y.LeftBottom,y.RightBottom,o.minus2_left);break;case y.RightCenter:r.push(y.LeftCenter,y.RightCenter,o.minus2_left);break;case y.RightBottom:r.push(y.LeftTop,y.RightTop,o.minus2_left);break;case y.EndTop:r.push(y.EndBottom,y.EndTop,o.plus2_right);break;case y.EndCenter:r.push(y.EndCenter,y.EndCenter,o.zero);break;case y.EndBottom:r.push(y.EndTop,y.EndBottom,o.minus2_right);break;case y.BeginBottom:default:r.push(y.BeginTop,y.BeginBottom,o.minus2_right);break}t.openBy.apply(t,r);if(this._getMenu()){this._popupOpened=true}this._writeAriaAttributes();if(!f.system.phone){this.setArrowState(true)}};B.prototype._menuClosed=function(){this._popupOpened=false;this.setArrowState(false);var e=this._getArrowButton();e.$().removeAttr("aria-controls");e.$().attr("aria-expanded","false")};B.prototype._writeAriaAttributes=function(){var e=this._getArrowButton(),t=this._getMenu();if(t){e.$().attr("aria-controls",t.getDomRefId());e.$().attr("aria-expanded","true")}};B.prototype.setArrowState=function(e){this._getArrowButton().$()[e?"addClass":"removeClass"]("sapMSBActive")};B.prototype.getPressed=function(){return this._getToggleButton().getPressed()};B.prototype.setProperty=function(e,o,n){if(e==="type"&&(o===m.Up||o===m.Back||o===m.Unstyled)){return this}var s=t.prototype.setProperty.apply(this,arguments);function a(e){return e.charAt(0).toUpperCase()+e.slice(1)}if(e==="iconDensityAware"||e==="textDirection"){i.prototype.setProperty.apply(this._getToggleButton(),arguments)}else if(e==="text"||e==="type"||e==="icon"||e==="pressed"){var p="set"+a(e);i.prototype[p].call(this._getToggleButton(),o);if(e==="type"){r.prototype[p].call(this._getArrowButton(),o)}}return s};B.prototype.onkeydown=function(e){if(e.which===h.SPACE){e.preventDefault()}this._getToggleButton().onkeydown(e)};B.prototype.onkeyup=function(e){this._getToggleButton().onkeyup(e)};B.prototype.onsapup=function(e){this._handleArrowPress()};B.prototype.onsapdown=function(e){this._handleArrowPress()};B.prototype.onsapupmodifiers=function(e){this._handleArrowPress()};B.prototype.onsapdownmodifiers=function(e){this._handleArrowPress()};B.prototype.onsapshow=function(e){this._handleArrowPress();e.preventDefault()};B.prototype.getButtonTypeAriaLabelId=function(){var e=this._getToggleButton().getType();return n.getButtonTypeAriaLabelId(e)};B.prototype.getTitleAttributeValue=function(){var e=this.getTooltip_AsString(),t=u.getIconInfo(this.getIcon()),o;if(e||t&&t.text&&!this.getText()){o=e||t.text}return o};B.prototype._onBeforeEnterOverflow=function(){this._getToggleButton()._bInOverflow=true};B.prototype._onAfterExitOverflow=function(){this._getToggleButton()._bInOverflow=false};B.prototype.getOverflowToolbarConfig=function(){return{canOverflow:true,propsUnrelatedToSize:["enabled","type","icon","accesskey","pressed"],autoCloseEvents:["press"],onBeforeEnterOverflow:this._onBeforeEnterOverflow.bind(this),onAfterExitOverflow:this._onAfterExitOverflow.bind(this)}};B.prototype._menuItemSelected=function(e){var t=e.getParameter("item");if(t.getToggleable()){var o=this._getToggleButton();var r=o.getPressed()?a.getElementById(this.getDefaultItem()):null;if(t!==r){this.setDefaultItem(t);o.setPressed(true);o.rerender();this.fireItemToggled({newItem:t,oldItem:r})}else{o.setPressed(!o.getPressed());this.fireItemToggled(o.getPressed()?{newItem:t,oldItem:null}:{newItem:null,oldItem:t})}}else{this.fireItemSelected({item:t})}this._popupOpened=false};B.prototype.getIcon=function(){return this._getToggleButton().getIcon()};B.prototype.getText=function(){return r.prototype._getText.call(this._getToggleButton())};B.prototype.setDefaultItem=function(e){this.setAssociation("defaultItem",e);if(e==null){return this}if(typeof e==="string"){e=a.getElementById(e)}var t=e.getIcon();var o=this._getToggleButton();o.setIcon(t);o.setText(e.getText());this.rerender();return this};B.prototype.onBeforeRendering=function(){if(!this.getDefaultItem()){var e=this.getItems().find(function(e){return e.getToggleable()});if(e){this.setDefaultItem(e)}}};return B});
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/ToggleMenuButtonRenderer", ["./library","sap/m/library","sap/ui/core/InvisibleText","sap/ui/core/ShortcutHintsMixin"],function(t,e,i,a){"use strict";var r=e.ButtonType;var n={apiVersion:2};var s="sapUiVkTMB";n.render=function(t,e){var i=e.getWidth(),n=e.getType(),o=e.getEnabled(),l=e.getTitleAttributeValue(),c;t.openStart("div",e).class(s);if(e._getToggleButton().getIcon()){t.class(s+"HasIcon")}if(n===r.Accept||n===r.Reject||n===r.Emphasized||n===r.Transparent||n===r.Attention||n===r.Neutral||n===r.Critical||n===r.Success||n===r.Negative){t.class(s+n)}this.writeAriaAttributes(t,e);t.attr("tabindex",o?"0":"-1");if(l&&!a.isDOMIDRegistered(e.getId())){t.attr("title",l)}if(i!=""||i.toLowerCase()==="auto"){t.style("width",i)}t.openEnd();t.openStart("div").class("sapUiVkTMBInner");if(!o){t.class("sapUiVkTMBInnerDisabled")}t.openEnd();t.renderControl(e._getToggleButton());t.renderControl(e._getArrowButton());t.close("div");if(l){c=e.getId()+"-tooltip";t.openStart("span",c);t.class("sapUiInvisibleText");t.openEnd();t.text(l);t.close("span")}t.close("div")};n.writeAriaAttributes=function(t,e){var i={};this.writeAriaRole(e,i);this.writeAriaLabelledBy(e,i);t.accessibilityState(e,i)};n.writeAriaRole=function(t,e){e["role"]="group"};n.writeAriaLabelledBy=function(t,e){var a="",r=t.getButtonTypeAriaLabelId(),n=t.getTitleAttributeValue(),s;if(r){a+=r;a+=" "}if(n){s=t.getId()+"-tooltip";a+=s+" "}a+=i.getStaticId("sap.m","SPLIT_BUTTON_DESCRIPTION")+" ";a+=i.getStaticId("sap.m","SPLIT_BUTTON_KEYBOARD_HINT");e["labelledby"]={value:a,append:true}};return n},true);
/*!
* SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
*/
sap.ui.predefine("sap/ui/vk/ToggleMenuItem", ["sap/m/MenuItem","./ToggleMenuItemRenderer"],function(e,r){"use strict";var t=e.extend("sap.ui.vk.ToggleMenuItem",{metadata:{library:"sap.ui.vk",properties:{toggleable:{type:"boolean",group:"Behavior",defaultValue:true}}},renderer:r});return t});
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/ToggleMenuItemRenderer", ["sap/ui/core/library"],function(e){"use strict";const t=e.ItemSelectionMode;const n={apiVersion:2};n.render=function(e,t){const n=!!t._getVisibleItems().length;e.openStart("li",t);this.renderAttributes(e,t);this.renderStyleClasses(e,t);this.renderInlineStyles(e,t);this.setAccessibilityAttributes(e,t);e.openEnd();this.renderIcon(e,t);this.renderText(e,t);if(n){this.renderSubmenuArrow(e,t)}else{this.renderShortcut(e,t);this.renderEndContent(e,t);this.renderSelectionMark(e,t)}e.close("li")};n.renderAttributes=function(e,t){if(t.getTooltip_AsString()){e.attr("title",t.getTooltip_AsString())}if(t.getVisible()&&t.isFocusable&&t.isFocusable()){e.attr("tabindex","0")}};n.renderStyleClasses=function(e,t){const n=t.getEnabled();e.class("sapMMenuItem");if(!n){e.class("sapMMenuItemDisabled")}};n.renderInlineStyles=function(e,t){};n.setAccessibilityAttributes=function(e,t){e.accessibilityState(t._getAccessibilityAttributes())};n.renderIcon=function(e,t){e.openStart("div");e.class("sapMMenuItemIcon");e.openEnd();if(t.getIcon()){const n=t._getIcon();e.renderControl(n)}e.close("div")};n.renderText=function(e,t){e.openStart("div",`${t.getId()}-txt`);e.class("sapMMenuItemText");e.openEnd();e.text(t.getText());e.close("div")};n.renderShortcut=function(e,t){const n=t.getShortcutText();if(n){e.openStart("div",`${t.getId()}-scuttxt`);e.class("sapMMenuItemShortcut");e.openEnd();e.text(n);e.close("div")}};n.renderSubmenuArrow=function(e,t){e.openStart("div");e.class("sapMMenuItemSubMenu");e.openEnd();e.openStart("div");e.class("sapUiIconMirrorInRTL");e.openEnd();e.close("div");e.close("div")};n.renderEndContent=function(e,t){const n=t.getEndContent();if(n.length){e.openStart("div",`${t.getId()}-endContent`);e.class("sapMMenuEndContent");e.openEnd();n.forEach(t=>e.renderControl(t));e.close("div")}};n.renderSelectionMark=function(e,n){if(n.getSelected()&&n._getItemSelectionMode()!==t.None){e.openStart("div",`${n.getId()}-sel`);e.class("sapMMenuItemSelected");e.openEnd();e.close("div")}};return n},true);
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/Toolbar", ["./library","./getResourceBundle","sap/ui/core/Control","sap/m/library","sap/m/Title","sap/m/Button","sap/m/ToggleButton","sap/m/ToolbarSpacer","sap/m/ToolbarSeparator","sap/m/Toolbar","sap/ui/core/Element"],function(e,t,n,i,r,a,o,l,s,p,u){"use strict";var T=i.ToolbarDesign;var c=i.ButtonType;var _=n.extend("sap.ui.vk.Toolbar",{metadata:{library:"sap.ui.vk",properties:{title:{type:"string",group:"Appearance",defaultValue:""}},events:{},associations:{viewer:{type:"sap.ui.vk.Viewer",multiple:false}},aggregations:{content:{type:"sap.ui.core.Control",multiple:true,forwarding:{getter:"_getToolbar",aggregation:"content",forwardBinding:true}},_toolbar:{type:"sap.m.Toolbar",multiple:false,visibility:"hidden"}}},constructor:function(e,t){n.apply(this,arguments);this._getViewer()?.attachFullScreen(this._fullScreenHandler,this)},renderer:{apiVersion:2,render:function(e,t){e.openStart("div",t);e.class("sapVizKitToolbar");e.openEnd();e.renderControl(t.getAggregation("_toolbar"));e.close("div")}}});_.prototype._getToolbar=function(){return this._toolbar};_.prototype._getViewer=function(){return u.getElementById(this.getViewer())};_.prototype._onFullScreen=function(){this._getViewer()?.activateFullScreenMode()};_.prototype._fullScreenHandler=function(e){var t=e.mParameters.isFullScreen;this._enterFullScreenButton.setPressed(t);if(t){this._enterFullScreenButton.setIcon("sap-icon://exit-full-screen")}else{this._enterFullScreenButton.setIcon("sap-icon://full-screen")}};_.prototype.init=function(){if(n.prototype.init){n.prototype.init.apply(this)}this._stepNavigationButton=new o({icon:"sap-icon://step",type:c.Transparent,tooltip:t().getText("STEP_NAV_MENUBUTTONTOOLTIP"),visible:"{= ${_internal>/stepNavigation/enabled} === true && ${_internal>/stepNavigation/supported} === true }",pressed:"{_internal>/stepNavigation/visible}"}).data("help-id","sapUiVkStepNavigationBtn",true);this._sceneTreeButton=new o({icon:"sap-icon://tree",type:c.Transparent,tooltip:t().getText("SCENETREE_MENUBUTTONTOOLTIP"),visible:"{= ${_internal>/sceneTree/enabled} === true && ${_internal>/sceneTree/supported} === true }",pressed:"{_internal>/sceneTree/visible}"}).data("help-id","sapUiVkSceneTreeBtn",true);this._layersPanelButton=new o({icon:"sap-icon://dimension",type:c.Transparent,tooltip:t().getText("LAYERS_BUTTONTOOLTIP"),visible:"{= ${_internal>/layersPanel/enabled} === true && ${_internal>/layersPanel/supported} === true }",pressed:"{_internal>/layersPanel/visible}"}).data("help-id","sapUiVkLayersBtn",true);this._elementsPanelButton=new o({icon:"sap-icon://group-2",type:c.Transparent,tooltip:t().getText("ELEMENTS_BUTTONTOOLTIP"),visible:"{= ${_internal>/elementsPanel/enabled} === true && ${_internal>/elementsPanel/supported} === true }",pressed:"{_internal>/elementsPanel/visible}"}).data("help-id","sapUiVkElementsBtn",true);this._pageGalleryButton=new o({icon:"sap-icon://documents",type:c.Transparent,tooltip:t().getText("PAGE_GALLERY_BUTTONTOOLTIP"),visible:"{= ${_internal>/pageGallery/enabled} === true && ${_internal>/pageGallery/supported} === true }",pressed:"{_internal>/pageGallery/visible}"}).data("help-id","sapUiVkPageGalleryBtn",true);this._miniMapButton=new o({icon:"sap-icon://map-3",type:c.Transparent,tooltip:t().getText("MINIMAP_BUTTONTOOLTIP"),visible:"{= ${_internal>/miniMap/enabled} === true && ${_internal>/miniMap/supported} === true }",pressed:"{_internal>/miniMap/visible}"}).data("help-id","sapUiVkMiniMapBtn",true);this._toggleHotspotsButton=new o({icon:"sap-icon://example",type:c.Transparent,tooltip:t().getText("TOGGLE_HOTSPOTS_BUTTONTOOLTIP"),visible:"{= ${_internal>/hotspots/supported} === true && ${_internal>/hotspots/enabled} === true }",pressed:"{_internal>/hotspots/showAll}"}).data("help-id","sapUiVkToolgeHotspotsBtn",true);this._toolbarTitle=new r;this._enterFullScreenButton=new a({icon:"sap-icon://full-screen",type:c.Transparent,press:this._onFullScreen.bind(this),tooltip:t().getText("ENTER_FULLSCREEN")}).data("help-id","sapUiVkEnterFullScreenBtn",true).addStyleClass("sapUiVkFullScreenToolbarButton");var e=[new l,this._toolbarTitle,new l,this._sceneTreeButton,this._stepNavigationButton,this._layersPanelButton,this._elementsPanelButton,this._pageGalleryButton,this._toggleHotspotsButton,this._miniMapButton,new s,this._enterFullScreenButton];this._toolbar=new p({design:T.Solid,content:e}).data("help-id","sapUiVkViewerToolbar",true);this.setAggregation("_toolbar",this._toolbar,true)};_.prototype.exit=function(){this._getViewer()?.detachFullScreen(this._fullScreenHandler,this)};_.prototype.onBeforeRendering=function(){this._toolbar.setVisible(true);this._toolbarTitle.setText(this.getTitle())};return _});
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/TransformationMatrix", ["sap/ui/base/DataType","sap/base/assert"],function(n,r){"use strict";var t={};t.parseValue=function(r){var t=n.getType("float");return r.split(/\s*,\s*|\s+/).map(t.parseValue.bind(t))};t.convertTo4x4=function(n){var r=n;return[r[0],r[1],r[2],0,r[3],r[4],r[5],0,r[6],r[7],r[8],0,r[9],r[10],r[11],1]};t.canConvertTo4x3=function(n){var r=function(n,r){return Math.abs(n-r)<1e-5};return r(n[3],0)&&r(n[7],0)&&r(n[11],0)&&r(n[15],1)};t.convertTo4x3=function(n){var e=n;r(t.canConvertTo4x3(e),"The transformation matrix is invalid. The last row must be [0, 0, 0, 1].");return[e[0],e[1],e[2],e[4],e[5],e[6],e[8],e[9],e[10],e[12],e[13],e[14]]};t.convert3x2To4x3=function(n){return[n[0],n[1],0,n[2],n[3],0,0,0,1,n[4],n[5],0]};t.convert4x3To3x2=function(n){return new Float32Array([n[0],n[1],n[3],n[4],n[9],n[10]])};t.convert4x4To3x2=function(n){return new Float32Array([n[0],n[1],n[4],n[5],n[12],n[13]])};t.convertTo3x2=function(n){if(n){if(n.length===12){return t.convert4x3To3x2(n)}else if(n.length===16){return t.convert4x4To3x2(n)}}return new Float32Array([1,0,0,1,0,0])};return t},true);
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/View", ["sap/ui/base/ManagedObject","sap/ui/model/json/JSONModel","./findIndexInArray","./AnimationPlayback","./NavigationMode","./Core"],function(t,a,e,i,s,n){"use strict";var o=t.extend("sap.ui.vk.View",{metadata:{library:"sap.ui.vk",interfaces:["sap.ui.vk.IPlaybackCollection"],properties:{viewId:{type:"string"},name:{type:"string"},description:{type:"string"},aspectRatio:{type:"float"},autoPlayAnimation:{type:"boolean",defaultValue:true},topColor:{type:"sap.ui.core.CSSColor",defaultValue:"rgba(238, 238, 238, 1)"},bottomColor:{type:"sap.ui.core.CSSColor",defaultValue:"rgba(255, 255, 255, 1)"},navigationMode:{type:"sap.ui.vk.NavigationMode",defaultValue:s.NoChange},dimension:{type:"int"}}}});o.prototype.init=function(){this._playbacks=[];this._playbacksJSONData=[];this._model=new a({playbacks:this._playbacksJSONData});this._model.setSizeLimit(1e3*1e3);this._highlightIdNodesMap=new Map};o.prototype.exit=function(){this._playbacks=undefined;this._playbacksJSONData=undefined;this._highlightIdNodesMap=undefined};o.prototype.getCamera=function(){return this._camera};o.prototype.setCamera=function(t){this._camera=t;return this};o.prototype.hasHighlight=function(){return this._highlightIdNodesMap!=null&&this._highlightIdNodesMap.size>0};o.prototype.getHighlightIdNodesMap=function(){return this._highlightIdNodesMap};o.prototype.addHighlightedNodes=function(t,a){var e=this._highlightIdNodesMap.get(t);if(!Array.isArray(a)){a=[a]}if(!e){this._highlightIdNodesMap.set(t,a)}else{e=e.concat(a.filter(function(t){return e.indexOf(t)<0}));this._highlightIdNodesMap.set(t,e)}};o.prototype.hasAnimation=function(){return this._playbacks!=null&&this._playbacks.length>0};o.prototype.getPlaybacks=function(){return this._playbacks};o.prototype.getPlayback=function(t){if(t<0||t>=this._playbacks.length){return undefined}return this._playbacks[t]};o.prototype.indexOfPlayback=function(t){return e(this._playbacks,function(a){return a===t})};o.prototype.addPlayback=function(t,a){this._playbacks.push(t);this._playbacksJSONData.push(t.getJSONData());if(this._model){this._model.updateBindings()}t.setJSONModel(this._model);if(!a){this._firePlaybacksChanged("playbackAdded",t)}return this};o.prototype.insertPlayback=function(t,a,e){if(a<0){a=0}else if(a!==0&&a>=this._playbacks.length){a=this._playbacks.length}this._playbacks.splice(a,0,t);this._playbacksJSONData.splice(a,0,t.getJSONData());if(this._model){this._model.updateBindings()}if(!e){this._firePlaybacksChanged("playbackInserted",t)}return this};o.prototype.sortPlaybacks=function(t){this._playbacks.sort(function(t,a){return t.getStartTime()-a.getStartTime()});this._playbacksJSONData=[];this._playbacks.forEach(function(t){this._playbacksJSONData.push(t.getJSONData())}.bind(this));var a=true;for(var e=0;e<this._playbacks.length-1;e++){var i=this._playbacks[e].getStartTime();var s=this._playbacks[e+1].getStartTime();if(s-i<1e-5){a=false;break}}if(!t){this._firePlaybacksChanged("playbacksOrderChanged")}return a};o.prototype.removePlayback=function(t,a){var i;if(typeof t==="number"){i=t}else if(typeof t==="string"){i=e(this._playbacks,function(a){return a.getId()===t})}else{i=e(this._playbacks,function(a){return a===t})}var s;if(i!=null&&i>=0&&i<this._playbacks.length){s=this._playbacks[i];this._playbacks.splice(i,1);this._playbacksJSONData.splice(i,1);if(this._model){this._model.updateBindings()}}if(!a){this._firePlaybacksChanged("playbackRemoved",s)}return this};o.prototype.removePlaybacks=function(t){this._playbacks.splice(0);this._playbacksJSONData.splice(0);if(this._model){this._model.updateBindings()}if(!t){this._firePlaybacksChanged("playbacksRemoved")}return this};o.prototype.switchPlaybacks=function(t,a,e){var i,s;for(var n=0;n<this._playbacks.length;n++){if(this._playbacks[n]===t){i=n}else if(this._playbacks[n]===a){s=n}}if(i!==undefined&&s!==undefined){var o=this._playbacks[i];var r=this._playbacksJSONData[i];this._playbacks[i]=this._playbacks[s];this._playbacksJSONData[i]=this._playbacksJSONData[s];this._playbacks[s]=o;this._playbacksJSONData[s]=r}this.resetPlaybacksStartTimes(true);if(!e){this._firePlaybacksChanged("playbacksOrderChanged")}return this};o.prototype.resetPlaybacksStartTimes=function(t){if(this._playbacks.length===0){return this}var a=0;for(var e=0;e<this._playbacks.length;e++){this._playbacks[e].setStartTime(a);a+=this._playbacks[e].getDuration()}if(!t){this._firePlaybacksChanged("playbacksStartTimeChanged")}return this};o.prototype._firePlaybacksChanged=function(t,a){n.getEventBus().publish("sap.ui.vk","playbacksChanged",{viewId:this.getViewId(),operation:t,playback:a})};o.prototype.setPlaybacksReversed=function(t,a){for(var e=0;e<this._playbacks.length;e++){this._playbacks[e].setReversed(t)}if(!a){this._firePlaybacksChanged()}return this};o.prototype.getNodeInfos=function(){return this._nodeInfos?this._nodeInfos:[]};o.prototype.setNodeInfos=function(t){this._nodeInfos=t;return this};o.prototype.updateNodeInfos=function(t){var a=this.getNodeInfos();if(!a){return this.setNodeInfos(t)}var e=new Map;a.forEach(function(t,a){e.set(t.target,a)});var i=function(t,a){for(var e in a){t[e]=a[e]}};t.forEach(function(t){var s=e.get(t.target);if(s==null){a.push(t)}else{i(a[s],t)}});this.setNodeInfos(a);return this};o.prototype.getModel=function(){return this._model};return o});
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/ViewGallery", ["sap/ui/core/Control","sap/ui/core/IconPool","./library","./Core","sap/m/Slider","./ViewGalleryRenderer","./getResourceBundle","./ViewGalleryThumbnail","sap/m/HBox","sap/m/VBox","sap/m/FormattedText","sap/m/FlexItemData","sap/m/Image","sap/m/Input","sap/m/ScrollContainer","sap/m/Button","sap/m/ToggleButton","sap/m/Toolbar","sap/m/Popover","sap/m/Title","sap/m/SelectList","sap/m/ToolbarSpacer","sap/m/ToolbarSeparator","sap/ui/model/json/JSONModel","sap/ui/core/dnd/DropInfo","sap/ui/core/dnd/DragInfo","sap/ui/core/Icon","sap/ui/core/InvisibleText","sap/ui/core/Item","sap/ui/core/library","sap/base/Log","sap/m/library"],function(e,t,i,s,n,r,o,a,l,h,c,p,d,u,g,m,_,f,V,v,w,S,y,I,T,b,C,D,A,x,G,M){"use strict";const P=M.InputType;const E=M.ButtonType;const R=M.FlexAlignContent;const z=M.FlexAlignItems;const B=M.FlexRendertype;const k=M.FlexJustifyContent;const O=M.ToolbarDesign;const L=M.PlacementType;const N=x.ValueState;var Y=e.extend("sap.ui.vk.ViewGallery",{metadata:{library:"sap.ui.vk",properties:{showAnimationTimeSlider:{type:"boolean",defaultValue:true},showToolbar:{type:"boolean",defaultValue:true},showThumbnailContainer:{type:"boolean",defaultValue:true},selectedViewIndex:{type:"int",defaultValue:-1},selectedViewGroupIndex:{type:"int",defaultValue:-1},enableViewReordering:{type:"boolean",defaultValue:false},transparency:{type:"float",defaultValue:1},enabled:{type:"boolean",defaultValue:true}},associations:{animationPlayer:{type:"sap.ui.vk.AnimationPlayer"},contentConnector:{type:"sap.ui.vk.ContentConnector"},host:{type:"sap.ui.vk.ViewportBase"},viewManager:{type:"sap.ui.vk.ViewManager"}},aggregations:{toolbar:{type:"sap.m.Toolbar",multiple:false,visibility:"hidden"},container:{type:"sap.m.ScrollContainer",multiple:false,visibility:"hidden"},animationTimeSlider:{type:"sap.m.Slider",multiple:false,visibility:"hidden"}},events:{selectionChange:{parameters:{item:"sap.ui.core.Control"}},viewOrderChange:{parameters:{view:"sap.ui.vk.View",viewIndex:"int"}}}},constructor:function(t,i){e.apply(this,arguments);s.observeAssociations(this)}});Y.prototype.init=function(){if(e.prototype.init){e.prototype.init.call(this)}this._scene=null;this._vkScene=null;this._viewItems=[];this._viewManager=null;this._host=null;this._cdsLoader=null;this._selectedGroupIndex=-1;this._previousOrientationVertical=false;this._playingAnimation=true;this._draggedModelView={};this._animationPlayer=null;this._manualTimeChange=false;t.addIcon("landscape-text","vk-icons","vk-icons","e019");t.addIcon("portrait-text","vk-icons","vk-icons","e01a");this.oModel=new I;if(this.getShowThumbnailContainer()){this.createThumbnailContainer()}if(this.getShowToolbar()){this.createToolbar()}if(this.getShowAnimationTimeSlider()){this.setAggregation("animationTimeSlider",new n);this._attachAnimationTimeSlider(this.getAnimationTimeSlider())}s.getEventBus().subscribe("sap.ui.vk","viewActivated",this._onViewActivated,this);s.getEventBus().subscribe("sap.ui.vk","procedureFinished",this._onProcedureFinished,this)};Y.prototype.exit=function(){s.getEventBus().unsubscribe("sap.ui.vk","viewActivated",this._onViewActivated,this);s.getEventBus().unsubscribe("sap.ui.vk","procedureFinished",this._onProcedureFinished,this);this.setScene(null)};Y.prototype.onSetViewManager=function(e){this._viewManager=e};Y.prototype.onUnsetViewManager=function(e){this._viewManager=null};Y.prototype._getSelectedViewGroup=function(){var e=this.getSelectedViewGroupIndex();var t;if(this._vkScene){var i=this._vkScene.getViewGroups();if(e>=0&&e<i.length){t=i[e]}}return t};Y.prototype._getSelectedView=function(){var e;var t=this.getSelectedViewIndex();var i=this._getViews();if(i&&t>=0&&t<i.length){e=i[t]}return e};Y.prototype._getViewGroups=function(){var e;if(this._vkScene){e=this._vkScene.getViewGroups()}return e};Y.prototype._getViews=function(){var e=this._getSelectedViewGroup();var t;if(e){t=e.getViews()}else if(this._vkScene){t=this._vkScene.getViews()}return t};Y.prototype._getViewIndex=function(e){var t=-1;var i=this._getViews();if(Array.isArray(i)){t=i.indexOf(e)}return t};Y.prototype._getViewAnimationDuration=function(e){e=e||this._getSelectedView();var t;if(e){var i=e.getPlaybacks();if(Array.isArray(i)&&i.length){t=i.reduce(function(e,t){return e+t.getDuration()},0)}}return t};Y.prototype.setVisible=function(t){if(e.prototype.setVisible){e.prototype.setVisible.call(this,t)}this.setDescription()};Y.prototype.onAfterRendering=function(){if(document.getElementById("body")){var e=window.getComputedStyle(document.getElementById("body"));var t=e.getPropertyValue("background-color");var i;var s=this.getDomRef();if(t){if(t.indexOf("a")===-1){i=t.replace("rgb","rgba").replace(")",", "+this.getTransparency()+")");s.style.backgroundColor=i}else{var n=new RegExp("([^,]*)$");i=t.replace(n," "+this.getTransparency()+")");s.style.backgroundColor=i}}if(this.toolbar){var r=this.toolbar.getDomRef();r.style.backgroundColor="rgba(0, 0, 0, 0)"}}if(this._host&&this._host.getContent().indexOf(this)!==-1){this.adjustStepDescriptionBoxes()}if(this.getDomRef()){var o=this.getDomRef();if(!this.getEnabled()){var a=function(e){var t=e.children;for(var i=0;i<t.length;i++){t[i].tabIndex=-1;a(t[i])}};a(o);this.addStyleClass("sapVizKitViewGalleryDisabled")}else{this.removeStyleClass("sapVizKitViewGalleryDisabled")}}};Y.prototype.setShowAnimationTimeSlider=function(e){this.setProperty("showAnimationTimeSlider",e);if(e){this._detachAnimationTimeSlider(this.getAnimationTimeSlider());this.setAggregation("animationTimeSlider",new n);this._attachAnimationTimeSlider(this.getAnimationTimeSlider())}else{this._detachAnimationTimeSlider(this.getAnimationTimeSlider());this.destroyAggregation("animationTimeSlider")}this._setupAnimationSlider()};Y.prototype._updateAnimationTimeSlider=function(e){const t=e.views?.some(e=>e.animated===true);this.setShowAnimationTimeSlider(t)};Y.prototype.getAnimationTimeSlider=function(){return this.getAggregation("animationTimeSlider")};Y.prototype.destroyToolbar=function(){this.destroyAggregation("toolbar")};Y.prototype.destroyThumbnailContainer=function(){this.destroyAggregation("container")};Y.prototype.createThumbnailContainer=function(){var e=this;this._hbox=new l;if(this.getEnableViewReordering()){this._hbox.addDragDropConfig(new T({dropEffect:sap.ui.core.dnd.DropEffect.Move,dropPosition:sap.ui.core.dnd.DropPosition.On,targetAggregation:"items",drop:function(t){var i=t.getParameter("droppedControl");e.reorderViews(i);e.fireViewOrderChange({view:e._draggedModelView,viewIndex:e._viewItems.indexOf(i)})}}));this._hbox.getMetadata().getAggregation().dnd.droppable=true}this._scrollContainer=new g(this.getId()+"-scroller",{width:"100%",horizontal:true,vertical:false,focusable:false,content:[this._hbox]});this._scrollContainer.addStyleClass("sapVizKitViewGalleryScrollContainer");this.setAggregation("container",this._scrollContainer)};Y.prototype.reorderViews=function(e){var t=this._modelViews.indexOf(this._draggedModelView);this._modelViews.splice(t,1);var i=this._viewItems.indexOf(e);this._modelViews.splice(i,0,this._draggedModelView);this._refreshItems()};Y.prototype.createToolbar=function(){var e=this;this.toolbar=new f({design:O.Auto});this.setAggregation("toolbar",this.toolbar);this._previousItemButton=new m(this.getId()+"-previousItemButton",{type:E.Transparent,icon:"sap-icon://navigation-left-arrow",tooltip:o().getText("STEP_NAV_PREVIOUSSTEPBUTTON"),press:function(t){var i=e.getSelectedViewIndex();if(i>0){e.setSelectedItem(e._viewItems[i-1])}}});this._nextItemButton=new m(this.getId()+"-nextItemButton",{type:E.Transparent,icon:"sap-icon://navigation-right-arrow",tooltip:o().getText("STEP_NAV_NEXTSTEPBUTTON"),press:function(t){var i=e.getSelectedViewIndex();if(i>=0&&i+1<e._viewItems.length){e.setSelectedItem(e._viewItems[i+1])}}});this._viewGroupSelector=new V({showHeader:false,contentWidth:"20%",placement:L.Top,horizontalScrolling:false,verticalScrolling:false,content:[new g({horizontal:false,vertical:true,height:"100%",content:[this._procedureList=new w({width:"100%",itemPress:function(t){e._clearUI();var i=this.indexOfItem(t.getParameter("item"));e.setSelectedViewGroupIndex(i)}})]})]});this._playButton=new _(this.getId()+"-playButton",{type:E.Transparent,pressed:false,icon:"sap-icon://media-play",visible:true,tooltip:o().getText("STEP_NAV_PLAYMENU_PLAY"),press:function(e){this._setPlayState(e.getSource().getPressed());if(e.getSource().getPressed()){this._playingProcedure=true;this._playProcedure()}else{this._playingProcedure=false;this._pauseAnimation()}}.bind(this)});this._invisStepCount=new D;this._currentStepCount=new u({ariaLabelledBy:this._invisStepCount,width:"auto",type:P.Number,submit:e=>{const t=e.getParameter("value");if(t<1||t>this._viewItems.length){return}this.setSelectedItem(this._viewItems[t-1])},liveChange:e=>{const t=e.getParameter("value");const i=t.replaceAll(".","");this._currentStepCount.setValue(i);if(i<1||i>this._viewItems.length){this._currentStepCount.setValueState(N.Error);this._currentStepCount.setValueStateText(o().getText(i===""?"VIEW_COUNT_EMPTY":"VIEW_COUNT_ERROR",[i]))}else{this._currentStepCount.setValueState(N.None)}}}).addStyleClass("sapVizKitViewGalleryCurrentStepInput").addEventDelegate({onfocusout:()=>{const e=this._currentStepCount.getValue();if(e<1||e>this._viewItems.length||parseInt(e,10)===this.getSelectedViewIndex()+1){return}this.setSelectedItem(this._viewItems[e-1])}});this._totalStepCount=new v({level:"H5",titleStyle:"H5"}).addStyleClass("sapVizKitViewGalleryTotalStepTitle");this._currentGroupTitle=new v({text:o().getText("STEP_NAV_PROCEDURES"),tooltip:o().getText("STEP_NAV_PROCEDURES"),level:"H5",titleStyle:"H5"}).addStyleClass("sapVizKitViewGalleryCurrentGroupTitle");this._separatorTitle=new v({width:5/1920*100+"%",level:"H5",titleStyle:"H5"});this._currentStepTitle=new v({level:"H5",titleStyle:"H5"}).addStyleClass("sapVizKitViewGalleryCurrentStepTitle");this._currentGroupTitle.addEventDelegate({ontap:function(){this._viewGroupSelector.openBy(this._currentGroupTitle)}.bind(this)});this.toolbar.addContent(this._currentGroupTitle).addContent(this._separatorTitle).addContent(this._currentStepTitle).addContent(new S).addContent(this._previousItemButton).addContent(this._invisStepCount).addContent(this._currentStepCount).addContent(this._totalStepCount).addContent(this._nextItemButton).addContent(new y).addContent(this._playButton)};Y.prototype._setPlayState=function(e){if(this.getAggregation("toolbar")){this._playButton.setPressed(e);if(e){this._playButton.setIcon("sap-icon://media-pause");this._playButton.setTooltip(o().getText("STEP_NAV_PLAYMENU_PAUSE"))}else{this._playButton.setIcon("sap-icon://media-play");this._playButton.setTooltip(o().getText("STEP_NAV_PLAYMENU_PLAYALLREMAINING"))}}};Y.prototype._createStepDescriptionBoxes=function(){this._stepDescription=new h({renderType:B.Bare,fitContainer:false,alignContent:R.Start,alignItems:z.Start,justifyContent:k.End,items:[this._stepDescriptionToolbar=new f({design:O.Solid,content:[this._stepDescriptionIcon=new C({src:"sap-icon://navigation-up-arrow",press:function(e){this._toggleViewDescription()}.bind(this)}).addStyleClass("sapVizKitViewGalleryStepDescriptionIcon sapVizKitViewGalleryStepDescriptionIconTransform"),new S,this._stepDescriptionOrientationIcon=new C({src:"sap-icon://vk-icons/landscape-text",press:function(e){this._toggleOrientation()}.bind(this)}).addStyleClass("sapVizKitViewGalleryStepDescriptionOrientationIcon")],layoutData:new p({shrinkFactor:0})}).addStyleClass("sapVizKitViewGalleryStepDescriptionToolbar"),this._stepDescriptionScroll=new g({horizontal:false,vertical:true,content:[this._stepDescriptionText=new c({visible:true}).addStyleClass("sapVizKitViewGalleryStepDescriptionText")]}).addStyleClass("sapVizKitViewGalleryStepDescriptionScroll")]}).addStyleClass("sapVizKitViewGalleryStepDescription");this._stepDescription.vitId="VIT-StepDescription";this._stepDescriptionVertical=new l({renderType:B.Bare,fitContainer:false,alignContent:R.Start,alignItems:z.Start,justifyContent:k.End,items:[this._stepDescriptionVerticalScroll=new g({horizontal:false,vertical:true,content:[this._stepDescriptionVerticalText=new c({visible:false}).addStyleClass("sapVizKitViewGalleryStepDescriptionVerticalText")]}).addStyleClass("sapVizKitViewGalleryStepDescriptionVerticalScroll"),this._stepDescriptionVerticalToolbar=new f({design:O.Solid,content:[this._stepDescriptionVerticalIcon=new C({src:"sap-icon://navigation-right-arrow",press:function(e){this._toggleViewDescriptionVertical()}.bind(this)}).addStyleClass("sapVizKitViewGalleryStepDescriptionVerticalIcon sapVizKitViewGalleryStepDescriptionIconTransform"),this._stepDescriptionVerticalOrientationIcon=new C({src:"sap-icon://vk-icons/portrait-text",press:function(e){this._toggleOrientation()}.bind(this)}).addStyleClass("sapVizKitViewGalleryStepDescriptionVerticalOrientationIcon")],layoutData:new p({shrinkFactor:0})}).addStyleClass("sapVizKitViewGalleryStepDescriptionVerticalToolbar")]}).addStyleClass("sapVizKitViewGalleryStepDescriptionVertical");this._stepDescriptionVertical.vitId="VIT-StepDescriptionVertical"};Y.prototype.adjustStepDescriptionBoxes=function(){if(this._stepDescription.getDomRef()){var e=this.getDomRef().getBoundingClientRect().height;var t=this._stepDescription.getDomRef().id;var i=this._stepDescriptionVertical.getDomRef().id;document.getElementById(t).style.bottom=e+"px";document.getElementById(i).style.bottom=e+"px";var s=this._host.getDomRef().getBoundingClientRect().height;document.getElementById(i).style.height=s-e+"px"}};Y.prototype._toggleOrientation=function(){if(this._stepDescriptionToolbar.getVisible()){this._stepDescriptionToolbar.setVisible(false);this._stepDescriptionVerticalToolbar.setVisible(true);this._previousOrientationVertical=true;if(this._stepDescriptionText.getVisible()){this._stepDescriptionVerticalText.setVisible(true)}this._stepDescriptionText.setVisible(false)}else{this._stepDescriptionToolbar.setVisible(true);this._previousOrientationVertical=false;if(this._stepDescriptionVerticalText.getVisible()){this._stepDescriptionText.setVisible(true)}this._stepDescriptionVerticalToolbar.setVisible(false);this._stepDescriptionVerticalText.setVisible(false)}this._stepDescription.rerender();this._stepDescriptionVertical.rerender();if(this._host&&this._host.getContent().indexOf(this)!==-1){this.adjustStepDescriptionBoxes()}};Y.prototype._toggleViewDescription=function(){if(!this._stepDescriptionText.getVisible()){this._stepDescriptionText.setVisible(true);this._stepDescriptionIcon.addStyleClass("sapVizKitViewGalleryStepDescriptionIconTransform");this._stepDescriptionVerticalIcon.addStyleClass("sapVizKitViewGalleryStepDescriptionIconTransform")}else{this._stepDescriptionText.setVisible(false);this._stepDescriptionIcon.removeStyleClass("sapVizKitViewGalleryStepDescriptionIconTransform");this._stepDescriptionVerticalIcon.removeStyleClass("sapVizKitViewGalleryStepDescriptionIconTransform")}this._stepDescriptionText.rerender()};Y.prototype._toggleViewDescriptionVertical=function(){if(!this._stepDescriptionVerticalText.getVisible()){this._stepDescriptionVerticalText.setVisible(true);this._stepDescriptionVerticalIcon.addStyleClass("sapVizKitViewGalleryStepDescriptionIconTransform");this._stepDescriptionIcon.addStyleClass("sapVizKitViewGalleryStepDescriptionIconTransform")}else{this._stepDescriptionVerticalText.setVisible(false);this._stepDescriptionVerticalIcon.removeStyleClass("sapVizKitViewGalleryStepDescriptionIconTransform");this._stepDescriptionIcon.removeStyleClass("sapVizKitViewGalleryStepDescriptionIconTransform")}this._stepDescriptionVerticalText.rerender()};Y.prototype._getHBox=function(){return this._hbox};Y.prototype._playProcedure=function(){this._manualTimeChange=false;if(this._viewManager){var e=this._getSelectedView();if(!e){var t=this._getViews();if(t&&t.length){e=t[0]}}if(e){this._viewManager.playViewGroup(e,this._getSelectedViewGroup())}}};Y.prototype._pauseAnimation=function(){if(this._viewManager){this._viewManager.stopPlayingViewGroup()}};Y.prototype.setPlayingAnimation=function(e){this._playingAnimation=e};Y.prototype.onSetAnimationPlayer=function(e){this._animationPlayer=e;e.attachTimeChanged(this._onAnimationPlayerTimeChanged,this);e.attachStateChanged(this._onAnimationPlayerStateChanged,this);this._setupAnimationSlider()};Y.prototype.onUnsetAnimationPlayer=function(e){e.detachTimeChanged(this._onAnimationPlayerTimeChanged,this);e.detachStateChanged(this._onAnimationPlayerStateChanged,this);this._animationPlayer=null};Y.prototype._setupAnimationSlider=function(){var e=this.getAnimationTimeSlider();if(e&&this._animationPlayer){var t=this._getViewAnimationDuration();if(t){e.setMax(t);e.setStep(t/100);e.setValue(this._animationPlayer.getTime())}}};Y.prototype._onAnimationPlayerTimeChanged=function(e){var t=e.getParameter("time");var i=this.getAnimationTimeSlider();if(i){i.setValue(t)}};Y.prototype._onAnimationPlayerStateChanged=function(e){var t=e.getParameter("playing");if(!this._playingProcedure){this._setPlayState(t)}};Y.prototype._onProcedureFinished=function(e){this._playingProcedure=false;this._setPlayState(false)};Y.prototype.setScene=function(e){if(e&&e.loaders){for(var t=0;t<e.loaders.length;t++){var i=e.loaders[t];if(i.getMetadata&&i.getMetadata().getName()==="sap.ui.vk.threejs.ContentDeliveryService"){if(this._cdsLoader){this._cdsLoader.detachLoadingFinished(this._handleCdsViewGroupUpdate,this)}this._cdsLoader=i;this._cdsLoader.attachLoadingFinished(this._handleCdsViewGroupUpdate,this);break}else if(i.requestViewGroup){this._loader=i;break}}}if(e==null&&this._cdsLoader){this._cdsLoader.detachLoadingFinished(this._handleCdsViewGroupUpdate,this);this._cdsLoader=null}this._vkScene=e;this._refreshProcedures();this._resetCurrentView()};Y.prototype._onViewActivated=function(e,t,i){var s;var n=i.view;var r=this._getViewGroups();if(r&&r.length>0){var o=r[this.getSelectedViewGroupIndex()];if(o&&o.getViewGroupId()!=n.viewGroupId){for(var a=0;a<r.length;a++){if(r[a].getViewGroupId()===n.viewGroupId){for(var l=0;l<r[a].getViews().length;l++){if(r[a].getViews()[l]===n){s=l;this.setSelectedViewGroupIndex(a,s);break}}}}}else{for(var h=0;o&&h<o.getViews().length;h++){if(o.getViews()[h]===n){s=h;this.viewActivated(s,n);break}}}}};Y.prototype.onSetHost=function(e){if(e.getContent()){var t=function(t){var i=e.getContent();for(var s=0;s<i.length;s++){if(i[s].vitId==t){return s}}return-1};e.removeContent(t("VIT-StepDescription"));e.removeContent(t("VIT-StepDescriptionVertical"))}this._createStepDescriptionBoxes();e.addContent(this._stepDescription);e.addContent(this._stepDescriptionVertical);this._stepDescriptionToolbar.setVisible(false);this._stepDescriptionVerticalToolbar.setVisible(false);this._attachAnimationTimeSlider(this.getAnimationTimeSlider())};Y.prototype.onUnsetHost=function(e){this._detachAnimationTimeSlider(this.getAnimationTimeSlider())};Y.prototype._attachAnimationTimeSlider=function(e){if(!e){return}e.attachChange(this._onSliderValueChange,this);e.attachLiveChange(this._onSliderValueLiveChange,this)};Y.prototype._detachAnimationTimeSlider=function(e){if(!e){return}e.detachChange(this._onSliderValueChange,this);e.detachLiveChange(this._onSliderValueLiveChange,this)};Y.prototype._onSliderValueLiveChange=function(e){var t=e.getParameter("value");this._manualTimeChange=true;if(this._animationPlayer&&this._animationPlayer.getTime()!==t){this._animationPlayer.setTime(t)}};Y.prototype._onSliderValueChange=function(e){var t=e.getParameter("value");this._manualTimeChange=true;if(this._animationPlayer&&this._animationPlayer.getTime()!==t){this._animationPlayer.setTime(t)}};Y.prototype._refreshProcedures=function(e){if(this.getAggregation("toolbar")){this._procedureList.removeAllItems()}this._modelViews=null;var t=this._getViewGroups();if(t&&t.length>0){this._selectedGroupIndex=0;var i=0;t.forEach(function(t){if(this.getAggregation("toolbar")){this._procedureList.addItem(new A({key:t.getViewGroupId(),text:t.getName()}))}if(e&&t.getViewGroupId()===e){this._selectedGroupIndex=i}i++}.bind(this));this._modelViews=this._getViews();if(this.getAggregation("toolbar")){this._currentGroupTitle.setText(t[this._selectedGroupIndex].getName()).setTooltip(t[this._selectedGroupIndex].getName())}}else if(this.getAggregation("toolbar")){this._currentGroupTitle.setText(o().getText("STEP_NAV_PROCEDURES"))}this._refreshItems()};Y.prototype.refresh=function(e){this.setScene(e)};var U="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAE4AAAA8CAYAAADIQIzXAAAACXBIWXMAAAsTAAALEwEAmpwYAAAFFmlUWHRYTUw6Y29tLmFkb2JlLnhtcAAAAAAAPD94cGFja2V0IGJlZ2luPSLvu78iIGlkPSJXNU0wTXBDZWhpSHpyZVN6TlRjemtjOWQiPz4gPHg6eG1wbWV0YSB4bWxuczp4PSJhZG9iZTpuczptZXRhLyIgeDp4bXB0az0iQWRvYmUgWE1QIENvcmUgNS42LWMxNDAgNzkuMTYwNDUxLCAyMDE3LzA1LzA2LTAxOjA4OjIxICAgICAgICAiPiA8cmRmOlJERiB4bWxuczpyZGY9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkvMDIvMjItcmRmLXN5bnRheC1ucyMiPiA8cmRmOkRlc2NyaXB0aW9uIHJkZjphYm91dD0iIiB4bWxuczp4bXA9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC8iIHhtbG5zOmRjPSJodHRwOi8vcHVybC5vcmcvZGMvZWxlbWVudHMvMS4xLyIgeG1sbnM6cGhvdG9zaG9wPSJodHRwOi8vbnMuYWRvYmUuY29tL3Bob3Rvc2hvcC8xLjAvIiB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIgeG1sbnM6c3RFdnQ9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZUV2ZW50IyIgeG1wOkNyZWF0b3JUb29sPSJBZG9iZSBQaG90b3Nob3AgQ0MgKE1hY2ludG9zaCkiIHhtcDpDcmVhdGVEYXRlPSIyMDE4LTA2LTA1VDEzOjU1OjAzKzEyOjAwIiB4bXA6TW9kaWZ5RGF0ZT0iMjAxOC0wNi0wNVQxNDowMDo1MCsxMjowMCIgeG1wOk1ldGFkYXRhRGF0ZT0iMjAxOC0wNi0wNVQxNDowMDo1MCsxMjowMCIgZGM6Zm9ybWF0PSJpbWFnZS9wbmciIHBob3Rvc2hvcDpDb2xvck1vZGU9IjMiIHBob3Rvc2hvcDpJQ0NQcm9maWxlPSJzUkdCIElFQzYxOTY2LTIuMSIgeG1wTU06SW5zdGFuY2VJRD0ieG1wLmlpZDoyNGZiYjQ5MS1mNzFkLTRmMTgtODA2Zi1iYjcxZjhhZTdhNjAiIHhtcE1NOkRvY3VtZW50SUQ9InhtcC5kaWQ6MjRmYmI0OTEtZjcxZC00ZjE4LTgwNmYtYmI3MWY4YWU3YTYwIiB4bXBNTTpPcmlnaW5hbERvY3VtZW50SUQ9InhtcC5kaWQ6MjRmYmI0OTEtZjcxZC00ZjE4LTgwNmYtYmI3MWY4YWU3YTYwIj4gPHhtcE1NOkhpc3Rvcnk+IDxyZGY6U2VxPiA8cmRmOmxpIHN0RXZ0OmFjdGlvbj0iY3JlYXRlZCIgc3RFdnQ6aW5zdGFuY2VJRD0ieG1wLmlpZDoyNGZiYjQ5MS1mNzFkLTRmMTgtODA2Zi1iYjcxZjhhZTdhNjAiIHN0RXZ0OndoZW49IjIwMTgtMDYtMDVUMTM6NTU6MDMrMTI6MDAiIHN0RXZ0OnNvZnR3YXJlQWdlbnQ9IkFkb2JlIFBob3Rvc2hvcCBDQyAoTWFjaW50b3NoKSIvPiA8L3JkZjpTZXE+IDwveG1wTU06SGlzdG9yeT4gPC9yZGY6RGVzY3JpcHRpb24+IDwvcmRmOlJERj4gPC94OnhtcG1ldGE+IDw/eHBhY2tldCBlbmQ9InIiPz6QcBQiAAAGO0lEQVR4nO2ca1MbRxaGn+6emR7dzMUEOxRbla04H+LE+f+/YlO1oWIiA8IGhGQZJCSkkeZ28mEsOxtYRxoGIVx6vwip5tI8OrfuPho1DuIzoMZK82igxkEsDz2KxygNDB56EI9QA/3QI3isWoHLqRW4nHLmOdgYg1IgX0E6USp7TZKUNJVP72fVXOCiKEJEUPPeZUklIhhj0Hp+Y5gJnFIKx9EcHBxzeXmJtTbPOJdKIkIcx7x48QObm0+YTJK5zp/b4iaTyVw3WFZNwaVpmuv8uWOc4zg4zlynLaXko2/mDTuFEJBHki2KjM13AqeUIkkSoiieOystUiKgtcJ13cKueSdwYRiyvr7O8+fPiOMUWE7LM8YQBAHNZhMoxvLuBC5JYqz12dhcyz5YTm6gYDQscXZ2lr19aHBTV5UUoihd2ljneYYwDAu95mrKlVMrcDn1qAqyLDtqXFehFCQJxPF8FX9RWig4EXAcgzFZTJx3cu2XDEkMvd6AJEkol8uUKx5xJMRxutCSaGHgRMB1DXGcMByOqVQqwOwJxfMMve6Ak5MTrq+vSdMUz/PY2dnh22+f4zh6ofAWEuNEwPUMIsL+/mt+/fU/XF1d4Vk906qEtYbBYMje3h69Xg/HcbDWEscx9Xqdw6MG2ii0XpzJ3Ts4ETBGYwy8e3dCt9vFdV0ajSPCMMH3zUzwWq0WaZpSLpc/1WGu61KplGm3WvS6fTxvcbnu3u+ktcL1FCfvzmk2m1QqFXzfZzwOqP9RJ0kEx/n/w8iq/pjB4BrP8264ttYGgPE4gAXGuHsH51lN67zD4eEBruugtUZE8P0SnU6Hs7NzHFfNYHVfPmDRtfe9gRMB6xtGw5Dj4wbWWhzH+R+LKZVKtFrnBMMQv3S7y6Zpil9yqFSqhGF4Y7qUpsmnay1yyncv4ESy0mE0GrO3t0eayq1u5rouURSx/8c+cZTieTfhiQgI7O7u4jgOo9GIKaE4jhmNRuzu7rKx8YQwzLcomUeFgxMRrG9IYuH17/tMJmOstbeWHZnL+vT7VzQax2jDrZkxDBOqVZ+XL3+kVqsxmYSMx2OUUnz//Qu+++5fJImQposzuULruKxWc1AK3rw5ZDgcUqlUvliriQjlcoV2u8Xm5lOebq0xDpIb9dhkkrC+8YSfq6/o9XrEcUy1WqVa84lCIUkecQFsjMI4cFA/pt1u/SO0qbTWGGM4OjqkWv0Fax0mk5vwxkGCMZqtrXVQkCYwGWcxbtELqYW6qutpTk/anDVPKZfLM58nInieJQgCDg+PUCqr/f4upbJkMR4nRKGgTZaArG8+Zusi/5svqzBwntVcXlzx9m0D31q0nu/SmcuW6XTec3raxvXUjSwpkq0B+iWD1ormWZs39SPety/QOvvccWYrqO+qQlxVabgeBNTr9WwP1nVzLWoqpbDWcnr6ls3NDcoVj3GQuaIxOoMJdN5f0GyeMxj0SdOUdrvN2toaW99ssbmxiV9yQCCKJPf23z+psBg3HI6I4xjf93OvBIsIrusSBAEHB2/46eeXWGtQGpIYPnS6dD50uPhwkVmeX0IphYjQ7/fpdrtUq1W2t7+hVntCpVLF2vuxwMLAGWMwxty5RUJEKJVK9Ho9Dg8avPjh33x43+X8vEm/n7Xy2Y+hQEQ+fUnT7oIwDGk0jnEch1KpxM7ODtvbTwtv21jKhczP8Lr89t8R19dDIKv5/nrMbZpumIsIl5eXKKXYfva08DEuJTjISpQ0TRmNRnieO7fFTOOl53n3Mr6lBTd1+SI3kYvUarMmp1bgcmoFLqdW4HJqBS6nCsuqItn0Jk3TpekRno7nPlQYuCms7HU5wEGxzYR/VQHgsoHVajVevfplaawNPneVQ/Ff5Z3AZUVq9rfnGaw/+xrcwjSdmRW8WX0ncJ5nGQz6vP69vrS9cfC5j08pVZhH3AmcMYYoihiNRkvlon+XiHzsclqSHuDpgL6GH4zMq1Udl1MzW5xS2SJhEIyWOp7NKhEhiqKszssRZWYGlyTC9vYzarUaxiztatQcygp23/dJcvy6Xo2DuM8MDzMQEax1UF+Zc+fczB7M4aqKMHyYftv7Vp6C4Cuzn8VpBS6nVuByavXAlpxygCarRwTNq8GfDrbV1CI5dZUAAAAASUVORK5CYII=";Y.prototype._clearUI=function(){if(this.getAggregation("toolbar")){this._currentStepTitle.setText("");this._separatorTitle.setText("");this._viewGroupSelector.close();this._nextItemButton.setEnabled(false);this._previousItemButton.setEnabled(false);this._totalStepCount.setText("");this._currentStepCount.setValue(null);if(this._stepDescriptionText){this._stepDescriptionText.setHtmlText("")}if(this._stepDescriptionVerticalText){this._stepDescriptionVerticalText.setHtmlText("")}}if(this.getAggregation("container")){this._hbox.destroyItems()}this._viewItems=[];if(this._stepDescriptionToolbar){this._stepDescriptionToolbar.setVisible(false)}if(this._stepDescriptionVerticalToolbar){this._stepDescriptionVerticalToolbar.setVisible(false)}};Y.prototype._refreshItems=function(){this._clearUI();var e=this;if(this._modelViews){var t=function(e){this.setSelectedItem(e.getSource())}.bind(this);this._modelViews.forEach(function(i){var s=true;var n=i.name||i.getName&&i.getName();var r=new a({alt:n,densityAware:false,tooltip:n,viewGallery:this,source:i.thumbnailData||U,press:function(s){r.detachBrowserEvent("mouseenter",function(t){e.startAnimate()});r.setSource(i.thumbnailData||U);clearInterval(s.getSource().interval);t(s)},layoutData:new p({shrinkFactor:0})});var o=function(t,n){var o=t.width/n;var a=t.height;var l=n;var h=a;var c=document.createElement("canvas");var p=c.getContext("2d");var d=[];c.width=l;c.height=h;for(var u=0;u<o;u++){var g=l*u;p.clearRect(0,0,l,h);p.drawImage(t,g,0,l,h,0,0,l,h);d.push(c.toDataURL())}e.startAnimate=function(){if(s){s=false;r.detachBrowserEvent("mouseenter",function(t){e.startAnimate()});var t=0;var i=function(){if(t<o){r.setSource(d[t]);t++}else{r.setSource(d[0]);t=0}};r.interval=setInterval(function(){i()},250)}};r.attachBrowserEvent("mouseenter",function(t){e.startAnimate()});r.attachBrowserEvent("mouseout",function(t){s=true;r.attachBrowserEvent("mouseenter",function(t){e.startAnimate()});clearInterval(r.interval);r.setSource(i.thumbnailData)})};if(i.animatedThumbnailData!==undefined){var l=document.createElement("img");l.onload=function(){o(l,i.tileWidth)};l.src=i.animatedThumbnailData}if(this.getEnableViewReordering()){r.addDragDropConfig(new b({dragStart:function(){e._draggedModelView=i}}));r.getMetadata().dnd.draggable=true}r.data("modelView",i);this._viewItems.push(r);if(this.getAggregation("container")){this._hbox.addItem(r)}if(this._hbox.getItems().length===1){r.data("help-id","vit-view-thumbnail",true)}}.bind(this));const i=(Math.max(this._viewItems.length.toString().length,2)-2)*.5;this._currentStepCount.setWidth(2+i+"rem");this.rerender()}};Y.prototype.setSelectedItem=function(e){if(e.getCustomData().length>0){var t=e.getCustomData()[0].getValue();if(this._viewManager){this._viewManager.activateView(t)}}return this};Y.prototype.setDescription=function(){if(!this._selectedItem){return}if(!this.getVisible()){this._stepDescription.setVisible(false);this._stepDescriptionToolbar.setVisible(false);this._stepDescriptionVertical.setVisible(false);this._stepDescriptionVerticalToolbar.setVisible(false);return}if(this._selectedItem.getCustomData().length>0){var e=this._selectedItem.getCustomData()[0].getValue();var t=e.getDescription();if(t){if(this._previousOrientationVertical===false){this._stepDescription.setVisible(true);this._stepDescriptionToolbar.setVisible(true);this._stepDescriptionVerticalToolbar.setVisible(false)}else{this._stepDescriptionVertical.setVisible(true);this._stepDescriptionToolbar.setVisible(false);this._stepDescriptionVerticalToolbar.setVisible(true);this._previousOrientationVertical=true}}else if(this._previousOrientationVertical===true){this._stepDescriptionVertical.setVisible(false)}else{this._stepDescription.setVisible(false);this._previousOrientationVertical=false}if(t!=null){this._stepDescriptionText.setHtmlText(t);this._stepDescriptionVerticalText.setHtmlText(t)}}};Y.prototype.viewActivated=function(e){if(this._selectedItem){if(this.getSelectedViewIndex()!==e){this._selectedItem.removeStyleClass("selected")}}this._selectedItem=this._viewItems[e];if(!this._selectedItem){return this}if(this.getAggregation("toolbar")){this._totalStepCount.setText("/ "+this._viewItems.length);this._invisStepCount.setText(o().getText("VIEW_COUNT_INPUT",[e+1,this._viewItems.length]));this._currentStepCount.setValue(e+1);this._currentStepCount.setValueState(N.None);var t=this._selectedItem!==this._viewItems[0]&&this._viewItems.length>1;var i=this._selectedItem!==this._viewItems[this._viewItems.length-1]&&this._viewItems.length>1;var s=this._selectedItem.getCustomData().length>0&&this._selectedItem.getCustomData()[0].getValue().getPlaybacks().length>0;this._previousItemButton.setEnabled(t);this._nextItemButton.setEnabled(i);this._playButton.setEnabled(s||i)}this._selectedItem.addStyleClass("selected");if(this._isScrollingNecessary(this._selectedItem.getDomRef(),this._scrollContainer.getDomRef())){this._scrollContainer.scrollToElement(this._selectedItem,500)}if(this._selectedItem.getCustomData().length>0){var n=this._selectedItem.getCustomData()[0].getValue();var r=n.getPlaybacks();var a=this.getAnimationTimeSlider();if(a){if(!r||r.length===0){a.setEnabled(false);a.setValue(0)}else{a.setEnabled(true)}}var l=n.name||n.getName&&n.getName();if(this.getAggregation("toolbar")){this._separatorTitle.setText("/");this._currentStepTitle.setText(l).setTooltip(l)}}this.setDescription();this.fireSelectionChange({item:this._selectedItem});this._setupAnimationSlider();return this};Y.prototype.getSelectedItem=function(){return this._selectedItem};Y.prototype.getSelectedViewIndex=function(){for(var e=0;e<this._viewItems.length;e++){if(this._viewItems[e]===this.getSelectedItem()){return e}}return-1};Y.prototype.setSelectedViewIndex=function(e){if(this._viewItems.length>e){this.setSelectedItem(this._viewItems[e])}};Y.prototype.getSelectedViewGroupIndex=function(){return this._selectedGroupIndex};Y.prototype.setSelectedViewGroupIndex=function(e,t){var i=this._getViewGroups();if(i&&i.length>e){this._selectedGroupIndex=e;if(t==null){t=0}this._currentGroupTitle.setText(i[e].getName()).setTooltip(i[e].getName());this._separatorTitle.setVisible(true);this._modelViews=this._getViews();if(!this._modelViews||this._modelViews.length===0){var s=i[e].getViewGroupId();var n=i[e].sceneId;var r=this;if(this._loader&&this._loader.requestViewGroup){this._loader.requestViewGroup(n,s,false).then(function(s){r._refreshItems();r.setSelectedViewIndex(t);r._updateAnimationTimeSlider(i[e])}).catch(function(e){G.error(e)})}else if(this._cdsLoader){this._cdsLoader.loadViewGroup(n,s).then(function(s){r._refreshItems();r.setSelectedViewIndex(t);r._updateAnimationTimeSlider(i[e])})}}else{this._refreshItems();this.setSelectedViewIndex(t);this._updateAnimationTimeSlider(i[e])}}};Y.prototype._isScrollingNecessary=function(e,t){if(e&&t){var i=e.getBoundingClientRect();return i.left<0||i.right>t.clientWidth}return false};Y.prototype._setContent=function(e){if(this._bIsBeingDestroyed){return}var t=e&&e.getMetadata&&e.getMetadata().getName();var i=t==="sap.ui.vk.threejs.Scene"||t==="sap.ui.vk.svg.Scene";this.setScene(i?e:null);if(i&&e.builders){for(var s=0;s<e.builders.length;s++){e.builders[s]._fireThumbnailLoaded=function(e){var t=null;for(var i=0;i<this._viewItems.length;i++){if(this._viewItems[i].data("modelView")==e.modelView){t=this._viewItems[i];break}}if(t){t.setSource(e.modelView.thumbnailData)}}.bind(this)}}this._attachAnimationTimeSlider(this.getAnimationTimeSlider())};Y.prototype.onSetContentConnector=function(e){e.attachContentReplaced(this._onContentReplaced,this);e.attachContentChangesStarted(this._onContentChangesStarted,this);e.attachContentLoadingFinished(this._handleCdsViewGroupUpdate,this);this._setContent(e.getContent())};Y.prototype.onUnsetContentConnector=function(e){this._setContent(null);e.detachContentChangesStarted(this._onContentChangesStarted,this);e.detachContentLoadingFinished(this._handleCdsViewGroupUpdate,this);e.detachContentReplaced(this._onContentReplaced,this)};Y.prototype._onContentChangesStarted=function(e){this._detachAnimationTimeSlider(this.getAnimationTimeSlider());this.setScene(null)};Y.prototype._onContentReplaced=function(e){this._setContent(e.getParameter("newContent"))};Y.prototype._handleCdsViewGroupUpdate=function(e){var t=e.getParameter("currentViewGroupId");if(this._modelViews&&this._modelViews.length){this._refreshItems()}else{this._refreshProcedures(t)}this._resetCurrentView()};Y.prototype._resetCurrentView=function(){if(this._viewManager){var e=this._viewManager.getActiveView();if(e&&this._viewItems){for(var t=0;t<this._viewItems.length;t++){var i=this._viewItems[t];var s=i.getCustomData()[0].getValue();if(s===e){if(this._selectedItem!==i){this.viewActivated(t);break}}}}if(this._selectedGroupIndex!==-1){var n=this._getViewGroups();if(n&&n.length){this._procedureList.setSelectedKey(n[0].getViewGroupId())}}}};return Y});
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/ViewGalleryRenderer", [],function(){"use strict";var e={apiVersion:2};e.render=function(e,n){e.openStart("div",n);e.openEnd();e.renderControl(n.getAggregation("animationTimeSlider"));e.renderControl(n.getAggregation("toolbar"));e.renderControl(n.getAggregation("container"));e.close("div")};return e},true);
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/ViewGalleryThumbnail", ["sap/m/Image","./Core","./ViewGalleryThumbnailRenderer"],function(e,t,a){"use strict";var l=e.extend("sap.ui.vk.ViewGalleryThumbnail",{metadata:{library:"sap.ui.vk",associations:{viewGallery:{type:"sap.ui.vk.ViewGallery"}},properties:{enabled:{type:"boolean",defaultValue:true},thumbnailWidth:{type:"sap.ui.core.CSSSize",defaultValue:"5rem"},thumbnailHeight:{type:"sap.ui.core.CSSSize",defaultValue:"5rem"},source:{type:"string",defaultValue:""},tooltip:{type:"string",defaultValue:""},selected:{type:"boolean",defaultValue:false},processing:{type:"boolean",defaultValue:false},animated:{type:"boolean",defaultValue:false}}},constructor:function(a,l){e.apply(this,arguments);this._viewGallery=null;t.observeAssociations(this)}});l.prototype.onSetViewGallery=function(e){this._viewGallery=e};l.prototype.onUnsetViewGallery=function(e){this._viewGallery=null};l.prototype._getIndex=function(){return this._viewGallery?this._viewGallery._viewItems.indexOf(this):-1};return l});
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/ViewGalleryThumbnailRenderer", ["./library","sap/ui/Device"],function(e,t){"use strict";var i={apiVersion:2};i.render=function(e,t){e.openStart("div",t);e.style("height",t.getThumbnailHeight());e.style("width",t.getThumbnailWidth());e.style("background-image","url("+t.getSource()+")");e.class("sapVizKitViewGalleryThumbnail");e.attr("tabindex",0);var i=t.getTooltip();if(i){e.attr("title",i)}e.openEnd();var a=t._getIndex()+1;if(a>0){e.openStart("div");e.class("sapVizKitViewGalleryStepNumberText");e.openEnd();e.text(a.toString());e.close("div")}e.close("div")};return i},true);
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/ViewGroup", ["sap/ui/base/ManagedObject","./findIndexInArray"],function(i,t){"use strict";var e=i.extend("sap.ui.vk.ViewGroup",{metadata:{library:"sap.ui.vk",properties:{viewGroupId:{type:"string"},name:{type:"string"},description:{type:"string"}},associations:{}}});e.prototype.init=function(){this._views=[]};e.prototype.exit=function(){this._views=null};e.prototype.getViews=function(){return this._views};e.prototype.addView=function(i){this._views.push(i);return this};e.prototype.insertView=function(i,t){if(t<0){t=0}else if(t!==0&&t>=this._views.length){t=this._views.length}this._views.splice(t,0,i);return this};e.prototype.indexOfView=function(i){return t(this._views,function(t){return t==i})};e.prototype.removeView=function(i){var t=this.indexOfView(i);if(t>=0){this._views.splice(t,1)}return this};e.prototype.removeViews=function(){if(this._views){this._views.splice(0)}return this};return e});
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/ViewManager", ["sap/ui/core/Element","./Core","./Scene"],function(e,t,i){"use strict";var n=e.extend("sap.ui.vk.ViewManager",{metadata:{library:"sap.ui.vk",associations:{contentConnector:{type:"sap.ui.vk.ContentConnector"},animationPlayer:{type:"sap.ui.vk.AnimationPlayer"}}},constructor:function(i,n){e.apply(this,arguments);this._scene=null;this._activeView=null;this._cancelPlayingViewGroup=false;t.observeLifetime(this);t.observeAssociations(this)}});n.prototype._setScene=function(e){if(this._scene!==e){this._scene=e;if(e){var t=e.getInitialView();if(t){this.activateView(t,true,true)}}}return this};n.prototype.getActiveView=function(){return this._activeView};n.prototype._getNextView=function(e,t){var i=this._scene;if(!t){t=i.findViewGroupByView(e)}var n;var a=-1;if(!t){n=i.getViews();a=n.indexOf(e)}else{n=t.getViews();a=t.indexOfView(e)}if(a<0){return undefined}else if(a>=n.length-1){return undefined}a++;return n[a]};n.prototype._setContent=function(e){var t=null;if(e&&e instanceof i){t=e}this._setScene(t)};n.prototype.onSetContentConnector=function(e){e.attachContentReplaced(this._onContentReplaced,this);this._setContent(e.getContent())};n.prototype.onUnsetContentConnector=function(e){this._setContent(null);e.detachContentReplaced(this._onContentReplaced,this)};n.prototype._onContentReplaced=function(e){this._setContent(e.getParameter("newContent"))};n.prototype.activateView=function(e,t,i){if(i==null){i=false}if(t==null){t=false}return this._activateView(e,null,t,i,false)};n.prototype.playViewGroup=function(t,i,n){this._cancelPlayingViewGroup=false;if(t===this.getActiveView()){var a=e.getElementById(this.getAnimationPlayer());if(a){if(a.getTime()>=a.getTotalDuration()){a.setTime(0)}}return this._play(t,i,true,n)}this._activateView(t,i,false,false,true,n);return this};n.prototype.stopPlayingViewGroup=function(){this._cancelPlayingViewGroup=true;var t=e.getElementById(this.getAnimationPlayer());if(t){t.stop()}return this};n.prototype._play=function(i,n,a,o){var s=t.getEventBus();var r=e.getElementById(this.getAnimationPlayer());var u=r!=null&&i.hasAnimation()&&i.getAutoPlayAnimation();if(a){var c=function(){if(this._cancelPlayingViewGroup){return}var e=this._getNextView(i,n);if(e){this._activateView(e,n,false,false,a)}else{s.publish("sap.ui.vk","procedureFinished")}}.bind(this);var l=function(e,t,i){if(i.source!==r){return}if(i.stopped){s.unsubscribe("sap.ui.vk","animationPlayStateChanged",l,this);if(i.endOfAnimation){c()}}};if(u){s.subscribe("sap.ui.vk","animationPlayStateChanged",l,this)}else{setTimeout(c,o)}}if(u){r.play()}};n.prototype._activateView=function(i,n,a,o,s,r){var u=e.getElementById(this.getAnimationPlayer());if(u){u.stop()}this._cancelPlayingViewGroup=false;var c=this;return new Promise(function(e,u){var l=t.getEventBus();c._activeView=i;var p=function(t,a,u){if(u.view!==i){return}l.unsubscribe("sap.ui.vk","readyForAnimation",p,c);if(!c._cancelPlayingViewGroup&&!o){c._play(i,n,s,r)}e({view:i})};l.subscribe("sap.ui.vk","readyForAnimation",p,c);l.publish("sap.ui.vk","activateView",{source:c,view:i,skipCameraTransitionAnimation:a,playViewGroup:s})})};return n});
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/ViewStateManager", ["./Scene","./ViewStateManagerBase","sap/ui/core/Element"],function(t,e,i){"use strict";var n=e.extend("sap.ui.vk.ViewStateManager",{metadata:{library:"sap.ui.vk"}});var o=n.getMetadata().getParent().getClass().prototype;n.prototype.init=function(){if(o.init){o.init.call(this)}this._implementation=null};n.prototype.exit=function(){this._destroyImplementation();if(o.exit){o.exit.call(this)}};n.prototype._destroyImplementation=function(){if(this._implementation){this._implementation.destroy();this._implementation=null}return this};n.prototype.getImplementation=function(){return this._implementation};n.prototype._setContent=function(t){var e=null;if(t?.isA?.(["sap.ui.vk.Scene","sap.ui.vk.pdf.Document"])){e=t}this._setScene(e);return this};n.prototype._setScene=function(t){if(t?.isA(["sap.ui.vk.Scene","sap.ui.vk.pdf.Document"])){var e=t.getMetadata().getName();var n=this._implementation?.getMetadata().getName();var o=e==="sap.ui.vk.dvl.Scene"&&n==="sap.ui.vk.dvl.ViewStateManager"||e==="sap.ui.vk.threejs.Scene"&&n==="sap.ui.vk.threejs.ViewStateManager"||e==="sap.ui.vk.svg.Scene"&&n==="sap.ui.vk.svg.ViewStateManager"||e==="sap.ui.vk.pdf.Document"&&n==="sap.ui.vk.pdf.ViewStateManager";if(!o){this._destroyImplementation();var a;switch(e){case"sap.ui.vk.dvl.Scene":a="sap.ui.vk.dvl.ViewStateManager";break;case"sap.ui.vk.threejs.Scene":a="sap.ui.vk.threejs.ViewStateManager";break;case"sap.ui.vk.svg.Scene":a="sap.ui.vk.svg.ViewStateManager";break;case"sap.ui.vk.pdf.Document":a="sap.ui.vk.pdf.ViewStateManager";break;default:break}if(a){var r=this;var s=sap.ui.require(a.replaceAll(".","/"));this._implementation=new s({shouldTrackVisibilityChanges:this.getShouldTrackVisibilityChanges(),recursiveSelection:this.getRecursiveSelection(),contentConnector:this.getContentConnector(),viewManager:this.getViewManager(),visibilityChanged:function(t){r.fireVisibilityChanged({visible:t.getParameter("visible"),hidden:t.getParameter("hidden")})},selectionChanged:function(t){r.fireSelectionChanged({selected:t.getParameter("selected"),unselected:t.getParameter("unselected")})},outliningChanged:function(t){r.fireOutliningChanged({outlined:t.getParameter("outlined"),unoutlined:t.getParameter("unoutlined")})},opacityChanged:function(t){r.fireOpacityChanged({changed:t.getParameter("changed"),opacity:t.getParameter("opacity")})},tintColorChanged:function(t){r.fireTintColorChanged({changed:t.getParameter("changed"),tintColor:t.getParameter("tintColor"),tintColorABGR:t.getParameter("tintColorABGR")})},nodeHierarchyReplaced:function(t){r.fireNodeHierarchyReplaced({oldNodeHierarchy:t.getParameter("oldNodeHierarchy"),newNodeHierarchy:t.getParameter("newNodeHierarchy")})},viewStateApplying:function(t){r.fireViewStateApplying({view:t.getParameter("view")})},viewStateApplied:function(t){r.fireViewStateApplied({view:t.getParameter("view")})},transformationChanged:function(t){r.fireTransformationChanged(t.getParameters())},highlightColorChanged:function(t){r.fireHighlightColorChanged(t.getParameters())}});var m=i.getElementById(this.getViewManager());if(m){var p=i.getElementById(m.getAnimationPlayer());if(p){p.setViewStateManager(this._implementation)}}}}}else{this._destroyImplementation()}return this};n.prototype.getAnimationPlayer=function(){var t;var e=i.getElementById(this.getViewManager());if(e){t=i.getElementById(e.getAnimationPlayer())}return t};n.prototype.getNodeHierarchy=function(){return this._implementation&&this._implementation.getNodeHierarchy()};n.prototype.getVisibilityChanges=function(){return this._implementation&&this._implementation.getVisibilityChanges()};n.prototype.getVisibilityComplete=function(){return this._implementation&&this._implementation.getVisibilityComplete()};n.prototype.getVisibilityState=function(t){return this._implementation&&this._implementation.getVisibilityState(t)};n.prototype.setVisibilityState=function(t,e,i,n){if(this._implementation){this._implementation.setVisibilityState(t,e,i,n)}return this};n.prototype.resetVisibility=function(){if(this._implementation){this._implementation.resetVisibility()}return this};n.prototype.enumerateSelection=function(t){if(this._implementation){this._implementation.enumerateSelection(t)}return this};n.prototype.enumerateOutlinedNodes=function(t){if(this._implementation&&this._implementation.enumerateOutlinedNodes){this._implementation.enumerateOutlinedNodes(t)}return this};n.prototype.setShowSelectionBoundingBox=function(t){if(this._implementation){this._implementation.setShowSelectionBoundingBox(t)}};n.prototype.getShowSelectionBoundingBox=function(){if(this._implementation){return this._implementation.getShowSelectionBoundingBox()}return true};n.prototype.getSelectionState=function(t){return this._implementation&&this._implementation.getSelectionState(t)};n.prototype.setSelectionState=function(t,e,i,n){if(this._implementation){this._implementation.setSelectionState(t,e,i,n)}return this};n.prototype.setSelectionStates=function(t,e,i,n){if(this._implementation){this._implementation.setSelectionStates(t,e,i,n)}return this};n.prototype.getOutliningState=function(t){if(this._implementation&&this._implementation.getOutliningState){return this._implementation.getOutliningState(t)}else{return false}};n.prototype.setOutliningStates=function(t,e,i){if(this._implementation&&this._implementation.setOutliningStates){this._implementation.setOutliningStates(t,e,i)}return this};n.prototype.getJoints=function(){if(this._implementation&&this._implementation.getJoints){return this._implementation.getJoints()}return undefined};n.prototype.setJoints=function(t,e){if(this._implementation&&this._implementation.setJoints){this._implementation.setJoints(t,e)}return this};n.prototype.getOpacity=function(t){return this._implementation&&this._implementation.getOpacity(t)};n.prototype.setOpacity=function(t,e,i){if(this._implementation){this._implementation.setOpacity(t,e,i)}return this};n.prototype.getTotalOpacity=function(t){if(this._implementation&&this._implementation.getTotalOpacity){return this._implementation.getTotalOpacity(t)}return 1};n.prototype.setTotalOpacity=function(t,e){if(this._implementation&&this._implementation.setTotalOpacity){return this._implementation.setTotalOpacity(t,e)}return null};n.prototype.getRestOpacity=function(t){if(this._implementation&&this._implementation.getRestOpacity){return this._implementation.getRestOpacity(t)}return null};n.prototype.setRestOpacity=function(t,e){if(this._implementation&&this._implementation.setRestOpacity){this._implementation.setRestOpacity(t,e)}return this};n.prototype.restoreRestOpacity=function(t){if(this._implementation&&this._implementation.restoreRestOpacity){this._implementation.restoreRestOpacity(t)}return this};n.prototype.updateRestOpacity=function(t){if(this._implementation&&this._implementation.updateRestOpacity){this._implementation.updateRestOpacity(t)}return this};n.prototype.getTintColor=function(t,e){return this._implementation&&this._implementation.getTintColor(t,e)};n.prototype.setTintColor=function(t,e,i){if(this._implementation){this._implementation.setTintColor(t,e,i)}return this};n.prototype.setHighlightColor=function(t){if(this._implementation&&this._implementation.setHighlightColor){this._implementation.setHighlightColor(t)}return this};n.prototype.getHighlightColor=function(t){if(this._implementation&&this._implementation.getHighlightColor){return this._implementation.getHighlightColor(t)}if(t){return 4278190080}else{return"rgba(0, 0, 0, 1)"}};n.prototype.setOutlineColor=function(t){if(this._implementation&&this._implementation.setOutlineColor){this._implementation.setOutlineColor(t)}return this};n.prototype.getOutlineColor=function(t){if(this._implementation&&this._implementation.getOutlineColor){return this._implementation.getOutlineColor(t)}else{return null}};n.prototype.setOutlineWidth=function(t){if(this._implementation&&this._implementation.setOutlineWidth){this._implementation.setOutlineWidth(t)}return this};n.prototype.getOutlineWidth=function(){if(this._implementation&&this._implementation.getOutlineWidth){return this._implementation.getOutlineWidth()}else{return 0}};n.prototype.setRecursiveOutlining=function(t){this.setProperty("recursiveOutlining",t,true);if(this._implementation&&this._implementation.setRecursiveOutlining){this._implementation.setRecursiveOutlining(t)}return this};n.prototype.setRecursiveSelection=function(t){this.setProperty("recursiveSelection",t,true);if(this._implementation){this._implementation.setRecursiveSelection(t)}return this};n.prototype.setHighlightDisplayState=function(t){if(this._implementation&&this._implementation.setHighlightDisplayState){this._implementation.setHighlightDisplayState(t)}return this};n.prototype.setTransformation=function(t,e){if(this._implementation&&this._implementation.setTransformation){this._implementation.setTransformation(t,e)}return this};n.prototype.getTransformation=function(t){if(this._implementation&&this._implementation.getTransformation){return this._implementation.getTransformation(t)}return null};n.prototype.getTransformationWorld=function(t){if(this._implementation&&this._implementation.getTransformationWorld){return this._implementation.getTransformationWorld(t)}return null};n.prototype.getRestTransformationWorld=function(t){if(this._implementation&&this._implementation.getRestTransformationWorld){return this._implementation.getRestTransformationWorld(t)}return null};n.prototype.getRestTransformationUsingJoint=function(t){if(this._implementation&&this._implementation.getRestTransformationUsingJoint){return this._implementation.getRestTransformationUsingJoint(t)}return null};n.prototype.updateNodesRestTransformation=function(t){if(this._implementation&&this._implementation.updateNodesRestTransformation){this._implementation.updateNodesRestTransformation(t)}return this};n.prototype.updateRestTransformation=function(t,e){if(this._implementation&&this._implementation.updateRestTransformation){this._implementation.updateRestTransformation(t,e)}return this};n.prototype.restoreRestTransformation=function(t){if(this._implementation&&this._implementation.restoreRestTransformation){this._implementation.restoreRestTransformation(t)}return this};n.prototype.setRestTransformation=function(t,e,i,n){if(this._implementation&&this._implementation.setRestTransformation){this._implementation.setRestTransformation(t,e,i,n)}return this};n.prototype.getRelativeTransformation=function(t){if(this._implementation&&this._implementation.getRelativeTransformation){return this._implementation.getRelativeTransformation(t)}return null};n.prototype.getRestTransformation=function(t){if(this._implementation&&this._implementation.getRestTransformation){return this._implementation.getRestTransformation(t)}return null};n.prototype.setInterpolatedRelativeValues=function(t,e){if(this._implementation&&this._implementation.setInterpolatedRelativeValues){return this._implementation.setInterpolatedRelativeValues(t,e)}return null};n.prototype._getEndPropertyInLastPlayback=function(t,e){if(this._implementation&&this._implementation._getEndPropertyInLastPlayback){return this._implementation._getEndPropertyInLastPlayback(t,e)}return null};n.prototype._getEndPropertyInPreviousPlayback=function(t,e,i){if(this._implementation&&this._implementation._getEndPropertyInPreviousPlayback){return this._implementation._getEndPropertyInPreviousPlayback(t,e,i)}return null};n.prototype._convertTracksToRelative=function(t){if(this._implementation&&this._implementation._convertTracksToRelative){this._implementation._convertTracksToRelative(t)}return this};n.prototype._setJointNodeOffsets=function(t,e){if(this._implementation&&this._implementation._setJointNodeOffsets){this._implementation._setJointNodeOffsets(t,e)}return this};n.prototype._setJointNodeMatrix=function(){if(this._implementation&&this._implementation._setJointNodeMatrix){this._implementation._setJointNodeMatrix()}return this};n.prototype._propagateOpacityToJointChildren=function(t,e){if(this._implementation&&this._implementation._propagateOpacityToJointChildren){this._implementation._propagateOpacityToJointChildren(t,e)}return this};n.prototype.setTranslationKey=function(t,e,i,n){if(this._implementation&&this._implementation.setTranslationKey){this._implementation.setTranslationKey(t,e,i,n)}return this};n.prototype.setScaleKey=function(t,e,i,n){if(this._implementation&&this._implementation.setScaleKey){this._implementation.setScaleKey(t,e,i,n)}return this};n.prototype.setRotationKey=function(t,e,i,n,o){if(this._implementation&&this._implementation.setRotationKey){this._implementation.setRotationKey(t,e,i,n,o)}return this};n.prototype.setOpacityKey=function(t,e,i,n){if(this._implementation&&this._implementation.setOpacityKey){this._implementation.setOpacityKey(t,e,i,n)}return this};n.prototype.getSymbolNodes=function(t){if(this._implementation&&this._implementation.getSymbolNodes){return this._implementation.getSymbolNodes(t)}return[]};n.prototype.getBackgroundImageType=function(){if(this._implementation&&this._implementation.getBackgroundImageType){return this._implementation.getBackgroundImageType()}return null};n.prototype.setBackgroundImageType=function(t){if(this._implementation&&this._implementation.setBackgroundImageType){return this._implementation.setBackgroundImageType(t)}return undefined};n.prototype.getSelectable=function(t){var e=this._implementation;if(e){return e.getSelectable(t)}if(Array.isArray(t)){return new Array(t.length).fill(true)}else{return true}};n.prototype.setSelectable=function(t,e){var i=this._implementation;if(i){return i.setSelectable(t,e)}return this};return n});
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/ViewStateManagerBase", ["sap/ui/core/Element","./Core"],function(e,t){"use strict";var n=e.extend("sap.ui.vk.ViewStateManagerBase",{metadata:{library:"sap.ui.vk",abstract:true,properties:{shouldTrackVisibilityChanges:{type:"boolean",defaultValue:false},recursiveSelection:{type:"boolean",defaultValue:false},recursiveOutlining:{type:"boolean",defaultValue:false},features:{type:"string[]",defaultValue:[]}},associations:{contentConnector:{type:"sap.ui.vk.ContentConnector"},viewManager:{type:"sap.ui.vk.ViewManager"}},events:{visibilityChanged:{parameters:{visible:{type:"any[]"},hidden:{type:"any[]"}},enableEventBubbling:true},selectionChanged:{parameters:{selected:{type:"any[]"},unselected:{type:"any[]"}},enableEventBubbling:true},outliningChanged:{parameters:{outlined:{type:"any[]"},unoutlined:{type:"any[]"}},enableEventBubbling:true},opacityChanged:{parameters:{changed:{type:"any[]"},opacity:{type:"any"}},enableEventBubbling:true},tintColorChanged:{parameters:{changed:{type:"any[]"},tintColor:{type:"any"},tintColorABGR:{type:"any"}},enableEventBubbling:true},nodeHierarchyReplaced:{parameters:{oldNodeHierarchy:{type:"sap.ui.vk.NodeHierarchy"},newNodeHierarchy:{type:"sap.ui.vk.NodeHierarchy"}}},highlightColorChanged:{parameters:{highlightColor:{type:"sap.ui.core.CSSColor"},highlightColorABGR:{type:"int"}},enableEventBubbling:true},transformationChanged:{parameters:{changed:{type:"any"},transformation:{type:"any"}}},viewStateApplying:{parameters:{view:{type:"sap.ui.vk.View"}}},viewStateApplied:{parameters:{view:{type:"sap.ui.vk.View"}}},readyForAnimation:{parameters:{view:{type:"sap.ui.vk.View"}}},outlineColorChanged:{parameters:{outlineColor:{type:"sap.ui.core.CSSColor"},outlineColorABGR:{type:"int"}},enableEventBubbling:true},outlineWidthChanged:{parameters:{width:{type:"float"}},enableEventBubbling:true}}},constructor:function(n,a){e.apply(this,arguments);t.observeLifetime(this);t.observeAssociations(this)}});n.prototype.onSetContentConnector=function(e){e.attachContentReplaced(this._onContentReplaced,this);this._setContent(e.getContent())};n.prototype.onUnsetContentConnector=function(e){e.detachContentReplaced(this._onContentReplaced,this);this._setContent(null)};n.prototype._onContentReplaced=function(e){this._setContent(e.getParameter("newContent"))};n.prototype._setContent=function(e){return this};n.prototype.getSelectable=function(e){if(Array.isArray(e)){return new Array(e.length).fill(true)}else{return true}};n.prototype.setSelectable=function(e,t){return this};return n});
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/Viewer", ["./library","sap/ui/core/Core","sap/ui/core/Control","sap/ui/model/json/JSONModel","./Scene","./ContentResource","./ContentConnector","./dvl/ContentManager","./FlexibleControl","sap/m/VBox","sap/m/FlexItemData","sap/ui/layout/Splitter","sap/ui/layout/SplitterLayoutData","./DvlException","./Messages","sap/m/ProgressIndicator","./Notifications","./ViewStateManager","./Toolbar","./SceneTree","./StepNavigation","./ViewGallery","./ViewManager","./AnimationPlayer","./Viewport","./NativeViewport","./RedlineDesign","./SelectionMode","./DrawerToolbar","./pdf/PageGallery","./ecad/LayersPanel","./ecad/ElementsPanel","./getResourceBundle","./cssColorToColor","./colorToCSSColor","./abgrToColor","./colorToABGR","sap/base/Log","sap/base/i18n/Localization","sap/ui/core/StaticArea"],function(e,t,i,n,s,a,o,r,l,p,h,u,c,d,g,_,y,v,b,f,m,w,C,S,P,V,T,E,M,A,I,R,N,G,D,k,L,x,B,H){"use strict";var z=i.extend("sap.ui.vk.Viewer",{metadata:{library:"sap.ui.vk",properties:{enableSceneTree:{type:"boolean",defaultValue:true},showSceneTree:{type:"boolean",defaultValue:true},enableStepNavigation:{type:"boolean",defaultValue:true},enableNotifications:{type:"boolean",defaultValue:true},showStepNavigation:{type:"boolean",defaultValue:false},showStepNavigationThumbnails:{type:"boolean",defaultValue:true},overlayStepNavigation:{type:"boolean",defaultValue:false},enableLayersPanel:{type:"boolean",defaultValue:true},showLayersPanel:{type:"boolean",defaultValue:true},enableElementsPanel:{type:"boolean",defaultValue:true},showElementsPanel:{type:"boolean",defaultValue:true},enablePageGallery:{type:"boolean",defaultValue:true},showPageGallery:{type:"boolean",defaultValue:true},enableToolbar:{type:"boolean",defaultValue:true},enableProgressIndicator:{type:"boolean",defaultValue:true},showDrawerToolbar:{type:"boolean",defaultValue:true},enableMiniMap:{type:"boolean",defaultValue:true},showMiniMap:{type:"boolean",defaultValue:false},width:{type:"sap.ui.core.CSSSize",defaultValue:null},height:{type:"sap.ui.core.CSSSize",defaultValue:null},toolbarTitle:{type:"string",defaultValue:""},shouldTrackVisibilityChanges:{type:"boolean",defaultValue:false},recursiveSelection:{type:"boolean",defaultValue:false},runtimeSettings:{type:"object",defaultValue:{}},webGLContextAttributes:{type:"object",defaultValue:{antialias:true,alpha:true,premultipliedAlpha:false}},hotspotsEnabled:{type:"boolean",defaultValue:true},showAllHotspots:{type:"boolean",defaultValue:false},hotspotColorABGR:{type:"int",defaultValue:1493172411},hotspotColor:{type:"sap.ui.core.CSSColor",defaultValue:"rgba(89, 0, 0, 0.73)"}},aggregations:{contentResources:{type:"sap.ui.vk.ContentResource",forwarding:{getter:"_getContentConnector",aggregation:"contentResources"}},progressIndicator:{type:"sap.m.ProgressIndicator",multiple:false,visibility:"hidden"},layout:{type:"sap.m.VBox",multiple:false,visibility:"hidden"},contentConnector:{type:"sap.ui.vk.ContentConnector",multiple:false,visibility:"hidden"},viewStateManager:{type:"sap.ui.vk.ViewStateManager",multiple:false,visibility:"hidden"}},defaultAggregation:"contentResources",events:{contentResourceChangesProcessed:{},sceneLoadingSucceeded:{parameters:{scene:{type:"sap.ui.vk.Scene"}}},sceneLoadingFailed:{parameters:{reason:{type:"object"}}},sceneDestroying:{parameters:{scene:{type:"sap.ui.vk.Scene"},preventGarbageCollection:{type:"function"}}},selectionChanged:{parameters:{selected:{type:"any[]"},unselected:{type:"any[]"}}},fullScreen:{parameters:{isFullScreen:{type:"boolean"}}},urlClicked:{parameters:{nodeRef:"any",url:"string"}},nodeClicked:{parameters:{nodeRef:"any",x:"int",y:"int"}}}},renderer:{apiVersion:2,render:function(e,t){e.openStart("div",t);e.class("sapVizKitViewer");if(t.getWidth()){e.style("width",t.getWidth())}if(t.getHeight()){e.style("height",t.getHeight())}e.openEnd();e.renderControl(t._layout);e.renderControl(t._progressIndicator);e.close("div")}},constructor:function(e,t){i.apply(this,arguments);Object.assign(this._data,{sceneTree:{supported:false,enabled:this.getEnableSceneTree(),visible:this.getShowSceneTree()},stepNavigation:{supported:false,enabled:this.getEnableStepNavigation(),visible:this.getShowStepNavigation()},layersPanel:{supported:false,enabled:this.getEnableLayersPanel(),visible:this.getShowLayersPanel()},elementsPanel:{supported:false,enabled:this.getEnableElementsPanel(),visible:this.getShowElementsPanel()},pageGallery:{supported:false,enabled:this.getEnablePageGallery(),visible:this.getShowPageGallery(),currentPageIndex:0},miniMap:{supported:false,enabled:this.getEnableMiniMap(),visible:this.getShowMiniMap()},toolbar:{title:this.getToolbarTitle(),enabled:this.getEnableToolbar()},drawerToolbar:{visible:this.getShowDrawerToolbar()},hotspots:{supported:false,enabled:this.getHotspotsEnabled(),showAll:this.getShowAllHotspots(),colorABGR:this.getHotspotColorABGR(),color:this.getHotspotColor()},shouldTrackVisibilityChanges:this.getShouldTrackVisibilityChanges(),recursiveSelection:this.getRecursiveSelection()})}});z.prototype.applySettings=function(e){this._inApplySettings=true;i.prototype.applySettings.apply(this,arguments);delete this._inApplySettings};z.prototype.init=function(){if(i.prototype.init){i.prototype.init.apply(this)}this._contentConnector=new o(this.getId()+"-contentconnector");this.setAggregation("contentConnector",this._contentConnector);this._contentConnector.attachContentReplaced(this._handleContentReplaced,this);this._contentConnector.attachContentChangesStarted(this._handleContentChangesStarted,this);this._contentConnector.attachContentChangesFinished(this._handleContentChangesFinished,this);this._contentConnector.attachContentChangesProgress(this._handleContentChangesProgress,this);this._data={sceneTree:{},stepNavigation:{},layersPanel:{},elementsPanel:{},pageGallery:{},miniMap:{},toolbar:{},drawerToolbar:{},hotspots:{}};this._model=new n(this._data);this._model.attachPropertyChange(function(e){const t=e.getParameter("value");switch(e.getParameter("path")){case"/sceneTree/visible":this.setShowSceneTree(t);break;case"/stepNavigation/visible":this.setShowStepNavigation(t);break;case"/layersPanel/visible":this.setShowLayersPanel(t);break;case"/elementsPanel/visible":this.setShowElementsPanel(t);break;case"/pageGallery/visible":this.setShowPageGallery(t);break;case"/miniMap/visible":this.setShowMiniMap(t);break;case"/hotspots/showAll":this.setShowAllHotspots(t);break;case"/hotspots/colorABGR":this.setHotspotColorABGR(t);break;case"/hotspots/color":this.setHotspotColor(t);break;default:break}},this);this.setModel(this._model,"_internal");this._viewStateManager=new v(this.getId()+"-viewstatemanager",{shouldTrackVisibilityChanges:"{_internal>/shouldTrackVisibilityChanges}",recursiveSelection:"{_internal>/recursiveSelection}",contentConnector:this._contentConnector});this.setAggregation("viewStateManager",this._viewStateManager);x.debug("sap.ui.vk.Viewer.init() called.");this._animationPlayer=new S({viewStateManager:this._viewStateManager});this._viewManager=new C({contentConnector:this._contentConnector,animationPlayer:this._animationPlayer});this._viewStateManager.setViewManager(this._viewManager);this._mainScene=null;this._busyIndicatorCounter=0;this._viewport=null;this._nativeViewport=null;this._redlineDesign=null;this._stepNavigation=null;this._sceneTree=null;this._drawerToolbar=null;this._pageGallery=null;this._layersPanel=null;this._elementsPanel=null;this._staticAreaParent=null;this._staticAreaNextSibling=null;this.attachBrowserEvent("fullscreenchange",this._handleFullscreenChange,this);this._toolbar=new b({title:"{_internal>/toolbar/title}",visible:"{_internal>/toolbar/enabled}",viewer:this});this._stackedViewport=new l(this.getId()+"-stackedViewport",{width:"100%",height:"100%",layout:"Stacked",layoutData:new c({size:"auto",minSize:200})});this._splitter=new u(this.getId()+"-splitter",{layoutData:new h({growFactor:1,minHeight:"200px"}),contentAreas:[this._stackedViewport]}).addStyleClass("sapUiVizKitSplitter");this._messagePopover=new y(`${this.getId()}-notifications`,{visible:true});this._messagePopover.attachAllMessagesCleared(this._updateLayout,this);this._messagePopover.attachMessageAdded(this._updateLayout,this);this._layout=new p(this.getId()+"-vbox",{height:"100%",items:[this._toolbar,this._splitter,this._messagePopover]}).addStyleClass("sapUiVizKitLayout");this.setAggregation("layout",this._layout);this.setTooltip(N().getText("VIEWER_TITLE"));if(this.getEnableProgressIndicator()){this._progressIndicator=new _({displayAnimation:false,displayOnly:true,visible:false}).addStyleClass("sapUiVizKitProgressIndicator");this.setAggregation("progressIndicator",this._progressIndicator)}B.attachChange(this._onLocalizationChanged)};z.prototype.exit=function(){x.debug("sap.ui.vk.Viewer.exit() called.");B.detachChange(this._onLocalizationChanged);this._viewport?.destroy();this._viewport=null;this._nativeViewport?.destroy();this._nativeViewport=null;this._setMainScene(null);this._toolbar=null;this._messagePopover=null;this._sceneTree=null;this._stepNavigation=null;this._drawerToolbar=null;this._componentsState=null;this._viewStateManager=null;this._contentConnector=null;this._viewManager=null;this._model=null;this._staticAreaParent=null;this._staticAreaNextSibling=null;this.detachBrowserEvent("fullscreenchange",this._handleFullscreenChange,this);if(i.prototype.exit){i.prototype.exit.apply(this)}};z.prototype._handleFullscreenChange=function(e){const t=this.getDomRef();if(e.target===this.getDomRef()||this._staticAreaParent!=null){const i=H.getDomRef();if(i==null){return}if(document.fullscreenElement===this.getDomRef()){this._staticAreaParent=i.parentElement;this._staticAreaNextSibling=i.nextSibling;t.insertBefore(i,t.firstChild);this._toolbar._enterFullScreenButton.setTooltip(N().getText("EXIT_FULLSCREEN"));e.stopImmediatePropagation()}else if(this._staticAreaParent!=null){this._staticAreaParent.insertBefore(i,this._staticAreaNextSibling);this._staticAreaParent=this._staticAreaNextSibling=null;this._toolbar._enterFullScreenButton.setTooltip(N().getText("ENTER_FULLSCREEN"));if(document.fullscreenElement!=null){e.stopImmediatePropagation()}}}};z.prototype._setMainScene=function(e){this._sceneTree?.destroy();this._sceneTree=null;if(this._stepNavigation){this._layout.removeItem(this._stepNavigation);this._viewport?.removeContent(this._stepNavigation);this._stepNavigation.destroy();this._stepNavigation=null}this._layersPanel?.destroy();this._layersPanel=null;this._elementsPanel?.destroy();this._elementsPanel=null;this._pageGallery?.destroy();this._pageGallery=null;this._mainScene=e instanceof s?e:null;const t=e?.getMetadata?.().getName()==="sap.ui.vk.svg.Scene";const i=t&&e.isECADScene();const n=e?.isA?.("sap.ui.vk.pdf.Document");const a=this._data;a.sceneTree.supported=a.stepNavigation.supported=e instanceof s&&!i;a.layersPanel.supported=a.elementsPanel.supported=i;a.hotspots.supported=t&&!i;a.miniMap.supported=t;a.pageGallery.supported=n;this._model?.updateBindings();if(this._mainScene){if(a.sceneTree.supported&&a.sceneTree.enabled){this._sceneTree=new f({layoutData:new c({size:"320px",minSize:200}),viewStateManager:this._viewStateManager,contentConnector:this._contentConnector})}if(a.stepNavigation.supported&&a.stepNavigation.enabled){this._instantiateStepNavigation()}if(a.layersPanel.supported&&a.layersPanel.enabled){this._layersPanel=new I({layoutData:new c({size:"320px",minSize:200}),contentConnector:this._contentConnector,viewStateManager:this._viewStateManager})}if(a.elementsPanel.supported&&a.elementsPanel.enabled){this._elementsPanel=new R({contentConnector:this._contentConnector,viewStateManager:this._viewStateManager,layoutData:new c({size:"320px",minSize:200})})}}if(a.pageGallery.supported){a.pageGallery.currentPageIndex=0;this._pageGallery=new A({layoutData:new c({size:"320px",minSize:200}),contentConnector:this._contentConnector,currentPageIndex:"{_internal>/pageGallery/currentPageIndex}"})}return this};z.prototype.getGraphicsCore=function(){return this._mainScene instanceof e.dvl.Scene?this._mainScene.getGraphicsCore():null};z.prototype.getScene=function(){return this._mainScene};z.prototype.getViewStateManager=function(){return this._viewStateManager};z.prototype.getViewport=function(){if(!this._viewport){this._viewport=new P(this.getId()+"-viewport",{viewStateManager:this._viewStateManager,selectionMode:E.Exclusive,contentConnector:this._contentConnector,showAllHotspots:"{_internal>/hotspots/showAll}",hotspotColorABGR:"{_internal>/hotspots/colorABGR}",hotspotColor:"{_internal>/hotspots/color}"});this._drawerToolbar=new M({visible:"{_internal>/drawerToolbar/visible}",expanded:true,viewport:this._viewport});this._viewport.addContent(this._drawerToolbar)}return this._viewport};z.prototype.getNativeViewport=function(){if(this._nativeViewport){return this._nativeViewport}var t=this.getViewport().getImplementation();return t instanceof e.NativeViewport?t:null};z.prototype.getToolbar=function(){return this._toolbar};z.prototype.getSceneTree=function(){return this._sceneTree};z.prototype.getRedlineDesign=function(){return this._redlineDesign};z.prototype.setEnableSceneTree=function(e){this.setProperty("enableSceneTree",e,true);this._data.sceneTree.enabled=e;this._model.updateBindings();return this};z.prototype.setShowSceneTree=function(e){this.setProperty("showSceneTree",e,true);this._data.sceneTree.visible=e;this._model.updateBindings();this._updateLayout();return this};z.prototype.setEnableStepNavigation=function(e){this.setProperty("enableStepNavigation",e,true);this._data.stepNavigation.enabled=e;this._model.updateBindings();return this};z.prototype.setShowStepNavigation=function(e){this.setProperty("showStepNavigation",e,true);this._data.stepNavigation.visible=e;this._model.updateBindings();return this};z.prototype.setEnableLayersPanel=function(e){this.setProperty("enableLayersPanel",e,true);this._data.layersPanel.enabled=e;this._model.updateBindings();return this};z.prototype.setShowLayersPanel=function(e){this.setProperty("showLayersPanel",e,true);this._data.layersPanel.visible=e;this._model.updateBindings();this._updateLayout();return this};z.prototype.setEnableElementsPanel=function(e){this.setProperty("enableElementsPanel",e,true);this._data.elementsPanel.enabled=e;this._model.updateBindings();return this};z.prototype.setShowElementsPanel=function(e){this.setProperty("showElementsPanel",e,true);this._data.elementsPanel.visible=e;this._model.updateBindings();this._updateLayout();return this};z.prototype.setEnablePageGallery=function(e){this.setProperty("enablePageGallery",e,true);this._data.pageGallery.enabled=e;this._model.updateBindings();return this};z.prototype.setShowPageGallery=function(e){this.setProperty("showPageGallery",e,true);this._data.pageGallery.visible=e;this._model.updateBindings();this._updateLayout();return this};z.prototype.setEnableMiniMap=function(e){this.setProperty("enableMiniMap",e,true);this._data.miniMap.enabled=e;this._model.updateBindings();this._updateLayout();return this};z.prototype.setShowMiniMap=function(e){this.setProperty("showMiniMap",e,true);this._data.miniMap.visible=e;this._model.updateBindings();this._updateLayout();return this};z.prototype.setToolbarTitle=function(e){this.setProperty("toolbarTitle",e,true);this._data.toolbar.title=e;this._model.updateBindings();return this};z.prototype.setEnableToolbar=function(e){this.setProperty("enableToolbar",e,true);this._data.toolbar.enabled=e;this._model.updateBindings();return this};z.prototype.setShowDrawerToolbar=function(e){this.setProperty("showDrawerToolbar",e,true);this._data.drawerToolbar.visible=e;this._model.updateBindings();return this};z.prototype.setHotspotsEnabled=function(e){this.setProperty("hotspotsEnabled",e,true);this._data.hotspots.enabled=e;this._model.updateBindings();return this};z.prototype.setShowAllHotspots=function(e){this.setProperty("showAllHotspots",e,true);this._data.hotspots.showAll=e;this._model.updateBindings();return this};z.prototype._setHotspotColor=function(e,t){this.setProperty("hotspotColorABGR",e,true);this.setProperty("hotspotColor",t,true);this._data.hotspots.colorABGR=e;this._data.hotspots.color=t;this._model.updateBindings();return this};z.prototype.setHotspotColorABGR=function(e){return this._setHotspotColor(e,D(k(e)))};z.prototype.setHotspotColor=function(e){return this._setHotspotColor(L(G(e)),e)};z.prototype.setShouldTrackVisibilityChanges=function(e){this.setProperty("shouldTrackVisibilityChanges",e,true);this._data.shouldTrackVisibilityChanges=e;this._model.updateBindings();return this};z.prototype.setRecursiveSelection=function(e){this.setProperty("recursiveSelection",e,true);this._data.recursiveSelection=e;this._model.updateBindings();return this};z.prototype.setEnableNotifications=function(e){this.setProperty("enableNotifications",e,true);this._messagePopover.setVisible(false);this._updateLayout();return this};z.prototype.activateFullScreenMode=function(){const e=this.getDomRef();if(document.fullscreenElement===e){document.exitFullscreen()}else{e.requestFullscreen()}return this};z.prototype.setRuntimeSettings=function(e){if(this._inApplySettings){this.setProperty("runtimeSettings",e,true);r.setRuntimeSettings(e)}else{x.error(N().getText(g.VIT29.summary),g.VIT29.code,"sap.ui.vk.Viewer")}return this};z.prototype.setWebGLContextAttributes=function(e){if(this._inApplySettings){this.setProperty("webGLContextAttributes",e,true);r.setWebGLContextAttributes(e)}else{x.error(N().getText(g.VIT30.summary),g.VIT30.code,"sap.ui.vk.Viewer")}return this};z.prototype.invalidate=function(e){if(e instanceof a){this._contentConnector.invalidate(e);return}i.prototype.invalidate.apply(this,arguments)};z.prototype._getContentConnector=function(){return this._contentConnector};z.prototype.isTreeBinding=function(e){return e==="contentResources"};z.prototype.setBusy=function(e){if(e){if(this._busyIndicatorCounter===0){this.setBusyIndicatorDelay(0);i.prototype.setBusy.call(this,true)}this._busyIndicatorCounter+=1}else{this._busyIndicatorCounter-=1;if(this._busyIndicatorCounter==0){i.prototype.setBusy.call(this,false)}}};z.prototype._setSplitterContent=function(e,t,i){if(e){e.setVisible(t);if(t){if(this._splitter.indexOfContentArea(e)<0){this._splitter.insertContentArea(e,i?this._splitter.getContentAreas().length:0)}}else if(this._splitter.indexOfContentArea(e)>=0){this._splitter.removeContentArea(e)}}};z.prototype._updateLayout=function(){const e=this._data;this._setSplitterContent(this._sceneTree,e.sceneTree.visible&&e.sceneTree.enabled);this._setSplitterContent(this._layersPanel,e.layersPanel.visible&&e.layersPanel.enabled);this._setSplitterContent(this._elementsPanel,e.elementsPanel.visible&&e.elementsPanel.enabled,true);this._setSplitterContent(this._pageGallery,e.pageGallery.visible&&e.pageGallery.enabled);this._messagePopover?.setVisible(this.getEnableNotifications()&&this._messagePopover.getAggregation("_messagePopover").getItems().length>0);if(e.miniMap.supported&&this._viewport?.getImplementation()?.getMetadata().getName()==="sap.ui.vk.svg.Viewport"){this._viewport.getImplementation().getMiniMap()[e.miniMap.visible&&e.miniMap.enabled?"open":"close"]()}};z.prototype._instantiateStepNavigation=function(){var e=this._mainScene.getMetadata().getName();if(e==="sap.ui.vk.dvl.Scene"){this._stepNavigation=new m({visible:"{_internal>/stepNavigation/visible}",showThumbnails:this.getShowStepNavigationThumbnails(),contentConnector:this._contentConnector});this._layout.insertItem(this._stepNavigation,3)}if(this._stepNavigation==null&&(e==="sap.ui.vk.threejs.Scene"||e==="sap.ui.vk.svg.Scene")){this._stepNavigation=new w({visible:"{_internal>/stepNavigation/visible}",host:this.getViewport(),contentConnector:this._contentConnector,viewManager:this._viewManager,animationPlayer:this._animationPlayer});if(!this.getOverlayStepNavigation()){this._layout.insertItem(this._stepNavigation,3)}else{this._stepNavigation.addStyleClass("sapVizKitViewGallery");this._viewport.addContent(this._stepNavigation)}}return this};z.prototype._showViewport=function(){const e=this.getViewport();this._nativeViewport?.setVisible(false);this._stackedViewport.removeAllContent();this._stackedViewport.addContent(e);e.setVisible(true);return this};z.prototype._showNativeViewport=function(){if(!this._nativeViewport){this._nativeViewport=new V(this.getId()+"-nativeViewport",{limitZoomOut:true,contentConnector:this._contentConnector})}this._viewport?.setVisible(false);this._stackedViewport.removeAllContent();this._stackedViewport.addContent(this._nativeViewport);this._nativeViewport.setVisible(true);return this};z.prototype.setDecryptionHandler=function(e){this._contentConnector.setDecryptionHandler(e);return this};z.prototype.setAuthorizationHandler=function(e){this._contentConnector.setAuthorizationHandler(e);return this};z.prototype.setConsumptionScenario=function(e){this._contentConnector.setConsumptionScenario(e);return this};z.prototype._instantiateRedlineDesign=function(e){var t=this.getViewport().getImplementation();if(t&&t.getVisible()){var i=t&&t.getVisible()?t:null;var n=i.getOutputSize();this._redlineDesign=new T({visible:false,virtualTop:n.top,virtualLeft:n.left,virtualSideLength:n.sideLength,redlineElements:e});this._redlineDesign._setTargetViewport(i)}return this};z.prototype.activateRedlineDesign=function(t){var i=this.getViewport().getImplementation();if(i._activateRedline){i._activateRedline()}else if(i instanceof e.threejs.Viewport){i._viewportGestureHandler._activateRedline()}t=t||[];this._instantiateRedlineDesign(t);this.getRedlineDesign().placeAt(this._stackedViewport);this.getRedlineDesign().setVisible(true);var n=function(e){var t=e.getParameter("deltaX"),n=e.getParameter("deltaY");i.queueCommand(function(){i.pan(t,n);i.endGesture()})};var s=function(e){var t=e.getParameter("originX"),n=e.getParameter("originY"),s=e.getParameter("zoomFactor");i.queueCommand(function(){i.beginGesture(t,n);i.zoom(s);i.endGesture()})};var a=function(e){var t=e.getParameter("deltaX"),n=e.getParameter("deltaY");i.queueCommand(function(){i._viewportGestureHandler._cameraController.beginGesture(t,n);i._viewportGestureHandler._cameraController.pan(t,n);i._viewportGestureHandler._cameraController.endGesture()})};var o=function(e){var t=e.getParameter("originX"),n=e.getParameter("originY"),s=e.getParameter("zoomFactor");i.queueCommand(function(){i._viewportGestureHandler._cameraController.beginGesture(t,n);i._viewportGestureHandler._cameraController.zoom(s);i._viewportGestureHandler._cameraController.endGesture()})};if((i instanceof e.NativeViewport||i instanceof e.dvl.Viewport)&&i.getVisible()){this.getRedlineDesign().attachEvent("pan",n.bind(this));this.getRedlineDesign().attachEvent("zoom",s.bind(this))}else if(i instanceof e.threejs.Viewport&&i.getVisible()){this.getRedlineDesign().attachEvent("pan",a.bind(this));this.getRedlineDesign().attachEvent("zoom",o.bind(this))}else{x.error("Error: Viewport not supported")}return this};z.prototype.destroyRedlineDesign=function(){if(this.getRedlineDesign()){var t=this.getViewport().getImplementation();if(t._deactivateRedline){t._deactivateRedline()}else if(t instanceof e.threejs.Viewport){t._viewportGestureHandler._deactivateRedline()}this.getRedlineDesign().destroy();this._redlineDesign=null}return this};z.prototype._removeProgressIndicator=function(){this._progressIndicator.setVisible(false);this._progressIndicator.setDisplayValue("");this._progressIndicator.setPercentValue(0);this._progressIndicator.rerender()};z.prototype._handleContentReplaced=function(e){var t=e.getParameter("newContent");if(t instanceof s||t instanceof HTMLImageElement||t instanceof HTMLObjectElement||t?.isA?.("sap.ui.vk.pdf.Document")){this._showViewport();if(this.getRedlineDesign()){this.getRedlineDesign().updatePanningRatio()}this._setMainScene(t)}else{this._setMainScene(null);if(this._viewport){this._viewport.setVisible(false)}if(this._nativeViewport){this._nativeViewport.setVisible(false)}this._stackedViewport.removeAllContent()}};z.prototype._handleContentChangesStarted=function(e){this.setBusy(true);if(this.getEnableProgressIndicator()){this._progressIndicator.setPercentValue(0);this._progressIndicator.setVisible(true);this._progressIndicator.rerender()}};z.prototype._handleContentChangesFinished=function(e){x.info("Finished");this.setBusy(false);var t=e.getParameter("content");if(t){if(this._pageGallery){const e=this._viewport.getImplementation();if(e?.getMetadata().getName()==="sap.ui.vk.pdf.Viewport"){e.bindProperty("currentPageIndex","_internal>/pageGallery/currentPageIndex")}}this.fireSceneLoadingSucceeded({scene:t})}var i=e.getParameter("failureReason");if(i){this.fireSceneLoadingFailed({reason:i});this._showNativeViewport();var n=N().getText("VIEWER_UNKNOWN_CONTENT_RESOURCE_TYPE_CAUSE");if(i.errorMessage===n){this._nativeViewport.loadFailed()}else{var s=N().getText("VIEWPORT_MESSAGEERRORLOADINGFILE");this._nativeViewport.loadFailed(s)}(Array.isArray(i)?i:[i]).forEach(function(e){x.error(N().getText(g.VIT13.summary),e.errorMessage,"sap.ui.vk.Viewer")})}if(i||this._progressIndicator.getPercentValue()===0){this._removeProgressIndicator()}this.fireContentResourceChangesProcessed();this._updateLayout()};var F=N().getText("PROGRESS_INDICATOR_TOTAL_PERCENT_DONE");z.prototype._handleContentChangesProgress=function(e){if(!this._progressIndicator.getVisible()){return}var t=e.getParameter("percentage");var i=e.getParameter("phase");this._progressIndicator.setPercentValue(t);this._progressIndicator.setDisplayValue(i+" / "+F+": "+(t?Math.floor(t)+"%":""));if(t>=100){this._removeProgressIndicator()}else{this._progressIndicator.rerender()}};z.prototype._handleContentDestroying=function(e){this.fireSceneDestroying({scene:e.getParameter("content").scene,preventGarbageCollection:e.getParameter("preventGarbageCollection")})};z.prototype._onLocalizationChanged=function(e){F=N().getText("PROGRESS_INDICATOR_TOTAL_PERCENT_DONE")};return z});
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/Viewport", ["./ViewportBase","./ViewStateManager","./ViewportRenderer","./VisibilityMode","./RenderMode","./Scene","./Camera","sap/base/Log"],function(t,e,i,o,n,s,a,r){"use strict";var l=t.extend("sap.ui.vk.Viewport",{metadata:{library:"sap.ui.vk",designtime:"sap/ui/vk/designtime/Viewport.designtime"}});var p=l.getMetadata().getParent().getClass().prototype;l.prototype.init=function(){if(p.init){p.init.call(this)}this._implementation=null};l.prototype.exit=function(){this._destroyImplementation();if(p.exit){p.exit.call(this)}};l.prototype.getImplementation=function(){return this._implementation};l.prototype._destroyImplementation=function(){if(this._implementation){var t=this.removeAllContent();var e=this;t.forEach(function(t){e.addAggregation("content",t)});this.setAggregation("safeArea",this._implementation.getSafeArea());this._implementation.destroy();this._implementation=null}return this};l.prototype.getShowDebugInfo=function(){if(this._implementation){return this._implementation.getShowDebugInfo()}return p.getShowDebugInfo.call(this)};l.prototype.setShowDebugInfo=function(t){p.setShowDebugInfo.call(this,t);if(this._implementation){this._implementation.setShowDebugInfo(t)}return this};l.prototype.getAutoStartRendering=function(){if(this._implementation){return this._implementation.getAutoStartRendering()}return p.getAutoStartRendering.call(this)};l.prototype.setAutoStartRendering=function(t){p.setAutoStartRendering.call(this,t);if(this._implementation){this._implementation.setAutoStartRendering(t)}return this};l.prototype.getBackgroundColorTop=function(){if(this._implementation){return this._implementation.getBackgroundColorTop()}return p.getBackgroundColorTop.call(this)};l.prototype.setBackgroundColorTop=function(t){p.setBackgroundColorTop.call(this,t);if(this._implementation){this._implementation.setBackgroundColorTop(t)}return this};l.prototype.getBackgroundColorBottom=function(){if(this._implementation){return this._implementation.getBackgroundColorBottom()}return p.getBackgroundColorBottom.call(this)};l.prototype.setBackgroundColorBottom=function(t){p.setBackgroundColorBottom.call(this,t);if(this._implementation){this._implementation.setBackgroundColorBottom(t)}return this};l.prototype.setWidth=function(t){p.setWidth.call(this,t);if(this._implementation){this._implementation.setWidth(t)}return this};l.prototype.setHeight=function(t){p.setHeight.call(this,t);if(this._implementation){this._implementation.setHeight(t)}return this};l.prototype.setSelectionMode=function(t){this.setProperty("selectionMode",t,true);if(this._implementation){this._implementation.setProperty("selectionMode",t,true)}return this};l.prototype.getSelectionMode=function(){if(this._implementation){return this._implementation.getSelectionMode()}return p.getSelectionMode.call(this)};l.prototype.setSelectionDisplayMode=function(t){p.setSelectionDisplayMode.call(this,t);if(this._implementation){this._implementation.setSelectionDisplayMode(t)}return this};l.prototype.getSelectionDisplayMode=function(){if(this._implementation){return this._implementation.getSelectionDisplayMode()}return p.getSelectionDisplayMode.call(this)};l.prototype.setShowSelectionBoundingBoxes=function(t){p.setShowSelectionBoundingBoxes.call(this,t);if(this._implementation){this._implementation.setShowSelectionBoundingBoxes(t)}return this};l.prototype.getShowSelectionBoundingBoxes=function(){if(this._implementation){return this._implementation.getShowSelectionBoundingBoxes()}return p.getShowSelectionBoundingBoxes.call(this)};l.prototype.setShowSafeArea=function(t){p.setShowSafeArea.call(this,t);if(this._implementation){this._implementation.setShowSafeArea(t)}return this};l.prototype.getShowSafeArea=function(){if(this._implementation){return this._implementation.getShowSafeArea()}return p.getShowSafeArea.call(this)};l.prototype.setShowAllHotspots=function(t){p.setShowAllHotspots.call(this,t);if(this._implementation){this._implementation.setShowAllHotspots(t)}return this};l.prototype.getShowAllHotspots=function(){if(this._implementation){return this._implementation.getShowAllHotspots()}return p.getShowAllHotspots.call(this)};l.prototype.setDisableHotspotHovering=function(t){p.setDisableHotspotHovering.call(this,t);if(this._implementation){this._implementation.setDisableHotspotHovering(t)}return this};l.prototype.getDisableHotspotHovering=function(){if(this._implementation){return this._implementation.getDisableHotspotHovering()}return p.getDisableHotspotHovering.call(this)};l.prototype.setHotspotColorABGR=function(t){p.setHotspotColorABGR.call(this,t);if(this._implementation){this._implementation.setHotspotColorABGR(t)}return this};l.prototype.getHotspotColorABGR=function(){if(this._implementation){return this._implementation.getHotspotColorABGR()}return p.getHotspotColorABGR.call(this)};l.prototype.setHotspotColor=function(t){p.setHotspotColor.call(this,t);if(this._implementation){this._implementation.setHotspotColor(t)}return this};l.prototype.getHotspotColor=function(){if(this._implementation){return this._implementation.getHotspotColor()}return p.getHotspotColor.call(this)};l.prototype.setHotspotCustomTextOutlineWidth=function(t){this._implementation?.setHotspotCustomTextOutlineWidth(t);return this};l.prototype.getHotspotCustomTextOutlineWidth=function(){return this._implementation?.getHotspotCustomTextOutlineWidth()??p.getHotspotCustomTextOutlineWidth.call(this)};l.prototype.setHotspotCustomTextOutlineColor=function(t){this._implementation?.setHotspotCustomTextOutlineColor(t);return this};l.prototype.getHotspotCustomTextOutlineColor=function(){return this._implementation?.getHotspotCustomTextOutlineColor()??p.getHotspotCustomTextOutlineColor.call(this)};l.prototype.setHotspotCustomTextHaloWidth=function(t){this._implementation?.setHotspotCustomTextHaloWidth(t);return this};l.prototype.getHotspotCustomTextHaloWidth=function(){return this._implementation?.getHotspotCustomTextHaloWidth()??p.getHotspotCustomTextHaloWidth.call(this)};l.prototype.setShowAllDynamicContents=function(t){p.setShowAllDynamicContents.call(this,t);if(this._implementation){this._implementation.setShowAllDynamicContents(t)}return this};l.prototype.getShowAllDynamicContents=function(){if(this._implementation){return this._implementation.getShowAllDynamicContents()}return p.getShowAllDynamicContents.call(this)};l.prototype.setKeepOutputSize=function(t){if(this._implementation&&this._implementation.setKeepOutputSize){this._implementation.setKeepOutputSize(t)}else{this.setProperty("keepOutputSize",t)}};l.prototype.getKeepOutputSize=function(){if(this._implementation&&this._implementation.getKeepOutputSize){return this._implementation.getKeepOutputSize()}return this.getProperty("keepOutputSize")};l.prototype.setShowAllHotspotsTintColor=function(t){if(this._implementation&&this._implementation.setShowAllHotspotsTintColor){this._implementation.setShowAllHotspotsTintColor(t)}else{this.setProperty("showAllHotspotsTintColor",t)}};l.prototype.getShowAllHotspotsTintColor=function(t){if(this._implementation&&this._implementation.getShowAllHotspotsTintColor){this._implementation.getShowAllHotspotsTintColor(t)}else{this.getProperty("showAllHotspotsTintColor",t)}};l.prototype.setCamera=function(t){p.setCamera.call(this,t);if(this._implementation){this._implementation.setCamera(t);return this}return this};l.prototype.getCamera=function(){if(this._implementation){return this._implementation.getCamera()}return p.getCamera.call(this)};l.prototype.setShouldRenderFrame=function(){if(this._implementation){this._implementation.setShouldRenderFrame()}return this};l.prototype.shouldRenderFrame=function(){if(this._implementation){this._implementation.shouldRenderFrame()}};l.prototype.setRenderMode=function(t){if(this._implementation&&this._implementation.setRenderMode){this._implementation.setRenderMode(t)}return this};l.prototype.getRenderMode=function(){if(this._implementation&&this._implementation.getRenderMode){return this._implementation.getRenderMode()}return n.Default};l.prototype.setFreezeCamera=function(t){p.setFreezeCamera.call(this,t);if(this._implementation){this._implementation.setFreezeCamera(t)}return this};l.prototype.showHotspots=function(t,e,i){if(this._implementation&&this._implementation.showHotspots){this._implementation.showHotspots(t,e,i)}return this};l.prototype.addTool=function(t){this.addAssociation("tools",t);if(this._implementation){this._implementation.addTool(t)}};l.prototype.removeTool=function(t){this.removeAssociation("tools",t);if(this._implementation){this._implementation.removeTool(t)}};l.prototype.getTools=function(){if(this._implementation){return this._implementation.getTools()}return this.getAssociation("tools",[])};l.prototype.removeAllTools=function(){this.removeAllAssociation("tools");if(this._implementation){this._implementation.removeAllTools()}};l.prototype.addContent=function(t){if(this._implementation){this._implementation.addContent(t)}else{this.addAggregation("content",t)}};l.prototype.removeContent=function(t){if(this._implementation){return this._implementation.removeContent(t)}return this.removeAggregation("content",t)};l.prototype.getContent=function(){if(this._implementation){return this._implementation.getContent()}return this.getAggregation("content")};l.prototype.removeAllContent=function(){if(this._implementation){return this._implementation.removeAllContent()}return this.removeAggregation("content")};l.prototype.setOutputSettings=function(t){if(this._implementation&&this._implementation.setOutputSettings){this._implementation.setOutputSettings(t)}else{this.setAggregation("outputSettings",t)}};l.prototype.getOutputSettings=function(){if(this._implementation&&this._implementation.getOutputSettings){return this._implementation.getOutputSettings()}return this.getAggregation("outputSettings")};l.prototype.removeOutputSettings=function(){if(this._implementation){return this._implementation.removeAggregation("outputSettings")}return this.removeAggregation("outputSettings")};l.prototype.setSafeArea=function(t){if(this._implementation){this._implementation.setSafeArea(t)}else{this.setAggregation("safeArea",t)}};l.prototype.getSafeArea=function(){if(this._implementation){return this._implementation.getSafeArea()}return this.getAggregation("safeArea")};l.prototype.removeSafeArea=function(){if(this._implementation){return this._implementation.removeAggregation("safeArea")}return this.removeAggregation("safeArea")};l.prototype.addAnnotation=function(t){if(this._implementation){this._implementation.addAnnotation(t)}else{this.addAggregation("annotations",t)}};l.prototype.destroyAnnotations=function(){if(this._implementation){return this._implementation.destroyAnnotations()}return this.destroyAggregation("annotations")};l.prototype.getAnnotations=function(){if(this._implementation){return this._implementation.getAnnotations()}return this.getAggregation("annotations")};l.prototype.getSymbolNodes=function(t){if(this._implementation&&this._implementation.getSymbolNodes){return this._implementation.getSymbolNodes(t)}return[]};l.prototype.indexOfAnnotation=function(t){if(this._implementation){return this._implementation.indexOfAnnotation(t)}return this.indexOfAggregation("annotations",t)};l.prototype.removeAllAnnotations=function(){if(this._implementation){return this._implementation.removeAllAnnotations()}return this.removeAggregation("annotations")};l.prototype.removeAnnotation=function(t){if(this._implementation){return this._implementation.removeAnnotation(t)}return this.removeAggregation("annotations",t)};l.prototype.insertAnnotation=function(t,e){if(this._implementation){return this._implementation.insertAnnotation(t,e)}return this.insertAggregation("annotations",t,e)};l.prototype.getCurrentView=function(){if(this._implementation&&this._implementation.getCurrentView){return this._implementation.getCurrentView()}return null};l.prototype.pan=function(t,e){if(this._implementation&&this._implementation.pan){this._implementation.pan(t,e)}};l.prototype.rotate=function(t,e){if(this._implementation&&this._implementation.rotate){this._implementation.rotate(t,e)}};l.prototype.zoom=function(t){if(this._implementation&&this._implementation.zoom){this._implementation.zoom(t)}};l.prototype._setContent=function(t){p._setContent.apply(this,arguments);if(t instanceof HTMLImageElement||t instanceof HTMLObjectElement){this._setImage(t);return this}if(t?.getMetadata().getName()==="sap.ui.vk.pdf.Document"){this._setPDFContent(t);return this}var e=null;var i=null;if(t){e=t;if(!(e instanceof s)){e=null}i=t.camera;if(!(i instanceof a)){i=null}}this._setScene(e);if(i){this.setCamera(i)}return this};l.prototype._setImage=function(t){var e="sap.ui.vk.NativeViewport";if(!this._implementation||this._implementation.getMetadata().getName()!==e){this._destroyImplementation();var i=sap.ui.require(e.replaceAll(".","/"));this._implementation=new i({tools:this.getAssociation("tools"),content:this.getContent(),contentConnector:this.getAssociation("contentConnector")});this._implementation.setParent(this);this.invalidate()}return this};l.prototype._setPDFContent=function(t){const e="sap.ui.vk.pdf.Viewport";if(this._implementation?.getMetadata().getName()!==e){this._destroyImplementation();const t=sap.ui.require(e.replaceAll(".","/"));this._implementation=new t({viewStateManager:this.getViewStateManager(),tools:this.getAssociation("tools"),content:this.getContent(),outputSettings:this.getOutputSettings(),safeArea:this.getSafeArea(),showSafeArea:this.getShowSafeArea(),showAllHotspots:this.getShowAllHotspots(),showAllHotspotsTintColor:this.getShowAllHotspotsTintColor(),disableHotspotHovering:this.getDisableHotspotHovering(),hotspotColorABGR:this.getHotspotColorABGR(),keepOutputSize:this.getKeepOutputSize(),showDebugInfo:this.getShowDebugInfo(),width:this.getWidth(),height:this.getHeight(),backgroundColorTop:this.getBackgroundColorTop(),backgroundColorBottom:this.getBackgroundColorBottom(),selectionMode:this.getSelectionMode(),selectionDisplayMode:this.getSelectionDisplayMode(),showSelectionBoundingBoxes:this.getShowSelectionBoundingBoxes(),freezeCamera:this.getFreezeCamera(),renderMode:this.getRenderMode(),autoStartRendering:this.getAutoStartRendering()});this._implementation.setParent(this);this._implementation.setContentConnector(this.getAssociation("contentConnector"));this.invalidate()}return this};l.prototype._setScene=function(t){if(t instanceof s){var e=t.getMetadata().getName(),i=this._implementation&&this._implementation.getMetadata().getName(),o=e==="sap.ui.vk.dvl.Scene"&&i==="sap.ui.vk.dvl.Viewport"||e==="sap.ui.vk.threejs.Scene"&&i==="sap.ui.vk.threejs.Viewport"||e==="sap.ui.vk.svg.Scene"&&i==="sap.ui.vk.svg.Viewport";if(!o){this._destroyImplementation();var n;var a=this.getCamera();if(e==="sap.ui.vk.dvl.Scene"){n="sap.ui.vk.dvl.Viewport"}else if(e==="sap.ui.vk.threejs.Scene"){n="sap.ui.vk.threejs.Viewport"}else if(e==="sap.ui.vk.svg.Scene"){n="sap.ui.vk.svg.Viewport"}if(n){var r=sap.ui.require(n.replaceAll(".","/"));this._implementation=new r({viewStateManager:this.getViewStateManager(),tools:this.getAssociation("tools"),content:this.getContent(),outputSettings:this.getOutputSettings(),safeArea:this.getSafeArea(),showSafeArea:this.getShowSafeArea(),showAllHotspots:this.getShowAllHotspots(),showAllHotspotsTintColor:this.getShowAllHotspotsTintColor(),disableHotspotHovering:this.getDisableHotspotHovering(),hotspotColorABGR:this.getHotspotColorABGR(),keepOutputSize:this.getKeepOutputSize(),showDebugInfo:this.getShowDebugInfo(),width:this.getWidth(),height:this.getHeight(),backgroundColorTop:this.getBackgroundColorTop(),backgroundColorBottom:this.getBackgroundColorBottom(),selectionMode:this.getSelectionMode(),selectionDisplayMode:this.getSelectionDisplayMode(),showSelectionBoundingBoxes:this.getShowSelectionBoundingBoxes(),freezeCamera:this.getFreezeCamera(),renderMode:this.getRenderMode(),autoStartRendering:this.getAutoStartRendering()});this._implementation.setContentConnector(this.getContentConnector());var l=this.getAggregation("annotations");if(l){l.forEach(function(t){this.removeAggregation("annotations",t);this._implementation.addAnnotation(t)},this)}if(a){this._camera=null;this._implementation.setCamera(a)}this._implementation.setParent(this)}this.invalidate()}}else{this._destroyImplementation();this.invalidate()}return this};l.prototype.onSetViewStateManager=function(t){if(this._implementation){this._implementation.setViewStateManager(t)}};l.prototype.onUnsetViewStateManager=function(t){if(this._implementation){this._implementation.setViewStateManager(null)}};l.prototype.activateView=function(t,e,i){if(this._implementation){this._implementation.activateView(t,e,i);return this}else{r.error("no implementation");return this}};l.prototype.resetCurrentView=function(){if(this._implementation&&this._implementation.resetCurrentView){this._implementation.resetCurrentView();return this}else{r.error("no implementation");return this}};l.prototype.zoomTo=function(t,e,i,o){if(this._implementation){this._implementation.zoomTo(t,e,i,o)}else{r.error("zoomTo: no implementation")}return this};l.prototype.tap=function(t,e,i){if(this._implementation){this._implementation.tap(t,e,i)}return this};l.prototype.tapObject=function(t){if(this._implementation&&this._implementation.tapObject){this._implementation.tapObject(t)}return this};var m=function(t){t.camera={}};var h=function(t){if(typeof t.camera==="object"&&t.camera!==null){t.camera.matrices=false}};var u=function(t){if(typeof t.camera==="object"&&t.camera!==null){t.camera.useTransitionCamera=false}};var g=function(t){t.animation=true};var c=function(t){t.visibility=false};var f=function(t){if(typeof t.visibility==="object"&&t.visibility!==null){t.visibility.mode=o.Complete}};var _=function(t){t.selection=false};l.prototype.getViewInfo=function(t){if(!this._implementation){r.error("no implementation");return null}var e={};if(typeof t!=="object"||t===null){m(e);h(e);u(e);g(e);c(e);f(e);_(e)}else{if(typeof t.camera==="object"&&t.camera!==null){e.camera={};if(typeof t.camera.matrices==="boolean"){e.camera.matrices=t.camera.matrices}else if("matrices"in t.camera){e.camera.matrices=false}else{h(e)}if(typeof t.camera.useTransitionCamera==="boolean"){e.camera.useTransitionCamera=t.camera.useTransitionCamera}else if("useTransitionCamera"in t.camera){e.camera.useTransitionCamera=false}else{u(e)}}else if(typeof t.camera==="boolean"){if(t.camera===true){e.camera={};h(e);u(e)}else{e.camera=false}}else if("camera"in t){e.camera=false}else{m(e);h(e);u(e)}if(typeof t.animation==="boolean"){e.animation=t.animation}else if("animation"in t){e.animation=false}else{g(e)}if(typeof t.visibility==="object"&&t.visibility!==null){e.visibility={};if(t.visibility.mode===o.Complete||t.visibility.mode===o.Differences){e.visibility.mode=t.visibility.mode}else{f(e)}}else if(typeof t.visibility==="boolean"){if(t.visibility===true){e.visibility={};f(e)}else{e.visibility=false}}else if("visibility"in t){e.visibility=false}else{c(e);f(e)}if(typeof t.selection==="boolean"){e.selection=t.selection}else if("selection"in t){e.selection=false}else{_(e)}}return this._implementation.getViewInfo(e)};l.prototype.setViewInfo=function(t,e){if(this._implementation){this._implementation.setViewInfo(t,e)}else{r.error("no implementation")}return this};l.prototype.getImage=function(t,e,i,o,n){if(this._implementation&&this._implementation.getImage){return this._implementation.getImage(t,e,i,o,n)}return null};l.prototype.projectToScreen=function(t,e,i,o){if(this._implementation&&this._implementation.projectToScreen){return this._implementation.projectToScreen(t,e,i,o)}return p.projectToScreen(t,e,i,o)};l.prototype.normalizeRectangle=function(t,e,i,o){if(this._implementation&&this._implementation.normalizeRectangle){return this._implementation.normalizeRectangle(t,e,i,o)}return p.normalizeRectangle(t,e,i,o)};l.prototype.deNormalizeRectangle=function(t,e,i,o){if(this._implementation&&this._implementation.deNormalizeRectangle){return this._implementation.deNormalizeRectangle(t,e,i,o)}return p.deNormalizeRectangle(t,e,i,o)};l.prototype.getMeasurementSurface=function(){var t=this._implementation;return t==null?null:t.getMeasurementSurface()};return l});
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/ViewportBase", ["sap/ui/core/Control","./tools/Tool","./library","./Core","./SelectionMode","./SelectionDisplayMode","./RenderMode","./SafeArea","sap/ui/core/Element","sap/ui/core/StaticArea"],function(e,t,n,a,o,i,r,l,s,u){"use strict";var p=e.extend("sap.ui.vk.ViewportBase",{metadata:{library:"sap.ui.vk",abstract:true,properties:{showDebugInfo:{type:"boolean",defaultValue:false},backgroundColorTop:{type:"sap.ui.core.CSSColor",defaultValue:"rgba(50, 50, 50, 1)"},backgroundColorBottom:{type:"sap.ui.core.CSSColor",defaultValue:"rgba(255, 255, 255, 1)"},width:{type:"sap.ui.core.CSSSize",defaultValue:"100%"},height:{type:"sap.ui.core.CSSSize",defaultValue:"100%"},selectionMode:{type:"sap.ui.vk.SelectionMode",defaultValue:o.Sticky},selectionDisplayMode:{type:"sap.ui.vk.SelectionDisplayMode",defaultValue:i.Highlight},showSelectionBoundingBoxes:{type:"boolean",defaultValue:true},freezeCamera:{type:"boolean",defaultValue:false},renderMode:{type:"sap.ui.vk.RenderMode",defaultValue:r.Default},showSafeArea:{type:"boolean",defaultValue:false},showAllHotspots:{type:"boolean",defaultValue:false},showAllDynamicContents:{type:"boolean",defaultValue:false},disableHotspotHovering:{type:"boolean",defaultValue:false},hotspotColorABGR:{type:"int",defaultValue:1493172411},hotspotColor:{type:"sap.ui.core.CSSColor",defaultValue:"rgba(89, 0, 0, 0.73)"},hotspotCustomTextOutlineWidth:{type:"float",defaultValue:1},hotspotCustomTextOutlineColor:{type:"sap.ui.core.CSSColor",defaultValue:"white"},hotspotCustomTextHaloWidth:{type:"float",defaultValue:10},keepOutputSize:{type:"boolean",defaultValue:false},showAllHotspotsTintColor:{type:"sap.ui.core.CSSColor",defaultValue:"rgba(255, 255, 0, .35)"},autoStartRendering:{type:"boolean",defaultValue:true}},associations:{contentConnector:{type:"sap.ui.vk.ContentConnector",multiple:false},viewStateManager:{type:"sap.ui.vk.ViewStateManagerBase",multiple:false},tools:{type:"sap.ui.vk.tools.Tool",multiple:true}},aggregations:{content:{type:"sap.ui.core.Control",multiple:true},safeArea:{type:"sap.ui.vk.SafeArea",multiple:false},annotations:{type:"sap.ui.vk.Annotation",multiple:true},outputSettings:{type:"sap.ui.vk.OutputSettings",multiple:false}},events:{urlClicked:{parameters:{nodeRef:"any",url:"string"},enableEventBubbling:true},nodeClicked:{parameters:{nodeRef:"any",x:"int",y:"int"},enableEventBubbling:true},resize:{parameters:{size:"object"},enableEventBubbling:true},nodesPicked:{parameters:{picked:{type:"any[]"}},enableEventBubbling:true},nodeZoomed:{parameters:{zoomed:{type:"any"},isZoomIn:{type:"boolean"}},enableEventBubbling:true},viewActivated:{parameters:{viewIndex:"int",view:"sap.ui.vk.View",type:{type:"string"}},enableEventBubbling:true},procedureFinished:{enableEventBubbling:true},viewFinished:{parameters:{viewIndex:"int"},enableEventBubbling:true}}},renderer:null,constructor:function(t,n){e.apply(this,arguments);a.observeAssociations(this)}});var c=p.getMetadata().getParent().getClass().prototype;p.prototype.init=function(){if(c.init){c.init.call(this)}if(this.getSafeArea()==null){this.setSafeArea(new l)}this._camera=null;this._staticAreaParent=null;this._staticAreaNextSibling=null;this.attachBrowserEvent("fullscreenchange",this._handleFullscreenChange,this)};p.prototype.exit=function(){if(this._camera){var e=s.getElementById(this.getContentConnector());if(e){var t=e.getContentManager();if(t){t.destroyCamera(this._camera)}this._camera=null}}this._staticAreaParent=null;this._staticAreaNextSibling=null;this.detachBrowserEvent("fullscreenchange",this._handleFullscreenChange,this);if(c.exit){c.exit.call(this)}};p.prototype._handleFullscreenChange=function(e){if(e.target===this.getDomRef()){const t=u.getDomRef();if(t==null){return}const n=this.getDomRef();if(document.fullscreenElement===n){this._staticAreaParent=t.parentElement;this._staticAreaNextSibling=t.nextSibling;n.insertBefore(t,n.firstChild);e.stopImmediatePropagation()}else{this._staticAreaParent.insertBefore(t,this._staticAreaNextSibling);this._staticAreaParent=this._staticAreaNextSibling=null;if(document.fullscreenElement!=null){e.stopImmediatePropagation()}}}};p.prototype.onSetContentConnector=function(e){e.attachContentReplaced(this._onContentReplaced,this);this._setContent(e.getContent())};p.prototype.onUnsetContentConnector=function(e){e.detachContentReplaced(this._onContentReplaced,this);this._setContent(null);this.setCamera(null)};p.prototype._onContentReplaced=function(e){this._setContent(e.getParameter("newContent"))};p.prototype._setContent=function(e){if(e&&!this.getViewStateManager()){var t=s.getElementById(this.getContentConnector());if(t){var n=t.getDefaultViewStateManager();if(n){this.setViewStateManager(n)}}}return this};p.prototype.addTool=function(e){this.addAssociation("tools",e);e=e instanceof t?e:s.getElementById(e);e.setViewport(this)};p.prototype.getImage=function(e,t){return null};p.prototype.stickySelectionHandler=function(e){if(this._viewStateManager==null){return}if(e.length===0){const e=[];this._viewStateManager.enumerateSelection(function(t){e.push(t)});if(e.length>0){this._viewStateManager.setSelectionStates([],e)}}else{const t=[];const n=[];this._viewStateManager.getSelectionState(e).forEach(function(a,o){if(a){n.push(e[o])}else{t.push(e[o])}});this._viewStateManager.setSelectionStates(t,n)}};p.prototype.exclusiveSelectionHandler=function(e){if(this._viewStateManager==null){return}const t=this._viewStateManager.getSelectionState(e).some(e=>!e);var n=[];if(e.length===0||t){const t=new Set(e);this._viewStateManager.enumerateSelection(function(e){if(!t.has(e)){n.push(e)}})}this._viewStateManager.setSelectionStates(e,n)};p.prototype.setCamera=function(e){if(e!==this._camera){var t=s.getElementById(this.getContentConnector());if(this._camera&&t){var n=t.getContentManager();if(n){n.destroyCamera(this._camera)}}}this._camera=e;return this};p.prototype.getCamera=function(){return this._camera};p.prototype.activateView=function(e,t,n){return this};p.prototype.pan=function(e,t){return this};p.prototype.rotate=function(e,t){return this};p.prototype.zoom=function(e){return this};p.prototype.projectToScreen=function(e,t,n,a){return{x:0,y:0,depth:0}};p.prototype.normalizeRectangle=function(e,t,n,a){return{x:0,y:0,width:0,height:0}};p.prototype.deNormalizeRectangle=function(e,t,n,a){return{x:0,y:0,width:0,height:0}};p.prototype.renderTools=function(e){var t=this.getTools();for(var n=0,a=t.length;n<a;n++){var o=s.getElementById(t[n]);var i=o.getGizmoForContainer(this);if(i&&i.hasDomElement()){e.renderControl(i)}}};p.prototype.renderContent=function(e){var t=this.getContent();for(var n=0,a=t.length;n<a;n++){e.renderControl(t[n])}};p.prototype.getMeasurementSurface=function(){return null};return p});
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/ViewportHandler", ["sap/ui/base/EventProvider","sap/base/Log"],function(t,e){"use strict";var i=t.extend("sap.ui.vk.ViewportHandler",{metadata:{library:"sap.ui.vk",publicMethods:["beginGesture","move","endGesture","click","doubleClick","contextMenu","getViewport"]},constructor:function(t){this._viewport=t;this._rect=null;this._evt={x:0,y:0,z:0,d:0,tdx:0,tdy:0};this._gesture=false;this._viewport.attachEvent("resize",this,this._onresize);this._nomenu=false}});i.prototype.destroy=function(){this._viewport=null;this._rect=null;this._evt=null;this._gesture=false};i.prototype._getOffset=function(t){var e=t.getBoundingClientRect();var i={x:e.left+window.pageXOffset,y:e.top+window.pageYOffset};return i};i.prototype._inside=function(t){var e=this._viewport.getIdForLabel();var i=document.getElementById(e);if(i==null){return false}var s=this._getOffset(i);this._rect={x:s.x,y:s.y,w:i.offsetWidth,h:i.offsetHeight};return t.x>=this._rect.x&&t.x<=this._rect.x+this._rect.w&&t.y>=this._rect.y&&t.y<=this._rect.y+this._rect.h};i.prototype._onresize=function(t){this._gesture=false;this._rect=null};i.prototype.hover=function(t){if(this._viewport.hover&&this._inside(t)){this._viewport.queueCommand(function(){this._viewport.hover(t.x-this._rect.x,t.y-this._rect.y)}.bind(this));t.handled=true}};i.prototype.beginGesture=function(t){if(this._inside(t)&&!this._gesture){this._gesture=true;var i=t.x-this._rect.x,s=t.y-this._rect.y;this._evt.tdx=0;this._evt.tdy=0;this._evt.x=i;this._evt.y=s;this._evt.d=t.d;e.debug("Loco: beginGesture: "+i+", "+s);this._viewport.queueCommand(function(){this._viewport.beginGesture(i,s)}.bind(this));t.handled=true}this._nomenu=false};i.prototype.move=function(t){if(this._gesture){var i=t.x-this._rect.x,s=t.y-this._rect.y;const r=t.d;var o=i-this._evt.x;var n=s-this._evt.y;this._evt.tdx=this._evt.tdx+o;this._evt.tdy=this._evt.tdy+n;this._evt.x=i;this._evt.y=s;this._evt.d=r;this._evt.n=t.n;switch(t.n){case 1:e.debug("Loco: Rotate: "+o+", "+n);this._viewport.queueCommand(function(){this._viewport.rotate(o,n)}.bind(this));break;case 2:e.debug("Loco: Pan: "+o+", "+n);if(r!=0&&r!=1){e.debug("Loco: Zoom: "+r)}this._viewport.queueCommand(function(){if(this._evt.tdx!==0&&this._evt.tdy!==0){this._viewport.pan(o,n)}if(r!=0&&r!=1){this._viewport.zoom(r)}}.bind(this));break;default:break}this._nomenu=true;t.handled=true}};i.prototype.endGesture=function(t){if(this._gesture){var i=t.x-this._rect.x,s=t.y-this._rect.y;e.debug("Loco: endGesture: "+i+", "+s);this._viewport.queueCommand(function(){this._viewport.endGesture()}.bind(this));this._gesture=false;t.handled=true}};i.prototype.click=function(t){if(this._inside(t)&&t.buttons<=1){var i=t.x-this._rect.x,s=t.y-this._rect.y;e.debug("Loco: click: "+i+", "+s);this._viewport.queueCommand(function(){this._viewport.tap(i,s,false)}.bind(this));t.handled=true}};i.prototype.doubleClick=function(t){if(this._inside(t)&&t.buttons<=1){var i=t.x-this._rect.x,s=t.y-this._rect.y;e.debug("Loco: doubleClick: "+i+", "+s);this._viewport.queueCommand(function(){this._viewport.tap(i,s,true)}.bind(this));t.handled=true}};i.prototype.contextMenu=function(t){if(this._inside(t)||this._nomenu||t.buttons==5){this._nomenu=false;t.handled=true}};i.prototype.keyEventHandler=function(t){};i.prototype.getViewport=function(){return this._viewport};return i});
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/ViewportRenderer", [],function(){"use strict";var e={apiVersion:2};e.render=function(e,t){e.openStart("div",t);e.class("sapVizKitViewport");if(t._implementation){e.attr("tabindex",-1)}else{e.attr("tabindex",0);e.attr("aria-label","Image");e.attr("role","figure")}var i=t.getWidth();if(i){e.style("width",i)}var n=t.getHeight();if(n){e.style("height",n)}e.openEnd();if(t._implementation){e.renderControl(t._implementation)}else if(t.getContent()){var r=t.getContent();for(var a=0,o=r.length;a<o;a++){e.renderControl(r[a])}}e.close("div")};return e},true);
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/VisibilityMode", ["sap/ui/base/DataType"],function(e){"use strict";var i={Complete:"complete",Differences:"differences"};e.registerEnum("sap.ui.vk.VisibilityMode",i);return i},true);
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/ZoomTo", ["sap/ui/base/DataType"],function(e){"use strict";var i={All:"all",Visible:"visible",Selected:"selected",Node:"node",NodeSetIsolation:"node_setisolation",Restore:"restore",RestoreRemoveIsolation:"restore_removeisolation",ViewLeft:"view_left",ViewRight:"view_right",ViewTop:"view_top",ViewBottom:"view_bottom",ViewBack:"view_back",ViewFront:"view_front"};e.registerEnum("sap.ui.vk.ZoomTo",i);return i},true);
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/abgrToColor", [],function(){"use strict";var e=function(e){return{red:e&255,green:e>>>8&255,blue:e>>>16&255,alpha:(e>>>24&255)/255}};return e},true);
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/colorToABGR", [],function(){"use strict";var e=function(e){return(e.alpha*255<<24|e.blue<<16|e.green<<8|e.red)>>>0};return e},true);
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/colorToCSSColor", [],function(){"use strict";var e=function(e){return"rgba("+e.red+","+e.green+","+e.blue+","+e.alpha+")"};return e},true);
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/colorToHex", [],function(){"use strict";const t=function(t){return"#"+(t.red<<24|t.green<<16|t.blue<<8|t.alpha*255)>>>(0).toString(16).padStart(8,"0")};return t});
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/cssColorToColor", [],function(){"use strict";var e=function(){var e=false;var r=document.createElement("div");r.id="sap.ui.vk.colorConverter";r.style.setProperty("display","none","important");return function(t){if(!e){if(document.body){document.body.appendChild(r);e=true}else{return{red:0,green:0,blue:0,alpha:1}}}r.style.setProperty("color","rgba(0, 0, 0, 0)","important");r.style.setProperty("color",t,"important");var n=window.getComputedStyle(r).color;if(n==="transparent"){return{red:0,green:0,blue:0,alpha:0}}else{var a=n.split("(")[1].split(")")[0].split(",");return{red:parseInt(a[0],10),green:parseInt(a[1],10),blue:parseInt(a[2],10),alpha:a.length===4?parseFloat(a[3]):1}}}}();return e},true);
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/dvl/BaseNodeProxy", ["../BaseNodeProxy","./getJSONObject"],function(e,t){"use strict";var d=e.extend("sap.ui.vk.dvl.BaseNodeProxy",{metadata:{library:"sap.ui.vk"}});d.prototype.init=function(e,t){this._dvl=e?e.getGraphicsCore()._getDvl():null;this._dvlSceneRef=e?e.getSceneRef():null;this._dvlNodeRef=t};d.prototype.reset=function(){this._dvlNodeRef=null;this._dvlSceneRef=null;this._dvl=null};d.prototype.getNodeRef=function(){return this._dvlNodeRef};d.prototype.getNodeId=function(){return this._dvlNodeRef};d.prototype.getName=function(){return t(this._dvl.Scene.RetrieveNodeInfo(this._dvlSceneRef,this._dvlNodeRef,sap.ve.dvl.DVLNODEINFO.DVLNODEINFO_NAME)).NodeName};d.prototype.getNodeMetadata=function(){return t(this._dvl.Scene.RetrieveMetadata(this._dvlSceneRef,this._dvlNodeRef)).metadata};d.prototype.getHasChildren=function(){return(t(this._dvl.Scene.RetrieveNodeInfo(this._dvlSceneRef,this._dvlNodeRef,sap.ve.dvl.DVLNODEINFO.DVLNODEINFO_FLAGS)).Flags&(sap.ve.dvl.DVLNODEFLAG.DVLNODEFLAG_MAPPED_HASCHILDREN|sap.ve.dvl.DVLNODEFLAG.DVLNODEFLAG_CLOSED))===sap.ve.dvl.DVLNODEFLAG.DVLNODEFLAG_MAPPED_HASCHILDREN};d.prototype.getSceneRef=function(){return this._dvlNodeRef};return d});
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/dvl/ContentManager", ["../ContentManager","../getResourceBundle"],function(e,t){"use strict";var r=e.extend("sap.ui.vk.dvl.ContentManager",{metadata:{library:"sap.ui.vk"}});var n=r.getMetadata().getParent().getClass().prototype;r.prototype.init=function(){if(n.init){n.init.call(this)}this._handleDownloadingProgressProxy=this._handleDownloadingProgress.bind(this);this._graphicsCore=null;this._failedSources=[]};r.prototype.exit=function(){if(this._graphicsCore){this._graphicsCore.destroy();this._graphicsCore=null}if(n.exit){n.exit.call(this)}};var o={},i={antialias:true,alpha:true,premultipliedAlpha:true};r.getRuntimeSettings=function(){return o};r.setRuntimeSettings=function(e){o=e};r.getWebGLContextAttributes=function(){return i};r.setWebGLContextAttributes=function(e){i=Object.assign(i,e)};r.prototype._getGraphicsCore=function(){var e=this;return new Promise(function(t,r){if(e._graphicsCore){t(e._graphicsCore)}else{sap.ui.require(["sap/ui/vk/dvl/GraphicsCore"],function(r){r.create(o,i).then(function(r){e._graphicsCore=r;e._graphicsCore.attachSceneLoadingStarted(e._handleDvlSceneLoadingStarted,e);e._graphicsCore.attachSceneLoadingFinished(e._handleDvlSceneLoadingFinished,e);e._graphicsCore.attachSceneLoadingProgress(e._handleDvlSceneLoadingProgress,e);t(e._graphicsCore)})})}})};r.prototype._handleDownloadingProgress=function(e){var r=e.getParameter("source"),n=e.getParameter("loaded"),o=e.getParameter("total"),i=o?n/o*50:0;this.fireContentChangesProgress({phase:t().getText("PROGRESS_INDICATOR_DOWNLOADING"),source:r,percentage:i})};r.prototype._handleDvlSceneLoadingProgress=function(e){this.fireContentChangesProgress({phase:t().getText("PROGRESS_INDICATOR_RENDERING"),source:e.getParameter("source"),percentage:50+e.getParameter("percentage")*50})};r.prototype._handleDvlSceneLoadingStarted=function(e){};r.prototype._handleDvlSceneLoadingFinished=function(e){};r.prototype.loadContent=function(e,t){this.fireContentChangesStarted();var r=this;this._getGraphicsCore().then(function(n){n.setDecryptionHandler(r._decryptionHandler);n.setAuthorizationHandler(r._authorizationHandler);n.setRetryCount(r._retryCount);n.loadContentResourcesAsync(t,function(o){var i=[];if(o){o.forEach(function(e){i.push({error:e,errorMessage:"Failed to download source '"+(e.source instanceof File?e.source.name:e.source)+"'."})})}var a=e?e:undefined;n.updateSceneTreeAsync(a,t).then(function(e){var t={content:e.scene};if(e.failureReason){i=i.concat(e.failureReason)}if(i.length>0){t.failureReason=i}sap.ui.require(["sap/ui/vk/dvl/Viewport","sap/ui/vk/dvl/ViewStateManager"],function(){r.fireContentChangesFinished(t)})}).catch(function(e){if(typeof e==="string"){i.push({error:e,errorMessage:e})}else{i.push({error:e,errorMessage:e.message?e.message:e.errorMessage})}r.fireContentChangesFinished({content:null,failureReason:i})})},r._handleDownloadingProgressProxy)},function(e){r.fireContentChangesFinished({content:null,failureReason:{error:e,errorMessage:"Failed to create DVL graphics core object."}})});return this};r.prototype.destroyContent=function(e){if(e){this._graphicsCore.destroyScene(e)}return this};r.prototype.collectGarbage=function(){this._graphicsCore.collectGarbage();return this};return r});
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/dvl/GraphicsCore", ["jquery.sap.script","sap/ui/base/EventProvider","../thirdparty/html2canvas","../ve/dvl","./Scene","../ContentResource","../DownloadManager","./ViewStateManager","../DvlException","../Messages","sap/ui/thirdparty/URI","./GraphicsCoreApi","./checkResult","./getPointer","./getJSONObject","../getResourceBundle","../utf8ArrayBufferToString","sap/base/assert","sap/base/util/uid","sap/base/Log","sap/ui/core/Core"],function(jQuery,e,t,r,n,o,s,i,a,c,u,d,l,h,v,f,p,_,g,y,S){"use strict";function m(e){return e instanceof File?"local":"remote"}function w(e){return e instanceof File?e.name:e}var C=function(e){Object.defineProperties(this,{source:{value:e,writable:false,enumerable:true},_refCount:{value:0,writable:true,enumerable:false}})};C.prototype.isInUse=function(){return this._refCount>0};C.prototype.addRef=function(){++this._refCount;return this};C.prototype.release=function(){--this._refCount;_(this._refCount>=0,"Too many calls to SourceDatum.release().");return this};C.prototype.destroy=function(){};var D=function(e,t,r){C.call(this,e);Object.defineProperties(this,{content:{value:r,writable:false,enumerable:true},vdsSourceDatum:{value:t,writable:false,enumerable:true}})};D.prototype=Object.create(C.prototype);D.prototype.constructor=D;D.prototype.destroy=function(){_(this.vdsSourceDatum,"VDSL source without VDS reference");if(this.vdsSourceDatum){this.vdsSourceDatum.release()}C.prototype.destroy.call(this)};var R=function(e,t,r){Object.defineProperties(this,{dvlSceneId:{value:e,writable:false,enumerable:true},sourceDatum:{value:t,writable:false,enumerable:true},root:{value:!!r,writable:false,enumerable:true},_refCount:{value:0,writable:true,enumerable:false}})};R.prototype.isInUse=function(){return this._refCount>0};R.prototype.addRef=function(){++this._refCount;return this};R.prototype.release=function(){--this._refCount;_(this._refCount>=0,"Too many calls to DvlSceneDatum.release().");return this};R.prototype.destroy=function(){if(this.sourceDatum){this.sourceDatum.release()}};var L=function(e,t){Object.defineProperties(this,{source:{value:e.getSource()},sourceType:{value:e.getSourceType()},sourceId:{value:e.getSourceId(),writable:true},name:{value:e.getName()},localMatrix:{value:e.getLocalMatrix(),writable:true},password:{value:e.getPassword()},children:{value:e.getContentResources().map(function(e){return new L(e)})},dvlSceneDatum:{value:null,writable:true},nodeProxy:{value:null,writable:true},fake:{value:!!t},sourceProperties:{value:null,writable:true}});e._shadowContentResource=this};L.prototype.destroy=function(){if(this.dvlSceneDatum){this.dvlSceneDatum.release()}};var I=function(e,t){Object.defineProperties(this,{vkScene:{value:e},shadowContentResource:{value:t}})};var P=e.extend("sap.ui.vk.dvl.GraphicsCore",{metadata:{library:"sap.ui.vk",publicMethods:["attachSceneLoadingFinished","attachSceneLoadingProgress","attachSceneLoadingStarted","buildSceneTree","buildSceneTreeAsync","createViewStateManager","destroyScene","destroyViewStateManager","detachSceneLoadingFinished","detachSceneLoadingProgress","detachSceneLoadingStarted","getApi","loadContentResourcesAsync","showDebugInfo","updateSceneTree","updateSceneTreeAsync"]},constructor:function(t,r){e.apply(this);var n=jQuery.extend({},t,{filePackagePrefixURL:sap.ui.require.toUrl("sap/ui/vk/ve")+"/"});this._dvlClientId=g();var o=this;this._initialized=new Promise(function(e){o._initResolve=e});sap.ve.dvl.createRuntime(n).then(function(e){o._dvl=e;o._dvl.CreateCoreInstance(o._dvlClientId);l(o._dvl.Core.Init(o._DVLMajorVersion,o._DVLMinorVersion));var t=S;t.attachLocalizationChanged(o._onlocalizationChanged,o);l(o._dvl.Core.SetLocale(t.getConfiguration().getLanguageTag()));o._canvas=o._createRenderingCanvasAndContext(r);o._rendererId=h(o._dvl.Core.CreateRenderer());o._dvl.Renderer.SetOptionF(sap.ve.dvl.DVLRENDEROPTIONF.DVLRENDEROPTIONF_DPI,96*window.devicePixelRatio,o._rendererId);o._initResolve()});this._sourceData=[];this._dvlSceneData=[];this._vkSceneData=[];this._viewports=[];this._renderLoopRequestId=null;this._renderLoop=this._renderLoop.bind(this);this._viewStateManagers=[];this._authorizationHandler=null;this._retryCount=1},_DVLMajorVersion:7,_DVLMinorVersion:6});P.create=function(e,t){return new Promise(function(r,n){try{var o=new P(e,t);o._initialized.then(function(){r(o)})}catch(e){n(e)}})};P.prototype.destroy=function(){S.detachLocalizationChanged(this._onlocalizationChanged,this);var t=this._viewports.slice();t.reverse();t.forEach(function(e){e.control.setGraphicsCore(null)});this._viewports=null;this._cleanupVkSceneData();this._vkSceneData=null;this._cleanupDvlSceneData();_(this._dvlSceneData.length===0,"Not all DVL scenes are destroyed when sap.ui.vk.dvl.Scene objects are destroyed.");this._dvlSceneData=null;this._cleanupSourceData();_(this._sourceData.length===0,"Not all sources are deleted.");this._sourceData=null;this._viewStateManagers.slice().forEach(this.destroyViewStateManager.bind(this));this._viewStateManagers=null;this._webGLContext=null;this._canvas=null;this._dvl.Core.DeleteRenderer(this._rendererId);this._rendererId=null;this._dvl.Core.Release();this._dvl=null;e.prototype.destroy.apply(this)};P.prototype._createRenderingCanvasAndContext=function(e){var t=document.createElement("canvas");t.id=g();this._webGLContext=this._dvl.Core.CreateWebGLContext(t,e);return t};P.prototype._getCanvas=function(){return this._canvas};P.prototype._getWebGLContext=function(){return this._webGLContext};P.prototype._getDvl=function(){return this._dvl};P.prototype._getDvlClientId=function(){return this._dvlClientId};P.prototype._findSourceData=function(e){var t=Object.getOwnPropertyNames(e);return this._sourceData.filter(function(r){return t.every(function(t){return e[t]===r[t]})})};P.prototype._destroySourceDatum=function(e){if(!(e instanceof D)){this._dvl.Core.DeleteFileByUrl(w(e.source),m(e.source))}e.destroy();return this};P.prototype._cleanupSourceData=function(){var e=false;for(var t=this._sourceData.length-1;t>=0;--t){var r=this._sourceData[t];if(!r.isInUse()){var n=r instanceof D?r.vdsSourceDatum:null;this._sourceData.splice(t,1);this._destroySourceDatum(r);if(n&&!n.isInUse()){e=true}}}if(e){this._cleanupSourceData()}return this};P.prototype._findDvlSceneData=function(e){var t=Object.getOwnPropertyNames(e);return this._dvlSceneData.filter(function(r){return t.every(function(t){return e[t]===r[t]})})};P.prototype._destroyDvlSceneDatum=function(e){this._dvl.Scene.Release(e.dvlSceneId);e.destroy();return this};P.prototype._cleanupDvlSceneData=function(){for(var e=this._dvlSceneData.length-1;e>=0;--e){var t=this._dvlSceneData[e];if(!t.isInUse()){this._dvlSceneData.splice(e,1);this._destroyDvlSceneDatum(t)}}};P.prototype._findVkSceneData=function(e){var t=Object.getOwnPropertyNames(e);return this._vkSceneData.filter(function(r){return t.every(function(t){return e[t]===r[t]})})};P.prototype._cleanupVkSceneData=function(){for(var e=this._vkSceneData.length-1;e>=0;--e){this.destroyScene(this._vkSceneData[e].vkScene)}};P.prototype._destroyShadowContentResource=function(e,t){if(t.children){t.children.forEach(this._destroyShadowContentResource.bind(this,e))}if(t.nodeProxy){var r=e.getDefaultNodeHierarchy();try{r.removeNode(t.nodeProxy.getNodeRef())}catch(e){var n="Failed to delete node with ID = "+t.nodeProxy.getNodeRef()+".";if(e instanceof a){n+=" Error code: "+e.code+". Message: "+e.message+"."}y.error(n)}r.destroyNodeProxy(t.nodeProxy)}t.destroy()};P.prototype._filterContentResources=function(e,t){var r=[];e.forEach(function e(n){if(t(n)){r.push(n)}n.getContentResources().forEach(e)});return r};P.prototype._getContentResourcesWithMissingPasswords=function(e){var t=this._dvl.Library;return this._filterContentResources(e,function(e){var r=e.getSource();try{return r&&v(t.RetrieveInfo(w(r),m(r))).flags&sap.ve.dvl.DVLFILEFLAG.ENCRYPTED&&!e.getPassword()}catch(e){y.warning("Failed to get information from Emscripten virtual file system about file '"+w(r)+"'");return false}})};P.prototype._getContentResourcesWithEncryptedVds3=function(e){var t=this._dvl.Library;return this._filterContentResources(e,function(e){var r=e.getSource();if(r){try{var n=v(t.RetrieveInfo(w(r),m(r)));return n.major<=3&&n.flags&sap.ve.dvl.DVLFILEFLAG.ENCRYPTED}catch(e){y.warning("Failed to get information from Emscripten virtual file system about file '"+w(r)+"'");return false}}else{return false}})};P.prototype._collectAndCheckSourceProperties=function(e){var t=e.dvlSceneDatum.sourceDatum;if(!t){return this}try{if(t instanceof D){t=t.vdsSourceDatum}var r=v(this._dvl.Library.RetrieveInfo(w(t.source),m(t.source)));e.sourceProperties={version:{major:r.major,minor:r.minor}};if(r.flags&(sap.ve.dvl.DVLFILEFLAG.PAGESCOMPRESSED|sap.ve.dvl.DVLFILEFLAG.WHOLEFILECOMPRESSED)){e.sourceProperties.compressed=true}if(r.flags&sap.ve.dvl.DVLFILEFLAG.ENCRYPTED){e.sourceProperties.encrypted=true}}catch(t){y.warning("Failed to get information from Emscripten virtual file system about file '"+w(e.source)+"'")}return this};P.prototype.loadContentResourcesAsync=function(e,t,r){var n=this,o=[],i=new Map;e.forEach(function e(t){var r=t.getSource();if(r&&o.indexOf(r)<0&&n._findSourceData({source:r}).length===0){o.push(r);var s=t.getSource();var a;if(s instanceof Object){a=s.name}else{a=s}if(t.getSourceType()==="vdsl"||t.getSourceType()==="vds"&&a.split(".").pop()==="vdsl"){i.set(r,{})}}t.getContentResources().forEach(e)});var a=[];if(o.length>0){var d;var l=new s(o,null,this._authorizationHandler,this._retryCount).attachItemSucceeded(function(e){var t=e.getParameter("source");var r=e.getParameter("response");if(i.has(t)){var n=p(r);if(n.trim().length===0){d=d||[];d.push({source:t,status:c.VIT22.code,statusText:f().getText(c.VIT22.summary)});y.error(f().getText(c.VIT22.summary),c.VIT22.code,"sap.ui.vk.dvl.GraphicsCore");return}else{var s=n.split(/\n|\r\n/);var h=s[0].match(/^file=(.+)$/);if(!h){d=d||[];d.push({source:t,status:c.VIT23.code,statusText:f().getText(c.VIT23.summary)});y.error(f().getText(c.VIT23.summary),c.VIT23.code,"sap.ui.vk.dvl.GraphicsCore");return}else{var v=i.get(t);v.content=s;var _=h[1];var g=_;var S=new u(g);if(S.is("relative")){if(t instanceof File){d=d||[];d.push({source:t,status:c.VIT24.code,statusText:f().getText(c.VIT24.summary)});y.error(f().getText(c.VIT24.summary),c.VIT24.code,"sap.ui.vk.dvl.GraphicsCore");return}else{var w=new u(t);_=S.absoluteTo(w).href()}}v.referencedSource=_;v.content[0]=v.content[0].replace(g,this._dvl.Core.GetFilename(v.referencedSource,"remote"));if(o.indexOf(v.referencedSource)<0&&this._findSourceData({source:v.referencedSource}).length===0){o.push(v.referencedSource);l.queue(v.referencedSource)}}}}else{var D=t instanceof File;var R=D?t.name:t;var L=m(t);this._dvl.Core.CreateFileFromArrayBuffer(r,R,L);a.push(new C(t))}},this).attachAllItemsCompleted(function(e){for(var r=0;r<a.length;r++){this._sourceData.push(a[r])}i.forEach(function(e,t){var r=this._findSourceData({source:e.referencedSource})[0];if(r){var n=new D(t,r,e.content.join("\n"));this._sourceData.push(n);r.addRef()}}.bind(this));if(t){t(d)}},this).attachItemFailed(function(e){d=d||[];d.push({source:e.getParameter("source"),status:e.getParameter("status"),statusText:e.getParameter("statusText")})},this);if(r){l.attachItemProgress(r,this)}l.start()}else if(t){t()}return this};P.prototype._buildPlaceholders=function(e,t,r,n){var o=[];n.forEach(function t(r,n,s){var i=e.createNode(r,s.name,n);s.nodeProxy=e.createNodeProxy(i);if(s.localMatrix){s.nodeProxy.setLocalMatrix(s.localMatrix)}if(s.source){o.push(s)}s.children.forEach(t.bind(this,i,null))}.bind(this,t,r));return o};P.prototype._updatePlaceholders=function(e,t,r){var n=this,o=e.getDefaultNodeHierarchy(),s=[];(function t(r,i,a){function c(e,t){if(!e&&!t){return true}else if(!!e^!!t){return false}else{return e.source===t.getSource()&&e.sourceType===t.getSourceType()&&e.name===t.getName()&&e.password===t.getPassword()}}function u(e,t){t._shadowContentResource=e;e.sourceId=t.getSourceId();e.localMatrix=t.getLocalMatrix();if(e.nodeProxy){e.nodeProxy.setLocalMatrix(e.localMatrix)}}var d=0;var l=jQuery.sap.arrayDiff(r,i,c,true);l.forEach(function(c){for(;d<c.index;++d){t(r[d].children,i[d].getContentResources(),r[d].nodeProxy.getNodeRef());u(r[d],i[d])}if(c.type==="delete"){n._destroyShadowContentResource(e,r[c.index]);r.splice(c.index,1)}else if(c.type==="insert"){var l;if(d<r.length&&r[d].nodeProxy){l=r[d].nodeProxy.getNodeRef()}var h=new L(i[c.index]);s=s.concat(n._buildPlaceholders(o,a,l,[h]));r.splice(c.index,0,h);++d}});for(;d<r.length;++d){t(r[d].children,i[d].getContentResources(),r[d].nodeProxy&&r[d].nodeProxy.getNodeRef());u(r[d],i[d])}})(t.fake?t.children:[t],r,null);return s};P.prototype._loadAndMergeContentResource=function(e,t){if(t.source){var r=this._findSourceData({source:t.source})[0];if(!r){y.warning("Failed to load content resource with sourceId '"+t.sourceId+"' due to failed downloading from URL '"+w(t.source)+"'.")}else{var n=t.nodeProxy.getNodeRef();var o=this._findDvlSceneData({sourceDatum:r,root:false})[0];if(!o){try{o=new R(h(r instanceof D?this._dvl.Core.LoadSceneFromVDSL(r.content,t.password):this._dvl.Core.LoadSceneByUrl(w(t.source),t.password,m(t.source))),r,false)}catch(e){y.error(f().getText(c.VIT34.summary)+": "+w(t.source),c.VIT34.code,"sap.ui.vk.dvl.GraphicsCore");return}this._dvlSceneData.push(o);r.addRef()}t.dvlSceneDatum=o;o.addRef();this._collectAndCheckSourceProperties(t);this._dvl.Renderer.ResetView(sap.ve.dvl.DVLRESETVIEWFLAG.CAMERA,this._rendererId);this._dvl.Scene.Merge(e._dvlSceneRef,o.dvlSceneId,n)}}};P.prototype.buildSceneTree=function(e){if(e.length===0){return null}var t;var r;var s=e.map(function(e){return new L(e)});if(s.length===1&&s[0].name==null){r=s[0];if(r.source){var i=this._findSourceData({source:r.source})[0];try{t=new R(h(i instanceof D?this._dvl.Core.LoadSceneFromVDSL(i.content,r.password):this._dvl.Core.LoadSceneByUrl(w(r.source),r.password,m(r.source))),i,true)}catch(e){y.error(f().getText(c.VIT34.summary)+": "+w(r.source),c.VIT34.code,"sap.ui.vk.dvl.GraphicsCore");return null}i.addRef()}else{t=new R(this._dvl.Core.CreateEmptyScene(),null,true)}}else{var a=new o({sourceType:"vds",sourceId:g()});r=new L(a,true);a.destroy();a=null;Array.prototype.push.apply(r.children,s);s=[r];t=new R(this._dvl.Core.CreateEmptyScene(),null,true)}this._dvlSceneData.push(t);r.dvlSceneDatum=t;t.addRef();this._collectAndCheckSourceProperties(r);var u=new n(this,t.dvlSceneId);this._vkSceneData.push(new I(u,r));this._buildPlaceholders(u.getDefaultNodeHierarchy(),null,null,r.children).forEach(this._loadAndMergeContentResource.bind(this,u.getDefaultNodeHierarchy()));return u};P.prototype.updateSceneTree=function(e,t,r){if(t.length===0){return null}var n;var o=this._getContentResourcesWithEncryptedVds3(t);if(o.length>0){y.error(f().getText(c.VIT25.summary),c.VIT25.code,"sap.ui.vk.dvl.GraphicsCore");n=n||{};n.contentResourcesWithEncryptedVds3=o}var s=this._getContentResourcesWithMissingPasswords(t);if(s.length>0){y.error(f().getText(c.VIT21.summary),c.VIT21.code,"sap.ui.vk.dvl.GraphicsCore");n=n||{};n.contentResourcesWithMissingPasswords=s}if(n&&r){r(n)}if(!e){return this.buildSceneTree(t)}var i=this._findVkSceneData({vkScene:e})[0].shadowContentResource;var a=!!i.source;var u=t.length===1&&!!t[0].getSource();if(!(a&&u&&i.source===t[0].getSource()||!a&&!u&&i.fake===t.length>1)||!i.fake&&t.length===1&&i.name!==t[0].getName()){return this.buildSceneTree(t)}this._updatePlaceholders(e,i,t).forEach(this._loadAndMergeContentResource.bind(this,e.getDefaultNodeHierarchy()));e.getDefaultNodeHierarchy().fireChanged();return e};P.prototype._loadDvlSceneAsync=function(e,t){return new Promise(function(r,n){var o;var s=function(t){o();this.fireSceneLoadingFinished({source:e.source,sceneId:t.sceneId});r(t.sceneId)};var i=function(t){o();var r=t.errorMessage;if(r==null){r=sap.ve.dvl.DVLRESULT.getDescription?sap.ve.dvl.DVLRESULT.getDescription(t.errorCode):""}var s={source:e.source,errorCode:t.errorCode,errorMessage:r};this.fireSceneLoadingFinished(s);n(s)};var c=function(t,r){this.fireSceneLoadingProgress({source:w(e.source),percentage:r});return true}.bind(this);o=function(){this._dvl.Client.NotifyFileLoadProgress=null;this._dvl.Client.detachSceneFailed(i,this);this._dvl.Client.detachSceneLoaded(s,this)}.bind(this);this._dvl.Client.attachSceneLoaded(s,this);this._dvl.Client.attachSceneFailed(i,this);this._dvl.Client.NotifyFileLoadProgress=c;this.fireSceneLoadingStarted({source:w(e.source)});try{l(e instanceof D?this._dvl.Core.LoadSceneFromVDSLAsync(e.content,t):this._dvl.Core.LoadSceneByUrlAsync(w(e.source),t,m(e.source)))}catch(e){o();i.call(this,{errorCode:e instanceof a?e.code:sap.ve.dvl.DVLRESULT.FAIL,errorMessage:e instanceof a?null:e})}}.bind(this))};var b=function(e,t){return new Promise(function(r){(function n(o){if(o>=e.length){r()}else{t(e[o]).catch(function(){}).then(function(){n(o+1)})}})(0)})};P.prototype._loadAndMergeContentResourcesAsync=function(e,t){var r,n=this;return b(t,function(t){if(t.source){var o=n._findSourceData({source:t.source})[0];if(!o){var s="Failed to load content resource with sourceId '"+t.sourceId+"' due to failed downloading from URL '"+w(t.source)+"'.";y.warning(s);r=r||[];r.push({errorMessage:s,source:t.source});return Promise.reject()}return function(){var e=n._findDvlSceneData({sourceDatum:o,root:false})[0];if(e){return Promise.resolve(e)}else{return n._loadDvlSceneAsync(o,t.password).then(function(t){e=new R(t,o,false);n._dvlSceneData.push(e);o.addRef();return Promise.resolve(e)},function(e){r=r||[];r.push(e);return Promise.reject()})}}().then(function(r){t.dvlSceneDatum=r;r.addRef();n._collectAndCheckSourceProperties(t);var o=t.nodeProxy.getNodeRef();n._dvl.Renderer.ResetView(sap.ve.dvl.DVLRESETVIEWFLAG.CAMERA,n._rendererId);n._dvl.Scene.Merge(e._dvlSceneRef,r.dvlSceneId,o);return Promise.resolve()})}return Promise.resolve()}).then(function(){return Promise.resolve(r)})};P.prototype.buildSceneTreeAsync=function(e){if(e.length===0){return Promise.resolve(null)}var t=e.map(function(e){return new L(e)});return function(){var e;if(t.length===1&&t[0].name==null){e=t[0];if(e.source){var r=this._findSourceData({source:e.source})[0];if(r){return this._loadDvlSceneAsync(r,e.password).then(function(t){var n=new R(t,r,true);r.addRef();return Promise.resolve({shadowContentResource:e,dvlSceneDatum:n})})}else{return Promise.reject({errorMessage:"Failed to download the root content resource.",source:e.source})}}return Promise.resolve({shadowContentResource:e,dvlSceneDatum:new R(this._dvl.Core.CreateEmptyScene(),null,true)})}else{var n=new o({sourceType:"vds",sourceId:g()});e=new L(n,true);n.destroy();n=null;Array.prototype.push.apply(e.children,t);t=[e];return Promise.resolve({shadowContentResource:e,dvlSceneDatum:new R(this._dvl.Core.CreateEmptyScene(),null,true)})}}.call(this).then(function(e){this._dvlSceneData.push(e.dvlSceneDatum);e.shadowContentResource.dvlSceneDatum=e.dvlSceneDatum;e.dvlSceneDatum.addRef();this._collectAndCheckSourceProperties(e.shadowContentResource);var t=new n(this,e.dvlSceneDatum.dvlSceneId);this._vkSceneData.push(new I(t,e.shadowContentResource));var r=t.getDefaultNodeHierarchy();return this._loadAndMergeContentResourcesAsync(r,this._buildPlaceholders(t.getDefaultNodeHierarchy(),null,null,e.shadowContentResource.children)).then(function(e){return Promise.resolve({scene:t,failureReason:e})})}.bind(this))};P.prototype.updateSceneTreeAsync=function(e,t){if(t.length===0){return Promise.resolve(null)}var r=this._getContentResourcesWithEncryptedVds3(t);if(r.length>0){y.error(f().getText(c.VIT25.summary),c.VIT25.code,"sap.ui.vk.dvl.GraphicsCore")}var n=this._getContentResourcesWithMissingPasswords(t);if(n.length>0){y.error(f().getText(c.VIT21.summary),c.VIT21.code,"sap.ui.vk.dvl.GraphicsCore")}if(!e){return this.buildSceneTreeAsync(t)}var o=this._findVkSceneData({vkScene:e})[0].shadowContentResource;var s=!!o.source;var i=t.length===1&&!!t[0].getSource();if(!(s&&i&&o.source===t[0].getSource()||!s&&!i&&o.fake===t.length>1)||!o.fake&&t.length===1&&o.name!==t[0].getName()){return this.buildSceneTreeAsync(t)}return new Promise(function(r,n){var s=e.getDefaultNodeHierarchy();this._loadAndMergeContentResourcesAsync(s,this._updatePlaceholders(e,o,t)).then(function(t){r({scene:e,failureReason:t});s.fireChanged()})}.bind(this))};P.prototype.destroyScene=function(e){var t;for(t=0;t<this._vkSceneData.length;++t){if(this._vkSceneData[t].vkScene===e){break}}if(t===this._vkSceneData.length){y.warning("Scene with id '"+e.getId()+"' is not created by this GraphicsCore.");return this}var r=this._vkSceneData.splice(t,1)[0];this._destroyShadowContentResource(e,r.shadowContentResource);e.destroy();return this};var T=function(e,t,r){_(Array.isArray(e),"The first parameter must be an array.");_(typeof t==="function","The second parameter must be a function.");for(var n=0,o=e.length;n<o;++n){if(t.call(r,e[n],n,e)){return n}}return-1};var V=function(e,t){return T(e,function(e){return e.control===t})};var E=function(e,t){return T(e,function(e){return e.rendererId===t})};P.prototype._registerViewport=function(e){_(e,"The viewportControl parameter must not be null.");if(V(this._viewports,e)>=0){return false}var t={control:e,canvas:null,rendererId:null};if(this._viewports.length===0){t.canvas=this._canvas;t.rendererId=this._rendererId;this._startRenderLoop()}else{if(this._viewports.length===1){var r=this._viewports[0];r.control._setCanvas(r.canvas=document.createElement("canvas"));this._dvl.Client.attachFrameFinished(this._handleFrameFinished,this)}t.canvas=document.createElement("canvas");t.rendererId=this._dvl.Core.CreateRenderer()}e._setCanvas(t.canvas);e._setRenderer(t.rendererId);e.attachResize(this._handleViewportResize,this);this._viewports.push(t);return true};P.prototype._deregisterViewport=function(e){_(e,"The viewportControl parameter must not be null.");var t=V(this._viewports,e);if(t<0){return false}_(t>0||this._viewports.length===1,"The first registered viewport control must be deregistered last.");var r=this._viewports.splice(t,1)[0];if(this._viewports.length===0){this._stopRenderLoop()}else{if(this._viewports.length===1){this._dvl.Client.detachFrameFinished(this._handleFrameFinished,this);var n=this._viewports[1-t];n.control._setCanvas(n.canvas=this._canvas)}this._dvl.Core.DeleteRenderer(r.rendererId)}e.detachResize(this._handleViewportResize,this);e._setRenderer(null);e._setCanvas(null);return true};P.prototype._getViewportCount=function(){return this._viewports.length};P.prototype._handleViewportResize=function(e){if(this._viewports.length>1){this._canvas.width=Math.max.apply(null,this._viewports.map(function(e){return e.canvas.width}));this._canvas.height=Math.max.apply(null,this._viewports.map(function(e){return e.canvas.height}))}};P.prototype._startRenderLoop=function(){if(!this._renderLoopRequestId){this._renderLoopRequestId=window.requestAnimationFrame(this._renderLoop)}return this};P.prototype._stopRenderLoop=function(){if(this._renderLoopRequestId){window.cancelAnimationFrame(this._renderLoopRequestId);this._renderLoopRequestId=null}return this};P.prototype._renderLoop=function(){var e;return function(){var t=this._viewports.length>1;this._viewports.forEach(function(r){var n=r.canvas,o=r.rendererId;this._dvl.Renderer._processCommandQueue(o);if(n.width>0&&n.height>0&&this._dvl.Renderer.ShouldRenderFrame(o)){if(t&&e!==o){this._dvl.Renderer.SetDimensions(n.width,n.height,o)}r.control.renderFrame();e=o}},this);this._renderLoopRequestId=window.requestAnimationFrame(this._renderLoop)}}();P.prototype._handleFrameFinished=function(e){_(this._viewports.length>1,"Method _handleFrameFinished should be only called when there are multiple viewports.");if(this._viewports.length>1){var t=E(this._viewports,e.rendererId);if(t>=0){var r=this._viewports[t].canvas,n=r.getContext("2d"),o=r.width,s=r.height;n.drawImage(this._canvas,0,this._canvas.height-s,o,s,0,0,o,s)}}};P.prototype.createViewStateManager=function(e,t){var r=new i;r._setNodeHierarchy(e).setShouldTrackVisibilityChanges(t);this._viewStateManagers.push(r);return r};P.prototype.destroyViewStateManager=function(e){var t=this._viewStateManagers.indexOf(e);if(t>=0){this._viewStateManagers.splice(t,1)[0].destroy()}return this};P.prototype.showDebugInfo=function(e){this._viewports.forEach(function(t){t.control.setShowDebugInfo(e)});return this};P.prototype.getApi=function(e){switch(e){case d.LegacyDvl:return this._dvl;default:return null}};P.prototype.collectGarbage=function(){this._cleanupDvlSceneData();this._cleanupSourceData();return this};P.prototype._onlocalizationChanged=function(e){if(e.getParameter("changes").language){l(this._dvl.Core.SetLocale(S.getConfiguration().getLanguageTag()))}};P.prototype.getDecryptionHandler=function(){return this._dvl.Client.getDecryptionHandler()};P.prototype.setDecryptionHandler=function(e){this._dvl.Client.setDecryptionHandler(e);return this};P.prototype.setAuthorizationHandler=function(e){this._authorizationHandler=e;return this};P.prototype.setRetryCount=function(e){this._retryCount=Math.max(e,0);return this};P.prototype.attachSceneLoadingFinished=function(e,t,r){return this.attachEvent("sceneLoadingFinished",e,t,r)};P.prototype.detachSceneLoadingFinished=function(e,t){return this.detachEvent("sceneLoadingFinished",e,t)};P.prototype.fireSceneLoadingFinished=function(e,t,r){return this.fireEvent("sceneLoadingFinished",e,t,r)};P.prototype.attachSceneLoadingProgress=function(e,t,r){return this.attachEvent("sceneLoadingProgress",e,t,r)};P.prototype.detachSceneLoadingProgress=function(e,t){return this.detachEvent("sceneLoadingProgress",e,t)};P.prototype.fireSceneLoadingProgress=function(e,t,r){return this.fireEvent("sceneLoadingProgress",e,t,r)};P.prototype.attachSceneLoadingStarted=function(e,t,r){return this.attachEvent("sceneLoadingStarted",e,t,r)};P.prototype.detachSceneLoadingStarted=function(e,t){return this.detachEvent("sceneLoadingStarted",e,t)};P.prototype.fireSceneLoadingStarted=function(e,t,r){return this.fireEvent("sceneLoadingStarted",e,t,r)};return P});
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/dvl/GraphicsCoreApi", ["sap/ui/base/DataType"],function(e){"use strict";var a={LegacyDvl:"LegacyDvl"};e.registerEnum("sap.ui.vk.dvl.GraphicsCoreApi",a);return a},true);
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/dvl/LayerProxy", ["../LayerProxy","./getJSONObject"],function(e,t){"use strict";var r=e.extend("sap.ui.vk.dvl.LayerProxy",{metadata:{library:"sap.ui.vk",publicMethods:["getDescription","getLayerId","getLayerMetadata","getName","getNodes","getVeIds"]},constructor:function(t,r){e.call(this);this._dvl=t?t.getGraphicsCore()._getDvl():null;this._dvlSceneRef=t?t.getSceneRef():null;this._dvlLayerId=r}});r.prototype.destroy=function(){this._dvlLayerId=null;this._dvlSceneRef=null;this._dvl=null;e.prototype.destroy.call(this)};r.prototype.getLayerId=function(){return this._dvlLayerId};r.prototype.getVeIds=function(){return t(this._dvl.Scene.RetrieveVEIDs(this._dvlSceneRef,this._dvlLayerId))};r.prototype.getName=function(){return t(this._dvl.Scene.RetrieveLayerInfo(this._dvlSceneRef,this._dvlLayerId)).name};r.prototype.getDescription=function(){return t(this._dvl.Scene.RetrieveLayerInfo(this._dvlSceneRef,this._dvlLayerId)).description};r.prototype.getLayerMetadata=function(){return t(this._dvl.Scene.RetrieveMetadata(this._dvlSceneRef,this._dvlLayerId)).metadata};r.prototype.getNodes=function(){return t(this._dvl.Scene.RetrieveLayerInfo(this._dvlSceneRef,this._dvlLayerId)).nodes};return r});
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/dvl/NodeHierarchy", ["../NodeHierarchy","../NodeContentType","sap/ui/base/ObjectPool","./BaseNodeProxy","./NodeProxy","./LayerProxy","../Messages","../DvlException","./checkResult","./getJSONObject","../getResourceBundle","sap/base/util/array/uniqueSort","sap/base/Log"],function(e,t,r,o,i,s,n,d,a,c,N,l,h){"use strict";var v={modeDictionary:{equals:function(e){return e?sap.ve.dvl.DVLFINDNODEMODE.DVLFINDNODEMODE_EQUAL:sap.ve.dvl.DVLFINDNODEMODE.DVLFINDNODEMODE_EQUAL_CASE_INSENSITIVE},contains:function(e){return e?sap.ve.dvl.DVLFINDNODEMODE.DVLFINDNODEMODE_SUBSTRING:sap.ve.dvl.DVLFINDNODEMODE.DVLFINDNODEMODE_SUBSTRING_CASE_INSENSITIVE},startsWith:function(e){return e?sap.ve.dvl.DVLFINDNODEMODE.DVLFINDNODEMODE_STARTS_WITH:sap.ve.dvl.DVLFINDNODEMODE.DVLFINDNODEMODE_STARTS_WITH_CASE_INSENSITIVE}}};var D=e.extend("sap.ui.vk.dvl.NodeHierarchy",{metadata:{library:"sap.ui.vk"},_baseNodeProxyPool:new r(o),constructor:function(t){e.call(this);this._graphicsCore=t.getGraphicsCore();this._scene=t;this._dvlSceneRef=this._scene.getSceneRef();this._dvl=this._graphicsCore._getDvl();this._nodeProxies=[];this._layerProxies=[]}});D.prototype.destroy=function(){this._layerProxies.slice().forEach(this.destroyLayerProxy,this);this._nodeProxies.slice().forEach(this.destroyNodeProxy,this);this._dvl=null;this._dvlSceneRef=null;this._scene=null;this._graphicsCore=null;e.prototype.destroy.call(this)};D.prototype.getGraphicsCore=function(){return this._graphicsCore};D.prototype.getScene=function(){return this._scene};D.prototype.getSceneRef=function(){return this._dvlSceneRef};D.prototype.enumerateChildren=function(e,t,r,o){if(typeof e==="function"){o=r;r=t;t=e;e=undefined}var i;if(e){if(r||(c(this._dvl.Scene.RetrieveNodeInfo(this._dvlSceneRef,e,sap.ve.dvl.DVLNODEINFO.DVLNODEINFO_FLAGS)).Flags&sap.ve.dvl.DVLNODEFLAG.DVLNODEFLAG_CLOSED)===0){i=c(this._dvl.Scene.RetrieveNodeInfo(this._dvlSceneRef,e,sap.ve.dvl.DVLNODEINFO.DVLNODEINFO_CHILDREN)).ChildNodes}else{i=[]}}else{i=c(this._dvl.Scene.RetrieveSceneInfo(this._dvlSceneRef,sap.ve.dvl.DVLSCENEINFO.DVLSCENEINFO_CHILDREN)).ChildNodes}if(o){i.forEach(t)}else{var s=this._baseNodeProxyPool.borrowObject();try{i.forEach(function(e){s.init(this,e);t(s);s.reset()}.bind(this))}finally{this._baseNodeProxyPool.returnObject(s)}}return this};D.prototype.enumerateAncestors=function(e,t,r){var o=c(this._dvl.Scene.RetrieveNodeInfo(this._dvlSceneRef,e,sap.ve.dvl.DVLNODEINFO.DVLNODEINFO_PARENTS)).ParentNodes;if(r){o.forEach(t)}else{var i=this._baseNodeProxyPool.borrowObject();try{o.forEach(function(e){i.init(this,e);t(i);i.reset()}.bind(this))}finally{this._baseNodeProxyPool.returnObject(i)}}return this};D.prototype.createNodeProxy=function(e){var t=new i(this,e);this._nodeProxies.push(t);return t};D.prototype.destroyNodeProxy=function(e){var t=this._nodeProxies.indexOf(e);if(t>=0){this._nodeProxies.splice(t,1)[0].destroy()}return this};D.prototype.getChildren=function(e,t){if(typeof e==="boolean"){t=e;e=undefined}if(e){if(t||(c(this._dvl.Scene.RetrieveNodeInfo(this._dvlSceneRef,e,sap.ve.dvl.DVLNODEINFO.DVLNODEINFO_FLAGS)).Flags&sap.ve.dvl.DVLNODEFLAG.DVLNODEFLAG_CLOSED)===0){return c(this._dvl.Scene.RetrieveNodeInfo(this._dvlSceneRef,e,sap.ve.dvl.DVLNODEINFO.DVLNODEINFO_CHILDREN)).ChildNodes}else{return[]}}else{return c(this._dvl.Scene.RetrieveSceneInfo(this._dvlSceneRef,sap.ve.dvl.DVLSCENEINFO.DVLSCENEINFO_CHILDREN)).ChildNodes}};D.prototype.getAncestors=function(e){return c(this._dvl.Scene.RetrieveNodeInfo(this._dvlSceneRef,e,sap.ve.dvl.DVLNODEINFO.DVLNODEINFO_PARENTS)).ParentNodes};D.prototype.findNodesByName=function(e){var t=sap.ve.dvl.DVLFINDNODETYPE.DVLFINDNODETYPE_NODE_NAME,r=[],o,i;if(e===undefined||e===null||jQuery.isEmptyObject(e)){o=v.modeDictionary.contains(false);i=[""]}else{if(e.value===undefined||e.value===null||e.value===""){h.error(N().getText(n.VIT6.summary),n.VIT6.code,"sap.ui.vk.dvl.NodeHierarchy");return[]}var s=e.hasOwnProperty("predicate")?e.predicate:"equals";if(s===undefined||s===null||s===""){h.error(N().getText(n.VIT7.summary),n.VIT7.code,"sap.ui.vk.dvl.NodeHierarchy");return[]}else if(["equals","contains","startsWith"].indexOf(s)===-1){h.error(N().getText(n.VIT8.summary),n.VIT8.code,"sap.ui.vk.dvl.NodeHierarchy");return[]}o=v.modeDictionary[s](e.caseSensitive);i=typeof e.value==="string"?[e.value]:e.value}for(var d=0;d<i.length;d++){r=r.concat(c(this._dvl.Scene.FindNodes(this._dvlSceneRef,t,o,i[d])).nodes)}return l(r)};D.prototype.createLayerProxy=function(e){var t=new s(this,e);this._layerProxies.push(t);return t};D.prototype.destroyLayerProxy=function(e){var t=this._layerProxies.indexOf(e);if(t>=0){this._layerProxies.splice(t,1)[0].destroy()}return this};D.prototype.getLayers=function(){return c(this._dvl.Scene.RetrieveSceneInfo(this._dvlSceneRef,sap.ve.dvl.DVLSCENEINFO.DVLSCENEINFO_LAYERS)).Layers};D.prototype.getHotspotNodeRefs=function(){var e=c(this._dvl.Scene.RetrieveSceneInfo(this._dvlSceneRef,sap.ve.dvl.DVLSCENEINFO.DVLSCENEINFO_HOTSPOTS).ChildNodes);return e.length>0?e:this._getLegacyHotspotNodeIds()};D.prototype._getLegacyHotspotNodeIds=function(){var e=this.getLayers(),t=[];for(var r=0;r<e.length;r++){var o=this.createLayerProxy(e[r]),i=o.getName();if(i.toLowerCase()==="hotspots"){t=o.getNodes();this.destroyLayerProxy(o);break}this.destroyLayerProxy(o)}return t};D.prototype.createNode=function(e,t,r){var o=this._dvl.Scene.CreateNode(this._dvlSceneRef,e,t,r);this.fireNodeCreated({nodeRef:o,nodeId:o});this.fireChanged();return o};D.prototype.createNodeCopy=function(e,t,r,o){var i=this._dvl.Scene.CreateNodeCopy(this._dvlSceneRef,e,t,sap.ve.dvl.DVLCREATENODECOPYFLAG.COPY_CHILDREN,r,o);this.fireNodeCreated({nodeRef:i,nodeId:i});this.fireChanged();return i};D.prototype.getNodeContentType=function(e){return t.Regular};D.prototype.removeNode=function(e){var t=[].concat(e);t.forEach(function(e){this.fireNodeRemoving({nodeRef:e,nodeId:e});try{a(this._dvl.Scene.DeleteNode(this._dvlSceneRef,e))}catch(r){var t="Failed to delete node with ID = "+e+".";if(r instanceof d){t+=" Error code: "+r.code+". Message: "+r.message+"."}h.error(t)}}.bind(this));this.fireChanged();return this};return D});
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/dvl/NodeProxy", ["../NodeProxy","./getJSONObject","../cssColorToColor","../colorToCSSColor","../abgrToColor","../colorToABGR","../TransformationMatrix"],function(e,t,o,r,i,n,d){"use strict";var l=e.extend("sap.ui.vk.dvl.NodeProxy",{metadata:{library:"sap.ui.vk"},constructor:function(t,o){e.call(this);this._dvl=t?t.getGraphicsCore()._getDvl():null;this._dvlSceneRef=t?t.getSceneRef():null;this._dvlNodeRef=o}});l.prototype.destroy=function(){this._dvlNodeRef=null;this._dvlSceneRef=null;this._dvl=null;e.prototype.destroy.call(this)};l.prototype.getNodeRef=function(){return this._dvlNodeRef};l.prototype.getNodeId=function(){return this._dvlNodeRef};l.prototype.getVeIds=function(){return t(this._dvl.Scene.RetrieveVEIDs(this._dvlSceneRef,this._dvlNodeRef))};l.prototype.getName=function(){return t(this._dvl.Scene.RetrieveNodeInfo(this._dvlSceneRef,this._dvlNodeRef,sap.ve.dvl.DVLNODEINFO.DVLNODEINFO_NAME)).NodeName};l.prototype.getLocalMatrix=function(){return d.convertTo4x3(t(this._dvl.Scene.GetNodeLocalMatrix(this._dvlSceneRef,this._dvlNodeRef)).matrix)};l.prototype.setLocalMatrix=function(e){this._dvl.Scene.SetNodeLocalMatrix(this._dvlSceneRef,this._dvlNodeRef,e&&d.convertTo4x4(e));this.setProperty("localMatrix",e,true);return this};l.prototype.getWorldMatrix=function(){return d.convertTo4x3(t(this._dvl.Scene.GetNodeWorldMatrix(this._dvlSceneRef,this._dvlNodeRef)).matrix)};l.prototype.setWorldMatrix=function(e){this._dvl.Scene.SetNodeWorldMatrix(this._dvlSceneRef,this._dvlNodeRef,e&&d.convertTo4x4(e));this.setProperty("worldMatrix",e,true);return this};l.prototype.getOpacity=function(){return t(this._dvl.Scene.RetrieveNodeInfo(this._dvlSceneRef,this._dvlNodeRef,sap.ve.dvl.DVLNODEINFO.DVLNODEINFO_OPACITY)).Opacity};l.prototype.setOpacity=function(e){this._dvl.Scene.SetNodeOpacity(this._dvlSceneRef,this._dvlNodeRef,e);this.setProperty("opacity",e,true);return this};l.prototype.getTintColorABGR=function(){return t(this._dvl.Scene.RetrieveNodeInfo(this._dvlSceneRef,this._dvlNodeRef,sap.ve.dvl.DVLNODEINFO.DVLNODEINFO_HIGHLIGHT_COLOR)).HighlightColor};l.prototype.setTintColorABGR=function(e){this._dvl.Scene.SetNodeHighlightColor(this._dvlSceneRef,this._dvlNodeRef,e);this.setProperty("tintColorABGR",e,true);this.setProperty("tintColor",r(i(e)),true);return this};l.prototype.getTintColor=function(){return r(i(this.getTintColorABGR()))};l.prototype.setTintColor=function(e){var t=n(o(e));this._dvl.Scene.SetNodeHighlightColor(this._dvlSceneRef,this._dvlNodeRef,t);this.setProperty("tintColorABGR",t,true);this.setProperty("tintColor",e,true);return this};l.prototype.getNodeMetadata=function(){return t(this._dvl.Scene.RetrieveMetadata(this._dvlSceneRef,this._dvlNodeRef)).metadata};l.prototype.getHasChildren=function(){return(t(this._dvl.Scene.RetrieveNodeInfo(this._dvlSceneRef,this._dvlNodeRef,sap.ve.dvl.DVLNODEINFO.DVLNODEINFO_FLAGS)).Flags&(sap.ve.dvl.DVLNODEFLAG.DVLNODEFLAG_MAPPED_HASCHILDREN|sap.ve.dvl.DVLNODEFLAG.DVLNODEFLAG_CLOSED))===sap.ve.dvl.DVLNODEFLAG.DVLNODEFLAG_MAPPED_HASCHILDREN};l.prototype.getClosed=function(){return(t(this._dvl.Scene.RetrieveNodeInfo(this._dvlSceneRef,this._dvlNodeRef,sap.ve.dvl.DVLNODEINFO.DVLNODEINFO_FLAGS)).Flags&sap.ve.dvl.DVLNODEFLAG.DVLNODEFLAG_CLOSED)!==0};return l});
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/dvl/Scene", ["../Scene","./NodeHierarchy","sap/base/util/uid"],function(e,t,r){"use strict";var i=e.extend("sap.ui.vk.dvl.Scene",{metadata:{library:"sap.ui.vk"},constructor:function(t,i){e.call(this);this._id=r();this._graphicsCore=t;this._dvlSceneRef=i;this._defaultNodeHierarchy=null}});i.prototype.destroy=function(){if(this._defaultNodeHierarchy){this._defaultNodeHierarchy.destroy();this._defaultNodeHierarchy=null}this._dvlSceneRef=null;this._graphicsCore=null;e.prototype.destroy.call(this)};i.prototype.getId=function(){return this._id};i.prototype.getGraphicsCore=function(){return this._graphicsCore};i.prototype.getDefaultNodeHierarchy=function(){if(!this._defaultNodeHierarchy){this._defaultNodeHierarchy=new t(this)}return this._defaultNodeHierarchy};i.prototype.getSceneRef=function(){return this._dvlSceneRef};i.prototype.setDoubleSided=function(e){this.setProperty("doubleSided",e,true);this._graphicsCore._dvl.Renderer.SetOption(sap.ve.dvl.DVLRENDEROPTION.DVLRENDEROPTION_SHOW_BACKFACING,e);return this};return i});
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/dvl/ViewStateManager", ["sap/ui/core/Element","../ViewStateManagerBase","./GraphicsCoreApi","../cssColorToColor","../colorToCSSColor","../abgrToColor","../colorToABGR","./Scene","sap/base/util/array/uniqueSort"],function(e,t,i,s,r,n,a,o,l){"use strict";var h;var d=t.extend("sap.ui.vk.dvl.ViewStateManager",{metadata:{library:"sap.ui.vk"}});var c=d.getMetadata().getParent().getClass().prototype;d.prototype.init=function(){if(c.init){c.init.call(this)}this._nodeHierarchy=null;this._dvl=null;this._nodeStates=new Map;this._selectedNodes=new Set;this._visibilityTracker=new h;this._closedNodeProcessed=false};d.prototype._setContent=function(e){var t=null;if(e&&e instanceof o){t=e}this._setScene(t);return this};d.prototype._setScene=function(e){if(e){this._setNodeHierarchy(e.getDefaultNodeHierarchy())}else{this._setNodeHierarchy(null)}return this};d.prototype._setNodeHierarchy=function(e){var t=this._nodeHierarchy;if(this._nodeHierarchy){this._nodeHierarchy.detachNodeCreated(this._handleNodeCreated,this);this._nodeHierarchy.detachNodeRemoving(this._handleNodeRemoving,this);this._dvl.Client.detachStepEvent(this._handleStepEvent,this);this._nodeHierarchy=null;this._dvl=null;this._nodeStates.clear();this._selectedNodes.clear();this._visibilityTracker.clear()}if(e){var s=e.getScene(),r=s.getSceneRef();this._nodeHierarchy=e;this._dvl=s.getGraphicsCore().getApi(i.LegacyDvl);this._dvl.Client.attachStepEvent(this._handleStepEvent,this);this._nodeHierarchy.attachNodeCreated(this._handleNodeCreated,this);this._nodeHierarchy.attachNodeRemoving(this._handleNodeRemoving,this);this._populateNodeStates(this._dvl.Scene.RetrieveSceneInfo(r,sap.ve.dvl.DVLSCENEINFO.DVLSCENEINFO_CHILDREN|sap.ve.dvl.DVLSCENEINFO.DVLSCENEINFO_HOTSPOTS).ChildNodes)}if(e!==t){this.fireNodeHierarchyReplaced({oldNodeHierarchy:t,newNodeHierarchy:e})}return this};d.prototype._populateNodeStates=function(e){var t=this,i=[],s=[],r=[],n=[],a=this._nodeHierarchy.getScene(),o=a.getSceneRef();e.forEach(function e(a){var l=t._dvl.Scene.RetrieveNodeInfo(o,a,sap.ve.dvl.DVLNODEINFO.DVLNODEINFO_FLAGS|sap.ve.dvl.DVLNODEINFO.DVLNODEINFO_CHILDREN);t._nodeStates.set(a,{flags:l.Flags,visible:l.Flags&sap.ve.dvl.DVLNODEFLAG.DVLNODEFLAG_VISIBLE});if(l.Flags&sap.ve.dvl.DVLNODEFLAG.DVLNODEFLAG_SELECTED){t._selectedNodes.add(a)}(l.Flags&sap.ve.dvl.DVLNODEFLAG.DVLNODEFLAG_VISIBLE?i:s).push(a);(l.Flags&sap.ve.dvl.DVLNODEFLAG.DVLNODEFLAG_SELECTED?r:n).push(a);l.ChildNodes.forEach(e)});this.fireSelectionChanged({selected:r,unselected:n});this.fireVisibilityChanged({visible:i,hidden:s});return this};d.prototype._handleNodeCreated=function(e){this._populateNodeStates([e.getParameter("nodeRef")])};d.prototype._handleNodeRemoving=function(e){var t=e.getParameter("nodeRef"),i=this;var s=function(e){i._nodeHierarchy.enumerateChildren(e,s,true,true);i._nodeStates.delete(e)};s(t)};d.prototype.getNodeHierarchy=function(){return this._nodeHierarchy};d.prototype.getVisibilityChanges=function(){return this.getShouldTrackVisibilityChanges()?this._visibilityTracker.getInfo(this.getNodeHierarchy()):null};d.prototype.getVisibilityComplete=function(){var e=this.getNodeHierarchy(),t=e.findNodesByName(),i=[],s=[];t.forEach(function(t){var r=e.createNodeProxy(t),n=jQuery.grep(r.getVeIds(),function(e){return e.type==="VE_LOCATOR"});n=Array.isArray(n)&&n.length>0?n[0].fields[0].value:null;e.destroyNodeProxy(r);if(n){if(this.getVisibilityState(t)){i.push(n)}else{s.push(n)}}},this);return{visible:i,hidden:s}};d.prototype.resetVisibility=function(){this._dvl.Renderer.ResetView(sap.ve.dvl.DVLRESETVIEWFLAG.VISIBILITY,this._scene);return this};var f=function(e,t,i){return e.has(i)&&(e.get(i).flags&t)!==0};d.prototype._getVisibilityFlagState=function(e){return f(this._nodeStates,sap.ve.dvl.DVLNODEFLAG.DVLNODEFLAG_VISIBLE,e)};d.prototype._getSelectionFlagState=function(e){return f(this._nodeStates,sap.ve.dvl.DVLNODEFLAG.DVLNODEFLAG_SELECTED,e)};var u=function(e,t,i,s){if(e.has(s)){var r=e.get(s);r.flags=r.flags&~i|t&i}else{e.set(s,{flags:t&i})}};d.prototype._setFlags=function(e,t,i){if(i&sap.ve.dvl.DVLNODEFLAG.DVLNODEFLAG_VISIBLE){this.setVisibilityState(e,(t&sap.ve.dvl.DVLNODEFLAG.DVLNODEFLAG_VISIBLE)!==0,false)}if(i&sap.ve.dvl.DVLNODEFLAG.DVLNODEFLAG_SELECTED){this.setSelectionState(e,(t&sap.ve.dvl.DVLNODEFLAG.DVLNODEFLAG_SELECTED)!==0,false)}u(this._nodeStates,t,i&~(sap.ve.dvl.DVLNODEFLAG.DVLNODEFLAG_VISIBLE|sap.ve.dvl.DVLNODEFLAG.DVLNODEFLAG_SELECTED),e);return this};d.prototype._getFlags=function(e,t){var i=this._nodeStates.get(e),s=i&&i.flags;return s!==undefined?s&t:null};d.prototype.getVisibilityState=function(e){return Array.isArray(e)?e.map(this._getVisibilityFlagState,this):this._getVisibilityFlagState(e)};d.prototype.setVisibilityState=function(e,t,i,s){if(!Array.isArray(e)){e=[e]}var r=l(i?this._collectNodesRecursively(e,true):e).filter(function(e){return e&&this._getVisibilityFlagState(e)!==t},this);var n=function(e,t){var i=[];this._nodeHierarchy.enumerateChildren(e,function(e){i.push(e)},true,true);i.forEach(function(e){var i=this._nodeStates.get(e);if(t){if(i.visible){i.flags|=sap.ve.dvl.DVLNODEFLAG.DVLNODEFLAG_VISIBLE;n(e,t)}}else{i.flags&=~sap.ve.dvl.DVLNODEFLAG.DVLNODEFLAG_VISIBLE;n(e,t)}},this)}.bind(this);if(r.length>0){r.forEach(function(e){var i=this._nodeStates.get(e);if(i){if(i.flags===undefined){i.flags=0}if(t){i.flags|=sap.ve.dvl.DVLNODEFLAG.DVLNODEFLAG_VISIBLE}else{i.flags&=~sap.ve.dvl.DVLNODEFLAG.DVLNODEFLAG_VISIBLE}}else{i={flags:t?sap.ve.dvl.DVLNODEFLAG.DVLNODEFLAG_VISIBLE:0};this._nodeStates.set(e,i)}i.visible=t;n(e,t)},this);if(this.getShouldTrackVisibilityChanges()){r.forEach(this._visibilityTracker.trackNodeRef,this._visibilityTracker)}this.fireVisibilityChanged({visible:t?r:[],hidden:t?[]:r})}return this};d.prototype.enumerateSelection=function(e){this._selectedNodes.forEach(e);return this};d.prototype.getSelectionState=function(e){return Array.isArray(e)?e.map(this._getSelectionFlagState,this):this._getSelectionFlagState(e)};d.prototype.setSelectionState=function(e,t,i,s){if(!Array.isArray(e)){e=[e]}var r=l(i||this.getRecursiveSelection()?this._collectNodesRecursively(e):e);if(this.getRecursiveSelection()&&!t){r=this._nodeHierarchy._appendAncestors(r)}r=r.filter(function(e){return e&&this._getSelectionFlagState(e)!==t},this);if(r.length>0){r.forEach(function(e){var i=this._nodeStates.get(e);if(i){if(i.flags===undefined){i.flags=this._dvl.Scene.RetrieveNodeInfo(this._nodeHierarchy.getScene().getSceneRef(),e,sap.ve.dvl.DVLNODEINFO.DVLNODEINFO_FLAGS).Flags}if(t){i.flags|=sap.ve.dvl.DVLNODEFLAG.DVLNODEFLAG_SELECTED}else{i.flags&=~sap.ve.dvl.DVLNODEFLAG.DVLNODEFLAG_SELECTED}}else{var s=this._dvl.Scene.RetrieveNodeInfo(this._nodeHierarchy.getScene().getSceneRef(),e,sap.ve.dvl.DVLNODEINFO.DVLNODEINFO_FLAGS).Flags;this._nodeStates.set(e,{flags:s|(t?sap.ve.dvl.DVLNODEFLAG.DVLNODEFLAG_SELECTED:0)})}this._selectedNodes[t?"add":"delete"](e)},this);if(!s){this.fireSelectionChanged({selected:t?r:[],unselected:t?[]:r})}}return this};d.prototype.setSelectionStates=function(e,t,i,s){if(!Array.isArray(e)){e=[e]}if(!Array.isArray(t)){t=[t]}var r=l(i||this.getRecursiveSelection()?this._collectNodesRecursively(e):e);var n=l(i||this.getRecursiveSelection()?this._collectNodesRecursively(t):t);if(this.getRecursiveSelection()){n=this._nodeHierarchy._appendAncestors(n,r)}r=r.filter(function(e){return e&&this._getSelectionFlagState(e)===false},this);n=n.filter(function(e){return e&&this._getSelectionFlagState(e)===true},this);if(r.length>0){r.forEach(function(e){var t=this._nodeStates.get(e);if(t){if(t.flags===undefined){t.flags=this._dvl.Scene.RetrieveNodeInfo(this._nodeHierarchy.getScene().getSceneRef(),e,sap.ve.dvl.DVLNODEINFO.DVLNODEINFO_FLAGS).Flags}t.flags|=sap.ve.dvl.DVLNODEFLAG.DVLNODEFLAG_SELECTED}else{var i=this._dvl.Scene.RetrieveNodeInfo(this._nodeHierarchy.getScene().getSceneRef(),e,sap.ve.dvl.DVLNODEINFO.DVLNODEINFO_FLAGS).Flags;this._nodeStates.set(e,{flags:i|sap.ve.dvl.DVLNODEFLAG.DVLNODEFLAG_SELECTED})}this._selectedNodes["add"](e)},this)}if(n.length>0){n.forEach(function(e){var t=this._nodeStates.get(e);if(t){if(t.flags===undefined){t.flags=this._dvl.Scene.RetrieveNodeInfo(this._nodeHierarchy.getScene().getSceneRef(),e,sap.ve.dvl.DVLNODEINFO.DVLNODEINFO_FLAGS).Flags}t.flags&=~sap.ve.dvl.DVLNODEFLAG.DVLNODEFLAG_SELECTED}else{var i=this._dvl.Scene.RetrieveNodeInfo(this._nodeHierarchy.getScene().getSceneRef(),e,sap.ve.dvl.DVLNODEINFO.DVLNODEINFO_FLAGS).Flags;this._nodeStates.set(e,{flags:i})}this._selectedNodes["delete"](e)},this)}if(!s){if(r.length>0||n.length>0){this.fireSelectionChanged({selected:r,unselected:n})}}return this};d.prototype._handleStepEvent=function(e){if(e.type===sap.ve.dvl.DVLSTEPEVENT.DVLSTEPEVENT_STARTED){this._visibilityTracker.clear()}};d.prototype._collectNodesRecursively=function(e,t){var i=[],s=this;if(t===undefined){t=false}e.forEach(function e(r){i.push(r);s._nodeHierarchy.enumerateChildren(r,e,t,true)});return i};d.prototype._getOpacity=function(e){if(this._nodeStates.has(e)){var t=this._nodeStates.get(e).opacity;return t===undefined?null:t}else{return null}};d.prototype.getOpacity=function(e){if(Array.isArray(e)){return e.map(this._getOpacity,this)}else{return this._getOpacity(e)}};d.prototype.setOpacity=function(e,t,i){if(!Array.isArray(e)){e=[e]}var s=l(i?this._collectNodesRecursively(e,true):e).filter(function(e){return e&&this._getOpacity(e)!==t},this);if(s.length>0){s.forEach(function(e){var i=this._nodeStates.get(e);if(i){if(t===null){delete i.opacity}else{i.opacity=t}}else if(t!==null){this._nodeStates.set(e,{opacity:t})}},this);this.fireOpacityChanged({changed:s,opacity:t})}return this};d.prototype._getTintColorABGR=function(e){if(this._nodeStates.has(e)){var t=this._nodeStates.get(e).tintColorABGR;return t===undefined?null:t}else{return null}};d.prototype._getTintColor=function(e){if(this._nodeStates.has(e)){var t=this._nodeStates.get(e).tintColorABGR;return t===undefined?null:r(n(t))}else{return null}};d.prototype.getTintColor=function(e,t){var i=t?"_getTintColorABGR":"_getTintColor";if(Array.isArray(e)){return e.map(this[i],this)}else{return this[i](e)}};d.prototype.setTintColor=function(e,t,i){if(!Array.isArray(e)){e=[e]}var r=null;switch(typeof t){case"number":r=t;break;case"string":if(sap.ui.core.CSSColor.isValid(t)){r=a(s(t))}break;default:t=null;break}var n=l(i?this._collectNodesRecursively(e,true):e).filter(function(e){return e&&this._getTintColorABGR(e)!==r},this);if(n.length>0){n.forEach(function(e){var t=this._nodeStates.get(e);if(t){if(r===null){delete t.tintColorABGR}else{t.tintColorABGR=r}}else if(r!==null){this._nodeStates.set(e,{tintColorABGR:r})}},this);this.fireTintColorChanged({changed:n,tintColor:t,tintColorABGR:r})}return this};h=function(){this._visibilityChanges=new Set};h.prototype.getInfo=function(e){var t=function(e){return e.type==="VE_LOCATOR"};var i=[];this._visibilityChanges.forEach(function(s){var r=e.createNodeProxy(s),n=jQuery.grep(r.getVeIds(),t);n=Array.isArray(n)&&n.length>0?n[0].fields[0].value:null;e.destroyNodeProxy(r);if(n){i.push(n)}});return i};h.prototype.clear=function(){this._visibilityChanges.clear()};h.prototype.trackNodeRef=function(e){if(this._visibilityChanges.has(e)){this._visibilityChanges.delete(e)}else{this._visibilityChanges.add(e)}};return d});
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/dvl/Viewport", ["sap/ui/core/ResizeHandler","../abgrToColor","../CameraFOVBindingType","../CameraProjectionType","../colorToABGR","../colorToCSSColor","../Core","../cssColorToColor","../getResourceBundle","../glMatrix","../Loco","../Messages","../SelectionMode","../Smart2DHandler","../ViewportBase","../ViewportHandler","../VisibilityMode","../ZoomTo","../OutputSettings","./getJSONObject","./Scene","./ViewportRenderer","sap/base/Log"],function(e,t,i,r,o,n,a,s,d,l,h,v,c,p,f,_,u,m,R,g,y,I,C){"use strict";var V;var S=function(){if(V){return}V={encodedProjectionType:{},decodedProjectionType:{},encodedBindingType:{},decodedBindingType:{},decodedZoomTo:{}};V.decodedProjectionType[r.Perspective]=sap.ve.dvl.DVLCAMERAPROJECTION.PERSPECTIVE;V.decodedProjectionType[r.Orthographic]=sap.ve.dvl.DVLCAMERAPROJECTION.ORTHOGRAPHIC;V.encodedProjectionType[sap.ve.dvl.DVLCAMERAPROJECTION.PERSPECTIVE]=r.Perspective;V.encodedProjectionType[sap.ve.dvl.DVLCAMERAPROJECTION.ORTHOGRAPHIC]=r.Orthographic;V.decodedBindingType[i.Minimum]=sap.ve.dvl.DVLCAMERAFOVBINDING.MIN;V.decodedBindingType[i.Maximum]=sap.ve.dvl.DVLCAMERAFOVBINDING.Max;V.decodedBindingType[i.Horizontal]=sap.ve.dvl.DVLCAMERAFOVBINDING.HORZ;V.decodedBindingType[i.Vertical]=sap.ve.dvl.DVLCAMERAFOVBINDING.VERT;V.encodedBindingType[sap.ve.dvl.DVLCAMERAFOVBINDING.MIN]=i.Minimum;V.encodedBindingType[sap.ve.dvl.DVLCAMERAFOVBINDING.MAX]=i.Maximum;V.encodedBindingType[sap.ve.dvl.DVLCAMERAFOVBINDING.HORZ]=i.Horizontal;V.encodedBindingType[sap.ve.dvl.DVLCAMERAFOVBINDING.VERT]=i.Vertical;V.decodedZoomTo[m.All]=sap.ve.dvl.DVLZOOMTO.DVLZOOMTO_ALL;V.decodedZoomTo[m.Visible]=sap.ve.dvl.DVLZOOMTO.DVLZOOMTO_VISIBLE;V.decodedZoomTo[m.Selected]=sap.ve.dvl.DVLZOOMTO.DVLZOOMTO_SELECTED;V.decodedZoomTo[m.Node]=sap.ve.dvl.DVLZOOMTO.DVLZOOMTO_NODE;V.decodedZoomTo[m.NodeSetIsolation]=sap.ve.dvl.DVLZOOMTO.DVLZOOMTO_NODE_SETISOLATION;V.decodedZoomTo[m.Restore]=sap.ve.dvl.DVLZOOMTO.DVLZOOMTO_RESTORE;V.decodedZoomTo[m.RestoreRemoveIsolation]=sap.ve.dvl.DVLZOOMTO.DVLZOOMTO_RESTORE_REMOVEISOLATION;V.decodedZoomTo[m.ViewLeft]=sap.ve.dvl.DVLZOOMTO.VIEW_LEFT;V.decodedZoomTo[m.ViewRight]=sap.ve.dvl.DVLZOOMTO.VIEW_RIGHT;V.decodedZoomTo[m.ViewTop]=sap.ve.dvl.DVLZOOMTO.VIEW_TOP;V.decodedZoomTo[m.ViewBottom]=sap.ve.dvl.DVLZOOMTO.VIEW_BOTTOM;V.decodedZoomTo[m.ViewBack]=sap.ve.dvl.DVLZOOMTO.VIEW_BACK;V.decodedZoomTo[m.ViewFront]=sap.ve.dvl.DVLZOOMTO.VIEW_FRONT};var T=f.extend("sap.ui.vk.dvl.Viewport",{metadata:{library:"sap.ui.vk",properties:{backgroundColorTopABGR:{type:"int",defaultValue:4278190080},backgroundColorBottomABGR:{type:"int",defaultValue:4294967295}},events:{pan:{parameters:{dx:"int",dy:"int"}},zoom:{parameters:{zoomFactor:"float"}},rotate:{parameters:{dx:"int",dy:"int"}},frameRenderingFinished:{}}}});var O=T.getMetadata().getParent().getClass().prototype;T.prototype.init=function(){if(O.init){O.init.call(this)}this._eventBus=a.getEventBus();this._graphicsCore=null;this._dvl=null;this._dvlRendererId=null;this._viewStateManager=null;this._canvas=null;this._resizeListenerId=null;this._is2D=false;this._viewportHandler=new _(this);this._loco=new h(this);this._loco.addHandler(this._viewportHandler,-1);this._smart2DHandler=null;this._lastPlayedStep=null;this._contentConnector=null};T.prototype.exit=function(){this._loco.removeHandler(this._viewportHandler);this._viewportHandler.destroy();this._loco.destroy();this._loco=null;if(this._resizeListenerId){e.deregister(this._resizeListenerId);this._resizeListenerId=null}this.setViewStateManager(null);this.setScene(null);this.setGraphicsCore(null);if(O.exit){O.exit.call(this)}};T.prototype.setGraphicsCore=function(e){S();if(e!=this._graphicsCore){if(this._graphicsCore){this._dvl.Client.detachFrameFinished(this._handleFrameFinished,this);this._dvl.Client.detachStepEvent(this._updateLastPlayedStep,this);this._dvl.Renderer.SetViewStateManager(null,this._dvlRendererId);this._graphicsCore._deregisterViewport(this);this._dvl=null}this._graphicsCore=e;if(this._graphicsCore){this._dvl=this._graphicsCore._getDvl();this._graphicsCore._registerViewport(this);this.setShowDebugInfo(this.getShowDebugInfo());this._dvl.Client.attachStepEvent(this._updateLastPlayedStep,this);this._dvl.Client.attachFrameFinished(this._handleFrameFinished,this);this._dvl.Renderer.SetViewStateManager(this._viewStateManager,this._dvlRendererId)}}return this};T.prototype.getGraphicsCore=function(){return this._graphicsCore};T.prototype._setCanvas=function(e){var t=this.getDomRef()&&this._canvas!==e;this._canvas=e;if(t){this.invalidate()}return this};T.prototype._setRenderer=function(e){this._dvlRendererId=e;return this};T.prototype._updateLastPlayedStep=function(e){if(e.type===sap.ve.dvl.DVLSTEPEVENT.DVLSTEPEVENT_STARTED){this._lastPlayedStep=e.stepId;this._updateOutputSettings()}};T.prototype.setScene=function(e){if(this._dvlRendererId){this._dvl.Renderer.AttachScene(e&&e.getSceneRef()||null,this._dvlRendererId);this._dvlSceneRef=e?e.getSceneRef():null;if(e){this._dvl.Client.attachUrlClicked(this._fireUrlClicked,this);var t=this._isSmart2DContent()||this._isSmart2DContentLegacy();if(t){this._dvl.Renderer.SetBackgroundColor(1,1,1,1,1,1,1,1,this._dvlRendererId)}else{var i=this._getDecomposedABGR(this.getBackgroundColorTopABGR());var r=this._getDecomposedABGR(this.getBackgroundColorBottomABGR());this._dvl.Renderer.SetBackgroundColor(i.red,i.green,i.blue,i.alpha,r.red,r.green,r.blue,r.alpha,this._dvlRendererId)}this._updateOutputSettings();this.fireViewActivated({type:t?"2D":"3D"})}else{this._dvl.Client.detachUrlClicked(this._fireUrlClicked,this);if(this._smart2DHandler){this._loco?.removeHandler(this._smart2DHandler)}this.invalidate()}}return this};T.prototype._updateOutputSettings=function(){var e=this._dvl.Scene.RetrieveSceneInfo(this._dvlSceneRef,sap.ve.dvl.DVLSCENEINFO.DVLSCENEINFO_STEP_INFO);var t=this._dvl.Scene.RetrieveOutputSettings(this._dvlSceneRef,e.StepId);var i=new R({width:t.width,height:t.height,dpi:t.dpi});this.setOutputSettings(i)};T.prototype._isSmart2DContent=function(){var e=g(this._dvl.Scene.RetrieveSceneInfo(this._dvlSceneRef,sap.ve.dvl.DVLSCENEINFO.DVLSCENEINFO_HOTSPOTS).ChildNodes);return e&&e.length>0};T.prototype._isSmart2DContentLegacy=function(){var e=this._dvl.Scene.GetCurrentCamera(this._dvlSceneRef),t=this._dvl.Camera.GetRotation(e),i=this._dvl.Camera.GetProjection(e);return t[0]===90&&t[1]===-90&&t[2]===0&&i===sap.ve.dvl.DVLCAMERAPROJECTION.ORTHOGRAPHIC};T.prototype._initializeSmart2DHandler=function(){if(this._viewStateManager){if(this._smart2DHandler){this._loco.removeHandler(this._smart2DHandler)}this._smart2DHandler=new p(this,this._viewStateManager);this._loco.addHandler(this._smart2DHandler,0)}if(this.getShowAllHotspots()){var e=this._viewStateManager.getNodeHierarchy(),t=e.getHotspotNodeRefs();this.showHotspots(t,true)}};T.prototype._fireUrlClicked=function(e){this.fireUrlClicked({url:e.url,nodeRef:e.nodeId})};T.prototype.setHotspotColorABGR=function(e){this.setProperty("hotspotColorABGR",e,true);this.setProperty("hotspotColor",n(t(this.getProperty("hotspotColorABGR"))),true);return this};T.prototype.setHotspotColor=function(e){this.setProperty("hotspotColor",e,true);this.setProperty("hotspotColorABGR",o(s(this.getProperty("hotspotColor"))),true);return this};T.prototype._getStepAndProcedureIndexes=function(e,t){var i=-1,r=-1,o=false;for(var n=0;n<e.length;n++){if(!o){for(var a=0;a<e[n].steps.length;a++){if(e[n].steps[a].id===t){r=a;i=n;o=true;break}}}else{break}}return{stepIndex:r,procedureIndex:i}};T.prototype._getStepVeIdById=function(e){if(e){var t=this._dvl.Scene.RetrieveVEIDs(this._dvlSceneRef,e);if(Array.isArray(t)){for(var i=0,r=t.length;i<r;++i){var o=t[i];if(o.source==="SAP"&&o.type==="VE_VIEWPORT"&&Array.isArray(o.fields)){for(var n=0,a=o.fields.length;n<a;++n){var s=o.fields[n];if(s.name==="ID"){return s.value}}}}}}return null};T.prototype._getStepIdByVeId=function(e,t){for(var i=0,r=e.length;i<r;++i){var o=e[i].steps;for(var n=0,a=o.length;n<a;++n){var s=o[n].id;if(this._getStepVeIdById(s)===t){return s}}}return null};var D=function(e){e.camera={}};var E=function(e){if(typeof e.camera==="object"&&e.camera!==null){e.camera.matrices=false}};var P=function(e){if(typeof e.camera==="object"&&e.camera!==null){e.camera.useTransitionCamera=false}};var b=function(e){e.animation=true};var w=function(e){e.visibility=false};var N=function(e){if(typeof e.visibility==="object"&&e.visibility!==null){e.visibility.mode=u.Complete}};T.prototype.getViewInfo=function(e){if(!this._dvlSceneRef){return null}var t={};if(typeof e!=="object"||e===null){D(t);E(t);P(t);b(t);w(t);N(t)}else{if(typeof e.camera==="object"&&e.camera!==null){t.camera={};if(typeof e.camera.matrices==="boolean"){t.camera.matrices=e.camera.matrices}else if("matrices"in e.camera){t.camera.matrices=false}else{E(t)}if(typeof e.camera.useTransitionCamera==="boolean"){t.camera.useTransitionCamera=e.camera.useTransitionCamera}else if("useTransitionCamera"in e.camera){t.camera.useTransitionCamera=false}else{P(t)}}else if(typeof e.camera==="boolean"){if(e.camera===true){t.camera={};E(t);P(t)}else{t.camera=false}}else if("camera"in e){t.camera=false}else{D(t);E(t);P(t)}if(typeof e.animation==="boolean"){t.animation=e.animation}else if("animation"in e){t.animation=false}else{b(t)}if(typeof e.visibility==="object"&&e.visibility!==null){t.visibility={};if(e.visibility.mode===u.Complete||e.visibility.mode===u.Differences){t.visibility.mode=e.visibility.mode}else{N(t)}}else if(typeof e.visibility==="boolean"){if(e.visibility===true){t.visibility={};N(t)}else{t.visibility=false}}else if("visibility"in e){t.visibility=false}else{w(t);N(t)}}var i={};if(t.camera){var o=null;if(t.camera.useTransitionCamera){o=this._dvl.Renderer.GetTransitionCamera(this._dvlRendererId);if(o===sap.ve.dvl.DVLID_INVALID){o=null}}if(o===null){o=this._dvl.Renderer.GetCurrentCamera(this._dvlRendererId)}var n=this._dvl.Camera.GetRotation(o),a=this._dvl.Camera.GetOrigin(o);i.camera={rotation:{yaw:n[0],pitch:n[1],roll:n[2]},position:{x:a[0],y:a[1],z:a[2]},projectionType:V.encodedProjectionType[this._dvl.Camera.GetProjection(o)],bindingType:V.encodedBindingType[this._dvl.Camera.GetFOVBinding(o)]};if(this._matView){i.viewMatrix=this._matView.slice()}if(this._matProj){i.projectionMatrix=this._matProj.slice()}if(i.camera.projectionType===r.Perspective){i.camera.fieldOfView=this._dvl.Camera.GetFOV(o)}else if(i.camera.projectionType===r.Orthographic){i.camera.zoomFactor=this._dvl.Camera.GetOrthoZoomFactor(o)}if(t.camera.matrices){var s=this._dvl.Renderer.GetCameraMatrices(this._dvlRendererId);i.camera.matrices={view:s.view,projection:s.projection}}}if(t.animation){var l=this._dvl.Scene.RetrieveSceneInfo(this._dvlSceneRef,sap.ve.dvl.DVLSCENEINFO.DVLSCENEINFO_STEP_INFO),h=l.StepId!==sap.ve.dvl.DVLID_INVALID;var c=h?l.StepId:this._lastPlayedStep,p=h?l.StepTime:0,f=this._dvl.Scene.RetrieveProcedures(this._dvlSceneRef),_=this._getStepAndProcedureIndexes(f.procedures,c),m=this._getStepVeIdById(c);i.animation={animationTime:p,stepIndex:_.stepIndex,procedureIndex:_.procedureIndex};if(m){i.animation.stepVeId=m}}if(t.visibility&&this._viewStateManager){i.visibility={mode:t.visibility.mode};if(t.visibility.mode===u.Complete){var R=this._viewStateManager.getVisibilityComplete();i.visibility.visible=R.visible;i.visibility.hidden=R.hidden}else if(this._viewStateManager.getShouldTrackVisibilityChanges()){i.visibility.changes=this._viewStateManager.getVisibilityChanges()}else{C.warning(d().getText(v.VIT32.summary),v.VIT32.code,"sap.ui.vk.dvl.Viewport")}}return i};T.prototype.setViewInfo=function(e,t){var i=false;if(e.animation){var o=this._dvl.Scene.RetrieveProcedures(this._dvlSceneRef),n=e.animation.procedureIndex,a=e.animation.stepIndex,s=e.animation.stepVeId,l,h=e.animation.animationTime||0;if(s||a>=0&&n>=0){if(s){l=this._getStepIdByVeId(o.procedures,e.animation.stepVeId)}else if(n>=0&&n<o.procedures.length){if(a>=0&&a<o.procedures[n].steps.length){l=o.procedures[n].steps[a].id}else{C.error(d().getText(v.VIT26.summary),v.VIT26.code,"sap.ui.vk.dvl.Viewport")}}else{C.error(d().getText(v.VIT27.summary),v.VIT27.code,"sap.ui.vk.dvl.Viewport")}if(l){this._dvl.Renderer.ActivateStep(this._dvlRendererId,l,false,false,h);this._dvl.Renderer.PauseCurrentStep(this._dvlRendererId)}}else{i=true}}if(e.camera){var c;if(e.camera.projectionType===r.Perspective||e.camera.projectionType===r.Orthographic){c=V.decodedProjectionType[e.camera.projectionType]}else{C.error(d().getText(v.VIT19.summary),v.VIT19.code,"sap.ui.vk.dvl.Viewport");c=sap.ve.dvl.DVLCAMERAPROJECTION.PERSPECTIVE}var p=this._dvl.Scene.CreateCamera(this._dvlSceneRef,c,sap.ve.dvl.DVLID_INVALID);if(c===sap.ve.dvl.DVLCAMERAPROJECTION.PERSPECTIVE){this._dvl.Camera.SetFOV(p,e.camera.fieldOfView)}else if(c===sap.ve.dvl.DVLCAMERAPROJECTION.ORTHOGRAPHIC){this._dvl.Camera.SetOrthoZoomFactor(p,e.camera.zoomFactor)}if(e.camera.position){this._dvl.Camera.SetOrigin(p,e.camera.position.x,e.camera.position.y,e.camera.position.z)}if(e.camera.rotation){this._dvl.Camera.SetRotation(p,e.camera.rotation.yaw,e.camera.rotation.pitch,e.camera.rotation.roll)}if(e.camera.bindingType){var f=V.decodedBindingType[e.camera.bindingType]||sap.ve.dvl.DVLCAMERAFOVBINDING.MIN;this._dvl.Camera.SetFOVBinding(p,f)}t=t||0;this._dvl.Renderer.ActivateCamera(this._dvlRendererId,p,t);this._dvl.Scene.DeleteNode(this._dvlSceneRef,p)}if(e.viewMatrix){this._matView=e.viewMatrix.slice()}if(e.projectionMatrix){this._matProj=e.projectionMatrix.slice()}if(e.visibility){var _=this._viewStateManager.getNodeHierarchy(),m=new Map,R=_.findNodesByName();R.forEach(function(e){var t=_.createNodeProxy(e),i=jQuery.grep(t.getVeIds(),function(e){return e.type==="VE_LOCATOR"});i=Array.isArray(i)&&i.length>0?i[0].fields[0].value:null;_.destroyNodeProxy(t);if(i){m.set(i,e)}});switch(e.visibility.mode){case u.Complete:var g=e.visibility.visible,y=e.visibility.hidden;g.forEach(function(e){this._viewStateManager.setVisibilityState(m.get(e),true,false)},this);y.forEach(function(e){this._viewStateManager.setVisibilityState(m.get(e),false,false)},this);break;case u.Differences:if(i){this.resetView({camera:false,visibility:true,transition:false})}e.visibility.changes.forEach(function(e){var t=m.get(e);if(t){this._viewStateManager.setVisibilityState(t,!this._viewStateManager.getVisibilityState(t),false)}},this);break;default:C.error(d().getText(v.VIT28.summary),v.VIT28.code,"sap.ui.vk.dvl.Viewport");break}}return this};T.prototype.setSelectionRect=function(e){if(!e){this._dvl.Renderer.DrawSelectionRect(0,0,0,0,this._dvlRendererId)}else{var t=this._toDvlRendererCoord(e.x1,e.y1);var i=this._toDvlRendererCoord(e.x2,e.y2);this._dvl.Renderer.DrawSelectionRect(t.x,t.y,i.x,i.y,this._dvlRendererId)}};T.prototype.getOutputSize=function(){var e=this.getViewInfo().camera.bindingType,t=this.getDomRef().getBoundingClientRect(),i=t.width,r=t.height,o;switch(V.decodedBindingType[e]){case sap.ve.dvl.DVLCAMERAFOVBINDING.MIN:o=Math.min(i,r);break;case sap.ve.dvl.DVLCAMERAFOVBINDING.MAX:o=Math.max(i,r);break;case sap.ve.dvl.DVLCAMERAFOVBINDING.HORZ:o=i;break;case sap.ve.dvl.DVLCAMERAFOVBINDING.VERT:o=r;break;default:break}return{left:(i-o)/2,top:(r-o)/2,sideLength:o}};T.prototype.onBeforeRendering=function(){if(this._resizeListenerId){e.deregister(this._resizeListenerId);this._resizeListenerId=null}};T.prototype.onAfterRendering=function(){var t=this.getDomRef();if(this._canvas){t.appendChild(this._canvas)}this._resizeListenerId=e.register(this,this._handleResize.bind(this));this._handleResize({size:{width:t.clientWidth,height:t.clientHeight}})};T.prototype._handleResize=function(e){if(this._dvlRendererId&&this._canvas){var t=e.size.width*window.devicePixelRatio;var i=e.size.height*window.devicePixelRatio;if(this._matProj){var r=this._matProj[0];var o=this._matProj[5];var n=Math.max(r,o);if(t>i){r=n*i/t;o=n}else{r=n;o=n*t/i}this._matProj[8]*=r/this._matProj[0];this._matProj[9]*=o/this._matProj[5];this._matProj[0]=r;this._matProj[5]=o}var a=96*window.devicePixelRatio;var s=this.getAggregation("outputSettings");this._gestureRatio=1;if(this.getKeepOutputSize()&&s&&s.getDpi()>0){var d=s.getWidth()/25.4*a;var l=s.getHeight()/25.4*a;var h=d/t;var v=l/i;var c=h>v?h:v;t*=c;i*=c;this._gestureRatio=c}this._dvl.Renderer.SetDimensions(t,i,this._dvlRendererId);this._dvl.Renderer.SetOptionF(sap.ve.dvl.DVLRENDEROPTIONF.DVLRENDEROPTIONF_DPI,a,this._dvlRendererId);this._dvl.Renderer.SetOptionF(sap.ve.dvl.DVLRENDEROPTIONF.DVLRENDEROPTIONF_MIN_VISIBLE_OBJECT_SIZE,1,this._dvlRendererId);this._canvas.width=t;this._canvas.height=i;this._canvas.style.width=e.size.width+"px";this._canvas.style.height=e.size.height+"px";this.fireResize({size:{width:e.size.width,height:e.size.height}});return true}return false};T.prototype._onVisibilityChanged=T.prototype._onSelectionChanged=T.prototype._onOpacityChanged=T.prototype._onTintColorChanged=function(e){if(this._dvlRendererId){this._dvl.Renderer.ForceRenderFrame(this._dvlRendererId)}};T.prototype.showHotspots=function(e,t,i){var r=sap.ui.vk.dvl.NodeProxy.prototype[typeof i==="string"?"setTintColor":"setTintColorABGR"];var o=function(e,t,i){var o=e.createNodeProxy(i);r.call(o,t);e.destroyNodeProxy(o)};if(!Array.isArray(e)){e=[e]}var n=i===undefined?this.getHotspotColorABGR():i;if(!t){n=0}var a=this._viewStateManager.getNodeHierarchy();if(this._isSmart2DContent()){var s=[];e.forEach(function(e){var t=g(this._dvl.Scene.RetrieveNodeInfo(this._dvlSceneRef,e,sap.ve.dvl.DVLNODEINFO.DVLNODEINFO_CHILDREN).ChildNodes);if(t){for(var i=0;i<t.length;i++){s.push(t[i])}}}.bind(this));for(var d=0;d<e.length;d++){s.push(e[d])}s.forEach(o.bind(null,a,n))}else{var l=[];var h=function(e){var t=a.getChildren(e);for(var i=0;i<t.length;i++){l.push(t[i])}t.forEach(h)};e.forEach(h);for(var v=0;v<e.length;v++){l.push(e[v])}l.forEach(o.bind(null,a,n))}return this};T.prototype._getDecomposedABGR=function(e){return{red:(e>>>0&255)/255,green:(e>>>8&255)/255,blue:(e>>>16&255)/255,alpha:(e>>>24&255)/255}};T.prototype._setBackgroundColor=function(){if(this._dvl){var e=this._getDecomposedABGR(this.getBackgroundColorTopABGR()),t=this._getDecomposedABGR(this.getBackgroundColorBottomABGR());this._dvl.Renderer.SetBackgroundColor(e.red,e.green,e.blue,e.alpha,t.red,t.green,t.blue,t.alpha,this._dvlRendererId)}};T.prototype.setBackgroundColorTopABGR=function(e){this.setProperty("backgroundColorTopABGR",e,true);this._setBackgroundColor();return this};T.prototype.setBackgroundColorTop=function(e){this.setProperty("backgroundColorTop",e,true);return this.setBackgroundColorTopABGR(o(s(e)))};T.prototype.setBackgroundColorBottomABGR=function(e){this.setProperty("backgroundColorBottomABGR",e,true);this._setBackgroundColor();return this};T.prototype.setBackgroundColorBottom=function(e){this.setProperty("backgroundColorBottom",e,true);return this.setBackgroundColorBottomABGR(o(s(e)))};T.prototype.setKeepOutputSize=function(e){this.setProperty("keepOutputSize",e);this._updateViewportSize()};T.prototype.setOutputSettings=function(e){this.setAggregation("outputSettings",e);this._updateViewportSize()};T.prototype._updateViewportSize=function(){var e=this.getDomRef();if(e){this._handleResize({size:{width:e.clientWidth,height:e.clientHeight}})}};T.prototype.setShouldRenderFrame=function(){if(this._dvlRendererId){this._dvl.Renderer.ForceRenderFrame(this._dvlRendererId)}return this};T.prototype.shouldRenderFrame=function(){return this._dvlRendererId&&this._dvl.Renderer.ShouldRenderFrame(this._dvlRendererId)};function A(e,t,i){return e+(t-e)*i}function M(e,t,i){i=Math.min(Math.max((i-e)/(t-e),0),1);return i*i*i*(i*(i*6-15)+10)}T.prototype._updateRedlineZoomToAnimation=function(){var e=this._anim;var t=e.startProjRect;var i=e.endProjRect;var r=Math.min(M(0,1,(Date.now()-e.startTime)/e.duration),1);var o={left:A(t.left,i.left,r),right:A(t.right,i.right,r),top:A(t.top,i.top,r),bottom:A(t.bottom,i.bottom,r)};if(this._redlineHandler){var n=e.currentProjRect;var a=(n.left+n.right)*.5;var s=(n.top+n.bottom)*.5;var d=(o.left+o.right)*.5;var l=(o.top+o.bottom)*.5;var h=this.getDomRef();var v=(a-d)*h.clientWidth/(n.right-n.left);var c=(s-l)*h.clientHeight/(n.bottom-n.top);this._redlineHandler.pan(v,c);this._redlineHandler.zoom((n.right-n.left)/(o.right-o.left),h.clientWidth*.5,h.clientHeight*.5);e.currentProjRect=o}B(this._matProj,o);if(r>=1){delete this._anim}};T.prototype.renderFrame=function(){if(this._dvlRendererId){if(this._matView&&this._matProj){if(this._anim){this._updateRedlineZoomToAnimation()}this.renderFrameEx(this._matView,this._matProj,this._dvlRendererId);if(this._anim){this.setShouldRenderFrame()}}else{this._dvl.Renderer.RenderFrame(this._dvlRendererId)}}return this};T.prototype.renderFrameEx=function(e,t){if(this._dvlRendererId){this._dvl.Renderer.RenderFrameEx.apply(this,[].concat(e,t),this._dvlRendererId)}return this};T.prototype.resetView=function(e){if(e!==undefined&&!jQuery.isPlainObject(e)){C.error(d().getText(v.VIT31.summary),v.VIT31.code,"sap.ui.vk.dvl.Viewport")}var t={camera:true,transition:true,visibility:false};jQuery.extend(t,e);if(t.camera||t.visibility){var i=(t.camera?sap.ve.dvl.DVLRESETVIEWFLAG.CAMERA:0)|(t.transition?sap.ve.dvl.DVLRESETVIEWFLAG.SMOOTHTRANSITION:0)|(t.visibility?sap.ve.dvl.DVLRESETVIEWFLAG.VISIBILITY:0);if(this._dvlRendererId){this._dvl.Renderer.ResetView(i,this._dvlRendererId);this._lastPlayedStep=null}}return this};T.prototype.canIsolateNode=function(e){if(this._dvlRendererId){return this._dvl.Renderer.CanIsolateNode(e,this._dvlRendererId)}else{return false}};T.prototype.setIsolatedNode=function(e){if(this._dvlRendererId){this._dvl.Renderer.SetIsolatedNode(e,this._dvlRendererId)}return this};T.prototype.getIsolatedNode=function(){if(this._dvlRendererId){return this._dvl.Renderer.GetIsolatedNode(this._dvlRendererId)}else{return sap.ve.dvl.DVLID_INVALID}};T.prototype._toDvlRendererCoord=function(e,t){if(this._matProj){var i=this.getDomRef();var r=L(this._matProj);var o=L(this._dvl.Renderer.GetCameraMatrices().projection);var n=r.left+(r.right-r.left)*(e/i.clientWidth);var a=r.top+(r.bottom-r.top)*(t/i.clientHeight);e=(n-o.left)/(o.right-o.left)*i.clientWidth;t=(a-o.top)/(o.bottom-o.top)*i.clientHeight}return{x:e*window.devicePixelRatio*this._gestureRatio,y:t*window.devicePixelRatio*this._gestureRatio}};T.prototype.hitTest=function(e,t){if(this._dvlRendererId){var i=this._toDvlRendererCoord(e,t);var r=this._dvl.Renderer.HitTest(i.x,i.y,this._dvlRendererId).id;this.setShouldRenderFrame();return r}else{return null}};T.prototype.setShowDebugInfo=function(e){this.setProperty("showDebugInfo",e,true);if(this._dvlRendererId){this._dvl.Renderer.SetOption(sap.ve.dvl.DVLRENDEROPTION.DVLRENDEROPTION_SHOW_DEBUG_INFO,e,this._dvlRendererId)}return this};T.prototype._handleFrameFinished=function(e){if(e.rendererId===this._dvlRendererId){this.fireFrameRenderingFinished()}};T.prototype.beginGesture=function(e,t){if(this._dvlRendererId){this._gesturePoint={x:e,y:t};var i=this._toDvlRendererCoord(e,t);this._dvl.Renderer.BeginGesture(i.x,i.y,this._dvlRendererId)}return this};T.prototype.endGesture=function(){if(this._dvlRendererId){this._dvl.Renderer.EndGesture(this._dvlRendererId)}return this};T.prototype._activateRedline=function(){this.renderFrame();var e=this._dvl.Renderer.GetCameraMatrices();this._matView=e.view;this._matProj=e.projection};T.prototype._deactivateRedline=function(){this._matView=null;this._matProj=null};T.prototype.pan=function(e,t){if(this._dvlRendererId&&!this.getFreezeCamera()){if(this._redlineHandler){this._redlineHandler.pan(e,t)}if(this._matProj){var i=this.getDomRef();this._matProj[8]-=e*2/i.clientWidth;this._matProj[9]+=t*2/i.clientHeight;this.setShouldRenderFrame()}else{this._dvl.Renderer.Pan(e*window.devicePixelRatio*this._gestureRatio,t*window.devicePixelRatio*this._gestureRatio,this._dvlRendererId)}this.firePan({dx:e,dy:t})}return this};T.prototype.rotate=function(e,t){if(this._dvlRendererId&&!this.getFreezeCamera()){if(this._redlineHandler){return this.pan(e,t)}this._dvl.Renderer.Rotate(e*window.devicePixelRatio*this._gestureRatio,t*window.devicePixelRatio*this._gestureRatio,this._dvlRendererId);this.fireRotate({dx:e,dy:t})}return this};function L(e){var t=e[15]===1;var i=2/e[0];var r=2/e[5];var o,n;if(t){o=-e[12]*i;n=-e[13]*r}else{o=e[8]*i;n=e[9]*r}var a=(i+o)*.5;var s=o-a;var d=(r+n)*.5;var l=n-d;return{left:s,top:d,right:a,bottom:l}}function B(e,t){var i=e[15]===1;e[0]=2/(t.right-t.left);e[5]=2/(t.top-t.bottom);if(i){e[12]=-(t.right+t.left)/(t.right-t.left);e[13]=-(t.top+t.bottom)/(t.top-t.bottom)}else{e[8]=(t.right+t.left)/(t.right-t.left);e[9]=(t.top+t.bottom)/(t.top-t.bottom)}}T.prototype.zoom=function(e){if(this._dvlRendererId&&!this.getFreezeCamera()){if(this._redlineHandler){this._redlineHandler.zoom(e)}if(this._matProj){var t=this.getDomRef();var i=L(this._matProj);var r=i.left+(i.right-i.left)*this._gesturePoint.x/t.clientWidth;var o=i.top+(i.bottom-i.top)*this._gesturePoint.y/t.clientHeight;var n=1/e;i.left=r+(i.left-r)*n;i.right=r+(i.right-r)*n;i.top=o+(i.top-o)*n;i.bottom=o+(i.bottom-o)*n;B(this._matProj,i);this.setShouldRenderFrame()}else{this._dvl.Renderer.Zoom(e,this._dvlRendererId)}this.fireZoom({zoomFactor:e})}return this};T.prototype.zoomTo=function(e,t,i,r){if(this._dvlRendererId){var o=0;if(Array.isArray(e)){for(var n in e){o|=V.decodedZoomTo[e[n]]}}else{o=V.decodedZoomTo[e]}this._dvl.Renderer.ZoomTo(o,t,i,r,this._dvlRendererId)}return this};T.prototype._redlineZoomTo=function(e){var t=[Infinity,Infinity,-Infinity,-Infinity];if(e!==sap.ve.dvl.DVLID_INVALID){var i=this._dvl.Scene.RetrieveNodeInfo(this._dvlSceneRef,e,sap.ve.dvl.DVLNODEINFO.DVLNODEINFO_BBOX).bbox;var r=this._dvl.Scene.GetNodeWorldMatrix(this._dvlSceneRef,e).matrix;if(i&&r){var o=l.vec3,n=l.mat4;var a=n.multiply(n.create(),this._matProj,this._matView);var s=n.multiply(n.create(),a,r);var d=i.min,h=i.max;[o.fromValues(d[0],d[1],d[2]),o.fromValues(h[0],h[1],h[2]),o.fromValues(d[0],d[1],h[2]),o.fromValues(d[0],h[1],h[2]),o.fromValues(h[0],d[1],h[2]),o.fromValues(h[0],h[1],d[2]),o.fromValues(d[0],h[1],d[2]),o.fromValues(h[0],d[1],d[2])].forEach(function(e){o.transformMat4(e,e,s);if(e[2]>0){t[0]=Math.min(t[0],e[0]);t[1]=Math.min(t[1],e[1]);t[2]=Math.max(t[2],e[0]);t[3]=Math.max(t[3],e[1])}})}}var v=L(this._matProj);this._anim={startTime:Date.now(),duration:500,startProjRect:v,currentProjRect:v};if(t[2]>t[0]&&t[3]>t[1]){var c=this._anim.startProjRect;var p=A(c.left,c.right,(t[0]+t[2])*.25+.5);var f=A(c.top,c.bottom,(t[3]+t[1])*-.25+.5);var _=Math.max(t[2]-t[0],t[3]-t[1])*.5;var u=(c.right-c.left)*.5*_;var m=(c.top-c.bottom)*.5*_;this._anim.endProjRect={left:p-u,top:f+m,right:p+u,bottom:f-m}}else{this._anim.endProjRect=L(this._dvl.Renderer.GetCameraMatrices().projection)}this.setShouldRenderFrame()};T.prototype.tap=function(e,t,i){if(this._dvlRendererId){var r=this._toDvlRendererCoord(e,t),o;if(!i){o=this.hitTest(e,t);var n={picked:o===sap.ve.dvl.DVLID_INVALID||o==null?[]:[o]};this.fireNodesPicked(n);if(this.getSelectionMode()===c.Exclusive){this.exclusiveSelectionHandler(n.picked)}else if(this.getSelectionMode()===c.Sticky){this.stickySelectionHandler(n.picked)}if(o!==sap.ve.dvl.DVLID_INVALID){this.fireNodeClicked({nodeRef:o,nodeId:o,x:e,y:t},true,true)}this._dvl.Renderer.Tap(r.x,r.y,false,false,this._dvlRendererId)}else if(!this.getFreezeCamera()){if(this._matView&&this._matProj){o=this.hitTest(e,t);this._redlineZoomTo(o)}else{this._dvl.Renderer.Tap(r.x,r.y,true,false,this._dvlRendererId)}}}return this};T.prototype.rectSelect=function(e,t,i,r){var o=[];if(this._dvlRendererId){var n=this._toDvlRendererCoord(e,t);var a=this._toDvlRendererCoord(i,r);var s=g(this._dvl.Renderer.RectSelect(n.x,n.y,a.x,a.y,this._dvlRendererId));if(s.SelectedNodes){o=s.SelectedNodes}}return o};T.prototype.queueCommand=function(e){if(this._dvlRendererId){this._dvl.Renderer._queueCommand(e,this._dvlRendererId)}return this};T.prototype._setContent=function(e){O._setContent.apply(this,arguments);var t=null;if(e&&e instanceof y){t=e}this._setScene(t);return this};T.prototype._setScene=function(e){var t=e&&e.getGraphicsCore();this.setGraphicsCore(t);this.setScene(e);if(e&&(this._isSmart2DContent()||this._isSmart2DContentLegacy())){this._initializeSmart2DHandler()}};T.prototype.onSetContentConnector=function(e){f.prototype.onSetContentConnector.call(this,e);e.attachContentChangesFinished(this._onContentChangesFinished,this)};T.prototype.onUnsetContentConnector=function(e){e.detachContentChangesFinished(this._onContentChangesFinished,this);f.prototype.onUnsetContentConnector.call(this,e)};T.prototype._onContentChangesFinished=function(e){if(e.getSource().getContentResources().length>1){this.zoomTo(m.Visible,sap.ve.dvl.DVLID_INVALID,0,0)}this.setShouldRenderFrame()};T.prototype.onSetViewStateManager=function(e){this._viewStateManager=e;e.attachOpacityChanged(this._onOpacityChanged,this);e.attachSelectionChanged(this._onSelectionChanged,this);e.attachTintColorChanged(this._onTintColorChanged,this);e.attachVisibilityChanged(this._onVisibilityChanged,this);if(this._dvl){this._dvl.Renderer.SetViewStateManager(e,this._dvlRendererId);if(this._isSmart2DContent()||this._isSmart2DContentLegacy()){this._initializeSmart2DHandler()}}};T.prototype.onUnsetViewStateManager=function(e){if(this._dvl){this._dvl.Renderer.SetViewStateManager(null,this._dvlRendererId)}e.detachOpacityChanged(this._onOpacityChanged,this);e.detachSelectionChanged(this._onSelectionChanged,this);e.detachTintColorChanged(this._onTintColorChanged,this);e.detachVisibilityChanged(this._onVisibilityChanged,this);this._viewStateManager=null};var x={x:-2,y:-2};var F=2;var G=5;[{key:"left",dx:-F,dy:0},{key:"right",dx:+F,dy:0},{key:"up",dx:0,dy:-F},{key:"down",dx:0,dy:+F}].forEach(function(e){T.prototype["onsap"+e.key]=function(t){this.beginGesture(x.x,x.y);this.rotate(e.dx,e.dy);this.endGesture();this.setShouldRenderFrame();t.preventDefault();t.stopPropagation()}});[{key:"left",dx:-G,dy:0},{key:"right",dx:+G,dy:0},{key:"up",dx:0,dy:-G},{key:"down",dx:0,dy:+G}].forEach(function(e){T.prototype["onsap"+e.key+"modifiers"]=function(t){if(t.shiftKey&&!(t.ctrlKey||t.altKey||t.metaKey)){this.beginGesture(x.x,x.y);this.pan(e.dx,e.dy);this.endGesture();this.setShouldRenderFrame();t.preventDefault();t.stopPropagation()}}});[{key:"minus",d:.98},{key:"plus",d:1.02}].forEach(function(e){T.prototype["onsap"+e.key]=function(t){this.beginGesture(this.$().width()/2,this.$().height()/2);this.zoom(e.d);this.endGesture();this.setShouldRenderFrame();t.preventDefault();t.stopPropagation()}});return T});
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/dvl/ViewportRenderer", [],function(){"use strict";var e={apiVersion:2};e.render=function(e,t){e.openStart("div",t);e.class("sapVizKitViewport");e.attr("tabindex",0);e.attr("aria-label","Image");e.attr("role","figure");var r=t.getWidth();if(r){e.style("width",r)}var i=t.getHeight();if(i){e.style("height",i)}e.openEnd();t.renderTools(e);t.renderContent(e);e.close("div")};return e},true);
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/dvl/checkResult", ["sap/base/Log","../DvlException"],function(e,r){"use strict";var t=function(t){if(t<0){var i=sap.ve.dvl.DVLRESULT.getDescription?sap.ve.dvl.DVLRESULT.getDescription(t):"";e.error(i,JSON.stringify({errorCode:t}),"sap.ve.dvl");throw new r(t,i)}return t};return t},true);
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/dvl/getJSONObject", ["sap/base/Log","../DvlException"],function(e,r){"use strict";var t=function(t){if(typeof t==="number"){var i=t;var n=sap.ve.dvl.DVLRESULT.getDescription?sap.ve.dvl.DVLRESULT.getDescription(i):"";e.error(n,JSON.stringify({errorCode:i}),"sap.ve.dvl");throw new r(i,n)}return t};return t},true);
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/dvl/getPointer", ["sap/base/Log","../DvlException"],function(e,r){"use strict";var t=function(t){if(typeof t==="number"){var i=t;var n=sap.ve.dvl.DVLRESULT.getDescription?sap.ve.dvl.DVLRESULT.getDescription(i):"";e.error(n,JSON.stringify({errorCode:i}),"sap.ve.dvl");throw new r(i,n)}return t};return t},true);
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/ecad/ElementsPanel", ["sap/m/VBox","sap/m/Button","sap/m/OverflowToolbar","sap/m/ToolbarSpacer","sap/m/Label","sap/m/Input","sap/m/Table","sap/m/table/ColumnWidthController","sap/m/table/columnmenu/Menu","sap/m/table/columnmenu/QuickGroup","sap/m/table/columnmenu/QuickGroupItem","sap/m/table/columnmenu/QuickSort","sap/m/table/columnmenu/QuickSortItem","sap/m/Column","sap/m/ColumnListItem","sap/m/plugins/ColumnResizer","sap/m/MultiComboBox","sap/m/IllustratedMessage","sap/m/IllustratedMessageType","sap/m/p13n/Engine","sap/m/p13n/SelectionController","sap/m/p13n/GroupController","sap/m/p13n/SortController","sap/m/p13n/MetadataHelper","sap/ui/core/Control","sap/ui/core/CustomData","sap/ui/core/Element","sap/ui/core/Icon","sap/ui/core/Lib","sap/ui/core/library","sap/ui/model/json/JSONModel","sap/ui/model/Filter","sap/ui/model/FilterOperator","sap/ui/model/Sorter","../Core","./VisibilityType","../getResourceBundle","sap/m/library"],function(e,t,n,s,i,a,o,r,l,h,p,c,u,d,g,_,m,f,y,E,b,S,T,C,w,N,P,L,M,v,B,k,x,I,A,V,O,F){"use strict";const D=v.SortOrder;const R={Hidden:"sap-icon://hide",Partial:"sap-icon://vk-icons/partially-visible-element",Visible:"sap-icon://show"};const H={RefDes:"refdes",Type:"type",Device:"deviceref",Visibility:"visibility"};const U={Component:"2",Net:"4"};const z={FilterSummary:"FilterSummary",ElementType:"ElementType"};function G(e){return e.data("key")}function W(e,t){return e.find(e=>G(e)===t)}function Y(e,t){for(let n=t.getParent();n!=null;n=n.getParent()){if(n===e){return true}}return false}function K(e){if(e.hiddenParts.size===0){return V.Visible}else if(e.hiddenParts.size<e.parts.size){return V.Partial}return V.Hidden}function j(e){const t=e?.userData?.metadata??{};if(t.length!=undefined){const e=new Map;t.forEach(t=>{if(t.category==="ecad"){e.set(t.tag,t.value)}});return e}return null}function Q(e){switch(e.type){case U.Component:return O().getText("ELEMENTS_PANEL_TYPE_COMPONENT");case U.Net:return O().getText("ELEMENTS_PANEL_TYPE_NET");default:return O().getText("ELEMENTS_PANEL_TYPE_UNKNOWN")}}var q=w.extend("sap.ui.vk.ecad.ElementsPanel",{metadata:{library:"sap.ui.vk",properties:{width:{type:"sap.ui.core.CSSSize",defaultValue:"auto"},height:{type:"sap.ui.core.CSSSize",defaultValue:"100%"}},aggregations:{content:{type:"sap.ui.core.Control",multiple:false,visibility:"hidden"}},associations:{contentConnector:{type:"sap.ui.vk.ContentConnector",multiple:false},viewStateManager:{type:"sap.ui.vk.ViewStateManagerBase",multiple:false}},events:{contentChanged:{enableEventBubbling:true}}},renderer:{apiVersion:2,render:function(e,t){e.openStart("div",t);e.class("sapUiSizeCompact");const n=t.getWidth();if(n!=null){e.style("width",n)}const s=t.getHeight();if(s!=null){e.style("height",s)}e.openEnd();e.renderControl(t.getAggregation("content"));e.close("div")}},constructor:function(e,t){w.apply(this,arguments);A.observeAssociations(this)}});q.prototype.onSetViewStateManager=function(e){this._manager=e;e.attachSelectionChanged(this._onViewportSelectionChanged,this);e.attachVisibilityChanged(this._onVisibilityChanged,this);this._refresh()};q.prototype.onUnsetViewStateManager=function(e){this._manager=null;e.detachSelectionChanged(this._onViewportSelectionChanged,this);e.detachVisibilityChanged(this._onVisibilityChanged,this);this._refresh()};q.prototype.onSetContentConnector=function(e){e.attachContentReplaced(this._onContentReplaced,this);this._setContent(e.getContent())};q.prototype.onUnsetContentConnector=function(e){this._setContent(null);e.detachContentReplaced(this._onContentReplaced,this)};q.prototype.init=function(){w.prototype.init?.apply(this);const r={expandedFilterSummary:"",snappedFilterSummary:""};const b=[U.Component,U.Net];this._scene=null;this._model=new B;this._skipEvent=false;this._filterSummaryModel=new B(r);this._elementTypeModel=new B(b);this.setModel(this._filterSummaryModel,z.FilterSummary);this.setModel(this._elementTypeModel,z.ElementType);this.setAggregation("content",new f({illustrationType:y.NoData,enableVerticalResponsiveness:true}));this._promise=Promise.all([M.load("sap.f"),M.load("sap.ui.comp")]).then(()=>new Promise(r=>{sap.ui.require(["sap/f/DynamicPage","sap/f/DynamicPageTitle","sap/f/DynamicPageHeader","sap/ui/comp/filterbar/FilterBar","sap/ui/comp/filterbar/FilterGroupItem"],(b,S,T,C,w)=>{this._showButton=new t({enabled:false,icon:R.Visible,text:O().getText("ELEMENTS_PANEL_SHOW_BUTTON"),tooltip:O().getText("ELEMENTS_PANEL_SHOW_BUTTON_TOOLTIP"),press:this._onShowElements.bind(this)});this._hideButton=new t({enabled:false,icon:R.Hidden,text:O().getText("ELEMENTS_PANEL_HIDE_BUTTON"),tooltip:O().getText("ELEMENTS_PANEL_HIDE_BUTTON_TOOLTIP"),press:this._onHideElements.bind(this)});this._settingsButton=new t({icon:"sap-icon://action-settings",tooltip:O().getText("ELEMENTS_PANEL_SETTINGS_BUTTON_TOOLTIP"),press:this._onSettings.bind(this)});const P=new l({showTableSettingsButton:true,beforeOpen:this._onBeforeOpenColumnMenu.bind(this),tableSettingsPressed:this._onSettings.bind(this),quickActions:[new c({change:this._onSort.bind(this),items:[new u]})]});const M=new l({showTableSettingsButton:true,beforeOpen:this._onBeforeOpenColumnMenu.bind(this),tableSettingsPressed:this._onSettings.bind(this),quickActions:[new c({change:this._onSort.bind(this),items:[new u]}),new h({change:this._onGroup.bind(this),items:[new p]})]});this._rowTemplate=new g({vAlign:"Middle",cells:[new i({text:"{refdes}",customData:new N({key:"key",value:H.RefDes})}),new i({text:{path:"",formatter:Q,customData:new N({key:"key",value:H.Type})}}),new i({text:"{deviceref}",customData:new N({key:"key",value:H.Device})}),new L({src:{path:"",formatter:function(e){switch(K(e)){case V.Hidden:return R.Hidden;case V.Partial:return R.Partial;default:return R.Visible}}},tooltip:{path:"",formatter:function(e){switch(K(e)){case V.Hidden:return O().getText("ELEMENTS_PANEL_VISIBLE_COLUMN_HIDDEN_TOOLTIP");case V.Partial:return O().getText("ELEMENTS_PANEL_VISIBLE_COLUMN_PARTIAL_TOOLTIP");default:return O().getText("ELEMENTS_PANEL_VISIBLE_COLUMN_VISIBLE_TOOLTIP")}}},customData:new N({key:"key",value:H.Visibility})})]});this._table=new o({id:"elements-table",mode:"MultiSelect",fixedLayout:"Strict",autoPopinMode:true,popinLayout:"GridSmall",includeItemInSelection:true,sticky:[F.Sticky.HeaderToolbar,F.Sticky.ColumnHeaders],selectionChange:this._onTableSelectionChanged.bind(this),headerToolbar:new n({content:[new s,this._showButton,this._hideButton,this._settingsButton]}),dependents:[new _({columnResize:this._onColumnResize.bind(this)})],columns:[new d({headerMenu:P,hAlign:v.TextAlign.Begin,customData:new N({key:"key",value:H.RefDes}),header:new i({text:O().getText("ELEMENTS_PANEL_NAME_COLUMN")})}),new d({headerMenu:M,hAlign:v.TextAlign.Begin,customData:new N({key:"key",value:H.Type}),header:new i({text:O().getText("ELEMENTS_PANEL_TYPE_COLUMN")})}),new d({headerMenu:M,hAlign:v.TextAlign.Begin,customData:new N({key:"key",value:H.Device}),header:new i({text:O().getText("ELEMENTS_PANEL_DEVICE_REFERENCE_COLUMN")})}),new d({hAlign:v.TextAlign.Center,customData:new N({key:"key",value:H.Visibility}),header:new i({text:O().getText("ELEMENTS_PANEL_VISIBLE_COLUMN")})})],items:{path:"/",template:this._rowTemplate}});this._table.setModel(this._model);this._filterBar=new C({useToolbar:false,persistencyKey:"Filters",search:this._onSearch.bind(this),filterChange:this._onFilterChange.bind(this),assignedFiltersChanged:this._onAssignedFiltersChanged.bind(this),filterGroupItems:[new w({name:H.RefDes,label:O().getText("REFDES_FILTER_LABEL"),groupName:"basic",visible:true,visibleInFilterBar:true,control:new a({change:this._onFilterChange.bind(this)})}),new w({name:H.Type,label:O().getText("TYPE_FILTER_LABEL"),groupName:"basic",visible:true,visibleInFilterBar:true,control:new m({selectionChange:this._onFilterChange.bind(this),items:{path:z.ElementType+">/",templateShareable:false,template:new sap.ui.core.Item({key:"{"+z.ElementType+">}",text:{path:z.ElementType+">",formatter:function(e){switch(e){case U.Component:return O().getText("ELEMENTS_PANEL_TYPE_COMPONENT");case U.Net:return O().getText("ELEMENTS_PANEL_TYPE_NET");default:return O().getText("ELEMENTS_TYPE_FILTER_ALL")}}}})}})}),new w({name:H.Device,label:O().getText("DEVICE_REF_FILTER_LABEL"),groupName:"basic",visible:true,visibleInFilterBar:true,control:new a({change:this._onFilterChange.bind(this)})})]});this._page=new b({visible:false,fitContent:true,showFooter:false,headerExpanded:false,title:new S({heading:this._filterTitle,expandedContent:new i({text:"{"+z.FilterSummary+">/expandedFilterSummary}"}),snappedContent:new i({text:"{"+z.FilterSummary+">/snappedFilterSummary}"})}),header:new T({content:this._filterBar}),content:this._table});this._message=new f({illustrationType:y.NoData,enableVerticalResponsiveness:true});const B=new e({height:"100%",renderType:F.FlexRendertype.Bare,items:[this._page,this._message]});this.destroyAggregation("content");this.setAggregation("content",B);this._p13nEngine=E.getInstance();this._registerForP13n();this._filterBar.addEventDelegate({onsapenter:e=>{const t=e.srcControl;if(this._filterBar.getFilterGroupItems().some(e=>{const n=e.getControl();return n===t||Y(n,t)})){this._onAssignedFiltersChanged();this._updateFilterBarToolbarText();this._onSearch()}}});this._filterBar.registerGetFiltersWithValues(this._getFiltersWithValues.bind(this));this._onAssignedFiltersChanged();this._updateFilterBarToolbarText();r()})}))};q.prototype.exit=function(){this._promise=this._promise.then(()=>{this._p13nEngine.detachStateChange(this._onTableStateChange);this._p13nEngine.deregister(this._table);this._p13nEngine=null;this._metadataHelper.destroy();this._metadataHelper=null;this._model.destroy();this._model=null;this._elementTypeModel.destroy();this._elementTypeModel=null;this._filterSummaryModel.destroy();this._filterSummaryModel=null;w.prototype.exit?.apply(this)})};q.prototype._updateMessage=function(e){const t=this._table.getItems().length>0;const n=e===true?this._table:this._page;n.setVisible(t);this._message.setVisible(!t);this._message.setIllustrationType(e===true?y.NoFilterResults:sap.m.IllustratedMessageType.NoData)};q.prototype._refresh=async function(){await this._promise;if(!this._scene||!this._manager){this._model?.setData([]);this._updateMessage(false);return}const e=new Map;this._scanTree(e,this._scene.getRootElement());const t=e.values().toArray();this._model.setSizeLimit(t.length);this._model.setData(t);this._table.setModel(this._model);this._updateMessage(false);this.fireContentChanged()};q.prototype._registerForP13n=function(){this._metadataHelper=new C([{groupable:false,key:H.RefDes,path:H.RefDes,label:O().getText("ELEMENTS_PANEL_NAME_COLUMN")},{key:H.Type,path:H.Type,label:O().getText("ELEMENTS_PANEL_TYPE_COLUMN")},{key:H.Device,path:H.Device,label:O().getText("ELEMENTS_PANEL_DEVICE_REFERENCE_COLUMN")},{sortable:false,groupable:false,key:H.Visibility,path:H.Visibility,label:O().getText("ELEMENTS_PANEL_VISIBLE_COLUMN")}]);this._p13nEngine.register(this._table,{helper:this._metadataHelper,controller:{columnStates:new b({control:this._table,targetAggregation:"columns",getKeyForItem:G}),columnWidthStates:new r({control:this._table}),sortStates:new T({control:this._table}),groupStates:new S({control:this._table})}});this._p13nEngine.attachStateChange(this._onTableStateChange.bind(this));const e={columnStates:this._metadataHelper.getProperties().map(({key:e})=>({key:e})),sortStates:[{key:H.RefDes,descending:false}]};this._p13nEngine.applyState(this._table,e)};q.prototype._onSettings=function(){this._p13nEngine.show(this._table,["columnStates","sortStates","groupStates"],{source:this._table})};q.prototype._setScene=function(e){this._scene=e?.isECADScene()?e:null;this._refresh()};q.prototype._addElement=function(e,t,n){const s=n.get("type");const i=n.get("refdes");const a=n.get("deviceref");var o=e.get(i);if(!o){o={refdes:i,type:s,deviceref:a,parts:new Map,hiddenParts:new Set};e.set(i,o)}switch(s){case U.Component:o.parts.set(t.uid,t);if(this._manager.getVisibilityState(t)===false){o.hiddenParts.add(t.uid)}break;case U.Net:t.children.forEach(e=>{o.parts.set(e.uid,e);if(this._manager.getVisibilityState(e)===false){o.hiddenParts.add(e.uid)}});break;default:break}};q.prototype._scanTree=function(e,t){const n=j(t);if(n){const s=n.get("refdes");if(s){this._addElement(e,t,n);return}}t.children.forEach(t=>this._scanTree(e,t))};q.prototype._onTableSelectionChanged=function(e){const t=e.getParameter("listItems");const n=e.getParameter("selected");const s=[];t.forEach(e=>{const t=e.getBindingContext().getObject();switch(t.type){case U.Component:s.push(t.parts.values().toArray()[0]);break;case U.Net:s.push(t.parts.values().toArray()[0].parent);break;default:break}});this._manager.setSelectionState(s,n,true,true);this._updateButtons()};q.prototype._onViewportSelectionChanged=function(e){const t=this._table.getItems();const n=e.getParameter("selected");const s=e.getParameter("unselected");const i=(e,t,n)=>{const s=t.getBindingContext().getObject();e.forEach(e=>{const i=j(e);const a=i?.get("refdes");if(a===s.refdes){this._table.setSelectedItem(t,n,false)}})};t.forEach(e=>{i(n,e,true);i(s,e,false)});this._updateButtons()};q.prototype._setContent=function(e){if(e&&!this.getViewStateManager()){const e=P.getElementById(this.getContentConnector());if(e){const t=e.getDefaultViewStateManager();if(t){this.setViewStateManager(t)}}}this._setScene(e);return this};q.prototype._onContentReplaced=function(e){this._setContent(e.getParameter("newContent"))};q.prototype._updateButtons=function(){let e=false;let t=false;const n=this._table.getSelectedItems();n.forEach(n=>{const s=n.getBindingContext().getObject();const i=K(s);if(i===V.Visible){e=true}else if(i===V.Hidden){t=true}else{e=t=true}});this._showButton.setEnabled(t);this._hideButton.setEnabled(e)};q.prototype._onShowElements=function(){const e=[];const t=this._table.getSelectedItems();t.forEach(t=>{const n=t.getBindingContext().getObject();if(n.hiddenParts.size>0){const t=n.parts.values().toArray()[0];n.hiddenParts.clear();if(n.type===U.Component){e.push(t)}else if(n.type===U.Net){e.push(t.parent)}}});this._skipEvent=true;this._manager.setVisibilityState(e,true,true,true);this._model.updateBindings(true);this._updateButtons()};q.prototype._onHideElements=function(){const e=[];const t=this._table.getSelectedItems();t.forEach(t=>{const n=t.getBindingContext().getObject();if(n.hiddenParts.size<n.parts.size){const t=n.parts.values().toArray()[0];n.parts.forEach(e=>n.hiddenParts.add(e.uid));if(n.type===U.Component){e.push(t)}else if(n.type===U.Net){e.push(t.parent)}}});this._skipEvent=true;this._manager.setVisibilityState(e,false,true,true);this._model.updateBindings(true);this._updateButtons()};q.prototype._onVisibilityChanged=async function(e){if(this._skipEvent){this._skipEvent=false;return}const t=e.getParameter("hidden");const n=e.getParameter("visible");await this._promise;const s=(e,t,n)=>{e.forEach(e=>{const s=j(e);const i=s?.get("refdes");if(i===t.refdes){switch(s.get("type")){case U.Component:if(n){t.hiddenParts.delete(e.uid)}else{t.hiddenParts.add(e.uid)}break;case U.Net:if(n){e.children.forEach(e=>t.hiddenParts.delete(e.uid))}else{e.children.forEach(e=>t.hiddenParts.add(e.uid))}break;default:break}}else{const i=s?.get("layer");if(i){if(t.parts.has(e.uid)){if(n){t.hiddenParts.delete(e.uid)}else{t.hiddenParts.add(e.uid)}}}}})};this._model.getData().forEach(e=>{s(t,e,false);s(n,e,true)});this._model.updateBindings(true);this._updateButtons()};q.prototype._onSearch=function(){this._table.setShowOverlay(true);const e=this._getFiltersWithValues().reduce((e,t)=>{var n=t.getControl();const s=t.getName();var i=[];switch(s){case H.RefDes:case H.Device:const e=n.getValue();i.push(new k({path:t.getName(),operator:x.Contains,value1:e}));break;case H.Type:const s=n.getSelectedKeys();s.forEach(e=>i.push(new k({path:t.getName(),operator:x.Contains,value1:e})));break;default:break}if(i.length>0){e.push(new k({filters:i,and:false}))}return e},[]);this._table.getBinding("items").filter(e);this._table.setShowOverlay(false);this._updateMessage(true)};q.prototype._onFilterChange=function(){this._table.setShowOverlay(true)};q.prototype._onAssignedFiltersChanged=function(){this._filterSummaryModel.setProperty("/snappedFilterSummary",this._filterBar.retrieveFiltersWithValuesAsText());this._filterSummaryModel.setProperty("/expandedFilterSummary",this._filterBar.retrieveFiltersWithValuesAsTextExpanded())};q.prototype._getFiltersWithValues=function(){return this._filterBar.getFilterGroupItems().filter(e=>{const t=e.getControl();if(t instanceof m){return t.getSelectedItems().length>0}else if(t instanceof a){return t.getValue().length>0}else{return false}})};q.prototype._updateFilterBarToolbarText=function(){this._filterBar._updateToolbarText?.()};q.prototype._onBeforeOpenColumnMenu=function(e){const t=e.getSource();const n=e.getParameter("openBy");const s=t.getQuickActions();const i=s.find(e=>e instanceof c);if(i!=null){const e=i.getItems()[0];e.setKey(G(n));e.setLabel(n.getHeader().getText(false));e.setSortOrder(n.getSortIndicator())}const a=s.find(e=>e instanceof h);if(a!=null){const e=a.getItems()[0];e.setKey(G(n));e.setLabel(n.getHeader().getText(false));e.setGrouped(n.data("grouped"))}};q.prototype._onColumnResize=function(e){};q.prototype._onSort=function(e){this._p13nEngine.retrieveState(this._table).then(t=>{const n=t.sortStates;for(const e of n){e.sorted=false}const s=e.getParameter("item");const i=s.getKey();const a=s.getSortOrder();if(a!==D.None){n.push({key:i,descending:a===D.Descending})}this._p13nEngine.applyState(this._table,t)})};q.prototype._onGroup=function(e){this._p13nEngine.retrieveState(this._table).then(t=>{const n=t.groupStates;for(const e of n){e.grouped=false}const s=e.getParameter("item");const i=s.getKey();if(s.getGrouped()){n.push({key:i})}this._p13nEngine.applyState(this._table,t)})};q.prototype._onTableStateChange=function(e){if(e.getParameter("control")!==this._table){return}const t=e.getParameter("state");if(t==null){return}const n=this._table.getBindingInfo("items");const s={path:n.path,model:n.model,factory:n.factory};const i=this._table.getColumns();for(const e of i){e.setVisible(false);e.setSortIndicator(D.None);e.data("grouped",false);const n=t.columnWidthStates[G(e)];if(n!==undefined){e.setWidth()}}const a=this._rowTemplate.getCells();t.columnStates.forEach((e,t)=>{const n=W(this._table.getColumns(),e.key);n.setVisible(true);this._table.removeColumn(n);this._table.insertColumn(n,t);const s=W(a,e.key);this._rowTemplate.removeCell(s);this._rowTemplate.insertCell(s,t)});s.sorter=[];if(t.groupStates.length===1){const e=t.groupStates[0].key;const n=this._metadataHelper.getProperty(e).path;const a=t.sortStates.find(t=>t.key===e);const o=a?.descending??false;const r=e=>{switch(n){case H.Type:return Q(e.getObject());default:return e.getProperty(n)}};s.sorter.push(new I(n,o,r));const l=W(i,e);l.data("grouped",true)}for(let e of t.sortStates){const n=W(i,e.key);n.setSortIndicator(e.descending?D.Descending:D.Ascending);if(t.groupStates[0]?.key===e.key){continue}const a=this._metadataHelper.getProperty(e.key).path;s.sorter.push(new I(a,e.descending))}this._table.bindItems(s)};return q});
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/ecad/LayersPanel", ["sap/m/VBox","sap/m/Button","sap/m/SearchField","sap/m/OverflowToolbar","sap/m/ToolbarLayoutData","sap/m/ToolbarSpacer","sap/m/Label","sap/m/Table","sap/m/Column","sap/m/ColumnListItem","sap/m/IllustratedMessage","sap/m/IllustratedMessageType","sap/m/plugins/ColumnResizer","sap/ui/core/Control","sap/ui/core/Element","sap/ui/core/Icon","sap/ui/core/library","sap/ui/model/json/JSONModel","../Core","./VisibilityType","../getResourceBundle","sap/m/library"],function(e,t,n,i,s,o,a,r,l,c,h,d,u,p,_,f,g,m,y,E,b,S){"use strict";const C=S.Sticky;const L=S.FlexRendertype;function T(e){const t=new Map;const n=e.getSceneMetadata();const i=n.find(e=>e.category==="ecad"&&e.tag==="Layers");if(i){const e=i.value.split("|");e.forEach(function(e){const i=n.find(t=>t.category===e&&t.tag==="Index");if(i){t.set(e,i.value)}})}return t}function w(e){if(e.hiddenElements.size===0){return E.Visible}else if(e.hiddenElements.size<e.elements.size){return E.Partial}return E.Hidden}function I(e){const t=e?.userData?.metadata??{};if(t.length){const e=new Map;t.forEach(function(t){if(t.category==="ecad"){e.set(t.tag,t.value)}});return e}return null}var x=p.extend("sap.ui.vk.ecad.LayersPanel",{metadata:{library:"sap.ui.vk",properties:{width:{type:"sap.ui.core.CSSSize",defaultValue:"auto"},height:{type:"sap.ui.core.CSSSize",defaultValue:"100%"}},aggregations:{content:{type:"sap.ui.core.Control",multiple:false}},associations:{contentConnector:{type:"sap.ui.vk.ContentConnector",multiple:false},viewStateManager:{type:"sap.ui.vk.ViewStateManagerBase",multiple:false}},events:{contentChanged:{enableEventBubbling:true}}},renderer:{apiVersion:2,render:function(e,t){e.openStart("div",t);e.class("sapUiSizeCompact");const n=t.getWidth();if(n!=null){e.style("width",n)}const i=t.getHeight();if(i!=null){e.style("height",i)}e.openEnd();e.renderControl(t.getAggregation("content"));e.close("div")}},constructor:function(e,t){p.apply(this,arguments);y.observeAssociations(this)}});const B={Hidden:"sap-icon://status-inactive",Partial:"sap-icon://vk-icons/partially-visible-layer",Visible:"sap-icon://rhombus-milestone-2"};const V={Component:"2",Net:"4"};x.prototype.onSetViewStateManager=function(e){this._manager=e;e.attachVisibilityChanged(this._onVisibilityChanged,this);this._refresh()};x.prototype.onUnsetViewStateManager=function(e){this._manager=null;e.detachVisibilityChanged(this._onVisibilityChanged,this);this._refresh()};x.prototype.onSetContentConnector=function(e){e.attachContentReplaced(this._onContentReplaced,this);this._setContent(e.getContent())};x.prototype.onUnsetContentConnector=function(e){this._setContent(null);e.detachContentReplaced(this._onContentReplaced,this)};x.prototype.init=function(){if(p.prototype.init){p.prototype.init.apply(this)}const _=this;this._searchField=new n({layoutData:new s({shrinkable:true,maxWidth:"400px"}),search:function(e){_._onSearch.call(_,e.getParameter("query"))}});this._showButton=new t({enabled:false,icon:B.Visible,text:b().getText("LAYERS_PANEL_SHOW_BUTTON"),tooltip:b().getText("LAYERS_PANEL_SHOW_BUTTON_TOOLTIP"),press:this._onShowLayers.bind(this)});this._hideButton=new t({enabled:false,icon:B.Hidden,text:b().getText("LAYERS_PANEL_HIDE_BUTTON"),tooltip:b().getText("LAYERS_PANEL_HIDE_BUTTON_TOOLTIP"),press:this._onHideLayers.bind(this)});this._table=new r({visible:false,mode:"MultiSelect",includeItemInSelection:true,sticky:[C.HeaderToolbar,C.ColumnHeaders],selectionChange:this._updateButtons.bind(this),headerToolbar:new i({content:[this._searchField,new o,this._showButton,this._hideButton]}),dependents:[new u],columns:[new l({minScreenWidth:"10rem",hAlign:g.TextAlign.Begin,header:new a({text:b().getText("LAYERS_PANEL_NAME_COLUMN")})}),new l({minScreenWidth:"6rem",hAlign:g.TextAlign.Center,header:new a({text:b().getText("LAYERS_PANEL_VISIBLE_COLUMN")})})],items:{path:"/",template:new c({vAlign:"Middle",cells:[new a({text:"{name}"}),new f({src:{path:"",formatter:function(e){switch(w(e)){case E.Hidden:return B.Hidden;case E.Partial:return B.Partial;default:return B.Visible}}},tooltip:{path:"",formatter:function(e){switch(w(e)){case E.Hidden:return b().getText("LAYERS_PANEL_VISIBLE_COLUMN_HIDDEN_TOOLTIP");case E.Partial:return b().getText("LAYERS_PANEL_VISIBLE_COLUMN_PARTIAL_TOOLTIP");default:return b().getText("LAYERS_PANEL_VISIBLE_COLUMN_VISIBLE_TOOLTIP")}}}})]})}});this._message=new h({illustrationType:d.NoData,enableVerticalResponsiveness:true});const y=new e({height:"100%",renderType:L.Bare,items:[this._table,this._message]});this.setAggregation("content",y);this._scene=null;this._model=new m;this._table.setModel(this._model);this._skipEvent=false};x.prototype.exit=function(){this._model.destroy();this._model=null;p.prototype.exit?.apply(this)};x.prototype.getControl=function(){return this._table};x.prototype._refresh=function(){if(!this._scene||!this._manager){this._model?.setData([]);this._updateMessage();return}this._initialLayerIndex=1;const e=new Map;this._scanTree(e,this._scene.getRootElement());const t=T(this._scene);t.forEach(function(t,n){const i=e.get(n);if(i){i.index=+t}},this);const n=e.values().toArray();n.sort((e,t)=>e.index-t.index);this._model.setSizeLimit(n.length);this._model.setData(n);this._table.setModel(this._model);this._updateMessage();this.fireContentChanged()};x.prototype._setScene=function(e){this._scene=e?.isECADScene()?e:null;this._refresh()};x.prototype._addToLayer=function(e,t,n){let i=e.get(t);if(!i){i={name:t,index:this._initialLayerIndex++,elements:new Map,hiddenElements:new Set};e.set(t,i)}if(this._manager.getVisibilityState(n)===false){i.hiddenElements.add(n.uid)}i.elements.set(n.uid,n)};x.prototype._scanTree=function(e,t){const n=I(t);if(n){const i=n.get("layer");if(i){this._addToLayer(e,i,t);return}}t.children.forEach(t=>this._scanTree(e,t))};x.prototype._setContent=function(e){if(e&&!this.getViewStateManager()){const e=_.getElementById(this.getContentConnector());if(e){const t=e.getDefaultViewStateManager();if(t){this.setViewStateManager(t)}}}this._setScene(e);return this};x.prototype._onContentReplaced=function(e){this._setContent(e.getParameter("newContent"))};x.prototype._updateButtons=function(){let e=false;let t=false;const n=this._table.getSelectedItems();n.forEach(function(n){const i=n.getBindingContext().getObject();const s=w(i);if(s===E.Visible){e=true}else if(s===E.Hidden){t=true}else{e=t=true}},this);this._showButton.setEnabled(t);this._hideButton.setEnabled(e)};x.prototype._onShowLayers=function(){const e=[];const t=this._table.getSelectedItems();t.forEach(function(t){const n=t.getBindingContext().getObject();if(n.hiddenElements.size>0){n.hiddenElements.clear();n.elements.forEach(function(t){e.push(t)},this)}},this);this._skipEvent=true;this._manager.setVisibilityState(e,true,true,true);this._model.updateBindings(true);this._updateButtons()};x.prototype._onHideLayers=function(){const e=[];const t=this._table.getSelectedItems();t.forEach(function(t){const n=t.getBindingContext().getObject();if(n.hiddenElements.size!==n.elements.size){n.hiddenElements.clear();n.elements.forEach(function(t){n.hiddenElements.add(t.uid);e.push(t)},this)}},this);this._skipEvent=true;this._manager.setVisibilityState(e,false,true,true);this._model.updateBindings(true);this._updateButtons()};x.prototype._onSearch=function(e){if(e!==""){const t=[];this._table.getItems().forEach(function(n){if(n.getBindingContext().getObject().name.lastIndexOf(e)!==-1){t.push(n)}},this);if(t.length>0){this._table.removeSelections(true,false);t.forEach(function(e){this._table.setSelectedItem(e)},this);this._table.fireSelectionChange({listItems:t})}}};x.prototype._onVisibilityChanged=function(e){if(this._skipEvent){this._skipEvent=false;return}const t=this._model.getData();const n=e.getParameter("hidden");const i=e.getParameter("visible");const s=(e,n)=>{e.forEach(function(e){const i=I(e);const s=i?.get("layer");if(s){const s=i?.get("type");const o=s===V.Component?[e]:[e].concat(e.children);o.forEach(function(e){for(let i=0;i<t.length;++i){if(t[i].elements.has(e.uid)){if(n){t[i].hiddenElements.delete(e.uid)}else{t[i].hiddenElements.add(e.uid)}break}}})}},this)};s(n,false);s(i,true);this._model.updateBindings(true);this._updateButtons()};x.prototype._updateMessage=function(){const e=this._table.getItems().length>0;this._table.setVisible(e);this._message.setVisible(!e)};return x});
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/ecad/VisibilityType", ["sap/ui/base/DataType"],function(i){"use strict";var e={Hidden:0,Partial:1,Visible:2};i.registerEnum("sap.ui.vk.ecad.VisibilityType",e);return e});
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/findIndexInArray", [],function(){"use strict";var r=function(r,n,t){if(Array.isArray(r)&&typeof n==="function"){for(var i=0,e=r.length;i<e;i++){if(n.call(t,r[i],i,r)){return i}}}return-1};return r});
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/getResourceBundle", ["sap/ui/core/Lib"],function(e){"use strict";return function(){return e.getResourceBundleFor("sap.ui.vk.i18n")}},true);
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/glMatrix", ["./thirdparty/gl-matrix"],function(r){"use strict";r.glMatrix.setMatrixArrayType(Float64Array);return r});
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/helpers/RotateOrbitHelperDvl", ["sap/ui/base/EventProvider"],function(e){"use strict";var t=e.extend("sap.ui.vk.helpers.RotateOrbitHelperDvl",{metadata:{library:"sap.ui.vk",publicMethods:["rotate"]},constructor:function(e,t){this._tool=e;this._dvl=t;this._dvlRendererId=this._tool._viewport._dvlRendererId}});t.prototype.destroy=function(){this._rotateOrbitTool=null};t.prototype.activateOrbitMode=function(){if(this._dvlRendererId){this._dvl.Renderer.SetOption(sap.ve.dvl.DVLRENDEROPTION.DVLRENDEROPTION_CAMERA_ROTATION_MODE_ORBIT,true)}return this};t.prototype.deactivateOrbitMode=function(){if(this._dvlRendererId){this._dvl.Renderer.SetOption(sap.ve.dvl.DVLRENDEROPTION.DVLRENDEROPTION_CAMERA_ROTATION_MODE_ORBIT,false)}return this};t.prototype.rotate=function(e,t){if(this._dvlRendererId){this._dvl.Renderer.Rotate(e*window.devicePixelRatio,t*window.devicePixelRatio,this._dvlRendererId);this._tool.fireRotate({dx:e,dy:t})}return this};return t});
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/helpers/RotateOrbitHelperThree", ["sap/ui/base/EventProvider"],function(t){"use strict";var e=t.extend("sap.ui.vk.helpers.RotateOrbitHelperThree",{metadata:{library:"sap.ui.vk",publicMethods:["rotate"]},constructor:function(t){this._tool=t}});e.prototype.destroy=function(){this._tool=null};e.prototype.activateOrbitMode=function(){this._tool._viewport._viewportGestureHandler._cameraController.isTurnTableMode=false;return this};e.prototype.deactivateOrbitMode=function(){this._tool._viewport._viewportGestureHandler._cameraController.isTurnTableMode=true;return this};e.prototype.rotate=function(t,e){this._tool._viewport._viewportGestureHandler._cameraController.rotate(t,e,false);return this};return e});
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/helpers/RotateTurntableHelperDvl", ["sap/ui/base/EventProvider"],function(e){"use strict";var t=e.extend("sap.ui.vk.helpers.RotateTurntableHelperDvl",{metadata:{library:"sap.ui.vk",publicMethods:["rotate"]},constructor:function(e,t){this._tool=e;this._dvl=t;this._dvlRendererId=this._tool._viewport._dvlRendererId}});t.prototype.destroy=function(){this._rotateOrbitTool=null};t.prototype.activateTurntableMode=function(){if(this._dvlRendererId){this._dvl.Renderer.SetOption(sap.ve.dvl.DVLRENDEROPTION.DVLRENDEROPTION_CAMERA_ROTATION_MODE_ORBIT,false)}return this};t.prototype.deactivateTurntableMode=function(){if(this._dvlRendererId){this._dvl.Renderer.SetOption(sap.ve.dvl.DVLRENDEROPTION.DVLRENDEROPTION_CAMERA_ROTATION_MODE_ORBIT,true)}return this};t.prototype.rotate=function(e,t){if(this._dvlRendererId){this._dvl.Renderer.Rotate(e*window.devicePixelRatio,t*window.devicePixelRatio,this._dvlRendererId);this._tool.fireRotate({dx:e,dy:t})}return this};return t});
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/helpers/RotateTurntableHelperThree", ["sap/ui/base/EventProvider"],function(t){"use strict";var e=t.extend("sap.ui.vk.helpers.RotateTurntableHelperThree",{metadata:{library:"sap.ui.vk",publicMethods:["rotate"]},constructor:function(t){this._tool=t}});e.prototype.destroy=function(){this._tool=null};e.prototype.activateTurntableMode=function(){this._tool._viewport._viewportGestureHandler._cameraController.isTurnTableMode=true;return this};e.prototype.deactivateTurntableMode=function(){this._tool._viewport._viewportGestureHandler._cameraController.isTurnTableMode=false;return this};e.prototype.rotate=function(t,e){this._tool._viewport._viewportGestureHandler._cameraController.rotate(t,e,true);this._tool.fireRotate({dx:t,dy:e});return this};return e});
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/helpers/WorkerScriptLoader", ["sap/ui/thirdparty/URI"],function(t){"use strict";var i={};i.absoluteUri=function(i){var r=new t(sap.ui.require.toUrl(i));if(r.is("relative")){r=r.absoluteTo(new t(document.baseURI))}return r};i.loadScript=function(t,i){var r=this.absoluteUri(t);var e=[];if(i&&i.length>0){i.forEach(function(t){e.push("'"+this.absoluteUri(t)+"'")},this)}e.push("'"+r.toString()+"'");return new Worker((window.URL||window.webkitURL).createObjectURL(new Blob(["importScripts("+e.join()+");"],{type:"application/javascript"})))};return i});
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/library", ["sap/ui/core/Lib","sap/ui/core/library","sap/m/library","./BillboardBorderLineStyle","./BillboardCoordinateSpace","./BillboardHorizontalAlignment","./BillboardStyle","./BillboardTextEncoding","./CameraFOVBindingType","./CameraProjectionType","./ContentResourceSourceCategory","./ContentResourceSourceTypeToCategoryMap","./DetailViewShape","./DetailViewType","./DvlException","./IncludeUsageIdType","./LeaderLineMarkStyle","./MapContainerButtonType","./Redline","./RenderMode","./SelectionMode","./TransformationMatrix","./VisibilityMode","./ZoomTo","./abgrToColor","./colorToABGR","./cssColorToColor","./colorToCSSColor","./getResourceBundle","./utf8ArrayBufferToString","./dvl/GraphicsCoreApi","./dvl/checkResult","./dvl/getJSONObject","./dvl/getPointer","./tools/AxisColours","./tools/CoordinateSystem","./tools/HitTestClickType","./tools/HitTestIdMode","./tools/PredefinedView"],function(e){"use strict";var o=e.init({apiVersion:2,name:"sap.ui.vk",dependencies:["sap.ui.core","sap.m"],interfaces:["sap.ui.vk.AuthorizationHandler","sap.ui.vk.DecryptionHandler","sap.ui.vk.IPlaybackCollection"],types:[],controls:["sap.ui.vk.AnimationTimeSlider","sap.ui.vk.ContainerBase","sap.ui.vk.ContainerContent","sap.ui.vk.DrawerToolbar","sap.ui.vk.FlexibleControl","sap.ui.vk.LegendItem","sap.ui.vk.ListPanel","sap.ui.vk.ListPanelStack","sap.ui.vk.MapContainer","sap.ui.vk.NativeViewport","sap.ui.vk.Notifications","sap.ui.vk.Overlay","sap.ui.vk.ProgressIndicator","sap.ui.vk.RedlineDesign","sap.ui.vk.RedlineSurface","sap.ui.vk.SceneTree","sap.ui.vk.StepNavigation","sap.ui.vk.Toolbar","sap.ui.vk.Viewer","sap.ui.vk.ViewGallery","sap.ui.vk.Viewport","sap.ui.vk.ViewportBase","sap.ui.vk.dvl.Viewport","sap.ui.vk.threejs.Viewport","sap.ui.vk.svg.Viewport","sap.ui.vk.tools.AnchorPointToolGizmo","sap.ui.vk.tools.CrossSectionToolGizmo","sap.ui.vk.tools.Gizmo","sap.ui.vk.tools.MoveToolGizmo","sap.ui.vk.tools.RotateToolGizmo","sap.ui.vk.tools.ScaleToolGizmo","sap.ui.vk.tools.SceneOrientationToolGizmo","sap.ui.vk.tools.TooltipToolGizmo","sap.ui.vk.ecad.LayersPanel","sap.ui.vk.ecad.ElementsPanel"],elements:["sap.ui.vk.ContentConnector","sap.ui.vk.FlexibleControlLayoutData","sap.ui.vk.OverlayArea","sap.ui.vk.RedlineElement","sap.ui.vk.RedlineElementEllipse","sap.ui.vk.RedlineElementFreehand","sap.ui.vk.RedlineElementLine","sap.ui.vk.RedlineElementRectangle","sap.ui.vk.RedlineElementText","sap.ui.vk.ViewStateManager","sap.ui.vk.ViewStateManagerBase","sap.ui.vk.dvl.ViewStateManager","sap.ui.vk.threejs.ViewStateManager","sap.ui.vk.svg.ViewStateManager","sap.ui.vk.tools.AnchorPointTool","sap.ui.vk.tools.CrossSectionTool","sap.ui.vk.tools.HitTestTool","sap.ui.vk.tools.MoveTool","sap.ui.vk.tools.RectSelectTool","sap.ui.vk.tools.RotateOrbitTool","sap.ui.vk.tools.RotateTool","sap.ui.vk.tools.RotateTurntableTool","sap.ui.vk.tools.ScaleTool","sap.ui.vk.tools.SceneOrientationTool","sap.ui.vk.tools.Tool","sap.ui.vk.tools.TooltipTool","sap.ui.vk.tools.PoiManipulationTool"],noLibraryCSS:false,version:"1.141.0",designtime:"sap/ui/vk/designtime/library.designtime"});var t={};t["sap/ui/vk/thirdparty/html2canvas"]={exports:"html2canvas",amd:true};t["sap/ui/vk/thirdparty/gl-matrix"]={exports:"glMatrix",amd:true};t["sap/ui/vk/thirdparty/imagetracer"]={exports:"ImageTracer",amd:true};sap.ui.loader.config({shim:t});(function(){var e=function(e,o){var t="new extend getMetadata";if(o){t+=" "+o}sap.ui.lazyRequire("sap.ui.vk."+e,t)};e("AnimationPlayback");e("AnimationSequence");e("BaseNodeProxy");e("Camera");e("ContentConnector","registerSourceType");e("ContentManager");e("ContentResource");e("Core");e("DownloadManager");e("ImageContentManager");e("LayerProxy");e("Loco");e("Material");e("NodeHierarchy");e("NodeProxy");e("OrthographicCamera");e("PerspectiveCamera");e("RedlineDesignHandler");e("RedlineGesturesHandler");e("Scene");e("Smart2DHandler");e("Texture");e("View");e("ViewportHandler");e("dvl.BaseNodeProxy");e("dvl.ContentManager","getRuntimeSettings setRuntimeSettings getWebGLContextAttributes setWebGLContextAttributes getDecryptionHandler setDecryptionHandler");e("dvl.GraphicsCore");e("dvl.LayerProxy");e("dvl.NodeHierarchy");e("dvl.NodeProxy");e("dvl.Scene");e("helpers.RotateOrbitHelperDvl");e("helpers.RotateOrbitHelperThree");e("helpers.RotateTurntableHelperDvl");e("helpers.RotateTurntableHelperThree");e("Highlight");e("svg.BaseNodeProxy");e("svg.ContentManager","registerLoader");e("svg.NodeHierarchy");e("svg.NodeProxy");e("svg.Scene");e("threejs.AnimationSequence");e("threejs.BaseNodeProxy");e("threejs.Billboard");e("threejs.Callout");e("threejs.ContentDeliveryService");e("threejs.ContentManager","registerLoader");e("threejs.DetailView");e("threejs.LayerProxy");e("threejs.Material");e("threejs.NodeHierarchy");e("threejs.NodeProxy");e("threejs.OrthographicCamera");e("threejs.PerspectiveCamera");e("threejs.Scene");e("threejs.Texture");e("threejs.Thrustline");e("threejs.ViewportGestureHandler");e("tools.AnchorPointToolHandler");e("tools.CrossSectionToolHandler");e("tools.HitTestToolHandler");e("tools.MoveToolHandler");e("tools.RectSelectToolHandler");e("tools.RotateToolHandler");e("tools.ScaleToolHandler");e("tools.TooltipToolHandler")})();return o});
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/matai/MataiLoader", ["sap/base/Log","sap/ui/base/ManagedObject","../getResourceBundle","../helpers/WorkerScriptLoader","../DownloadManager"],function(e,t,r,a,n){"use strict";var o={FinishedTree:r().getText("SCENE_CONTEXT_FINISHED_TREE"),LoadingGeometries:r().getText("SCENE_CONTEXT_LOADING_GEOMETRIES"),LoadingTextures:r().getText("SCENE_CONTEXT_LOADING_TEXTURES"),LoadingModelViews:r().getText("SCENE_CONTEXT_LOADING_MODEL_VIEWS")};var s=t.extend("sap.ui.vk.matai.MataiLoader",{metadata:{library:"sap.ui.vk",events:{contentChangesProgress:{parameters:{source:"any",phase:"string",percent:"float"}},contentLoadingFinished:{parameters:{source:"any",node:"any"}}}}});var i=s.getMetadata().getName();function u(e,t,r){var a=performance.now();var n=e._progress;var o=a-n.lastUpdateTime>=500||t!==n.phase||r>=n.totalCount;n.phase=t;n.count=r;if(o){var s=40+60*(n.totalCount?n.count/n.totalCount:1);e._loader.fireContentChangesProgress({source:e._contentResource&&e._contentResource.getSource(),phase:t,percentage:Math.min(s,100)});n.lastUpdateTime=a}}var c=1;var d=new Map;var g=function(){var t;return function(){return t||(t=new Promise(function(t,n){var s=a.loadScript("sap/ui/vk/matai/MataiLoaderWorker.js",["sap/ui/vk/ve/matai.js"]);var c=0;var g=-1;var l=-2;var E=-3;var f=-4;var v=-5;var p=-6;var R=-7;var _=-8;function T(e){var t=r();switch(e){case g:return t.getText("LOADER_FILENOTFOUND");case l:return t.getText("LOADER_WRONGFILEFORMAT");case E:return t.getText("LOADER_WRONGPASSWORD");case f:return t.getText("LOADER_ERRORREADINGFILE");case v:return t.getText("LOADER_FILECONTENT");case p:return t.getText("LOADER_NODEFAULTVIEW");case R:return t.getText("LOADER_FILECONTENT");case _:return t.getText("LOADER_ERRORREADINGREFERENCEDFILE");default:return t.getText("LOADER_UNKNOWNERROR")}}function m(t,r,a){var n=T(r);t._reject({status:r,errorText:n});e.error(n,a,i);L(t,r)}function L(t,r){e.info("Matai loading finished");u(t,"",t._progress.totalCount);t._loader.fireContentLoadingFinished({source:t._contentResource,node:t._rootNode});t._loader=null;var a=t._id;s.postMessage({method:"destroyContext",args:{sceneBuilderId:a}});d.delete(a)}s.onmessage=function(a){var n=a.data;if(n.event==="runtimeCreated"){t(this);return}if("event"in n){var g=n.sceneBuilderId;var l=d.get(g);var E=l.sceneBuilder;switch(n.event){case"contextCreated":if(n.result===c){s.postMessage({method:"loadFile",args:{sceneBuilderId:g}})}else{m(E,n.result)}break;case"fileLoaded":if(n.result===c){l.waitingCount-=1;if(l.waitingCount===0){s.postMessage({method:"buildScene",args:{sceneBuilderId:g}})}}else{m(E,n.result)}break;case"referencedFileLoaded":l.waitingCount-=1;if(n.result!==c){e.error(T(n.result),n.fileName,i)}if(l.waitingCount===0){s.postMessage({method:"buildScene",args:{sceneBuilderId:g}})}break;case"referencedFileRequested":var f=l.dependencyLoader;if(f==null){e.error(r().getText("LOADER_NODEPENDENCYLOADER"),null,i)}else{var v=n.fileName;var p=n.veId;var R=n.veVersion;var _=l.files;var O=_.get(v);if(O==null){O=f.load(v);_.set(v,O)}l.waitingCount+=1;O.then(function(e){var t=e.buffer;e.buffer=null;s.postMessage({method:"loadReferencedFile",args:{sceneBuilderId:g,buffer:t,fileName:v,veId:p,veVersion:R}},t==null?[]:[t])},function(){l.waitingCount-=1;e.error(r().getText("LOADER_ERRORREADINGREFERENCEDFILE"),v,i);if(l.waitingCount===0){s.postMessage({method:"buildScene",args:{sceneBuilderId:g}})}})}break;case"sceneBuilt":L(E,n.result);break;default:break}}else{n.forEach(function(t){var r=t.sceneBuilderId;var a=d.get(r);var n=a.sceneBuilder;try{n[t.method].apply(n,t.args)}catch(r){e.error("SceneBuilder."+t.method+"()",r)}switch(t.method){case"setScene":var s=t.args[0];n._progress.totalCount=s.meshCount+s.imageCount+s.modelViewCount;u(n,o.FinishedTree,0);break;case"setGeometry":u(n,o.LoadingGeometries,n._progress.count+1);break;case"createImage":u(n,o.LoadingTextures,n._progress.count+1);break;case"createThumbnail":u(n,o.LoadingModelViews,n._progress.count+1);break;default:break}})}};s.onerror=function(e){n(e)};var O=a.absoluteUri("sap/ui/vk/ve/").toString();s.postMessage({method:"createRuntime",args:{scriptDirectory:O}})}))}}();function l(t,a,n,o,s,i,u){var l=s.getDependencyLoader();sap.ui.require([o.isObject3D?"sap/ui/vk/threejs/SceneBuilder":"sap/ui/vk/svg/SceneBuilder","sap/base/i18n/Localization"],function(E,f){g().then(function(g){g.onerror=function(t){e.error("Error in WebWorker",t);u(r().getText("LOADER_ERRORREADINGFILE"))};var v=new E(o,s,i,u);v._loader=t;v._progress={lastUpdateTime:performance.now()};v._id=c++;d.set(v._id,{sceneBuilder:v,dependencyLoader:l,files:new Map,waitingCount:1});g.postMessage({method:"createContext",args:{sceneBuilderId:v._id,buffer:a,fileName:n,locale:f.getLanguageTag().toString()}},[a])},function(e){u(e)})})}s.prototype.load=function(e,t,a,o){var s=this;return new Promise(function(i,u){if(typeof t.getSource()==="string"){var c=t.getSource();new n([c],undefined,a,o).attachItemSucceeded(function(r){var a=r.getParameter("source");var n=r.getParameter("response");l(s,n,a,e,t,i,u)},this).attachItemFailed(function(e){var t=e.getParameter("statusText");if(t===""){t=r().getText("VIEWER_SOURCE_FAILED_TO_DOWNLOAD_CAUSE")}u(t)},this).start()}else if(t.getSource()instanceof File){var d=new FileReader;d.onload=function(r){l(s,r.target.result,t.getSource().name,e,t,i,u)};d.onerror=function(e){u(e)};d.readAsArrayBuffer(t.getSource())}})};return s});
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/measurements/Angle", ["./Measurement","./MeasurementType","./Utils"],function(t,i,e){"use strict";var o=function(i){t.apply(this,arguments);this._angle=i&&"angle"in i?i.angle:0;this._state=i&&"state"in i?i.state:0;this._scale=i&&"scale"in i?i.scale:1;this._point1=i&&"point1"in i?i.point1.slice():[0,0,0];this._point2=i&&"point2"in i?i.point2.slice():[0,0,0];this._point3=i&&"point3"in i?i.point3.slice():[0,0,0];this._point4=i&&"point4"in i?i.point4.slice():[0,0,0]};o.prototype=Object.create(t.prototype);o.prototype.constructor=o;o.prototype.isAngle=true;t._classMap.set(i.Angle,o);o.prototype.getAngle=function(){return this._angle};o.prototype.setAngle=function(t){this._angle=t;return this};o.prototype.getState=function(){return this._state};o.prototype.setState=function(t){this._state=t;return this};o.prototype.getPoint1=function(){return this._point1};o.prototype.setPoint1=function(t){var i=this._point1;i[0]=t[0];i[1]=t[1];i[2]=t[2];return this};o.prototype.setPoint2=function(t){var i=this._point2;i[0]=t[0];i[1]=t[1];i[2]=t[2];return this};o.prototype.setPoint3=function(t){var i=this._point3;i[0]=t[0];i[1]=t[1];i[2]=t[2];return this};o.prototype.setPoint4=function(t){var i=this._point4;i[0]=t[0];i[1]=t[1];i[2]=t[2];return this};o.prototype.getRadiusScale=function(){return this._scale};o.prototype.setRadiusScale=function(t){this._scale=t;return this};o.prototype.setAngleRadius=function(t,i,o,n,r,s){var a=e.computeEdgeDirection(i,t);var p=e.computeEdgeDirection(n,r);var c=e.computeEdgeDirection(o,s);var u=e.computePointToPointDistance(s,o);var h=e.computePointToPointDistance(r,o);var l=e.computePointToPointDistance(n,o);if(l>h){h=l}var v=h>0?u/h:1;var _=e.angleBetweenVectors2D(a[0],a[1],c[0],c[1]);var f=e.angleBetweenVectors2D(a[0],a[1],p[0],p[1]);if(_<0){_+=2*Math.PI}if(f<0){f+=2*Math.PI;if(_<f){v=-v}}else if(_>f){v=-v}return this.setRadiusScale(v)};o.prototype.toString=function(){return"{ visible: "+this._visible+", angle: "+this._angle+", state: "+this._state+", scale: "+this._scale+", p1: ["+this._point1.join(", ")+"]"+", p2: ["+this._point2.join(", ")+"]"+", p3: ["+this._point3.join(", ")+"]"+", p4: ["+this._point4.join(", ")+"]"+" }"};o.prototype.isEdge1Defined=function(){var t=this._point1;var i=this._point2;var e=t[0]-i[0];var o=t[1]-i[1];var n=t[2]-i[2];return Math.sqrt(e*e+o*o+n*n)>1e-5};o.prototype.isEdge2Defined=function(){var t=this._point3;var i=this._point4;var e=t[0]-i[0];var o=t[1]-i[1];var n=t[2]-i[2];return Math.sqrt(e*e+o*o+n*n)>1e-5};o.prototype.getPoints=function(){var t=this._point1;var i=this._point2;var o=this._point3;var n=this._point4;var r=t;var s=i;var a=i;var p=i;var c=i;var u=i;var h;if(e.computePointToPointDistance2(t,i)>0&&e.computePointToPointDistance2(o,n)>0){var l=e.findClosestPointEdgeToEdge([t[0],t[1],t[2],i[0],i[1],i[2]],[o[0],o[1],o[2],n[0],n[1],n[2]]);a=[l[0],l[1],l[2]];u=[l[3],l[4],l[5]];var v=e.computeEdgeDirection(t,i);var _=e.computeEdgeDirection(o,n);var f=e.compareNormal(v,_,true)?null:e.findClosestPointLineToLine([t[0],t[1],t[2],i[0],i[1],i[2]],[o[0],o[1],o[2],n[0],n[1],n[2]]);if(f){h=e.computePointToPointDistance2(t,a)>e.computePointToPointDistance2(i,a);r=h?t:i;s=h?i:t;h=e.computePointToPointDistance2(o,u)>e.computePointToPointDistance2(n,u);p=h?n:o;c=h?o:n}else if(e.compareNormal(v,_,false)){p=o;c=n}else{p=n;c=o}}return[r[0],r[1],r[2],s[0],s[1],s[2],a[0],a[1],a[2],u[0],u[1],u[2],p[0],p[1],p[2],c[0],c[1],c[2]]};o.prototype.computeAngle=function(){var t=this._point1;var i=this._point2;var o=this._point3;var n=this._point4;if(e.computePointToPointDistance2(t,i)>0&&e.computePointToPointDistance2(o,n)>0){var r=e.computeEdgeDirection(i,t);var s=e.computeEdgeDirection(o,n);var a=e.dotProduct(r,s);this.setAngle(Math.acos(a))}else{this.setAngle(0)}};o.prototype.toJSON=function(){return{type:i.Angle,id:this._id,visible:this._visible,angle:this._angle,state:this._state,scale:this._scale,point1:Array.from(this._point1),point2:Array.from(this._point2),point3:Array.from(this._point3),point4:Array.from(this._point4),features:this._features.map(function(t){return t!=null?t.toJSON():null})}};return o});
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/measurements/Area", ["./Measurement","./MeasurementType","./Utils"],function(t,i,o){"use strict";var e=function(i){t.apply(this,arguments);this._area=i&&"area"in i?i.area:0;this._position=i&&"position"in i?i.position.slice():[0,0,0];this._points=i&&"points"in i?i.points.slice():[]};e.prototype=Object.create(t.prototype);e.prototype.constructor=e;e.prototype.isArea=true;t._classMap.set(i.Area,e);e.prototype.getPoints=function(){return this._points};e.prototype.getPosition=function(){return this._position};e.prototype.getArea=function(){return this._area};e.prototype.duplicateLastPoint=function(){var t=this._points;var i=t.length-3;t.push(t[i]);t.push(t[i+1]);t.push(t[i+2]);this.updateContourPositionAndArea();return this};e.prototype.replaceLastPoints=function(t,i,o){if(t){this._points.splice(-t*3,t*3)}if(o){for(var e=i.length-3;e>=0;e-=3){this._points.push(i[e],i[e+1],i[e+2])}}else{this._points=this._points.concat(i)}this.updateContourPositionAndArea();return this};e.prototype.replaceLastPoint=function(t){var i=this._points;var o=i.length-3;i[o]=t[0];i[o+1]=t[1];i[o+2]=t[2];this.updateContourPositionAndArea();return this};e.prototype.deletePredLastPoints=function(t){var i=this._points;var o=i.pop();var e=i.pop();var s=i.pop();var n=(t-1)*3;if(n>0){this._points.splice(-n,n)}var r=i.length;if(r>=3){i[r-3]=s;i[r-2]=e;i[r-1]=o}this.updateContourPositionAndArea();return this};e.prototype.toString=function(){return"{ visible: "+this._visible+", area: "+this._area+", position: ["+this._position.join(", ")+"]"+", points: ["+this._points.join(", ")+"]"+" }"};e.prototype.updateContourPositionAndArea=function(){var t=this._points;var i=t.length;if(o.equalPoints(t,0,t,i-3)){i-=3}var e=0;var s=0;var n=0;var r;for(var a=0;a<i;a+=3){var p=a+3;if(p>=i){p=0}e+=t[a]*t[p+1]-t[a+1]*t[p];r=t[a]*t[p+1]-t[p]*t[a+1];s+=(t[a]+t[p])*r;n+=(t[a+1]+t[p+1])*r}e*=.5;r=i>=9?1/(6*e):0;this._position=[s*r,n*r,0];this._area=i<9?null:-Math.abs(e)};e.prototype.setFromFace=function(t){var i=t.getValue();var e=i.vertices;if(t.isClosedContour()){this._points=Array.from(e);this.updateContourPositionAndArea()}else{var s=i.triangles;var n,r,a=0;var p=[0,0,0];for(var u=0,h=s.length;u<h;u+=3){n=o.computeTriangleArea(e,s[u]*3,s[u+1]*3,s[u+2]*3);r=o.computeTriangleAverageCoordinate(e,s[u]*3,s[u+1]*3,s[u+2]*3);p[0]+=n*r[0];p[1]+=n*r[1];p[2]+=n*r[2];a+=n}this._area=a;this._position=o.scalePoint(p,1/a)}};e.prototype.finalize=function(){var t=this._points;if(o.isClosedContour(t)){t.pop();t.pop();t.pop()}this._area=Math.abs(this._area)};e.prototype.hasSelfIntersections=function(){return o.hasSelfIntersections(this._points,false)};e.prototype.hasSelfIntersectionsLastEdge=function(){return o.hasSelfIntersectionsLastEdge(this._points)};e.prototype.toJSON=function(){return{type:i.Area,id:this._id,visible:this._visible,area:this._area,position:Array.from(this._position),points:Array.from(this._points),features:this._features.map(function(t){return t!=null?t.toJSON():null})}};return e});
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/measurements/ColorRadioButton", ["sap/m/RadioButton"],function(e){"use strict";var o=e.extend("sap.ui.vk.measurements.ColorRadioButton",{metadata:{library:"sap.ui.vk",properties:{color:"sap.ui.core.CSSColor"}},renderer:{apiVersion:2,render:function(e,o){e.openStart("div",o).class("sapUiVizKitMeasurementColorRb").attr("tabindex",o.hasOwnProperty("_iTabIndex")?o._iTabIndex:0);if(o.getSelected()){e.class("sapUiVizKitMeasurementColorRbSel")}e.openEnd();e.openStart("div").style("background-color",o.getColor()).openEnd().close("div");e.close("div")}}});return o});
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/measurements/Distance", ["./Measurement","./MeasurementType"],function(t,o){"use strict";var i=function(o){t.apply(this,arguments);this._showArrows=o&&"showArrows"in o?o.showArrows:true;this._point1=o&&"point1"in o?o.point1.slice():[0,0,0];this._point2=o&&"point2"in o?o.point2.slice():[0,0,0]};i.prototype=Object.create(t.prototype);i.prototype.constructor=i;i.prototype.isDistance=true;t._classMap.set(o.Distance,i);i.prototype.getShowArrows=function(){return this._showArrows};i.prototype.setShowArrows=function(t){this._showArrows=t;return this};i.prototype.getPoint1=function(){return this._point1};i.prototype.setPoint1=function(t){var o=this._point1;o[0]=t[0];o[1]=t[1];o[2]=t[2];return this};i.prototype.getPoint2=function(){return this._point2};i.prototype.setPoint2=function(t){var o=this._point2;o[0]=t[0];o[1]=t[1];o[2]=t[2];return this};i.prototype.toString=function(){return"{ visible: "+this._visible+", showArrows: "+this._showArrows+", p1: ["+this._point1.join(", ")+"]"+", p2: ["+this._point2.join(", ")+"]"+" }"};i.prototype.getDistance=function(){var t=this._point1;var o=this._point2;var i=t[0]-o[0];var r=t[1]-o[1];var n=t[2]-o[2];return Math.sqrt(i*i+r*r+n*n)};i.prototype.toJSON=function(){return{type:o.Distance,id:this._id,visible:this._visible,showArrows:this._showArrows,point1:Array.from(this._point1),point2:Array.from(this._point2),features:this._features.map(function(t){return t!=null?t.toJSON():null})}};return i});
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/measurements/Edge", ["sap/base/assert","./Feature","./FeatureType"],function(e,t,r){"use strict";var o=[0,0,0,0,0,0];var s=function(e){t.apply(this,arguments);this._edge=new Float64Array(6);this.setValue(e&&e.edge||o)};s.prototype=Object.create(t.prototype);s.prototype.constructor=s;s.prototype.isEdge=true;t._classMap.set(r.Edge,s);s.prototype.setValue=function(t){e(t.length===6,"Edge array must have 6 elements");this._edge.set(t);return this};s.prototype.getValue=function(){return this._edge};s.prototype.toJSON=function(){return{type:r.Edge,edge:Array.from(this._edge)}};return s});
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/measurements/Face", ["sap/base/assert","./Feature","./FeatureType","./Utils"],function(e,n,t,r){"use strict";var a={vertices:[0,0,0],triangles:null,boundingSpheres:null,edges:null,planeEquation:null};var s=function(e){n.apply(this,arguments);this._face={};this.setValue(e&&e.face||a)};s.prototype=Object.create(n.prototype);s.prototype.constructor=s;s.prototype.isFace=true;n._classMap.set(t.Face,s);s.prototype.isClosedContour=function(){return!this._face.triangles};s.prototype.setValue=function(n){e(n.vertices.length%3===0,"Vertices array must have 3x elements");var t=this._face;t.vertices=new Float64Array(n.vertices);if(!n.triangles){t.triangles=null;t.boundingSpheres=null;t.edges=null;t.planeEquation=null;return this}var a=t.vertices;e(n.triangles.length%3===0,"Triangles array must have 3x elements");t.triangles=new Int32Array(n.triangles);var s=t.triangles;var i,l,o,u;var g,p,h;if(n.boundingSpheres){e(n.boundingSpheres.length%4===0,"Bounding spheres must have 4x elements");e(n.boundingSpheres.length/4===n.triangles.length/3,"Number of triangles and bounding spheres must match");t.boundingSpheres=new Float64Array(n.boundingSpheres)}else{t.boundingSpheres=new Float64Array(4*(s.length/3));var c=0;for(g=0,h=s.length;g<h;g+=3){i=s[g]*3;l=[a[i],a[i+1],a[i+2]];i=s[g+1]*3;o=[a[i],a[i+1],a[i+2]];i=s[g+2]*3;u=[a[i],a[i+1],a[i+2]];r.computeTriangleBoundingSphere(l,o,u,t.boundingSpheres,c);c+=4}}if(n.edges){e(n.edges.length%2===0,"Edges array must have 2x elements");t.edges=new Int32Array(n.edges)}else{var f=new Set;for(g=0,h=s.length;g<h;g+=3){for(p=0;p<3;++p){l=s[g+p];o=s[g+(p+1)%3];if(l<o){i=l+":"+o}else{i=o+":"+l}if(f.has(i)){f.delete(i)}else{f.add(i)}}}g=0;t.edges=new Int32Array(f.size*2);f.forEach(function(e){i=e.split(":");t.edges[g]=Number(i[0]);t.edges[g+1]=Number(i[1]);g+=2})}if(n.planeEquation){e(n.planeEquation.length===4,"Plane equation have 4 elements");t.planeEquation=new Float64Array(n.planeEquation)}else{e(s.length>=3,"Expecting at least one triangle");t.planeEquation=new Float64Array(r.computePlaneEquation(a,s[0]*3,s[1]*3,s[2]*3))}return this};s.prototype.getValue=function(){return this._face};s.prototype.toJSON=function(e){var n=this._face;var r={type:t.Face,face:{vertices:Array.from(n.vertices)}};if(n.triangles){r.face.triangles=Array.from(n.triangles)}if(e){if(n.boundingSpheres){r.face.boundingSpheres=Array.from(n.boundingSpheres)}if(n.edges){r.face.edges=Array.from(n.edges)}if(n.planeEquation){r.face.planeEquation=Array.from(n.planeEquation)}}return r};return s});
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/measurements/Feature", ["sap/base/Log"],function(t){"use strict";var e=function(t){this._context=t!=null&&"context"in t?t.context:null;this._featureId=t!=null&&"featureId"in t?t.featureId:null};e.prototype.isFeature=true;e._classMap=new Map;e.prototype.setContext=function(t){this._context=t;return this};e.prototype.getContext=function(){return this._context};e.prototype.setFeatureId=function(t){this._featureId=t;return this};e.prototype.getFeatureId=function(){return this._featureId};e.prototype.toJSON=function(){return{}};e.createFromJSON=function(n){if(n!=null){var r=e._classMap.get(n.type);if(r){return new r(n)}t.warning("Unknown feature type:",n.type)}return null};e.prototype.clone=function(){return e.createFromJSON(this.toJSON(true))};return e});
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/measurements/FeatureType", ["sap/ui/base/DataType"],function(e){"use strict";var a={Vertex:"Vertex",Edge:"Edge",Face:"Face"};e.registerEnum("sap.ui.vk.measurements.FeatureType",a);return a});
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/measurements/Measurement", ["sap/base/Log","./Feature","../uuidv4"],function(t,e,i){"use strict";var r=function(t){this._id=t&&"id"in t?t.id:i();this._visible=t&&"visible"in t?t.visible:true;this._highlighted=false;this._features=[];if(t.features){t.features.forEach(function(t){this._features.push(e.createFromJSON(t))},this)}};r.prototype.isMeasurement=true;r._classMap=new Map;r.prototype.getId=function(){return this._id};r.prototype.getVisible=function(){return this._visible};r.prototype.setVisible=function(t){this._visible=t;return this};r.prototype.setHighlighted=function(t){this._highlighted=t;return this};r.prototype.getHighlighted=function(){return this._highlighted};r.prototype.setFeatures=function(t){this._features=t.map(function(t){return t!=null?t.clone():null});return this};r.prototype.getFeatures=function(){return this._features};r.createFromJSON=function(e){if(e!=null){var i=r._classMap.get(e.type);if(i){return new i(e)}t.warning("Unknown measurement type:",e.type)}return null};r.prototype.clone=function(){return r.createFromJSON(this.toJSON())};return r});
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/measurements/MeasurementType", ["sap/ui/base/DataType"],function(e){"use strict";var a={Angle:"Angle",Distance:"Distance",Area:"Area"};e.registerEnum("sap.ui.vk.measurements.MeasurementType",a);return a});
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/measurements/MeshAnalyzer", ["./Utils"],function(e){"use strict";var t=new Float64Array(3);var r=new Float64Array(3);var i=new Float64Array(3);var n=new Uint32Array(3);var a=new Float64Array(3*3);function s(e,t,r){var i=e*3;var n=t*2;this._vertices=new Float64Array((i+n+(r||0))*3);this._vertexCount=0;this._vertexToVertexIndices=new Uint32Array((e*3+t*2)*2);this._vertexToVertexConnectivity=new Uint32Array((i+n)*2);this._vertexToVertexEdgeId=null;this._triangles=new Uint32Array(e*3);this._triangleFaceId=new Uint32Array(e);this._triangleFaceId.fill(4294967295);this._triangleDoubleSidedFlag=new Uint8Array(e);this._triangleCount=0;this._triangleBoundingSphere=null;this._lines=new Uint32Array(t*2);this._lineCount=0;this._vertexSearchMap=new Map;this._vertexNextIndexWithSameHash=new Uint32Array(e*3);this._indexSearchMap=new Map;this._vertexTriangleIndices=new Uint32Array(e*3);this._vertexTriangleUsage=new Uint32Array(i*2)}s.prototype._pointsEqual=function(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]};s.prototype._hashTypedArray=function(e){var t=new Uint8Array(e.buffer);var r=2166136261;for(var i=0,n=t.length;i<n;++i){r^=t[i];r+=(r<<1)+(r<<4)+(r<<7)+(r<<8)+(r<<24)}return r>>>0};s.prototype._addVertex=function(e){var t=this._hashTypedArray(e);var r;var i=this._vertexSearchMap.get(t);var n;if(i!==undefined){do{n=i*3;if(this._vertices[n]===e[0]&&this._vertices[n+1]===e[1]&&this._vertices[n+2]===e[2]){return i}r=i;i=this._vertexNextIndexWithSameHash[i]}while(i>0)}n=this._vertexCount*3;this._vertices[n]=e[0];this._vertices[n+1]=e[1];this._vertices[n+2]=e[2];if(r!==undefined){this._vertexNextIndexWithSameHash[r]=this._vertexCount}else{this._vertexSearchMap.set(t,this._vertexCount)}return this._vertexCount++};s.prototype._finishMeshBuildingPart1=function(){this._vertexSearchMap=undefined;this._vertexNextIndexWithSameHash=undefined;this._indexSearchMap=undefined;this._buildVertexTriangleUsage();this._buildFaceIds();var e=this._buildEdges();return e};s.prototype._finishMeshBuildingPart2=function(e){this._vertexTriangleIndices=undefined;this._vertexTriangleUsage=undefined;this._buildEdgeIds(e);this._triangleBoundingSphere=new Float64Array(this._triangleCount*4);this._computeBoundingSpheres()};s.prototype.finishMeshBuilding=function(){var e=this._finishMeshBuildingPart1();this._finishMeshBuildingPart2(e)};s.prototype._buildVertexTriangleUsage=function(){var e=0;var t=this._vertexCount;var r;for(r=0;r<t;++r){this._vertexTriangleUsage[r*2]=e;e+=this._vertexTriangleUsage[r*2+1];this._vertexTriangleUsage[r*2+1]=0}var i;var n;var a;var s=this._triangleCount;for(r=0;r<s;++r){for(a=0;a<3;++a){i=this._triangles[r*3+a];t=this._vertexTriangleUsage[i*2+1];n=this._vertexTriangleUsage[i*2]+t;this._vertexTriangleIndices[n]=r;t++;this._vertexTriangleUsage[i*2+1]=t}}};s.prototype._buildEdges=function(){var e=0;var t;var r;var i;var n;var a;var s;var v;var o;var h;var l=this._lineCount;var u;var _;var g=new Set;var d=this._vertexToVertexIndices;var x;var c=function(t){d[e]=Number(t.split(":")[0]);e++};for(var f=0,p=this._vertexCount;f<p;++f){this._vertexToVertexConnectivity[f*2]=e;u=e;t=this._vertexTriangleUsage[f*2];r=t+this._vertexTriangleUsage[f*2+1];g.clear();for(i=t;i<r;++i){n=this._vertexTriangleIndices[i];_=this._triangleFaceId[n];n*=3;for(a=0;a<3;++a){s=this._triangles[n+a];if(s!==f){x=s+":"+_;if(g.has(x)){g.delete(x)}else{g.add(x)}}}}g.forEach(c);for(v=0;v<l;++v){o=this._lines[v*2];h=this._lines[v*2+1];if(o===f){d[e]=h;e++}else if(h===f){d[e]=o;e++}}this._vertexToVertexConnectivity[f*2+1]=e-u}return e};s.prototype.addTriangle=function(n,a,s){if(this._triangleCount*3+3>this._triangles.length){return-1}t.set([n[0],n[1],n[2]]);r.set([a[0],a[1],a[2]]);i.set([s[0],s[1],s[2]]);if(this._pointsEqual(t,r)||this._pointsEqual(t,i)||this._pointsEqual(r,i)){return-2}if(e.isDegenerateTriangle(t,r,i)){return-3}var v=this._addVertex(t);var o=this._addVertex(r);var h=this._addVertex(i);var l=[h,v,o];if(v<o){if(v<h){l=[v,o,h]}}else if(o<h){l=[o,h,v]}var u=l[0]+":"+l[1]+":"+l[2];var _=this._indexSearchMap.get(u);if(_!==undefined){return _}_=this._indexSearchMap.get(l[0]+":"+l[2]+":"+l[1]);if(_!==undefined){this._triangleDoubleSidedFlag[_]=true;return _}this._indexSearchMap.set(u,this._triangleCount);var g=this._triangleCount*3;this._triangles[g]=l[0];this._triangles[g+1]=l[1];this._triangles[g+2]=l[2];this._vertexTriangleUsage[v*2+1]++;this._vertexTriangleUsage[o*2+1]++;this._vertexTriangleUsage[h*2+1]++;return this._triangleCount++};s.prototype.addLine=function(e,i){if(this._lineCount*2+2>this._lines.length){return-1}t.set([e[0],e[1],e[2]]);r.set([i[0],i[1],i[2]]);if(this._pointsEqual(t,r)){return-2}var n=this._addVertex(t);var a=this._addVertex(r);var s=n<a?[n,a]:[a,n];var v=s[0]+":"+s[1];var o=this._indexSearchMap.get(v);if(o!==undefined){return o}this._indexSearchMap.set(v,this._lineCount);var h=this._lineCount*2;this._lines[h]=s[0];this._lines[h+1]=s[1];return this._lineCount++};s.prototype._buildFaceIds=function(){var t=new Uint8Array(this._triangleCount);var r=[];var i;var n;var a;var s;var v;var o;var h;var l;var u;var _;var g;var d;var x;var c;var f;var p;var T=0;for(var y=0,V=this._triangleCount;y<V;++y){if(t[y]===0){i=this.isTriangleDoubleSided(y);n=this.computeTriangleNormal(y);this._triangleFaceId[y]=T;r.push(y);while(r.length>0){a=r.pop();t[a]=1;s=a*3;for(v=0;v<3;++v){o=this._triangles[s+v];h=this._triangles[s+(v+1)%3];l=this._triangles[s+(v+2)%3];u=this._vertexTriangleUsage[o*2];_=u+this._vertexTriangleUsage[o*2+1];for(g=u;g<_;++g){d=this._vertexTriangleIndices[g];x=false;c=d*3;for(f=0;f<3;++f){p=this._triangles[c+f];if(p===h||p===l){x=true}}if(x&&!t[d]&&this._triangleFaceId[d]!==T){this._triangleFaceId[d]=T;if(e.compareNormal(n,this.computeTriangleNormal(d),i||this.isTriangleDoubleSided(d))){r.push(d)}}}}}T++}}};s.prototype._buildEdgeIds=function(t){this._vertexToVertexEdgeId=new Int32Array(t);var r=new Uint8Array(t);var i=1;var n=new Float64Array(3);var a=new Float64Array(3);var s=new Float64Array(3);var v=new Float64Array(3);var o;var h;var l;var u;var _;var g;var d;var x;var c;var f;var p;var T;for(var y=0,V=this._vertexCount;y<V;++y){n.set(this.getVertex(y));o=this._vertexToVertexConnectivity[y*2];h=o+this._vertexToVertexConnectivity[y*2+1];for(l=o;l<h;++l){if(r[l]===0){r[l]=1;u=this._vertexToVertexIndices[l];if(u<y){this._vertexToVertexEdgeId[l]=0;continue}this._vertexToVertexEdgeId[l]=i;_=y;g=u;a.set(this.getVertex(g));e.computeEdgeDirection(n,a,s);n.set(a);for(d=0;d<2;++d){x=true;while(x){x=false;c=this._vertexToVertexConnectivity[g*2];f=c+this._vertexToVertexConnectivity[g*2+1];for(p=c;p<f;++p){T=this._vertexToVertexIndices[p];if(T!==_&&r[p]===0&&this._vertexToVertexEdgeId[p]!==i){this._vertexToVertexEdgeId[p]=i;a.set(this.getVertex(T));e.computeEdgeDirection(n,a,v);if(e.compareNormal(s,v)){_=g;g=T;r[p]=1;n.set(a);x=true;if(d>0){this._vertexToVertexEdgeId[p]=-this._vertexToVertexEdgeId[p]}break}}}}_=u;g=y;n.set(this.getVertex(y));s[0]=-s[0];s[1]=-s[1];s[2]=-s[2]}i++}}}};s.prototype._computeBoundingSpheres=function(){var t=0;var r=0;var i;var n;var a;for(var s=0,v=this._triangleCount;s<v;++s){i=this.getVertex(this._triangles[t]);n=this.getVertex(this._triangles[t+1]);a=this.getVertex(this._triangles[t+2]);e.computeTriangleBoundingSphere(i,n,a,this._triangleBoundingSphere,r);t+=3;r+=4}};s.prototype.intersectSphere=function(t,r,i,s,v,o,h,l){var u=a.subarray(0,3);var _=a.subarray(3,6);var g=a.subarray(6,9);var d={faceId:null,faceDistance:null,edgeId:null,edgeDistance:null,vertexId:null,vertexDistance:null};var x=null;var c=null;var f;var p;var T;var y;var V;var C;var I;var w;var S;var U;var E=r*r;var A=s||v;for(var D=0,b=this._triangleCount;D<b;++D){f=e.computePointToPointDistance(this._triangleBoundingSphere,t,D*4);if(f>r+this._triangleBoundingSphere[D*4+3]){continue}for(p=0;p<3;p++){n[p]=this._triangles[D*3+p]}u.set(this.getVertex(n[0]));_.set(this.getVertex(n[1]));g.set(this.getVertex(n[2]));if(i){T=e.getNearestPointOnTriangle(a,t);y=e.computePointToPointDistance2(T,t);if(y>E){continue}if(!d.faceDistance||y<d.faceDistance){d.faceDistance=y;d.faceId=this._triangleFaceId[D]}}if(A){for(V=0;V<3;++V){if(V===0){C=u}else if(V===1){C=_}else{C=g}if(s){I=(V+1)%3;if(I===0){w=u}else if(I===1){w=_}else{w=g}S=e.computeEdgeToPointDistance2(C,w,t);if(S<=E&&(!d.edgeDistance||S<d.edgeDistance)){d.edgeDistance=S;x=n[V];c=n[I]}}if(v){U=e.computePointToPointDistance2(C,t);if(U<=E&&(!d.vertexDistance||U<d.vertexDistance)){d.vertexDistance=U;d.vertexId=n[V]}}}}}if(d.edgeDistance!==null){d.edgeId=this.getEdgeId(x,c)}if(!this._triangleCount&&!this._lineCount&&this._vertexCount&&v){const r=l?l*l:E;for(let i=0,n=this._vertexCount;i<n;++i){u.set(this.getVertex(i));U=e.computePointToPointDistance2(u,t);if(U<=r&&(!d.vertexDistance||U<d.vertexDistance)){d.vertexDistance=U;d.vertexId=i}}}return d};s.prototype.getEdgeId=function(e,t){var r=e<t?[e,t]:[t,e];var i=this._vertexToVertexConnectivity[r[0]*2];var n=i+this._vertexToVertexConnectivity[r[0]*2+1];for(var a=i;a<n;++a){if(r[1]===this._vertexToVertexIndices[a]){var s=this._vertexToVertexEdgeId[a];return s<0?-s:s}}return null};s.prototype.buildEdgePath=function(e,t){var r=[];var i=0;var n=null;var a=null;var s;var v;var o;var h;var l;var u=-e;while(i<this._vertexCount){s=this._vertexToVertexConnectivity[i*2];v=s+this._vertexToVertexConnectivity[i*2+1];for(o=s;o<v;++o){l=this._vertexToVertexEdgeId[o];if(l===e){n=this._vertexToVertexIndices[o]}else if(l===u){a=this._vertexToVertexIndices[o]}}if(n){h=this.getVertex(i);r.push(h[0]);r.push(h[1]);r.push(h[2]);break}i++}while(n){s=this._vertexToVertexConnectivity[n*2];v=s+this._vertexToVertexConnectivity[n*2+1];h=this.getVertex(n);if(t&&r.length===6){r[3]=h[0];r[4]=h[1];r[5]=h[2]}else{r.push(h[0]);r.push(h[1]);r.push(h[2])}n=null;for(o=s;o<v;++o){if(this._vertexToVertexEdgeId[o]===e){n=this._vertexToVertexIndices[o];break}}}while(a){s=this._vertexToVertexConnectivity[a*2];v=s+this._vertexToVertexConnectivity[a*2+1];h=this.getVertex(a);if(t&&r.length===6){r[0]=h[0];r[1]=h[1];r[2]=h[2]}else{r.unshift(h[0],h[1],h[2])}a=null;for(o=s;o<v;++o){if(this._vertexToVertexEdgeId[o]===u){a=this._vertexToVertexIndices[o];break}}}return r};s.prototype.buildFace=function(t){var r=this._triangleCount;var i=this._triangleFaceId;var n=this._triangleBoundingSphere;var a=this._triangles;var s=0;var v=this._vertices;var o=[1,0,0,0];var h=new Uint32Array(this._vertexCount);var l=0;var u;for(u=0;u<r;++u){if(i[u]===t){l++}}var _=new Uint32Array(l*3);var g=new Float64Array(l*4);var d=new Set;var x;var c;var f;var p;var T;l=0;for(u=0;u<r;++u){if(i[u]===t){for(x=0;x<3;++x){f=a[u*3+x];p=h[f];if(p===0){++s;h[f]=s;p=s}_[l*3+x]=p-1}for(x=0;x<4;++x){g[l*4+x]=n[u*4+x]}for(x=0;x<3;++x){c=_[l*3+x];p=_[l*3+(x+1)%3];if(c<p){T=c+":"+p}else{T=p+":"+c}if(d.has(T)){d.delete(T)}else{d.add(T)}}if(l===0){var y=a[u*3]*3;var V=a[u*3+1]*3;var C=a[u*3+2]*3;o=e.computePlaneEquation(v,y,V,C)}l++}}var I=new Float64Array(s*3);for(u=0,l=this._vertexCount;u<l;++u){p=h[u];if(p!==0){x=(p-1)*3;c=u*3;I[x]=v[c];I[x+1]=v[c+1];I[x+2]=v[c+2]}}var w=[];d.forEach(function(e){p=e.split(":");w.push(Number(p[0]));w.push(Number(p[1]))});return{vertices:I,triangles:_,boundingSpheres:g,edges:w,planeEquation:o}};s.prototype.getTriangleCount=function(){return this._triangleCount};s.prototype.getLineCount=function(){return this._lineCount};s.prototype.getVertexCount=function(){return this._vertexCount};s.prototype.isTriangleDoubleSided=function(e){return this._triangleDoubleSidedFlag[e]>0};s.prototype.getVertex=function(e){var t=e*3;return[this._vertices[t],this._vertices[t+1],this._vertices[t+2]]};s.prototype.computeTriangleNormal=function(t){var r=this._triangles[t*3]*3;var i=this._triangles[t*3+1]*3;var n=this._triangles[t*3+2]*3;var a=[this._vertices[r],this._vertices[r+1],this._vertices[r+2]];var s=e.pointMinusPoint(this._vertices,a,i);var v=e.pointMinusPoint(this._vertices,a,n);var o=e.crossProduct(s,v);var h=e.dotProduct(o,o);if(h===0){return[1,0,0]}h=1/Math.sqrt(h);return[o[0]*h,o[1]*h,o[2]*h]};return s});
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/measurements/MeshAnalyzer2D", ["./Utils","sap/base/Log"],function(e,r){"use strict";function t(e,a){this._uid=e.uid;var i=Math.sqrt(a[2]*a[2]+a[3]*a[3]);this._samplingKoeff=1e4/i;this._tagName=e.tagName();this._matrix=e._matrixWorld();this._invMatrix=t.invertMatrix3x2(this._matrix);switch(this._tagName){case"ellipse":this.cx=e.cx;this.cy=e.cy;this.rx=e.rx;this.ry=e.ry;break;case"image":this.x=e.x;this.y=e.y;this.width=e.width;this.height=e.height;break;case"line":case"linearGradient":this.x1=e.x1;this.y1=e.y1;this.x2=e.x2;this.y2=e.y2;break;case"path":this.segments=e.segments;break;case"polygon":case"polyline":this.points=e.points;break;case"rect":this.x=e.x;this.y=e.y;this.rx=e.rx;this.ry=e.ry;this.width=e.width;this.height=e.height;break;case"text":break;default:r.error("Unknown svg tag: "+this._tagName);break}}t.invertMatrix3x2=function(e){var t=e[0];var a=e[1];var i=e[2];var n=e[3];var s=e[4];var l=e[5];var o=t*n-a*i;if(!o){r.error("Empty determinant of matrix 'a'");return null}o=1/o;var v=[];v.push(n*o);v.push(-a*o);v.push(-i*o);v.push(t*o);v.push((i*l-n*s)*o);v.push((a*s-t*l)*o);return v};t.transform2d=function(e,r){var t=e[0];var a=e[1];return[r[0]*t+r[2]*a+r[4],r[1]*t+r[3]*a+r[5]]};t.distanceToRectangle=function(r,t,a,i,n,s,l,o,v){var u=a*a;var c=Number.MAX_VALUE;var h;var f=Number.MAX_VALUE;var m;var p;var d=[r,t,0];var g=[];for(var x=0;x<4;++x){var P=s+(x===0||x===3?0:o);var y=l+(x===0||x===1?0:v);g.push(P,y);if(n){p=e.computePointToPointDistance2([P,y,0],d);if(p<c){c=p;h=[P,y]}}if(i){var T=(x+1)%4;var b=s+(T===0||T===3?0:o);var D=l+(T===0||T===1?0:v);p=e.computeEdgeToPointDistance2([P,y,0],[b,D,0],d);if(p<f){f=p;m=[P,y,b,D]}}}var _=c<u?h:null;var M=f<u?m:null;g.push(g[0],g[1]);return[_,M,!_&&M?g:null]};t.distanceToLine=function(r,t,a,i,n,s,l,o,v){var u=null;var c=null;var h=a*a;var f=[s,l,0];var m=[o,v,0];var p=[r,t,0];if(i&&e.computeEdgeToPointDistance2(f,m,p)<h){c=[f[0],f[1],m[0],m[1]]}if(n){var d=e.computePointToPointDistance2(f,p);var g=e.computePointToPointDistance2(m,p);if(d<g&&d<h){u=f}else if(g<d&&g<h){u=m}}return[u,c]};t.distanceToPolyLine=function(r,t,a,i,n,s,l){var o=null;var v=null;var u=a*a;var c=Number.MAX_VALUE;var h;var f=Number.MAX_VALUE;var m;var p;var d=[r,t,0];var g;var x;var P;var y;var T=l.length;if(T<2){return[]}for(var b=0;b<T;b+=2){g=l[b];x=l[b+1];if(n){p=e.computePointToPointDistance2([g,x,0],d);if(p<c){c=p;h=[g,x]}}if(i){if(b>0){p=e.computeEdgeToPointDistance2([P,y,0],[g,x,0],d);if(p<f){f=p;m=[P,y,g,x]}}else if(s){P=l[T-2];y=l[T-1];f=e.computeEdgeToPointDistance2([P,y,0],[g,x,0],d);m=[P,y,g,x]}}P=g;y=x}if(c<u){o=h}if(f<u){v=m}var D=null;if(!o&&v){D=Array.from(l);if(s){D.push(l[0],l[1])}}return[o,v,D]};t.distanceToEllipse=function(r,t,a,i,n,s,l,o,v){var u=null;var c=[r,t,0];var h=[i,n,0];var f=e.computePointToPointDistance2(h,c);u=[i,n];var m=e.computeEdgeDirection(h,c);var p=e.angleBetweenVectors2D(1,0,m[0],m[1]);if(o!=null&&v!=null){p=e.clampAngle(p,o,v)}m=[i+s*Math.cos(p),n+l*Math.sin(p),0];var d=e.computePointToPointDistance2(m,c);if(d<f){f=d;u=m}return f<a*a?u:null};t.computeArcCenter=function(r,t,a,i,n,s,l,o){var v=l===false;var u=o!==false;var c=.5*(r-a);var h=.5*(t-i);var f=c*c/(n*n)+h*h/(s*s);if(f>1){f=Math.sqrt(f);n=n*f;s=s*f}var m=n*s;var p=n*h;var d=s*c;f=p*p+d*d;if(!f){return null}var g=Math.sqrt(Math.abs((m*m-f)/f));if(v==u){g=-g}var x=g*p/s;var P=-g*d/n;var y=x+.5*(r+a);var T=P+.5*(t+i);var b=(c-x)/n;var D=(c+x)/n;var _=(h-P)/s;var M=(h+P)/s;var A=e.angleBetweenVectors2D(1,0,b,_);var E=e.clampAngle2PI(e.angleBetweenVectors2D(b,_,-D,-M));if(!u){E-=2*Math.PI}return{cx:y,cy:T,rx:n,ry:s,startAngle:A,deltaAngle:E}};t.sampleBezier=function(r,t,a,i,n){return n?e.bezierCubic2D(r,t,i,n,a):e.bezierQuadric2D(r,t,i,a)};t.sampleBezierCurve=function(r,a,i,n,s){var l=e.computePointToPointDistance2D(r,i);if(n){l+=e.computePointToPointDistance2D(i,n);l+=e.computePointToPointDistance2D(n,a)}else{l+=e.computePointToPointDistance2D(i,a)}var o=Math.min(Math.max(l*s,35),200);var v=[];for(var u=0;u<o;++u){var c=t.sampleBezier(u/o,r,a,i,n);v.push(c[0],c[1])}return v};t.sampleEllipse=function(e,r,t,a,i,n,s){var l=Math.max(t,a)*n;var o=Math.min(Math.max(l*s,35),200);var v=[];for(var u=0;u<o;++u){var c=i+u*n/o;v.push(e+t*Math.cos(c),r+a*Math.sin(c))}return v};t.distanceToBezier=function(r,a,i,n,s,l,o){var v=[r,a,0];var u=Number.MAX_VALUE;var c;var h;var f;var m;var p;var d=100;var g=function(e){if(e<=0){return n}if(e>=1){return s}return t.sampleBezier(e,n,s,l,o)};for(p=0;p<=d;++p){f=p/d;h=g(f);m=e.computePointToPointDistance2(h,v);if(m<u){u=m;c=f}}p=.5/d;while(p>1e-8){for(d=0;d<2;++d){f=d==0?c-p:c+p;h=g(f);m=e.computePointToPointDistance2(h,v);if(m<u){u=m;c=f}}p*=.5}return u>i*i?null:g(c)};t.distanceToPath=function(r,a,i,n,s,l,o,v,u){var c=[];var h=[];var f=null;var m=null;var p=0;var d=i*i;var g=Number.MAX_VALUE;var x;var P=Number.MAX_VALUE;var y;var T;var b=[r,a,0];var D;var _;var M;var A;var E;var k=0;var w=0;var I=0;var L=0;var N=null;var z=null;var B=null;var C=null;var V=function(e,r,t,a,i){var n=c.length;if(!n||c[n-2]!==e||c[n-1]!==r){p++;h.push(i?-p:p);c.push(e,r)}h.push(i?-p:p);c.push(t,a)};var U=function(e,r,t,a,i){var n=e;var s=r;var l,o;for(var v=0,u=t.length;v<u;v+=2){l=t[v];o=t[v+1];V(n,s,l,o,true);n=l;s=o}V(n,s,a,i,true)};var X=function(){if(s){T=e.computePointToPointDistance2([k,w,0],b);if(T<g){g=T;x=[k,w];m=null}}if(N!=null){if(l){V(N,z,k,w,false)}if(n){T=e.computeEdgeToPointDistance2([N,z,0],[k,w,0],b);if(T<P){P=T;y=[N,z,k,w];f=h.length-1}}}N=k;z=w};for(var q=0,K=v.length;q<K;++q){D=v[q];_=D.points;M=D.dimension||2;switch(D.type){case"arc":N=k;z=w;if(D.relative){k+=_[0];w+=_[1]}else{k=_[0];w=_[1]}var S=t.computeArcCenter(N,z,k,w,D.major,D.minor,D.short,D.clockwise);if(S){if(l){U(N,z,t.sampleEllipse(S.cx,S.cy,S.rx,S.ry,S.startAngle,S.deltaAngle,u),k,w)}if(s){var G=t.distanceToEllipse(r,a,i,S.cx,S.cy,S.rx,S.ry,S.startAngle,S.deltaAngle);if(G){var R=e.computePointToPointDistance2(G,b);if(R<g){g=R;x=G;f=h.length-1;if(o&&e.computePointToPointDistance2(G,[N,z,0])>d&&e.computePointToPointDistance2(G,[k,w,0])>d){m=[N,z].concat(t.sampleEllipse(S.cx,S.cy,S.rx,S.ry,S.startAngle,S.deltaAngle,u),[k,w])}}}}}break;case"move":N=null;z=null;k=_[0];w=_[1];I=k;L=w;X();for(A=M,E=_.length-1;A<E;A+=M){if(D.relative){k+=_[A];w+=_[A+1]}else{k=_[A];w=_[A+1]}X()}break;case"line":N=k;z=w;for(A=0,E=_.length-1;A<E;A+=M){if(D.relative){k+=_[A];w+=_[A+1]}else{k=_[A];w=_[A+1]}X()}break;case"close":N=k;z=w;k=I;w=L;X();break;case"bezier":var j=D.degree||2;var Q=0;var W=j-1;if(D.smooth){W--;B=k;C=w}var F=[null,null];for(A=0,E=_.length-1;A<E;A+=M){if(Q===0){I=k;L=w;N=null;z=null}if(Q<W){if(D.relative){F[Q]=[k+_[A],w+_[A+1]]}else{F[Q]=[_[A],_[A+1]]}Q++}else{if(D.relative){k+=_[A];w+=_[A+1]}else{k=_[A];w=_[A+1]}var H=[2*I-B,2*L-C];var J=D.smooth||j===2?0:1;B=F[J][0];C=F[J][1];var O=D.smooth?H:F[0];var Y=j===2?null:[B,C];var Z=[I,L];var $=[k,w];if(l){U(Z[0],Z[1],t.sampleBezierCurve(Z,$,O,Y,u),$[0],$[1])}if(s){var ee=t.distanceToBezier(r,a,i,Z,$,O,Y);if(ee){var re=e.computePointToPointDistance2(ee,b);if(re<g){g=re;x=ee;f=h.length-1;if(o&&e.computePointToPointDistance2(ee,[I,L,0])>d&&e.computePointToPointDistance2(ee,[k,w,0])>d){m=[Z[0],Z[1]].concat(t.sampleBezierCurve(Z,$,O,Y,u),[$[0],$[1]])}}}}Q=0}}break;default:break}}var te=g<d?x:null;var ae=P<d?y:null;var ie=l&&(te||ae)?e.findClosedContour(c,h,f):null;return[te,ae,ie,te?m:null]};t.prototype.intersectSphere=function(r,a,i,n,s,l,o){var v={faceId:null,edgeId:null,vertexId:null,contourId:null,curvedEdgeId:null,edge:null,vertex:null,contour:null,curvedEdge:null};var u=r[0];var c=r[1];var h=t.transform2d([u,c],this._invMatrix);var f=t.transform2d([u+a,c],this._invMatrix);u=h[0];c=h[1];var m=Math.sqrt((f[0]-u)*(f[0]-u)+(f[1]-c)*(f[1]-c));var p=[];switch(this._tagName){case"ellipse":if(s){var d=t.distanceToEllipse(u,c,m,this.cx,this.cy,this.rx,this.ry,null,null);if(d){if(l){var g=t.sampleEllipse(this.cx,this.cy,this.rx,this.ry,0,2*Math.PI,this._samplingKoeff);g.push(g[0],g[1]);p.push(d,null,g)}else{p.push(d)}}}break;case"rect":case"image":p=t.distanceToRectangle(u,c,m,n,s,this.x,this.y,this.width,this.height);break;case"line":case"linearGradient":p=t.distanceToLine(u,c,m,n,s,this.x1,this.y1,this.x2,this.y2);break;case"path":p=t.distanceToPath(u,c,m,n,s,l,o,this.segments,this._samplingKoeff);break;case"polygon":p=t.distanceToPolyLine(u,c,m,n,s,true,this.points);break;case"polyline":p=t.distanceToPolyLine(u,c,m,n,s,false,this.points);break;default:break}f=p.length>0?p[0]:null;if(f){var x=t.transform2d([f[0],f[1]],this._matrix);v.vertex=[x[0],x[1],0];v.vertexId="v"+x[0]+":"+x[1]}f=p.length>1?p[1]:null;if(f){var P=t.transform2d([f[0],f[1]],this._matrix);var y=t.transform2d([f[2],f[3]],this._matrix);v.edge=[P[0],P[1],0,y[0],y[1],0];v.edgeId="e"+P[0]+":"+P[1]+":"+y[0]+":"+y[1]}f=p.length>2?p[2]:null;var T;if(l&&f&&f.length>=6){var b=[];for(var D=0,_=f.length/2;D<_;++D){T=t.transform2d([f[D*2],f[D*2+1]],this._matrix);b.push(T[0],T[1],0)}if(e.isClosedContour(b)&&!e.hasSelfIntersections(b,false)){v.contour=b;v.contourId="cc:"+(this._uid?this._uid:"")+":"+b[0]+":"+b[1]}}f=p.length>3?p[3]:null;if(o&&f&&f.length>=6){var M=[];for(var A=0,E=f.length/2;A<E;++A){T=t.transform2d([f[A*2],f[A*2+1]],this._matrix);M.push(T[0],T[1],0)}if(!e.hasSelfIntersections(M,true)){v.curvedEdge=M;v.curvedEdgeId="ce:"+(this._uid?this._uid:"")+":"+M[0]+":"+M[1]}}return v};return t});
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/measurements/Settings", [],function(){"use strict";var e="sap.ui.vk.measurements.Settings";var t={color:0,precision:1,units:"mm",featureVertex:true,featureEdge:true,featureFace:true};var r={};r.load=function(){var r=self.localStorage.getItem(e);if(r==null){r={}}else{try{r=JSON.parse(r)}catch(e){r={}}}return Object.assign(Object.assign({},t),r)};r.save=function(t){var r;if("scale"in t){r=t.scale;delete t.scale}self.localStorage.setItem(e,JSON.stringify(t));if(r!=null){t.scale=r}return this};return r});
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/measurements/Surface", ["sap/base/Log","sap/ui/base/EventProvider","sap/base/i18n/Localization","sap/ui/core/format/NumberFormat","../getResourceBundle","./Measurement","../glMatrix","./Settings","./Utils","../uuidv4"],function(e,t,r,i,a,n,s,o,u,m){"use strict";var c=6;var l=16;var d="http://www.w3.org/2000/svg";var h=t.extend("sap.ui.vk.measurements.Surface",{metadata:{library:"sap.ui.vk"},constructor:function(){t.call(this);var e=document.createElementNS(d,"svg");e._surface=this;e.setAttribute("id","measurement-surface-"+m());e.classList.add("sapUiVizKitMeasurementSurface");e.setAttribute("data-help-id","sapUiVkMeasurementSurface");e.innerHTML="<defs>"+"<marker markerWidth='6' markerHeight='4' refX='3' refY='2' orient='auto' id='arrow-start-highlighted'>"+"<polygon points='6 0, 6 4, 0 2'/>"+"</marker>"+"<marker markerWidth='6' markerHeight='4' refX='3' refY='2' orient='auto' id='arrow-end-highlighted'>"+"<polygon points='0 0, 6 2, 0 4'/>"+"</marker>"+"<marker markerWidth='6' markerHeight='4' refX='3' refY='2' orient='auto' id='arrow-start0'>"+"<polygon points='6 0, 6 4, 0 2'/>"+"</marker>"+"<marker markerWidth='6' markerHeight='4' refX='3' refY='2' orient='auto' id='arrow-end0'>"+"<polygon points='0 0, 6 2, 0 4'/>"+"</marker>"+"<marker markerWidth='6' markerHeight='4' refX='3' refY='2' orient='auto' id='arrow-start1'>"+"<polygon points='6 0, 6 4, 0 2'/>"+"</marker>"+"<marker markerWidth='6' markerHeight='4' refX='3' refY='2' orient='auto' id='arrow-end1'>"+"<polygon points='0 0, 6 2, 0 4'/>"+"</marker>"+"<marker markerWidth='6' markerHeight='4' refX='3' refY='2' orient='auto' id='arrow-start2'>"+"<polygon points='6 0, 6 4, 0 2'/>"+"</marker>"+"<marker markerWidth='6' markerHeight='4' refX='3' refY='2' orient='auto' id='arrow-end2'>"+"<polygon points='0 0, 6 2, 0 4'/>"+"</marker>"+"<marker markerWidth='6' markerHeight='4' refX='3' refY='2' orient='auto' id='arrow-start3'>"+"<polygon points='6 0, 6 4, 0 2'/>"+"</marker>"+"<marker markerWidth='6' markerHeight='4' refX='3' refY='2' orient='auto' id='arrow-end3'>"+"<polygon points='0 0, 6 2, 0 4'/>"+"</marker>"+"<marker markerWidth='6' markerHeight='4' refX='3' refY='2' orient='auto' id='arrow-start4'>"+"<polygon points='6 0, 6 4, 0 2'/>"+"</marker>"+"<marker markerWidth='6' markerHeight='4' refX='3' refY='2' orient='auto' id='arrow-end4'>"+"<polygon points='0 0, 6 2, 0 4'/>"+"</marker>"+"</defs>";var r=document.createElementNS(d,"g");var i=document.createElementNS(d,"g");var a=document.createElementNS(d,"g");e.append(r,i,a);this._svgDomRef=e;this._featuresDomRef=r;this._measurementsDomRef=i;this._measurementsUnderConstructionDomRef=a;this._features=[];this._measurements=[];this._measurementsUnderConstruction=[];this._settings=o.load();this._settings.scale=1}});h.prototype.destroy=function(){if(this._svgDomRef!=null){this._svgDomRef.remove();this._svgDomRef._surface=null}this._svgDomRef=null;this._featuresDomRef=null;this._measurementsDomRef=null;this._measurementsUnderConstructionDomRef=null;this._features=null;this._measurements=null;this._measurementsUnderConstruction=null;this._settings=null;t.prototype.destroy(this)};h.prototype.getDomRef=function(){return this._svgDomRef};h.prototype.addMeasurement=function(e){this._addMeasurement(e,false);this.fireMeasurementsAdded({measurements:[e]});return this};h.prototype._addMeasurement=function(e,t){var r;if(e.isDistance){r=document.createElementNS(d,"g");r.dataset.sapUiVkMeasurement=true;var i=document.createElementNS(d,"line");var a=document.createElementNS(d,"rect");var n=document.createElementNS(d,"text");n.appendChild(document.createTextNode(""));r.append(i,a,n)}else if(e.isAngle){r=document.createElementNS(d,"g");r.dataset.sapUiVkMeasurement=true;var s=document.createElementNS(d,"path");var o=document.createElementNS(d,"path");o.classList.add("sapUiVizKitMeasurementDashed");var u=document.createElementNS(d,"path");u.classList.add("sapUiVizKitMeasurementDotted");var m=document.createElementNS(d,"path");var c=document.createElementNS(d,"rect");var l=document.createElementNS(d,"text");l.appendChild(document.createTextNode(""));r.append(s,o,u,m,c,l)}else if(e.isArea){r=document.createElementNS(d,"g");r.dataset.sapUiVkMeasurement=true;var h=document.createElementNS(d,"path");h.classList.add("sapUiVizKitMeasurementFill");h.setAttribute("opacity",.5);var v=document.createElementNS(d,"path");v.classList.add("sapUiVizKitMeasurementStroke");v.setAttribute("opacity",.5);var f=document.createElementNS(d,"path");f.classList.add("sapUiVizKitMeasurementArea");var p=document.createElementNS(d,"path");p.classList.add("sapUiVizKitMeasurementAreaEdgeIntersecting");var g=document.createElementNS(d,"rect");var y=document.createElementNS(d,"text");y.appendChild(document.createTextNode(""));r.append(h,v,f,p,g,y)}else{throw new Error("Unknown measurement object")}if(t){this._measurementsUnderConstruction.push(e);this._measurementsUnderConstructionDomRef.appendChild(r)}else{this._measurements.push(e);this._measurementsDomRef.appendChild(r)}r._measurement=e;return this};h.prototype.removeMeasurement=function(e){this.fireMeasurementsRemoving({measurements:[e]});this._removeMeasurement(e,false);return this};h.prototype._removeMeasurement=function(e,t){var r;var i;if(t){r=this._measurementsUnderConstruction;i=this._measurementsUnderConstructionDomRef}else{r=this._measurements;i=this._measurementsDomRef}var a=r.indexOf(e);if(a>=0){r.splice(a,1);i.children[a].remove()}e.getFeatures().forEach(function(e){if(e){this.removeFeature(e)}},this);return this};h.prototype.beginMeasurementConstruction=function(e){this._addMeasurement(e,true);return this};h.prototype.endMeasurementConstruction=function(e){var t=this._measurementsUnderConstruction.indexOf(e);if(t>=0){this._measurementsUnderConstruction.splice(t,1);this._measurements.push(e);this._measurementsDomRef.appendChild(this._measurementsUnderConstructionDomRef.children[t]);this.fireMeasurementsAdded({measurements:[e]})}return this};h.prototype.cancelMeasurementConstruction=function(e){this._removeMeasurement(e,true);return this};h.prototype.getMeasurementsUnderConstruction=function(){return this._measurementsUnderConstruction};h.prototype.highlightMeasurement=function(e,t,r,i){var a=this._measurements;var n=a.indexOf(e);if(n<0){return}e.setHighlighted(t);var s=this._measurementsDomRef.children[n];var o=s.children[0];var u=this.getMeasurementArrowColorCode();if(t){if(u!==""){s.classList.remove("sapUiVizKitMeasurement"+u)}s.classList.add("sapUiVizKitMeasurementHighlighted");if(e.isArea){s.children[2].removeAttribute("opacity")}else{o.setAttribute("marker-start","url(#arrow-start-highlighted)");o.setAttribute("marker-end","url(#arrow-end-highlighted)")}e.getFeatures().forEach(function(e){if(e){this.addFeature(e);var t=this._features.indexOf(e);if(t>=0){v(this._featuresDomRef.children[t],e,r,i,this._settings)}}},this)}else{s.classList.remove("sapUiVizKitMeasurementHighlighted");if(u!==""){s.classList.add("sapUiVizKitMeasurement"+u)}if(e.isArea){s.children[2].setAttribute("opacity",.5)}else{o.setAttribute("marker-start","url(#arrow-start"+u+")");o.setAttribute("marker-end","url(#arrow-end"+u+")")}e.getFeatures().forEach(function(e){if(e){this.removeFeature(e)}},this)}};h.prototype.getMeasurements=function(){return this._measurements};h.prototype.getMeasurementById=function(e){return this._measurements.find(function(t){return t.getId()===e})};h.prototype.addFeature=function(e){if(this._features.indexOf(e)>=0){return this}var t;if(e.isVertex){t=document.createElementNS(d,"circle")}else if(e.isEdge){t=document.createElementNS(d,"line")}else if(e.isFace){t=document.createElementNS(d,"g");var r=document.createElementNS(d,"path");var i=document.createElementNS(d,"path");i.classList.add("sapUiVizKitMeasurementContour");t.append(r,i)}else{throw new Error("Unknown measurement feature")}this._features.push(e);this._featuresDomRef.append(t);return this};h.prototype.removeFeature=function(e){var t=this._features;var r=t.indexOf(e);if(r>=0){t.splice(r,1);this._featuresDomRef.children[r].remove()}return this};function v(e,t,r,i,a){var n=null;if(t.isVertex){n=V}else if(t.isEdge){n=x}else if(t.isFace){n=U}if(n!=null){n(e,t,r,i,a)}}h.prototype.update=function(e,t){var r;var i;var a=this._measurements;var n=this._measurementsDomRef.children;for(var s=0;s<2;++s){for(r=0,i=a.length;r<i;++r){var o=a[r];var u=n[r];if(o.getVisible()){u.setAttribute("visibility","visible")}else{u.setAttribute("visibility","hidden");continue}var m=null;if(o.isDistance){m=b}else if(o.isAngle){m=S}else if(o.isArea){m=D}if(m!=null){m(u,o,e,t,this._settings)}}a=this._measurementsUnderConstruction;n=this._measurementsUnderConstructionDomRef.children}var c=this._features;var l=this._featuresDomRef.children;for(r=0,i=c.length;r<i;++r){v(l[r],c[r],e,t,this._settings)}return this};var f=new Map;r.attachChange(function(){f.clear()});function p(e,t){var r=t.precision;var n=t.units;var s=t.scale*u.getUnitFactor(n);var o=f.get(r);if(o==null){o=i.getFloatInstance({minFractionDigits:r,maxFractionDigits:r});f.set(r,o)}var m=a().getText("MEASUREMENTS_DISTANCE_VALUE",[o.format(e*s),u.translateUnits(n)]);return m}function g(e,t,r,i,a,n){e.childNodes[0].data=r;var s=e.getBBox().width+10;var o=26;var u=i-s*.5;var m=a-o*.5;if(n&&n.x>=u&&n.x<=u+s&&n.y>=m&&n.y<=m+o){a-=o;m-=o}t.x.baseVal.value=u;t.y.baseVal.value=m;t.width.baseVal.value=s;e.setAttribute("x",i);e.setAttribute("y",a)}function y(e,t,r){var i=r?"sapUiVizKitMeasurementHighlighted":"sapUiVizKitMeasurement"+t;if(!e.classList.contains(i)){e.classList.forEach(function(e,t,r){r.remove(e)});e.classList.add(i)}}function b(e,t,r,i,a){var n=w(a);var s=t.getHighlighted();y(e,n,s);var o=t.getPoint1();var u=t.getPoint2();var m=r.projectToScreen(o[0],o[1],o[2],i);var l=r.projectToScreen(u[0],u[1],u[2],i);var d=e.children[0];if(t.getShowArrows()){var h=l.x-m.x;var v=l.y-m.y;var f=Math.sqrt(h*h+v*v);if(Math.abs(f)<1e-5){e.setAttribute("visibility","hidden");return this}var b=c*h/f;var A=c*v/f;d.x1.baseVal.value=m.x+b;d.y1.baseVal.value=m.y+A;d.x2.baseVal.value=l.x-b;d.y2.baseVal.value=l.y-A;d.setAttribute("marker-start",s?"url(#arrow-start-highlighted)":"url(#arrow-start"+n+")");d.setAttribute("marker-end",s?"url(#arrow-end-highlighted)":"url(#arrow-end"+n+")")}else{d.x1.baseVal.value=m.x;d.y1.baseVal.value=m.y;d.x2.baseVal.value=l.x;d.y2.baseVal.value=l.y;d.removeAttribute("marker-start");d.removeAttribute("marker-end")}e.removeAttribute("visibility");var M=(m.x+l.x)*.5;var _=(m.y+l.y)*.5;g(e.children[2],e.children[1],p(t.getDistance(),a),M,_,m);return this}function A(e,t,r,i){var a=i|0;var n=e.projectToScreen(r[a+0],r[a+1],r[a+2],t);return[n.x,n.y,0]}function M(e,t,r){var i=r|0;var a=s.vec3.fromValues(t[i],t[i+1],t[i+2]);s.vec3.transformMat4(a,a,e);return a}function _(e,t,r,i){var a=M(r,i);return A(e,t,a)}function E(e,t){return s.vec3.fromValues(t*Math.cos(e),t*Math.sin(e),0)}function S(e,t,r,n,o){var m=w(o);var d=t.getHighlighted();y(e,m,d);var h=t.getPoints();var v=[h[6],h[7],h[8]];var p=[h[9],h[10],h[11]];var b=u.pointMinusPoint(v,p);b=u.pointMinusPoint(h,b);var A=[h[15],h[16],h[17]];var S=u.normalize(u.crossProduct(u.computeEdgeDirection(p,b),u.computeEdgeDirection(p,A)));var k=s.mat4.create();var D=s.quat.create();s.quat.rotationTo(D,s.vec3.fromValues(0,0,1),s.vec3.fromValues(S[0],S[1],S[2]));s.mat4.fromRotationTranslation(k,D,s.vec3.fromValues(p[0],p[1],p[2]));var V=s.mat4.create();s.mat4.invert(V,k);var x=M(V,h,0);var U=M(V,h,3);var R=M(V,v);var C=M(V,p);var N=M(V,h,12);var L=M(V,h,15);var P=_(r,n,k,x);var T=_(r,n,k,U);var F="M"+P[0]+" "+P[1]+" L"+T[0]+" "+T[1];var H=u.computePointToPointDistance(x,U);var I=u.computePointToPointDistance(C,N);var z=u.computePointToPointDistance(C,L);var K=I>z?I:z;var j=t.getState();if(j>0&&H>0&&K>0){var W=_(r,n,k,N);var X=W;var Y=T;if(X[0]!==Y[0]||X[1]!==Y[1]){F+=" M"+X[0]+" "+X[1]}var O=_(r,n,k,L);F+=" L"+O[0]+" "+O[1];var B=u.computeEdgeDirection(U,x);var q=u.computeEdgeDirection(N,L);var J=t.getRadiusScale();var Z=J<0;var G=K*Math.abs(J);var Q=u.angleBetweenVectors2D(1,0,B[0],B[1]);var $=u.angleBetweenVectors2D(B[0],B[1],q[0],q[1]);if($<0){Q=u.angleBetweenVectors2D(B[0],B[1],-1,0);$=-$}var ee=Q+$/2;var te=t.getAngle();var re=Math.PI/180;X=_(r,n,k,E(ee,G));Y=_(r,n,k,E(ee+re,G));var ie=re*c/u.computePointToPointDistance(X,Y);if(Z){ee+=Math.PI;te=2*Math.PI-te;$=$-2*Math.PI;ie=-ie}var ae=Math.ceil(Math.abs($)/(Math.PI/2));var ne=Q+ie;var se=($-ie-ie)/ae;var oe="";for(var ue=0;ue<ae;++ue){var me=E(ne+se*ue,G);var ce=E(ne+se*(1+ue),G);var le=me[0];var de=me[1];var he=ce[0];var ve=ce[1];var fe=le*le+de*de;var pe=fe+le*he+de*ve;var ge=4/3*(Math.sqrt(2*fe*pe)-pe)/(le*ve-de*he);var ye=[le-ge*de,de+ge*le,0];var be=[he+ge*ve,ve-ge*he,0];if(ue===0){me=_(r,n,k,me);oe+=" M"+me[0]+" "+me[1]}ye=_(r,n,k,ye);be=_(r,n,k,be);ce=_(r,n,k,ce);oe+=" C"+ye[0]+" "+ye[1]+" "+be[0]+" "+be[1]+" "+ce[0]+" "+ce[1]}var Ae=e.children[0];Ae.setAttribute("d",oe);Ae.setAttribute("marker-start",d?"url(#arrow-start-highlighted)":"url(#arrow-start"+m+")");Ae.setAttribute("marker-end",d?"url(#arrow-end-highlighted)":"url(#arrow-end"+m+")");Ae.setAttribute("opacity",j===1?.5:1);Ae.removeAttribute("visibility");Ae=e.children[1];var Me=_(r,n,k,R);var _e=_(r,n,k,C);var Ee=Me[0]!==_e[0]||Me[1]!==_e[1];X=_e;Y=_(r,n,k,E(Q,G));var Se=u.computePointToPointDistance(X,Y)+l;var ke=u.computeEdgeDirection(X,Y);var De=u.pointPlusPoint(u.scalePoint(ke,Se),X);var Ve="";if(Ee){Ve="M"+X[0]+" "+X[1]+" L"+De[0]+" "+De[1]}else if(u.computeEdgeToPointDistance2(P,T,De)>.001){Ve="M"+P[0]+" "+P[1]+" L"+De[0]+" "+De[1]}X=_e;Y=_(r,n,k,E(Q+$,G));Se=u.computePointToPointDistance(X,Y)+l;ke=u.computeEdgeDirection(X,Y);De=u.pointPlusPoint(u.scalePoint(ke,Se),X);if(u.computeEdgeToPointDistance2(W,O,De)>.001){Ve+="M"+O[0]+" "+O[1]+" L"+De[0]+" "+De[1]}if(Ve.length>0){Ae.setAttribute("d",Ve);Ae.removeAttribute("visibility")}else{Ae.setAttribute("d","");Ae.setAttribute("visibility","hidden")}Ae=e.children[2];if(Ee){X=Me;Y=_e;Ae.setAttribute("d","M"+X[0]+" "+X[1]+" L"+Y[0]+" "+Y[1]);Ae.removeAttribute("visibility")}else{Ae.setAttribute("d","");Ae.setAttribute("visibility","hidden")}var xe=o.precision;var Ue=f.get(xe);if(Ue==null){Ue=i.getFloatInstance({minFractionDigits:xe,maxFractionDigits:xe});f.set(xe,Ue)}var we=a().getText("MEASUREMENTS_ANGLE_VALUE",[Ue.format(180*te/Math.PI)]);X=_(r,n,k,E(ee,G));g(e.children[5],e.children[4],we,X[0],X[1],null);e.children[3].removeAttribute("visibility");e.children[4].removeAttribute("visibility");e.children[5].removeAttribute("visibility")}else{e.children[0].setAttribute("visibility","hidden");e.children[1].setAttribute("visibility","hidden");e.children[2].setAttribute("visibility","hidden");e.children[4].setAttribute("visibility","hidden");e.children[5].setAttribute("visibility","hidden")}var Re=e.children[3];Re.setAttribute("d",F);y(Re,"StrokeColor"+m,false);Re.removeAttribute("visibility");return this}function k(e,t){var r=t.precision;var n=t.units;var s=t.scale*u.getUnitFactor(n);var o=f.get(r);if(o==null){o=i.getFloatInstance({minFractionDigits:r,maxFractionDigits:r});f.set(r,o)}var m=a().getText("MEASUREMENTS_AREA_VALUE",[o.format(e*s*s),u.translateUnits(n,"2")]);return m}function D(e,t,r,i,a){var n=w(a);var s=t.getHighlighted();y(e,n,s);var o=t.getArea();var u=o&&o<0;if(u){o=-o}var m=t.getPoints();var c=e.children[2];var l=m?m.length:0;if(l>=6){var d="";for(var h=0;h<l;h+=3){var v=A(r,i,m,h);d+=(h===0?"M":" L")+v[0]+" "+v[1]}if(!u){d+=" Z"}c.setAttribute("d",d);c.removeAttribute("visibility")}else{c.setAttribute("visibility","hidden")}c.classList.remove("sapUiVizKitMeasurementAreaSelfIntersecting");var f=t.hasSelfIntersections();if(f){c.classList.add("sapUiVizKitMeasurementAreaSelfIntersecting")}var p=e.children[3];if(l>=6&&t.hasSelfIntersectionsLastEdge()){var b=A(r,i,m,l-6);var M=A(r,i,m,l-3);p.setAttribute("d","M"+b[0]+" "+b[1]+" L"+M[0]+" "+M[1]);p.removeAttribute("visibility")}else{p.setAttribute("visibility","hidden")}var _=t.getFeatures();if(_&&Array.isArray(_)&&_.length===1&&_[0].isFace){U(e,_[0],r,i,null)}else{e.children[0].setAttribute("d","");e.children[1].setAttribute("d","")}if(s||u){c.removeAttribute("opacity")}else{c.setAttribute("opacity",.5)}var E=e.children[4];var S=e.children[5];if(o&&!f){var D=A(r,i,t.getPosition());g(S,E,k(o,a),D[0],D[1],null);S.removeAttribute("visibility");E.removeAttribute("visibility")}else{S.setAttribute("visibility","hidden");E.setAttribute("visibility","hidden")}return this}function V(e,t,r,i,a){var n=t.getValue();var s=r.projectToScreen(n[0],n[1],n[2],i);e.cx.baseVal.value=s.x;e.cy.baseVal.value=s.y;return this}function x(e,t,r,i,a){var n=t.getValue();var s=r.projectToScreen(n[0],n[1],n[2],i);e.x1.baseVal.value=s.x;e.y1.baseVal.value=s.y;s=r.projectToScreen(n[3],n[4],n[5],i);e.x2.baseVal.value=s.x;e.y2.baseVal.value=s.y;return this}function U(e,t,r,i,a){var n=t.getValue();var s=n.vertices;var o=n.triangles;var u=n.edges;var m;var c;var l;var d;var h;h="";for(l=0,d=o?o.length:0;l<d;l+=3){m=o[l]*3;c=r.projectToScreen(s[m],s[m+1],s[m+2],i);h+="M"+c.x+" "+c.y;m=o[l+1]*3;c=r.projectToScreen(s[m],s[m+1],s[m+2],i);h+=" L"+c.x+" "+c.y;m=o[l+2]*3;c=r.projectToScreen(s[m],s[m+1],s[m+2],i);h+=" L"+c.x+" "+c.y+" Z "}e.children[0].setAttribute("d",h);h="";for(l=0,d=u?u.length:0;l<d;l+=2){m=u[l]*3;c=r.projectToScreen(s[m],s[m+1],s[m+2],i);h+="M"+c.x+" "+c.y;m=u[l+1]*3;c=r.projectToScreen(s[m],s[m+1],s[m+2],i);h+=" L"+c.x+" "+c.y}e.children[1].setAttribute("d",h);return this}h.prototype.hitTest=function(e,t){var r=this._svgDomRef;var i=r.getBoundingClientRect();var a=r.style;a.pointerEvents="auto";var n=document.elementFromPoint(e+i.x,t+i.y);a.pointerEvents="none";var s=n&&n.parentElement;return s!=null&&s.dataset.sapUiVkMeasurement==="true"?s:null};h.prototype.updateSettings=function(e){Object.assign(this._settings,e);return this};h.prototype.getScale=function(){return this._settings.scale};h.prototype.setScale=function(e){if(e!==this._settings.scale){var t={oldScale:this._settings.scale,newScale:e};this._settings.scale=e;this.fireScaleChanged(t)}return this};function w(e){return e.color}h.prototype.getMeasurementArrowColorCode=function(){return w(this._settings)};h.prototype.toJSON=function(e){var t=Array.isArray(e)?e:this._measurements;return{scale:this._settings.scale,measurements:t.map(function(e){return e.toJSON()})}};h.prototype.fromJSON=function(t,r){if("scale"in t){if(t.scale>0){this.setScale(t.scale)}else{e.error("Incorrect 'scale' value: "+t.scale)}}var i=t.measurements.map(n.createFromJSON);var a;if(r){a=this._measurements.slice()}else{a=t.measurements.map(function(e){return e.id}).map(this.getMeasurementById,this).filter(function(e){return e!=null})}if(a.length>0){this.fireMeasurementsRemoving({measurements:a});a.forEach(function(e){this._removeMeasurement(e,false)},this)}if(i.length>0){i.forEach(function(e){this._addMeasurement(e,false)},this);this.fireMeasurementsAdded({measurements:i})}};var R={measurementsAdded:"measurementsAdded",measurementsRemoving:"measurementsRemoving",scaleChanged:"scaleChanged"};h.prototype.attachMeasurementsAdded=function(e,t,r){return this.attachEvent(R.measurementsAdded,e,t,r)};h.prototype.detachMeasurementsAdded=function(e,t){return this.detachEvent(R.measurementsAdded,e,t)};h.prototype.fireMeasurementsAdded=function(e){return this.fireEvent(R.measurementsAdded,e)};h.prototype.attachMeasurementsRemoving=function(e,t,r){return this.attachEvent(R.measurementsRemoving,e,t,r)};h.prototype.detachMeasurementsRemoving=function(e,t){return this.detachEvent(R.measurementsRemoving,e,t)};h.prototype.fireMeasurementsRemoving=function(e){return this.fireEvent(R.measurementsRemoving,e)};h.prototype.attachScaleChanged=function(e,t,r){return this.attachEvent(R.scaleChanged,e,t,r)};h.prototype.detachScaleChanged=function(e,t){return this.detachEvent(R.scaleChanged,e,t)};h.prototype.fireScaleChanged=function(e){return this.fireEvent(R.scaleChanged,e)};return h});
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/measurements/Utils", ["sap/base/Log","../getResourceBundle"],function(t,n){"use strict";var r=1e-6;var e=1e-6;var o=1e-6;var i=1e-8;var a=1e-5;var u=new Float64Array(9);var s=2*Math.PI;var c={};c.compareNormal=function(t,n,e){if(c.computePointToPointDistance2(t,n)<r){return true}if(e){var o=c.pointPlusPoint(t,n);if(c.magnitude2(o)<r){return true}}return false};c.computeEdgeDirection=function(t,n,r){var e=c.normalize(c.pointMinusPoint(n,t));if(r){r[0]=e[0];r[1]=e[1];r[2]=e[2];return null}return e};c.scalePoint=function(t,n){return[n*t[0],n*t[1],n*t[2]]};c.normalize=function(t){var n=c.magnitude2(t);n=n<r?1:1/Math.sqrt(n);return c.scalePoint(t,n)};c.magnitude2=function(t){return t[0]*t[0]+t[1]*t[1]+t[2]*t[2]};c.dotProduct=function(t,n){return t[0]*n[0]+t[1]*n[1]+t[2]*n[2]};c.crossProduct=function(t,n){return[t[1]*n[2]-t[2]*n[1],t[2]*n[0]-t[0]*n[2],t[0]*n[1]-t[1]*n[0]]};c.equalPoints=function(t,n,r,e){return t[n]===r[e]&&t[n+1]===r[e+1]&&t[n+2]===r[e+2]};c.angleBetweenVectors2D=function(n,r,e,o){var a=n*e+r*o;var u=Math.sqrt((n*n+r*r)*(e*e+o*o));if(u<i){t.error("Degenerate angle: ax="+n+" ay="+r+" bx="+e+" by="+o);return 0}var s=a/u;if(s<-1){s=-1}else if(s>1){s=1}var c=Math.acos(s);return n*o<r*e?-c:c};c.isDegenerateTriangle=function(t,n,r){var e=c.pointMinusPoint(n,t);var i=c.pointMinusPoint(r,t);var a=c.dotProduct(e,e);var u=c.dotProduct(e,i);var s=c.dotProduct(i,i);var v=2*(a*s-u*u);return Math.abs(v)<=o};c.computeTriangleBoundingSphere=function(n,r,e,i,a){var u=c.pointMinusPoint(r,n);var s=c.pointMinusPoint(e,n);var v=c.dotProduct(u,u);var f=c.dotProduct(u,s);var l=c.dotProduct(s,s);var P=2*(v*l-f*f);var d=[n[0],n[1],n[2]];var g;if(Math.abs(P)<=o){t.error("Degenerate triangle detected! All 3 points on the same line: ("+n+") ("+r+") ("+e+")");g=[d[0],d[1],d[2]]}else{var p=(v*l-l*f)/P;var m=(l*v-v*f)/P;if(p<=0){g=[.5*(n[0]+e[0]),.5*(n[1]+e[1]),.5*(n[2]+e[2])]}else if(m<=0){g=[.5*(n[0]+r[0]),.5*(n[1]+r[1]),.5*(n[2]+r[2])]}else if(p+m>=1){g=[.5*(r[0]+e[0]),.5*(r[1]+e[1]),.5*(r[2]+e[2])];d=[r[0],r[1],r[2]]}else{g=[n[0]+p*u[0]+m*s[0],n[1]+p*u[1]+m*s[1],n[2]+p*u[2]+m*s[2]]}}i[a]=g[0];i[a+1]=g[1];i[a+2]=g[2];i[a+3]=c.computePointToPointDistance(g,d)};c.getNearestPointOnTriangle=function(t,n){var r=c.normalize(c.crossProduct(c.pointMinusPoint(t,t,3),c.pointMinusPoint(t,t,6)));var e=c.pointMinusPoint(n,t);var o=c.dotProduct(e,r);var i=c.scalePoint(r,-o);var a=c.pointPlusPoint(n,i);for(var u=0;u<3;++u){var s=u*3;var v=[t[s],t[s+1],t[s+2]];s=(u+1)%3*3;var f=[t[s],t[s+1],t[s+2]];s=(u+2)%3*3;var l=[t[s],t[s+1],t[s+2]];var P=c.normalize(c.pointMinusPoint(f,v));var d=c.normalize(c.pointMinusPoint(l,v));var g=c.normalize(c.pointMinusPoint(l,f));var p=c.scalePoint(c.pointPlusPoint(P,d),-1);var m=c.pointMinusPoint(P,g);var h=c.dotProduct(c.crossProduct(p,c.pointMinusPoint(a,v)),r);var T=c.dotProduct(c.crossProduct(m,c.pointMinusPoint(a,f)),r);if(h>=0&&T<=0){var M=c.pointMinusPoint(v,a);var D=c.pointMinusPoint(f,a);if(c.dotProduct(c.crossProduct(M,D),r)<0){return c.projectPointToEdge(v,f,a)}}}return a};c.pointOnLine=function(t,n){return[t[0]+(t[3]-t[0])*n,t[1]+(t[4]-t[1])*n,t[2]+(t[5]-t[2])*n]};c.projectPointToLine=function(t,n){var e=[t[0],t[1],t[2]];var o=[t[3],t[4],t[5]];var i=c.pointMinusPoint(o,e);var a=c.magnitude2(i);if(a<r){return 0}return c.dotProduct(i,c.pointMinusPoint(n,e))/a};c.projectPointToEdge=function(t,n,e){var o=c.pointMinusPoint(n,t);var i=c.magnitude2(o);if(i<r){return t}var a=c.dotProduct(o,c.pointMinusPoint(e,t))/i;if(a<=0){return t}if(a>=1){return n}return[t[0]+o[0]*a,t[1]+o[1]*a,t[2]+o[2]*a]};c.computeEdgeToPointDistance2=function(t,n,r){return c.computePointToPointDistance2(c.projectPointToEdge(t,n,r),r)};c.computePointToPointDistance=function(t,n,r){return Math.sqrt(c.computePointToPointDistance2(t,n,r))};c.computePointToPointDistance2D=function(t,n,r){return c.computePointToPointDistance([t[0],t[1],0],[n[0],n[1],0])};c.computePointToPointDistance2=function(t,n,r){var e=c.pointMinusPoint(t,n,r);return c.magnitude2(e)};c.pointMinusPoint=function(t,n,r){var e=r|0;return[t[e+0]-n[0],t[e+1]-n[1],t[e+2]-n[2]]};c.pointPlusPoint=function(t,n,r){var e=r|0;return[t[e+0]+n[0],t[e+1]+n[1],t[e+2]+n[2]]};c.bezierQuadric2D=function(t,n,r,e){var o=t*t;var i=1-t;var a=i*i;var u=2*i*t;var s=n[0]*a;var c=n[1]*a;s+=r[0]*u;c+=r[1]*u;s+=e[0]*o;c+=e[1]*o;return[s,c,0]};c.bezierCubic2D=function(t,n,r,e,o){var i=t*t;var a=i*t;var u=1-t;var s=u*u;var c=s*u;var v=3*s*t;var f=3*u*i;var l=n[0]*c;var P=n[1]*c;l+=r[0]*v;P+=r[1]*v;l+=e[0]*f;P+=e[1]*f;l+=o[0]*a;P+=o[1]*a;return[l,P,0]};c.findClosestPointEdgeToPoint=function(t,n){return c.projectPointToEdge([t[0],t[1],t[2]],[t[3],t[4],t[5]],n)};c.findClosestPointFaceToPoint=function(t,n){var r=t.vertices;var e=t.triangles;var o;var i;var a;var s;var v;var f;for(var l=0,P=e.length;l<P;l+=3){for(v=0;v<3;++v){f=e[l+v]*3;u[v*3]=r[f];u[v*3+1]=r[f+1];u[v*3+2]=r[f+2]}a=c.getNearestPointOnTriangle(u,n);s=c.computePointToPointDistance2(a,n);if(!l||s<o){o=s;i=a}}return i};c.computePlaneEquation=function(t,n,r,e){var o=[t[n],t[n+1],t[n+2]];var i=c.pointMinusPoint(t,o,r);var a=c.pointMinusPoint(t,o,e);var u=c.crossProduct(i,a);var s=c.dotProduct(u,u);if(s!==0){u=c.scalePoint(u,1/Math.sqrt(s));return[u[0],u[1],u[2],-c.dotProduct(o,u)]}return[1,0,0,0]};c.intersectPlanes=function(t,n){var e=c.crossProduct(t,n);var o=c.magnitude2(e);if(o<r){return null}var i=c.scalePoint(c.pointPlusPoint(c.scalePoint(c.crossProduct(e,n),t[3]),c.scalePoint(c.crossProduct(t,e),n[3])),1/o);var a=c.pointPlusPoint(i,e);return[i[0],i[1],i[2],a[0],a[1],a[2]]};c.intersectLines=function(t,n){return c.findClosestPointEdgeToEdge(t,n,true,true)};c.findClosestPointLineToLine=function(t,n){return c.findClosestPointEdgeToEdge(t,n,true,false)};c.findClosestPointEdgeToEdge=function(t,n,r,o){var u=c.pointMinusPoint(t,t,3);var s=c.pointMinusPoint(n,n,3);var v=c.pointMinusPoint(t,n,0);var f=c.dotProduct(u,u);var l=c.dotProduct(u,s);var P=c.dotProduct(s,s);var d=c.dotProduct(u,v);var g=c.dotProduct(s,v);var p=f*P-l*l;var m,h=p;var T,M=p;var D=p<a;if(D){m=.5;h=1;T=.5;M=1}else{m=l*g-P*d;T=f*g-l*d;if(!r){if(m<0){m=0;T=g;M=P}else if(m>h){m=h;T=g+l;M=P}}}if(!r){if(T<0){T=0;if(-d<0){m=0}else if(-d>f){m=h}else{m=-d;h=f}}else if(T>M){T=M;if(-d+l<0){m=0}else if(-d+l>f){m=h}else{m=-d+l;h=f}}}f=Math.abs(m)<i;l=Math.abs(T)<i;var b=f?0:m/h;var E=l?0:T/M;P=Math.abs(m-h)<i;d=Math.abs(T-M)<i;if(P){b=1}if(d){E=1}v=c.pointOnLine(t,b);u=c.pointOnLine(n,E);p=c.computePointToPointDistance2(v,u);if(o&&p>e){return null}if(r){return D?null:[b,E]}if(D||f||l||P||d){P=c.findClosestPointEdgeToPoint(t,u);f=c.computePointToPointDistance2(P,u);d=c.findClosestPointEdgeToPoint(n,v);l=c.computePointToPointDistance2(d,v);if(f<l){if(f+i<p){p=f;for(g=0;g<3;++g){v[g]=P[g]}}}else if(l+i<p){p=l;for(g=0;g<3;++g){u[g]=d[g]}}for(f=0;f<6;f+=3){l=[n[f],n[f+1],n[f+2]];P=c.findClosestPointEdgeToPoint(t,l);d=c.computePointToPointDistance2(P,l);if(d+i<p){p=d;for(g=0;g<3;++g){v[g]=P[g];u[g]=l[g]}}}for(f=0;f<6;f+=3){l=[t[f],t[f+1],t[f+2]];P=c.findClosestPointEdgeToPoint(n,l);d=c.computePointToPointDistance2(P,l);if(d+i<p){p=d;for(g=0;g<3;++g){v[g]=l[g];u[g]=P[g]}}}}return[v[0],v[1],v[2],u[0],u[1],u[2]]};c.findClosestPointFaceToEdge=function(n,r){var e=performance.now();var o=n.triangles;var i=n.vertices;var a=n.edges;var s=n.boundingSpheres;var v=Number.MAX_VALUE;var f;var l;var P;var d;var g;var p;var m;var h=[r[3],r[4],r[5]];for(d=0,m=a.length;d<m;d+=2){for(g=0;g<2;++g){p=a[d+g]*3;u[g*3]=i[p];u[g*3+1]=i[p+1];u[g*3+2]=i[p+2]}l=c.findClosestPointEdgeToEdge(u,r);P=c.computePointToPointDistance2(l,l,3);if(P<v){v=P;f=l}}v=Math.sqrt(v);var T=[(r[0]+r[3])/2,(r[1]+r[4])/2,(r[2]+r[5])/2];var M=c.computePointToPointDistance(r,r,3)/2;var D;var b=performance.now()-e;var E;for(d=0,m=o.length;d<m;d+=3){P=c.computePointToPointDistance(s,T,d*4);if(P<M+v+s[d*4+3]){for(g=0;g<3;++g){D=o[d+g]*3;u[g*3]=i[D];u[g*3+1]=i[D+1];u[g*3+2]=i[D+2]}E=r;for(g=0;g<2;++g){l=c.getNearestPointOnTriangle(u,E);P=c.computePointToPointDistance(l,E);if(P<v){v=P;f[0]=l[0];f[1]=l[1];f[2]=l[2];f[3]=E[0];f[4]=E[1];f[5]=E[2]}E=h}}}var C=performance.now()-e;if(C>10){t.info("Face[t"+n.triangles.length+"/e"+n.edges.length+"/v"+n.vertices.length+"] distance to Edge in "+C.toFixed(1)+"ms ("+b.toFixed(0)+" + "+(C-b).toFixed(0)+")")}return f};c.findClosestPointFaceToFace=function(n,r){var e=performance.now();var o=n.vertices;var i=r.vertices;var a=n.edges;var s=r.edges;var v;var f;var l;var P;var d;var g;var p;var m=Number.MAX_VALUE;var h;var T;var M=new Float64Array(6);var D;var b;for(l=0,d=a.length;l<d;l+=2){for(v=0;v<2;++v){f=a[l+v]*3;M[v*3]=o[f];M[v*3+1]=o[f+1];M[v*3+2]=o[f+2]}for(P=0,g=s.length;P<g;P+=2){for(v=0;v<2;++v){f=s[P+v]*3;u[v*3]=i[f];u[v*3+1]=i[f+1];u[v*3+2]=i[f+2]}h=c.findClosestPointEdgeToEdge(M,u);p=c.computePointToPointDistance2(h,h,3);if(p<m){m=p;T=h}}}m=Math.sqrt(m);var E;var C;var q;var F=n.edges;var A=n.vertices;var w=r.triangles;var L=r.vertices;var x=r.boundingSpheres;var I=performance.now()-e;for(var N=0;N<2;++N){for(l=0,d=F.length;l<d;l+=2){for(v=0;v<2;++v){f=F[l+v];f*=3;M[v*3]=A[f];M[v*3+1]=A[f+1];M[v*3+2]=A[f+2]}q=[M[3],M[4],M[5]];D=[(M[0]+M[3])/2,(M[1]+M[4])/2,(M[2]+M[5])/2];b=c.computePointToPointDistance(M,M,3)/2;for(E=0,g=w.length;E<g;E+=3){p=c.computePointToPointDistance(x,D,E*4);if(p<b+m+x[E*4+3]){for(v=0;v<3;++v){f=w[E+v]*3;u[v*3]=L[f];u[v*3+1]=L[f+1];u[v*3+2]=L[f+2]}C=M;for(v=0;v<2;++v){h=c.getNearestPointOnTriangle(u,C);p=c.computePointToPointDistance(h,C);if(p<m){m=p;if(N>0){T[0]=h[0];T[1]=h[1];T[2]=h[2];T[3]=C[0];T[4]=C[1];T[5]=C[2]}else{T[0]=C[0];T[1]=C[1];T[2]=C[2];T[3]=h[0];T[4]=h[1];T[5]=h[2]}}C=q}}}}F=r.edges;A=r.vertices;w=n.triangles;L=n.vertices;x=n.boundingSpheres}var z=performance.now()-e;if(z>20){t.info("Face[t"+n.triangles.length+"/e"+n.edges.length+"/v"+n.vertices.length+"] distance to Face[t"+r.triangles.length+"/e"+r.edges.length+"/v"+r.vertices.length+"] in "+z.toFixed(1)+"ms ("+I.toFixed(0)+" + "+(z-I).toFixed(0)+")")}return T};c.hasSelfIntersections=function(t,n){var r=t?t.length/3:0;if(r>2){var e=n?r-1:r;var o,a,u;var s=[0,0,0,0,0,0];var v=[0,0,0,0,0,0];for(var f=0;f<e;++f){u=f*3;s[0]=t[u];s[1]=t[u+1];s[2]=t[u+2];u=(f+1)%r*3;s[3]=t[u];s[4]=t[u+1];s[5]=t[u+2];for(o=f+2;o<e;++o){u=o*3;v[0]=t[u];v[1]=t[u+1];v[2]=t[u+2];u=(o+1)%r*3;v[3]=t[u];v[4]=t[u+1];v[5]=t[u+2];if(!c.equalPoints(s,0,v,0)&&!c.equalPoints(s,0,v,3)&&!c.equalPoints(s,3,v,0)&&!c.equalPoints(s,3,v,3)){a=c.intersectLines(s,v);if(a&&a[0]>i&&a[0]<1-i&&a[1]>i&&a[1]<1-i){return true}}}}}return false};c.hasSelfIntersectionsLastEdge=function(t){var n=t?t.length/3:0;if(n>2){var r,e;var o=t.slice(t.length-6,t.length);var a=[0,0,0,0,0,0];for(var u=0;u<n;++u){e=u*3;a[0]=t[e];a[1]=t[e+1];a[2]=t[e+2];e=(u+1)%n*3;a[3]=t[e];a[4]=t[e+1];a[5]=t[e+2];if(!c.equalPoints(o,0,a,0)&&!c.equalPoints(o,0,a,3)&&!c.equalPoints(o,3,a,0)&&!c.equalPoints(o,3,a,3)){r=c.intersectLines(o,a);if(r&&r[0]>i&&r[0]<1-i&&r[1]>i&&r[1]<1-i){return true}}}}return false};c.computeTriangleArea=function(t,n,r,e){var o=[t[n],t[n+1],t[n+2]];var i=[t[r],t[r+1],t[r+2]];var a=[t[e],t[e+1],t[e+2]];var u=c.computePointToPointDistance(o,i);var s=c.computePointToPointDistance(i,a);var v=c.computePointToPointDistance(a,o);var f=(u+s+v)/2;return Math.sqrt(f*((f-u)*(f-s)*(f-v)))};c.computeTriangleAverageCoordinate=function(t,n,r,e){return[(t[n]+t[r]+t[e])/3,(t[n+1]+t[r+1]+t[e+1])/3,(t[n+2]+t[r+2]+t[e+2])/3]};c.translateUnits=function(t,r){var e=null;switch(t){case"mm":e="MM";break;case"cm":e="CM";break;case"m":e="M";break;case"in":e="IN";break;case"ft":e="FT";break;default:return""}return n().getText("UNITS_SHORT_"+e+(r?r:""))};c.getUnitFactor=function(t){switch(t){case"mm":return 1;case"cm":return 1/10;case"m":return 1/1e3;case"in":return 1/25.4;case"ft":return 1/(25.4*12);default:return 1}};c.clampAngle2PI=function(t){while(t>=s){t-=s}while(t<0){t+=s}return t};c.clampAngle=function(t,n,r){var e=c.clampAngle2PI(t);var o=c.clampAngle2PI(r<0?n-r+s:n);var i=c.clampAngle2PI(r<0?n:n+r);if(i<o){if(e<o){o-=s}else{i+=s}}return Math.max(Math.min(e,i),o)};c.isClosedContour=function(t){return t&&t.length>9&&c.equalPoints(t,0,t,t.length-3)};c.findClosedContour=function(t,n,r){var e=Math.abs(n[0]);var o=Math.abs(n[r]);var i=Math.abs(n[n.length-1]);var a=i-e+1;var u=Array.apply(null,{length:a*2});var s,c;for(s=0;s<n.length;++s){var v=Math.abs(n[s])-e;if(u[v*2]===undefined){u[v*2]=s}u[v*2+1]=s}var f=(o-e)*2;var l=u[f];var P=u[f+1];var d=t.slice(l*2,P*2+2);var g=n.slice(l,P+1);r-=l;u[f]=null;u[f+1]=null;var p=false;var m=true;var h=true;var T,M;var D,b;while(p||m){h=!h;D=d[h?0:d.length-2];b=d[h?1:d.length-1];m=p;p=false;for(s=0;s<a;++s){f=s*2;l=u[f];P=u[f+1];if(u[f]!=null){if(D===t[l*2]&&b===t[l*2+1]){T=t.slice(l*2+2,P*2+2);M=n.slice(l+1,P+1);p=true}else if(D===t[P*2]&&b===t[P*2+1]){T=[];for(c=P*2-2;c>=l*2;c-=2){T.push(t[c],t[c+1])}M=n.slice(l,P).reverse();p=true}}if(p){u[f]=null;u[f+1]=null;if(h){r+=M.length;g=M.reverse().concat(g);var E=[];for(c=T.length-2;c>=0;c-=2){E.push(T[c],T[c+1])}d=E.concat(d)}else{g=g.concat(M);d=d.concat(T)}break}}}var C=g.length;for(s=r-1;s>=0;--s){if(g[s]>=0){D=d[s*2];b=d[s*2+1];for(c=r;c<C;++c){if(c-s>=3&&g[c]>=0&&D===d[c*2]&&b===d[c*2+1]){return d.slice(s*2,c*2+2)}}}}return null};return c});
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/measurements/Vertex", ["sap/base/assert","./Feature","./FeatureType"],function(t,e,r){"use strict";var o=[0,0,0];var s=function(t){e.apply(this,arguments);this._vertex=new Float64Array(3);this.setValue(t&&t.vertex||o)};s.prototype=Object.create(e.prototype);s.prototype.constructor=s;s.prototype.isVertex=true;e._classMap.set(r.Vertex,s);s.prototype.setValue=function(e){t(e.length===3,"Vertex array must have 3 elements");this._vertex.set(e);return this};s.prototype.getValue=function(){return this._vertex};s.prototype.toJSON=function(){return{type:r.Vertex,vertex:Array.from(this._vertex)}};return s});
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/pdf/ContentManager", ["sap/base/Log","../ContentManager","../getResourceBundle","../svg/Element","../svg/HotspotHelper","../svg/Scene","../svg/SceneBuilder","./Document","./Utils","./Viewport","./ViewStateManager"],(e,t,n,o,s,r,i,a,c)=>{"use strict";const d=t.extend("sap.ui.vk.pdf.ContentManager",{metadata:{library:"sap.ui.vk"}});d.prototype.loadContent=function(t,o){this.fireContentChangesStarted();if(o.length!==1){setTimeout(()=>{this.fireContentChangesFinished({content:null,failureReason:{errorMessage:n().getText("PDFCONTENTMANAGER_ONLY_LOAD_SINGLE_PDF")}})},0)}else if(o[0].getContentResources().length>0){setTimeout(()=>{this.fireContentChangesFinished({content:null,failureReason:{errorMessage:n().getText("PDFCONTENTMANAGER_CANNOT_LOAD_PDF_HIERARCHY")}})},0)}else{(async()=>{try{const e=o[0];const[t,n]=await Promise.all([this._loadDocument(e),this._loadHotspots(e),this._loadExtraModules()]);const s=this._buildSvgScene(e,n);const r=new a(t,s);this.fireContentChangesFinished({content:r})}catch(t){e.error("Failed to load PDF content",t);this.fireContentChangesFinished({content:null,failureReason:{errorMessage:n().getText("PDFCONTENTMANAGER_FAILED_TO_LOAD_PDF",[t.message])}})}})()}return this};d.prototype.destroyContent=function(e){if(e instanceof a){e.destroy()}return this};d.prototype._loadDocument=async function(e){const t={};let o=e.getSource();if(typeof o==="string"){const n=e.getVeid()??"";if(n!==""){if(!o.endsWith("/")){o+="/"}o+=`scenes/${n}/pdf`}t.url=o}else if(o instanceof File){t.data=await new Promise((e,t)=>{const n=new FileReader;n.onload=t=>e(t.target.result);n.onerror=e=>t(e.target.error);n.readAsArrayBuffer(o)})}else{throw new Error(n().getText("PDFCONTENTMANAGER_SOURCE_TYPE_NOT_SUPPORTED"))}const s=await c.loadPdfjsLib();return await s.getDocument(t).promise};d.prototype._loadHotspots=async function(e){const t=e.getSource();if(typeof t==="string"){const t=e.getVeid()??"";if(t!==""){const t=await fetch(u(e));if(!t.ok){throw new Error(t.statusText)}return await t.json()}}return{scene:{id:"-1"},tree:{sid:"-1",nodes:[]},parametrics:[]}};d.prototype._loadExtraModules=async function(){return new Promise((e,t)=>{sap.ui.require(["sap/ui/vk/pdf/Viewport"],e,e=>t(e))})};d.prototype._buildSvgScene=function(e,t){const n=new r;const s=n.getRootElement();const a=new o;a.name=e.getName();a.sourceId=e.getSourceId();s.add(a);e._shadowContentResource={nodeProxy:n.getDefaultNodeHierarchy().createNodeProxy(a)};const{scene:{id:c},tree:{sid:d,nodes:u=[]},parametrics:f=[]}=t;const p=new i(a,e);p.setRootNode(a,d,c,n);n.setSceneBuilder(p);l(p,c,u,f);return n};d.prototype.updateContent=async function(e,t,n){const o=e[0];const{nodeIds:s}=n;const r=await fetch(u(o,{sids:s}));if(!r.ok){throw new Error(r.statusText)}const i=await r.json();const a=t.scene;const c=a.getSceneBuilder();const d=a.getDefaultNodeHierarchy();const{scene:{id:f},tree:{nodes:p},parametrics:g=[]}=i;const h=p.map(e=>a.persistentIdToNodeRef(e.sid)).filter(e=>e!=null);d.removeNode(h);l(c,f,p,g)};function l(e,t,n,o){function s(n){const{node:r,children:i=[],parentId:a}=n;if(a!=null){r.parentId=a}else if(r.parent!=null){r.parentId=r.parent}const c=r.parametric==null?null:o[r.parametric];if(c!=null){r.parametricId=c.id}const d=e.createNode(r,t);if(c!=null){e.setParametricContent(r.sid,c,t)}for(const e of i){s(e)}d._initAsHotspot()}const r=f(n);for(const e of r){s(e)}}function u(e,t){let n=e.getSource();let o=e.getVeid()??"";if(!n.endsWith("/")){n+="/"}n+=`scenes/${o}`;n+="?contentType=hotspot";n+="&$select=contentType,name,transform,visible,pageIndex";n+="&$expand=parametric";n+=`&hidden=${e.getIncludeHidden()}`;const s=t?.sids;if(s!=null){n+="&sid="+s.join("&sid=")}return n}function f(e){const t=e.map(e=>({node:e}));t.filter(({node:{children:e}})=>e!=null).forEach(e=>{const{node:n}=e;e.children=n.children.map(o=>{const s=t[o];s.parentId=n.sid;s.parent=e;return s})});return t.filter(({parent:e})=>e==null)}return d});
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/pdf/Document", ["./Page"],e=>{"use strict";const t="sap.ui.vk.pdf.Document";class s{getName(){return t}isA(e){return Array.isArray(e)?e.includes(t):e===t}}const n=new s;class u{#e=null;#t=null;constructor(e,t=null){this.#e=e;this.#t=t}destroy(){this.#e.destroy();this.#e=null;this.#t.getSceneBuilder().cleanup();this.#t.destroy();this.#t=null}get pageCount(){return this.#e.numPages}async getPage(t){const s=await this.#e.getPage(t+1);return new e(s)}getMetadata(){return n}isA(e){return n.isA(e)}get scene(){return this.#t}}return u});
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/pdf/Page", [],()=>{"use strict";class e{#e=null;constructor(e){this.#e=e}get pageIndex(){return this.#e.pageNumber-1}get rawDimensions(){const{width:e,height:t,viewBox:[i,s]}=this.#e.getViewport({scale:1});return{pageX:i,pageY:s,pageWidth:e,pageHeight:t}}get userUnit(){return this.#e.userUnit}renderToCanvas(e,t,i=0,s=0){t*=this.userUnit*96/72;const n=this.#e.getViewport({scale:t});return this.#e.render({canvasContext:e.getContext("2d",{alpha:false}),viewport:n,transform:[devicePixelRatio,0,0,devicePixelRatio,i*devicePixelRatio,s*devicePixelRatio],annotationMode:0})}renderToImage(e){const{pageWidth:t,pageHeight:i}=this.rawDimensions;const s=e/Math.max(t,i);const n=this.#e.getViewport({scale:s});const a=Math.round(n.width);const r=Math.round(n.height);const o=document.createElement("canvas");o.width=a;o.height=r;const g=this.#e.render({canvasContext:o.getContext("2d",{alpha:false}),viewport:n,annotationMode:0});return{renderTask:g,canvas:o}}cssPixelToPDFPoint(e,t,i){return this.#t(i).convertToPdfPoint(e,t)}pdfPointToCSSPixel(e,t,i){return this.#t(i).convertToViewportPoint(e,t)}#t(e){return this.#e.getViewport({scale:e*this.userUnit*96/72})}}return e});
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/pdf/PageGallery", ["sap/base/Log","sap/m/library","sap/m/Slider","sap/m/VBox","sap/ui/core/Control","sap/ui/core/delegate/ItemNavigation","sap/ui/core/EnabledPropagator","../Core","./Utils","../getResourceBundle"],(e,t,s,n,i,o,a,r,l,h)=>{"use strict";const{FlexRendertype:u}=t;const c="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg'></svg>";const g=sap.ui.require.toUrl("sap/ui/vk/themes/base/images/vk-pdf-page-error.svg");const d="thumbnail";const p="pageIndex";const _=25;const m=140;const f=206;const b=5;const y=5e3;const P=i.extend("sap.ui.vk.pdf.PageGalleryItem",{metadata:{library:"sap.ui.vk"},renderer:{apiVersion:2,render(e,t){const s=t.getId();e.openStart("div",s);e.class("sapVizKitPageGalleryItem");e.attr("tabindex",0);e.attr("data-sap-ui-vk-page-index",t._pageIndex);if(t._selected){e.class("sapVizKitPageGalleryItemSelected")}e.openEnd();{e.openStart("img",`${s}-${d}`);e.attr("src",t._thumbnail);e.attr("alt",h().getText("PAGE_ALT_TEXT",[t._pageIndex+1]));e.style("width",`${t._width}px`);e.style("height",`${t._height}px`);e.openEnd();e.close("img")}{e.openStart("div",`${s}-${p}`);e.class("sapMLabel");e.openEnd();const n=t._pageIndex;e.text(n!=null?n+1:"0");e.close("div")}e.close("div")}},init(){i.prototype.init?.call(this);this._pageIndex=null;this._selected=false;this._thumbnail=c;this._width=m;this._height=f;this._isDirty=true},setPageIndex(e){this._pageIndex=e;const t=this.getDomRef(p);if(t!=null){t.textContent=e}return this},setSelected(e){this._selected=e;const t=this.getDomRef();if(t!=null){if(e){t.classList.add("sapVizKitPageGalleryItemSelected")}else{t.classList.remove("sapVizKitPageGalleryItemSelected")}}return this},setThumbnail(e,t,s){this._thumbnail=e;this._width=t;this._height=s;const n=this.getDomRef(d);if(n!=null){n.src=e;const{style:i}=n;i.width=`${t}px`;i.height=`${s}px`}return this},setThumbnailSideLength(e){const{_width:t,_height:s,_thumbnail:n}=this;if(e===Math.max(t,s)){return this}if(t>s){this.setThumbnail(n,e,e*s/t)}else{this.setThumbnail(n,e*t/s,e)}this.setDirty(true);return this},getDirty(){return this._isDirty},setDirty(e){this._isDirty=e;return this}});const v=i.extend("sap.ui.vk.pdf.PageGallery",{metadata:{library:"sap.ui.vk",properties:{width:{type:"sap.ui.core.CSSSize",defaultValue:"100%"},height:{type:"sap.ui.core.CSSSize",defaultValue:"100%"},currentPageIndex:{type:"int",defaultValue:0},thumbnailScale:{type:"float",defaultValue:_}},aggregations:{_slider:{type:"sap.m.Slider",multiple:false,visibility:"hidden"},_pages:{type:"sap.m.VBox",multiple:false,visibility:"hidden"}},associations:{contentConnector:{type:"sap.ui.vk.ContentConnector",multiple:false}},events:{pageChanged:{parameters:{newPageIndex:"int",oldPageIndex:"int"}},thumbnailScaleChanged:{parameters:{value:"float"}}}},renderer:{apiVersion:2,render(e,t){e.openStart("div",t);e.class("sapVizKitPageGallery");if(!t.getEnabled()){e.class("sapVizKitPageGalleryDisabled")}e.style("width",t.getWidth());e.style("height",t.getHeight());e.openEnd();e.renderControl(t._getSliderControl());e.renderControl(t._getPagesControl());e.close("div")}},constructor:function(e,t){i.apply(this,arguments);r.observeAssociations(this)}});const C=v.getMetadata().getName();a.call(v.prototype);v.prototype.init=function(){i.prototype.init?.call(this);const e=this.getId();this._document=null;this._visiblePages=new Set;this._queue=new Set;this._processingQueueScheduled=false;this._tasks=new Map;this._thumbnailSideLength=f;this._scrollToCurrentPageIndexAfterRendering=false;this.setAggregation("_slider",new s(`${e}-slider`,{tooltip:h().getText("SLIDER_TOOLTIP"),width:"auto",min:5,max:100,value:_,enabled:false,liveChange:[false,this._onSliderValueChanged,this],change:[true,this._onSliderValueChanged,this]}).addStyleClass("sapVizKitPageGallerySlider"));this.setAggregation("_pages",new n(`${e}-pages`,{renderType:u.Bare}).addStyleClass("sapVizKitPageGalleryPages"));const t=this._itemNavigation=new o;this.addEventDelegate(t);this._intersectionObserver=null;this._intersectionObserverCallback=this._intersectionObserverCallback.bind(this);this._onkeydown=this._onkeydown.bind(this)};v.prototype.exit=function(){this._unsubscribeFromEvents();this._intersectionObserver?.disconnect();this._intersectionObserver=null;this.removeEventDelegate(this._itemNavigation);this._itemNavigation.destroy();this._itemNavigation=null;this._clearQueue();this._visiblePages.clear();this._document=null;i.prototype.exit?.call(this)};v.prototype.onSetContentConnector=function(e){e.attachContentReplaced(this._onContentReplaced,this);this._setContent(e.getContent())};v.prototype.onUnsetContentConnector=function(e){e.detachContentReplaced(this._onContentReplaced,this);this._setContent(null)};v.prototype._onContentReplaced=function(e){this._setContent(e.getParameter("newContent"))};v.prototype._setContent=function(e){if(e===this._document){return}this._intersectionObserver?.disconnect();this._document=e;const t=this._getSliderControl();t.setEnabled(false);const s=this._getPagesControl();s.destroyItems();this._clearQueue();if(e!=null){this._scrollToCurrentPageIndexAfterRendering=true;t.setEnabled(true);const n=this._thumbnailSideLength;const i=this.getId();const o=e.pageCount;const a=Math.max(0,Math.min(this.getCurrentPageIndex(),o-1));for(let e=0;e<o;++e){const t=new P(`${i}-page-${e}`);t.setPageIndex(e);t.setSelected(e===a);t.setThumbnailSideLength(n);s.addItem(t)}this.setCurrentPageIndex(a)}this.invalidate()};v.prototype._subscribeToEvents=function(){this.$().on("keydown",this._onkeydown)};v.prototype._unsubscribeFromEvents=function(){this.$().off("keydown",this._onkeydown)};v.prototype.onBeforeRendering=function(){this._intersectionObserver?.disconnect();this._intersectionObserver=null;this._unsubscribeFromEvents()};v.prototype.onAfterRendering=function(){const e=this._getPagesControl();const t=e.getDomRef();const s=e.getItems();const n=Math.max(this.getCurrentPageIndex(),0);this._itemNavigation.setRootDomRef(t).setItemDomRefs(s.map(e=>e.getDomRef())).setColumns(1,true).setCycling(false).setPageSize(1).setSelectedIndex(n).setFocusedIndex(n);const i=this._intersectionObserver=new IntersectionObserver(this._intersectionObserverCallback,{root:t,threshold:0});for(const e of s){i.observe(e.getDomRef())}if(this._scrollToCurrentPageIndexAfterRendering){this._scrollToCurrentPageIndexAfterRendering=false;const e=this.getCurrentPageIndex();if(e>=0&&e<s.length){s[e].getDomRef()?.scrollIntoView({block:"nearest"})}}this._subscribeToEvents()};v.prototype._intersectionObserverCallback=function(t){const s=this._getPagesControl().getItems();const n=this._visiblePages;for(const{target:i,isIntersecting:o}of t){const t=i.dataset.sapUiVkPageIndex;if(t==null){continue}const a=parseInt(t,10);const r=s[a];if(o){e.debug(`IntersectionObserver: page ${a} became visible`,null,C);n.add(a);if(r.getDirty()){this._enqueueThumbnailGeneration(a)}}else{e.debug(`IntersectionObserver: page ${a} became invisible`,null,C);n.delete(a)}}this._itemNavigation.setPageSize(Math.max(1,n.size-1))};v.prototype._onSliderValueChanged=function(e,t){this._changeThumbnailScale(e.getParameter("value"),t)};v.prototype._changeThumbnailScale=function(e,t){i.prototype.setProperty.call(this,"thumbnailScale",e,true);this.getAggregation("_slider").setValue(e);const s=this._thumbnailSideLength=e*f/_;this.fireThumbnailScaleChanged({value:e});if(this._document==null){return}const n=this._getPagesControl();const o=n.getDomRef();const{scrollTop:a,scrollHeight:r}=o;const l=a/r;const h=n.getItems();const u=h.length;const c=this._visiblePages;for(let e=0;e<u;++e){h[e].setThumbnailSideLength(s);if(t&&c.has(e)){this._enqueueThumbnailGeneration(e)}}const{scrollHeight:g}=o;const d=l*g;o.scrollTo({top:d,behavior:"instant"})};v.prototype._activatePage=function(e){if(this._document==null){return}const t=e.target.closest("[data-sap-ui-vk-page-index]");if(t!=null){const e=t.dataset.sapUiVkPageIndex;if(e!=null){const t=parseInt(e,10);this.setCurrentPageIndex(t)}}};v.prototype.ontap=function(e){this._activatePage(e)};v.prototype.onsapenter=function(e){this._activatePage(e)};v.prototype._onkeydown=function(e){if(!this.getEnabled()&&e.key!=="Tab"){e.preventDefault();e.stopPropagation()}};v.prototype.setCurrentPageIndex=function(e){const t=this.getCurrentPageIndex();if(t===e){return this}const s=this._getPagesControl().getItems();const n=s.length;if(n===0){this.setProperty("currentPageIndex",e,true)}else{if(t>=0&&t<n){s[t].setSelected(false)}e=Math.max(0,Math.min(e,n-1));this._itemNavigation.setSelectedIndex(e).setFocusedIndex(e);this.setProperty("currentPageIndex",e,true);const i=s[e];i.setSelected(true);i.getDomRef()?.scrollIntoView({block:"nearest"})}this.firePageChanged({newPageIndex:e,oldPageIndex:t});return this};v.prototype._enqueueThumbnailGeneration=function(e){const t=this._queue;if(t.has(e)){return}const s=this._thumbnailSideLength;const n=this._tasks;const i=n.get(e);if(i!=null){const{renderTask:t}=i;if(t==null||i.sideLength===s){return}n.delete(e);t.cancel()}t.add(e);this._getPagesControl().getItems()[e].setBusy(true);this._scheduleProcessingThumbnailQueue()};v.prototype._scheduleProcessingThumbnailQueue=function(){if(!this._processingQueueScheduled){this._processingQueueScheduled=true;queueMicrotask(()=>{this._processThumbnailQueue()})}};v.prototype._processThumbnailQueue=async function(){this._processingQueueScheduled=false;const t=this._tasks;if(t.size>=b){e.debug("Too many simultaneous thumbnail tasks",null,C);return}const s=this._queue;if(s.size===0){e.debug("No more pages to process",null,C);return}for(const n of s){s.delete(n);if(this._visiblePages.has(n)){e.debug(`Processing page ${n}`,null,C);const s={};t.set(n,s);const i=await this._document.getPage(n);const o=this._thumbnailSideLength;const{devicePixelRatio:a}=window;const{renderTask:r,canvas:h}=i.renderToImage(o*a);s.sideLength=o;s.renderTask=r;s.canvas=h;s.timedOut=false;s.timeoutId=setTimeout(()=>{s.renderTask.cancel();s.timedOut=true},y);try{await r.promise;clearTimeout(s.timeoutId);e.debug(`Page ${n} rendered successfully`,null,C);const t=h.toDataURL("image/png");const i=this._getPagesControl().getItems()[n];if(s.sideLength===this._thumbnailSideLength){i.setThumbnail(t,h.width/a,h.height/a);i.setDirty(false)}else{e.debug(`Page ${n} thumbnail was generated for a different size, enqueuing a new task`,null,C);this._enqueueThumbnailGeneration(n)}}catch(t){if(t instanceof l.getPdfjsLib().RenderingCancelledException){e.debug(`Page ${n} rendering cancelled`,t,C);if(s.timedOut){e.error(`Page ${n} rendering timed out`,t,C);this._getPagesControl().getItems()[n].setThumbnail(g,h.width/a,h.height/a).setDirty(false)}}else{e.error("Page ${pageIndex} rendering failed",t,C)}}t.delete(n);if(!this.isDestroyStarted()){this._getPagesControl().getItems()[n]?.setBusy(false);this._scheduleProcessingThumbnailQueue()}break}else{this._getPagesControl().getItems()[n].setBusy(false);e.debug(`Page ${n} is not visible anymore, trying to process another page`,null,C)}}};v.prototype._clearQueue=function(){this._queue.clear();const e=this._tasks;for(const{renderTask:t}of e.values()){t?.cancel()}e.clear()};v.prototype._getSliderControl=function(){return this.getAggregation("_slider")};v.prototype._getPagesControl=function(){return this.getAggregation("_pages")};v.prototype.setProperty=function(e,t,s){if(e==="thumbnailScale"){this._changeThumbnailScale(t,true)}else{i.prototype.setProperty.apply(this,arguments)}return this};return v});
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/pdf/Utils", ["../helpers/WorkerScriptLoader"],t=>{"use strict";class i{static#t;static async loadPdfjsLib(){let s=i.#t;if(s==null){const i=t.absoluteUri("sap/ui/vk/thirdparty/pdf.js").toString();const r=t.absoluteUri("sap/ui/vk/thirdparty/pdf.worker.js").toString();this.#t=s=await import(i);s.GlobalWorkerOptions.workerSrc=r}return s}static getPdfjsLib(){return i.#t}static clearCanvas(t){const{width:i,height:s}=t;const r=t.getContext("2d",{alpha:false});r.fillStyle="white";r.fillRect(0,0,i,s)}}return i});
/*!
* SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
*/
sap.ui.predefine("sap/ui/vk/pdf/ViewStateManager", ["../svg/ViewStateManager"],function(t){"use strict";const e=t.extend("sap.ui.vk.pdf.ViewStateManager",{metadata:{library:"sap.ui.vk"}});const a=e.getMetadata().getParent().getClass().prototype;e.prototype._setContent=function(t){return a._setContent.call(this,t?.scene)};return e});
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/pdf/Viewport", ["sap/base/Log","sap/ui/core/Element","sap/ui/core/delegate/ScrollEnablement","sap/ui/core/ResizeHandler","../abgrToColor","../cssColorToColor","../Loco","../SelectionMode","../ViewportBase","../svg/Element","./ViewportRenderer","./Utils"],(t,e,n,s,o,i,a,r,l,c,h,p)=>{"use strict";const u="http://www.w3.org/2000/svg";const d=1.1;const g=.01;const f=100;const _=10;const m="scrollContainer";const C="document";const v="page";const y="pdfCanvas";const w="pdfStretchedCanvas";const H="pdfHighResCanvas";const R="hotspotSurface";const S=0;const P=1;const x=2;const b=l.extend("sap.ui.vk.pdf.Viewport",{metadata:{library:"sap.ui.vk",properties:{currentPageIndex:{type:"int",defaultValue:0}},events:{pageChanged:{parameters:{newPageIndex:"int",oldPageIndex:"int"}},documentReplaced:{parameters:{oldDocument:"sap.ui.vk.pdf.Document",newDocument:"sap.ui.vk.pdf.Document"}}}},renderer:h});const D=b.getMetadata().getName();b.prototype.init=function(){l.prototype.init?.call(this);this._document=null;this._page=null;this._scene=null;const t=document.createElementNS(u,"svg");t.id=`${this.getId()}-${R}`;t.classList.add("sapVizKitPDFHotspotSurface");t.setAttribute("viewBox","0 0 1 1");this._hotspotSurface=t;this._currentHotspotElement=null;this._normalCanvas=null;this._stretchedCanvas=null;this._highResCanvas=null;this._renderTasks=[];this._contentReplaced=false;this.attachBrowserEvent("wheel",this._onWheel,this);this._onScroll=this._onScroll.bind(this);this._onResize=this._onResize.bind(this);this._resizeListenerId=null;this._scale=1;this._scrolling=false;this._resizing=false;this._scrollContainer=new n(this,`${this.getId()}-${C}`,{horizontal:true,vertical:true,scrollContainerId:`${this.getId()}-${m}`});this._pageNavigationEnabled=true;const e=this._loco=new a(this);this._camera={zoom:this._scale,_screenToWorld:(t,e)=>{const n=this._page;if(n==null){return{x:0,y:0}}const{pageX:s,pageY:o,pageWidth:i,pageHeight:a}=n.rawDimensions;const{width:r,height:l}=this.getDomRef(v).getBoundingClientRect();return{x:t/r*i+s,y:e/l*a+o}},_worldToScreen:(t,e)=>{const n=this._page;if(n==null){return{x:0,y:0}}const{pageX:s,pageY:o,pageWidth:i,pageHeight:a}=n.rawDimensions;const{width:r,height:l}=this.getDomRef(v).getBoundingClientRect();return{x:(t-s)/i*r,y:(e-o)/a*l}},_transformRect:t=>{const e=this._page;if(e==null){return{x1:0,y1:0,x2:0,y2:0}}const{x:n,y:s}=this._camera._screenToWorld(t.x1,t.y1);const{x:o,y:i}=this._camera._screenToWorld(t.x2,t.y2);return{x1:Math.min(n,o),y1:Math.min(s,i),x2:Math.max(n,o),y2:Math.max(s,i)}}};const s=this._gestureHandler={click:t=>{if(this._document!=null){const{event:e}=t;const n=this.hitTest(e.clientX,e.clientY);const s={picked:n?[n]:[]};this.fireNodesPicked(s);if(this.getSelectionMode()===r.Exclusive){this.exclusiveSelectionHandler(s.picked)}else if(this.getSelectionMode()===r.Sticky){this.stickySelectionHandler(s.picked)}}},hover:t=>{if(this._document!=null&&!this.getDisableHotspotHovering()){const{event:e}=t;const n=this._currentHotspotElement;const s=this.hitTest(e.clientX,e.clientY);if(s!=n){if(!this.getShowAllHotspots()){n?.setHotspotColor(1,null);s?.setHotspotColor(1,"#bb000059")}this._currentHotspotElement=s}}}};e.addHandler(s)};b.prototype.exit=function(){this._loco.removeHandler(this._gestureHandler).destroy();this._loco=null;this._gestureHandler=null;this.detachBrowserEvent("wheel",this._onWheel,this);this._scrollContainer.destroy();this._scrollContainer=null;this._unsubscribeFromEvents();this._highResCanvas=null;this._stretchedCanvas=null;this._normalCanvas=null;this._hotspotSurface=null;this._currentHotspotElement=null;this._scene=null;this._page=null;this._document=null;l.prototype.exit?.call(this)};b.prototype.getIdForLabel=function(){return`${this.getId()}-${v}`};b.prototype.getScrollDelegate=function(){return this._scrollContainer};b.prototype._subscribeToEvents=function(){this.$(m).on("scroll",this._onScroll);this._resizeListenerId=s.register(this,this._onResize)};b.prototype._unsubscribeFromEvents=function(){s.deregister(this._resizeListenerId);this._resizeListenerId=null;this.$(m).off("scroll",this._onScroll)};b.prototype.onSetContentConnector=function(t){l.prototype.onSetContentConnector.call(this,t);t.attachEvent("_contentUpdated",this._onContentUpdated,this)};b.prototype.onUnsetContentConnector=function(t){t.detachEvent("_contentUpdated",this._onContentUpdated,this);l.prototype.onUnsetContentConnector.call(this,t)};b.prototype._setContent=function(t){l.prototype._setContent.call(this,t);const e=this._document;if(t===e){return}this._document=t;this._scene=t?.scene;this._page=null;this._deleteHighResCanvas();this._deleteStretchedCanvas();this._deleteNormalCanvas();this._scale=this._camera.zoom=1;this._currentHotspotElement=null;this.fireEvent("documentReplaced",{oldDocument:e,newDocument:t},false,true);if(t!=null){this._applyHotspotHoveringClass(this.getDisableHotspotHovering());this._applyShowAllHotspots(this.getShowAllHotspots());this._contentReplaced=true;this.setCurrentPageIndex(this.getCurrentPageIndex())}this.invalidate()};b.prototype._onContentUpdated=function(t){this._applyHotspotHoveringClass(this.getDisableHotspotHovering());this._applyShowAllHotspots(this.getShowAllHotspots())};b.prototype._createNormalCanvas=function(){const t=document.createElement("canvas");t.id=`${this.getId()}-${y}`;t.classList.add("sapVizKitPDFNormalCanvas");return t};b.prototype._createStretchedCanvas=function(){const t=document.createElement("canvas");t.id=`${this.getId()}-${w}`;t.classList.add("sapVizKitPDFStretchedCanvas");return t};b.prototype._createHighResCanvas=function(){const t=document.createElement("canvas");t.id=`${this.getId()}-${H}`;t.classList.add("sapVizKitPDFHighResCanvas");return t};b.prototype._deleteNormalCanvas=function(){this._normalCanvas?.remove();this._normalCanvas=null};b.prototype._deleteStretchedCanvas=function(){this._stretchedCanvas?.remove();this._stretchedCanvas=null};b.prototype._deleteHighResCanvas=function(){this._highResCanvas?.remove();this._highResCanvas=null};b.prototype._layoutPage=function({page:t,scale:n=this._scale,firstTimePageRendering:s=false,zoomCenter:o=null}){const i=this.getDomRef(v);if(i==null){return null}const a={};const{cssWidth:r,cssHeight:l,width:c,height:h}=this._calculatePDFCanvasSize(t,n);const p=Math.max(screen.width,screen.height);const u=r>p||l>p;const d=this._normalCanvas!=null?P:this._stretchedCanvas!=null?x:S;const g=u?x:P;const f=this.getDomRef(m);if(d===S){const t=this._createNormalCanvas();const{style:e}=t;e.width=`${r}px`;e.height=`${l}px`;this._normalCanvas=t;i.appendChild(t)}if(g===P){const t=this._createNormalCanvas();t.width=c;t.height=h;const{style:e}=t;e.width=`${r}px`;e.height=`${l}px`;a.normal={canvas:t,scale:n}}else if(d!==x||s){const e=this._createStretchedCanvas();const{width:n,height:s}=this._calculatePDFCanvasSize(t,1);let o;if(n>s){e.width=p;e.height=p*s/n;o=p/n}else{e.width=p*n/s;e.height=p;o=p/s}const{style:i}=e;i.width=`${r}px`;i.height=`${l}px`;a.stretched={canvas:e,scale:o}}if(o!=null){const s=this._screenToPage(t,o[0],o[1]);this._scale=this._camera.zoom=n;this.getTools().map(t=>e.getElementById(t)).filter(t=>t.isA("sap.ui.vk.tools.TransformSvgElementTool")).map(t=>t.getGizmoForContainer(this)).filter(t=>t?.hasDomElement()).forEach(t=>t.rerender());i.style.setProperty("--sapUiVizKitRedlineScale",n);const{style:a}=this._normalCanvas??this._stretchedCanvas;a.width=`${r}px`;a.height=`${l}px`;const c=this._pageToScreen(t,s[0],s[1]);f.scrollBy({left:c[0]-o[0],top:c[1]-o[1],behavior:"instant"})}else{const{style:t}=this._normalCanvas??this._stretchedCanvas;t.width=`${r}px`;t.height=`${l}px`}if(g===x){const t=f.getBoundingClientRect();const e=i.getBoundingClientRect();const s=E(t,e);const{devicePixelRatio:o}=window;const r=this._createHighResCanvas();r.width=Math.round(s.width*o);r.height=Math.round(s.height*o);const{style:l}=r;l.width=`${s.width/e.width*100}%`;l.height=`${s.height/e.height*100}%`;l.left=`${(s.left-e.left)/e.width*100}%`;l.top=`${(s.top-e.top)/e.height*100}%`;a.highRes={canvas:r,scale:n,offsetX:Math.min(e.left-t.left,0),offsetY:Math.min(e.top-t.top,0)}}this._redlineHandler?._tool.getGizmo().rerender();return a};b.prototype._cancelRenderTasks=async function(){const t=this._renderTasks;for(const e of t){e.cancel()}try{await Promise.all(t.map(({promise:t})=>t))}catch(t){}t.splice(0)};b.prototype._renderPage=async function({page:e,canvases:n}){if(this.getDomRef(v)==null){return}await this._cancelRenderTasks();const s=this._renderTasks;try{const{normal:t,stretched:o,highRes:i}=n;if(t!=null){const{canvas:n,scale:o}=t;s.push(e.renderToCanvas(n,o))}else{if(o!=null){const{canvas:t,scale:n}=o;s.push(e.renderToCanvas(t,n))}const{canvas:t,scale:n,offsetX:a,offsetY:r}=i;s.push(e.renderToCanvas(t,n,a,r))}await Promise.all(s.map(({promise:t})=>t));const a=this.getDomRef(v);if(a==null){return}if(t!=null){this._deleteHighResCanvas();this._deleteStretchedCanvas();this._deleteNormalCanvas();const{canvas:e}=t;this._normalCanvas=e;a.appendChild(e)}else{this._deleteNormalCanvas();if(o!=null){this._deleteStretchedCanvas();const{canvas:t}=o;this._stretchedCanvas=t;a.appendChild(t)}this._deleteHighResCanvas();const{canvas:t}=i;this._highResCanvas=t;a.appendChild(t)}}catch(e){if(e instanceof p.getPdfjsLib().RenderingCancelledException){t.debug("Rendering cancelled",e,D)}else{t.error("Failed to render PDF page",e,D)}}finally{s.splice(0)}};b.prototype._render=async function({page:t,scale:e=this._scale,firstTimePageRendering:n=false,zoomCenter:s=null}={}){const o=this._layoutPage({page:t,scale:e,firstTimePageRendering:n,zoomCenter:s});await this._renderPage({page:t,canvases:o})};b.prototype.onAfterRendering=function(t){this._subscribeToEvents();const e=this.getDomRef(v);e.appendChild(this._hotspotSurface);if(this._normalCanvas!=null){e.appendChild(this._normalCanvas)}if(this._stretchedCanvas!=null){e.appendChild(this._stretchedCanvas)}if(this._highResCanvas!=null){e.appendChild(this._highResCanvas)}};b.prototype.onBeforeRendering=function(t){this._unsubscribeFromEvents()};b.prototype.setCurrentPageIndex=function(t){const e=this._document;if(e==null){this.setProperty("currentPageIndex",t,true);return this}const n=Math.max(0,Math.min(t,e.pageCount-1));const s=this.getCurrentPageIndex();if(n===s&&!this._contentReplaced){return this}this._contentReplaced=false;this.setProperty("currentPageIndex",n,true);(async()=>{const t=await e.getPage(n);this._page=t;const s=this._normalCanvas??this._stretchedCanvas;if(s!=null){p.clearCanvas(s)}this._updateHotspotSurface();await this._render({page:t,firstTimePageRendering:true})})();this.fireEvent("pageChanged",{newPageIndex:n,oldPageIndex:s},false,true);return this};b.prototype.setPageNavigationEnabled=function(t){this._pageNavigationEnabled=t;this.getContent().find(t=>t.isA("sap.ui.vk.DrawerToolbar"))?.setPageNavigationEnabled(t);return this};b.prototype._calculatePDFCanvasSize=function(t,e){const n=t.userUnit*e*96/72;const{pageWidth:s,pageHeight:o}=t.rawDimensions;const i=s*n;const a=o*n;const{devicePixelRatio:r}=window;return{cssWidth:Math.round(i),cssHeight:Math.round(a),width:Math.round(i*r),height:Math.round(a*r)}};b.prototype._screenToPage=function(t,e,n){const{left:s,top:o}=this.getDomRef(v).getBoundingClientRect();return t.cssPixelToPDFPoint(e-s,n-o,this._scale)};b.prototype._pageToScreen=function(t,e,n){const{left:s,top:o}=this.getDomRef(v).getBoundingClientRect();const[i,a]=t.pdfPointToCSSPixel(e,n,this._scale);return[s+i,o+a]};b.prototype._isKeyboardPageNavigationPossible=function(t){return t.srcControl===this&&this._page!=null&&this._pageNavigationEnabled};b.prototype.onsappageup=function(t){if(!this._isKeyboardPageNavigationPossible(t)){return}t.preventDefault();this.setCurrentPageIndex(this.getCurrentPageIndex()-1)};b.prototype.onsappagedown=function(t){if(!this._isKeyboardPageNavigationPossible(t)){return}t.preventDefault();this.setCurrentPageIndex(this.getCurrentPageIndex()+1)};b.prototype.onsaphome=function(t){if(!this._isKeyboardPageNavigationPossible(t)){return}t.preventDefault();this.setCurrentPageIndex(0)};b.prototype.onsapend=function(t){if(!this._isKeyboardPageNavigationPossible(t)){return}t.preventDefault();this.setCurrentPageIndex(this._document.pageCount-1)};b.prototype._onWheel=function(t){if(this._page==null){return}if(!t.ctrlKey){return}t.preventDefault();const e=Math.min(Math.max(-t.originalEvent.deltaY,-20),20);this.zoom(Math.pow(2,e/100),t.clientX,t.clientY)};b.prototype._onScroll=function(t){if(this._page==null){return}if(this._highResCanvas!=null&&!this._scrolling){this._scrolling=true;setTimeout(()=>{this._scrolling=false;this._render({page:this._page})},500)}};b.prototype._onResize=function(t){if(this._page!=null){if(this._highResCanvas!=null&&!this._resizing){this._resizing=true;setTimeout(()=>{this._resizing=false;this._render({page:this._page})},500)}}const{width:e,height:n}=t.size;this.fireResize({size:{width:e,height:n}})};b.prototype.onkeydown=function(t){if(t.srcControl!==this||this._page==null){return}if(t.ctrlKey){let e=true;let n=1;switch(t.key){case"+":case"=":n=d;break;case"-":case"_":n=1/d;break;case"0":n=1/this._scale;break;default:e=false;break}if(e){t.preventDefault();const{left:e,top:s,right:o,bottom:i}=this.getDomRef(v).getBoundingClientRect();this.zoom(n,(e+o)/2,(s+i)/2)}}else if(!t.altKey){let e=0;let n=0;let s=true;switch(t.key){case"ArrowLeft":e=-_;break;case"ArrowRight":e=_;break;case"ArrowUp":n=-_;break;case"ArrowDown":n=_;break;default:s=false;break}if(s){t.preventDefault();this.pan(e,n)}}};b.prototype.pan=function(t,e){if(this._page==null){return}const n=this.getDomRef(m);if(n==null){return}const{scrollLeft:s,scrollTop:o}=n;this._scrollContainer.scrollTo(s+t,o+e);if(this._highResCanvas!=null){this._render({page:this._page})}};b.prototype.zoom=function(t,e,n){if(this._page==null){return}const s=this._page;if(s==null||t===1){return}const o=this._scale;const i=Math.min(Math.max(o*t,g),f);if(i!=o){this._render({page:s,scale:i,zoomCenter:[e,n]})}};b.prototype.zoomToFitPage=function(){const t=this._page;const e=this.getDomRef();if(t==null||e==null){return}const{cssWidth:n,cssHeight:s}=this._calculatePDFCanvasSize(t,1);const o=n/s;const{clientWidth:i,clientHeight:a}=e;const{paddingLeft:r,paddingRight:l,paddingTop:c,paddingBottom:h}=getComputedStyle(this.getDomRef(m));const p=i-parseFloat(r)-parseFloat(l);const u=a-parseFloat(c)-parseFloat(h);const d=p/u;const g=d<o?p:u*o;this._render({page:t,scale:g/n,zoomCenter:[i/2,a/2]})};b.prototype.zoomToFitPageWidth=function(){const t=this._page;const e=this.getDomRef();if(t==null||e==null){return}const{cssWidth:n,cssHeight:s}=this._calculatePDFCanvasSize(t,1);const{clientWidth:o,clientHeight:i}=e;const{paddingLeft:a,paddingRight:r,paddingTop:l,paddingBottom:c}=getComputedStyle(this.getDomRef(m));const h=o-parseFloat(a)-parseFloat(r);const p=i-parseFloat(l)-parseFloat(c);let u=h;const d=s*u/n;if(d>p){u-=z()}this._render({page:t,scale:u/n,zoomCenter:[o/2,i/2]})};b.prototype.setShouldRenderFrame=function(){};b.prototype.getOutputSize=function(){const{width:t,height:e}=this.getDomRef(v).getBoundingClientRect();const n=Math.min(t,e);return{left:(t-n)*.5,top:(e-n)*.5,sideLength:n}};b.prototype.onmousedown=function(t){const e=this._redlineHandler;if(e!=null&&t.srcControl.isA("sap.ui.vk.RedlineElementText")&&e._tool.getGizmo()?._textEditingElement==null){t.preventDefault();this.focus();return}};function E(t,e){if(t.right<e.left||e.right<t.left||t.bottom<e.top||e.bottom<t.top){return new DOMRect(0,0,0,0)}const n=Math.max(t.left,e.left);const s=Math.max(t.top,e.top);const o=Math.min(t.right,e.right);const i=Math.min(t.bottom,e.bottom);return new DOMRect(n,s,o-n,i-s)}function z(){const t=document.createElement("div");t.style.visibility="hidden";t.style.overflow="scroll";document.body.appendChild(t);const e=document.createElement("div");t.appendChild(e);const n=t.offsetWidth-e.offsetWidth;t.remove();return n}b.prototype.getScene=function(){return this._document?.scene};b.prototype._getViewBox=function(){const t=this._page;if(t==null){return[0,0,1,1]}const{pageX:e,pageY:n,pageWidth:s,pageHeight:o}=t.rawDimensions;return[e,n,s,o]};b.prototype._updateHotspotSurface=function(){this._cleanupHotspotSurface();this._populateHotspotSurface()};b.prototype._cleanupHotspotSurface=function(){const t=this._hotspotSurface;for(let e=t.lastElementChild;e!=null;e=t.lastElementChild){e.remove()}};b.prototype._populateHotspotSurface=function(){const t=this._hotspotSurface;const e=new Map;const n=t=>e.set(c._hotspotEffectName(t),t);n(o(this._viewStateManager.getHighlightColor(true)));n(o(this.getHotspotColorABGR()));n(i(this.getShowAllHotspotsTintColor()));for(const t of this._document.scene.getDefaultNodeHierarchy().getHotspotNodeRefs()){const{name:n,color:s}=t.getHotspotEffectDef();e.set(n,s)}for(const[n,s]of e){const e=document.createElementNS(u,"filter");e.id=n;const o=document.createElementNS(u,"feColorMatrix");o.setAttribute("in","SourceGraphic");o.setAttribute("type","matrix");o.setAttribute("values",`0 0 0 0 ${s.red/255}, 0 0 0 0 ${s.green/255}, 0 0 0 0 ${s.blue/255}, 0 0 0 ${s.alpha} 0`);e.appendChild(o);t.appendChild(e)}t.setAttribute("viewBox",`${this._getViewBox().join(" ")}`);const{scene:s}=this._document;const a=s.getRootElement();const r=a.children[0];const{pageY:l,pageHeight:h}=this._page.rawDimensions;r.setMatrix([1,0,0,-1,0,h+2*l]);const p=this._createDomSvgElement(a);t.appendChild(p)};b.prototype._createDomSvgElement=function(t){const e=t.getPageIndex();if(e!=null&&e!==this.getCurrentPageIndex()){return null}const n=t.domRef=t._createDomElement();for(const e of t.children){const t=this._createDomSvgElement(e);if(t!=null){n.appendChild(t)}}return n};b.prototype.setDisableHotspotHovering=function(t){this.setProperty("disableHotspotHovering",t,true);this._applyHotspotHoveringClass(t);return this};b.prototype._applyHotspotHoveringClass=function(t){const e=this._document;if(e!=null){const n=t?"addClass":"removeClass";const s=e.scene.getDefaultNodeHierarchy().getHotspotNodeRefs();for(const t of s){t[n]("sapUiVizKitNonInteractiveHotspot")}}return this};b.prototype.setShowAllHotspots=function(t){this.setProperty("showAllHotspots",t,true);this._applyShowAllHotspots(t);return this};b.prototype._applyShowAllHotspots=function(t){const e=this._document;if(e==null){return}const n=e.scene.getDefaultNodeHierarchy().getHotspotNodeRefs();const s=this._currentHotspotElement;const o=this.getShowAllHotspotsTintColor();for(const e of n){if(t){e.setHotspotColor(1,o)}else if(e===s){e.setHotspotColor(1,this.getHotspotColorABGR())}else{e.setHotspotColor(1,null)}}};b.prototype.hitTest=function(t,e){const n=document.elementFromPoint(t,e);if(n!=null){const t=this._document.scene.getRootElement().getElementById(n.id);if(t!=null){return t._getSceneTreeElement()}}return null};b.prototype.onSetViewStateManager=function(t){this._viewStateManager=t;t.attachOutliningChanged(this._onOutliningOrSelectionChanged,this);t.attachSelectionChanged(this._onOutliningOrSelectionChanged,this)};b.prototype.onUnsetViewStateManager=function(t){t.detachOutliningChanged(this._onOutliningOrSelectionChanged,this);t.detachSelectionChanged(this._onOutliningOrSelectionChanged,this);this._viewStateManager=null};b.prototype._onOutliningOrSelectionChanged=function(t){for(const n of this.getTools()){const s=e.getElementById(n);const o=s.getGizmoForContainer(this);if(o&&o.handleSelectionChanged){o.handleSelectionChanged(t)}}};b.prototype.showHotspots=function(t,e,n){if(t==null){return this}if(!Array.isArray(t)){t=[t]}const s=e?n??this.getHotspotColorABGR():null;for(const e of t){e.setCustomHotspotColor(1,s)}this._updateHotspotSurface();return this};b.prototype.attachCameraChanged=function(){};b.prototype.detachCameraChanged=function(){};return b});
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/pdf/ViewportRenderer", ["sap/ui/core/Element"],e=>{"use strict";function t(e){return e.isA("sap.ui.vk.tools.RedlineTool")}function i(e){return e.isA("sap.ui.vk.tools.TransformSvgElementTool")}function n(t,i,n){i.getTools().map(t=>e.getElementById(t)).filter(e=>n(e)).map(e=>e.getGizmoForContainer(i)).filter(e=>e?.hasDomElement()).forEach(e=>t.renderControl(e))}return{apiVersion:2,render(e,o){{e.openStart("div",o);e.class("sapVizKitViewport");e.class("sapVizKitPDFViewport");e.attr("tabindex",0);e.attr("aria-label","Image");e.attr("role","figure");e.style("width",o.getWidth());e.style("height",o.getHeight());e.openEnd();o.renderContent(e);n(e,o,e=>!(t(e)||i(e)));{e.openStart("div",o.getId()+"-scrollContainer");e.class("sapVizKitPDFScrollContainer");e.openEnd();{e.openStart("div",o.getId()+"-document");e.class("sapVizKitPDFDocument");e.openEnd();{e.openStart("div",o.getId()+"-page");e.class("sapVizKitPDFPage");e.style("--sapUiVizKitRedlineScale",o._scale);e.openEnd();n(e,o,e=>t(e)||i(e));e.close("div")}e.close("div")}e.close("div")}e.close("div")}}}});
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/svg/BaseNodeProxy", ["../BaseNodeProxy"],function(e){"use strict";var t=e.extend("sap.ui.vk.svg.BaseNodeProxy",{metadata:{library:"sap.ui.vk"}});t.prototype.init=function(e,t){this._element=t};t.prototype.reset=function(){this._element=null};t.prototype.getNodeRef=function(){return this._element};t.prototype.getNodeId=function(){return this._element};t.prototype.getName=function(){return this._element.name||"<"+this._element.type+">"};t.prototype.getNodeMetadata=function(){return this._element.userData.metadata||{}};t.prototype.getSceneRef=function(){return this._element};return t});
/*!
* SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
*/
sap.ui.predefine("sap/ui/vk/svg/ContentDeliveryService", ["sap/base/Log","sap/ui/base/ManagedObject","../totara/TotaraLoader","../svg/SceneBuilder","../getResourceBundle","../uuidv4"],function(e,t,r,n,a,o){"use strict";var i=t.extend("sap.ui.vk.svg.ContentDeliveryService",{metadata:{library:"sap.ui.vk",properties:{authorizationHandler:"any",maxActiveRequests:{type:"int",defaultValue:4},consumptionScenario:{type:"string"},maxUrlLength:{type:"int",defaultValue:2048},meshesBatchSize:{type:"int",defaultValue:128},materialsBatchSize:{type:"int",defaultValue:128},geomMeshesBatchSize:{type:"int",defaultValue:128},geomMeshesMaxBatchDataSize:{type:"int",defaultValue:10*1024*1024},annotationsBatchSize:{type:"int",defaultValue:128},tracksBatchSize:{type:"int",defaultValue:128},sequencesBatchSize:{type:"int",defaultValue:128},voxelThreshold:{type:"number",defaultValue:0},skipLowLODRendering:{type:"boolean",defaultValue:true}},events:{cameraChanged:{parameters:{sceneId:{type:"string"},camera:{type:"any"}},enableEventBubbling:true},sceneUpdated:{parameters:{},enableEventBubbling:true},viewGroupUpdated:{parameters:{currentViewGroupId:"string"},enableEventBubbling:true},sceneCompleted:{parameters:{sceneId:{type:"string"}},enableEventBubbling:true},loadingFinished:{parameters:{currentViewId:"string",currentViewGroupId:"string"},enableEventBubbling:true},contentChangesProgress:{parameters:{percent:"float"}},errorReported:{parameters:{error:{type:"any"}}},initialViewCompleted:{parameters:{sceneId:{type:"string"}},enableEventBubbling:true}}},constructor:function(e,a){this._loader=new r;this._loader.setSceneBuilder(new n);t.apply(this,arguments);this._loader.setSkipLowLODRendering(this.getSkipLowLODRendering());this._transientSceneMap=new Map;this._currentNodeHierarchy=null}});i.prototype.getMaxActiveRequests=function(){return this._loader.getMaxActiveRequests()};i.prototype.setMaxActiveRequests=function(e){this._loader.setMaxActiveRequests(e);return this};i.prototype.getConsumptionScenario=function(){return this._loader.getConsumptionScenario()};i.prototype.setConsumptionScenario=function(e){this._loader.setConsumptionScenario(e);return this};i.prototype.getMaxUrlLength=function(){return this._loader.getMaxUrlLength()};i.prototype.setMaxUrlLength=function(e){this._loader.setMaxUrlLength(e);return this};i.prototype.getMeshesBatchSize=function(){return this._loader.getMeshesBatchSize()};i.prototype.setMeshesBatchSize=function(e){this._loader.setMeshesBatchSize(e);return this};i.prototype.getMaterialsBatchSize=function(){return this._loader.getMaterialsBatchSize()};i.prototype.setMaterialsBatchSize=function(e){this._loader.setMaterialsBatchSize(e);return this};i.prototype.getGeomMeshesBatchSize=function(){return this._loader.getGeomMeshesBatchSize()};i.prototype.setGeomMeshesBatchSize=function(e){this._loader.setGeomMeshesBatchSize(e);return this};i.prototype.getGeomMeshesMaxBatchDataSize=function(){return this._loader.getGeomMeshesMaxBatchDataSize()};i.prototype.setGeomMeshesMaxBatchDataSize=function(e){this._loader.setGeomMeshesMaxBatchDataSize(e);return this};i.prototype.getAnnotationsBatchSize=function(){return this._loader.getAnnotationsBatchSize()};i.prototype.setAnnotationsBatchSize=function(e){this._loader.setAnnotationsBatchSize(e);return this};i.prototype.getVoxelThreshold=function(){return this._loader.getVoxelThreshold()};i.prototype.setVoxelThreshold=function(e){this._loader.setVoxelThreshold(e);return this};i.prototype.setSkipLowLODRendering=function(e){this.setProperty("skipLowLODRendering",e,true);this._loader.setSkipLowLODRendering(e);return this};i.prototype.initUrl=function(e,t,n){if(!e.endsWith("/")){e+="/"}var a=this;function i(){a.fireSceneUpdated({})}function s(){var e;if(a._loader&&a._loader.currentSceneInfo){var t=a._loader.getContext(a._loader.currentSceneInfo.id);if(t){e=t.currentViewGroupId}}a.fireViewGroupUpdated({currentViewGroupId:e})}if(!this._loader.running()||this._loader.getUrl()!==e){if(this._loader.running()){var d=this._loader.sceneBuilder;this._loader.dispose();this._loader=new r;this._loader.setSceneBuilder(d)}this._loader.onErrorCallbacks.attach(this._reportError.bind(a));this._loader.onMaterialFinishedCallbacks.attach(i);this._loader.onImageFinishedCallbacks.attach(i);this._loader.onImageDetailsFinishedCallbacks.attach(i);this._loader.onViewGroupUpdatedCallbacks.attach(s);this._loader.setUrl(e);this._loader.setSessionId(n?n:o());return this._loader.run()}else if(!t){this._loader.cleanup()}return Promise.resolve("Loader is ready")};i.prototype._reportError=function(e){this.fireErrorReported(e)};i.prototype._createLoadParam=function(t,r,n,a){var o=this;var i;var s=false;var d;if(this._currentNodeHierarchy){d=this._currentNodeHierarchy.getScene()}var u={root:n,vkScene:d,activateView:a.getActivateView(),enableLogger:a.getEnableLogger(),includeAnimation:a.getIncludeAnimation(),includeBackground:a.getIncludeBackground(),includeHidden:a.getIncludeHidden(),includeParametric:a.getIncludeParametric(),includeMetadata:a.getIncludeMetadata(),includeUsageId:a.getIncludeUsageId(),metadataFilter:a.getMetadataFilter(),pushPMI:a.getPushPMI(),pushViewGroups:a.getPushViewGroups(),useSecureConnection:a.getUseSecureConnection(),onActiveCamera:function(e){var t=false;var r=o._loader.getContext(a.getVeid());if(r&&r.phase<2){i=e;t=true}if(!t){o.fireCameraChanged({sceneId:a.getVeid(),camera:e})}},onInitialSceneFinished:function(e){s=true;t({node:n,camera:i,contentResource:a,initialView:e,annotations:o.getSceneBuilder()._annotations,loader:o})},onSceneCompleted:function(){o.fireSceneCompleted({sceneId:a.getVeid()})},onLoadingFinished:function(){var e,t;if(o._loader&&o._loader.currentSceneInfo){var r=o._loader.getContext(o._loader.currentSceneInfo.id);if(r){e=r.currentViewId;t=r.currentViewGroupId}}o.fireLoadingFinished({currentViewId:e,currentViewGroupId:t})},onContentChangesProgress:function(e){o.fireContentChangesProgress({source:e.source,phase:e.phase,percentage:e.percentage})},onInitialViewCompleted:function(){o.fireInitialViewCompleted({sceneId:a.getVeid()})}};var c=function(t){e.warning("Content loading error reported:",JSON.stringify(t.getParameters()));var n;if(t.getParameter("errorText")){n=t.getParameter("errorText")}else if(t.getParameter("error")){n=t.getParameter("error")}else if(t.getParameter("reason")){n=t.getParameter("reason")}else{n="failed to load: unknown reason"}if(s){var a=t.getParameter("error");if(a&&a===4){o.initUrl(this._loader.getUrl(),true)}}else{o.detachErrorReported(c);if(t.getParameter("events")){n=n+"\n"+JSON.stringify(t.getParameter("events"))}r(n)}};o.attachErrorReported(c);return u};i.prototype.load=function(e,t,r){var n=this;var o=t.getNodeProxy();if(o){this._currentNodeHierarchy=o.getNodeHierarchy()}return new Promise(function(o,i){if(!t.getSource()||!t.getVeid()){i(a().getText("CONTENTDELIVERYSERVICE_MSG_NOURLORVEID"));return}n.initUrl(t.getSource(),true);var s=n._createLoadParam(o,i,e,t);if(n._loader){n._loader.request(t.getVeid(),s,r)}})};i.prototype.getSceneBuilder=function(){if(this._loader){return this._loader.getSceneBuilder()}return null};i.prototype.decrementResourceCountersForDeletedTreeNode=function(e){var t=this._loader.getContext(this._loader.currentSceneInfo.id);this._loader.decrementResourceCountersForDeletedTreeNode(t,e)};i.prototype.update=function(e,t,r){var n=this;return new Promise(function(o,i){if(!n._loader){i(a().getText("CONTENTDELIVERYSERVICE_MSG_CONTENTDELIVERYSERVICENOTINITIALISED"));return}n._loader.update(e,t,r).then(function(e){if(n._currentNodeHierarchy){for(var t=0;t<e.replacedNodeRefs.length;t++){n._currentNodeHierarchy.fireNodeReplaced({ReplacedNodeRef:e.replacedNodeRefs[t],ReplacementNodeRef:e.replacementNodeRefs[t],ReplacedNodeId:e.replacedNodeRefs[t],ReplacementNodeId:e.replacementNodeRefs[t]})}}o({sceneVeId:e.sceneVeId,sids:e.sidArray})}).catch(function(e){return i(e)})})};i.prototype.exit=function(){if(this._loader){this._loader.dispose();this._loader=null}this._transientSceneMap=null};i.prototype.loadView=function(t,r,n,a){if(typeof n==="undefined"){n="static"}var o=this;return this._loader.requestView(t,n,r,null,a).then(function(e){if(o._currentNodeHierarchy&&e.updatedNodes){for(var t=0;t<e.updatedNodes.length;t++){o._currentNodeHierarchy.fireNodeUpdated({nodeRef:e.updatedNodes[t]})}}o.fireSceneUpdated({});return e}).catch(function(t){e.error(t);return null})};i.prototype.updatePlaybacks=function(t,r,n){var a=this;return this._loader.requestView(t,"static",r,n,true).then(function(e){if(a._currentNodeHierarchy&&e.updatedNodes){for(var t=0;t<e.updatedNodes.length;t++){a._currentNodeHierarchy.fireNodeUpdated({nodeRef:e.updatedNodes[t]})}}a.fireSceneUpdated({});return e}).catch(function(t){e.error(t);return null})};i.prototype.loadViewGroup=function(t,r,n,a){var o=this;return this._loader.requestViewGroup(t,r,n,a).then(function(e){o.fireSceneUpdated({});return e}).catch(function(t){e.error(t);return null})};i.prototype.loadAnnotation=function(t,r){var n=this;return this._loader.requestAnnotation(t,r).then(function(e){n.fireSceneUpdated({});return e}).catch(function(t){e.error(t);return null})};i.prototype.assignMaterialToNodes=function(e,t,r,n){return Promise.resolve()};i.prototype.replaceMaterialOnNodes=function(e,t,r,n){return Promise.resolve()};i.prototype.printLogTokens=function(){if(this._loader){this._loader.printLogTokens();return true}else{return false}};return i});
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/svg/ContentManager", ["sap/base/Log","../ContentManager","./Scene","./SceneBuilder","./Element","../Messages","../getResourceBundle","./Viewport","./ViewStateManager"],function(e,t,r,a,o,n,i){"use strict";var s=t.extend("sap.ui.vk.svg.ContentManager",{metadata:{library:"sap.ui.vk",events:{errorReported:{parameters:{error:{type:"any"}}}}}});var d=s.getMetadata().getParent().getClass().prototype;s.prototype.init=function(){if(d.init){d.init.call(this)}};s.prototype.exit=function(){if(this.defaultCdsLoader){this.defaultCdsLoader.destroy();this.defaultCdsLoader=null}if(d.exit){d.exit.call(this)}};s.prototype._handleContentChangesProgress=function(e){this.fireContentChangesProgress({phase:e.getParameter("phase"),source:e.getParameter("source"),percentage:e.getParameter("percentage")})};s.prototype._handleContentLoadingFinished=function(e){this.fireContentLoadingFinished({source:e.getParameter("source"),node:e.getParameter("node")})};s.prototype.loadContent=function(t,a){var o=this;var s=function(){o.fireContentChangesStarted();var t=new r;o._loadContentResources(t,a).then(function(r){e.info("Content loading resolved",r);if(r&&r.length>0&&r[0].initialView){t.setInitialView(r[0].initialView)}var a;for(a=0;a<r.length;a++){if(r[a].camera){t.camera=r[a].camera;break}}if(r.length>0){var n=r[0];t.backgroundTopColor=n.backgroundTopColor;t.backgroundBottomColor=n.backgroundBottomColor;t.outputSettings=n.outputSettings}for(a=0;a<r.length;a++){if(r[a].loader){t.loaders=t.loaders||[];t.loaders.push(r[a].loader)}if(r[a].builder){t.builders=t.builders||[];t.builders.push(r[a].builder)}}if(o._totaraLoader){t.setSceneBuilder(o._totaraLoader.getSceneBuilder())}o.fireContentChangesFinished({content:t})},function(t){e.info("Content loading rejected:",t);var r;if(typeof t==="string"){r=t}else if(t.errorText){r=t.errorText}else if(t.message){r=t.message}r=r||i().getText(n.VIT37.summary);e.error(i().getText("CONTENTMANAGER_MSG_CONTENTRESOURCESFAILEDTOLOAD"),r);o.fireContentChangesFinished({content:null,failureReason:[{error:t,errorMessage:r}]})})};s();return this};s.prototype._getTotaraLoader=function(){if(this._totaraLoader==null){return new Promise(function(e){var t="sap/ui/vk/totara/TotaraLoader";sap.ui.require([t],function(t){var r=new t;r.setSceneBuilder(new a);e(r)})})}return Promise.resolve(this._totaraLoader)};s.prototype._getMataiLoader=function(){if(this._mataiLoader==null){var e=this;return new Promise(function(t){var r="sap/ui/vk/matai/MataiLoader";sap.ui.require([r],function(r){t(e._mataiLoader=new r)})})}return Promise.resolve(this._mataiLoader)};s.prototype._createLoadParam=function(t,r,a,o){var n=this;var i;var s=false;var d={root:a,vkScene:this._currentScene,enableLogger:o.getEnableLogger(),includeAnimation:false,includeBackground:o.getIncludeBackground(),includeHidden:o.getIncludeHidden(),includeParametric:true,includeMetadata:o.getIncludeMetadata()||o.getEffectiveSourceType()==="ecad",includeUsageId:o.getIncludeUsageId(),metadataFilter:o.getMetadataFilter(),pushPMI:true,pushViewGroups:o.getPushViewGroups(),useSecureConnection:o.getUseSecureConnection(),onActiveCamera:function(e){i=e},onInitialSceneFinished:function(e){s=true;t({node:a,contentResource:o,initialView:e,camera:i,loader:n._totaraLoader})},onLoadingFinished:function(){n.fireContentLoadingFinished({source:o,node:a})},onContentChangesProgress:function(e){n.fireContentChangesProgress({source:e.source,phase:e.phase,percentage:e.percentage})}};var u=function(t){e.warning("Content loading error reported:",JSON.stringify(t.getParameters()));var a;if(t.getParameter("errorText")){a=t.getParameter("errorText")}else if(t.getParameter("error")){a=t.getParameter("error")}else if(t.getParameter("reason")){a=t.getParameter("reason")}else{a="failed to load: unknown reason"}if(s){var o=t.getParameter("error");if(o&&o===4){n.initUrl(this._loader.getUrl(),true)}}else{n.detachErrorReported(u);if(t.getParameter("events")){a=a+"\n"+JSON.stringify(t.getParameter("events"))}r(a)}};n.attachErrorReported(u);return d};s.prototype._reportError=function(e){this.fireErrorReported(e)};s.prototype._loadStream=function(e,t){var r=this;return new Promise(function(a,o){r._getTotaraLoader().then(function(n){r._totaraLoader=n;var i=r._createLoadParam(a,o,e,t);n.onErrorCallbacks.attach(r._reportError.bind(r));n.setUrl(t.getSource());n.run();n.request(t.getVeid(),i,r._authorizationHandler)})})};s.prototype._loadVDS4=function(e,t){var r=this;return this._getMataiLoader().then(function(a){if(a){r._mataiLoader=a;a.attachContentChangesProgress(r._handleContentChangesProgress,r);a.attachContentLoadingFinished(r._handleContentLoadingFinished,r);return a.load(e,t)}else{return Promise.resolve({node:e,contentResource:t})}})};s.prototype._loadContentResources=function(e,t){this._currentScene=e;this._currentNodeHierarchy=e.getDefaultNodeHierarchy();var r=[];var a=this;t.forEach(function e(t,n){var i=new o;i.name=n.getName();i.sourceId=n.getSourceId();t.add(i);n._shadowContentResource={nodeProxy:this._currentNodeHierarchy.createNodeProxy(i)};var s=n._contentManagerResolver;var d=s&&s.settings?s.settings.loader:null;if(d){if(typeof d==="function"){r.push(d(i,n,a._authorizationHandler))}else if(d&&d.load){i.matrix=new Float32Array([1,0,0,-1,0,0]);r.push(d.load(i,n,a._authorizationHandler));this._totaraLoader=d._loader;this._totaraLoader.onLoadingFinishedCallbacks.attach(function(){a.fireContentLoadingFinished({source:n,node:i})})}else{r.push(Promise.resolve({node:i,contentResource:n}))}}else{const e=n.getEffectiveSourceType()?.toLowerCase();switch(e){case"ecad":case"stream2d":{i.matrix=new Float32Array([1,0,0,-1,0,0]);r.push(this._loadStream(i,n));break}case"vds4-2d":{i.matrix=new Float32Array([1,0,0,-1,0,0]);r.push(this._loadVDS4(i,n));break}default:break}}}.bind(this,e.getRootElement()));return Promise.all(r)};s.prototype.destroyContent=function(e){if(e){e.destroy()}if(this._totaraLoader){this._totaraLoader.dispose();this._totaraLoader=null}else if(this._mataiLoader&&e.builders&&Array.isArray(e.builders)){e.builders.forEach(function(e){if(e){e.cleanup()}});this._mataiLoader.destroy();this._mataiLoader=null}};return s});
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/svg/Element", ["../abgrToColor","../cssColorToColor","../NodeContentType","sap/base/assert","sap/base/Log","sap/base/util/uid"],function(t,e,i,s,o,r){"use strict";var n=10;var a=function(t){t=t||{};this.type="Group";this.uid=r();this.sid=t.sid||undefined;this.name=t.name||undefined;this.vMask=1|0;this.sMask=0|0;this.matrix=new Float32Array(t.matrix||[1,0,0,1,0,0]);this.parent=null;this.children=[];this.domRef=null;this.nodeContentType=i.Regular;this.materialId=t.materialID;if(t.lineStyle){this.lineStyle=t.lineStyle}if(t.fillStyle){this.fillStyle=t.fillStyle}this.userData=t.subelement?{skipIt:true}:{};this.classList=new Set};function h(t,i){if(t===null||t===undefined){return Float32Array([0,0,0,i])}var s=t.match(/\w\w/g).map(function(t){return parseInt(t,16)});if(s.length==4){i=s[3]/255}if(s.length<3||isNaN(s[0]+s[1]+s[2]+i)){t=e(t);return new Float32Array([t.red/255,t.green/255,t.blue/255,t.alpha])}return new Float32Array([s[0]/255,s[1]/255,s[2]/255,i])}function l(t,e){if(t){if(typeof t==="string"){return h(t,e)}else if(t.length===4){return new Float32Array(t)}else{return new Float32Array([t[0],t[1],t[2],e])}}return new Float32Array([0,0,0,0])}a.prototype.defaultFillAlpha=0;a.prototype.setFillStyle=function(t,e){if(t){this.fillStyle=t;if(t.fillURL){this.fillURL=t.fillURL}else{this.fill=l(t.colour,1)}}else{this.fill=new Float32Array([0,0,0,0])}if(this._fillStyleId){this.removeClass(this._fillStyleId);this._fillStyleId=null}if(e){this.invalidate()}};a.prototype.setLineStyle=function(t,e){if(t){this.lineStyle=t;this.stroke=l(t.colour,1);this.strokeWidth=t.width||1;this.coordinateSpace=t.coordinateSpace?t.coordinateSpace:n;this.strokeDashArray=a._convertDashes(t.dashes||[],this.strokeWidth);this.lineCap=t.linecap}else{this.stroke=new Float32Array([0,0,0,0]);this.strokeWidth=1;this.coordinateSpace=n;this.strokeDashArray=[]}if(this._lineStyleId){this.removeClass(this._lineStyleId);this._lineStyleId=null}if(e){this.invalidate()}};a.prototype.setMaterial=function(t,e){t=t||{};if(this.materialId===t.materialId){this.setFillStyle(this.fillStyle);var i=this.lineStyle;if(i){this.setLineStyle(i)}else{this.stroke=l(t.lineColor,1);this.strokeWidth=t.lineWidth!==undefined?t.lineWidth:1;this.strokeDashArray=t.lineStyle&&t.lineStyle.dashPattern||[];this.coordinateSpace=t.lineStyle?.widthCoordinateSpace??n}}for(var s=0,o=this.children.length;s<o;s++){this.children[s].setMaterial(t)}if(e){this.invalidate()}};a._convertDashes=function(t,e){var i=[];for(var s=0;s<t.length;s++){var o=t[s]*10;if(o>0){i.push(o);i.push(0)}else if(o<0){i.push(0);i.push(-o)}else{i.push(e);i.push(e)}}return i};a._convertToDashes=function(t,e){var i=[];for(var s=0;s<t.length;s+=2){var o=t[s];var r=t[s+1];if(o===e&&r===e){i.push(0)}else if(r===0){i.push(o*.1)}else if(o===0){i.push(r*-.1)}}return i};a.prototype.add=function(t){if(t.parent!==null){t.parent.remove(t)}t.parent=this;this.children.push(t);t.sMask=this.sMask;if(this.highlightColor){t.highlightColor=this.highlightColor}var e=this._hasHostpotAncestor();if(e||this.nodeContentType===i.Hotspot){this._updateHotspotDescendants(e?null:this)}const s=this._hasDynamicContentAncestor();if(s||this.nodeContentType===i.DynamicContent){this._updateHotspotDescendants(s?null:this)}if(this.domRef){t.traverse(function(t){if(!t.domRef){t.domRef=c(t)?t.parent.domRef:t._createDomElement()}if(t.domRef&&t.parent.domRef&&t.parent.domRef!==t.domRef&&t.domRef.parentNode!==t.parent.domRef){t.parent.domRef.appendChild(t.domRef)}})}return this};a.prototype.remove=function(t){var e=this.children.indexOf(t);if(e!==-1){if(t.domRef&&this.domRef&&t.domRef.parentNode===this.domRef){this.domRef.removeChild(t.domRef)}t.parent=null;this.children.splice(e,1)}return this};a.prototype.replace=function(t,e){var i=this.children.indexOf(t);if(i!==-1){t.parent=null;e.parent=this;this.children[i]=e;e.domRef=t.domRef;e.invalidate()}return this};a.prototype._vkPersistentId=function(){var t=this;do{if(t.sid){return t.sid}t=t.parent}while(t);return null};a.prototype._vkGetNodeContentType=function(){return this.nodeContentType};a.prototype._updateHotspotDescendants=function(t){this.traverse(function(e){if(e===t){return}e.userData.skipIt=true;if(t&&e._isGeometryNode()){Object.defineProperty(e,"filter",{get:function(){return t.getHotspotEffectDef().name},configurable:true})}if(e.hasOwnProperty("opacity")){delete e.opacity}if(e._isGeometryNode()){e.fill=e.stroke=new Float32Array([1,1,1,1]);e._updateColor()}else if(e.domRef){e.domRef.removeAttribute("filter");e.domRef.removeAttribute("opacity")}})};a.prototype._initAsHotspot=function(){if(this._hasHostpotAncestor()){return}Object.defineProperty(this,"opacity",{get:function(){return this.highlightColor||this.customHotspotColor||this.hotspotColor?1:0},configurable:true});this._updateHotspotDescendants(this);if(this.domRef!==null){if(this.domRef===(this.parent&&this.parent.domRef)){this.invalidate()}else{this._updateColor()}}};a.prototype._initAsDynamicContent=function(){if(this._hasDynamicContentAncestor()){return}this._updateHotspotDescendants(this);if(this.domRef!==null){if(this.domRef===(this.parent&&this.parent.domRef)){this.invalidate()}else{this._updateColor()}}};a.prototype._vkSetNodeContentType=function(t){this.nodeContentType=t;if(t===i.Hotspot){this._initAsHotspot()}if(t===i.DynamicContent){this._initAsDynamicContent()}};a.prototype.traverse=function(t){t(this);var e=this.children;for(var i=0,s=e.length;i<s;i++){e[i].traverse(t)}};a.prototype.traverseAncestors=function(t){var e=this.parent;if(e!==null){t(e);e.traverseAncestors(t)}};a.prototype.traverseVisible=function(t,e){if(this.isVisible(e)){t(this);var i=this.children;for(var s=0,o=i.length;s<o;s++){i[s].traverseVisible(t,e)}}};a.prototype.setVisible=function(t,e){if(!this.userData.skipIt){if(e){this.vMask|=t}else{this.vMask&=~t}if(this.domRef!==null){if(this.parent&&this.domRef===this.parent.domRef^c(this)){this.invalidate()}else if(e){this.domRef.removeAttribute("display")}else{this.domRef.setAttribute("display","none")}}}};a.prototype.isVisible=function(t){return this.userData.skipIt||(this.vMask&t)!==0};a.prototype._updateColor=function(t){var e=this.domRef;if(e!==null){if(this.nodeContentType===i.Hotspot&&!this._hasHostpotAncestor()){if(this.customText){this.customText.filter=this.getHotspotEffectDef().name+"-custom-text";this.customText.domRef?.setAttribute("filter",`url(#${this.customText.filter})`)}this.traverse(t=>{const e=t.filter;if(e){t.domRef?.setAttribute("filter",`url(#${e})`)}});e.setAttribute("opacity",this.opacity)}else if(this.nodeContentType===i.DynamicContent&&!this._hasDynamicContentAncestor()){if(this.customText){this.customText.filter=this.getHotspotEffectDef().name+"-custom-text";this.customText.domRef?.setAttribute("filter",`url(#${this.customText.filter})`)}this.traverse(t=>{const e=t.filter;if(e){t.domRef?.setAttribute("filter",`url(#${e})`)}})}else{var s=e.setAttribute.bind(e);if(this.highlightColor||this.tintColor){if(this._fillStyleId){this.removeClass(this._fillStyleId)}this._setFillStyleAttributes(s);if(this._lineStyleId){this.removeClass(this._lineStyleId)}this._setLineStyleAttributes(s)}else{if(this._fillStyleId){this.addClass(this._fillStyleId);e.removeAttribute("fill")}else{this._setFillStyleAttributes(s)}if(this._lineStyleId){this.addClass(this._lineStyleId);e.removeAttribute("stroke");e.removeAttribute("stroke-width");e.removeAttribute("vector-effect");e.removeAttribute("stroke-dasharray")}else{this._setLineStyleAttributes(s)}}}}};a._hotspotEffectName=function(t){return"hotspot-effect-"+_(t.red,t.green,t.blue,t.alpha)};a.prototype.getHotspotEffectDef=function(){var i;if(this.highlightColor){i=t(this.highlightColor)}else{var s=this.customHotspotColor||this.hotspotColor;if(s){i=typeof s==="number"?t(s):e(s)}else{i={red:0,green:0,blue:0,alpha:0}}}return{name:a._hotspotEffectName(i),color:i}};a.prototype.setSelected=function(t,e,i){if(e){this.sMask|=t;this.highlightColor=i}else{this.sMask&=~t;delete this.highlightColor}this._updateColor(t)};a.prototype.isSelected=function(t){return(this.sMask&t)!==0};a.prototype.setTintColor=function(t,e){s(this.nodeContentType!==i.Hotspot,"setTintColor() method is not for hotspots, use setHotspotColor() method");this.tintColor=e;this._updateColor(t)};a.prototype.getTintColor=function(){return this.tintColor};a.prototype.setHotspotColor=function(t,e){s(this.nodeContentType===i.Hotspot||this.nodeContentType===i.DynamicContent,"setHotspotColor() method is only for hotspots or dynamic content");this.hotspotColor=e;this._updateColor(t)};a.prototype.setCustomHotspotColor=function(t,e){s(this.nodeContentType===i.Hotspot,"setCustomHotspotColor() method is only for hotspots");this.customHotspotColor=e;this._updateColor(t)};a.prototype._isGeometryNode=function(){return this.constructor!==a};a.prototype.setOpacity=function(t){s(this.nodeContentType!==i.Hotspot,"setOpacity() method is not for hotspots");if(this._isGeometryNode()){return}this.opacity=t;if(this.domRef!==null){if(this.parent&&this.domRef===this.parent.domRef^c(this)){this.invalidate()}else if(t!==undefined){this.domRef.setAttribute("opacity",t)}else{this.domRef.removeAttribute("opacity")}}};function f(t){return t[0]===1&&t[1]===0&&t[2]===0&&t[3]===1&&t[4]===0&&t[5]===0}a.prototype.setMatrix=function(t){this.matrix.set(t);if(this.domRef!==null){if(this.parent&&this.domRef===this.parent.domRef^c(this)){this.invalidate()}else if(!this.parent||this.domRef!==this.parent.domRef){if(!f(t)){this.domRef.setAttribute("transform","matrix("+this.matrix.join(",")+")")}else{this.domRef.removeAttribute("transform")}}}this._updateCustomText()};a.prototype.setCustomText=function(t){o.warning("You need to import 'sap.ui.vk.svg.Text' module to call method setCustomText().");return this};a.prototype._updateCustomText=function(){if(this.customText){const t=this._getBBox(null,true);const e=this.customText.domRef?.getBBox();if(t&&e){const i=this._matrixWorld();const s=this.customText.pivot??[.5,.5];const o=t.x+t.width*s[0];const r=t.y+t.height*(i[3]<0?1-s[1]:s[1]);i[4]=i[5]=0;const n=a._transformPoint(o,r,i);const h=this.customText.anchor;if(h){n.x-=e.x+e.width*h[0];n.y-=e.y+e.height*h[1]}const l=a._invertMatrix(i);const f=a._transformPoint(n.x,n.y,l);l[4]=f.x;l[5]=f.y;this.customText.setMatrix(l)}}};a._multiplyMatrices=function(t,e){var i=t[0],s=t[2],o=t[4];var r=t[1],n=t[3],a=t[5];var h=e[0],l=e[2],f=e[4];var u=e[1],d=e[3],p=e[5];return new Float32Array([i*h+s*u,r*h+n*u,i*l+s*d,r*l+n*d,i*f+s*p+o,r*f+n*p+a])};a._invertMatrix=function(t){var e=t[0],i=t[1],s=t[2],o=t[3],r=t[4],n=t[5],a=e*o-i*s;if(a===0){return new Float32Array([0,0,0,0,0,0])}var h=1/a;var l=new Float32Array(6);l[0]=o*h;l[1]=-i*h;l[2]=-s*h;l[3]=e*h;l[4]=(n*s-o*r)*h;l[5]=(i*r-n*e)*h;return l};a._decompose=function(t){var e=Math.sqrt(t[0]*t[0]+t[1]*t[1]);var i=Math.sqrt(t[2]*t[2]+t[3]*t[3]);var s=t[0]*t[3]-t[1]*t[2];if(s<0){i*=-1}var o=t[0]/e,r=t[1]/e,n=t[2]/i,a=t[3]/i;var h,l;if(o+a+1>0){l=.5/Math.sqrt(2+o+a);h=[0,0,(n-r)*l,.25/l]}else{l=2*Math.sqrt(2-o-a);h=[0,0,.25*l,(n-r)/l]}return{position:[t[4],t[5],0],quaternion:h,scale:[e,i,1]}};a._compose=function(t,e,i){var s=i[0],o=i[1];var r=e[0],n=e[1],a=-e[2],h=e[3];var l=r*n,f=a*a,u=h*a;return new Float32Array([(1-(n*n+f)*2)*s,(l+u)*2*s,(l-u)*2*o,(1-(r*r+f)*2)*o,t[0],t[1]])};a._transformPoint=function(t,e,i){return{x:t*i[0]+e*i[2]+i[4],y:t*i[1]+e*i[3]+i[5]}};a.prototype._matrixWorld=function(t){if(t!==undefined){return a._multiplyMatrices(t,this.matrix)}else{var e=this.parent;var i=this.matrix;while(e!==null){i=a._multiplyMatrices(e.matrix,i);e=e.parent}return i}};function u(t,e,i,s,o){t.min.x=Math.min(t.min.x,e-s);t.min.y=Math.min(t.min.y,i-o);t.max.x=Math.max(t.max.x,e+s);t.max.y=Math.max(t.max.y,i+o)}function d(t){return t*t}a.prototype._expandBoundingBoxCE=function(t,e,i,s,o,r){u(t,i*e[0]+s*e[2]+e[4],i*e[1]+s*e[3]+e[5],Math.abs(o*e[0])+Math.abs(r*e[2]),Math.abs(o*e[1])+Math.abs(r*e[3]))};a.prototype._expandBoundingBoxCR=function(t,e,i,s,o,r){u(t,i*e[0]+s*e[2]+e[4],i*e[1]+s*e[3]+e[5],Math.sqrt(d(o*e[0])+d(r*e[2])),Math.sqrt(d(o*e[1])+d(r*e[3])))};a.prototype._expandBoundingBox=function(t,e){};a.prototype._expandBoundingBoxRecursive=function(t,e,i){if(this.isVisible(e)){var s=this._matrixWorld(i);this._expandBoundingBox(t,s);var o=this.children;for(var r=0,n=o.length;r<n;r++){o[r]._expandBoundingBoxRecursive(t,e,s)}}};function p(t,e){var i=t.width*.5;var s=t.height*.5;var o=t.x+i;var r=t.y+s;var n=o*e[0]+r*e[2]+e[4];var a=o*e[1]+r*e[3]+e[5];var h=Math.abs(i*e[0])+Math.abs(s*e[2]);var l=Math.abs(i*e[1])+Math.abs(s*e[3]);return{x:n-h,y:a-l,width:h*2,height:l*2}}a.prototype._getBBox=function(t,e){if(this.domRef){var i;if(!e&&this.domRef!==this.parent?.domRef){i=this.domRef.getBBox();if(t&&i){i=p(i,t)}return i}var s=Infinity,o=Infinity,r=-Infinity,n=-Infinity;for(var h=0,l=this.children.length;h<l;h++){var f=this.children[h];i=f._getBBox(t?a._multiplyMatrices(t,f.matrix):f.matrix);if(i){s=Math.min(s,i.x);o=Math.min(o,i.y);r=Math.max(r,i.x+i.width);n=Math.max(n,i.y+i.height)}}if(s<=r&&o<=n){return{x:s,y:o,width:r-s,height:n-o}}}return null};function c(t){return t.parent!==null&&t.constructor===a&&f(t.matrix)&&t.opacity===undefined&&(t.nodeContentType!==i.Hotspot||t._hasHostpotAncestor())&&(t.nodeContentType!==i.DynamicContent||t._hasDynamicContentAncestor())&&t.vMask===1}a.prototype._getSceneTreeElement=function(){var t=this;var e=t.parent;while(e){if(e.userData.closed||e.nodeContentType!==i.Regular){t=e}e=e.parent}while(t.userData.skipIt){t=t.parent}return t};function m(t,e,i){function s(t,e,i){var s,o;for(var r=0,n=t.length;r<n;r++){var a=t[r];var h=e*a.x+i*a.y;if(r===0||s>h){s=h}if(r===0||o<h){o=h}}return{min:s,max:o}}var o=[a._transformPoint(t.x,t.y,e),a._transformPoint(t.x+t.width,t.y,e),a._transformPoint(t.x+t.width,t.y+t.height,e),a._transformPoint(t.x,t.y+t.height,e)];var r=[{x:i.x1,y:i.y1},{x:i.x2,y:i.y1},{x:i.x2,y:i.y2},{x:i.x1,y:i.y2}];var n=o.concat(r);for(var h=0,l=n.length-1;h<n.length;l=h++){var f=n[l];var u=n[h];var d=u.y-f.y,p=f.x-u.x;var c=s(o,d,p);var m=s(r,d,p);if(c.max<m.min||m.max<c.min){return false}}return true}a.prototype._findRectElementsRecursive=function(t,e,i,s){if(this.isVisible(i)){var o=this._matrixWorld(s);if(this._isGeometryNode()){var r=this._getBBox();if(r&&m(r,o,e)){t.add(this._getSceneTreeElement())}}var n=this.children;for(var a=0,h=n.length;a<h;a++){n[a]._findRectElementsRecursive(t,e,i,o)}}};a.prototype.tagName=function(){return"g"};a.prototype._setBaseAttributes=function(t,e){t("id",this.uid);const i=this.filter;if(i!=null){t("filter",`url(#${i})`)}const s=this.opacity;if(s!=null){t("opacity",s)}if(!f(this.matrix)){t("transform","matrix("+this.matrix.join(",")+")")}if(!this.isVisible(e)){t("display","none")}if(!this._fillStyleId||!this.classList.has(this._fillStyleId)){this._setFillStyleAttributes(t)}if(!this._lineStyleId||!this.classList.has(this._lineStyleId)){this._setLineStyleAttributes(t)}if(this.classList.size){t("class",Array.from(this.classList).join(" "))}};a.prototype._setSpecificAttributes=function(t,e){};a.prototype._setFillStyleAttributes=function(t){if(this.fillURL!==undefined){t("fill",this.fillURL)}else if(this.fill!==undefined){t("fill",this._cssColor(this.fill))}};a.prototype._setLineStyleAttributes=function(t){if(this.stroke!==undefined&&this.stroke[3]>0&&this.strokeWidth){t("stroke",this._cssColor(this.stroke));if(this.strokeWidth!==1){t("stroke-width",this.strokeWidth)}if(this.strokeDashArray.length>0){t("stroke-dasharray",this.strokeDashArray.join(" "))}if(this.lineCap!=null){t("stroke-linecap",this.lineCap)}if(!this.coordinateSpace||this.coordinateSpace===n){t("vector-effect","non-scaling-stroke")}}};a.prototype.render=function(t,e,s){var o=c(this),r;if(!o){r=this.tagName();t.openStart(r);if(s&&this._isGeometryNode()){var n=s._getFillStyleId(this);if(this._fillStyleId!==n){if(this._fillStyleId){this.removeClass(this._fillStyleId)}this._fillStyleId=n;if(n){this.addClass(this._fillStyleId)}}var a=s._getLineStyleId(this);if(this._lineStyleId!==a){if(this._lineStyleId){this.removeClass(this._lineStyleId)}this._lineStyleId=a;if(a){this.addClass(this._lineStyleId)}}}var h=t.attr.bind(t);this._setBaseAttributes(h,e);this._setSpecificAttributes(h,null);t.openEnd();if(this._renderContent){this._renderContent(t)}}var l=[];this.children.forEach(function(o){if(o.nodeContentType===i.Hotspot||o.nodeContentType===i.DynamicContent){l.push(o)}else{o.render(t,e,s)}});l.forEach(function(i){i.render(t,e)});this.customText?.render(t,e);if(!o){t.close(r)}};a._svgNamespace="http://www.w3.org/2000/svg";a.prototype._createDomElement=function(t=0){var e=document.createElementNS(a._svgNamespace,this.tagName());var i=e.setAttribute.bind(e);this._setBaseAttributes(i,1<<t);this._setSpecificAttributes(i,e);if(this._createContent){this._createContent(e)}return e};function y(t,e){var i=t.domRef;if(i&&i!==e&&i.parentNode===e){return i}var s=t.children;for(var o=0,r=s.length;o<r;o++){i=y(s[o],e);if(i!==null){return i}}return null}a.prototype._replaceParentDomRef=function(t,e){for(var i=0,s=this.children.length;i<s;i++){var o=this.children[i];if(o.domRef){if(o.domRef===t){o.domRef=e;o._replaceParentDomRef(t,e)}else if(o.domRef.parentNode===t){if(t.parentNode===e){e.insertBefore(o.domRef,t)}else{e.appendChild(o.domRef)}}}}};a.prototype.invalidate=function(t){var e=this.domRef;if(e!==null){var i=this.parent&&this.parent.domRef;if(c(this)){if(e!==i){this.domRef=i;this._replaceParentDomRef(e,this.domRef);e.remove()}}else{this.domRef=this._createDomElement(t);if(e===i){i.insertBefore(this.domRef,y(this,i))}else if(i){i.replaceChild(this.domRef,e)}this._replaceParentDomRef(e,this.domRef)}}};a.prototype._setDomRef=function(t){this.domRef=t;var e=this.children;for(var i=0,s=e.length;i<s;i++){var o=e[i];var r=document.getElementById(o.uid);if(r===null&&c(o)){r=t}o._setDomRef(r)}if(this.customText){this.customText.domRef=document.getElementById(this.customText.uid);this._updateCustomText()}};a.prototype.getElementByProperty=function(t,e){if(this[t]===e){return this}for(const i of this.children){const s=i.getElementByProperty(t,e);if(s!==null){return s}}if(this.customText&&this.customText[t]===e){return this.customText}return null};a.prototype.getElementById=function(t){return this.getElementByProperty("uid",t)};a.prototype.copy=function(t,e){this.name=t.name;this.matrix=t.matrix.slice();this.nodeContentType=t.nodeContentType;this.materialId=t.materialId;this.lineStyle=t.lineStyle;this.fillStyle=t.fillStyle;this.classList=new Set(t.classList);if(t.opacity!==undefined){this.opacity=t.opacity}if(t.tintColor!==undefined){this.tintColor=t.tintColor}if(t.hotspotColor){this.hotspotColor=t.hotspotColor}if(t.customHotspotColor){this.customHotspotColor=t.customHotspotColor}if(t.fillURL!==undefined){this.fillURL=t.fillURL}if(t.fill!==undefined){this.fill=t.fill.slice()}if(t.stroke!==undefined){this.stroke=t.stroke.slice()}if(t.strokeWidth!==undefined){this.strokeWidth=t.strokeWidth}if(t.coordinateSpace){this.coordinateSpace=t.coordinateSpace}if(t.lineCap!==undefined){this.lineCap=t.lineCap}if(t.strokeDashArray!==undefined){this.strokeDashArray=t.strokeDashArray.slice()}if(t.userData.skipIt){this.userData.skipIt=true}if(t.pageIndex!=null){this.pageIndex=t.pageIndex}if(e||e===undefined){for(var i=0,s=t.children.length;i<s;i++){this.add(t.children[i].clone())}}return this};a.prototype.clone=function(){return(new this.constructor).copy(this)};function v(t,e,i){return t+(e-t)*i}function _(t,e,i,s){var o=(t<<24|e<<16|i<<8|s*255)>>>0;return"#"+o.toString(16).padStart(8,"0")}function C(t){return _(t[0]*255,t[1]*255,t[2]*255,t[3])}a.prototype._cssColor=function(e){var i=e[3];if(i===0){return"none"}var s=e[0]*255;var o=e[1]*255;var r=e[2]*255;var n=this.tintColor;if(n){n=t(n);var a=n.alpha;if(a>0){s=v(s,n.red,a);o=v(o,n.green,a);r=v(r,n.blue,a)}}var h=this.highlightColor;if(h){h=t(h);var l=h.alpha;if(l>0){s=v(s,h.red,l);o=v(o,h.green,l);r=v(r,h.blue,l);i=v(i,l,l)}}return _(s,o,r,i)};function x(t,e){function i(t,e){return Object.entries(t).every(function(t){return e[t[0]]===t[1]})&&Object.entries(e).every(function(e){return t[e[0]]===e[1]})}var s=e.findIndex(function(e){return i(e,t)});if(s<0){s=e.length;e.push(t)}return s}a.prototype._getParametricShape=function(t,e,i){var s={};if(!f(this.matrix)){var o=a._decompose(this.matrix);s.t=o.position;s.r=o.quaternion;s.s=o.scale}var r=this._hasHostpotAncestor();var n=parseFloat(this.strokeWidth);var h={width:typeof this.strokeWidth==="number"?this.strokeWidth+"px":this.strokeWidth,coordinateSpace:this.coordinateSpace};if(this.strokeDashArray&&this.strokeDashArray.length>0){h.dashes=a._convertToDashes(this.strokeDashArray,this.strokeWidth)}if(!r){if(this.fill!==undefined){s.fill=x({colour:C(this.fill)},t)}if(this.stroke!==undefined&&this.stroke[3]>0&&n>0){h.colour=C(this.stroke);s.stroke=x(h,e)}}else if(this.stroke!==undefined&&this.stroke[3]>0&&n>0&&(n!==1||this.strokeDashArray.length>0)){s.stroke=x(h,e)}return s};a.prototype.getParametricContent=function(t,e,i){var s=[];this.children.forEach(function(o){var r=o._getParametricShape(t,e,i);if(r.type!==undefined){s.push(r)}});if(s.length===0){return null}return s.length===1?s[0]:{shapes:s}};a.prototype._hasHostpotAncestor=function(){var t=this.parent;while(t){if(t.nodeContentType===i.Hotspot){return true}t=t.parent}return false};a.prototype._hasDynamicContentAncestor=function(){var t=this.parent;while(t){if(t.nodeContentType===i.DynamicContent){return true}t=t.parent}return false};a.prototype.addClass=function(t){this.classList.add(t);if(this.domRef){this.domRef.setAttribute("class",Array.from(this.classList).join(" "))}return this};a.prototype.removeClass=function(t){this.classList.delete(t);if(this.domRef){if(this.classList.size){this.domRef.setAttribute("class",Array.from(this.classList).join(" "))}else{this.domRef.removeAttribute("class")}}return this};a.prototype.hasClass=function(t){return this.classList.has(t)};a.prototype.toggleClass=function(t){if(this.hasClass(t)){this.removeClass(t)}else{this.addClass(t)}return this};a.prototype.getPageIndex=function(){return this.pageIndex};a.prototype.setPageIndex=function(t){this.pageIndex=t};return a});
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/svg/Ellipse", ["./Element"],function(t){"use strict";var i=function(i){i=i||{};t.call(this,i);this.type="Ellipse";this.cx=i.cx||0;this.cy=i.cy||0;this.rx=i.major||i.radius||0;this.ry=i.minor||i.radius||0;this.setMaterial(i.material)};i.prototype=Object.assign(Object.create(t.prototype),{constructor:i});i.prototype.tagName=function(){return"ellipse"};i.prototype._expandBoundingBox=function(t,i){var r=isNaN(this.strokeWidth)?0:this.strokeWidth*.5;this._expandBoundingBoxCR(t,i,this.cx,this.cy,this.rx+r,this.ry+r)};i.prototype._setSpecificAttributes=function(t){if(this.cx){t("cx",this.cx)}if(this.cy){t("cy",this.cy)}t("rx",this.rx);t("ry",this.ry)};i.prototype._getParametricShape=function(i,r,s){var e=t.prototype._getParametricShape.call(this,i,r,s);if(this.rx===this.ry){e.type="circle";e.radius=this.rx}else{e.type="ellipse";e.major=this.rx;e.minor=this.ry}if(this.cx||this.cy){e.cx=this.cx;e.cy=this.cy}return e};i.prototype.copy=function(i,r){t.prototype.copy.call(this,i,r);this.cx=i.cx;this.cy=i.cy;this.rx=i.rx;this.ry=i.ry;return this};return i});
/*!
* SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
*/
sap.ui.predefine("sap/ui/vk/svg/HotspotHelper", ["../NodeContentType","./Element","./Rectangle","./Path","sap/base/assert","sap/base/Log","sap/base/util/uid","../TransformationMatrix","../thirdparty/imagetracer","../uuidv4"],function(t,e,r,a,i,n,o,s,l,d){"use strict";var u=function(){};u.prototype.duplicateHotspot=function(t,r,a,i){t=Array.isArray(t)?t:[t];var n;if(a){n=e._multiplyMatrices(e._invertMatrix(t[0]._matrixWorld()),a)}else if(i){var o=i._camera._transformRect({x1:0,y1:0,x2:30,y2:30});n=[1,0,0,1,o.x2-o.x1,o.y2-o.y1]}var s=e._invertMatrix(r._matrixWorld());var l=[];t.forEach(function(t){var a=t.clone();a.userData.duplicatedFrom=t.sid;var i=e._multiplyMatrices(n,t._matrixWorld());var o=e._multiplyMatrices(s,i);a.matrix.set(o);r.add(a);l.push(a)});return l};u.prototype.updateHotspot=function(a){const i=e._invertMatrix(a._matrixWorld());function o(o){o.traverse(function(o){if(o.nodeContentType===t.Hotspot||o.parent===a){return}let s;if(o.type==="Image"){s=new r({x:o.x,y:o.y,width:o.width,height:o.height})}else if(o.type!=="Group"){s=(new o.constructor).copy(o,false)}else{n.warning(`Unsupported child node type "${o.type}" is tried to be embedded in hotspot node "${a.name}"`)}if(s!=null){s.matrix=e._multiplyMatrices(i,o._matrixWorld());s.userData.sourceJointNode=o;a.add(s)}})}for(let t=a.children.length-1;t>=0;--t){const e=a.children[t];if(e.userData.sourceJointNode!==undefined){a.remove(e)}}const s=a.userData.jointNodes;if(s!=null){for(const e of s){if(e.nodeContentType!==t.Hotspot&&e.parent!==a){o(e)}}}a._initAsHotspot()};u.prototype.mergeHotspots=function(r,a){var i=r.getDefaultNodeHierarchy();var n=a[0];var l=n.getPageIndex();var d=i.createNode(null,n.name,null,t.Hotspot,{sid:o()});if(l!=null){d.setPageIndex(l)}var u=[],h=[];var c=e._invertMatrix(d._matrixWorld());var p=function(t,e){return e._vkGetNodeContentType()===t};a.forEach(function(r){if(r.children.every(p.bind(null,t.Hotspot))){var a=r.children.length;while(a--){var i=r.children[0];var n=e._multiplyMatrices(c,i._matrixWorld());r.remove(i);d.add(i);i.matrix=n;u.push(i)}h.push(r)}else if(r.children.every(p.bind(null,t.Regular))){r.parent.remove(r);d.add(r);r.matrix=e._multiplyMatrices(c,r._matrixWorld());u.push(r)}});if(u){d.userData.jointNodes=Array.from(u)}if(n.hotspotColor!=null){d.setHotspotColor(n.vMask,n.hotspotColor)}if(n.customHotspotColor!=null){d.setCustomHotspotColor(n.vMask,n.customHotspotColor)}i.removeNode(h);var f=[],m=[],v=[],g=[],y=[];var x={name:d.name,contentType:t.Hotspot,joints:[],children:[]};if(l!=null){x.pageIndex=l}d.userData.jointNodes.forEach(function(e,r){var a=e.getParametricContent(v,g,y);m.push(a);const i={name:e.name,transform:s.convert3x2To4x3(e.matrix),parametric:r,contentType:t.Hotspot};if(l!=null){i.pageIndex=l}f.push(i);x.joints.push({child:r,type:"LINK",action:"bubble"});x.children.push(r)});f.push(x);a.forEach(function(t){f.push({suppressed:true,sid:t.sid})});var w=r.getViewStateManager().getCurrentView();return{nodeRef:d,request:{views:[{id:w?.getViewId(),name:w?.getName(),nodes:f}],parametrics:m,fillstyles:v,linestyles:g,textStyles:y}}};u.prototype.mergeElements=function(r,a){i(a.length&&"HotspotHelper.mergeElements: at least one node must be provided");var n=r.createNode(null,a[0].name,null,t.Regular,{sid:o()});var s=e._invertMatrix(n._matrixWorld());var l={name:n.name,contentType:"geometry",parametric:0};var d=[l],u=[],h=[],c=[],p=[];var f=new Set;a.forEach(function(t){t.traverse(function(t){if(t._isGeometryNode()){f.add(t)}})});a.forEach(function(t){d.push({suppressed:true,sid:t.sid})});f.forEach(function(t){var r=t._matrixWorld();t.parent.remove(t);n.add(t);t.setMatrix(e._multiplyMatrices(s,r));t.userData.skipIt=true;var a=t._getParametricShape(h,c,p);if(a.type!==undefined){u.push(a)}});a.forEach(function(t){if(!f.has(t)){t.parent.remove(t)}});var m={nodes:d,parametrics:[{shapes:u}]};if(h.length>0){m.fillStyles=h}if(c.length>0){m.lineStyles=c}if(p.length>0){m.textStyles=p}return{nodeRef:n,request:m}};u.prototype.createHotspotFromGeometry=function(r,i,n){return new Promise(function(o,s){r=Array.isArray(r)?r:[r];var d=[];r.forEach(function(t){t.traverseVisible(function(t){if(t._isGeometryNode()){d.push(t)}},-1>>>0)});if(d.length===1){switch(d[0].type){case"Rectangle":case"Ellipse":case"Line":var u=i.createNode(n,r[0].name,null,t.Hotspot);u.setMatrix(e._multiplyMatrices(e._invertMatrix(u.parent._matrixWorld()),d[0]._matrixWorld()));var h=d[0].clone();h.setMatrix([1,0,0,1,0,0]);u.add(h);o(u);return;default:break}}var c;var p=document.createElementNS("http://www.w3.org/2000/svg","svg");d.forEach(function(t){var e=t._getBBox(t._matrixWorld());if(!c){c=e}else{c.width=Math.max(c.x+c.width,e.x+e.width);c.height=Math.max(c.y+c.height,e.y+e.height);c.x=Math.min(c.x,e.x);c.y=Math.min(c.y,e.y);c.width-=c.x;c.height-=c.y}var r=t.domRef.cloneNode(true);if(r.getAttribute("fill")){r.setAttribute("fill","#000")}if(r.getAttribute("stroke")){r.setAttribute("stroke","#000")}r.setAttribute("transform","matrix("+t._matrixWorld().join(",")+")");p.appendChild(r)});var f=c.width*.05;var m=c.height*.05;c.x-=f;c.y-=m;c.width+=f*2;c.height+=m*2;p.setAttribute("width",Math.ceil(1e3*c.width/Math.max(c.width,c.height)));p.setAttribute("height",Math.ceil(1e3*c.height/Math.max(c.width,c.height)));p.setAttribute("viewBox",[c.x,c.y,c.width,c.height].join(" "));p.setAttribute("font-family",'"72","72full",Arial,Helvetica,sans-serif');var v=new Image;v.onload=function(){var d=document.createElement("canvas");var u=d.width=this.width;var h=d.height=this.height;var p=d.getContext("2d");var f=i.createNode(n,r[0].name,null,t.Hotspot);var m=f.parent._matrixWorld();var v=m[3]<0;if(v){f.setMatrix(e._multiplyMatrices(e._invertMatrix(m),[c.width/u,0,0,-c.height/h,c.x,c.y+c.height]));p.transform(1,0,0,-1,0,h)}else{f.setMatrix(e._multiplyMatrices(e._invertMatrix(m),[c.width/u,0,0,c.height/h,c.x,c.y]))}p.drawImage(this,0,0,u,h);var g=p.getImageData(0,0,u,h);function y(t,e){return t+e*u<<2}var x=p.createImageData(u,h);var w,_;var M,b;function C(t,e){return t>=0&&t<u&&e>=0&&e<h?M[y(t,e)+3]:0}for(var N=0;N<2;N++){M=g.data;b=x.data;for(_=1;_<h;_++){for(w=1;w<u;w++){if(C(w,_)>127||C(w-1,_)>127||C(w+1,_)>127||C(w,_-1)>127||C(w,_+1)>127){b[y(w,_)+3]=255}}}var H=g;g=x;x=H}var A=g.data;function T(t,e){var r=y(t,e);return A[r+3]<128&&A[r]!==1}var E=[0,0];while(E.length>0){_=E.pop();w=E.pop();A[y(w,_)]=1;if(w+1<u&&T(w+1,_)){E.push(w+1,_)}if(w>0&&T(w-1,_)){E.push(w-1,_)}if(_+1<h&&T(w,_+1)){E.push(w,_+1)}if(_>0&&T(w,_-1)){E.push(w,_-1)}}for(_=0;_<h;_++){for(w=0;w<u;w++){if(T(w,_)){A[y(w,_)+3]=255}}}var I=l.imagedataToSVG(g,{ltres:2,qtres:2,pathomit:8,rightangleenhance:false,colorsampling:0,numberofcolors:2,mincolorratio:0,colorquantcycles:1,blurradius:0,blurdelta:20,strokewidth:0,linefilter:true,roundcoords:0,pal:[{r:0,g:0,b:0,a:0},{r:0,g:0,b:0,a:255}],desc:false});var D=[];var S=(new DOMParser).parseFromString(I,"image/svg+xml");if(S&&S.firstChild&&S.firstChild.tagName==="svg"){for(var W=S.firstChild.firstChild;W!==null;W=W.nextSibling){if(W.tagName==="path"&&W.getAttribute("opacity")>.5){D=D.concat(a._extractSegmentsFromDomRef(W))}}}if(D.length>0){f.add(new a({segments:D}));o(f)}else{f.parent.remove(f);s()}};v.src="data:image/svg+xml;base64,"+btoa((new XMLSerializer).serializeToString(p))})};u.prototype.createRequest=function(e,r){if(!e||!r){return null}var a=[];var i=[];var n=[];var o=[];var l=[];var u=r&&r._currentView;function h(e,r){r.setNodePersistentId(e,d());var u={name:e.name,transform:s.convert3x2To4x3(e.matrix),veId:e.sid};const c=e.getPageIndex();if(c!=null){u.pageIndex=c}if(e.nodeContentType===t.Hotspot){u.contentType="HOTSPOT"}if(e.nodeContentType===t.DynamicContent){u.contentType="DYNAMICCONTENT"}if(e.userData.duplicatedFrom){u.duplicatedFrom=e.userData.duplicatedFrom;delete e.userData.duplicatedFrom}var p=e.getParametricContent(n,o,l);if(p){u.parametric=i.length;i.push(p)}var f=a.length;a.push(u);var m=e.children;if(m.length>0){var v=[];for(var g=0;g<m.length;g++){if(m[g].type==="Group"){v.push(h(m[g],r))}}if(v.length>0){u.children=v}}return f}var c=r.getScene();(Array.isArray(e)?e:[e]).forEach(function(t){h(t,c)});var p={views:[{id:u&&u.getViewId(),nodes:a}],parametrics:i};if(n.length>0){p.fillstyles=n}if(o.length>0){p.linestyles=o}if(l.length>0){p.textStyles=l}return p};return u});
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/svg/Image", ["./Element"],function(t){"use strict";var i=function(i){i=i||{};t.call(this,i);this.type="Image";this.x=i.x||0;this.y=i.y||0;this.width=i.width||0;this.height=i.height||0;this.data=i.data||null;this.setMaterial(i.material)};i.prototype=Object.assign(Object.create(t.prototype),{constructor:i});i.prototype.tagName=function(){return"image"};i.prototype.setMaterial=function(t,i){if(t&&this.materialId===t.materialId){var h=t.textureWidth;var e=t.textureHeight;if(h&&e){this.width=h;this.height=e}if(t.texture){this.data=t.texture}if(i){this.invalidate()}}};i.prototype._setSpecificAttributes=function(t,i){if(this.x){t("x",this.x)}if(this.y){t("y",this.y)}if(this.width>0&&this.height>0&&this.data){t("width",this.width);t("height",this.height);if(i){i.setAttribute("href",this.data)}else{t("href",this.data)}}};i.prototype._expandBoundingBox=function(t,i){var h=this.width*.5;var e=this.height*.5;this._expandBoundingBoxCE(t,i,this.x+h,this.y+e,h,e)};i.prototype._getParametricShape=function(i,h,e){var a=t.prototype._getParametricShape.call(this,i,h,e);a.type="rectangle";a.width=this.width;a.length=this.height;return a};i.prototype.copy=function(i,h){t.prototype.copy.call(this,i,h);this.x=i.x;this.y=i.y;this.width=i.width;this.height=i.height;this.data=i.data;return this};return i});
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/svg/Line", ["./Element"],function(t){"use strict";var i=function(i){i=i||{};t.call(this,i);this.type="Line";this.x1=i.x1||0;this.y1=i.y1||0;this.x2=i.x2||0;this.y2=i.y2||0;this.setMaterial(i.material)};i.prototype=Object.assign(Object.create(t.prototype),{constructor:i});i.prototype.tagName=function(){return"line"};i.prototype.setFillStyle=function(t,i){};i.prototype._expandBoundingBox=function(t,i){var e=isNaN(this.strokeWidth)?0:this.strokeWidth*.5;this._expandBoundingBoxCE(t,i,this.x1,this.y1,e,e);this._expandBoundingBoxCE(t,i,this.x2,this.y2,e,e)};i.prototype._setSpecificAttributes=function(t){t("x1",this.x1);t("y1",this.y1);t("x2",this.x2);t("y2",this.y2)};i.prototype._getParametricShape=function(i,e,s){var o=t.prototype._getParametricShape.call(this,i,e,s);o.type="line";o.x1=this.x1;o.y1=this.y1;o.x2=this.x2;o.y2=this.y2;return o};i.prototype.copy=function(i,e){t.prototype.copy.call(this,i,e);this.x1=i.x1;this.y1=i.y1;this.x2=i.x2;this.y2=i.y2;return this};return i});
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/svg/LinearGradient", ["../TransformationMatrix","./Element"],function(t,i){"use strict";var n=function(n){n=n||{};i.call(this,n);this.type="LinearGradient";this.x1=n.x1;this.y1=n.y1;this.x2=n.x2;this.y2=n.y2;this.gradient=n.gradient||[];this.gradientTransform=n.gradientTransform?i._multiplyMatrices([-1,0,0,-1,0,0],t.convert4x3To3x2(n.gradientTransform)):n.gradientTransform;this.gradientUnits="objectBoundingBox";this.transformOrigin="0.5 0.5"};n.prototype=Object.assign(Object.create(i.prototype),{constructor:n});n.prototype.tagName=function(){return"linearGradient"};n.prototype._setBaseAttributes=function(t,i){t("id",this.uid)};n.prototype._setSpecificAttributes=function(t){if(this.x1!==undefined){t("x1",this.x1)}if(this.y1!==undefined){t("y1",this.y1)}if(this.x2!==undefined){t("x2",this.x2)}if(this.y2!==undefined){t("y2",this.y2)}if(this.gradientTransform!==undefined){t("gradientTransform","matrix("+this.gradientTransform.join(",")+")");t("transform-origin",this.transformOrigin)}if(this.gradientUnits!==undefined){t("gradientUnits",this.gradientUnits)}};n.prototype._renderContent=function(t){var i=this.gradient;for(var n=0,r=i.length;n<r;n+=2){t.openStart("stop");t.attr("offset",i[n]);t.attr("stop-color",i[n+1]);t.openEnd();t.close("stop")}};n.prototype._createContent=function(t){var n=this.gradient;for(var r=0,e=n.length;r<e;r+=2){var s=document.createElementNS(i._svgNamespace,"stop");s.setAttribute("offset",n[r]);s.setAttribute("stop-color",n[r+1]);t.append(s)}};n.prototype.copy=function(t,n){i.prototype.copy.call(this,t,n);this.x1=t.x1;this.y1=t.y1;this.x2=t.x2;this.y2=t.y2;this.gradient=t.gradient.slice();if(this.gradientUnits!==undefined){this.gradientUnits=t.gradientUnits}if(t.gradientTransform!==undefined){this.gradientTransform=t.gradientTransform.slice();this.transformOrigin=t.transformOrigin.slice()}return this};return n});
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/svg/MiniMap", ["sap/ui/core/Control","sap/ui/core/Element"],function(t,e){"use strict";const i=t.extend("sap.ui.vk.svg.MiniMap",{metadata:{library:"sap.ui.vk",properties:{maxWidth:{type:"int",defaultValue:"320"},maxHeight:{type:"int",defaultValue:"320"}},associations:{viewport:{type:"sap.ui.vk.svg.Viewport",multiple:false},viewStateManager:{type:"sap.ui.vk.ViewStateManagerBase",multiple:false}},events:{sizeChanged:{parameters:{width:{type:"int"},height:{type:"int"}}}}},renderer:{apiVersion:2,render:function(t,e){t.openStart("div",e);t.class("sapUiVkMiniMapView");t.openEnd();t.close("div")}}});i.prototype.init=function(){t.prototype.init.call(this);this._sceneBBox=null;this._width=this._height=0;this._lockPosition={x:-16,y:16};this._canvas=document.createElement("canvas");this._canvas.classList.add("sapUiVkMiniMapViewCanvas");this._rect=document.createElement("div");this._rect.classList.add("sapUiVkMiniMapViewAreaRect");this.attachBrowserEvent(sap.ui.Device.browser.firefox?"DOMMouseScroll":"mousewheel",this._onMouseWheel,this)};i.prototype.exit=function(){this.setViewport(null);this.setViewStateManager(null)};i.prototype.setViewport=function(t){const i=e.getElementById(this.getViewport());i?.detachResize(this._updateRectPosition,this);i?.detachCameraChanged(this._updateRectPosition,this);this.setAssociation("viewport",t);t?.attachCameraChanged(this._updateRectPosition,this);t?.attachResize(this._updateRectPosition,this)};i.prototype.setViewStateManager=function(t){const i=e.getElementById(this.getViewStateManager());i?.detachVisibilityChanged(this._onContentUpdate,this);i?.detachTintColorChanged(this._onContentUpdate,this);this.setAssociation("viewStateManager",t);t?.attachVisibilityChanged(this._onContentUpdate,this);t?.attachTintColorChanged(this._onContentUpdate,this)};i.prototype._updateRectPosition=function(){const t=e.getElementById(this.getViewport());const i=this._sceneBBox;if(!t||!i){return}const n=t._getViewBox();const o=this._width/i[2];const s=this._height/i[3];const a=(n[0]-i[0])*o;const h=(n[1]-i[1])*s;this._rect.style.left=a+"px";this._rect.style.top=h+"px";this._rect.style.width=n[2]*o+"px";this._rect.style.height=n[3]*s+"px"};i.prototype._onMouseWheel=function(t){const i=e.getElementById(this.getViewport());if(!i){return}const n=this.getDomRef().getBoundingClientRect();const o=t.pageX-n.x;const s=t.pageY-n.y;if(o<0||o>=this._width||s<0||s>=this._height){return}let a=t.originalEvent.detail?t.originalEvent.detail*-40:t.originalEvent.wheelDelta;if(!t.originalEvent.touches){a=Math.min(Math.max(a,-20),20)}i.beginGesture(i._width*.5,i._height*.5);i.zoom(Math.pow(2,a/960));i.endGesture();t.setMarked();t.preventDefault()};i.prototype.ontouchstart=function(t){const i=e.getElementById(this.getViewport());const n=this._sceneBBox;const o=this.getParent()?.getDomRef();if(!i||!n||!o){return}if(t.button===2){const e=i.getDomRef()?.getBoundingClientRect();const n=o.getBoundingClientRect();if(!e||!n){return}const s={x:t.pageX,y:t.pageY,elementX:parseInt(o.style.left,10)||0,elementY:parseInt(o.style.top,10)||0};let a;const h=t=>{if(t.buttons!==2){a();return}let i=s.elementX+t.pageX-s.x;let h=s.elementY+t.pageY-s.y;i=Math.min(Math.max(i,e.x),e.x+e.width-n.width-1);h=Math.min(Math.max(h,e.y),e.y+e.height-n.height-1);o.style.left=i+"px";o.style.top=h+"px";const r=i-e.x;const c=h-e.y;const p=e.x+e.width-(i+n.width);const l=e.y+e.height-(h+n.height);this._lockPosition.x=r<p?r:-p;this._lockPosition.y=c<l?c:-l;t.setMarked();t.preventDefault()};const r=jQuery(document);a=t=>{r.off("mousemove",h);r.off("mouseup",a);o.style.cursor=null};r.on("mousemove",h);r.on("mouseup",a);o.style.cursor="grab";return}const s=t=>{const e=this.getDomRef().getBoundingClientRect();const o=i._getViewBox();const s=t.pageX-e.x;const a=t.pageY-e.y;const h=o[0]+o[2]*.5-n[0]-s*n[2]/this._width;const r=o[1]+o[3]*.5-n[1]-a*n[3]/this._height;if(h!==0||r!==0){const t=i.getCamera();i.pan(h*t.zoom,r*t.zoom)}t.setMarked();t.preventDefault()};i.beginGesture(i._width*.5,i._height*.5);s(t);const a=jQuery(document);const h=t=>{a.off("mousemove",s);a.off("mouseup",h);o.style.cursor=null;i.endGesture()};a.on("mousemove",s);a.on("mouseup",h);o.style.cursor="crosshair"};i.prototype.oncontextmenu=function(t){t.preventDefault();t.stopPropagation()};i.prototype._onContentUpdate=function(){const t=e.getElementById(this.getViewport());const i=t?._svgElement;const n=this.getDomRef();if(!i||!n){return}const o=i.getBBox();let s=this._sceneBBox;if(!s||!s[2]||!s[3]){s=this._sceneBBox=[o.x,o.y,o.width,o.height]}else{s[2]=Math.max(s[0]+s[2],o.x+o.width);s[3]=Math.max(s[1]+s[3],o.y+o.height);s[0]=Math.min(s[0],o.x);s[1]=Math.min(s[1],o.y);s[2]-=s[0];s[3]-=s[1]}const a=s[2]>0&&s[3]>0?s[2]/s[3]:1;const h=this.getMaxWidth();const r=this.getMaxHeight();const c=this._width=Math.min(h,Math.round(h*a));const p=this._height=Math.min(r,Math.round(r/a));n.style.width=c+"px";n.style.height=p+"px";this.fireSizeChanged({width:c,height:p});this._updateRectPosition();const l=i.getAttribute("width");const d=i.getAttribute("height");const g=i.getAttribute("viewBox");i.setAttribute("width",c+"px");i.setAttribute("height",p+"px");i.setAttribute("viewBox",s.join(" "));const u=(new XMLSerializer).serializeToString(i);const m="data:image/svg+xml; charset=utf8, "+encodeURIComponent(u);i.setAttribute("width",l);i.setAttribute("height",d);i.setAttribute("viewBox",g);const f=this._canvas;const w=window.devicePixelRatio||1;f.width=c*w;f.height=p*w;const y=new Image;y.src=m;y.onload=function(){const e=f.getContext("2d");const i=e.createLinearGradient(0,0,0,f.height);i.addColorStop(0,t.getBackgroundColorTop());i.addColorStop(1,t.getBackgroundColorBottom());e.fillStyle=i;e.fillRect(0,0,f.width,f.height);e.drawImage(y,0,0,f.width,f.height)}};i.prototype.onAfterRendering=function(){const t=this.getDomRef();t.appendChild(this._canvas);t.appendChild(this._rect);this._onContentUpdate()};return i});
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/svg/NodeHierarchy", ["../NodeHierarchy","sap/ui/base/ObjectPool","./Element","./BaseNodeProxy","./NodeProxy","../Messages","../getResourceBundle","../NodeContentType","sap/base/util/uid","sap/base/assert","sap/base/Log"],function(e,t,n,o,r,i,a,s,d,c,u){"use strict";var h={equals:function(e,t){return e===t},contains:function(e,t){return e.indexOf(t)!==-1},startsWith:function(e,t){return e.indexOf(t)===0}};var f=e.extend("sap.ui.vk.svg.NodeHierarchy",{metadata:{library:"sap.ui.vk"},_baseNodeProxyPool:new t(o),constructor:function(t){e.call(this);this._scene=t;this._nodeProxies=[]}});f.prototype.destroy=function(){this._nodeProxies.slice().forEach(this.destroyNodeProxy,this);this._scene=null;e.prototype.destroy.call(this)};f.prototype.getScene=function(){return this._scene};f.prototype.getSceneRef=function(){return this._scene.getRootElement()};f.prototype.enumerateChildren=function(e,t,n,o){if(typeof e==="function"){o=n;n=t;t=e;e=undefined}var r=this.getChildren(e,n);if(o){r.forEach(t)}else{var i=this._baseNodeProxyPool.borrowObject();try{r.forEach(function(e){i.init(this,e);t(i);i.reset()}.bind(this))}finally{this._baseNodeProxyPool.returnObject(i)}}return this};f.prototype.enumerateAncestors=function(e,t,n){var o=this.getAncestors(e);if(n){o.forEach(t)}else{var r=this._baseNodeProxyPool.borrowObject();try{o.forEach(function(e){r.init(this,e);t(r);r.reset()}.bind(this))}finally{this._baseNodeProxyPool.returnObject(r)}}return this};f.prototype.createNodeProxy=function(e){var t=new r(this,e);this._nodeProxies.push(t);return t};f.prototype.destroyNodeProxy=function(e){var t=this._nodeProxies.indexOf(e);if(t>=0){this._nodeProxies.splice(t,1)[0].destroy()}return this};f.prototype.getChildren=function(e,t){if(typeof e==="boolean"){t=e;e=undefined}e=e||this._scene.getRootElement();return t||!e.closed?e.children:[]};f.prototype.getAncestors=function(e){var t=[];e.traverseAncestors(function(e){t.unshift(e)});if(t.length>0&&t[0]===this._scene.getRootElement()){t.shift()}return t};f.prototype.findNodesByName=function(e){var t=[];if(e===undefined||e===null||e===""||jQuery.isEmptyObject(e)){this._scene.getRootElement().children.forEach(function(e){e.traverse(function(e){t.push(e)})})}else{var n=h[e.predicate||"equals"];if(n===undefined){u.error(a().getText(i.VIT8.summary),i.VIT8.code,"sap.ui.vk.svg.NodeHierarchy")}else if(!Array.isArray(e.value)&&typeof e.value!=="string"){u.error(a().getText(i.VIT6.summary),i.VIT6.code,"sap.ui.vk.svg.NodeHierarchy")}else{var o=Array.isArray(e.value)?e.value:[e.value];if(!e.caseSensitive){for(var r in o){o[r]=o[r].toLowerCase()}}this._scene.getRootElement().children.forEach(function(r){r.traverse(function(r){var i=r.name||"";if(!e.caseSensitive){i=i.toLowerCase()}for(var a in o){if(n(i,o[a])){t.push(r);break}}})})}}return t};f.prototype.createLayerProxy=function(e){return null};f.prototype.destroyLayerProxy=function(e){return this};f.prototype.getLayers=function(){return[]};f.prototype.getHotspotNodeRefs=function(){var e=[];this._scene.getRootElement().traverse(function(t){if(t._vkGetNodeContentType()===s.Hotspot){e.push(t)}});return e};f.prototype.getDynamicContentNodeRefs=function(){var e=[];this._scene.getRootElement().traverse(function(t){if(t._vkGetNodeContentType()===s.DynamicContent){e.push(t)}});return e};f.prototype.attachChanged=function(e,t,n){return this.attachEvent("changed",e,t,n)};f.prototype.detachChanged=function(e,t,n){return this.detachEvent("changed",e,t,n)};f.prototype.fireChanged=function(e,t,n){return this.fireEvent("changed",e,t,n)};f.prototype.attachNodeCreated=function(e,t,n){return this.attachEvent("nodeCreated",e,t,n)};f.prototype.detachNodeCreated=function(e,t,n){return this.detachEvent("nodeCreated",e,t,n)};f.prototype.fireNodeCreated=function(e,t,n){return this.fireEvent("nodeCreated",e,t,n)};f.prototype.attachNodeRemoving=function(e,t,n){return this.attachEvent("nodeRemoving",e,t,n)};f.prototype.detachNodeRemoving=function(e,t,n){return this.detachEvent("nodeRemoving",e,t,n)};f.prototype.fireNodeRemoving=function(e,t,n){return this.fireEvent("nodeRemoving",e,t,n)};f.prototype.attachNodeReplaced=function(e,t,n){return this.attachEvent("nodeReplaced",e,t,n)};f.prototype.detachNodeReplaced=function(e,t,n){return this.detachEvent("nodeReplaced",e,t,n)};f.prototype.fireNodeReplaced=function(e,t,n){return this.fireEvent("nodeReplaced",e,t,n)};f.prototype.attachNodeUpdated=function(e,t,n){return this.attachEvent("nodeUpdated",e,t,n)};f.prototype.detachNodeUpdated=function(e,t,n){return this.detachEvent("nodeUpdated",e,t,n)};f.prototype.fireNodeUpdated=function(e,t,n){return this.fireEvent("nodeUpdated",e,t,n)};f.prototype.createNode=function(e,t,o,r,i){var u=this.getScene().getSceneBuilder();var h=null;if(u){i=i||{};i.name=i.name||t;i.sid=i.sid||d();h=u.createNode(i);if(!e){e=h.parent}}else{if(!e){e=this._scene.getRootElement()}h=new n;h.name=t;e.add(h)}var f=e.children.indexOf(o);c(e.children[e.children.length-1]===h,a().getText("NODEHIERARCHY_MSG_CREATENODEFAILED"));if(f>=0){e.children.splice(f,0,e.children.pop())}if(r){h._vkSetNodeContentType(r)}else{h._vkSetNodeContentType(s.Regular)}if(i&&u){switch(h._vkGetNodeContentType()){case s.Annotation:i.node=h;i.nodeId=h._vkPersistentId();u.createAnnotation(i);break;default:}}this.fireNodeCreated({nodeRef:h,nodeId:h});this.fireChanged();return h};f.prototype.getNodeContentType=function(e){if(e==null){return s.Regular}var t=e._vkGetNodeContentType();if(!t){t=s.Regular}return t};f.prototype.createNodeCopy=function(e,t,n,o){if(!t){t=this._scene.getRootElement()}var r=t.children.indexOf(o);var i=e.clone(true);i.name=n;t.add(i);c(t.children[t.children.length-1]===i,a().getText("NODEHIERARCHY_MSG_CREATENODEFAILED"));if(r>=0){t.children.splice(r,0,t.children.pop())}this.fireNodeCreated({nodeRef:i,nodeId:i});this.fireChanged();return i};f.prototype.removeNode=function(e){var t=[].concat(e);t.forEach(function(e){if(e&&e.parent){this.fireNodeRemoving({nodeRef:e,nodeId:e});e.parent.remove(e)}}.bind(this));var n=this.getScene().getSceneBuilder();if(n){t.forEach(n.removeNode,n)}this.fireChanged();return this};return f});
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/svg/NodeProxy", ["../NodeProxy","../cssColorToColor","../colorToCSSColor","../abgrToColor","../colorToABGR","../TransformationMatrix","./Element"],function(t,e,r,o,n,i,s){"use strict";var p=t.extend("sap.ui.vk.svg.NodeProxy",{metadata:{library:"sap.ui.vk"},constructor:function(e,r){t.call(this);this._element=r;this._nodeHierarchy=e}});p.prototype.destroy=function(){this._element=null;t.prototype.destroy.call(this)};p.prototype.getNodeHierarchy=function(){return this._nodeHierarchy};p.prototype.getNodeRef=function(){return this._element};p.prototype.getNodeId=function(){return this._element};p.prototype.getVeIds=function(){return this._element.userData.veids||[]};p.prototype.getVeId=function(){return this._element.sid};p.prototype.getName=function(){return this._element.name||"<"+this._element.type+">"};p.prototype.getLocalMatrix=function(){return i.convert3x2To4x3(this._element.matrix)};p.prototype.setLocalMatrix=function(t){if(t){this._element.matrix=i.convert4x3To3x2(t)}this.setProperty("localMatrix",t,true);return this};p.prototype.getWorldMatrix=function(){return i.convert3x2To4x3(this._element._matrixWorld())};p.prototype.setWorldMatrix=function(t){if(t){var e=i.convert4x3To3x2(t);var r=this._element;if(r.parent){r.matrix=s._multiplyMatrices(s._invertMatrix(r.parent._matrixWorld()),e)}else{r.matrix=e}}this.setProperty("worldMatrix",t,true);return this};p.prototype.getOpacity=function(){return this._element.opacity};p.prototype.setOpacity=function(t){this.setProperty("opacity",t,true);return this};p.prototype.getTintColorABGR=function(){return this._element.tintColor};p.prototype.setTintColorABGR=function(t){this.setProperty("tintColorABGR",t,true);this.setProperty("tintColor",r(o(t)),true);return this};p.prototype.getTintColor=function(){return r(o(this._element.tintColor))};p.prototype.setTintColor=function(t){var r=n(e(t));this.setProperty("tintColorABGR",r,true);this.setProperty("tintColor",t,true);return this};p.prototype.getNodeMetadata=function(){return this._element.userData.metadata||{}};p.prototype.getHasChildren=function(){return this._element.children.length>0};p.prototype.getClosed=function(){return!!this._element.closed};return p});
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/svg/OrthographicCamera", ["../OrthographicCamera"],function(t){"use strict";var i=t.extend("sap.ui.vk.svg.OrthographicCamera",{metadata:{library:"sap.ui.vk"}});var o=t.getMetadata().getParent().getClass().prototype;i.prototype.init=function(){if(o.init){o.init.call(this)}this.zoom=1;this.offsetX=0;this.offsetY=0;this._width=0;this._height=0;this.zoomedObject=null};i._MIN_ZOOM=1e-15;i.prototype.update=function(t,o,h){if(this._width!==t||this._height!==o){if(this._width>0&&this._height>0){var s=Math.min(t,o)/Math.min(this._width,this._height);s=Math.max(s,i._MIN_ZOOM/this.zoom);this.zoom*=s;this.offsetX=(this.offsetX-this._width*.5)*s+t*.5;this.offsetY=(this.offsetY-this._height*.5)*s+o*.5}else{h=true}this._width=t;this._height=o;if(h){this.reset()}}};i.prototype.reset=function(){if(this._initialZoom){this.setZoomFactor(this._initialZoom)}if(this._initialPosition){this.setPosition(this._initialPosition)}};i.prototype._getViewBox=function(){var t=this.zoom>0?1/this.zoom:1;return[-this.offsetX*t,-this.offsetY*t,this._width*t,this._height*t]};i.prototype._setViewBox=function(t,o,h){this.zoom=Math.min(o,h)/Math.min(t[2],t[3]);this.zoom=Math.max(this.zoom,i._MIN_ZOOM);this.offsetX=o*.5-(t[0]+t[2]*.5)*this.zoom;this.offsetY=h*.5-(t[1]+t[3]*.5)*this.zoom;this._width=o;this._height=h};i.prototype._zoomTo=function(t,o,h,s){var e=Math.min(o/(t.max.x-t.min.x),h/(t.max.y-t.min.y))/(1+(s||0));e=Math.max(e,i._MIN_ZOOM);this.zoom=e;this.offsetX=(o-(t.min.x+t.max.x)*e)*.5;this.offsetY=(h-(t.min.y+t.max.y)*e)*.5;this._width=o;this._height=h};i.prototype._screenToWorld=function(t,i){return{x:(t-this.offsetX)/this.zoom,y:(i-this.offsetY)/this.zoom}};i.prototype._worldToScreen=function(t,i){return{x:t*this.zoom+this.offsetX,y:i*this.zoom+this.offsetY}};i.prototype._transformRect=function(t){var i=this._screenToWorld(t.x1,t.y1);var o=this._screenToWorld(t.x2,t.y2);return{x1:Math.min(i.x,o.x),y1:Math.min(i.y,o.y),x2:Math.max(i.x,o.x),y2:Math.max(i.y,o.y)}};i.prototype._getYSign=function(){return this.getUpDirection()[1]>=0?-1:1};i.prototype.getPosition=function(){var t=this.zoom>0?1/this.zoom:1;return[(this._width*.5-this.offsetX)*t,(this._height*.5-this.offsetY)*t*this._getYSign(),0]};i.prototype.setPosition=function(t){if(Array.isArray(t)&&t.length>=2){if(!this._initialPosition){this._initialPosition=t.slice()}if(this._width>0&&this._height>0){this.offsetX=this._width*.5-t[0]*this.zoom;this.offsetY=this._height*.5-t[1]*this._getYSign()*this.zoom}}};i.prototype.getZoomFactor=function(){var t=Math.min(this._width,this._height);if(t===0){return null}return this.zoom*2/t};i.prototype.setZoomFactor=function(t){if(this._initialZoom==null){this._initialZoom=t}if(this._width>0&&this._height>0){var o=t*.5*Math.min(this._width,this._height);o=Math.max(o,i._MIN_ZOOM);this.offsetX+=(this._width*.5-this.offsetX)*(this.zoom-o)/this.zoom;this.offsetY+=(this._height*.5-this.offsetY)*(this.zoom-o)/this.zoom;this.zoom=o}};return i});
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/svg/Path", ["sap/base/Log","./Element"],function(e,t){"use strict";var i=function(e){e=e||{};t.call(this,e);this.type="Path";this.segments=e.segments||[];this.setMaterial(e.material)};i.prototype=Object.assign(Object.create(t.prototype),{constructor:i});i.prototype.tagName=function(){return"path"};i.prototype._expandBoundingBox=function(e,t){if(this.domRef){var i=this.domRef.getBBox();if(i){this._expandBoundingBoxCE(e,t,i.x+i.width*.5,i.y+i.height*.5,i.width*.5,i.height*.5);return}}var n=isNaN(this.strokeWidth)?0:this.strokeWidth*.5;var r=0,s=0;for(var a=0,o=this.segments.length;a<o;a++){var p=this.segments[a];var h=p.points;var f=p.dimension||2,c,u;switch(p.type){case"arc":if(p.relative){r+=h[0];s+=h[1]}else{r=h[0];s=h[1]}this._expandBoundingBoxCE(e,t,r,s,n,n);break;case"move":r=h[0];s=h[1];this._expandBoundingBoxCE(e,t,r,s,n,n);for(c=f,u=h.length-1;c<u;c+=f){if(p.relative){r+=h[c];s+=h[c+1]}else{r=h[c];s=h[c+1]}this._expandBoundingBoxCE(e,t,r,s,n,n)}break;case"line":for(c=0,u=h.length-1;c<u;c+=f){if(p.relative){r+=h[c];s+=h[c+1]}else{r=h[c];s=h[c+1]}this._expandBoundingBoxCE(e,t,r,s,n,n)}break;case"bezier":var d=p.degree||2;for(c=0,u=h.length-1;c<u;c+=f){if(p.relative){this._expandBoundingBoxCE(e,t,r+h[c],s+h[c+1],n,n);if(c/f%d===d-1){r+=h[c];s+=h[c+1]}}else{r=h[c];s=h[c+1];this._expandBoundingBoxCE(e,t,r,s,n,n)}}break;default:break}}};function n(t,i){var n,r;var s=i.points;switch(i.degree||2){case 2:for(n=0,r=s.length-3;n<r;n+=4){t.push(i.relative?"q":"Q",s[n],s[n+1],s[n+2],s[n+3])}break;case 3:if(!i.smooth){for(n=0,r=s.length-5;n<r;n+=6){t.push(i.relative?"c":"C",s[n],s[n+1],s[n+2],s[n+3],s[n+4],s[n+5])}}else{for(n=0,r=s.length-3;n<r;n+=4){t.push(i.relative?"s":"S",s[n],s[n+1],s[n+2],s[n+3])}}break;default:e.warning("Unsupported bezier segment degree:",i.type);break}}function r(e,t){var i=t.points;e.push(t.relative?"m":"M",i[0],i[1]);var n=t.dimension||2;for(var r=n,s=i.length-1;r<s;r+=n){e.push(t.relative?"l":"L",i[r],i[r+1])}}function s(e,t){var i=t.points;var n=t.dimension||2;for(var r=0,s=i.length-1;r<s;r+=n){e.push(t.relative?"l":"L",i[r],i[r+1])}}function a(e,t){e.push(t.relative?"a":"A",t.major,t.minor,"0",t.short===false?"1":"0",t.clockwise?"1":"0",t.points[0],t.points[1])}i.prototype._setSpecificAttributes=function(t){var i=[];this.segments.forEach(function(t){switch(t.type){case"move":r(i,t);break;case"line":s(i,t);break;case"close":i.push("Z");break;case"arc":a(i,t);break;case"bezier":n(i,t);break;default:e.warning("Unsupported path segment type:",t.type,JSON.stringify(t));break}});if(i.length>0){t("d",i.join(" "))}};i.prototype._getParametricShape=function(e,i,n){var r=t.prototype._getParametricShape.call(this,e,i,n);r.type="path";r.segments=this.segments;return r};i.prototype.copy=function(e,i){t.prototype.copy.call(this,e,i);for(var n=0,r=e.segments.length;n<r;n++){var s=e.segments[n];var a={type:s.type};if(s.points!==undefined){a.points=s.points.slice()}if(s.dimension!==undefined){a.dimension=s.dimension}if(s.degree!==undefined){a.degree=s.degree}if(s.smooth!==undefined){a.smooth=s.smooth}if(s.relative!==undefined){a.relative=s.relative}if(s.major!==undefined){a.major=s.major}if(s.minor!==undefined){a.minor=s.minor}if(s.short!==undefined){a.short=s.short}if(s.clockwise!==undefined){a.clockwise=s.clockwise}this.segments.push(a)}return this};i._extractSegmentsFromDomRef=function(t){var i=[];var n=t.getAttribute("d").split(" ");var r=0;function s(){return n[r++]}function a(){return parseFloat(s())}for(var o=s();o!==undefined;o=s()){switch(o){case"M":i.push({type:"move",points:[a(),a()]});break;case"L":i.push({type:"line",points:[a(),a()]});break;case"Q":i.push({type:"bezier",degree:2,relative:false,points:[a(),a(),a(),a()]});break;case"Z":i.push({type:"close"});break;default:e.warning('Path.createFromDomRef: "'+o+'" path segment is not supported.');break}}return i};return i});
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/svg/Polyline", ["./Element"],function(t){"use strict";var o=function(o){o=o||{};t.call(this,o);this.type="Polyline";this.points=new Float32Array(o.points||[0,0,100,100]);this.closed=o.closed||false;this.setMaterial(o.material)};o.prototype=Object.assign(Object.create(t.prototype),{constructor:o});o.prototype.tagName=function(){return this.closed?"polygon":"polyline"};o.prototype._expandBoundingBox=function(t,o){var i=isNaN(this.strokeWidth)?0:this.strokeWidth*.5;var e=this.points;for(var s=0,n=e.length;s<n;s+=2){this._expandBoundingBoxCE(t,o,e[s],e[s+1],i,i)}};o.prototype._setSpecificAttributes=function(t){t("points",this.points.join(" "))};o.prototype._getParametricShape=function(o,i,e){var s=t.prototype._getParametricShape.call(this,o,i,e);s.type="polyline";s.points=Array.from(this.points);s.closed=this.closed;s.dim=2;return s};o.prototype.copy=function(o,i){t.prototype.copy.call(this,o,i);this.points=o.points.slice();this.closed=o.closed;return this};return o});
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/svg/Rectangle", ["./Element"],function(t){"use strict";var i=function(i){i=i||{};t.call(this,i);this.type="Rectangle";this.x=i.x||0;this.y=i.y||0;this.width=i.width||0;this.height=i.height||i.length||0;this.rx=i.rx||i.radius||0;this.ry=i.ry||i.radius||0;this.setMaterial(i.material)};i.prototype=Object.assign(Object.create(t.prototype),{constructor:i});i.prototype.tagName=function(){return"rect"};i.prototype._expandBoundingBox=function(t,i){var h=isNaN(this.strokeWidth)?0:this.strokeWidth*.5;var e=this.width*.5;var r=this.height*.5;this._expandBoundingBoxCE(t,i,this.x+e,this.y+r,e+h,r+h)};i.prototype._setSpecificAttributes=function(t){if(this.x){t("x",this.x)}if(this.y){t("y",this.y)}t("width",this.width);t("height",this.height);if(this.rx){t("rx",this.rx)}if(this.ry){t("ry",this.ry)}};i.prototype._getParametricShape=function(i,h,e){var r=t.prototype._getParametricShape.call(this,i,h,e);r.type="rectangle";r.width=this.width;r.length=this.height;r.radius=Math.min(this.rx,this.ry);return r};i.prototype.copy=function(i,h){t.prototype.copy.call(this,i,h);this.x=i.x;this.y=i.y;this.width=i.width;this.height=i.height;this.rx=i.rx;this.ry=i.ry;return this};return i});
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/svg/Scene", ["../Scene","./NodeHierarchy","./Element"],function(t,e,r){"use strict";var i=t.extend("sap.ui.vk.svg.Scene",{metadata:{library:"sap.ui.vk"},constructor:function(){t.call(this);this._sceneBuilder=null;this._defaultNodeHierarchy=null;this._currentViewStateManager=null}});i.prototype.init=function(){this._root=new r;this._root.userData.skipIt=true};i.prototype.destroy=function(){if(this._defaultNodeHierarchy){this._defaultNodeHierarchy.destroy();this._defaultNodeHierarchy=null}this._sceneBuilder=null;this._root=null;t.prototype.destroy.call(this)};i.prototype.setViewStateManager=function(t){this._currentViewStateManager=t;return this};i.prototype.getViewStateManager=function(){return this._currentViewStateManager};i.prototype.getId=function(){return this._root&&this._root.id};i.prototype.getDefaultNodeHierarchy=function(){if(!this._defaultNodeHierarchy){this._defaultNodeHierarchy=new e(this)}return this._defaultNodeHierarchy};i.prototype.getRootElement=function(){return this._root};i.prototype.setSceneBuilder=function(t){this._sceneBuilder=t};i.prototype.getSceneBuilder=function(){return this._sceneBuilder};i.prototype.nodeRefToPersistentId=function(t){return Array.isArray(t)?t.map(function(t){return t._vkPersistentId()}):t._vkPersistentId()};i.prototype.persistentIdToNodeRef=function(t){var e=this._sceneBuilder;if(Array.isArray(t)){return t.map(function(t){return e?e.getNode(t):null})}else{return e?e.getNode(t):null}};i.prototype.setNodePersistentId=function(t,e,r){return this._sceneBuilder?this._sceneBuilder.setNodePersistentId(t,e,r):false};i.prototype.getInitialView=function(){return this._initialView};i.prototype.setInitialView=function(t){this._initialView=t};return i});
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/svg/SceneBuilder", ["sap/base/Log","./Element","./Ellipse","./Rectangle","./Line","./Polyline","./Path","./Text","./Image","./LinearGradient","./OrthographicCamera","../View","../NodeContentType","../NavigationMode","../TransformationMatrix","../getResourceBundle","../totara/TotaraUtils","../colorToCSSColor","./SvgImage"],function(e,t,i,a,r,s,n,o,h,d,l,u,p,c,m,f,_,v,g){"use strict";var y=function(e,t,i,a){this._rootNode=e;this._contentResource=t;this._resolve=i;this._reject=a;this._cameras=new Map;this._sceneIdTreeNodesMap=new Map;this._sceneIdRootNodeMap=new Map;this._materialMap=new Map;this._annotationsMap=new Map;this._annotationNodesMap=new Map;this._materialNodesMap=new Map;this._nodes=new Map;this._viewGroups=new Map;this._views=new Map;this._viewThumbnails=new Map;this._geometries=new Map;this._geometryMeshes=new Map;this._meshNodes=new Map;this._meshSubmeshes=new Map;this._images=new Map;this._imageTextures=new Map;this._fillStyles=new Map;this._lineStyles=new Map;this._textStyles=new Map;this._joints=new Map;this._yIndex=1;this._materialsByTextureImageId=new Map;if(t){var r=t.getNodeProxy();var s=r.getNodeHierarchy();this._vkScene=s.getScene();var n=t.getSource();if(n&&n.name){this._sceneIdTreeNodesMap.set(n.name,this._nodes);this._sceneIdRootNodeMap.set(n.name,e);this._currentSceneId=n.name}if(this._rootNode){this._rootNode.userData.skipIt=!t.getName()}}};y.prototype.setScene=function(t){this._yIndex=1;this._rootNode.matrix[3]=t.upAxis===2||t.upAxis===4?-1:1;const i=this._cameras.get(t.cameraId);const a=t.outputSettings;if(a&&i){const e=72;const i=1/25.4;const r=4/3;const s=i*e*r;const n=Math.min(a.width,a.height)*s;this._materialMap.forEach(function(e){if(e.lineStyle.widthCoordinateSpace===4){if(!t.showPaperSpace){e.lineWidth=e.lineStyle.width*1024/n;e.lineStyle.widthCoordinateSpace=0}}})}e.info("setScene",JSON.stringify(t),i);this._resolve?.({node:this._rootNode,camera:i,backgroundTopColor:t.backgroundTopColor,backgroundBottomColor:t.backgroundBottomColor,outputSettings:a,contentResource:this._contentResource,builder:this})};y.prototype.setRootNode=function(e,t,i,a){this._rootNode=e;e.sid=t;this._nodes.set(t,e);this._viewGroups=new Map;this._views=new Map;if(i){this._sceneIdTreeNodesMap.set(i,this._nodes);this._sceneIdRootNodeMap.set(i,e);this._currentSceneId=i}if(a){this._vkScene=a;if(this._sceneMetadata){this._vkScene.setSceneMetadata(this._sceneMetadata)}}return this};y.prototype.setNodePersistentId=function(e,t,i){this._resetCurrentScene(i);e.sid=t;this._nodes.set(t,e);return true};y.prototype.cleanup=function(){this._rootNode=null;this._currentSceneId=null;this._contentResource=null;this._resolve=null;this._reject=null;if(this._nodes){this._nodes.clear()}if(this._viewGroups){this._viewGroups.clear()}if(this._views){this._views.clear()}this._cameras.clear();this._materialMap.clear();this._annotationsMap.clear();this._annotationNodesMap.clear();this._materialNodesMap.clear();this._sceneIdTreeNodesMap.clear();this._sceneIdRootNodeMap.clear();this._materialsByTextureImageId.clear();this._viewThumbnails.clear();this._geometries.clear();this._geometryMeshes.clear();this._meshNodes.clear();this._meshSubmeshes.clear();this._images.clear();this._imageTextures.clear();this._joints.clear();this._fillStyles.clear();this._lineStyles.clear();this._textStyles.clear()};y.prototype.getNode=function(e,t){if(t){this._resetCurrentScene(t);if(this._nodes){return this._nodes.get(e)}}else{var i=this._sceneIdTreeNodesMap.values();var a=i.next();while(!a.done){var r=a.value.get(e);if(r){return r}a=i.next()}}return null};y.prototype._resetCurrentScene=function(e){if(e&&e!==this._currentSceneId){var t=this._sceneIdTreeNodesMap.get(e);if(t){this._nodes=t}else{this._nodes=new Map}var i=this._sceneIdRootNodeMap.get(e);if(i){this._rootNode=i}else{this._rootNode=null}this._currentSceneId=e}};y.prototype.createCamera=function(e,t){this._resetCurrentScene(t);var i=new l;i.setUpDirection(Array.isArray(e.up)?e.up:[0,1,0]);i.setZoomFactor(e.zoom);i.setPosition(e.origin);this._cameras.set(e.id,i);return i};y.prototype.getCamera=function(e){return this._cameras.get(e)};y.prototype.hasMesh=function(e){return this._meshSubmeshes.has(e)};y.prototype.hasImage=function(e){return this._images.has(e)};y.prototype.hasAnnotation=function(e){return this._annotationsMap.has(e)};function I(e){if(Array.isArray(e)){for(var t=0;t<e.length;t++){if(e[t].type===undefined||e[t].type==="mesh"||e[t].type==="line"){return e[t]}}}return null}y.prototype.setMeshNode=function(e,t){this._setMeshNode(this._nodes.get(e),t)};y.prototype.setModelViewVisibilitySet=function(){};y.prototype.setAnimationPlaybacks=function(){};y.prototype.createThumbnail=function(e){var t=this._viewThumbnails.get(e.imageId);if(t){t.thumbnailData="data:image/"+"jpeg"+";base64,"+window.btoa(String.fromCharCode.apply(null,e.data));if(this._fireThumbnailLoaded){this._fireThumbnailLoaded({modelView:t})}}};y.prototype.setSubmeshes=function(e){var t,i,a,r,s;for(var n=0,o=e.length;n<o;++n){t=e[n];i=t.submeshes;for(r=0,s=i.length;r<s;++r){a=i[r];this.insertSubmesh(a)}}};y.prototype.insertSubmesh=function(e){if(!e.lods){return false}var t=I(e.lods);if(!t){return false}e.boundingBox=t.boundingBox;var i=this._geometries.get(t.id);if(i){var a=this._meshNodes.get(e.meshId);if(a){for(var r=0;r<a.length;r++){this._addGeometryToNode(a[r],i,e)}}}else{_.pushElementIntoMapArray(this._geometryMeshes,t.id,e)}_.pushElementIntoMapArray(this._meshSubmeshes,e.meshId,e);return true};y.prototype.getViewGroup=function(e,t){this._resetCurrentScene(t);var i=this._viewGroups.get(e);var a=[];if(i&&i.views){for(var r=0;r<i.views.length;r++){var s=i.views[r].id;var n=this._views.get(s);if(n){a.push(n)}}}return a};y.prototype.insertViewGroup=function(e,t){this._resetCurrentScene(t);var i=this._viewGroups.get(e.id);if(!i){i=this._vkScene.createViewGroup({viewGroupId:e.id,name:e.name,description:e.description});this._viewGroups.set(e.id,i)}else{i.setViewGroupId(e.id);i.setName(e.name);i.setDescription(e.description)}i.type=e.type;i.metadata=e.metadata;i.veids=e.veids;i.views=e.views;i.sceneId=e.sceneId;return this};var w={turntable:c.Turntable,orbit:c.Orbit,pan:c.Pan,zoom:c.Zoom};y.prototype.insertView=function(e,t){this._resetCurrentScene(t);let i=this._views.get(e.viewId);if(i==null){i=this._vkScene.createView({viewId:e.viewId,name:e.name,description:e.description?'<pre class="sapThemeVizKitViewGalleryStepDescriptionPre">'+e.description+"</pre>":e.description,aspectRatio:e.safeAreaAspectRatio,autoPlayAnimation:e.autoPlayAnimation,navigationMode:w[e.navigationMode]||c.NoChange,dimension:2});this._views.set(e.viewId,i)}else{i.setName(e.name);i.setDescription(e.description?'<pre class="sapThemeVizKitViewGalleryStepDescriptionPre">'+e.description+"</pre>":e.description);i.setAspectRatio(e.safeAreaAspectRatio)}i.userData={viewInfo:e};if(e.thumbnailId){var a=this._images.get(e.thumbnailId);if(a){i.thumbnailData=a}else{this._viewThumbnails.set(e.thumbnailId,i)}}if(e.cameraId){i.setCamera(this._cameras.get(e.cameraId))}i.type=e.type;i.flyToTime=e.flyToTime;i.preDelay=e.preDelay;i.postDelay=e.postDelay;i.navigationMode=e.navigationMode;var r=this._getSavedColor(e.topColour,localStorage.getItem("color.backgroundTop"));if(r!=null){i.setTopColor(r)}var s=this._getSavedColor(e.bottomColour,localStorage.getItem("color.backgroundBottom"));if(s!=null){i.setBottomColor(s)}i.dimension=e.dimension;i.query=e.query;i.metadata=e.metadata;i.veids=e.veids;i.viewGroupId=e.viewGroupId;i.id=e.viewId;if(i.viewGroupId){var n=this._viewGroups.get(i.viewGroupId);if(n){n.addView(i)}}return this};y.prototype.getView=function(e,t){this._resetCurrentScene(t);return this._views.get(e)};y.prototype.setViewCamera=function(e,t,i){this._resetCurrentScene(i);var a=this._cameras.get(e);var r=this._views.get(t);if(a&&r){r.setCamera(a)}return this};y.prototype.getChildNodeIds=function(e,t,i){this._resetCurrentScene(t);var a=this._nodes.get(e);var r=[];if(!a){return r}if(a&&a.children){for(var s=0;s<a.children.length;s++){var n=a.children[s];if(n.userData.treeNode&&n.userData.treeNode.sid){r.push(n.userData.treeNode.sid)}else if(i&&n.userData.submeshInfo&&n.userData.submeshInfo.id){r.push(n.userData.submeshInfo.id)}}}return r};y.prototype.setViewNodeInfos=function(e,t,i){this._resetCurrentScene(i);var a=this._views.get(t);a.setNodeInfos(e);return this};y.prototype.finalizeViewGroups=function(e){this._resetCurrentScene(e);var t=this._viewGroups.entries();var i=t.next();while(!i.done){var a=i.value[1];var r=i.value[0];if(!a||!a.views||!a.views.length){i=t.next();continue}a.removeViews();for(var s=0;s<a.views.length;s++){var n=a.views[s].id;var o=this._views.get(n);if(o&&o.userData.viewInfo.thumbnailId&&!o.thumbnailData){var h=this._images.get(o.userData.viewInfo.thumbnailId);if(h){o.thumbnailData=h}}if(o){o.viewGroupId=r;a.addView(o)}}i=t.next()}return this};y.prototype.setVoxelThreshold=function(e){return this};y.prototype.getVoxelThreshold=function(){return 0};y.prototype.createNode=function(e,i){this._resetCurrentScene(i);var a=e.transform;const r=e.contentType=="SVG"?new g({sid:e.sid,name:e.name,matrix:[1,0,0,-1,0,0],sceneId:i,imageId:e.imageId,width:e.width,height:e.height}):new t({sid:e.sid,name:e.name,matrix:m.convertTo3x2(a)});this._nodes.set(e.sid,r);var s=r.userData;if(e.metadata){s.metadata=e.metadata}if(e.veids){s.veids=e.veids}if(e.usageIds){s.usageIds=e.usageIds}if(e.parametricId){s.parametricId=e.parametricId}else if(e.dynamicContentId){s.dynamicContentId=e.dynamicContentId}else if(e.meshId){this._setMeshNode(r,e.meshId)}s.treeNode=e;r.setVisible(1,e.visible??true);if(e.visualisable===false){s.skipIt=true}if(e.joints){e.joints.forEach(function(e){var t=this._nodes.get(e.parentSid);if(t){t.userData.jointNodes=t.userData.jointNodes||[];t.userData.jointNodes.push(r)}else{_.pushElementIntoMapArray(this._joints,e.parentSid,r)}},this)}var n=this._joints.get(e.sid);if(n){s.jointNodes=s.jointNodes?s.jointNodes.concat(n):n}if(e.viewBox){s.viewBox=e.viewBox}if(e.pageIndex!=null){r.setPageIndex(e.pageIndex)}var o=this._nodes.get(e.parentId);(o||this._rootNode).add(r);if(e.contentType==="HOTSPOT"){r._vkSetNodeContentType(p.Hotspot)}else if(e.contentType==="DYNAMIC_CONTENT"){r._vkSetNodeContentType(p.DynamicContent)}else if(e.contentType==="ANNOTATION"){r._vkSetNodeContentType(p.Annotation)}else if(e.contentType==="SVG"){r._vkSetNodeContentType(p.SvgImage)}return r};y.prototype.preferMeshes=function(){return false};y.prototype.createAnnotation=function(e,t){_.pushElementIntoMapArray(this._annotationNodesMap,e.annotationId,e.nodeId);var i=this.getAnnotation(e.annotationId);if(i){this.createImageNote(i,t)}};y.prototype.remove=function(e,t){this._resetCurrentScene(t);var i=this;e=[].concat(e);e.forEach(function(e){var a=i._nodes.get(e);if(a){i._nodes.delete(e);for(var r=0;r<a.children.length;r++){var s=a.children[r];if(s.userData&&s.userData.treeNode&&s.userData.treeNode.sid){i.remove(s.userData.treeNode.sid,t)}}}});return this};function M(e){return new Float32Array([Math.max(e[3]-e[0],Number.EPSILON),0,0,Math.max(e[4]-e[1],Number.EPSILON),(e[3]+e[0])*.5,(e[4]+e[1])*.5])}y.prototype._addGeometryToNode=function(e,t,i){var a=i.materialId;var r=this._getMaterial(a);var s=t.data;var o=s.indices;var h=s.points;var d=new Float32Array([1,0,0,1,0,0]);if(t.isPositionQuantized&&i.boundingBox&&i.boundingBox.length===6){d=M(i.boundingBox)}if(i.transform){}var l,u,p,c;var m=o.length;var f=[];if(t.isPolyline){for(l=0,u=-1;l<m;l+=2,u=c){p=o[l]*3;c=o[l+1]*3;if(p!==u){f.push({type:"move",points:[h[p],h[p+this._yIndex]]});f.push({type:"line",points:[h[c],h[c+this._yIndex]]})}else{f[f.length-1].points.push(h[c],h[c+this._yIndex])}}}else{r=Object.assign(Object.assign({},r),{lineColor:[0,0,0,0],lineWidth:0});for(l=0;l<m;l+=3){u=o[l]*3;p=o[l+1]*3;c=o[l+2]*3;f.push({type:"move",points:[h[u],h[u+this._yIndex]]});f.push({type:"line",points:[h[p],h[p+this._yIndex],h[c],h[c+this._yIndex]]});f.push({type:"close"})}}var v=new n({segments:f,isTriangleMesh:!t.isPolyline,matrix:d,material:r,materialID:a,fillStyle:t.isPolyline?null:{colour:r.color},subelement:true});e.add(v);_.pushElementIntoMapArray(this._materialNodesMap,a,v)};y.prototype.setGeometry=function(e){this._geometries.set(e.id,e);var t=this._geometryMeshes.get(e.id);if(t){for(var i=0;i<t.length;i++){var a=t[i];var r=this._meshNodes.get(a.meshId);if(r){for(var s=0;s<r.length;s++){this._addGeometryToNode(r[s],e,a)}}}}if(this._fireSceneUpdated){this._fireSceneUpdated()}return this};y.prototype._setMeshNode=function(e,t){_.pushElementIntoMapArray(this._meshNodes,t,e);var i=this._meshSubmeshes.get(t);if(i){for(var a=0;a<i.length;a++){var r=i[a];var s=I(r.lods);if(s){var n=this._geometries.get(s.id);if(n){this._addGeometryToNode(e,n,r)}}}}};var S=[0,0];var N=[0,0,0,1];var b=[1,1];function x(e){return t._compose(e.t||S,e.r||N,e.s||b)}y.prototype.setParametricContent=function(t,i,a){if(i==null){e.warning("Empty parametric content for node "+t);return}this._resetCurrentScene(a);var r=this._nodes.get(t);var s=i.shapes;if(s){for(var n=0;n<s.length;n++){this._createObject(s[n],r)}}else{this._createObject(i,r)}};y.prototype.setDynamicContent=function(e,t,i){this._resetCurrentScene(i);const a=this._nodes.get(e);if(a){a.userData.templateId=t.templateId;const e={type:"rectangle",width:1,height:1};const i=this._createObject(e,a);i.fill=i.stroke=[0,0,0,0]}};function T(e,t,i,a,r){return[e+i*Math.cos(r),t+a*Math.sin(r)]}y.prototype._createObject=function(t,h){t.matrix=x(t);t.subelement=true;if(t.materialID){t.material=this._getMaterial(t.materialID)}if(this._lineStyles&&t.stroke_id!==undefined){t.lineStyle=this._lineStyles.get(t.stroke_id)}if(this._fillStyles&&t.fill_id!==undefined){t.fillStyle=this._fillStyles.get(t.fill_id);if(t.fillStyle.gradient){var l=new d(t.fillStyle);t.fillStyle.fillURL="url(#"+l.uid+")";h.add(l)}}if(this._textStyles&&t.style_id!==undefined){t.style=this._textStyles.get(t.style_id);t.textStyles=this._textStyles}var u;switch(t.type){case"arc":case"ellipticalArc":var p=t.cx||0;var c=t.cy||0;var m=t.major??t.radius;var f=t.minor??t.radius;var v=t.start>t.end?t.start-Math.PI*2:t.start;var g=t.end;t.segments=[{type:"move",points:T(p,c,m,f,v)},{type:"arc",major:m,minor:f,short:Math.abs(g-v)<Math.PI,clockwise:g>v,points:T(p,c,m,f,g)}];u=new n(t);break;case"rectangle":u=new a(t);break;case"line":u=new r(t);break;case"polyline":u=new s(t);break;case"ellipse":case"circle":u=new i(t);break;case"text":if(this._rootNode.matrix[3]<0){t.matrix[2]*=-1;t.matrix[3]*=-1}u=new o(t);break;case"path":u=new n(t);break;default:e.warning("Unsupported parametric type",t.type);u=null;break}if(u){u.userData.po=t;if(t.materialID){_.pushElementIntoMapArray(this._materialNodesMap,t.materialID,u)}h.add(u)}return u};y.prototype.createImageNote=function(e,t){this._resetCurrentScene(t);if(e.type==="image"){var i=e.label.materialId;if(!i){return}var a=this._getMaterial(i);this._annotationsMap.set(e.id,e);var r=this._annotationNodesMap.get(e.id)||[];this._annotationNodesMap.delete(e.id);if(e.nodeId){r.push(e.nodeId)}for(var s=0;s<r.length;s++){var n=this._nodes.get(r[s]);if(n){var o=new h({materialID:i,material:a,subelement:true,matrix:[1,0,0,-1,0,0]});n.add(o);_.pushElementIntoMapArray(this._materialNodesMap,i,o)}}}};y.prototype.removeNode=function(e){this._nodes.delete(e.sid);e.children.forEach(this.removeNode,this)};y.prototype.createMaterial=function(e){var t=[];var i=e.id;var a=this._getMaterial(i);a.lineColor=e.lineColour;a.lineWidth=e.lineWidth||1;a.lineStyle={width:e.lineWidth||1,haloWidth:e.lineHaloWidth||0,endCapStyle:e.lineEndRound?1:0,dashPattern:e.lineDashPattern||[],dashPatternScale:e.lineDashPatternScale,widthCoordinateSpace:e.lineWidthCoordinateSpace};if(e.emissiveColour){a.color=e.emissiveColour}if(e.opacity!==undefined){a.opacity=e.opacity}if(e.textureEmissive&&e.textureEmissive.length&&e.textureEmissive[0].imageId){var r=e.textureEmissive[0].imageId;if(this._images.has(r)){a.texture=this._images.get(r)}else{var s={imageId:e.textureEmissive[0].imageId};t.push(s);_.pushElementIntoMapArray(this._imageTextures,r,{materialId:i});if(!a.userData){a.userData={}}a.userData.imageIdsToLoad=new Set;a.userData.imageIdsToLoad.add(s.imageId)}a.textureWidth=e.textureEmissive[0].width;a.textureHeight=e.textureEmissive[0].height;_.pushElementIntoMapArray(this._materialsByTextureImageId,r,{materialId:i})}var n=this._materialNodesMap.get(i);if(n){for(var o=0;o<n.length;o++){n[o].setMaterial(a,true)}}return t};y.prototype._getMaterial=function(e){return this._materialMap.get(e)||this._createTemporaryMaterial(e)};y.prototype._createTemporaryMaterial=function(e){var t={materialId:e,lineColor:[0,0,0,1],lineWidth:1};this._materialMap.set(e,t);return t};y.prototype.checkMaterialExists=function(e,t){if(!this._materialMap.get(e)){if(t){this._createTemporaryMaterial(e)}return false}return true};y.prototype.materialNeeded=function(e){return false};y.prototype.getAnnotation=function(e){return this._annotationsMap.get(e)};y.prototype.updateViewsForReplacedNodes=function(e){};y.prototype.insertFillStyle=function(e){this._fillStyles.set(e.veid,e)};y.prototype.insertLineStyle=function(e){this._lineStyles.set(e.veid,e)};y.prototype.insertTextStyle=function(e){this._textStyles.set(e.veid,e)};var C=function(e){var t="";try{var i=32768;var a=0;var r=e.length;var s;while(a<r){s=e.slice(a,Math.min(a+i,r));t+=String.fromCharCode.apply(null,s);a+=i}}catch(e){t=""}return t};y.prototype.createImage=function(t){if(t.binaryData.length<32){e.warning("SceneBuilder.createImage()","Can't create image from empty data");return this}var i=new DataView(t.binaryData.buffer);var a=true;if(i.getUint8(0,true)===parseInt("0xFF",16)&&i.getUint8(1,true)===parseInt("0xD8",16)){a=false}var r=C(t.binaryData);var s="data:image/"+(a?"png":"jpeg")+";base64,"+btoa(r);this._images.set(t.id,s);var n=this._imageTextures.get(t.id);if(n&&n.length){this._imageTextures.delete(t.id);n.forEach(function(e){var i=this._getMaterial(e.materialId);i.texture=s;if(i.userData&&i.userData.imageIdsToLoad&&i.userData.imageIdsToLoad.size){i.userData.imageIdsToLoad.delete(t.id)}var a=this._materialNodesMap.get(e.materialId);if(a){for(var r=0;r<a.length;r++){a[r].setMaterial(i,true)}}}.bind(this))}return this};y.prototype.setViewThumbnail=function(e,t,i,a){this._resetCurrentScene(i);var r=this._views.get(t);var s=this._images.get(e);if(r&&s){if(r.userData!==undefined){if(r.userData.viewInfo.thumbnailId===e){r.thumbnailData=s}}}return this};y.prototype._getSavedColor=function(e,t){if(e&&e.length>2){return v({red:Math.floor(e[0]*255),green:Math.floor(e[1]*255),blue:Math.floor(e[2]*255),alpha:e.length>3?e[3]:1})}else if(t){return t}return undefined};y.prototype.setSceneMetadata=function(e){if(this._vkScene){this._vkScene.setSceneMetadata(e)}else{this._sceneMetadata=e}};return y});
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/svg/SvgImage", ["./Element"],function(t){"use strict";var i=function(i){i=i??{};t.call(this,i);this.type="SvgImage";this.x=i.x??0;this.y=i.y??0;this.width=i.width??0;this.height=i.height??0;this.sceneId=i.sceneId;this.imageId=i.imageId;this.data=i.data||""};i.prototype=Object.assign(Object.create(t.prototype),{constructor:i});i.prototype.tagName=function(){return"image"};i.prototype.getImageId=function(){return this.imageId};i.prototype.setImageData=function(t){this.data=t;this.invalidate()};i.prototype.render=function(i,e,h){const s=h.getCurrentView()!=null;if(this.width==0||this.height==0){return}if(this.isVisible(e)&&(this.parent==null||this.parent.isVisible(s?this.parent.vMask:this.parent.sMask))){t.prototype.render.call(this,i,e,h)}};i.prototype._setSpecificAttributes=function(t,i){if(this.x){t("x",this.x)}if(this.y){t("y",this.y)}if(this.width){t("width",this.width)}if(this.height){t("height",this.height)}if(i){i.setAttribute("href",this.data||"")}else{t("href",this.data||"")}};i.prototype.setDimensions=function(t,i){const e=t!==this.width||i!==this.height;this.width=t;this.height=i;if(e){this.invalidate()}};i.prototype.setMatrix=function(i){t.prototype.setMatrix.call(this,t._multiplyMatrices(i,[1,0,0,-1,0,0]))};i.prototype._expandBoundingBox=function(t,i){const e=this.width*.5;const h=this.height*.5;this._expandBoundingBoxCE(t,i,this.x+e,this.y+h,e,h)};i.prototype._getParametricShape=function(i,e,h){var s=t.prototype._getParametricShape.call(this,i,e,h);s.type="rectangle";s.width=this.width;s.length=this.height;return s};i.prototype.copy=function(i,e){t.prototype.copy.call(this,i,e);this.type=i.type;this.x=i.x;this.y=i.y;this.width=i.width;this.height=i.height;this.data=i.data;this.sceneId=i.sceneId;this.imageId=i.imageId;return this};return i});
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/svg/Text", ["./Element","./Path","sap/base/util/uid"],function(t,e,i){"use strict";const n=10;const s=11;const a=12;var o=function(e){e=e||{};t.call(this,e);this.type="Text";this.text=e.text;this.content=e.content||(e.children?v(e.children,e.textStyles):[]);this.style=e.style||{};this.style.size=this.style.size||"1em";this.x=e.x||0;this.y=e.y||0;["dx","dy","textAnchor","alignmentBaseline","pivot","anchor"].forEach(t=>{if(e[t]!=null){this[t]=e[t]}});this.fillStyle=e.fillStyle||{colour:[0,0,0,1]};this.lineStyle=e.lineStyle||{colour:[0,0,0,0],width:1};if(this.style.fill){this.fillStyle.veid="t"+this.style.veid;this.fillStyle.colour=this.style.fill}if(this.style.stroke){this.lineStyle.veid="t"+this.style.veid;this.lineStyle.colour=this.style.stroke}this.setMaterial(e.material)};o.prototype=Object.assign(Object.create(t.prototype),{constructor:o});o.prototype.tagName=function(){return"text"};o.prototype.defaultFillAlpha=1;var r=document.createElement("canvas");var f=r.getContext("2d");o.prototype._expandBoundingBox=function(t,e){if(this.domRef){var i=this.domRef.getBBox();if(i){this._expandBoundingBoxCE(t,e,i.x+i.width*.5,i.y+i.height*.5,i.width*.5,i.height*.5);return}}function n(t){var e="";for(var i=0,s=t.length;i<s;i++){var a=t[i];if(a.text){e+=a.text}if(a.content){e+=n(a.content)}}return e}var s=isNaN(this.strokeWidth)?0:this.strokeWidth*.5;f.font=this.style.size+" "+(this.style.fontFace||"Arial");var a=f.measureText((this.text?this.text:"")+(this.content?n(this.content):""));var o=a.width*.5+s;var r=(a.actualBoundingBoxAscent||this.style.size)*.5+s;this._expandBoundingBoxCE(t,e,this.x+o,this.y-r,o,r)};function l(t,e,i){if(t.size){e("font-size",t.size)}if(t.fontFace){e("font-family",t.fontFace)}if(t.fontStyle){e("font-style",t.fontStyle)}if(t.fontWeight){e("font-weight",t.fontWeight)}if(t.textDecoration){e("text-decoration",t.textDecoration)}if(!i){if(t.fill){e("fill",t.fill)}if(t.stroke){e("stroke",t.stroke)}}}o.prototype._setSpecificAttributes=function(t){t("x",this.x);t("y",this.y);if(this.dx){t("dx",this.dx)}if(this.dy){t("dy",this.dy)}if(this.textAnchor){t("text-anchor",this.textAnchor)}if(this.alignmentBaseline){t("alignment-baseline",this.alignmentBaseline)}l(this.style,t,true)};function h(t,e){if(t.x!==undefined){e("x",t.x)}if(t.y!==undefined){e("y",t.y)}if(t.dx){e("dx",t.dx)}if(t.dy){e("dy",t.dy)}}function c(t,i){if(!t||t.length===0){return}var o=i.attr.bind(i);for(var r=0,f=t.length;r<f;r++){var d=t[r];switch(d.type){case n:case undefined:case"text":i.text(d.text);break;case s:case"span":i.openStart("tspan");h(d,o);if(d.style){l(d.style,o)}i.openEnd();if(d.text){i.text(d.text)}c(d.content,i);i.close("tspan");break;case a:case"path":i.openStart("textPath");h(d,o);if(d.style){l(d.style,o)}if(!d.path&&d.pathSegments){d.path=new e({segments:d.pathSegments})}var x=d.path;if(x instanceof e){i.attr("href","#"+x.uid);i.openEnd();i.openStart(x.tagName());i.attr("id",x.uid);x._setSpecificAttributes(o);i.openEnd();i.close(x.tagName())}else{i.openEnd()}if(d.text){i.text(d.text)}c(d.content,i);i.close("textPath");break;default:break}}}o.prototype._renderContent=function(t){if(this.text){t.text(this.text)}c(this.content,t)};function d(i,o){if(!i||i.length===0){return}var r,f;for(var c=0,x=i.length;c<x;c++){var p=i[c];switch(p.type){case n:case undefined:case"text":o.append(p.text);break;case s:case"span":r=document.createElementNS(t._svgNamespace,"tspan");f=r.setAttribute.bind(r);h(p,f);if(p.style){l(p.style,f)}if(p.text){r.append(p.text)}d(p.content,r);o.append(r);break;case a:case"path":r=document.createElementNS(t._svgNamespace,"textPath");f=r.setAttribute.bind(r);h(p,f);if(p.style){l(p.style,f)}if(!p.path&&p.pathSegments){p.path=new e({segments:p.pathSegments})}var y=p.path;if(y instanceof e){r.setAttribute("href","#"+y.uid);var u=document.createElementNS(t._svgNamespace,y.tagName());u.setAttribute("id",y.uid);y._setSpecificAttributes(u.setAttribute.bind(u));r.append(u)}if(p.text){r.append(p.text)}d(p.content,r);o.append(r);break;default:break}}}o.prototype._createContent=function(t){if(this.text){t.append(this.text)}d(this.content,t)};function x(t){let e;switch(typeof t){case"number":e=t;break;case"string":if(t.endsWith("pt")){e=parseFloat(t)*4/3}else if(t.endsWith("em")){e=parseFloat(t)*16}else{e=parseFloat(t)}break;default:e=0;break}return typeof e==="number"&&isFinite(e)?e:0}function p(t){var e=[];for(var i=0;i<t.childNodes.length;i++){var a=t.childNodes[i];if(a.data!==undefined){e.push({type:n,text:a.data})}else if(a.childNodes.length>0){var o={type:s,content:p(a)};var r=a.style;var f={};if(r.fontSize){f.size=r.fontSize}if(r.fontFamily){f.fontFace=r.fontFamily.replaceAll('"',"'")}if(r.textDecoration){f.textDecoration=r.textDecoration}if(r.color){f.fill=r.color}switch(a.tagName){case"EM":f.fontStyle="italic";break;case"STRONG":f.fontWeight="bold";break;default:break}if(Object.keys(f).length){o.style=f}e.push(o)}}return e}function y(t){var e=0;for(var i=0;i<t.length;i++){var n=t[i];var s=n.style&&n.style.size;if(s!==undefined){s=x(s);if(typeof s=="number"&&isFinite(s)){e=Math.max(e,s)}}if(n.content){e=Math.max(e,y(n.content))}}return e}o.prototype.setHtmlTextContent=function(t){var e=document.createElement("html");e.innerHTML=t;var i=[];var a=e.getElementsByTagName("body");var o=a.length>0?a[0].childNodes:[];for(var r=0,f=this.y;r<o.length;r++){var l=o[r];if(l.childNodes.length>0){var h=p(l);var c;if(l.nodeName==="P"){c=Math.max(y(h),x(this.style.size));f+=r>0?c:0}i.push({type:s,x:x(l.style.paddingLeft)+this.x,y:f,content:p(l)});if(l.nodeName==="P"){f+=c*.25}}else if(l.data){i.push({type:n,text:l.data})}}delete this.text;this.content=i;this.invalidate()};function u(t,e){var i="";var o=[];for(var r=0;r<t.length;r++){var f=t[r];switch(f.type){case n:case undefined:case"text":i+=f.text;break;case s:case"span":case a:case"path":var l=f.style;if(!e||f.y!==undefined||f.dy!==undefined){o.push("p");i+='<p style="text-align: left;';if(f.x){i+=" padding-left: "+(typeof f.x==="number"?f.x+"px":f.x)+";"}i+='">'}if(l){if(l.textDecoration||l.size||l.fontFace||l.fill){o.push("span");i+='<span style="';if(l.textDecoration){i+="text-decoration: "+l.textDecoration+";"}if(l.size){i+="font-size: "+x(l.size)*.75+"pt;"}if(l.fill){i+="color: "+l.fill+";"}if(l.fontFace){i+="font-family: "+l.fontFace+";"}i+='">'}if(l.fontStyle==="italic"){o.push("em");i+="<em>"}if(l.fontWeight==="bold"){o.push("strong");i+="<strong>"}}if(o.length===0){o.push("span");i+="<span>"}if(f.text){i+=f.text}i+=u(f.content,true);var h=o.pop();while(h!==undefined){i+="</"+h+">";h=o.pop()}break;default:break}}return i}o.prototype.getHtmlTextContent=function(){var t=u(this.content,false);return this.text?this.text+t:t};function v(t,e){var i=[];for(var o=0;o<t.length;o++){var r=t[o];switch(r.type){case undefined:case"text":i.push({type:n,text:r.text});break;default:case"span":case"path":var f={type:r.type==="path"?a:s};if(r.x!==undefined){f.x=r.x}if(r.y!==undefined){f.x=r.y}if(r.dx!==undefined){f.x=r.dx}if(r.dy!==undefined){f.x=r.dy}if(r.style_id){f.style=e.get(r.style_id)}if(r.text){f.text=r.text}if(r.children){f.content=v(r.children,e)}i.push(f);break}}return i}function m(t,e){var o=[];for(var r=0;r<t.length;r++){var f=t[r];switch(f.type){case n:case undefined:o.push({text:f.text});break;case s:case"span":case a:case"path":var l={type:"span"};if(f.x!==undefined){l.x=f.x}if(f.y!==undefined){l.y=f.y}if(f.dx!==undefined){l.dx=f.dx}if(f.dy!==undefined){l.dy=f.dy}if(f.text){l.text=f.text}var h=f.style;if(h){h.veid=h.veid||i();l["style_id"]=h.veid;e.push(h)}if(f.content){l.children=m(f.content,e)}o.push(l);break;default:break}}return o}o.prototype._getParametricShape=function(e,n,s){var a=t.prototype._getParametricShape.call(this,e,n,s);a.type="text";if(a.s){a.s[1]*=-1}if(this.x){a.x=this.x}if(this.y){a.y=this.y}if(this.dx){a.dx=this.dx}if(this.dy){a.dy=this.dy}var o=this.style;if(o){o.veid=o.veid||i();a["style_id"]=o.veid;s.push(o)}if(this.text){a.text=this.text}a.children=m(this.content,s);return a};o.prototype.copy=function(e,i){t.prototype.copy.call(this,e,i);this.text=e.text;this.content=e.content;this.style=e.style;this.x=e.x;this.y=e.y;if(e.dx){this.dx=e.dx}if(e.dy){this.dy=e.dy}return this};t.prototype.setCustomText=function(t){if(t==null||t.text==null&&t.htmlText==null){this.customText=null;return this}const e=this.customText=new o({text:t.text,pivot:t.pivot??[.5,.5],anchor:t.anchor??[.5,.5],style:{size:t.size??"0px",fontFace:t.fontFamily??t.fontFace??"Arial",fontStyle:t.fontStyle,fontWeight:t.fontWeight,textDecoration:t.textDecoration,fill:t.fill??"black"}});if(t.htmlText){e.setHtmlTextContent(t.htmlText)}e.userData.customText=true;return this};return o});
/*!
* SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
*/
sap.ui.predefine("sap/ui/vk/svg/ViewStateManager", ["sap/base/Log","../Core","../ViewStateManagerBase","../cssColorToColor","../colorToCSSColor","../abgrToColor","../colorToABGR","../AnimationTrackType","../NodeContentType","./Scene","./Element","sap/ui/base/DataType","sap/ui/core/Element"],function(t,e,i,r,n,s,a,o,h,l,c,u,f){"use strict";var d;var p=i.extend("sap.ui.vk.svg.ViewStateManager",{metadata:{library:"sap.ui.vk"}});var y=p.getMetadata().getParent().getClass().prototype;p.prototype.init=function(){if(y.init){y.init.call(this)}this._mask=1|0;this._nodeHierarchy=null;this._selectedNodes=new Set;this._visibilityTracker=new d;this.setHighlightColor(3204448443);e.getEventBus().subscribe("sap.ui.vk","activateView",this._onActivateView,this)};p.prototype.exit=function(){e.getEventBus().unsubscribe("sap.ui.vk","activateView",this._onActivateView,this)};p.prototype._setContent=function(t){if(t===this._scene){return this}var e=null;if(t&&t instanceof l){e=t}this._setScene(e);if(e){var i=e.getInitialView();if(i){this._currentView=i;this._resetNodesStatusByCurrentView(this._currentView)}}return this};p.prototype._setScene=function(t){this._setNodeHierarchy(t?t.getDefaultNodeHierarchy():null);if(t){t.setViewStateManager(this)}this._scene=t;return this};p.prototype._setNodeHierarchy=function(t){var e=this._nodeHierarchy;if(this._nodeHierarchy){this._nodeHierarchy=null;this._selectedNodes.clear();this._visibilityTracker.clear()}if(t){this._nodeHierarchy=t;this._nodeHierarchy.attachNodeReplaced(this._handleNodeReplaced,this);this._nodeHierarchy.attachNodeUpdated(this._handleNodeUpdated,this);this._nodeHierarchy.attachNodeRemoving(this._handleNodeRemoving,this);this._initialState={visible:[],hidden:[]};var i=this;var r=t.findNodesByName();r.forEach(function(t){(t.isVisible(i._mask)?i._initialState.visible:i._initialState.hidden).push(t)});this.fireVisibilityChanged({visible:this._initialState.visible,hidden:this._initialState.hidden})}if(t!==e){this.fireNodeHierarchyReplaced({oldNodeHierarchy:e,newNodeHierarchy:t})}return this};p.prototype._handleNodeReplaced=function(t){var e=t.getParameter("ReplacedNodeRef");var i=t.getParameter("ReplacementNodeRef");if(this.getSelectionState(e)){this.setSelectionStates(i,e)}};p.prototype._handleNodeUpdated=function(t){var e=t.getParameter("nodeRef");if(this.getSelectionState(e)){this.setSelectionStates([],e);this.setSelectionStates(e,[])}};p.prototype._handleNodeRemoving=function(t){var e=t.getParameter("nodeRef");if(this.getSelectionState(e)){this.setSelectionStates([],e,true,true)}};p.prototype.getNodeHierarchy=function(){return this._nodeHierarchy};p.prototype.getVisibilityChanges=function(){return this.getShouldTrackVisibilityChanges()?this._visibilityTracker.getInfo(this.getNodeHierarchy()):null};p.prototype.getCurrentView=function(){var t=f.getElementById(this.getViewManager());if(!t){return null}var e=t.getActiveView();return e};p.prototype.getVisibilityComplete=function(){var t=this.getNodeHierarchy(),e=t.findNodesByName(),i=[],r=[];e.forEach(function(e){var n=t.createNodeProxy(e);var s=n.getVeId();t.destroyNodeProxy(n);if(s){if(this.getVisibilityState(e)){i.push(s)}else{r.push(s)}}},this);return{visible:i,hidden:r}};p.prototype.resetVisibility=function(){this.setVisibilityState(this._initialState.visible,true,false);this.setVisibilityState(this._initialState.hidden,false,false);this._visibilityTracker.clear();return this};p.prototype.getVisibilityState=function(t){var e=this._mask;if(Array.isArray(t)){return t.map(function(t){return t?t.isVisible(e):false})}return t?t.isVisible(e):false};p.prototype.setVisibilityState=function(t,e,i,r){if(!Array.isArray(t)){t=[t]}var n=Array.isArray(e);var s=[];var a=t;if(i){a=[];t.forEach(function(t,i){var r=this._collectNodesRecursively(t);a=a.concat(r);var o=s.length;s.length=o+r.length;s.fill(n?e[i]:e,o)},this)}else if(!n){s.length=a.length;s.fill(e)}else{s=e}var o=[];var h=new Set;var l=this._mask;var c=a.filter(function(t,e){if(h.has(t)){return false}h.add(t);var i=t?t.isVisible(l)!=s[e]:false;if(i){o.push(s[e])}return i},this);if(c.length>0){var u={visible:[],hidden:[]};c.forEach(function(t,e){if(o[e]){t.setVisible(l,true);u.visible.push(t);if(r){var i=t.parent;while(i){i.setVisible(l,true);i=i.parent}}}else{t.setVisible(l,false);u.hidden.push(t)}},this);if(this.getShouldTrackVisibilityChanges()){c.forEach(this._visibilityTracker.trackNodeRef,this._visibilityTracker)}this.fireVisibilityChanged(u)}return this};p.prototype.enumerateSelection=function(t){this._selectedNodes.forEach(t);return this};p.prototype.getSelectionState=function(t){var e=this._selectedNodes;function i(t){return e.has(t)}return Array.isArray(t)?t.map(i):i(t)};p.prototype._getSelectionComplete=function(){var t=this.getNodeHierarchy(),e=[];function i(e){var i=t.createNodeProxy(e);var r=i.getVeId();t.destroyNodeProxy(i);return r}this._selectedNodes.forEach(function(t){var r=i(t);if(r){e.push(r)}});return{selected:e}};p.prototype._isAncestorSelected=function(t){t=t.parent;while(t){if(this._selectedNodes.has(t)){return true}t=t.parent}return false};p.prototype._updateHighlightColor=function(t,e){var i=e||this._selectedNodes.has(t);t.setSelected(this._mask,i,this._highlightColorABGR);if(t.nodeContentType!==h.Hotspot&&t.nodeContentType!==h.DynamicContent){var r=t.children;for(var n=0,s=r.length;n<s;n++){this._updateHighlightColor(r[n],i)}}};p.prototype.setSelectionState=function(t,e,i,r){if(!Array.isArray(t)){t=[t]}t=(i||this.getRecursiveSelection()?this._collectNodesRecursively(t):t).filter(function(t,e,i){return i.indexOf(t)===e});if(this.getRecursiveSelection()&&!e){t=this._nodeHierarchy._appendAncestors(t)}var n=t.filter(function(t){return this._selectedNodes.has(t)!==e},this);if(n.length>0){n.forEach(function(t){if(t){this._selectedNodes[e?"add":"delete"](t)}},this);n.forEach(function(t){if(t){this._updateHighlightColor(t,e||this._isAncestorSelected(t))}},this);if(!r){this.fireSelectionChanged({selected:e?n:[],unselected:e?[]:n})}}return this};p.prototype.setSelectionStates=function(t,e,i,r){if(!Array.isArray(t)){t=[t]}if(!Array.isArray(e)){e=[e]}t=i||this.getRecursiveSelection()?this._collectNodesRecursively(t):t;e=i||this.getRecursiveSelection()?this._collectNodesRecursively(e):e;if(this.getRecursiveSelection()){e=this._nodeHierarchy._appendAncestors(e,t)}var n=t.filter(function(t){return t&&this._selectedNodes.has(t)===false},this);var s=e.filter(function(t){return t&&this._selectedNodes.has(t)===true},this);if(n.length>0||s.length>0){n.forEach(function(t){this._selectedNodes.add(t);this._updateHighlightColor(t,true)},this);s.forEach(function(t){this._selectedNodes.delete(t)},this);s.forEach(function(t){this._updateHighlightColor(t,this._isAncestorSelected(t))},this);if(!r){this.fireSelectionChanged({selected:n,unselected:s})}}return this};p.prototype._collectNodesRecursively=function(t){var e=[],i=this;if(!Array.isArray(t)){t=[t]}t.forEach(function t(r){e.push(r);i._nodeHierarchy.enumerateChildren(r,t,false,true)});return e};p.prototype._getOpacity=function(t){return t.opacity!==undefined?t.opacity:null};p.prototype.getOpacity=function(t){if(Array.isArray(t)){return t.map(this._getOpacity,this)}else{return this._getOpacity(t)}};p.prototype.setTotalOpacity=function(t,e){this.setOpacity(t,e);return{opacity:e,totalOpacity:e}};p.prototype.setOpacity=function(t,e,i){if(!Array.isArray(t)){t=[t]}var r=Array.isArray(e);if(e===null){e=undefined}else if(r){e.forEach(function(t,i){if(t===null){e[i]=undefined}})}var n=[];var s=t;if(!r){n.length=s.length;n.fill(e)}else{n=e}var a=[];var o=new Set;var h=s.filter(function(t,e){if(o.has(t)){return false}o.add(t);var i=t?t.opacity!==n[e]:false;if(i){a.push(n[e])}return i},this);if(h.length>0){h.forEach(function(t,e){t.setOpacity(a[e])},this);this.fireOpacityChanged({changed:h,opacity:r?a:a[0]})}return this};p.prototype._getTintColorABGR=function(t){return t.tintColor!==undefined?t.tintColor:null};p.prototype._getTintColor=function(t){return t.tintColor!==undefined?n(s(t.tintColor)):null};p.prototype.getTintColor=function(t,e){var i=e?"_getTintColorABGR":"_getTintColor";if(Array.isArray(t)){return t.map(this[i],this)}else{return this[i](t)}};function g(t){switch(typeof t){case"number":return t>>>0;case"string":const e=u.getType("sap.ui.core.CSSColor");return e.isValid(t)?a(r(t)):undefined;default:return undefined}}p.prototype.setTintColor=function(t,e,i){if(!Array.isArray(t)){t=[t]}var r=Array.isArray(e);var n=[];var s=t;if(i){s=[];t.forEach(function(t,i){var a=this._collectNodesRecursively(t);s=s.concat(a);var o=n.length;n.length=o+a.length;n.fill(r?e[i]:e,o)},this)}else if(!r){n.length=s.length;n.fill(e)}else{n=e}var a=[];var o=new Set;var h=s.filter(function(t,e){if(o.has(t)){return false}o.add(t);var i=t?t.tintColor!==g(n[e]):false;if(i){a.push(n[e])}return i},this);if(h.length>0){var l=this._mask;var c=[];h.forEach(function(t,e){var i=g(a[e]);t.setTintColor(l,i);c.push(i)},this);var u={changed:h,tintColor:r?a:a[0],tintColorABGR:r?c:c[0]};this.fireTintColorChanged(u)}return this};p.prototype.setHighlightColor=function(t){t=g(t);if(t===undefined){return this}this._highlightColorABGR=t;if(this._selectedNodes.size>0){this._selectedNodes.forEach(function(t){this._updateHighlightColor(t,true)},this)}this.fireHighlightColorChanged({highlightColor:n(s(t)),highlightColorABGR:t});return this};p.prototype.getHighlightColor=function(t){return t?this._highlightColorABGR:n(s(this._highlightColorABGR))};p.prototype.getTransformationWorld=function(t){function e(t){return c._decompose(t._matrixWorld())}if(!Array.isArray(t)){return e(t)}var i=[];t.forEach(function(t){i.push(e(t))});return i};p.prototype.getTransformation=function(t){function e(t){var e=c._decompose(t.matrix);return{translation:e.position,quaternion:e.quaternion,scale:e.scale}}if(!Array.isArray(t)){return e(t)}var i=[];t.forEach(function(t){i.push(e(t))});return i};function v(t){if(t.length===3){return new Float32Array([1,0,0,1,t[0],t[1]])}else if(t.length===12){return new Float32Array([t[0],t[1],t[3],t[4],t[9],t[10]])}else if(t.length===16){return new Float32Array([t[0],t[1],t[4],t[5],t[12],t[13]])}else{throw new Error("Invalid matrix format")}}p.prototype.setTransformation=function(e,i){var r=Array.isArray(e);if(!Array.isArray(e)){e=[e]}var n={changed:[],transformation:[]};var s=function(t){return c._decompose(t.matrix)};if(!i){e.forEach(function(t){if(t.userData.matrix){t.setMatrix(t.userData.matrix);delete t.userData.matrix}n.changed.push(t);n.transformation.push(s(t))},this)}else{if(!Array.isArray(i)){i=[i]}e.forEach(function(e,r){if(!e.userData.matrix){e.userData.matrix=e.matrix.slice()}var a=i[r];if(a.transform){e.setMatrix(v(a.transform))}else{var o;if(a.quaternion){o=a.quaternion}else if(a.angleAxis){var h=a.angleAxis;var l=h[3]/2,u=Math.sin(l);o=[h[0]*u,h[1]*u,h[2]*u,Math.cos(l)]}else if(a.euler){t.warning("svg.ViewStateManager.setTransformation: Euler angles are not yet supported");o=[0,0,0,1]}var f=c._compose(a.translation,o,a.scale);e.setMatrix(f)}n.changed.push(e);n.transformation.push(s(e))},this)}if(!r){n.changed=n.changed[0];n.transformation=n.transformation[0]}this.fireTransformationChanged(n);return this};p.prototype._resetNodesStatusByCurrentView=function(t){var e=this.getNodeHierarchy();var i=t.getNodeInfos();if(!e||!i){return}var r=[];var n=[];i.forEach(function(t){if(t.target){if(t.transform){r.push(t.target);n.push({transform:t.transform})}else if(t[o.Translate]&&t[o.Rotate]&&t[o.Scale]){r.push(t.target);n.push({translation:t[o.Translate].slice(),quaternion:t[o.Rotate].slice(),scale:t[o.Scale].slice()})}}});if(t.userData&&t.userData.nodeStartDataByAnimation){t.userData.nodeStartDataByAnimation.forEach(function(t,e){if(t[o.Translate]&&t[o.Rotate]&&t[o.Scale]){r.push(e);n.push({translation:t[o.Translate].slice(),quaternion:t[o.Rotate].slice(),scale:t[o.Scale].slice()})}})}if(r.length){this.setTransformation(r,n)}var s=[];var a=[];i.forEach(function(t){if(!t.target.userData.skipIt){(t.visible?s:a).push(t.target)}});this.setVisibilityState(e.getChildren()[0].children,false,true);this.setVisibilityState(s,true,false);this.setVisibilityState(a,false,false)};p.prototype._onActivateView=function(t,e,i){var r=this.getViewManager();if(r&&i.source.getId()===r){this.activateView(i.view)}};p.prototype.activateView=function(t){this.fireViewStateApplying({view:t});this._resetNodesStatusByCurrentView(t);this.fireViewStateApplied({view:t});e.getEventBus().publish("sap.ui.vk","viewStateApplied",{source:this,view:t});return this};p.prototype.setJoints=function(t,e){return this};p.prototype._propagateOpacityToJointChildren=function(t,e){return this};p.prototype._setJointNodeMatrix=function(){return this};d=function(){this._visibilityChanges=new Set};d.prototype.getInfo=function(t){var e=[];this._visibilityChanges.forEach(function(i){var r=t.createNodeProxy(i);var n=r.getVeId();t.destroyNodeProxy(r);if(n){e.push(n)}else{e.push(t.getScene().nodeRefToPersistentId(i))}});return e};d.prototype.clear=function(){this._visibilityChanges.clear()};d.prototype.trackNodeRef=function(t){if(this._visibilityChanges.has(t)){this._visibilityChanges.delete(t)}else{this._visibilityChanges.add(t)}};return p});
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/svg/Viewport", ["../Core","../ViewportBase","sap/ui/core/Element","sap/ui/core/ResizeHandler","sap/ui/events/KeyCodes","../Loco","../ViewStateManager","./ViewStateManager","../ViewportHandler","../VisibilityMode","../ZoomTo","../SelectionMode","../NodeContentType","../getResourceBundle","../Messages","./Scene","./OrthographicCamera","../measurements/Surface","./Rectangle","./HotspotHelper","../colorToCSSColor","../cssColorToColor","../colorToABGR","../abgrToColor","./MiniMap","./Element","sap/m/Dialog","sap/base/Log","sap/base/i18n/Localization"],function(t,e,i,s,o,n,a,r,h,l,c,u,f,d,m,p,g,_,v,y,w,C,S,b,x,R,M,E,T){"use strict";var V=e.extend("sap.ui.vk.svg.Viewport",{metadata:{library:"sap.ui.vk",aggregations:{miniMap:{type:"sap.m.Dialog",multiple:false}},events:{cameraChanged:{parameters:{offset:"float[]",zoom:"float"},enableEventBubbling:true},hotspotEnter:{parameters:{nodeRef:"any"},enableEventBubbling:true},hotspotLeave:{parameters:{nodeRef:"any"},enableEventBubbling:true}}}});const A={Top:"Top",Inner:"Inner",Bottom:"Bottom",Unknown:""};var B=V.getMetadata().getParent().getClass().prototype;V.prototype.init=function(){if(B.init){B.init.call(this)}this._measurementSurface=new _;this._resizeListenerId=null;this._animLoopRequestId=0;this._animLoopFunction=this._animLoop.bind(this);this._width=this._height=0;this._camera=new g;this._gestureX=0;this._gestureY=0;this._scene=null;this._selectionRect=new v({material:{lineColor:[.75,.75,0,1],lineStyle:{dashPattern:[2,2]}}});this._styles=new Map;this.raster={rasterImage:document.createElement("canvas"),vectorImage:new Image,bmpCanvas:null,rasterMode:false,useRasterMode:false,delayEnd:false,endRasterModeTimer:null,updateImageTimer:null,bmpDrawRequestId:null,nodesThreshold:2500};this.raster.vectorImage.onload=function(){var t=this.raster.vectorImage;var e=this.raster.rasterImage;e.viewBox=t.viewBox;D(e,t.width,t.height);var i=e.getContext("2d");i.clearRect(0,0,e.width,e.height);i.drawImage(t,0,0,e.width,e.height);this._requestBmpDraw()}.bind(this);this._viewportHandler=new h(this);this._loco=new n(this);this._loco.addHandler(this._viewportHandler,-1);this._hotspotHelper=new y;this._currentViewIndex=0;this._currentView=null;this._pcbRotateAngle=0;this._pcbVisibleSurface=A.Unknown;this._topElements=[];this._bottomElements=[];t.getEventBus().subscribe("sap.ui.vk","viewStateApplied",this._onViewStateApplied,this);T.attachChange(this._onLocalizationChanged.bind(this));const e=this._miniMap=new x({viewport:this});const i=new M({showHeader:false,horizontalScrolling:false,verticalScrolling:false,content:e,escapeHandler:function(){}}).addStyleClass("sapUiVkMiniMapDialog");i.attachBeforeOpen(function(){i.oPopup.setModal(false)});i._calcPosition=()=>{const t=this.getDomRef()?.getBoundingClientRect()??{top:0,right:0};const s=i.getDomRef()?.getBoundingClientRect()??{width:0,height:0};const o=e._lockPosition;return{top:(o.y>=0?t.top+o.y:Math.max(t.bottom+o.y-s.height,t.top))+"px",left:(o.x>=0?t.left+o.x:Math.max(t.right+o.x-s.width,t.left))+"px"}};e.attachSizeChanged(t=>{i.setContentWidth(t.getParameter("width")+4+"px");i.setContentHeight(t.getParameter("height")+4+"px")});this.setMiniMap(i)};V.prototype.exit=function(){T.detachChange(this._onLocalizationChanged);t.getEventBus().unsubscribe("sap.ui.vk","viewStateApplied",this._onViewStateApplied,this);this._loco.removeHandler(this._viewportHandler);this._viewportHandler.destroy();if(this._resizeListenerId){s.deregister(this._resizeListenerId);this._resizeListenerId=null}this._setScene(null);this._renderer=null;this._loco.destroy();this._loco=null;this._viewportHandler=null;this._miniMap=null;B.exit?.call(this);var e=this.getTools();for(var o=0;o<e.length;o++){var n=i.getElementById(e[o]);if(n){n.setActive(false)}}this._measurementSurface.destroy();this._measurementSurface=null;this.raster.rasterMode=false;this.raster.useRasterMode=false};V.prototype._onLocalizationChanged=function(t){var e=this._measurementSurface;if(e&&e.getMeasurements().length>0){e.update(this,this.getCamera())}};V.prototype.onBeforeRendering=function(){if(this._resizeListenerId){s.deregister(this._resizeListenerId);this._resizeListenerId=null}};V.prototype._updateCustomText=function(){const t=this._scene.getRootElement();const e=[];t.traverse(function(t){if(t.type==="Text"){const i=t.style.size;const s=parseFloat(i);if(s>0){let o=1;if(typeof i==="string"){if(i.endsWith("em")){o=16}else if(i.endsWith("pt")){o=1.333}}const n=t._matrixWorld();e.push(s*o*Math.sqrt(n[2]*n[2]+n[3]*n[3]))}}});let i;if(e.length>0){e.sort();i=e[e.length>>1]}else{const e=t.domRef.getBBox();i=Math.max(e.width,e.height)*.01}i=Math.round(i*100)/100;t.traverse(function(t){if(t.customText?.style.size==="0px"){t.customText.style.size=i+"px"}})};V.prototype._updateCustomTextFilters=function(){const t=this._scene?.getRootElement()?.domRef;if(t){const e=this.getHotspotCustomTextHaloWidth();const i=e*.1;const s=this.getHotspotCustomTextOutlineWidth();const o=Math.max(e+i,s*2);const n=C(this.getHotspotCustomTextOutlineColor());for(const a of t.parentNode.getElementsByTagName("filter")){if(a.id.endsWith("-custom-text")){if(sap.ui.Device.browser.firefox){a.setAttribute("x","-25%");a.setAttribute("y","-100%");a.setAttribute("width","150%");a.setAttribute("height","300%")}else{a.setAttribute("x",-o+"px");a.setAttribute("y",-o+"px");a.setAttribute("width",`calc(100% + ${o*2}px)`);a.setAttribute("height",`calc(100% + ${o*2}px)`)}a.childNodes[0].setAttribute("radius",i);a.childNodes[2].setAttribute("stdDeviation",e);a.childNodes[3].setAttribute("radius",s);a.childNodes[5].setAttribute("stdDeviation",s);a.childNodes[4].setAttribute("values",`0 0 0 0 ${n.red/255}, 0 0 0 0 ${n.green/255}, 0 0 0 0 ${n.blue/255}, 0 0 0 ${n.alpha} 0`)}}}};V.prototype.setHotspotCustomTextOutlineColor=function(t){this.setProperty("hotspotCustomTextOutlineColor",t,true);this._updateCustomTextFilters();return this};V.prototype.setHotspotCustomTextOutlineWidth=function(t){this.setProperty("hotspotCustomTextOutlineWidth",t,true);this._updateCustomTextFilters();return this};V.prototype.setHotspotCustomTextHaloWidth=function(t){this.setProperty("hotspotCustomTextHaloWidth",t,true);this._updateCustomTextFilters();return this};V.prototype.onAfterRendering=function(){this._resizeListenerId=s.register(this,this._handleResize.bind(this));var t=this.getDomRef();t.append(this._measurementSurface.getDomRef());if(this._scene){var e=this._scene.getRootElement();e._setDomRef(document.getElementById(e.uid));this._svgElement=e.domRef.parentNode;this._updateCustomText()}this._handleResize({size:{width:t.clientWidth,height:t.clientHeight}});this._miniMap._onContentUpdate()};V.prototype._handleResize=function(t){var e=this._width;var i=this._height;this._width=t.size.width;this._height=t.size.height;this._camera.update(this._width,this._height,false);if((e===0||i===0)&&(!this._camera._initialZoom||this._camera._initialZoom<0||!this._camera._initialPosition)){this.zoomTo(c.All,null,0,0)}else{this._updateViewBox();this.fireCameraChanged({viewBox:this._getViewBox()})}var s=this._measurementSurface.getDomRef();s.style.width=this._width+"px";s.style.height=this._height+"px";const o=this.getMiniMap();o.$().css(o._calcPosition());this.fireResize({size:{width:this._width,height:this._height}});if(this._svgElement!=null){this.raster.bmpCanvas=this._svgElement.previousSibling;this._invalidateRasterImage()}return true};V.prototype.setScene=function(t){return this._setScene(t)};V.prototype._setScene=function(t){if(this._scene){this._scene.getDefaultNodeHierarchy().detachNodeCreated(this._nodeCreatedHandler,this)}this._scene=t;this._currentViewIndex=0;this._currentView=null;this._styles.clear();if(t){this.setCamera(new g);if(this.isECAD()){const t=this._extractLayersZone();this._topElements=[];this._bottomElements=[];this._scanTree(t,this._scene.getRootElement())}var e=this._scene.getDefaultNodeHierarchy();this.raster.useRasterMode=e.findNodesByName().length>this.raster.nodesThreshold;e.attachNodeCreated(this._nodeCreatedHandler,this);var i=t.getInitialView();if(i){this.activateView(i)}this._onContentLoadingFinished()}return this};V.prototype.setCamera=function(t){if(!(t instanceof g)){return this}if(B.setCamera){B.setCamera.call(this,t)}if(t){t.update(this._width,this._height,true);this._updateViewBox()}return this};V.prototype._nodeCreatedHandler=function(t){var e=t.getParameter("nodeRef");if(e._vkGetNodeContentType()===f.Annotation&&e.children&&e.children.length&&e.children[0].type==="Image"){this.invalidate()}};V.prototype.getScene=function(){return this._scene};V.prototype.onSetViewStateManager=function(t){this._viewStateManager=t;this._miniMap.setViewStateManager(t);t.attachOutliningChanged(this._onOutliningOrSelectionChanged,this);t.attachSelectionChanged(this._onOutliningOrSelectionChanged,this)};V.prototype.onUnsetViewStateManager=function(t){t.detachOutliningChanged(this._onOutliningOrSelectionChanged,this);t.detachSelectionChanged(this._onOutliningOrSelectionChanged,this);this._viewStateManager=null;this._miniMap?.setViewStateManager(null)};V.prototype._getViewStateManagerSVG=function(){if(this._viewStateManager){if(this._viewStateManager instanceof r){return this._viewStateManager}if(this._viewStateManager instanceof a&&this._viewStateManager._implementation instanceof r){return this._viewStateManager._implementation}}return null};V.prototype.hitTest=function(t,e,i,s,o){var n=this._getViewStateManagerSVG();if(!n||!this._scene){return null}var a=this._scene.getRootElement();var r=this.getDomRef().getBoundingClientRect();t+=r.x;e+=r.y;function h(t){while(t&&!t.id){t=t.parentElement}if(!t){return null}const e=a.getElementById(t.id);const i=e?._getSceneTreeElement();if(!i){return null}if(o&&i._vkGetNodeContentType()===f.Hotspot||e.userData.customText){return undefined}return e}function l(t,e){const i=document.elementFromPoint(t,e);const s=h(i);if(s!==undefined){return s}for(const i of document.elementsFromPoint(t,e)){const t=h(i);if(t!==undefined){return t}}return null}var c=l(t,e);if(i){var u=3;var d=3;for(var m=e-d;m<e+d&&!c;m++){for(var p=t-u;p<t+u&&!c;p++){c=l(p,m)}}}if(s){return c}return c?c._getSceneTreeElement():null};V.prototype.tap=function(t,e,i){var s=this.getDomRef();if(s){s.focus()}var o=this.hitTest(t,e,true);if(this.isECAD()&&o){const t=this.findElement(o);if(t==null){return this}o=t}if(!i){this.tapObject(o);if(o!=null){this.fireNodeClicked({nodeRef:o,x:t,y:e},true,true)}}else if(!this.getFreezeCamera()){if(o&&this._camera.zoomedObject!==o){this._camera.zoomedObject=o;this.zoomTo(c.Node,this._camera.zoomedObject,.5,.1)}else{this._camera.zoomedObject=null;this.zoomTo(c.Visible,null,.5,0)}}return this};V.prototype.tapObject=function(t){var e={picked:t?[t]:[]};this.fireNodesPicked(e);if(this.isECAD()&&t){const i=t=>{if(t!=null){e.picked.push(t);t.children.forEach(i)}};e.picked=[];i(t)}if(this.getSelectionMode()===u.Exclusive){this.exclusiveSelectionHandler(e.picked)}else if(this.getSelectionMode()===u.Sticky){this.stickySelectionHandler(e.picked)}return this};var I={x:-2,y:-2};var H=2;var z=5;V.prototype.onkeydown=function(t){if(!t.isMarked()){switch(t.keyCode){case o.ARROW_LEFT:case o.ARROW_RIGHT:case o.ARROW_UP:case o.ARROW_DOWN:if(t.ctrlKey||t.altKey||t.metaKey){break}var e={x:0,y:0};switch(t.keyCode){case o.ARROW_LEFT:e.x=-1;break;case o.ARROW_RIGHT:e.x=+1;break;case o.ARROW_UP:e.y=-1;break;case o.ARROW_DOWN:e.y=+1;break;default:break}this.beginGesture(I.x,I.y);if(t.shiftKey){this.pan(z*e.x,z*e.y)}else{this.rotate(H*e.x,H*e.y,true)}this.endGesture();t.preventDefault();t.stopPropagation();break;case 189:case o.PLUS:case o.NUMPAD_MINUS:case o.NUMPAD_PLUS:this.beginGesture(this._width*.5,this._height*.5);this.zoom(t.keyCode===o.PLUS||t.keyCode===o.NUMPAD_PLUS?1.02:.98);this.endGesture();t.preventDefault();t.stopPropagation();break;case o.D:if(t.ctrlKey){this._dumpSceneData()}break;default:break}}};V.prototype._onOutliningOrSelectionChanged=function(t){var e=this.getTools();for(var s=0;s<e.length;s++){var o=i.getElementById(e[s]);var n=o.getGizmoForContainer(this);if(n&&n.handleSelectionChanged){n.handleSelectionChanged(t)}}this._invalidateRasterImage()};V.prototype.setSelectionRect=function(t){var e=document.getElementById(this._selectionRect.uid);if(e){if(t){e.removeAttribute("display");t=this._camera._transformRect(t);e.setAttribute("x",t.x1,t.x2);e.setAttribute("y",t.y1,t.y2);e.setAttribute("width",t.x2-t.x1);e.setAttribute("height",t.y2-t.y1)}else{e.setAttribute("display","none")}}};V.prototype._select=function(t){var e=this._getViewStateManagerSVG();if(e&&this._scene){t=this._camera._transformRect(t);var i=new Set;this._scene.getRootElement()._findRectElementsRecursive(i,t,e._mask);if(this.isECAD()&&i.size!==0){const t=new Set;const e=(t,i)=>{if(t!=null){i.add(t);t.children.forEach(t=>e(t,i))}};i.forEach(i=>{const s=this.findElement(i);if(s!=null){e(s,t)}});return Array.from(t)}return Array.from(i)}return[]};V.prototype.getImage=function(t,e,i,s,o){return null};V.prototype._setContent=function(t){B._setContent.apply(this,arguments);this._setScene(t instanceof p?t:null);if(this._measurementSurface!=null){this._measurementSurface.setScale(1)}return this};V.prototype.onSetContentConnector=function(t){e.prototype.onSetContentConnector.call(this,t);t.attachContentLoadingFinished(this._onContentLoadingFinished,this)};V.prototype.onUnsetContentConnector=function(t){t.detachContentLoadingFinished(this._onContentLoadingFinished,this);e.prototype.onUnsetContentConnector.call(this,t)};V.prototype._onContentLoadingFinished=function(t){if(this._scene){var e=this._scene.getDefaultNodeHierarchy();if(e){var i=this._getViewStateManagerSVG();var s=i&&i._mask||1;var o=this.getShowAllHotspots()?this.getShowAllHotspotsTintColor():null;var n=e.getHotspotNodeRefs();n.forEach(function(t){this._hotspotHelper.updateHotspot(t);if(o!=null){t.setHotspotColor(s,o)}if(this.getDisableHotspotHovering()){t.addClass("sapUiVizKitNonInteractiveHotspot")}},this)}if(this.isECAD()){this._pcbVisibleSurface=A.Bottom;this.flipPcb(true)}if(t&&(!this._camera._initialZoom||this._camera._initialZoom===-1)){this.zoomTo(c.All,null,0,0);this._camera._initialZoom=this._camera.getZoomFactor();this._camera._initialPosition=this._camera.getPosition()}this.invalidate()}};function N(t,e,i){return t+(e-t)*i}function k(t,e,i){i=Math.min(Math.max((i-t)/(e-t),0),1);return i*i*i*(i*(i*6-15)+10)}V.prototype._animLoop=function(){this._animLoopRequestId=0;var t=this._anim;if(t){var e=t.start;var i=t.end;var s=Date.now();var o=Math.min(k(0,1,(s-e.time)/t.duration),1);var n=this._camera.offsetX;var a=this._camera.offsetY;var r=this._camera.zoom;this._camera.offsetX=N(e.offsetX,i.offsetX,o);this._camera.offsetY=N(e.offsetY,i.offsetY,o);this._camera.zoom=N(e.zoom,i.zoom,o);if(this._redlineHandler){this._redlineHandler.pan(this._camera.offsetX-n,this._camera.offsetY-a);this._redlineHandler.zoom(this._camera.zoom/r,this._camera.offsetX,this._camera.offsetY)}this.fireCameraChanged({viewBox:this._getViewBox()});if(this._updateViewBox()&&s-e.time<t.duration){this._animLoopRequestId=window.requestAnimationFrame(this._animLoopFunction)}else{delete this._anim;this._endRasterMode()}}};V.prototype.getCurrentView=function(){return this._currentView};V.prototype._onViewStateApplied=function(t,e,i){if(i.source===this._getViewStateManagerSVG()){this.activateView(i.view)}};V.prototype.activateView=function(e){if(!this._scene){return this}var i=this._scene.getViewGroups();var s=this;if(i){i.forEach(function(t){t.getViews().forEach(function(i){if(i===e){s._currentViewIndex=t.getViews().indexOf(i)}})})}this.fireViewActivated({viewIndex:this._currentViewIndex,view:e});t.getEventBus().publish("sap.ui.vk","viewActivated",{source:this,view:e,viewIndex:this._currentViewIndex});this._currentView=e;var o=e.getCamera();if(o){this.setCamera(o)}var n=e.getTopColor();if(n!=null){if(Array.isArray(n)&&n.length>2){this.setBackgroundColorTop(w({red:Math.floor(n[0]*255),green:Math.floor(n[1]*255),blue:Math.floor(n[2]*255),alpha:n.length>3?n[3]:1}))}else{this.setBackgroundColorTop(n)}}var a=e.getBottomColor();if(a!=null){if(Array.isArray(a)&&a.length>2){this.setBackgroundColorBottom(w({red:Math.floor(a[0]*255),green:Math.floor(a[1]*255),blue:Math.floor(a[2]*255),alpha:a.length>3?a[3]:1}))}else{this.setBackgroundColorBottom(a)}}t.getEventBus().publish("sap.ui.vk","readyForAnimation",{source:this._getViewStateManagerSVG(),view:e,ignoreAnimationPosition:false});this.rerender();if(o?.zoom<=g._MIN_ZOOM){this.zoomTo(c.Visible,null,0,0)}this.fireViewFinished({viewIndex:this._currentViewIndex});return this};V.prototype.resetCurrentView=function(){if(this._currentView){this._getViewStateManagerSVG()._resetNodesStatusByCurrentView(this._currentView);this.rerender()}return this};V.prototype.zoomTo=function(t,e,i,s){if(this._width===0||this._height===0||this._scene==null){return this}var o={min:{x:Infinity,y:Infinity},max:{x:-Infinity,y:-Infinity}};var n=this._getViewStateManagerSVG();(Array.isArray(t)?t:[t]).forEach(function(t){switch(t){case c.All:this._scene.getRootElement()._expandBoundingBoxRecursive(o,-1>>>0);break;case c.Visible:if(n){this._scene.getRootElement()._expandBoundingBoxRecursive(o,n._mask)}break;case c.Selected:if(n){n.enumerateSelection(function(t){t._expandBoundingBoxRecursive(o,-1>>>0)})}break;case c.Node:if(!e){return}if(Array.isArray(e)){e.forEach(function(t){t._expandBoundingBoxRecursive(o,-1>>>0)})}else{e._expandBoundingBoxRecursive(o,-1>>>0)}break;case c.Restore:E.error(d().getText("VIEWPORT_MSG_RESTORENOTIMPLEMENTED"));return;case c.NodeSetIsolation:E.error(d().getText("VIEWPORT_MSG_NODESETISOLATIONNOTIMPLEMENTED"));return;case c.RestoreRemoveIsolation:E.error(d().getText("VIEWPORT_MSG_RESTOREREMOVEISOLATIONNOTIMPLEMENTED"));return;case c.ViewLeft:case c.ViewRight:case c.ViewTop:case c.ViewBottom:case c.ViewBack:case c.ViewFront:return;default:break}}.bind(this));if(o.min.x>=o.max.x||o.min.y>=o.max.y){o={min:{x:0,y:0},max:{x:1,y:1}}}var a=new g;a._zoomTo(o,this._width,this._height,s);this._activateCamera(a,i);return this};V.prototype._activateCamera=function(t,e){if(e>0&&!this._animLoopRequestId){this._anim={start:{time:Date.now(),offsetX:this._camera.offsetX,offsetY:this._camera.offsetY,zoom:this._camera.zoom},end:{offsetX:t.offsetX,offsetY:t.offsetY,zoom:t.zoom},duration:e*1e3};this._startRasterMode();this._animLoopRequestId=window.requestAnimationFrame(this._animLoopFunction)}else{if(this._redlineHandler){this._redlineHandler.pan(t.offsetX-this._camera.offsetX,t.offsetY-this._camera.offsetY);this._redlineHandler.zoom(t.zoom/this._camera.zoom,t.offsetX,t.offsetY)}this._camera.zoom=t.zoom;this._camera.offsetX=t.offsetX;this._camera.offsetY=t.offsetY;this._updateViewBox();this._invalidateRasterImage();this.fireCameraChanged({viewBox:this._getViewBox()})}};V.prototype.beginGesture=function(t,e){this._gestureX=(t-this._camera.offsetX)/this._camera.zoom;this._gestureY=(e-this._camera.offsetY)/this._camera.zoom};V.prototype.endGesture=function(){this._gestureX=0;this._gestureY=0;this._endRasterMode()};function D(t,e,i){if(t.width!==e*devicePixelRatio||t.height!==i*devicePixelRatio){t.width=e*devicePixelRatio;t.height=i*devicePixelRatio;t.style.width=e+"px";t.style.height=i+"px"}}V.prototype.invalidate=function(){e.prototype.invalidate.call(this);if(this.raster){this._invalidateRasterImage()}};V.prototype._invalidateRasterImage=function(){if(this.raster.updateImageTimer){clearTimeout(this.raster.updateImageTimer);this.raster.updateImageTimer=null}if(this.raster.useRasterMode){this.raster.updateImageTimer=setTimeout(this._updateRasterImage.bind(this),100)}};V.prototype._updateRasterImage=function(){this.raster.updateImageTimer=null;if(this._svgElement==null||!this.raster.useRasterMode||!this.raster.bmpCanvas){return}var t=Math.round(Math.max(Math.max(this._width,this._height)*.5,512));var e=this._width+t;var i=this._height+t;var s=e/this._width;var o=i/this._height;var n=this._getViewBox();var a=[n[0]-n[2]*(s-1)*.5,n[1]-n[3]*(o-1)*.5,n[2]*s,n[3]*o];this._svgElement.setAttribute("width",e+"px");this._svgElement.setAttribute("height",i+"px");this._svgElement.setAttribute("viewBox",a.join(" "));var r=(new XMLSerializer).serializeToString(this._svgElement);var h="data:image/svg+xml; charset=utf8, "+encodeURIComponent(r);this._svgElement.setAttribute("width","100%");this._svgElement.setAttribute("height","100%");this._svgElement.setAttribute("viewBox",n.join(" "));this.raster.vectorImage.viewBox=a;this.raster.vectorImage.src=h};V.prototype._startRasterMode=function(t){if(this.raster.endRasterModeTimer){clearTimeout(this.raster.endRasterModeTimer);this.raster.endRasterModeTimer=null}if(this.raster.updateImageTimer){clearTimeout(this.raster.updateImageTimer);this.raster.updateImageTimer=null}if(this.raster.rasterMode||!this.raster.useRasterMode||this._svgElement==null){return}this.raster.rasterMode=true;this.raster.delayEnd=t;this._svgElement.style.display="none";this.raster.bmpCanvas.style.display="block";this._requestBmpDraw()};V.prototype._endRasterMode=function(){if(!this.raster.rasterMode){return}var t=function(){this.raster.bmpCanvas.style.display="none";this._svgElement.style.display="";this.raster.rasterMode=false;this._invalidateRasterImage()}.bind(this);if(this.raster.delayEnd){this.raster.endRasterModeTimer=setTimeout(function(){this.raster.endRasterModeTimer=null;t()}.bind(this),500)}else{t()}};V.prototype.pan=function(t,e){if(!this.getFreezeCamera()){this._startRasterMode();this._camera.offsetX+=t;this._camera.offsetY+=e;this._updateViewBox();if(this._redlineHandler){this._redlineHandler.pan(t,e)}this.fireCameraChanged({viewBox:this._getViewBox()})}};V.prototype.rotate=function(t,e){this.pan(t,e)};V.prototype.zoom=function(t){if(!this.getFreezeCamera()){this._startRasterMode(true);var e=this._camera.zoom;this._camera.zoom=Math.max(this._camera.zoom*t,g._MIN_ZOOM);this._camera.offsetX+=this._gestureX*(e-this._camera.zoom);this._camera.offsetY+=this._gestureY*(e-this._camera.zoom);if(this._redlineHandler){this._redlineHandler.zoom(this._camera.zoom/e)}this._updateViewBox();this.fireCameraChanged({viewBox:this._getViewBox()})}};V.prototype.hover=function(t,e){var i=this._getViewStateManagerSVG();if(!i){return}var s=this.getDisableHotspotHovering()?null:this.hitTest(t,e);var o=false;if(this._hotspotElement&&this._hotspotElement!==s){this.fireHotspotLeave({nodeRef:this._hotspotElement});if(!this.getShowAllHotspots()){this._hotspotElement.setHotspotColor(i._mask,null)}this._hotspotElement=null;o=true}if(this._dynamicContentElement&&this._dynamicContentElement!==s){this.fireHotspotLeave({nodeRef:this._dynamicContentElement});if(!this.getShowAllDynamicContents()){this._dynamicContentElement.setHotspotColor(i._mask,null)}this._dynamicContentElement=null;o=true}if(s&&s._vkGetNodeContentType()===f.Hotspot){this._hotspotElement=s;if(!this.getShowAllHotspots()){s.setHotspotColor(i._mask,this.getHotspotColorABGR())}this.fireHotspotEnter({nodeRef:s});o=true}if(s&&s._vkGetNodeContentType()===f.DynamicContent){this._dynamicContentElement=s;if(!this.getShowAllDynamicContents()){s.setHotspotColor(i._mask,this.getHotspotColorABGR())}this.fireHotspotEnter({nodeRef:s});o=true}if(o){this._invalidateRasterImage()}};V.prototype._getViewBox=function(){return this._camera._getViewBox()};V.prototype._requestBmpDraw=function(){if(this.raster.rasterMode){this.raster.bmpDrawRequestId=this.raster.bmpDrawRequestId||window.requestAnimationFrame(this._bmpDraw.bind(this))}};V.prototype._bmpDraw=function(){this.raster.bmpDrawRequestId=null;var t=this._getViewBox();var e=this.raster.rasterImage;var i=this.raster.bmpCanvas;D(i,this._width,this._height);var s=i.getContext("2d");s.resetTransform();s.clearRect(0,0,i.width,i.height);var o=e.viewBox;if(o){var n=this._camera._worldToScreen(o[0],o[1]);var a=this._camera._worldToScreen(t[0],t[1]);s.translate((n.x-a.x)*devicePixelRatio,(n.y-a.y)*devicePixelRatio);s.scale(o[2]*i.width/(t[2]*e.width),o[3]*i.height/(t[3]*e.height));s.imageSmoothingEnabled=true;s.imageSmoothingQuality="high";s.drawImage(e,0,0)}};V.prototype._updateViewBox=function(){if(this._svgElement==null){return false}this._requestBmpDraw();if(this._measurementSurface!=null){this._measurementSurface.update(this,this.getCamera())}this._svgElement.setAttribute("viewBox",this._getViewBox().join(" "));return true};V.prototype.getViewInfo=function(t){var e={};if(t==null){t={}}if(t.camera==null){t.camera=true}if(t.camera){e.camera={viewBox:this._getViewBox()}}if(t.visibility&&this._viewStateManager){var i=t.visibility.mode==null?l.Complete:t.visibility.mode;e.visibility={mode:i};if(i===l.Complete){var s=this._viewStateManager.getVisibilityComplete();e.visibility.visible=s.visible;e.visibility.hidden=s.hidden}else if(this._viewStateManager.getShouldTrackVisibilityChanges()){e.visibility.changes=this._viewStateManager.getVisibilityChanges()}else{E.warning(d().getText(m.VIT32.summary),m.VIT32.code,"sap.ui.vk.threejs.Viewport")}}var o=this._getViewStateManagerSVG();if(t.selection&&o){e.selection=o._getSelectionComplete()}return e};V.prototype.setViewInfo=function(t,e){var i=t.camera;if(i&&i.viewBox){var s=new g;s._setViewBox(i.viewBox,this._width,this._height);this._activateCamera(s,e)}var o=new Map;if(t.visibility||t.selection){var n=this._viewStateManager.getNodeHierarchy(),a=n.findNodesByName();a.forEach(function(t){var e=n.createNodeProxy(t);var i=e.getVeId();n.destroyNodeProxy(e);if(i){o.set(i,t)}})}if(t.visibility){switch(t.visibility.mode){case l.Complete:const e=t.visibility.visible.map(t=>o.get(t)).filter(t=>t!=null),i=t.visibility.hidden.map(t=>o.get(t)).filter(t=>t!=null);this._viewStateManager.setVisibilityState(e,true,false);this._viewStateManager.setVisibilityState(i,false,false);break;case l.Differences:this._viewStateManager.resetVisibility();t.visibility.changes.forEach(function(t){var e=o.get(t);if(e){this._viewStateManager.setVisibilityState(e,!this._viewStateManager.getVisibilityState(e),false)}},this);break;default:E.error(d().getText(m.VIT28.summary),m.VIT28.code,"sap.ui.vk.threejs.Viewport");break}}var r=this._getViewStateManagerSVG();var h=t.selection;if(h&&r){var c=r._getSelectionComplete();if(Array.isArray(h.selected)){var u=[];var f=[];h.selected.forEach(function(t){var e=o.get(t);if(e){u.push(e)}});c.selected.forEach(function(t){var e=o.get(t);if(e&&h.selected.indexOf(t)<0){f.push(e)}});r.setSelectionStates(u,f,false,false)}}return this};V.prototype.queueCommand=function(t){if(this instanceof V){t()}return this};V.prototype.getOutputSize=function(){var t=this.getDomRef().getBoundingClientRect();var e=t.width;var i=t.height;var s;s=Math.min(e,i);return{left:(e-s)*.5,top:(i-s)*.5,sideLength:s}};V.prototype.setShouldRenderFrame=function(){this.invalidate()};V.prototype._isPanoramicActivated=function(){return false};V.prototype.setShowAllHotspots=function(t){this.setProperty("showAllHotspots",t,true);var e=this._getViewStateManagerSVG();if(e){var i=e._mask;var s=e.getNodeHierarchy().getHotspotNodeRefs();var o=this._hotspotElement;var n=this.getShowAllHotspotsTintColor();s.forEach(function(e){if(t){e.setHotspotColor(i,n)}else if(e===o){e.setHotspotColor(i,this.getHotspotColorABGR())}else{e.setHotspotColor(i,null)}},this);if(s.length>0){this.invalidate()}}};V.prototype.setDisableHotspotHovering=function(t){this.setProperty("disableHotspotHovering",t,true);if(t){this.hover(0,0)}var e=this._getViewStateManagerSVG();if(e){var i=e.getNodeHierarchy().getHotspotNodeRefs();i.forEach(function(e){if(t){e.addClass("sapUiVizKitNonInteractiveHotspot")}else{e.removeClass("sapUiVizKitNonInteractiveHotspot")}})}};V.prototype.setHotspotColorABGR=function(t){this.setProperty("hotspotColorABGR",t,true);this.setProperty("hotspotColor",w(b(t)),true);this.invalidate();return this};V.prototype.setHotspotColor=function(t){this.setProperty("hotspotColor",t,true);this.setProperty("hotspotColorABGR",S(C(t)),true);this.invalidate();return this};V.prototype.showHotspots=function(t,e,i){if(t==null){return this}if(!Array.isArray(t)){t=[t]}var s=e?i||this.getHotspotColorABGR():null;var o=this._getViewStateManagerSVG()._mask;t.forEach(function(t){t.setCustomHotspotColor(o,s)});this.invalidate();return this};V.prototype.setShowAllDynamicContents=function(t){this.setProperty("showAllDynamicContents",t,true);const e=this._getViewStateManagerSVG();if(e){const i=e._mask;const s=e.getNodeHierarchy().getDynamicContentNodeRefs();const o=this._dynamicContentElement;const n=this.getShowAllHotspotsTintColor();s.forEach(function(e){if(t){e.setHotspotColor(i,n)}else if(e===o){e.setHotspotColor(i,this.getHotspotColorABGR())}else{e.setHotspotColor(i,null)}},this);if(s.length>0){this.invalidate()}}};V.prototype._getFillStyleId=function(t){if(t.highlightColor||t.tintColor){return null}var e;if(t.fillStyle&&t.fillStyle.veid!==undefined){e="f"+t.fillStyle.veid}else if(t.fill!==undefined&&t.fill[3]===0){e="fn"}else{return null}if(!this._styles.has(e)){var i=[];t._setFillStyleAttributes(function(t,e){i.push(t,e)});this._styles.set(e,i)}return e};V.prototype._getLineStyleId=function(t){if(t.highlightColor||t.tintColor){return null}var e;if(t.lineStyle&&t.lineStyle.veid!==undefined){e="l"+t.lineStyle.veid}else if(t.materialId){e="m"+t.materialId}else{return null}if(!this._styles.has(e)){var i=[];t._setLineStyleAttributes(function(t,e){i.push(t,e)});this._styles.set(e,i)}return e};V.prototype.getMeasurementSurface=function(){return this._measurementSurface};V.prototype._dumpSceneData=function(){var t=this._scene.getDefaultNodeHierarchy();var e=t.findNodesByName();var i=E.getLevel();E.setLevel(E.Level.INFO);E.info("**************************************");E.info("Nodes in the scene: "+e.length);var s=0;var o=0;var n=0;var a=0;var r=document.getElementsByTagName("svg")[0];var h=function(t){s+=t.children.length;var e=t;var i=1;while(e!=r){e=e.parentNode;i++}if(o<i){o=i}if(t.children.length===0){n++;if(t.tagName==="g"){a++}}for(var l=0;l<t.children.length;l++){h(t.children[l])}};h(r);E.info("DOM statistics:");E.info("    Nodes:      "+s);E.info("    Tree depth: "+o);E.info("    Leaf nodes: "+n);E.info("    Empty nodes:"+a);E.info("    Groups:     "+document.getElementsByTagName("g").length);E.info("    Lines:      "+document.getElementsByTagName("line").length);E.info("    Polylines:   "+document.getElementsByTagName("polyline").length);E.info("    Polygons:   "+document.getElementsByTagName("polygon").length);E.info("    Paths:      "+document.getElementsByTagName("path").length);E.info("    Ellipses:   "+document.getElementsByTagName("ellipse").length);E.info("    Rectangles: "+document.getElementsByTagName("rect").length);E.info("    Texts:      "+document.getElementsByTagName("text").length);E.info("    Images:     "+document.getElementsByTagName("image").length);E.info("**************************************");E.setLevel(i)};V.prototype.projectToScreen=function(t,e,i,s){var o=s._worldToScreen(t,e,0);o.z=0;return o};V.prototype.isECAD=function(){return this._scene?.isECADScene()??false};V.prototype._extractMetadata=function(t){if(t.length!=undefined){const e=new Map;t.forEach(function(t){if(t.category==="ecad"){e.set(t.tag,t.value)}});return e}return null};V.prototype._extractLayersZone=function(){const t=new Map;const e=this._scene.getSceneMetadata();const i=e.find(t=>t.category==="ecad"&&t.tag==="Layers");if(i){const s=i.value.split("|");s.forEach(function(i){const s=e.find(t=>t.category===i&&t.tag==="Zone");t.set(i,s?s.value:A.Unknown)},this)}return t};V.prototype._scanTree=function(t,e){const i=this._extractMetadata(e.userData.metadata||{});if(i){const s=i.get("layer");if(s){const i=t.get(s);switch(i){case A.Top:this._topElements.push(e);break;case A.Bottom:this._bottomElements.push(e);break;default:break}return}}e.children.forEach(this._scanTree.bind(this,t))};function P(t){const e=Math.sin(t);const i=Math.cos(t);return[i,-e,e,i,0,0]}V.prototype._setRootTransform=function(){const t=P(this._pcbRotateAngle);const e=[this._pcbVisibleSurface===A.Top?1:-1,0,0,1,0,0];const i=this._scene.getRootElement();i.setMatrix(R._multiplyMatrices(e,t))};V.prototype.findElement=function(t){while(t!=null){const e=this._extractMetadata(t.userData.metadata??{});if(e?.has("type")){return t}t=t.parent}return null};V.prototype.rotatePcbCW=function(){if(this.isECAD()){this._pcbRotateAngle+=this._pcbVisibleSurface===A.Top?-Math.PI/2:Math.PI/2;this._setRootTransform();this.zoomTo(c.Visible)}};V.prototype.rotatePcbCCW=function(){if(this.isECAD()){this._pcbRotateAngle+=this._pcbVisibleSurface===A.Top?Math.PI/2:-Math.PI/2;this._setRootTransform();this.zoomTo(c.Visible)}};V.prototype.flipPcb=function(t){if(this.isECAD()&&this._viewStateManager){this._pcbVisibleSurface=this._pcbVisibleSurface===A.Top?A.Bottom:A.Top;if(!t){this._setRootTransform();this.zoomTo(c.Visible)}this._viewStateManager.setVisibilityState(this._scene.getRootElement(),false,true,true);switch(this._pcbVisibleSurface){case A.Top:this._viewStateManager.setVisibilityState(this._topElements,true,true,true);break;case A.Bottom:this._viewStateManager.setVisibilityState(this._bottomElements,true,true,true);break;default:break}}};return V});
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/svg/ViewportRenderer", ["./Element","../abgrToColor","../cssColorToColor"],function(t,e,o){"use strict";var r={apiVersion:2};r.render=function(r,a){r.openStart("div",a);r.class("sapVizKitViewport");r.attr("tabindex",0);r.attr("aria-label","Image");r.attr("role","figure");r.style("width",a.getWidth());r.style("height",a.getHeight());r.style("background-image","linear-gradient("+a.getBackgroundColorTop()+","+a.getBackgroundColorBottom()+")");r.openEnd();r.openStart("canvas");r.style("display","none");r.style("position","absolute");r.openEnd();r.close("canvas");r.openStart("svg");r.attr("id",a.getId()+"-svg");r.attr("width","100%");r.attr("height","100%");r.attr("viewBox",a._getViewBox().join(" "));r.style("position","absolute");r.openEnd();var n=a.getScene();if(n){var l=a._getViewStateManagerSVG();var i=new Map;var s=e(l._highlightColorABGR);var u=e(a.getHotspotColorABGR());var p=o(a.getShowAllHotspotsTintColor());const d=a.getHotspotCustomTextHaloWidth();const f=d*.1;const g=o(a.getHotspotCustomTextOutlineColor());const h=a.getHotspotCustomTextOutlineWidth();const x=Math.max(d+f,h*2);i.set(t._hotspotEffectName(s),s);i.set(t._hotspotEffectName(u),u);i.set(t._hotspotEffectName(p),p);var c=n.getDefaultNodeHierarchy();c.getHotspotNodeRefs().forEach(function(t){var e=t.getHotspotEffectDef();i.set(e.name,e.color)});i.forEach(function(t,e){r.openStart("filter");r.attr("id",e);r.openEnd();r.openStart("feColorMatrix");r.attr("in","SourceGraphic");r.attr("type","matrix");r.attr("values","0 0 0 0 "+t.red/255+", 0 0 0 0 "+t.green/255+", 0 0 0 0 "+t.blue/255+", 0 0 0 "+t.alpha+" 0");r.openEnd();r.close("feColorMatrix");r.close("filter");r.openStart("filter");r.attr("id",e+"-custom-text");if(sap.ui.Device.browser.firefox){r.attr("x","-25%");r.attr("y","-100%");r.attr("width","150%");r.attr("height","300%")}else{r.attr("x",-x+"px");r.attr("y",-x+"px");r.attr("width",`calc(100% + ${x*2}px)`);r.attr("height",`calc(100% + ${x*2}px)`)}r.openEnd();r.openStart("feMorphology");r.attr("in","SourceAlpha");r.attr("result","blurOut");r.attr("operator","dilate");r.attr("radius",f);r.openEnd();r.close("feMorphology");r.openStart("feColorMatrix");r.attr("in","blurOut");r.attr("result","blurOut");r.attr("type","matrix");r.attr("values","0 0 0 0 "+t.red/255+", 0 0 0 0 "+t.green/255+", 0 0 0 0 "+t.blue/255+", 0 0 0 1 0");r.openEnd();r.close("feColorMatrix");r.openStart("feGaussianBlur");r.attr("in","blurOut");r.attr("result","blurOut");r.attr("stdDeviation",d);r.openEnd();r.close("feGaussianBlur");r.openStart("feMorphology");r.attr("in","SourceAlpha");r.attr("result","outline");r.attr("operator","dilate");r.attr("radius",h);r.openEnd();r.close("feMorphology");r.openStart("feColorMatrix");r.attr("in","outline");r.attr("result","outline");r.attr("type","matrix");r.attr("values","0 0 0 0 "+g.red/255+", 0 0 0 0 "+g.green/255+", 0 0 0 0 "+g.blue/255+", 0 0 0 "+g.alpha+" 0");r.openEnd();r.close("feColorMatrix");r.openStart("feGaussianBlur");r.attr("in","outline");r.attr("result","outline");r.attr("stdDeviation",h);r.openEnd();r.close("feGaussianBlur");r.openStart("feBlend");r.attr("in","blurOut");r.attr("in2","outline");r.attr("result","blurOut");r.openEnd();r.close("feBlend");r.openStart("feBlend");r.attr("in","SourceGraphic");r.attr("in2","blurOut");r.openEnd();r.close("feBlend");r.close("filter")});n.getRootElement().render(r,l?l._mask:-1|0,a)}a._selectionRect.render(r,0|0);if(a._styles.size>0){r.openStart("defs");r.openEnd();r.openStart("style");r.openEnd();a._styles.forEach(function(t,e){r.text("."+e+"{\n");for(var o=0;o<t.length;o+=2){r.text(t[o]+":"+t[o+1]+";\n")}r.text("}\n")});r.close("style");r.close("defs")}r.close("svg");a.renderTools(r);a.renderContent(r);r.close("div")};return r},true);
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/threejs/AnimationHelper", ["../thirdparty/three","../View","../AnimationPlayback","../AnimationTrackType","../AnimationTrackValueType","../AnimationTrackValueTypeSize","../AnimationRotateType","../AnimationMath","../TransformationMatrix"],function(e,t,a,r,n,i,o,s,u){"use strict";var f=function(){};f.prototype._getChildNodesWithMaterial=function(e,t){for(var a=0;e.children&&a<e.children.length;a++){var r=e.children[a];if(r&&r.material&&r.material.color){t.push(r)}this._getChildNodesWithMaterial(r,t)}};f.prototype._getVkTrackType=function(e){switch(e.type){case"TRANSLATE":return r.Translate;case"ROTATE":return r.Rotate;case"SCALE":return r.Scale;case"OPACITY":return r.Opacity;case"COLOR":return r.Color;default:return undefined}};f.prototype._getVkTrackValueType=function(e,t){switch(e.type){case"TRANSLATE":return n.Vector3;case"ROTATE":if(t===o.Quaternion){return n.Quaternion}else if(t===o.AngleAxis){return n.AngleAxis}else{return n.Euler}case"SCALE":return n.Vector3;case"OPACITY":return n.Scalar;case"COLOR":return n.Vector3;default:return undefined}};f.prototype.insertEmptyTrack=function(e,t,a,r){var n=this._getVkTrackValueType(e);var i=r.createTrack(null,{trackValueType:n,isAbsoluteValue:e.isAbsoluteValue});if(t&&a){t.setNodeAnimation(a,this._getVkTrackType(e),i,true)}};f.prototype.insertTracks=function(e,t,a,r){e.forEach(function(e){var o=t.get(e.id);var s=r.findTrack(e.id.toString());if(Array.isArray(o)&&o.length){if(!s){var u=this._getVkTrackValueType(o[0],e.rotateType);var f=i.get(u);s=r.createTrack(e.id.toString(),{trackValueType:u,cycleForward:e.cyclicInfo.cyclicEnd,cycleBackward:e.cyclicInfo.cyclicStart,infinite:e.infinite,isAbsoluteValue:o[0].isAbsoluteValue});if(e.times){e.times.forEach(function(t,a){var r;if(u===n.Scalar){r=e.values[a]}else{r=[];for(var i=0;i<f;i++){r.push(e.values[a*f+i])}}s.insertKey(t,r,true)})}}o.forEach(function(e){var t=r.findSequence(e.sequenceId);var n=a.get(e.targetId);if(t&&n){t.setNodeAnimation(n,this._getVkTrackType(e),s,true)}},this)}},this);return this};f.prototype.setInitialNodePositionsFromSubsequentViews=function(e,t,a){if(!e||!e.length){return}var r;var n;var i;var o=new Map;for(var s=e.length-1;s>0;s--){var u=e[s];var f;if(u){f=u.getPlaybacks()}if(f){for(var l=f.length-1;l>=0;l--){var c=f[l];if(c){r=t.findSequence(c.getSequence().getId());if(r){if(a&&!r.hasHighlight()){continue}if(!c.getReversed()){n=r.getNodesBoundaryValues(true).entries()}else{n=r.getNodesBoundaryValues(false).entries()}i=n.next();while(!i.done){o.set(i.value[0],i.value[1]);i=n.next()}}}}}var v=e[s-1];if(v){if(!v.userData){v.userData={}}if(!v.userData.nodeStartDataByAnimation){v.userData.nodeStartDataByAnimation=new Map}n=o.entries();i=n.next();while(!i.done){v.userData.nodeStartDataByAnimation.set(i.value[0],i.value[1]);i=n.next()}}}};f.prototype.setInitialNodePositionsFromPreviousViews=function(e,t,a){if(!e||!e.length){return}var r;var n;var i;var o=new Map;for(var s=0;s<e.length-1;s++){var u=e[s];var f;if(u){f=u.getPlaybacks()}if(f){for(var l=0;l<f.length;l++){var c=f[l];if(c){r=t.findSequence(c.getSequence().getId());if(r){if(a&&!r.hasHighlight()){continue}if(!c.getReversed()){n=r.getNodesBoundaryValues(false).entries()}else{n=r.getNodesBoundaryValues(true).entries()}i=n.next();while(!i.done){o.set(i.value[0],i.value[1]);i=n.next()}}}}}var v=e[s+1];if(v){if(!v.userData){v.userData={}}if(!v.userData.nodeStartDataByAnimation){v.userData.nodeStartDataByAnimation=new Map}n=o.entries();i=n.next();while(!i.done){v.userData.nodeStartDataByAnimation.set(i.value[0],i.value[1]);i=n.next()}}}};f.prototype.setInitialNodePositionsOnView=function(e,t,a){if(!e){return}var r;var n;var i=0;var o=null;o=e.getPlaybacks();if(!o||!o.length){return}if(!e.userData){e.userData={}}if(!e.userData.nodeStartDataByAnimation){e.userData.nodeStartDataByAnimation=new Map}for(var s=o.length-1;s>=i;s--){var u=o[s];var f=t.findSequence(u.getSequence().getId());if(f){if(a&&!f.hasHighlight()){continue}if(u.getReversed()){r=f.getNodesBoundaryValues(false).entries()}else{r=f.getNodesBoundaryValues(true).entries()}n=r.next();while(!n.done){e.userData.nodeStartDataByAnimation.set(n.value[0],n.value[1]);n=r.next()}}}};f.prototype.setInitialNodePositionsFromCurrenetViews=function(e,t,a){if(!e||!e.length){return}for(var r=0;r<e.length;r++){var n=e[r];if(!n){continue}this.setInitialNodePositionsOnView(n,t,a)}};f.prototype.setPlaybackStartTimes=function(e,t){if(!e||!e.length){return}for(var a=0;a<e.length;a++){var r=e[a];if(!r){continue}var n=null;if(r){n=r.getPlaybacks()}if(!n||!n.length){continue}var i=0;for(var o=0;o<n.length;o++){var s=n[o];var u=s.getSequence();if(u){u.resetDuration(true)}s.setStartTime(i);i+=s.getDuration()}}};f.prototype.prepareViewForAnimation=function(t){var a=t.getNodeInfos();if(!a){return}if(!t.userData){t.userData={}}if(!t.userData.nodesDataByView){t.userData.nodesDataByView=new Map}else{return}function r(t){var a=new e.Matrix4;if(t.length===3){a.setPosition((new e.Vector3).fromArray(t))}else if(t.length===12){a.fromArray(u.convertTo4x4(t))}else if(t.length===16){a.fromArray(t)}else{throw"Invalid matrix format"}return a}for(var n=0;n<a.length;n++){var i=a[n];if(!i||!i.target){continue}var o={};if(i.transform){o.position=new e.Vector3;o.scale=new e.Vector3;o.quaternion=new e.Quaternion;var s=r(i.transform);s.decompose(o.position,o.quaternion,o.scale);t.userData.nodesDataByView.set(i.target,o)}}};f.prototype.getNodePositionByView=function(e,t){var a;if(!e){return a}if(!e.userData||!e.userData.nodesDataByView){this.prepareViewForAnimation(e)}if(e.userData&&e.userData.nodesDataByView){a=e.userData.nodesDataByView.get(t)}return a};f.prototype.getNodePositionFromNearestPlayback=function(e,t,a,r){var n;if(!t||!e){return n}var i=t.getPlaybacks();if(!i){return n}var o;var s;var u=0;for(o=0;o<i.length;o++){s=i[o];if(a==s.getSequenceId()){u=s.getStartTime();break}}var f=0;for(o=0;o<i.length;o++){s=i[o];var l=s.getStartTime();if(u<=l){continue}if(a==s.getSequenceId()){continue}var c=e.findSequence(s.getSequenceId());if(c){var v;if(s.getReversed()){v=c.getNodesStartValues()}else{v=c.getNodesEndValues()}var d=v.get(r);if(d&&l>=f){n=d;f=l}}}return n};f.prototype._buildViewInitialState=function(e,t,a){var i=t.indexOf(e);if(i<0){return undefined}var o;var u;var f;var l=new Map;var c=function(e,t,a){var r=l.get(e);if(!r){r={target:e};l.set(e,r)}r[t]=a};var v=function(e,t){if(!e){return}var a=e.getNodeAnimation();if(a){a.forEach(function(e){var a=e.nodeRef;for(var i in r){var o=r[i];var u=e[o];if(u&&u.getKeysCount()){var f=t?0:u.getKeysCount()-1;var l=u.getKey(f);var v=u.getKeysType();var d=0;if(v===n.AngleAxis){d=1}var g=s.interpolate(v,l,l,d,u);c(a,o,g.value)}}})}};for(o=t.length-1;o>=i;o--){f=t[o].getPlaybacks();if(Array.isArray(f)){for(u=f.length-1;u>=0;u--){v(f[u].getSequence(),true)}}}for(o=0;o<i;o++){f=t[o].getPlaybacks();if(Array.isArray(f)){for(u=0;u<f.length;u++){v(f[u].getSequence(),false)}}}return l};f.prototype.buildViewsInitialState=function(e,t){if(!Array.isArray(e)){return}var a=function(e){var t=[];e.forEach(function(e,a){t.push(e)});return t};e.forEach(function(r){var n=this._buildViewInitialState(r,e,t);if(n){r.updateNodeInfos(a(n))}},this)};return f});
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/threejs/BaseNodeProxy", ["../BaseNodeProxy"],function(t){"use strict";var e=t.extend("sap.ui.vk.threejs.BaseNodeProxy",{metadata:{library:"sap.ui.vk"}});e.prototype.init=function(t,e){this._object3D=e};e.prototype.reset=function(){this._object3D=null};e.prototype.getNodeRef=function(){return this._object3D};e.prototype.getNodeId=function(){return this._object3D};e.prototype.getName=function(){return this._object3D.name||"<"+this._object3D.type+">"};e.prototype.getNodeMetadata=function(){return this._object3D.userData.metadata||{}};e.prototype.getHasChildren=function(){return this._object3D.children.length>0};e.prototype.getSceneRef=function(){return this._object3D};return e});
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/threejs/Billboard", ["sap/ui/base/ManagedObject","../thirdparty/three","../thirdparty/html2canvas","../BillboardCoordinateSpace","../BillboardTextEncoding","../BillboardStyle","../BillboardBorderLineStyle","../BillboardHorizontalAlignment","./ThreeUtils","../NodeContentType"],function(t,e,i,r,a,o,n,l,h,s){"use strict";var d=t.extend("sap.ui.vk.threejs.Billboard",{metadata:{library:"sap.ui.vk",properties:{node:{type:"any",defaultValue:new e.Group},text:{type:"string",defaultValue:""},font:{type:"string",defaultValue:""},fontSize:{type:"float",defaultValue:20},fontWeight:{type:"string",defaultValue:"normal"},fontItalic:{type:"boolean",defaultValue:false},textColor:{type:"sap.ui.core.CSSColor",defaultValue:"#fff"},borderColor:{type:"sap.ui.core.CSSColor",defaultValue:"#fff"},borderOpacity:{type:"float",defaultValue:1},backgroundColor:{type:"sap.ui.core.CSSColor",defaultValue:"#fff"},backgroundOpacity:{type:"float",defaultValue:.5},encoding:{type:"sap.ui.vk.BillboardTextEncoding",defaultValue:a.PlainText},width:{type:"float",defaultValue:100},height:{type:"float",defaultValue:100},style:{type:"sap.ui.vk.BillboardStyle",defaultValue:o.None},borderLineStyle:{type:"sap.ui.vk.BillboardBorderLineStyle",defaultValue:n.Solid},borderWidth:{type:"float",defaultValue:2},horizontalAlignment:{type:"sap.ui.vk.BillboardHorizontalAlignment",defaultValue:l.Left},texture:{type:"any",defaultValue:null},material:{type:"any"},link:{type:"string",defaultValue:""},coordinateSpace:{type:"sap.ui.vk.BillboardCoordinateSpace",defaultValue:r.Viewport},position:{type:"any",defaultValue:new e.Vector3(0,0,0)},renderOrder:{type:"int",defaultValue:0}}}});d.prototype._planeGeometry=new e.PlaneGeometry(1,1);d.prototype.init=function(){if(t.prototype.init){t.prototype.init.call(this)}var i=new e.MeshBasicMaterial({depthTest:false,depthWrite:false,transparent:true,alphaTest:.05,premultipliedAlpha:true,side:e.DoubleSide});this.setProperty("material",i,true);this._billboard=new e.Mesh(this._planeGeometry,i);this._needUpdateTexture=true};d.prototype.exit=function(){if(t.prototype.exit){t.prototype.exit.call(this)}if(this._billboard){h.disposeObject(this._billboard);this._billboard=null}};d.prototype.setNode=function(t){if(t instanceof e.Object3D){this.setProperty("node",t,true);t.add(this._billboard);t.matrixAutoUpdate=false;t.isBillboard=true;t.userData.billboard=this;this._traverse(function(t){t.userData.skipIt=true})}return this};d.prototype._traverse=function(t){t(this._billboard)};d.prototype.setEncoding=function(t){this.setProperty("encoding",t,true);this._needUpdateTexture=true;return this};d.prototype.setText=function(t){this.setProperty("text",t,true);this._needUpdateTexture=true;return this};d.prototype.setFont=function(t){this.setProperty("font",t,true);this._needUpdateTexture=true;return this};d.prototype.setFontSize=function(t){this.setProperty("fontSize",t,true);this._needUpdateTexture=true;return this};d.prototype.setFontWeight=function(t){this.setProperty("fontWeight",t,true);this._needUpdateTexture=true;return this};d.prototype.setFontItalic=function(t){this.setProperty("fontItalic",t,true);this._needUpdateTexture=true;return this};d.prototype.setStyle=function(t){this.setProperty("style",t,true);this._needUpdateTexture=true;return this};d.prototype.setWidth=function(t){this.setProperty("width",t,true);this._needUpdateTexture=true;return this};d.prototype.setHeight=function(t){this.setProperty("height",t,true);this._needUpdateTexture=true;return this};d.prototype.setTextColor=function(t){this.setProperty("textColor",t,true);this._needUpdateTexture=true;return this};d.prototype.setBackgroundColor=function(t){this.setProperty("backgroundColor",t,true);this._needUpdateTexture=true;return this};d.prototype.setBackgroundOpacity=function(t){this.setProperty("backgroundOpacity",t,true);this._needUpdateTexture=true;return this};d.prototype.setBorderWidth=function(t){this.setProperty("borderWidth",t,true);this._needUpdateTexture=true;return this};d.prototype.setBorderLineStyle=function(t){this.setProperty("borderLineStyle",t,true);this._needUpdateTexture=true;return this};d.prototype.setBorderColor=function(t){this.setProperty("borderColor",t,true);this._needUpdateTexture=true;return this};d.prototype.setBorderOpacity=function(t){this.setProperty("borderOpacity",t,true);this._needUpdateTexture=true;return this};d.prototype.setHorizontalAlignment=function(t){this.setProperty("horizontalAlignment",t,true);this._needUpdateTexture=true;return this};d.prototype.setLink=function(t){this.setProperty("link",t,true);this._needUpdateTexture=true;return this};d.prototype.setTexture=function(t){this.setProperty("texture",t,true);const e=this._billboard.material;e.map=t;e.needsUpdate=true;e.visible=true;const i=e.userData.prototypeMaterial;if(i){i.map=t;i.needsUpdate=true;i.visible=true}return this};d.prototype.setMaterial=function(t){this.setProperty("material",t,true);this._billboard.material=t;return this};d.prototype.setRenderOrder=function(t){this.setProperty("renderOrder",t,true);this._traverse(function(e){e.renderOrder=t});return this};d.prototype._renderBackground=function(t,e,i,r){t.fillStyle=this.getBackgroundColor();t.strokeStyle=this.getBorderColor();t.lineWidth=r;switch(this.getBorderLineStyle()){default:t.setLineDash([]);break;case n.Dash:t.setLineDash([r*5,r]);break;case n.Dot:t.setLineDash([r*2,r]);break;case n.DashDot:t.setLineDash([r*5,r,r*2,r]);break;case n.DashDotDot:t.setLineDash([r*5,r,r*2,r,r*2,r]);break}var a=r/2;if(this.getStyle()===o.RectangularShape){t.globalAlpha=this.getBackgroundOpacity();if(t.globalAlpha>0){t.fillRect(0,0,e,i)}t.globalAlpha=r>0?this.getBorderOpacity():0;if(t.globalAlpha>0){t.strokeRect(a,a,e-r,i-r)}}else if(this.getStyle()===o.CircularShape){var l=e/2;var h=i/2;var s=e/2;t.beginPath();t.arc(l,h,s-a,0,2*Math.PI);t.closePath();t.globalAlpha=this.getBackgroundOpacity();if(t.globalAlpha>0){t.fill()}t.globalAlpha=r>0?this.getBorderOpacity():0;if(t.globalAlpha>0){t.stroke()}}t.globalAlpha=1;t.setLineDash([])};d.prototype._getFont=function(t){return(this.getFontItalic()?"italic ":"")+this.getFontWeight()+" "+this.getFontSize()*t+"px "+(this.getFont()||"Arial")};d.prototype._renderPlainText=function(t){var i=document.createElement("canvas");var r=i.getContext("2d");var a=this.getFontSize()*t;var l=this._getFont(t);r.font=l;var h=Math.ceil(a);var s=this.getBorderLineStyle()!==n.None?this.getBorderWidth()*t:0;var d=Math.ceil(a*.2+s);var u=this.getText().split("\n");var p=0;u.forEach(function(t){p=Math.max(p,r.measureText(t).width)});var c=this.getLink();if(c.length>0){p=Math.max(p,r.measureText(c).width)}p=Math.ceil(p*.5)*2;var g=u.length+(c.length>0?1:0);var y=Math.ceil(h*g*.5)*2;var f=p+d*2;var x=y+d*2;if(this.getStyle()===o.CircularShape){f=x=Math.max(f,x)}this._width=f/t;this._height=x/t;i.width=e.MathUtils.ceilPowerOfTwo(f);i.height=e.MathUtils.ceilPowerOfTwo(x);this._renderBackground(r,f,x,s);r.font=l;r.textAlign=this.getHorizontalAlignment();r.textBaseline="middle";var m=["left","center","right"].indexOf(r.textAlign);var v=f+p*(m-1)>>1;var b=x-(g-1)*h>>1;r.fillStyle=this.getTextColor();r.filter="blur(0px)";for(var w in u){r.fillText(u[w],v,b+h*w)}if(c.length>0){r.fillStyle="#00f";r.textAlign="right";r.textBaseline="bottom";r.fillText(c,f-d,x-d)}this._setBillboardTexture(i,f,x)};d.prototype._renderHtmlText=function(t){var r=document.createElement("canvas");var a=r.getContext("2d");var l=this.getBorderLineStyle()!==n.None?this.getBorderWidth()*t:0;var h=Math.ceil(l);var s=Math.ceil(this.getWidth()*t)+h*2;var d=Math.ceil(this.getHeight()*t)+h*2;if(this.getStyle()===o.CircularShape){s=d=Math.max(s,d)}this._width=s/t;this._height=d/t;r.width=e.MathUtils.ceilPowerOfTwo(s);r.height=e.MathUtils.ceilPowerOfTwo(d);this._renderBackground(a,s,d,l);var u=this.getLink();if(u.length>0){a.font=this._getFont(t);a.fillStyle="#00f";a.textAlign="right";a.textBaseline="bottom";a.fillText(u,s-h,d-h)}var p=document.createElement("iframe");p.style.visibility="hidden";p.width=(s-h*2)/t;p.height=(d-h*2)/t;p.sandbox="allow-same-origin";document.body.appendChild(p);var c=p.contentDocument||p.contentWindow.document;c.open();c.close();c.body.innerHTML=this.getText();var g=document.createElement("canvas");g.width=p.width*t;g.height=p.height*t;g.style.width=p.width+"px";g.style.height=p.height+"px";var y=g.getContext("2d");y.scale(t,t);this._billboard.material.visible=false;i(c.body,{canvas:g,backgroundColor:null}).then(function(t){if(t.width>0&&t.height>0){r.getContext("2d").drawImage(t,h,h)}setTimeout(this._setBillboardTexture.bind(this,r,s,d),0);document.body.removeChild(p)}.bind(this))};d.prototype._renderText=function(t){var e=this.getFont()||"Arial";var r=this.getFontSize()*1.333;var l=4;var h=1.2;var s=1.25;var d;var u;var p=document.createElement("canvas");p.id="jDVLAnnotationCanvas-"+Math.random().toString(36).substr(2,9);p.style.visibility="hidden";p.style.display="none";var c=2048;var g=1024;var y=Math.pow(2,Math.ceil(Math.log(t)/Math.LN2));p.width=c*y;p.height=g*y;document.body.appendChild(p);var f=p.getContext("2d");var x=Math.min(Math.max(Math.round(this.getFontWeight()/100),1),9)*100;f.font=x+(this.getFontItalic()?" italic ":" ")+r+"px "+e;var m=Math.ceil(r*h);var v=this.getWidth();var b=this.getHeight();var w=this.getBorderLineStyle()!==n.None?this.getBorderWidth():0;var M=(this.getEncoding()===a.PlainText?1024:v)-(l+w)*2;var T=((this.getEncoding()===a.PlainText?1024:this.getHeight())-(l+w)*2)/m|0;var S=0;var _=0;var C=this.getText();var B=this.getLink();var k=this.getEncoding()===a.PlainText?C.split("\n"):[];k.length=Math.min(k.length,B.length>0?T-1:T);function P(t){return t.substr(0,t.length-2)+""}var W=[];if(B.length>0){var D=T-k.length;while(B.length>0&&k.length<D){var A=B;while(f.measureText(A).width>M&&A.length>1){A=A.substring(0,A.length-1)}W.push(A);B=B.substring(A.length,B.length)}if(B.length>0){W[W.length-1]=P(W[W.length-1])}for(var V=0;V<W.length;V++){_=Math.max(f.measureText(W[V]).width,_)}}if(this.getEncoding()===a.PlainText){for(var L=0;L<k.length;L++){S=Math.max(f.measureText(k[L]).width,S)}var U=f.measureText(" ").width;v=Math.max(S,_)+U+l*2;b=(k.length+W.length)*m+l*2}else if(this.getEncoding()===a.HtmlText&&typeof i!="undefined"){d=document.createElement("iframe");d.style.visibility="hidden";d.sandbox="allow-same-origin";document.body.appendChild(d);u=d.contentDocument||d.contentWindow.document;u.open();u.close();u.documentElement.innerHTML=C;(function t(){var e;if(u.styleSheets.length===0){e=u.createElement("style");e.type="text/css";e.appendChild(document.createTextNode(""));u.head.appendChild(e)}e=u.querySelector("style");e.sheet.insertRule("* { margin: 0; padding: 0; line-height: 1; }",0);e.sheet.insertRule("span { line-height: "+s+"; overflow-wrap: break-word;  }",1);var i=e.sheet.cssRules;var r=[];for(var a=0;a<i.length;a++){r.push(i[a].cssText)}e.textContent=r.join("\n");u.body.removeAttribute("style");var o=u.body.querySelectorAll("p");if(o.length>0){o[0].style.marginTop=0;o[0].style.paddingTop="1px";o.forEach(function(t,e){t.style.whiteSpace="normal"})}u.body.querySelectorAll("span").forEach(function(t){var e=t.style.fontFamily.split(",");e.forEach(function(t,i){e[i]='"'+t.trim().replaceAll(/[\u0022\u0027]/g,"")+'"'});t.style.fontFamily=e.join(", ")})})();var E=function(t){function e(t,e){if(e.left<t.left){t.left=e.left}if(e.right>t.right){t.right=e.right}if(e.top<t.top){t.top=e.top}if(e.bottom>t.bottom){t.bottom=e.bottom}}u.body.style.margin=0;u.body.style.padding=0;u.body.style.border=0;var i=u.createElement("div");while(u.body.childNodes.length){var r=u.body.childNodes[0];i.appendChild(r)}u.body.appendChild(i);i.style.margin=0;i.style.padding=0;i.style.border=0;i.style.position="absolute";var a={left:Infinity,top:Infinity,right:-Infinity,bottom:-Infinity};var o;var n;if(t===undefined){i.style.width="min-content";i.style.height="min-content";i.style.overflowWrap="normal";u.querySelectorAll("span").forEach(function(t){e(a,t.getBoundingClientRect())});o=Math.ceil(a.right-a.left);n=Math.ceil(a.bottom-a.top);var h=a.width/a.height;var s=16/9;if(h>s){t={width:o,height:n}}else{var p=o*n;var c=Math.sqrt(p/s);var g=c*s;t={width:Math.ceil(g),height:Math.ceil(c)}}}i.style.width=t.width+"px";i.style.height=t.height+"px";i.style.overflowWrap="normal";u.querySelectorAll("span").forEach(function(t){e(a,t.getBoundingClientRect())});o=Math.ceil(a.right-a.left);if(Math.abs(o-t.width)>l){o=Math.min(o,t.width-2*l)}d.width=o;i.style.width=o+"px";a={left:Infinity,top:Infinity,right:-Infinity,bottom:-Infinity};u.querySelectorAll("p").forEach(function(t){e(a,t.getBoundingClientRect())});n=Math.ceil(a.bottom-a.top);var y={width:o,height:n};while(i.childNodes.length){var f=i.childNodes[0];u.body.appendChild(f)}u.body.removeChild(i);return y};var F={width:Math.ceil(v),height:Math.ceil(b)};F=E(v>0&&b>0?F:undefined);F.width+=l*2;F.height+=l*2;if(v<F.width){v=F.width}if(b<F.height){b=F.height}}v=Math.ceil(v+2*w);b=Math.ceil(b+2*w);if(this.getStyle()===o.CircularShape){v=b=Math.max(v,b)}v*=t;b*=t;var O=Math.pow(2,Math.ceil(Math.log(v)/Math.LN2));var q=Math.pow(2,Math.ceil(Math.log(b)/Math.LN2));O=Math.min(O,p.width);q=Math.min(q,p.height);var I=1;if(v>O||b>q){I=Math.min(O/v,q/b);v*=I;b*=I;t*=I}var j=v;var z=b;this._width=v/t;this._height=b/t;l*=t;w*=t;r*=t;m*=t;S*=t;f.fillStyle=this.getBackgroundColor();f.strokeStyle=this.getBorderColor();f.lineWidth=w;var N=w/2;switch(this.getBorderLineStyle()){default:f.setLineDash([]);break;case n.Dash:f.setLineDash([w*5,w]);break;case n.Dot:f.setLineDash([w*2,w]);break;case n.DashDot:f.setLineDash([w*5,w,w*2,w]);break;case n.DashDotDot:f.setLineDash([w*5,w,w*2,w,w*2,w]);break}var R=this.getBackgroundOpacity();var H=this.getBorderOpacity();if(this.getStyle()===o.RectangularShape){if(R>0){f.globalAlpha=R;f.fillRect(0,0,v,b)}f.globalAlpha=w>0?H:0;if(f.globalAlpha>0){f.strokeRect(N,N,v-w,b-w)}}else if(this.getStyle()===o.CircularShape){var G=v/2;var Q=b/2;var J=Math.min(G,Q);f.beginPath();f.arc(G,Q,J-N,0,2*Math.PI);f.closePath();if(R>0){f.globalAlpha=R;f.fill()}f.globalAlpha=w>0?H:0;if(H>0){f.stroke()}}f.globalAlpha=1;f.setLineDash([]);f.font=x+(this.getFontItalic()?" italic ":" ")+r+"px "+e;f.textAlign="left";f.textBaseline="middle";function K(){if(W.length>0){f.fillStyle="#0000FF";b-=W.length*m;var t=(v-_)*.5;var e=b-w-l+m*.5;for(var i=0;i<W.length;i++){f.fillText(W[i],t,e);e+=m}}}if(this.getEncoding()===a.PlainText){K();f.fillStyle=this.getTextColor();f.strokeStyle=this.getBackgroundColor();f.lineWidth=3;var X=(v-S)*.5;var Y=(b-(k.length-W.length-1)*m)*.5;if(k.length==1){var Z=f.measureText(C);var $=Z.actualBoundingBoxDescent+Z.actualBoundingBoxAscent;f.textAlign="center";f.textBaseline="bottom";X=v*.5;Y=(b-2*w-$)*.5+$+l}for(var tt=0;tt<k.length;tt++){if(this.getStyle()===o.TextGlow){f.strokeText(k[tt],X,Y)}f.fillText(k[tt],X,Y);Y+=m}this._setBillboardTexture(p,j,z);document.body.removeChild(p)}else if(this.getEncoding()===a.HtmlText&&typeof i!="undefined"){K();var et=v-w*2;var it=b-w*2;et/=t;it/=t;d.width=et;d.height=it;d.scale=I;d.sandbox="allow-same-origin";l/=t;u.body.style.width=et-2*l+"px";u.body.style.height=it-2*l+"px";u.body.style.margin=0;u.body.style.padding=l+"px";var rt=document.createElement("canvas");rt.style.width=et+"px";rt.style.height=it+"px";rt.width=et*t;rt.height=it*t;var at=rt.getContext("2d");at.scale(t,t);i(u.documentElement,{canvas:rt,backgroundColor:null,width:et,height:it}).then(function(t){if(t.width>0&&t.height>0){var e=p.getContext("2d");e.scale(I,I);e.drawImage(t,w,w)}setTimeout(this._setBillboardTexture.bind(this,p,j,z),0);document.body.removeChild(d);document.body.removeChild(p)}.bind(this))}else{document.body.removeChild(p)}};d.prototype._setBillboardTexture=function(t,i,r){var a=i/t.width,o=r/t.height;this._billboard.geometry=new e.PlaneGeometry(1,1).setAttribute("uv",new e.Float32BufferAttribute([0,1,a,1,0,1-o,a,1-o],2));var n=new e.CanvasTexture(t);n.magFilter=e.NearestFilter;this.setTexture(n)};var u=new e.Vector4,p=new e.Vector3,c=new e.Vector3,g=new e.Vector3,y=new e.Quaternion,f=new e.Vector3;d.prototype._updateTexture=function(){this._width=this.getWidth();this._height=this.getHeight();if(this.getText()&&!this.getTexture()){this._renderText(window.devicePixelRatio)}};d.prototype._update=function(t,i,a){var o=this.getNode();if(!o||!o.visible){return}if(this._needUpdateTexture){this._needUpdateTexture=false;this._updateTexture()}o.matrix.copy(o.parent.matrixWorld).invert();o.matrix.decompose(o.position,o.quaternion,o.scale);o.matrixWorld.identity();var n=this._billboard;var l=this.getPosition();var h=n.position;var s=1;if(l){h.copy(l)}else{h.setScalar(0)}n.quaternion.copy(i.quaternion);var d=this.getCoordinateSpace();if(d===r.Screen){const t=e.MathUtils.lerp(i.near,i.far,.5+.499*h.z);s=(i.isPerspectiveCamera?2*t:2)/i.projectionMatrix.elements[5];h.set(h.x*s,h.y*s,-t).applyMatrix4(i.matrixWorld);s*=2}else if(d===r.Viewport){if(a.x>a.y){h.x*=a.y/a.x}else{h.y*=a.x/a.y}h.unproject(i);u.copy(h).applyMatrix4(i.matrixWorldInverse).applyMatrix4(i.projectionMatrix);var g=u.x/u.w*.5*a.x,y=u.y/u.w*.5*a.y;s=u.w*2/(a.x*i.projectionMatrix.elements[0]);p.setFromMatrixColumn(i.matrixWorld,0).multiplyScalar(s*(Math.round(g)-g));c.setFromMatrixColumn(i.matrixWorld,1).multiplyScalar(s*(Math.round(y)-y));h.add(p).add(c)}n.scale.set((this._width>=0?this._width:.5*a.x/a.y)*s,(this._height>=0?this._height:.5)*s,1);n.updateMatrix();n.updateMatrixWorld()};d.prototype._ortho2DUpdate=function(t,e){if(!this.visible){return}var i=this.userData.originalTransform;var r=e.near*1.0001;if(Math.abs(i.q.w-1)>.001){r=Math.min(r+e.near*i.s.length()*.5,(e.near+e.far)*.5)}this.position.copy(i.p).multiplyScalar(2/e.projectionMatrix.elements[5]);this.position.z=-1;this.position.multiplyScalar(r).applyMatrix4(e.matrixWorld);y.copy(e.quaternion).multiply(i.q);this.quaternion.copy(y);this.scale.copy(i.s).multiplyScalar(r*.5);this.scale.z=Math.min(r-e.near,this.scale.z*.001);this.matrixWorld.compose(this.position,this.quaternion,this.scale);this.matrix.copy(this.parent.matrixWorld).invert().multiply(this.matrixWorld);this.matrix.decompose(this.position,this.quaternion,this.scale);this.updateMatrixWorld(true)};d.prototype._billboardViewUpdate=function(t,i,r,a,o){if(!this.visible){return}this.parent.matrixWorld.decompose(g,y,f);y.invert().multiply(i.quaternion);this.quaternion.copy(y);if(this._vkGetNodeContentType()===s.Symbol){if(o!=null&&a!==undefined){let t=o._computeWorldOpacity(this);if(a){const r=(new e.Vector3).setFromMatrixColumn(i.matrixWorld,2);t*=Math.max(r.dot(this.userData.direction),0)*.8+.2}this._vkSetOpacityRecursive(t)}u.copy(this.getWorldPosition(g));u.applyMatrix4(i.matrixWorldInverse).applyMatrix4(i.projectionMatrix);var n=u.w*2/(t.getSize(new e.Vector2).x*i.projectionMatrix.elements[0]);this.scale.setScalar(n);if(!this.userData._symbolCenterFixed){if(!this.userData.boundingBox||this.userData.boundingBox.isEmpty()){this._vkCalculateObjectOrientedBoundingBox();if(this.userData.boundingBox.isEmpty()){return}}var l=this.userData.boundingBox.getCenter(new e.Vector3).multiplyScalar(-1);this.traverse(function(t){if(t.geometry){t.position.add(l);t.updateMatrix()}});this._vkCalculateObjectOrientedBoundingBox();this.userData._symbolCenterFixed=true}}this.updateMatrix();this.updateMatrixWorld()};d.prototype._lockToViewportUpdate=function(t,e){var i=0;this.children.forEach(function(t){if(t.visible&&Math.abs(t.quaternion.w-1)>.001){i=Math.max(i,t.scale.length())}});var r=Math.min(e.near*(1.0001+i*.5),(e.near+e.far)*.5);this.position.setFromMatrixColumn(e.matrixWorld,2).multiplyScalar(-r);this.position.add(e.position);this.scale.setScalar(r*2/e.projectionMatrix.elements[5]);this.matrixWorld.compose(this.position,e.quaternion,this.scale);this.matrix.copy(this.parent.matrixWorld).invert().multiply(this.matrixWorld);this.matrix.decompose(this.position,this.quaternion,this.scale);this.updateMatrixWorld(true)};return d});
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/threejs/Callout", ["../thirdparty/three","sap/ui/base/ManagedObject","./Billboard","../thirdparty/html2canvas","./PolylineGeometry","./PolylineMaterial","./PolylineMesh","../BillboardStyle","../LeaderLineMarkStyle","./ThreeUtils"],function(t,e,a,r,i,l,s,o,n,h){"use strict";var p=a.extend("sap.ui.vk.threejs.Callout",{metadata:{library:"sap.ui.vk",properties:{anchorNode:{type:"any",defaultValue:null},depthTest:{type:"boolean",defaultValue:true}}}});p.prototype.init=function(){if(a.prototype.init){a.prototype.init.call(this)}this._lines=[];this._heads=[]};p.prototype.exit=function(){if(a.prototype.exit){a.prototype.exit.call(this)}this._lines.forEach(function(t){h.disposeObject(t)});this._lines=null;this._heads.forEach(function(t){h.disposeObject(t)});this._heads=null};p.prototype._traverse=function(t){a.prototype._traverse.call(this,t);this._lines.forEach(t);this._heads.forEach(t)};p.prototype.setDepthTest=function(t){this.setProperty("depthTest",t,true);this._traverse(function(e){e.material.depthTest=t});return this};var d=new t.Vector4,u=new t.Vector4,c=new t.Vector4,y=new t.Vector2,x=new t.Vector2,m=new t.Vector2,f=new t.Quaternion,v=new t.Matrix4,M=new t.Vector2,g=new t.Vector3,w=new t.Vector3,b=new t.Vector3(0,0,1),_=new t.Matrix4,S=new t.Matrix4;p.prototype._update=function(e,a,r){var i=this.getNode();if(!i||!i.visible){return}if(this._needUpdateTexture){this._needUpdateTexture=false;this._updateTexture()}i.matrix.copy(i.parent.matrixWorld).invert();i.matrix.decompose(i.position,i.quaternion,i.scale);i.matrixWorld.identity();var l=this.getPosition(),s=this._billboard.position;if(l){s.copy(l)}else{s.setScalar(0)}var n=this.getAnchorNode();if(n){s.applyMatrix4(n.matrixWorld)}this._billboard.quaternion.copy(a.quaternion);_.multiplyMatrices(a.projectionMatrix,a.matrixWorldInverse);d.copy(s).applyMatrix4(_);y.copy(d).multiplyScalar(1/d.w).multiply(r);var h=d.w*2/(r.x*a.projectionMatrix.elements[0]);const p=e.userData?.outputSettings;if(p){const t=72;const e=1/25.4;const a=4/3;const i=e*t*a;const l=p.width*i;const s=p.height*i;h*=Math.min(r.x/l,r.y/s)}this._billboard.scale.set(h*this._width,h*this._height,1);g.setFromMatrixColumn(a.matrixWorld,0).multiplyScalar(h*(Math.round(y.x*.5)-y.x*.5));w.setFromMatrixColumn(a.matrixWorld,1).multiplyScalar(h*(Math.round(y.y*.5)-y.y*.5));s.add(g).add(w);this._billboard.updateMatrix();this._billboard.updateMatrixWorld();var D=this.getStyle()===o.CircularShape;var P=a.near;function T(t,e,a){if(t<e){return t-e}else if(t>a){return t-a}return 0}this._lines.forEach(function(e){if(e.userData.targetNode){e.matrix.copy(e.userData.targetNode.matrixWorld)}else{e.matrix.identity()}e.matrixWorld.copy(e.matrix);if(e.isPolylineMesh){e.material.resolution.copy(r)}if(e.isHaloMesh){return}var i=e.geometry.vertices;var l=i[0];var s=i[i.length-2];var o=i[i.length-1];var n=e.userData.startPointMesh;var h=false;var p=[0,i.length-1];if(n!==undefined){l.copy(n.userData.targetVertex)}S.multiplyMatrices(_,e.matrixWorld);if(e.userData.extensionLength>0&&i.length>2){p.push(i.length-2);d.copy(i[i.length-3]).applyMatrix4(S);x.copy(d).multiplyScalar(1/d.w).multiply(r);s.set(Math.sign(x.x-y.x)*.5*(1+e.userData.extensionLength/this._width),0,0);s.applyMatrix4(this._billboard.matrixWorld).applyMatrix4(v.copy(e.matrixWorld).invert())}d.copy(s).applyMatrix4(S);x.copy(d).multiplyScalar(1/d.w).multiply(r);if(D){var g=M.copy(x).sub(y).length();h=g<this._width;M.multiplyScalar(.5/g);o.set(M.x,M.y,0)}else{var w=T(x.x,y.x-this._width,y.x+this._width),W=T(x.y,y.y-this._height,y.y+this._height);h=w===0&&W===0;if(Math.abs(w)>Math.abs(W)){o.set(Math.sign(w)*.5,0,0)}else{o.set(0,Math.sign(W)*.5,0)}}if(h){o.copy(s)}else{o.applyMatrix4(this._billboard.matrixWorld).applyMatrix4(v.copy(e.matrixWorld).invert())}e.geometry.verticesNeedUpdate=true;if(n!==undefined){n.position.copy(n.userData.targetVertex).applyMatrix4(e.matrixWorld);d.copy(n.position).applyMatrix4(_);var C=d.w/(r.x*a.projectionMatrix.elements[0]);n.scale.setScalar(C);n.visible=false;var V=false;if(d.w>=P){u.copy(d);c.copy(i[1]).applyMatrix4(S);if(c.w<P){var O=(u.w-P)/(u.w-c.w);c.sub(u).multiplyScalar(O).add(u)}m.copy(u).multiplyScalar(1/u.w);x.copy(c).multiplyScalar(1/c.w);M.copy(x).sub(m).multiply(r);V=M.length()<n.userData.lineOffset;f.setFromAxisAngle(b,Math.atan2(M.y,M.x));n.quaternion.copy(a.quaternion).multiply(f);n.updateMatrix();n.matrixWorld.copy(n.matrix);n.matrixWorldNeedsUpdate=false;m.multiply(r).sub(y);n.visible=D?m.length()>this._width:Math.abs(m.x)>this._width||Math.abs(m.y)>this._height;if(V||!n.visible){l.copy(i[1])}else{l.set(n.userData.lineOffset,0,0).applyMatrix4(n.matrixWorld).applyMatrix4(v.copy(e.matrixWorld).invert())}}}e.geometry._updateVertices(p);e.computeLineDistances(S,r,a instanceof t.PerspectiveCamera?P:undefined);if(e.userData.haloMesh){e.userData.haloMesh.material.lineLength=e.material.lineLength}}.bind(this))};p.prototype._createMarkMesh=function(e,a,r,i){var l=r===n.Arrow;var s=window.devicePixelRatio;var o=a.width;var h=o*a.haloWidth;i=(Array.isArray(i)||i instanceof Float32Array)&&i.length===2?i:[1,1];var p,d;if(l){p=Math.max(35*i[0],o*5);d=Math.max(15*i[1],o*2)}else{p=d=Math.max(2*i[0],o*2)}p=Math.ceil(p+h*2);d=Math.ceil(d+h*2);var u=document.createElement("canvas");u.width=t.MathUtils.ceilPowerOfTwo(p*s);u.height=t.MathUtils.ceilPowerOfTwo(d*s);var c=u.getContext("2d");var y=p/2,x=d/2;c.fillStyle="#FFF";c.scale(s,s);if(l){c.beginPath();c.moveTo(0,x);c.lineTo(p,0);c.lineTo(p,d);c.closePath();c.fill();var m=p*x/Math.sqrt(p*p+x*x),f=(m-h)/m;var v=p-p*f,M=x*(p*f-h)/p;c.fillStyle=e.getStyle();c.beginPath();c.moveTo(v,x);c.lineTo(p-h,x-M);c.lineTo(p-h,x+M);c.closePath();c.fill()}else{var g=p*.5,w=g-h;c.beginPath();c.ellipse(y,x,g,g,0,0,Math.PI*2);c.fill();c.fillStyle=e.getStyle();c.beginPath();c.ellipse(y,x,w,w,0,0,Math.PI*2);c.fill()}c.fillRect(p-h,x-o*.5,h,o);var b=new t.MeshBasicMaterial({map:new t.CanvasTexture(u),transparent:true,alphaTest:.05,premultipliedAlpha:true,side:t.DoubleSide,depthTest:this.getDepthTest()});var _=new t.PlaneGeometry(p*2,d*2);if(l){_.translate(p,0,0)}var S=new t.Mesh(_,b);S.userData.skipIt=true;S.userData.lineOffset=l?p*2-1:p-h*2;var D=new t.Vector2(p*s/u.width,d*s/u.height);var P=S.geometry.attributes.uv.array;for(var T=0,W=P.length;T<W;T+=2){P[T]*=D.x;P[T+1]=1-(1-P[T+1])*D.y}return S};p.prototype.addLeaderLine=function(t,e,a,r,o,h,p){var d=this.getNode();if(p>0&&t.length<3){t.push(t[t.length-1].clone())}var u=a.userData.lineStyle||{};u.width=u.width||1;u.haloWidth=u.haloWidth||0;u.endCapStyle=u.endCapStyle||0;var c=u.endCapStyle||t.length>2?1:0;var y=(c&&(r!==n.None||u.endCapStyle===0)?1:0)|(c&&(o!==n.None||u.endCapStyle===0)?2:0);var x=new i;x.setVertices(t);var m;if(u.haloWidth>0){var f=new l({color:16777215,lineColor:16777215,linewidth:u.width*(u.haloWidth*2+1),dashCapStyle:u.endCapStyle,segmentCapStyle:c,trimStyle:y,transparent:true,depthTest:this.getDepthTest()});m=new s(x,f);m.userData.skipIt=true;m.userData.targetNode=e;m.matrixAutoUpdate=false;m.renderOrder=this.getRenderOrder();m.isHaloMesh=true;d.add(m);this._lines.push(m)}var v=new l({color:16777215,lineColor:a.color,linewidth:u.width,dashCapStyle:u.endCapStyle,segmentCapStyle:c,trimStyle:y,dashPattern:u.dashPattern||[],dashScale:u.dashPatternScale||1,transparent:true,depthTest:this.getDepthTest()});var M=new s(x,v);M.userData.skipIt=true;M.userData.targetNode=e;M.userData.extensionLength=p;M.userData.haloMesh=m;M.matrixAutoUpdate=false;M.renderOrder=this.getRenderOrder();d.add(M);this._lines.push(M);if(r!==n.None){var g=this._createMarkMesh(a.color,u,r,h);g.userData.targetVertex=x.vertices[0].clone();g.matrixAutoUpdate=false;g.renderOrder=this.getRenderOrder();M.userData.startPointMesh=g;d.add(g);this._heads.push(g)}return M};return p});
/*!
* SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
*/
sap.ui.predefine("sap/ui/vk/threejs/ContentDeliveryService", ["sap/base/Log","sap/ui/base/ManagedObject","../totara/TotaraLoader","../threejs/SceneBuilder","./Material","../thirdparty/three","../getResourceBundle","../ObjectType"],function(e,t,r,n,a,o,i,s){"use strict";var d=t.extend("sap.ui.vk.threejs.ContentDeliveryService",{metadata:{library:"sap.ui.vk",properties:{authorizationHandler:"any",maxActiveRequests:{type:"int",defaultValue:4},consumptionScenario:{type:"string"},maxUrlLength:{type:"int",defaultValue:2048},meshesBatchSize:{type:"int",defaultValue:128},materialsBatchSize:{type:"int",defaultValue:128},geomMeshesBatchSize:{type:"int",defaultValue:128},geomMeshesMaxBatchDataSize:{type:"int",defaultValue:10*1024*1024},annotationsBatchSize:{type:"int",defaultValue:128},tracksBatchSize:{type:"int",defaultValue:128},sequencesBatchSize:{type:"int",defaultValue:128},voxelThreshold:{type:"number",defaultValue:0},skipLowLODRendering:{type:"boolean",defaultValue:true}},events:{cameraChanged:{parameters:{sceneId:{type:"string"},camera:{type:"any"}},enableEventBubbling:true},sceneUpdated:{parameters:{},enableEventBubbling:true},viewGroupUpdated:{parameters:{currentViewGroupId:"string"},enableEventBubbling:true},sceneCompleted:{parameters:{sceneId:{type:"string"}},enableEventBubbling:true},loadingFinished:{parameters:{currentViewId:"string",currentViewGroupId:"string"},enableEventBubbling:true},contentChangesProgress:{parameters:{percent:"float"}},errorReported:{parameters:{error:{type:"any"}}},initialViewCompleted:{parameters:{sceneId:{type:"string"}},enableEventBubbling:true}}},constructor:function(e,a){this._loader=new r;this._loader.setSceneBuilder(new n);t.apply(this,arguments);this._loader.setSkipLowLODRendering(this.getSkipLowLODRendering());this._transientSceneMap=new Map;this._currentNodeHierarchy=null}});d.prototype.getMaxActiveRequests=function(){return this._loader.getMaxActiveRequests()};d.prototype.setMaxActiveRequests=function(e){this._loader.setMaxActiveRequests(e);return this};d.prototype.getConsumptionScenario=function(){return this._loader.getConsumptionScenario()};d.prototype.setConsumptionScenario=function(e){this._loader.setConsumptionScenario(e);return this};d.prototype.getMaxUrlLength=function(){return this._loader.getMaxUrlLength()};d.prototype.setMaxUrlLength=function(e){this._loader.setMaxUrlLength(e);return this};d.prototype.getMeshesBatchSize=function(){return this._loader.getMeshesBatchSize()};d.prototype.setMeshesBatchSize=function(e){this._loader.setMeshesBatchSize(e);return this};d.prototype.getMaterialsBatchSize=function(){return this._loader.getMaterialsBatchSize()};d.prototype.setMaterialsBatchSize=function(e){this._loader.setMaterialsBatchSize(e);return this};d.prototype.getGeomMeshesBatchSize=function(){return this._loader.getGeomMeshesBatchSize()};d.prototype.setGeomMeshesBatchSize=function(e){this._loader.setGeomMeshesBatchSize(e);return this};d.prototype.getGeomMeshesMaxBatchDataSize=function(){return this._loader.getGeomMeshesMaxBatchDataSize()};d.prototype.setGeomMeshesMaxBatchDataSize=function(e){this._loader.setGeomMeshesMaxBatchDataSize(e);return this};d.prototype.getAnnotationsBatchSize=function(){return this._loader.getAnnotationsBatchSize()};d.prototype.setAnnotationsBatchSize=function(e){this._loader.setAnnotationsBatchSize(e);return this};d.prototype.getVoxelThreshold=function(){return this._loader.getVoxelThreshold()};d.prototype.setVoxelThreshold=function(e){this._loader.setVoxelThreshold(e);return this};d.prototype.setSkipLowLODRendering=function(e){this.setProperty("skipLowLODRendering",e,true);this._loader.setSkipLowLODRendering(e);return this};function u(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=Math.random()*16|0,r=e=="x"?t:t&3|8;return r.toString(16).toLowerCase()})}d.prototype.initUrl=function(e,t,n){if(!e.endsWith("/")){e+="/"}var a=this;function o(){a.fireSceneUpdated({})}function i(){var e;if(a._loader&&a._loader.currentSceneInfo){var t=a._loader.getContext(a._loader.currentSceneInfo.id);if(t){e=t.currentViewGroupId}}a.fireViewGroupUpdated({currentViewGroupId:e})}if(!this._loader.running()||this._loader.getUrl()!==e){if(this._loader.running()){var s=this._loader.sceneBuilder;this._loader.dispose();this._loader=new r;this._loader.setSceneBuilder(s)}this._loader.onErrorCallbacks.attach(this._reportError.bind(a));this._loader.onMaterialFinishedCallbacks.attach(o);this._loader.onImageFinishedCallbacks.attach(o);this._loader.onImageDetailsFinishedCallbacks.attach(o);this._loader.onViewGroupUpdatedCallbacks.attach(i);this._loader.setUrl(e);this._loader.setSessionId(n?n:u());return this._loader.run()}else if(!t){this._loader.cleanup()}return Promise.resolve("Loader is ready")};d.prototype._reportError=function(e){this.fireErrorReported(e)};d.prototype._createLoadParam=function(t,r,n,a){var o=this;var i;var s=false;var d;if(this._currentNodeHierarchy){d=this._currentNodeHierarchy.getScene()}var u={root:n,vkScene:d,activateView:a.getActivateView(),enableLogger:a.getEnableLogger(),includeAnimation:a.getIncludeAnimation(),includeBackground:a.getIncludeBackground(),includeHidden:a.getIncludeHidden(),includeParametric:a.getIncludeParametric(),includeMetadata:a.getIncludeMetadata(),includeUsageId:a.getIncludeUsageId(),metadataFilter:a.getMetadataFilter(),pushPMI:a.getPushPMI(),pushViewGroups:a.getPushViewGroups(),useSecureConnection:a.getUseSecureConnection(),onActiveCamera:function(e){var t=false;var r=o._loader.getContext(a.getVeid());if(r&&r.phase<2){i=e;t=true}if(!t){o.fireCameraChanged({sceneId:a.getVeid(),camera:e})}},onInitialSceneFinished:function(e){s=true;t({node:n,camera:i,contentResource:a,initialView:e,annotations:o.getSceneBuilder()._annotations,loader:o})},onSceneCompleted:function(){o.fireSceneCompleted({sceneId:a.getVeid()})},onLoadingFinished:function(){var e,t;if(o._loader&&o._loader.currentSceneInfo){var r=o._loader.getContext(o._loader.currentSceneInfo.id);if(r){e=r.currentViewId;t=r.currentViewGroupId}}o.fireLoadingFinished({source:a,node:n,currentViewId:e,currentViewGroupId:t})},onContentChangesProgress:function(e){o.fireContentChangesProgress({source:e.source,phase:e.phase,percentage:e.percentage})},onInitialViewCompleted:function(){o.fireInitialViewCompleted({sceneId:a.getVeid()})}};var c=function(t){e.warning("Content loading error reported:",JSON.stringify(t.getParameters()));var n;if(t.getParameter("errorText")){n=t.getParameter("errorText")}else if(t.getParameter("error")){n=t.getParameter("error")}else if(t.getParameter("reason")){n=t.getParameter("reason")}else{n="failed to load: unknown reason"}if(s){var a=t.getParameter("error");if(a&&a===4){o.initUrl(this._loader.getUrl(),true)}}else{o.detachErrorReported(c);if(t.getParameter("events")){n=n+"\n"+JSON.stringify(t.getParameter("events"))}r(n)}};o.attachErrorReported(c);return u};d.prototype.load=function(e,t,r){var n=this;var a=t.getNodeProxy();if(a){this._currentNodeHierarchy=a.getNodeHierarchy()}return new Promise(function(a,o){if(!t.getSource()||!t.getVeid()){o(i().getText("CONTENTDELIVERYSERVICE_MSG_NOURLORVEID"));return}n.initUrl(t.getSource(),true);var s=n._createLoadParam(a,o,e,t);if(n._loader){n._loader.request(t.getVeid(),s,r)}})};d.prototype.getSceneBuilder=function(){if(this._loader){return this._loader.getSceneBuilder()}return null};d.prototype.decrementResourceCountersForDeletedTreeNode=function(e){var t=this._loader.getContext(this._loader.currentSceneInfo.id);this._loader.decrementResourceCountersForDeletedTreeNode(t,e)};d.prototype.update=function(e,t,r){var n=this;return new Promise(function(a,o){if(!n._loader){o(i().getText("CONTENTDELIVERYSERVICE_MSG_CONTENTDELIVERYSERVICENOTINITIALISED"));return}n._loader.update(e,t,r).then(function(e){if(n._currentNodeHierarchy){for(var t=0;t<e.replacedNodeRefs.length;t++){n._currentNodeHierarchy.fireNodeReplaced({ReplacedNodeRef:e.replacedNodeRefs[t],ReplacementNodeRef:e.replacementNodeRefs[t],ReplacedNodeId:e.replacedNodeRefs[t],ReplacementNodeId:e.replacementNodeRefs[t]})}}a({sceneVeId:e.sceneVeId,sids:e.sidArray})}).catch(function(e){return o(e)})})};d.prototype.exit=function(){if(this._loader){this._loader.dispose();this._loader=null}this._transientSceneMap=null};d.prototype.loadView=function(t,r,n,a){if(typeof n==="undefined"){n="static"}var o=this;return this._loader.requestView(t,n,r,null,a).then(function(e){if(o._currentNodeHierarchy&&e.updatedNodes){for(var t=0;t<e.updatedNodes.length;t++){o._currentNodeHierarchy.fireNodeUpdated({nodeRef:e.updatedNodes[t]})}}o.fireSceneUpdated({});return e}).catch(function(t){e.error(t);return null})};d.prototype.updatePlaybacks=function(t,r,n){var a=this;return this._loader.requestView(t,"static",r,n,true).then(function(e){if(a._currentNodeHierarchy&&e.updatedNodes){for(var t=0;t<e.updatedNodes.length;t++){a._currentNodeHierarchy.fireNodeUpdated({nodeRef:e.updatedNodes[t]})}}a.fireSceneUpdated({});return e}).catch(function(t){e.error(t);return null})};d.prototype.loadViewGroup=function(t,r,n,a){var o=this;return this._loader.requestViewGroup(t,r,n,a).then(function(e){o.fireSceneUpdated({});return e}).catch(function(t){e.error(t);return null})};d.prototype.loadAnnotation=function(t,r){var n=this;return this._loader.requestAnnotation(t,r).then(function(e){n.fireSceneUpdated({});return e}).catch(function(t){e.error(t);return null})};d.prototype.assignMaterialToNodes=function(t,r,n,o){var i=this;return this._loader.requestMaterial(t,r).then(function(e){function r(e,t,n){if(!t){return}if(t.userData.markedForNotAssigningMaterial){delete t.userData.markedForNotAssigningMaterial;return}if(i._currentNodeHierarchy){var o=i._currentNodeHierarchy.createNodeProxy(t);var d=new a;d.setMaterialRef(e);o.assignMaterial(d);i._currentNodeHierarchy.destroyNodeProxy(o)}if(n){t.children.forEach(function(t){if(!t||t.userData.objectType===s.PMI||t.userData.objectType===s.Hotspot){return}r(e,t,n)})}}if(!o){for(var d=0;d<n.length;d++){r(e,n[d],true)}}else{for(var u=0;u<n.length;u++){n[u].userData.markedForNotAssigningMaterial=true}var c=i._loader.getContext(t);var l=c.root;r(e,l,true)}i.fireSceneUpdated({});return true}).catch(function(t){e.error(t);return false})};d.prototype.replaceMaterialOnNodes=function(t,r,n,a){var o=this;return Promise.all([this._loader.requestMaterial(t,r),this._loader.requestMaterial(t,n)]).then(function(e){var r=e[0];var n=e[1];function i(e,t,r){if(!e){return}if(o._currentNodeHierarchy){var n=o._currentNodeHierarchy.createNodeProxy(e);n.replaceMaterial(t,r);o._currentNodeHierarchy.destroyNodeProxy(n)}e.children.forEach(function(e){i(e,t,r)})}if(!a){var s=o._loader.getContext(t);i(s.root,r,n)}else if(Array.isArray(a)){a.forEach(function(e){i(e,r,n)})}else{i([a],r,n)}o.fireSceneUpdated({});return true}).catch(function(t){e.error(t);return false})};d.prototype.printLogTokens=function(){if(this._loader){this._loader.printLogTokens();return true}else{return false}};return d});
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/threejs/ContentManager", ["./utils/arrayDiff","sap/base/Log","../thirdparty/three","../ContentManager","./Scene","../TransformationMatrix","./PerspectiveCamera","./OrthographicCamera","../Messages","../getResourceBundle","./ContentDeliveryService","./ThreeUtils","./Viewport","./ViewStateManager"],function(e,t,r,a,o,n,i,s,d,l,u,c){"use strict";var h=function(e){Object.defineProperties(this,{source:{value:e.getSource()},sourceType:{value:e.getSourceType()},sourceId:{value:null,writable:true},name:{value:null,writable:true},localMatrix:{value:null,writable:true},children:{value:[]},nodeProxy:{value:null,writable:true},loader:{value:null,writable:true},builder:{value:null,writable:true}});e._shadowContentResource=this};var f=a.extend("sap.ui.vk.threejs.ContentManager",{metadata:{library:"sap.ui.vk"}});var g=f.getMetadata().getParent().getClass().prototype;f.prototype.init=function(){if(g.init){g.init.call(this)}this._shadowContentResources=[]};f.prototype.exit=function(){if(this.defaultCdsLoader){this.defaultCdsLoader.destroy();this.defaultCdsLoader=null}if(this.defaultMataiLoader){this.defaultMataiLoader.destroy();this.defaultMataiLoader=null}if(g.exit){g.exit.call(this)}this._shadowContentResources=null};f.prototype._handleContentChangesProgress=function(e){this.fireContentChangesProgress({phase:e.getParameter("phase"),source:e.getParameter("source"),percentage:e.getParameter("percentage")})};f.prototype._handleContentLoadingFinished=function(e){this.fireContentLoadingFinished({source:e.getParameter("source"),node:e.getParameter("node")})};function p(e){if(e&&e.isMesh){e.castShadow=true;e.receiveShadow=false}if(e&&e.children){for(var t=0;t<e.children.length;t++){p(e.children[t])}}}function v(e,t){if(e){var a=new r.Group;e.add(a);a.name="DefaultLights";a.userData.defaultLights=true;a.private=true;var o=(new r.Box3).setFromObject(e);var n=o.getSize(new r.Vector3);var i=o.getCenter(new r.Vector3);var s=n.length();const v=[new r.Color(.72,.72,.81),new r.Color(.2,.2,.2),new r.Color(.32,.32,.36),new r.Color(.36,.36,.36)];const C=[new r.Vector3,new r.Vector3(2,-.5,-1.5),new r.Vector3(-2,-2.5,1.1),new r.Vector3(-.04,2,.01)];for(var d=0,l=v.length;d<l;d++){const e=new r.DirectionalLight(v[d],Math.PI);e.position.copy(C[d]);e.private=true;e.updateWorldMatrix(false,false);a.add(e)}if(t){p(e);var u=new r.DirectionalLight;u.color.setRGB(.5,.5,.5);u.position.set(0,1,0);u.castShadow=true;u.shadow.mapSize.width=512;u.shadow.mapSize.height=512;var c=2e3;u.shadow.camera.left=-c;u.shadow.camera.right=c;u.shadow.camera.top=c;u.shadow.camera.bottom=-c;u.shadow.camera.far=3500;u.shadow.bias=-1e-4;u.private=true;a.add(u);var h=new r.PlaneGeometry(n.x,n.z);var f=new r.ShadowMaterial;f.opacity=.2;var g=new r.Mesh(h,f);g.rotation.x=-Math.PI/2;g.position.x=i.x;g.position.y=o.min.y-s*.1;g.position.z=i.z;e.add(g);g.receiveShadow=true}}}f.prototype.loadContent=function(e,a){this.fireContentChangesStarted();var n=e||new o(new r.Scene);var i=this;this._loadContentResources(n,a).then(function(r){t.info("Content loading resolved");if(r){for(var a=0;a<r.length;++a){if(!n.getInitialView()&&r[a].initialView){n.setInitialView(r[a].initialView)}n.camera=n.camera||r[a].camera;var o=r[a].contentResource?r[a].contentResource._shadowContentResource:null;if(r[a].loader){if(o){o.loader=r[a].loader}n.loaders=n.loaders||[];n.loaders.push(r[a].loader)}if(r[a].builder){if(o){o.builder=r[a].builder}n.builders=n.builders||[];n.builders.push(r[a].builder)}}if(r.length>0){var s=r[0];n.backgroundTopColor=s.backgroundTopColor;n.backgroundBottomColor=s.backgroundBottomColor;n.renderMode=s.renderMode;n.upAxis=s.upAxis;n.outputSettings=s.outputSettings}}n.getSceneRef().updateMatrixWorld();if(!e){v(n.getSceneRef(),false)}if(n.loaders){i._initSceneWithCDSLoaderIfExists(n,n.loaders)}i.fireContentChangesFinished({content:n})},function(e){t.info("Content loading rejected:",e);var r;if(typeof e==="string"){r=e}else if(e.errorText){r=e.errorText}else if(e.message){r=e.message}r=r||l().getText(d.VIT37.summary);t.error(l().getText("CONTENTMANAGER_MSG_CONTENTRESOURCESFAILEDTOLOAD"),r);i.fireContentChangesFinished({content:null,failureReason:[{error:e,errorMessage:r}]})});return this};f.prototype._findLoader=function(e){if(e._contentManagerResolver&&e._contentManagerResolver.settings&&e._contentManagerResolver.settings.loader){return Promise.resolve(e._contentManagerResolver.settings.loader)}if(e.getSource()){var t=e.getEffectiveSourceType().toLowerCase();var r=this;switch(t){case"stream":{if(this.defaultCdsLoader==null){return new Promise(function(e){var t="sap/ui/vk/threejs/ContentDeliveryService";sap.ui.require([t],function(t){e(r.defaultCdsLoader=new t({authorizationHandler:r._authorizationHandler,consumptionScenario:r._consumptionScenario}))})})}return Promise.resolve(this.defaultCdsLoader)}case"vds":case"vds4":{if(this.defaultMataiLoader==null){return new Promise(function(e){var t="sap/ui/vk/matai/MataiLoader";sap.ui.require([t],function(t){e(r.defaultMataiLoader=new t)})})}return Promise.resolve(this.defaultMataiLoader)}default:break}}return Promise.resolve(null)};const C=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1];f.prototype._loadContentResources=function(t,a){function o(e,t){if(typeof t==="string"){return(e||"")+t}return null}function i(e,t){e??=C;t??=C;return e===t||e.every((e,r)=>e===t[r])}function s(e,t){if(!e&&!t){return true}else if(!!e^!!t){return false}else{return e.source===t.getSource()&&e.sourceType===t.getSourceType()&&e.sourceId===t.getSourceId()&&e.name===t.getName()&&i(e.localMatrix,t.getLocalMatrix())}}function d(e,t){t._shadowContentResource=e;var r=e.nodeProxy.getNodeRef();e.name=t.getName();r.name=e.name;e.sourceId=t.getSourceId();r.sourceId=e.sourceId;if(!i(e.localMatrix,t.getLocalMatrix())){e.localMatrix=t.getLocalMatrix();r.matrix.fromArray(n.convertTo4x4(e.localMatrix));r.matrix.decompose(r.position,r.quaternion,r.scale);r.matrixWorldNeedsUpdate=true}}var l=[];var u=new Map;function f(e){var t=o(e.sourceType,e.source);var r=u.get(t);if(!r){r=[];u.set(t,r)}r.push(e);var a=e.nodeProxy.getNodeRef();a.parent.remove(a);e.children.forEach(function(e){f(e)});e.children.length=0}function g(e,a){var o=new h(e);var n=new r.Group;a.add(n);n.matrixWorldNeedsUpdate=true;o.nodeProxy=t.getDefaultNodeHierarchy().createNodeProxy(n);d(o,e);l.push(e);return o}(function t(r,a,o){var n=0;var i=e(r,a,s,true);i.forEach(function(e){for(;n<e.index;++n){d(r[n],a[n]);t(r[n].children,a[n].getContentResources(),r[n].nodeProxy.getNodeRef())}if(e.type==="delete"){f(r[e.index]);r.splice(e.index,1)}else if(e.type==="insert"){var i=g(a[e.index],o);r.splice(e.index,0,i);t(i.children,a[e.index].getContentResources(),i.nodeProxy.getNodeRef())}++n});for(;n<r.length;++n){d(r[n],a[n]);t(r[n].children,a[n].getContentResources(),r[n].nodeProxy.getNodeRef())}})(this._shadowContentResources,a,t.getSceneRef());var p=[];l.forEach(function(e){var r=e._shadowContentResource.nodeProxy.getNodeRef();var a=o(e.getSourceType(),e.getSource());var n=u.get(a);if(a&&n&&n.length>0){var i=n.pop();var s=i.nodeProxy.getNodeRef();for(var d=0;d<s.children.length;++d){r.add(s.children[d])}if(i.loader){e._shadowContentResource.loader=i.loader}if(i.builder){e._shadowContentResource.builder=i.builder}t.getDefaultNodeHierarchy().destroyNodeProxy(i.nodeProxy);i.nodeProxy=null}else{var l=this;p.push(this._findLoader(e).then(function(t){if(t){if(t.attachContentChangesProgress){t.attachContentChangesProgress(l._handleContentChangesProgress,l)}if(t.attachContentLoadingFinished){t.attachContentLoadingFinished(l._handleContentLoadingFinished,l)}else if(t.attachLoadingFinished){t.attachLoadingFinished(l._handleContentLoadingFinished,l)}}if(typeof t==="function"){return t(r,e,l._authorizationHandler,l._retryCount)}else if(t&&t.load){return t.load(r,e,l._authorizationHandler,l._retryCount)}else{return Promise.resolve({node:r,contentResource:e})}}))}},this);function v(e,t){if(t){t.removeNode(e);return}var a=[];var o=[];c.getAllTHREENodes([e],a,o);var n=new Map;var i=new Map;a.forEach(function(e){if(e instanceof r.Mesh){if(!i.has(e.geometry.uuid)){c.disposeGeometry(e);i.set(e.geometry.uuid,true)}if(e.material){if(!n.has(e.material.uuid)){c.disposeMaterial(e.material);n.set(e.material.uuid,true)}}if(e.userData&&e.userData.originalMaterial&&e.userData.originalMaterial.uuid!==e.material.uuid&&!n.has(e.userData.originalMaterial.uuid)){c.disposeMaterial(e.userData.originalMaterial);n.set(e.userData.originalMaterial.uuid,true)}}if(e.parent){e.parent.remove(e)}});o.forEach(function(e){if(e.parent){e.parent.remove(e)}});n.clear();i.clear()}u.forEach(function(e,t){for(var r=0;r<e.length;++r){var a=e[r];v(a.nodeProxy.getNodeRef(),a.builder);if(a.builder){a.builder.cleanup()}if(a.loader){if(a.loader._loader&&a.loader._loader.sceneBuilder){a.loader._loader.removeContext(a.loader._loader.currentSceneInfo.id);a.loader._loader.sceneBuilder.cleanup()}if(a.loader.detachContentChangesProgress){a.loader.detachContentChangesProgress(this._handleContentChangesProgress,this)}if(a.loader.detachContentLoadingFinished){a.loader.detachContentLoadingFinished(this._handleContentLoadingFinished,this)}if(a.loader.detachLoadingFinished){a.loader.detachLoadingFinished(this._handleContentLoadingFinished,this)}}}},this);if(a.length===1&&a[0].getName()==null&&a[0].getLocalMatrix()==null){a[0]._shadowContentResource.nodeProxy.getNodeRef().userData.skipIt=true}else{a.forEach(function(e){e._shadowContentResource.nodeProxy.getNodeRef().userData.skipIt=false})}return Promise.all(p)};f.prototype._initSceneWithCDSLoaderIfExists=function(e,t){if(t){var r;for(var a=0;a<t.length;a++){if(t[a]instanceof u){r=t[a].getSceneBuilder();break}}if(r){e.setSceneBuilder(r);e.getDefaultNodeHierarchy().attachNodeRemoving(function(e){var t=e.getParameter("nodeRef");if(t.userData.treeNode&&t.userData.treeNode.sid){r.decrementResourceCountersForDeletedTreeNode(t.userData.treeNode.sid)}});return true}}return false};f.prototype.destroyContent=function(e){if(e){e.destroy();this._shadowContentResources=[];if(e.loaders&&Array.isArray(e.loaders)&&e.loaders.length>0){if(e.loaders[0]._loader&&e.loaders[0]._loader.sceneBuilder){e.loaders[0]._loader.removeContext(e.loaders[0]._loader.currentSceneInfo.id);e.loaders[0]._loader.sceneBuilder.cleanup()}if(e.loaders[0].detachContentChangesProgress){e.loaders[0].detachContentChangesProgress(this._handleContentChangesProgress,this)}if(e.loaders[0].detachContentLoadingFinished){e.loaders[0].detachContentLoadingFinished(this._handleContentLoadingFinished,this)}else if(e.loaders[0].detachLoadingFinished){e.loaders[0].detachLoadingFinished(this._handleContentLoadingFinished,this)}}else if(e.builders&&Array.isArray(e.builders)){e.builders.forEach(function(e){if(e){e.cleanup()}})}}return this};f.prototype.createOrthographicCamera=function(){return new s};f.prototype.createPerspectiveCamera=function(){return new i};return f});
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/threejs/DetailView", ["../thirdparty/three","sap/ui/base/ManagedObject","../thirdparty/html2canvas","../DetailViewType","../DetailViewShape","./OrthographicCamera","./PerspectiveCamera"],function(e,t,r,i,a,o,n){"use strict";var s=t.extend("sap.ui.vk.threejs.DetailView",{metadata:{library:"sap.ui.vk",properties:{name:{type:"string",defaultValue:""},camera:{type:"any",defaultValue:null},type:{type:"sap.ui.vk.DetailViewType",defaultValue:i.DetailView},shape:{type:"sap.ui.vk.DetailViewShape",defaultValue:a.Box},borderWidth:{type:"float",defaultValue:2},backgroundColor:{type:"sap.ui.core.CSSColor",defaultValue:"#fff"},borderColor:{type:"sap.ui.core.CSSColor",defaultValue:"#000"},origin:{type:"any",defaultValue:new e.Vector2(0,0)},size:{type:"any",defaultValue:new e.Vector2(.5,.5)},attachmentPoint:{type:"any",defaultValue:null},metadata:{type:"any",defaultValue:{}},veId:{type:"any",defaultValue:{}},visibleNodes:{type:"any",defaultValue:null},targetNodes:{type:"any",defaultValue:null}}}});s.prototype.init=function(){if(t.prototype.init){t.prototype.init.call(this)}this._backgroundColor=new e.Color;this._node=new e.Group;var r=new e.MeshBasicMaterial({depthTest:false});this._line=new e.Mesh(new e.BufferGeometry,r);this._line.renderOrder=0;this._node.add(this._line);var i=new e.BufferGeometry;i.setIndex([0,1,2]);var a=new e.MeshBasicMaterial({color:this._backgroundColor,depthTest:false});this._triangle=new e.Mesh(i,a);this._triangle.renderOrder=1;this._node.add(this._triangle);this._billboard=new e.Mesh(new e.BufferGeometry,new e.MeshBasicMaterial({depthTest:false}));this._billboard.renderOrder=2;this._node.add(this._billboard);this._border=new e.Mesh(new e.BufferGeometry,r);this._border.renderOrder=3;this._node.add(this._border)};s.prototype.setCamera=function(e){if(e instanceof n||e instanceof o){this.setProperty("camera",e,true)}return this};s.prototype.setShape=function(e){this.setProperty("shape",e,true);return this};s.prototype.setBackgroundColor=function(e){this.setProperty("backgroundColor",e,true);this._backgroundColor.setStyle(e);this._triangle.material.color.copy(this._backgroundColor);return this};s.prototype.setBorderColor=function(e){this.setProperty("borderColor",e,true);this._border.material.map=null;return this};s.prototype.setBorderWidth=function(e){this.setProperty("borderWidth",e,true);this._border.material.map=null;return this};s.prototype.setOrigin=function(t){if(t instanceof e.Vector2){this.setProperty("origin",t,true)}return this};s.prototype.setSize=function(t){if(t instanceof e.Vector2){this.setProperty("size",t,true)}return this};var l=-.5,h=1.5,u=new e.Vector4,d=new e.Vector3,p=new e.Vector3,c=new e.Vector3,f=new e.Vector2,y=new e.Vector2,v=new e.Vector2,b=new e.Matrix4;function _(e,t){return Math.PI*(3*(e+t)-Math.sqrt((3*e+t)*(e+3*t)))}function g(e,t,r,i,a,o){var n=e[t],s=e[t+1],l=e[a],h=e[a+1],u=e[o],d=e[o+1],p=i-s,c=n-r;var f=((l-n)*p+(h-s)*c)/((l-u)*p+(h-d)*c);e[a]=l+(u-l)*f;e[a+1]=h+(d-h)*f}function m(e,t,r,i){f.set(e[r+1]-e[t+1],e[t]-e[r]).normalize().multiplyScalar(i);e[t]+=f.x;e[t+1]+=f.y;e[r]+=f.x;e[r+1]+=f.y}function x(e,t){var r=e.length;for(var i=0;i<6;i+=3){var a=i===0?t*l:t*h;var o=e[i],n=e[i+1];for(var s=i;s<r-6;s+=6){var u=e[s],d=e[s+1];e[s]=o;e[s+1]=n;o=e[s+6];n=e[s+7];m(e,s,s+6,a);if(s>i){g(e,s-6,u,d,s,s+6)}}}}s.prototype._createBoxViewport=function(t,r,i,a){var o=[-t,-r,0,t,-r,0,t,r,0,-t,r,0];var n=this._billboard.geometry;n.setIndex([0,1,2,0,2,3]);n.setAttribute("position",new e.Float32BufferAttribute(o,3));n.setAttribute("uv",new e.Float32BufferAttribute([0,0,1,0,1,1,0,1],2));if(this._border.visible){var s=[],l;for(l=0;l<o.length;l+=3){var h=o[l],u=o[l+1];s.push(h,u,0,h,u,0)}s.push(s[0],s[1],0,s[0],s[1],0);x(s,this._borderWidth);l=s.length-6;s[0]=s[l];s[l+1]=s[1];s[3]=s[l+3];s[l+4]=s[4];this._createBorderGeometry(this._border.geometry,s)}};s.prototype._createCircleViewport=function(t,r,i,a){var o=[0,0,0],n=[.5,.5],s=[];var l=e.MathUtils.clamp(Math.round(_(t,r)/24),32,256);var u=2*Math.PI/l;for(var d=0;d<l;d++){var p=d*u,c=Math.cos(p),y=Math.sin(p);o.push(c*t,y*r,0);n.push(c*.5+.5,y*.5+.5);s.push(0,d+1,d+1<l?d+2:1)}var v=this._billboard.geometry;v.setIndex(s);v.setAttribute("position",new e.Float32BufferAttribute(o,3));v.setAttribute("uv",new e.Float32BufferAttribute(n,2));var b=this._borderWidth*h;this._createCircleBorder(o,t,r,i&&f.set(i.x/(t+b),i.y/(r+b)).length()>1?i:null,a)};s.prototype._createCircleBorder=function(t,r,i,o,n){var s=this._borderWidth,u=[],d,p,c;if(o&&(n!==a.Circle&&n!==a.CircleLine)){u.push(o.x,o.y,0,o.x,o.y,0);var y=Math.PI*.05;var v=Math.atan2(o.y*r,o.x*i)+y;var b=t.length/3-3;y=2*(Math.PI-y)/b;for(d=0;d<=b;d++){var _=v+d*y;p=Math.cos(_)*r;c=Math.sin(_)*i;u.push(p,c,0,p,c,0)}var g=[o.x,o.y,0,u[6],u[7],0,u[u.length-3],u[u.length-2],0];u.push(o.x,o.y,0,o.x,o.y,0);x(u,s);d=u.length-6;var m=f.set(u[9],u[10]).sub(o).length();var w=f.set(u[9]-u[d-3],u[10]-u[d-2]).length()*.5;var M=o.length();M=1-s*2*m/(w*M);u[d+0]=u[0]=o.x*M;u[d+1]=u[1]=o.y*M;u[d+3]=u[3]=o.x;u[d+4]=u[4]=o.y;var C=this._triangle.geometry;M=(1+M)*.5;g[0]*=M;g[1]*=M;C.setAttribute("position",new e.Float32BufferAttribute(g,3));this._triangle.visible=true;this._triangle.material.color.set(n===a.SolidPointer||n===a.SolidArrow?this.getBorderColor():this._backgroundColor)}else{this._line.visible=this._line.visible&&o!==null;for(d=3;d<t.length;d+=3){p=t[d];c=t[d+1];u.push(p,c,0,p,c,0)}u.push(u[0],u[1],0,u[0],u[1],0);x(u,s);d=u.length-6;u[d]=u[0]=t[3]+s*l;u[d+3]=u[3]=t[3]+s*h;u[d+1]=u[1]=t[4];u[d+4]=u[4]=t[4]}this._createBorderGeometry(this._border.geometry,u)};s.prototype._createBorderGeometry=function(t,r){var i,a=r.length/3;var o=[];for(i=2;i<a;i+=2){o.push(i-1,i,i-2,i+1,i,i-1)}var n=[];var s=this._borderU;for(i=0;i<a;i+=2){n.push(0,.5,s,.5)}t.setIndex(o);t.setAttribute("position",new e.Float32BufferAttribute(r,3));t.setAttribute("uv",new e.Float32BufferAttribute(n,2))};s.prototype._createLine=function(e){var t=[0,0,0,0,0,0,e.x,e.y,0,e.x,e.y,0];m(t,0,6,-this._borderWidth);m(t,3,9,this._borderWidth);this._createBorderGeometry(this._line.geometry,t)};s.prototype._updateGeometry=function(e,t,r){var i=this.getShape(),o=this.getAttachmentPoint(),n=this.getOrigin();this._border.visible=i!==a.BoxNoOutline;this._line.visible=i===a.BoxLine||i===a.CircleLine;this._triangle.visible=false;if(o){u.copy(o).applyMatrix4(r.matrixWorldInverse).applyMatrix4(r.projectionMatrix);o=u.w>0?o:null;var s=u.x/u.w*t.x/t.y,l=u.y/u.w;c.set(s-n.x,l-n.y,0).multiplyScalar(t.y)}switch(i){default:case a.Box:case a.BoxLine:case a.BoxNoOutline:this._createBoxViewport(e.x,e.y,o?c:null,i);break;case a.Circle:case a.CircleLine:case a.CirclePointer:case a.CircleArrow:case a.CircleBubbles:case a.SolidPointer:case a.SolidArrow:this._createCircleViewport(e.x,e.y,o?c:null,i);break}if(this._line.visible){this._createLine(c)}};s.prototype._updateBorderTexture=function(t){var r=Math.round(this.getBorderWidth()*t);this._borderWidth=r+2;var i=e.MathUtils.ceilPowerOfTwo(this._borderWidth);this._borderU=this._borderWidth/i;this._borderWidth/=t;var a=new ArrayBuffer(i*4);var o=new Uint32Array(a);var n=new e.Color(this.getBorderColor());n=n.r*255|n.g*255<<8|n.b*255<<16|4278190080;o.fill(n&16777215);for(var s=1;s<=r;s++){o[s]=n}var l=new e.DataTexture(new Uint8Array(a),i,1,e.RGBAFormat,e.UnsignedByteType,e.UVMapping,e.ClampToEdgeWrapping,e.ClampToEdgeWrapping,e.LinearFilter,e.LinearFilter);l.needsUpdate=true;this._border.material.map=l;this._border.material.needsUpdate=true;this._line.material=this._border.material};function w(e){var t=e.elements;var r=t[15]===1;var i=2/t[0];var a=2/t[5];var o,n;if(r){o=-t[12]*i;n=-t[13]*a}else{o=t[8]*i;n=t[9]*a}var s=(i+o)*.5;var l=o-s;var h=(a+n)*.5;var u=n-h;return{left:l,top:h,right:s,bottom:u}}function M(e,t){var r=e.elements;var i=r[15]===1;r[0]=2/(t.right-t.left);r[5]=2/(t.top-t.bottom);if(i){r[12]=-(t.right+t.left)/(t.right-t.left);r[13]=-(t.top+t.bottom)/(t.top-t.bottom)}else{r[8]=(t.right+t.left)/(t.right-t.left);r[9]=(t.top+t.bottom)/(t.top-t.bottom)}}function C(t,r,i,a){var o=i.x/a.x;var n=i.y/a.y;u.copy(r).applyMatrix4(t.matrixWorldInverse).applyMatrix4(t.projectionMatrix);var s=(u.x/u.w-o)*.5+.5;var l=(u.y/u.w-n)*.5+.5;var h=w(t.projectionMatrix);var d={};d.left=e.MathUtils.lerp(h.left,h.right,s);d.right=e.MathUtils.lerp(h.left,h.right,s+o);d.top=e.MathUtils.lerp(h.top,h.bottom,1-l-n);d.bottom=e.MathUtils.lerp(h.top,h.bottom,1-l);M(t.projectionMatrix,d)}var B=new e.Vector2;s.prototype._render=function(t,r,a,o,n){t.getSize(B);var s=t.getPixelRatio(),l=this.getOrigin(),h=this._node,c=h.position;if(!this._border.material.map){this._updateBorderTexture(s)}y.copy(this.getSize()).multiplyScalar(B.y*.5);y.set(Math.round(y.x)<<1,Math.round(y.y)<<1);c.set(l.x*B.y/B.x,l.y,0).unproject(r);u.copy(c).applyMatrix4(r.matrixWorldInverse).applyMatrix4(r.projectionMatrix);var f=(u.x/u.w*.5+.5)*B.x,_=(u.y/u.w*.5+.5)*B.y;var g=u.w/(B.x*r.projectionMatrix.elements[0]);h.scale.setScalar(g);d.setFromMatrixColumn(r.matrixWorld,0).multiplyScalar(g*2*(Math.round(f)-f));p.setFromMatrixColumn(r.matrixWorld,1).multiplyScalar(g*2*(Math.round(_)-_));c.add(d).add(p);h.quaternion.copy(r.quaternion);h.updateMatrix();h.updateMatrixWorld();this._updateGeometry(y,B,r);v.copy(y).multiplyScalar(s);if(!this._renderTarget||this._renderTarget.width!==v.x||this._renderTarget.height!==v.y){this._renderTarget=new e.WebGLRenderTarget(v.x,v.y,{minFilter:e.LinearFilter,magFilter:e.NearestFilter,format:e.RGBFormat});this._billboard.material.map=this._renderTarget.texture;this._billboard.material.needsUpdate=true}var m;if(this.getType()===i.Cutaway){m=r;b.copy(m.projectionMatrix);C(m,c,y,B)}else{m=this.getCamera();m.adjustClipPlanes(o);m.update(y.x,y.y);m=m.getCameraRef()}var x=new Set;a.children.forEach(function(e){if(e.userData._vkDynamicObjects){e.userData._vkDynamicObjects.forEach(function(e){if(e.parent){if(e.userData.is2D||e.isBillboard){if(e.visible){x.add(e)}e.visible=false}else{e._vkUpdate(t,m,y)}}})}});if(n?.isDirectionalLight){m.updateMatrixWorld();n.position.setFromMatrixColumn(m.matrixWorld,2);n.updateMatrix();n.updateMatrixWorld(true)}var w=this.getTargetNodes();var M=this.getTargetNodes();if(Array.isArray(M)){w.forEach(function(e){e.userData._visible=e.visible;e.visible=true})}if(Array.isArray(M)){M.forEach(function(e){e.userData._visible=e.visible;e.visible=false})}t.setClearColor(this._backgroundColor,1);t.setRenderTarget(this._renderTarget);t.clear();t.render(a,m);if(m===r){r.projectionMatrix.copy(b)}if(Array.isArray(w)){w.forEach(function(e){e.visible=e.userData._visible})}if(Array.isArray(M)){M.forEach(function(e){e.visible=e.userData._visible})}t.setRenderTarget(null);t.render(this._node,r);a.children.forEach(function(e){if(e.userData._vkDynamicObjects){e.userData._vkDynamicObjects.forEach(function(e){if(e.parent&&(e.userData.is2D||e.isBillboard)){e.visible=x.has(e)}})}})};return s});
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/threejs/HighlightPlayer", ["sap/ui/base/Object","../HighlightDisplayState"],function(t,e){"use strict";var i=t.extend("sap.ui.vk.threejs.HighlightPlayer",{constructor:function(){this._state=e.stopped;this._startTime=0;this._timeElapsed=0;this._highlightsNodesMap=new Map}});i.prototype.reset=function(t,i){this.stop();this._highlightsNodesMap.clear();this._state=e.stopped;if(t&&i){var s=t.getHighlightIdNodesMap();var a=this;s.forEach(function(t,e){var s=i.getHighlight(e);a.addHighlights(s,t)})}return this};i.prototype.setViewStateManager=function(t){this._viewStateManager=t};i.prototype.addHighlights=function(t,e){if(t&&e&&e.length){this._highlightsNodesMap.set(t,{nodes:e})}};i.prototype.start=function(t){if(this._state===e.pausing){this._startTime=t-this._timeElapsed}else{this._startTime=t;this._timeElapsed=0}this._state=e.playing;var i=this._viewStateManager;this._highlightsNodesMap.forEach(function(t,e){var s=[];t.nodes.forEach(function(t){while(t){if(!i.getVisibilityState(t)){i.setVisibilityState(t,true,false);s.push(t)}t=t.parent}});t.hiddenNodes=s.length>0?s:undefined})};i.prototype.play=function(t){if(this._state!==e.playing){return false}this._timeElapsed=t-this._startTime;var i=[];this._highlightsNodesMap.forEach(function(t,e){const s=e.evaluate(this._timeElapsed/1e3);if(s.color!=null){this._viewStateManager.setNodesHighlightColor(t.nodes,s.isCompleted?null:s.color)}if(s.opacity!=null){this._viewStateManager.setOpacity(t.nodes,s.isCompleted?null:s.opacity)}if(s.isCompleted){if(e.isFadeOut()&&t.hiddenNodes!==undefined){this._viewStateManager.setVisibilityState(t.hiddenNodes,false,false)}if(e.isFadeInOut()){i.push(e)}}},this);i.forEach(function(t){this._highlightsNodesMap.delete(t)},this);if(this._highlightsNodesMap.size===0){this._state=e.stopped;return false}return true};i.prototype.stop=function(t){this._timeElapsed=0;this._startTime=0;var i=this;this._highlightsNodesMap.forEach(function(t,e){i._viewStateManager.setNodesHighlightColor(t.nodes,null);i._viewStateManager.setOpacity(t.nodes,null);if(e.isFadeOut()&&t.hiddenNodes!=undefined){i._viewStateManager.setVisibilityState(t.hiddenNodes,false,false)}});this._state=e.stopped;return this};i.prototype.pause=function(t){if(this._state===e.stopped){return this}this._timeElapsed=t-this._startTime;this._state=e.pausing;return this};return i});
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/threejs/HitTester", ["sap/base/Log","../thirdparty/three"],function(e,t){"use strict";const r=31;const n=31;var a=function(){this._maskMaterial=new t.MeshBasicMaterial({side:t.DoubleSide,fog:false});this._depthMaterial=new t.ShaderMaterial({vertexShader:["#include <clipping_planes_pars_vertex>","void main() {","\t#include <data_texture_explicit>","\t#include <begin_vertex>","\t#include <project_vertex>","\t#include <clipping_planes_vertex>","}"].join("\n"),fragmentShader:["#include <clipping_planes_pars_fragment>","void main() {","\t#include <clipping_planes_fragment>","\thighp vec4 value = vec4(fract(vec4(1.0, 255.0, 65025.0, 16581375.0) * gl_FragCoord.z));","\tvalue.xyz -= value.yzw * (1.0 / 255.0);","\tgl_FragColor = value;","}"].join("\n"),side:t.DoubleSide,clipping:true});this._renderTarget=new t.WebGLRenderTarget(r,n,{minFilter:t.NearestFilter,magFilter:t.NearestFilter});this._renderTarget.texture.generateMipmaps=false;this._renderTarget.depthBuffer=true};var i;var l=new t.Matrix4;var o=new t.Frustum;var s=new t.Matrix4;var c=new t.Vector2;var u=new t.Raycaster;var d=new t.Ray;var p=new t.Sphere;var f=[];var g=new Uint8Array(4);var h=new t.Vector3;function v(e){var t=e.parent;while(t){if(t.userData.closed){e=t}t=t.parent}while(e.parent&&e.userData.skipIt){e=e.parent}return e}a.prototype.hitTest=function(e,a,x,_,m,y,C,M,w){if(i?.constructor!==C.constructor){i=new C.constructor}i.copy(C);const b=r>>1;const T=n>>1;const S=0;const j=0;var D=C.view;if(D){const t=D.width/x;const n=D.height/_;i.setViewOffset(D.fullWidth,D.fullHeight,D.offsetX+(e-.5*r)*t,D.offsetY+(a-.5*r)*n,t*r,n*r)}else{i.setViewOffset(x,_,e-r*.5,a-n*.5,r,n)}i.updateMatrixWorld();i.updateProjectionMatrix();l.multiplyMatrices(i.projectionMatrix,i.matrixWorldInverse);o.setFromProjectionMatrix(l);u.setFromCamera(c.set(S,j),i);const P=m.getContextRedBits();const B=m.getContextGreenBits();const F=m.getContextBlueBits();const R=P+B;const I=(1<<P)-1;const $=(1<<B)-1;const O=(1<<F)-1;const k=1/I;const V=1/$;const W=1/O;const z=this._maskMaterial;var A=new t.Color;m.getClearColor(A);var G=m.getClearAlpha();var N=m.autoClear;m.setRenderTarget(this._renderTarget);m.clippingPlanes=M||[];m.autoClear=false;m.setClearColor(0,0);m.clear(true,true,false);var E=z.color;var L=0;f.length=0;var U=w&&w.ignoreUnderlay?null:[];var H=[];var X=w&&w.ignoreOverlay?null:[];function Y(e,t){if(!t){H.push(e)}else if(t<0){if(U){U.push(e)}}else if(X){X.push(e)}}function q(e,r){if(!e.visible||e.userData.selectable===false){return}r=r||e.userData.renderStage;var n=e.geometry;if(n&&e.material){if(n.userData.isPointCloud){Y(e,r)}else if(o.intersectsObject(e)){const a=e.matrixWorld;const i=e.userData.renderGroup;if(i?.boundingSphere){p.setFromPackedArray(i.boundingSphere)}else{if(n.boundingSphere==null){n.computeBoundingSphere()}p.copy(n.boundingSphere)}p.applyMatrix4(a);if(u.ray.intersectsSphere(p)){s.copy(a).invert();d.copy(u.ray).applyMatrix4(s);const l=i?.boundingBox?t.Box3.newFromPackedArray(i.boundingBox):n.boundingBox;if(l==null||d.intersectsBox(l)){Y(e,r)}}}}var a=e.children;for(var i=0,l=a.length;i<l;i++){q(a[i],r)}}q(y);function J(e,t){const r=e.material;e.material=t;if(e.geometry.userData.isPointCloud){t.specularMap=r.specularMap}m.render(e,i);e.material=r}function K(e){L+=1;f.push(e);E.setRGB((L&I)*k,(L>>P&$)*V,(L>>R&O)*W);J(e,z)}if(U!=null&&U.length>0){U.forEach(K);m.clearDepth()}H.forEach(K);if(X!=null&&X.length>0){m.clearDepth();X.forEach(K)}m.readRenderTargetPixels(this._renderTarget,b,T,1,1,g);L=(g[0]>>8-P)+(g[1]>>8-B<<P)+(g[2]>>8-F<<R);let Q=L>0?f[L-1]:null;if(Q){m.clear(true,true,false);J(Q,this._depthMaterial);m.readRenderTargetPixels(this._renderTarget,b,T,1,1,g);const e=(g[0]+(g[1]+(g[2]+g[3]/255)/255)/255)/255*2-1;h.set(S,j,e).unproject(i);if(Q.geometry.userData.isPointCloud&&y.userData._instanceIndexToNodeMap instanceof Map){this._clusterIndexMaterial??=new t.ShaderMaterial({vertexShader:["#include <clipping_planes_pars_vertex>","varying lowp vec3 clusterColor;","void main() {","\t#include <data_texture_explicit>","\t#include <begin_vertex>","\t#include <project_vertex>","\t#include <clipping_planes_vertex>","\thighp int index = int(clusterInstance);",`\tclusterColor.x = float(index & ${I}) * ${k};`,`\tclusterColor.y = float((index >> ${P}) & ${$}) * ${V};`,`\tclusterColor.z = float((index >> ${R}) & ${O}) * ${W};`,"}"].join("\n"),fragmentShader:["#include <clipping_planes_pars_fragment>","varying lowp vec3 clusterColor;","void main() {","\t#include <clipping_planes_fragment>","\tgl_FragColor = vec4(clusterColor, 1.0);","}"].join("\n"),side:t.DoubleSide,clipping:true});m.clear(true,true,false);J(Q,this._clusterIndexMaterial);m.readRenderTargetPixels(this._renderTarget,b,T,1,1,g);const e=(g[0]>>8-P)+(g[1]>>8-B<<P)+(g[2]>>8-F<<R);if(e>0){Q=y.userData._instanceIndexToNodeMap.get(e)??Q}}}m.setRenderTarget(null);m.clippingPlanes=[];m.setClearColor(A,G);m.autoClear=N;return Q?{distance:u.ray.origin.distanceTo(h),point:h,object:v(Q)}:null};a.prototype.hitTestPrecise=function(e,t,r,n,a,i,l){u.setFromCamera(c.set(e/r*2-1,t/n*-2+1),i);if(l&&l.length>0){for(var o in l){var s=l[o];var d=s.distanceToPoint(u.ray.origin),p=-d/s.normal.dot(u.ray.direction);if(p>0){if(d<0){u.near=Math.max(u.near,p)}else{u.far=Math.min(u.far,p)}}else if(d<0){return null}}}var f=u.intersectObjects(a.children,true);if(l&&l.length>0){u.near=0;u.far=Infinity}if(f){for(var g in f){var h=f[g];var x=v(h.object);if(x.visible&&!x.isBillboard&&!x.isDetailView){h.object=x;return h}}}return null};a.prototype.hitTestPoint=function(e,t,r,n,a,i,l){u.setFromCamera(c.set(e/r*2-1,t/n*-2+1),i);if(l&&l.length>0){for(var o in l){var s=l[o];var d=s.distanceToPoint(u.ray.origin),p=-d/s.normal.dot(u.ray.direction);if(p>0){if(d<0){u.near=Math.max(u.near,p)}else{u.far=Math.min(u.far,p)}}else if(d<0){return null}}}var f=u.intersectObjects(a.children,true);if(l&&l.length>0){u.near=0;u.far=Infinity}return f.length===1?f[0].point:null};return a});
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/threejs/MarchingCubes", [],function(){"use strict";var f=new Uint32Array([0,265,515,778,1030,1295,1541,1804,2060,2309,2575,2822,3082,3331,3593,3840,400,153,915,666,1430,1183,1941,1692,2460,2197,2975,2710,3482,3219,3993,3728,560,825,51,314,1590,1855,1077,1340,2620,2869,2111,2358,3642,3891,3129,3376,928,681,419,170,1958,1711,1445,1196,2988,2725,2479,2214,4010,3747,3497,3232,1120,1385,1635,1898,102,367,613,876,3180,3429,3695,3942,2154,2403,2665,2912,1520,1273,2035,1786,502,255,1013,764,3580,3317,4095,3830,2554,2291,3065,2800,1616,1881,1107,1370,598,863,85,348,3676,3925,3167,3414,2650,2899,2137,2384,1984,1737,1475,1226,966,719,453,204,4044,3781,3535,3270,3018,2755,2505,2240,2240,2505,2755,3018,3270,3535,3781,4044,204,453,719,966,1226,1475,1737,1984,2384,2137,2899,2650,3414,3167,3925,3676,348,85,863,598,1370,1107,1881,1616,2800,3065,2291,2554,3830,4095,3317,3580,764,1013,255,502,1786,2035,1273,1520,2912,2665,2403,2154,3942,3695,3429,3180,876,613,367,102,1898,1635,1385,1120,3232,3497,3747,4010,2214,2479,2725,2988,1196,1445,1711,1958,170,419,681,928,3376,3129,3891,3642,2358,2111,2869,2620,1340,1077,1855,1590,314,51,825,560,3728,3993,3219,3482,2710,2975,2197,2460,1692,1941,1183,1430,666,915,153,400,3840,3593,3331,3082,2822,2575,2309,2060,1804,1541,1295,1030,778,515,265,0]);var r=[[],[0,8,3],[0,1,9],[1,8,3,9,8,1],[1,2,10],[0,8,3,1,2,10],[9,2,10,0,2,9],[2,8,3,2,10,8,10,9,8],[3,11,2],[0,11,2,8,11,0],[1,9,0,2,3,11],[1,11,2,1,9,11,9,8,11],[3,10,1,11,10,3],[0,10,1,0,8,10,8,11,10],[3,9,0,3,11,9,11,10,9],[9,8,10,10,8,11],[4,7,8],[4,3,0,7,3,4],[0,1,9,8,4,7],[4,1,9,4,7,1,7,3,1],[1,2,10,8,4,7],[3,4,7,3,0,4,1,2,10],[9,2,10,9,0,2,8,4,7],[2,10,9,2,9,7,2,7,3,7,9,4],[8,4,7,3,11,2],[11,4,7,11,2,4,2,0,4],[9,0,1,8,4,7,2,3,11],[4,7,11,9,4,11,9,11,2,9,2,1],[3,10,1,3,11,10,7,8,4],[1,11,10,1,4,11,1,0,4,7,11,4],[4,7,8,9,0,11,9,11,10,11,0,3],[4,7,11,4,11,9,9,11,10],[9,5,4],[9,5,4,0,8,3],[0,5,4,1,5,0],[8,5,4,8,3,5,3,1,5],[1,2,10,9,5,4],[3,0,8,1,2,10,4,9,5],[5,2,10,5,4,2,4,0,2],[2,10,5,3,2,5,3,5,4,3,4,8],[9,5,4,2,3,11],[0,11,2,0,8,11,4,9,5],[0,5,4,0,1,5,2,3,11],[2,1,5,2,5,8,2,8,11,4,8,5],[10,3,11,10,1,3,9,5,4],[4,9,5,0,8,1,8,10,1,8,11,10],[5,4,0,5,0,11,5,11,10,11,0,3],[5,4,8,5,8,10,10,8,11],[9,7,8,5,7,9],[9,3,0,9,5,3,5,7,3],[0,7,8,0,1,7,1,5,7],[1,5,3,3,5,7],[9,7,8,9,5,7,10,1,2],[10,1,2,9,5,0,5,3,0,5,7,3],[8,0,2,8,2,5,8,5,7,10,5,2],[2,10,5,2,5,3,3,5,7],[7,9,5,7,8,9,3,11,2],[9,5,7,9,7,2,9,2,0,2,7,11],[2,3,11,0,1,8,1,7,8,1,5,7],[11,2,1,11,1,7,7,1,5],[9,5,8,8,5,7,10,1,3,10,3,11],[5,7,0,5,0,9,7,11,0,1,0,10,11,10,0],[11,10,0,11,0,3,10,5,0,8,0,7,5,7,0],[11,10,5,7,11,5],[10,6,5],[0,8,3,5,10,6],[9,0,1,5,10,6],[1,8,3,1,9,8,5,10,6],[1,6,5,2,6,1],[1,6,5,1,2,6,3,0,8],[9,6,5,9,0,6,0,2,6],[5,9,8,5,8,2,5,2,6,3,2,8],[2,3,11,10,6,5],[11,0,8,11,2,0,10,6,5],[0,1,9,2,3,11,5,10,6],[5,10,6,1,9,2,9,11,2,9,8,11],[6,3,11,6,5,3,5,1,3],[0,8,11,0,11,5,0,5,1,5,11,6],[3,11,6,0,3,6,0,6,5,0,5,9],[6,5,9,6,9,11,11,9,8],[5,10,6,4,7,8],[4,3,0,4,7,3,6,5,10],[1,9,0,5,10,6,8,4,7],[10,6,5,1,9,7,1,7,3,7,9,4],[6,1,2,6,5,1,4,7,8],[1,2,5,5,2,6,3,0,4,3,4,7],[8,4,7,9,0,5,0,6,5,0,2,6],[7,3,9,7,9,4,3,2,9,5,9,6,2,6,9],[3,11,2,7,8,4,10,6,5],[5,10,6,4,7,2,4,2,0,2,7,11],[0,1,9,4,7,8,2,3,11,5,10,6],[9,2,1,9,11,2,9,4,11,7,11,4,5,10,6],[8,4,7,3,11,5,3,5,1,5,11,6],[5,1,11,5,11,6,1,0,11,7,11,4,0,4,11],[0,5,9,0,6,5,0,3,6,11,6,3,8,4,7],[6,5,9,6,9,11,4,7,9,7,11,9],[10,4,9,6,4,10],[4,10,6,4,9,10,0,8,3],[10,0,1,10,6,0,6,4,0],[8,3,1,8,1,6,8,6,4,6,1,10],[1,4,9,1,2,4,2,6,4],[3,0,8,1,2,9,2,4,9,2,6,4],[0,2,4,4,2,6],[8,3,2,8,2,4,4,2,6],[10,4,9,10,6,4,11,2,3],[0,8,2,2,8,11,4,9,10,4,10,6],[3,11,2,0,1,6,0,6,4,6,1,10],[6,4,1,6,1,10,4,8,1,2,1,11,8,11,1],[9,6,4,9,3,6,9,1,3,11,6,3],[8,11,1,8,1,0,11,6,1,9,1,4,6,4,1],[3,11,6,3,6,0,0,6,4],[6,4,8,11,6,8],[7,10,6,7,8,10,8,9,10],[0,7,3,0,10,7,0,9,10,6,7,10],[10,6,7,1,10,7,1,7,8,1,8,0],[10,6,7,10,7,1,1,7,3],[1,2,6,1,6,8,1,8,9,8,6,7],[2,6,9,2,9,1,6,7,9,0,9,3,7,3,9],[7,8,0,7,0,6,6,0,2],[7,3,2,6,7,2],[2,3,11,10,6,8,10,8,9,8,6,7],[2,0,7,2,7,11,0,9,7,6,7,10,9,10,7],[1,8,0,1,7,8,1,10,7,6,7,10,2,3,11],[11,2,1,11,1,7,10,6,1,6,7,1],[8,9,6,8,6,7,9,1,6,11,6,3,1,3,6],[0,9,1,11,6,7],[7,8,0,7,0,6,3,11,0,11,6,0],[7,11,6],[7,6,11],[3,0,8,11,7,6],[0,1,9,11,7,6],[8,1,9,8,3,1,11,7,6],[10,1,2,6,11,7],[1,2,10,3,0,8,6,11,7],[2,9,0,2,10,9,6,11,7],[6,11,7,2,10,3,10,8,3,10,9,8],[7,2,3,6,2,7],[7,0,8,7,6,0,6,2,0],[2,7,6,2,3,7,0,1,9],[1,6,2,1,8,6,1,9,8,8,7,6],[10,7,6,10,1,7,1,3,7],[10,7,6,1,7,10,1,8,7,1,0,8],[0,3,7,0,7,10,0,10,9,6,10,7],[7,6,10,7,10,8,8,10,9],[6,8,4,11,8,6],[3,6,11,3,0,6,0,4,6],[8,6,11,8,4,6,9,0,1],[9,4,6,9,6,3,9,3,1,11,3,6],[6,8,4,6,11,8,2,10,1],[1,2,10,3,0,11,0,6,11,0,4,6],[4,11,8,4,6,11,0,2,9,2,10,9],[10,9,3,10,3,2,9,4,3,11,3,6,4,6,3],[8,2,3,8,4,2,4,6,2],[0,4,2,4,6,2],[1,9,0,2,3,4,2,4,6,4,3,8],[1,9,4,1,4,2,2,4,6],[8,1,3,8,6,1,8,4,6,6,10,1],[10,1,0,10,0,6,6,0,4],[4,6,3,4,3,8,6,10,3,0,3,9,10,9,3],[10,9,4,6,10,4],[4,9,5,7,6,11],[0,8,3,4,9,5,11,7,6],[5,0,1,5,4,0,7,6,11],[11,7,6,8,3,4,3,5,4,3,1,5],[9,5,4,10,1,2,7,6,11],[6,11,7,1,2,10,0,8,3,4,9,5],[7,6,11,5,4,10,4,2,10,4,0,2],[3,4,8,3,5,4,3,2,5,10,5,2,11,7,6],[7,2,3,7,6,2,5,4,9],[9,5,4,0,8,6,0,6,2,6,8,7],[3,6,2,3,7,6,1,5,0,5,4,0],[6,2,8,6,8,7,2,1,8,4,8,5,1,5,8],[9,5,4,10,1,6,1,7,6,1,3,7],[1,6,10,1,7,6,1,0,7,8,7,0,9,5,4],[4,0,10,4,10,5,0,3,10,6,10,7,3,7,10],[7,6,10,7,10,8,5,4,10,4,8,10],[6,9,5,6,11,9,11,8,9],[3,6,11,0,6,3,0,5,6,0,9,5],[0,11,8,0,5,11,0,1,5,5,6,11],[6,11,3,6,3,5,5,3,1],[1,2,10,9,5,11,9,11,8,11,5,6],[0,11,3,0,6,11,0,9,6,5,6,9,1,2,10],[11,8,5,11,5,6,8,0,5,10,5,2,0,2,5],[6,11,3,6,3,5,2,10,3,10,5,3],[5,8,9,5,2,8,5,6,2,3,8,2],[9,5,6,9,6,0,0,6,2],[1,5,8,1,8,0,5,6,8,3,8,2,6,2,8],[1,5,6,2,1,6],[1,3,6,1,6,10,3,8,6,5,6,9,8,9,6],[10,1,0,10,0,6,9,5,0,5,6,0],[0,3,8,5,6,10],[10,5,6],[11,5,10,7,5,11],[11,5,10,11,7,5,8,3,0],[5,11,7,5,10,11,1,9,0],[10,7,5,10,11,7,9,8,1,8,3,1],[11,1,2,11,7,1,7,5,1],[0,8,3,1,2,7,1,7,5,7,2,11],[9,7,5,9,2,7,9,0,2,2,11,7],[7,5,2,7,2,11,5,9,2,3,2,8,9,8,2],[2,5,10,2,3,5,3,7,5],[8,2,0,8,5,2,8,7,5,10,2,5],[9,0,1,5,10,3,5,3,7,3,10,2],[9,8,2,9,2,1,8,7,2,10,2,5,7,5,2],[1,3,5,3,7,5],[0,8,7,0,7,1,1,7,5],[9,0,3,9,3,5,5,3,7],[9,8,7,5,9,7],[5,8,4,5,10,8,10,11,8],[5,0,4,5,11,0,5,10,11,11,3,0],[0,1,9,8,4,10,8,10,11,10,4,5],[10,11,4,10,4,5,11,3,4,9,4,1,3,1,4],[2,5,1,2,8,5,2,11,8,4,5,8],[0,4,11,0,11,3,4,5,11,2,11,1,5,1,11],[0,2,5,0,5,9,2,11,5,4,5,8,11,8,5],[9,4,5,2,11,3],[2,5,10,3,5,2,3,4,5,3,8,4],[5,10,2,5,2,4,4,2,0],[3,10,2,3,5,10,3,8,5,4,5,8,0,1,9],[5,10,2,5,2,4,1,9,2,9,4,2],[8,4,5,8,5,3,3,5,1],[0,4,5,1,0,5],[8,4,5,8,5,3,9,0,5,0,3,5],[9,4,5],[4,11,7,4,9,11,9,10,11],[0,8,3,4,9,7,9,11,7,9,10,11],[1,10,11,1,11,4,1,4,0,7,4,11],[3,1,4,3,4,8,1,10,4,7,4,11,10,11,4],[4,11,7,9,11,4,9,2,11,9,1,2],[9,7,4,9,11,7,9,1,11,2,11,1,0,8,3],[11,7,4,11,4,2,2,4,0],[11,7,4,11,4,2,8,3,4,3,2,4],[2,9,10,2,7,9,2,3,7,7,4,9],[9,10,7,9,7,4,10,2,7,8,7,0,2,0,7],[3,7,10,3,10,2,7,4,10,1,10,0,4,0,10],[1,10,2,8,7,4],[4,9,1,4,1,7,7,1,3],[4,9,1,4,1,7,0,8,1,8,7,1],[4,0,3,7,4,3],[4,8,7],[9,10,8,10,11,8],[3,0,9,3,9,11,11,9,10],[0,1,10,0,10,8,8,10,11],[3,1,10,11,3,10],[1,2,11,1,11,9,9,11,8],[3,0,9,3,9,11,1,2,9,2,11,9],[0,2,11,8,0,11],[3,2,11],[2,3,8,2,8,10,10,8,9],[9,10,2,0,9,2],[2,3,8,2,8,10,0,1,8,1,10,8],[1,10,2],[1,3,8,9,1,8],[0,9,1],[0,3,8],[]];var i=new Uint32Array([0,1,1,2,1,2,2,3,1,2,2,3,2,3,3,2,1,2,2,3,2,3,3,4,2,3,3,4,3,4,4,3,1,2,2,3,2,3,3,4,2,3,3,4,3,4,4,3,2,3,3,2,3,4,4,3,3,4,4,3,4,5,5,2,1,2,2,3,2,3,3,4,2,3,3,4,3,4,4,3,2,3,3,4,3,4,4,5,3,4,4,5,4,5,5,4,2,3,3,4,3,4,2,3,3,4,4,5,4,5,3,2,3,4,4,3,4,5,3,2,4,5,5,4,5,2,4,1,1,2,2,3,2,3,3,4,2,3,3,4,3,4,4,3,2,3,3,4,3,4,4,5,3,2,4,3,4,3,5,2,2,3,3,4,3,4,4,5,3,4,4,5,4,5,5,4,3,4,4,3,4,5,5,4,4,3,5,2,5,4,2,1,2,3,3,4,3,4,4,5,3,4,4,5,2,3,3,2,3,4,4,5,4,5,5,2,4,3,5,4,3,2,4,1,3,4,4,5,4,5,3,4,4,5,5,2,3,4,2,1,2,3,3,2,3,4,2,1,3,2,4,1,2,1,1,0]);var a=.5;var v=new Float32Array(36);var n;var t=function(f,r,i,t,e,o,u,s,c,h,l){if(Math.abs(a-s)<1e-5){v[f]=h[0]+r*l[0];v[f+1]=h[1]+i*l[1];v[f+2]=h[2]+t*l[2]}else if(Math.abs(a-c)<1e-5){v[f]=h[0]+e*l[0];v[f+1]=h[1]+o*l[1];v[f+2]=h[2]+u*l[2]}else if(Math.abs(s-c)<1e-5){v[f]=h[0]+r*l[0];v[f+1]=h[1]+i*l[1];v[f+2]=h[2]+t*l[2]}else{n=(a-s)/(c-s);v[f]=h[0]+(r+n*(e-r))*l[0];v[f+1]=h[1]+(i+n*(o-i))*l[1];v[f+2]=h[2]+(t+n*(u-t))*l[2]}};var e=function(){};e.march=function(i,n,e,o,u,s){var c=.5/n;var h=[e[3]-e[0],e[4]-e[1],e[5]-e[2]];var l=n*n;var M=n;var b=n-1;var w,y,A,U,d,g,m,p;var q,F,j,k,x,z;var B,C,D,E,G,H;var I=0;var J=0;for(j=-1;j<=b;++j){for(F=-1;F<=b;++F){for(q=-1;q<=b;++q){w=q<0||F<0||j<0?0:i[j*l+F*M+q];y=q===b||F<0||j<0?0:i[j*l+F*M+q+1];A=q===b||F<0||j===b?0:i[(j+1)*l+F*M+q+1];U=q<0||F<0||j===b?0:i[(j+1)*l+F*M+q];d=q<0||F===b||j<0?0:i[j*l+(F+1)*M+q];g=q===b||F===b||j<0?0:i[j*l+(F+1)*M+q+1];m=q===b||F===b||j===b?0:i[(j+1)*l+(F+1)*M+q+1];p=q<0||F===b||j===b?0:i[(j+1)*l+(F+1)*M+q];B=(q+1)/n-c;C=(q+2)/n-c;D=(F+1)/n-c;E=(F+2)/n-c;G=(j+1)/n-c;H=(j+2)/n-c;k=0;if(w>a){k|=1}if(y>a){k|=2}if(A>a){k|=4}if(U>a){k|=8}if(d>a){k|=16}if(g>a){k|=32}if(m>a){k|=64}if(p>a){k|=128}if(f[k]===0){continue}if(f[k]&1){t(0,B,D,G,C,D,G,w,y,e,h)}if(f[k]&2){t(3,C,D,G,C,D,H,y,A,e,h)}if(f[k]&4){t(6,C,D,H,B,D,H,A,U,e,h)}if(f[k]&8){t(9,B,D,H,B,D,G,U,w,e,h)}if(f[k]&16){t(12,B,E,G,C,E,G,d,g,e,h)}if(f[k]&32){t(15,C,E,G,C,E,H,g,m,e,h)}if(f[k]&64){t(18,C,E,H,B,E,H,m,p,e,h)}if(f[k]&128){t(21,B,E,H,B,E,G,p,d,e,h)}if(f[k]&256){t(24,B,D,G,B,E,G,w,d,e,h)}if(f[k]&512){t(27,C,D,G,C,E,G,y,g,e,h)}if(f[k]&1024){t(30,C,D,H,C,E,H,A,m,e,h)}if(f[k]&2048){t(33,B,D,H,B,E,H,U,p,e,h)}for(x=0,z=r[k].length;x<z;x+=3){w=r[k][x]*3;U=r[k][x+1]*3;d=r[k][x+2]*3;o[I]=v[w];o[I+1]=v[w+1];o[I+2]=v[w+2];o[I+3]=v[U];o[I+4]=v[U+1];o[I+5]=v[U+2];o[I+6]=v[d];o[I+7]=v[d+1];o[I+8]=v[d+2];if(u){B=v[w]-v[U];D=v[w+1]-v[U+1];G=v[w+2]-v[U+2];C=v[d]-v[U];E=v[d+1]-v[U+1];H=v[d+2]-v[U+2];y=G*E-D*H;A=B*H-G*C;g=D*C-B*E;m=Math.sqrt(y*y+A*A+g*g);B=y/m;D=A/m;G=g/m;for(m=0;m<3;++m){u[I]=B;u[I+1]=D;u[I+2]=G;I+=3}}s[J]=J;s[J+1]=J+1;s[J+2]=J+2;J+=3}}}}};e.count=function(f,r){var v=r*r;var n=r;var t=r-1;var e,o,u,s,c,h,l,M;var b,w,y,A;var U=0;for(y=-1;y<=t;++y){for(w=-1;w<=t;++w){for(b=-1;b<=t;++b){e=b<0||w<0||y<0?0:f[y*v+w*n+b];o=b===t||w<0||y<0?0:f[y*v+w*n+b+1];u=b===t||w<0||y===t?0:f[(y+1)*v+w*n+b+1];s=b<0||w<0||y===t?0:f[(y+1)*v+w*n+b];c=b<0||w===t||y<0?0:f[y*v+(w+1)*n+b];h=b===t||w===t||y<0?0:f[y*v+(w+1)*n+b+1];l=b===t||w===t||y===t?0:f[(y+1)*v+(w+1)*n+b+1];M=b<0||w===t||y===t?0:f[(y+1)*v+(w+1)*n+b];A=0;if(e>a){A|=1}if(o>a){A|=2}if(u>a){A|=4}if(s>a){A|=8}if(c>a){A|=16}if(h>a){A|=32}if(l>a){A|=64}if(M>a){A|=128}U+=i[A]}}}return U};return e});
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/threejs/Material", ["../Material","../thirdparty/three","./MaterialType","./Texture","../cssColorToColor","../colorToCSSColor","./ThreeUtils"],function(t,e,i,a,r,n,s){"use strict";var o=t.extend("sap.ui.vk.threejs.Material",{metadata:{library:"sap.ui.vk"},constructor:function(a){switch(a){default:case i.MeshPhongMaterial:this._nativeMaterial=new e.MeshPhongMaterial({color:11184810});break;case i.LineBasicMaterial:this._nativeMaterial=new e.LineBasicMaterial({color:11184810});break;case i.MeshBasicMaterial:this._nativeMaterial=new e.MeshBasicMaterial({color:11184810});break}t.call(this)}});var l=o.getMetadata().getParent().getClass().prototype;o.prototype.init=function(){if(l.init){l.init.call(this)}};o.prototype.exit=function(){if(l.exit){l.exit.call(this)}if(this._nativeMaterial){s.disposeMaterial(this._nativeMaterial);this._nativeMaterial=null}};o.prototype.getMaterialRef=function(){return this._nativeMaterial};o.prototype.setMaterialRef=function(t){this._nativeMaterial=t;return this};o.prototype.getId=function(){if(this._nativeMaterial&&this._nativeMaterial.userData&&this._nativeMaterial.userData.materialId){return this._nativeMaterial.userData.materialId}return undefined};o.prototype.setId=function(t){this._nativeMaterial.userData.materialId=t;return this};o.prototype.getName=function(){if(this._nativeMaterial.userData&&this._nativeMaterial.userData.name){return this._nativeMaterial.userData.name}return undefined};o.prototype.setName=function(t){this._nativeMaterial.userData.name=t;return this};o.prototype.getAmbientColour=function(){return"rgba(0, 0, 0, 1)"};o.prototype.setAmbientColour=function(t){return this};o.prototype.getDiffuseColour=function(){if(this._nativeMaterial.isMeshPhongMaterial&&this._nativeMaterial.color){var t={red:Math.round(this._nativeMaterial.color.r*255),green:Math.round(this._nativeMaterial.color.g*255),blue:Math.round(this._nativeMaterial.color.b*255),alpha:1};return n(t)}return"rgba(0, 0, 0, 1)"};o.prototype.setDiffuseColour=function(t){if(this._nativeMaterial.isMeshPhongMaterial){var i=r(t);this._nativeMaterial.color=new e.Color(i.red/255,i.green/255,i.blue/255)}return this};o.prototype.getEmissiveColour=function(){if(this._nativeMaterial.isMeshPhongMaterial&&this._nativeMaterial.emissive){var t={red:Math.round(this._nativeMaterial.emissive.r*255),green:Math.round(this._nativeMaterial.emissive.g*255),blue:Math.round(this._nativeMaterial.emissive.b*255),alpha:1};return n(t)}return"rgba(0, 0, 0, 1)"};o.prototype.setEmissiveColour=function(t){if(this._nativeMaterial.isMeshPhongMaterial){var i=r(t);this._nativeMaterial.emissive=new e.Color(i.red/255,i.green/255,i.blue/255)}return this};o.prototype.getSpecularColour=function(){if(this._nativeMaterial.isMeshPhongMaterial&&this._nativeMaterial.specular){var t={red:Math.round(this._nativeMaterial.specular.r*255),green:Math.round(this._nativeMaterial.specular.g*255),blue:Math.round(this._nativeMaterial.specular.b*255),alpha:1};return n(t)}return"rgba(0, 0, 0, 1)"};o.prototype.setSpecularColour=function(t){if(this._nativeMaterial.isMeshPhongMaterial){var i=r(t);this._nativeMaterial.specular=new e.Color(i.red/255,i.green/255,i.blue/255)}return this};o.prototype.getOpacity=function(){if(this._nativeMaterial.opacity!==undefined){return this._nativeMaterial.opacity}return 1};o.prototype.setOpacity=function(t){if(t>=0&&t<=1){this._nativeMaterial.opacity=t;this._nativeMaterial.transparent=this._nativeMaterial.opacity<1}return this};o.prototype.getGlossiness=function(){if(this._nativeMaterial.isMeshPhongMaterial&&this._nativeMaterial.shininess){return this._nativeMaterial.shininess/100}return 0};o.prototype.setGlossiness=function(t){if(this._nativeMaterial.isMeshPhongMaterial){this._nativeMaterial.shininess=t*100}return this};o.prototype.getLineColour=function(){if(this._nativeMaterial.isLineBasicMaterial&&this._nativeMaterial.color){var t={red:Math.round(this._nativeMaterial.color.r*255),green:Math.round(this._nativeMaterial.color.g*255),blue:Math.round(this._nativeMaterial.color.b*255),alpha:1};return n(t)}return"rgba(0, 0, 0, 1)"};o.prototype.setLineColour=function(t){if(this._nativeMaterial.isLineBasicMaterial){var i=r(t);this._nativeMaterial.color=new e.Color(i.red/255,i.green/255,i.blue/255)}return this};o.prototype.getLineWidth=function(){if(this._nativeMaterial.isLineBasicMaterial&&this._nativeMaterial.linewidth!==undefined){return this._nativeMaterial.linewidth}return 0};o.prototype.setLineWidth=function(t){if(this._nativeMaterial.isLineBasicMaterial){this._nativeMaterial.linewidth=t}return this};o.prototype.getTextureDiffuse=function(){if(this._nativeMaterial.map){var t=new a;t.setTextureRef(this._nativeMaterial.map);return t}return null};o.prototype.setTextureDiffuse=function(t){if(this._nativeMaterial.isMeshPhongMaterial&&t){this._nativeMaterial.map=t.getTextureRef()}return this};o.prototype.getTextureBump=function(){if(this._nativeMaterial.bumpMap){var t=new a;t.setTextureRef(this._nativeMaterial.bumpMap);return t}return null};o.prototype.setTextureBump=function(t){if(this._nativeMaterial.isMeshPhongMaterial&&t){this._nativeMaterial.bumpMap=t.getTextureRef()}return this};o.prototype.getTextureOpacity=function(){if(this._nativeMaterial.alphaMap){var t=new a;t.setTextureRef(this._nativeMaterial.alphaMap);return t}return null};o.prototype.setTextureOpacity=function(t){if(this._nativeMaterial.isMeshPhongMaterial&&t){this._nativeMaterial.alphaMap=t.getTextureRef()}return this};o.prototype.getTextureReflection=function(){if(this._nativeMaterial.envMap){var t=new a;t.setTextureRef(this._nativeMaterial.envMap);return t}return null};o.prototype.setTextureReflection=function(t){if(this._nativeMaterial.isMeshPhongMaterial&&t){this._nativeMaterial.envMap=t.getTextureRef();if(this._nativeMaterial.envMap){this._nativeMaterial.envMap.mapping=e.SphericalReflectionMapping;this._nativeMaterial.combine=e.AddOperation}}return this};o.prototype.getTextureEmissive=function(){if(this._nativeMaterial.emissiveMap){var t=new a;t.setTextureRef(this._nativeMaterial.emissiveMap);return t}return null};o.prototype.setTextureEmissive=function(t){if(this._nativeMaterial.isMeshPhongMaterial&&t){this._nativeMaterial.emissiveMap=t.getTextureRef()}return this};o.prototype.getTextureAmbientOcclusion=function(){if(this._nativeMaterial.aoMap){var t=new a;t.setTextureRef(this._nativeMaterial.aoMap);return t}return null};o.prototype.setTextureAmbientOcclusion=function(t){if(this._nativeMaterial.isMeshPhongMaterial&&t){this._nativeMaterial.aoMap=t.getTextureRef()}return this};return o});
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/threejs/MaterialType", ["sap/ui/base/DataType"],function(a){"use strict";var e={MeshPhongMaterial:"MeshPhongMaterial",MeshBasicMaterial:"MeshBasicMaterial",LineBasicMaterial:"LineBasicMaterial"};a.registerEnum("sap.ui.vk.threejs.MaterialType",e);return e},true);
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/threejs/NodeHierarchy", ["../NodeHierarchy","sap/ui/base/ObjectPool","./BaseNodeProxy","./NodeProxy","../Messages","../getResourceBundle","../NodeContentType","sap/base/util/uid","sap/base/assert","sap/base/Log","../thirdparty/three"],function(e,t,n,r,o,i,a,s,d,c,u){"use strict";var f={equals:function(e,t){return e===t},contains:function(e,t){return e.indexOf(t)!==-1},startsWith:function(e,t){return e.indexOf(t)===0}};var h=e.extend("sap.ui.vk.threejs.NodeHierarchy",{metadata:{library:"sap.ui.vk"},_baseNodeProxyPool:new t(n),constructor:function(t){e.call(this);this._scene=t;this._nodeProxies=[]}});h.prototype.destroy=function(){this._nodeProxies.slice().forEach(this.destroyNodeProxy,this);this._scene=null;e.prototype.destroy.call(this)};h.prototype.getScene=function(){return this._scene};h.prototype.getSceneRef=function(){return this._scene.getSceneRef()};h.prototype.enumerateChildren=function(e,t,n,r){if(typeof e==="function"){r=n;n=t;t=e;e=undefined}var o=this.getChildren(e,n);if(r){o.forEach(t)}else{var i=this._baseNodeProxyPool.borrowObject();try{o.forEach(function(e){i.init(this,e);t(i);i.reset()}.bind(this))}finally{this._baseNodeProxyPool.returnObject(i)}}return this};h.prototype.enumerateAncestors=function(e,t,n){var r=this.getAncestors(e);if(n){r.forEach(t)}else{var o=this._baseNodeProxyPool.borrowObject();try{r.forEach(function(e){o.init(this,e);t(o);o.reset()}.bind(this))}finally{this._baseNodeProxyPool.returnObject(o)}}return this};h.prototype.createNodeProxy=function(e){var t=new r(this,e);this._nodeProxies.push(t);return t};h.prototype.destroyNodeProxy=function(e){var t=this._nodeProxies.indexOf(e);if(t>=0){this._nodeProxies.splice(t,1)[0].destroy()}return this};h.prototype.getChildren=function(e,t){if(typeof e==="boolean"){t=e;e=undefined}if(!e){e=this._scene.getSceneRef()}var n=[];if(t||!e.userData.closed){e.children.forEach(function(e){if(!e.private&&(e.geometry===undefined||!e.userData.skipIt)){n.push(e)}})}return n};h.prototype.getAncestors=function(e){var t=[];e.traverseAncestors(function(e){t.unshift(e)});if(t.length>0&&t[0]===this._scene.getSceneRef()){t.shift()}return t};h.prototype.findNodesByName=function(e){var t=[];if(e===undefined||e===null||e===""||jQuery.isEmptyObject(e)){this._scene.getSceneRef().children.forEach(function(e){e.traverse(function(e){if(!e.private&&!e.userData.skipIt){t.push(e)}})})}else{var n=f[e.predicate||"equals"];if(n===undefined){c.error(i().getText(o.VIT8.summary),o.VIT8.code,"sap.ui.vk.threejs.NodeHierarchy")}else if(!Array.isArray(e.value)&&typeof e.value!=="string"){c.error(i().getText(o.VIT6.summary),o.VIT6.code,"sap.ui.vk.threejs.NodeHierarchy")}else{var r=Array.isArray(e.value)?e.value:[e.value];if(!e.caseSensitive){for(var a in r){r[a]=r[a].toLowerCase()}}this._scene.getSceneRef().children.forEach(function(o){o.traverse(function(o){if(!o.private&&!o.userData.skipIt){var i=o.name||"";if(!e.caseSensitive){i=i.toLowerCase()}for(var a in r){if(n(i,r[a])){t.push(o);break}}}})})}}return t};h.prototype.findNodesByUsageIdPath=function(e,t,n){var r=[];function o(i,a,s){if(!i.userData.skipIt){if(a>=0){var d=t[a];if(d==="**"){d=t[++a];s=true}var c=d==="*";if(!c&&Array.isArray(i.userData.usageIds)){var u=i.userData.usageIds.find(function(t){return t.name===e});var f=u&&u.keys;var h=Array.isArray(d)?d:[d];if(Array.isArray(f)&&f.length===h.length){c=f.every(function(e){return h.some(function(t){return t.name===e.name&&t.value===e.value})})}}if(c){a++;if(a>=t.length){r.push(i);return}s=false}else if(!s){return}}else{a=0}}if(!i.userData.closed||n&&n.stepIntoClosedNodes){i.children.forEach(function(e){o(e,a,s)})}}o(n&&n.searchUnder||this._scene.getSceneRef(),-1,false);return r};h.prototype.createLayerProxy=function(e){return null};h.prototype.destroyLayerProxy=function(e){return this};h.prototype.getLayers=function(){return[]};h.prototype.getHotspotNodeRefs=function(){return null};h.prototype.attachChanged=function(e,t,n){return this.attachEvent("changed",e,t,n)};h.prototype.detachChanged=function(e,t,n){return this.detachEvent("changed",e,t,n)};h.prototype.fireChanged=function(e,t,n){return this.fireEvent("changed",e,t,n)};h.prototype.attachNodeCreated=function(e,t,n){return this.attachEvent("nodeCreated",e,t,n)};h.prototype.detachNodeCreated=function(e,t,n){return this.detachEvent("nodeCreated",e,t,n)};h.prototype.fireNodeCreated=function(e,t,n){return this.fireEvent("nodeCreated",e,t,n)};h.prototype.attachNodeRemoving=function(e,t,n){return this.attachEvent("nodeRemoving",e,t,n)};h.prototype.detachNodeRemoving=function(e,t,n){return this.detachEvent("nodeRemoving",e,t,n)};h.prototype.fireNodeRemoving=function(e,t,n){return this.fireEvent("nodeRemoving",e,t,n)};h.prototype.attachNodeReplaced=function(e,t,n){return this.attachEvent("nodeReplaced",e,t,n)};h.prototype.detachNodeReplaced=function(e,t,n){return this.detachEvent("nodeReplaced",e,t,n)};h.prototype.fireNodeReplaced=function(e,t,n){return this.fireEvent("nodeReplaced",e,t,n)};h.prototype.attachNodeUpdated=function(e,t,n){return this.attachEvent("nodeUpdated",e,t,n)};h.prototype.detachNodeUpdated=function(e,t,n){return this.detachEvent("nodeUpdated",e,t,n)};h.prototype.fireNodeUpdated=function(e,t,n){return this.fireEvent("nodeUpdated",e,t,n)};h.prototype.createNode=function(e,t,n,r,o){var c=this.getScene().getSceneBuilder();var f=null;var h;if(c){if(r===a.Annotation){h={contentType:"ANNOTATION",name:t,sid:o.sid||s(),annotationId:s()}}else{h=o||{};h.name=h.name||t;h.sid=h.sid||s()}h.parentId??=e?._vkPersistentId();f=c.createNode(h);if(!e){e=f.parent}}else{if(!e){e=this._scene.getSceneRef()}f=new u.Group;f.name=t;e.add(f)}var p=e.children.indexOf(n);d(e.children[e.children.length-1]===f,i().getText("NODEHIERARCHY_MSG_CREATENODEFAILED"));if(p>=0){e.children.splice(p,0,e.children.pop())}if(r){f._vkSetNodeContentType(r)}else{f._vkSetNodeContentType(a.Regular)}if(o&&c){switch(f._vkGetNodeContentType()){case a.Annotation:o.nodeId=f._vkPersistentId();o.id=h.annotationId;c.createAnnotation(o);break;case a.Background:c.setParametricContent(o.sid,o.parametricContent);break;default:}}this.fireNodeCreated({nodeRef:f,nodeId:f});this.fireChanged();return f};h.prototype.getNodeContentType=function(e){if(e==null){return a.Regular}var t=e._vkGetNodeContentType();if(!t){t=a.Regular}return t};h.prototype.createNodeCopy=function(e,t,n,r){if(!t){t=this._scene.getSceneRef()}var o=t.children.indexOf(r);var a=e.clone(true);a.name=n;t.add(a);d(t.children[t.children.length-1]===a,i().getText("NODEHIERARCHY_MSG_CREATENODEFAILED"));if(o>=0){t.children.splice(o,0,t.children.pop())}this.fireNodeCreated({nodeRef:a,nodeId:a});this.fireChanged();return a};h.prototype.removeNode=function(e){var t=[].concat(e);t.forEach(function(e){if(e&&e.parent){this.fireNodeRemoving({nodeRef:e,nodeId:e});e.parent.remove(e)}}.bind(this));var n=this.getScene().getSceneBuilder();if(n){t.forEach(n.removeNode,n)}this.fireChanged();return this};return h});
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/threejs/NodeProxy", ["../NodeProxy","./Material","../cssColorToColor","../colorToCSSColor","../abgrToColor","../colorToABGR","../TransformationMatrix","./ThreeExtensions","../ObjectType","../thirdparty/three"],function(t,e,r,a,i,o,n,s,c,u){"use strict";var l=t.extend("sap.ui.vk.threejs.NodeProxy",{metadata:{library:"sap.ui.vk"},constructor:function(e,r){t.call(this);this._object3D=r;this._nodeHierarchy=e}});l.prototype.destroy=function(){this._object3D=null;t.prototype.destroy.call(this)};l.prototype.getNodeHierarchy=function(){return this._nodeHierarchy};l.prototype.getNodeRef=function(){return this._object3D};l.prototype.getNodeId=function(){return this._object3D};l.prototype.getVeIds=function(){return this._object3D.userData.veids||[]};l.prototype.getVeId=function(){return this._object3D.userData.treeNode?this._object3D.userData.treeNode.sid:null};l.prototype.getMaterialId=function(){var t=this._object3D;if(this._object3D&&!this._object3D.geometry){if(this._object3D.children.length===1&&this._object3D.children[0].geometry&&(this._object3D.children[0].name===""||this._object3D.children[0].name===undefined)){t=this._object3D.children[0]}}if(t.material!==undefined&&t.material.userData!==undefined&&t.material.userData.materialId!==undefined){return t.material.userData.materialId}else if(t.userData.originalMaterial!==undefined&&t.userData.originalMaterial.userData!==undefined&&t.userData.originalMaterial.userData.materialId!==undefined){return t.userData.originalMaterial.userData.materialId}return undefined};l.prototype.getName=function(){return this._object3D.name||"<"+this._object3D.type+">"};l.prototype._updateAncestorsBoundingBox=function(){var t=this._object3D.parent;while(t){if(t.userData.boundingBox!==undefined){t._vkCalculateObjectOrientedBoundingBox()}t=t.parent}};l.prototype.getLocalMatrix=function(){return n.convertTo4x3(this._object3D.matrix.elements)};l.prototype.setLocalMatrix=function(t){if(t){var e=this._object3D;e.matrix.fromArray(n.convertTo4x4(t));e.matrix.decompose(e.position,e.quaternion,e.scale);e.updateMatrixWorld(true);this._updateAncestorsBoundingBox()}this.setProperty("localMatrix",t,true);return this};l.prototype.setLocalMatrixNotUpdatingBBox=function(t){if(t){var e=this._object3D;e.matrix.fromArray(n.convertTo4x4(t));e.matrix.decompose(e.position,e.quaternion,e.scale);e.updateMatrixWorld(true)}this.setProperty("localMatrix",t,true);return this};l.prototype.getWorldMatrix=function(){return n.convertTo4x3(this._object3D.matrixWorld.elements)};l.prototype.setWorldMatrix=function(t){if(t){var e=this._object3D;e.matrixWorld.fromArray(n.convertTo4x4(t));if(e.parent){e.matrix.multiplyMatrices((new u.Matrix4).copy(e.parent.matrixWorld).invert(),e.matrixWorld)}else{e.matrix.copy(e.matrixWorld)}e.matrix.decompose(e.position,e.quaternion,e.scale);e.updateMatrixWorld(true);this._updateAncestorsBoundingBox()}this.setProperty("worldMatrix",t,true);return this};l.prototype.getOpacity=function(){const t=this._nodeHierarchy.getScene().getViewStateManager();return t?.getOpacity(this._object3D)??this._object3D.userData.opacity};l.prototype.setOpacity=function(t){var e=this._nodeHierarchy.getScene().getViewStateManager();if(e){e.setOpacity(this._object3D,t)}else{this._object3D.userData.opacity=t}this.setProperty("opacity",t,true);return this};l.prototype.getTintColorABGR=function(){const t=this._nodeHierarchy.getScene().getViewStateManager();return t?._getTintColorABGR(this._object3D)??this._object3D.userData.tintColor};l.prototype.setTintColorABGR=function(t){var e=this._nodeHierarchy.getScene().getViewStateManager();if(e){e.setTintColor(this._object3D,t)}else{this._object3D.userData.tintColor=t}this.setProperty("tintColorABGR",t,true);this.setProperty("tintColor",a(i(t)),true);return this};l.prototype.getTintColor=function(){return a(i(this.getTintColorABGR()))};l.prototype.setTintColor=function(t){var e=o(r(t));var a=this._nodeHierarchy.getScene().getViewStateManager();if(a){a.setTintColor(this._object3D,e)}else{this._object3D.userData.tintColor=e}this.setProperty("tintColorABGR",e,true);this.setProperty("tintColor",t,true);return this};l.prototype.getNodeMetadata=function(){return this._object3D.userData.metadata||{}};l.prototype.getHasChildren=function(){return this._object3D.children.length>0};l.prototype.getClosed=function(){return!!this._object3D.userData.closed};l.prototype.getBoundingBox=function(){return this._object3D.userData.boundingBox};l.prototype.assignMaterial=function(t){var e=function(t,e){var r;if(t.userData){r=t.userData.materialId;e.userData.materialId=r}if(e.material!==undefined){if(e.material.side){t.side=e.material.side}e.material=t;t.userData.materialUsed++;delete e.userData.originalMaterial}};e(t.getMaterialRef(),this._object3D);if(!this._object3D.children){return this}this._object3D.children.forEach(function(r){if(!r||r.userData.objectType===c.PMI||r.userData.objectType===c.Hotspot){return}e(t.getMaterialRef(),r)});return this};l.prototype.enumerateMaterials=function(t){var r=function(t,e,a){if(t){if(t.userData.originalMaterial){e.add(t.userData.originalMaterial)}else if(t.material){e.add(t.material)}if(t.children){t.children.forEach(function(t){if(t){if(a){r(t,e,a)}else if(t.userData.originalMaterial){e.add(t.userData.originalMaterial)}else if(t.material){e.add(t.material)}}})}}};var a=new Set;r(this._object3D,a,t);var i=[];a.forEach(function(t){i.push(t)});var o=[];for(var n=0;n<i.length;n++){var s=new e;s.setMaterialRef(i[n]);o.push(s)}return o};l.prototype.replaceMaterial=function(t,e){var r=typeof t.getMaterialRef==="function"?t.getMaterialRef():t;var a=typeof e.getMaterialRef==="function"?e.getMaterialRef():e;if(this._object3D.userData.originalMaterial&&this._object3D.userData.originalMaterial===r){this._object3D.userData.originalMaterial=a}else if(this._object3D.material&&this._object3D.material===r){this._object3D.material=a}if(e.id){this._object3D.userData.materialId=e.id}if(!this._object3D.children){return this}this._object3D.children.forEach(function(t){if(t&&t.userData.originalMaterial&&t.userData.originalMaterial===r){t.userData.originalMaterial=a}else if(t&&t.material&&t.material===r){t.material=a}});return this};l.prototype.getLocalTranslate=function(){var t=this._object3D;return[t.position.x,t.position.y,t.position.z]};l.prototype.getLocalScale=function(){var t=this._object3D;return[t.scale.x,t.scale.y,t.scale.z]};l.prototype.getLocalRotationInQuaternion=function(){var t=this._object3D;return[t.quaternion.x,t.quaternion.y,t.quaternion.z,t.quaternion.w]};l.prototype.getLocalRotationInAngleAxis=function(){var t=this._object3D;var e=t.quaternion;if(e.w>1){e.normalise()}var r=2*Math.acos(e.w);var a=Math.sqrt(1-e.w*e.w);var i,o,n;if(a<.001){i=e.x;o=e.y;n=e.z}else{i=e.x/a;o=e.y/a;n=e.z/a}return[i,o,n,r]};l.prototype.getLocalRotationInEuler=function(){var t=this._object3D;var e=t.quaternion;if(e.w>1){e.normalise()}var r=26;var a=e.x*e.y+e.z*e.w;var i,o,n;if(a>.499){i=2*Math.atan2(e.x,e.w);o=Math.PI/2;n=0}if(a<-.499){i=-2*Math.atan2(e.x,e.w);o=-Math.PI/2;n=0}else{var s=e.x*e.x;var c=e.y*e.y;var u=e.z*e.z;i=Math.atan2(2*e.y*e.w-2*e.x*e.z,1-2*c-2*u);o=Math.asin(2*a);n=Math.atan2(2*e.x*e.w-2*e.y*e.z,1-2*s-2*u)}return[i,o,n,r]};return l});
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/threejs/OrthographicCamera", ["../OrthographicCamera","../thirdparty/three"],function(t,e){"use strict";var a=t.extend("sap.ui.vk.threejs.OrthographicCamera",{metadata:{library:"sap.ui.vk"}});var i=t.getMetadata().getParent().getClass().prototype;a.prototype.init=function(){if(i.init){i.init.call(this)}var t=1;var a=2e5;this._nativeCamera=new e.OrthographicCamera(-1,1,1,-1,t,a);this._nativeCamera.position.set(0,0,1e4);this._nativeCamera.zoom=-1;this.setUsingDefaultClipPlanes(true)};a.prototype.update=function(t,e){var a=1/Math.min(t,e);var i=t*a;var r=e*a;if(this.getRight()!==i||this.getTop()!==r){this.setLeft(-i);this.setRight(i);this.setTop(r);this.setBottom(-r);var n=this._nativeCamera.view;if(n&&n.enabled){var o=n.fullWidth/n.fullHeight;var s=t/e;var p=Math.min(s,1)/Math.min(o,1);var u=p*o/s;var h=t/n.fullWidth;var f=e/n.fullHeight;n.offsetX=(n.offsetX*u+(n.fullWidth-n.width)*(1-u)*.5)*h;n.offsetY=(n.offsetY*p+(n.fullHeight-n.height)*(1-p)*.5)*f;n.width*=h;n.height*=f;n.fullWidth=t;n.fullHeight=e}this._nativeCamera.updateProjectionMatrix()}};a.prototype.exit=function(){if(i.exit){i.exit.call(this)}this._nativeCamera=null};a.prototype.getLeft=function(){return this._nativeCamera.left};a.prototype.setLeft=function(t){this._nativeCamera.left=t;return this};a.prototype.getRight=function(){return this._nativeCamera.right};a.prototype.setRight=function(t){this._nativeCamera.right=t;return this};a.prototype.getTop=function(){return this._nativeCamera.top};a.prototype.setTop=function(t){this._nativeCamera.top=t;return this};a.prototype.getBottom=function(){return this._nativeCamera.bottom};a.prototype.setBottom=function(t){this._nativeCamera.bottom=t;return this};a.prototype.getZoomFactor=function(){return this._nativeCamera.zoom};a.prototype.setZoomFactor=function(t){this._nativeCamera.zoom=t;return this};a.prototype.getCameraRef=function(){return this._nativeCamera};a.prototype.setCameraRef=function(t){this._nativeCamera=t;return this};a.prototype.getNearClipPlane=function(){return this._nativeCamera.near};a.prototype.setNearClipPlane=function(t){this._nativeCamera.near=t;this.setUsingDefaultClipPlanes(false);this._nativeCamera.updateProjectionMatrix();this.setIsModified(true);return this};a.prototype.getFarClipPlane=function(){return this._nativeCamera.far};a.prototype.setFarClipPlane=function(t){this._nativeCamera.far=t;this.setUsingDefaultClipPlanes(false);this._nativeCamera.updateProjectionMatrix();this.setIsModified(true);return this};a.prototype.getPosition=function(){return this._nativeCamera.position.toArray()};a.prototype.setPosition=function(t){this._nativeCamera.position.fromArray(t);this._nativeCamera.updateMatrixWorld();return this};a.prototype.getUpDirection=function(){return this._nativeCamera.up.toArray()};a.prototype.setUpDirection=function(t){this._nativeCamera.up.fromArray(t);this._nativeCamera.updateMatrixWorld();return this};a.prototype.getTargetDirection=function(){var t=new e.Vector3;this._nativeCamera.getWorldDirection(t);return t.toArray()};a.prototype.setTargetDirection=function(t){var a=(new e.Vector3).fromArray(t);a.add(this._nativeCamera.position);this._nativeCamera.lookAt(a);return this};a.prototype.setUsingDefaultClipPlanes=function(t){this._nativeCamera.userData.usingDefaultClipPlanes=t;return this};a.prototype.getUsingDefaultClipPlanes=function(){return this._nativeCamera.userData.usingDefaultClipPlanes};a.prototype.adjustClipPlanes=function(t){var a=this._nativeCamera;a.updateMatrixWorld();t=t.clone().applyMatrix4(a.matrixWorldInverse);a.near=-t.max.z;a.far=-t.min.z;var i=Math.max((a.far-a.near)*.0025,.001);a.near-=i;a.far+=i;if(a.near<0){var r=new e.Vector3(0,0,-1).transformDirection(a.matrixWorld).multiplyScalar(a.near);a.position.add(r);a.far-=a.near;a.near=0;a.updateMatrixWorld()}a.updateProjectionMatrix();return this};a.prototype.adjustZoom=function(t){var e=this._nativeCamera;e.updateMatrixWorld();t=t.clone().applyMatrix4(e.matrixWorldInverse);e.zoom=1/Math.max(t.min.x/e.left,t.max.y/e.top,t.max.x/e.right,t.min.y/e.bottom);e.updateProjectionMatrix();return this};return a});
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/threejs/OutlineRenderer", ["../thirdparty/three","sap/base/Log","./ThreeUtils"],function(e,t,r){"use strict";var a=function(){this._copyMaterial=new e.MeshBasicMaterial({transparent:true,fog:false});this._maskMaterial=new e.MeshBasicMaterial({side:e.DoubleSide,fog:false});this._outlineMaterial=new e.ShaderMaterial({uniforms:{mask:{value:null},offset:{value:new e.Vector2(1,0,0,1)}},vertexShader:["varying vec2 vTC;","void main() {","\tvTC = uv;","\tgl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);","}"].join("\n"),fragmentShader:["varying vec2 vTC;","uniform sampler2D mask;","uniform vec4 offset;","float delta(vec3 c1,  vec3 c2) {","\tvec3 dc = c1 - c2;","\treturn dot(dc, dc);","}","void main() {","\tvec3 c = texture2D(mask, vTC).rgb;","\tvec3 c1 = texture2D(mask, vTC + offset.xy).rgb;","\tvec3 c2 = texture2D(mask, vTC - offset.xy).rgb;","\tvec3 c3 = texture2D(mask, vTC + offset.zw).rgb;","\tvec3 c4 = texture2D(mask, vTC - offset.yw).rgb;","\tvec4 a = vec4(delta(c, c1), delta(c, c2), delta(c, c3), delta(c, c4));","\tgl_FragColor = vec4(1.0, 1.0, 1.0, sign(dot(a, a)));","}"].join("\n")});this._expandMaterial=new e.ShaderMaterial({uniforms:{mask:{value:null},offset:{value:new e.Vector2(1,0,0,1)}},vertexShader:["varying vec2 vTC;","void main() {","\tvTC = uv;","\tgl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);","}"].join("\n"),fragmentShader:["varying vec2 vTC;","uniform sampler2D mask;","uniform vec4 offset;","void main() {","\tfloat a = texture2D(mask, vTC).a;","\ta += texture2D(mask, vTC + offset.xy).a;","\ta += texture2D(mask, vTC - offset.xy).a;","\ta += texture2D(mask, vTC + offset.zw).a;","\ta += texture2D(mask, vTC - offset.yw).a;","\tgl_FragColor = vec4(1.0, 1.0, 1.0, a * 0.5);","}"].join("\n")});this._screenCamera=new e.OrthographicCamera(-1,1,1,-1,0,1);this._screenMesh=new e.Mesh(new e.PlaneGeometry(2,2))};a.prototype.render=function(t,r,a,i,s,n,l){if(!i||!i.length){return}var o=t.getSize(new e.Vector2);var v=2;var h=o.width*v;var c=o.height*v;if(!this._renderTarget1||this._renderTarget1.width!==h||this._renderTarget1.height!==c){var f={minFilter:e.NearestFilter,magFilter:e.NearestFilter};this._renderTarget1=new e.WebGLRenderTarget(h,c,f);this._renderTarget1.texture.generateMipmaps=false;this._renderTarget2=new e.WebGLRenderTarget(h,c,f);this._renderTarget2.texture.generateMipmaps=false}var u;var d;if(l){u=new Map;d=new Map;l.forEach(function(e){if(!e.node||!e.parent){return}u.set(e.node,e);if(e.parent){var t=d.get(e.parent)||[];t.push(e);d.set(e.parent,t)}})}var m;var M=new Set;var _=function(e){if(e.isMesh){var t=e;while(t){if(!t.visible){return}t=t.parent}M.add({mesh:e,color:m})}};var g;for(g=0;g<i.length;g++){var p=i[g];m=new e.Color((g+1&255)/255,(g+1>>8&255)/255,(g+1>>16&255)/255);p._vkTraverseNodes(_,u,d)}if(M.size===0){return}var C=new e.Color;t.getClearColor(C);var T=t.getClearAlpha();var x=t.autoClear;t.autoClear=false;t.setClearColor(0,0);var w;var k=this._renderTarget1;var y=this._renderTarget2;t.setRenderTarget(k);t.clear(true,true,false);var D=M.values();var b=D.next();while(!b.done){var S=b.value.mesh;this._maskMaterial.color=b.value.color;b=D.next();w=S.material;S.material=this._maskMaterial;t.render(S,a);S.material=w}var j=new e.Vector4(1/h,0,0,1/c);w=this._outlineMaterial;w.uniforms.mask.value=k.texture;w.uniforms.offset.value=j;this._screenMesh.material=w;t.setRenderTarget(y);t.render(this._screenMesh,this._screenCamera);if(n>1){w=this._expandMaterial;w.uniforms.offset.value=j;this._screenMesh.material=w;for(g=1;g<n;g++){var F=k;k=y;y=F;w.uniforms.mask.value=k.texture;t.setRenderTarget(y);t.render(this._screenMesh,this._screenCamera)}}w=this._copyMaterial;w.map=y.texture;w.color=s;this._screenMesh.material=w;t.setRenderTarget(null);t.render(this._screenMesh,this._screenCamera);t.setClearColor(C,T);t.autoClear=x};a.prototype.dispose=function(){if(this._copyMaterial){r.disposeMaterial(this._copyMaterial);this._copyMaterial=null}if(this._maskMaterial){r.disposeMaterial(this._maskMaterial);this._maskMaterial=null}if(this._outlineMaterial){r.disposeMaterial(this._outlineMaterial);this._outlineMaterial=null}if(this._expandMaterial){r.disposeMaterial(this._expandMaterial);this._expandMaterial=null}if(this._screenMesh){r.disposeObject(this._screenMesh);this._screenMesh=null}};return a});
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/threejs/ParametricGenerators", ["../thirdparty/three"],function(e){"use strict";var n={generateSphere:function(n,t){var r=new e.SphereGeometry(n.radius,32,32);var a=new e.Mesh(r,t||undefined);a.name="sphere";return a},generateBox:function(n,t){const r=new e.Mesh(new e.BoxGeometry(n.length,n.width,n.height),t||undefined);r.name="box";return r},generatePlane:function(n,t){var r=new e.PlaneGeometry(n.length,n.width);var a=new e.Mesh(r,t||undefined);a.name="plane";a.rotation.x=Math.PI/2;a.position.set(-n.length/2,-n.width/2,0);return a}};return n});
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/threejs/PerspectiveCamera", ["../PerspectiveCamera","../thirdparty/three"],function(t,e){"use strict";var a=t.extend("sap.ui.vk.threejs.PerspectiveCamera",{metadata:{library:"sap.ui.vk"}});var i=t.getMetadata().getParent().getClass().prototype;a.prototype.init=function(){if(i.init){i.init.call(this)}var t=1;var a=1e4;this._nativeCamera=new e.PerspectiveCamera(30,1,t,a);this._nativeCamera.position.set(0,0,100);this.setUsingDefaultClipPlanes(true)};a.prototype.update=function(t,e){var a=t/e;if(this._nativeCamera.aspect!==a){var i=this._nativeCamera.aspect;var r=this._nativeCamera.zoom;this._nativeCamera.aspect=a;this._nativeCamera.zoom=Math.min(this._nativeCamera.aspect,1);var n=this._nativeCamera.view;if(n&&n.enabled){var o=t/n.fullWidth;var s=e/n.fullHeight;var p=this._nativeCamera.zoom/r;var u=p*i/this._nativeCamera.aspect;n.offsetX=(n.offsetX*u+(n.fullWidth-n.width)*(1-u)*.5)*o;n.offsetY=(n.offsetY*p+(n.fullHeight-n.height)*(1-p)*.5)*s;n.width*=o;n.height*=s;n.fullWidth=t;n.fullHeight=e}this._nativeCamera.updateProjectionMatrix()}};a.prototype.exit=function(){if(i.exit){i.exit.call(this)}this._nativeCamera=null};a.prototype.getFov=function(){return this._nativeCamera.fov};a.prototype.setFov=function(t){this._nativeCamera.fov=t;this._nativeCamera.updateProjectionMatrix();this.setIsModified(true);return this};a.prototype.getCameraRef=function(){return this._nativeCamera};a.prototype.setCameraRef=function(t){this._nativeCamera=t;return this};a.prototype.getNearClipPlane=function(){return this._nativeCamera.near};a.prototype.setNearClipPlane=function(t){this._nativeCamera.near=t;this.setUsingDefaultClipPlanes(false);this._nativeCamera.updateProjectionMatrix();this.setIsModified(true);return this};a.prototype.getFarClipPlane=function(){return this._nativeCamera.far};a.prototype.setFarClipPlane=function(t){this._nativeCamera.far=t;this.setUsingDefaultClipPlanes(false);this._nativeCamera.updateProjectionMatrix();this.setIsModified(true);return this};a.prototype.getPosition=function(){return this._nativeCamera.position.toArray()};a.prototype.setPosition=function(t){this._nativeCamera.position.fromArray(t);this._nativeCamera.updateMatrixWorld();return this};a.prototype.getUpDirection=function(){return this._nativeCamera.up.toArray()};a.prototype.setUpDirection=function(t){this._nativeCamera.up.fromArray(t);this._nativeCamera.updateMatrixWorld();return this};a.prototype.getTargetDirection=function(){return this._nativeCamera.getWorldDirection(new e.Vector3).toArray()};a.prototype.setTargetDirection=function(t){var a=(new e.Vector3).fromArray(t);a.add(this._nativeCamera.position);this._nativeCamera.lookAt(a);return this};a.prototype.setUsingDefaultClipPlanes=function(t){this._nativeCamera.userData.usingDefaultClipPlanes=t;return this};a.prototype.getUsingDefaultClipPlanes=function(){return this._nativeCamera.userData.usingDefaultClipPlanes};a.prototype.adjustClipPlanes=function(t){var e=this._nativeCamera;e.updateMatrixWorld();t=t.clone().applyMatrix4(e.matrixWorldInverse);e.near=-t.max.z;e.far=-t.min.z;var a=Math.max(Math.max(e.far-e.near,e.far)*.0025,.001);e.near-=a;e.far+=a;e.near=Math.max(e.near,a);e.far=Math.max(e.far,e.near+a);var i=-(e.far+e.near)/(e.far-e.near);var r=-2*e.far*e.near/(e.far-e.near);e.projectionMatrix.elements[10]=i;e.projectionMatrix.elements[14]=r;e.projectionMatrixInverse.copy(e.projectionMatrix).invert();return this};return a});
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/threejs/PoiHelper", ["../ContentConnector","../ContentResource","./ContentDeliveryService","../NodeContentType","../TransformationMatrix","../thirdparty/three","sap/base/assert","sap/base/util/uid"],function(e,r,t,n,o,a,i,s){"use strict";var d=new a.Vector3(1,1,1);function c(e){e.userData={skipIt:true};e.children.forEach(c)}var m=function(){this._symbolSceneCache=[]};m.prototype.createPOI=function(e,r,t,m,u,l,f){m=m._implementation||m;if(!("sid"in l)){l.sid=s()}if(!("transform"in l)){i(f!=null,"If nodeInfo.transform is not defined then getNearestEntityOrVisibleElementNodes must be defined.");var v=m.getDomRef().getBoundingClientRect();var y=u.x-v.left;var p=u.y-v.top;var h=m.hitTest(y,p,{ignoreOverlay:true});if(h==null){return Promise.reject("Cannot locate an object for the marker.")}var x=(new a.Matrix4).compose(h.point,m._getNativeCamera().quaternion,d);var g=f(h.object);var N=g.length>0?(new a.Matrix4).copy(g[0].matrixWorld).invert():new a.Matrix4;x.premultiply(N);l.transform=o.convertTo4x3(x.elements);l.referenceNode=(g.length>0?g[0]:h.object).userData.nodeId}l.transformType="BILLBOARD_VIEW";var I=r.getDefaultNodeHierarchy();var w=I.createNode(null,l.name,null,n.Symbol,l);var b=m.getCurrentView()||r.getViews()[0];return this.loadSymbolScene(e,t).then(function(e){var r=e.userData.entityId;w.add.apply(w,e.children);w.children.forEach(c);w.userData.treeNode.entityId=r;b.updateNodeInfos([{target:w,visible:true,transform:l.transform}]);m.setShouldRenderFrame();return{transform:l.transform.slice(),veId:l.sid,entityId:r,name:l.name,transformType:"BILLBOARD_VIEW",contentType:"SYMBOL",referenceNode:l.referenceNode,symbolNode:w}})};m.prototype.updatePOI=function(e,r,t,n,o,a){var i=r.persistentIdToNodeRef(n);if("name"in a){i.name=a.name}if("transform"in a){if(i.userData.treeNode.transform){i.userData.treeNode.transform=a.transform.slice()}else{i.position.set(a.transform[9],a.transform[10],a.transform[11])}}if(o){var s=r.getDefaultNodeHierarchy();s.removeNode(i.children);return this.loadSymbolScene(e,o).then(function(e){var r=e.userData.entityId;i.add.apply(i,e.children);i.children.forEach(c);i.userData._symbolCenterFixed=false;i.userData.treeNode.entityId=r;t.setShouldRenderFrame();return r})}else{t.setShouldRenderFrame();return Promise.resolve(i.userData.treeNode.entityId)}};m.prototype.removePOI=function(e,r){var t=e.getDefaultNodeHierarchy();var n=e.getViewStateManager();n.setVisibilityState(r,false,true);var o=Array.isArray(r)?r:[r];if(o&&o.length){o.forEach(function(r){var t=r.userData.nodeId;var n=e.getReferenceNodeFromMarkerNodeId(t);if(n){e.unbindMarkerNodeTransformationFromReferenceNode(n.userData.nodeId,t)}})}t.removeNode(r)};m.prototype.getPoiRect=function(e,r){var t=e._getNativeCamera();var n=new a.Box3;n.setFromObject(r);var o=[new a.Vector3(n.min.x,n.min.y,n.min.z),new a.Vector3(n.max.x,n.max.y,n.max.z),new a.Vector3(n.min.x,n.min.y,n.max.z),new a.Vector3(n.min.x,n.max.y,n.max.z),new a.Vector3(n.max.x,n.min.y,n.max.z),new a.Vector3(n.max.x,n.max.y,n.min.z),new a.Vector3(n.min.x,n.max.y,n.min.z),new a.Vector3(n.max.x,n.min.y,n.min.z)];var i=new a.Frustum;i.setFromProjectionMatrix((new a.Matrix4).multiplyMatrices(t.projectionMatrix,t.matrixWorldInverse));if(!i.intersectsBox(n)){return false}var s=new a.Vector3(1,1,1);var d=new a.Vector3(-1,-1,-1);var c=new a.Vector3;for(var m=0;m<o.length;++m){if(!i.containsPoint(o[m])){return false}var u=c.copy(o[m]);var l=u.project(t);s.min(l);d.max(l)}var f=new a.Box2(s,d);var v=e.getDomRef().getBoundingClientRect();var y=new a.Vector2(v.width/2,v.height/2);var p=f.min.clone().multiply(y);var h=f.max.clone().multiply(y);var x=h.x-p.x;var g=h.y-p.y;return{width:x,height:g}};m.prototype.adjustPoi=function(e,r){if(e.getBackgroundProjection()!=="planar"){var t=r.getWorldPosition(new a.Vector3).project(e._getNativeCamera());var n=e.hitTest((t.x*.5+.5)*e._width,(t.y*-.5+.5)*e._height,{ignoreOverlay:true});if(n){r.position.copy(n.point)}r.quaternion.copy(e._getNativeCamera().quaternion);r.updateMatrix();r.updateMatrixWorld();r.userData.direction=(new a.Vector3).setFromMatrixColumn(r.matrixWorld,2).normalize()}r.userData.transform=o.convertTo4x3(r.matrix.elements)};m.prototype.updateNodeId=function(e,r,t){var n=e.persistentIdToNodeRef(r);if(n!=null){var o=e.getReferenceNodeFromMarkerNodeId(r);if(o){e.unbindMarkerNodeTransformationFromReferenceNode(o.userData.nodeId,r);e.bindMarkerNodeTransformationToReferenceNode(o.userData.nodeId,t)}e.setNodePersistentId(n,t)}return n};m.prototype.findSymbolSceneInCache=function(e,r){return this._symbolSceneCache.find(function(t){return t.url===e&&t.sceneId===r})};m.prototype.loadSymbolScene=function(n,o){var a=this.findSymbolSceneInCache(n,o);if(a!=null){return Promise.resolve(a.rootNodeRef.clone())}return new Promise(function(a,i){var d="marker-"+s();var c=new r({sourceType:d,source:n,veid:o,sourceId:"abc"});var m=new e;var u=new t;var l=function(){e.removeContentManagerResolver(d);setTimeout(function(){m.destroy();u.destroy()},0)};u.attachEventOnce("sceneCompleted",function(){var e=c.getNodeProxy().getNodeRef();if(this.findSymbolSceneInCache(n,o)==null){this._symbolSceneCache.push({url:n,sceneId:o,rootNodeRef:e.clone()})}a(e.clone());l()},this);u.attachEventOnce("errorReported",function(e){i(e.getParameter("error"));l()});e.addContentManagerResolver({pattern:d,dimension:3,contentManagerClassName:"sap.ui.vk.threejs.ContentManager",settings:{loader:u}});m.addContentResource(c)}.bind(this))};return m});
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/threejs/PointCloudGroup", ["../thirdparty/three"],function(t){"use strict";const e=function(e){this._position=new t.Vector3;this._quaternion=new t.Quaternion;this._size=new t.Vector3;this._color=new t.Vector4;r(this._position,e.position);r(this._quaternion,e.quaternion);r(this._size,e.size);r(this._color,e.color)};function r(t,e){if(e!=null){if(t.constructor===e.constructor){t.copy(e)}else if(Array.isArray(e)){t.fromArray(e)}else if(typeof e==="number"){t.setScalar(e)}}}e.prototype.getMatrix=function(){return(new t.Matrix4).compose(this._position,this._quaternion,this._size)};e.prototype.getPosition=function(){return this._position};e.prototype.getQuaternion=function(){return this._quaternion};e.prototype.getSize=function(){return this._size};e.prototype.getColor=function(){return this._color};function o(e){const r=.5;const o=[new t.Vector3(-r,-r,-r),new t.Vector3(r,-r,-r),new t.Vector3(-r,r,-r),new t.Vector3(r,r,-r),new t.Vector3(-r,-r,r),new t.Vector3(r,-r,r),new t.Vector3(-r,r,r),new t.Vector3(r,r,r)];o.forEach(t=>t.applyMatrix4(e));return o}function n(t,e){const r=t.getMatrix().invert().multiply(e.getMatrix());const n=o(r);return!(n.every(t=>t.x<-.5)||n.every(t=>t.x>.5)||n.every(t=>t.y<-.5)||n.every(t=>t.y>.5)||n.every(t=>t.z<-.5)||n.every(t=>t.z>.5))}e.prototype.intersectsGroup=function(t){return n(this,t)&&n(t,this)};e.prototype.overlapsGroup=function(t){const e=this.getMatrix().invert().multiply(t.getMatrix());const r=o(e);return r.every(t=>t.x>=-.5)&&r.every(t=>t.x<=.5)&&r.every(t=>t.y>=-.5)&&r.every(t=>t.y<=.5)&&r.every(t=>t.z>=-.5)&&r.every(t=>t.z<=.5)};const i=new t.Vector3;e.prototype.containsPoint=function(t){this._matrixInv??=this.getMatrix().invert();i.copy(t).applyMatrix4(this._matrixInv);return i.x>=-.5&&i.x<=.5&&i.y>=-.5&&i.y<=.5&&i.z>=-.5&&i.z<=.5};return e});
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/threejs/PolylineGeometry", ["../thirdparty/three"],function(t){"use strict";function e(n=null){var r=new t.InstancedBufferGeometry;Object.setPrototypeOf(r,e.prototype);r.type="PolylineGeometry";var i=[-1,2,0,1,2,0,-1,1,0,1,1,0,-1,0,0,1,0,0,-1,-1,0,1,-1,0];var s=[2,-1,2,1,1,-1,1,1,-1,-1,-1,1,-2,-1,-2,1];var o=[0,2,1,2,3,1,2,4,3,4,5,3,4,6,5,6,7,5];r.setIndex(o);r.setAttribute("position",new t.Float32BufferAttribute(i,3));r.setAttribute("uv",new t.Float32BufferAttribute(s,2));const u=n?n.getAttribute("position"):null;if(u&&u.count>0){const e=n.getAttribute("normal1").array;const i=n.getAttribute("normal2").array;const s=[];const o=u.count;const c=u.array;for(let e=0;e<o;++e){s.push(new t.Vector3(c[e*3],c[e*3+1],c[e*3+2]))}const a=o/2;const f=[];const h=new Float32Array(6*a);for(let t=0;t<a;++t){f.push(t*2);f.push(t*2+1);h[t*6]=e[t*6];h[t*6+1]=e[t*6+1];h[t*6+2]=e[t*6+2];h[t*6+3]=i[t*6];h[t*6+4]=i[t*6+1];h[t*6+5]=i[t*6+2]}r.setVertices(s,f,h)}return r}e.prototype=Object.assign(Object.create(t.InstancedBufferGeometry.prototype),{constructor:e,isPolylineGeometry:true,setVertices:function(e,n,r){this.vertices=e;this.indices=n;const i=n?n.length>>1:e.length-1;const s=new Float32Array(6*i);for(let t=0,r=0;t<i;t++){let i,o;if(n){i=e[n[t<<1]];o=e[n[(t<<1)+1]]}else{i=e[t];o=e[t+1]}s[r++]=i.x;s[r++]=i.y;s[r++]=i.z;s[r++]=o.x;s[r++]=o.y;s[r++]=o.z}const o=new t.InstancedInterleavedBuffer(s,6,1);this.setAttribute("instanceStart",new t.InterleavedBufferAttribute(o,3,0));this.setAttribute("instanceEnd",new t.InterleavedBufferAttribute(o,3,3));const u=new t.InstancedInterleavedBuffer(new Float32Array(2*i),2,1);this.setAttribute("instanceDistance",new t.InterleavedBufferAttribute(u,2,0));if(r&&r.length===s.length){const e=new t.InstancedInterleavedBuffer(r,6,1);this.setAttribute("normal1",new t.InterleavedBufferAttribute(e,3,0));this.setAttribute("normal2",new t.InterleavedBufferAttribute(e,3,3))}this.computeBoundingBox();this.computeBoundingSphere();return this},computeBoundingBox:function(){if(this.boundingBox===null){this.boundingBox=new t.Box3}this.boundingBox.setFromPoints(this.vertices)},computeBoundingSphere:function(){if(this.boundingSphere===null){this.boundingSphere=new t.Sphere}this.boundingSphere.setFromPoints(this.vertices)},_updateVertices:function(t){var e=this.vertices;var n=this.attributes.instanceStart.data;var r=n.array;t.forEach(function(t){var n=e[t];var i=t*6-3;if(i>=0){r[i+0]=n.x;r[i+1]=n.y;r[i+2]=n.z}if(i+5<r.length){r[i+3]=n.x;r[i+4]=n.y;r[i+5]=n.z}});n.needsUpdate=true;this.computeBoundingBox();this.computeBoundingSphere()},copy(e){t.InstancedBufferGeometry.prototype.copy.call(this,e);this.vertices=e.vertices;this.indices=e.indices;return this}});return e});
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/threejs/PolylineMaterial", ["../thirdparty/three"],function(e){"use strict";var t={lineColor:{value:new e.Color(1,1,1)},linewidth:{value:1},resolution:{value:new e.Vector2(1,1)},dashScale:{value:1},dashPeriod:{value:new e.Vector3(1,1,1)},dashAtlas:{value:null},lineLength:{value:1e5}};var i=e.UniformsUtils.merge([e.UniformsLib.common,e.UniformsLib.fog,t]);var n=["#include <common>","#include <color_pars_vertex>","#include <fog_pars_vertex>","#include <logdepthbuf_pars_vertex>","#include <clipping_planes_pars_vertex>","","uniform float linewidth;","uniform vec2 resolution;","","attribute vec3 instanceStart;","attribute vec3 instanceEnd;","#ifdef USE_ILLUSTRATION","attribute vec3 normal1;","attribute vec3 normal2;","varying float edgeVisibility;","#endif","","varying vec2 vTC;","","#if defined(USE_DASH) || TRIM_STYLE","attribute vec2 instanceDistance;","varying float vLineDistance;","#endif","","void trimSegment(const in vec4 start, inout vec4 end) {","\t// trim end segment so it terminates between the camera plane and the near plane","","\t// conservative estimate of the near plane","\tfloat a = projectionMatrix[ 2 ][ 2 ]; // 3nd entry in 3th column","\tfloat b = projectionMatrix[ 3 ][ 2 ]; // 3nd entry in 4th column","\tfloat nearEstimate = -0.5 * b / a;","","\tfloat t = (nearEstimate - start.z) / (end.z - start.z);","","\tend.xyz = mix(start.xyz, end.xyz, t);","}","","void main() {","\tvTC = uv * linewidth;","","\t// camera space","\tvec4 start = modelViewMatrix * vec4(instanceStart, 1.0);","\tvec4 end = modelViewMatrix * vec4(instanceEnd, 1.0);","","\t// special case for perspective projection, and segments that terminate either in, or behind, the camera plane","\t// clearly the gpu firmware has a way of addressing this issue when projecting into ndc space","\t// but we need to perform ndc-space calculations in the shader, so we must address this issue directly","\t// perhaps there is a more elegant solution -- WestLangley","","\tbool perspective = (projectionMatrix[ 2 ][ 3 ] == -1.0); // 4th entry in the 3rd column","\tif (perspective) {","\t\tif (start.z < 0.0 && end.z >= 0.0) {","\t\t\ttrimSegment(start, end);","\t\t} else if (end.z < 0.0 && start.z >= 0.0) {","\t\t\ttrimSegment(end, start);","\t\t}","\t}","","\t// clip space","\tvec4 clipStart = projectionMatrix * start;","\tvec4 clipEnd = projectionMatrix * end;","","\t// ndc space","\tvec2 ndcStart = clipStart.xy / clipStart.w;","\tvec2 ndcEnd = clipEnd.xy / clipEnd.w;","","\t// direction","\tvec2 dir = (ndcEnd - ndcStart) * resolution;","\tfloat l = length(dir);","\tdir = normalize(dir);","","\t// perpendicular to dir","\tvec2 offset = vec2(dir.y, -dir.x) * position.x;","","#if defined(USE_DASH) || TRIM_STYLE","\tvLineDistance = mix(instanceDistance.x, instanceDistance.y, position.y);","#endif","","\t// endcaps","\tif ( position.y < 0.0 ) {","\t\toffset -= dir;","#if defined(USE_DASH)","\t\tvLineDistance = mix(instanceDistance.x, instanceDistance.y, position.y * linewidth / l);","#endif","\t} else if ( position.y > 1.0 ) {","\t\toffset += dir;","#if defined(USE_DASH)","\t\tvLineDistance = mix(instanceDistance.x, instanceDistance.y, 1.0 + (position.y - 1.0) * linewidth / l);","#endif","\t}","","\t// select end","\tvec4 clip = (position.y < 0.5) ? clipStart : clipEnd;","\tclip /= clip.w; // remove perspective correction","","\tclip.xy += offset * (linewidth / resolution);","","\tgl_Position = clip;","","\tvec4 mvPosition = (position.y < 0.5) ? start : end; // this is an approximation","","#include <logdepthbuf_vertex>","#include <clipping_planes_vertex>","#include <fog_vertex>","#ifdef USE_ILLUSTRATION","\tvec3 eyeDirection = mvPosition.xyz;","\tvec3 n1 = normalMatrix * normal1;","\tvec3 n2 = normalMatrix * normal2;","\tedgeVisibility = dot(normal1, normal2) <= 0.5 ? 1.0 : step(dot(eyeDirection, n1) * dot(eyeDirection, n2), 0.0);","#endif","}"].join("\n");var a=["uniform vec3 diffuse;","uniform vec3 lineColor;","uniform float opacity;","uniform float linewidth;","","#ifdef USE_DASH","uniform float dashScale;","uniform vec3 dashPeriod;","uniform sampler2D dashAtlas;","#endif","","#ifdef USE_ILLUSTRATION","varying float edgeVisibility;","#endif","#if (TRIM_STYLE & 2)","uniform float lineLength;","#endif","","varying float vLineDistance;","","#include <common>","#include <color_pars_fragment>","#include <fog_pars_fragment>","#include <logdepthbuf_pars_fragment>","#include <clipping_planes_pars_fragment>","","varying vec2 vTC;","","void main() {","","#include <clipping_planes_fragment>","","\tvec4 diffuseColor = vec4(diffuse * lineColor, opacity);","","\tvec2 uv = abs(vTC);","\tdiffuseColor.a *= clamp(linewidth + 0.5 - uv.y, 0.0, 1.0); // line antialiasing","","#if (TRIM_STYLE & 1)","\tif (vLineDistance < 0.0)","\t\tdiscard;","#endif","","#if (TRIM_STYLE & 2)","\tif (vLineDistance > lineLength)","\t\tdiscard;","#endif","","\tif (uv.x > linewidth) { // apply segment cap","#if (SEGMENT_CAP_STYLE == 1) // round cap","\t\tvec2 delta = vec2(uv.y, uv.x - linewidth);","\t\tdiffuseColor.a *= clamp(linewidth - length(delta), 0.0, 1.0);","#else","\t\tdiffuseColor.a *= clamp(linewidth + 1.0 - uv.x, 0.0, 1.0);","#endif","\t}","","#include <logdepthbuf_fragment>","#include <color_fragment>","","#ifdef USE_DASH","\tfloat x = fract(vLineDistance * dashPeriod.y / dashScale);","\tvec4 dash = texture2D(dashAtlas, vec2(x * dashPeriod.z, 0.5));","\tdash.zw *= 255.0;","\tx *= dashPeriod.x;","\tdash.zw = vec2(dash.z - x, x - dash.w);","\tx = min(dash.z, dash.w) * dashScale;","#if (DASH_CAP_STYLE == 1) // round cap","\tvec2 delta = vec2(x * 2.0, uv.y);","\tdiffuseColor.a *= max(step(x / linewidth, 0.0), clamp(linewidth + 0.5 - length(delta), 0.0, 1.0));","#else // no cap","\tdiffuseColor.a *= clamp(0.5 - x, 0.0, 1.0);","#endif","#endif","","#ifdef USE_ILLUSTRATION","\tif (edgeVisibility < 0.01) discard;","\tdiffuseColor.a = 1.0;","#endif","\tgl_FragColor = diffuseColor;","","#include <premultiplied_alpha_fragment>","#include <tonemapping_fragment>","#include <colorspace_fragment>","#include <fog_fragment>","}"].join("\n");function r(t){var s=new e.ShaderMaterial({type:"PolylineMaterial",uniforms:e.UniformsUtils.clone(i),vertexShader:n,fragmentShader:a});Object.setPrototypeOf(s,r.prototype);s.defines.DASH_CAP_STYLE=0;s.defines.SEGMENT_CAP_STYLE=0;s.defines.TRIM_STYLE=0;s._dashPattern=[];s.dashOffset=0;s._illustration=false;Object.defineProperties(s,{color:{enumerable:true,get:function(){return this.uniforms.diffuse.value},set:function(e){this.uniforms.diffuse.value=e}},opacity:{enumerable:true,get:function(){return this.uniforms.opacity.value},set:function(e){this.uniforms.opacity.value=e}},lineColor:{enumerable:true,get:function(){return this.uniforms.lineColor.value},set:function(e){this.uniforms.lineColor.value=e}},linewidth:{enumerable:true,get:function(){return this.uniforms.linewidth.value},set:function(e){this.uniforms.linewidth.value=e}},dashCapStyle:{enumerable:true,get:function(){return this.defines.DASH_CAP_STYLE},set:function(e){this.defines.DASH_CAP_STYLE=e}},segmentCapStyle:{enumerable:true,get:function(){return this.defines.SEGMENT_CAP_STYLE},set:function(e){this.defines.SEGMENT_CAP_STYLE=e}},trimStyle:{enumerable:true,get:function(){return this.defines.TRIM_STYLE},set:function(e){this.defines.TRIM_STYLE=e}},dashScale:{enumerable:true,get:function(){return this.uniforms.dashScale.value},set:function(e){this.uniforms.dashScale.value=e}},dashPattern:{enumerable:true,get:function(){return this._dashPattern},set:function(e){this._dashPattern=e;this._updateDashAtlas()}},resolution:{enumerable:true,get:function(){return this.uniforms.resolution.value},set:function(e){this.uniforms.resolution.value.copy(e)}},illustration:{enumerable:true,get:function(){return this._illustration},set:function(e){this._illustration=e;if(e){this.defines.USE_ILLUSTRATION=1}else{delete this.defines.USE_ILLUSTRATION}}},lineLength:{enumerable:true,get:function(){return this.uniforms.lineLength.value},set:function(e){this.uniforms.lineLength.value=e}}});s.setValues(t);return s}r.prototype=Object.create(e.ShaderMaterial.prototype);r.prototype.constructor=r;r.prototype.isLineMaterial=true;r.prototype._updateDashAtlas=function(){if(!this._dashPattern.length){delete this.defines.USE_DASH;this.uniforms.dashAtlas.value=null;this.needsUpdate=true;return}var t=Array.from(this._dashPattern);if(t.length&1){t=t.concat(t)}var i=t.reduce(function(e,t){return e+Math.ceil(t)});var n=e.MathUtils.ceilPowerOfTwo(i);this.uniforms.dashPeriod.value.set(i,1/i,i/n);var a=new Uint8Array(n*4);for(var r=0,s=0,o=0;r<t.length;r++){var l=t[r];var d=r&1?s+l:s;var c=r&1?s:s+l;var u=r&1?0:255;while(l-- >0){a[o++]=u;a[o++]=0;a[o++]=d;a[o++]=c;s++}}var f=new e.DataTexture(a,n,1,e.RGBAFormat,e.UnsignedByteType,e.UVMapping,e.ClampToEdgeWrapping,e.ClampToEdgeWrapping,e.NearestFilter,e.NearestFilter);f.needsUpdate=true;this.defines.USE_DASH="";this.uniforms.dashAtlas.value=f;this.needsUpdate=true};r.prototype.copy=function(t){e.ShaderMaterial.prototype.copy.call(this,t);this.color.copy(t.color);this.lineColor.copy(t.lineColor);this.linewidth=t.linewidth;this.dashCapStyle=t.dashCapStyle;this.segmentCapStyle=t.segmentCapStyle;this.trimStyle=t.trimStyle;this.dashPattern=t.dashPattern;this.resolution=t.resolution;this._illustration=t._illustration;this.lineLength=t.lineLength;return this};return r});
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/threejs/PolylineMesh", ["../thirdparty/three","./PolylineGeometry","./PolylineMaterial"],function(e,t,a){"use strict";function r(i,l){var n=i!==undefined?i:new t;var c=l!==undefined?l:new a;var s=new e.Mesh(n,c);Object.setPrototypeOf(s,r.prototype);this.type="PolylineMesh";return s}r.prototype=Object.assign(Object.create(e.Mesh.prototype),{constructor:r,isPolylineMesh:true,computeLineDistances:function(){var t=new e.Vector4;var a=new e.Vector4;var r=new e.Vector2;var i=new e.Vector2;return function(e,l,n){var c=this.geometry;var s=c.attributes.instanceDistance.data;var o=s.array;const p=c.vertices;const y=c.indices;let u=this.material.dashOffset,f;if(!y){a.copy(p[0]).applyMatrix4(e)}for(let c=0,w=0,d=s.count;c<d;c++,w+=2){if(y){t.copy(p[y[c<<1]]).applyMatrix4(e);a.copy(p[y[(c<<1)+1]]).applyMatrix4(e);u=this.material.dashOffset}else{t.copy(a);a.copy(p[c+1]).applyMatrix4(e)}if(n!==undefined){if(t.w>=n){r.copy(t).multiplyScalar(1/t.w);if(a.w>=n){i.copy(a).multiplyScalar(1/a.w)}else{f=(t.w-n)/(t.w-a.w);i.copy(a).sub(t).multiplyScalar(f).add(t).multiplyScalar(1/n)}}else if(a.w>=n){i.copy(a).multiplyScalar(1/a.w);f=(a.w-n)/(a.w-t.w);r.copy(t).sub(a).multiplyScalar(f).add(a).multiplyScalar(1/n)}else{r.set(0,0,0);i.set(0,0,0)}}else{r.copy(t);i.copy(a)}o[w]=u;u+=i.sub(r).multiply(l).length()*.5;o[w+1]=u}this.material.lineLength=u;s.needsUpdate=true;return this}}()});return r});
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/threejs/Scene", ["sap/base/Log","../Scene","./NodeHierarchy","../RenderMode","../thirdparty/three","./PolylineGeometry","./PolylineMaterial","./PolylineMesh","./ThreeUtils","../totara/TotaraUtils","sap/base/util/uid"],function(e,t,r,i,n,a,o,s,l,u,c){"use strict";var d=t.extend("sap.ui.vk.threejs.Scene",{metadata:{library:"sap.ui.vk"},PoiCoordinateSpaces:{WorldSpace:0,ReferenceNodeSpace:1},constructor:function(e){t.call(this);this._id=c();this._scene=e;this._sceneBuilder=null;this._defaultNodeHierarchy=null;this._currentViewStateManager=null;this._animationSequenceMap=new Map;this._initialView=null;this._materialMap=new Map;this._outlineGeometryToNodes=new Map;this._annotationMap=new Map}});d.prototype.init=function(){this._outlineColor=new n.Vector4(0,0,0,1);this._illustrationLineWidth=1/640;this._outlineThickMaterial=new o({color:16777215,lineColor:new n.Color(this._outlineColor.x,this._outlineColor.y,this._outlineColor.z),linewidth:this._illustrationLineWidth,illustration:true,depthWrite:false,depthFunc:n.LessEqualDepth,polygonOffset:true,polygonOffsetFactor:-4,blending:n.NormalBlending,clipping:true});this._outlineMaterial=new n.ShaderMaterial({uniforms:{color:{value:this._outlineColor}},vertexShader:["attribute vec3 normal1;","attribute vec3 normal2;","#include <clipping_planes_pars_vertex>","uniform vec4 color;","varying vec4 vColor;","void main() {","\t#include <begin_vertex>","\t#include <project_vertex>","\t#include <clipping_planes_vertex>","\tvec3 eyeDirection = mvPosition.xyz;","\tvec3 n1 = normalMatrix * normal1;","\tvec3 n2 = normalMatrix * normal2;","\tvColor = color;","\tvColor.a *= dot(normal1, normal2) <= 0.5 ? 1.0 : step(dot(eyeDirection, n1) * dot(eyeDirection, n2), 0.0);","}"].join("\n"),fragmentShader:["#include <clipping_planes_pars_fragment>","varying vec4 vColor;","void main() {","\t#include <clipping_planes_fragment>","\tif (vColor.a < 0.01) discard;","\tgl_FragColor = vColor;","}"].join("\n"),depthWrite:false,depthFunc:n.LessEqualDepth,polygonOffset:true,polygonOffsetFactor:-4,blending:n.NormalBlending,clipping:true});this._solidWhiteMaterial=new n.MeshBasicMaterial({color:16777215})};d.prototype.clearThreeScene=function(){if(!this._scene){return}var e=[];var t=[];l.getAllTHREENodes([this._scene],e,t);var r=this._scene.userData;if(r.geometryClusters){e=e.concat(r.geometryClusters);delete r.geometryClusters}if(r.currentClusters){r.currentClusters.clear()}r.instanceDataTexture?.dispose();r.instanceDataTexture=null;r.currentInstanceIndex=0;var i=new Map;var a=new Map;e.forEach(function(e){if(e instanceof n.Mesh){if(!i.has(e.geometry.uuid)){l.disposeGeometry(e);i.set(e.geometry.uuid,true)}if(e.material){if(!a.has(e.material.uuid)){l.disposeMaterial(e.material);a.set(e.material.uuid,true)}}if(e.userData&&e.userData.originalMaterial&&e.userData.originalMaterial.uuid!==e.material.uuid&&!a.has(e.userData.originalMaterial.uuid)){l.disposeMaterial(e.userData.originalMaterial);a.set(e.userData.originalMaterial.uuid,true)}}if(e.parent){e.parent.remove(e)}});t.forEach(function(e){e.parent.remove(e)});i.clear();a.clear()};d.prototype.destroy=function(){this._outlineGeometryToNodes.clear();this.clearThreeScene();if(this._defaultNodeHierarchy){this._defaultNodeHierarchy.destroy();this._defaultNodeHierarchy=null}l.disposeMaterial(this._solidWhiteMaterial);l.disposeMaterial(this._outlineMaterial);l.disposeMaterial(this._outlineThickMaterial);this._sceneBuilder=null;this._scene=null;this._currentViewStateManager=null;this._animationSequenceMap.clear();this._materialMap.clear();t.prototype.destroy.call(this)};d.prototype.setDoubleSided=function(e){this.setProperty("doubleSided",e,true);this._scene.traverse(function(t){if(t.material!==undefined){var r=t.userData;var i=n.FrontSide;var a;if(r.originalMaterial){a=r.originalMaterial.userData;if(a.originalMaterialSide===undefined){a.originalMaterialSide=r.originalMaterial.side}i=a.originalMaterialSide}else{a=t.material.userData;if(a.originalMaterialSide===undefined){a.originalMaterialSide=t.material.side}i=a.originalMaterialSide}t.material.side=e?n.DoubleSide:i}});return this};d.prototype.setViewStateManager=function(e){this._currentViewStateManager=e;return this};d.prototype.getViewStateManager=function(){return this._currentViewStateManager};d.prototype.getId=function(){return this._id};d.prototype.getDefaultNodeHierarchy=function(){if(!this._defaultNodeHierarchy){this._defaultNodeHierarchy=new r(this)}return this._defaultNodeHierarchy};d.prototype._computeBoundingBox=function(e,t,r,i){var a=new n.Box3;if(this._scene){var o=this._scene.userData;var s=o.geometryClusters;if(e&&s&&s.length>100&&!i){var l;for(var u=0,c=s.length;u<c;++u){l=s[u].geometry.boundingBox;if(l){a.union(l)}}}else{this._scene._expandBoundingBox(a,e,t,r)}}return a};d.prototype.getSceneRef=function(){return this._scene};d.prototype.setSceneBuilder=function(e){this._sceneBuilder=e};d.prototype.getSceneBuilder=function(){return this._sceneBuilder};d.prototype.nodeRefToPersistentId=function(e){return Array.isArray(e)?e.map(function(e){return e._vkPersistentId()}):e._vkPersistentId()};d.prototype.persistentIdToNodeRef=function(e){var t=this._sceneBuilder;if(Array.isArray(e)){return e.map(function(e){return t?t.getNode(e):null})}else{return t?t.getNode(e):null}};d.prototype.setNodePersistentId=function(e,t,r){return this._sceneBuilder?this._sceneBuilder.setNodePersistentId(e,t,r):false};d.prototype._addAnnotation=function(e,t){this._annotationMap.set(e,t)};d.prototype._hasAnnotation=function(e){return this._annotationMap.has(e)};d.prototype._getAnnotations=function(){return this._annotationMap};d.prototype._removeAnnotationsForNode=function(e){this._annotationMap.forEach(function(t){if(t.node===e){this._annotationMap.delete(t.annotation.id)}},this)};d.prototype.setAnnotationPersistentId=function(e,t,r){var i=this._annotationMap.get(e.id);if(i){this._annotationMap.delete(e.id);i.annotation.id=t;this._annotationMap.set(t,i);return true}return false};d.prototype.getPointCloudGroups=function(){this._pointCloudGroups??=new Map;return this._pointCloudGroups};d.prototype.enumerateMaterials=function(){if(!this._defaultNodeHierarchy){return[]}var e=this._defaultNodeHierarchy.createNodeProxy(this._scene);if(e){return e.enumerateMaterials(true)}else{return[]}};var f=0;function p(e,t){var r=e.x-t.x;if(r<-f){return true}if(r>f){return false}var i=e.y-t.y;if(i<-f){return true}if(i>f){return false}return e.z-t.z<-f}function h(e,t,r){if(t<r){var i=y(e,t,r);h(e,t,i-1);h(e,i+1,r)}return e}function y(e,t,r){var i=e[r],n=t;for(var a=t;a<r;a++){if(p(e[a],i)){_(e,a,n);n++}}_(e,r,n);return n}function _(e,t,r){if(t!=r){var i=e[t];e[t]=e[r];e[r]=i}}function m(e,t){var r=new n.BufferGeometry;Object.setPrototypeOf(r,m.prototype);r.type="OutlineGeometry";var i=e&&e.isBufferGeometry&&e.getAttribute("position");if(!i||!e.index){return}e.computeBoundingBox();var a=new n.Vector3;e.boundingBox.getSize(a);f=Math.max(a.x,a.y,a.z)*1e-4;var o=i.count;var s=e.index.array;var l=s.length;if(o===0||l<3){return}var u,c,d,y;var _=new Array(o);for(u=0;u<o;u++){_[u]=(new n.Vector3).fromArray(i.array,u*i.itemSize);_[u].index=u}h(_,0,_.length-1);var M=[],g=[];M.push(_[0]);g[_[0].index]=M.length-1;for(u=1;u<o;u++){if(p(M[M.length-1],_[u])){M.push(_[u])}g[_[u].index]=M.length-1}var v=[];for(d=0;d<l;d+=3){var x=g[s[d]];var w=g[s[d+1]];var b=g[s[d+2]];if(x!==w&&w!==b&&b!==x){v.push(x,w,b)}}s=v;_=M;l=s.length;var B={},S;var N=new n.Vector3,D=new n.Vector3,A=new n.Vector3;var C=new Array(l/3);for(d=0,y=0;d<l;d+=3,y++){D.copy(_[s[d+1]]).sub(_[s[d]]);A.copy(_[s[d+2]]).sub(_[s[d]]);C[y]=(new n.Vector3).crossVectors(D,A).normalize();for(u=0,c=2;u<3;c=u++){var I=s[d+c];var k=s[d+u];S=Math.min(I,k)+","+Math.max(I,k);if(B[S]===undefined){B[S]={index1:I,index2:k,face1:y,face2:undefined}}else{B[S].face2=y}}}var T=Math.cos(n.MathUtils.DEG2RAD*(t!==undefined?t:1));var V=[];var G=[];var O=[];for(S in B){var z=B[S];if(z.face2===undefined||C[z.face1].dot(C[z.face2])<=T&&N.copy(_[z.index2]).sub(_[z.index1]).cross(C[z.face1]).dot(C[z.face2])>0){var P=_[z.index1];V.push(P.x,P.y,P.z);P=_[z.index2];V.push(P.x,P.y,P.z);var R=C[z.face1];G.push(R.x,R.y,R.z);G.push(R.x,R.y,R.z);if(z.face2!==undefined){var F=C[z.face2];O.push(F.x,F.y,F.z);O.push(F.x,F.y,F.z)}else{O.push(0,0,0);O.push(0,0,0)}}}r.setAttribute("position",new n.Float32BufferAttribute(V,3));r.setAttribute("normal1",new n.Float32BufferAttribute(G,3));r.setAttribute("normal2",new n.Float32BufferAttribute(O,3));return r}m.prototype=Object.create(n.BufferGeometry.prototype);m.prototype.constructor=m;function M(e){const t=e.userData.renderGroup?.boundingBox;if(t){return t[0]>=t[3]&&t[1]>=t[4]&&t[2]>=t[5]}const r=e.geometry.boundingBox;return r===null||r.min.x>=r.max.x&&r.min.y>=r.max.y&&r.min.z>=r.max.z}function g(e,t){const r=e.isMesh&&!!e.userData.skipIt===t&&!M(e)&&e.geometry;const i=r&&r.isBufferGeometry&&r.getAttribute("position");if(!i){return[0,0]}const n=e.userData.renderGroup;return n?[n.lastVertex-n.firstVertex,n.count]:[i.count,r.index?r.index.array.length:i.count]}function v(e,t,r,i,a,o){const s=i.isMesh&&!!i.userData.skipIt===a&&!M(i)&&i.geometry;const l=s&&s.isBufferGeometry&&s.getAttribute("position");if(!l){return}let c=null;if(a){i.updateMatrix();c=i.matrix}if(o){u.pushElementIntoMapArray(o,i.userData.geometryId,a?i.parent:i)}const d=i.userData.renderGroup;const f=d?d.firstVertex:0;const p=d?d.lastVertex-f:l.count;const h=l.array;const y=f*3;const _=r[0];const m=_*3;const g=new n.Vector3;for(let t=0,r=p*3;t<r;t+=3){g.set(h[y+t],h[y+t+1],h[y+t+2]);if(c){g.applyMatrix4(c)}e[m+t]=g.x;e[m+t+1]=g.y;e[m+t+2]=g.z}const v=r[1];const x=s?.index?.array;const w=d?d.start:0;let b;if(x){b=d?d.count:x.count;const e=f-_;for(let r=0;r<b;++r){t[v+r]=x[w+r]-e}}else{b=p;for(let e=0;e<b;++e){t[v+e]=_+e}}r[0]+=p;r[1]+=b}function x(t,r,i,o){try{let e,l=t.children.length;let[u,c]=g(t,false);for(e=0;e<l;++e){const[r,i]=g(t.children[e],true);u+=r;c+=i}if(!u){return}const d=new Float32Array(u*3);const f=new Uint32Array(c);let p=[0,0];v(d,f,p,t,false,o);for(e=0;e<l;++e){v(d,f,p,t.children[e],true,o)}const h=new n.BufferGeometry;h.setAttribute("position",new n.BufferAttribute(d,3));h.setIndex(new n.BufferAttribute(f,1));const y=new m(h);const _=y.getAttribute("position");if(_&&_.count>0){let e;if(r){const t=new a(y);t.boundingBox=new n.Box3;e=new s(t,i)}else{y.boundingBox=new n.Box3;e=new n.LineSegments(y,i)}e.isOutline=true;e.userData.skipIt=true;e.renderOrder=t.renderOrder+.5;e.matrixWorldNeedsUpdate=true;t.add(e);t.hasOutline=true}}catch(r){e.error("Unable to create outline geometry for node "+t.name,r)}}function w(e,t){var r=e.userData;if(r.defaultMaterial===undefined){r.defaultMaterial=r.originalMaterial||e.material}e.material=t;r.originalMaterial=null}function b(e){var t=e.userData;if(t.defaultMaterial){e.material=t.defaultMaterial;delete t.defaultMaterial;t.originalMaterial=null}}d.prototype._createOutlineGeometry=function(e){if(this._scene){this._scene._vkTraverseMeshNodes(function(t){if(t.isOutline){t.visible=true}else{if(!t.hasOutline){const e=this._illustrationLineWidth>0;x(t,e,e?this._outlineThickMaterial:this._outlineMaterial,this._outlineGeometryToNodes)}if(t.isMesh&&t.material&&!t.material.isLineBasicMaterial&&!t.material.isLineMaterial){switch(e){case i.LineIllustration:w(t,this._solidWhiteMaterial);break;case i.ShadedIllustration:var r=(t.userData.defaultMaterial||t.userData.originalMaterial||t.material).clone();if(r.emissive){r.color.multiplyScalar(.5);r.emissive.multiplyScalar(.5).addScalar(.5)}else{r.color.multiplyScalar(.5).addScalar(.5)}w(t,r);break;default:b(t);break}}}}.bind(this))}};d.prototype._hideOutlineGeometry=function(){if(this._scene){this._scene._vkTraverseMeshNodes(function(e){if(e.isOutline){e.visible=false}if(e.isMesh){b(e)}})}};d.prototype.onGeometryUpdated=function(e){const t=this._outlineGeometryToNodes.get(e);if(t){for(let e=0;e<t.length;++e){const r=t[e];const i=r.children;for(let e=i.length-1;e>=0;--e){const t=i[e];if(t.isOutline){const e=t.isPolylineMesh;const i=t.material;r.remove(t);x(r,e,i,null);break}}}}};d.prototype.getInitialView=function(){return this._initialView};d.prototype.setInitialView=function(e){this._initialView=e};d.prototype.getMaterial=function(e){return this._materialMap.get(e)};d.prototype.setMaterial=function(e,t){this._materialMap.set(e,t)};d.prototype.clearUnusedMaterials=function(){const e=new Set;this._scene?.traverse(t=>{if(t.material){e.add(t.material);if(t.userData.originalMaterial){e.add(t.userData.originalMaterial)}}});const t=[];this._materialMap.forEach(function(r,i){if(e.has(r.getMaterialRef())){t.push([i,r])}else{r.destroy()}});this._materialMap=new Map(t)};d.prototype._getNativeMaterial=function(e){var t=e?this._materialMap.get(e):null;return t?t.getMaterialRef():null};d.prototype._setNodeMaterial=function(e,t){var r=this._getNativeMaterial(t);e.children.forEach(function(e){if(e.material){if(r){if(e.userData.materialId!==t){this._sceneBuilder._setSubmeshMaterial(e,r,t)}}else{var i=e.userData.initialMaterialId;if(i&&e.userData.materialId!==i){var n=this._getNativeMaterial(i);if(n){this._sceneBuilder._setSubmeshMaterial(e,n,i)}}}}}.bind(this))};d.prototype.bindMarkerNodeTransformationToReferenceNode=function(e,t){if(this._sceneBuilder){this._sceneBuilder.bindMarkerNodeTransformationToReferenceNode(e,t,this.PoiCoordinateSpaces.ReferenceNodeSpace)}};d.prototype.unbindMarkerNodeTransformationFromReferenceNode=function(e,t){if(this._sceneBuilder){this._sceneBuilder.unbindMarkerNodeTransformationFromReferenceNode(e,t)}};d.prototype.getReferenceNodeFromMarkerNodeId=function(e){if(this._sceneBuilder){return this._sceneBuilder.getReferenceNodeFromMarkerNodeId(e)}return null};d.prototype.updateMarkerCoordinateSpace=function(e,t,r){if(!e||!t||!r){return}if(this._sceneBuilder){this._sceneBuilder.updateMarkerCoordinateSpace(e,t,r)}};return d});
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/threejs/SceneBuilder", ["../thirdparty/three","sap/base/Log","./UsageCounter","../totara/TotaraUtils","./OrthographicCamera","./PerspectiveCamera","./DetailView","./AnimationHelper","./Thrustline","./Billboard","./Callout","../BillboardCoordinateSpace","../BillboardTextEncoding","../BillboardStyle","../BillboardBorderLineStyle","../BillboardHorizontalAlignment","../LeaderLineMarkStyle","../DetailViewType","../DetailViewShape","../AnimationPlayback","../AnimationRotateType","../RenderMode","./Material","./MaterialType","./SphericalMapMaterial","../ObjectType","./ParametricGenerators","../NodeContentType","../NavigationMode","sap/base/util/uid","./ThreeUtils","sap/base/assert","../colorToCSSColor","../TransformationMatrix","./PointCloudGroup"],function(e,t,r,i,a,n,s,o,d,u,l,c,h,p,f,m,v,g,y,_,I,S,b,w,D,M,x,T,C,A,k,N,R,P,B){"use strict";var V=function(e,t,r,i){this._rootNode=e;this._contentResource=t;this._resolve=r;this._reject=i;this._callouts=new Map;this._cameras=new Map;this._images=new Map;this._imageIdsAndTileWidths=new Map;this._imageTextures=new Map;this._geometries=new Map;this._meshNodes=new Map;this._meshSubmeshes=new Map;this._geometryProxies=new Map;this._geometrySubmeshIndices=new Map;this._materialMeshes=new Map;this._materialClones=new Map;this._joints=[];this._pointCloudGroups=[];this._imageAddedToMaterialHandlers=[];this._isSmallScene=null;this._preprocessedClusterDefinitions=null;this._preprocessedSubmeshToClusterMap=null;this._temporaryGeometryBuffer={points:new Float32Array(65536*3),normals:new Float32Array(65536*3),colors:new Float32Array(65536*3),uvs:new Float32Array(65536*2),indices:new Uint16Array(65536),previousIndexCount:0};this._nodeWithAssocicatedMarkers=new Map;this._markNodeIdsToRefNodeIds=new Map;if(e){this._nodes=new Map;this._tracks=new Map;this._trackIdSequenceNodeMap=new Map;this._viewGroups=new Map;this._views=new Map}else{this._nodes=null;this._tracks=null;this._trackIdSequenceNodeMap=null;this._viewGroups=null;this._views=null}this._currentSceneId=null;this._sceneIdTreeNodesMap=new Map;this._sceneIdRootNodeMap=new Map;this._animationHelper=new o(this);if(t){var a=t.getNodeProxy();var n=a.getNodeHierarchy();this._vkScene=n.getScene();var s=t.getSource();if(s&&s.name){this._sceneIdTreeNodesMap.set(s.name,this._nodes);this._sceneIdRootNodeMap.set(s.name,e);this._currentSceneId=s.name}}this._viewThumbnails=new Map;this._thrustlines=new Map;this._animations=new Map;this._animationTracks=new Map;this._jointNodesMap=new Map;this._jointParentsMap=new Map;this._upAxis=2;this._voxelThreshold=0;this._maximumRenderedPointsBudget=20*1e6};V.prototype.getVoxelThreshold=function(){return this._voxelThreshold};V.prototype.setVoxelThreshold=function(e){this._voxelThreshold=e;return this};var O=[S.Default,S.Default,S.Default,S.LineIllustration,S.SolidOutline,S.ShadedIllustration];V.prototype.setScene=function(e){this._vkScene.setSceneBuilder(this);var t=this._cameras.get(e.cameraId);this._upAxis=e.upAxis;this._resolve({node:this._rootNode,camera:t,backgroundTopColor:e.backgroundTopColor,backgroundBottomColor:e.backgroundBottomColor,upAxis:e.upAxis,dimension:e.dimension,outputSettings:e.showPaperFrame?e.outputSettings:null,contentResource:this._contentResource,builder:this})};V.prototype.setRootNode=function(e,t,r,i){this._rootNode=e;this._nodes=new Map;this._nodes.set(t,e);this._tracks=new Map;this._trackIdSequenceNodeMap=new Map;this._sequenceIdToPlaybacks=new Map;this._viewGroups=new Map;this._views=new Map;if(r){this._sceneIdTreeNodesMap.set(r,this._nodes);this._sceneIdRootNodeMap.set(r,e);this._currentSceneId=r}if(i){this._vkScene=i;if(this._sceneMetadata){this._vkScene.setSceneMetadata(this._sceneMetadata)}}return this};V.prototype._resetCurrentScene=function(e){if(e&&e!==this._currentSceneId){var t=this._sceneIdTreeNodesMap.get(e);if(t){this._nodes=t}else{this._nodes=null}var r=this._sceneIdRootNodeMap.get(e);if(r){this._rootNode=r}else{this._rootNode=null}this._currentSceneId=e}};V.prototype.getNode=function(e,t){if(t){this._resetCurrentScene(t);if(this._nodes){return this._nodes.get(e)}}else{var r=this._sceneIdTreeNodesMap.values();var i=r.next();while(!i.done){var a=i.value.get(e);if(a){return a}i=r.next()}}return null};V.prototype.hasMesh=function(e){return this._meshSubmeshes.has(e)};V.prototype.hasImage=function(e){return this._images.has(e)};V.prototype.hasAnnotation=function(e){return this._vkScene._hasAnnotation(e)};V.prototype.setNodePersistentId=function(e,t,r){var i=e.userData;var a=i.treeNode;if(a==null){a=i.treeNode={}}var n=a.sid;this._resetCurrentScene(r);i.nodeId=a.sid=t;if(this._nodes){if(n){this._nodes.delete(n)}this._nodes.set(t,e);return true}return false};var E=function(t){var r=new e.Matrix4;if(t.length===3){r.setPosition((new e.Vector3).fromArray(t))}else if(t.length===12){r.fromArray(P.convertTo4x4(t))}else if(t.length===16){r.fromArray(t)}else{throw"Invalid matrix format"}return r};V.prototype._createTemporaryMaterial=function(t,r){var i=new b(r||w.MeshPhongMaterial);var a=i.getMaterialRef();a.vertexColors=true;a.userData.materialUsed=0;a.userData.materialId=t;a.userData.toBeUpdated=true;if(this._vkScene.getDoubleSided()){a.side=e.DoubleSide;a.userData.originalMaterialSide=e.FrontSide}this._vkScene.setMaterial(t,i);var n=this._materialMeshes.get(t);if(n){n.forEach(function(e){this._updateMeshSubmeshesMaterial(e,t,a)},this)}var s=this._vkScene.getSceneRef().userData;if(!s.instanceDataTexture){var o=2048;var d=2048;s.maxInstanceIndex=Math.floor(2048*2048*4/20)-1;s.instanceDataTexture=new e.DataTexture(new Float32Array(o*d*4),o,d,e.RGBAFormat,e.FloatType);s.instanceDataTexture.version=1;s.instanceDataTexture.image.needsUpdate=true;s.instanceDataTexture.onUpdate=function(e){e.userData.textureUpdateParams=null};s.textureUpdateResults=null}a.specularMap=s.instanceDataTexture;return a};V.prototype._getMaterialRef=function(e){var t=this._vkScene.getMaterial(e);return t?t.getMaterialRef():null};V.prototype.checkMaterialExists=function(e,t){if(this._getMaterialRef(e)===null){if(t){this._createTemporaryMaterial(e)}return false}return true};V.prototype.materialNeeded=function(e){return true};V.prototype.attachImageAddedToMaterial=function(e,t){this._imageAddedToMaterialHandlers.push({func:e,listener:t});return this};V.prototype.detachImageAddedToMaterial=function(e,t){for(var r=0;r<this._imageAddedToMaterialHandlers.length;r++){var i=this._imageAddedToMaterialHandlers[r];if(i.func===e&&i.listener===t){this._imageAddedToMaterialHandlers.splice(r,1);return this}}return this};V.prototype.fireImageAddedToMaterial=function(e){var t=this._imageAddedToMaterialHandlers.slice();t.forEach(function(t){t.func.call(t.listener,e)});return this};V.prototype._attachMaterialClone=function(e,t){i.pushElementIntoMapArray(this._materialClones,e,t)};V.prototype._addDynamicObject=function(e,t,r){var i=this._rootNode.userData;if(!i._vkDynamicObjects){i._vkDynamicObjects=[]}if(i._vkDynamicObjects.indexOf(e)<0){i._vkDynamicObjects.push(e)}e._vkUpdate=t;if(r){e.userData.is2D=true}};const G={REFERENCE:T.Reference,ANNOTATION:T.Annotation,BACKGROUND:T.Background,SYMBOL:T.Symbol,PMI:T.PMI,POINT_CLOUD_GROUP:T.PointCloudGroup};V.prototype.createNode=function(t,r){this._resetCurrentScene(r);var i=new e.Group;this._nodes.set(t.sid,i);var a;var n=this._jointNodesMap.get(t.sid);if(n&&n.length){for(a=0;a<n.length;a++){n[a].node=i}}var s=this._jointParentsMap.get(t.sid);if(s&&s.length){for(a=0;a<s.length;a++){s[a].parent=i}}var o=this._nodes.get(t.parentId);(o||this._rootNode).add(i);var d=i.userData;d.treeNode=t;if(t.closed){d.closed=true}if(t.selectable===false){d.selectable=false}if(t.visualisable===false&&t.contentType!=="SYMBOL"){d.skipIt=true}if(t.metadata){d.metadata=t.metadata}if(t.veids){d.veids=t.veids}if(t.usageIds){d.usageIds=t.usageIds}if(t.sid){d.nodeId=t.sid}if(t.name){i.name=t.name}if(t.visible!==undefined){i.visible=!!t.visible}if(o){var l;if(d.skipIt||o.name&&i.name===o.name+" offset geometry"){d.skipIt=true}else{l=o;while(l){if(l.userData.closed){d.skipIt=true;d.skipItClosed=true}l=l.parent}}if(o.userData.symbolContent){d.skipIt=true;if(d.skipItClosed===true){d.skipItClosed=false}d.symbolContent=true}if(i.visible&&!d.skipIt&&this._contentResource){l=o;while(l){l.visible=true;l=l.parent}}}if(t.renderOrder){i.renderOrder=t.renderOrder}if(t.renderMethod){d.renderMethod=t.renderMethod}if(t.renderStage){if(typeof t.renderStage==="string"){t.renderStage={UNDERLAY_2D:-1,OVERLAY_2D:1}[t.renderStage]||0}d.renderStage=t.renderStage}d.opacity=t.opacity;if(t.transform){i.applyMatrix4(E(t.transform));if(!isFinite(i.quaternion.x)||!isFinite(i.quaternion.y)||!isFinite(i.quaternion.z)||!isFinite(i.quaternion.w)){i.quaternion.set(0,0,0,1)}}i.updateMatrixWorld(true);if(t.objectTransform){d.objectTransform=(new e.Matrix4).fromArray(t.objectTransform)}if(t.transformType){d.transformType=t.transformType;switch(t.transformType){case"ORTHO2D":d.originalTransform={p:i.position.clone(),q:i.quaternion.clone(),s:i.scale.clone()};this._addDynamicObject(i,u.prototype._ortho2DUpdate,true);break;case"BILLBOARD_VIEW":this._addDynamicObject(i,u.prototype._billboardViewUpdate,false);break;case"LOCK_TOVIEWPORT":this._addDynamicObject(i,u.prototype._lockToViewportUpdate,true);break;default:break}}if(t.materialId){d.materialId=t.materialId}if(t.geometryType){d.geometryType=t.geometryType}if(t.meshId){this.setMeshNode(t.sid,t.meshId)}if(t.parametricId){this.setParametricNode(t.sid,t.parametricId,t.visible)}if(t.dynamicContentId){const e=this._nodes.get(t.sid);if(e){const r=t.visible;e.userData.parametricVisible=r!==undefined?r:true}}if(i.parent.userData.objectType===M.Hotspot){d.objectType=M.Hotspot}else if(i.parent.userData.objectType===M.PMI){d.objectType=M.PMI}else if(t.contentType==="HOTSPOT"){d.objectType=M.Hotspot}else if(t.contentType==="DYNAMIC_CONTENT"){d.objectType=M.DynamicContent}else if(t.contentType==="PMI"){d.objectType=M.PMI}const c=G[t.contentType];if(c){i._vkSetNodeContentType(c)}return i};V.prototype.removeNode=function(e){this._nodes.delete(e._vkPersistentId());this._vkScene._removeAnnotationsForNode(e);this._vkScene.getPointCloudGroups().delete(e);this.setPointCloudGroups([],this._currentSceneId);var t=false;if(!this._forbiddenTextureUpdate){this._forbiddenTextureUpdate=true;t=true;var r=this._vkScene.getSceneRef().userData;if(r.instanceDataTexture){var i=r.geometryClusters;var a=k.prepareTextureUpdateResults(i?i.length:0,r.textureUpdateResults);k.removeNodeFromClusterRenderingRecursive(e,r.instanceDataTexture.image.data,a);r.textureUpdateResults=a}}e.children.forEach(this.removeNode,this);if(t){delete this._forbiddenTextureUpdate}};V.prototype.hasNode=function(e){return this._nodes.has(e._vkPersistentId())};V.prototype.getChildNodeIds=function(e,t,r){this._resetCurrentScene(t);var i=this._nodes.get(e);var a=[];if(!i){return a}if(i&&i.children){for(var n=0;n<i.children.length;n++){var s=i.children[n];if(s.userData.treeNode&&s.userData.treeNode.sid){a.push(s.userData.treeNode.sid)}else if(r&&s.userData.submeshInfo&&s.userData.submeshInfo.id){a.push(s.userData.submeshInfo.id)}}}return a};function L(e){for(var t=0;t<e.length;t++){if(e[t].type==="box"&&e[t].data){return e[t]}}return null}function U(e){if(Array.isArray(e)){for(var t=0;t<e.length;t++){if(e[t].type===undefined||e[t].type==="mesh"||e[t].type==="line"){return e[t]}}}return null}V.prototype._addGeometryToCluster=function(t,r,i,a,n,s,o,d,u,l,c){var h=this._vkScene.getSceneRef().userData;var p=65536;var f=3*p;var m=r.length/3;var v=s?s.length:0;const g=v===0;const y=o?"l":"t";const _=!o&&(i&&i.length===m*3);const I=!o&&!g&&(n&&n.length===m*2);const S=a&&a.length===m*3||g;let b=d+":"+(g?"p":y)+(_?"N":"n")+(S?"C":"c")+(I?"U":"u")+l;if(!h.currentClusters){h.currentClusters=new Map}var w=this._preprocessedSubmeshToClusterMap?this._preprocessedSubmeshToClusterMap.get(u):-1;var D=w>=0?this._preprocessedClusterDefinitions[w]:null;if(D){b="pre"+w;p=D.verts;f=D.elems*(o?2:3)}var M=D?D.cluster:h.currentClusters.get(b);if(!M||M.freeVertices<m||M.freeIndices<v){M=new e.BufferGeometry;if(D){D.cluster=M}else{h.currentClusters.set(b,M)}if(l>1){M.userData.renderInstanceCount=l}M.freeVertices=p;M.freeIndices=f;M.contents=[];M.userData.geometryUsed=0;if(!g){M.setIndex(new e.BufferAttribute(new Uint16Array(f),1))}M.setAttribute("position",new e.BufferAttribute(new Float32Array(p*3),3));M.setAttribute("clusterInstance",new e.BufferAttribute(new Float32Array(p),1));if(g){M.userData.isPointCloud=true}else if(o){M.userData.isPolyline=true}if(_){M.setAttribute("normal",new e.BufferAttribute(new Float32Array(p*3),3))}if(S){M.setAttribute("color",new e.BufferAttribute(new Float32Array(p*3),3))}if(I){M.setAttribute("uv",new e.BufferAttribute(new Float32Array(p*2),2))}let t=this._getMaterialRef(d);var x;if(g){t=t.clone();t.userData.isPointCloud=true;x=new e.Points(M,t)}else if(o){x=new e.LineSegments(M,t)}else{x=new e.Mesh(M,t);if(!_){t.side=e.DoubleSide;t.userData.originalMaterialSide=e.DoubleSide}}t.needsUpdate=true;x.additionalRenderables=[];if(h.geometryClusters){h.geometryClusters.push(x)}else{h.geometryClusters=[x];h.currentInstanceIndex??=0}x.userData.isGeometryCluster=true;M.userData.clusterIndex=h.geometryClusters.length-1}var T=p-M.freeVertices;k.updateClusterAttrib(M,"position",T*3,r);if(M.userData.isPointCloud&&this._pointCloudGroups.length>0){k._updateClusterInstanceAttribute(M,T,m,h.currentInstanceIndex,this._pointCloudGroups)}else{const e=M.getAttribute("clusterInstance");e.array.fill(h.currentInstanceIndex,T,T+m);e.addUpdateRange(T,m);e.needsUpdate=true}if(_){k.updateClusterAttrib(M,"normal",T*3,i)}if(S){if(!a){a=new Float32Array(m*3);a.fill(.7)}k.updateClusterAttrib(M,"color",T*3,a)}if(I){k.updateClusterAttrib(M,"uv",T*2,n)}var C=f-M.freeIndices;if(!g){k.updateClusterIndices(M,s,T,C,v)}M.freeVertices-=m;M.freeIndices-=v;M.drawRange.count=g?T+m:C+v;M.contents.push({instanceIndex:h.currentInstanceIndex,vertexLast:(T+m)*3,isFinal:c});M.shouldUpload=2;if(t){M.boundingBox=e.Box3.newFromPackedArray(t)}else{M.computeBoundingBox(T,T+m)}M.computeBoundingSphere(T,T+m,true);const A={geometry:M,vertexStart:T,vertexCount:m,indexStart:g?undefined:C,indexCount:g?undefined:v,boundingBox:M.boundingBox,boundingSphere:M.boundingSphere,instanceIndex:h.currentInstanceIndex};M.boundingBox=null;M.boundingSphere=null;return A};function q(e,t){var r=e.boundingBox.min;var i=e.boundingBox.max;var a=e.boundingSphere;return{firstVertex:e.vertexStart,lastVertex:e.vertexStart+e.vertexCount,start:e.indexStart===undefined?e.vertexStart:e.indexStart,count:e.indexCount===undefined?e.vertexCount:e.indexCount,instanceIndex:t,clusterIndex:e.geometry.userData.clusterIndex,boundingBox:[r.x,r.y,r.z,i.x,i.y,i.z],boundingSphere:[a.center.x,a.center.y,a.center.z,a.radius]}}V.prototype._cloneSubmesh=function(t,r){var a=t instanceof e.Mesh?t._vkClone():t.clone();if(r.userData.transformType==="ORTHO2D"){a.position.setScalar(0);a.scale.setScalar(1)}a.userData.skipIt=true;a.renderOrder=r.renderOrder;if(r.userData.materialId){k.disposeMaterial(a.material);a.material=this._getMaterialRef(r.userData.materialId)||t.material;a.userData.materialId=r.userData.materialId;i.pushElementIntoMapArray(this._materialMeshes,r.userData.materialId,t.userData.meshId)}return a};V.prototype.preprocessMeshes=function(e){if(this._preprocessedSubmeshToClusterMap){return}this._preprocessedClusterDefinitions=[];this._preprocessedSubmeshToClusterMap=new Map;var r=performance.now();var a=new Set;var n=new Map;var s=0,o=0,d=0;var u=0,l=0;var c=0,h=0,p=0,f=0;var m=0,v=0;var g,y,_,I,S,b,w,D,M,x;var T,C,A;var N,R,P,B,V,O;var E,G;var L=e.length;var q,F;var W=[];for(g=0;g<L;++g){y=e[g];_=y.id;I=y.submeshes;N=false;W.length=0;for(S=0,b=I.length;S<b;++S){M=I[S].lods[0];W.push(M.boundingBox);if(!M.elementCount){N=true}}E=this._meshNodes.get(_);if(E){y.priority=this._computeMeshPriority(E,W);if(N){F=E[0].name;F=F?F.split(":"):null;if(F&&F[1]&&F[0]==="_machete.pointsSubMesh"){y.priority0=Number(F[1])}}}else{y.priority=0}}e.sort(function(e,t){if(e.priority0!==undefined&&t.priority0!==undefined){if(e.priority0<t.priority0){return-1}else if(e.priority0>t.priority0){return 1}}return t.priority-e.priority});for(g=0;g<L;++g){y=e[g];_=y.id;if(a.has(_)){continue}a.add(_);E=this._meshNodes.get(_);G=E?E.length:0;d+=G;if(G===0){o++;continue}s++;I=y.submeshes;for(S=0,b=I.length;S<b;++S){w=I[S];D=w.materialId;q=false;M=U(w.lods);x=!M?null:M.id;if(x==null){continue}T=M.pointCount;C=M.elementCount||0;A=M.flags;if(T>0&&A!=null){N=C===0;R=(A&1)>0;P=!R&&(A&2)>0;V=!R&&!N&&(A&4)>0;B=(A&32)>0;O=R?"l":"t";u++;if(N){if(y.priority0===0||m<this._maximumRenderedPointsBudget){m+=T}else{for(F=0;F<G;++F){E[F].visible=false}q=true;y.skipPointCloud=true;v+=T}}else if(R){f+=2*2*C;c+=T;p+=C}else{f+=2*3*C;c+=T;h+=C}if(!q){f+=(3+1+(P?3:0)+(B?3:0)+(V?2:0))*4*T;i.pushElementIntoMapArray(n,D+":"+(N?"p":O)+(P?"N":"n")+(B?"C":"c")+(V?"U":"u")+G,{submeshId:w.id,verts:T,elems:C,meshIndex:g,submeshIndex:S})}}else{l++}}}n.forEach(function(t){k.partitionCluster(t,this._preprocessedClusterDefinitions,this._preprocessedSubmeshToClusterMap,e)},this);this._isSmallScene=u<2e3&&c<1e6&&m<1e6;t.info(n.size+" unique cluster types detected in "+(performance.now()-r).toFixed(1)+"ms.  "+"Scene frame classification: "+(this._isSmallScene?"small.  ":"large.  ")+s+" meshes ("+o+" undefined).  "+d+" mesh instances.  "+(d/s).toFixed(1)+"X instancing.  "+u+" geometries ("+l+" undefined).  "+c.toLocaleString()+" unique vertices.  "+h.toLocaleString()+" unique triangles.  "+p.toLocaleString()+" unique lines.  "+m.toLocaleString()+" unique points.  "+v.toLocaleString()+" skipped points.  "+(f/1048576).toFixed(1)+"MB VRAM in "+this._preprocessedClusterDefinitions.length+" clusters expected.")};V.prototype.getTempGeometryBuffer=function(){return this._temporaryGeometryBuffer};V.prototype.setSubmeshes=function(e){this.preprocessMeshes(e);var t,r,i,a,n;for(var s=0,o=e.length;s<o;++s){t=e[s];r=t.submeshes;for(a=0,n=r.length;a<n;++a){i=r[a];this.insertSubmesh(i)}}};V.prototype.insertSubmesh=function(t){var r=this._getMaterialRef(t.materialId)||this._createTemporaryMaterial(t.materialId);var a=t.id;var n=U(t.lods);if(!n){return false}var s=n.pointCount;var o=n.elementCount===0?null:n.elementCount;var d=s>0&&o>0;var u=n.id;var l=n.flags;var c=n.boundingBox;var h=this._meshNodes.get(t.meshId);var p=null;var f;var m=h?h.length:0;if(!c){var v=new e.BufferGeometry;var g=new e.BufferAttribute(new Uint16Array(0),1);var y=new e.BufferAttribute(new Float32Array(0),3);v.setIndex(g);v.setAttribute("position",y);f=new e.Mesh(v,r)}else if(l!=null&&s>0&&o==null){const i=k.buildEmptyMesh(c,l,s,o,this._temporaryGeometryBuffer);p=this._addGeometryToCluster(c,i.points,i.normals,i.colors,undefined,undefined,false,t.materialId,a,m,false);f=new e.Points(p.geometry,r)}else if(l!=null&&(l&1)>0&&d){const i=k.buildEmptyMesh(c,l,s,o,this._temporaryGeometryBuffer);p=this._addGeometryToCluster(c,i.points,undefined,undefined,undefined,i.indices,true,t.materialId,a,m,false);f=new e.LineSegments(p.geometry,r)}else{var _=L(t.lods);var I=_?_.data:null;if(this._isSmallScene==null){this._isSmallScene=this._meshNodes.size<2e3&&this._nodes.size<5e3}var S=!I;var b=!d||m<1;var w=d&&(s<24||o<12);if(w&&this._isSmallScene){b=true;w=false}var D=1;if(b){D=-1}else if(this._isSmallScene||S){D=0}if(l==null){l=0}var M=w?k.buildEmptyMesh(c,l,s,o,this._temporaryGeometryBuffer):k.buildTemporaryMesh(c,l,s,o,I,S,D,this._temporaryGeometryBuffer);if(b||M.points.length>s*3||M.indices.length>o*3){var x=new e.BufferGeometry;var T=new e.BufferAttribute(M.indices.slice(),1);var C=new e.BufferAttribute(M.points.slice(),3);x.setIndex(T);x.setAttribute("position",C);if(M.normals){var A=new e.BufferAttribute(M.normals.slice(),3);x.setAttribute("normal",A)}x.boundingBox=e.Box3.newFromPackedArray(c);f=new e.Mesh(x,r)}else{p=this._addGeometryToCluster(c,M.points,M.normals,M.colors,M.uvs,M.indices,false,t.materialId,a,m,false);f=new e.Mesh(p.geometry,r)}}f.userData.geometryId=u;f.userData.lodInfo=n;if(t.transform){f.applyMatrix4(E(t.transform))}f.updateMatrixWorld(true);f.userData.submeshId=a;f.userData.initialMaterialId=t.materialId;f.userData.meshId=t.meshId;f.userData.materialId=t.materialId;f.userData.submeshInfo=t;i.pushElementIntoMapArray(this._materialMeshes,t.materialId,t.meshId);var N=i.pushElementIntoMapArray(this._meshSubmeshes,t.meshId,f)-1;if(p){i.pushElementIntoMapArray(this._geometries,n.id,p)}else{i.pushElementIntoMapArray(this._geometryProxies,n.id,{meshId:t.meshId,submeshId:a,submeshIndex:N,materialId:t.materialId})}if(h){var R=this._vkScene.getSceneRef().userData;h.forEach(function(t){var r=this._cloneSubmesh(f,t);if(r.material&&t.userData&&t.userData.geometryType&&(t.userData.geometryType==="PLANE"||t.userData.geometryType==="SURFACE")){r.material.side=e.DoubleSide;if(this._vkScene.getDoubleSided()){r.material.userData.originalMaterialSide=e.DoubleSide}}if(p){r.userData.renderGroup=q(p,R.currentInstanceIndex);R._instanceIndexToNodeMap??=new Map;R._instanceIndexToNodeMap.set(R.currentInstanceIndex,t);k.increaseCurrentInstance(R)}this._geometrySubmeshIndices.set(t.userData.nodeId+":"+u,t.children.length);t.add(r);r.updateMatrixWorld(true);W(r,this._materialClones)},this)}return true};function F(i,a,n,s,o,d){var u=s.geometry;var l=i[a];if(!l||l.userData.geometryId!==n){t.error("Invalid submesh index in replaceSubmeshGeometry");return}if(l.geometry!==u){var c=q(s,o.currentInstanceIndex);if(d){k.increaseCurrentInstance(o)}if(l.isMesh&&!u.userData.isPolyline){if(l.geometry){k.disposeGeometry(l)}l.geometry=u;l.userData.renderGroup=c;l.updateMatrixWorld(true);r.increaseGeometryUsed(u)}else{var h=new e.LineSegments(u,l.material);r.increaseGeometryUsed(u);h.position.copy(l.position);h.quaternion.copy(l.quaternion);h.scale.copy(l.scale);h.matrix.copy(l.matrix);h.updateMatrixWorld(true);h.userData=l.userData;h.userData.renderGroup=c;h.renderOrder=l.renderOrder;h.parent=l.parent;i[a]=h;l.parent=null}}}V.prototype._setSubmeshMaterial=function(e,t,a){r.increaseMaterialUsed(t);e.material=t;e.userData.materialId=a;delete e.userData.originalMaterial;if(e.material!==t){i.pushElementIntoMapArray(this._materialClones,a,e.material)}};V.prototype._updateMaterial=function(e,t,r){e.children.forEach(function(e){if(e.material&&e.userData.materialId===t){this._setSubmeshMaterial(e,r,t)}},this)};V.prototype._updateMeshSubmeshesMaterial=function(e,t,r){var i=this._meshSubmeshes.get(e);if(i){i.forEach(function(e){if(e.material&&e.material.userData.materialId===t){e.material=r}})}};function W(e,t){if(e.material){var r=e.material;if(e.material!==r){i.pushElementIntoMapArray(t,e.material.userData.materialId,e.material)}}}V.prototype.setGeometry=function(r){var a=r.id;var n=r.data;if(r.isPointCloud){const t=this._vkScene.getSceneRef().userData;const r=n.points;const i=(new e.Box3).setFromArray(r);t.pointCloudBoundingBox??=new e.Box3;t.pointCloudBoundingBox.union(i);t.totalPointCount??=0;t.totalPointCount+=r.length/3;const a=t.pointCloudBoundingBox.getSize(new e.Vector3);t.pointScale=Math.sqrt((a.x*a.z*2+a.x*a.y+a.y*a.z)/t.totalPointCount)*700}var s=this._geometries.get(a);if(s){s.forEach(e=>{if(!k.updateClusterGeometry(e,n.points,n.normals,n.colors,n.uvs,n.indices,this._pointCloudGroups)){t.error("Invalid geometry in setGeometry")}})}var o=true;var d=this._geometryProxies.get(a);if(d){o=false;var u=0;d.forEach(function(e){var t=this._meshNodes.get(e.meshId);if(t){u+=t.length}},this);if(u<1){u=1}var l=this._vkScene.getSceneRef().userData;d.forEach(function(e){var t=this._addGeometryToCluster(null,n.points,n.normals,n.colors,n.uvs,n.indices,r.isPolyline,e.materialId,e.submeshId,u,true);i.pushElementIntoMapArray(this._geometries,a,t);var s=e.meshId;var o=this._meshNodes.get(s);if(o){for(let e=0;e<o.length;++e){F(o[e].children,this._geometrySubmeshIndices.get(o[e].userData.nodeId+":"+a),a,t,l,true)}}var d=this._meshSubmeshes.get(s);if(d){F(d,e.submeshIndex,a,t,l,false)}},this);this._geometryProxies.delete(a)}this._vkScene.onGeometryUpdated(a);if(this._fireSceneUpdated){this._fireSceneUpdated(o)}return this};V.prototype.setMeshNode=function(e,t){var r=this._nodes.get(e);if(r){i.pushElementIntoMapArray(this._meshNodes,t,r);var a=this._meshSubmeshes.get(t);if(a){a.forEach(function(e){var t=this._cloneSubmesh(e,r);var i=this._geometries.get(e.userData.geometryId);if(i){t.userData.renderGroup=q(i[0],null)}this._geometrySubmeshIndices.set(r.userData.nodeId+":"+e.userData.geometryId,r.children.length);r.add(t);W(t,this._materialClones)},this)}}};V.prototype.setParametricNode=function(e,t,r){var i=this._nodes.get(e);if(i){i.userData.parametricVisible=r!==undefined?r:true}};V.prototype.progress=function(e){t.log("reading progress:",e)};V.prototype.getGeometry=function(e){var t=this._geometries.get(e);return t?t[0].geometry:null};var j={rect:p.RectangularShape,circle:p.CircularShape,none:p.None,textGlow:p.TextGlow};var z={none:f.None,solid:f.Solid,dash:f.Dash,dot:f.Dot,dashdot:f.DashDot,dashdotdot:f.DashDotDot};var H={left:m.Left,center:m.Center,right:m.Right};var Y={none:v.None,point:v.Point,arrow:v.Arrow};var K=new e.Color;function J(t){var r=new e.Matrix4;var i=new e.Matrix4;var a=t;while(a&&a.userData.originalTransform){N(a.userData.transformType==="ORTHO2D");var n=a.userData.originalTransform;r.compose(n.p,n.q,n.s);i.premultiply(r);a=a.parent}i.decompose(t.position,t.quaternion,t.scale)}V.prototype.createAnnotation=function(r,i){this._resetCurrentScene(i);var a=this._nodes.get(r.nodeId);if(!a){t.warning("Annotation node not found",r);return}if(a.userData.originalTransform){J(a)}var n=r.type;if(n===undefined){this.createLegacyAnnotation(r,a);return}a.userData.annotationType=n;if(n==="html"){r.id=r.id||A();var s=[];if(r.leaderLines){r.leaderLines.forEach(function(e){if(e.start&&e.start.sid){s.push(this._nodes.get(e.start.sid))}},this)}this._vkScene._addAnnotation(r.id,{annotation:r,node:a,attachment:r.attachment&&r.attachment.sid?this._nodes.get(r.attachment.sid):null,targetNodes:s});return}var o=r.label||{};var d=r.text||{};var c=o.colour||[1,1,1,1];var m=o.borderColour||[0,0,0,1];var v={node:a,renderOrder:a.renderOrder||0,style:j[o.shape]||p.RectangularShape,width:o.width||64,height:o.height||64,backgroundColor:K.fromArray(c).getStyle(),backgroundOpacity:c[3],borderColor:K.fromArray(m).getStyle(),borderOpacity:m[3],borderWidth:o.borderColour?o.borderWidth||0:0,borderLineStyle:z[o.borderLineStyle]||f.Solid,horizontalAlignment:H[d.align]};if(d.html){v.encoding=h.HtmlText;v.text=d.html}else{v.encoding=h.PlainText;v.text=d.text;v.font=d.fontFace||"Arial";v.fontSize=Math.abs(d.fontSize)||16;v.fontWeight=Math.min(d.fontWeight,900);v.fontItalic=d.fontItalic;v.textColor=K.fromArray(d.colour||[0,0,0]).getStyle()}if(n==="text"){var g=a.position;v.position=new e.Vector3(g.x*2,g.y*2,g.z);var y=new u(v);y.setText(v.text);this._addDynamicObject(a,y._update.bind(y),true)}else if(n==="note"){var _=r.attachment||{};v.position=(new e.Vector3).fromArray(_.position||[0,0,0]);v.anchorNode=this._nodes.get(_.sid)||this._rootNode;v.depthTest=false;var I=new l(v);I.setText(v.text);this._callouts.set(r.id,I);this._addDynamicObject(a,I._update.bind(I),false)}else{t.warning("Unsupported annotation type",r)}};var X=[p.RectangularShape,p.CircularShape,p.None,p.TextGlow];var Z=[c.Viewport,c.Screen,c.World];var Q=[f.None,f.Solid,f.Dash,f.Dot,f.DashDot,f.DashDotDot];var $=[v.None,v.Point,v.Arrow];var ee=[m.Left,m.Center,m.Right];function te(e){var t=e.toString(16);if(e.length>=3){t=(e[0]*255<<16|e[1]*255<<8|e[2]*255).toString(16)}return"#"+"000000".substring(t.length)+t}function re(e){if(!e){return false}for(var t=0,r=e.length;t<r;t++){if(!isFinite(e[t])){return false}}return true}V.prototype.createLegacyAnnotation=function(r,i){var a=r.position;if(!re(a)){t.warning("Incorrect annotation position",r);return}r.coordinateSpace|=0;var n=r.backgroundOpacity;if(!n){n=r.backgroundColour?r.backgroundColour[3]:0}var s=r.borderOpacity;if(!s){s=r.borderColour?r.borderColour[3]:0}var o={node:i,coordinateSpace:Z[r.coordinateSpace],style:X[r.shape||0],width:r.width,height:r.height,backgroundColor:r.backgroundColour?te(r.backgroundColour):"#fff",backgroundOpacity:n,borderColor:r.borderColour?te(r.borderColour):"#000",borderOpacity:s,borderWidth:r.borderWidth,borderLineStyle:Q[r.borderLineStyle]};if(r.encoding!==undefined){o.encoding=r.encoding?h.HtmlText:h.PlainText;o.font=r.font;o.fontSize=r.fontSize;o.fontWeight=Math.min(r.fontWeight,900);o.fontItalic=r.fontItalic;o.textColor=te(r.textColour);o.link=r.link;o.horizontalAlignment=ee[r.textHorizontalAlignment];o.position=(new e.Vector3).fromArray(a)}else if(r.fontFace){o.encoding=h.PlainText;o.font=r.fontFace;o.fontSize=Math.abs(r.fontSize);o.fontWeight=Math.min(r.fontWeight,900);o.textColor=te(r.textColour)}else{o.encoding=h.HtmlText}if(r.coordinateSpace<2){if(!o.positions){o.position=new e.Vector3(a[0]*2-1,a[1]*-2+1,a[2])}o.renderOrder=(r.order|0)+1e3;var d=new u(o);d.setText(r.text);this._addDynamicObject(i,d._update.bind(d),true)}else{o.anchorNode=this._nodes.get(r.sid)||this._rootNode;if(!o.position){o.position=(new e.Vector3).fromArray(a)}o.depthTest=false;o.renderOrder=r.order|0;if(r.alwaysOnTop){o.renderOrder=1}var c=new l(o);c.setText(r.text);this._callouts.set(r.id,c);this._addDynamicObject(i,c._update.bind(c),false)}};function ie(e){while(e){if(e.userData.transformType){return e.userData.transformType}e=e.parent}return undefined}V.prototype.createImageNote=function(r,i){this._resetCurrentScene(i);var a=this._nodes.get(r.nodeId);if(!a){t.warning("Image annotation node not found",r);return}if(a.userData.originalTransform){J(a)}if(r.type==="image"){var n=r.label||{};var s=n.materialId;var o=this._getMaterialRef(s);if(!o){t.warning("Image annotation material not found",r);return}if(n.projection==="spherical"){a.position.setScalar(0);a.scale.setScalar(1);n.width=-1;n.height=-1;a.userData.transformType="LOCK_TOVIEWPORT";a.userData.renderStage=-1;var d=o;o=new D({upAxis:this._upAxis,map:d.map,color:d.color});o.userData=d.userData;this._vkScene.getMaterial(s)._nativeMaterial=o}o.depthTest=false;o.depthWrite=false;o.blending=e.CustomBlending;o.side=e.DoubleSide;if(a.userData.renderStage===undefined){if(r.order){a.userData.renderStage=Math.sign(r.order)}else if(r.order===undefined&&ie(a)!==undefined){a.userData.renderStage=1}}switch(a.userData.transformType){case"ORTHO2D":case"LOCK_TOVIEWPORT":var l=new u({node:a,renderOrder:a.renderOrder||0,coordinateSpace:c.Screen,position:new e.Vector3(a.position.x,a.position.y,0),width:(n.width||200)*a.scale.x*.5,height:(n.height||200)*a.scale.y*.5});l.setMaterial(o);a.position.setScalar(0);a.scale.setScalar(1);this._addDynamicObject(a,l._update.bind(l),true);break;case"BILLBOARD_VIEW":default:var h=new e.Mesh(u.prototype._planeGeometry,o);h.scale.set(n.width,n.height,1);h.updateMatrix();a.add(h);break}}else{this.createLegacyImageNote(r,a)}};V.prototype.createLegacyImageNote=function(t,r){var i=(new e.Vector3).fromArray(t.position);var a=t.width;var n=t.height;if(!t.properlyAligned){i.x+=t.width*.5;i.y+=t.height*.5;i.applyMatrix4(r.matrix);a=t.width*.5*r.matrix.elements[0];n=t.height*.5*r.matrix.elements[5]}var s=this._getMaterialRef(t.labelMaterialId);s.depthTest=false;s.depthWrite=false;s.blending=e.CustomBlending;if(ie(r)==="LOCK_TOVIEWPORT"){var o=new u({node:r,coordinateSpace:c.Screen,renderOrder:(t.order|0)+1e3,position:i,width:a,height:n});o.setMaterial(s);this._addDynamicObject(r,o._update.bind(o),true)}else{var d=new e.Mesh(u.prototype._planeGeometry,s);d.renderOrder=(t.order|0)+1e3;d.position.copy(i);d.scale.set(a*2,n*2,1);d.updateMatrix();r.add(d);r.scale.setScalar(1);r.updateMatrix()}};V.prototype.insertLeaderLine=function(r,i){this._resetCurrentScene(i);var a=this._callouts.get(r.annotationId);if(a){var n=this._getMaterialRef(r.materialId);if(!n){t.warning("Leader line material not found",r);return}var s=[];var o=r.points;for(var d=0,u=o.length;d<u;d++){s.push((new e.Vector3).fromArray(o[d]))}var l;if(r.start){var c=r.start||{};var h=r.end||{};var p=r.extension||{};l=this._nodes.get(r.start.sid)||this._rootNode;a.addLeaderLine(s,l,n,Y[c.style]||v.None,Y[h.style]||v.None,c.size,p.length||0)}else{l=this._nodes.get(r.startPointSid)||this._rootNode;a.addLeaderLine(s,l,n,$[r.startPointHeadStyle],$[r.endPointHeadStyle],r.pointHeadConstant,r.extensionLength)}}};V.prototype._findDetailViewNodes=function(e){var r=[];if(e){e.forEach(function(e){var i=this._nodes.get(e);if(i){r.push(i)}else{t.warning("Unknown detailView node reference",e)}},this)}return r};V.prototype.createDetailView=function(r,i){this._resetCurrentScene(i);var a=this._nodes.get(r.nodeId);if(!a){t.warning("Detail view node not found",r);return}var n=r.label;if(!n){this.createLegacyDetailView(r,a);return}var o=r.attachment;var d={name:r.name,camera:n.camera?this.createCamera(n.camera):null,type:r.cutaway?g.Cutaway:g.DetailView,borderWidth:n.borderWidth||0,backgroundColor:K.fromArray(n.colour||[1,1,1]).getStyle(),borderColor:K.fromArray(n.borderColour||[1,1,1]).getStyle(),origin:new e.Vector2(a.position.x*2-1+a.scale.x,a.position.y*-2+1-a.scale.x),size:new e.Vector2(a.scale.x,a.scale.y),attachmentPoint:(new e.Vector3).fromArray(o.position||[0,0,0]),veId:r.veid,visibleNodes:this._findDetailViewNodes(r.visibleNodes),targetNodes:this._findDetailViewNodes(r.targetNodes)};if(n.shape==="rect"){d.shape=!n.leaderStyle||n.leaderStyle==="none"?y.Box:y.BoxLine}else{d.shape={none:y.Circle,line:y.CircleLine,pointer:y.CirclePointer,arrow:y.CircleArrow,bubbles:y.CircleBubbles}[n.leaderStyle]||y.Circle}var u=new s(d);if(!this._rootNode.userData._vkDetailViews){this._rootNode.userData._vkDetailViews=[]}this._rootNode.userData._vkDetailViews.push({detailView:u,node:a,renderOrder:r.renderOrder||a.renderOrder||0})};V.prototype.createLegacyDetailView=function(t,r){if(!t.properlyAligned){if(!t.shape){t.shape=t.leaderStyle?y.BoxLine:y.Box}else{t.shape=[y.Circle,y.CircleLine,y.CirclePointer,y.CircleArrow,y.CircleBubbles][t.leaderStyle||0]}t.type=t.cutaway?g.Cutaway:g.DetailView;t.camera=t.camera?this.createCamera(t.camera):null;t.origin=new e.Vector2(r.position.x*2-1+r.scale.x,r.position.y*-2+1-r.scale.x);t.size=new e.Vector2(r.scale.x,r.scale.y);t.renderOrder=r.renderOrder}else{t.type=[g.DetailView,g.Cutaway][t.type];t.shape=[y.Box,y.Circle,y.CircleLine,y.CirclePointer,y.CircleArrow,y.CircleBubbles,y.BoxLine,y.BoxNoOutline,y.SolidPointer,y.SolidArrow][t.shape];t.camera=this._cameras.get(t.cameraId);t.origin=(new e.Vector2).fromArray(t.origin);t.size=(new e.Vector2).fromArray(t.size)}var i=new s({name:t.name,camera:t.camera,type:t.type,shape:t.shape,borderWidth:t.borderWidth||0,backgroundColor:t.backgroundColour?te(t.backgroundColour):"#fff",borderColor:t.borderColour?te(t.borderColour):"#000",origin:t.origin,size:t.size,attachmentPoint:(new e.Vector3).fromArray(t.attachment),metadata:t.metadata,veId:t.veid,visibleNodes:this._findDetailViewNodes(t.visibleNodes),targetNodes:this._findDetailViewNodes(t.targetNodes)});if(!this._rootNode.userData._vkDetailViews){this._rootNode.userData._vkDetailViews=[]}this._rootNode.userData._vkDetailViews.push({detailView:i,node:r,renderOrder:t.renderOrder||0})};V.prototype.insertThrustline=function(t){var r=this._nodes.get(t.thrustlineId);if(r&&!this._thrustlines.get(t.thrustlineId)){var i=new d({node:r,principleAxis:(new e.Vector3).fromArray(t.principleAxis),material:this._getMaterialRef(t.materialId)});var a=[];var n=0;var s=0;var o=0;for(var u=0;u<t.itemCount;u++){var l={};l.target=this._nodes.get(t.targets[u]);l.majorAxisIndex=t.itemMajorAxisesIndices[u];var c;l.basisAxises=[];o=n+t.itemBasisAxisesCounts[u];for(c=n;c<o;c++){var h={};h.x=t.itemBasisAxisesCoordinates[c*3];h.y=t.itemBasisAxisesCoordinates[c*3+1];h.z=t.itemBasisAxisesCoordinates[c*3+2];l.basisAxises.push(h)}n=o;l.dimension={};l.dimension.x=t.itemDimensionsCoordinates[u*3];l.dimension.y=t.itemDimensionsCoordinates[u*3+1];l.dimension.z=t.itemDimensionsCoordinates[u*3+2];l.center={};l.center.x=t.itemCentersCoordinates[u*3];l.center.y=t.itemCentersCoordinates[u*3+1];l.center.z=t.itemCentersCoordinates[u*3+2];l.boundPoints=[];o=s+t.itemBoundPointsCounts[u];for(c=s;c<o;c++){var p={};p.x=t.itemBoundPointsCoordinates[c*3];p.y=t.itemBoundPointsCoordinates[c*3+1];p.z=t.itemBoundPointsCoordinates[c*3+2];l.boundPoints.push(p)}s=o;a.push(l)}i.setItems(a);var f=0;var m=[];for(var v=0;v<t.segmentCount;v++){var g={};g.startItemIndex=t.segmentsStartItemIndices[v];g.endItemIndex=t.segmentsEndItemIndices[v];g.startBoundIndex=t.segmentsStartBoundIndices[v];g.endBoundIndex=t.segmentsEndBoundIndices[v];g.ratios=[];o=f+t.segmentRatioCounts[v];for(var y=0;y<o;y++){var _={};_.x=t.segmentRatiosCoordinates[y*2];_.y=t.segmentRatiosCoordinates[y*2+1];g.ratios.push(_)}f=o;m.push(g)}i.setSegments(m);this._thrustlines.set(t.thrustlineId,i);this._addDynamicObject(r,i._update.bind(i),false)}};V.prototype.updateViewsForReplacedNodes=function(e){var t=new Map;e.forEach(function(e){var r=this._nodes.get(e.sid);if(r){t.set(e.sid,r)}},this);function r(e,t){var r=e.getNodeInfos();r.forEach(function(e){var r=e.target;if(r&&r.userData&&r.userData.treeNode&&r.userData.treeNode.sid){var i=t.get(r.userData.treeNode.sid);if(i){e.target=i;i.updateMatrixWorld()}}})}function i(t,r){var i;var a=t.getPlaybacks();for(var n=0;n<a.length;n++){var s=a[n];var o=s.getSequence();if(o){var d=false;var u=o.getNodeAnimation();for(var l=0;l<u.length;l++){var c=u[l];var h=c.nodeRef;if(h&&h.userData&&h.userData.treeNode&&h.userData.treeNode.sid){i=r.get(h.userData.treeNode.sid);if(i){o.removeNodeAnimation(h,null,true);for(var p in c){if(p==="nodeRef"){continue}o.setNodeAnimation(i,p,c[p],true)}d=true}}}var f=o.getJoint();for(var m=0;f&&m<f.length;m++){var v=f[m];if(v.parentSid){i=r.get(v.parentSid);if(i){v.parent=i;d=true}}if(v.nodeSid){i=r.get(v.nodeSid);if(i){v.node=i;d=true}}}if(d){o._fireSequenceChanged()}}}e.forEach(function(e){var t=e.target;if(t&&t.userData&&t.userData.treeNode&&t.userData.treeNode.sid){var i=r.get(t.userData.treeNode.sid);if(i){e.target=i;i.updateMatrixWorld()}}})}this._views.forEach(function(e,a){r(e,t);i(e,t)})};V.prototype._decrementResourceCounters=function(e){e.traverse(function(e){if(e.isMesh){r.decreaseMaterialUsed(e.material);r.decreaseGeometryUsed(e.geometry)}})};V.prototype.decrementResourceCountersForDeletedTreeNode=function(e,t){this._resetCurrentScene(t);var r=this;e=[].concat(e);e.forEach(function(e){var t=r._nodes.get(e);if(t){r._decrementResourceCounters(t);r._nodes.delete(e)}});return this};V.prototype.remove=function(e,t){this._resetCurrentScene(t);var r=this;e=[].concat(e);e.forEach(function(e){var i=r._nodes.get(e);if(i){r._decrementResourceCounters(i);if(i.parent){i.parent.remove(i)}r._nodes.delete(e);var a=false;if(!r._forbiddenTextureUpdate){r._forbiddenTextureUpdate=true;a=true;var n=r._vkScene.getSceneRef().userData;if(n.instanceDataTexture){var s=n.geometryClusters;var o=k.prepareTextureUpdateResults(s?s.length:0,n.textureUpdateResults);k.removeNodeFromClusterRenderingRecursive(i,n.instanceDataTexture.image.data,o);n.textureUpdateResults=o}}for(var d=0;d<i.children.length;d++){var u=i.children[d];if(u.userData&&u.userData.treeNode&&u.userData.treeNode.sid){r.remove(u.userData.treeNode.sid,t)}}if(a){delete r._forbiddenTextureUpdate}}});return this};V.prototype.resourcesCleanUp=function(){var e=this._geometries;e.forEach(function(e){e.forEach(function(e){var t=e.geometry.userData.geometryUsed;if(t<=0){e.dispose()}})});return this};V.prototype.createCamera=function(t,r){this._resetCurrentScene(r);var i=t.near||1;var s=t.far||2e5;if(t.origin.length===3&&t.origin[0]===0&&t.origin[1]===0&&t.origin[2]===0){t.ortho=false;t.rotate=true}var o;if(t.ortho){o=new e.OrthographicCamera(-1,1,1,-1,i,s);o.zoom=t.zoom||-1}else{o=new e.PerspectiveCamera(e.MathUtils.radToDeg(t.fov),1,i,s)}if(t.origin){o.position.fromArray(t.origin)}if(t.up){o.up.fromArray(t.up);if(t.notUseDirectionVector){o.up.sub(o.position)}o.up.normalize()}if(t.rotate){o.userData.rotate=t.rotate;o.up.set(0,1,0)}if(t.target){var d=(new e.Vector3).fromArray(t.target);if(!t.notUseDirectionVector){d.add(o.position)}o.lookAt(d)}this._rootNode.userData.camera=o;var u=null;if(o.isOrthographicCamera){u=new a}else if(o.isPerspectiveCamera){u=new n}u.setCameraRef(o);u.setUsingDefaultClipPlanes(true);var l=t.id;if(l){this._cameras.set(l,u)}this._rootNode.userData.camera=u;return u};V.prototype.insertCamera=function(e,t,r){this._resetCurrentScene(r);var i=this._nodes.get(e);var a=this._cameras.get(t);var n=a&&a.getCameraRef();if(i&&n){(i||this._rootNode).add(n.parent?n.clone():n)}return this};V.prototype.getCamera=function(e){return this._cameras.get(e)};V.prototype.createMaterial=function(t){var r=[];var a=t.id;var n=this._getMaterialRef(a);var s=null;if(t.textureEmissive){if(!n||!n.isMeshBasicMaterial){s=n;n=this._createTemporaryMaterial(a,w.MeshBasicMaterial)}}if(!n){n=this._createTemporaryMaterial(a)}if(t.lineWidth>0){if(t.lineColour){n.color.fromArray(t.lineColour)}n.linewidth=t.lineWidth;n.userData.lineStyle={width:t.lineWidth,haloWidth:t.lineHaloWidth||0,endCapStyle:t.lineEndRound?1:0,dashPattern:t.lineDashPattern||[],dashPatternScale:t.lineDashPatternScale,widthCoordinateSpace:t.lineWidthCoordinateSpace}}delete n.userData.toBeUpdated;n.userData.materialInfo=t;if(t.diffuseColour){n.color.fromArray(t.diffuseColour)}if(t.specularColour&&n.specular){n.specular.fromArray(t.specularColour);if(t.specularLevel){n.specular.multiplyScalar(t.specularLevel)}}var o=true;if(t.emissiveColour){if(n.emissive){n.emissive.fromArray(t.emissiveColour);if(n.emissive.r!==0||n.emissive.g!==0||n.emissive.b!==0){o=false;n.depthFunc=e.LessDepth}}else{n.color.fromArray(t.emissiveColour)}}if(o&&t.ambientColour&&n.emissive){n.emissive.fromArray(t.ambientColour);n.emissive.multiplyScalar(.2)}if(t.opacity!==undefined){n.opacity=t.opacity;n.transparent=t.opacity<.99}var d=t.glossiness?t.glossiness:0;var u=Math.pow(2,d*10)*2;if(u<0){u=0}if(u>128){u=128}n.shininess=u;n.userData.imageIdsToAddAsTexture=new Set;var l,c;if(t.textureDiffuse){c=t.textureDiffuse;l=c[0]||c;n.userData.imageIdsToAddAsTexture.add(l.imageId)}else if(t.textureDecal){c=t.textureDecal;l=c[0]||c;n.userData.imageIdsToAddAsTexture.add(l.imageId)}if(t.textureBump){c=t.textureBump;l=c[0]||c;n.userData.imageIdsToAddAsTexture.add(l.imageId)}if(t.textureEmissive){c=t.textureEmissive;l=c[0]||c;n.userData.imageIdsToAddAsTexture.add(l.imageId)}if(t.textureAmbientOcclusion){c=t.textureAmbientOcclusion;l=c[0]||c;n.userData.imageIdsToAddAsTexture.add(l.imageId)}if(t.textureReflection){c=t.textureReflection;l=c[0]||c;n.userData.imageIdsToAddAsTexture.add(l.imageId)}if(n.userData.imageIdsToAddAsTexture.size===0){delete n.userData.imageIdsToAddAsTexture}r=this.updateTextureMaps(a);if(r.length>0){n.userData.imageIdsToLoad=new Set;for(var h=0;h<r.length;h++){var p=r[h];i.pushElementIntoMapArray(this._imageTextures,p.imageId,{textureType:p.textureType,materialId:a});n.userData.imageIdsToLoad.add(p.imageId)}}var f=this._materialMeshes.get(a);if(f){for(var m=0;m<f.length;m++){var v=f[m];var g=this._meshNodes.get(v);if(g){for(var y=0;y<g.length;y++){this._updateMaterial(g[y],a,n)}}if(s){this._updateMeshSubmeshesMaterial(v,a,n)}}}if(s){k.disposeMaterial(s)}return r};V.prototype.getMaterial=function(e){return this._getMaterialRef(e)};var ae=function(e){var t="";try{var r=32768;var i=0;var a=e.length;var n;while(i<a){n=e.slice(i,Math.min(i+r,a));t+=String.fromCharCode.apply(null,n);i+=r}}catch(e){t=""}return t};V.prototype.createImage=function(e){if(e.binaryData.length<32){t.warning("SceneBuilder.createImage()","Can't create image from empty data");return this}var r=new DataView(e.binaryData.buffer);var i=true;if(r.getUint8(0,true)===parseInt("0xFF",16)&&r.getUint8(1,true)===parseInt("0xD8",16)){i=false}var a=ae(e.binaryData);var n="data:image/"+(i?"png":"jpeg")+";base64,"+btoa(a);this._images.set(e.id,n);var s=this._imageTextures.get(e.id);if(s){this._imageTextures.delete(e.id);for(var o=0;o<s.length;o++){var d=s[o];this.updateTextureMap(d.materialId,d.textureType)}}return this};var ne=new e.TextureLoader;var se={Diffuse:0,Bump:1,Opacity:2,Reflection:3,Refraction:4,Specular:5,Ambient:6,Emissive:7,SpecularLevel:8,Glossiness:9,AmbientOcclusion:10,Decal:11};V.prototype.updateTextureMaps=function(e){var t=[];var r=this._getMaterialRef(e);if(!r){return t}var i=r.userData.materialInfo;if(!i){return t}if(i.textureDiffuse){var a=this.updateTextureMap(e,se.Diffuse);if(a.imageId){t.push(a)}}else if(i.textureDecal){var n=this.updateTextureMap(e,se.Decal);if(n.imageId){t.push(n)}}if(i.textureBump){var s=this.updateTextureMap(e,se.Bump);if(s.imageId){t.push(s)}}if(i.textureEmissive){var o=this.updateTextureMap(e,se.Emissive);if(o.imageId){r[r.emissive?"emissive":"color"].setRGB(1,1,1);t.push(o)}}if(i.textureAmbientOcclusion){var d=this.updateTextureMap(e,se.AmbientOcclusion);if(d.imageId){t.push(d)}}if(i.textureReflection){var u=this.updateTextureMap(e,se.Reflection);if(u.imageId){t.push(u)}}return t};V.prototype.updateTextureMap=function(t,r){var i={textureType:r,imageId:null};var a=this._getMaterialRef(t);if(!a){return i}var n=a.userData.materialInfo;if(!n){return i}var s=null;switch(r){case se.Diffuse:s=n.textureDiffuse;break;case se.Decal:s=n.textureDecal;break;case se.Bump:s=n.textureBump;break;case se.Reflection:s=n.textureReflection;break;case se.Emissive:s=n.textureEmissive;break;case se.AmbientOcclusion:s=n.textureAmbientOcclusion;break;default:break}if(!s){return i}var o=s[0]||s;var d=this._images.get(o.imageId);if(!d){i.imageId=o.imageId;return i}if(a.userData.imageIdsToLoad){a.userData.imageIdsToLoad.delete(o.imageId);if(a.userData.imageIdsToLoad.size===0){delete a.userData.imageIdsToLoad}}if(a.userData.parametricType==="sphere"){o.uvHorizontalScale=-1}var u=o.influence!==undefined?o.influence:0;function l(t,i){switch(r){case se.Diffuse:case se.Decal:t.map=i;if(d.startsWith("data:image/png")){t.transparent=true}break;case se.Bump:t.bumpMap=i;t.bumpScale=u;break;case se.Opacity:t.alphaMap=i;break;case se.Reflection:i.mapping=e.EquirectangularReflectionMapping;t.envMap=i;t.combine=e.AddOperation;t.reflectivity=u;break;case se.Emissive:t[t.emissiveMap!==undefined?"emissiveMap":"map"]=i;if(t.isSphericalMapMaterial){i.minFilter=e.LinearFilter}break;case se.AmbientOcclusion:t.aoMap=i;break;default:}t.needsUpdate=true}ne.load(d,function(r){r.wrapS=o.uvHorizontalTilingEnabled?e.RepeatWrapping:e.ClampToEdgeWrapping;r.wrapT=o.uvVerticalTilingEnabled?e.RepeatWrapping:e.ClampToEdgeWrapping;r.magFilter=o.filterMode===1?e.NearestFilter:e.LinearFilter;r.minFilter=o.filterMode===1?e.NearestFilter:e.LinearMipMapLinearFilter;r.anisotropy=4;var i=o.uvHorizontalOffset||0;var n=o.uvVerticalOffset||0;r.repeat.set(o.uvHorizontalScale||1,o.uvVerticalScale||1);r.center.set(-i,-n);r.offset.set(i,n);r.rotation=-o.uvRotationAngle;if(a.isMeshBasicMaterial){r.generateMipmaps=false;r.minFilter=o.filterMode===1?e.NearestFilter:e.LinearFilter}l(a,r);if(a.userData.imageIdsToAddAsTexture&&o.imageId){a.userData.imageIdsToAddAsTexture.delete(o.imageId);if(a.userData.imageIdsToAddAsTexture.size===0){delete a.userData.imageIdsToAddAsTexture}}var s=this._materialClones.get(t);if(s){s.forEach(function(e){l(e,r)})}this.fireImageAddedToMaterial({materialId:t});if(this._fireSceneUpdated){this._fireSceneUpdated()}}.bind(this));return i};V.prototype.insertPlayback=function(e,t,r){this._resetCurrentScene(r);var a=this._vkScene.findSequence(e.sequenceId);var n=new _(e.id,{sequence:a,timeScale:e.speed?1/e.speed:1,preDelay:e.preDelay?e.preDelay:0,postDelay:e.postDelay?e.postDelay:0,repeats:e.repeat?Math.abs(e.repeat):0,reversed:e.reversed?true:false,startTime:e.start?e.start:0});var s=this._views.get(t);if(s){s.addPlayback(n)}if(!a){i.pushElementIntoMapArray(this._sequenceIdToPlaybacks,e.sequenceId,n)}return this};V.prototype.insertSequence=function(e,t){var r=this._vkScene.findSequence(e.id);if(r){this._vkScene.removeSequence(r)}var a;if(e.endTime){if(e.startTime){a=e.endTime-e.startTime}else{a=e.endTime}}else{a=1}r=this._vkScene.createSequence(e.id,{name:e.name,duration:a});if(Array.isArray(e.joints)){e.joints.forEach(function(e){var t=this._joints[e];if(t){r.setJoint(t,true)}},this)}if(e.nodes&&e.nodes.length>0){for(var n=0;n<e.nodes.length;n++){var s=e.nodes[n];if(s.empty){s.type=s.binding;var o=this._nodes.get(s.sid);this._animationHelper.insertEmptyTrack(s,r,o,this._vkScene);continue}i.pushElementIntoMapArray(this._trackIdSequenceNodeMap,s.trackId,{sequenceId:e.id,targetId:s.sid,type:s.binding,pivot:s.pivot,isAbsoluteValue:s.isAbsoluteValue})}}var d=this._sequenceIdToPlaybacks.get(e.id);if(d){d.forEach(function(e){e.setSequence(r)})}return this};V.prototype.insertTracks=function(e){this._animationHelper.insertTracks(e,this._trackIdSequenceNodeMap,this._nodes,this._vkScene);return this};V.prototype.insertJoints=function(e,t){this._resetCurrentScene(t);this._joints=[];e.forEach(function(e){var t=this._nodes.get(e.childSid);var r=this._nodes.get(e.parentSid);var i={id:e.id,node:t,parent:r,translation:new Float32Array(e.t?e.t:[0,0,0]),quaternion:new Float32Array(e.q?e.q:[0,0,0,1]),scale:new Float32Array(e.s?e.s:[1,1,1])};if(!t){var a=this._jointNodesMap.get(e.childSid);if(!a){a=[]}a.push(i);this._jointNodesMap.set(e.childSid,a)}if(!r){var n=this._jointParentsMap.get(e.parentSid);if(!n){n=[]}n.push(i);this._jointParentsMap.set(e.parentSid,n)}this._joints.push(i)},this);return this};V.prototype.finalizeAnimation=function(){var e=this._rootNode;if(e){while(e.parent){e=e.parent}e.userData.tracks=this._tracks}return this};V.prototype.finalizePlaybacks=function(){var e=this._rootNode;if(e){while(e.parent){e=e.parent}}else{return this}if(!e.userData.animationNodeOriginalData){e.userData.animationNodeOriginalData=new Map}var t;var r=this._viewGroups.entries();var i=r.next();while(!i.done){t=i.value[1];i=r.next();var a=[];for(var n=0;n<t.getViews().length;n++){if(t.getViews()[n].id){var s=this._views.get(t.getViews()[n].id);if(s){a.push(s)}}}}return this};V.prototype.finalizeViewGroups=function(e){this._resetCurrentScene(e);var t=this._viewGroups.entries();var r=t.next();while(!r.done){var i=r.value[1];var a=r.value[0];if(!i||!i.views||!i.views.length){r=t.next();continue}i.removeViews();for(var n=0;n<i.views.length;n++){var s=i.views[n].id;var o=this._views.get(s);if(o&&o.userData.viewInfo.thumbnailId&&!o.thumbnailData){var d=this._images.get(o.userData.viewInfo.thumbnailId);if(d){o.thumbnailData=d}}if(o){o.viewGroupId=a;i.addView(o)}}r=t.next()}return this};V.prototype.insertViewGroup=function(e,t){this._resetCurrentScene(t);var r=this._viewGroups.get(e.id);if(!r){r=this._vkScene.createViewGroup({viewGroupId:e.id,name:e.name,description:e.description});this._viewGroups.set(e.id,r)}else{r.setViewGroupId(e.id);r.setName(e.name);r.setDescription(e.description)}r.type=e.type;r.metadata=e.metadata;r.veids=e.veids;r.views=e.views;r.sceneId=e.sceneId;return this};V.prototype.getViewGroup=function(e,t){this._resetCurrentScene(t);var r=this._viewGroups.get(e);var i=[];if(r&&r.views){for(var a=0;a<r.views.length;a++){var n=r.views[a].id;var s=this._views.get(n);if(s){i.push(s)}}}return i};var oe={turntable:C.Turntable,orbit:C.Orbit,pan:C.Pan,zoom:C.Zoom};V.prototype.insertView=function(e,t){this._resetCurrentScene(t);var r=e.description;if(r){var i=new RegExp("^<[^>]*?>");if(i.test(r)){var a=new RegExp("(^(<[^>]*?>s*)+)|((<[^>]*?>s*)+$)","g");var n=r.replace(a,"");if(!n){r=n}}r='<pre class="sapThemeVizKitViewGalleryStepDescriptionPre">'+r+"</pre>"}var s=this._views.get(e.viewId);if(s==null){s=this._vkScene.createView({viewId:e.viewId,name:e.name,description:r,aspectRatio:e.safeAreaAspectRatio,autoPlayAnimation:e.autoPlayAnimation,navigationMode:oe[e.navigationMode]||C.NoChange,dimension:e.dimension||3});this._views.set(e.viewId,s)}else{s.removePlaybacks(true);s.setName(e.name);s.setDescription(r);s.setAspectRatio(e.safeAreaAspectRatio);s.setAutoPlayAnimation(e.autoPlayAnimation);s.setNavigationMode(oe[e.navigationMode]||C.NoChange);s.setDimension(e.dimension||3)}s.userData={viewInfo:e};if(e.thumbnailId){var o=this._images.get(e.thumbnailId);if(o){s.thumbnailData=o}else{this._viewThumbnails.set(e.thumbnailId,s)}}if(e.animatedThumbnailId){var d=this._images.get(e.animatedThumbnailId);if(d){s.animatedThumbnailData=d;s.tileWidth=this._imageIdsAndTileWidths.get(e.animatedThumbnailId)}}if(e.cameraId){s.setCamera(this._cameras.get(e.cameraId))}s.type=e.type;s.flyToTime=e.flyToTime;s.preDelay=e.preDelay;s.postDelay=e.postDelay;s.navigationMode=e.navigationMode;var u=this._getSavedColor(e.topColour,localStorage.getItem("color.backgroundTop"));if(u!=null){s.setTopColor(u)}var l=this._getSavedColor(e.bottomColour,localStorage.getItem("color.backgroundBottom"));if(l!=null){s.setBottomColor(l)}s.renderMode=O[e.renderMethod]??S.Default;s.dimension=e.dimension;if(e.showPaperFrame){s.outputSettings=e.outputSettings}s.query=e.query;s.metadata=e.metadata;s.veids=e.veids;s.viewGroupId=e.viewGroupId;s.id=e.viewId;if(s.viewGroupId){var c=this._viewGroups.get(s.viewGroupId);if(c){var h=c.indexOfView(s);if(h<0){c.addView(s)}}}return this};V.prototype.setModelViewVisibilitySet=function(e){var r=this._views.get(e.viewId);var i=new Set;var a=[];e.visibleNodes.forEach(function(e){var r=this._nodes.get(e);if(r){i.add(r);a.push({target:r,visible:true})}else{t.warning("Unknown modelView visible node reference",e)}},this);Array.from(i).forEach(function(e){e=e.parent;while(e&&!i.has(e)){i.add(e);a.push({target:e,visible:true});e=e.parent}});if(r){r.updateNodeInfos(a)}};V.prototype.recordHighlightedNodeInView=function(e,t,r,i){this._resetCurrentScene(i);var a=this._views.get(r);if(!a){return this}var n=this._nodes.get(t);if(!n){return this}a.addHighlightedNodes(e,n);return this};V.prototype.insertHighlightStyle=function(e){var t=this._vkScene.getHighlight(e.id);if(t){return this}if(e.duration>0){if(e.colours&&e.colours.length===1&&(!e.opacities||e.opacities.length===1)){var r=e.colours[0];e.colours.push([r[0],r[1],r[2],0])}else if(!e.colours&&e.opacities&&e.opacities.length===1){e.opacities.push(0)}}this._vkScene.createHighlight(e.id,e);return this};V.prototype.insertModelViewHighlight=function(t){var r=this._views.get(t.viewId);if(r){var i=[];t.highlightNodes.forEach(function(e){var t=this._nodes.get(e);if(t){i.push(t)}else{}},this);var a={duration:t.duration,cycles:t.cycles};if(!t.id){t.id=e.MathUtils.generateUUID().toLowerCase()}var n=new e.Color(t.color1).toArray();var s=new e.Color(t.color2).toArray();n[3]=(t.color1>>>24&255)/255;s[3]=(t.color2>>>24&255)/255;a.colours=[n,s];a.opacities=[e.MathUtils.clamp(t.opacity1,0,1),e.MathUtils.clamp(t.opacity2,0,1)];this._vkScene.createHighlight(t.id,a);r.addHighlightedNodes(t.id,i)}};V.prototype.createThumbnail=function(e){var t=this._viewThumbnails.get(e.imageId);if(t){t.thumbnailData="data:image/"+"jpeg"+";base64,"+window.btoa(String.fromCharCode.apply(null,e.data));if(this._fireThumbnailLoaded){this._fireThumbnailLoaded({modelView:t})}}};V.prototype.highlightStyleExists=function(e){var t=this._vkScene.getHighlight(e);return t!==undefined};V.prototype.getView=function(e,t){this._resetCurrentScene(t);return this._views.get(e)};V.prototype.getSequence=function(e){return this._vkScene.findSequence(e)};V.prototype.setViewCamera=function(e,t,r){this._resetCurrentScene(r);var i=this._cameras.get(e);var a=this._views.get(t);if(i&&a){a.setCamera(i)}return this};V.prototype.setViewNodeInfos=function(e,t,r){this._resetCurrentScene(r);var i=this._views.get(t);i.setNodeInfos(e);return this};V.prototype.setViewThumbnail=function(e,t,r,i){this._resetCurrentScene(r);var a=this._views.get(t);var n=this._images.get(e);if(i){this._imageIdsAndTileWidths.set(e,i)}if(a&&n){if(a.userData!==undefined){if(a.userData.viewInfo.thumbnailId===e){a.thumbnailData=n}else if(a.userData.viewInfo.animatedThumbnailId===e){a.animatedThumbnailData=n;a.tileWidth=i}}}return this};V.prototype.cleanup=function(){this._rootNode?.removeFromParent();this._rootNode=null;this._currentSceneId=null;this._contentResource=null;this._resolve=null;this._reject=null;this._vkScene?.clearUnusedMaterials();this._callouts.forEach(function(e){e.destroy()});this._callouts.clear();this._cameras.forEach(function(t){if(!t instanceof e.Camera){t.destroy()}});this._cameras.clear();this._images.clear();this._imageIdsAndTileWidths.clear();this._imageTextures.clear();this._geometries.clear();this._meshNodes.clear();this._meshSubmeshes.clear();this._geometryProxies.clear();this._geometrySubmeshIndices.clear();this._materialMeshes.clear();this._materialClones.clear();this._joints=[];this._pointCloudGroups=[];this._imageAddedToMaterialHandlers=[];this._isSmallScene=null;this._preprocessedClusterDefinitions=null;this._preprocessedSubmeshToClusterMap=null;if(this._nodes){this._nodes.clear()}if(this._tracks){this._tracks.clear()}if(this._trackIdSequenceNodeMap){this._trackIdSequenceNodeMap.clear()}if(this._viewGroups){this._viewGroups.clear()}if(this._views){this._views.clear()}this._sceneIdTreeNodesMap.clear();this._sceneIdRootNodeMap.clear();this._viewThumbnails.clear();this._thrustlines.clear();this._animations.clear();this._animationTracks.clear();this._jointNodesMap.clear();this._jointParentsMap.clear()};V.prototype.insertAnimationGroup=function(e){var t=this._vkScene.findSequence(e.animationGroupRef.toString());if(!t){var r;if(e.endTime){r=e.endTime-e.startTime;if(!e.startTime){e.startTime=0}}t=this._vkScene.createSequence(e.animationGroupRef.toString(),{name:e.name,duration:r});if(!t.userData){t.userData={}}t.userData.animations=[]}if(e.modelViewRef){var i=this._views.get(e.modelViewRef);if(i){var a=this._vkScene.findSequence(e.animationGroupRef.toString());var n=new _({sequence:a,timeScale:e.playbackSpeed?1/e.playbackSpeed:1,preDelay:e.playbackPreDelay?e.playbackPreDelay:0,postDelay:e.playbackPostDelay?e.playbackPostDelay:0,repeat:e.playbackRepeat?Math.abs(e.playbackRepeat):0,reversed:e.playbackReversed?true:false,startTime:0});i.addPlayback(n)}}};V.prototype.insertAnimation=function(e){var t=this._animations.get(e.animationRef);if(!t){t={};t.type=e.animationType;t.targetRefs=[];t.targetPivots=[];t.sequenceId=e.animationGroupRef.toString();t.trackIds=new Set;t.tracks=[];this._animations.set(e.animationRef,t)}if(e.animationGroupRef){var r=this._vkScene.findSequence(e.animationGroupRef.toString());if(!r.userData.animations.includes(e.animationRef)){r.userData.animations.push(e.animationRef)}}};V.prototype.insertAnimationTarget=function(e){var t=this._animations.get(e.animationRef);if(t){if(!t.targetRefs.includes(e.targetRef)){t.targetRefs.push(e.targetRef);t.targetPivots.push({x:e.targetPivotX,y:e.targetPivotY,z:e.targetPivotZ})}}};V.prototype.insertAnimationTrack=function(e){var t=this._animationTracks.get(e.animationTrackRef);var r=e.animationRef;if(!t){delete e.animationRef;t=e;this._animationTracks.set(e.animationTrackRef,t)}if(!r){return}var a=this._animations.get(r);if(!a||!a.sequenceId){return}if(a.trackIds.has(t.animationTrackRef)){return}a.trackIds.add(t.animationTrackRef);for(var n=0;a.targetRefs&&n<a.targetRefs.length;n++){var s=a.targetRefs[n];var o=a.targetPivots[n];var d=this._nodes.get(s);if(!d){continue}var u;if(o.x!==0||o.y!==0||o.z!==0){u=[o.x,o.y,o.z]}var l=["OPACITY","COLOUR","TRANSLATE","SCALE","ROTATE"][t.type]||"";i.pushElementIntoMapArray(this._trackIdSequenceNodeMap,e.animationTrackRef,{sequenceId:a.sequenceId,targetId:s,type:l,pivot:u,isAbsoluteValue:true});var c={};c.times=Array.prototype.slice.call(t.times);c.values=Array.prototype.slice.call(t.values);c.id=e.animationTrackRef;c.cyclicInfo={};c.cyclicInfo.cyclicStart=t.cyclicStart;c.cyclicInfo.cyclicEnd=t.cyclicEnd;var h;if(a.type===0){if(t.dataType===0){if(t.values.length!==t.keyCount||t.times.length!==t.keyCount){continue}if(t.type===3){c.values=[];for(h=0;h<t.keyCount;h++){c.values.push(t.values[h]);c.values.push(t.values[h]);c.values.push(t.values[h])}}}else if(t.dataType===1||t.dataType===3){if(t.values.length!==3*t.keyCount||t.times.length!==t.keyCount){continue}}else if(t.dataType===4||t.dataType===5||t.dataType===6){if(t.values.length!==4*t.keyCount||t.times.length!==t.keyCount){continue}if(t.dataType===4){c.rotateType=I.AngleAxis}else if(t.dataType===6){c.rotateType=I.Euler}else{c.rotateType=I.Quaternion;for(var p=3;p<c.values.length;p=p+4){c.values[p]=-c.values[p]}}}}a.tracks.push(c)}};V.prototype.setAnimationTracks=function(e){var t=this._animations.get(e);if(t){this._animationHelper.insertTracks(t.tracks,this._trackIdSequenceNodeMap,this._nodes,this._vkScene)}};V.prototype.setAnimationPlaybacks=function(e){var t=this._viewGroups.get(e.viewGroupId);this._animationHelper.setInitialNodePositionsFromSubsequentViews(t.getViews(),this._vkScene);this._animationHelper.setInitialNodePositionsFromPreviousViews(t.getViews(),this._vkScene);this._animationHelper.setInitialNodePositionsFromCurrenetViews(t.getViews(),this._vkScene);this._animationHelper.setPlaybackStartTimes(t.getViews(),this._vkScene);this._animationHelper.buildViewsInitialState(t.getViews(),this._vkScene)};V.prototype.preferMeshes=function(){return true};V.prototype.setParametricContent=function(e,r,i){this._resetCurrentScene(i);const a={sphere:"generateSphere",box:"generateBox",plane:"generatePlane"};const n=r.type;if(n in a===false){t.warning("Attempt to load unknown parametric type: "+n);return}var s=this.getNode(e,this.sceneId);var o=r.materialID;var d=null;if(o){d=this._getMaterialRef(o)||this._createTemporaryMaterial(o);if(s.userData.parametricVisible){d.userData.parametricType=n}}const u=x[a[n]](r,d);if(s.userData.nodeContentType){u.userData.nodeContentType=s.userData.nodeContentType}u.userData.skipIt=true;u.renderOrder=s.renderOrder;s.add(u)};V.prototype.insertFillStyle=function(e){};V.prototype.insertLineStyle=function(e){};V.prototype.insertTextStyle=function(e){};V.prototype.setPointCloudGroups=function(t,r){this._resetCurrentScene(r);const i=this._vkScene.getSceneRef().userData;const a=this._vkScene.getPointCloudGroups();t.forEach(t=>{const n=this.getNode(t.nodeId,r);if(n){const r=n.userData;if(t.items?.length>0){n.material??=new e.MeshPhongMaterial;r.pointCloudGroupId=t.id;r.pcgBoundingBox??=new e.Box3;t.node=n;if(!r.renderGroup){i.currentInstanceIndex??=0;r.renderGroup={instanceIndex:i.currentInstanceIndex,clusterSet:new Set};i._instanceIndexToNodeMap??=new Map;i._instanceIndexToNodeMap.set(i.currentInstanceIndex,n);k.increaseCurrentInstance(i)}const s=t.items.map(e=>{const t=new B(e);t.sequence=parseInt(e.sequence,10);t.type=e.type||0;t.node=n;t.instanceIndex=r.renderGroup.instanceIndex;return t});a.set(n,s)}else{a.delete(n)}}});const n=this._pointCloudGroups=[];a.forEach(e=>{e.forEach(e=>{e.node.userData.renderGroup.clusterSet.clear();n.push(e)})});n.sort((e,t)=>t.sequence-e.sequence);this._geometries.forEach(e=>{e.forEach(e=>{k._updateGeometryClusterInstance(e,n)})})};V.prototype._getSavedColor=function(e,t){if(e&&e.length>2){return R({red:Math.floor(e[0]*255),green:Math.floor(e[1]*255),blue:Math.floor(e[2]*255),alpha:e.length>3?e[3]:1})}else if(t){return t}return undefined};var de=[];V.prototype._computeMeshPriority=function(e,t){de[0]=de[1]=de[2]=Infinity;de[3]=de[4]=de[5]=-Infinity;for(var r=0,i=t.length;r<i;++r){var a=t[r];de[0]=Math.min(de[0],a[0]);de[1]=Math.min(de[1],a[1]);de[2]=Math.min(de[2],a[2]);de[3]=Math.max(de[3],a[3]);de[4]=Math.max(de[4],a[4]);de[5]=Math.max(de[5],a[5])}var n=e[0];var s=n.matrixWorld.getMaxScaleOnAxis();var o=0;var d=0;var u=0;if(de[3]>=de[0]&&de[4]>=de[1]&&de[5]>=de[2]){o=de[3]-de[0];d=de[4]-de[1];u=de[5]-de[2]}var l=o*(d+u)+d*u;return l*s*e.length};V.prototype.bindMarkerNodeTransformationToReferenceNode=function(e,t,r){if(!e||!t){return}var i=this._nodeWithAssocicatedMarkers.get(e);if(i==null){i=new Map;this._nodeWithAssocicatedMarkers.set(e,i)}i.set(t,{coordinateSpace:r});this._markNodeIdsToRefNodeIds.set(t,e)};V.prototype.unbindMarkerNodeTransformationFromReferenceNode=function(e,t){if(!e||!t){return}var r=this._nodeWithAssocicatedMarkers.get(e);if(r==null){return}r.delete(t);this._markNodeIdsToRefNodeIds.delete(t)};V.prototype.getBoundMarkerNodes=function(e){if(!e){return null}return this._nodeWithAssocicatedMarkers.get(e)};V.prototype.getAllNodesWithBoundMarkers=function(){return this._nodeWithAssocicatedMarkers};V.prototype.getReferenceNodeFromMarkerNodeId=function(e){var t=this._markNodeIdsToRefNodeIds.get(e);if(t){return this.getNode(t,this.sceneId)}return null};V.prototype.updateMarkerCoordinateSpace=function(e,t,r){if(!e||!t||!r){return}var i=this._nodeWithAssocicatedMarkers.get(t);if(i==null){return}i.set(r,{coordinateSpace:this._vkScene.PoiCoordinateSpaces.ReferenceNodeSpace})};V.prototype.setSceneMetadata=function(e){if(this._vkScene){this._vkScene.setSceneMetadata(e)}else{this._sceneMetadata=e}};return V});
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/threejs/SphericalMapMaterial", ["../thirdparty/three"],function(e){"use strict";var t=["#ifdef USE_MAP","\tvarying vec3 vEyeDirection;","#endif","void main() {","\t#include <begin_vertex>","\t#include <project_vertex>","#ifdef USE_MAP","\tif (isOrthographic) {","\t\tvEyeDirection = vec3(-viewMatrix[0][2], -viewMatrix[1][2], -viewMatrix[2][2]);","\t} else {","\t\tvec4 worldPosition = modelMatrix * vec4(transformed, 1.0);","\t\tvEyeDirection = worldPosition.xyz - cameraPosition;","\t}","#endif","}"].join("\n");var i=["#define RECIPROCAL_PI 0.3183098861837907","#define RECIPROCAL_PI2 0.15915494309189535","#include <map_pars_fragment>","uniform vec3 color;","uniform float opacity;","#ifdef USE_MAP","\tvarying vec3 vEyeDirection;","#endif","void main() {","#ifdef USE_MAP","#if UP_AXIS == 4","\tvec2 texCoord = vec2(atan(vEyeDirection.x, vEyeDirection.y), acos(-vEyeDirection.z / length(vEyeDirection))) * vec2(RECIPROCAL_PI2, RECIPROCAL_PI);","#else","\tvec2 texCoord = vec2(atan(vEyeDirection.z, vEyeDirection.x), acos(-vEyeDirection.y / length(vEyeDirection))) * vec2(RECIPROCAL_PI2, RECIPROCAL_PI);","#endif","\tvec4 mapColor = vec4(texture2D(map, texCoord).rgb, opacity);","\tmapColor.rgb *= color;","#else","\tdiscard;","\tvec4 mapColor = vec4(0.0);","#endif","\tgl_FragColor = mapColor;","}"].join("\n");function r(o){o=o||{};var n=new e.ShaderMaterial({type:"SphericalMapMaterial",uniforms:{map:{value:o.map||null},color:{value:o.color||new e.Color(1,1,1)},opacity:{value:o.opacity!==undefined?o.opacity:1}},defines:{UP_AXIS:o.upAxis!==undefined?o.upAxis:2},vertexShader:t,fragmentShader:i,depthTest:false,depthWrite:false,blending:e.CustomBlending});Object.setPrototypeOf(n,r.prototype);Object.defineProperties(n,{map:{enumerable:true,get:function(){return this.uniforms.map.value},set:function(e){this.uniforms.map.value=e}},color:{enumerable:true,get:function(){return this.uniforms.color.value},set:function(e){this.uniforms.color.value=e}},opacity:{enumerable:true,get:function(){return this.uniforms.opacity.value},set:function(e){this.uniforms.opacity.value=e}},upAxis:{enumerable:true,get:function(){return this.defines.UP_AXIS},set:function(e){this.defines.UP_AXIS=e;this.needsUpdate=true}}});return n}r.prototype=Object.assign(Object.create(e.ShaderMaterial.prototype),{constructor:r});r.prototype.isSphericalMapMaterial=true;r.prototype.copy=function(t){e.ShaderMaterial.prototype.copy.call(this,t);this.map=t.map;this.color.copy(t.color);return this};return r});
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/threejs/Texture", ["../Texture","../thirdparty/three"],function(t,e){"use strict";var i=t.extend("sap.ui.vk.threejs.Texture",{metadata:{library:"sap.ui.vk"},constructor:function(t){if(t){var i=new e.TextureLoader;this._nativeTexture=i.load(t)}}});var r=i.getMetadata().getParent().getClass().prototype;i.prototype.init=function(){if(r.init){r.init.call(this)}};i.prototype.load=function(t){var i=new e.TextureLoader;this._nativeTexture=i.load(t);return this};i.prototype.getTextureRef=function(){return this._nativeTexture};i.prototype.setTextureRef=function(t){this._nativeTexture=t;return this};i.prototype.getId=function(){return this._nativeTexture?.userData.id||undefined};i.prototype.setId=function(t){if(this._nativeTexture){this._nativeTexture.userData.id=t}return this};i.prototype.getFilterMode=function(){if(this._nativeTexture){return this._nativeTexture.magFilter===e.NearestFilter?1:0}return 0};i.prototype.setFilterMode=function(t){if(this._nativeTexture){this._nativeTexture.magFilter=t===1?e.NearestFilter:e.LinearFilter}};i.prototype.getUvRotationAngle=function(){if(this._nativeTexture){return this._nativeTexture.rotation}return 0};i.prototype.setUvRotationAngle=function(t){if(this._nativeTexture){this._nativeTexture.rotation=t}};i.prototype.getUvHorizontalOffset=function(){if(this._nativeTexture){return this._nativeTexture.offset.x}return 0};i.prototype.setUvHorizontalOffset=function(t){if(this._nativeTexture){this._nativeTexture.offset.x=t}};i.prototype.getUvVerticalOffset=function(){if(this._nativeTexture){return this._nativeTexture.offset.y}return 0};i.prototype.setUvVerticalOffset=function(t){if(this._nativeTexture){this._nativeTexture.offset.y=t}};i.prototype.getUvHorizontalScale=function(){if(this._nativeTexture){return this._nativeTexture.repeat.x}return 0};i.prototype.setUvHorizontalScale=function(t){if(this._nativeTexture){this._nativeTexture.repeat.x=t}};i.prototype.getUvVerticalScale=function(){if(this._nativeTexture){return this._nativeTexture.repeat.y}return 0};i.prototype.setUvVerticalScale=function(t){if(this._nativeTexture){this._nativeTexture.repeat.y=t}};i.prototype.getUvHorizontalTilingEnabled=function(){if(this._nativeTexture){return this._nativeTexture.wrapS===e.RepeatWrapping}return true};i.prototype.setUvHorizontalTilingEnabled=function(t){if(this._nativeTexture){this._nativeTexture.wrapS=t?e.RepeatWrapping:e.ClampToEdgeWrapping}};i.prototype.getUvVerticalTilingEnabled=function(){if(this._nativeTexture){return this._nativeTexture.wrapT===e.RepeatWrapping}return true};i.prototype.setUvVerticalTilingEnabled=function(t){if(this._nativeTexture){this._nativeTexture.wrapT=t?e.RepeatWrapping:e.ClampToEdgeWrapping}};return i});
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/threejs/ThreeExtensions", ["../abgrToColor","../ObjectType","../thirdparty/three","../NodeContentType","./ThreeUtils"],function(e,t,i,r,n){"use strict";i.Object3D.prototype._vkCalculateObjectOrientedBoundingBox=function(){n.computeObjectOrientedBoundingBox(this,this.userData.boundingBox=new i.Box3)};i.Object3D.prototype._vkTraverseNodeGeometry=function(e){e(this);for(var t=0,i=this.children.length;t<i;t++){var r=this.children[t];if(r.geometry!==undefined&&r.userData.skipIt){if(r.children){r._vkTraverseNodeGeometry(e)}else{e(r)}}else if(r.children){r._vkTraverseNodeGeometry(e)}}};i.Object3D.prototype._vkSetOpacityRecursive=function(e){this.traverseVisible(function(t){if(t.material){t.material.opacity=e;t.material.transparent=e<1}})};i.Object3D.prototype._vkGetTotalOpacity=function(e,t){var i;if(e){i=new Map;e.forEach(function(e){if(!e.node||!e.parent){return}i.set(e.node,e)})}var r=1;var n=this;do{var a=null,o=null;if(i){o=i.get(n)}if(o&&o.opacity!=null){a=o.opacity}else if(t){a=t._getOpacity(n)}else if(n.userData&&n.userData.opacity!==undefined){a=n.userData.opacity}var s=1;if(o&&o.opacity!=null&&n.userData&&n.userData.offsetOpacity!=null){s=n.userData.offsetOpacity}if(a!=null){r*=a;r*=s}if(o&&o.parent){n=o.parent;continue}n=n.parent}while(n);return r};i.Object3D.prototype._vkTraverseMeshNodes=function(e){if(this._vkUpdate!==undefined||this.isDetailView||this.userData.nodeContentType===r.PMI){return}e(this);var t=this.children;for(var i=0,n=t.length;i<n;i++){t[i]._vkTraverseMeshNodes(e)}};i.Object3D.prototype._vkTraverseNodes=function(e,t,i){e(this);var r;if(i){r=i.get(this)}var n;if(r){for(n=0;n<r.length;n++){r[n].node._vkTraverseNodes(e,t,i)}}var a=this.children;if(a){for(n=0;n<a.length;n++){var o=a[n];if(t){var s=t.get(o);if(s){continue}}o._vkTraverseNodes(e,t,i)}}};function a(e,t){var i=e.min,r=e.max,n=t.elements,a=(i.x+r.x)*.5,o=(i.y+r.y)*.5,s=(i.z+r.z)*.5,u=r.x-a,c=r.y-o,h=r.z-s;var p=n[0]*a+n[4]*o+n[8]*s+n[12];var d=n[1]*a+n[5]*o+n[9]*s+n[13];var f=n[2]*a+n[6]*o+n[10]*s+n[14];var l=Math.abs(n[0]*u)+Math.abs(n[4]*c)+Math.abs(n[8]*h);var y=Math.abs(n[1]*u)+Math.abs(n[5]*c)+Math.abs(n[9]*h);var v=Math.abs(n[2]*u)+Math.abs(n[6]*c)+Math.abs(n[10]*h);i.set(p-l,d-y,f-v);r.set(p+l,d+y,f+v)}i.Object3D.prototype._expandBoundingBox=function(e,t,r,n){var o=new i.Box3;function s(i){const r=i.userData;var n=i.geometry;if(n!==undefined){const t=r.renderGroup;if(t?.boundingBox){o.setFromPackedArray(t.boundingBox)}else{if(!n.boundingBox){n.computeBoundingBox()}o.copy(n.boundingBox)}if(!o.isEmpty()){a(o,i.matrixWorld);if(isFinite(o.min.x)&&isFinite(o.min.y)&&isFinite(o.min.z)&&isFinite(o.max.x)&&isFinite(o.max.y)&&isFinite(o.max.z)){e.union(o)}}}else if(r.pcgBoundingBox?.isEmpty()===false){o.copy(r.pcgBoundingBox);a(o,i.matrixWorld);e.union(o)}const s=r.boundingBox;if(s!==undefined&&s.min&&s.max&&!s.isEmpty()&&!t){o.copy(s);a(o,i.matrixWorld);e.union(o)}}function u(e){if(e._vkUpdate!==undefined&&(r||n&&e.userData.is2D)){return}if(!t||e.visible){s(e);var i=e.children;for(var a=0,o=i.length;a<o;a++){u(i[a])}}}u(this);return e};i.Object3D.prototype._vkPersistentId=function(){var e=this;do{if(e.userData.treeNode&&e.userData.treeNode.sid){return e.userData.treeNode.sid}e=e.parent}while(e);return null};i.Object3D.prototype._vkSetNodeContentType=function(e){this.userData.nodeContentType=e;if(e===r.Reference){this.visible=false;this.userData.skipIt=true}else if(e===r.Background){this.userData.renderStage=-1}else if(e===r.Symbol){this.userData.symbolContent=true;this.userData.renderStage=1;this.updateMatrix();this.updateMatrixWorld(true);this.userData.direction=(new i.Vector3).setFromMatrixColumn(this.matrixWorld,2).normalize()}};i.Object3D.prototype._vkGetNodeContentType=function(){return this.userData.nodeContentType};i.Camera.prototype._vkZoomTo=function(e,t){t=t||0;var r=new i.Vector3;e.getSize(r);if(r.lengthSq()===0){return this}var n=e.min,a=e.max;var o=[new i.Vector3(n.x,n.y,n.z),new i.Vector3(a.x,a.y,a.z),new i.Vector3(n.x,n.y,a.z),new i.Vector3(n.x,a.y,a.z),new i.Vector3(a.x,n.y,a.z),new i.Vector3(a.x,a.y,n.z),new i.Vector3(n.x,a.y,n.z),new i.Vector3(a.x,n.y,n.z)];var s=new i.Matrix4,u=new i.Vector3,c=new i.Box2;function h(e){o.forEach(function(t){u=t.project(e);c.expandByPoint(new i.Vector2(u.x,u.y))})}var p=this.view;if(p&&p.enabled){h(this);var d=p.offsetX+p.width*(.5+.25*(c.min.x+c.max.x));var f=p.offsetY+p.height*(.5-.25*(c.min.y+c.max.y));var l=Math.max(c.max.x-c.min.x,c.max.y-c.min.y)*.5*(1+t);p.width*=l;p.height*=l;p.offsetX=d-p.width*.5;p.offsetY=f-p.height*.5;return this}function y(e){s.multiplyMatrices(e.projectionMatrix,e.matrixWorldInverse);for(var t in o){u.copy(o[t]).applyMatrix4(s);if(u.x<-1||u.x>1||u.y<-1||u.y>1){return false}}return true}var v=new i.Vector3;e.getCenter(v);var x=new i.Vector3;this.getWorldDirection(x);x.multiplyScalar(r.length());this.position.copy(v).sub(x);this.updateMatrixWorld(true);if(this.isPerspectiveCamera){while(!y(this)){this.position.sub(x);this.updateMatrixWorld(true)}var m=10;var b=this.position.clone();var g=v.clone();for(var D=0;D<m;D++){this.position.copy(b).add(g).multiplyScalar(.5);this.updateMatrixWorld(true);if(y(this)){b.copy(this.position)}else{g.copy(this.position)}}this.position.copy(b).sub(v).multiplyScalar(t).add(b);this.updateMatrixWorld(true)}else if(this.isOrthographicCamera){h(this);this.zoom/=Math.max(c.max.x-c.min.x,c.max.y-c.min.y)*.5*(1+t);this.updateProjectionMatrix()}return this};i.Mesh.prototype._vkClone=function(){var e=new i.Mesh;n.disposeMaterial(e.material);e.copy(this);return e}});
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/threejs/ThreeUtils", ["../thirdparty/three","sap/base/Log","./MarchingCubes","../ObjectType"],function(e,r,t,n){"use strict";var a=new Float32Array(1);var i={};i.createWebGLImageRenderer=function(r,t,n){var a=new e.WebGLRenderer({canvas:r,preserveDrawingBuffer:true,antialias:true,alpha:true});a.setSize(t,n);a.outputColorSpace=e.LinearSRGBColorSpace;return a};i.createWebGLRenderer=function(r,t){var n=new e.WebGLRenderer({antialias:true,alpha:true});n.setPixelRatio(r);n.setSize(1,1);if(t){n.shadowMap.enabled=true}n.outputColorSpace=e.LinearSRGBColorSpace;return n};i._disposeMaterial=function(e){if(e.map){e.map.dispose()}if(e.lightMap){e.lightMap.dispose()}if(e.bumpMap){e.bumpMap.dispose()}if(e.normalMap){e.normalMap.dispose()}if(e.envMap){e.envMap.dispose()}if(e.alphaMap){e.alphaMap.dispose()}if(e.emissiveMap){e.emissiveMap.dispose()}if(e.aoMap){e.aoMap.dispose()}e.dispose()};i.disposeMaterial=function(e){if(e){i._disposeMaterial(e)}};i.disposeObject=function(r){if(r instanceof e.Mesh||r instanceof e.Line||r instanceof e.Box3Helper){if(r.geometry){r.geometry.dispose()}if(r.material){i._disposeMaterial(r.material)}}};i.disposeGeometry=function(r){if(r instanceof e.Mesh||r instanceof e.Line||r instanceof e.Box3Helper){if(r.geometry){r.geometry.dispose()}}};i.getAllTHREENodes=function(t,n,a){if(!t){return}if(!n||!a){r.error("getAllTHREENodes input parameters - all3DNodes and/or allGroupNodes are undefined.");return}t.forEach(function(r){if(r instanceof e.Mesh){n.push(r)}else if(r instanceof e.Light){n.push(r)}else if(r instanceof e.Camera){n.push(r)}else if(r instanceof e.Box3Helper){n.push(r)}else if(r instanceof e.Group){a.push(r)}if(r.children&&r.children.length>0){i.getAllTHREENodes(r.children,n,a)}})};var o=new e.Vector3;var s=function(e,r){if(e.userData.pcgBoundingBox){r.copy(e.userData.pcgBoundingBox)}else{r.makeEmpty()}e.updateMatrixWorld(true);e.traverse(function(e){if(e.userData.objectType===n.Hotspot||e.userData.objectType===n.PMI){return}var t;var a;var i=e.geometry;if(i!=null){if(i.isGeometry){var s=i.vertices;for(t=0,a=s.length;t<a;t++){o.copy(s[t]);o.applyMatrix4(e.matrixWorld);r.expandByPoint(o)}}else if(i.isBufferGeometry){var u=i.attributes.position;if(u!=null){var f=e.userData.renderGroup;for(t=f?f.firstVertex:0,a=f?f.lastVertex:u.count;t<a;t++){o.fromBufferAttribute(u,t).applyMatrix4(e.matrixWorld);r.expandByPoint(o)}}}}});return r};i.computeObjectOrientedBoundingBox=function(e,r){var t=e.parent;var n=e.matrix.clone();var a=e.matrixAutoUpdate;e.parent=null;e.matrix.identity();e.matrixAutoUpdate=false;s(e,r);e.matrixAutoUpdate=a;e.matrix.copy(n);e.parent=t;e.updateMatrixWorld(true);return r};function u(e,r,t){r[0]=e[t+8];r[4]=e[t+9];r[8]=e[t+10];r[12]=e[t+11];r[1]=e[t+12];r[5]=e[t+13];r[9]=e[t+14];r[13]=e[t+15];r[2]=e[t+16];r[6]=e[t+17];r[10]=e[t+18];r[14]=e[t+19]}i.computeClusterBoundingBoxes=function(r,t,n,a){var i=new Uint8Array(t.buffer);var o,s,f,l,d,c,p,v,m,h,x,b,g;var y;var M=new e.Matrix4;var I=M.elements;var C=new e.Vector3;for(var B=0,w=r.length;B<w;++B){if(a[3+B]===0){continue}var U=new e.Box3;var A=new e.Vector3;y=0;x=r[B].additionalRenderables;o=r[B].geometry;f=o.userData.renderInstanceCount||1;s=o.contents;for(h=0;h<2;++h){for(l=0,d=s.length;l<d;++l){c=s[l].instanceIndex;for(p=0;p<f;++p){v=c*20;c++;if((i[v*4+3]&3)>0){u(t,I,v);for(m=0;m<8;++m){C.x=t[v+((m&1)>0?3:2)];C.y=t[v+((m&2)>0?5:4)];C.z=t[v+((m&4)>0?7:6)];C.applyMatrix4(M);if(h>0){y=Math.max(y,A.distanceToSquared(C))}else{U.expandByPoint(C)}}}}}for(l=0,d=x.length;l<d;++l){b=x[l];g=b.userData.renderGroup;if(g.instanceIndex===null){for(m=0;m<8;++m){C.x=g.boundingBox[v+((m&1)>0?3:0)];C.y=g.boundingBox[v+((m&2)>0?4:1)];C.z=g.boundingBox[v+((m&4)>0?5:2)];C.applyMatrix4(b.matrixWorld);if(h>0){y=Math.max(y,A.distanceToSquared(C))}else{U.expandByPoint(C)}}}}const r=o.userData.pointCloudInstances;if(r){for(const e of r){v=e*20;u(t,I,v);for(m=0;m<8;++m){C.x=t[v+((m&1)>0?3:2)];C.y=t[v+((m&2)>0?5:4)];C.z=t[v+((m&4)>0?7:6)];C.applyMatrix4(M);if(h>0){y=Math.max(y,A.distanceToSquared(C))}else{U.expandByPoint(C)}}}}if(h===0){if(U.isEmpty()){o.boundingBox=null;o.boundingSphere=null;break}U.getCenter(A)}else{o.boundingBox=U;o.boundingSphere=new e.Sphere(A,Math.sqrt(y))}}}};i.initClustersBeforeProcessingHierarchy=function(e){e.forEach(e=>{e.additionalRenderables.length=0;if(e.material.userData.isPointCloud){e.material.transparent=false}})};i.processUpdatedDataTexture=function(e,r,t){var n=e.userData.textureUpdateParams;if(n){r=Math.min(r,n.updatedFrom);t=Math.max(t,n.updatedTo)}var a=4;var i=a*e.image.width;var o=Math.floor(r/i);var s=Math.ceil(t/i);var u=s-o;var f=0;var l=e.image.width;var d=o*i;if(u===1){f=Math.floor((r-i*o)/a);d+=f*a;l=Math.ceil((t-d)/a)}e.userData.textureUpdateParams={xOffset:f,yOffset:o,width:l,height:u,dataOffset:d,updatedFrom:r,updatedTo:t};e.needsUpdate=true};i.prepareTextureUpdateResults=function(e,r){var t=3+e;if(!r){var n=new Uint32Array(t);n[0]=4294967295;return n}if(r.length>=t){return r}var a=new Uint32Array(t);a.set(r);return a};function f(e,r,t,n,a){for(var i=0,o=t.instanceIndex*20;i<a;++i,++o){if(e[o]!=n[i]){e[o]=n[i];r[3+t.clusterIndex]=1;if(o<r[0]){r[0]=o}if(o>r[1]){r[1]=o}}}}function l(e,r,t,n){var a=e.userData.renderGroup;if(a&&a.instanceIndex!==null){f(t,n,a,r,1)}var i=e.children;for(var o=0,s=i.length;o<s;o++){l(i[o],r,t,n)}}i.removeNodeFromClusterRenderingRecursive=function(e,r,t){l(e,a,r,t)};const d=(new e.Matrix4).elements;i.updateNodeClusterRenderingInfo=function(e,r,t,n,a,i){var o=e.userData;var s=o.renderGroup;if(s&&s.clusterIndex!==undefined){var u=r[s.clusterIndex];if(s.instanceIndex===null){u.additionalRenderables.push(e)}else if(n){var l=new Uint8Array(t.buffer);l[0]=0;l[1]=0;l[2]=0;if(!u.isPoints&&(o.initialMaterialId!==o.materialId||e.renderOrder!=0||o.customMaterial||o.defaultMaterial||e.material.transparent===true)){l[3]=2;u.additionalRenderables.push(e)}else if(o.customMaterial&&e.material.userData.customColor){const r=e.material.color;l[0]=255*r.r;l[1]=255*r.g;l[2]=255*r.b;l[3]=3}else{l[3]=1}t[1]=u.isPoints?e.material.opacity:1;if(u.isPoints&&e.material.opacity<1){s.clusterSet?.forEach(e=>{r[e].material.transparent=true})}var c=s.boundingBox;if(c){t[2]=c[0];t[3]=c[3];t[4]=c[1];t[5]=c[4];t[6]=c[2];t[7]=c[5]}const p=i&&u.isPoints?d:e.matrixWorld.elements;t[8]=p[0];t[9]=p[4];t[10]=p[8];t[11]=p[12];t[12]=p[1];t[13]=p[5];t[14]=p[9];t[15]=p[13];t[16]=p[2];t[17]=p[6];t[18]=p[10];t[19]=p[14];f(n,a,s,t,20)}}else if(e.isMesh||e.isLine||e.isPoints||e._vkUpdate){a[2]=1}};function c(e,r,t,n,a,i,o,s,u){if(i===o){r[a*u*u+n*u+t]=1}if(i<o){var f=e[s[0]];s[0]++;t*=2;n*=2;a*=2;var l,d,p;for(p=0;p<2;++p){for(d=0;d<2;++d){for(l=0;l<2;++l){if((f&1<<p*4+d*2+l)!==0){c(e,r,t+l,n+d,a+p,i+1,o,s,u)}}}}}}function p(e,r){var t,n,a,i;var o=r*r;var s=true;var u;while(s){s=false;u=0;for(a=0;a<r;++a){for(n=0;n<r;++n){for(t=0;t<r;++t){if(e[a*o+n*r+t]>0){t++;for(i=r-1;i>t;--i){if(e[a*o+n*r+i]>0){for(;t<i;++t){if(e[a*o+n*r+t]===0){e[a*o+n*r+t]=1;s=true}}break}}u++;break}}}}for(a=0;a<r;++a){for(t=0;t<r;++t){for(n=0;n<r;++n){if(e[a*o+n*r+t]>0){n++;for(i=r-1;i>n;--i){if(e[a*o+i*r+t]>0){for(;n<i;++n){if(e[a*o+n*r+t]===0){e[a*o+n*r+t]=1;s=true}}break}}u++;break}}}}for(n=0;n<r;++n){for(t=0;t<r;++t){for(a=0;a<r;++a){if(e[a*o+n*r+t]>0){a++;for(i=r-1;i>a;--i){if(e[i*o+n*r+t]>0){for(;a<i;++a){if(e[a*o+n*r+t]===0){e[a*o+n*r+t]=1;s=true}}break}}u++;break}}}}}return u*2}function v(e,r,t,n){var a=r*4;var i,o,s,u;switch(e){case 0:i=[t[0],t[1],t[5],t[3],t[1],t[5],t[0],t[4],t[5],t[3],t[4],t[5]];o=0;s=0;u=1;break;case 1:i=[t[0],t[1],t[2],t[0],t[4],t[2],t[3],t[1],t[2],t[3],t[4],t[2]];o=0;s=0;u=-1;break;case 2:i=[t[0],t[4],t[5],t[3],t[4],t[5],t[0],t[4],t[2],t[3],t[4],t[2]];o=0;s=1;u=0;break;case 3:i=[t[0],t[1],t[5],t[0],t[1],t[2],t[3],t[1],t[5],t[3],t[1],t[2]];o=0;s=-1;u=0;break;case 4:i=[t[3],t[1],t[5],t[3],t[1],t[2],t[3],t[4],t[5],t[3],t[4],t[2]];o=1;s=0;u=0;break;default:i=[t[0],t[1],t[5],t[0],t[4],t[5],t[0],t[1],t[2],t[0],t[4],t[2]];o=-1;s=0;u=0;break}n.points.set(i,a*3);if(n.normals!==undefined){n.normals.set([o,s,u,o,s,u,o,s,u,o,s,u],a*3)}n.indices.set([a+0,a+1,a+2,a+2,a+1,a+3],r*6)}function m(e,r,t,n,a,i){e[0]=a[0]+r*i[0];e[1]=a[1]+t*i[1];e[2]=a[2]+n*i[2];e[3]=e[0]+i[0];e[4]=e[1]+i[1];e[5]=e[2]+i[2]}function h(e,r,t,n,a,i){var o,s,u,f;var l=r*t;var d=0;var c=[(a[3]-a[0])/r,(a[4]-a[1])/t,(a[5]-a[2])/n];var p=[0,0,0,0,0,0];for(u=0;u<n;++u){for(s=0;s<t;++s){for(o=0;o<r;++o){if(e[u*l+s*r+o]>0){m(p,o,s,u,a,c);v(5,d,p,i);d++;for(f=r-1;f>=o;--f){if(e[u*l+s*r+f]>0){m(p,f,s,u,a,c);v(4,d,p,i);d++;break}}break}}}}for(u=0;u<n;++u){for(o=0;o<r;++o){for(s=0;s<t;++s){if(e[u*l+s*r+o]>0){m(p,o,s,u,a,c);v(3,d,p,i);d++;for(f=t-1;f>=s;--f){if(e[u*l+f*r+o]>0){m(p,o,f,u,a,c);v(2,d,p,i);d++;break}}break}}}}for(s=0;s<t;++s){for(o=0;o<r;++o){for(u=0;u<n;++u){if(e[u*l+s*r+o]>0){m(p,o,s,u,a,c);v(1,d,p,i);d++;for(f=n-1;f>=u;--f){if(e[f*l+s*r+o]>0){m(p,o,s,f,a,c);v(0,d,p,i);d++;break}}break}}}}return d*4}function x(e,r,t,n,a,i,o,s){const u=t==null;let f;if(i>0){f=false}else if(i<0){f=true}else if(u){f=r>n}else{f=r>n||t>a}const l=f?r:n;const d=f?t:a;const c=u?0:o*d;const p=e.tempBuffer;e.points=p.points.subarray(0,l*3);if(c>0){const r=s*o;if(p.indices.length<c){p.indices=new Uint16Array(c)}else if(r<p.previousIndexCount){p.indices.fill(0,r,p.previousIndexCount)}p.previousIndexCount=c;e.indices=p.indices.subarray(0,c)}else{e.indices=undefined}if(e.normals!==undefined){e.normals=p.normals.subarray(0,l*3)}if(e.colors!==undefined){e.colors=p.colors.subarray(0,l*3);e.colors.fill(1)}if(e.uvs!==undefined){e.uvs=p.uvs.subarray(0,l*2)}}function b(e,r,t,n){var a=t[0]<=2?Infinity:(n[3]-n[0])/t[0];var i=t[1]<=2?Infinity:(n[4]-n[1])/t[1];var o=t[2]<=2?Infinity:(n[5]-n[2])/t[2];var s=-1;if(a<=i&&a<=o){if(a!==Infinity){s=0}}else if(i<=a&&i<=o){if(i!==Infinity){s=1}}else if(o<=a&&o<=i){if(o!==Infinity){s=2}}if(s<0){return 0}a=t[0];i=t[1];o=t[2];var u=a*i;var f=a,l=i,d=o;var c=f*l;var p,v,m;if(s===0){t[0]=t[0]>>1;f=t[0];c=f*l;for(m=0;m<o;++m){for(v=0;v<i;++v){for(p=0;p<a;++p){r[m*c+v*f+p]=e[m*u+v*a+p*2]|e[m*u+v*a+p*2+1]}}}}if(s===1){t[1]=t[1]>>1;l=t[1];c=f*l;for(m=0;m<o;++m){for(v=0;v<i;++v){for(p=0;p<a;++p){r[m*c+v*f+p]=e[m*u+v*2*a+p]|e[m*u+(v*2+1)*a+p]}}}}if(s===2){t[2]=t[2]>>1;d=t[2];c=f*l;for(m=0;m<o;++m){for(v=0;v<i;++v){for(p=0;p<a;++p){r[m*c+v*f+p]=e[m*2*u+v*a+p]|e[(m*2+1)*u+v*a+p]}}}}var h=0;for(m=0;m<d;++m){for(v=0;v<l;++v){for(p=0;p<f;++p){if(r[m*c+v*f+p]>0){h++;break}}}}for(m=0;m<d;++m){for(p=0;p<f;++p){for(v=0;v<l;++v){if(r[m*c+v*f+p]>0){h++;break}}}}for(v=0;v<l;++v){for(p=0;p<f;++p){for(m=0;m<d;++m){if(r[m*c+v*f+p]>0){h++;break}}}}return h*2}i.buildEmptyMesh=function(e,r,t,n,a){var i={tempBuffer:a,points:null,normals:(r&3)>0?null:undefined,colors:(r&32)>0?null:undefined,uvs:(r&4)>0?null:undefined,indices:null};x(i,t,n,t,n,-1,3-(r&1),0);var o=i.points;o[0]=e[0];o[1]=e[1];o[2]=e[2];for(var s=1;s<t;++s){o[s*3]=e[3];o[s*3+1]=e[4];o[s*3+2]=e[5]}return i};i.buildTemporaryMesh=function(e,r,n,a,i,o,s,u){var f=s<=0;var l={tempBuffer:u,points:null,normals:(r&3)>0?null:undefined,colors:(r&32)>0?null:undefined,uvs:(r&4)>0?null:undefined,indices:null};var d=0;var m=0;var g=null;var y=0;if(!o&&i&&(f||n>=384&&a>=192)){var M=atob(i);var I=M.length;g=new Uint8Array(I);for(var C=0;C<I;++C){g[C]=M.charCodeAt(C)}y=g[0]}var B=null;var w=0;if(y>0){B=new Uint8Array(Math.pow(Math.pow(2,y),3));w=Math.pow(2,y);var U=new Uint32Array(2);U[0]=1;c(g,B,0,0,0,0,y,U,w);var A=t.count(B,w);var k=f?21845:Math.min(n/3,a);if(!f&&A>k){m=p(B,w);A=t.count(B,w)}if(A<=k){x(l,A*3,A,n,a,s,3,A);t.march(B,w,e,l.points,l.normals,l.indices);d=A*3}}if(d===0&&w>=2){var D=Math.floor(Math.min(n/4,a/2));if(f){D=m}var G=new Uint8Array(w*w*w/2);var S=[w,w,w];var R=false;var P=0;for(;;){if(m<=D){x(l,m*4,m*2,n,a,s,3,m*2);d=h(R?G:B,S[0],S[1],S[2],e,l);break}m=P===4?0:b(R?G:B,R?B:G,S,e);if(!m){break}R=!R;P++}}if(d===0){x(l,24,12,n,a,s,3,12);for(;d<6;++d){v(d,d,e,l)}d=24}var T=l.points;for(var E=d,L=T.length/3;E<L;++E){T[E*3]=T[0];T[E*3+1]=T[1];T[E*3+2]=T[2]}return l};i.updateClusterAttrib=function(e,r,t,n){var a=e.getAttribute(r);a.array.set(n,t);a.addUpdateRange(t,n.length)};i.updateClusterIndices=function(e,r,t,n,a){var i=e.getIndex();i.addUpdateRange(n,a);var o=i.array;for(var s=0;s<a;++s){o[n+s]=t+r[s]}};const g=new e.Vector3;i._updateClusterInstanceAttribute=function(r,t,n,a,i){const o=r.getAttribute("clusterInstance");const s=r.getAttribute("position").array;const u=r.userData;const f=u.clusterIndex;const l=t+n;const d=o.array;const c=new Set;const p=new Set;for(let e=t,r=t*3;e<l;e++,r+=3){g.fromArray(s,r);let t;c.clear();for(let e=0;e<i.length;e++){const r=i[e];if(r.containsPoint(g)&&!c.has(r.node)){if(r.type!==1){t=r;break}else{c.add(r.node)}}}if(t){p.add(t.node);const e=t.node.userData;e.renderGroup.clusterIndex=f;e.renderGroup.clusterSet.add(f);u.pointCloudInstances??=new Set;u.pointCloudInstances.add(t.instanceIndex);e.pcgBoundingBox.expandByPoint(g)}d[e]=t?t.instanceIndex:a}o.addUpdateRange(t,n);o.needsUpdate=true;p.forEach(r=>{const t=r.userData.pcgBoundingBox;r.userData.renderGroup.boundingBox=[t.min.x,t.min.y,t.min.z,t.max.x,t.max.y,t.max.z];const n=t.getCenter(new e.Vector3);r.userData.renderGroup.boundingSphere=[n.x,n.y,n.z,n.sub(t.min).length()]})};i._updateGeometryClusterInstance=function(e,r){const t=e.geometry;if(t.userData.isPointCloud){this._updateClusterInstanceAttribute(t,e.vertexStart,e.vertexCount,e.instanceIndex,r)}};i.updateClusterGeometry=function(e,r,t,n,a,o,s){if(r.length===e.vertexCount*3&&(!o||!o.length||o.length===e.indexCount)){var u=e.geometry;var f=!u.userData.isPolyline;var l=e.instanceIndex;var d=u.contents;for(var c=0,p=d.length;c<p;++c){if(d[c].instanceIndex===l){if(d[c].isFinal!==true){d[c].isFinal=true;var v=e.vertexStart;i.updateClusterAttrib(u,"position",v*3,r);if(t&&t.length&&f){i.updateClusterAttrib(u,"normal",v*3,t)}if(n&&n.length){i.updateClusterAttrib(u,"color",v*3,n)}if(a&&a.length){i.updateClusterAttrib(u,"uv",v*2,a)}if(o&&o.length){i.updateClusterIndices(u,o,v,e.indexStart,e.indexCount)}if(s?.length>0){i._updateGeometryClusterInstance(e,s)}if(u.shouldUpload<1){u.shouldUpload=1}}return true}}}return false};i.prepareClustersForGpuUpload=function(e){var r,t,n,a,i;var o=e.length;var s=0;for(var u=0;u<o;++u){r=e[u].geometry;t=r.shouldUpload;if(t===1&&o>=100){n=r.contents;i=n.length;for(a=0;a<i;++a){if(!n[a].isFinal){t=0;s++;break}}}if(t>0){r.shouldUpload=0;t=r.getIndex();if(t){t.needsUpdate=true}t=r.attributes;t.position.needsUpdate=true;if(t.normal){t.normal.needsUpdate=true}if(t.color){t.color.needsUpdate=true}if(t.uv){t.uv.needsUpdate=true}if(t.clusterInstance){t.clusterInstance.needsUpdate=true}}}return s};i.increaseCurrentInstance=function(e){if(e.currentInstanceIndex<e.maxInstanceIndex){e.currentInstanceIndex++}else{r.error("Maximum number of instances in a texture reached!")}};i.partitionCluster=function(e,r,t,n){var a;var i=null;var o=r.length-1;for(var s=0,u=e.length;s<u;++s){a=e[s];if(!i||i.verts+a.verts>65536){i={verts:0,elems:0};r.push(i);o++}t.set(a.submeshId,o);n[a.meshIndex].submeshes[a.submeshIndex].clusterIndex=o;i.verts+=a.verts;i.elems+=a.elems}};return i});
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/threejs/Thrustline", ["../thirdparty/three","sap/ui/base/ManagedObject","./PolylineGeometry","./PolylineMaterial","./PolylineMesh","../LeaderLineMarkStyle"],function(e,t,r,a,s,i){"use strict";var n=t.extend("sap.ui.vk.threejs.Thrustline",{metadata:{library:"sap.ui.vk",properties:{node:{type:"object"},renderOrder:{type:"int",defaultValue:0},depthTest:{type:"boolean",defaultValue:true},principleAxis:{type:"object",defaultValue:new e.Vector3(0,0,0)},material:{type:"object"},items:{type:"object[]"},segments:{type:"object[]"}}}});n.prototype.init=function(){if(t.prototype.init){t.prototype.init.call(this)}this._needUpdateMeshes=false};n.prototype.setNode=function(t){if(t instanceof e.Object3D){this.setProperty("node",t,true);this._needUpdateMeshes=true}return this};n.prototype.setRenderOrder=function(e){this.setProperty("renderOrder",e,true);this._needUpdateMeshes=true;return this};n.prototype.setDepthTest=function(e){this.setProperty("depthTest",e,true);this._needUpdateMeshes=true;return this};n.prototype.setMaterial=function(t){if(t instanceof e.Material){this.setProperty("material",t,true);this._needUpdateMeshes=true}return this};n.prototype.setItems=function(e){this.setProperty("items",e,true);this._needUpdateMeshes=true;return this};n.prototype.setSegments=function(e){this.setProperty("segments",e,true);this._needUpdateMeshes=true;return this};n.prototype._updateMeshes=function(t){var i=this.getNode();var n=this.getMaterial();var o=this.getDepthTest();var p=this.getRenderOrder();var l=n&&n.userData.lineStyle?n.userData.lineStyle:{};var d=l.width;var h=l.dashPatternScale;if(l.widthCoordinateSpace===3){d=d?d*t.y/2:1;h=h?h*t.y/2:1}d=d||1;l.haloWidth=l.haloWidth||0;l.endCapStyle=l.endCapStyle||0;this.getSegments().forEach(function(t){if(t.polylineMesh){i.remove(t.polylineMesh);t.polylineMesh=null}if(t.haloMesh){i.remove(t.haloMesh);t.haloMesh=null}var u=[];for(var y=0,c=t.ratios.length;y<c;y++){u.push(new e.Vector3)}var f=new r;f.setVertices(u);var v=l.endCapStyle||u.length>2?1:0;var m=(v&&l.endCapStyle===0?1:0)|(v&&l.endCapStyle===0?2:0);if(l.haloWidth>0){var M=new a({color:16777215,lineColor:16777215,linewidth:d*(l.haloWidth*2+1),dashCapStyle:l.endCapStyle,segmentCapStyle:v,trimStyle:m,transparent:true,depthTest:o});var g=new s(f,M);g.matrixAutoUpdate=false;g.renderOrder=p;g.userData.skipIt=true;t.haloMesh=g;i.add(g)}var S=new a({color:16777215,lineColor:n.color,linewidth:d,dashCapStyle:l.endCapStyle,segmentCapStyle:v,trimStyle:m,dashPattern:l.dashPattern||[],dashScale:h||1,transparent:true,depthTest:o,polygonOffset:true,polygonOffsetFactor:-4});var w=new s(f,S);w.matrixAutoUpdate=false;w.renderOrder=p;w.userData.skipIt=true;t.polylineMesh=w;i.add(w)})};var o=new e.Matrix4,p=new e.Matrix4,l=new e.Vector3,d=new e.Vector3,h=new e.Vector3,u=new e.Vector3;n.prototype._update=function(t,r,a){var s=this.getNode();if(!s||!s.visible){return}if(this._needUpdateMeshes){this._needUpdateMeshes=false;this._updateMeshes(a)}o.multiplyMatrices(r.projectionMatrix,r.matrixWorldInverse);p.copy(o);var i=r instanceof e.PerspectiveCamera?r.near:undefined;var n=this.getItems();l.copy(this.getPrincipleAxis()).normalize();this.getSegments().forEach(function(t){var r=t.polylineMesh;if(r){var s=r.geometry;var o=n[t.startItemIndex];const S=(new e.Vector3).copy(o.boundPoints[t.startBoundIndex]).applyMatrix4(o.target.matrixWorld);var y=n[t.endItemIndex];const w=(new e.Vector3).copy(y.boundPoints[t.endBoundIndex]).applyMatrix4(y.target.matrixWorld);d.copy(w).sub(S);h.copy(l).multiplyScalar(d.dot(l));u.copy(d).sub(h);var c=s.vertices;var f=[];for(var v=0,m=t.ratios.length;v<m;v++){f.push(v);var M=t.ratios[v];var g=c[v];g.copy(S);d.copy(h).multiplyScalar(M.x);g.add(d);d.copy(u).multiplyScalar(M.y);g.add(d)}s._updateVertices(f);r.material.resolution.copy(a);r.computeLineDistances(p,a,i)}var S=t.haloMesh;if(S){S.material.resolution.copy(a);S.computeLineDistances(p,a,i)}})};return n});
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/threejs/UsageCounter", ["../thirdparty/three"],function(e){"use strict";var r=function(){};r.increaseMaterialUsed=function(e){if(e&&e.userData&&e.userData.materialUsed!==undefined){e.userData.materialUsed++;return true}return false};r.decreaseMaterialUsed=function(e){if(e&&e.userData&&e.userData.materialUsed!==undefined){e.userData.materialUsed--;return true}return false};r.increaseGeometryUsed=function(e){if(e&&e.userData&&e.userData.geometryUsed!==undefined){e.userData.geometryUsed++;return true}return false};r.decreaseGeometryUsed=function(e){if(e&&e.userData&&e.userData.geometryUsed!==undefined){e.userData.geometryUsed--;return true}return false};return r});
/*!
* SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
*/
sap.ui.predefine("sap/ui/vk/threejs/ViewStateManager", ["sap/base/assert","../Core","../ViewStateManagerBase","../thirdparty/three","../cssColorToColor","../colorToCSSColor","../abgrToColor","../colorToABGR","./Scene","../ObjectType","../RotationType","./HighlightPlayer","../HighlightDisplayState","../Highlight","../AnimationTrackType","../AnimationTrackValueType","../AnimationMath","../NodeContentType","./ThreeUtils","sap/ui/base/DataType","../TransformationMatrix","sap/ui/core/Element"],function(t,e,i,r,n,a,o,s,l,u,c,h,f,d,p,y,g,v,_,m,A,S){"use strict";var w;class C{cloneMaterial(t,e){const i=t.clone();i.userData.prototypeMaterial=t;return i}releaseMaterial(t){_.disposeMaterial(t);return this}}var b=i.extend("sap.ui.vk.threejs.ViewStateManager",{metadata:{library:"sap.ui.vk"}});var N=b.getMetadata().getParent().getClass().prototype;b.prototype.init=function(){N.init?.call(this);this._nodeHierarchy=null;this._nodeStates=new Map;this._selectedNodes=new Set;this._needsMaterialUpdate=new Set;this._outlinedNodes=new Set;this.setOutlineColor("rgba(255, 0, 255, 1.0)");this.setOutlineWidth(1);this._materialCache=new C;this._showSelectionBoundingBox=true;this._visibilityTracker=new w;this._boundingBoxesScene=new r.Scene;this._selectedNodesBoundingBox=new r.Box3;this._boundingBoxColor=new r.Color(12632064);this.setHighlightColor("rgba(255, 0, 0, 1.0)");this._joints=[];this._highlightPlayer=new h;this._highlightPlayer.setViewStateManager(this);this._transitionPlayer=new h;this._transitionPlayer.setViewStateManager(this);e.getEventBus().subscribe("sap.ui.vk","activateView",this._onActivateView,this)};b.prototype._clearBoundingBoxScene=function(){var t=[];var e=[];_.getAllTHREENodes([this._boundingBoxesScene],t,e);t.forEach(function(t){_.disposeObject(t);t.parent.remove(t)});e.forEach(function(t){t.parent.remove(t)})};b.prototype._clearNodeStates=function(){var t=this._nodeStates;t.forEach(function(t,e){if(t.material!=null){_.disposeMaterial(t.material)}if(t.material2!=null){_.disposeMaterial(t.material2)}if(t.boundingBoxNode){_.disposeObject(t.boundingBoxNode)}},this);t.clear()};b.prototype.exit=function(){e.getEventBus().unsubscribe("sap.ui.vk","activateView",this._onActivateView,this);this._clearNodeStates();this._selectedNodes.clear();this._outlinedNodes.clear();if(this._boundingBoxesScene){this._clearBoundingBoxScene();this._boundingBoxesScene=null}this._nodeHierarchy=null;N.exit?.call(this)};b.prototype._setContent=function(t){if(t===this._scene){return this}var e=null;if(t&&t instanceof l){e=t}this._setScene(e);if(e){var i=e.getInitialView();if(i){this._currentView=i;this._resetNodesMaterialAndOpacityByCurrentView(this._currentView)}}return this};b.prototype._setScene=function(t){this._clearNodeStates();if(this._boundingBoxesScene){this._clearBoundingBoxScene()}this._boundingBoxesScene=new r.Scene;this._setNodeHierarchy(t?t.getDefaultNodeHierarchy():null);if(t){t.setViewStateManager(this)}this._scene=t;if(this._scene){var e=this._scene.getInitialView();if(e){this.activateView(e)}}return this};b.prototype._setNodeHierarchy=function(t){var e=this._nodeHierarchy;if(this._nodeHierarchy){this._nodeHierarchy.detachNodeReplaced(this._handleNodeReplaced,this);this._nodeHierarchy.detachNodeUpdated(this._handleNodeUpdated,this);this._nodeHierarchy.detachNodeRemoving(this._handleNodeRemoving,this);this._nodeHierarchy=null;this._clearNodeStates();this._selectedNodes.clear();this._outlinedNodes.clear();this._visibilityTracker.clear()}if(t){this._nodeHierarchy=t;this._nodeHierarchy.attachNodeReplaced(this._handleNodeReplaced,this);this._nodeHierarchy.attachNodeUpdated(this._handleNodeUpdated,this);this._nodeHierarchy.attachNodeRemoving(this._handleNodeRemoving,this);const e=[];const i=[];t.getSceneRef().traverse(function(t){(t.visible?e:i).push(t)});this.fireVisibilityChanged({visible:e,hidden:i})}if(t!==e){this.fireNodeHierarchyReplaced({oldNodeHierarchy:e,newNodeHierarchy:t})}return this};b.prototype._getJointByChildNode=function(t){var e;if(this._jointCollection){for(var i=0;i<this._jointCollection.length;i++){if(this._jointCollection[i].node===t){e=this._jointCollection[i];break}}}return e};b.prototype._handleNodeReplaced=function(t){var e=t.getParameter("ReplacedNodeRef");var i=t.getParameter("ReplacementNodeRef");if(this.getSelectionState(e)){this.setSelectionStates(i,e)}};b.prototype._handleNodeUpdated=function(t){var e=t.getParameter("nodeRef");if(this.getSelectionState(e)){this.setSelectionStates([],e);this.setSelectionStates(e,[])}};b.prototype._handleNodeRemoving=function(t){var e=t.getParameter("nodeRef");if(this._jointCollection){for(var i=0;i<this._jointCollection.length;i++){if(this._jointCollection[i].node===e){this._jointCollection[i].node=null;break}if(this._jointCollection[i].parent===e){this._jointCollection[i].parent=null;break}}}if(this.getSelectionState(e)){this.setSelectionStates([],e,true,true)}};b.prototype.getNodeHierarchy=function(){return this._nodeHierarchy};b.prototype.getVisibilityChanges=function(){return this.getShouldTrackVisibilityChanges()?this._visibilityTracker.getInfo(this.getNodeHierarchy()):null};b.prototype.getCurrentView=function(){var t=S.getElementById(this.getViewManager());if(!t){return null}var e=t.getActiveView();return e};b.prototype.resetNodeProperty=function(t,e){const i=this.getCurrentView()?.getNodeInfos();if(i){var n=[];n.push(t);if(this._jointCollection&&this._jointCollection.length>0){for(var a=0;a<this._jointCollection.length;a++){var o=this._jointCollection[a];if(!o.node||!o.parent){continue}var s=o.parent;if(s!==t){break}n.push(o.node)}}i.forEach(function(a){if(!n.includes(a.target)){return}if(!e||e!==p.Opacity){var o={nodeRefs:[],positions:[]};var s;var l;var u;if(a.transform){var c=new r.Vector3;var h=new r.Quaternion;var f=new r.Vector3;var d=R(a.transform);d.decompose(c,h,f);s=c.toArray();l=h.toArray();u=f.toArray()}else if(a[p.Scale]&&a[p.Rotate]&&a[p.Translate]){s=a[p.Translate].slice();l=a[p.Rotate].slice();u=a[p.Scale].slice()}if(s){o.nodeRefs.push(a.target);o.positions.push({translation:s,quaternion:l,scale:u});this.setTransformation(o.nodeRefs,o.positions)}}else{this.setOpacity(t,a.opacity);var y={changed:t,opacity:i.opacity};this.fireOpacityChanged(y)}},this)}};b.prototype.getVisibilityComplete=function(){var t=this.getNodeHierarchy(),e=t.findNodesByName(),i=[],r=[];e.forEach(function(e){var n=t.createNodeProxy(e);var a=n.getVeId();t.destroyNodeProxy(n);if(a){if(this.getVisibilityState(e)){i.push(a)}else{r.push(a)}}},this);return{visible:i,hidden:r}};b.prototype.resetVisibility=function(){const t=[];const e=[];this._nodeStates.forEach(function(i,r){const n=i.visible;if(n===true){e.push(r)}else if(n===false){t.push(r)}i.visible=null});this._deleteUnusedNodeStates();this._visibilityTracker.clear();this.fireVisibilityChanged({visible:t,hidden:e});return this};b.prototype.getVisibilityState=function(t){if(Array.isArray(t)){return t.map(t=>E(t,this._nodeStates.get(t)))}else{return E(t,this._nodeStates.get(t))}};b.prototype.setVisibilityState=function(t,e,i,r){if(!Array.isArray(t)){t=[t]}var n=Array.isArray(e);var a=[];var o=t;if(i){o=[];t.forEach(function(t,i){var r=this._collectNodesRecursively(t);o=o.concat(r);var s=a.length;a.length+=r.length;a.fill(n?e[i]:e,s)},this)}else if(!n){a.length=o.length;a.fill(e)}else{a=e}if(r){var s=[];o.forEach(function(t,e){var i=a[e];if(i){for(var r=t;r&&!r.isScene;r=r.parent){s.push(r)}}});o=o.concat(s);var l=a.length;a.length+=s.length;a.fill(true,l)}var u=[];var c=new Set;var h=o.filter(function(t,e){if(t==null||t.userData.skipIt||c.has(t)){return false}c.add(t);const i=this._nodeStates.get(t);var r=E(t,i);var n=a[e];var o=r!==n;if(o){u.push(n)}return o},this);if(h.length>0){this._applyVisibilityNodeState(h,u);this._deleteUnusedNodeStates();var f={visible:[],hidden:[]};h.forEach(function(t,e){f[u[e]?"visible":"hidden"].push(t)});if(this.getShouldTrackVisibilityChanges()){h.forEach(this._visibilityTracker.trackNodeRef,this._visibilityTracker)}this.fireVisibilityChanged(f)}return this};b.prototype.enumerateSelection=function(t){this._selectedNodes.forEach(t);return this};b.prototype.enumerateOutlinedNodes=function(t){this._outlinedNodes.forEach(t);return this};b.prototype.getSelectionState=function(t){const e=this._selectedNodes.has.bind(this._selectedNodes);return Array.isArray(t)?t.map(e):e(t)};b.prototype._getSelectionComplete=function(){var t=this.getNodeHierarchy(),e=[],i=[];function r(e){var i=t.createNodeProxy(e);var r=i.getVeId();t.destroyNodeProxy(i);return r}this._selectedNodes.forEach(function(t){var i=r(t);if(i){e.push(i)}});this._outlinedNodes.forEach(function(t){var e=r(t);if(e){i.push(e)}});return{selected:e,outlined:i}};b.prototype._addBoundingBox=function(t){t._vkCalculateObjectOrientedBoundingBox()};b.prototype._removeBoundingBox=function(t){delete t.userData.boundingBox};b.prototype._expandBoundingBoxWithSelected=function(t){if(!this._selectedNodesBoundingBox.isEmpty()){t.union(this._selectedNodesBoundingBox)}};b.prototype._updateBoundingBoxes=function(){var t;var e=new r.Vector3;var i=new r.Vector3;var n=new r.Quaternion;var a=new r.Matrix4;var o,s;this._selectedNodesBoundingBox.makeEmpty();var l=null;var u=this._selectedNodes.size;if(u>0){l=new Float32Array(u*16);u=0;this._selectedNodes.forEach(function(r){r._vkCalculateObjectOrientedBoundingBox();t=r.userData.boundingBox;if(t&&!t.isEmpty()){t.getCenter(e);t.getSize(i);i.multiplyScalar(.5);a.compose(e,n,i);a.premultiply(r.matrixWorld);s=a.elements;for(o=0;o<16;++o){l[u++]=s[o]}for(o=0;o<8;++o){e.x=(o&1)>0?1:-1;e.y=(o&2)>0?1:-1;e.z=(o&4)>0?1:-1;e.applyMatrix4(a);this._selectedNodesBoundingBox.expandByPoint(e)}}},this);if(u!==l.length){l=l.slice(0,u)}}var c=this._boundingBoxesScene.children.length>0?this._boundingBoxesScene.children[0]:null;var h=false;var f=false;if(u>0){if(!c){f=true}else{var d=c.geometry.attributes.itm;if(u===d.array.length){s=d.array;for(o=0;o<u;++o){if(l[o]!==s[o]){d.set(l);d.version++;break}}}else{h=true;f=true}}}else if(c){h=true}var p=null;if(h){if(f){p=c.material}this._boundingBoxesScene.remove(c);_.disposeObject(c);c=null}if(f){if(!p){p=new r.LineBasicMaterial({color:this._boundingBoxColor,onBeforeCompile:function(t){t.vertexShader=("attribute mat4 itm;\n"+t.vertexShader).replace("#include <begin_vertex>","#include <begin_vertex>\ntransformed = (itm * vec4(transformed, 1.0)).xyz;\n")}})}var y=new r.InstancedBufferGeometry;y.setIndex(new r.BufferAttribute(new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),1));y.setAttribute("position",new r.Float32BufferAttribute([1,1,1,-1,1,1,-1,-1,1,1,-1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1],3));y.setAttribute("itm",new r.InstancedBufferAttribute(l,16));c=new r.LineSegments(y,p);c.frustumCulled=false;this._boundingBoxesScene.add(c)}};b.prototype.setShowSelectionBoundingBox=function(t){this._showSelectionBoundingBox=t;this._selectedNodes.forEach(t?this._addBoundingBox:this._removeBoundingBox,this)};b.prototype.getShowSelectionBoundingBox=function(){return this._showSelectionBoundingBox};b.prototype.setSelectionState=function(t,e,i,r){if(!Array.isArray(t)){t=[t]}t=(i||this.getRecursiveSelection()?this._collectNodesRecursively(t):t).filter(function(t,e,i){return i.indexOf(t)===e});if(this.getRecursiveSelection()&&!e){t=this._nodeHierarchy._appendAncestors(t)}const n=this._selectedNodes;const a=t.filter(t=>n.has(t)!==e);if(a.length>0){this._applySelectionNodeState(a,e);if(!e){this._deleteUnusedNodeStates()}if(!r){this.fireSelectionChanged({selected:e?a:[],unselected:e?[]:a})}}return this};b.prototype.setSelectionStates=function(t,e,i,r){if(!Array.isArray(t)){t=[t]}if(!Array.isArray(e)){e=[e]}t=i||this.getRecursiveSelection()?this._collectNodesRecursively(t):t;e=i||this.getRecursiveSelection()?this._collectNodesRecursively(e):e;if(this.getRecursiveSelection()){e=this._nodeHierarchy._appendAncestors(e,t)}var n=t.filter(function(t){return this._selectedNodes.has(t)===false},this);var a=e.filter(function(t){return this._selectedNodes.has(t)===true},this);if(n.length>0||a.length>0){this._applySelectionNodeState(n,true);this._applySelectionNodeState(a,false);if(a.length>0){this._deleteUnusedNodeStates()}if(!r){this.fireSelectionChanged({selected:n,unselected:a})}}return this};b.prototype.setOutlineColor=function(t){switch(typeof t){case"number":this._outlineColorABGR=t;break;case"string":const e=m.getType("sap.ui.core.CSSColor");if(e.isValid(t)){this._outlineColorABGR=s(n(t))}break;default:return this}this.fireOutlineColorChanged({outlineColor:a(o(this._outlineColorABGR)),outlineColorABGR:this._outlineColorABGR});return this};b.prototype.getOutlineColor=function(t){return t?this._outlineColorABGR:a(o(this._outlineColorABGR))};b.prototype.getOutliningState=function(t){var e=this._outlinedNodes;function i(t){return e.has(t)}return Array.isArray(t)?t.map(i):i(t)};b.prototype.setOutliningStates=function(t,e,i,r){if(!Array.isArray(t)){t=[t]}if(!Array.isArray(e)){e=[e]}t=i||this.getRecursiveOutlining()?this._collectNodesRecursively(t):t;e=i||this.getRecursiveOutlining()?this._collectNodesRecursively(e):e;if(this.getRecursiveOutlining()){e=this._nodeHierarchy._appendAncestors(e,t)}var n=t.filter(function(t){return this._outlinedNodes.has(t)===false},this);var a=e.filter(function(t){return this._outlinedNodes.has(t)===true},this);if(n.length>0||a.length>0){n.forEach(function(t){this._outlinedNodes.add(t)},this);a.forEach(function(t){this._outlinedNodes.delete(t)},this);if(!r){this.fireOutliningChanged({outlined:n,unoutlined:a})}}return this};b.prototype.setOutlineWidth=function(t){this._outlineWidth=t;this.fireOutlineWidthChanged({width:t});return this};b.prototype.getOutlineWidth=function(){return this._outlineWidth};b.prototype._collectNodesRecursively=function(t){var e=[];var i=this._nodeHierarchy;(Array.isArray(t)?t:[t]).forEach(function t(r){e.push(r);i.enumerateChildren(r,t,false,true)});return e};b.prototype._getOpacity=function(t){const e=this._nodeStates.get(t);return e?.opacity??null};b.prototype.getOpacity=function(t){if(Array.isArray(t)){return t.map(this._getOpacity,this)}else{return this._getOpacity(t)}};b.prototype.setOpacity=function(t,e,i){if(!Array.isArray(t)){t=[t]}var r=Array.isArray(e);var n=[];var a=t;if(i){a=[];t.forEach(function(t,i){var o=this._collectNodesRecursively(t);a=a.concat(o);var s=n.length;n.length+=o.length;n.fill(r?e[i]:e,s)},this)}else if(!r){n.length=a.length;n.fill(e)}else{n=e}var o=[];var s=new Set;var l=a.filter(function(t,e){if(s.has(t)){return false}s.add(t);const i=this._nodeStates.get(t);var r=n[e];var a=i==null&&r!=null||i!=null&&i.opacity!==r;if(a){o.push(r)}return a},this);if(l.length>0){this._applyOpacityNodeState(l,o);this._deleteUnusedNodeStates();var u={changed:l,opacity:r?o:o[0]};this.fireOpacityChanged(u)}return this};b.prototype._getTintColorABGR=function(t){const e=this._nodeStates.get(t);return e?.tintColor};b.prototype._getTintColor=function(t){const e=this._getTintColorABGR(t);return e!=null?a(o(e)):null};b.prototype.getTintColor=function(t,e){var i=e?this._getTintColorABGR:this._getTintColor;if(Array.isArray(t)){return t.map(i,this)}else{return i.call(this,t)}};function x(t){switch(typeof t){case"number":return t;case"string":const e=m.getType("sap.ui.core.CSSColor");return e.isValid(t)?s(n(t)):null;default:return null}}b.prototype.setTintColor=function(t,e,i){if(!Array.isArray(t)){t=[t]}var r=Array.isArray(e);var n=[];var a=t;if(i){a=[];t.forEach(function(t,i){var o=this._collectNodesRecursively(t);a=a.concat(o);var s=n.length;n.length+=o.length;n.fill(r?e[i]:e,s)},this)}else if(!r){n.length=a.length;n.fill(e)}else{n=e}var o=[];var s=[];var l=new Set;var u=a.filter(function(t,e){if(l.has(t)){return false}l.add(t);const i=this._nodeStates.get(t);var r=n[e];var a=x(n[e]);var u=i==null&&r!=null||i!=null&&i.tintColor!==a;if(u){o.push(r);s.push(a)}return u},this);if(u.length>0){this._applyTintColorNodeState(u,s);this._deleteUnusedNodeStates();var c={changed:u,tintColor:r?o:o[0],tintColorABGR:r?s:s[0]};this.fireTintColorChanged(c)}return this};b.prototype.setNodesHighlightColor=function(t,e,i){if(!Array.isArray(t)){t=[t]}const r=i?this._collectNodesRecursively(t):t;const n=Array.from(new Set(r));if(n.length>0){n.forEach(function(t){const i=this._getNodeState(t,e!=null);if(i!=null){i.highlightColor=e;this._setNeedsMaterialUpdate(t);t.children.forEach(this._setAncestorHighlightColorRecursively.bind(this,e!=null?e:i.ancestorHighlightColor),this)}},this);this._deleteUnusedNodeStates()}return this};b.prototype.setHighlightColor=function(t){switch(typeof t){case"number":this._highlightColorABGR=t;break;case"string":const e=m.getType("sap.ui.core.CSSColor");if(e.isValid(t)){this._highlightColorABGR=s(n(t))}break;default:return this}if(this._selectedNodes.size>0){this._nodeStates.forEach(function(t,e){if(t.selected||t.ancestorSelected){this._setNeedsMaterialUpdate(e)}},this)}this.fireHighlightColorChanged({highlightColor:a(o(this._highlightColorABGR)),highlightColorABGR:this._highlightColorABGR});return this};b.prototype.getHighlightColor=function(t){return t?this._highlightColorABGR:a(o(this._highlightColorABGR))};b.prototype.getRestTransformationUsingJoint=function(t){var e=this._getJointByChildNode(t);if(e&&e.translation&&e.scale&&e.quaternion){return e}else{return this.getRestTransformation(t)}};b.prototype.getRelativeTransformation=function(t){var e=function(t){var e=this.getRestTransformation(t);var i=[t.position.x-e.translation[0],t.position.y-e.translation[1],t.position.z-e.translation[2]];var n=(new r.Quaternion).fromArray(e.quaternion).invert().premultiply(t.quaternion).toArray();var a=[t.scale.x/e.scale[0],t.scale.y/e.scale[1],t.scale.z/e.scale[2]];return{translation:i,quaternion:n,scale:a}}.bind(this);if(!Array.isArray(t)){return e(t)}var i=[];t.forEach(function(t){i.push(e(t))});return i};b.prototype.getTransformationWorld=function(t){var e=function(t){var e=new r.Vector3;var i=new r.Vector3;var n=new r.Quaternion;t.updateMatrixWorld();t.matrixWorld.decompose(e,n,i);return{translation:e.toArray(),quaternion:n.toArray(),scale:i.toArray()}};if(!Array.isArray(t)){return e(t)}var i=[];t.forEach(function(t){i.push(e(t))});return i};b.prototype.getTransformation=function(t){var e=function(t){return{translation:this.getTranslation(t),quaternion:this.getRotation(t,c.Quaternion),scale:this.getScale(t)}}.bind(this);if(!Array.isArray(t)){return e(t)}var i=[];t.forEach(function(t){i.push(e(t))});return i};b.prototype.getTranslation=function(t){var e=function(t){return t.position.toArray()};if(!Array.isArray(t)){return e(t)}var i=[];t.forEach(function(t){i.push(e(t))});return i};b.prototype.getScale=function(t){var e=function(t){return t.scale.toArray()};if(!Array.isArray(t)){return e(t)}var i=[];t.forEach(function(t){i.push(e(t))});return i};b.prototype._convertQuaternionToAngleAxis=function(t){if(t.w>1){t.normalize()}if(t.w>.9999&&t.x<1e-4&&t.y<1e-4&&t.z<1e-4){t.w=1;t.x=0;t.y=0;t.z=0}var e=2*Math.acos(t.w);var i;var r;var n;var a=Math.sqrt(1-t.w*t.w);if(a<1e-4){i=1;r=0;n=0}else{i=t.x/a;r=t.y/a;n=t.z/a}return[i,r,n,e]};b.prototype.getRotation=function(t,e){var i=function(t){var i=t.quaternion;var n;switch(e){case c.AngleAxis:n=this._convertQuaternionToAngleAxis(i);break;case c.Euler:var a=new r.Euler;a.setFromQuaternion(i);n=a.toArray();break;default:n=i.toArray()}return n};if(!Array.isArray(t)){return i(t)}var n=[];t.forEach(function(t){n.push(i(t))});return n};b.prototype.setTransformation=function(t,e){var i=Array.isArray(t);if(!Array.isArray(t)){t=[t]}var n={changed:[],transformation:[]};var a=function(t){return{position:t.position.toArray(),quaternion:t.quaternion.toArray(),scale:t.scale.toArray()}};if(!e){t.forEach(function(t){if(t.userData.position&&t.userData.quaternion&&t.userData.scale){t.position=t.userData.position;t.quaternion=t.userData.quaternion;t.scale=t.userData.scale;t.updateMatrix();delete t.userData.position;delete t.userData.quaternion;delete t.userData.scale}n.changed.push(t);n.transformation.push(a(t))},this)}else{if(!Array.isArray(e)){e=[e]}t.forEach(function(t,i){var o=t.userData;if(!o){return}if(!o.position){o.position=t.position.clone()}if(!o.quaternion){o.quaternion=t.quaternion.clone()}if(!o.scale){o.scale=t.scale.clone()}var s=e[i];if(s.transform){var l=R(s.transform);l.decompose(t.position,t.quaternion,t.scale)}else{t.position.fromArray(s.translation);t.scale.fromArray(s.scale);if(s.quaternion){t.quaternion.fromArray(s.quaternion)}else if(s.angleAxis){var u=new r.Vector3(s.angleAxis[0],s.angleAxis[1],s.angleAxis[2]);t.quaternion.setFromAxisAngle(u,s.angleAxis[3])}else if(s.euler){var c=new r.Euler;c.fromArray(s.euler[0],s.euler[1],s.euler[2],s.euler[3]);t.quaternion.setFromEuler(c)}}t.updateMatrix();n.changed.push(t);n.transformation.push(a(t))},this)}if(!i){n.changed=n.changed[0];n.transformation=n.transformation[0]}this.fireTransformationChanged(n);return this};b.prototype.getJoints=function(){return this._jointCollection};b.prototype.setJoints=function(t,e){this._jointCollection=[];this._playbackAssociatedWithJoints=null;if(!t){return this}var i=new Set;var r=new Map;t.forEach(function(t){if(!t.node||!t.parent){return}i.add(t.node);r.set(t.node,t)});while(i.size>0){var n=i.values().next().value;i.delete(n);var a=r.get(n);var o=[a];var s=[];var l=a.parent;while(l){a=r.get(l);if(a!==undefined){if(i.delete(l)){o.push(a)}if(s.length>0){a.nodesToUpdate=a.nodesToUpdate||[];while(s.length>0){var u=s.pop();if(a.nodesToUpdate.indexOf(u)>=0){break}a.nodesToUpdate.push(u)}}s.length=0;l=a.parent}else{s.push(l);l=l.parent}}while(o.length>0){this._jointCollection.push(o.pop())}}if(this._jointCollection&&this._jointCollection.length>0){this._playbackAssociatedWithJoints=e;this._jointCollection.forEach(function(t){if(!t.node||!t.parent){return}t.translation=null;t.scale=null;t.quaternion=null;t.opacity=null;if(t.node.userData){t.node.userData.offsetTranslation=null;t.node.userData.offsetQuaternion=null;t.node.userData.offsetScale=null;t.node.userData.originalRotationType=null;t.node.userData.offsetOpacity=null}});this._jointCollection.forEach(function(t){this._updateJointNode(t,this._playbackAssociatedWithJoints)}.bind(this))}return this};b.prototype._updateJointNode=function(t,e){if(!t.node||!t.parent){return}if(t.translation&&t.quaternion&&t.scale&&t.opacity){return}var i=new Map;if(this._jointCollection&&this._jointCollection.length>0){this._jointCollection.forEach(function(t){if(!t.node||!t.parent){return}i.set(t.node,t)})}var n,a,o,s,l,u;var c=t.node;var h=new r.Matrix4;var f,d=1;while(c){u=this.getRestOpacity(c);l=this.getRestTransformation(c);if(!l){c=c.parent;continue}n=new r.Vector3(l.translation[0],l.translation[1],l.translation[2]);a=new r.Vector3(l.scale[0],l.scale[1],l.scale[2]);o=new r.Quaternion(l.quaternion[0],l.quaternion[1],l.quaternion[2],l.quaternion[3]);f=u;if(e){var y=this._getEndPropertyInPreviousPlayback(c,p.Translate,e,true);if(y){n.x+=y[0];n.y+=y[1];n.z+=y[2]}var g=this._getEndPropertyInPreviousPlayback(c,p.Scale,e,true);if(g){a.x*=g[0];a.y*=g[1];a.z*=g[2]}var v=this._getEndPropertyInPreviousPlayback(c,p.Rotate,e,true);if(v){var _=new r.Quaternion(v[0],v[1],v[2],v[3]);o=_.multiply(o)}var m=this._getEndPropertyInPreviousPlayback(c,p.Opacity,e,true);if(m!=null){f*=m}}s=(new r.Matrix4).compose(n,o,a);h.premultiply(s);d*=f;c=c.parent}var A=t.parent;var S=new r.Matrix4;var w=1;while(A){var C=i.get(A);if(C){if(!C.translation){this._updateJointNode(C)}n=new r.Vector3(C.translation[0],C.translation[1],C.translation[2]);a=new r.Vector3(C.scale[0],C.scale[1],C.scale[2]);o=new r.Quaternion(C.quaternion[0],C.quaternion[1],C.quaternion[2],C.quaternion[3]);f=C.opacity;A=C.parent}else{u=this.getRestOpacity(A);l=this.getRestTransformation(A);if(!l){A=A.parent;continue}n=new r.Vector3(l.translation[0],l.translation[1],l.translation[2]);a=new r.Vector3(l.scale[0],l.scale[1],l.scale[2]);o=new r.Quaternion(l.quaternion[0],l.quaternion[1],l.quaternion[2],l.quaternion[3]);f=u;if(e){var b=this._getEndPropertyInPreviousPlayback(A,p.Translate,e,true);if(b){n.x+=b[0];n.y+=b[1];n.z+=b[2]}var N=this._getEndPropertyInPreviousPlayback(A,p.Scale,e,true);if(N){a.x*=N[0];a.y*=N[1];a.z*=N[2]}var x=this._getEndPropertyInPreviousPlayback(A,p.Rotate,e,true);if(x){var T=new r.Quaternion(x[0],x[1],x[2],x[3]);o=T.multiply(o)}var R=this._getEndPropertyInPreviousPlayback(A,p.Opacity,e,true);if(R!=null){f*=R}}A=A.parent}s=(new r.Matrix4).compose(n,o,a);S.premultiply(s);w*=f}var V=S.copy(S).invert().multiply(h);V.decompose(n,o,a);t.translation=n.toArray();t.quaternion=o.toArray();t.scale=a.toArray();var k=function(t,e){if(t===e){return 1}else if(Math.abs(e)<1e-4){return 1}return t/e};t.opacity=k(d,w)};b.prototype._propagateOpacityToJointChildren=function(t,e){if(!t||!e||t.length!==e.length){return this}if(!this._jointCollection||!this._jointCollection.length){return this}var i=new Map;this._jointCollection.forEach(function(t){var e=i.get(t.parent);if(!e){e=[];i.set(t.parent,e)}e.push(t)});const r=this;var n=function(t,e){if(t.opacity!=null&&t.node){let i=t.opacity*e;if(t.node.userData.offsetOpacity!=null){i*=t.node.userData.offsetOpacity}r.setOpacity(t.node,i)}};t.forEach(function(t,r){var a=i.get(t);if(a){a.forEach(function(t){n(t,e[r])})}});return this};b.prototype.getSymbolNodes=function(t){var e=this.getCurrentView()||this._scene.getViews()[0];var i=e?e.getNodeInfos().reduce(function(e,i){if(i.target._vkGetNodeContentType()===v.Symbol&&i.target.parent){if(!t||t===i.target.userData.treeNode.sid){e.push(i.target)}}return e},[]):[];return i};var T={sphere:"360Image",plane:"2DImage"};b.prototype._getBackgroundNodeInfos=function(){var t=null,e=[];const i=e=>{if(this.getVisibilityState(e)){if(e._vkGetNodeContentType()===v.Background&&T[e.name]){t=e;return}var r=e.children;for(var n=0,a=r.length;n<a&&t===null;n++){i(r[n])}}};i(this._scene.getSceneRef());if(t){e=t.parent.children.filter(function(t){return t._vkGetNodeContentType()===v.Background})}return{current:t,all:e}};b.prototype.getBackgroundImageType=function(){var t=this._getBackgroundNodeInfos().current;return t?T[t.name]:null};b.prototype.setBackgroundImageType=function(t){var e=this._getBackgroundNodeInfos();var i=e.all.find(function(e){return t===T[e.name]});if(i&&!this.getVisibilityState(i)){if(e.current){this.setVisibilityState(e.current,false,false)}this.setVisibilityState(e.all,false,false);this.setVisibilityState(i,true,false)}return i};function R(t){var e=new r.Matrix4;if(t.length===3){e.setPosition((new r.Vector3).fromArray(t))}else if(t.length===12){e.fromArray(A.convertTo4x4(t))}else if(t.length===16){e.fromArray(t.slice())}else{throw"Invalid matrix format"}return e}b.prototype._resetNodesStatusByCurrentView=function(t,e){var i=this.getNodeHierarchy();if(i){var n=t.getNodeInfos();if(n){var a={nodeRefs:[],positions:[]};var o=new r.Vector3;var s=new r.Quaternion;var l=new r.Vector3;for(const t of n){if(t.target===null){return}if(t.transform){var u=R(t.transform);if(!g.equalMatrices(u,t.target.matrix,1e-6)){u.decompose(o,s,l);a.nodeRefs.push(t.target);a.positions.push({translation:o.toArray(),quaternion:s.toArray(),scale:l.toArray()})}}else if(t[p.Scale]&&t[p.Rotate]&&t[p.Translate]){a.nodeRefs.push(t.target);a.positions.push({translation:t[p.Translate].slice(),quaternion:t[p.Rotate].slice(),scale:t[p.Scale].slice()})}}if(t.userData&&t.userData.nodeStartDataByAnimation){t.userData.nodeStartDataByAnimation.forEach(function(t,e){if(t[p.Translate]&&t[p.Rotate]&&t[p.Scale]){a.nodeRefs.push(e);a.positions.push({translation:t[p.Translate].slice(),quaternion:t[p.Rotate].slice(),scale:t[p.Scale].slice()})}},this)}if(a.nodeRefs.length){this.setTransformation(a.nodeRefs,a.positions)}if(e){var c=[];var h=[];n.forEach(function(t){if(!t.target.userData.skipIt){(t.visible?c:h).push(t.target)}});this.setVisibilityState(i.getChildren()[0].children,false,true);if(this.getSymbolNodes().length){this.getSymbolNodes().forEach(function(t){t.traverse(function(t){t.visible=true})})}this.setVisibilityState(c,true,false);this.setVisibilityState(h,false,false)}}}};b.prototype._resetNodesMaterialAndOpacityByCurrentView=function(t){t?.getNodeInfos()?.forEach(function(t){if(t.target){this.setOpacity(t.target,t.opacity)}},this)};b.prototype._onActivateView=function(t,e,i){var r=this.getViewManager();if(!r||i.source.getId()!==r){return}this.activateView(i.view,false,i.playViewGroup,i.skipCameraTransitionAnimation)};b.prototype.activateView=function(t,i,r,n){this.fireViewStateApplying({view:t});this.setJoints(undefined);this._resetNodesMaterialAndOpacityByCurrentView(t);this._prepareTransition(t);this._resetNodesStatusByCurrentView(t,true);this._highlightPlayer.reset(t,this._scene);this.fireViewStateApplied({view:t,ignoreAnimationPosition:i,skipCameraTransitionAnimation:n,playViewGroup:r});e.getEventBus().publish("sap.ui.vk","viewStateApplied",{source:this,view:t,ignoreAnimationPosition:i,skipCameraTransitionAnimation:n,playViewGroup:r});return this};b.prototype.setHighlightDisplayState=function(t){if(t===f.playing){this._highlightPlayer.start(Date.now())}else if(t===f.stopped){this._highlightPlayer.stop()}else if(t===f.pausing){this._highlightPlayer.pause(Date.now())}this.fireHighlightColorChanged({highlightColor:a(o(this._highlightColorABGR)),highlightColorABGR:this._highlightColorABGR});return this};b.prototype._startHighlight=function(){this._highlightPlayer.start(Date.now());return this};b.prototype._playHighlight=function(){return this._highlightPlayer.play(Date.now())};b.prototype._prepareTransition=function(t){this._transitionPlayer.reset();this._transitionPlayer.fadeInNodes=[];this._transitionPlayer.fadeOutNodes=[];this._fadeInBackground=null;this._fadeOutBackground=null;var e=t.getNodeInfos();if(!e){return}var i=new Set;var r=new Set;e.forEach(function(t){(t.visible?i:r).add(t.target)});var n=this._transitionPlayer.fadeInNodes;var a=this._transitionPlayer.fadeOutNodes;var o=this._nodeHierarchy;var s=function(t,e,r){if(!t.userData.skipIt){e=e&&i.has(t);r=r&&this.getVisibilityState(t)}if(t.geometry&&e!==r){if(t.parent&&t.parent.userData.symbolContent){t.renderOrder=2}(e?n:a).push(t)}if(t._vkGetNodeContentType()===v.Background){if(e){this._fadeInBackground=t}else if(r){this._fadeOutBackground=t}}t.children.forEach(function(t){s(t,e,r)})}.bind(this);o.getChildren()[0].children.forEach(function(t){s(t,true,true)});if(this._fadeInBackground){this._fadeInBackground.traverse(function(t){if(t.material){t.renderOrder=-2}})}if(this._fadeOutBackground){this._fadeOutBackground.traverse(function(t){if(t.material){t.renderOrder=1}})}};b.prototype._startTransition=function(t){var e=this._transitionPlayer.fadeInNodes;var i=this._transitionPlayer.fadeOutNodes;if(e&&e.length){var r=new d("FadeIn",{duration:t/500,opacities:[1,0],cycles:.5,type:"FadeIn"});this._transitionPlayer.addHighlights(r,e)}if(i&&i.length){var n=new d("FadeOut",{duration:t/500,opacities:[0,1],cycles:.5,type:"FadeOut"});this._transitionPlayer.addHighlights(n,i)}if(e&&e.length||i&&i.length){this._transitionPlayer.start(Date.now());this._transitionPlayer.play(Date.now());return t}return 0};b.prototype._playTransition=function(){return this._transitionPlayer.play(Date.now())};b.prototype.updateNodesRestTransformation=function(t){for(var e=0;e<t.length;e++){this.updateRestTransformation(t[e],true);if(this._playbackAssociatedWithJoints&&e===t.length-1){var i=this._playbackAssociatedWithJoints.getSequence();if(i){i._fireSequenceChanged()}}}return this};b.prototype.updateRestTransformation=function(t,e){var i=this.getCurrentView();if(!i){return this}i.getNodeInfos()?.forEach(function(e){if(e.target===t){t.updateMatrix();e.transform=t.matrix.elements.slice()}});if(this._jointCollection&&this._jointCollection.length>0){this._jointCollection.forEach(function(e){if(!e.node||!e.parent){return}if(e.parent===t||e.node===t){e.translation=null;e.scale=null;e.quaternion=null;if(e.node.userData){e.node.userData.offsetTranslation=null;e.node.userData.offsetQuaternion=null;e.node.userData.offsetScale=null;e.node.userData.originalRotationType=null}}});this._jointCollection.forEach(function(e){if(!e.node||!e.parent){return}if(e.parent===t){this._updateJointNode(e,this._playbackAssociatedWithJoints);this.restoreRestTransformation(e.node)}}.bind(this));this._jointCollection.forEach(function(e){if(!e.node||!e.parent){return}if(e.node===t){this._updateJointNode(e,this._playbackAssociatedWithJoints)}},this);if(this._playbackAssociatedWithJoints&&!e){var r=this._playbackAssociatedWithJoints.getSequence();if(r){r._fireSequenceChanged()}}}return this};b.prototype.restoreRestTransformation=function(t){var e=this.getCurrentView();if(!e){return this}var i=e.getNodeInfos();if(i){i.forEach(function(e){if(e.target!==t){return}if(e.transform){var i=R(e.transform);i.decompose(t.position,t.quaternion,t.scale)}else if(e[p.Scale]&&e[p.Rotate]&&e[p.Translate]){t.position.set(e[p.Translate][0],e[p.Translate][1],e[p.Translate][2]);t.quaternion.set(e[p.Rotate][0],e[p.Rotate][1],e[p.Rotate][2],e[p.Rotate][3]);t.scale.set(e[p.Scale][0],e[p.Scale][1],e[p.Scale][2])}t.updateMatrix()})}var r={changed:[t],transformation:[{position:t.position.toArray(),quaternion:t.quaternion.toArray(),scale:t.scale.toArray()}]};this.fireTransformationChanged(r);return this};b.prototype.setRestTransformation=function(t,e,i,n){var a=this.getCurrentView();if(!a){return this}var o=a.getNodeInfos();if(o){o.forEach(function(a){if(a.target!==t){return}if(!e||!i||!n){if(a.transform){var o=new r.Vector3;var s=new r.Quaternion;var l=new r.Vector3;var u=R(a.transform);u.decompose(o,s,l);if(!e){e=[o.x,o.y,o.z]}if(!n){n=[l.x,l.y,l.z]}if(!i){i=[s.x,s.y,s.z,s.w]}}else if(a[p.Scale]&&a[p.Rotate]&&a[p.Translate]){if(!e){e=a[p.Translate].slice()}if(!n){n=a[p.Scale].slice()}if(!i){i=a[p.Rotate].slice()}}}var c=new r.Vector3(e[0],e[1],e[2]);var h=new r.Quaternion(i[0],i[1],i[2],i[3]);var f=new r.Vector3(n[0],n[1],n[2]);var d=new r.Matrix4;d.compose(c,h,f);a.transform=d.elements.slice()})}if(this._jointCollection&&this._jointCollection.length>0){this._jointCollection.forEach(function(e){if(!e.node||!e.parent){return}if(e.parent===t||e.node===t){e.translation=null;e.scale=null;e.quaternion=null;if(e.node.userData){e.node.userData.offsetTranslation=null;e.node.userData.offsetQuaternion=null;e.node.userData.offsetScale=null;e.node.userData.originalRotationType=null}}});this._jointCollection.forEach(function(e){if(!e.node||!e.parent){return}if(e.parent===t){this._updateJointNode(e,this._playbackAssociatedWithJoints);this.restoreRestTransformation(e.node)}},this);this._jointCollection.forEach(function(e){if(!e.node||!e.parent){return}if(e.node===t){this._updateJointNode(e,this._playbackAssociatedWithJoints)}},this);if(this._playbackAssociatedWithJoints){var s=this._playbackAssociatedWithJoints.getSequence();if(s){s._fireSequenceChanged()}}}return this};b.prototype.getRestOpacity=function(t){const e=this.getCurrentView()?.getNodeInfos();var i=1;if(e?.length){for(var r=0;r<e.length;r++){var n=e[r];if(n.target!==t){continue}if(n.opacity!==undefined&&n.opacity!==null){i=n.opacity}break}}return i};b.prototype.setRestOpacity=function(t,e){const i=this.getCurrentView()?.getNodeInfos();i?.forEach(function(i){if(i.target!==t){return}i.opacity=e});return this};b.prototype.restoreRestOpacity=function(t){const e=this.getCurrentView()?.getNodeInfos();if(e){e.forEach(function(e){if(e.target!==t){return}var i=1;if(e.opacity!==undefined){i=e.opacity}this.setOpacity(t,i)}.bind(this))}if(this._jointCollection&&this._jointCollection.length>0){this._jointCollection.forEach(function(e){if(!e.node||!e.parent){return}if(e.parent===t||e.node===t){e.opacity=null;if(e.node.userData){e.node.userData.offsetOpacity=null}}});this._jointCollection.forEach(function(e){if(!e.node||!e.parent){return}if(e.parent===t){this._updateJointNode(e,this._playbackAssociatedWithJoints);this.restoreRestOpacity(e.node)}},this);this._jointCollection.forEach(function(e){if(!e.node||!e.parent){return}if(e.node===t){this._updateJointNode(e,this._playbackAssociatedWithJoints)}},this);if(this._playbackAssociatedWithJoints){var i=this._playbackAssociatedWithJoints.getSequence();if(i){i._fireSequenceChanged()}}}return this};b.prototype.updateRestOpacity=function(t){const e=this.getCurrentView();if(!e){return this}e.getNodeInfos()?.forEach(function(e){if(e.target===t){const i=this._getOpacity(t);if(i!=null){e.opacity=i}else{delete e.opacity}}},this);if(this._jointCollection?.length>0){this._jointCollection.forEach(function(e){if(!e.node||!e.parent){return}if(e.parent===t||e.node===t){e.opacity=null;if(e.node.userData){e.node.userData.offsetOpacity=null}}});this._jointCollection.forEach(function(e){if(!e.node||!e.parent){return}if(e.node===t){this._updateJointNode(e,this._playbackAssociatedWithJoints)}},this);if(this._playbackAssociatedWithJoints){var i=this._playbackAssociatedWithJoints.getSequence();if(i){i._fireSequenceChanged()}}}return this};b.prototype.getRestTransformationWorld=function(t){const e=this.getCurrentView()?.getNodeInfos();var i;if(e){var n=new r.Matrix4;while(t){for(var a=0;a<e.length;a++){var o=e[a];if(o.target!==t){continue}var s;if(o.transform){s=R(o.transform)}else if(o[p.Scale]&&o[p.Rotate]&&o[p.Translate]){var l=new r.Vector3(o[p.Translate][0],o[p.Translate][1],o[p.Translate][2]);var u=new r.Quaternion(o[p.Rotate][0],o[p.Rotate][1],o[p.Rotate][2],o[p.Rotate][3]);var c=new r.Vector3(o[p.Scale][0],o[p.Scale][1],o[p.Scale][2]);s=(new r.Matrix4).compose(l,u,c)}if(s){n.premultiply(s)}break}t=t.parent}var h=new r.Vector3;var f=new r.Quaternion;var d=new r.Vector3;n.decompose(h,f,d);i={};i.translation=h.toArray();i.quaternion=f.toArray();i.scale=d.toArray()}if(!i){i=this.getTransformationWorld(t)}return i};b.prototype.getRestTransformation=function(t){const e=this.getCurrentView()?.getNodeInfos();var i;if(e){e.forEach(function(e){if(e.target!==t){return}if(e.transform){var n=new r.Vector3;var a=new r.Quaternion;var o=new r.Vector3;var s=R(e.transform);s.decompose(n,a,o);i={};i.translation=n.toArray();i.quaternion=a.toArray();i.scale=o.toArray()}else if(e[p.Scale]&&e[p.Rotate]&&e[p.Translate]){i={};i.translation=e[p.Translate].slice();i.quaternion=e[p.Rotate].slice();i.scale=e[p.Scale].slice()}})}if(!i&&t){i={};i.translation=t.userData.position?t.userData.position.toArray():t.position.toArray();i.quaternion=t.userData.quaternion?t.userData.quaternion.toArray():t.quaternion.toArray();i.scale=t.userData.scale?t.userData.scale.toArray():t.scale.toArray();i.matrix=t.matrix.clone()}return i};b.prototype._addToTransformation=function(t,e,i,n,a,o){var s={};var l;if(e){s.translation=[];for(l=0;l<3;l++){s.translation.push(e[l]+t.translation[l])}}else{s.translation=t.translation}if(n){s.scale=[];for(l=0;l<3;l++){s.scale.push(n[l]*t.scale[l])}}else{s.scale=t.scale}if(i){var u=new r.Quaternion(t.quaternion[0],t.quaternion[1],t.quaternion[2],t.quaternion[3]);var h=new r.Quaternion(i[0],i[1],i[2],i[3]);if(a===c.Euler){var f=o?o[3]:6;var d=g.threeQuatToNeutralEuler(u,f);var p=o?o:g.threeQuatToNeutralEuler(h,f);d[0]+=p[0];d[1]+=p[1];d[2]+=p[2];s.quaternion=g.glMatrixQuatToNeutral(g.neutralEulerToGlMatrixQuat(d))}else{var y=(new r.Matrix4).makeRotationFromQuaternion(u);var v=(new r.Matrix4).makeRotationFromQuaternion(h);y.premultiply(v);u.setFromRotationMatrix(y);s.quaternion=[u.x,u.y,u.z,u.w]}}else{s.quaternion=t.quaternion}return s};b.prototype.setInterpolatedRelativeValues=function(t,e){if(e.rtranslate){t.userData.offsetTranslation=e.rtranslate}else{t.userData.offsetTranslation=null}if(e.rscale){t.userData.offsetScale=e.rscale}else{t.userData.offsetScale=null}if(e.rrotate){t.userData.offsetQuaternion=e.rrotate;t.userData.originalRotationType=e.originalRotationType}else{t.userData.offsetQuaternion=null;t.userData.originalRotationType=null}if(e.Euler){t.userData.Euler=e.Euler}else{t.userData.Euler=null}if(e.ropacity!=null){t.userData.offsetOpacity=e.ropacity}else{t.userData.offsetOpacity=null}return this};b.prototype._setJointNodeMatrix=function(){if(this._jointCollection&&this._jointCollection.length>0){this._jointCollection.forEach(function(t){if(!t.node||!t.parent){return}var e=t.node;if(e.userData.skipUpdateJointNode){return}var i={};i.translation=t.translation.slice();i.scale=t.scale.slice();i.quaternion=t.quaternion.slice();var n=this._addToTransformation(i,e.userData.offsetTranslation,e.userData.offsetQuaternion,e.userData.offsetScale,e.userData.originalRotationType,e.userData.Euler);e.position.fromArray(n.translation);e.scale.fromArray(n.scale);e.quaternion.fromArray(n.quaternion);e.updateMatrix();var a=e.quaternion.clone();var o=new r.Matrix4;if(t.parent){t.parent.updateMatrixWorld();o=t.parent.matrixWorld.clone();e.matrixWorld.multiplyMatrices(t.parent.matrixWorld,e.matrix)}else{e.matrixWorld.copy(e.matrix)}var s=new r.Matrix4;if(e.parent){e.parent.updateWorldMatrix(true,false);s.copy(e.parent.matrixWorld);e.matrix.copy(e.parent.matrixWorld).invert().multiply(e.matrixWorld)}else{e.matrix.copy(e.matrixWorld)}e.matrix.decompose(e.position,e.quaternion,e.scale);var l=[e.scale.x,e.scale.y,e.scale.z];this._adjustQuaternionAndScale(o,s,a,e.quaternion,n.scale,l);e.scale.x=l[0];e.scale.y=l[1];e.scale.z=l[2];e.children.forEach(function(t){t.updateMatrixWorld(true)});if(t.nodesToUpdate){t.nodesToUpdate.forEach(function(t){if(t.matrixAutoUpdate){t.updateMatrix()}t.matrixWorld.multiplyMatrices(t.parent.matrixWorld,t.matrix)})}},this)}};b.prototype._getEndPropertyInLastPlayback=function(t,e){var i;var r=this.getCurrentView();if(!r){return i}var n=r.getPlaybacks();if(!n||!n.length){return i}for(var a=n.length-1;a>=0;a--){var o=n[a];var s=o.getSequence();if(s._convertedFromAbsolute){return i}i=o.getNodeBoundaryProperty(t,e,true);if(i){break}}return i};b.prototype._getEndPropertyInPreviousPlayback=function(t,e,i,r){var n;var a=this._getJointByChildNode(t);if(a&&!r){return n}var o=i.getSequence();if(o&&o._convertedFromAbsolute){return n}var s=this.getCurrentView();if(!s){return n}var l=s.getPlaybacks();for(var u=1;u<l.length;u++){var c=l[u];if(c!==i){continue}for(var h=u-1;h>=0;h--){var f=l[h];n=f.getNodeBoundaryProperty(t,e,true);if(n){break}}}return n};b.prototype._convertTracksToRelative=function(t,e){if(e&&t._conversionDoneForReversed||!e&&t._conversionDone){return this}t._convertedFromAbsolute=false;var i=this.getCurrentView();if(!i){return this}var n=t.getNodeAnimation();if(!n||!n.length){return this}var a=i.getNodeInfos();if(a){a.forEach(function(e){var i;for(var a=0;a<n.length;a++){if(e.target===n[a].nodeRef){i=n[a];break}}if(!i){return}var o=[0,0,0];var s=[1,1,1];var l=new r.Quaternion;var u=new r.Vector3;var c=new r.Vector3;if(e.transform){var h=R(e.transform);h.decompose(u,l,c);o=u.toArray();s=c.toArray()}else if(e[p.Scale]&&e[p.Rotate]&&e[p.Translate]){o=e[p.Translate].slice();l=new r.Quaternion(e[p.Rotate][0],e[p.Rotate][1],e[p.Rotate][2],e[p.Rotate][3]);s=e[p.Scale].slice()}else{e.target.matrix.decompose(u,l,c);o=u.toArray();s=c.toArray()}var f,d,v,_;var m=i[p.Translate];if(m&&m.getIsAbsoluteValue()){d=m.getKeysCount();for(f=0;f<d;f++){v=m.getKey(f);_=[v.value[0]-o[0],v.value[1]-o[1],v.value[2]-o[2]];m.updateKey(f,_,true)}m.setIsAbsoluteValue(false);t._convertedFromAbsolute=true}var A=i[p.Scale];if(A&&A.getIsAbsoluteValue()){d=A.getKeysCount();for(f=0;f<d;f++){v=A.getKey(f);_=[v.value[0]/s[0],v.value[1]/s[1],v.value[2]/s[2]];A.updateKey(f,_,true)}A.setIsAbsoluteValue(false);t._convertedFromAbsolute=true}var S=i[p.Opacity];if(S&&S.getIsAbsoluteValue()){var w=this.getRestOpacity(e.target);if(!w){w=1}d=S.getKeysCount();for(f=0;f<d;f++){v=S.getKey(f);_=v.value/w;S.updateKey(f,_,true)}S.setIsAbsoluteValue(false);t._convertedFromAbsolute=true}var C=i[p.Rotate];if(C&&C.getIsAbsoluteValue()){var b;var N=(new r.Matrix4).makeRotationFromQuaternion(l);var x=(new r.Matrix4).copy(N).invert();var T=new r.Matrix4;var V=new r.Matrix4;d=C.getKeysCount();var k=C.getKeysType();for(f=0;f<d;f++){v=C.getKey(f);if(k===y.Quaternion){b=new r.Quaternion(v.value[0],v.value[1],v.value[2],v.value[3]);T.makeRotationFromQuaternion(b);V.multiplyMatrices(T,x);b.setFromRotationMatrix(V);_=b.toArray();C.updateKey(f,_,true)}else if(k===y.Euler){var B=v.value;var E=g.threeQuatToNeutralEuler(l,B[3]);_=[B[0]-E[0]+g.getModulatedAngularValue(B[0]),B[1]-E[1]+g.getModulatedAngularValue(B[1]),B[2]-E[2]+g.getModulatedAngularValue(B[2]),B[3]];C.updateKey(f,_,true)}else if(f===0){var M=new r.Vector3(v.value[0],v.value[1],v.value[2]);T.makeRotationAxis(M,v.value[3]);V.multiplyMatrices(T,x);b=(new r.Quaternion).setFromRotationMatrix(V);_=this._convertQuaternionToAngleAxis(b);C.updateKey(f,_,true);break}}C.setIsAbsoluteValue(false);t._convertedFromAbsolute=true}}.bind(this))}if(!e){t._conversionDone=true;t._conversionDoneForReversed=false}else{t._conversionDone=false;t._conversionDoneForReversed=true}return this};b.prototype._getTrackKeys=function(t){var e=[];var i=t.getKeysCount();for(var r=0;r<i;r++){var n=t.getKey(r);var a;if(Array.isArray(n.value)){a=n.value.slice()}else{a=n.value}e.push({time:n.time,value:a})}return e};b.prototype._setJointNodeOffsets=function(t,e){var i=this._getJointByChildNode(t);if(i){var n=new r.Matrix4;if(t.parent){n=t.parent.matrixWorld.clone()}var a=new r.Matrix4;t.updateMatrixWorld();var o=new r.Matrix4;if(i.parent){i.parent.updateMatrixWorld();o=i.parent.matrixWorld.clone();a.copy(i.parent.matrixWorld).invert().multiply(t.matrixWorld)}else{a.copy(t.matrixWorld)}var s=new r.Vector3;var l=new r.Vector3;var u=new r.Quaternion;a.decompose(s,u,l);if(e===p.Translate){var c=s.toArray();t.userData.offsetTranslation=[c[0]-i.translation[0],c[1]-i.translation[1],c[2]-i.translation[2]]}else if(e===p.Scale){var h=l.toArray();this._adjustQuaternionAndScale(n,o,t.quaternion,u,t.scale.toArray(),h);t.userData.offsetScale=[h[0]/i.scale[0],h[1]/i.scale[1],h[2]/i.scale[2]]}else{this._adjustQuaternionAndScale(n,o,t.quaternion,u,t.scale.toArray(),l.toArray());var f=new r.Quaternion(i.quaternion[0],i.quaternion[1],i.quaternion[2],i.quaternion[3]);var d=(new r.Matrix4).makeRotationFromQuaternion(f);var y=(new r.Matrix4).copy(d).invert();var g=(new r.Matrix4).makeRotationFromQuaternion(u);var v=(new r.Matrix4).multiplyMatrices(g,y);var _=(new r.Quaternion).setFromRotationMatrix(v);t.userData.offsetQuaternion=_.toArray()}}return this};b.prototype.setTranslationKey=function(t,e,i,n){var a=i.getSequence();if(!a){return null}var o;var s=new r.Vector3;t.matrix.decompose(s,new r.Quaternion,new r.Vector3);var l=this._getJointByChildNode(t);if(l){o=l.translation.slice();t.updateMatrixWorld();var u=new r.Matrix4;if(l.parent){l.parent.updateMatrixWorld();u.copy(l.parent.matrixWorld).invert().multiply(t.matrixWorld)}else{u.matrix.copy(t.matrixWorld)}u.decompose(s,new r.Quaternion,new r.Vector3)}else{var c=this.getRestTransformation(t);o=c.translation}var h=s.toArray();var f=[h[0]-o[0],h[1]-o[1],h[2]-o[2]];var d=this._getEndPropertyInPreviousPlayback(t,p.Translate,i);if(d){f[0]-=d[0];f[1]-=d[1];f[2]-=d[2]}var g=a.getNodeAnimation(t,p.Translate);var v;if(!g){g=this._scene.createTrack(null,{trackValueType:y.Vector3,isAbsoluteValue:false});a.setNodeAnimation(t,p.Translate,g,true)}else{v=this._getTrackKeys(g)}g.insertKey(e,f,n);var _=this._getTrackKeys(g);return{KeyValue:f,absoluteValue:h,offset:d,PreviousTrack:v,CurrentTrack:_}};b.prototype._adjustQuaternionAndScale=function(t,e,i,n,a,o){function s(t,e,i,r){var n=Math.abs(t.dot(e));var a=Math.abs(t.dot(i));var o=Math.abs(t.dot(r));if(n>=a&&n>=o){return 0}else if(a>=n&&a>=o){return 1}else{return 2}}if(a[0]>0&&a[1]>0&&a[2]>0){return}var l=t.clone().multiply((new r.Matrix4).makeRotationFromQuaternion(i));var u=(new r.Matrix4).makeRotationFromQuaternion(n);var c=e.clone().multiply(u);var h=new r.Vector3;var f=new r.Vector3;var d=new r.Vector3;l.extractBasis(h,f,d);var p=[h,f,d];var y=new r.Vector3;var g=new r.Vector3;var v=new r.Vector3;c.extractBasis(y,g,v);var _=[1,1,1];for(var m=0;m<3;m++){var A=s(p[m],y,g,v);if(a[m]*o[A]<0){_[A]=-1;o[A]=-o[A]}}u.scale(new r.Vector3(_[0],_[1],_[2]));var S=(new r.Quaternion).setFromRotationMatrix(u);n.x=S.x;n.y=S.y;n.z=S.z;n.w=S.w};b.prototype.setScaleKey=function(t,e,i,n){var a=i.getSequence();if(!a){return null}var o;var s=t.scale.toArray();var l=t.quaternion.clone();var u=this._getJointByChildNode(t);if(u){var c=new r.Matrix4;if(t.parent){c=t.parent.matrixWorld.clone()}o=u.scale.slice();t.updateMatrixWorld();var h=new r.Matrix4;var f=new r.Matrix4;if(u.parent){u.parent.updateMatrixWorld();f=u.parent.matrixWorld.clone();h.copy(u.parent.matrixWorld).invert().multiply(t.matrixWorld)}else{h.copy(t.matrixWorld)}var d=new r.Quaternion;var g=new r.Vector3;h.decompose(new r.Vector3,d,g);var v=g.toArray();this._adjustQuaternionAndScale(c,f,l,d,s,v);s=v}else{var _=this.getRestTransformation(t);o=_.scale}var m=[s[0]/o[0],s[1]/o[1],s[2]/o[2]];var A=this._getEndPropertyInPreviousPlayback(t,p.Scale,i);if(A){m[0]/=A[0];m[1]/=A[1];m[2]/=A[2]}var S=a.getNodeAnimation(t,p.Scale);var w;if(!S){S=this._scene.createTrack(null,{trackValueType:y.Vector3,isAbsoluteValue:false});a.setNodeAnimation(t,p.Scale,S,true)}else{w=this._getTrackKeys(S)}S.insertKey(e,m,n);var C=this._getTrackKeys(S);return{KeyValue:m,absoluteValue:s,offset:A,PreviousTrack:w,CurrentTrack:C}};b.prototype.setRotationKey=function(t,e,i,n,a){var o=n.getSequence();if(!o){return null}var s=36;var l=[i[0],i[1],i[2],s];var u=o.getNodeAnimation(t,p.Rotate);if(u&&u.getKeysType()!==y.Euler){return null}var c;if(!u){u=this._scene.createTrack(null,{trackValueType:y.Euler,isAbsoluteValue:false});o.setNodeAnimation(t,p.Rotate,u,true)}else{c=this._getTrackKeys(u)}u.insertKey(e,l,a);var h=this._getTrackKeys(u);var f=new r.Quaternion;var d=new r.Euler(i[0],i[1],i[2]);f.setFromEuler(d);var g=this._getEndPropertyInPreviousPlayback(t,p.Rotate,n);if(g){var v=new r.Quaternion(g[0],g[1],g[2],g[3]);f.multiply(v)}var _=this._getJointByChildNode(t);var m=new r.Quaternion;if(_){m.fromArray(_.quaternion)}else{var A=this.getRestTransformation(t);m.fromArray(A.quaternion)}f.multiply(m);return{KeyValue:l,absoluteValue:f.toArray(),offset:g,PreviousTrack:c,CurrentTrack:h}};b.prototype.setAxisAngleRotationKey=function(t,e,i,r,n){var a=r.getSequence();if(!a){return null}var o=a.getNodeAnimation(t,p.Rotate);if(o&&o.getKeysType()!==y.AngleAxis){if(!o.setKeysType(y.AngleAxis)){return null}}var s=[i[0],i[1],i[2],i[3]];var l;if(!o){o=this._scene.createTrack(null,{trackValueType:y.AngleAxis,isAbsoluteValue:false});a.setNodeAnimation(t,p.Rotate,o,true)}else{l=this._getTrackKeys(o)}o.insertKey(e,s,n);var u=this._getTrackKeys(o);return{KeyValue:s,PreviousTrack:l,CurrentTrack:u}};b.prototype.getTotalOpacity=function(t){return t._vkGetTotalOpacity(this._jointCollection,this)};b.prototype.setTotalOpacity=function(t,e){var i=1;var r=this._getJointByChildNode(t);if(r&&r.parent){i=r.parent._vkGetTotalOpacity(this._jointCollection,this)}else if(t.parent){i=t.parent._vkGetTotalOpacity(this._jointCollection,this)}let n=this._getOpacity(t);if(i!==0){n=e/i}else{e=0}this.setOpacity(t,n);var a={changed:t,opacity:n};this.fireOpacityChanged(a);return{opacity:n,totalOpacity:e}};b.prototype.setOpacityKey=function(t,e,i,r){var n=i.getSequence();if(!n){return null}let a=this.getOpacity(t)??1;var o=this.getRestOpacity(t);if(!o&&n._convertedFromAbsolute){o=1}a/=o;var s=this._getEndPropertyInPreviousPlayback(t,p.Opacity,i);if(s){a/=s}var l=n.getNodeAnimation(t,p.Opacity);var u;if(!l){l=this._scene.createTrack(null,{trackValueType:y.Opacity});n.setNodeAnimation(t,p.Opacity,l,true)}else{u=this._getTrackKeys(l)}l.insertKey(e,a,r);var c=this._getTrackKeys(l);return{KeyValue:a,totalOpacity:this.getTotalOpacity(t),PreviousTrack:u,CurrentTrack:c}};w=function(){this._visibilityChanges=new Set};w.prototype.getInfo=function(t){var e=[];this._visibilityChanges.forEach(function(i){var r=t.createNodeProxy(i);var n=r.getVeId();t.destroyNodeProxy(r);if(n){e.push(n)}else{e.push(t.getScene().nodeRefToPersistentId(i))}});return e};w.prototype.clear=function(){this._visibilityChanges.clear()};w.prototype.trackNodeRef=function(t){if(this._visibilityChanges.has(t)){this._visibilityChanges.delete(t)}else{this._visibilityChanges.add(t)}};function V(t){while(!t.isScene){var e=t.userData.selectable;if(e!=null){return e}t=t.parent}return true}b.prototype.getSelectable=function(t){if(Array.isArray(t)){return t.map(V)}else{return V(t)}};b.prototype.setSelectable=function(t,e){if(!Array.isArray(t)){t=[t]}t.forEach(function(t){t.userData.selectable=e});return this};b.prototype.updateAssociatedMarkerMatrix=function(){var t=this._scene?this._scene.getSceneBuilder():null;if(t){let e=t.getAllNodesWithBoundMarkers();if(e){e.forEach((t,e)=>{const i=this._scene.persistentIdToNodeRef(e);if(i){var r=i.matrixWorld;t.forEach((t,e)=>{if(t.coordinateSpace!==this._scene.PoiCoordinateSpaces.ReferenceNodeSpace){return}const i=this._scene.persistentIdToNodeRef(e);if(i?.visible){const t=i.userData.treeNode?.transform;if(t){let e=R(t);e.premultiply(r);e.decompose(i.position,i.quaternion,i.scale);i.updateMatrix()}}})}})}}};b.prototype._getNodeState=function(t,e){const i=this._nodeStates;let r=i.get(t);if(r==null&&e){r={visible:null,originalVisible:null,selected:false,ancestorSelected:false,tintColor:null,ancestorTintColor:null,highlightColor:null,ancestorHighlightColor:null,opacity:null,ancestorOverridesOpacity:false,boundingBoxNode:null,material:null,material2:null,originalMaterial:null};i.set(t,r)}return r};b.prototype._deleteUnusedNodeStates=function(){const t=this._materialCache;this._nodeStates.forEach(function(e,i,r){if(e.visible==null&&!e.selected&&!e.ancestorSelected&&e.tintColor==null&&e.ancestorTintColor==null&&e.highlightColor==null&&e.ancestorHighlightColor==null&&e.opacity==null&&!e.ancestorOverridesOpacity){r.delete(i);if(e.material!=null){t.releaseMaterial(e.material)}if(e.material2!=null){t.releaseMaterial(e.material2)}}});return this};b.prototype._applyVisibilityNodeState=function(t,e){t.forEach(function(t,i){const r=e[i];const n=t.visible;const a=r!==n;const o=this._getNodeState(t,a);if(o){if(a){o.visible=r}else{o.visible=null}}},this)};b.prototype._applySelectionNodeState=function(t,e){if(e){t.forEach(function(t){this._selectedNodes.add(t);if(this._showSelectionBoundingBox){this._addBoundingBox(t)}const e=this._getNodeState(t,true);const i=B(e);e.selected=true;if(B(e)!==i){this._setNeedsMaterialUpdate(t)}if(!e.ancestorSelected){t.children.forEach(this._setAncestorSelectedRecursively.bind(this,true),this)}},this)}else{t.forEach(function(t){this._selectedNodes.delete(t);if(this._showSelectionBoundingBox){this._removeBoundingBox(t)}const e=this._nodeStates.get(t);if(e!=null){const i=B(e);e.selected=false;if(B(e)!==i){this._setNeedsMaterialUpdate(t)}if(!e.ancestorSelected){t.children.forEach(this._setAncestorSelectedRecursively.bind(this,false),this)}}},this)}return this};b.prototype._setAncestorSelectedRecursively=function(t,e){const i=this._getNodeState(e,t);if(i!=null&&i.ancestorSelected!==t){const r=B(i);i.ancestorSelected=t;if(B(i)!==r){this._setNeedsMaterialUpdate(e)}if(!i.selected){e.children.forEach(this._setAncestorSelectedRecursively.bind(this,t),this)}}return this};b.prototype._applyTintColorNodeState=function(t,e){t.forEach(function(t,i){const r=e[i];const n=this._getNodeState(t,r!=null);if(n!=null){n.tintColor=r;this._setNeedsMaterialUpdate(t);t.children.forEach(this._setAncestorTintColorRecursively.bind(this,r!=null?r:n.ancestorTintColor),this)}},this);return this};b.prototype._setAncestorTintColorRecursively=function(t,e){const i=this._getNodeState(e,t!=null);if(i!=null&&i.ancestorTintColor!==t){const r=M(i);i.ancestorTintColor=t;if(M(i)!==r){this._setNeedsMaterialUpdate(e)}if(i.tintColor==null){e.children.forEach(this._setAncestorTintColorRecursively.bind(this,t),this)}}return this};b.prototype._setAncestorHighlightColorRecursively=function(t,e){const i=this._getNodeState(e,t!=null);if(i!=null&&i.ancestorHighlightColor!==t){const r=O(i);i.ancestorHighlightColor=t;if(O(i)!==r){this._setNeedsMaterialUpdate(e)}if(i.highlightColor==null){e.children.forEach(this._setAncestorHighlightColorRecursively.bind(this,t),this)}}return this};b.prototype._applyOpacityNodeState=function(t,e){t.forEach(function(t,i){const r=e[i];const n=this._getNodeState(t,r!=null);if(n!=null){n.opacity=r;this._setNeedsMaterialUpdate(t);t.children.forEach(this._setAncestorOverridesOpacityRecursively.bind(this,r!=null),this)}},this);return this};b.prototype._setAncestorOverridesOpacityRecursively=function(t,e){const i=this._getNodeState(e,t);if(i!=null){i.ancestorOverridesOpacity=t;this._setNeedsMaterialUpdate(e);e.children.forEach(this._setAncestorOverridesOpacityRecursively.bind(this,i.opacity!=null||t),this)}return this};b.prototype._computeWorldOpacity=function(t,e){e??=this._nodeStates.get(t);const i=e?.opacity??t.userData.opacity??1;return t.parent?i*this._computeWorldOpacity(t.parent):i};b.prototype._setNeedsMaterialUpdate=function(t){if(t.material!=null){this._needsMaterialUpdate.add(t)}};function k(t,e,i,n){t.color.copy(e.color);t.emissive?.copy(e.emissive);t.specular?.copy(e.specular);t.userData.customColor=i.w>0;if(t.userData.customColor){const e=new r.Color(i.x,i.y,i.z);t.color.lerp(e,i.w);t.emissive?.lerp(e,i.w*.5);t.specular?.multiplyScalar(1-.5*i.w)}const a=t.transparent;t.opacity=n;t.transparent=n<1;t.needsUpdate=t.transparent!==a}b.prototype._updateNodeStateMaterials=function(){if(this._needsMaterialUpdate.size===0){return this}const e=this._materialCache;const i=o(this._highlightColorABGR);const n=new r.Vector4(i.red/255,i.green/255,i.blue/255,1);this._needsMaterialUpdate.forEach(function(a){t(a.material!=null,"Node should have a material to update its state");const s=this._nodeStates.get(a);if(s==null){return}const l=this._computeWorldOpacity(a,s);const u=new r.Vector4(0,0,0,0);const c=O(s);if(c!=null){u.fromArray(c)}const h=M(s);if(h!=null){const t=o(h);u.lerp(new r.Vector4(t.red/255,t.green/255,t.blue/255,1),t.alpha)}if(s.selected||s.ancestorSelected){s.material2??=e.cloneMaterial(a.material);k(s.material2,a.material,u,l);u.lerp(n,i.alpha)}s.material??=e.cloneMaterial(a.material);k(s.material,a.material,u,l);s.customMaterial=u.w>0||l<1},this);this._needsMaterialUpdate.clear();return this};b.prototype.applyNodeStates=function(t){this._updateNodeStateMaterials();this._nodeStates.forEach(function(e,i){if(e.material!=null&&e.customMaterial){e.originalMaterial=i.material;i.material=t&&(e.selected||e.ancestorSelected)?e.material2??e.material:e.material;i.userData.customMaterial=true}if(e.visible!=null){e.originalVisible=i.visible;i.visible=e.visible}})};b.prototype.revertNodeStates=function(){this._nodeStates.forEach(function(t,e){if(t.originalMaterial){e.material=t.originalMaterial;t.originalMaterial=null;e.userData.customMaterial=false}if(t.originalVisible!=null){e.visible=t.originalVisible;t.originalVisible=null}})};function B(e){t(e!=null,"Node state should not be null");return e.selected||e.ancestorSelected}function E(t,e){return e?.visible??t?.visible??false}function M(t){return t.tintColor||t.ancestorTintColor}function O(t){return t.highlightColor||t.ancestorHighlightColor}return b});
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/threejs/Viewport", ["../Core","../ViewportBase","../abgrToColor","sap/ui/core/Element","sap/ui/core/ResizeHandler","sap/ui/events/KeyCodes","../Loco","../thirdparty/three","../ViewStateManager","./ViewportGestureHandler","./OrthographicCamera","./PerspectiveCamera","./OutlineRenderer","../Messages","sap/ui/base/ManagedObjectObserver","../CameraProjectionType","../CameraFOVBindingType","../VisibilityMode","../ZoomTo","../SelectionMode","../RenderMode","../getResourceBundle","../cssColorToColor","../ViewStateManager","./ViewStateManager","./HitTester","./Scene","./ContentDeliveryService","./ThreeUtils","../Annotation","../measurements/Surface","../NodeContentType","../SelectionDisplayMode","sap/base/assert","sap/base/Log","../findIndexInArray","sap/base/i18n/Localization"],function(e,t,i,r,a,n,o,s,l,h,d,u,c,p,f,g,m,v,_,y,C,w,S,b,R,x,M,k,B,T,A,V,F,N,D,O,G){"use strict";s.ColorManagement.enabled=false;var L=t.extend("sap.ui.vk.threejs.Viewport",{metadata:{library:"sap.ui.vk",events:{cameraChanged:{parameters:{position:"float[]",quaternion:"float[]",zoom:"float"},enableEventBubbling:true},frameRenderingFinished:{}}}});var I=L.getMetadata().getParent().getClass().prototype;s.PropertyBinding.prototype.GetterByBindingType[0]=function(e,t){e[t]=this.targetObject[this.propertyName]};L.prototype.init=function(){if(I.init){I.init.call(this)}this._measurementSurface=new A;this._renderer=null;this._totalGpuAllocated=0;this._totalGpuUpdated=0;this._imageCanvas=null;this._canvas=null;this._registryEntry=null;this._width=1;this._height=1;this._resizeListenerId=null;this._handleResize=this._handleResize.bind(this);this._renderLoopRequestId=0;this._renderLoop=this._renderLoop.bind(this);this._shouldProcessHierarchy=true;this._shouldDoTraversalRendering=false;this._clippingPlanes=[];this._hitTester=new x;this._scene=null;this._camera=new u;this._upAxis=2;var t=new s.Vector4;var i=new s.Vector4;this._updateColor(t,this.getBackgroundColorTop());this._updateColor(i,this.getBackgroundColorBottom());this._checkBackgroundColor();this._backgroundMaterial=new s.ShaderMaterial({uniforms:{topColor:{value:t},bottomColor:{value:i}},vertexShader:["varying float vPos;","void main() {","\tgl_Position = vec4(position, 1.0);","\tvPos = position.y * -0.5 + 0.5;","}"].join("\n"),fragmentShader:["uniform vec4 topColor;","uniform vec4 bottomColor;","varying float vPos;","void main() {","\tgl_FragColor = mix(topColor, bottomColor, vPos);","}"].join("\n"),side:s.DoubleSide,depthTest:false,depthWrite:false,blending:s.NoBlending});this._backgroundCamera=new s.Camera;this._backgroundScene=new s.Scene;this._backgroundScene.add(new s.Mesh(new s.PlaneGeometry(2,2,1,1),this._backgroundMaterial));this._underlayGroup=new s.Group;this._overlayGroup=new s.Group;this._outlineRenderer=new c(1);this._showPMI=true;this._xrayColor1=new s.Vector4(0,.75,1,.45);this._xrayColor2=new s.Vector4(0,0,1,0);this._xrayMaterial=new s.ShaderMaterial({uniforms:{color1:{value:this._xrayColor1},color2:{value:this._xrayColor2}},vertexShader:["#include <clipping_planes_pars_vertex>","varying vec3 vNormal;","void main() {","#include <beginnormal_vertex>","#include <defaultnormal_vertex>","#include <begin_vertex>","#include <project_vertex>","#include <clipping_planes_vertex>","\tvNormal = normalize( transformedNormal );","}"].join("\n"),fragmentShader:["#include <clipping_planes_pars_fragment>","uniform vec4 color1;","uniform vec4 color2;","varying vec3 vNormal;","void main() {","#include <clipping_planes_fragment>","\tgl_FragColor = mix(color1, color2, abs(normalize(vNormal).z));","}"].join("\n"),side:s.DoubleSide,depthWrite:false,depthFunc:s.LessDepth,blending:s.NormalBlending,clipping:true,transparent:true});this._viewportGestureHandler=new h(this);this._loco=new o(this);this._loco.addHandler(this._viewportGestureHandler,-1);this._zoomedObject=null;this._cdsLoader=null;this.attachCameraChanged(function(e){this.setShouldRenderFrame(true)});this._sceneObserver=new f(this.setShouldRenderFrame.bind(this));this._currentViewIndex=0;this._currentView=null;e.getEventBus().subscribe("sap.ui.vk","viewStateApplied",this._onViewStateApplied,this);G.attachChange(this._onLocalizationChanged.bind(this))};L.prototype.cameraUpdateCompleted=function(e){this.fireViewFinished({viewIndex:this._currentViewIndex})};L.prototype.exit=function(){this._stopRenderLoop();G.detachChange(this._onLocalizationChanged);e.getEventBus().unsubscribe("sap.ui.vk","viewStateApplied",this._onViewStateApplied,this);this._loco.removeHandler(this._viewportGestureHandler);this._viewportGestureHandler.destroy();if(this._resizeListenerId){a.deregister(this._resizeListenerId);this._resizeListenerId=null}var t=this.getTools();for(var i=0;i<t.length;i++){var n=r.getElementById(t[i]);if(n){n.setActive(false)}}this._measurementSurface.destroy();this._measurementSurface=null;this._setContent(null);this.setCamera(null);this._outlineRenderer?.dispose();this._outlineRenderer=null;this._backgroundCamera=null;this._backgroundMaterial=null;this._backgroundScene=null;this._loco.destroy();this._loco=null;this._viewportGestureHandler=null;this._cameraLight=null;this._hitTester=null;this._imageCanvas=null;if(this._cdsLoader){this._cdsLoader.detachSceneUpdated(this._handleCdsSceneUpdate,this)}if(I.exit){I.exit.call(this)}};L.prototype._onLocalizationChanged=function(e){var t=this._measurementSurface;if(t&&t.getMeasurements().length>0){t.update(this,this.getCamera())}};L.prototype.onSetViewStateManager=function(e){this._viewStateManager=e;e.attachVisibilityChanged(this._onVisibilityChanged,this);e.attachOpacityChanged(this.setShouldRenderFrame,this);e.attachTintColorChanged(this.setShouldRenderFrame,this);e.attachHighlightColorChanged(this.setShouldRenderFrame,this);e.attachTransformationChanged(this.setShouldRenderFrame,this);e.attachOutlineColorChanged(this.setShouldRenderFrame,this);e.attachOutlineWidthChanged(this.setShouldRenderFrame,this);e.attachOutliningChanged(this._onOutliningOrSelectionChanged,this);e.attachSelectionChanged(this._onOutliningOrSelectionChanged,this)};L.prototype.onUnsetViewStateManager=function(e){e.detachOutliningChanged(this._onOutliningOrSelectionChanged,this);e.detachSelectionChanged(this._onOutliningOrSelectionChanged,this);e.detachVisibilityChanged(this._onVisibilityChanged,this);e.detachOpacityChanged(this.setShouldRenderFrame,this);e.detachTintColorChanged(this.setShouldRenderFrame,this);e.detachHighlightColorChanged(this.setShouldRenderFrame,this);e.detachTransformationChanged(this.setShouldRenderFrame,this);e.detachOutlineColorChanged(this.setShouldRenderFrame,this);e.detachOutlineWidthChanged(this.setShouldRenderFrame,this);this._viewStateManager=null};L.prototype._startRenderLoop=function(){if(this._renderLoopRequestId===0){this._renderLoopRequestId=window.requestAnimationFrame(this._renderLoop)}return this};L.prototype._stopRenderLoop=function(){if(this._renderLoopRequestId!==0){window.cancelAnimationFrame(this._renderLoopRequestId);this._renderLoopRequestId=0}return this};L.prototype.setBackgroundColorTop=function(e){I.setBackgroundColorTop.call(this,e);if(this._backgroundMaterial!==null){this._updateColor(this._backgroundMaterial.uniforms.topColor.value,e);this._checkBackgroundColor()}return this};L.prototype.setBackgroundColorBottom=function(e){I.setBackgroundColorBottom.call(this,e);if(this._backgroundMaterial!==null){this._updateColor(this._backgroundMaterial.uniforms.bottomColor.value,e);this._checkBackgroundColor()}return this};L.prototype.setClippingPlanes=function(e){this._clippingPlanes=e;return this};L.prototype.onBeforeRendering=function(){if(this._resizeListenerId){a.deregister(this._resizeListenerId);this._resizeListenerId=null}this._stopRenderLoop()};L.prototype.onAfterRendering=function(){var e=this.getDomRef();if(this._canvas){e.append(this._canvas)}e.append(this._measurementSurface.getDomRef());this._resizeListenerId=a.register(this,this._handleResize);this._handleResize({size:{width:e.clientWidth,height:e.clientHeight}});this._startRenderLoop()};L.prototype._handleResize=function(e){if(!this._camera||!this._renderer){return false}if(this.getSafeArea()){this.getSafeArea().resize()}var t=e.size.width;var i=e.size.height;this._width=t;this._height=i;if(this._camera){this._camera.update(t,i)}var r=this._canvas;var a=this._renderer.domElement;if(r!==a){var n=window.devicePixelRatio;r.width=Math.floor(t*n);r.height=Math.floor(i*n);r.style.width=t+"px";r.style.height=i+"px"}K(this._registryEntry);var o=this._measurementSurface.getDomRef();o.style.width=t+"px";o.style.height=i+"px";this.fireResize({size:{width:t,height:i}});this.setShouldRenderFrame(true);return true};L.prototype.setScene=function(e){return this._setScene(e)};L.prototype._setScene=function(e){var t;if(this._scene){t=this._scene.getDefaultNodeHierarchy();t.detachNodeRemoving(this._onNodeRemoving,this);t.detachNodeCreated(this._onNodeCreated,this);Y(this,this._scene)}this._scene=e;this._homeCamera=null;this._currentViewIndex=0;this._currentView=null;this._sceneObserver.disconnect();var i=this._getNativeScene();if(i){this._sceneObserver.observe(this._scene,{properties:["doubleSided"]});this._backgroundNode=this._findBackgroundNode();var r;for(var a=0;a<i.children.length;a++){r=i.children[a];if(r.private&&r.userData.defaultLights&&r.children.length&&r.children[0].isDirectionalLight){this._cameraLight=r.children[0]}}}if(this._scene){t=this._scene.getDefaultNodeHierarchy();t.attachNodeCreated(this._onNodeCreated,this);t.attachNodeRemoving(this._onNodeRemoving,this)}if(this._scene){var n=this._scene.getInitialView();if(n&&this._getViewStateManagerThreeJS()){this.activateView(n,false,true)}}this._clearAnnotations(true);this.setShouldRenderFrame();return this};L.prototype.getScene=function(){return this._scene};L.prototype._getNativeScene=function(){return this._scene?this._scene.getSceneRef():null};L.prototype._getNativeCamera=function(){return this._camera?this._camera.getCameraRef():null};L.prototype._clearAnnotations=function(e){if(e){this.destroyAnnotations()}else{this.getAnnotations().forEach(function(e){if(e.autoGenerated){this.removeAnnotation(e);e.destroy()}},this)}this._annotationsCreated=false};L.prototype._onNodeCreated=function(e){var t=e.getParameter("nodeRef");if(t._vkGetNodeContentType()==V.Annotation){var i=this.getCurrentView();if(i){i.getNodeInfos().push({target:t,visible:true,annotationId:t.userData.treeNode.annotationId})}const e=this._getViewStateManagerThreeJS();var r=this._scene&&this._scene._getAnnotations();if(r){r.forEach(function(i){if(i.node===t){var r=T.createAnnotation(i,this);r.autoGenerated=true;this.addAnnotation(r);r.setDisplay(e?.getVisibilityState(t)??t.visible)}},this)}}};L.prototype._onNodeRemoving=function(e){var t=e.getParameter("nodeRef");if(t._vkGetNodeContentType()===V.Annotation){this.getAnnotations().forEach(function(e){if(e.getNodeRef()===t){this.removeAnnotation(e);e.destroy()}},this)}};L.prototype.setCamera=function(e){if(I.setCamera){I.setCamera.call(this,e)}var t=this.getCamera();if(t&&this._renderer){t.update(this._width,this._height);if(!this._homeCamera&&t.getCameraRef()&&!t._dummyCamera){this._homeCamera=t.getCameraRef().clone()}}this.setShouldRenderFrame(true);return this};L.prototype.getRenderer=function(){return this._renderer};L.prototype._getViewStateManagerThreeJS=function(){if(this._viewStateManager){if(this._viewStateManager instanceof R){return this._viewStateManager}if(this._viewStateManager instanceof b&&this._viewStateManager._implementation instanceof R){return this._viewStateManager._implementation}}return null};L.prototype._updateColor=function(e,t){var i=S(t);e.color=new s.Color(i.red/255,i.green/255,i.blue/255);e.alpha=i.alpha;e.x=e.color.r*e.alpha;e.y=e.color.g*e.alpha;e.z=e.color.b*e.alpha;e.w=e.alpha};L.prototype._checkBackgroundColor=function(){var e=this.getBackgroundColorTop();if(e===this.getBackgroundColorBottom()){if(this._backgroundColor===null){this._backgroundColor=new s.Vector4}this._updateColor(this._backgroundColor,e)}else{this._backgroundColor=null}this.setShouldRenderFrame(true)};L.prototype._handleCdsSceneUpdate=function(){this.setShouldRenderFrame()};L.prototype.setShouldRenderFrame=function(e){if(e!==true){this._shouldProcessHierarchy=true}this._startRenderLoop();return this};L.prototype.shouldRenderFrame=function(){return this._renderLoopRequestId!==0};L.prototype.setRenderMode=function(e){this.setProperty("renderMode",e,true);if(this._scene){switch(e){case C.LineIllustration:case C.ShadedIllustration:case C.SolidOutline:this._scene._createOutlineGeometry(e);break;default:this._scene._hideOutlineGeometry();break}}this.setShouldRenderFrame(false);return this};L.prototype.hitTest=function(e,t,i){var r=this._getNativeScene();var a=this._getNativeCamera();if(!a||!r){return null}var n=this._getViewStateManagerThreeJS();n?.applyNodeStates?.();try{var o=this._canvas;return this._hitTester.hitTest(e-o.clientLeft,t-o.clientTop,o.clientWidth,o.clientHeight,this._renderer,r,a,this._clippingPlanes,i)}finally{n?.revertNodeStates?.()}};L.prototype._isRedlineActivated=function(){var e=this._getNativeCamera();return e?e.userData.isRedlineActivated:false};var P={sphere:"spherical",plane:"planar"};L.prototype._findBackgroundNode=function(){var e=this._getNativeScene();const t=this._getViewStateManagerThreeJS();if(e==null||t==null){return null}var i=function(e){for(var r=0;r<e.length;r++){var a=e[r];if(a._vkGetNodeContentType()===V.Background&&t.getVisibilityState(a)===true&&(a.name==="plane"||a.name==="sphere")){if(a.parent.name==="Background"&&t.getVisibilityState(a.parent)===false){return null}return a}else{var n=i(a.children);if(n!=null){return n}}}return null};return i(e.children)};L.prototype._onVisibilityChanged=function(){this._backgroundNode=this._findBackgroundNode();this.setShouldRenderFrame()};L.prototype.getBackgroundProjection=function(){return P[this._backgroundNode&&this._backgroundNode.name]};L.prototype._isPanoramicActivated=function(){return this.getBackgroundProjection()==="spherical"};L.prototype._isPlanarActivated=function(){return this.getBackgroundProjection()==="planar"};L.prototype.tap=function(e,t,i){if(!i){if(this._viewStateManager){var r=this.hitTest(e,t);var a=r&&r.object;this.tapObject(a);if(a!==null){this.fireNodeClicked({nodeRef:a,x:e,y:t},true,true)}}}else if(!this.getFreezeCamera()){var n=this.hitTest(e,t);if(n&&(this._zoomedObject===null||this._zoomedObject!==n.object)){this._zoomedObject=n.object;this._viewportGestureHandler.zoomObject(this._zoomedObject,true)}else{this._viewportGestureHandler.zoomObject(this._zoomedObject,false);this._zoomedObject=null}}return this};L.prototype.tapObject=function(e){var t={picked:e?[e]:[]};this.fireNodesPicked(t);if(e&&e._vkGetNodeContentType()===V.Background){this.exclusiveSelectionHandler([]);return this}if(this.getSelectionMode()===y.Exclusive){this.exclusiveSelectionHandler(t.picked)}else if(this.getSelectionMode()===y.Sticky){this.stickySelectionHandler(t.picked)}return this};var E={x:-2,y:-2};var z=2;var U=5;L.prototype.onkeydown=function(e){if(!e.isMarked()){var t;switch(e.keyCode){case n.ARROW_LEFT:case n.ARROW_RIGHT:case n.ARROW_UP:case n.ARROW_DOWN:if(e.ctrlKey||e.altKey||e.metaKey){break}var i={x:0,y:0};switch(e.keyCode){case n.ARROW_LEFT:i.x=-1;break;case n.ARROW_RIGHT:i.x=+1;break;case n.ARROW_UP:i.y=-1;break;case n.ARROW_DOWN:i.y=+1;break;default:break}t=this._viewportGestureHandler._cameraController;t.beginGesture(E.x,E.y);if(e.shiftKey){t.pan(U*i.x,U*i.y)}else{t.rotate(z*i.x,z*i.y,true)}t.endGesture();this.setShouldRenderFrame(true);e.preventDefault();e.stopPropagation();break;case 189:case n.PLUS:case n.NUMPAD_MINUS:case n.NUMPAD_PLUS:t=this._viewportGestureHandler._cameraController;t.beginGesture(this.$().width()/2,this.$().height()/2);t.zoom(e.keyCode===n.PLUS||e.keyCode===n.NUMPAD_PLUS?1.02:.98);t.endGesture();this.setShouldRenderFrame(true);e.preventDefault();e.stopPropagation();break;default:break}}};L.prototype._onOutliningOrSelectionChanged=function(e){var t=this.getTools();for(var i=0;i<t.length;i++){var a=r.getElementById(t[i]);var n=a.getGizmoForContainer(this);if(n&&n.handleSelectionChanged){n.handleSelectionChanged(e)}}this.setShouldRenderFrame()};L.prototype.setSelectionRect=function(e){this.setShouldRenderFrame();if(!e){this._selectionRect=null;return}var t=e.x1/this._width*2-1;var i=e.y1/this._height*-2+1;var r=e.x2/this._width*2-1;var a=e.y2/this._height*-2+1;var n=[t,a,-1,r,a,-1,r,i,-1,t,i,-1];if(!this._selectionRect){var o=new s.BufferGeometry;o.setAttribute("position",new s.Float32BufferAttribute(n,3));this._selectionRect=new s.LineLoop(o,new s.LineBasicMaterial({color:12632064,linewidth:window.devicePixelRatio}))}else{var l=this._selectionRect.geometry.getAttribute("position");l.array.set(n);l.needsUpdate=true}};L.prototype.isViewport3D=function(){return this.getMetadata().getName()==="sap.ui.vk.threejs.Viewport"};L.prototype.isView3D=function(){var e=this.getCurrentView&&this.getCurrentView();var t=e&&e.getDimension();return this.isViewport3D()&&!this._redlineHandler&&!this._isPlanarActivated()&&t!==2};L.prototype._renderLoop=function(){this._renderLoopRequestId=0;if(!this._renderer||!this.getDomRef()){return}let e=false;if(this._viewportGestureHandler?.animateCameraUpdate()){e=true}if(this.getCamera()?.getIsModified()){this.getCamera().setIsModified(false);e=true}const t=this._getViewStateManagerThreeJS();if(t!=null){if(t._playTransition()||t._playHighlight()){e=true}}if(this.getAutoStartRendering()){if(t!=null){t._setJointNodeMatrix();const e=this.isView3D();const i=this.isViewport3D()&&this._isPanoramicActivated();if(e&&!i){t.updateAssociatedMarkerMatrix()}}this.render();for(const e of this.getAnnotations()){e.update()}this._measurementSurface.update(this,this.getCamera())}if(e){this.setShouldRenderFrame()}};function j(e,t,i,r,a){var n=new s.Vector2(r._width,r._height);var o=r.getBackgroundProjection();let l=false;e.userData??={};e.userData.outputSettings=r._outputSettings;i.children.forEach(function(i){if(i.userData._vkDynamicObjects){i.userData._vkDynamicObjects.forEach(function(i){if(i.parent){i._vkUpdate(e,t,n,o,a);l=true}})}});return l}function H(e,t,i,r,a){i.children.forEach(function(n){if(n.userData._vkDetailViews){n.userData._vkDetailViews.sort(function(e,t){return e.renderOrder-t.renderOrder});n.userData._vkDetailViews.forEach(function(n){if(n.node.visible){n.detailView._render(e,t,i,r,a)}})}})}const W=(new s.Matrix4).elements;function J(e,t){const i=e.userData.renderGroup?.clusterIndex;if(i!==undefined){const r=t[i];if(r.isPoints&&e.matrixWorld.elements.some((e,t)=>e!==W[t])){return true}}return e.children.some(e=>J(e,t))}L.prototype._setPointCloudTransformationDisabled=function(e){this._disablePointCloudTransformation=e;this.setShouldRenderFrame();var t=this._getNativeScene();return e&&t?.userData.geometryClusters&&J(t,t.userData.geometryClusters)};L.prototype._prepareForRenderingRecursive=function(e,t,i,r,a,n,o,s){if(e.visible===false||s&&e._vkGetNodeContentType()===V.PMI){if(r){B.removeNodeFromClusterRenderingRecursive(e,r,a)}return}if(e.userData.renderStage){(e.userData.renderStage<0?this._underlayGroup:this._overlayGroup).children.push(e);if(!o&&r){o=true;B.removeNodeFromClusterRenderingRecursive(e,r,a)}}e.matrixAutoUpdate=false;if(e.matrixWorldNeedsUpdate||n){if(e.parent===null){e.matrixWorld.copy(e.matrix)}else{e.matrixWorld.multiplyMatrices(e.parent.matrixWorld,e.matrix)}e.matrixWorldNeedsUpdate=true;n=true}if(!o){B.updateNodeClusterRenderingInfo(e,t,i,r,a,this._disablePointCloudTransformation)}var l=e.children;for(var h=0,d=l.length;h<d;h++){this._prepareForRenderingRecursive(l[h],t,i,r,a,n,o,s)}};function q(e,t){e.children.forEach(function(e){if(!e.userData.defaultLights){e.visible=t}})}function Q(e,t){if(e?.isDirectionalLight&&t){t.updateMatrixWorld();e.position.setFromMatrixColumn(t.matrixWorld,2);e.updateMatrix();e.updateMatrixWorld(true)}}L.prototype.render=function(){var e=this._renderer;if(!e){return}var t=performance.now();var i=this._getViewStateManagerThreeJS();i?.applyNodeStates?.(this.getSelectionDisplayMode()===F.Outline);try{e.setViewport(0,0,this._canvas.width/window.devicePixelRatio,this._canvas.height/window.devicePixelRatio);var a=this._getNativeScene();var n=this._getNativeCamera();if(!a||!n){return}var o=a.userData;var l=this.getScene();Q(this._cameraLight,n);if(o.pointScale){this._renderer.pointScale=o.pointScale}var h=o.geometryClusters;var d=h?o.instanceDataTexture:null;var u=d?d.image.data:null;var c=B.prepareTextureUpdateResults(h?h.length:0,o.textureUpdateResults);o.textureUpdateResults=null;var p=new Float32Array(20);var f=performance.now();var g=false;const te=this._showPMI===false;if(this._shouldProcessHierarchy){this._shouldProcessHierarchy=false;g=true;this._underlayGroup.children.length=0;this._overlayGroup.children.length=0;if(h){B.initClustersBeforeProcessingHierarchy(h)}this._prepareForRenderingRecursive(a,h,p,u,c,false,false,te);this._shouldDoTraversalRendering=c[2]===1;if(this._underlayGroup.children.length>0||this._overlayGroup.children.length>0){for(let e=0,t=a.children.length;e<t;++e){const t=a.children[e];if(t.userData.defaultLights){if(this._underlayGroup.children.length>0){this._underlayGroup.children.push(t)}if(this._overlayGroup.children.length>0){this._overlayGroup.children.push(t)}}}}}var m=performance.now();a.matrixWorldAutoUpdate=false;o.doTraversalRendering=this._shouldDoTraversalRendering;var v=performance.now();if(d&&c[1]>=c[0]){B.processUpdatedDataTexture(d,c[0],c[1]+1);B.computeClusterBoundingBoxes(h,u,a,c)}var _=h?B.prepareClustersForGpuUpload(h):0;var y=performance.now();var w=this.getTools();var S,b,R,x;const ie=j(e,n,a,this,i);const re=ie&&(n.near<=0||n.far<=0);if(i&&(g||ie)){i._updateBoundingBoxes()}var M=performance.now();var k=M;if(this._camera.getUsingDefaultClipPlanes()||n.isOrthographicCamera&&n.zoom<=0){x=l._computeBoundingBox(true,false,true);if(i){i._expandBoundingBoxWithSelected(x)}k=performance.now();if(re&&x.isEmpty()){x=l._computeBoundingBox(false,false,true)}if(!x.isEmpty()){if(n.isOrthographicCamera&&n.zoom<=0){this._camera.adjustZoom(x)}if(this._camera.getUsingDefaultClipPlanes()){for(S=0;S<w.length;S++){b=r.getElementById(w[S]);R=b.getGizmoForContainer(this);if(R&&R.expandBoundingBox){R.expandBoundingBox(x)}}this._camera.adjustClipPlanes(x)}if(re){j(e,n,a,this,i)}var T=new s.Vector3;x.getSize(T);var A=this._camera._nativeCamera.position;var V,N,O;for(var G=0;G<3;++G){O=Math.abs(T.getComponent(G));if(!G||O>V){V=O}O=Math.abs(A.getComponent(G));if(!G||O>N){N=O}}if(N/V>100&&!o.totalPointCount){o.useGeometryClusters=false}}}e.autoClear=false;if(this._backgroundColor!==null){e.setClearColor(this._backgroundColor.color,this._backgroundColor.alpha);e.clear(true,true,false)}else{e.render(this._backgroundScene,this._backgroundCamera);e.clearDepth()}if(this._underlayGroup.children.length>0){e.render(this._underlayGroup,n);e.clearDepth();q(this._underlayGroup,false)}q(this._overlayGroup,false);e.clippingPlanes=this._clippingPlanes;switch(this.getRenderMode()){case C.XRay:if(i){var L=a.children[a.children.length-1].clone();i._selectedNodes.forEach(function(t){if(t.visible){t.add(L);e.render(t,n);t.remove(L)}})}this._xrayMaterial.specularMap=d;a.overrideMaterial=this._xrayMaterial;break;default:break}var I=performance.now();e.render(a,n);var P=performance.now();var E=e.info.render;var z=E.frame;var U={calls:a.userData.doTraversalRendering?-E.calls:E.calls,tris:E.triangles,tMatrix:(m-f).toFixed(1),tBBox:(k-M).toFixed(1),tRender:(P-I).toFixed(1),tTexture:(y-v).toFixed(1),lines:E.lines,points:E.points,vramAllocated:E.vramAllocated,vramUpdated:E.vramUpdated};e.clippingPlanes=[];a.overrideMaterial=null;if(this.getShowSelectionBoundingBoxes()&&i){var W=i._boundingBoxesScene;if(W){e.render(W,n)}}if(this._overlayGroup.children.length>0){q(this._overlayGroup,true);e.clearDepth();e.render(this._overlayGroup,n)}q(this._underlayGroup,true);H(e,n,a,x,this._cameraLight);if(i?._outlinedNodes.size>0){this._renderOutline(a,n,Array.from(i._outlinedNodes),i._outlineColorABGR,i)}if(this.getSelectionDisplayMode()===F.Outline&&i?._selectedNodes.size>0){this._renderOutline(a,n,Array.from(i._selectedNodes),i._highlightColorABGR,i)}for(S=0;S<w.length;S++){b=r.getElementById(w[S]);R=b.getGizmoForContainer(this);if(R&&R.render){R.render(this)}}if(this._selectionRect){e.render(this._selectionRect,this._backgroundCamera)}var J=this._registryEntry.webGLRenderer.domElement;var X=this._canvas;if(X!==J){var Z=X.getContext("2d");var Y=X.width;var K=X.height;Z.drawImage(J,0,J.height-K,Y,K,0,0,Y,K)}var $=performance.now();var ee="";if(U.vramAllocated>0){this._totalGpuAllocated+=U.vramAllocated;ee+=", allocated="+(U.vramAllocated/1048576).toFixed(1)+"MB ("+(this._totalGpuAllocated/1048576).toFixed(1)+"MB total)"}if(U.vramUpdated>0){this._totalGpuUpdated+=U.vramUpdated;ee+=", updated="+(U.vramUpdated/1048576).toFixed(1)+"MB ("+(this._totalGpuUpdated/1048576).toFixed(1)+"MB total)"}if(_>0){ee+=", partialClusters="+_}D.debug("Frame #"+z+": "+($-t).toFixed(1)+"ms","Calls="+U.calls+", Tris="+U.tris+", tMatrix="+U.tMatrix+", tBBox="+U.tBBox+", tRender="+U.tRender+", tTexture="+U.tTexture+", lines="+U.lines+", points="+U.points+ee)}finally{i?.revertNodeStates?.()}this.fireFrameRenderingFinished()};L.prototype._renderOutline=function(e,t,r,a,n){const o=i(a);const l=new s.Color(o.red/255,o.green/255,o.blue/255);this._outlineRenderer.render(this._renderer,e,t,r,l,n.getOutlineWidth(),n._jointCollection)};L.prototype.getImage=function(e,t,i,r,a){var n=this._getNativeScene();if(!n){return null}e=Math.min(e||16,2048);t=Math.min(t||16,2048);this._imageCanvas=this._imageCanvas||document.createElementNS("http://www.w3.org/1999/xhtml","canvas");var o=B.createWebGLImageRenderer(this._imageCanvas,e,t);var s=this.getBackgroundColorTop();var l=this.getBackgroundColorBottom();if(i&&!r){o.setClearColor(i,1)}else if(!i&&r){o.setClearColor(r,1)}else{if(i&&r){this.setBackgroundColorTop(i);this.setBackgroundColorBottom(r)}o.render(this._backgroundScene,this._backgroundCamera);o.autoClear=false}document.body.appendChild(o.domElement);var h=this.getCamera();var c=h instanceof u?new u:new d;c.getCameraRef().copy(h.getCameraRef());c.update(e,t);Q(this._cameraLight,c.getCameraRef());var p=[];var f=this._getViewStateManagerThreeJS();if(!a){if(f!==null){f.enumerateSelection(function(e){p.push(e)});f.setSelectionStates([],p,false,true)}}var g=n.userData.useGeometryClusters;n.userData.useGeometryClusters=false;o.render(n,c.getCameraRef());n.userData.useGeometryClusters=g;var m=o.getContext().canvas.toDataURL();if(f!==null&&p.length>0){f.setSelectionStates(p,[],false,true)}document.body.removeChild(o.domElement);o.dispose();if(l&&i){this.setBackgroundColorBottom(l)}if(s&&r){this.setBackgroundColorTop(s)}return m};L.prototype.getMaterialImage=function(e,t,i,r,a,n){t=s.MathUtils.clamp(t||256,8,2048);i=s.MathUtils.clamp(i||256,8,2048);this._imageCanvas=this._imageCanvas||document.createElementNS("http://www.w3.org/1999/xhtml","canvas");var o=B.createWebGLImageRenderer(this._imageCanvas,t,i);var l=this.getBackgroundColorTop();var h=this.getBackgroundColorBottom();if(r&&!a){o.setClearColor(r,1)}else if(!r&&a){o.setClearColor(a,1)}else if(r&&a){this.setBackgroundColorTop(r);this.setBackgroundColorBottom(a);o.render(this._backgroundScene,this._backgroundCamera);o.autoClear=false}else{o.setClearColor("#000000",0)}document.body.appendChild(o.domElement);var u=new d;var c=u.getCameraRef();u.update(t,i);var p=new s.SphereGeometry(1,64,32);var f=new s.Mesh(p);var g=new s.Box3;f._expandBoundingBox(g,false,false,false);c._vkZoomTo(g,n);u.adjustClipPlanes(g);const m=new s.DirectionalLight(16777215,Math.PI);Q(m,c);f.add(m);var v=Array.isArray(e)?e:[e];var _=[];for(var y in v){f.material=v[y];o.render(f,c);_.push(o.getContext().canvas.toDataURL())}f.remove(m);document.body.removeChild(o.domElement);o.dispose();if(h&&r){this.setBackgroundColorBottom(h)}if(l&&a){this.setBackgroundColorTop(l)}return Array.isArray(e)?_:_[0]};L.prototype.getObjectImage=function(e,t,i,r,a,n,o){return this.getObjectImageEx(e,t,i,r,a,{quaternion:n,margin:o,includeOverlay:true})};L.prototype.getObjectImageEx=function(e,t,i,r,a,n){var o=this._getNativeScene();if(!o){return null}n=n||{};t=s.MathUtils.clamp(t||256,8,2048);i=s.MathUtils.clamp(i||256,8,2048);this._imageCanvas=this._imageCanvas||document.createElementNS("http://www.w3.org/1999/xhtml","canvas");var l=B.createWebGLImageRenderer(this._imageCanvas,t,i);var h=this.getBackgroundColorTop();var c=this.getBackgroundColorBottom();if(r&&!a){l.setClearColor(r,1)}else if(!r&&a){l.setClearColor(a,1)}else{if(r&&a){this.setBackgroundColorTop(r);this.setBackgroundColorBottom(a)}l.render(this._backgroundScene,this._backgroundCamera);l.autoClear=false}document.body.appendChild(l.domElement);var p=this._getViewStateManagerThreeJS();p?.applyNodeStates?.();try{if(e==null){e=o.children.slice().filter(function(e){return!e.userData.defaultLights})}else if(!Array.isArray(e)){e=[e]}var f=this.getCamera();var g=f instanceof u?new u:new d;var m=g.getCameraRef();m.copy(f.getCameraRef());if(n.quaternion&&!n.useViewportCamera){m.quaternion.copy(n.quaternion);m.updateMatrixWorld();m.up.setFromMatrixColumn(m.matrixWorld,1).normalize()}g.update(t,i);if(!n.useViewportCamera){e[0].getWorldPosition(m.position);m.position.sub(m.getWorldDirection(new s.Vector3).multiplyScalar(1e3))}m.updateMatrixWorld();m.updateProjectionMatrix();var v=new s.Vector2;l.getSize(v);var _=[];e.forEach(function(e){e.traverseVisible(function(e){e._vkUpdate?.(l,m,v,null,p);if(!n.includeOverlay&&e.userData.renderStage>0||!n.includeUnderlay&&e.userData.renderStage<0){_.push(e);e.visible=false}})});var y=new s.Scene;y.children=e;var C=new s.Box3;y._expandBoundingBox(C,false,false,false);if(!n.useViewportCamera){m._vkZoomTo(C,n.margin)}g.adjustClipPlanes(C);var w=o.children[o.children.length-1].clone();Q(w.children[0],m);y.add(w);var S=[];if(p!=null){p.enumerateSelection(function(e){S.push(e)});p.setSelectionStates([],S,false,true)}var b=y.userData.useGeometryClusters;y.userData.useGeometryClusters=false;l.render(y,m);y.userData.useGeometryClusters=b;if(p!=null&&S.length>0){p.setSelectionStates(S,[],false,true)}if(_.length>0){_.forEach(function(e){e.visible=true})}y.remove(w);y.children=[]}finally{p?.revertNodeStates?.()}var R=l.getContext().canvas.toDataURL(n.type,n.encoderOptions);document.body.removeChild(l.domElement);l.dispose();if(c&&r){this.setBackgroundColorBottom(c)}if(h&&a){this.setBackgroundColorTop(h)}return R};L.prototype._initDummyCamera=function(e){const t=this.getScene()._computeBoundingBox(true,true,false,true);if(!t.isEmpty()){e._dummyCamera=false;e.setFov(14.27);const i=this._upAxis===4?new s.Euler(s.MathUtils.degToRad(90-30),0,s.MathUtils.degToRad(55-90),"ZXY"):new s.Euler(s.MathUtils.degToRad(-30),s.MathUtils.degToRad(55-90),0,"YXZ");this.setCamera(e);this._viewportGestureHandler.zoomTo(t,(new s.Quaternion).setFromEuler(i),0,0,null,false)}};L.prototype._setContent=function(e){I._setContent.apply(this,arguments);var t=null;if(this._scene){Y(this,this._scene)}if(e){t=e;if(!(t instanceof M)){t=null}var i;if(e.loaders){for(i=0;i<e.loaders.length;i++){if(e.loaders[i]instanceof k){this._cdsLoader=e.loaders[i];this._cdsLoader.getSceneBuilder()._fireSceneUpdated=this.setShouldRenderFrame.bind(this);this._cdsLoader.attachSceneUpdated(this._handleCdsSceneUpdate,this);this._cdsLoader.attachInitialViewCompleted(this.setShouldRenderFrame,this);this._contentLoadingFinished=false;break}}}if(e.builders){for(i=0;i<e.builders.length;i++){e.builders[i]._fireSceneUpdated=this.setShouldRenderFrame.bind(this)}}}else if(this._cdsLoader){this._cdsLoader.detachSceneUpdated(this._handleCdsSceneUpdate,this);this._cdsLoader.detachInitialViewCompleted(this.setShouldRenderFrame,this);this._cdsLoader=null}if(t){Z(this,t)}this._setScene(t);if(e){this._upAxis=e.upAxis||2;let t=e.camera;if(!(t instanceof d)&&!(t instanceof u)){t=new u;t._dummyCamera=true;if(e.builders&&e.builders.length>0){this._initDummyCamera(t)}}this.setCamera(t);if(e.backgroundTopColor!==undefined){this.setBackgroundColorTop(new s.Color(e.backgroundTopColor).getStyle())}if(e.backgroundBottomColor!==undefined){this.setBackgroundColorBottom(new s.Color(e.backgroundBottomColor).getStyle())}if(e.renderMode!==undefined){this.setRenderMode(e.renderMode)}this._outputSettings=e.outputSettings}if(this._measurementSurface!=null){this._measurementSurface.setScale(1)}return this};L.prototype.onSetContentConnector=function(e){t.prototype.onSetContentConnector.call(this,e);e.attachContentChangesFinished(this.setShouldRenderFrame,this);e.attachContentLoadingFinished(this._onContentLoadingFinished,this)};L.prototype.onUnsetContentConnector=function(e){e.detachContentChangesFinished(this.setShouldRenderFrame,this);e.detachContentLoadingFinished(this._onContentLoadingFinished,this);t.prototype.onUnsetContentConnector.call(this,e)};L.prototype._onContentLoadingFinished=function(e){this._contentLoadingFinished=true;if(this.getCamera()?._dummyCamera){this._initDummyCamera(this.getCamera())}this._createAnnotations();this.setRenderMode(this.getRenderMode());this.setShouldRenderFrame()};L.prototype.getCurrentView=function(){return this._currentView};L.prototype._onViewStateApplied=function(e,t,i){if(i.source!=this._getViewStateManagerThreeJS()||!this._scene){return}this._ignoreAnimationPosition=i.ignoreAnimationPosition;this.activateView(i.view,i.playViewGroup,i.skipCameraTransitionAnimation)};L.prototype._activateSingleView=function(t,i,r){var a=this._scene.getViewGroups();var n=this;if(a){a.forEach(function(e){e.getViews().forEach(function(i){if(i===t){n._currentViewIndex=e.getViews().indexOf(i)}})})}this.fireViewActivated({viewIndex:this._currentViewIndex,view:t});e.getEventBus().publish("sap.ui.vk","viewActivated",{source:this,view:t,viewIndex:this._currentViewIndex});this._currentView=t;this._backgroundNode=this._findBackgroundNode();var o=t.getTopColor();if(o!=null){if(Array.isArray(o)&&o.length>2){this.setBackgroundColorTop(new s.Color(o[0],o[1],o[2]).getStyle())}else{this.setBackgroundColorTop(new s.Color(o).getStyle())}}var l=t.getBottomColor();if(l!=null){if(Array.isArray(l)&&l.length>2){this.setBackgroundColorBottom(new s.Color(l[0],l[1],l[2]).getStyle())}else{this.setBackgroundColorBottom(new s.Color(l).getStyle())}}if(t.renderMode!==undefined){this.setRenderMode(t.renderMode)}this._outputSettings=t.outputSettings;var h=t.getCamera();var d=this._getViewStateManagerThreeJS();var u=t.flyToTime!=null?t.flyToTime:2e3;var c;if(d&&d._fadeOutBackground&&d._fadeInBackground&&d._fadeOutBackground!==d._fadeInBackground&&d._fadeOutBackground.name==="sphere"){c="zoomIn";h=h||this.getCamera()}var p=0;if(h){var f=i&&!t.hasAnimation();p=this._viewportGestureHandler.activateCamera(h.getCameraRef(),r?0:u,f,c)}else{this.cameraUpdateCompleted()}var g=0;if(!r){g=d._startTransition(p>0?p:u,t)}if(this.getSafeArea()){this.getSafeArea().resize()}if(this._readyForAnimationTimer){clearTimeout(this._readyForAnimationTimer)}this._readyForAnimationTimer=setTimeout(function(){this._readyForAnimationTimer=0;if(d){if(this._contentLoadingFinished!==false){this._createAnnotations()}d.fireReadyForAnimation({view:t,ignoreAnimationPosition:this._ignoreAnimationPosition});e.getEventBus().publish("sap.ui.vk","readyForAnimation",{source:d,view:t,ignoreAnimationPosition:this._ignoreAnimationPosition});d._startHighlight()}}.bind(this),Math.max(g,p)+100)};L.prototype.resetCurrentView=function(){if(!this._currentView){return this}this._getViewStateManagerThreeJS()._resetNodesMaterialAndOpacityByCurrentView(this._currentView);this._getViewStateManagerThreeJS()._resetNodesStatusByCurrentView(this._currentView,true);this.setShouldRenderFrame();return this};L.prototype.activateView=function(e,t,i){this._clearAnnotations();this._activateSingleView(e,t,i);return this};L.prototype.zoomTo=function(e,t,i,r){var a=this._getNativeScene();var n=this._getNativeCamera();if(!n||!a){return this}r=r||0;var o=new s.Box3;var l=null;var h=null;(Array.isArray(e)?e:[e]).forEach(function(e){switch(e){case _.All:a._expandBoundingBox(o,false,true);break;case _.Visible:a._expandBoundingBox(o,true,true);break;case _.Selected:var i=this._getViewStateManagerThreeJS();if(i){i.enumerateSelection(function(e){e._expandBoundingBox(o,false,true)})}break;case _.Node:if(!t){return}h=t;if(Array.isArray(t)){t.forEach(function(e){e._expandBoundingBox(o,false,true)})}else{t._expandBoundingBox(o,false,true)}break;case _.Restore:D.error(w().getText("VIEWPORT_MSG_RESTORENOTIMPLEMENTED"));return;case _.NodeSetIsolation:D.error(w().getText("VIEWPORT_MSG_NODESETISOLATIONNOTIMPLEMENTED"));return;case _.RestoreRemoveIsolation:D.error(w().getText("VIEWPORT_MSG_RESTOREREMOVEISOLATIONNOTIMPLEMENTED"));return;case _.ViewLeft:l=(new s.Quaternion).setFromAxisAngle(new s.Vector3(0,1,0),-Math.PI/2);break;case _.ViewRight:l=(new s.Quaternion).setFromAxisAngle(new s.Vector3(0,1,0),Math.PI/2);break;case _.ViewTop:l=(new s.Quaternion).setFromAxisAngle(new s.Vector3(1,0,0),-Math.PI/2);break;case _.ViewBottom:l=(new s.Quaternion).setFromAxisAngle(new s.Vector3(1,0,0),Math.PI/2);break;case _.ViewBack:l=(new s.Quaternion).setFromAxisAngle(new s.Vector3(0,1,0),Math.PI);break;case _.ViewFront:l=(new s.Quaternion).setFromAxisAngle(new s.Vector3(0,1,0),0);break;default:break}},this);if(!o.isEmpty()){this._viewportGestureHandler.zoomTo(o,l,r,i*1e3,h,h!==null)}return this};L.prototype.pan=function(e,t){this._viewportGestureHandler._cameraController.pan(e,t)};L.prototype.rotate=function(e,t,i){this._viewportGestureHandler._cameraController.rotate(e,t,i)};L.prototype.zoom=function(e){this._viewportGestureHandler._cameraController.zoom(e)};L.prototype.getViewInfo=function(e){var t={};if(e==null){e={}}if(e.camera==null){e.camera=true}var i=this._getNativeCamera();if(e.camera&&i){var r=i.rotation.clone();r.reorder("YXZ");t.camera={rotation:{yaw:s.MathUtils.radToDeg(r.y),pitch:s.MathUtils.radToDeg(r.x),roll:s.MathUtils.radToDeg(r.z)},position:{x:i.position.x,y:i.position.y,z:i.position.z},projectionType:i.isOrthographicCamera?g.Orthographic:g.Perspective,bindingType:m.Vertical};var a=i.view;if(a&&a.enabled){t.camera.view={fullWidth:a.fullWidth,fullHeight:a.fullHeight,offsetX:a.offsetX,offsetY:a.offsetY,width:a.width,height:a.height}}if(t.camera.projectionType===g.Perspective){t.camera.fieldOfView=i.fov}else if(t.camera.projectionType===g.Orthographic){t.camera.zoomFactor=i.zoom}if(e.camera.matrices){t.camera.matrices={view:i.matrixWorldInverse.elements.slice(),projection:i.projectionMatrix.elements.slice()}}}if(e.visibility&&this._viewStateManager){var n=e.visibility.mode==null?v.Complete:e.visibility.mode;t.visibility={mode:n};if(n===v.Complete){var o=this._viewStateManager.getVisibilityComplete();t.visibility.visible=o.visible;t.visibility.hidden=o.hidden}else if(this._viewStateManager.getShouldTrackVisibilityChanges()){t.visibility.changes=this._viewStateManager.getVisibilityChanges()}else{D.warning(w().getText(p.VIT32.summary),p.VIT32.code,"sap.ui.vk.threejs.Viewport")}}var l=this._getViewStateManagerThreeJS();if(e.selection&&l){t.selection=l._getSelectionComplete()}return t};L.prototype.setViewInfo=function(e,t){var i=this._getNativeCamera();if(e.camera&&i){var r=e.camera;var a=r.projectionType===g.Orthographic?new s.OrthographicCamera:new s.PerspectiveCamera;a.userData=i.userData;a.aspect=i.aspect;a.position.copy(r.position);var n=r.rotation;a.quaternion.setFromEuler(new s.Euler(s.MathUtils.degToRad(n.pitch),s.MathUtils.degToRad(n.yaw),s.MathUtils.degToRad(n.roll),"YXZ"));a.fov=r.fieldOfView||a.fov;a.zoom=r.zoomFactor||a.zoom;a.updateMatrix();a.up.setFromMatrixColumn(a.matrix,1).normalize();if(i.view&&i.view.enabled){var o=r.view||i.view;a.setViewOffset(o.fullWidth,o.fullHeight,o.offsetX,o.offsetY,o.width,o.height);if(i.isPerspectiveCamera){a.aspect=o.fullWidth/o.fullHeight;a.zoom=Math.min(a.aspect,1)}}this._viewportGestureHandler.activateCamera(a,(t||0)*1e3)}var l=new Map;if(e.visibility||e.selection){var h=this._viewStateManager.getNodeHierarchy();if(h){var d=h.findNodesByName();d.forEach(function(e){var t=h.createNodeProxy(e);var i=t.getVeId();h.destroyNodeProxy(t);if(i){l.set(i,e)}})}}if(e.visibility){switch(e.visibility.mode){case v.Complete:var u=e.visibility.visible,c=e.visibility.hidden;u.forEach(function(e){this._viewStateManager.setVisibilityState(l.get(e),true,false)},this);c.forEach(function(e){this._viewStateManager.setVisibilityState(l.get(e),false,false)},this);break;case v.Differences:this._viewStateManager.resetVisibility();e.visibility.changes.forEach(function(e){var t=l.get(e);if(t){this._viewStateManager.setVisibilityState(t,!this._viewStateManager.getVisibilityState(t),false)}},this);break;default:D.error(w().getText(p.VIT28.summary),p.VIT28.code,"sap.ui.vk.threejs.Viewport");break}}var f=this._getViewStateManagerThreeJS();var m=e.selection;if(m&&f){var _=f._getSelectionComplete();if(Array.isArray(m.selected)){var y=[];var C=[];m.selected.forEach(function(e){var t=l.get(e);if(t){y.push(t)}});_.selected.forEach(function(e){var t=l.get(e);if(t&&m.selected.indexOf(e)<0){C.push(t)}});f.setSelectionStates(y,C,false,false)}if(Array.isArray(m.outlined)){var S=[];var b=[];m.outlined.forEach(function(e){var t=l.get(e);if(t){S.push(t)}});_.outlined.forEach(function(e){var t=l.get(e);if(t&&m.outlined.indexOf(e)<0){b.push(t)}});f.setOutliningStates(S,b,false,false)}}this.setShouldRenderFrame();return this};L.prototype.queueCommand=function(e){if(this instanceof L){e()}return this};L.prototype.getOutputSize=function(){var e=this.getDomRef().getBoundingClientRect();var t=e.width;var i=e.height;var r;r=Math.min(t,i);return{left:(t-r)/2,top:(i-r)/2,sideLength:r}};L.prototype.projectToScreen=function(e,t,i,r){var a=this.getDomRef().getBoundingClientRect();var n=a.width/2;var o=a.height/2;var l=new s.Vector3(e,t,i).project(r.getCameraRef());return{x:n+l.x*n,y:o-l.y*o,depth:l.z}};L.prototype._createAndAddAnnotation=function(e){var t=T.createAnnotation(e,this);t.autoGenerated=true;t.setDisplay(this._viewStateManager.getVisibilityState(e.node));this.addAnnotation(t);return t};L.prototype._createAnnotations=function(){if(this._annotationsCreated){return this}this._annotationsCreated=true;var e=this._scene&&this._scene._getAnnotations();if(e==null||e.size===0){return this}var t=this.getCurrentView();if(t){t.getNodeInfos().filter(function(e){var t=e.target;return e.annotationId!=null&&t._vkGetNodeContentType()===V.Annotation&&t.userData.annotationType==="html"}).forEach(function(t){var i=t.target;var r=e.get(t.annotationId);N(r!=null,"Cannot find annotation for node with sid="+this._scene.nodeRefToPersistentId(i));if(r!=null){N(i===r.node,"Annotation found for node with sid="+this._scene.nodeRefToPersistentId(t.target)+" references other node with sid="+this._scene.nodeRefToPersistentId(r.node));if(i===r.node){this._createAndAddAnnotation(r)}}},this)}else{e.forEach(function(e){this._createAndAddAnnotation(e)},this)}var i=0;this.getAnnotations().forEach(function(e){if(e.getAnimate()&&e.getDisplay()&&e.getAnimationDelay()===-1){e.setAnimationDelay(i++)}});return this};L.prototype.setBackgroundNode=function(e){var t=this._viewStateManager.getNodeHierarchy();var i;var r=t.findNodesByName().reduce(function(e,t){if(t._vkGetNodeContentType()===V.Background){if(this._viewStateManager.getVisibilityState(t)){i=t}e.push(t)}return e}.bind(this),[]);if(!e){this._viewStateManager.setVisibilityState(r,true,false);this._viewStateManager.setVisibilityState(i,false,false);this._viewportGestureHandler.setView(null,1e3)}else{var a=e.parametricContent;var n=a.materialId;var o=e.sceneId;var l=t.createNode(i&&i.parent,a.type,null,V.Background,{parametricContent:a});this._viewStateManager.setVisibilityState(r,false,false);r.push(l);if(this._cdsLoader){this._cdsLoader.assignMaterialToNodes(o,n,l.children)}var h=a.type==="plane"?(new s.Quaternion).setFromAxisAngle(new s.Vector3(0,1,0),0):null;this._viewportGestureHandler.setView(h,1e3)}return r};L.prototype.normalizeRectangle=function(e,t,i,r){var a=this.getSafeArea().getDomRef();if(a==null){a=this.getDomRef()}var n=window.getComputedStyle(a);var o=parseFloat(n.width);var s=parseFloat(n.left);var l=(e-s)/o-.5;var h=parseFloat(n.height);var d=parseFloat(n.top);var u=(t-d)/h-.5;return{x:l,y:u,width:i/o,height:r/h}};L.prototype.deNormalizeRectangle=function(e,t,i,r){var a=this.getSafeArea().getDomRef();if(a==null){a=this.getDomRef()}var n=window.getComputedStyle(a);var o=parseFloat(n.width);var s=parseFloat(n.left);var l=o/2;var h=s+l;var d=Math.abs(e)*2;if(e<0){d=1-d;d*=l;d+=s}else if(e>0){d*=l;d+=h}else{d=h}var u=Math.abs(i)*2*l;var c=parseFloat(n.height);var p=parseFloat(n.top);var f=c/2;var g=p+f;var m=Math.abs(t)*2;if(t<0){m=1-m;m*=f;m+=p}else if(t>0){m*=f;m+=g}else{m=g}var v=Math.abs(r)*2*f;return{x:d,y:m,width:u,height:v}};var X=[];function Z(e,t){var i=O(X,function(e){return e.scene===t});if(i<0){var r=B.createWebGLRenderer(window.devicePixelRatio,true);e._registryEntry={scene:t,webGLRenderer:r,viewports:[e]};X.push(e._registryEntry);e._renderer=r;e._canvas=r.domElement;e.invalidate()}else{var a=X[i];var n=a.viewports;var o=n.indexOf(e);if(o<0){if(n.length==1){var s=n[0];s._canvas=document.createElement("canvas");s.invalidate()}n.push(e);e._registryEntry=a;e._renderer=a.webGLRenderer;e._canvas=document.createElement("canvas");e.invalidate()}}}function Y(e,t){var i=O(X,function(e){return e.scene===t});if(i<0){return}var r=X[i];var a=r.viewports;var n=a.indexOf(e);if(n<0){return}a.splice(n,1);if(a.length==1){var o=a[0];o._canvas=r.webGLRenderer.domElement;o.invalidate()}else if(a.length===0){r.webGLRenderer.renderLists.dispose();r.webGLRenderer.dispose();X.splice(i,1)}e._registryEntry=null;e._canvas=null;e._renderer=null;e.invalidate()}function K(e){var t=0;var i=0;e.viewports.forEach(function(e){t=Math.max(t,e._width);i=Math.max(i,e._height)});e.webGLRenderer.setSize(t,i,true)}L.prototype.getMeasurementSurface=function(){return this._measurementSurface};L.prototype.setShowPMI=function(e){this._showPMI=e;return this};return L});
/*!
* SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
*/
sap.ui.predefine("sap/ui/vk/threejs/ViewportGestureHandler", ["sap/base/Log","sap/ui/base/EventProvider","./PerspectiveCamera","./OrthographicCamera","../thirdparty/three","../getResourceBundle","../NodeContentType"],function(e,t,a,i,r,o,n){"use strict";var s=t.extend("sap.ui.vk.threejs.ViewportGestureHandler",{metadata:{library:"sap.ui.vk"},constructor:function(t){this._matProj=null;this._viewport=t;this._rect=null;this._evt={x:0,y:0,z:0,d:0};this._gesture=false;this._viewport.attachEvent("resize",this,this._onresize);this._nomenu=false;var a=function(t){var a=t;var i=new r.Vector3;var s=new r.Vector2;var h=.001;var l=-Math.PI/2+h;var m=Math.PI/2-h;this.isTurnTableMode=true;this._timeIntervalForCameraAnimation=500;this._startTimeForCameraAnimation=0;this._newCamera=null;this._oldCamera=null;this._animationType=null;this._zoomedNodeRef=null;this._isZoomIn=true;this.beginGesture=function(e,t){var o=a.getScene();if(o==null){return}var n=a.getCamera().getCameraRef();var h=a.getRenderer().getSize(new r.Vector2);s.x=e/h.width*2-1;s.y=t/h.height*-2+1;a._gesturePoint={x:e,y:t};var l=n.userData.isRedlineActivated?null:a.hitTest(e,t,o.getSceneRef(),n);if(l){i.copy(l.point)}else{var m=o._computeBoundingBox(true,true);if(!m.isEmpty()){m.getCenter(i)}else{i.setScalar(0)}}};this.endGesture=function(){};this.pan=function(e,t){if(a.getFreezeCamera()||a.getCamera()===null||e===0&&t===0){return}if(a._redlineHandler){a._redlineHandler.pan(e,t)}else if(a._isPanoramicActivated()){this.rotate(e,t);return}var o=a.getCamera().getCameraRef();var n=a.getRenderer().getSize(new r.Vector2);if(o.view&&o.view.enabled){o.view.offsetX-=e*o.view.width/o.view.fullWidth;o.view.offsetY-=t*o.view.height/o.view.fullHeight;o.updateProjectionMatrix()}else{var s=i.clone().project(o);s.x-=e*2/n.width;s.y+=t*2/n.height;s.unproject(o).sub(i);o.position.add(s);o.updateMatrixWorld()}a.fireCameraChanged({position:o.position.toArray()})};var d=[new r.Vector3(+1,0,0),new r.Vector3(-1,0,0),new r.Vector3(0,+1,0),new r.Vector3(0,-1,0),new r.Vector3(0,0,+1),new r.Vector3(0,0,-1)];this.rotate=function(e,t,o){if(a.getFreezeCamera()||a.getCamera()===null||e===0&&t===0){return}if(a._redlineHandler||a._isPlanarActivated()){this.pan(e,t);return}if(o!==undefined){this.isTurnTableMode=o}var n=a.getCamera().getCameraRef();var s=-.01;if(a._isPanoramicActivated()){var h=a.getRenderer().getSize(new r.Vector2);s=2/(h.x*n.projectionMatrix.elements[0]);i.copy(n.position)}var c=e*s,p=t*s;var u=n.position.clone().sub(i);var f=new r.Vector3,_=(new r.Vector3).setFromMatrixColumn(n.matrixWorld,1).normalize(),v=(new r.Vector3).setFromMatrixColumn(n.matrixWorld,0).normalize();n.getWorldDirection(f);f.normalize();var C=new r.Quaternion;if(this.isTurnTableMode){var w=d[a._upAxis]||d[2];v.sub(w.clone().multiplyScalar(w.dot(v))).normalize();var g=v.clone().cross(f);var y=Math.acos(Math.min(Math.max(g.dot(_),-1),1));if(y!==0){var x=Math.abs(c)+Math.abs(p);if(Math.abs(y)>x){y=Math.sign(y)*x}var M=_.clone().cross(g).normalize();_.applyQuaternion((new r.Quaternion).setFromAxisAngle(M,y))}C.setFromAxisAngle(w,c);var b=Math.atan2(f.y,Math.sqrt(f.x*f.x+f.z*f.z));p=r.MathUtils.clamp(p,l-b,m-b)}else{C.setFromAxisAngle(_,c)}C.multiply((new r.Quaternion).setFromAxisAngle(v,p));u.applyQuaternion(C);f.applyQuaternion(C);_.applyQuaternion(C);u.add(i);if(!n.userData.rotate){n.position.copy(u)}n.up.copy(_);n.lookAt(u.add(f));n.updateMatrixWorld();a.fireCameraChanged({position:n.position.toArray(),quaternion:n.quaternion.toArray()})};this.zoom=function(t){if(t===0||t===1||a.getFreezeCamera()||a.getCamera()===null||a.getScene()===null){return}var n=a.getCamera().getCameraRef();var h=new r.Vector3;if(!n.userData.isRedlineActivated){var l=100;var m=new r.Vector3;var d=!a.getBackgroundProjection();var c=a.getScene()._computeBoundingBox(true,d);c.applyMatrix4(n.matrixWorldInverse);c.min.z=Math.max(c.min.z,n.near);c.max.z=Math.max(c.max.z,n.near);c.applyMatrix4(n.projectionMatrix);c.getSize(m);var p=a.getRenderer().getSize(new r.Vector2);var u=m.x*p.width*.5;var f=m.y*p.height*.5;if(u<l&&f<l&&t<1){return}}var _=a._redlineHandler;if(_){t=Math.min(Math.max(_._zoomFactor*t,1/8),32)/_._zoomFactor;_._zoomFactor*=t;_.zoom(t)}if(n.view&&n.view.enabled){var v=a.getDomRef();var C=a._gesturePoint.x/v.clientWidth;var w=a._gesturePoint.y/v.clientHeight;var g=1/t;n.view.offsetX+=C*n.view.width;n.view.offsetY+=w*n.view.height;n.view.width*=g;n.view.height*=g;n.view.offsetX-=C*n.view.width;n.view.offsetY-=w*n.view.height}else if(n.isPerspectiveCamera){if(a._isPanoramicActivated()){n.fov=Math.min(Math.max(5,n.fov/Math.pow(t,.5)),90)}else{h.set(s.x,s.y,1).unproject(n);h.sub(new r.Vector3(s.x,s.y,-1).unproject(n));var y=i.clone().sub(n.position).length()*(1-1/t);h.setLength(y);n.position.add(h)}}else if(n.isOrthographicCamera){h.set(s.x,s.y,1).unproject(n);h.sub(new r.Vector3(0,0,1).unproject(n));h.multiplyScalar(1-1/t);n.zoom*=t;n.position.add(h)}else{e.error(o().getText("VIEWPORTGESTUREHANDLER_MSG_UNSUPPORTEDCAMERATYPE"))}n.updateProjectionMatrix();n.updateMatrixWorld();var x={position:n.position.toArray()};if(n.isOrthographicCamera){x.zoom=n.zoom}a.fireCameraChanged(x)};this.animateCameraUpdate=function(){if(this._newCamera===null||this._oldCamera===null){return false}if(a.getCamera()==null){this._newCamera=null;this._oldCamera=null;return false}function e(e,t,a){a=r.MathUtils.clamp((a-e)/(t-e),0,1);return a*a*a*(a*(a*6-15)+10)}var t=Math.min((Date.now()-this._startTimeForCameraAnimation)/this._timeIntervalForCameraAnimation,1);t=e(0,1,t);var i=a.getCamera().getCameraRef();if(i.view&&i.view.enabled){var o=i.view.width;var n=i.view.height;var s=i.view.offsetX+i.view.width*.5;var h=i.view.offsetY+i.view.height*.5;i.view.offsetX=r.MathUtils.lerp(this._oldCamera.view.offsetX,this._newCamera.view.offsetX,t);i.view.offsetY=r.MathUtils.lerp(this._oldCamera.view.offsetY,this._newCamera.view.offsetY,t);i.view.width=r.MathUtils.lerp(this._oldCamera.view.width,this._newCamera.view.width,t);i.view.height=r.MathUtils.lerp(this._oldCamera.view.height,this._newCamera.view.height,t);var l=i.view.offsetX+i.view.width*.5;var m=i.view.offsetY+i.view.height*.5;var d=a._redlineHandler;if(d){var c=o/i.view.width;var p=(s-l)*i.view.fullWidth/o;var u=(h-m)*i.view.fullHeight/n;d._zoomFactor*=c;d.pan(p,u);d.zoom(c,i.view.fullWidth*.5,i.view.fullHeight*.5)}}if(i.isOrthographicCamera&&this._newCamera.isOrthographicCamera&&this._oldCamera.isOrthographicCamera){i.left=r.MathUtils.lerp(this._oldCamera.left,this._newCamera.left,t);i.right=r.MathUtils.lerp(this._oldCamera.right,this._newCamera.right,t);i.top=r.MathUtils.lerp(this._oldCamera.top,this._newCamera.top,t);i.bottom=r.MathUtils.lerp(this._oldCamera.bottom,this._newCamera.bottom,t);if(this._transitionEffect==="zoomIn"){var f=Math.max(this._oldCamera.zoom,this._newCamera.zoom)*5;i.zoom=t<.5?r.MathUtils.lerp(this._oldCamera.zoom,f,t*2):r.MathUtils.lerp(f,this._newCamera.zoom,(t-.5)*2)}else{i.zoom=r.MathUtils.lerp(this._oldCamera.zoom,this._newCamera.zoom,t)}}if(i.isPerspectiveCamera&&this._newCamera.isPerspectiveCamera&&this._oldCamera.isPerspectiveCamera){if(this._transitionEffect==="zoomIn"){var _=Math.min(this._oldCamera.fov,this._newCamera.fov)*.1;i.fov=t<.5?r.MathUtils.lerp(this._oldCamera.fov,_,t*2):r.MathUtils.lerp(_,this._newCamera.fov,(t-.5)*2)}else{i.fov=r.MathUtils.lerp(this._oldCamera.fov,this._newCamera.fov,t)}}i.far=r.MathUtils.lerp(this._oldCamera.far,this._newCamera.far,t);i.near=r.MathUtils.lerp(this._oldCamera.near,this._newCamera.near,t);i.updateProjectionMatrix();i.position.lerpVectors(this._oldCamera.position,this._newCamera.position,t);i.scale.lerpVectors(this._oldCamera.scale,this._newCamera.scale,t);i.up.lerpVectors(this._oldCamera.up,this._newCamera.up,t);var v=this._oldCamera.getWorldDirection(new r.Vector3);var C=this._newCamera.getWorldDirection(new r.Vector3);var w=(new r.Vector3).lerpVectors(v,C,t);i.lookAt(w.add(i.position));var g=a.getDomRef();a.getCamera().update(g.clientWidth,g.clientHeight);let y=true;if(t===1){y=false;this._newCamera=null;this._oldCamera=null;if(this._animationType==="zooming"&&this._zoomedNodeRef){a.fireNodeZoomed({zoomed:this._zoomedNodeRef,isZoomIn:this._isZoomIn})}a.cameraUpdateCompleted({position:i.position.toArray(),quaternion:i.quaternion.toArray()})}a.fireCameraChanged({position:i.position.toArray(),quaternion:i.quaternion.toArray()});return y};this.startCameraAnimation=function(e,t){this._startTimeForCameraAnimation=Date.now();this._timeIntervalForCameraAnimation=e!==undefined?e:500;this._transitionEffect=t;a.setShouldRenderFrame()};this.lookAtObject=function(e,t){if(e._vkGetNodeContentType()!==n.Background){this.prepareForCameraUpdateAnimation();var i=a.getCamera().getCameraRef();this._newCamera=i.clone();this._newCamera.lookAt(e.getWorldPosition(new r.Vector3));this._newCamera.up.set(0,1,0);this._newCamera.updateMatrixWorld();this.startCameraAnimation(t)}};this.zoomObject=function(e,t,i){if(a.getScene()==null){return}var o;if(t&&e){o=new r.Box3;e._expandBoundingBox(o,true,true)}else{o=a.getScene()._computeBoundingBox(true,true)}if(e&&(e._vkGetNodeContentType()===n.Background||e._vkGetNodeContentType()===n.Symbol)){o.setFromObject(e)}var s=e&&e._vkGetNodeContentType()===n.Symbol?10:0;this.zoomBox(o,s,i,e,t)};this.zoomBox=function(e,t,i,r,o){this._zoomedNodeRef=r;this._isZoomIn=o;this._animationType="zooming";this._newCamera=a.getCamera().getCameraRef().clone();this._newCamera._vkZoomTo(e,t);if(a.getBackgroundProjection()==="spherical"){this._newCamera.position.setScalar(0)}this.startCameraAnimation(i)};this.prepareForCameraUpdateAnimation=function(){this._oldCamera=a.getCamera().getCameraRef().clone()};this.startAnimatingCameraUpdate=function(e,t,i){var r=a.getCamera().getCameraRef();if(!this._oldCamera){return 0}var o=!!i;var n=1e-4;if(r.isOrthographicCamera&&this._oldCamera.isOrthographicCamera){if(Math.abs(r.left-this._oldCamera.left)>n||Math.abs(r.right-this._oldCamera.right)>n||Math.abs(r.top-this._oldCamera.top)>n||Math.abs(r.bottom-this._oldCamera.bottom)>n||Math.abs(r.zoom-this._oldCamera.zoom)>n){o=true}}else if(r.isPerspectiveCamera&&this._oldCamera.isPerspectiveCamera){if(Math.abs(r.fov-this._oldCamera.fov)>n||Math.abs(r.aspect-this._oldCamera.aspect)>n){o=true}}if(!o){if(Math.abs(r.position.x-this._oldCamera.position.x)>n||Math.abs(r.position.y-this._oldCamera.position.y)>n||Math.abs(r.position.z-this._oldCamera.position.z)>n||Math.abs(r.scale.x-this._oldCamera.scale.x)>n||Math.abs(r.scale.y-this._oldCamera.scale.y)>n||Math.abs(r.scale.z-this._oldCamera.scale.z)>n||Math.abs(r.quaternion.x-this._oldCamera.quaternion.x)>n||Math.abs(r.quaternion.y-this._oldCamera.quaternion.y)>n||Math.abs(r.quaternion.z-this._oldCamera.quaternion.z)>n||Math.abs(r.quaternion.w-this._oldCamera.quaternion.w)>n){o=true}}if(!o){if(!t){a.cameraUpdateCompleted({position:r.position.toArray(),quaternion:r.quaternion.toArray()});return 0}else{e=500}}this._newCamera=a.getCamera().getCameraRef().clone();this.startCameraAnimation(e,i);return e}};this._cameraController=new a(t)}});s.prototype._activateRedline=function(){var e=this._viewport.getCamera().getCameraRef();e.userData.isRedlineActivated=true;var t=this._viewport.getDomRef();e.setViewOffset(t.clientWidth,t.clientHeight,0,0,t.clientWidth,t.clientHeight)};s.prototype._deactivateRedline=function(){var e=this._viewport&&this._viewport.getCamera();if(e){var t=e.getCameraRef();t.userData.isRedlineActivated=false;t.clearViewOffset()}};s.prototype.destroy=function(){this._viewport=null;this._rect=null;this._evt=null;this._gesture=false};s.prototype._getOffset=function(e){var t=e.getBoundingClientRect();var a={x:t.left+window.pageXOffset,y:t.top+window.pageYOffset};return a};s.prototype._inside=function(e){var t=this._viewport.getIdForLabel();var a=document.getElementById(t);if(!a){return false}var i=this._getOffset(a);this._rect={x:i.x,y:i.y,w:a.offsetWidth,h:a.offsetHeight};return e.x>=this._rect.x&&e.x<=this._rect.x+this._rect.w&&e.y>=this._rect.y&&e.y<=this._rect.y+this._rect.h};s.prototype._onresize=function(e){this._gesture=false;this._rect=null};s.prototype.beginGesture=function(t){if(this._inside(t)&&!this._gesture){this._gesture=true;var a=t.x-this._rect.x,i=t.y-this._rect.y;this._evt.x=a;this._evt.y=i;this._evt.d=t.d;e.debug("Loco: beginGesture: "+a+", "+i);this._cameraController.beginGesture(a,i);t.handled=true;if(document.activeElement){try{document.activeElement.blur()}catch(e){}}var r=document.getElementById(this._viewport.getIdForLabel());r.focus()}this._nomenu=false};s.prototype.move=function(t){if(this._gesture){var a=t.x-this._rect.x,i=t.y-this._rect.y;const n=t.d;var r=a-this._evt.x;var o=i-this._evt.y;this._evt.x=a;this._evt.y=i;this._evt.d=n;switch(t.n){case 1:e.debug("Loco: Rotate: "+r+", "+o);this._cameraController.rotate(r,o);break;case 2:e.debug("Loco: Pan: "+r+", "+o);if(n!=0&&n!=1){e.debug("Loco: Zoom: "+n)}this._cameraController.pan(r,o);if(n!=0&&n!=1){this._cameraController.zoom(n)}break;default:break}this._nomenu=true;t.handled=true}};s.prototype.endGesture=function(t){if(this._gesture){var a=t.x-this._rect.x,i=t.y-this._rect.y;e.debug("Loco: endGesture: "+a+", "+i);this._cameraController.endGesture();this._gesture=false;t.handled=true}};s.prototype.click=function(t){if(this._inside(t)&&t.buttons<=1){var a=t.x-this._rect.x,i=t.y-this._rect.y;e.debug("Loco: click: "+a+", "+i);if(this._viewport){this._viewport.tap(a,i,false)}t.handled=true}};s.prototype.doubleClick=function(t){if(this._inside(t)&&t.buttons<=1){var a=t.x-this._rect.x,i=t.y-this._rect.y;e.debug("Loco: doubleClick: "+a+", "+i);if(this._viewport){this._viewport.tap(a,i,true)}t.handled=true}};s.prototype.contextMenu=function(e){if(this._inside(e)||this._nomenu||e.buttons===5){this._nomenu=false;e.handled=true}};s.prototype.keyEventHandler=function(e){};s.prototype.getViewport=function(){return this._viewport};s.prototype.activateCamera=function(e,t,r,o){var n=0;this._cameraController.prepareForCameraUpdateAnimation();const s=this._viewport;const h=s.getCamera();if(h.getCameraRef().isPerspectiveCamera!==e.isPerspectiveCamera){var l=e.isPerspectiveCamera?new a:new i;l.getCameraRef().copy(e);s.setCamera(l)}else{h.getCameraRef().copy(e);h.update(s._width,s._height);delete h._dummyCamera}if(t>0){n=this._cameraController.startAnimatingCameraUpdate(t,r,o)}else{s.cameraUpdateCompleted({position:e.position.toArray(),quaternion:e.quaternion.toArray()})}return n};s.prototype.setView=function(t,i){var o=this._viewport.getCamera().getCameraRef();if(o.userData.isRedlineActivated){e.error("setView() method is disabled when Redlining is activated");return this}this._cameraController.prepareForCameraUpdateAnimation();if(t){o.quaternion.copy(t);o.updateMatrixWorld();o.up.setFromMatrixColumn(o.matrixWorld,1).normalize();this._cameraController.zoomObject(null,false,i)}else{o.copy(this._viewport._homeCamera?this._viewport._homeCamera:(new a).getCameraRef());var n=this._viewport.getRenderer().getSize(new r.Vector2);this._viewport.getCamera().update(n.width,n.height);this._cameraController.startAnimatingCameraUpdate(i)}this._viewport.setShouldRenderFrame();return this};s.prototype.zoomTo=function(t,a,i,r,o,n){if(this._viewport._isPanoramicActivated()||this._viewport._isPlanarActivated()){e.error("zoomTo() method is disabled in navigation scene");return this}var s=this._viewport.getCamera().getCameraRef();this._cameraController.prepareForCameraUpdateAnimation();if(a){s.quaternion.copy(a);s.updateMatrixWorld();s.up.setFromMatrixColumn(s.matrixWorld,1).normalize()}this._cameraController.zoomBox(t,i,r,o,n);return this};s.prototype.zoomObject=function(e,t,a){if(this._viewport._isPanoramicActivated()){this._cameraController.lookAtObject(e,a)}else{this._cameraController.prepareForCameraUpdateAnimation();this._cameraController.zoomObject(e,t,a)}return this};s.prototype.animateCameraUpdate=function(){return this._cameraController.animateCameraUpdate()};s.prototype.prepareForCameraUpdateAnimation=function(){this._cameraController.prepareForCameraUpdateAnimation()};s.prototype.startAnimatingCameraUpdate=function(e){this._cameraController.startAnimatingCameraUpdate(e)};return s});
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/threejs/ViewportRenderer", [],function(){"use strict";var e={apiVersion:2};e.render=function(e,t){e.openStart("div",t);e.class("sapVizKitViewport");e.attr("tabindex",0);e.attr("aria-label","Image");e.attr("role","figure");e.style("width",t.getWidth());e.style("height",t.getHeight());e.openEnd();if(t.getSafeArea()){e.renderControl(t.getSafeArea())}t.renderTools(e);t.renderContent(e);var n=t.getAnnotations();if(n&&n.length>0){e.openStart("div");e.class("sapUiVizKitAnnotationContainer");e.openEnd();n.forEach(function(t){e.renderControl(t)});e.close("div")}e.close("div")};return e},true);
sap.ui.predefine("sap/ui/vk/threejs/utils/arrayDiff", ["sap/base/util/deepEqual"],function(e){"use strict";function t(t,o,r,n){r=r||function(t,o){return e(t,o)};const l=[];const w=[];const f=[];for(let e=0;e<o.length;e++){const i=o[e];let d=0;let s;if(n&&r(t[e],i)){d=1;s=e}else{for(let e=0;e<t.length;e++){if(r(t[e],i)){d++;s=e;if(n||d>1){break}}}}if(d==1){const r={oldIndex:s,newIndex:e};if(f[s]){delete l[s];delete w[f[s].newIndex]}else{w[e]={data:o[e],row:s};l[s]={data:t[s],row:e};f[s]=r}}}for(let e=0;e<o.length-1;e++){if(w[e]&&!w[e+1]&&w[e].row+1<t.length&&!l[w[e].row+1]&&r(t[w[e].row+1],o[e+1])){w[e+1]={data:o[e+1],row:w[e].row+1};l[w[e].row+1]={data:l[w[e].row+1],row:e+1}}}for(let e=o.length-1;e>0;e--){if(w[e]&&!w[e-1]&&w[e].row>0&&!l[w[e].row-1]&&r(t[w[e].row-1],o[e-1])){w[e-1]={data:o[e-1],row:w[e].row-1};l[w[e].row-1]={data:l[w[e].row-1],row:e-1}}}const i=[];if(o.length==0){for(let e=0;e<t.length;e++){i.push({index:0,type:"delete"})}}else{let e=0;if(!l[0]){for(let o=0;o<t.length&&!l[o];o++){i.push({index:0,type:"delete"});e=o+1}}for(let r=0;r<o.length;r++){if(!w[r]||w[r].row>e){i.push({index:r,type:"insert"})}else{e=w[r].row+1;for(let o=w[r].row+1;o<t.length&&(!l[o]||l[o].row<r);o++){i.push({index:r+1,type:"delete"});e=o+1}}}}return i}return t});
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/tools/AnchorPointTool", ["../thirdparty/three","./Tool","./AnchorPointToolHandler","./AnchorPointToolGizmo","./AnchorPointToolOperation"],function(t,e,i,o,r){"use strict";var n=e.extend("sap.ui.vk.tools.AnchorPointTool",{metadata:{library:"sap.ui.vk",properties:{enableStepping:{type:"boolean",defaultValue:false},showEditingUI:{type:"boolean",defaultValue:false},allowOperation:{type:"sap.ui.vk.tools.AnchorPointToolOperation",defaultValue:r.All},allowContextMenu:{type:"boolean",defaultValue:true},position:{type:"any",defaultValue:null},quaternion:{type:"any",defaultValue:null}},events:{moving:{parameters:{x:"float",y:"float",z:"float"}},moved:{parameters:{x:"float",y:"float",z:"float"}},rotating:{parameters:{x:"float",y:"float",z:"float"}},rotated:{parameters:{x:"float",y:"float",z:"float"}}}},constructor:function(t,o){e.apply(this,arguments);this._viewport=null;this._handler=new i(this);this._gizmo=null}});n.prototype.init=function(){if(e.prototype.init){e.prototype.init.call(this)}this.setFootprint(["sap.ui.vk.threejs.Viewport"]);var t=new o;this.setAggregation("gizmo",t);this.setProperty("position",t._gizmo.position);this.setProperty("quaternion",t._gizmo.quaternion)};n.prototype.setViewport=function(t){if(this._viewport!==t){this._deactivateScreenAlignment()}e.prototype.setViewport.call(this,t);if(t){this.getGizmo()._initAnchorPoint(t)}};n.prototype.setActive=function(t,i,o){e.prototype.setActive.call(this,t,i,o);if(this._viewport){if(t){this._gizmo=this.getGizmo();this._gizmo.show(this._viewport,this);this._addLocoHandler();this._deactivateScreenAlignment()}else{this._removeLocoHandler();if(this._gizmo){this._gizmo.hide();this._gizmo=null}}}return this};n.prototype.queueCommand=function(t){if(this._addLocoHandler()){if(this.isViewportType("sap.ui.vk.threejs.Viewport")){t()}}return this};n.prototype.setShowEditingUI=function(t){this.setProperty("showEditingUI",t,true);if(this._viewport){this._viewport.setShouldRenderFrame()}return this};n.prototype.setAllowOperation=function(t){this.setProperty("allowOperation",t,true);if(this._gizmo){this._gizmo._updateHandlesVisibility()}if(this._viewport){this._viewport.setShouldRenderFrame()}return this};n.prototype.move=function(t,e,i){if(this._gizmo){this._gizmo.move(t,e,i)}if(this._viewport){this._viewport.setShouldRenderFrame()}return this};n.prototype.rotate=function(t,e,i){if(this._gizmo){this._gizmo.rotate(t,e,i)}if(this._viewport){this._viewport.setShouldRenderFrame()}return this};n.prototype.moveTo=function(e,i){var o=Array.isArray(e)?e:[e];var r=new t.Vector3;if(e instanceof t.Matrix4){r.setFromMatrixPosition(e)}else if(i){var n=0;var a=new t.Vector3;o.forEach(function(t){t.updateWorldMatrix(false,false);r.add(a.setFromMatrixPosition(t.matrixWorld));n++});r.multiplyScalar(1/n)}else{var s=new t.Box3;o.forEach(function(t){t._expandBoundingBox(s,true,false,false)});s.getCenter(r)}this.getGizmo().setPosition(r);if(this._viewport){this._viewport.setShouldRenderFrame()}return this};n.prototype.alignTo=function(e){this._deactivateScreenAlignment();var i=new t.Quaternion;if(e instanceof t.Matrix4){e.decompose(new t.Vector3,i,new t.Vector3)}else if(e){e.updateWorldMatrix(false,false);e.matrixWorld.decompose(new t.Vector3,i,new t.Vector3)}this.getGizmo().setQuaternion(i);if(this._viewport){this._viewport.setShouldRenderFrame()}return this};n.prototype.alignToWorld=function(){this._deactivateScreenAlignment();this.getGizmo().setQuaternion(new t.Quaternion);if(this._viewport){this._viewport.setShouldRenderFrame()}return this};n.prototype.alignToScreen=function(){if(this._viewport){this._activateScreenAlignment();this.alignToScreenCallback();this._viewport.setShouldRenderFrame()}return this};n.prototype._activateScreenAlignment=function(){if(!this.alignToScreenCallback){this.alignToScreenCallback=function(){var t=this._viewport.getCamera().getCameraRef();this.getGizmo().setQuaternion(t.quaternion)}.bind(this);this._viewport.attachCameraChanged(this.alignToScreenCallback)}};n.prototype._deactivateScreenAlignment=function(){if(this.alignToScreenCallback&&this._viewport){this._viewport.detachCameraChanged(this.alignToScreenCallback);this.alignToScreenCallback=null}};n.prototype.setPosition=function(){throw new Error("The AnchorPointTool position is read-only")};n.prototype.setQuaternion=function(){throw new Error("The AnchorPointTool quaternion is read-only")};return n});
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/tools/AnchorPointToolGizmo", ["../getResourceBundle","../thirdparty/three","../thirdparty/BufferGeometryUtils","./Gizmo","./CoordinateSystem","./AxisColours","./AnchorPointToolOperation","sap/base/assert"],function(t,e,i,o,r,a,s,n){"use strict";var h=o.extend("sap.ui.vk.tools.AnchorPointToolGizmo",{metadata:{library:"sap.ui.vk"},renderer:{apiVersion:2,render:function(t,e){t.openStart("div",e);t.class("sapUiVkTransformationToolEdit");t.openEnd();t.renderControl(e._editingForm);t.close("div")}}});h.prototype.init=function(){if(o.prototype.init){o.prototype.init.apply(this)}this._createEditingForm(null,84);this._gizmoIndex=-1;this._handleIndex=-1;this._viewport=null;this._tool=null;this._sceneGizmo=new e.Scene;const t=new e.DirectionalLight(16777215,.5*Math.PI);t.position.set(1,3,2);this._sceneGizmo.add(t);this._sceneGizmo.add(new e.AmbientLight(16777215,.5*Math.PI));this._touchAreas=new e.Group;this._gizmo=new e.Group;this._sceneGizmo.add(this._gizmo);this._matViewProj=new e.Matrix4;this._gizmoSize=96;this._moveDelta=new e.Vector3;this._rotationDelta=new e.Vector3;function r(t,o,r){var a=96,s=1,n=24,h=4,l=48;t.multiplyScalar(1/a);var d=new e.CylinderGeometry(s,s,a-n,4);var u=(new e.Matrix4).makeBasis(new e.Vector3(t.y,t.z,t.x),t,new e.Vector3(t.z,t.x,t.y));u.setPosition(t.clone().multiplyScalar((a-n)*.5));d.applyMatrix4(u);var _=new e.MeshLambertMaterial({color:o,transparent:true});var p=new e.Mesh(d,_);p.matrixAutoUpdate=false;p.userData.color=o;var c=new e.CylinderGeometry(0,h,n,12,1);u.setPosition(t.clone().multiplyScalar(a-n*.5));c.applyMatrix4(u);var m=new e.Mesh(c,_);m.matrixAutoUpdate=false;p.add(m);var g=new e.CylinderGeometry(l*.5,l*.5,l,12,1);g.applyMatrix4(u);var v=new e.CylinderGeometry(l*.5,l*.2,l,12,1);u.setPosition(t.clone().multiplyScalar(a*.5));v.applyMatrix4(u);var y=i.mergeGeometries([g,v]);r.add(new e.Mesh(y,_));return p}function s(t,i,o){var r=new Float32Array(9);r[t]=r[i+6]=1;r[t+3]=r[i+3]=.5;var a=new e.BufferGeometry;var s=new Float32Array(12);s[3+t]=s[6+i]=s[9+t]=s[9+i]=.333;a.setAttribute("position",new e.Float32BufferAttribute(s,3));a.setIndex([0,2,1,1,2,3]);var n=new e.MeshBasicMaterial({color:16776960,opacity:.5,transparent:true,visible:false,side:e.DoubleSide});var h=new e.Mesh(a,n);h.matrixAutoUpdate=false;h.userData.colors=r;var l=new e.BufferGeometry;var d=new Float32Array(9);d[t]=d[t+3]=d[i+3]=d[i+6]=.333;l.setAttribute("position",new e.Float32BufferAttribute(d,3));l.setAttribute("color",new e.Float32BufferAttribute(r,3));var u=new e.Line(l,new e.LineBasicMaterial({vertexColors:true,transparent:true,linewidth:window.devicePixelRatio}));u.matrixAutoUpdate=false;h.add(u);o.add(new e.Mesh(a,new e.MeshBasicMaterial({side:e.DoubleSide})));return h}function n(t,i,o,r){var a=new e.TorusGeometry(o,1/96,4,r,Math.PI/2);if(t===0){a.rotateY(Math.PI/-2)}else if(t===1){a.rotateX(Math.PI/2)}var s=new e.Mesh(a,new e.MeshBasicMaterial({color:i,transparent:true}));s.matrixAutoUpdate=false;s.userData.color=i;return s}function h(t,i,o){var r=new e.TorusGeometry(i,16/96,4,o,Math.PI/2);if(t===0){r.rotateY(Math.PI/-2)}else if(t===1){r.rotateX(Math.PI/2)}return new e.Mesh(r,new e.MeshBasicMaterial({opacity:.2,transparent:true}))}this._gizmo.add(r(new e.Vector3(1,0,0),a.x,this._touchAreas));this._gizmo.add(r(new e.Vector3(0,1,0),a.y,this._touchAreas));this._gizmo.add(r(new e.Vector3(0,0,1),a.z,this._touchAreas));this._gizmo.add(s(1,2,this._touchAreas));this._gizmo.add(s(2,0,this._touchAreas));this._gizmo.add(s(0,1,this._touchAreas));for(var l=0;l<3;l++){this._gizmo.add(n(l,a[["x","y","z"][l]],1,32));this._touchAreas.add(h(l,1,24))}var d=new e.MeshBasicMaterial({color:33023,opacity:.5,transparent:true,side:e.DoubleSide});this._arcMesh=new e.Mesh(new e.BufferGeometry,d);this._arcMesh.visible=false;this._gizmo.add(this._arcMesh);this._axisTitles=this._createAxisTitles();this._sceneGizmo.add(this._axisTitles);var u=new e.BufferGeometry;u.setAttribute("position",new e.Float32BufferAttribute(new Float32Array(6),3));this._line=new e.LineSegments(u,new e.LineBasicMaterial);this._line.frustumCulled=false;this._line.visible=false;this._gizmo.add(this._line)};h.prototype.hasDomElement=function(){return true};h.prototype._updateHandlesVisibility=function(){var t=this._tool.getAllowOperation();var e=t!==s.Rotate;var i=t!==s.Move;var o;for(o=0;o<3;o++){this._touchAreas.children[o].visible=e}for(o=3;o<6;o++){this._gizmo.children[o].visible=this._touchAreas.children[o].visible=e}for(o=6;o<9;o++){this._gizmo.children[o].visible=this._touchAreas.children[o].visible=i}};h.prototype._initAnchorPoint=function(t){t._anchorPoint=this._gizmo};h.prototype.show=function(t,e){this._viewport=t;this._tool=e;this._updateHandlesVisibility();this._initAnchorPoint(t)};h.prototype.hide=function(){this._viewport=null;this._tool=null};h.prototype.setPosition=function(t){this._gizmo.position.copy(t);this._gizmo.updateMatrixWorld()};h.prototype.setQuaternion=function(t){this._gizmo.quaternion.copy(t);this._gizmo.updateMatrixWorld()};h.prototype.getGizmoCount=function(){return 1};h.prototype.getTouchObject=function(t){this._touchAreas.position.copy(this._gizmo.position);this._touchAreas.quaternion.copy(this._gizmo.quaternion);this._touchAreas.scale.copy(this._gizmo.scale);this._touchAreas.updateMatrixWorld(true);return this._touchAreas};var l=[1,2,4,6,5,3,1,2,4];h.prototype.highlightHandle=function(t,e){var i;for(i=0;i<3;i++){var o=this._gizmo.children[i];var r=l[t]&1<<i;var a=r?16776960:o.userData.color;o.material.color.setHex(a);o.children[0].material.color.setHex(a);this._axisTitles.children[i].material.color.setHex(a)}for(i=3;i<6;i++){var n=this._gizmo.children[i];n.material.visible=i===t;var h=n.children[0].geometry.attributes.color;h.copyArray(i===t?[1,1,0,1,1,0,1,1,0]:n.userData.colors);h.needsUpdate=true;n.children[0].material.opacity=i===t||e&&t===-1?1:.35;n.children[0].visible=i===t||e}for(i=6;i<9;i++){var d=this._gizmo.children[i];d.visible=this._tool.getAllowOperation()!==s.Move&&(i===t||e);d.material.color.setHex(i===t?16776960:d.userData.color);d.material.opacity=i===t||e&&t===-1?1:.35}};h.prototype.selectHandle=function(e){this._handleIndex=e;if(e>=0&&e<3){this._units.setText(t().getText("TOOL_UNITS_MM"))}else if(e>=6&&e<9){this._units.setText(String.fromCharCode(176))}this._editingForm.rerender();this._viewport.setShouldRenderFrame()};h.prototype.beginGesture=function(){this._isMoved=false;this._isRotated=false;this._originPosition=(new e.Vector3).setFromMatrixPosition(this._gizmo.matrixWorld);this._originQuaternion=this._gizmo.quaternion.clone()};h.prototype.endGesture=function(){if(this._isMoved){this._tool.fireMoved({x:this._moveDelta.x,y:this._moveDelta.y,z:this._moveDelta.z})}if(this._isRotated){this._tool.fireRotated({x:this._rotationDelta.x,y:this._rotationDelta.y,z:this._rotationDelta.z})}this._line.visible=false;this._arcMesh.visible=false};h.prototype._setOffset=function(t,i){if(this._tool.fireEvent("moving",{x:t.x,y:t.y,z:t.z},true)){this._move(t);var o=(new e.Matrix4).copy(this._gizmo.matrixWorld).invert();var r=(new e.Vector3).setFromMatrixScale(this._gizmo.matrixWorld);var a=this._gizmo.position.clone().applyMatrix4(o);t.copy(this._originPosition).applyMatrix4(o).sub(a).multiply(r);var s=this._line.geometry.getAttribute("position");s.array.set(t.toArray());s.needsUpdate=true;this._line.geometry.computeBoundingBox();t.set(Math.abs(t.x),Math.abs(t.y),Math.abs(t.z));t.multiplyScalar(1/Math.max(t.x,t.y,t.z));this._line.material.color.setRGB(t.x,t.y,t.z);this._line.visible=true}};h.prototype._move=function(t){if(this._tool.getAllowOperation()===s.Rotate){return this}this._isMoved=true;this._moveDelta.copy(t);this._gizmo.position.copy(this._originPosition).add(t);this._viewport.setShouldRenderFrame();return this};h.prototype.move=function(t,i,o){this.beginGesture();this._move(new e.Vector3(t,i,o||0))};h.prototype._setRotationAxisAngle=function(t,i,o){var r=(o-i)%(Math.PI*2);var a=[0,0,0];a[t]=r;a=(new e.Euler).fromArray(a);if(this._tool.fireEvent("rotating",{x:e.MathUtils.radToDeg(a.x),y:e.MathUtils.radToDeg(a.y),z:e.MathUtils.radToDeg(a.z)},true)){this._rotate(a);var s=[0,0,0];var n=new e.Vector3;var h=(t+1)%3,l=(t+2)%3;var d,u=Math.max(Math.ceil(Math.abs(r)*64/Math.PI),1);for(d=0;d<=u;d++){var _=i-r*(d/u);n.set(0,0,0).setComponent(h,Math.cos(_)).setComponent(l,Math.sin(_));s.push(n.x,n.y,n.z)}var p=[];for(d=0;d<u;d++){p.push(0,d+1,d+2)}var c=this._arcMesh.geometry;c.setIndex(p);c.setAttribute("position",new e.Float32BufferAttribute(s,3));this._arcMesh.visible=true}};h.prototype._rotate=function(t){if(this._tool.getAllowOperation()===s.Move){return this}this._tool._deactivateScreenAlignment();this._isRotated=true;this._rotationDelta.set(e.MathUtils.radToDeg(t.x),e.MathUtils.radToDeg(t.y),e.MathUtils.radToDeg(t.z));var i=(new e.Quaternion).setFromEuler(t);this._gizmo.quaternion.copy(this._originQuaternion).multiply(i);this._viewport.setShouldRenderFrame();return this};h.prototype.rotate=function(t,i,o){this.beginGesture();this._rotate(new e.Euler(e.MathUtils.degToRad(t||0),e.MathUtils.degToRad(i||0),e.MathUtils.degToRad(o||0)))};h.prototype._getValueLocaleOptions=function(){return this._handleIndex>=0&&this._handleIndex<3?{useGrouping:false}:{useGrouping:false,minimumFractionDigits:1,maximumFractionDigits:2}};h.prototype.getValue=function(){if(this._handleIndex>=0&&this._handleIndex<3){var t=(new e.Vector3).setFromMatrixColumn(this._gizmo.matrixWorld,this._handleIndex).normalize();return t.dot(this._gizmo.position)}if(this._handleIndex>=6&&this._handleIndex<9){return e.MathUtils.radToDeg(this._gizmo.rotation.reorder("YXZ")[["x","y","z"][this._handleIndex-6]])}return 0};h.prototype.setValue=function(t){if(this._handleIndex>=0&&this._handleIndex<3){var i=(new e.Vector3).setFromMatrixColumn(this._gizmo.matrixWorld,this._handleIndex).normalize().multiplyScalar(t-this.getValue());this.beginGesture();this._move(i);this.endGesture()}else if(this._handleIndex>=6&&this._handleIndex<9){var o=this._gizmo.rotation.clone();o[["x","y","z"][this._handleIndex-6]]=e.MathUtils.degToRad(t);var r=(new e.Quaternion).setFromEuler(o);var a=this._gizmo.quaternion.clone().invert().multiply(r);o.setFromQuaternion(a);this.beginGesture();this._rotate(o);this.endGesture()}};h.prototype.expandBoundingBox=function(t){if(this._viewport){this._expandBoundingBox(t,this._viewport.getCamera().getCameraRef(),true)}};h.prototype._updateGizmoTransformation=function(t,e){this._matViewProj.multiplyMatrices(e.projectionMatrix,e.matrixWorldInverse);var i=this._getGizmoScale(this._gizmo.position);this._gizmo.scale.setScalar(this._gizmoSize*i);this._gizmo.updateMatrixWorld(true);this._updateAxisTitles(this._axisTitles,this._gizmo,e,this._gizmoSize+18,i);this._line.scale.setScalar(1/(this._gizmoSize*i))};h.prototype._getEditingFormPosition=function(){var t=this._getGizmoScale(this._gizmo.position);var i=new e.Vector3;if(this._handleIndex>=0&&this._handleIndex<3){i.setFromMatrixColumn(this._gizmo.matrixWorld,this._handleIndex).normalize()}else if(this._handleIndex>=6&&this._handleIndex<9){var o=this._handleIndex%3;var r=this._extractBasis(this._gizmo.matrixWorld);i.copy(r[(o+1)%3]).add(r[(o+2)%3]).normalize()}return i.clone().multiplyScalar((this._gizmoSize+18)*t).add(this._gizmo.position).applyMatrix4(this._matViewProj)};h.prototype.render=function(){n(this._viewport&&this._viewport.getMetadata().getName()==="sap.ui.vk.threejs.Viewport","Can't render gizmo without sap.ui.vk.threejs.Viewport");var t=this._viewport.getRenderer(),e=this._viewport.getCamera().getCameraRef();t.clearDepth();this._updateGizmoTransformation(0,e);t.render(this._sceneGizmo,e);this._updateEditingForm(this._handleIndex>=0&&this._handleIndex<3||this._handleIndex>=6&&this._handleIndex<9,this._handleIndex%3)};return h});
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/tools/AnchorPointToolHandler", ["sap/ui/base/EventProvider","sap/m/Menu","sap/m/MenuItem","../getResourceBundle","../thirdparty/three"],function(t,e,i,s,n){"use strict";var r=t.extend("sap.ui.vk.tools.AnchorPointToolHandler",{metadata:{library:"sap.ui.vk"},constructor:function(t){this._priority=10;this._tool=t;this._gizmo=t.getGizmo();this._rect=null;this._rayCaster=new n.Raycaster;this._handleIndex=-1;this._gizmoIndex=-1;this._handleAxis=new n.Vector3;this._gizmoOrigin=new n.Vector3;this._gizmoScale=1;this._matrixOrigin=new n.Matrix4;this._rotationOrigin=new n.Matrix4;this._mouse=new n.Vector2;this._mouseOrigin=new n.Vector2}});r.prototype._updateMouse=function(t){var e=this.getViewport().getRenderer().getSize(new n.Vector2);this._mouse.x=(t.x-this._rect.x)/e.width*2-1;this._mouse.y=(t.y-this._rect.y)/e.height*-2+1;this._rayCaster.setFromCamera(this._mouse,this.getViewport().getCamera().getCameraRef())};r.prototype._updateHandles=function(t,e){var i=this._handleIndex;this._handleIndex=-1;if(t.n===1||t.event&&t.event.type==="contextmenu"){for(var s=0,n=this._gizmo.getGizmoCount();s<n;s++){var r=this._gizmo.getTouchObject(s);var a=this._rayCaster.intersectObject(r,true);if(a.length>0){this._handleIndex=r.children.indexOf(a[0].object);if(this._handleIndex>=0){this._gizmoIndex=s;this._gizmoOrigin.setFromMatrixPosition(r.matrixWorld);this._matrixOrigin.copy(r.matrixWorld);this._gizmoScale=r.scale.x;this._rotationOrigin.extractRotation(r.matrixWorld);if(this._handleIndex<3){this._handleAxis.setFromMatrixColumn(r.matrixWorld,this._handleIndex).normalize()}else if(this._handleIndex<6){this._handleAxis.setFromMatrixColumn(r.matrixWorld,this._handleIndex-3).normalize()}else if(this._handleIndex<9){this._handleAxis.setFromMatrixColumn(r.matrixWorld,this._handleIndex-6).normalize()}}}}}this._gizmo.highlightHandle(this._handleIndex,e||this._handleIndex===-1);if(i!==this._handleIndex){this.getViewport().setShouldRenderFrame()}};r.prototype.hover=function(t){if(this._inside(t)&&!this._gesture){this._updateMouse(t);this._updateHandles(t,true);t.handled|=this._handleIndex>=0}};r.prototype.click=function(t){if(this._inside(t)&&!this._gesture){this._updateMouse(t);this._updateHandles(t,true);this._gizmo.selectHandle(this._handleIndex);t.handled|=this._handleIndex>=0}};var a=new n.Vector3;r.prototype._getAxisOffset=function(){var t=this._rayCaster.ray;var e=this._handleAxis.clone().cross(t.direction).cross(t.direction).normalize();a.copy(t.origin).sub(this._gizmoOrigin);return e.dot(a)/e.dot(this._handleAxis)};r.prototype._getPlaneOffset=function(){var t=this._rayCaster.ray;a.copy(this._gizmoOrigin).sub(t.origin);var e=this._handleAxis.dot(a)/this._handleAxis.dot(t.direction);return t.direction.clone().multiplyScalar(e).sub(a)};r.prototype._getMouseAngle=function(){var t=this._rayCaster.ray;var e=this._rotationPoint.clone().sub(t.origin);var i=this._rotationAxis.dot(e)/this._rotationAxis.dot(t.direction);var s=t.direction.clone().multiplyScalar(i).sub(e).normalize();return Math.atan2(s.dot(this._axis2),s.dot(this._axis1))};r.prototype.beginGesture=function(t){if(this._inside(t)&&!this._gesture){this._updateMouse(t);this._updateHandles(t,false);if(this._handleIndex>=0){t.handled=true;this._gesture=true;this._mouseOrigin.copy(t);this._gizmo.selectHandle(this._handleIndex);this._gizmo.beginGesture();if(this._handleIndex<3){this._dragOrigin=this._getAxisOffset()}else if(this._handleIndex<6){this._dragOrigin=this._getPlaneOffset()}else if(this._handleIndex<9){this._axis1=(new n.Vector3).setFromMatrixColumn(this._matrixOrigin,(this._handleIndex+1)%3).normalize();this._axis2=(new n.Vector3).setFromMatrixColumn(this._matrixOrigin,(this._handleIndex+2)%3).normalize();this._rotationAxis=(new n.Vector3).crossVectors(this._axis1,this._axis2).normalize();this._rotationPoint=(new n.Vector3).setFromMatrixPosition(this._matrixOrigin);if(Math.abs(this._rayCaster.ray.direction.dot(this._rotationAxis))<Math.cos(Math.PI*85/180)){var e=this.getViewport().getCamera().getCameraRef().matrixWorld;this._axis1.setFromMatrixColumn(e,0).normalize();this._axis2.setFromMatrixColumn(e,1).normalize();this._rotationAxis.setFromMatrixColumn(e,2).normalize()}var i=this._axis1.clone();var s=2;for(var r=0;r<3;r++){var a=(new n.Vector3).setComponent(r,1);var o=this._rotationAxis.dot(a);if(s>o){s=o;i.copy(a)}}i.sub(this._rotationAxis.clone().multiplyScalar(i.dot(this._rotationAxis))).normalize();this._levelAngle=Math.atan2(i.dot(this._axis2),i.dot(this._axis1));this._startAngle=this._getMouseAngle();this._prevDeltaAngle=0}}}};r.prototype._setOffset=function(t){if(this._tool.getEnableStepping()){var e=Math.pow(10,Math.round(Math.log10(this._gizmoScale)))*.1;var i=(new n.Matrix4).copy(this._rotationOrigin).invert();var s=this._gizmoOrigin.clone().applyMatrix4(i);var r=this._gizmoOrigin.clone().add(t).applyMatrix4(i);for(var o=0;o<3;o++){var h=r.getComponent(o);if(Math.abs(h-s.getComponent(o))>e*1e-5){var _=Math.round(h/e)*e;a.setFromMatrixColumn(this._rotationOrigin,o).multiplyScalar(_-h);t.add(a)}}}this._gizmo._setOffset(t,this._gizmoIndex)};r.prototype.move=function(t){if(this._gesture){t.handled=true;this._updateMouse(t);if(this._handleIndex<3){if(isFinite(this._dragOrigin)){this._setOffset(this._handleAxis.clone().multiplyScalar(this._getAxisOffset()-this._dragOrigin))}}else if(this._handleIndex<6){if(isFinite(this._dragOrigin.x)&&isFinite(this._dragOrigin.y)&&isFinite(this._dragOrigin.z)){this._setOffset(this._getPlaneOffset().sub(this._dragOrigin))}}else if(this._handleIndex<9){var e=this._startAngle;var i=this._getMouseAngle()-e;if(i>Math.PI){i-=Math.PI*2}else if(i<-Math.PI){i+=Math.PI*2}if(Math.abs(this._prevDeltaAngle)>Math.PI/4){if(this._prevDeltaAngle*i<0){i+=Math.PI*2*Math.sign(this._prevDeltaAngle)}}i=i%(Math.PI*2);var s=e+i;if(this._tool.getEnableStepping()){var r=n.MathUtils.degToRad(5);var a=s-e-this._levelAngle;s+=Math.round(a/r)*r-a}this._prevDeltaAngle=s-e;if(isFinite(e)&&isFinite(s)){this._gizmo._setRotationAxisAngle(this._handleIndex-6,e,s)}}}};r.prototype.endGesture=function(t){if(this._gesture){this._gesture=false;t.handled=true;this._updateMouse(t);this._gizmo.endGesture();this._dragOrigin=undefined;this._updateHandles(t,true);this.getViewport().setShouldRenderFrame()}};function o(t){var e=[];if(t){t.enumerateSelection(function(t){e.push(t)})}return e}r.prototype.contextMenu=function(t){if(!this._tool.getAllowContextMenu()){return}if(this._inside(t)){this._updateMouse(t);this._updateHandles(t,true);if(this._handleIndex>=0){t.handled=true;var r=this.getViewport();var a=new e({items:[new i({text:s().getText("ANCHOR_POINT_TOOL_MOVE_TO_WORLD_ORIGIN")}),new i({text:s().getText("ANCHOR_POINT_TOOL_MOVE_TO_SELECTION_CENTER")}),new i({text:s().getText("ANCHOR_POINT_TOOL_MOVE_TO_SCENE_CENTER")}),new i({text:s().getText("ANCHOR_POINT_TOOL_MOVE_TO_SELECTED_OBJECTS_ORIGIN")})],itemSelected:function(t){var e=t.getParameters("item").item;var i=t.getSource().indexOfItem(e);var s=new n.Vector3;switch(i){default:case 0:break;case 1:this._tool.moveTo(o(r._viewStateManager),false);return;case 2:var a=r.getScene()?r.getScene().getSceneRef():null;if(a){var h=new n.Box3;a._expandBoundingBox(h,null,true);h.getCenter(s)}break;case 3:this._tool.moveTo(o(r._viewStateManager),true);return}this._gizmo.setPosition(s);r.setShouldRenderFrame()}.bind(this)});a.openAsContextMenu(t.event,r)}}};r.prototype.getViewport=function(){return this._tool._viewport};r.prototype._getOffset=function(t){var e=t.getBoundingClientRect();var i={x:e.left+window.pageXOffset,y:e.top+window.pageYOffset};return i};r.prototype._inside=function(t){var e=this._tool._viewport.getIdForLabel();var i=document.getElementById(e);if(i===null){return false}var s=this._getOffset(i);this._rect={x:s.x,y:s.y,w:i.offsetWidth,h:i.offsetHeight};return t.x>=this._rect.x&&t.x<=this._rect.x+this._rect.w&&t.y>=this._rect.y&&t.y<=this._rect.y+this._rect.h};return r});
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/tools/AnchorPointToolOperation", ["sap/ui/base/DataType"],function(e){"use strict";var t={All:"All",Rotate:"Rotate",Move:"Move"};e.registerEnum("sap.ui.vk.tools.AnchorPointToolOperation",t);return t},true);
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/tools/AngleMeasurementTool", ["./Tool","./MeasurementToolHandler","./AngleMeasurementToolGizmo"],function(t,i,e){"use strict";var s=t.extend("sap.ui.vk.tools.AngleMeasurementTool",{metadata:{library:"sap.ui.vk"}});var o=s.getMetadata().getParent().getClass().prototype;s.prototype.init=function(){if(o.init){o.init.call(this)}this._viewport=null;this._handler=new i(this);this.setFootprint(["sap.ui.vk.threejs.Viewport","sap.ui.vk.svg.Viewport"]);this.setGizmo(new e)};s.prototype.exit=function(){o.exit.apply(this,arguments)};s.prototype.setActive=function(t,i,e){o.setActive.call(this,t,i,e);if(this._viewport){if(t){this._gizmo=this.getGizmo();if(this._gizmo){this._gizmo.show(this._viewport,this)}this._addLocoHandler();this._viewport.addStyleClass("sapUiVizKitAngleCursor")}else{this._viewport.removeStyleClass("sapUiVizKitAngleCursor");this._removeLocoHandler();if(this._gizmo){this._gizmo.hide();this._gizmo=null}}}return this};return s});
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/tools/AngleMeasurementToolGizmo", ["../measurements/Angle","../measurements/Utils","./MeasurementToolState","./MeasurementToolGizmo"],function(e,t,r,i){"use strict";var s=i.extend("sap.ui.vk.tools.AngleMeasurementToolGizmo",{metadata:{library:"sap.ui.vk"},renderer:null});var a=s.getMetadata().getParent().getClass().prototype;s.prototype.init=function(){if(a.init){a.init.call(this)}this._thirdFeature=null};s.prototype._updateCurrentFeature=function(e,i,s,a,u,n){var h=e==null?null:this._getMeshAnalyzer(e);var c=false;var _=false;var o=this._firstFeature&&this._firstFeature.isEdge;if(h!=null&&(a||u||n)){const e=this._computeSphereRadius(i,s);const f=this._getPointRadius(s);const F=h.intersectSphere(i,e,a,u,n,false,false,f);if(this._is2D){if(!o&&F.vertex!=null){if(this._replaceCurrentFeature(this._vertexFeatures[this._currentFeatureIndex],F.vertexId,h)){this._currentFeature.setValue(F.vertex);return true}}else if(F.edge!=null){if(this._state===r.SearchingSecondFeature&&this._firstFeature.getFeatureId()===F.edgeId&&this._firstFeature.getContext()===h){c=true}else if(this._replaceCurrentFeature(this._edgeFeatures[this._currentFeatureIndex],F.edgeId,h)){this._currentFeature.setValue(F.edge);return true}}else if(o){c=true}else{this._replaceCurrentFeature(this._vertexFeatures[this._currentFeatureIndex],null,h);this._currentFeature.setValue(i);return true}}else{if(F.vertexId!=null){if(this._replaceCurrentFeature(this._vertexFeatures[this._currentFeatureIndex],F.vertexId,h)){this._currentFeature.setValue(h.getVertex(F.vertexId));return true}}else if(F.edgeId!=null){if(this._replaceCurrentFeature(this._edgeFeatures[this._currentFeatureIndex],F.edgeId,h)){this._currentFeature.setValue(h.buildEdgePath(F.edgeId,true));return true}}else if(F.faceId!=null){if(this._state===r.SearchingSecondFeature&&this._firstFeature.getFeatureId()===F.faceId&&this._firstFeature.getContext()===h){c=true}else if(this._replaceCurrentFeature(this._faceFeatures[this._currentFeatureIndex],F.faceId,h)){var l=h.buildFace(F.faceId);if(this._state===r.SearchingSecondFeature&&!t.intersectPlanes(this._firstFeature.getValue().planeEquation,l.planeEquation)){c=true}else{this._currentFeature.setValue(l);return true}}_=true}else{c=true}}}else if(o){c=true}else{this._replaceCurrentFeature(this._vertexFeatures[this._currentFeatureIndex],null,h);this._currentFeature.setValue(i);return true}if(c&&this._currentFeature){this._surface.removeFeature(this._currentFeature);this._currentFeature=null;return true}return _};s.prototype._trimByContour=function(e,r,i,s){var a=[r[0],r[1],r[2],i[0],i[1],i[2]];var u,n=null;var h,c,_;var o=e.edges;var l=e.vertices;for(var f=0,F=o.length;f<F;f+=2){h=3*o[f];c=3*o[f+1];_=t.intersectLines(a,[l[h],l[h+1],l[h+2],l[c],l[c+1],l[c+2]]);u=_&&_[1]>=0&&_[1]<=1?_[0]:null;if(u){if(n){if(u<n[0]){n[0]=u}if(u>n[1]){n[1]=u}}else{n=[u,u]}}}var v=null;if(n&&s){if(s>n[0]&&s<n[1]){v=s}else if(n[1]>0&&n[1]<1){v=n[1]}}else if(n&&n[1]>0&&n[1]<1){v=n[1]}else if(s&&s>0&&s<1){v=s}return v?t.pointOnLine(a,v):i};s.prototype._updateFace2FaceMeasurement=function(e){var r=this._firstFeature.getValue();var i=this._currentFeature.getValue();var s=t.intersectPlanes(r.planeEquation,i.planeEquation);var a,u,n,h,c,_;var o,l,f;var F=r.vertices;for(var v=0,d=F.length;v<d;v+=3){a=[F[v],F[v+1],F[v+2]];u=t.projectPointToLine(s,a);o=t.computePointToPointDistance2(a,t.pointOnLine(s,u));if(v===0){n=u;h=u;c=a;_=a;l=a;f=o}if(u<n){n=u;c=a}if(u>h){h=u;_=a}if(o>f){f=o;l=a}}var g=t.projectPointToLine(s,e);var p=t.pointOnLine(s,g);if(g<=n){this._currentMeasurement.setPoint1(c);this._currentMeasurement.setPoint2(t.pointOnLine(s,n))}else if(g>=h){this._currentMeasurement.setPoint1(_);this._currentMeasurement.setPoint2(t.pointOnLine(s,h))}else{var m=t.pointOnLine(s,t.projectPointToLine(s,l));var P=t.pointMinusPoint(m,p);a=t.pointMinusPoint(l,P);var S=t.computePointToPointDistance(p,a);var M=t.computePointToPointDistance(p,e);this._currentMeasurement.setPoint1(this._trimByContour(r,p,a,S>0?M/S:1));this._currentMeasurement.setPoint2(p)}this._currentMeasurement.setPoint3(p);this._currentMeasurement.setPoint4(e);this._currentMeasurement.computeAngle();var x=Math.acos(t.dotProduct(r.planeEquation,i.planeEquation));var C=Math.PI-x;var I=this._currentMeasurement.getAngle();this._currentMeasurement.setAngle(Math.abs(x-I)<Math.abs(C-I)?x:C)};s.prototype._updateMeasurement=function(e){if(this._state===r.DefiningAngle){var t=this._viewport;var i=t.getCamera();var s=e.getPoints();var a=t.projectToScreen(s[0],s[1],s[2],i);var u=t.projectToScreen(s[3],s[4],s[5],i);var n=t.projectToScreen(s[6],s[7],s[8],i);var h=t.projectToScreen(s[9],s[10],s[11],i);var c=t.projectToScreen(s[12],s[13],s[14],i);var _=t.projectToScreen(s[15],s[16],s[17],i);var o=n.x-h.x;var l=n.y-h.y;var f=this._hoverPoint.screenPoint;e.setAngleRadius([a.x-o,a.y-l,0],[u.x-o,u.y-l,0],[h.x,h.y,0],[c.x,c.y,0],[_.x,_.y,0],[f[0],f[1],0]);return}var F=this._hoverPoint.worldPoint.slice();if(this._currentFeature&&this._currentFeature.isVertex){var v=this._currentFeature.getValue();F[0]=v[0];F[1]=v[1];F[2]=v[2]}if(this._state===r.SearchingSecondFeature){if(this._currentFeature&&this._currentFeature.isEdge){var d=this._currentFeature.getValue();e.setPoint3(d);e.setPoint4([d[3],d[4],d[5]]);e.computeAngle()}else if(this._firstFeature.isVertex){e.setPoint2(F);e.setPoint3(F);e.setPoint4(F);e.computeAngle()}else if(this._currentFeature&&this._currentFeature.isFace){this._updateFace2FaceMeasurement(F);e.setState(1)}}else if(this._state===r.SearchingThirdFeature){e.setPoint4(F);e.setState(1);e.computeAngle()}};s.prototype.setHoverPoint=function(e){var t=this._hoverPoint&&this._hoverPoint.nodeRef;var i=e&&e.nodeRef;if(i!=t){var s=this._vsm;if(s!=null){var a=i!=null?[i]:[];var u=t!=null?[t]:[];s.setOutliningStates(a,u,false,true)}}this._hoverPoint=e;var n=this._state===r.DefiningAngle;var h=this._state===r.SearchingSecondFeature||this._state===r.SearchingThirdFeature||this._state===r.DefiningAngle?this._currentMeasurement:null;if(!n&&(!e||e.worldPoint==null)){if(h){h.setVisible(n);this._surface.update(this._viewport,this._viewport.getCamera())}if(this._currentFeature){this._surface.removeFeature(this._currentFeature);this._currentFeature=null}}else{var c=this._settings;var _=!e.shiftKey&&c.featureFace&&!this._is2D;var o=!e.shiftKey&&c.featureEdge;var l=!e.shiftKey&&c.featureVertex;if(this._firstFeature){_=this._firstFeature.isFace;o=this._firstFeature.isEdge;l=this._firstFeature.isVertex}if(n){_=false;o=false;l=false}var f=true;if((i||this._is2D)&&!n){f=this._updateCurrentFeature(i,this._hoverPoint.worldPoint,this._viewport,_,o,l)}else if(this._currentFeature){this._surface.removeFeature(this._currentFeature);this._currentFeature=null}if(h&&f){this._updateMeasurement(h);h.setVisible(n||this._currentFeature!=null)}this._surface.update(this._viewport,this._viewport.getCamera())}return this};s.prototype.fixPoint=function(t){this.setHoverPoint(t);var i=this._vsm;var s=this._hoverPoint&&this._hoverPoint.nodeRef;var a=this._state;switch(a){case r.SearchingFirstFeature:if(!t.worldPoint){break}this._firstFeature=this._currentFeature;this._currentFeature=null;this.setCurrentFeatureIndex(1);this._state=r.SearchingSecondFeature;var u=t.worldPoint.slice();var n=t.worldPoint.slice();if(this._firstFeature&&this._firstFeature.isVertex){var h=this._firstFeature.getValue();u[0]=h[0];u[1]=h[1];u[2]=h[2]}var c=0;if(this._firstFeature&&this._firstFeature.isEdge){var _=this._firstFeature.getValue();u[0]=_[0];u[1]=_[1];u[2]=_[2];n[0]=_[3];n[1]=_[4];n[2]=_[5];c=1}var o=new e({point1:u,point2:n,point3:n,point4:n,state:c});this._surface.beginMeasurementConstruction(o);this._currentMeasurement=o;break;case r.SearchingSecondFeature:if(!this._currentMeasurement.getVisible()||!this._currentMeasurement.isEdge1Defined()){break}this._surface.update(this._viewport,this._viewport.getCamera());if(s!=null&&i!=null){i.setOutliningStates([],[s],false,true)}this._secondFeature=this._currentFeature;this._currentFeature=null;this.setCurrentFeatureIndex(2);this._state=this._currentMeasurement.getState()===1?r.DefiningAngle:r.SearchingThirdFeature;break;case r.SearchingThirdFeature:if(!this._currentMeasurement.isEdge2Defined()){break}this._surface.update(this._viewport,this._viewport.getCamera());if(s!=null&&i!=null){i.setOutliningStates([],[s],false,true)}this._thirdFeature=this._currentFeature;this._currentFeature=null;this.setCurrentFeatureIndex(3);this._state=r.DefiningAngle;break;case r.DefiningAngle:if(!this._currentMeasurement.isEdge2Defined()){break}this._currentMeasurement.setState(2);this._currentMeasurement.setFeatures(this._thirdFeature!=null?[this._firstFeature,this._secondFeature,this._thirdFeature]:[this._firstFeature,this._secondFeature]);this._surface.update(this._viewport,this._viewport.getCamera());if(s!=null&&i!=null){i.setOutliningStates([],[s],false,true)}this._state=r.SearchingFirstFeature;if(this._currentFeature){this._surface.removeFeature(this._currentFeature)}this._surface.removeFeature(this._thirdFeature);this._surface.removeFeature(this._secondFeature);this._surface.removeFeature(this._firstFeature);this._currentFeature=null;this._firstFeature=null;this._secondFeature=null;this._thirdFeature=null;this.setCurrentFeatureIndex(0);var l=this._currentMeasurement;this._currentMeasurement=null;this._surface.endMeasurementConstruction(l);break;default:break}return this};s.prototype.escapePressed=function(){switch(this._state){case r.DefiningAngle:this._state=r.SearchingThirdFeature;this._currentMeasurement.setRadiusScale(1);if(this._currentFeature){this._surface.removeFeature(this._currentFeature);this._currentFeature=null}if(this._thirdFeature){this._surface.removeFeature(this._thirdFeature);this._thirdFeature=null;this.setCurrentFeatureIndex(2)}if(!this._firstFeature.isVertex){this._state=r.SearchingSecondFeature;this._surface.removeFeature(this._secondFeature);this._secondFeature=null;this.setCurrentFeatureIndex(1);this._currentMeasurement.setVisible(false)}break;case r.SearchingThirdFeature:this._state=r.SearchingSecondFeature;this._currentMeasurement.setState(0);this._surface.removeFeature(this._secondFeature);this._secondFeature=null;this.setCurrentFeatureIndex(1);if(this._currentFeature){this._surface.removeFeature(this._currentFeature);this._currentFeature=null}break;case r.SearchingSecondFeature:this._state=r.SearchingFirstFeature;this._surface.removeFeature(this._firstFeature);this._firstFeature=null;if(this._currentFeature){this._surface.removeFeature(this._currentFeature);this._currentFeature=null}this.setCurrentFeatureIndex(0);this._surface.cancelMeasurementConstruction(this._currentMeasurement);this._currentMeasurement=null;break;case r.SearchingFirstFeature:var e=this._vsm;var t=this._hoverPoint&&this._hoverPoint.nodeRef;if(t!=null&&e!=null){e.setOutliningStates([],[t],false,true)}if(this._currentFeature!=null){this._surface.removeFeature(this._currentFeature);this._currentFeature=null}this._state=r.Off;this._tool.setActive(false,this._viewport);break;default:break}if(this._currentMeasurement){this._updateMeasurement(this._currentMeasurement)}if(this._state!==r.Off){this._surface.update(this._viewport,this._viewport.getCamera())}};s.prototype.is2D=function(){return this._is2D};return s});
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/tools/AreaMeasurementTool", ["./Tool","./MeasurementToolHandler","./AreaMeasurementToolGizmo"],function(t,i,e){"use strict";var s=t.extend("sap.ui.vk.tools.AreaMeasurementTool",{metadata:{library:"sap.ui.vk"}});var o=s.getMetadata().getParent().getClass().prototype;s.prototype.init=function(){if(o.init){o.init.call(this)}this._viewport=null;this._handler=new i(this);this.setFootprint(["sap.ui.vk.threejs.Viewport","sap.ui.vk.svg.Viewport"]);this.setGizmo(new e)};s.prototype.exit=function(){o.exit.apply(this,arguments)};s.prototype.setActive=function(t,i,e){o.setActive.call(this,t,i,e);if(this._viewport){if(t){this._gizmo=this.getGizmo();if(this._gizmo){this._gizmo.show(this._viewport,this)}this._addLocoHandler();this._viewport.addStyleClass("sapUiVizKitAreaCursor")}else{this._viewport.removeStyleClass("sapUiVizKitAreaCursor");this._removeLocoHandler();if(this._gizmo){this._gizmo.hide();this._gizmo=null}}}return this};return s});
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/tools/AreaMeasurementToolGizmo", ["../measurements/Area","../measurements/Face","../measurements/Utils","./MeasurementToolState","./MeasurementToolGizmo"],function(e,t,r,s,u){"use strict";var i=u.extend("sap.ui.vk.tools.AreaMeasurementToolGizmo",{metadata:{library:"sap.ui.vk"},renderer:null});var n=i.getMetadata().getParent().getClass().prototype;i.prototype.init=function(){if(n.init){n.init.call(this)}this._pointsCountPerClick=null};i.prototype.beginMeasurementConstruction=function(e){this._surface.beginMeasurementConstruction(e);this._currentMeasurement=e;this._pointsCountPerClick=[]};i.prototype.cancelMeasurementConstruction=function(){this._surface.cancelMeasurementConstruction(this._currentMeasurement);this._currentMeasurement=null;this._pointsCountPerClick=null};i.prototype.endMeasurementConstruction=function(){var e=this._currentMeasurement;this._currentMeasurement=null;this._surface.endMeasurementConstruction(e);this._pointsCountPerClick=null};i.prototype.updateContour=function(e,t){var r=e.length/3;if(this._pointsCountPerClick.length>0){var s=this._pointsCountPerClick[this._pointsCountPerClick.length-1];if(s===1&&r===1){this._currentMeasurement.replaceLastPoint(e)}else{this._currentMeasurement.replaceLastPoints(s,e,t);this._pointsCountPerClick[this._pointsCountPerClick.length-1]=r}}else{this._currentMeasurement.replaceLastPoints(0,e,t);this._pointsCountPerClick.push(r)}};i.prototype._finishArea=function(e){if(this._currentMeasurement.hasSelfIntersections()){return}var t=this._vsm;var r=this._hoverPoint&&this._hoverPoint.nodeRef;this._currentMeasurement.finalize();this._surface.update(this._viewport,this._viewport.getCamera());if(r!=null&&t!=null){t.setOutliningStates([],[r],false,true)}this._state=s.SearchingFirstFeature;if(e){this._currentMeasurement.setFeatures(this._vertexFeatures);for(var u=0,i=this._vertexFeatures.length;u<i;++u){this._surface.removeFeature(this._vertexFeatures[u])}}else if(this._currentFeature){this._currentMeasurement.setFeatures([this._currentFeature]);this._surface.removeFeature(this._currentFeature)}this._currentFeature=null;this.setCurrentFeatureIndex(0);this.endMeasurementConstruction()};i.prototype._updateCurrentFeature=function(t,u,i,n,a){var h=t==null?null:this._getMeshAnalyzer(t);var o=this._computeSphereRadius(u,i);var c=false;var _=false;var l=this._currentMeasurement?this._currentMeasurement.getPoints():null;var F=this._is2D;if(F&&l&&l.length>9&&!r.isClosedContour(l)&&r.computePointToPointDistance(u,l)<o){this._replaceCurrentFeature(this._vertexFeatures[this._currentFeatureIndex],null,h);this._currentFeature.setValue(l.slice(0,3));return true}if(h!=null){const t=this._getPointRadius(i);const l=h.intersectSphere(u,o,!F,F,F,n,a,t);if(F){if(!l.contour&&this._currentMeasurement&&this._state===s.SearchingFirstFeature){this.cancelMeasurementConstruction()}if(l.contour&&this._state===s.SearchingFirstFeature){if(this._replaceCurrentFeature(this._faceFeatures[this._currentFeatureIndex],l.contourId,h)){this._currentFeature.setValue({vertices:l.contour});return true}_=true}else if(l.curvedEdge!=null){if(!this._currentMeasurement){var f=new e({});this.beginMeasurementConstruction(f)}var v=l.curvedEdge;var p=v.length-3;var d=[v[0],v[1],v[2]];var C=[v[p],v[p+1],v[p+2]];var m=r.computePointToPointDistance2(u,d)>r.computePointToPointDistance2(u,C);this.updateContour(v,m);if(this._replaceCurrentFeature(this._vertexFeatures[this._currentFeatureIndex],l.curvedEdgeId+":"+(m?"r":"l"),h)){this._currentFeature.setValue(m?d:C);return true}}else if(l.vertex!=null){if(this._replaceCurrentFeature(this._vertexFeatures[this._currentFeatureIndex],l.vertexId,h)){this._currentFeature.setValue(l.vertex);return true}}else if(l.edge!=null){this._replaceCurrentFeature(this._vertexFeatures[this._currentFeatureIndex],l.edgeId,h);var g=l.edge;this._currentFeature.setValue(r.projectPointToEdge([g[0],g[1],g[2]],[g[3],g[4],g[5]],u));return true}else{this._replaceCurrentFeature(this._vertexFeatures[this._currentFeatureIndex],null,h);this._currentFeature.setValue(u);return true}}else{if(l.faceId!=null){if(this._replaceCurrentFeature(this._faceFeatures[this._currentFeatureIndex],l.faceId,h)){this._currentFeature.setValue(h.buildFace(l.faceId));return true}_=true}else{c=true}}}else if(F){if(this._currentMeasurement&&this._state===s.SearchingFirstFeature){this.cancelMeasurementConstruction()}this._replaceCurrentFeature(this._vertexFeatures[this._currentFeatureIndex],null,h);this._currentFeature.setValue(u);return true}if(c&&this._currentFeature){this._surface.removeFeature(this._currentFeature);this._currentFeature=null;return true}return _};i.prototype.setHoverPoint=function(t){var r=this._hoverPoint&&this._hoverPoint.nodeRef;var s=t&&t.nodeRef;if(s!=r){var u=this._vsm;if(u!=null){var i=s!=null?[s]:[];var n=r!=null?[r]:[];u.setOutliningStates(i,n,false,true)}}this._hoverPoint=t;if(!t||t.worldPoint==null){if(this._currentMeasurement){this.cancelMeasurementConstruction()}if(this._currentFeature){this._surface.removeFeature(this._currentFeature);this._currentFeature=null}}else{var a=true;if(s||this._is2D){var h=this._settings;var o=!t.shiftKey&&h.featureEdge;var c=!t.shiftKey&&h.featureFace;a=this._updateCurrentFeature(s,this._hoverPoint.worldPoint,this._viewport,c,o)}else if(this._currentFeature){this._surface.removeFeature(this._currentFeature);this._currentFeature=null}var _=this._currentMeasurement;if(this._currentFeature&&this._currentFeature.isFace){if(!_){_=new e({});this.beginMeasurementConstruction(_)}_.setFromFace(this._currentFeature)}else if(_&&a){var l=this._hoverPoint.worldPoint.slice();if(this._currentFeature&&this._currentFeature.isVertex){var F=this._currentFeature.getValue();l[0]=F[0];l[1]=F[1];l[2]=F[2]}this.updateContour(l,false)}this._surface.update(this._viewport,this._viewport.getCamera())}return this};i.prototype.fixPoint=function(t){this.setHoverPoint(t);var u=this._vsm;var i=this._hoverPoint&&this._hoverPoint.nodeRef;var n=this._state;switch(n){case s.SearchingFirstFeature:if(!t.worldPoint){break}if(this._currentMeasurement){var a=this._currentMeasurement.getPoints();if(!a||!a.length||r.isClosedContour(a)){this._finishArea(false);this._surface.update(this._viewport,this._viewport.getCamera())}else{this._currentMeasurement.duplicateLastPoint();this._pointsCountPerClick.push(1);this._currentFeature=null;this.setCurrentFeatureIndex(1);this._state=s.SearchingSecondFeature}break}var h=t.worldPoint.slice();if(this._currentFeature&&this._currentFeature.isVertex){var o=this._currentFeature.getValue();h[0]=o[0];h[1]=o[1];h[2]=o[2]}var c=new e({points:h});c.duplicateLastPoint();this.beginMeasurementConstruction(c);this._pointsCountPerClick.push(1,1);this._currentFeature=null;this.setCurrentFeatureIndex(1);this._state=s.SearchingSecondFeature;break;case s.SearchingSecondFeature:var _=this._currentMeasurement.getPoints();if(this._currentMeasurement.getArea()&&_.length>9&&r.computePointToPointDistance2(_,_,_.length-3)===0){this._finishArea(true);break}if(!this._currentMeasurement.hasSelfIntersectionsLastEdge()){this._currentMeasurement.duplicateLastPoint();this._pointsCountPerClick.push(1);if(i!=null&&u!=null){u.setOutliningStates([],[i],false,true)}var l=this._currentFeature;var F=l.getContext();var f=l.getFeatureId();var v=l.getValue();this.setCurrentFeatureIndex(this._currentFeatureIndex+1);l=this._vertexFeatures[this._currentFeatureIndex];l.setContext(F);l.setFeatureId(f);l.setValue(v);this._surface.addFeature(l);this._currentFeature=l;this._state=s.SearchingSecondFeature;this._surface.update(this._viewport,this._viewport.getCamera())}break;default:break}return this};i.prototype.escapePressed=function(){switch(this._state){case s.SearchingSecondFeature:if(this._currentFeatureIndex>=2){var e=this._pointsCountPerClick.pop();var t=this._pointsCountPerClick.pop();this._pointsCountPerClick.push(e);this._currentMeasurement.deletePredLastPoints(t);this._surface.removeFeature(this._vertexFeatures[this._currentFeatureIndex-1]);this._vertexFeatures[this._currentFeatureIndex-1].setContext(this._currentFeature.getContext());this._vertexFeatures[this._currentFeatureIndex-1].setFeatureId(this._currentFeature.getFeatureId());this._vertexFeatures[this._currentFeatureIndex-1].setValue(this._currentFeature.getValue());this._surface.removeFeature(this._currentFeature);this._currentFeature=null;this.setCurrentFeatureIndex(this._currentFeatureIndex-1);this._currentFeature=this._vertexFeatures[this._currentFeatureIndex];this._surface.addFeature(this._currentFeature)}else{this._state=s.SearchingFirstFeature;if(this._currentFeature){this._surface.removeFeature(this._currentFeature);this._currentFeature=null}this.setCurrentFeatureIndex(0);this.cancelMeasurementConstruction()}this._surface.update(this._viewport,this._viewport.getCamera());break;case s.SearchingFirstFeature:var r=this._vsm;var u=this._hoverPoint&&this._hoverPoint.nodeRef;if(u!=null&&r!=null){r.setOutliningStates([],[u],false,true)}if(this._currentFeature!=null){this._surface.removeFeature(this._currentFeature);this._currentFeature=null}this._state=s.Off;this._tool.setActive(false,this._viewport);break;default:break}};i.prototype.doubleClick=function(e){this.setHoverPoint(e);var t=this._state===s.SearchingSecondFeature?this._currentMeasurement:null;if(t&&t.getArea()){this._finishArea(true);return true}return false};i.prototype.is2D=function(){return this._is2D};return i});
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/tools/AxisAngleRotationTool", ["./Tool","../thirdparty/three","./AxisAngleRotationToolHandler","./AxisAngleRotationToolGizmo","./ToolNodeSet"],function(t,e,o,i,s){"use strict";var n=t.extend("sap.ui.vk.tools.AxisAngleRotationTool",{metadata:{library:"sap.ui.vk",properties:{enableStepping:{type:"boolean",defaultValue:false},enableSnapping:{type:"boolean",defaultValue:false},showEditingUI:{type:"boolean",defaultValue:false},allowContextMenu:{type:"boolean",defaultValue:true},nodeSet:{type:"sap.ui.vk.tools.ToolNodeSet",defaultValue:s.Highlight}},events:{rotating:{parameters:{nodesProperties:"object[]"}},rotated:{parameters:{nodesProperties:"object[]"}}}},constructor:function(e,i){t.apply(this,arguments);this._viewport=null;this._handler=new o(this);this._gizmo=null}});n.prototype.init=function(){t.prototype.init.call(this);this.setFootprint(["sap.ui.vk.threejs.Viewport"]);this.setAggregation("gizmo",new i)};n.prototype.setActive=function(e,o,i){t.prototype.setActive.call(this,e,o,i);if(this._viewport){if(e){this._gizmo=this.getGizmo();this._gizmo.show(this._viewport,this);this._addLocoHandler()}else{this._removeLocoHandler();this._gizmo?.hide();this._gizmo=null}}return this};n.prototype.queueCommand=function(t){if(this._addLocoHandler()){if(this.isViewportType("sap.ui.vk.threejs.Viewport")){t()}}return this};n.prototype.setShowEditingUI=function(t){this.setProperty("showEditingUI",t,true);this._viewport?.setShouldRenderFrame();return this};n.prototype.setEnableSnapping=function(t){this.setProperty("enableSnapping",t,true);if(t&&this.getActive()){this.getGizmo()._computeBoundsTree()}else{this.getGizmo()._disposeBoundsTree()}return this};n.prototype.resetValues=function(){this.getGizmo().resetValues();this._viewport?.setShouldRenderFrame();return this};n.prototype.setNodeSet=function(t){this.setProperty("nodeSet",t,true);this._gizmo?.handleSelectionChanged()};n.prototype.rotateBy=function(t){this.getGizmo().rotateBy(t);return this};n.prototype.setAxis=function(t){this.getGizmo().setAxis(t);return this};n.prototype.getValues=function(){return this.getGizmo().getValues()};n.prototype.setValues=function(t){this.getGizmo().setValues(t);return this};return n});
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/tools/AxisAngleRotationToolGizmo", ["sap/base/Log","../thirdparty/three","./Gizmo","./AxisColours","../AnimationTrackType","sap/base/assert"],function(t,e,i,a,o,r){"use strict";var n=i.extend("sap.ui.vk.tools.AxisAngleRotationToolGizmo",{metadata:{library:"sap.ui.vk"},renderer:{apiVersion:2,render:function(t,e){t.openStart("div",e);t.class("sapUiVkTransformationToolEdit");t.openEnd();t.renderControl(e._editingForm);t.close("div")}}});var s=[16711808,a.y,a.z];var l=Math.PI*2,h=Math.PI/2,u=13;var d=e.MathUtils.degToRad,p=e.MathUtils.radToDeg;n.prototype.init=function(){i.prototype.init.apply(this);this._createEditingForm(String.fromCharCode(176),84);this._gizmoIndex=-1;this._handleIndex=-1;this._value=new e.Vector3;this._rotationDelta=new e.Vector3;this._noHitRotation=new e.Euler;this._viewport=null;this._tool=null;this._sceneGizmo=new e.Scene;const t=new e.DirectionalLight(16777215,.5*Math.PI);t.position.set(1,3,2);this._sceneGizmo.add(t);this._sceneGizmo.add(new e.AmbientLight(16777215,.5*Math.PI));this._gizmo=new e.Group;this._sceneGizmo.add(this._gizmo);this._touchAreas=new e.Group;this._nodes=[];this._matViewProj=new e.Matrix4;this._gizmoSize=96;function a(t,i,a){var o=new e.TorusGeometry(i,16/96,4,a,t===2?Math.PI:l);if(t===0){o.rotateY(h)}else if(t===1){o.rotateX(h)}else{o.rotateZ(-h)}return new e.Mesh(o,new e.MeshBasicMaterial({opacity:.2,transparent:true}))}var o;for(o=0;o<3;o++){this._touchAreas.add(a(o,1,24))}for(o=0;o<3;o++){var r=new e.Mesh(new e.IcosahedronGeometry(.25,0),new e.MeshBasicMaterial({opacity:.2,transparent:true}));r.position.setComponent(o,1.6);this._touchAreas.add(r)}};n.prototype._createGizmoObject=function(){var t=new e.Group;var i=t.userData;function a(t,i,a,o){var r=new e.TorusGeometry(a,1/96,4,o,t===2?Math.PI:l);if(t===0){r.rotateY(h)}else if(t===1){r.rotateX(h)}else{r.rotateZ(-h)}var n=new e.Mesh(r,new e.MeshBasicMaterial({color:i,transparent:true}));n.matrixAutoUpdate=false;n.userData.color=i;return n}function o(t,i){var a=96*3,o=2,r=12*3,n=2*3;t.multiplyScalar(1/a);var s=new e.MeshLambertMaterial({color:i});var l=new e.CylinderGeometry(o,o,a-r,4);var h=(new e.Matrix4).makeBasis(new e.Vector3(t.y,t.z,t.x),t,new e.Vector3(t.z,t.x,t.y));h.setPosition(t.clone().multiplyScalar((a-r)*.5));l.applyMatrix4(h);var u=new e.Mesh(l,s);u.matrixAutoUpdate=false;u.userData.color=i;var d=new e.CylinderGeometry(0,n,r,12,1);h.setPosition(t.clone().multiplyScalar(a-r*.5));d.applyMatrix4(h);var p=new e.Mesh(d,s);p.matrixAutoUpdate=false;u.add(p);return u}var r;for(r=0;r<3;r++){t.add(a(r,s[r],1,128))}i.axisArrow=o(new e.Vector3(3,0,0),s[0]);t.add(i.axisArrow);var n=new e.BufferGeometry;n.setAttribute("position",new e.Float32BufferAttribute(new Float32Array([0,0,0,3,0,0]),3));i.arrowProjection=new e.Line(n,new e.LineDashedMaterial({color:s[0],transparent:true,scale:10,dashSize:1,gapSize:1}));i.arrowProjection.computeLineDistances();t.add(i.arrowProjection);t.add(new e.AxesHelper(1.5));i.arcMeshes=[];for(r=0;r<3;r++){var d=new e.Mesh(new e.BufferGeometry,new e.MeshBasicMaterial({vertexColors:true,opacity:.5,transparent:true,side:e.DoubleSide,depthWrite:false}));d.visible=false;i.arcMeshes.push(d);t.add(d)}i.valueLabels=[];for(r=0;r<3;r++){var p=this._createTextMesh("",64,32,u,16777215,false);p.renderOrder=10;p.material.depthTest=false;p.visible=false;i.valueLabels.push(p);t.add(p)}var c=i.axisTitles=this._createAxisTitles();c.scale.setScalar(1/this._gizmoSize);var _=this._gizmoSize*1.6;c.children[0].position.x=_;c.children[1].position.y=_;c.children[2].position.z=_;t.add(c);return t};n.prototype.hasDomElement=function(){return true};n.prototype.resetValues=function(){this._value.setScalar(0)};n.prototype.show=function(t,e){this._viewport=t;this._tool=e;this.handleSelectionChanged();this._tool.fireEvent("rotating",{x:0,y:0,z:0,nodesProperties:this._getNodesProperties()},true);this._attachVisibilityChanged()};n.prototype.hide=function(){this._detachVisibilityChanged();this._cleanTempData();this._disposeBoundsTree();this._viewport=null;this._tool=null;this._gizmoIndex=this._handleIndex=-1;this._updateEditingForm(false)};n.prototype._onVisibilityChanged=function(t){if(this._tool.getEnableSnapping()){this._computeBoundsTree()}};n.prototype.getGizmoCount=function(){return this._nodes.length};n.prototype.getTouchObject=function(t){if(this._nodes.length===0){return null}var e=this._gizmo.children[t];c(this._touchAreas.children[2],e.children[2]);c(this._touchAreas.children[0],e.children[0]);this._updateGizmoObjectTransformation(this._touchAreas,t);return this._touchAreas};n.prototype.highlightHandle=function(t,e,i){for(var a=0,o=this._gizmo.children.length;a<o;a++){var r=this._gizmo.children[a];var n=r.userData;for(var s=0;s<3;s++){var l=r.children[s];var h=s===t&&a===e?16776960:l.userData.color;l.material.color.setHex(h);l.material.opacity=t===-1||s===t?1:.35;l.material.visible=i||s===t;var u=n.axisTitles.children[s];u.material.color.setHex(a===e&&s===t-3?16776960:l.userData.color);u.material.opacity=i?1:.35;n.arcMeshes[s].material.visible=i||s===t||s===2&&t===1}}};n.prototype._snapToAxis=function(t){var i=-this._value.y,a=-this._value.z;switch(t){case 0:i+=90;break;case 1:a+=90;break;default:break}this.beginGesture();this._rotate(new e.Euler(0,d(i),d(a)));this.endGesture()};n.prototype.selectHandle=function(t,e){this._gizmoIndex=e;this._handleIndex=t;if(t>=3&&t<6){this._snapToAxis(t-3)}this._updateEditValue();this._viewport.setShouldRenderFrame()};function c(t,e){t.quaternion.copy(e.quaternion);t.position.copy(e.position);t.updateMatrix();t.updateMatrixWorld(true)}function _(t){return p(Math.atan2(t[0],t[2]))}function m(t){return p(Math.atan2(t[1],Math.sqrt(t[0]*t[0]+t[2]*t[2])))}function v(t,e){t=d(t);e=d(e);var i=Math.sin(t),a=Math.cos(t);var o=Math.sin(e),r=Math.cos(e);return[i*r,o,a*r]}function f(t,i,a,o){if(t.userData.angle1===a&&t.userData.angle2===o){return}t.userData.angle1=a;t.userData.angle2=o;var r=(new e.Color).setHex(s[i]);var n=[0,0,0];var h=[r.r,r.g,r.b];var u=new e.Vector3;var d=(i+1)%3,p=(i+2)%3;var c=o-a;var _,m=Math.min(Math.max(Math.ceil(Math.abs(c)*64/Math.PI),1),1e4);var v=Math.min(l/Math.abs(c),1);var f=e.MathUtils.lerp;for(_=0;_<=m;_++){var g=1-_/m;var x=a+c*g;var y=f(v,1,g);u.set(0,0,0).setComponent(d,Math.cos(x)*y).setComponent(p,Math.sin(x)*y);n.push(u.x,u.y,u.z);var z=f(1,.5,g);h.push(r.r*z,r.g*z,r.b*z)}var w=[];for(_=0;_<m;_++){w.push(0,_+1,_+2)}var M=t.geometry;M.setIndex(w);M.setAttribute("position",new e.Float32BufferAttribute(n,3));M.setAttribute("color",new e.Float32BufferAttribute(h,3));t.visible=c!==0}n.prototype._updateGizmoObject=function(t,i,a,o){var r=this._gizmo.children[t];var n=new e.Euler(0,d(a-90),0,"YZX");var s=r.children[2];s.quaternion.setFromEuler(n);s.updateMatrix();n.z=d(o);var l=r.children[0];l.quaternion.setFromEuler(n);l.updateMatrix();l.position.setFromMatrixColumn(l.matrix,0).multiplyScalar(2);l.updateMatrix();var h=r.userData;var u=h.axisArrow;u.quaternion.copy(l.quaternion);u.updateMatrix();var p=h.arrowProjection;var _=Math.cos(n.z);p.quaternion.copy(s.quaternion);p.scale.setScalar(_);p.updateMatrix();p.material.scale=_*10;var m=h.arcMeshes;f(m[0],0,0,d(i));c(m[0],r.children[0]);f(m[1],1,0,d(a));c(m[1],r.children[1]);f(m[2],2,0,d(o));c(m[2],r.children[2]);var v=h.valueLabels;x(v[0],i);x(v[1],a);x(v[2],o)};n.prototype.beginGesture=function(){this._rotationDelta.setScalar(0);this._noHitRotation.set(0,0,0);this._nodes.forEach(function(t){t.beginAngle=t.angle;t.beginAzimuth=t.azimuth;t.beginElevation=t.elevation})};n.prototype._getNodesProperties=function(){return this.getValues()};n.prototype.endGesture=function(){this._nodes.forEach(function(t){delete t.beginAngle;delete t.beginAzimuth;delete t.beginElevation});var t=this._getNodesProperties();this._tool.fireRotated({x:this._rotationDelta.x,y:this._rotationDelta.y,z:this._rotationDelta.z,nodesProperties:t})};function g(t,e){var i=window.devicePixelRatio;var a=t.width;var o=t.height;var r=a*.5;var n=o*.5;var s=Math.min(u*.85*i,r-1);var l=t.getContext("2d");l.font="Bold "+u*i+"px Arial";var d=l.measureText(e);var p=Math.min(d.width*.5-s*.5,r-s-1);l.clearRect(0,0,a,o);l.beginPath();l.arc(r-p,n,s,h,h*3,false);l.lineTo(r+p,n-s);l.arc(r+p,n,s,-h,h,false);l.lineTo(r-p,n+s);l.closePath();l.globalAlpha=.75;l.fillStyle="#fff";l.fill();l.globalAlpha=1;l.lineWidth=i;l.strokeStyle="#000";l.stroke();l.fillStyle="#000";l.textAlign="center";if(sap.ui.Device.browser.chrome||sap.ui.Device.browser.firefox){l.textBaseline="top";l.fillText(e,r,n-d.actualBoundingBoxDescent*.5)}else{l.textBaseline="middle";l.fillText(e,r,n)}}function x(t,e){t.visible=e!==0;if(t.visible&&t.userData.value!==e){t.userData.value=e;var i=e.toLocaleString("fullwide",{useGrouping:false,minimumFractionDigits:1,maximumFractionDigits:1})+"";var a=t.material.map;g(a.image,i);a.needsUpdate=true}}n.prototype._updateEditValue=function(){var t=this._nodes[this._gizmoIndex];if(t){this._value.set(t.angle,t.azimuth,t.elevation)}};n.prototype._calculateRotationQuaternion=function(t){var i=(new e.Vector3).fromArray(v(t.azimuth,t.elevation));var a=this._getEffectiveParent(t.node);if(a!==t.node.parent){i.transformDirection(a.matrixWorld);i.transformDirection(t.node.parent.matrixWorld.clone().invert())}return(new e.Quaternion).setFromAxisAngle(i,d(t.angle))};n.prototype._updateNodeRotation=function(t){const e=this._calculateRotationQuaternion(t);const i=t.node;i.quaternion.multiplyQuaternions(e,t.quaternion);i.updateMatrix();i.updateMatrixWorld(true);delete i.userData.skipUpdateJointNode;this._viewport._viewStateManager._setJointNodeOffsets(i,o.Rotate)};n.prototype._rotate=function(t,i){this._rotationDelta.set(p(t.x),p(t.y),p(t.z));this._nodes.forEach(function(t){t.angle=t.beginAngle+this._rotationDelta.x;t.azimuth=(t.beginAzimuth+this._rotationDelta.y)%360;t.elevation=e.MathUtils.clamp(t.beginElevation+this._rotationDelta.z,-90,90);if(t.azimuth>180){t.azimuth-=360}if(t.azimuth<-180){t.azimuth+=360}this._updateNodeRotation(t)},this);if(!i&&this._tool.getEnableSnapping()){if(this._checkSceneSelectionIntersection()){const i=new e.Euler;for(let e=0;e<6;e++){i.set((t.x+this._noHitRotation.x)*.5,(t.y+this._noHitRotation.y)*.5,(t.z+this._noHitRotation.z)*.5);this._rotate(i,true);(this._checkSceneSelectionIntersection()?t:this._noHitRotation).copy(i)}if(!this._noHitRotation.equals(i)){this._rotate(this._noHitRotation,true)}}else{this._noHitRotation.copy(t)}}this._updateEditValue();this._viewport.setShouldRenderFrame()};n.prototype._setRotationAxisAngle=function(t,i,a){var o=a-i;if(t!==0){o%=l}var r=new e.Euler;r[["x","y","z"][t]]=o;var n=this._getNodesProperties();if(this._tool.fireEvent("rotating",{x:p(r.x),y:p(r.y),z:p(r.z),nodesProperties:n},true)){this._rotate(r)}};n.prototype.rotate=function(t,i,a){this.beginGesture();this._rotate(new e.Euler(d(t||0),d(i||0),d(a||0)))};n.prototype._getValueLocaleOptions=function(){return{useGrouping:false,minimumFractionDigits:1,maximumFractionDigits:2}};n.prototype.getValue=function(){return this._gizmoIndex>=0&&this._handleIndex>=0&&this._handleIndex<3?this._value.getComponent(this._handleIndex):0};n.prototype.setValue=function(t){if(this._gizmoIndex>=0&&this._handleIndex>=0&&this._handleIndex<3){var i=new e.Euler;i[["x","y","z"][this._handleIndex]]=d(t-this._value.getComponent(this._handleIndex));this.beginGesture();this._rotate(i);this.endGesture()}};n.prototype.rotateBy=function(t){this.beginGesture();this._rotate(new e.Euler(d(t),0,0));this.endGesture()};n.prototype.setAxis=function(t){this.beginGesture();var e=0;var i=0;if(Array.isArray(t)){e=_(t);i=m(t)}else{if("azimuth"in t){e=t.azimuth}if("elevation"in t){i=t.elevation}}this._nodes.forEach(function(t){t.azimuth=e;t.elevation=i;this._updateNodeRotation(t)},this);this._updateEditValue();this._viewport.setShouldRenderFrame();this.endGesture()};n.prototype.getValues=function(){var t=[];this._nodes.forEach(function(e){t.push({node:e.node,angle:e.angle,azimuth:e.azimuth,elevation:e.elevation,axis:v(e.azimuth,e.elevation)})});return t};n.prototype._getNodeInfoByNode=function(t){var e=this._nodes;for(var i=0,a=e.length;i<a;i++){if(e[i].node===t){return e[i]}}return null};n.prototype.setValues=function(t){t.forEach(function(t){var e=this._getNodeInfoByNode(t.node);if(e){e.angle=t.angle;if(t.axis){e.azimuth=_(t.axis);e.elevation=m(t.axis)}else{e.azimuth=t.azimuth;e.elevation=t.elevation}var i=this._calculateRotationQuaternion(e);e.quaternion.multiplyQuaternions(i.invert(),e.node.quaternion);this._updateNodeRotation(e)}},this);this._updateEditValue();this._viewport.setShouldRenderFrame()};n.prototype.expandBoundingBox=function(t){if(this._viewport){this._expandBoundingBox(t,this._viewport.getCamera().getCameraRef(),true)}};n.prototype._updateSelection=function(t){i.prototype._updateSelection.call(this,t);if(this._tool.getEnableSnapping()){this._computeBoundsTree()}};n.prototype.handleSelectionChanged=function(t){this._nodes.length=0;this._gizmoIndex=this._handleIndex=-1;if(this._viewport){this._updateSelection(this._viewport._viewStateManager);this._tool.fireEvent("rotating",{x:0,y:0,z:0,nodesProperties:this._getNodesProperties()},true);this._nodes.forEach(function(t){t.quaternion=t.node.quaternion.clone();t.angle=0;t.azimuth=0;t.elevation=0});var e=this._nodes.length;var i=this._gizmo;while(i.children.length>e){i.remove(i.children[i.children.length-1])}while(i.children.length<e){i.add(this._createGizmoObject())}}};n.prototype._getObjectSize=function(t){var i=new e.Box3;this._nodes[t].node._expandBoundingBox(i,true,false);if(i.isEmpty()){return 0}var a=new e.Vector3;i.getSize(a);return a.length()};n.prototype._updateGizmoObjectTransformation=function(t,e){var i=this._nodes[e].node;var a=this._getEffectiveParent(i);t.position.setFromMatrixPosition(i.matrixWorld);if(a){t.quaternion.setFromRotationMatrix(a.matrixWorld)}else{t.quaternion.set(0,0,0,1)}var o=this._getGizmoScale(t.position);t.scale.setScalar(this._gizmoSize*o);t.updateMatrix();t.updateMatrixWorld(true);return o};n.prototype._getValuePosition=function(t,i,a,o){a=d(a);o=d(o);var r=new e.Euler(0,0,0,"YZX");if(i===0){r.set(0,a,o)}else if(i===1){r.set(0,a*.5,0)}else{r.set(0,a,o*.5)}r.y-=h;t.set(i===0?3.25:1.25,0,0).applyEuler(r)};var y=new e.Vector3;n.prototype._updateGizmoTransformation=function(t,e){var i=this._gizmo.children[t];var a=this._nodes[t];var o=this._updateGizmoObjectTransformation(i,t);i.userData.axisTitles.children.forEach(function(t){t.quaternion.copy(i.quaternion).invert().multiply(e.quaternion)});for(var r=0;r<3;r++){var n=i.userData.valueLabels[r];this._getValuePosition(n.position,r,a.azimuth,a.elevation);n.quaternion.copy(i.quaternion).invert().multiply(e.quaternion);y.copy(n.position).applyMatrix4(i.matrixWorld);n.scale.setScalar(this._getGizmoScale(y)/(o*this._gizmoSize))}};n.prototype._getEditingFormPosition=function(){var t=this._gizmo.children[this._gizmoIndex];var e=this._nodes[this._gizmoIndex];this._updateGizmoObjectTransformation(t,this._gizmoIndex);this._getValuePosition(y,this._handleIndex,e.azimuth,e.elevation);return y.applyMatrix4(t.matrixWorld).applyMatrix4(this._matViewProj)};n.prototype.render=function(){r(this._viewport&&this._viewport.getMetadata().getName()==="sap.ui.vk.threejs.Viewport","Can't render gizmo without sap.ui.vk.threejs.Viewport");if(this._nodes.length>0){var t=this._viewport.getRenderer(),e=this._viewport.getCamera().getCameraRef();this._matViewProj.multiplyMatrices(e.projectionMatrix,e.matrixWorldInverse);t.clearDepth();for(var i=0,a=this.getGizmoCount();i<a;i++){var o=this._nodes[i];this._updateGizmoObject(i,o.angle,o.azimuth,o.elevation);this._updateGizmoTransformation(i,e)}t.render(this._sceneGizmo,e);this._updateEditValue()}this._updateEditingForm(this._nodes.length>0&&this._gizmoIndex>=0&&this._handleIndex>=0&&this._handleIndex<3,this._handleIndex,["","",""][this._handleIndex])};n.prototype._getOffsetForRestTransformation=function(t){};return n});
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/tools/AxisAngleRotationToolHandler", ["sap/ui/base/EventProvider","sap/m/Menu","sap/m/MenuItem","../getResourceBundle","../thirdparty/three","./CoordinateSystem"],function(t,e,i,s,n,r){"use strict";var o=t.extend("sap.ui.vk.tools.AxisAngleRotationToolHandler",{metadata:{library:"sap.ui.vk"},constructor:function(t){this._priority=12;this._tool=t;this._gizmo=t.getGizmo();this._rect=null;this._rayCaster=new n.Raycaster;this._rayCaster.linePrecision=.2;this._handleIndex=-1;this._gizmoIndex=-1;this._matrixOrigin=new n.Matrix4;this._mouse=new n.Vector2;this._mouseOrigin=new n.Vector2}});o.prototype._updateMouse=function(t){var e=this.getViewport().getRenderer().getSize(new n.Vector2);this._mouse.x=(t.x-this._rect.x)/e.width*2-1;this._mouse.y=(t.y-this._rect.y)/e.height*-2+1;this._rayCaster.setFromCamera(this._mouse,this.getViewport().getCamera().getCameraRef())};o.prototype._updateHandles=function(t,e){var i=this._handleIndex;this._handleIndex=-1;if(t.n===1||t.event&&t.event.type==="contextmenu"){for(var s=0,n=this._gizmo.getGizmoCount();s<n;s++){var r=this._gizmo.getTouchObject(s);var o=this._rayCaster.intersectObject(r,true);if(o.length>0){this._handleIndex=r.children.indexOf(o[0].object);if(this._handleIndex>=0&&this._handleIndex<6){this._gizmoIndex=s;this._matrixOrigin.copy(o[0].object.matrixWorld);this._objectSize=this._gizmo._getObjectSize(s)/this._gizmo._getGizmoScale(r.position)}}}}this._gizmo.highlightHandle(this._handleIndex,this._gizmoIndex,e||this._handleIndex===-1);if(i!==this._handleIndex){this.getViewport().setShouldRenderFrame()}};o.prototype.hover=function(t){if(this._inside(t)&&!this._gesture){this._updateMouse(t);this._updateHandles(t,true);t.handled|=this._handleIndex>=0}};o.prototype.click=function(t){if(this._inside(t)&&!this._gesture){this._updateMouse(t);this._updateHandles(t,true);this._gizmo.selectHandle(this._handleIndex,this._gizmoIndex);t.handled|=this._handleIndex>=0}};o.prototype._getMouseAngle=function(){var t=this._rayCaster.ray;var e=this._rotationPoint.clone().sub(t.origin);var i=this._rotationAxis.dot(e)/this._rotationAxis.dot(t.direction);var s=t.direction.clone().multiplyScalar(i).sub(e).normalize();return Math.atan2(s.dot(this._axis2),s.dot(this._axis1))};o.prototype.beginGesture=function(t){if(this._inside(t)&&!this._gesture){this._updateMouse(t);this._updateHandles(t,false);if(this._handleIndex>=0&&this._handleIndex<3){t.handled=true;this._gesture=true;this._mouseOrigin.copy(t);this._gizmo.selectHandle(this._handleIndex,this._gizmoIndex);this._gizmo.beginGesture();this._axis1=(new n.Vector3).setFromMatrixColumn(this._matrixOrigin,(this._handleIndex+1)%3).normalize();this._axis2=(new n.Vector3).setFromMatrixColumn(this._matrixOrigin,(this._handleIndex+2)%3).normalize();this._rotationAxis=(new n.Vector3).crossVectors(this._axis1,this._axis2).normalize();this._rotationPoint=(new n.Vector3).setFromMatrixPosition(this._matrixOrigin);if(Math.abs(this._rayCaster.ray.direction.dot(this._rotationAxis))<Math.cos(Math.PI*85/180)){var e=this.getViewport().getCamera().getCameraRef().matrixWorld;this._axis1.setFromMatrixColumn(e,0).normalize();this._axis2.setFromMatrixColumn(e,1).normalize();this._rotationAxis.setFromMatrixColumn(e,2).normalize()}this._startAngle=n.MathUtils.degToRad(this._gizmo.getValue());this._prevAngle=this._getMouseAngle();this._deltaAngle=0}}};o.prototype.move=function(t){if(this._gesture){t.handled=true;this._updateMouse(t);var e=this._getMouseAngle();var i=e-this._prevAngle;this._prevAngle=e;if(i>Math.PI){i-=Math.PI*2}else if(i<-Math.PI){i+=Math.PI*2}this._deltaAngle+=i;var s=this._startAngle;var r=s+this._deltaAngle;if(this._tool.getEnableStepping()){var o=5;if(this._objectSize>0){var a=[.1,1,5,15];var h=[2e3,1e3,300,0];for(var _=0;_<4;_++){if(this._objectSize>=h[_]){o=a[_];break}}}o=n.MathUtils.degToRad(o);r=Math.round(r/o)*o}if(isFinite(s)&&isFinite(r)){this._gizmo._setRotationAxisAngle(this._handleIndex,s,r)}}};o.prototype.endGesture=function(t){if(this._gesture){this._gesture=false;t.handled=true;this._updateMouse(t);this._gizmo.endGesture();this._updateHandles(t,true);this.getViewport().setShouldRenderFrame()}};o.prototype.contextMenu=function(t){if(!this._tool.getAllowContextMenu()){return}if(this._inside(t)){this._updateMouse(t);this._updateHandles(t,true);if(this._handleIndex>=0){t.handled=true}}};o.prototype.getViewport=function(){return this._tool._viewport};o.prototype._getOffset=function(t){var e=t.getBoundingClientRect();var i={x:e.left+window.pageXOffset,y:e.top+window.pageYOffset};return i};o.prototype._inside=function(t){var e=this._tool._viewport.getIdForLabel();var i=document.getElementById(e);if(i===null){return false}var s=this._getOffset(i);this._rect={x:s.x,y:s.y,w:i.offsetWidth,h:i.offsetHeight};return t.x>=this._rect.x&&t.x<=this._rect.x+this._rect.w&&t.y>=this._rect.y&&t.y<=this._rect.y+this._rect.h};return o});
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/tools/AxisColours", [],function(){"use strict";var e={x:16720418,y:42821,z:4754167};return e},true);
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/tools/CalibrateDistanceMeasurementTool", ["sap/m/MessageBox","sap/ui/core/Fragment","sap/ui/model/json/JSONModel","sap/ui/model/resource/ResourceModel","./CalibrateDistanceMeasurementToolHandler","./Tool","../getResourceBundle","../measurements/Settings","../measurements/Utils"],function(e,t,i,s,a,r,n,o,l){"use strict";var u=r.extend("sap.ui.vk.tools.CalibrateDistanceMeasurementTool",{metadata:{library:"sap.ui.vk"}});var h=u.getMetadata().getParent().getClass().prototype;u.prototype.init=function(){if(h.init){h.init.call(this)}this._viewport=null;this._handler=new a(this);this._highlightedMeasurementDomRef=null;this.setFootprint(["sap.ui.vk.threejs.Viewport","sap.ui.vk.svg.Viewport"])};u.prototype.setActive=function(e,t,i){h.setActive.call(this,e,t,i);if(this._viewport){if(e){this._addLocoHandler();this._viewport.addStyleClass("sapUiVizKitCalibrateDistanceCursor")}else{this._viewport.removeStyleClass("sapUiVizKitCalibrateDistanceCursor");this.highlightMeasurement(null,this._viewport.getMeasurementSurface());this._removeLocoHandler()}}return this};u.prototype.highlightMeasurement=function(e){var t=this._highlightedMeasurementDomRef;if(e===t){return null}var i=this._viewport.getMeasurementSurface();if(t!=null){i.highlightMeasurement(t._measurement,false)}if(e!=null){if(e._measurement.isDistance){i.highlightMeasurement(e._measurement,true,this._viewport,this._viewport.getCamera())}else{e=null}}this._highlightedMeasurementDomRef=e;return this};u.prototype.calibrateMeasurement=function(a){var r=a._measurement;if(!r.isDistance){return this}var u=this._viewport;var h=u.getMeasurementSurface();var c=o.load();var d=l.getUnitFactor(c.units);var m=h.getScale();var p=r.getDistance();var v=p*d*m;var g={label:n().getText("MEASUREMENTS_CALIBRATION_DISTANCE_LABEL",[l.translateUnits(o.load().units)]),distance:v};var f=new i(g);var _=this;var M=this.getId()+"-calibration-dialog";var C;t.load({name:"sap.ui.vk.measurements.Calibration",id:M,controller:{onResetPressed:function(e){f.setProperty("/distance",p*d)},onOkPressed:function(){if(g.distance<=0){e.error(n().getText("MEASUREMENTS_CALIBRATION_DISTANCE_ERROR_MESSAGE"),{onClose:function(){t.byId(M,"distance").focus()}});return}if(g.distance!==v){h.setScale(g.distance/d/p);h.update(u,u.getCamera())}C.close();_.setActive(false,u)},onCancelPressed:function(){C.close()},onAfterClose:function(){C.destroy();C=null}}}).then(function(e){C=e;C.setModel(f);C.setModel(new s({bundle:n()}),"i18n");C.open()});return this};return u});
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/tools/CalibrateDistanceMeasurementToolHandler", ["sap/ui/base/EventProvider"],function(t){"use strict";var e=t.extend("sap.ui.vk.tools.CalibrateDistanceMeasurementToolHandler",{metadata:{library:"sap.ui.vk"},constructor:function(t){this._priority=0;this._tool=t;this._rect=null}});e.prototype.destroy=function(){this._tool=null;this._rect=null};e.prototype.hover=function(t){var e=this._tool;var r=e._viewport;var i=r.getMeasurementSurface();if(this._inside(t)&&r.getScene()){var o=t.x-this._rect.x;var n=t.y-this._rect.y;e.highlightMeasurement(i.hitTest(o,n))}else{e.highlightMeasurement(null)}};e.prototype.beginGesture=function(t){};e.prototype.move=function(t){};e.prototype.endGesture=function(t){};e.prototype.click=function(t){t.handled=true;var e=this._tool;var r=e._viewport;if(this._inside(t)&&r.getScene()){var i=t.x-this._rect.x;var o=t.y-this._rect.y;var n=r.getMeasurementSurface().hitTest(i,o);if(n){e.calibrateMeasurement(n)}}};e.prototype.doubleClick=function(t){};e.prototype.contextMenu=function(t){};e.prototype.keyEventHandler=function(t){if(t.code==="Escape"){var e=this._tool;e.setActive(false,e._viewport);t.handled=true}};e.prototype._getOffset=function(t){var e=t.getBoundingClientRect();var r={x:e.left+window.pageXOffset,y:e.top+window.pageYOffset};return r};e.prototype._inside=function(t){var e=this._tool._viewport.getIdForLabel();var r=document.getElementById(e);if(r==null){return false}var i=this._getOffset(r);var o=this._rect={x:i.x,y:i.y,w:r.offsetWidth,h:r.offsetHeight};return t.x>=o.x&&t.x<=o.x+o.w&&t.y>=o.y&&t.y<=o.y+o.h};return e});
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/tools/CoordinateSystem", ["sap/ui/base/DataType"],function(e){"use strict";var r={Local:"Local",World:"World",Screen:"Screen",Parent:"Parent",Custom:"Custom"};e.registerEnum("sap.ui.vk.tools.CoordinateSystem",r);return r},true);
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/tools/CreateEllipseTool", ["sap/base/Log","../library","./Tool","./CreateEllipseToolHandler","./CreateEllipseToolGizmo","../svg/Ellipse"],function(t,e,i,o,s,r){"use strict";var n=i.extend("sap.ui.vk.tools.CreateEllipseTool",{metadata:{library:"sap.ui.vk",properties:{parentNode:{type:"any",defaultValue:null},uniformMode:{type:"boolean",defaultValue:false}},events:{completed:{parameters:{node:{type:"any"},request:{type:"any"}}}}},constructor:function(t,e){if(n._instance){return n._instance}i.apply(this,arguments);this._viewport=null;this._handler=new o(this);n._instance=this;return this}});n.prototype.init=function(){if(i.prototype.init){i.prototype.init.call(this)}this.setFootprint(["sap.ui.vk.svg.Viewport","sap.ui.vk.pdf.Viewport"]);this.setAggregation("gizmo",new s)};n.prototype.setActive=function(t,e,o){i.prototype.setActive.call(this,t,e,o);var s=this._viewport;if(s){if(t){this._gizmo=this.getGizmo();if(this._gizmo){this._gizmo.show(s,this)}this._addLocoHandler()}else{this._removeLocoHandler();if(this._gizmo){this._gizmo.hide();this._gizmo=null}}}return this};n.prototype.setMaterial=function(t,e,i){this._material=t;this._lineStyle=e;this._fillStyle=i};n.prototype.queueCommand=function(t){if(this._addLocoHandler()){if(this.isViewportType("sap.ui.vk.svg.Viewport")){t()}}return this};n.prototype.setParentNode=function(t){if(t===this.getParentNode()){return this}this.setProperty("parentNode",t,true);if(this._gizmo){this._gizmo.updateParentNode()}return this};return n});
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/tools/CreateEllipseToolGizmo", ["./CreateParametricGizmo","../svg/Element","../svg/Ellipse"],function(t,e,i){"use strict";var a=t.extend("sap.ui.vk.tools.CreateEllipseToolGizmo",{metadata:{library:"sap.ui.vk"},renderer:null});a.prototype.hasDomElement=function(){return false};a.prototype.show=function(t,e){t.addStyleClass("sapVizKitViewportCreateToolActive");this._viewport=t;this._tool=e;this.updateParentNode()};a.prototype.hide=function(){this._viewport.removeStyleClass("sapVizKitViewportCreateToolActive");this._viewport=null;this._tool=null;this._root=null};a.prototype._calculateNodeMatrix=function(t,i,a,r){var o=e._multiplyMatrices(this._invParentMatrix,[t,i,-i,t,a,r]);var s=o[0]*o[3]-o[1]*o[2];if(s<0){o[2]*=-1;o[3]*=-1}if(o[3]<0){o[0]*=-1;o[1]*=-1;o[2]*=-1;o[3]*=-1}return o};a.prototype._startAdding=function(t){this._invParentMatrix=e._invertMatrix(this._root._matrixWorld());this._startPos=t;var a=this._viewport._camera._transformRect({x1:0,y1:0,x2:1,y2:1});this._minRadius=Math.max(a.x2-a.x1,a.y2-a.y1)*.5;this._activeElement=new i({subelement:true,major:this._minRadius,minor:this._minRadius,material:this._tool._material,lineStyle:this._tool._lineStyle,fillStyle:this._tool._fillStyle});var r=new e({name:"Ellipse",matrix:this._calculateNodeMatrix(1,0,t.x,t.y)});this._setPageIndexIfExists(r);r.add(this._activeElement);this._root.add(r)};a.prototype._update=function(t,e){var i=this._startPos;var a=this._activeElement;if(a){var r=t.x-i.x;var o=t.y-i.y;var s=Math.sqrt(r*r+o*o);var l=this._tool.getUniformMode()^e;if(s===0||l){r=1;o=0}else{r/=s;o/=s}var n=Math.max(s*.5,this._minRadius);var _=l?n:n*.5;a.rx=Math.max(n,this._minRadius);a.ry=Math.max(_,this._minRadius);a.parent.setMatrix(this._calculateNodeMatrix(r,o,(t.x+i.x)*.5,(t.y+i.y)*.5));a.invalidate()}};a.prototype._stopAdding=function(t){var e=this._activeElement;this._activeElement=null;if(t){this._tool.fireCompleted({node:e.parent,request:this._createRequest(e.parent)})}else{this._root.remove(e.parent)}};return a});
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/tools/CreateEllipseToolHandler", ["sap/ui/base/EventProvider","../svg/Element"],function(t,e){"use strict";var i=t.extend("sap.ui.vk.tools.CreateEllipseToolHandler",{metadata:{library:"sap.ui.vk"},constructor:function(t){this._priority=30;this._tool=t;this._rect=null}});i.prototype._getPosition=function(t){return this._tool._viewport._camera._screenToWorld(t.x-this._rect.x,t.y-this._rect.y)};i.prototype.hover=function(t){};i.prototype.beginGesture=function(t){var e=this._tool.getGizmo();if(e&&this._inside(t)){if(t.buttons===1){this._gesture=true;this._pointerMoved=false;t.handled=true;e._startAdding(this._getPosition(t))}}};i.prototype.move=function(t){if(this._gesture){this._pointerMoved=true;t.handled=true;this._tool.getGizmo()._update(this._getPosition(t),t.event&&(sap.ui.Device.os.macintosh?t.event.metaKey:t.event.ctrlKey))}};i.prototype.endGesture=function(t){if(this._gesture){this._gesture=false;t.handled=true;const e=this._pointerMoved;this._pointerMoved=false;this._tool.getGizmo()._stopAdding(e)}};i.prototype.click=function(t){var e=this._tool.getGizmo();if(e&&this._inside(t)){t.handled=true}};i.prototype.doubleClick=function(t){};i.prototype.contextMenu=function(t){};i.prototype.getViewport=function(){return this._tool._viewport};i.prototype._getOffset=function(t){var e=t.getBoundingClientRect();var i={x:e.left+window.pageXOffset,y:e.top+window.pageYOffset};return i};i.prototype._inside=function(t){var e=this._tool._viewport.getIdForLabel();var i=document.getElementById(e);if(i==null){return false}var o=this._getOffset(i);this._rect={x:o.x,y:o.y,w:i.offsetWidth,h:i.offsetHeight};return t.x>=this._rect.x&&t.x<=this._rect.x+this._rect.w&&t.y>=this._rect.y&&t.y<=this._rect.y+this._rect.h};return i});
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/tools/CreateParametricGizmo", ["./Gizmo","../svg/HotspotHelper"],function(t,e){"use strict";var i=t.extend("sap.ui.vk.tools.CreateParametricGizmo",{metadata:{library:"sap.ui.vk"},renderer:null});i.prototype.init=function(){if(t.prototype.init){t.prototype.init.apply(this)}this._viewport=null;this._tool=null;this._activeElement=null};i.prototype.updateParentNode=function(){if(!this._tool||!this._viewport){return}var t=this._tool.getParentNode();if(!t){t=this._viewport._scene.getRootElement();while(t.userData.skipIt&&t.children.length>0){t=t.children[0]}}this._root=t};i.prototype._createRequest=function(t){return(new e).createRequest(t,this._viewport)};i.prototype._setPageIndexIfExists=function(t){const e=this._viewport.getCurrentPageIndex?.();if(e!=null){t.setPageIndex(e)}return this};return i});
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/tools/CreatePathTool", ["../library","./Tool","./CreatePathToolHandler","./CreatePathToolGizmo"],function(t,e,i,o){"use strict";var s=e.extend("sap.ui.vk.tools.CreatePathTool",{metadata:{library:"sap.ui.vk",properties:{parentNode:{type:"any",defaultValue:null},closePath:{type:"boolean",defaultValue:false}},events:{completed:{parameters:{node:{type:"any"},request:{type:"any"},closed:"boolean"}}}},constructor:function(t,o){if(s._instance){return s._instance}e.apply(this,arguments);this._viewport=null;this._handler=new i(this);s._instance=this;return this}});s.prototype.init=function(){if(e.prototype.init){e.prototype.init.call(this)}this.setFootprint(["sap.ui.vk.svg.Viewport","sap.ui.vk.pdf.Viewport"]);this.setAggregation("gizmo",new o)};s.prototype.setActive=function(t,i,o){e.prototype.setActive.call(this,t,i,o);var s=this._viewport;if(s){if(t){this._gizmo=this.getGizmo();if(this._gizmo){this._gizmo.show(s,this)}this._addLocoHandler()}else{this._removeLocoHandler();if(this._gizmo){this._gizmo.hide();this._gizmo=null}}}return this};s.prototype.setMaterial=function(t,e,i){this._material=t;this._lineStyle=e;this._fillStyle=i};s.prototype.queueCommand=function(t){if(this._addLocoHandler()){if(this.isViewportType("sap.ui.vk.svg.Viewport")){t()}}return this};s.prototype.setParentNode=function(t){if(t===this.getParentNode()){return this}this.setProperty("parentNode",t,true);if(this._gizmo){this._gizmo.updateParentNode()}return this};return s});
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/tools/CreatePathToolGizmo", ["./CreateParametricGizmo","../svg/Element","../svg/Path","sap/ui/events/KeyCodes"],function(t,e,i,s){"use strict";var n=t.extend("sap.ui.vk.tools.CreatePathToolGizmo",{metadata:{library:"sap.ui.vk"},renderer:null});n.prototype.hasDomElement=function(){return false};n.prototype.show=function(t,e){this._viewport=t;this._tool=e;this._activeElement=null;this.updateParentNode();this._onKeyPressListener=this._onKeyPress.bind(this);document.addEventListener("keydown",this._onKeyPressListener)};n.prototype.hide=function(){document.removeEventListener("keydown",this._onKeyPressListener);if(this._gizmo){this._gizmo.parent.remove(this._gizmo);this._gizmo=null}if(this._activeElement){this._finishPath(false)}this._viewport=null;this._tool=null;this._root=null};var o=4;var l=16;n.prototype._getDistance=function(t,e){return Math.sqrt(t*t+e*e)*this._viewport._camera.zoom};n.prototype._getGizmoSegments=function(t){var e=5/this._viewport._camera.zoom;return[{type:"move",points:[t.x-e,t.y]},{type:"line",points:[t.x+e,t.y]},{type:"move",points:[t.x,t.y-e]},{type:"line",points:[t.x,t.y+e]}]};n.prototype._addPoint=function(t,s,n){var h=this._activeElement;if(!h){this._activeElement=h=new i({subelement:true,material:this._tool._material,lineStyle:this._tool._lineStyle,fillStyle:null,segments:[{type:"move",points:[t.x,t.y]}]});if(h.stroke[3]===0){h.stroke.set([1,0,0,.5]);h.strokeDashArray=[5,5]}if(this._tool.getClosePath()){h.segments.push({type:"close"});h.setFillStyle(this._tool._fillStyle)}this._pointCount=2;this._canClosePath=false;this._gizmo=new i({subelement:true,lineStyle:{colour:"#000",width:2},segments:this._getGizmoSegments(t)});var a=new e({name:"Path"});this._setPageIndexIfExists(a);a.add(h);a.add(this._gizmo);this._root.add(a)}else{var r=h.segments[0].points;if(this._pointCount>=r.length){r.push(t.x,t.y)}else{r[r.length-2]=t.x;r[r.length-1]=t.y}h.invalidate();if(s){if(n&&this._checkClosure(t)){return}if(this._getDistance(t.x-r[this._pointCount-2],t.y-r[this._pointCount-1])>=o){this._canClosePath=this._canClosePath||this._getDistance(t.x-r[0],t.y-r[1])>=l;this._pointCount=r.length;if(this._gizmo){this._gizmo.segments=this._getGizmoSegments(t);this._gizmo.invalidate()}}}}};n.prototype._checkClosure=function(t){var e=this._activeElement;if(e){var i=e.segments[0].points;if(this._getDistance(t.x-i[0],t.y-i[1])<l){if(this._canClosePath&&this._pointCount>=6){this._finishPath(true);return true}}}return false};n.prototype._finishPath=function(t){if(this._gizmo){this._gizmo.parent.remove(this._gizmo);this._gizmo=null}var e=this._activeElement;if(e){if(this._pointCount<4){e.parent.remove(e);this._activeElement=null;this._tool.fireCompleted({})}else{var i=e.segments[0].points;i.length=this._pointCount;e.setLineStyle(this._tool._lineStyle);if(t&&e.segments.length===1){e.segments.push({type:"close"});e.setFillStyle(this._tool._fillStyle)}e.invalidate();this._tool.fireCompleted({node:e.parent,request:this._createRequest(e.parent),closed:t})}this._activeElement=null}};n.prototype._onKeyPress=function(t){switch(t.keyCode){case s.ESCAPE:case s.ENTER:if(this._activeElement){this._finishPath(false)}break;default:break}};return n});
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/tools/CreatePathToolHandler", ["sap/ui/base/EventProvider","../svg/Element"],function(t,e){"use strict";var i=t.extend("sap.ui.vk.tools.CreatePathToolHandler",{metadata:{library:"sap.ui.vk"},constructor:function(t){this._priority=30;this._tool=t;this._rect=null;this._gesture=false}});i.prototype._getPosition=function(t){var i=this._tool._viewport._camera._screenToWorld(t.x-this._rect.x,t.y-this._rect.y);var o=e._invertMatrix(this._tool.getGizmo()._root._matrixWorld());return e._transformPoint(i.x,i.y,o)};i.prototype.hover=function(t){var e=this._tool.getGizmo();if(e&&e._activeElement){t.handled=true;this._tool.getGizmo()._addPoint(this._getPosition(t),false)}};i.prototype.beginGesture=function(t){var e=this._tool.getGizmo();if(e&&t.buttons===1&&this._inside(t)){t.handled=true;this._gesture=true;e._addPoint(this._getPosition(t),true,true)}};i.prototype.move=function(t){var e=this._tool.getGizmo();if(e&&this._gesture&&this._inside(t)){t.handled=true;this._tool.getGizmo()._addPoint(this._getPosition(t),true)}};i.prototype.endGesture=function(t){var e=this._tool.getGizmo();if(e&&this._gesture&&this._inside(t)){this._gesture=false;t.handled=true;this._tool.getGizmo()._checkClosure(this._getPosition(t))}};i.prototype.click=function(t){var e=this._tool.getGizmo();if(e&&this._inside(t)){t.handled=true}};i.prototype.doubleClick=function(t){var e=this._tool.getGizmo();if(e&&this._inside(t)){t.handled=true;e._finishPath(false)}};i.prototype.contextMenu=function(t){};i.prototype.getViewport=function(){return this._tool._viewport};i.prototype._getOffset=function(t){var e=t.getBoundingClientRect();var i={x:e.left+window.pageXOffset,y:e.top+window.pageYOffset};return i};i.prototype._inside=function(t){var e=this._tool._viewport.getIdForLabel();var i=document.getElementById(e);if(i==null){return false}var o=this._getOffset(i);this._rect={x:o.x,y:o.y,w:i.offsetWidth,h:i.offsetHeight};return t.x>=this._rect.x&&t.x<=this._rect.x+this._rect.w&&t.y>=this._rect.y&&t.y<=this._rect.y+this._rect.h};return i});
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/tools/CreateRectangleTool", ["../library","./Tool","./CreateRectangleToolHandler","./CreateRectangleToolGizmo"],function(t,e,i,o){"use strict";var r=e.extend("sap.ui.vk.tools.CreateRectangleTool",{metadata:{library:"sap.ui.vk",properties:{parentNode:{type:"any",defaultValue:null},uniformMode:{type:"boolean",defaultValue:false}},events:{completed:{parameters:{node:{type:"any"},request:{type:"any"}}}}},constructor:function(t,o){if(r._instance){return r._instance}e.apply(this,arguments);this._viewport=null;this._handler=new i(this);r._instance=this;return this}});r.prototype.init=function(){if(e.prototype.init){e.prototype.init.call(this)}this.setFootprint(["sap.ui.vk.svg.Viewport","sap.ui.vk.pdf.Viewport"]);this.setAggregation("gizmo",new o)};r.prototype.setActive=function(t,i,o){e.prototype.setActive.call(this,t,i,o);var r=this._viewport;if(r){if(t){this._gizmo=this.getGizmo();if(this._gizmo){this._gizmo.show(r,this)}this._addLocoHandler()}else{this._removeLocoHandler();if(this._gizmo){this._gizmo.hide();this._gizmo=null}}}return this};r.prototype.setMaterial=function(t,e,i){this._material=t;this._lineStyle=e;this._fillStyle=i};r.prototype.queueCommand=function(t){if(this._addLocoHandler()){if(this.isViewportType("sap.ui.vk.svg.Viewport")){t()}}return this};r.prototype.setParentNode=function(t){if(t===this.getParentNode()){return this}this.setProperty("parentNode",t,true);if(this._gizmo){this._gizmo.updateParentNode()}return this};return r});
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/tools/CreateRectangleToolGizmo", ["./CreateParametricGizmo","../svg/Element","../svg/Rectangle"],function(t,e,i){"use strict";var a=t.extend("sap.ui.vk.tools.CreateRectangleToolGizmo",{metadata:{library:"sap.ui.vk"},renderer:null});a.prototype.hasDomElement=function(){return false};a.prototype.show=function(t,e){t.addStyleClass("sapVizKitViewportCreateToolActive");this._viewport=t;this._tool=e;this.updateParentNode()};a.prototype.hide=function(){this._viewport.removeStyleClass("sapVizKitViewportCreateToolActive");this._viewport=null;this._tool=null;this._root=null};a.prototype._startAdding=function(t){this._startPos=t;var a=this._viewport._camera._transformRect({x1:0,y1:0,x2:1,y2:1});this._minWidth=a.x2-a.x1;this._minHeight=a.y2-a.y1;this._activeElement=new i({subelement:true,width:this._minWidth,height:this._minHeight,material:this._tool._material,lineStyle:this._tool._lineStyle,fillStyle:this._tool._fillStyle});var o=new e({name:"Rectangle",matrix:[1,0,0,1,t.x,t.y]});this._setPageIndexIfExists(o);o.add(this._activeElement);this._root.add(o)};a.prototype._update=function(t,e){var i=this._startPos;var a=this._activeElement;if(a){var o=Math.min(i.x,t.x);var s=Math.min(i.y,t.y);var r=Math.max(Math.abs(i.x-t.x),this._minWidth);var n=Math.max(Math.abs(i.y-t.y),this._minHeight);if(this._tool.getUniformMode()^e){if(r<n){r=n;if(t.x<i.x){o=i.x-r}}else{n=r;if(t.y<i.y){s=i.y-n}}}a.parent.setMatrix([1,0,0,1,o,s]);a.width=r;a.height=n;a.invalidate()}};a.prototype._stopAdding=function(t){var e=this._activeElement;this._activeElement=null;if(t){this._tool.fireCompleted({node:e.parent,request:this._createRequest(e.parent)})}else{this._root.remove(e.parent)}};return a});
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/tools/CreateRectangleToolHandler", ["sap/ui/base/EventProvider","../svg/Element"],function(t,e){"use strict";var o=t.extend("sap.ui.vk.tools.CreateRectangleToolHandler",{metadata:{library:"sap.ui.vk"},constructor:function(t){this._priority=30;this._tool=t;this._rect=null}});o.prototype._getPosition=function(t){var o=this._tool._viewport._camera._screenToWorld(t.x-this._rect.x,t.y-this._rect.y);var i=e._invertMatrix(this._tool.getGizmo()._root._matrixWorld());return e._transformPoint(o.x,o.y,i)};o.prototype.hover=function(t){};o.prototype.beginGesture=function(t){var e=this._tool.getGizmo();if(e&&this._inside(t)){if(t.buttons===1){this._gesture=true;this._pointerMoved=false;t.handled=true;e._startAdding(this._getPosition(t))}}};o.prototype.move=function(t){if(this._gesture){this._pointerMoved=true;t.handled=true;this._tool.getGizmo()._update(this._getPosition(t),t.event&&(sap.ui.Device.os.macintosh?t.event.metaKey:t.event.ctrlKey))}};o.prototype.endGesture=function(t){if(this._gesture){this._gesture=false;t.handled=true;const e=this._pointerMoved;this._pointerMoved=false;this._tool.getGizmo()._stopAdding(e)}};o.prototype.click=function(t){var e=this._tool.getGizmo();if(e&&this._inside(t)){t.handled=true}};o.prototype.doubleClick=function(t){};o.prototype.contextMenu=function(t){};o.prototype.getViewport=function(){return this._tool._viewport};o.prototype._getOffset=function(t){var e=t.getBoundingClientRect();var o={x:e.left+window.pageXOffset,y:e.top+window.pageYOffset};return o};o.prototype._inside=function(t){var e=this._tool._viewport.getIdForLabel();var o=document.getElementById(e);if(o==null){return false}var i=this._getOffset(o);this._rect={x:i.x,y:i.y,w:o.offsetWidth,h:o.offsetHeight};return t.x>=this._rect.x&&t.x<=this._rect.x+this._rect.w&&t.y>=this._rect.y&&t.y<=this._rect.y+this._rect.h};return o});
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/tools/CreateTextTool", ["./Tool","./CreateTextToolHandler","./CreateTextToolGizmo"],function(t,e,i){"use strict";var o=t.extend("sap.ui.vk.tools.CreateTextTool",{metadata:{library:"sap.ui.vk",properties:{parentNode:{type:"any",defaultValue:null},fontSize:{type:"string",defaultValue:"14"},fontFace:{type:"string",defaultValue:"Verdana,Arial,Helvetica,sans-serif"}},events:{completed:{parameters:{node:{type:"any"},request:{type:"any"}}}}},constructor:function(i,s){if(o._instance){return o._instance}t.apply(this,arguments);this._viewport=null;this._handler=new e(this);o._instance=this;return this}});o.prototype.init=function(){if(t.prototype.init){t.prototype.init.call(this)}this.setFootprint(["sap.ui.vk.svg.Viewport"]);this.setAggregation("gizmo",new i)};o.prototype.setActive=function(e,i,o){t.prototype.setActive.call(this,e,i,o);var s=this._viewport;if(s){if(e){this._gizmo=this.getGizmo();if(this._gizmo){this._gizmo.show(s,this)}this._addLocoHandler()}else{this._removeLocoHandler();if(this._gizmo){this._gizmo.hide();this._gizmo=null}}}return this};o.prototype.setMaterial=function(t,e,i){this._material=t;this._lineStyle=e;this._fillStyle=i};o.prototype._editText=function(t){if(this._gizmo){this._gizmo._editText(t)}};o.prototype.queueCommand=function(t){if(this._addLocoHandler()){if(this.isViewportType("sap.ui.vk.svg.Viewport")){t()}}return this};o.prototype.setParentNode=function(t){if(t===this.getParentNode()){return this}this.setProperty("parentNode",t,true);if(this._gizmo){this._gizmo.updateParentNode()}return this};return o});
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/tools/CreateTextToolGizmo", ["./CreateParametricGizmo","../svg/Element","../svg/Text","sap/ui/richtexteditor/RichTextEditor","sap/m/Popover","sap/m/VBox","sap/m/Button","sap/m/library"],function(t,e,o,i,n,r,s,a){"use strict";const l=a.PlacementType;var p=t.extend("sap.ui.vk.tools.CreateTextToolGizmo",{metadata:{library:"sap.ui.vk"},renderer:{apiVersion:2,render:function(t,e){t.openStart("div",e);t.style("position","absolute");t.style("pointer-events","none");t.openEnd();t.close("div")}}});p.prototype.hasDomElement=function(){return true};p.prototype.show=function(t,e){this._viewport=t;this._tool=e;this._editForm=null;this.updateParentNode()};p.prototype.hide=function(){this._viewport=null;this._tool=null;this._root=null;if(this._editForm){this._editForm.close();this._editForm=null}};p.prototype._createText=function(t,i){if(this._editForm){return}var n=1/this._viewport._camera.zoom;var r=e._multiplyMatrices(e._invertMatrix(this._root._matrixWorld()),[n,0,0,n,t.x,t.y]);var s=[1,0,0,r[3]<0?-1:1,0,0];if(r[3]<0){r[2]*=-1;r[3]*=-1}var a=new o({subelement:true,text:i,style:{size:this._tool.getFontSize(),fontFace:this._tool.getFontFace()},matrix:s,lineStyle:this._tool._lineStyle,fillStyle:this._tool._fillStyle});var l=new e({name:"Text",matrix:r});l.add(a);this._root.add(l);this._editText(a)};p.prototype._editText=function(t){var o=this.getDomRef();if(!o){this._editElementWhenReady=t;return}var a=e._transformPoint(t.x,t.y,t._matrixWorld());var p=this._viewport._camera._worldToScreen(a.x,a.y);o.style.left=p.x+"px";o.style.top=p.y+"px";var h=this._editForm=new n({showHeader:false,placement:l.PreferredLeftOrFlip,content:new r({items:[new i({width:"500px",height:"200px",wrapping:false,customToolbar:true,showGroupUndo:true,showGroupFont:true,showGroupTextAlign:false,value:t.getHtmlTextContent(),change:function(e){t.setHtmlTextContent(this.getValue())},customButtons:[new s({text:"OK",press:function(){h.close()}})]}).addStyleClass("sapUiSizeCompact"),new s({text:"OK",press:function(){h.close()}})]})});h.attachAfterClose(function(){this._tool.fireCompleted({node:t.parent,request:this._createRequest(t.parent)});this._editForm=null}.bind(this));h.openBy(this)};p.prototype.onAfterRendering=function(){if(this._editElementWhenReady){this._editText(this._editElementWhenReady);this._editElementWhenReady=null}};return p});
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/tools/CreateTextToolHandler", ["sap/ui/base/EventProvider","../svg/Element"],function(t,e){"use strict";var o=t.extend("sap.ui.vk.tools.CreateTextToolHandler",{metadata:{library:"sap.ui.vk"},constructor:function(t){this._priority=30;this._tool=t;this._rect=null}});o.prototype._getPosition=function(t){return this._tool._viewport._camera._screenToWorld(t.x-this._rect.x,t.y-this._rect.y)};o.prototype.hover=function(t){};o.prototype.beginGesture=function(t){};o.prototype.move=function(t){};o.prototype.endGesture=function(t){};o.prototype.click=function(t){var e=this._tool.getGizmo();if(e&&this._inside(t)){this._tool.getGizmo()._createText(this._getPosition(t),"Text");t.handled=true}};o.prototype.doubleClick=function(t){};o.prototype.contextMenu=function(t){};o.prototype.getViewport=function(){return this._tool._viewport};o.prototype._getOffset=function(t){var e=t.getBoundingClientRect();var o={x:e.left+window.pageXOffset,y:e.top+window.pageYOffset};return o};o.prototype._inside=function(t){var e=this._tool._viewport.getIdForLabel();var o=document.getElementById(e);if(o==null){return false}var i=this._getOffset(o);this._rect={x:i.x,y:i.y,w:o.offsetWidth,h:o.offsetHeight};return t.x>=this._rect.x&&t.x<=this._rect.x+this._rect.w&&t.y>=this._rect.y&&t.y<=this._rect.y+this._rect.h};return o});
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/tools/CrossSectionTool", ["./Tool","./CrossSectionToolHandler","./CrossSectionToolGizmo"],function(t,i,o){"use strict";var e=t.extend("sap.ui.vk.tools.CrossSectionTool",{metadata:{library:"sap.ui.vk",properties:{showEditingUI:{type:"boolean",defaultValue:false}}},constructor:function(o,s){if(e._instance){return e._instance}t.apply(this,arguments);this._viewport=null;this._handler=new i(this);this._gizmo=null;e._instance=this;return this}});e.prototype.init=function(){if(t.prototype.init){t.prototype.init.call(this)}this.setFootprint(["sap.ui.vk.threejs.Viewport"]);this.setAggregation("gizmo",new o)};e.prototype.setActive=function(i,o,e){t.prototype.setActive.call(this,i,o,e);if(this._viewport){if(i){this._gizmo=this.getGizmo();this._gizmo.show(this._viewport,this);this._addLocoHandler()}else{this._removeLocoHandler();if(this._gizmo){this._gizmo.hide();this._gizmo=null}}}return this};e.prototype.setAxis=function(t){if(this._gizmo){this._gizmo.setAxis(t)}return this};e.prototype.setFlip=function(t){if(this._gizmo){this._gizmo.setFlip(t)}return this};e.prototype.getFlip=function(){return this._gizmo?this._gizmo._flip:undefined};e.prototype.setShowEditingUI=function(t){this.setProperty("showEditingUI",t,true);if(this._viewport){this._viewport.setShouldRenderFrame()}return this};e.prototype.queueCommand=function(t){if(this._addLocoHandler()){if(this.isViewportType("sap.ui.vk.threejs.Viewport")){t()}}return this};e.prototype.destroy=function(){t.prototype.destroy.call(this);this._viewport=null;delete e._instance};return e});
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/tools/CrossSectionToolGizmo", ["../getResourceBundle","../thirdparty/three","./Gizmo","./AxisColours","../threejs/ThreeUtils","sap/base/assert"],function(t,e,i,o,r,n){"use strict";var s=i.extend("sap.ui.vk.tools.CrossSectionToolGizmo",{metadata:{library:"sap.ui.vk"},renderer:{apiVersion:2,render:function(t,e){t.openStart("div",e);t.class("sapUiVkTransformationToolEdit");t.openEnd();t.renderControl(e._editingForm);t.close("div")}}});s.prototype.init=function(){if(i.prototype.init){i.prototype.init.apply(this)}this._createEditingForm(t().getText("TOOL_UNITS_MM"),84);this._handleIndex=-1;this._viewport=null;this._tool=null;this._position=new e.Vector3(0,0,0);this._plane=new e.Plane(new e.Vector3(0,0,1),0);this._flip=false;this._matViewProj=new e.Matrix4;this._gizmoSize=144;this._firstShowPress=true;this.setAxis(0)};s.prototype.hasDomElement=function(){return true};s.prototype.show=function(t,i){this._viewport=t;this._tool=i;if(this._firstShowPress){var o=t._scene?t._scene._computeBoundingBox(true,true):new e.Box3;o.getCenter(this._position);this._firstShowPress=false}this._plane.constant=-this._plane.normal.dot(this._position);t.setClippingPlanes([this._plane])};s.prototype.hide=function(){if(this._viewport){this._viewport.setClippingPlanes([]);this._viewport=null}this._handleIndex=-1;this._tool=null;this._updateEditingForm(false,-1)};s.prototype._getOffset=function(){return this._position.getComponent(this._axis)};s.prototype.getAxis=function(){return this._axis};s.prototype.setAxis=function(t){this._handleIndex=-1;this._axis=t;var i=(new e.Vector3).setComponent(t,1);this._plane.normal.set(0,0,0).setComponent(t,this._flip?-1:1);this._plane.constant=-this._plane.normal.dot(this._position);var r=new e.BufferGeometry;var n=new Array(15);var s=new e.Vector3(i.y,i.z,i.x),a=new e.Vector3(i.z,i.x,i.y),h=new e.Vector3;h.sub(s).sub(a).multiplyScalar(.5).toArray(n,0);h.toArray(n,12);h.add(s).toArray(n,3);h.add(a).toArray(n,6);h.sub(s).toArray(n,9);r.setAttribute("position",new e.Float32BufferAttribute(n,3));this._gizmoPlane=new e.Line(r,new e.LineBasicMaterial({color:4210752,transparent:true,linewidth:window.devicePixelRatio}));var p=144,l=window.devicePixelRatio*.5,_=32,u=6,m=48;i=this._plane.normal.clone().multiplyScalar(1/p);var d=0;switch(t){case 0:d=o.x;break;case 1:d=o.y;break;case 2:d=o.z;break;default:break}var c=new e.CylinderGeometry(l,l,p-_,4);var w=(new e.Matrix4).makeBasis(new e.Vector3(i.y,i.z,i.x),i,new e.Vector3(i.z,i.x,i.y));w.setPosition(i.clone().multiplyScalar((p-_)*.5));c.applyMatrix4(w);this._gizmoArrow=new e.Mesh(c,new e.MeshBasicMaterial({color:d}));this._gizmoArrow.userData.color=d;var g=new e.CylinderGeometry(0,u,_,12,1);w.setPosition(i.clone().multiplyScalar(p-_*.5));g.applyMatrix4(w);var x=new e.Mesh(g,new e.MeshBasicMaterial({color:d}));x.matrixAutoUpdate=false;this._gizmoArrow.add(x);var y=new e.CylinderGeometry(m*.5,m*.5,p,12,1);w.setPosition(i.clone().multiplyScalar(p*.5));y.applyMatrix4(w);this._touchMesh=new e.Mesh(y,new e.MeshBasicMaterial({visible:false,side:e.DoubleSide}));this._gizmoArrow.add(this._touchMesh);if(this._viewport){this._viewport.setShouldRenderFrame()}return this};s.prototype.setFlip=function(t){this._flip=!!t;var e=this._handleIndex;this.setAxis(this._axis);this._handleIndex=e;return this};s.prototype.getTouchObject=function(){return this._touchMesh};var a=new e.Vector3;s.prototype._getDelta=function(){var t=this._viewport._scene._computeBoundingBox(true,true);t.getSize(a);return Math.max(a.x,a.y,a.z)};s.prototype._setOffset=function(t){var i=this._viewport._scene._computeBoundingBox(true,true);t=e.MathUtils.clamp(t,i.min.getComponent(this._axis),i.max.getComponent(this._axis));this._position.setComponent(this._axis,t);this._plane.constant=-this._plane.normal.dot(this._position);this._viewport.setShouldRenderFrame()};s.prototype.getValue=function(){return this._position.getComponent(this._handleIndex)};s.prototype.setValue=function(t){if(this._handleIndex>=0){this._position.setComponent(this._handleIndex,t);this._plane.constant=t;this._viewport.setShouldRenderFrame()}};s.prototype.highlightArrowHandle=function(t){var e=t?16776960:this._gizmoArrow.userData.color;this._gizmoArrow.material.color.setHex(e);this._gizmoArrow.children[0].material.color.setHex(e)};s.prototype.selectHandle=function(t){this._handleIndex=t;this._viewport.setShouldRenderFrame()};s.prototype._adjustBoundingBox=function(t){t.getSize(a);var e=Math.max(a.x,a.y,a.z)*.2;t.expandByScalar(e)};s.prototype._updateGizmo=function(t){var i=this._axis;var o=e.MathUtils.clamp(this._position.getComponent(i),t.min.getComponent(i),t.max.getComponent(i));this._position.setComponent(i,o);this._plane.constant=-this._plane.normal.dot(this._position);this._adjustBoundingBox(t);t.getCenter(this._gizmoPlane.position);this._gizmoPlane.position.setComponent(i,o);t.getSize(this._gizmoPlane.scale);this._gizmoPlane.updateMatrixWorld(true);var r=this._viewport.getCamera().getCameraRef();this._gizmoArrow.position.copy(this._gizmoPlane.position);this._matViewProj.multiplyMatrices(r.projectionMatrix,r.matrixWorldInverse);this._gizmoArrow.scale.setScalar(this._gizmoSize*this._getGizmoScale(this._gizmoArrow.position));this._gizmoArrow.updateMatrixWorld(true)};s.prototype.expandBoundingBox=function(t){if(this._viewport){var e=this._viewport._scene._computeBoundingBox(true,true);this._updateGizmo(e);t.min.min(e.min);t.max.max(e.max);t.expandByPoint(this._plane.normal.clone().multiply(this._gizmoArrow.scale).add(this._gizmoArrow.position))}};s.prototype._getEditingFormPosition=function(){return this._plane.normal.clone().applyMatrix4(this._gizmoArrow.matrixWorld).applyMatrix4(this._matViewProj)};s.prototype.render=function(){n(this._viewport&&this._viewport.getMetadata().getName()==="sap.ui.vk.threejs.Viewport","Can't render gizmo without sap.ui.vk.threejs.Viewport");var t=this._viewport._scene._computeBoundingBox(true,true);this._updateGizmo(t);var e=this._viewport.getRenderer(),i=this._viewport.getCamera().getCameraRef();e.render(this._gizmoPlane,i);e.clearDepth();e.render(this._gizmoArrow,i);this._gizmo=this._gizmoArrow;this._updateEditingForm(this._handleIndex>=0,this._handleIndex)};s.prototype.exit=function(){if(this._gizmoArrow){r.disposeObject(this._gizmoArrow);this._gizmoArrow=null}if(this._gizmoPlane){r.disposeObject(this._gizmoPlane);this._gizmoPlane=null}if(this._touchMesh){r.disposeObject(this._touchMesh);this._touchMesh=null}i.prototype.exit.call(this)};return s});
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/tools/CrossSectionToolHandler", ["sap/ui/base/EventProvider","../thirdparty/three"],function(t,e){"use strict";var i=t.extend("sap.ui.vk.tools.CrossSectionToolHandler",{metadata:{library:"sap.ui.vk"},constructor:function(t){this._priority=20;this._tool=t;this._gizmo=t.getGizmo();this._rect=null;this._mouse=new e.Vector2;this._rayCaster=new e.Raycaster;this._rayCaster.linePrecision=0;this._gizmoAxis=new e.Vector3;this._dragOrigin=new e.Vector2;this._dragOffset=0;this._dragDelta=0}});i.prototype._updateRayCaster=function(t){var i=this.getViewport().getRenderer().getSize(new e.Vector2);this._mouse.x=(t.x-this._rect.x)/i.width*2-1;this._mouse.y=(t.y-this._rect.y)/i.height*-2+1;this._rayCaster.setFromCamera(this._mouse,this.getViewport().getCamera().getCameraRef())};i.prototype._updateArrowHandle=function(t){var e=this._gizmo.getTouchObject();var i=-1;if(t.n===1){this._updateRayCaster(t);var s=this._rayCaster.intersectObject(e,true);i=s.length>0?this._gizmo.getAxis():-1}if(i!==this._axisIndex){this._axisIndex=i;this._gizmo.highlightArrowHandle(i>=0);if(i>=0){this._gizmoAxis.setScalar(0).setComponent(this._axisIndex,1)}this.getViewport().setShouldRenderFrame()}};i.prototype.hover=function(t){if(this._inside(t)&&!this._gesture){this._updateArrowHandle(t);t.handled|=this._axisIndex>=0}};i.prototype.click=function(t){if(this._inside(t)&&!this._gesture){this._updateArrowHandle(t);this._gizmo.selectHandle(this._axisIndex);t.handled|=this._axisIndex>=0}};i.prototype.beginGesture=function(t){if(this._inside(t)&&!this._gesture){this._updateArrowHandle(t);this._gizmo.selectHandle(this._axisIndex);if(this._axisIndex>=0){this._gesture=true;t.handled=true;this._dragOrigin.set(t.x,t.y);this._dragOffset=this._gizmo._getOffset();this._dragDelta=this._gizmo._getDelta()/500}}};i.prototype.move=function(t){if(this._gesture){t.handled=true;this._updateRayCaster(t);var e=this._gizmoAxis.clone().applyQuaternion(this.getViewport().getCamera().getCameraRef().quaternion.clone().invert());e.z=0;e.normalize();if(e.x===0&&e.y===0){e.y=1}this._gizmo._setOffset(this._dragOffset+((t.x-this._dragOrigin.x)*e.x-(t.y-this._dragOrigin.y)*e.y)*this._dragDelta)}};i.prototype.endGesture=function(t){if(this._gesture){this._gesture=false;t.handled=true;this._updateArrowHandle(t)}};i.prototype.getViewport=function(){return this._tool._viewport};i.prototype._getOffset=function(t){var e=t.getBoundingClientRect();var i={x:e.left+window.pageXOffset,y:e.top+window.pageYOffset};return i};i.prototype._inside=function(t){var e=this._tool._viewport.getIdForLabel();var i=document.getElementById(e);if(i===null){return false}var s=this._getOffset(i);this._rect={x:s.x,y:s.y,w:i.offsetWidth,h:i.offsetHeight};return t.x>=this._rect.x&&t.x<=this._rect.x+this._rect.w&&t.y>=this._rect.y&&t.y<=this._rect.y+this._rect.h};return i});
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/tools/DeleteMeasurementTool", ["./DeleteMeasurementToolHandler","./Tool"],function(e,t){"use strict";var i=t.extend("sap.ui.vk.tools.DeleteMeasurementTool",{metadata:{library:"sap.ui.vk"}});var r=i.getMetadata().getParent().getClass().prototype;i.prototype.init=function(){if(r.init){r.init.call(this)}this._viewport=null;this._handler=new e(this);this._highlightedMeasurementDomRef=null;this.setFootprint(["sap.ui.vk.threejs.Viewport","sap.ui.vk.svg.Viewport"])};i.prototype.setActive=function(e,t,i){r.setActive.call(this,e,t,i);if(this._viewport){if(e){this._addLocoHandler();this._viewport.addStyleClass("sapUiVizKitDeleteDistanceCursor")}else{this._viewport.removeStyleClass("sapUiVizKitDeleteDistanceCursor");this.highlightMeasurement(null,this._viewport.getMeasurementSurface());this._removeLocoHandler()}}return this};i.prototype.highlightMeasurement=function(e,t){var i=this._highlightedMeasurementDomRef;if(e===i){return null}if(i!=null){this._viewport.getMeasurementSurface().highlightMeasurement(i._measurement,false)}if(e!=null){this._viewport.getMeasurementSurface().highlightMeasurement(e._measurement,true,this._viewport,this._viewport.getCamera())}this._highlightedMeasurementDomRef=e;return this};i.prototype.removeMeasurement=function(e){var t=this._viewport.getMeasurementSurface();var i=e._measurement;t.removeMeasurement(i);if(t.getMeasurements().length===0){this.setActive(false,this._viewport)}return this};return i});
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/tools/DeleteMeasurementToolHandler", ["sap/ui/base/EventProvider"],function(t){"use strict";var e=t.extend("sap.ui.vk.tools.DeleteMeasurementToolHandler",{metadata:{library:"sap.ui.vk"},constructor:function(t){this._priority=0;this._tool=t;this._rect=null}});e.prototype.destroy=function(){this._tool=null;this._rect=null};e.prototype.hover=function(t){var e=this._tool;var r=e._viewport;var o=r.getMeasurementSurface();if(this._inside(t)&&r.getScene()){var i=t.x-this._rect.x;var n=t.y-this._rect.y;e.highlightMeasurement(o.hitTest(i,n),o)}else{e.highlightMeasurement(null,o)}};e.prototype.beginGesture=function(t){};e.prototype.move=function(t){};e.prototype.endGesture=function(t){};e.prototype.click=function(t){t.handled=true;var e=this._tool;var r=e._viewport;if(this._inside(t)&&r.getScene()){var o=t.x-this._rect.x;var i=t.y-this._rect.y;var n=r.getMeasurementSurface().hitTest(o,i);if(n){e.removeMeasurement(n)}}};e.prototype.doubleClick=function(t){};e.prototype.contextMenu=function(t){};e.prototype.keyEventHandler=function(t){if(t.code==="Escape"){var e=this._tool;e.setActive(false,e._viewport);t.handled=true}};e.prototype._getOffset=function(t){var e=t.getBoundingClientRect();var r={x:e.left+window.pageXOffset,y:e.top+window.pageYOffset};return r};e.prototype._inside=function(t){var e=this._tool._viewport.getIdForLabel();var r=document.getElementById(e);if(r==null){return false}var o=this._getOffset(r);var i=this._rect={x:o.x,y:o.y,w:r.offsetWidth,h:r.offsetHeight};return t.x>=i.x&&t.x<=i.x+i.w&&t.y>=i.y&&t.y<=i.y+i.h};return e});
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/tools/DistanceMeasurementTool", ["sap/ui/core/Fragment","sap/ui/core/IconPool","sap/ui/core/format/NumberFormat","sap/ui/model/json/JSONModel","sap/ui/model/resource/ResourceModel","./Tool","./MeasurementToolHandler","./DistanceMeasurementToolGizmo","../measurements/Settings","../getResourceBundle"],function(e,t,i,o,s,a,n,r,l,u){"use strict";var c="vk-icons";var d="vk-icons";t.addIcon("measurement-vertex",c,d,"e965");t.addIcon("measurement-edge",c,d,"e964");t.addIcon("measurement-face",c,d,"e963");t.addIcon("fill-color",c,d,"e92f");var m=a.extend("sap.ui.vk.tools.DistanceMeasurementTool",{metadata:{library:"sap.ui.vk"}});var p=m.getMetadata().getParent().getClass().prototype;m.prototype.init=function(){if(p.init){p.init.call(this)}this._viewport=null;this._handler=new n(this);this.setFootprint(["sap.ui.vk.threejs.Viewport","sap.ui.vk.svg.Viewport"]);this.setGizmo(new r)};m.prototype.exit=function(){p.exit.apply(this,arguments)};m.prototype.setActive=function(e,t,i){p.setActive.call(this,e,t,i);if(this._viewport){if(e){this._gizmo=this.getGizmo();if(this._gizmo){this._gizmo.show(this._viewport,this)}this._addLocoHandler();this._viewport.addStyleClass("sapUiVizKitDistanceCursor")}else{this._viewport.removeStyleClass("sapUiVizKitDistanceCursor");this._removeLocoHandler();if(this._gizmo){this._gizmo.hide();this._gizmo=null}}}return this};m.prototype.showSettingsDialog=function(t){var a=l.load();var n=t.getCamera();var r=t.getMeasurementSurface();var c;e.load({name:"sap.ui.vk.measurements.Settings",id:this.getId()+"-settings-dialog",controller:{formatPrecision:function(e){var t=i.getFloatInstance({minFractionDigits:e,maxFractionDigits:e});return t.format(Math.pow(10,-e))},onClosePressed:function(e){c.close()},onAfterClose:function(e){c.destroy();c=null},onChange:function(e){l.save(a);r.updateSettings(a);r.update(t,n)}}}).then(function(e){c=e;c.setModel(new s({bundle:u()}),"i18n");c.setModel(new o(a),"settings");c.setModel(new o({is2D:t.getScene().getMetadata().getName()==="sap.ui.vk.svg.Scene"}),"extra");c.open()})};return m});
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/tools/DistanceMeasurementToolGizmo", ["../measurements/Distance","../measurements/Utils","./MeasurementToolState","./MeasurementToolGizmo"],function(e,t,r,s){"use strict";var i=s.extend("sap.ui.vk.tools.DistanceMeasurementToolGizmo",{metadata:{library:"sap.ui.vk"},renderer:null});var u=i.getMetadata().getParent().getClass().prototype;i.prototype.init=function(){if(u.init){u.init.call(this)}};i.prototype._updateCurrentFeature=function(e,t,r,s,i,u){var a=e==null?null:this._getMeshAnalyzer(e);var n=false;if(a!=null&&(s||i||u)){const e=this._computeSphereRadius(t,r);const h=this._getPointRadius(r);const l=a.intersectSphere(t,e,s,i,u,false,false,h);if(this._is2D){if(l.vertex!=null){if(this._replaceCurrentFeature(this._vertexFeatures[this._currentFeatureIndex],l.vertexId,a)){this._currentFeature.setValue(l.vertex);return true}}else if(l.edge!=null){if(this._replaceCurrentFeature(this._edgeFeatures[this._currentFeatureIndex],l.edgeId,a)){this._currentFeature.setValue(l.edge);return true}}else{this._replaceCurrentFeature(this._vertexFeatures[this._currentFeatureIndex],null,a);this._currentFeature.setValue(t);return true}}else{if(l.vertexId!=null){if(this._replaceCurrentFeature(this._vertexFeatures[this._currentFeatureIndex],l.vertexId,a)){this._currentFeature.setValue(a.getVertex(l.vertexId));return true}}else if(l.edgeId!=null){if(this._replaceCurrentFeature(this._edgeFeatures[this._currentFeatureIndex],l.edgeId,a)){this._currentFeature.setValue(a.buildEdgePath(l.edgeId,true));return true}}else if(l.faceId!=null){if(this._replaceCurrentFeature(this._faceFeatures[this._currentFeatureIndex],l.faceId,a)){this._currentFeature.setValue(a.buildFace(l.faceId));return true}}else{n=true}}}else{this._replaceCurrentFeature(this._vertexFeatures[this._currentFeatureIndex],null,a);this._currentFeature.setValue(t);return true}if(n&&this._currentFeature){this._surface.removeFeature(this._currentFeature);this._currentFeature=null;return true}return false};i.prototype._updateMeasurement=function(e){var r=this._firstFeature;var s=this._currentFeature;var i=r&&(r.isEdge||r.isFace);var u=s&&(s.isEdge||s.isFace);var a=this._hoverPoint.worldPoint;var n=null;if(s&&s.isVertex){a=s.getValue()}if(i&&u){var h;if(r.isEdge){if(s.isEdge){h=t.findClosestPointEdgeToEdge(s.getValue(),r.getValue())}else{h=t.findClosestPointFaceToEdge(s.getValue(),r.getValue())}n=[h[3],h[4],h[5]];a[0]=h[0];a[1]=h[1];a[2]=h[2]}else{if(s.isEdge){h=t.findClosestPointFaceToEdge(r.getValue(),s.getValue())}else{h=t.findClosestPointFaceToFace(r.getValue(),s.getValue())}n=[h[0],h[1],h[2]];a[0]=h[3];a[1]=h[4];a[2]=h[5]}}else if(i){if(r.isEdge){n=t.findClosestPointEdgeToPoint(r.getValue(),a)}else{n=t.findClosestPointFaceToPoint(r.getValue(),a)}}else if(u){var l=e.getPoint1();if(s.isEdge){a=t.findClosestPointEdgeToPoint(s.getValue(),l)}else{a=t.findClosestPointFaceToPoint(s.getValue(),l)}}if(n){e.setPoint1(n)}e.setPoint2(a)};i.prototype.setHoverPoint=function(e){var t=this._hoverPoint&&this._hoverPoint.nodeRef;var s=e&&e.nodeRef;if(s!=t){var i=this._vsm;if(i!=null){var u=s!=null?[s]:[];var a=t!=null?[t]:[];i.setOutliningStates(u,a,false,true)}}this._hoverPoint=e;var n=this._state===r.SearchingSecondFeature?this._currentMeasurement:null;if(!e||e.worldPoint==null){if(n){n.setVisible(false);this._surface.update(this._viewport,this._viewport.getCamera())}if(this._currentFeature){this._surface.removeFeature(this._currentFeature);this._currentFeature=null}}else{var h=this._settings;var l=!e.shiftKey&&h.featureFace&&!this._is2D;var o=!e.shiftKey&&h.featureEdge;var c=!e.shiftKey&&h.featureVertex;var _=true;if(s||this._is2D){_=this._updateCurrentFeature(s,this._hoverPoint.worldPoint,this._viewport,l,o,c)}else if(this._currentFeature){this._surface.removeFeature(this._currentFeature);this._currentFeature=null}if(n&&_){this._updateMeasurement(n);n.setVisible(true)}this._surface.update(this._viewport,this._viewport.getCamera())}return this};i.prototype.fixPoint=function(t){var s=this._state;switch(s){case r.SearchingFirstFeature:if(!t.worldPoint){break}this._firstFeature=this._currentFeature;this._currentFeature=null;this.setCurrentFeatureIndex(1);this._state=r.SearchingSecondFeature;var i=t.worldPoint.slice();if(this._firstFeature&&this._firstFeature.isVertex){var u=this._firstFeature.getValue();i[0]=u[0];i[1]=u[1];i[2]=u[2]}var a=new e({point1:i,point2:i});this._surface.beginMeasurementConstruction(a);this._currentMeasurement=a;break;case r.SearchingSecondFeature:if(this._currentMeasurement.getDistance()<1e-5){break}this._currentMeasurement.setShowArrows(true);this._currentMeasurement.setFeatures([this._firstFeature,this._currentFeature]);this._surface.update(this._viewport,this._viewport.getCamera());this._state=r.SearchingFirstFeature;this._surface.removeFeature(this._currentFeature);this._surface.removeFeature(this._firstFeature);this._currentFeature=null;this._firstFeature=null;this.setCurrentFeatureIndex(0);var n=this._currentMeasurement;this._currentMeasurement=null;this._surface.endMeasurementConstruction(n);break;default:break}return this};i.prototype.escapePressed=function(){switch(this._state){case r.SearchingSecondFeature:this._state=r.SearchingFirstFeature;this._surface.removeFeature(this._firstFeature);if(this._currentFeature){this._surface.removeFeature(this._currentFeature)}this._firstFeature=this._currentFeature=null;this.setCurrentFeatureIndex(0);this._surface.cancelMeasurementConstruction(this._currentMeasurement);this._currentMeasurement=null;break;case r.SearchingFirstFeature:if(this._currentFeature!=null){this._surface.removeFeature(this._currentFeature)}this._firstFeature=this._currentFeature=null;this.setCurrentFeatureIndex(0);this._state=r.Off;this._tool.setActive(false,this._viewport);break;default:break}};i.prototype.is2D=function(){return this._is2D};return i});
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/tools/DuplicateSvgElementTool", ["sap/base/Log","../library","./Tool","./DuplicateSvgElementToolHandler","./DuplicateSvgElementToolGizmo"],function(t,i,e,o,s){"use strict";var n=e.extend("sap.ui.vk.tools.DuplicateSvgElementTool",{metadata:{library:"sap.ui.vk",properties:{parentNode:{type:"any",defaultValue:null},nodeList:{type:"any[]",defaultValue:[]}},events:{nodesCreated:{parameters:{x:"float",y:"float",nodes:"any[]",request:"object"}}}},constructor:function(t,i){if(n._instance){return n._instance}e.apply(this,arguments);this._viewport=null;this._handler=new o(this);n._instance=this;return this}});n.prototype.init=function(){if(e.prototype.init){e.prototype.init.call(this)}this.setFootprint(["sap.ui.vk.svg.Viewport","sap.ui.vk.pdf.Viewport"]);this.setAggregation("gizmo",new s)};n.prototype.setActive=function(t,i,o){e.prototype.setActive.call(this,t,i,o);var s=this._viewport;if(s){if(t){this._gizmo=this.getGizmo();if(this._gizmo){this._gizmo.show(s,this)}this._addLocoHandler()}else{this._removeLocoHandler();if(this._gizmo){this._gizmo.hide();this._gizmo=null}}}return this};n.prototype.queueCommand=function(t){if(this._addLocoHandler()){if(this.isViewportType("sap.ui.vk.svg.Viewport")){t()}}return this};return n});
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/tools/DuplicateSvgElementToolGizmo", ["./CreateParametricGizmo","../svg/Element","./ToolNodeSet"],function(t,i,e){"use strict";var o=t.extend("sap.ui.vk.tools.DuplicateSvgElementToolGizmo",{metadata:{library:"sap.ui.vk"},renderer:null});o.prototype.hasDomElement=function(){return false};var r=30;var s=30;o.prototype.show=function(t,i){this._viewport=t;this._tool=i;this._updateNodeList()};o.prototype.hide=function(){this._clearNodeList();this._viewport=null;this._tool=null};o.prototype._clearNodeList=function(){if(this._nodes&&this._nodes.length>0){this._nodes.forEach(function(t){var i=t.node;i.parent.remove(i)})}this._nodes=[]};o.prototype._updateNodeList=function(){this._clearNodeList();this._origin=null;var t=this._tool.getNodeList();if(Array.isArray(t)&&t.length>0){this.updateParentNode();this._parentMatrixWorldInv=i._invertMatrix(this._root._matrixWorld());var e=t[0]._getBBox(t[0]._matrixWorld());this._origin=e?{x:e.x+e.width*.5,y:e.y+e.height*.5}:{x:0,y:0};var o=this._viewport._camera._transformRect({x1:0,y1:0,x2:r,y2:s});this._createNodes({x:this._origin.x+o.x2-o.x1,y:this._origin.y+o.x2-o.x1})}};o.prototype._createNodes=function(t){var e=[1,0,0,1,t.x-this._origin.x,t.y-this._origin.y];this._nodes=[];this._tool.getNodeList().forEach(function(t){var o=t.clone();o.userData.duplicatedFrom=t.sid;var r=t._matrixWorld();o.matrix.set(i._multiplyMatrices(this._parentMatrixWorldInv,i._multiplyMatrices(e,r)));this._root.add(o);this._nodes.push({node:o,matrixWorld:t._matrixWorld()})}.bind(this))};o.prototype._move=function(t){if(this._nodes&&this._nodes.length>0){var e=[1,0,0,1,t.x-this._origin.x,t.y-this._origin.y];var o=this._parentMatrixWorldInv;this._nodes.forEach(function(t){var r=i._multiplyMatrices(o,i._multiplyMatrices(e,t.matrixWorld));t.node.setMatrix(r)})}};o.prototype._complete=function(t){this._move(t);if(this._nodes&&this._nodes.length>0){var i=this._nodes.map(function(t){return t.node});this._tool.fireNodesCreated({x:t.x-this._origin.x,y:t.y-this._origin.y,nodes:i,request:this._createRequest(i)});this._createNodes(t)}};return o});
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/tools/DuplicateSvgElementToolHandler", ["sap/ui/base/EventProvider","../svg/Element"],function(t,e){"use strict";var o=t.extend("sap.ui.vk.tools.DuplicateSvgElementToolHandler",{metadata:{library:"sap.ui.vk"},constructor:function(t){this._priority=10;this._tool=t;this._rect=null}});o.prototype._getPosition=function(t){return this._tool._viewport._camera._screenToWorld(t.x-this._rect.x,t.y-this._rect.y)};o.prototype.hover=function(t){var e=this._tool.getGizmo();if(e&&this._inside(t)){e._move(this._getPosition(t))}};o.prototype.beginGesture=function(t){};o.prototype.move=function(t){};o.prototype.endGesture=function(t){};o.prototype.click=function(t){var e=this._tool.getGizmo();if(e&&this._inside(t)){t.handled=true;e._complete(this._getPosition(t))}};o.prototype.doubleClick=function(t){};o.prototype.contextMenu=function(t){};o.prototype.getViewport=function(){return this._tool._viewport};o.prototype._getOffset=function(t){var e=t.getBoundingClientRect();var o={x:e.left+window.pageXOffset,y:e.top+window.pageYOffset};return o};o.prototype._inside=function(t){var e=this._tool._viewport.getIdForLabel();var o=document.getElementById(e);if(o==null){return false}var i=this._getOffset(o);this._rect={x:i.x,y:i.y,w:o.offsetWidth,h:o.offsetHeight};return t.x>=this._rect.x&&t.x<=this._rect.x+this._rect.w&&t.y>=this._rect.y&&t.y<=this._rect.y+this._rect.h};return o});
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/tools/ExplodeAxis", ["sap/ui/base/DataType"],function(e){"use strict";var s={X:"X",Y:"Y",Z:"Z"};e.registerEnum("sap.ui.vk.tools.ExplodeAxis",s);return s},true);
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/tools/ExplodeDirection", ["sap/ui/base/DataType"],function(e){"use strict";var i={Positive:"Positive",Negative:"Negative"};e.registerEnum("sap.ui.vk.tools.ExplodeDirection",i);return i},true);
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/tools/ExplodeItemGroup", ["sap/ui/core/Element","../thirdparty/three"],function(t,e){"use strict";var i=t.extend("sap.ui.vk.tools.ExplodeItemGroup",{metadata:{library:"sap.ui.vk",properties:{name:{type:"string"},magnitudeAdjustmentMultiplier:{type:"float",defaultValue:0}},aggregations:{items:{type:"sap.ui.vk.NodeProxy",multiple:true}}}});i.prototype.init=function(){this._magnitude=0;this._offset=0;this._deltaOffset=0;this._center=new e.Vector3};i.prototype.getBoundingBox=function(){var t=new e.Box3;this.getItems().forEach(function(e){e.getNodeRef()._expandBoundingBox(t,false,true,true)});return t};i.prototype.getMagnitude=function(){return this._magnitude*(this._offset+this._deltaOffset*this.getMagnitudeAdjustmentMultiplier())};return i});
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/tools/ExplodeTool", ["./Tool","./ExplodeAxis","./ExplodeDirection","./ExplodeItemGroup","./ExplodeType","./ExplodeToolHandler","./ExplodeToolGizmo","../AnimationPlayback","../AnimationTrackType","../AnimationTrackValueType","../OrthographicCamera","sap/ui/base/ManagedObjectObserver","../getResourceBundle","../TransformationMatrix","../thirdparty/three"],function(e,t,i,o,a,r,s,n,p,l,u,d,c,h,m){"use strict";var g=e.extend("sap.ui.vk.tools.ExplodeTool",{metadata:{library:"sap.ui.vk",properties:{type:{type:"sap.ui.vk.tools.ExplodeType",defaultValue:a.Linear},axis:{type:"sap.ui.vk.tools.ExplodeAxis"},direction:{type:"sap.ui.vk.tools.ExplodeDirection"},magnitude:{type:"float",defaultValue:0},anchor:{type:"float[]",defaultValue:[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}},aggregations:{items:{type:"sap.ui.vk.tools.ExplodeItemGroup",multiple:true}},associations:{selectedItem:{type:"sap.ui.vk.tools.ExplodeItemGroup",multiple:false}},events:{axisSelected:{parameters:{axis:{type:"sap.ui.vk.tools.ExplodeAxis"},direction:{type:"sap.ui.vk.tools.ExplodeDirection"}}},magnitudeChanging:{parameters:{type:{type:"sap.ui.vk.tools.ExplodeType"},axis:{type:"sap.ui.vk.tools.ExplodeAxis"},direction:{type:"sap.ui.vk.tools.ExplodeDirection"},magnitude:{type:"float"}}},magnitudeChanged:{parameters:{type:{type:"sap.ui.vk.tools.ExplodeType"},axis:{type:"sap.ui.vk.tools.ExplodeAxis"},direction:{type:"sap.ui.vk.tools.ExplodeDirection"},magnitude:{type:"float"}}},itemSequenceChangePressed:{parameters:{item:{type:"sap.ui.vk.tools.ExplodeItemGroup"},moveUp:{type:"boolean"}}},itemPositionAdjusting:{parameters:{item:{type:"sap.ui.vk.tools.ExplodeItemGroup"},magnitudeAdjustmentMultiplier:{type:"float"}}},itemPositionAdjusted:{parameters:{item:{type:"sap.ui.vk.tools.ExplodeItemGroup"},magnitudeAdjustmentMultiplier:{type:"float"}}}}},constructor:function(t,i){e.apply(this,arguments);this._viewport=null;this._handler=new r(this);this._gizmo=null}});g.prototype.init=function(){if(e.prototype.init){e.prototype.init.call(this)}this.setFootprint(["sap.ui.vk.threejs.Viewport"]);this.setAggregation("gizmo",new s);this._groupObserver=new d(this._onGroupChanged.bind(this));this._groupsObserver=new d(this._onGroupsChanged.bind(this));this._groupsObserver.observe(this,{aggregations:["items"]})};g.prototype.destroy=function(){g._cleanAssociatedLoaders();this._groupsObserver.disconnect();this._groupsObserver=null;this._groupObserver.disconnect();this._groupObserver=null};g.prototype.setActive=function(t,i,o){e.prototype.setActive.call(this,t,i,o);if(this._viewport){if(t){this._gizmo=this.getGizmo();this._gizmo.show(this._viewport,this);this._addLocoHandler()}else{this._removeLocoHandler();if(this._gizmo){this._gizmo.hide();this._gizmo=null}}}return this};g.prototype.queueCommand=function(e){if(this._addLocoHandler()){if(this.isViewportType("sap.ui.vk.threejs.Viewport")){e()}}return this};g.prototype.setType=function(e){this.setProperty("type",e,true);if(this._gizmo){this._gizmo._recalculateOffsets()}};g.prototype.setAxis=function(e){this.setProperty("axis",e,true);if(this._gizmo){this._gizmo._updateAxis()}};g.prototype.setDirection=function(e){this.setProperty("direction",e,true);if(this._gizmo){this._gizmo._updateAxis()}};g.prototype.setAnchor=function(e){this.setProperty("anchor",e,true);if(this._gizmo){this._gizmo._updateAxis()}};g.prototype.pickAnchorFromNodesList=function(e){var t=null;var i=-1;var o=new m.Vector3;(Array.isArray(e)?e:[e]).forEach(function(e){var a=new m.Box3;e._expandBoundingBox(a,false,true,true);var r=a.getSize(new m.Vector3).manhattanLength();if(i<r){i=r;t=e;a.getCenter(o)}});if(t!==null){this.setAnchor(t.matrixWorld.clone().setPosition(o).elements)}return t};g.prototype.setMagnitude=function(e){e=Math.max(e,0);this.setProperty("magnitude",e,true);if(this._gizmo){this._gizmo._setMagnitude(e)}};g.prototype.setSelectedItem=function(e){this.setAssociation("selectedItem",e);if(this._gizmo){this._gizmo._handleSelectedItemChanged()}};g.prototype._onGroupsChanged=function(e){this._groupObserver.disconnect();this.getItems().forEach(function(e){this._groupObserver.observe(e,{aggregations:["items"]})}.bind(this));if(this._gizmo){this._gizmo._handleGroupsChanged(e)}};g.prototype._onGroupChanged=function(e){if(this._gizmo){this._gizmo._handleGroupsChanged(e)}};g.prototype.reset=function(){this.getItems().forEach(function(e){e.setMagnitudeAdjustmentMultiplier(0)});this.setMagnitude(0);this.setType(a.Linear);this.setAxis(undefined);this.setDirection(undefined)};g.prototype._activateView=function(e){var t=this._viewport.getScene();var i=t.getViewStateManager();var o=t.getViews()[e];i.activateView(o);var a=this._viewport._viewStateManager.getAnimationPlayer();if(a){setTimeout(function(){a.play()},100)}};g.prototype._createView=function(e,t,i,o,a,r,s){var n=this._viewport.getScene();var p=n.getViewStateManager();var l=n.createView({name:t});var d=[];if(e){var c=e.getNodeInfos();c.forEach(function(e){var t={target:e.target,transform:e.transform?e.transform.slice():null,meshId:e.meshId,materialId:e.materialId,visible:e.visible,opacity:e.opacity};d.push(t)})}else{var h=p.getNodeHierarchy();var m=function(e){if(e.visible){d.push({target:e,visible:e.visible})}h.enumerateChildren(e,m,false,true)};h.enumerateChildren(null,m,false,true)}l.setNodeInfos(d);var g={name:t,nodes:[]};if(e){g.sourceId=e.getViewId();g.exclude="PLAYBACK";var v=this._viewport.getCamera();var f={origin:v.getPosition(),target:v.getTargetDirection(),up:v.getUpDirection(),ortho:v instanceof u};if(f.ortho){f.zoom=v.getZoomFactor()}else{f.fov=v.getFov()/180*Math.PI}g.camera=f;var y=this._viewport._viewStateManager.getAnimationPlayer();if(y){g.time=y.getTime()}}d=[];o.forEach(function(e){var t=e.node;var i=a.get(t);g.nodes.push({sid:n.nodeRefToPersistentId(t),transform:i.localMatrix});d.push({target:t,transform:i.localMatrix})});l.updateNodeInfos(d);var x=n.findViewGroupByView(e);g.groupIds=x?[x.getViewGroupId()]:[r];if(s!==null){g.sequence=s}if(i){i.push(g)}return l};g.prototype.generateRequestData=function(e,t){var i=e?e.viewPrefix:null;var o=[];var r=1;var s=this._viewport.getScene();var u=this._viewport.getCurrentView();var d=new Map;var g=new Map;var v=[];var f=[];var y=[];var x=[];var _=null;var w=[];var E=null;var T=this.getType();if(t){if(Array.isArray(t.views)){var P=t.views.findIndex(function(e){return e.id===u.getViewId()});if(P>=0){_=t.views[P].sequence+1}w=t.views.slice(P+1)}E=t.id}var V=new Map;if(e&&e.animation&&e.animation.enabled){this.getItems().forEach(function(e){e.getItems().forEach(function(e){var t=e.getNodeRef();t.updateMatrixWorld();var i=(new m.Vector3).setFromMatrixPosition(t.matrixWorld);g.set(t.uuid,i);var o=new m.Matrix4;o.copy(t.parent.matrixWorld).invert().multiply(t.matrixWorld);var a=new m.Vector3;var r=new m.Quaternion;var s=new m.Vector3;o.decompose(a,r,s);V.set(t,{localMatrix:h.convertTo4x3(o.elements),position:a,worldPosition:i})})});this._gizmo._nodes.forEach(function(e){var t=e.node;t.matrix.elements[12]=e.local.x;t.matrix.elements[13]=e.local.y;t.matrix.elements[14]=e.local.z;t.position.setFromMatrixPosition(t.matrix);t.updateMatrixWorld(true);d.set(t,[e.local.x,e.local.y,e.local.z]);var i=(new m.Vector3).setFromMatrixPosition(t.matrixWorld);var o=new m.Matrix4;o.copy(t.parent.matrixWorld).invert().multiply(t.matrixWorld);var a=new m.Vector3;var r=new m.Quaternion;var s=new m.Vector3;o.decompose(a,r,s);var n=V.get(t);n.originalPosition=a;n.originalWorldPosition=i})}var A=new Set;var I=this._createView(u,i?i:c().getText("EXPLODETOOL_VIEW"),o,A,V,E,_);var k=o[o.length-1];if(e&&e.animation&&e.animation.enabled){if(!e.animation.separateAnimations){e.animation.separateViews=false}var O=e.animation.sequencePrefix;var b=1;var z=new Map;var M=null;var L=[];var C=[];var D="";this.getItems().forEach(function(t){y.push({name:t.getName()?t.getName():c().getText("EXPLODETOOL_GROUP_NODE",[b]),contentType:"REFERENCE",transform:[1,0,0,0,1,0,0,0,1,0,0,0]});k=o[o.length-1];if(e.animation.separateAnimations||e.animation.separateViews||b==1){if(L.length>0){f.push({name:D,endTime:r,joints:C,nodes:L});L=[];C=[]}if(e.animation.separateViews){D=c().getText("EXPLODETOOL_SEQUENCE_NAME",[k.name,1])}else{D=c().getText("EXPLODETOOL_SEQUENCE_NAME",[k.name,b])}D=O?c().getText("EXPLODETOOL_PREFIX_n",[O,b]):D;M=s.createSequence(I.getId()+"_seq"+b,{name:D,duration:r});var d=new n({sequence:M});I.addPlayback(d);I.resetPlaybacksStartTimes();if(!k.playbacks){k.playbacks=[]}k.playbacks.push({start:e.animation.separateViews?0:(b-1)*r,sequence:f.length})}var h=s.createTrack(null,{trackValueType:l.Vector3,isAbsoluteValue:false});this._gizmo._nodes.forEach(function(e){if(e.group==t){var i=e.node;var o=s.nodeRefToPersistentId(i);C.push(x.length);x.push({parent:b-1,childSid:o});var n=g.get(i.uuid);if(T===a.Radial||h.getKeysCount()==0){if(T===a.Radial&&h.getKeysCount()>0){h=s.createTrack(null,{trackValueType:l.Vector3,isAbsoluteValue:false})}var u=V.get(i);var d=[u.worldPosition.x-u.originalWorldPosition.x,u.worldPosition.y-u.originalWorldPosition.y,u.worldPosition.z-u.originalWorldPosition.z];h.insertKey(0,[0,0,0]);h.insertKey(r,d);v.push({time:[0,r],vector3:[0,0,0,d[0],d[1],d[2]]})}if(T===a.Radial){L.push({sid:o,rtranslate:{track:v.length-1}})}M.setNodeAnimation(i,p.Translate,h);z.set(i,[n.x,n.y,n.z]);A.add(e)}});if(T===a.Linear){L.push({node:b-1,rtranslate:{track:v.length-1}})}b++;if(e.animation.separateViews&&b<=this.getItems().length){I=this._createView(u,i?c().getText("EXPLODETOOL_PREFIX_n",[i,b]):c().getText("EXPLODETOOL_VIEW_n",[b]),o,A,V,E,_?++_:_)}}.bind(this));if(L.length>0){f.push({name:D,endTime:r,joints:C,nodes:L})}}else{var S=[];k.nodes=[];this.getItems().forEach(function(e){e.getItems().forEach(function(e){var t=e.getNodeRef();var i=t.matrix.elements.slice();S.push({target:t,transform:i});k.nodes.push({sid:s.nodeRefToPersistentId(t),transform:i})})});I.updateNodeInfos(S)}var G=function(){var e={data:{views:o}};w.forEach(function(t){e.data.views.push({id:t.id,sequence:++_})});if(f.length>0){e.data.tree={nodes:y};e.data.animation={sequences:f,tracks:v,joints:x}}return e};return G()};return g});
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/tools/ExplodeToolGizmo", ["../getResourceBundle","../thirdparty/three","../thirdparty/BufferGeometryUtils","./Gizmo","./AxisColours","./ExplodeAxis","./ExplodeDirection","./ExplodeType","../AnimationTrackType","sap/base/assert","sap/base/Log","sap/ui/core/Element"],function(t,e,i,o,r,s,a,n,h,u,d,l){"use strict";var c=o.extend("sap.ui.vk.tools.ExplodeToolGizmo",{metadata:{library:"sap.ui.vk"},renderer:null});var p=96;var _=48;var m={PositiveX:0,PositiveY:1,PositiveZ:2,NegativeX:3,NegativeY:4,NegativeZ:5,ResetAdjustment:6,AdjustUp:7,AdjustDown:8,MoveUp:9,MoveDown:10};c.prototype.init=function(){if(o.prototype.init){o.prototype.init.apply(this)}this._createEditingForm(t().getText("TOOL_UNITS_MM"),84);this._moveDelta=new e.Vector3;this._anchorPosition=new e.Vector3;this._axisDirection=new e.Vector3;this._axisColor=0;this._magnitude=0;this._viewport=null;this._tool=null;this._groups=[];this._nodes=[];this._groupsMap=new Map;this._sceneGizmo=new e.Scene;const s=new e.AmbientLight(16777215,.5*Math.PI);s.layers.enableAll();this._sceneGizmo.add(s);const a=new e.DirectionalLight(16777215,.5*Math.PI);a.position.set(1,3,2);a.layers.enableAll();this._sceneGizmo.add(a);this._gizmo=new e.Group;this._touchAreas=new e.Group;this._touchAreas2=new e.Group;this._sceneGizmo.add(this._gizmo);this._matViewProj=new e.Matrix4;var n=new e.MeshLambertMaterial({color:33023,transparent:true,opacity:.2});function h(t,o,r,s){var a=1,n=4,h=24;var u=new e.MeshLambertMaterial({color:r});var d=new e.CylinderGeometry(a,a,t-h,4);var l=new e.Vector3(o.y,o.z,o.x);var c=new e.Vector3(o.z,o.x,o.y);var p=o.x<0||o.y<0||o.z<0?(new e.Matrix4).makeBasis(c,o,l):(new e.Matrix4).makeBasis(l,o,c);p.setPosition(o.clone().multiplyScalar((t-h)*.5));d.applyMatrix4(p);var m=new e.Mesh(d,u);m.matrixAutoUpdate=false;m.userData.color=r;var g=new e.CylinderGeometry(0,n,h,12,1);p.setPosition(o.clone().multiplyScalar(t-h*.5));g.applyMatrix4(p);var f=new e.Mesh(g,u);f.matrixAutoUpdate=false;m.add(f);if(s){var v=new e.CylinderGeometry(_*.5,_*.5,t-_+h*.5,12,1);p.setPosition(o.clone().multiplyScalar(_+v.parameters.height*.5));v.applyMatrix4(p);var x=new e.CylinderGeometry(_*.5,0,_,12,1);p.setPosition(o.clone().multiplyScalar(_*.5));x.applyMatrix4(p);var y=i.mergeGeometries([v,x]);s.add(new e.Mesh(y,u))}return m}this._gizmo.add(h(p,new e.Vector3(1,0,0),r.x,this._touchAreas));this._gizmo.add(h(p,new e.Vector3(0,1,0),r.y,this._touchAreas));this._gizmo.add(h(p,new e.Vector3(0,0,1),r.z,this._touchAreas));this._gizmo.add(h(p,new e.Vector3(-1,0,0),r.x,this._touchAreas));this._gizmo.add(h(p,new e.Vector3(0,-1,0),r.y,this._touchAreas));this._gizmo.add(h(p,new e.Vector3(0,0,-1),r.z,this._touchAreas));this._axisTitles=this._createAxisTitles(undefined,undefined,false,true);this._sceneGizmo.add(this._axisTitles);var u=32;var d=u*1.75;this._groupGizmo=new e.Group;this._sceneGizmo.add(this._groupGizmo);var l=new e.Mesh(new e.IcosahedronGeometry(8,1),new e.MeshLambertMaterial);this._groupGizmo.add(l);this._groupGizmo.add(h(u*1.5,new e.Vector3(0,1,0),16777215));this._groupGizmo.add(h(u*1.5,new e.Vector3(0,-1,0),16777215));var c=16;var m=i.mergeGeometries([new e.CylinderGeometry(0,6,c,16).applyMatrix4((new e.Matrix4).setPosition(0,d+c*.5,0)),new e.CylinderGeometry(0,6,c,16).applyMatrix4((new e.Matrix4).setPosition(0,d+c*1.5,0))]);this._groupGizmo.add(new e.Mesh(m,new e.MeshLambertMaterial));this._groupGizmo.add(new e.Mesh(m.clone().rotateX(Math.PI),new e.MeshLambertMaterial));this._groupGizmo.add(new e.Mesh(new e.CylinderGeometry(16,16,u*6,12,1),new e.MeshBasicMaterial({color:16777215,transparent:true,opacity:.5,side:e.BackSide})));function g(t,i,o){var r=new e.IcosahedronGeometry(_*.5,1);r.applyMatrix4((new e.Matrix4).setPosition(0,(t+i)*.5,0));o.add(new e.Mesh(r,n))}g(u*-.5,u*.5,this._touchAreas2);g(u*.5,u*1.5,this._touchAreas2);g(u*-1.5,u*-.5,this._touchAreas2);g(d,d+u,this._touchAreas2);g(-d-u,-d,this._touchAreas2);function f(t){t.traverse(function(t){t.layers.enableAll()})}function v(t){t.children.forEach(function(t,e){t.traverse(function(t){t.layers.enable(Math.min(e,6)+1)})})}v(this._gizmo);v(this._axisTitles);v(this._touchAreas);f(this._groupGizmo);f(this._touchAreas2)};c.prototype.hasDomElement=function(){return false};c.prototype.show=function(t,e){this._viewport=t;this._tool=e;this._nodes.length=0;this._handleGroupsChanged()};c.prototype.hide=function(){this._cleanTempData();this._viewport=null;this._tool=null;this._updateEditingForm(false)};c.prototype.getGizmoCount=function(){if(!this._groups.length){return 0}return this._getActiveAxisIndex()>=0&&this._magnitude>0&&this._getSelectedItem()?2:1};c.prototype.getTouchObject=function(t){if(t===0){this._updateGizmoObjectTransformation(this._touchAreas);return this._touchAreas}else{this._updateGroupGizmoTransformation(this._touchAreas2);return this._touchAreas2}};c.prototype._handleGroupsChanged=function(t){this._setMagnitude(0);var i=this._groupsMap;i.clear();this._groups=this._tool.getItems().slice();var o=this._nodes=[];this._groups.forEach(function(t){var r=t.getItems();for(var s=0;s<r.length;s++){var a=r[s].getNodeRef();i.set(a,t);var n=new e.Box3;a._expandBoundingBox(n,false,true,true);o.push({node:a,center:n.getCenter(new e.Vector3),group:t,local:(new e.Vector3).setFromMatrixPosition(a.matrix),origin:(new e.Vector3).setFromMatrixPosition(a.matrixWorld),matParentInv:a.parent?(new e.Matrix4).copy(a.parent.matrixWorld).invert():new e.Matrix4})}});this._calculateGroupOffsets();this._setMagnitude(this._tool.getMagnitude())};c.prototype._getSelectedItem=function(){return l.getElementById(this._tool.getSelectedItem())};c.prototype._handleSelectedItemChanged=function(){var t=this._viewport._viewStateManager;var e=new Set;var i=this._getSelectedItem();if(i){i.getItems().forEach(function(t){e.add(t.getNodeRef())})}var o=[];t.enumerateOutlinedNodes(function(t){if(!e.has(t)){o.push(t)}});t.setOutliningStates(Array.from(e),o,false)};c.prototype.highlightHandle=function(t,e){this._handleIndex=t;this._gizmo.children.forEach(function(e,i){var o=t===i;var r=o?16776960:e.userData.color;e.material.color.setHex(r);this._axisTitles.children[i].material.color.setHex(r)}.bind(this));for(var i=0;i<5;i++){this._groupGizmo.children[i].material.color.setHex(i+6===t?16776960:this._axisColor)}};c.prototype._calculateGroupOffsets=function(){var t=this._axisDirection;if(this._tool.getType()===n.Linear){var i=new e.Vector3(Math.abs(t.x),Math.abs(t.y),Math.abs(t.z));var o=new e.Vector3;var r=0,s=0;this._groups.forEach(function(t,e){var a=t.getBoundingBox();a.getCenter(t._center);a.getSize(o);r=i.dot(o);if(e>0){s+=r*.5}t._offset=s;t._deltaOffset=r*.5;s+=r*.5});s+=r*.5;var a=s>0?1/s:1;this._groups.forEach(function(t){t._offset=1-t._offset*a;t._deltaOffset*=a})}else{var h=1/this._groups.length;this._groups.forEach(function(t,i){var o=t.getBoundingBox();o.getCenter(t._center);t._offset=1-i*h;t._deltaOffset=h*.5;var r=-1;var s=new e.Vector3;var a=t.getItems();for(var n=0;n<a.length;n++){var u=a[n].getNodeRef();var d=new e.Box3;u._expandBoundingBox(d,false,true,true);var l=d.getSize(new e.Vector3).manhattanLength();if(r<l){r=l;d.getCenter(s)}}})}};c.prototype._getActiveAxisIndex=function(){var t=this._tool.getAxis();var e=this._tool.getDirection();var i=t&&e?[s.X,s.Y,s.Z].indexOf(t):-1;if(i>=0&&e===a.Negative){i+=3}return i};c.prototype._recalculateOffsets=function(){this._setMagnitude(0);this._calculateGroupOffsets();this._setMagnitude(this._tool.getMagnitude());this._viewport.setShouldRenderFrame()};c.prototype._updateAxis=function(){var t=this._getActiveAxisIndex();if(t>=0){this._updateGizmoObjectTransformation(this._gizmo);this._axisDirection.setFromMatrixColumn(this._gizmo.matrixWorld,t%3).normalize().multiplyScalar(t<3?1:-1);this._anchorPosition.setFromMatrixPosition(this._gizmo.matrixWorld);this._axisColor=this._gizmo.children[t].userData.color;for(var e=0;e<5;e++){this._groupGizmo.children[e].material.color.setHex(this._axisColor)}this._recalculateOffsets()}else{this._setMagnitude(0);this._viewport.setShouldRenderFrame()}};c.prototype._moveSelectedGroup=function(t){var e=this._tool;var i=this._getSelectedItem();var o=e.getItems();var r=o.indexOf(i);if(r>=0&&r+t>=0&&r+t<o.length){e.removeItem(i);e.insertItem(i,r+t);e.fireItemSequenceChangePressed({item:i,moveUp:t<0})}};c.prototype._setMagnitudeAdjustmentMultiplier=function(t,e){var i=this._getSelectedItem();if(i){i.setMagnitudeAdjustmentMultiplier(t);this._updatePositions();this._tool[e?"fireItemPositionAdjusted":"fireItemPositionAdjusting"]({item:i,magnitudeAdjustmentMultiplier:i.getMagnitudeAdjustmentMultiplier()})}};c.prototype._beginGesture=function(){this._moveDelta.setScalar(0);this._beginMagnitude=this._magnitude;var t=this._tool;switch(this._handleIndex){case m.ResetAdjustment:this._setMagnitudeAdjustmentMultiplier(0,true);break;case m.AdjustUp:case m.AdjustDown:var e=this._getSelectedItem();this._magnitudeAdjustmentMultiplier=e?e.getMagnitudeAdjustmentMultiplier():0;break;case m.MoveUp:this._moveSelectedGroup(-1);break;case m.MoveDown:this._moveSelectedGroup(+1);break;default:if(this._handleIndex<6&&(!t.getAxis()||!t.getDirection())){t.setAxis([s.X,s.Y,s.Z][this._handleIndex%3]);t.setDirection(this._handleIndex<3?a.Positive:a.Negative);t.fireAxisSelected({axis:t.getAxis(),direction:t.getDirection()})}break}};c.prototype._setMagnitude=function(t){this._magnitude=t;this._groups.forEach(function(e){e._magnitude=t});this._updatePositions()};c.prototype._setOffset=function(t){var e=this._tool;if(this._handleIndex<6){e.setMagnitude(this._beginMagnitude+t);e.fireMagnitudeChanging({type:e.getType(),axis:e.getAxis(),direction:e.getDirection(),magnitude:e.getMagnitude()})}else if(this._handleIndex===m.AdjustUp||this._handleIndex===m.AdjustDown){var i=this._magnitude>0?this._getSelectedItem():null;if(i){this._setMagnitudeAdjustmentMultiplier(this._magnitudeAdjustmentMultiplier+t/(this._magnitude*i._deltaOffset))}}};c.prototype._updatePositions=function(){var t=this._tool.getType()===n.Linear;var i=new e.Vector3;var o=new e.Vector3;var r=new e.Vector3;this._nodes.forEach(function(e){var s=e.node;if(t){o.copy(this._axisDirection)}else{o.copy(e.center).sub(this._anchorPosition);r.copy(this._axisDirection).multiplyScalar(o.dot(r));o.sub(r).normalize()}o.multiplyScalar(e.group.getMagnitude());i.copy(e.origin).add(o);s.matrixWorld.setPosition(i);s.matrix.multiplyMatrices(e.matParentInv,s.matrixWorld);s.position.setFromMatrixPosition(s.matrix);s.updateMatrixWorld(true);if(s.parent!==this._getEffectiveParent(s)){this._viewport._viewStateManager._setJointNodeOffsets(s,h.Translate)}}.bind(this));this._viewport.setShouldRenderFrame()};c.prototype._endGesture=function(){var t=this._tool;if(this._handleIndex<6){t.fireMagnitudeChanged({type:t.getType(),axis:t.getAxis(),direction:t.getDirection(),magnitude:t.getMagnitude()})}else if(this._handleIndex===m.AdjustUp||this._handleIndex===m.AdjustDown){var e=this._magnitude>0?this._getSelectedItem():null;if(e){t.fireItemPositionAdjusted({item:e,magnitudeAdjustmentMultiplier:e.getMagnitudeAdjustmentMultiplier()})}}};c.prototype.expandBoundingBox=function(t){if(this._viewport){this._expandBoundingBox(t,this._viewport.getCamera().getCameraRef(),true)}};c.prototype._updateGizmoObjectTransformation=function(t){t.matrix.fromArray(this._tool.getAnchor());t.matrix.decompose(t.position,t.quaternion,t.scale);var e=this._getGizmoScale(t.position);t.scale.setScalar(e);t.matrixAutoUpdate=true;t.updateMatrixWorld(true);return e};c.prototype._updateGroupGizmoTransformation=function(t){var i=this._getActiveAxisIndex();var o=i>=0&&this._magnitude>0?this._getSelectedItem():null;t.visible=!!o;if(o){if(this._tool.getType()===n.Linear){t.position.copy(this._axisDirection).multiplyScalar(o.getMagnitude()).add(o._center)}else{t.position.copy(o._center)}t.quaternion.setFromUnitVectors(new e.Vector3(0,1,0),this._axisDirection);t.scale.setScalar(this._getGizmoScale(t.position));t.updateMatrix();t.updateMatrixWorld()}};c.prototype._updateGizmoTransformation=function(t,e){this._updateGizmoObjectTransformation(this._gizmo)};c.prototype._getCameraLayersMask=function(){var t=0|0;var e=this._getActiveAxisIndex();t=1<<e+1;if(e>=0&&this._magnitude>0&&this._getSelectedItem()){t|=1<<7}return t};c.prototype.render=function(){u(this._viewport&&this._viewport.getMetadata().getName()==="sap.ui.vk.threejs.Viewport","Can't render gizmo without sap.ui.vk.threejs.Viewport");if(this._tool&&this._groups.length>0){var t=this._viewport.getRenderer(),e=this._viewport.getCamera().getCameraRef();this._matViewProj.multiplyMatrices(e.projectionMatrix,e.matrixWorldInverse);t.clearDepth();var i=this._updateGizmoObjectTransformation(this._gizmo);this._updateAxisTitles(this._axisTitles,this._gizmo,e,p+18,i);this._updateGroupGizmoTransformation(this._groupGizmo);var o=e.layers.mask;e.layers.mask=this._getCameraLayersMask();t.render(this._sceneGizmo,e);e.layers.mask=o}};return c});
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/tools/ExplodeToolHandler", ["sap/ui/base/EventProvider","./ExplodeToolGizmo","../thirdparty/three"],function(t,e,i){"use strict";var s=t.extend("sap.ui.vk.tools.ExplodeToolHandler",{metadata:{library:"sap.ui.vk"},constructor:function(t){this._priority=13;this._tool=t;this._gizmo=t.getGizmo();this._rect=null;this._rayCaster=new i.Raycaster;this._handleIndex=-1;this._handleAxis=new i.Vector3;this._gizmoOrigin=new i.Vector3;this._mouse=new i.Vector2}});s.prototype._updateMouse=function(t){var e=this.getViewport().getRenderer().getSize(new i.Vector2);this._mouse.x=(t.x-this._rect.x)/e.width*2-1;this._mouse.y=(t.y-this._rect.y)/e.height*-2+1;this._rayCaster.setFromCamera(this._mouse,this.getViewport().getCamera().getCameraRef());this._rayCaster.far=Infinity};s.prototype._updateHandles=function(t,e){var i=this._handleIndex;this._handleIndex=-1;if(t.n===1||t.event&&t.event.type==="contextmenu"){this._rayCaster.layers.mask=this._gizmo._getCameraLayersMask();for(var s=0,r=this._gizmo.getGizmoCount();s<r;s++){var n=this._gizmo.getTouchObject(s);var o=this._rayCaster.intersectObject(n,true);if(o.length>0){this._handleIndex=n.children.indexOf(o[0].object);if(this._handleIndex>=0){this._rayCaster.far=o[0].distance;this._gizmoOrigin.setFromMatrixPosition(n.matrixWorld);if(s===0){this._handleAxis.setFromMatrixColumn(n.matrixWorld,this._handleIndex%3).normalize().multiplyScalar(this._handleIndex<3?1:-1)}else{this._handleAxis.copy(this._gizmo._axisDirection);this._handleIndex+=6}}}}}this._gizmo.highlightHandle(this._handleIndex,e||this._handleIndex===-1);if(i!==this._handleIndex){this.getViewport().setShouldRenderFrame()}};s.prototype.hover=function(t){if(this._inside(t)&&!this._gesture){this._updateMouse(t);this._updateHandles(t,true);t.handled|=this._handleIndex>=0}};s.prototype.click=function(t){if(this._inside(t)&&!this._gesture){if(this._handleIndex<0){var e=this.getViewport().hitTest(t.x-this._rect.x,t.y-this._rect.y);if(!e){this._tool.setSelectedItem(null);return}var i=e.object;var s=this._tool.getGizmo()._groupsMap;var r=null;while(i){r=s.get(i);if(r){this._tool.setSelectedItem(r);t.handled=true;break}i=i.parent}}else{t.handled=this._handleIndex>=0}}};var r=new i.Vector3;s.prototype._getAxisOffset=function(){var t=this._rayCaster.ray;var e=this._handleAxis.clone().cross(t.direction).cross(t.direction).normalize();r.copy(t.origin).sub(this._gizmoOrigin);return e.dot(r)/e.dot(this._handleAxis)};s.prototype._getPlaneOffset=function(){var t=this._rayCaster.ray;r.copy(this._gizmoOrigin).sub(t.origin);var e=this._handleAxis.dot(r)/this._handleAxis.dot(t.direction);return t.direction.clone().multiplyScalar(e).sub(r)};s.prototype.beginGesture=function(t){if(this._inside(t)&&!this._gesture){this._updateMouse(t);this._updateHandles(t,false);if(this._handleIndex>=0){this._gesture=true;t.handled=true;this._gizmo._beginGesture(this._handleIndex);this._dragOrigin=this._getAxisOffset()}}};s.prototype.move=function(t){if(this._gesture){t.handled=true;this._updateMouse(t);var e=this._getAxisOffset()-this._dragOrigin;if(isFinite(e)){this._gizmo._setOffset(e)}}};s.prototype.endGesture=function(t){if(this._gesture){this._gesture=false;t.handled=true;this._updateMouse(t);this._gizmo._endGesture();this._dragOrigin=undefined;this._updateHandles(t,true);this.getViewport().setShouldRenderFrame()}};s.prototype.contextMenu=function(t){};s.prototype.getViewport=function(){return this._tool._viewport};s.prototype._getOffset=function(t){var e=t.getBoundingClientRect();var i={x:e.left+window.pageXOffset,y:e.top+window.pageYOffset};return i};s.prototype._inside=function(t){var e=this._tool._viewport.getIdForLabel();var i=document.getElementById(e);if(i===null){return false}var s=this._getOffset(i);this._rect={x:s.x,y:s.y,w:i.offsetWidth,h:i.offsetHeight};return t.x>=this._rect.x&&t.x<=this._rect.x+this._rect.w&&t.y>=this._rect.y&&t.y<=this._rect.y+this._rect.h};return s});
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/tools/ExplodeType", ["sap/ui/base/DataType"],function(a){"use strict";var e={Linear:"Linear",Radial:"Radial"};a.registerEnum("sap.ui.vk.tools.ExplodeType",e);return e},true);
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/tools/Gizmo", ["../library","sap/m/library","sap/m/Input","sap/m/Label","sap/m/HBox","sap/ui/core/library","sap/ui/core/Control","./CoordinateSystem","./AxisColours","./ToolNodeSet","../thirdparty/three","../thirdparty/three-mesh-bvh","./GizmoPlacementMode","../AnimationTrackType"],function(t,e,i,o,n,r,a,s,l,c,h,u,p,d){"use strict";var f=e.InputType;var _=a.extend("sap.ui.vk.tools.Gizmo",{metadata:{library:"sap.ui.vk"},renderer:null});_.prototype.hasDomElement=function(){return true};_.prototype._drawText=function(t,e,i,o){var n=window.devicePixelRatio;var r=t.width;var a=t.height;var s=r*.5;var l=a*.5;var c=t.getContext("2d");c.clearRect(0,0,r,a);c.font="Bold "+i*n+"px Arial";c.textAlign="center";c.textBaseline="middle";c.fillStyle="#000";c.globalAlpha=.5;c.filter="blur(3px)";c.fillText(e,s+1,l+1);c.fillStyle="#fff";c.globalAlpha=1;c.filter="blur(0px)";c.fillText(e,s,l);if(o){c.beginPath();c.arc(s,l,s-n,0,2*Math.PI,false);c.closePath();c.lineWidth=n*2;c.strokeStyle="#fff";c.stroke()}};_.prototype._createTextMesh=function(t,e,i,o,n,r){var a=window.devicePixelRatio;var s=document.createElement("canvas");s.width=e*a;s.height=i*a;this._drawText(s,t,o,r);var l=new h.Texture(s);l.needsUpdate=true;var c=new h.MeshBasicMaterial({map:l,color:n,transparent:true,alphaTest:.05,premultipliedAlpha:true,side:h.DoubleSide});var u=new h.Mesh(new h.PlaneGeometry(e,i),c);u.userData.color=n;return u};_.prototype._createAxisTitles=function(t,e,i,o){t=t||32;e=e||20;var n=new h.Group;n.add(this._createTextMesh("X",t,t,e,l.x,i));n.add(this._createTextMesh("Y",t,t,e,l.y,i));n.add(this._createTextMesh("Z",t,t,e,l.z,i));if(o){n.add(this._createTextMesh("-X",t,t,e,l.x,i));n.add(this._createTextMesh("-Y",t,t,e,l.y,i));n.add(this._createTextMesh("-Z",t,t,e,l.z,i))}return n};_.prototype._extractBasis=function(t){var e=[new h.Vector3,new h.Vector3,new h.Vector3];t.extractBasis(e[0],e[1],e[2]);e[0].normalize();e[1].normalize();e[2].normalize();return e};_.prototype._updateAxisTitles=function(t,e,i,o,n){var r=this._extractBasis(e.matrixWorld);t.children.forEach(function(t,e){var n=o.constructor===h.Vector3?o.getComponent(e%3):o;t.position.copy(r[e%3]).multiplyScalar(n*(e<3?1:-1));t.quaternion.copy(i.quaternion)});t.position.copy(e.position);t.scale.setScalar(n)};_.prototype._updateSelection=function(t){if(t==null){return false}var e=[];if(this._tool){if(this._tool.getNodeSet()===c.Highlight){t.enumerateSelection(function(t){e.push({node:t})})}else{t.enumerateOutlinedNodes(function(t){e.push({node:t})})}}if(this._nodes.length===e.length&&this._nodes.every(function(t,i){return e[i].node===t.node})){return false}this._cleanTempData();this._nodes=e;e.forEach(function(t){t.ignore=false;var i=t.node.parent;while(i&&!t.ignore){for(var o=0,n=e.length;o<n;o++){if(e[o].node===i){t.ignore=true;break}}i=i.parent}this._getOffsetForRestTransformation(t.node)},this);return true};function m(t,e,i,o,n){const r=i.attributes.position;let a=e.length/3;const s=o?.firstVertex??0;const l=o?o.lastVertex-s:r.count;const c=o?.start??0;const u=o?.count??i.index?.count??l;if(i.index!=null){a-=s;const e=i.index.array;const o=new h.Vector3,n=new h.Vector3,l=new h.Vector3;for(let i=c,s=c+u;i<s;i+=3){const s=e[i],c=e[i+1],h=e[i+2];o.set(r.getX(s),r.getY(s),r.getZ(s));n.set(r.getX(c),r.getY(c),r.getZ(c)).sub(o);l.set(r.getX(h),r.getY(h),r.getZ(h)).sub(o);if(n.cross(l).lengthSq()>1e-4){t.push(s+a);t.push(c+a);t.push(h+a)}}}else{for(let e=0;e<u;e++){t.push(e+a)}}const p=new h.Vector3;for(let t=s,i=s+l;t<i;t++){p.set(r.getX(t),r.getY(t),r.getZ(t));if(n!=null){p.applyMatrix4(n)}e.push(p.x);e.push(p.y);e.push(p.z)}}_.prototype._createBVHGeometry=function(t,e){const i=new h.BufferGeometry;i.setIndex(e);i.setAttribute("position",new h.Float32BufferAttribute(t,3));i.boundsTree=new u.MeshBVH(i);return i};_.prototype._computeBoundsTree=function(){if(this._nodes.length===0){this._disposeBoundsTree();return}const t=new Set(this._nodes.map(t=>t.node));const e=this._viewport?._getViewStateManagerThreeJS();e?.getJoints()?.forEach(e=>{if(t.has(e.parent)){t.add(e.node)}});this._selectedMeshes=[];const i=[];const o=[];const n=(r,a)=>{if(!(e?.getVisibilityState(r)??r.visible)||r._vkUpdate||r.userData.renderStage>0||r.userData.renderStage<0){return}a||=t.has(r);if(r.geometry instanceof h.BufferGeometry&&!r.geometry.userData.isPointCloud){const t=r.userData;if(a){if(!t.bvhGeometry){const e=[];const i=[];m(e,i,r.geometry,t.renderGroup,null);t.bvhGeometry=this._createBVHGeometry(i,e)}this._selectedMeshes.push(r)}else{m(i,o,r.geometry,t.renderGroup,r.matrixWorld)}}r.children.forEach(t=>n(t,a))};n(this._viewport._getNativeScene(),false);this._staticGeometry=this._createBVHGeometry(o,i)};_.prototype._disposeBoundsTree=function(){this._selectedMeshes=[];this._staticGeometry=null};_.prototype._checkSceneSelectionIntersection=function(){this._viewport?._getViewStateManagerThreeJS()?._setJointNodeMatrix();return this._selectedMeshes.some(t=>this._staticGeometry.boundsTree.intersectsGeometry(t.userData.bvhGeometry,t.matrixWorld))};_.prototype.setPlacementMode=function(t){this._placementMode=t};_.prototype._getAnchorPoint=function(){return this._viewport?this._viewport._anchorPoint:null};_.prototype._getGizmoScale=function(t){var e=this._viewport.getRenderer();var i=this._viewport.getCamera().getCameraRef();var o=new h.Vector4;o.copy(t).applyMatrix4(this._matViewProj);return o.w*2/(e.getSize(new h.Vector2).x*i.projectionMatrix.elements[0])};_.prototype._getEffectiveParent=function(t){if(this._viewport._viewStateManager){var e=this._viewport._viewStateManager.getJoints();if(e){for(var i=0;i<e.length;i++){var o=e[i];if(!o.node||!o.parent){continue}if(o.node===t){return o.parent}}}}return t.parent};_.prototype._cleanTempData=function(){this._nodes.forEach(function(t){delete t.node.userData.skipUpdateJointNode});this._nodeUserDataMap?.clear();this._sequence=null};_.prototype._prepareForCreatingKey=function(t){this._playback=t};_.prototype._getOffsetForRestTransformation=function(t){if(this._viewport._viewStateManager){if(!this._nodeUserDataMap){this._nodeUserDataMap=new Map}var e=this._nodeUserDataMap.get(t);if(!e){e={};this._nodeUserDataMap.set(t,e)}var i=this._viewport._viewStateManager.getTransformation(t);var o=this._viewport._viewStateManager.getRestTransformation(t);if(!o){return}var n=new h.Vector3(o.translation[0],o.translation[1],o.translation[2]);var r=new h.Vector3(o.scale[0],o.scale[1],o.scale[2]);e.quatRest=new h.Quaternion(o.quaternion[0],o.quaternion[1],o.quaternion[2],o.quaternion[3]);e.matRest=(new h.Matrix4).compose(n,e.quatRest,r);e.matRestInv=(new h.Matrix4).copy(e.matRest).invert();e.initialTranslation=i.translation.slice();e.initialScale=i.scale.slice();e.initialQuaternion=new h.Quaternion(i.quaternion[0],i.quaternion[1],i.quaternion[2],i.quaternion[3]);e.matInitial=t.matrix.clone();e.matInitialInv=(new h.Matrix4).copy(t.matrix).invert();e.quatInitialDiff=e.initialQuaternion.clone().multiply(e.quatRest.clone().invert());e.quatInitialDiffInv=e.quatInitialDiff.clone().invert();e.matInitialDiff=t.matrix.clone().multiply(e.matRestInv);var a=[0,0,0];var s=this._viewport._viewStateManager.getAnimationPlayer();if(s){var l=s.getAnimatedProperty(t,d.Rotate);if(l.offsetToPrevious){a=l.offsetToPrevious}}e.euler=new h.Euler(0,0,0);e.startEuler=new h.Euler(0,0,0);e.eulerInParentCoors=new h.Euler(a[0],a[1],a[2]);e.startEulerInParentCoors=new h.Euler(a[0],a[1],a[2])}};_.prototype._updateGizmoObjectTransformation=function(t,e){const i=this._getAnchorPoint();t.position.setScalar(0);switch(this._placementMode){default:case p.Default:if(this._nodes.length>0){if(this._coordinateSystem===s.Local||this._coordinateSystem===s.Parent){t.position.setFromMatrixPosition(this._nodes[e].node.matrixWorld)}else{const e=new h.Vector3;this._nodes.forEach(function(i){e.setFromMatrixPosition(i.node.matrixWorld);t.position.add(e)});t.position.multiplyScalar(1/this._nodes.length)}}break;case p.ObjectCenter:const o=new h.Box3;if(this._coordinateSystem===s.Local||this._coordinateSystem===s.Parent){this._nodes[e].node._expandBoundingBox(o,true,true,true)}else{this._nodes.forEach(function(t){t.node._expandBoundingBox(o,true,true,true)})}o.getCenter(t.position);break;case p.Custom:if(i){t.position.copy(i.position)}break}const o=this._getGizmoScale(t.position);t.scale.setScalar(this._gizmoSize*o);t.matrixAutoUpdate=true;t.quaternion.set(0,0,0,1);switch(this._coordinateSystem){case s.Local:case s.Parent:if(e>=0&&e<this._nodes.length){const i=this._nodes[e].node;const o=this._coordinateSystem===s.Parent?this._getEffectiveParent(i)?.matrixWorld:null;const n=this._extractBasis(o??i.matrixWorld);t.matrix.makeBasis(n[0],n[1],n[2]);t.quaternion.setFromRotationMatrix(t.matrix);t.matrix.scale(t.scale);t.matrix.setPosition(t.position);t.matrixAutoUpdate=false}break;case s.Screen:const o=this._viewport.getCamera().getCameraRef();t.quaternion.copy(o.quaternion);break;case s.Custom:if(i){t.quaternion.copy(i.quaternion)}break;default:break}t.updateMatrixWorld(true);return o};_.prototype._expandBoundingBox=function(t,e,i){var o=this.getGizmoCount();if(o>0){this._matViewProj.multiplyMatrices(e.projectionMatrix,e.matrixWorldInverse);for(var n=0;n<o;n++){this._updateGizmoTransformation(n,e);this._sceneGizmo._expandBoundingBox(t,i,false)}}};_.prototype._createEditingForm=function(t,e){this._label=new o({}).addStyleClass("sapUiVkTransformationToolEditLabel");this._units=new o({text:t}).addStyleClass("sapUiVkTransformationToolEditUnits");this._input=new i({width:e+"px",type:f.Number,maxLength:10,textAlign:r.TextAlign.Right,change:t=>{this.setValue(t.getParameter("value"))}});this._editingForm=new n({items:[this._label,this._input,this._units]}).addStyleClass("sapUiSizeCompact");this._editingForm.onkeydown=this._editingForm.ontap=this._editingForm.ontouchstart=function(t){t.setMarked()}};_.prototype._getValueLocaleOptions=function(){return{useGrouping:false}};_.prototype._updateEditingForm=function(t,e,i){var o=this.getDomRef();if(o){if(t&&this._tool&&this._tool.getShowEditingUI()){this._label.setText(i||["X","Y","Z"][e]);this._label.rerender();var n=this._label.getDomRef();if(n){n.style.color=new h.Color(l[["x","y","z"][e]]).getStyle()}this._input.setValue(this.getValue().toLocaleString("fullwide",this._getValueLocaleOptions()));var r=this._getEditingFormPosition();var a=this._gizmo.position.clone().applyMatrix4(this._matViewProj).sub(r);var s=this._viewport.getDomRef().getBoundingClientRect();var c=o.getBoundingClientRect();var u=a.x>-1e-4;var p=u?c.width:-c.width;var d=c.height*.5;var f=h.MathUtils.clamp(s.width*(r.x*.5+.5)+(u?-20:20),Math.max(p,0),s.width+Math.min(p,0));var _=h.MathUtils.clamp(s.height*(r.y*-.5+.5),d,s.height-d);o.style.left=Math.round(f)+"px";o.style.top=Math.round(_)+"px";o.style.transform="translate("+(u?"-100%":"0%")+", -50%)";o.style.display="block"}else{o.style.display="none"}}};_.prototype._attachVisibilityChanged=function(){this._viewport?._getViewStateManagerThreeJS()?.attachVisibilityChanged(this._onVisibilityChanged,this)};_.prototype._detachVisibilityChanged=function(){this._viewport?._getViewStateManagerThreeJS()?.detachVisibilityChanged(this._onVisibilityChanged,this)};return _});
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/tools/GizmoPlacementMode", ["sap/ui/base/DataType"],function(e){"use strict";var t={Default:"Default",ObjectCenter:"ObjectCenter",Custom:"Custom"};e.registerEnum("sap.ui.vk.tools.GizmoPlacementMode",t);return t},true);
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/tools/HighlightMeasurementTool", ["./HighlightMeasurementToolHandler","./Tool"],function(e,t){"use strict";var i=t.extend("sap.ui.vk.tools.HighlightMeasurementTool",{metadata:{library:"sap.ui.vk"}});var s=i.getMetadata().getParent().getClass().prototype;i.prototype.init=function(){if(s.init){s.init.call(this)}this._viewport=null;this._handler=new e(this);this._highlightedMeasurementDomRef=null;this.setFootprint(["sap.ui.vk.threejs.Viewport","sap.ui.vk.svg.Viewport"])};i.prototype.setActive=function(e,t,i){s.setActive.call(this,e,t,i);if(this._viewport){if(e){this._selection=[];this._addLocoHandler();this._viewport.addStyleClass("sapUiVizKitHighlightDistanceCursor")}else{this._viewport.removeStyleClass("sapUiVizKitHighlightDistanceCursor");this.clearSelection();this.highlightMeasurement(null,this._viewport.getMeasurementSurface());this._removeLocoHandler()}}return this};i.prototype.highlightMeasurement=function(e){var t=this._highlightedMeasurementDomRef;if(e===t){return null}if(t!=null&&this._selection.indexOf(t)<0){this._viewport.getMeasurementSurface().highlightMeasurement(t._measurement,false)}if(e!=null&&this._selection.indexOf(e)<0){this._viewport.getMeasurementSurface().highlightMeasurement(e._measurement,true,this._viewport,this._viewport.getCamera())}this._highlightedMeasurementDomRef=e;return this};i.prototype.selectMeasurement=function(e){var t=this._selection.indexOf(e);if(t<0){this._selection.push(e);if(e!==this._highlightedMeasurementDomRef){this._viewport.getMeasurementSurface().highlightMeasurement(e._measurement,true,this._viewport,this._viewport.getCamera())}}else{this._selection.splice(t,1);if(e!==this._highlightedMeasurementDomRef){this._viewport.getMeasurementSurface().highlightMeasurement(e._measurement,false)}}return this};i.prototype.clearSelection=function(){this._selection.forEach(function(e){if(e!==this._highlightedMeasurementDomRef){this._viewport.getMeasurementSurface().highlightMeasurement(e._measurement,false)}},this);this._selection.length=0};return i});
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/tools/HighlightMeasurementToolHandler", ["sap/ui/base/EventProvider"],function(t){"use strict";var e=t.extend("sap.ui.vk.tools.HighlightMeasurementToolHandler",{metadata:{library:"sap.ui.vk"},constructor:function(t){this._priority=0;this._tool=t;this._rect=null}});e.prototype.destroy=function(){this._tool=null;this._rect=null};e.prototype.hover=function(t){var e=this._tool;var r=e._viewport;var i=r.getMeasurementSurface();if(this._inside(t)&&r.getScene()){var o=t.x-this._rect.x;var n=t.y-this._rect.y;e.highlightMeasurement(i.hitTest(o,n),i)}else{e.highlightMeasurement(null,i)}};e.prototype.beginGesture=function(t){};e.prototype.move=function(t){};e.prototype.endGesture=function(t){};e.prototype.click=function(t){var e=this._tool;var r=e._viewport;if(this._inside(t)&&r.getScene()){var i=t.x-this._rect.x;var o=t.y-this._rect.y;var n=r.getMeasurementSurface().hitTest(i,o);if(n){t.handled=true;e.selectMeasurement(n)}else{e.clearSelection()}}};e.prototype.doubleClick=function(t){};e.prototype.contextMenu=function(t){};e.prototype._getOffset=function(t){var e=t.getBoundingClientRect();var r={x:e.left+window.pageXOffset,y:e.top+window.pageYOffset};return r};e.prototype._inside=function(t){var e=this._tool._viewport.getIdForLabel();var r=document.getElementById(e);if(r==null){return false}var i=this._getOffset(r);var o=this._rect={x:i.x,y:i.y,w:r.offsetWidth,h:r.offsetHeight};return t.x>=o.x&&t.x<=o.x+o.w&&t.y>=o.y&&t.y<=o.y+o.h};return e});
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/tools/HitTestClickType", ["sap/ui/base/DataType"],function(e){"use strict";var t={Single:"Single",Double:"Double",Context:"Context"};e.registerEnum("sap.ui.vk.tools.HitTestClickType",t);return t},true);
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/tools/HitTestIdMode", ["sap/ui/base/DataType"],function(e){"use strict";var a={ThreeJS:"ThreeJS",VEsID:"VEsID",Callback:"Callback"};e.registerEnum("sap.ui.vk.tools.HitTestIdMode",a);return a},true);
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/tools/HitTestTool", ["./Tool","./HitTestToolHandler","./HitTestIdMode","../thirdparty/three"],function(e,t,i,r){"use strict";var s=e.extend("sap.ui.vk.tools.HitTestTool",{metadata:{library:"sap.ui.vk",properties:{IdMode:{type:"sap.ui.vk.tools.HitTestIdMode",defaultValue:i.ThreeJS}},events:{hit:{parameters:{id:"any",object:"any",point:"any",clickType:"sap.ui.vk.tools.HitTestClickType"}}}},constructor:function(i,r){if(s._instance){return s._instance}e.apply(this,arguments);this.setToolid("63150593-75f6-c330-2a7a-c1f85d36b2b9");this._viewport=null;this._handler=new t(this);this._loco=null;s._instance=this;return this}});s.prototype.init=function(){if(e.prototype.init){e.prototype.init.call(this)}this.setFootprint(["sap.ui.vk.threejs.Viewport"])};s.prototype.setActive=function(t,i,r){e.prototype.setActive.call(this,t,i,r);if(this._viewport){if(t){this._prepare()}else{this._removeLocoHandler()}}return this};s.prototype._prepare=function(){if(!this._addLocoHandler()){return false}var e=false;if(this.isViewportType("sap.ui.vk.dvl.Viewport")&&this._viewport._dvl){this._dvlRendererId=this._viewport._dvlRendererId;this._dvl=this._viewport._dvl;e=true}else if(this.isViewportType("sap.ui.vk.threejs.Viewport")&&(this._viewport._scene&&this._viewport._scene.getSceneRef())){e=true}return e};s.prototype.queueCommand=function(e){if(this._prepare()){if(this._dvlRendererId){this._dvl.Renderer._queueCommand(e,this._dvlRendererId)}}return this};s.prototype.hitTest=function(e,t,r,s,o){if(this._prepare()){var p=null;if(this.isViewportType("sap.ui.vk.dvl.Viewport")&&this._viewport._dvl){return null}else if(this.isViewportType("sap.ui.vk.threejs.Viewport")){if(!r||!s){p=null}else if(this._viewport._renderer){p=this._viewport.hitTest(e,t)}}var n=null;if(p){var l;switch(this.getIdMode()){case i.VEsID:l=this._viewport._scene.nodeRefToPersistentId(p.object);break;case i.ThreeJS:l=p.object.id;break;default:l=p.object.id;break}n={id:l,object:p.object,point:p.point,clickType:o};this.fireHit(n)}return n}return null};return s});
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/tools/HitTestToolHandler", ["sap/ui/base/EventProvider","./HitTestClickType"],function(t,e){"use strict";var i=t.extend("sap.ui.vk.tools.HitTestToolHandler",{metadata:{library:"sap.ui.vk"},constructor:function(t){this._priority=0;this._tool=t;this._rect=null;this._gesture=false;this._nomenu=false}});i.prototype.destroy=function(){this._tool=null;this._rect=null;this._gesture=false};i.prototype._getOffset=function(t){var e=t.getBoundingClientRect();var i={x:e.left+window.pageXOffset,y:e.top+window.pageYOffset};return i};i.prototype._inside=function(t){var e=this._tool._viewport.getIdForLabel();var i=document.getElementById(e);if(i==null){return false}var o=this._getOffset(i);this._rect={x:o.x,y:o.y,w:i.offsetWidth,h:i.offsetHeight};return t.x>=this._rect.x&&t.x<=this._rect.x+this._rect.w&&t.y>=this._rect.y&&t.y<=this._rect.y+this._rect.h};i.prototype.beginGesture=function(t){t.handled=false};i.prototype.move=function(t){t.handled=false};i.prototype.endGesture=function(t){t.handled=false};i.prototype._executeHittest=function(t,e){if(this._inside(t)&&!this._gesture){this._gesture=false;var i=t.x-this._rect.x,o=t.y-this._rect.y;this._gizmo=this._tool.getGizmo();if(this._gizmo){this._gizmo.show(this._tool._viewport);this._gizmo.moveGizmo(i,o)}var s=this._tool._viewport.getScene();var r=this._tool._viewport.getCamera();this._tool.hitTest(i,o,s,r,e);if(this._gizmo){this._gizmo.hide()}}};i.prototype.click=function(t){this._executeHittest(t,e.Single);t.handled=true};i.prototype.doubleClick=function(t){this._executeHittest(t,e.Double);t.handled=false};i.prototype.contextMenu=function(t){this._executeHittest(t,e.Context);t.handled=false};i.prototype.getViewport=function(){return this._tool._viewport};return i});
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/tools/MeasurementToolGizmo", ["sap/base/Log","../measurements/Edge","../measurements/Face","../measurements/Vertex","../measurements/MeshAnalyzer","../measurements/MeshAnalyzer2D","../measurements/Settings","./MeasurementToolState","./Gizmo","../thirdparty/three","sap/ui/core/Element"],function(e,t,r,s,a,n,i,u,o,l,h){"use strict";var c=o.extend("sap.ui.vk.tools.MeasurementToolGizmo",{metadata:{library:"sap.ui.vk"},renderer:null});var _=c.getMetadata().getParent().getClass().prototype;c.prototype.hasDomElement=function(){return false};c.prototype.init=function(){if(_.init){_.init.call(this)}this._viewport=null;this._surface=null;this._tool=null;this._vsm=null;this._settings=null;this._state=u.Off;this._hoverPoint=null;this._currentFeature=null;this._currentFeatureIndex=0;this._firstFeature=null;this._secondFeature=null;this._vertexFeatures=[new s];this._edgeFeatures=[new t];this._faceFeatures=[new r];this._currentMeasurement=null;this._meshAnalyzerMap=new Map;this._is2D=false};c.prototype.setCurrentFeatureIndex=function(a){if(a<1&&this._firstFeature){e.error("setCurrentFeatureIndex: first feature not null with index="+a)}if(a<2&&this._secondFeature){e.error("setCurrentFeatureIndex: second feature not null with index="+a)}var n=a-this._currentFeatureIndex;if(n===1){this._currentFeatureIndex++;this._vertexFeatures.push(new s);this._edgeFeatures.push(new t);this._faceFeatures.push(new r)}else if(n===-1){this._currentFeatureIndex--;this._vertexFeatures.pop();this._edgeFeatures.pop();this._faceFeatures.pop()}else if(a===0){this._currentFeatureIndex=0;this._vertexFeatures.splice(1);this._edgeFeatures.splice(1);this._faceFeatures.splice(1)}else if(n!==0){e.error("setCurrentFeatureIndex: "+this._currentFeatureIndex+" => "+a)}};c.prototype._createMeshAnalyzer=function(e){let t=null;let r=0;let s=0;let n=0;let i,u,o;let h=function(e){if(e.geometry&&e.geometry.isBufferGeometry){const s=e.geometry.getAttribute("position");const a=e.geometry.getIndex();const h=e.userData.renderGroup;if(s&&a){if(t){for(let r=h?h.start:0,n=h?h.start+h.count:a.count;r<n;r+=3){i=(new l.Vector3).fromArray(s.array,a.array[r]*3);u=(new l.Vector3).fromArray(s.array,a.array[r+1]*3);o=(new l.Vector3).fromArray(s.array,a.array[r+2]*3);i.applyMatrix4(e.matrixWorld);u.applyMatrix4(e.matrixWorld);o.applyMatrix4(e.matrixWorld);t.addTriangle([i.x,i.y,i.z],[u.x,u.y,u.z],[o.x,o.y,o.z])}}else{r+=h?h.count:a.count}}else if(s){if(t){for(let r=h?h.start:0,a=h?h.start+h.count:s.count;r<a;++r){i=(new l.Vector3).fromArray(s.array,r*3);i.applyMatrix4(e.matrixWorld);t._addVertex([i.x,i.y,i.z])}}else{n+=h?h.count:s.count}}}e.children.forEach(h)};for(let i=0;i<2;++i){h(e);if(i===0){t=new a(r/3,s,n)}}t.finishMeshBuilding();return t};c.prototype._createMeshAnalyzer2D=function(e){return new n(e,this._viewport.getCamera()._getViewBox())};c.prototype._getMeshAnalyzer=function(e){var t=this._meshAnalyzerMap.get(e);if(t!=null){return t}var r=this._is2D?this._createMeshAnalyzer2D(e):this._createMeshAnalyzer(e);this._meshAnalyzerMap.set(e,r);return r};c.prototype.show=function(e,t){this._viewport=e;this._surface=e.getMeasurementSurface();this._tool=t;this._vsm=h.getElementById(e.getViewStateManager());this._is2D=e.getScene().getMetadata().getName()==="sap.ui.vk.svg.Scene";this._settings=i.load();this._state=u.SearchingFirstFeature;this.setCurrentFeatureIndex(0)};c.prototype.hide=function(){if(this._surface!=null){var e=this._surface;for(var t=0,r=this._faceFeatures.length;t<r;++t){e.removeFeature(this._faceFeatures[t])}for(var s=0,a=this._edgeFeatures.length;s<a;++s){e.removeFeature(this._edgeFeatures[s])}for(var n=0,i=this._vertexFeatures.length;n<i;++n){e.removeFeature(this._vertexFeatures[n])}if(this._currentMeasurement!=null){e.removeMeasurement(this._currentMeasurement);this._currentMeasurement=null}}var o=this._vsm;var l=this._hoverPoint&&this._hoverPoint.nodeRef;if(l!=null&&o!=null){o.setOutliningStates([],[l],false,true)}this._viewport=null;this._surface=null;this._tool=null;this._vsm=null;this._settings=null;this._state=u.Off;this._currentFeature=null;this._firstFeature=null;this._secondFeature=null;this.setCurrentFeatureIndex(0);this._hoverPoint=null};c.prototype._computeSphereRadius=function(e,t){var r=this._is2D?5:3;if(this._is2D){var s=t._camera._worldToScreen(e[0],e[1]);var a=t._camera._screenToWorld(s.x+r,s.y);r=Math.abs(e[0]-a.x)}else{var n=t.getDomRef().getBoundingClientRect();var i=n.width*.5;var u=n.height*.5;var o=t.getCamera().getCameraRef();var h=(new l.Vector3).fromArray(e);var c=h.clone();c.project(o);var _=r/i;var f=r/u;r=0;for(var p=0;p<4;++p){var d=p%2?-1:1;var m=new l.Vector3(c.x+d*(p<2?_:0),c.y+d*(p>=2?f:0),c.z);m.unproject(o);var v=m.distanceTo(h);if(v>r){r=v}}}return r};c.prototype._getPointRadius=function(e){const t=e.getScene().getSceneRef?.().userData?.pointScale;return t?t/1024:undefined};c.prototype._replaceCurrentFeature=function(e,t,r){var s=false;if(e!==this._currentFeature){this._surface.removeFeature(this._currentFeature);this._surface.addFeature(e);this._currentFeature=e;s=true}else if(r!==e.getContext()||t!==e.getFeatureId()){s=true}if(s){e.setContext(r);e.setFeatureId(t)}return s};return c});
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/tools/MeasurementToolHandler", ["sap/ui/base/EventProvider"],function(t){"use strict";var e=t.extend("sap.ui.vk.tools.MeasurementToolHandler",{metadata:{library:"sap.ui.vk"},constructor:function(e){t.call(this);this._priority=0;this._tool=e;this._rect=null}});e.prototype.destroy=function(){this._tool=null;this._rect=null};e.prototype._processMouseEvent=function(t,e){var o=null;if(t&&this._inside(e)&&this.getViewport().getScene()){var i=e.x-this._rect.x;var r=e.y-this._rect.y;var n=this._tool._viewport;if(t.is2D()){var s=n.hitTest(i,r,true,true,true);var u=n._camera._screenToWorld(i,r);o={screenPoint:[i,r],worldPoint:[u.x,u.y,0],nodeRef:s,shiftKey:e.event.shiftKey}}else{var l=n.hitTest(i,r);if(l!=null&&l.object!=null){o={screenPoint:[i,r],worldPoint:l.point.toArray(),nodeRef:l.object,shiftKey:e.event.shiftKey}}else{o={screenPoint:[i,r],worldPoint:null,nodeRef:null,shiftKey:e.event.shiftKey}}}}return o};e.prototype.hover=function(t){var e=this._tool.getGizmo();e.setHoverPoint(this._processMouseEvent(e,t))};e.prototype.beginGesture=function(t){};e.prototype.move=function(t){};e.prototype.endGesture=function(t){};e.prototype.click=function(t){var e=this.getViewport().getDomRef();if(e){e.focus()}t.handled=true;var o=this._tool.getGizmo();o.fixPoint(this._processMouseEvent(o,t))};e.prototype.doubleClick=function(t){var e=this._tool.getGizmo();if(e&&e.doubleClick&&e.doubleClick(this._processMouseEvent(e,t))){t.handled=true}};e.prototype.contextMenu=function(t){};e.prototype.keyEventHandler=function(t){if(t.code==="Escape"){var e=this._tool.getGizmo();if(e){e.escapePressed();t.handled=true}}};e.prototype.getViewport=function(){return this._tool._viewport};e.prototype._getOffset=function(t){var e=t.getBoundingClientRect();var o={x:e.left+window.pageXOffset,y:e.top+window.pageYOffset};return o};e.prototype._inside=function(t){var e=this._tool._viewport.getIdForLabel();var o=document.getElementById(e);if(o==null){return false}var i=this._getOffset(o);var r=this._rect={x:i.x,y:i.y,w:o.offsetWidth,h:o.offsetHeight};return t.x>=r.x&&t.x<=r.x+r.w&&t.y>=r.y&&t.y<=r.y+r.h};return e});
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/tools/MeasurementToolState", [],function(){"use strict";var e={Off:"Off",SearchingFirstFeature:"SearchingFirstFeature",SearchingSecondFeature:"SearchingSecondFeature",SearchingThirdFeature:"SearchingThirdFeature",DefiningAngle:"DefiningAngle"};return e},true);
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/tools/MoveTool", ["./Tool","./CoordinateSystem","./GizmoPlacementMode","./MoveToolHandler","./MoveToolGizmo","./ToolNodeSet"],function(e,t,o,i,s,r){"use strict";var n=e.extend("sap.ui.vk.tools.MoveTool",{metadata:{library:"sap.ui.vk",properties:{coordinateSystem:{type:"sap.ui.vk.tools.CoordinateSystem",defaultValue:t.World},placementMode:{type:"sap.ui.vk.tools.GizmoPlacementMode",defaultValue:o.ObjectCenter},enableStepping:{type:"boolean",defaultValue:false},enableSnapping:{type:"boolean",defaultValue:false},showEditingUI:{type:"boolean",defaultValue:false},autoResetValues:{type:"boolean",defaultValue:true},allowContextMenu:{type:"boolean",defaultValue:true},nodeSet:{type:"sap.ui.vk.tools.ToolNodeSet",defaultValue:r.Highlight}},events:{moving:{parameters:{x:"float",y:"float",z:"float",nodesProperties:"any[]"}},moved:{parameters:{x:"float",y:"float",z:"float",nodesProperties:"any[]"}},coordinateSystemChanged:{parameters:{coordinateSystem:"sap.ui.vk.tools.CoordinateSystem"}},placementModeChanged:{parameters:{placementMode:"sap.ui.vk.tools.GizmoPlacementMode"}}}},constructor:function(t,o){e.apply(this,arguments);this._viewport=null;this._handler=new i(this);this._gizmo=null}});n.prototype.init=function(){e.prototype.init.call(this);this.setFootprint(["sap.ui.vk.threejs.Viewport"]);this.setAggregation("gizmo",new s)};n.prototype.setActive=function(t,o,i){e.prototype.setActive.call(this,t,o,i);if(this._viewport){if(t){this._gizmo=this.getGizmo();this._gizmo.setCoordinateSystem(this.getCoordinateSystem());this._gizmo.setPlacementMode(this.getPlacementMode());this._gizmo.show(this._viewport,this);this._addLocoHandler()}else{this._removeLocoHandler();this._gizmo?.hide();this._gizmo=null}}return this};n.prototype.queueCommand=function(e){if(this._addLocoHandler()){if(this.isViewportType("sap.ui.vk.threejs.Viewport")){e()}}return this};n.prototype.setPlacementMode=function(e){var t=this.getPlacementMode();if(t!==e){this.setProperty("placementMode",e,true);this.getGizmo().setPlacementMode(e);this._viewport?.setShouldRenderFrame();this.firePlacementModeChanged({placementMode:e})}return this};n.prototype.setCoordinateSystem=function(e){var t=this.getCoordinateSystem();if(t!==e){this.setProperty("coordinateSystem",e,true);this.getGizmo().setCoordinateSystem(e);this._viewport?.setShouldRenderFrame();this.fireCoordinateSystemChanged({coordinateSystem:e})}return this};n.prototype.setShowEditingUI=function(e){this.setProperty("showEditingUI",e,true);this._viewport?.setShouldRenderFrame();return this};n.prototype.setEnableSnapping=function(e){this.setProperty("enableSnapping",e,true);if(e&&this.getActive()){this.getGizmo()._computeBoundsTree()}else{this.getGizmo()._disposeBoundsTree()}return this};n.prototype.resetValues=function(){this.getGizmo().resetValues();this._viewport?.setShouldRenderFrame();return this};n.prototype.setNodeSet=function(e){this.setProperty("nodeSet",e,true);this._gizmo?.handleSelectionChanged()};n.prototype.move=function(e,t,o,i){var s;if(i&&i!==this.getCoordinateSystem()){s=this.getCoordinateSystem();this.setCoordinateSystem(i)}this._gizmo?.move(e,t,o);if(s){this.setCoordinateSystem(s)}this._gizmo?.endGesture();this._viewport?.setShouldRenderFrame();return this};n.prototype.prepareForCreatingTranslateKey=function(e){if(this._gizmo){this._gizmo._prepareForCreatingKey(e);return this._gizmo._getNodesProperties()}return null};return n});
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/tools/MoveToolGizmo", ["../getResourceBundle","../thirdparty/three","../thirdparty/BufferGeometryUtils","./Gizmo","./CoordinateSystem","./GizmoPlacementMode","./AxisColours","../AnimationTrackType","sap/base/assert","sap/base/Log"],function(t,e,i,r,o,a,n,s,l,h){"use strict";var d=r.extend("sap.ui.vk.tools.MoveToolGizmo",{metadata:{library:"sap.ui.vk"},renderer:{apiVersion:2,render:function(t,e){t.openStart("div",e);t.class("sapUiVkTransformationToolEdit");t.openEnd();t.renderControl(e._editingForm);t.close("div")}}});d.prototype.init=function(){r.prototype.init.apply(this);this._createEditingForm(t().getText("TOOL_UNITS_MM"),84);this._gizmoIndex=-1;this._handleIndex=-1;this._value=new e.Vector3;this._moveDelta=new e.Vector3;this._noHitOffset=new e.Vector3;this._viewport=null;this._tool=null;this._sceneGizmo=new e.Scene;const s=new e.DirectionalLight(16777215,.5*Math.PI);s.position.set(1,3,2);this._sceneGizmo.add(s);this._sceneGizmo.add(new e.AmbientLight(16777215,.5*Math.PI));this._gizmo=new e.Group;this._touchAreas=new e.Group;this._sceneGizmo.add(this._gizmo);this._coordinateSystem=o.World;this._placementMode=a.Default;this._nodes=[];this._matViewProj=new e.Matrix4;this._gizmoSize=96;function l(t,r,o){var a=96,n=1,s=24,l=4,h=48;t.multiplyScalar(1/a);var d=new e.MeshLambertMaterial({color:r,transparent:true});var c=new e.CylinderGeometry(n,n,a-s,4);var p=(new e.Matrix4).makeBasis(new e.Vector3(t.y,t.z,t.x),t,new e.Vector3(t.z,t.x,t.y));p.setPosition(t.clone().multiplyScalar((a-s)*.5));c.applyMatrix4(p);var u=new e.Mesh(c,d);u.matrixAutoUpdate=false;u.userData.color=r;var f=new e.CylinderGeometry(0,l,s,12,1);p.setPosition(t.clone().multiplyScalar(a-s*.5));f.applyMatrix4(p);var m=new e.Mesh(f,d);m.matrixAutoUpdate=false;u.add(m);var _=new e.CylinderGeometry(h*.5,h*.5,h,12,1);_.applyMatrix4(p);var v=new e.CylinderGeometry(h*.5,h*.2,h,12,1);p.setPosition(t.clone().multiplyScalar(a*.5));v.applyMatrix4(p);var y=i.mergeGeometries([_,v]);o.add(new e.Mesh(y,d));return u}function h(t,i,r){var o=new Float32Array(9);o[t]=o[i+6]=1;o[t+3]=o[i+3]=.5;var a=new e.BufferGeometry;var n=new Float32Array(12);n[3+t]=n[6+i]=n[9+t]=n[9+i]=.333;a.setAttribute("position",new e.Float32BufferAttribute(n,3));a.setIndex([0,2,1,1,2,3]);var s=new e.MeshBasicMaterial({color:16776960,opacity:.5,transparent:true,visible:false,side:e.DoubleSide});var l=new e.Mesh(a,s);l.matrixAutoUpdate=false;l.userData.colors=o;var h=new e.BufferGeometry;var d=new Float32Array(9);d[t]=d[t+3]=d[i+3]=d[i+6]=.333;h.setAttribute("position",new e.Float32BufferAttribute(d,3));h.setAttribute("color",new e.Float32BufferAttribute(o,3));var c=new e.Line(h,new e.LineBasicMaterial({vertexColors:true,transparent:true,linewidth:window.devicePixelRatio}));c.matrixAutoUpdate=false;l.add(c);r.add(new e.Mesh(a,new e.MeshBasicMaterial({side:e.DoubleSide})));return l}this._gizmo.add(l(new e.Vector3(1,0,0),n.x,this._touchAreas));this._gizmo.add(l(new e.Vector3(0,1,0),n.y,this._touchAreas));this._gizmo.add(l(new e.Vector3(0,0,1),n.z,this._touchAreas));this._gizmo.add(h(1,2,this._touchAreas));this._gizmo.add(h(2,0,this._touchAreas));this._gizmo.add(h(0,1,this._touchAreas));this._axisTitles=this._createAxisTitles();this._sceneGizmo.add(this._axisTitles);var d=new e.BufferGeometry;d.setAttribute("position",new e.Float32BufferAttribute(new Float32Array(6),3));this._line=new e.LineSegments(d,new e.LineBasicMaterial);this._line.frustumCulled=false;this._line.visible=false;this._gizmo.add(this._line)};d.prototype.hasDomElement=function(){return true};d.prototype.resetValues=function(){this._value.setScalar(0)};d.prototype.setCoordinateSystem=function(t){this._coordinateSystem=t;var e=t===o.Screen;var i=this._gizmo.children,r=this._touchAreas.children;i[2].visible=i[3].visible=i[4].visible=!e;r[2].visible=r[3].visible=r[4].visible=!e;this._axisTitles.children[2].visible=!e;this._gizmoIndex=this._handleIndex=-1};d.prototype.show=function(t,e){this._viewport=t;this._tool=e;this._nodes.length=0;this._updateSelection(t._viewStateManager);var i=this._getNodesProperties();this._tool.fireEvent("moving",{x:0,y:0,z:0,nodesProperties:i},true);this._attachVisibilityChanged()};d.prototype.hide=function(){this._detachVisibilityChanged();this._cleanTempData();this._disposeBoundsTree();this._viewport=null;this._tool=null;this._gizmoIndex=this._handleIndex=-1;this._updateEditingForm(false)};d.prototype._onVisibilityChanged=function(t){if(this._tool.getEnableSnapping()){this._computeBoundsTree()}};d.prototype.getGizmoCount=function(){if(this._coordinateSystem===o.Local||this._coordinateSystem===o.Parent){return this._nodes.length}else{return this._nodes.length>0?1:0}};d.prototype.getTouchObject=function(t){if(this._nodes.length===0){return null}this._updateGizmoObjectTransformation(this._touchAreas,t);return this._touchAreas};var c=[1,2,4,6,5,3];d.prototype.highlightHandle=function(t,e){var i;for(i=0;i<3;i++){var r=this._gizmo.children[i];var o=c[t]&1<<i;var a=o?16776960:r.userData.color;r.material.color.setHex(a);r.material.opacity=o||e?1:.35;r.children[0].material.color.setHex(a);r.children[0].material.opacity=o||e?1:.35;var n=this._axisTitles.children[i];n.material.color.setHex(a);n.material.opacity=o||e?1:.35}for(i=3;i<6;i++){var s=this._gizmo.children[i];s.material.visible=i===t;var l=s.children[0].geometry.attributes.color;l.copyArray(i===t?[1,1,0,1,1,0,1,1,0]:s.userData.colors);l.needsUpdate=true;s.children[0].material.opacity=i===t||e?1:.35}};d.prototype.selectHandle=function(t,e){this._gizmoIndex=e;this._handleIndex=t;if(this._tool.getAutoResetValues()){this.resetValues()}this._viewport.setShouldRenderFrame(true)};d.prototype.beginGesture=function(){this._beginValue=this._value.clone();this._moveDelta.setScalar(0);this._noHitOffset.setScalar(0);this._matOrigin=this._gizmo.matrixWorld.clone();this._nodes.forEach(function(t){var i=t.node;t.matOrigin=i.matrixWorld.clone();t.originLocal=i.position.clone();t.origin=(new e.Vector3).setFromMatrixPosition(i.matrixWorld);if(i.parent){t.matParentInv=(new e.Matrix4).copy(i.parent.matrixWorld).invert()}else{t.matParentInv=new e.Matrix4}})};d.prototype._printEventInfo=function(t,e,i,r,o){h.debug(t+" is fired:"+" x = "+e+"; y = "+i+"; z = "+r);o.forEach(function(t){h.debug("Node: "+t.node.name);if(t.offsetToRest){h.debug("offsetToRest: [ "+t.offsetToRest[0]+", "+t.offsetToRest[1]+", "+t.offsetToRest[2]+" ] ")}else{h.debug("offsetToRest: null")}if(t.offsetToPrevious){h.debug("offsetToPrevious: [ "+t.offsetToPrevious[0]+", "+t.offsetToPrevious[1]+", "+t.offsetToPrevious[2]+" ] ")}else{h.debug("offsetToPrevious: null")}if(t.absolute){h.debug("absolute: [ "+t.absolute[0]+", "+t.absolute[1]+", "+t.absolute[2]+" ] ")}else{h.debug("absolute: null")}if(t.world){h.debug("world: [ "+t.world[0]+", "+t.world[1]+", "+t.world[2]+" ] ")}else{h.debug("world: null")}if(t.restDifference){h.debug("restDifference: [ "+t.restDifference[0]+", "+t.restDifference[1]+", "+t.restDifference[2]+" ] ")}else{h.debug("restDifference: null")}if(t.restDifferenceInCoordinates){h.debug("restDifferenceInCoordinates: [ "+t.restDifferenceInCoordinates[0]+", "+t.restDifferenceInCoordinates[1]+", "+t.restDifferenceInCoordinates[2]+" ] ")}else{h.debug("restDifferenceInCoordinates: null")}})};d.prototype._getOffsetToRestInCoordinateSystem=function(t,i,r){if(r===o.World){return i.toArray()}else if(r===o.Custom){var a=(new e.Matrix4).extractRotation(this._gizmo.matrixWorld);var n=(new e.Matrix4).copy(a).invert();return i.clone().applyMatrix4(n).toArray()}else if(r===o.Local){var s=(new e.Matrix4).extractRotation(t.matrixWorld);var l=(new e.Matrix4).copy(s).invert();return i.clone().applyMatrix4(l).toArray()}else if(r===o.Screen){var h=this._viewport.getRenderer().getSize(new e.Vector2);var d=this._viewport.getCamera().getCameraRef();var c=(new e.Vector4).copy(this._gizmo.position).applyMatrix4(this._matViewProj);var p=(new e.Matrix3).setFromMatrix4(d.matrixWorld);var u=(new e.Matrix3).copy(p).invert();var f=i.clone().applyMatrix3(u);var m=2*c.w/(d.projectionMatrix.elements[0]*h.width);var _=2*c.w/(d.projectionMatrix.elements[5]*h.height);return[f.x/m,f.y/_,0]}return null};d.prototype._getNodesProperties=function(){var t=[];this._nodes.forEach(function(i){var r=i.node;var a={};a.node=r;var n=this._getEffectiveParent(r);var l=new e.Matrix4;if(n===r.parent){var h=this._viewport._viewStateManager.getRelativeTransformation(r);a.offsetToRestInParent=h.translation.slice();if(r.parent){l=(new e.Matrix4).extractRotation(r.parent.matrixWorld)}a.offsetToPreviousInParent=a.offsetToRestInParent.slice();var d;if(this._playback){d=this._viewport._viewStateManager._getEndPropertyInPreviousPlayback(r,s.Translate,this._playback);if(d){a.offsetToPreviousInParent[0]-=d[0];a.offsetToPreviousInParent[1]-=d[1];a.offsetToPreviousInParent[2]-=d[2]}}var c=this._viewport._viewStateManager.getRestTransformation(r);var p=[c.translation[0],c.translation[1],c.translation[2]];if(d){p[0]+=d[0];p[1]+=d[1];p[2]+=d[2]}var u=new e.Quaternion;var f=new e.Vector3;var m=new e.Vector3;r.matrix.decompose(m,u,f);var _=(new e.Matrix4).makeTranslation(-p[0],-p[1],-p[2]);var v=(new e.Matrix4).makeTranslation(-c.translation[0],-c.translation[1],-c.translation[2]);if(f.x===0||f.y===0||f.z===0){f.x=1;f.y=1;f.z=1}var y=(new e.Matrix4).makeScale(1/f.x,1/f.y,1/f.z);var x=(new e.Matrix4).makeRotationFromQuaternion(u.invert());var g=y.clone().multiply(x).multiply(_).multiply(r.matrix);g.decompose(m,u,f);a.offsetToPrevious=m.toArray();var w=y.multiply(x).multiply(v).multiply(r.matrix);w.decompose(m,u,f);a.offsetToRest=m.toArray()}else{if(r.userData.skipUpdateJointNode){this._viewport._viewStateManager._setJointNodeOffsets(r,s.Translate)}if(r.userData&&r.userData.offsetTranslation){a.offsetToRestInParent=r.userData.offsetTranslation.slice()}else{a.offsetToRestInParent=[0,0,0]}a.offsetToPreviousInParent=a.offsetToRestInParent.slice();if(r.userData.skipUpdateJointNode){r.userData.skipUpdateJointNode=false;this._viewport._viewStateManager._setJointNodeMatrix();r.userData.skipUpdateJointNode=true}var M=this._viewport._viewStateManager.getRestTransformationUsingJoint(r);var S=new e.Vector3;var z=new e.Vector3(M.scale[0],M.scale[1],M.scale[2]);var b=new e.Quaternion(M.quaternion[0],M.quaternion[1],M.quaternion[2],M.quaternion[3]);if(r.userData.offsetScale){z.x*=r.userData.offsetScale[0];z.y*=r.userData.offsetScale[1];z.z*=r.userData.offsetScale[2]}if(r.userData.offsetQuaternion){var P=new e.Quaternion(r.userData.offsetQuaternion[0],r.userData.offsetQuaternion[1],r.userData.offsetQuaternion[2],r.userData.offsetQuaternion[3]);b.multiply(P)}var T=(new e.Matrix4).makeRotationFromQuaternion(b);var I=(new e.Matrix4).makeTranslation(M.translation[0],M.translation[1],M.translation[2]);var D=n.matrixWorld.clone().multiply(I).multiply(T).scale(z);var V=(new e.Matrix4).copy(D).invert().multiply(r.matrixWorld);V.decompose(S,b,z);a.offsetToPrevious=S.toArray();a.offsetToRest=S.toArray()}var C=this._viewport._viewStateManager.getTransformation(r);a.absolute=[C.translation[0],C.translation[1],C.translation[2]];var A=this._viewport._viewStateManager.getTransformationWorld(r);a.world=A.translation;var R;if(this._nodeUserDataMap){R=this._nodeUserDataMap.get(r)}if(R&&R.initialTranslation){a.restDifference=[C.translation[0]-R.initialTranslation[0],C.translation[1]-R.initialTranslation[1],C.translation[2]-R.initialTranslation[2]];if(this._coordinateSystem===o.Parent){a.restDifferenceInCoordinates=a.restDifference.slice()}else{var G=new e.Vector3(a.restDifference[0],a.restDifference[1],a.restDifference[2]).applyMatrix4(l);a.restDifferenceInCoordinates=this._getOffsetToRestInCoordinateSystem(r,G,this._coordinateSystem)}}t.push(a)}.bind(this));return t};d.prototype.endGesture=function(){this._line.visible=false;var t=this._getNodesProperties();var i=this._moveDelta.clone();if(this._coordinateSystem===o.Custom){var r=(new e.Matrix4).extractRotation(this._gizmo.matrixWorld);var a=(new e.Matrix4).copy(r).invert();i.applyMatrix4(a)}delete this._beginValue;this._nodes.forEach(function(t){var e=t.node;delete e.userData.skipUpdateJointNode;this._viewport._viewStateManager._setJointNodeOffsets(e,s.Translate)},this);this._tool.fireMoved({x:i.x,y:i.y,z:i.z,nodesProperties:t});this._printEventInfo("Event 'moved'",i.x,i.y,i.z,t)};d.prototype._setOffset=function(t,i){if(this._coordinateSystem===o.Local||this._coordinateSystem===o.Parent){var r=this._nodes[i];var a=r.node;var n=this._getEffectiveParent(a);if(this._coordinateSystem===o.Parent&&n){a=n}var s=(new e.Matrix4).copy(a.matrixWorld).invert();var l=(new e.Vector3).setFromMatrixScale(a.matrixWorld);var h=r.origin.clone().applyMatrix4(s);t=r.origin.clone().add(t).applyMatrix4(s).sub(h).multiply(l)}else if(this._coordinateSystem===o.Screen){var d=this._viewport.getRenderer().getSize(new e.Vector2);var c=this._gizmo.position.clone().applyMatrix4(this._matViewProj);var p=this._gizmo.position.clone().add(t).applyMatrix4(this._matViewProj);t.set(Math.round((p.x-c.x)*.5*d.width),Math.round((p.y-c.y)*.5*d.height),0)}var u=this._getNodesProperties();var f=t.clone();if(this._coordinateSystem===o.Custom){var m=(new e.Matrix4).extractRotation(this._gizmo.matrixWorld);var _=(new e.Matrix4).copy(m).invert();f.applyMatrix4(_)}if(this._tool.fireEvent("moving",{x:f.x,y:f.y,z:f.z,nodesProperties:u},true)){this._printEventInfo("Event 'moving'",f.x,f.y,f.z,u);this._move(t);if(this._coordinateSystem===o.Screen){t.set((new e.Vector3).setFromMatrixColumn(this._matOrigin,0).normalize().dot(t),(new e.Vector3).setFromMatrixColumn(this._matOrigin,1).normalize().dot(t),0)}else if(this._coordinateSystem===o.Custom){var v=this._getAnchorPoint();if(v){var y=(new e.Matrix4).copy(v.matrixWorld).invert();var x=(new e.Vector3).setFromMatrixScale(v.matrixWorld);var g=v.position.clone().applyMatrix4(y);t.copy(v.position.clone().add(t).applyMatrix4(y).sub(g).multiply(x))}}var w=this._line.geometry.getAttribute("position");w.array.set(t.multiplyScalar(-1).toArray());w.needsUpdate=true;this._line.geometry.computeBoundingBox();t.set(Math.abs(t.x),Math.abs(t.y),Math.abs(t.z));t.multiplyScalar(1/Math.max(t.x,t.y,t.z));this._line.material.color.setRGB(t.x,t.y,t.z);this._line.visible=true}};d.prototype._move=function(t,i=false){this._value.addVectors(this._beginValue,t);this._moveDelta.copy(t);this._nodes.forEach(function(t){var e=t.node;e.userData.skipUpdateJointNode=true});if(this._coordinateSystem===o.Local||this._coordinateSystem===o.Parent){this._nodes.forEach(e=>{var i=e.node;var r=this._getEffectiveParent(i);var a=null;if(this._coordinateSystem===o.Parent&&r){a=this._extractBasis(r.matrixWorld)}else{a=this._extractBasis(i.matrixWorld)}var n=e.origin.clone();n.add(a[0].multiplyScalar(t.x)).add(a[1].multiplyScalar(t.y)).add(a[2].multiplyScalar(t.z));i.matrixWorld.setPosition(n);i.matrix.multiplyMatrices(e.matParentInv,i.matrixWorld);i.position.setFromMatrixPosition(i.matrix);i.updateMatrixWorld(true)})}else{if(this._coordinateSystem===o.Screen){var r=this._viewport.getRenderer().getSize(new e.Vector2);var a=this._viewport.getCamera().getCameraRef();var n=(new e.Vector4).copy(this._gizmo.position).applyMatrix4(this._matViewProj);var s=t.x*2*n.w/(a.projectionMatrix.elements[0]*r.width);var l=t.y*2*n.w/(a.projectionMatrix.elements[5]*r.height);t.setFromMatrixColumn(a.matrixWorld,0).multiplyScalar(s);t.add((new e.Vector3).setFromMatrixColumn(a.matrixWorld,1).multiplyScalar(l))}this._gizmo.position.setFromMatrixPosition(this._matOrigin).add(t);if(this._coordinateSystem===o.Custom){var h=this._getAnchorPoint();if(h){h.position.copy(this._gizmo.position)}}this._nodes.forEach(function(e){if(!e.ignore){var i=e.node;i.matrixWorld.setPosition(e.origin.clone().add(t));i.matrix.multiplyMatrices(e.matParentInv,i.matrixWorld);i.position.setFromMatrixPosition(i.matrix);i.updateMatrixWorld(true)}})}if(!i&&this._tool.getEnableSnapping()){if(this._checkSceneSelectionIntersection()){const i=new e.Vector3;for(let e=0;e<6;e++){i.copy(t).add(this._noHitOffset).multiplyScalar(.5);this._move(i,true);(this._checkSceneSelectionIntersection()?t:this._noHitOffset).copy(i)}if(!this._noHitOffset.equals(i)){this._move(this._noHitOffset,true)}}else{this._noHitOffset.copy(t)}}this._viewport.setShouldRenderFrame()};d.prototype.move=function(t,i,r){this.beginGesture();if(this._coordinateSystem===o.Custom){var a=new e.Vector3(t,i,r);var n=(new e.Matrix4).extractRotation(this._gizmo.matrixWorld);a.applyMatrix4(n);t=a.x;i=a.y;r=a.z}this._move(new e.Vector3(t,i,r||0))};d.prototype.getValue=function(){return this._gizmoIndex>=0&&this._handleIndex>=0&&this._handleIndex<3?this._value.getComponent(this._handleIndex):0};d.prototype.setValue=function(t){if(this._gizmoIndex>=0&&this._handleIndex>=0&&this._handleIndex<3){this.beginGesture();this._move((new e.Vector3).setComponent(this._handleIndex,t-this._value.getComponent(this._handleIndex)));this.endGesture()}};d.prototype.expandBoundingBox=function(t){if(this._viewport){this._expandBoundingBox(t,this._viewport.getCamera().getCameraRef(),true)}};d.prototype._updateSelection=function(t){r.prototype._updateSelection.call(this,t);if(this._tool.getEnableSnapping()){this._computeBoundsTree()}};d.prototype.handleSelectionChanged=function(t){if(this._viewport){this._updateSelection(this._viewport._viewStateManager);var e=this._getNodesProperties();this._tool.fireEvent("moving",{x:0,y:0,z:0,nodesProperties:e},true);this._gizmoIndex=this._handleIndex=-1}};d.prototype._updateGizmoTransformation=function(t,e){var i=this._updateGizmoObjectTransformation(this._gizmo,t);this._updateAxisTitles(this._axisTitles,this._gizmo,e,this._gizmoSize+18,i);this._line.scale.setScalar(1/(this._gizmoSize*i))};d.prototype._getEditingFormPosition=function(){var t=this._updateGizmoObjectTransformation(this._gizmo,this._gizmoIndex);var i=(new e.Vector3).setFromMatrixColumn(this._gizmo.matrixWorld,this._handleIndex).normalize();return i.clone().multiplyScalar((this._gizmoSize+18)*t).add(this._gizmo.position).applyMatrix4(this._matViewProj)};d.prototype.render=function(){l(this._viewport&&this._viewport.getMetadata().getName()==="sap.ui.vk.threejs.Viewport","Can't render gizmo without sap.ui.vk.threejs.Viewport");if(this._nodes.length>0){var t=this._viewport.getRenderer(),e=this._viewport.getCamera().getCameraRef();this._matViewProj.multiplyMatrices(e.projectionMatrix,e.matrixWorldInverse);t.clearDepth();for(var i=0,r=this.getGizmoCount();i<r;i++){this._updateGizmoTransformation(i,e);t.render(this._sceneGizmo,e)}}this._updateEditingForm(this._nodes.length>0&&this._gizmoIndex>=0&&this._handleIndex>=0&&this._handleIndex<3,this._handleIndex)};return d});
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/tools/MoveToolHandler", ["sap/ui/base/EventProvider","sap/m/Menu","sap/m/MenuItem","../getResourceBundle","../thirdparty/three","./CoordinateSystem"],function(t,e,i,s,n,r){"use strict";var o=t.extend("sap.ui.vk.tools.MoveToolHandler",{metadata:{library:"sap.ui.vk"},constructor:function(t){this._priority=13;this._tool=t;this._gizmo=t.getGizmo();this._rect=null;this._rayCaster=new n.Raycaster;this._handleIndex=-1;this._gizmoIndex=-1;this._handleAxis=new n.Vector3;this._gizmoOrigin=new n.Vector3;this._gizmoScale=1;this._objectSpace=new n.Matrix4;this._mouse=new n.Vector2}});o.prototype._updateMouse=function(t){var e=this.getViewport().getRenderer().getSize(new n.Vector2);this._mouse.x=(t.x-this._rect.x)/e.width*2-1;this._mouse.y=(t.y-this._rect.y)/e.height*-2+1;this._rayCaster.setFromCamera(this._mouse,this.getViewport().getCamera().getCameraRef())};o.prototype._updateHandles=function(t,e){var i=this._handleIndex;this._handleIndex=-1;if(t.n===1||t.event&&t.event.type==="contextmenu"){for(var s=0,n=this._gizmo.getGizmoCount();s<n;s++){var o=this._gizmo.getTouchObject(s);var h=this._rayCaster.intersectObject(o,true);if(h.length>0){this._handleIndex=o.children.indexOf(h[0].object);if(this._handleIndex>=0){this._gizmoIndex=s;this._gizmoOrigin.setFromMatrixPosition(o.matrixWorld);this._gizmoScale=o.scale.x;this._objectSpace.extractRotation(o.matrixWorld);if(this._gizmo._coordinateSystem!==r.World){this._objectSpace.copyPosition(o.matrixWorld)}if(this._handleIndex<3){this._handleAxis.setFromMatrixColumn(o.matrixWorld,this._handleIndex).normalize()}else if(this._handleIndex<6){this._handleAxis.setFromMatrixColumn(o.matrixWorld,this._handleIndex-3).normalize()}}}}}this._gizmo.highlightHandle(this._handleIndex,e||this._handleIndex===-1);if(i!==this._handleIndex){this.getViewport().setShouldRenderFrame(true)}};o.prototype.hover=function(t){if(this._inside(t)&&!this._gesture){this._updateMouse(t);this._updateHandles(t,true);t.handled|=this._handleIndex>=0}};o.prototype.click=function(t){if(this._inside(t)&&!this._gesture){this._updateMouse(t);this._updateHandles(t,true);this._gizmo.selectHandle(this._handleIndex,this._gizmoIndex);t.handled|=this._handleIndex>=0}};var h=new n.Vector3;o.prototype._getAxisOffset=function(){var t=this._rayCaster.ray;var e=this._handleAxis.clone().cross(t.direction).cross(t.direction).normalize();h.copy(t.origin).sub(this._gizmoOrigin);return e.dot(h)/e.dot(this._handleAxis)};o.prototype._getPlaneOffset=function(){var t=this._rayCaster.ray;h.copy(this._gizmoOrigin).sub(t.origin);var e=this._handleAxis.dot(h)/this._handleAxis.dot(t.direction);return t.direction.clone().multiplyScalar(e).sub(h)};o.prototype.beginGesture=function(t){if(this._inside(t)&&!this._gesture){this._updateMouse(t);this._updateHandles(t,false);if(this._handleIndex>=0){this._gesture=true;t.handled=true;this._gizmo.selectHandle(this._handleIndex,this._gizmoIndex);this._gizmo.beginGesture();if(this._handleIndex<3){this._dragOrigin=this._getAxisOffset()}else if(this._handleIndex<6){this._dragOrigin=this._getPlaneOffset()}}}};o.prototype._setOffset=function(t){if(this._tool.getEnableStepping()){var e=Math.pow(10,Math.round(Math.log10(this._gizmoScale)))*.1;var i=(new n.Matrix4).copy(this._objectSpace).invert();var s=this._gizmoOrigin.clone().applyMatrix4(i);var r=this._gizmoOrigin.clone().add(t).applyMatrix4(i);for(var o=0;o<3;o++){var a=r.getComponent(o);if(Math.abs(a-s.getComponent(o))>e*1e-5){var d=Math.round(a/e)*e;h.setFromMatrixColumn(this._objectSpace,o).multiplyScalar(d-a);t.add(h)}}}if(isFinite(t.x)&&isFinite(t.y)&&isFinite(t.z)){this._gizmo._setOffset(t,this._gizmoIndex)}};o.prototype.move=function(t){if(this._gesture){t.handled=true;this._updateMouse(t);if(this._handleIndex<3){if(isFinite(this._dragOrigin)){this._setOffset(this._handleAxis.clone().multiplyScalar(this._getAxisOffset()-this._dragOrigin))}}else if(this._handleIndex<6){if(isFinite(this._dragOrigin.x)&&isFinite(this._dragOrigin.y)&&isFinite(this._dragOrigin.z)){this._setOffset(this._getPlaneOffset().sub(this._dragOrigin))}}}};o.prototype.endGesture=function(t){if(this._gesture){this._gesture=false;t.handled=true;this._updateMouse(t);this._gizmo.endGesture();this._dragOrigin=undefined;this._updateHandles(t,true);this.getViewport().setShouldRenderFrame()}};o.prototype.contextMenu=function(t){if(!this._tool.getAllowContextMenu()){return}if(this._inside(t)){this._updateMouse(t);this._updateHandles(t,true);if(this._handleIndex>=0){t.handled=true;var n=new e({items:[new i({text:s().getText("TOOL_COORDINATE_SYSTEM_WORLD"),key:r.World}),new i({text:s().getText("TOOL_COORDINATE_SYSTEM_LOCAL"),key:r.Local}),new i({text:s().getText("TOOL_COORDINATE_SYSTEM_PARENT"),key:r.Parent}),new i({text:s().getText("TOOL_COORDINATE_SYSTEM_SCREEN"),key:r.Screen}),new i({text:s().getText("TOOL_COORDINATE_SYSTEM_CUSTOM"),key:r.Custom})],itemSelected:function(t){var e=t.getParameters("item").item;this._tool.setCoordinateSystem(e.getKey())}.bind(this)});n.openAsContextMenu(t.event,this.getViewport())}}};o.prototype.getViewport=function(){return this._tool._viewport};o.prototype._getOffset=function(t){var e=t.getBoundingClientRect();var i={x:e.left+window.pageXOffset,y:e.top+window.pageYOffset};return i};o.prototype._inside=function(t){var e=this._tool._viewport.getIdForLabel();var i=document.getElementById(e);if(i===null){return false}var s=this._getOffset(i);this._rect={x:s.x,y:s.y,w:i.offsetWidth,h:i.offsetHeight};return t.x>=this._rect.x&&t.x<=this._rect.x+this._rect.w&&t.y>=this._rect.y&&t.y<=this._rect.y+this._rect.h};return o});
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/tools/PoiManipulationTool", ["./Tool","../thirdparty/three","./PoiToolHandler","./PoiToolGizmo","../threejs/PoiHelper","./ToolNodeSet","../NodeContentType","sap/m/Button","sap/m/library"],function(t,e,i,o,s,n,a,r,h){"use strict";const l=h.ButtonType;var p=t.extend("sap.ui.vk.tools.PoiManipulationTool",{metadata:{library:"sap.ui.vk",properties:{nodeSet:{type:"sap.ui.vk.tools.ToolNodeSet",defaultValue:n.Highlight}},aggregations:{buttons:{type:"sap.m.Button",multiple:true}},events:{editing:{parameters:{nodeRef:"any"}},removing:{parameters:{nodeRef:"any"}},moving:{parameters:{x:"float",y:"float",z:"float",nodesProperties:"any[]"}},moved:{parameters:{x:"float",y:"float",z:"float",nodesProperties:"any[]"}}}},constructor:function(n,a){t.apply(this,arguments);this._viewport=null;this._poiHelper=new s;this.setAggregation("gizmo",new o);this._handler=new i(this);this._buttonPosition=new e.Vector2;this._selectedPoi=new Set}});p.prototype.init=function(){if(t.prototype.init){t.prototype.init.call(this)}this._editButton=new r({icon:"sap-icon://edit",type:l.Neutral,press:function(t){this.fireEditing({nodeRef:this._selectedPoi.values().next().value})}.bind(this)}).addStyleClass("sapUiVizKitPoiButtonEdit");this._deleteButton=new r({icon:"sap-icon://delete",type:l.Neutral,press:function(t){this.fireRemoving({nodeRef:this._selectedPoi.values().next().value})}.bind(this)}).addStyleClass("sapUiVizKitPoiButtonDelete");this.addAggregation("buttons",this._editButton);this.addAggregation("buttons",this._deleteButton);this.setButtonsVisibility(false);this.attachMoved(function(t){var e=t.getParameter("nodesProperties");for(var i=0;i<e.length;++i){var o=e[i].node;if(this._gizmo&&this._gizmo.getIgnoreNonPoiNode()&&o._vkGetNodeContentType()!==a.Symbol){continue}this._poiHelper.adjustPoi(this._viewport,o)}});this.setFootprint(["sap.ui.vk.threejs.Viewport"])};p.prototype.getSelectedPois=function(){var t=[];if(this._viewport){var e=this._viewport._viewStateManager;e.getSymbolNodes().forEach(function(i){if(e.getSelectionState(i)){t.push(i)}})}return t};p.prototype._updateSelectedPoi=function(){if(this._viewport&&this._viewport._viewStateManager){var t=this._viewport._viewStateManager;var e=t.getSymbolNodes();this._selectedPoi.forEach(function(t){if(!e.includes(t)){this._selectedPoi.delete(t)}}.bind(this));e.forEach(function(e){if(t.getSelectionState(e)){this._selectedPoi.add(e)}else{this._selectedPoi.delete(e)}}.bind(this))}return this};p.prototype._updateButtonPosition=function(t){var i=this._poiHelper.getPoiRect(this._viewport,t);if(i){var o=new e.Box3;o.expandByObject(t);var s=new e.Vector3;o.getCenter(s);var n=this._viewport.projectToScreen(s.x,s.y,s.z,this._viewport.getCamera());var a=n.x+i.width/2;var r=n.y-i.height/2;this._buttonPosition.set(a,r);return true}return false};p.prototype.handlePoiSelectionChange=function(){this._updateSelectedPoi()};p.prototype.setActive=function(e,i){t.prototype.setActive.call(this,e,i);if(this._viewport){this.updateButtons();if(e){this._gizmo=this.getGizmo();this._gizmo.show(this._viewport,this);this._gizmo.rerender();this._addLocoHandler();this._viewport._viewStateManager.attachSelectionChanged(this.handlePoiSelectionChange,this)}else{this._removeLocoHandler();if(this._viewport._viewStateManager){this._viewport._viewStateManager.detachSelectionChanged(this.handlePoiSelectionChange,this)}if(this._gizmo){this._gizmo.hide();this._gizmo=null}}}return this};p.prototype.updateButtons=function(){this._updateSelectedPoi();var t=this.getButtons();var e;t.forEach(function(t){if(t.getVisible()){t.rerender();if(t.getDomRef()){e=t.getDomRef().parentElement}}});if(e){if(this._selectedPoi.size&&this._updateButtonPosition(this._selectedPoi.values().next().value)){e.style.display="block";e.style.left=this._buttonPosition.x+"px";e.style.top=this._buttonPosition.y+"px"}else{e.style.display="none"}}};p.prototype.setButtonsVisibility=function(t){this.getButtons().forEach(function(e){if(e.getVisible()!==t){e.setVisible(t)}})};p.prototype.addButtons=function(t){if(!Array.isArray(t)){t=[t]}t.forEach(function(t){this.addAggregation("buttons",t)},this)};return p});
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/tools/PoiToolGizmo", ["../thirdparty/three","./Gizmo","./PoiToolGizmoRenderer","./GizmoPlacementMode","../NodeContentType","sap/base/assert","../TransformationMatrix"],function(t,e,o,i,r,n,s){"use strict";var a=e.extend("sap.ui.vk.tools.PoiToolGizmo",{metadata:{library:"sap.ui.vk"}});a.prototype.init=function(){if(e.prototype.init){e.prototype.init.apply(this)}this._viewport=null;this._tool=null;this._placementMode=i.ObjectCenter;this._nodes=[];this._poiIndex=-1;this._moveDelta=new t.Vector3;this._ignoreNonPoiNode=false};a.prototype.hasDomElement=function(){return true};a.prototype.setIgnoreNonPoiNode=function(t){this._ignoreNonPoiNode=t};a.prototype.getIgnoreNonPoiNode=function(){return this._ignoreNonPoiNode};a.prototype.show=function(t,e){this._viewport=t;this._tool=e;this._nodes.length=0;this._updateSelection(t._viewStateManager);var o=this._getNodesProperties();this._tool.fireEvent("moving",{x:0,y:0,z:0,nodesProperties:o},true)};a.prototype.hide=function(){this._cleanTempData();this._viewport=null;this._tool=null;this._poiIndex=-1};a.prototype.getPOICount=function(){return this._nodes.length};a.prototype.getPOI=function(t){return t<this._nodes.length?this._nodes[t].node:null};a.prototype.selectPOI=function(t){this._poiIndex=t;this._viewport.setShouldRenderFrame()};a.prototype.beginGesture=function(){this._moveDelta.setScalar(0);this._nodes.forEach(function(e){var o=e.node;if(this._ignoreNonPoiNode&&o._vkGetNodeContentType()!==r.Symbol){return}e.origin=(new t.Vector3).setFromMatrixPosition(o.matrixWorld);e.matParentInv=new t.Matrix4;if(o.parent){e.matParentInv.copy(o.parent.matrixWorld).invert()}},this)};a.prototype._getNodesProperties=function(){var t=[];this._nodes.forEach(function(e){t.push({node:e.node})});return t};a.prototype.endGesture=function(){if(this._moveDelta.x||this._moveDelta.y||this._moveDelta.z){this._tool.fireMoved({x:this._moveDelta.x,y:this._moveDelta.y,z:this._moveDelta.z,nodesProperties:this._getNodesProperties()})}};a.prototype._setOffset=function(t){if(this._tool.fireEvent("moving",{x:t.x,y:t.y,z:t.z,nodesProperties:this._getNodesProperties()},true)){this._move(t)}};a.prototype._move=function(e){this._moveDelta.copy(e);var o=this._viewport._isPanoramicActivated();var i=(new t.Vector3).setFromMatrixPosition(this._viewport.getCamera().getCameraRef().matrixWorld);this._nodes.forEach(function(n){var s=n.node;if(this._ignoreNonPoiNode&&s._vkGetNodeContentType()!==r.Symbol){return}if(!n.origin){n.origin=(new t.Vector3).setFromMatrixPosition(s.matrixWorld)}var a=n.origin.clone();if(o){var p=a.distanceTo(i);a.add(e).sub(i).setLength(p).add(i)}else{a.add(e)}s.matrixWorld.setPosition(a);s.matrix.multiplyMatrices(n.matParentInv,s.matrixWorld);s.position.setFromMatrixPosition(s.matrix);s.matrixWorldNeedsUpdate=true;this._updatePoiNodeTransform(s)},this);this._viewport.setShouldRenderFrame()};a.prototype.move=function(e,o,i){this.beginGesture();this._move(new t.Vector3(e,o,i||0))};a.prototype.handleSelectionChanged=function(t){if(this._viewport){this._updateSelection(this._viewport._viewStateManager);var e=this._getNodesProperties();this._tool.fireEvent("moving",{x:0,y:0,z:0,nodesProperties:e},true);this._poiIndex=-1}};a.prototype._updatePoiButtons=function(){this._tool.updateButtons()};a.prototype.render=function(){n(this._viewport&&this._viewport.getMetadata().getName()==="sap.ui.vk.threejs.Viewport","Can't render gizmo without sap.ui.vk.threejs.Viewport");this._updatePoiButtons()};a.prototype._updatePoiNodeTransform=function(e){if(e&&e.userData.treeNode){var o=null;var i=this._viewport.getScene().getSceneBuilder();if(i){var r=i.getReferenceNodeFromMarkerNodeId(e.userData.nodeId);o=r?(new t.Matrix4).copy(r.matrixWorld).invert():new t.Matrix4;var n=e.matrix.clone();n.premultiply(o);e.userData.treeNode.transform=s.convertTo4x3(n.elements)}}};return a});
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/tools/PoiToolGizmoRenderer", [],function(){"use strict";var t={apiVersion:2};t.render=function(t,n){t.openStart("div",n);t.openEnd();var e=n._tool;var o=e&&e.getButtons&&e.getButtons();if(o&&o.length){t.openStart("div");t.class("sapUiVizKitPoiButtonsContainer");t.openEnd();for(var r=0;r<o.length;++r){t.renderControl(o[r])}t.close("div")}t.close("div")};return t},true);
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/tools/PoiToolHandler", ["sap/ui/base/EventProvider","../thirdparty/three"],function(t,e){"use strict";var i=t.extend("sap.ui.vk.tools.PoiToolHandler",{metadata:{library:"sap.ui.vk"},constructor:function(t){this._priority=30;this._tool=t;this._gizmo=t.getGizmo();this._rect=null;this._poiIndex=-1;this._mouse=new e.Vector2}});i.prototype._updateMouse=function(t){var i=this.getViewport().getRenderer().getSize(new e.Vector2);this._mouse.x=(t.x-this._rect.x)/i.width*2-1;this._mouse.y=(t.y-this._rect.y)/i.height*-2+1};i.prototype._updateActivePOI=function(t){this._poiIndex=-1;if(t.n===1||t.event&&t.event.type==="contextmenu"){var i=this._tool._viewport.getDomRef().getBoundingClientRect();var s=this._tool._viewport.hitTest(t.x-i.left,t.y-i.top);if(s&&s.object){this._poiZ=(new e.Vector3).setFromMatrixPosition(s.object.matrixWorld).project(this.getViewport().getCamera().getCameraRef()).z;for(var o=0,r=this._gizmo.getPOICount();o<r;o++){if(this._gizmo.getPOI(o)===s.object){this._poiIndex=o;break}}}}};i.prototype._getDragPosition=function(){return new e.Vector3(this._mouse.x,this._mouse.y,this._poiZ).unproject(this.getViewport().getCamera().getCameraRef())};i.prototype.click=function(t){if(this._inside(t)&&!this._gesture){this._updateMouse(t);this._updateActivePOI(t,true);this._gizmo.selectPOI(this._poiIndex);t.handled|=this._poiIndex>=0}};i.prototype.beginGesture=function(t){if(this._inside(t)&&!this._gesture){this._updateMouse(t);this._updateActivePOI(t);if(this._poiIndex>=0){this._gesture=true;t.handled=true;this._gizmo.selectPOI(this._poiIndex);this._gizmo.beginGesture();this._dragOrigin=this._getDragPosition()}}};i.prototype._setOffset=function(t){if(isFinite(t.x)&&isFinite(t.y)&&isFinite(t.z)){this._gizmo._setOffset(t,this._poiIndex)}};i.prototype.move=function(t){if(this._gesture){t.handled=true;this._updateMouse(t);if(isFinite(this._dragOrigin.x)&&isFinite(this._dragOrigin.y)&&isFinite(this._dragOrigin.z)){this._setOffset(this._getDragPosition().sub(this._dragOrigin))}}};i.prototype.endGesture=function(t){if(this._gesture){this._gesture=false;t.handled=true;this._updateMouse(t);this._gizmo.endGesture();this._dragOrigin=undefined;this._updateActivePOI(t);this.getViewport().setShouldRenderFrame()}};i.prototype.getViewport=function(){return this._tool._viewport};i.prototype._getOffset=function(t){var e=t.getBoundingClientRect();var i={x:e.left+window.pageXOffset,y:e.top+window.pageYOffset};return i};i.prototype._inside=function(t){var e=this._tool._viewport.getIdForLabel();var i=document.getElementById(e);if(i===null){return false}var s=this._getOffset(i);this._rect={x:s.x,y:s.y,w:i.offsetWidth,h:i.offsetHeight};return t.x>=this._rect.x&&t.x<=this._rect.x+this._rect.w&&t.y>=this._rect.y&&t.y<=this._rect.y+this._rect.h};return i});
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/tools/PointCloudSelectionTool", ["./Tool","./PointCloudSelectionToolHandler","./PointCloudSelectionToolGizmo"],function(t,o,e){"use strict";const i=t.extend("sap.ui.vk.tools.PointCloudSelectionTool",{metadata:{library:"sap.ui.vk",properties:{selectionColor:{type:"float[]",defaultValue:[0,1,0,1]}},events:{groupAdded:{group:"sap.ui.vk.threejs.PointCloudGroup"},groupRemoved:{group:"sap.ui.vk.threejs.PointCloudGroup"},currentGroupChanged:{group:"sap.ui.vk.threejs.PointCloudGroup"}}},constructor:function(e,i){t.apply(this,arguments);this._viewport=null;this._handler=new o(this);this._gizmo=null}});i.prototype.init=function(){if(t.prototype.init){t.prototype.init.call(this)}this.setFootprint(["sap.ui.vk.threejs.Viewport"]);this.setAggregation("gizmo",new e)};i.prototype.setActive=function(o,e,i){t.prototype.setActive.call(this,o,e,i);if(this._viewport){if(o){this._gizmo=this.getGizmo();this._gizmo.show(this._viewport,this);this._addLocoHandler()}else{this._removeLocoHandler();if(this._gizmo){this._gizmo.hide();this._gizmo=null}}}return this};i.prototype.getGroups=function(){return this.getGizmo()._groups};i.prototype.addGroup=function(t){return this.getGizmo().addGroup(t)};i.prototype.removeGroup=function(t){return this.getGizmo().removeGroup(t)};i.prototype.clearGroups=function(){this.getGizmo().clearGroups()};i.prototype.getCurrentGroup=function(){return this.getGizmo().getCurrentGroup()};i.prototype.previousGroup=function(){return this.getGizmo()._previousGroup()};i.prototype.nextGroup=function(){return this.getGizmo()._nextGroup()};i.prototype.changeCurrentGroupType=function(t){this.getGizmo()._changeCurrentGroupType(t)};i.prototype.isCurrentGroupAdditive=function(){return this.getGizmo()._isCurrentGroupAdditive()};i.prototype.queueCommand=function(t){if(this._addLocoHandler()){if(this.isViewportType("sap.ui.vk.threejs.Viewport")){t()}}return this};return i});
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/tools/PointCloudSelectionToolGizmo", ["sap/ui/events/KeyCodes","../thirdparty/three","../thirdparty/BufferGeometryUtils","../threejs/PolylineMesh","../threejs/PolylineGeometry","../threejs/PolylineMaterial","../threejs/PointCloudGroup","./Gizmo","./AxisColours","sap/base/assert"],function(t,e,o,i,r,n,s,a,u,p){"use strict";const l=a.extend("sap.ui.vk.tools.PointCloudSelectionToolGizmo",{metadata:{library:"sap.ui.vk"},renderer:{apiVersion:2,render:function(t,e){t.openStart("div",e);t.class("sapUiVkTransformationToolEdit");t.openEnd();t.close("div")}}});const c=96;const h=["x","y","z"];l.prototype.init=function(){a.prototype.init?.apply(this);this._currentGroupIndex=-1;this._viewport=null;this._tool=null;this._sceneGizmo=new e.Scene;const t=new e.DirectionalLight(16777215,.5*Math.PI);t.position.set(1,3,2);this._sceneGizmo.add(t);this._sceneGizmo.add(new e.AmbientLight(16777215,.5*Math.PI));const s=this._touchAreas=new e.Group;const p=this._gizmo=new e.Group;this._sceneGizmo.add(p);this._matViewProj=new e.Matrix4;this._groups=[];const l=new e.MeshBasicMaterial({opacity:.2,transparent:true,side:e.DoubleSide});function c(t){s.add(new e.Mesh(t,l))}function d(t,i){const r=96,n=1,s=0,a=48;t.multiplyScalar(1/r);const u=new e.CylinderGeometry(n,n,r-s,4);const l=(new e.Matrix4).makeBasis(new e.Vector3(t.y,t.z,t.x),t,new e.Vector3(t.z,t.x,t.y));l.setPosition(t.clone().multiplyScalar((r-s)*.5));u.applyMatrix4(l);const h=new e.MeshLambertMaterial({color:i,transparent:true});const d=new e.Mesh(u,h);d.matrixAutoUpdate=false;p.add(d);const _=new e.CylinderGeometry(a*.45,a*.45,a,12,1);_.applyMatrix4(l);const f=new e.CylinderGeometry(a*.45,a*.2,a,12,1);l.setPosition(t.clone().multiplyScalar(r*.5));f.applyMatrix4(l);const m=o.mergeGeometries([_,f]);c(m)}function _(t,o){const i=new Float32Array(9);i[t]=i[o+6]=1;i[t+3]=i[o+3]=.5;const r=new e.BufferGeometry;const n=new Float32Array(12);n[3+t]=n[6+o]=n[9+t]=n[9+o]=.333;r.setAttribute("position",new e.Float32BufferAttribute(n,3));r.setIndex([0,2,1,1,2,3]);const s=new e.MeshBasicMaterial({color:16776960,opacity:.5,transparent:true,visible:false,side:e.DoubleSide});const a=new e.Mesh(r,s);a.matrixAutoUpdate=false;a.userData.colors=i;const u=new e.BufferGeometry;const l=new Float32Array(9);l[t]=l[t+3]=l[o+3]=l[o+6]=.333;u.setAttribute("position",new e.Float32BufferAttribute(l,3));u.setAttribute("color",new e.Float32BufferAttribute(i,3));const h=new e.Line(u,new e.LineBasicMaterial({vertexColors:true,transparent:true,linewidth:window.devicePixelRatio}));h.matrixAutoUpdate=false;a.add(h);p.add(a);c(r)}function f(t,o,i){const r=new e.TorusGeometry(1,t,4,o,Math.PI/2);if(i===0){r.rotateY(Math.PI/-2)}else if(i===1){r.rotateX(Math.PI/2)}return r}function m(t,o,i){const r=f(1/96,i,t);const n=new e.Mesh(r,new e.MeshBasicMaterial({color:o,transparent:true}));n.matrixAutoUpdate=false;p.add(n)}d(new e.Vector3(1,0,0),u.x);d(new e.Vector3(0,1,0),u.y);d(new e.Vector3(0,0,1),u.z);_(1,2);_(2,0);_(0,1);for(let t=0;t<3;t++){m(t,u[h[t]],32);c(f(16/96,4,t))}for(let t=0;t<6;t++){const o=t>>1;const i=new e.ConeGeometry(.125,.25,16);i.translate(0,.125,0);if(o===0){i.rotateZ(Math.PI/(t&1?-2:2))}else if(o===2){i.rotateX(Math.PI/(t&1?2:-2))}else if(t===2){i.rotateX(Math.PI)}const r=new e.Mesh(i,new e.MeshLambertMaterial({color:u[h[o]],transparent:true}));p.add(r);const n=new e.CylinderGeometry(.25,.25,.5,12,1);if(o===0){n.rotateZ(Math.PI/2)}else if(o===2){n.rotateX(Math.PI/-2)}c(n)}p.children.forEach(function(t){t.userData.color=t.material.color.toJSON()});const y={color:16777215,linewidth:2,dashCapStyle:0,dashPattern:[5,5],segmentCapStyle:1,trimStyle:0,transparent:true};this._polylineMaterial1=new n(Object.assign({lineColor:13421568,dashOffset:5},y));this._polylineMaterial2=new n(Object.assign({lineColor:16776960,dashOffset:0},y));const g=.5;const w=new r;w.setVertices([new e.Vector3(-g,-g,-g),new e.Vector3(g,-g,-g),new e.Vector3(-g,g,-g),new e.Vector3(g,g,-g),new e.Vector3(-g,-g,g),new e.Vector3(g,-g,g),new e.Vector3(-g,g,g),new e.Vector3(g,g,g)],[0,1,2,3,4,5,6,7,0,2,1,3,4,6,5,7,0,4,1,5,2,6,3,7]);this._boxMesh=new e.Scene;this._boxMesh.add(new i(w,this._polylineMaterial1));this._boxMesh.add(new i(w.clone(),this._polylineMaterial2))};l.prototype.hasDomElement=function(){return true};l.prototype.show=function(t,e){this._viewport=t;this._tool=e;this._updatePointCloudGroups()};l.prototype.hide=function(){this._updatePointCloudGroups([]);this._viewport=null;this._tool=null};const d=new e.Vector2;const _=new e.Matrix4;const f=new e.Matrix4;l.prototype.addGroup=function(t){this._currentGroupIndex=this._groups.length;t??={};t.color=this._tool?.getSelectionColor()?.slice()||[0,1,0,1];let o=100;if(this._viewport){const i=this._viewport.getCamera().getCameraRef();if(t.position instanceof e.Vector3){o=(i.isPerspectiveCamera?-t.position.clone().applyMatrix4(i.matrixWorldInverse).z:1)/i.projectionMatrix.elements[5]}else{this._viewport.getRenderer().getSize(d);const r=this._viewport.hitTest(d.x>>1,d.y>>1);if(r){o=r.distance;t.position??=r.point}else{o=(i.near+i.far)*.5;t.position??=(new e.Vector3).setFromMatrixColumn(i.matrixWorld,2).multiplyScalar(-o).add(i.position)}o=(i.isPerspectiveCamera?o:1)/i.projectionMatrix.elements[5]}}t.size??=o*.5;const i=new s(t);this._groups.push(i);this._updatePointCloudGroups();this._tool?.fireGroupAdded({group:i});this._tool?.fireCurrentGroupChanged({group:i});return i};l.prototype.removeGroup=function(t){if(t==null){t=this._groups.pop()}else{const e=typeof t==="number"?t:this._groups.indexOf(t);if(e>=0){t=this._groups.splice(e,1)[0]}else{t=null}}if(t){this._currentGroupIndex=Math.min(this._currentGroupIndex,this._groups.length-1);this._updatePointCloudGroups();this._tool?.fireGroupRemoved({group:t});this._tool?.fireCurrentGroupChanged({group:this.getCurrentGroup()})}return t};l.prototype.clearGroups=function(t){this._groups.length=0;this._currentGroupIndex=-1;this._updatePointCloudGroups()};l.prototype.getGizmoCount=function(){return this.getCurrentGroup()!=null?1:0};l.prototype._updateGizmoObjectTransformation=function(t,e){const o=this._groups[e];t.position.copy(o._position);t.quaternion.copy(o._quaternion);const i=this._getGizmoScale(t.position);t.scale.setScalar(c*i);t.updateMatrixWorld(true);for(let e=0;e<3;e++){const i=o._size.getComponent(e)*.5/t.scale.x;t.children[9+e*2].position.setComponent(e,-i);t.children[9+e*2].updateMatrixWorld(true);t.children[10+e*2].position.setComponent(e,i);t.children[10+e*2].updateMatrixWorld(true)}return i};l.prototype._updateGizmoTransformation=function(t){const e=this._updateGizmoObjectTransformation(this._gizmo,t);this._gizmo.scale.setScalar(c*e);this._gizmo.updateMatrixWorld(true)};l.prototype.getTouchObject=function(t){this._updateGizmoObjectTransformation(this._touchAreas,this._currentGroupIndex);return this._touchAreas};l.prototype.highlightHandle=function(t,e){if(this._handleIndex===t&&this._hoverMode===e){return}this._handleIndex=t;this._hoverMode=e;const o=16776960;const i=.35;const r=[1,2,4,6,5,3,1,2,4];for(let n=0;n<3;n++){const s=this._gizmo.children[n];s.visible=t<9||e;s.material.color.setHex(r[t]&1<<n?o:s.userData.color);s.material.opacity=t<9?1:i}for(let o=3;o<6;o++){const r=this._gizmo.children[o];r.material.visible=o===t;const n=r.children[0].geometry.attributes.color;n.copyArray(o===t?[1,1,0,1,1,0,1,1,0]:r.userData.colors);n.needsUpdate=true;r.children[0].visible=o===t||e;r.children[0].material.opacity=o===t||e&&t===-1?1:i}for(let r=6;r<9;r++){const n=this._gizmo.children[r];n.visible=r===t||e;n.material.color.setHex(r===t?o:n.userData.color);n.material.opacity=r===t||e&&t===-1?1:i}for(let r=9;r<15;r++){const n=this._gizmo.children[r];n.visible=r===t||e;n.material.color.setHex(r===t?o:n.userData.color);n.material.opacity=r===t||e&&t===-1?1:i}this._viewport?.setShouldRenderFrame()};l.prototype.beginGesture=function(){const t=this.getCurrentGroup();if(t){this._originPosition=t._position.clone();this._originSize=t._size.clone();this._originQuaternion=t._quaternion.clone()}};l.prototype.endGesture=function(){};l.prototype._setGroupPosition=function(t,e){const o=this.getCurrentGroup();if(o){if(e){o._position.x=t.x;o._position.z=t.z}else{o._position.copy(t)}this._updatePointCloudGroups()}};l.prototype._setOffset=function(t){const e=this.getCurrentGroup();if(e){e?._position.copy(this._originPosition).add(t);this._updatePointCloudGroups()}};l.prototype._setSize=function(t,e,o,i,r){const n=this.getCurrentGroup();if(n){const s=t>>1;let a=this._originSize.getComponent(s)+e;this.highlightHandle(9+(a>=0?t:(t&~1)+1-(t&1)),false);a=Math.abs(a);n._size.copy(this._originSize);if(r){const t=a/this._originSize.getComponent(s);if(s!==1){n._size.x*=t;n._size.z*=t}else{n._size.y*=t}}else if(i){n._size.multiplyScalar(a/this._originSize.getComponent(s))}else{n._size.setComponent(s,a);n._position.copy(o).multiplyScalar(e*.5).add(this._originPosition)}this._updatePointCloudGroups()}};l.prototype._setRotationAxisAngle=function(t,o){const i=this.getCurrentGroup();if(i){const r=new e.Euler;r[h[t]]=o;i._quaternion.setFromEuler(r).premultiply(this._originQuaternion);this._updatePointCloudGroups()}};l.prototype._updatePointCloudGroups=function(t){const e=this._viewport?.getScene()?.getSceneRef()?.userData;if(e){t??=this._groups;e.pointCloudGroupMatrices=t.map(function(t){return t.getMatrix().invert().transpose()});e.pointCloudGroupColors=t.map(function(t){return t.getColor()});this._viewport?.setShouldRenderFrame()}};l.prototype.expandBoundingBox=function(t){if(this._viewport){this._expandBoundingBox(t,this._viewport.getCamera().getCameraRef(),true)}};l.prototype.getCurrentGroup=function(){return this._currentGroupIndex>=0&&this._currentGroupIndex<this._groups.length?this._groups[this._currentGroupIndex]:null};l.prototype._previousGroup=function(){if(this._currentGroupIndex>0){this._currentGroupIndex--}this._viewport?.setShouldRenderFrame();this._tool?.fireCurrentGroupChanged({group:this.getCurrentGroup()})};l.prototype._nextGroup=function(){if(this._currentGroupIndex<this._groups.length){this._currentGroupIndex++}this._viewport?.setShouldRenderFrame();this._tool?.fireCurrentGroupChanged({group:this.getCurrentGroup()})};l.prototype._isCurrentGroupAdditive=function(){const t=this.getCurrentGroup();if(t){return t._color.w>0?true:false}return undefined};l.prototype._changeCurrentGroupType=function(t){const e=this.getCurrentGroup();if(e){e._color.w=t?this._tool?.getSelectionColor()[3]||1:0;this._updatePointCloudGroups();this._tool?.fireCurrentGroupChanged({group:e})}};l.prototype.render=function(){p(this._viewport&&this._viewport.getMetadata().getName()==="sap.ui.vk.threejs.Viewport","Can't render gizmo without sap.ui.vk.threejs.Viewport");const t=this._viewport.getRenderer();const o=this._viewport.getCamera().getCameraRef();t.clearDepth();t.getSize(d);this._polylineMaterial1.resolution.copy(d);this._polylineMaterial2.resolution.copy(d);_.multiplyMatrices(o.projectionMatrix,o.matrixWorldInverse);const i=o instanceof e.PerspectiveCamera?o.near:undefined;this._groups.forEach((e,r)=>{this._boxMesh.position.copy(e._position);this._boxMesh.quaternion.copy(e._quaternion);this._boxMesh.scale.copy(e._size);this._boxMesh.updateMatrixWorld(true);f.multiplyMatrices(_,this._boxMesh.matrixWorld);this._boxMesh.children.forEach(function(t){t.computeLineDistances(f,d,i)});this._polylineMaterial1.opacity=this._polylineMaterial2.opacity=r===this._currentGroupIndex?1:.15;t.render(this._boxMesh,o)});if(this.getCurrentGroup()){this._updateGizmoTransformation(this._currentGroupIndex);t.render(this._sceneGizmo,o)}};return l});
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/tools/PointCloudSelectionToolHandler", ["sap/ui/base/EventProvider","../thirdparty/three"],function(t,i){"use strict";const e=t.extend("sap.ui.vk.tools.PointCloudSelectionToolHandler",{metadata:{library:"sap.ui.vk"},constructor:function(t){this._priority=10;this._tool=t;this._gizmo=t.getGizmo();this._rect=null;this._rayCaster=new i.Raycaster;this._handleIndex=-1;this._handleAxis=new i.Vector3;this._gizmoOrigin=new i.Vector3;this._gizmoScale=1;this._matrixOrigin=new i.Matrix4;this._rotationOrigin=new i.Matrix4;this._mouse=new i.Vector2;this._mouseOrigin=new i.Vector2}});e.prototype._updateMouse=function(t){const e=this.getViewport();const s=e.getRenderer().getSize(new i.Vector2);this._mouse.x=(t.x-this._rect.x)/s.width*2-1;this._mouse.y=(t.y-this._rect.y)/s.height*-2+1;this._rayCaster.setFromCamera(this._mouse,e.getCamera().getCameraRef())};e.prototype._updateHandles=function(t,i){this._handleIndex=-1;if(t.n===1||t.event&&t.event.type==="contextmenu"){for(let t=0,i=this._gizmo.getGizmoCount();t<i;t++){const i=this._gizmo.getTouchObject(t);const e=this._rayCaster.intersectObject(i,true);if(e.length>0){this._handleIndex=i.children.indexOf(e[0].object);if(this._handleIndex>=0){this._gizmoOrigin.setFromMatrixPosition(i.matrixWorld);this._matrixOrigin.copy(i.matrixWorld);this._gizmoScale=i.scale.x;this._rotationOrigin.extractRotation(i.matrixWorld);if(this._handleIndex<3){this._handleAxis.setFromMatrixColumn(i.matrixWorld,this._handleIndex).normalize()}else if(this._handleIndex<6){this._handleAxis.setFromMatrixColumn(i.matrixWorld,this._handleIndex-3).normalize()}else if(this._handleIndex<9){this._handleAxis.setFromMatrixColumn(i.matrixWorld,this._handleIndex-6).normalize()}else if(this._handleIndex<15){this._handleAxis.setFromMatrixColumn(i.matrixWorld,this._handleIndex-9>>1).normalize();if(this._handleIndex&1){this._handleAxis.multiplyScalar(-1)}}}}}}this._gizmo.highlightHandle(this._handleIndex,i||this._handleIndex===-1)};e.prototype.hover=function(t){if(this._inside(t)&&!this._gesture){this._updateMouse(t);this._updateHandles(t,true);t.handled|=this._handleIndex>=0}};e.prototype.click=function(t){if(this._inside(t)&&!this._gesture){this._updateMouse(t);this._updateHandles(t,true);const i=this.getViewport().hitTest(t.x-this._rect.x,t.y-this._rect.y);if(i){if(this._gizmo.getCurrentGroup()){this._gizmo._setGroupPosition(i.point,t.event.shiftKey)}else{this._gizmo.addGroup({position:i.point})}}t.handled=true}};const s=new i.Vector3;e.prototype._getAxisOffset=function(){const t=this._rayCaster.ray;const i=this._handleAxis.clone().cross(t.direction).cross(t.direction).normalize();s.copy(t.origin).sub(this._gizmoOrigin);return i.dot(s)/i.dot(this._handleAxis)};e.prototype._getPlaneOffset=function(){const t=this._rayCaster.ray;s.copy(this._gizmoOrigin).sub(t.origin);const i=this._handleAxis.dot(s)/this._handleAxis.dot(t.direction);return t.direction.clone().multiplyScalar(i).sub(s)};e.prototype._getMouseAngle=function(){const t=this._rayCaster.ray;const i=this._rotationPoint.clone().sub(t.origin);const e=this._rotationAxis.dot(i)/this._rotationAxis.dot(t.direction);const s=t.direction.clone().multiplyScalar(e).sub(i).normalize();return Math.atan2(s.dot(this._axis2),s.dot(this._axis1))};e.prototype.beginGesture=function(t){if(this._inside(t)&&!this._gesture){this._updateMouse(t);this._updateHandles(t,false);if(this._handleIndex>=0){t.handled=true;this._gesture=true;this._mouseOrigin.copy(t);this._gizmo.beginGesture();if(this._handleIndex<3||this._handleIndex>=9&&this._handleIndex<15){this._dragOrigin=this._getAxisOffset()}else if(this._handleIndex<6){this._dragOrigin=this._getPlaneOffset()}else if(this._handleIndex<9){this._axis1=(new i.Vector3).setFromMatrixColumn(this._matrixOrigin,(this._handleIndex+1)%3).normalize();this._axis2=(new i.Vector3).setFromMatrixColumn(this._matrixOrigin,(this._handleIndex+2)%3).normalize();this._rotationAxis=(new i.Vector3).crossVectors(this._axis1,this._axis2).normalize();this._rotationPoint=(new i.Vector3).setFromMatrixPosition(this._matrixOrigin);if(Math.abs(this._rayCaster.ray.direction.dot(this._rotationAxis))<Math.cos(Math.PI*85/180)){const t=this.getViewport().getCamera().getCameraRef().matrixWorld;this._axis1.setFromMatrixColumn(t,0).normalize();this._axis2.setFromMatrixColumn(t,1).normalize();this._rotationAxis.setFromMatrixColumn(t,2).normalize()}this._startAngle=this._getMouseAngle()}}}};e.prototype.move=function(t){if(this._gesture){t.handled=true;this._updateMouse(t);if(this._handleIndex<3){if(isFinite(this._dragOrigin)){this._gizmo._setOffset(this._handleAxis.clone().multiplyScalar(this._getAxisOffset()-this._dragOrigin))}}else if(this._handleIndex<6){if(isFinite(this._dragOrigin.x)&&isFinite(this._dragOrigin.y)&&isFinite(this._dragOrigin.z)){this._gizmo._setOffset(this._getPlaneOffset().sub(this._dragOrigin))}}else if(this._handleIndex<9){const t=this._getMouseAngle()-this._startAngle;if(isFinite(t)){this._gizmo._setRotationAxisAngle(this._handleIndex-6,t)}}else if(this._handleIndex<15){if(isFinite(this._dragOrigin)){this._gizmo._setSize(this._handleIndex-9,this._getAxisOffset()-this._dragOrigin,this._handleAxis,sap.ui.Device.os.macintosh?t.event.metaKey:t.event.ctrlKey,t.event.shiftKey)}}}};e.prototype.endGesture=function(t){if(this._gesture){this._gesture=false;t.handled=true;this._updateMouse(t);this._gizmo.endGesture();this._dragOrigin=undefined;this._updateHandles(t,true)}};e.prototype.getViewport=function(){return this._tool._viewport};e.prototype._getOffset=function(t){const i=t.getBoundingClientRect();return{x:i.left+window.scrollX,y:i.top+window.scrollY}};e.prototype._inside=function(t){const i=this._tool._viewport.getIdForLabel();const e=document.getElementById(i);if(e==null){return false}const s=this._getOffset(e);this._rect={x:s.x,y:s.y,w:e.offsetWidth,h:e.offsetHeight};return t.x>=this._rect.x&&t.x<=this._rect.x+this._rect.w&&t.y>=this._rect.y&&t.y<=this._rect.y+this._rect.h};return e});
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/tools/PredefinedView", ["sap/ui/base/DataType"],function(t){"use strict";var e={Initial:"Initial",Front:"Front",Back:"Back",Left:"Left",Right:"Right",Top:"Top",Bottom:"Bottom"};t.registerEnum("sap.ui.vk.tools.PredefinedView",e);return e},true);
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/tools/RectSelectTool", ["./Tool","./RectSelectToolHandler","../SelectionDisplayMode","../Loco","../thirdparty/three"],function(e,t,i,r,a){"use strict";var s=e.extend("sap.ui.vk.tools.RectSelectTool",{metadata:{library:"sap.ui.vk",properties:{subtractMode:{type:"boolean",defaultValue:false}}},constructor:function(i,r){if(s._instance){return s._instance}e.apply(this,arguments);this._viewport=null;this._handler=new t(this);this._loco=null;s._instance=this;return this}});s.prototype.init=function(){if(e.prototype.init){e.prototype.init.call(this)}this.setFootprint(["sap.ui.vk.dvl.Viewport","sap.ui.vk.threejs.Viewport","sap.ui.vk.svg.Viewport"])};s.prototype.setActive=function(t,i,r){e.prototype.setActive.call(this,t,i,r);if(this._viewport){if(t){if(this._prepare()){this._handler.activate(this._viewport)}}else{this._handler.deactivate()}}return this};s.prototype._prepare=function(){if(this.isViewportType("sap.ui.vk.dvl.Viewport")&&this._viewport._dvl){return true}else if(this.isViewportType("sap.ui.vk.threejs.Viewport")&&this._viewport._scene&&this._viewport._scene.getSceneRef()){return true}else if(this.isViewportType("sap.ui.vk.svg.Viewport")&&this._viewport._scene){return true}else{return false}};s.prototype.queueCommand=function(e){if(this._prepare()){if(this.isViewportType("sap.ui.vk.threejs.Viewport")||this.isViewportType("sap.ui.vk.svg.Viewport")){e()}}return this};function n(e,t,i){var r=e.elements;var s=r[15]===1;var n=2/r[0];var o=2/r[5];var l,p;if(s){l=-r[12]*n;p=-r[13]*o}else{l=r[8]*n;p=r[9]*o}var u=(n+l)*.5;var c=l-u;var v=(o+p)*.5;var f=p-v;var h=a.MathUtils.lerp(c,u,Math.min(t.x1,t.x2)/i.width);var d=a.MathUtils.lerp(c,u,Math.max(t.x1,t.x2)/i.width);var g=a.MathUtils.lerp(v,f,Math.min(t.y1,t.y2)/i.height);var S=a.MathUtils.lerp(v,f,Math.max(t.y1,t.y2)/i.height);r[0]=2/(d-h);r[5]=2/(g-S);if(s){r[12]=-(d+h)/(d-h);r[13]=-(g+S)/(g-S)}else{r[8]=(d+h)/(d-h);r[9]=(g+S)/(g-S)}}s.prototype.select=function(e,t,i,r,a,s){if(!this._prepare()){return[]}return this._select(e,t,i,r,this._viewport,a,s)};s.prototype._select=function(e,t,r,s,o,l,p){var u=[];var c=o.getMetadata().getName();if(c==="sap.ui.vk.svg.Viewport"){if(e===r||t===s){return u}u=o._select({x1:e,y1:t,x2:r,y2:s});if(u.length>0){o.fireNodesPicked({picked:u});if(o.getSelectionDisplayMode()===i.Outline){if(this.getSubtractMode()){o._viewStateManager.setOutliningStates([],u)}else{o._viewStateManager.setOutliningStates(u,[])}}else if(this.getSubtractMode()){o._viewStateManager.setSelectionStates([],u)}else{o._viewStateManager.setSelectionStates(u,[])}}return u}if(c==="sap.ui.vk.dvl.Viewport"){u=o.rectSelect(e,t,r,s);if(u.length>0){var v={picked:u};o.fireNodesPicked(v);if(o.getSelectionDisplayMode()===i.Outline){if(this.getSubtractMode()){o._viewStateManager.setOutliningStates([],u)}else{o._viewStateManager.setOutliningStates(u,[])}}else if(this.getSubtractMode()){o._viewStateManager.setSelectionStates([],u)}else{o._viewStateManager.setSelectionStates(u,[])}}return u}if(c!=="sap.ui.vk.threejs.Viewport"){return u}var f=l?l.getSceneRef():undefined;var h=p?p.getCameraRef():undefined;var d=o._getViewStateManagerThreeJS();if(!h||!f||!d||e===r||t===s){return u}var g={x1:e,y1:t,x2:r,y2:s};var S=h.projectionMatrix.clone();n(S,g,o._renderer.getSize(new a.Vector2));var w=(new a.Matrix4).multiplyMatrices(S,h.matrixWorldInverse);var y=(new a.Frustum).setFromProjectionMatrix(w);var _=new a.Vector3;function M(e){var t=e.geometry;if(t!==undefined&&y.intersectsObject(e)){var i,r=0;if(t.isGeometry){var a=t.vertices;for(i=0,r=a.length;i<r;i++){_.copy(a[i]).applyMatrix4(e.matrixWorld);if(!y.containsPoint(_)){break}}}else if(t.isBufferGeometry){var s=t.attributes.position;if(s!==undefined){var n=e.userData.renderGroup;for(i=n?n.firstVertex:0,r=n?n.lastVertex:s.count;i<r;i++){_.fromBufferAttribute(s,i).applyMatrix4(e.matrixWorld);if(!y.containsPoint(_)){break}}}}return r>0&&i===r}return false}function k(e,t,i){if(!e.visible||e.userData.selectable===false){return}var r=i||e.userData.skipIt?t:{totalCount:0,passedCount:0};if(r&&e.geometry!==undefined){r.totalCount++;if(M(e)){r.passedCount++}}var a=e.children;for(var s=0,n=a.length;s<n;s++){k(a[s],r,i||e.userData.closed)}if(r!==t&&r.passedCount>0&&r.totalCount===r.passedCount){u.push(e)}}k(f);if(u.length>0){var V={picked:u};o.fireNodesPicked(V);if(o.getSelectionDisplayMode()===i.Outline){if(this.getSubtractMode()){d.setOutliningStates([],u)}else{d.setOutliningStates(u,[])}}else if(this.getSubtractMode()){d.setSelectionStates([],u)}else{d.setSelectionStates(u,[])}}return u};return s});
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/tools/RectSelectToolHandler", ["sap/ui/base/EventProvider"],function(t){"use strict";var e=t.extend("sap.ui.vk.tools.RectSelectToolHandler",{metadata:{library:"sap.ui.vk",publicMethods:["beginGesture","endGesture","move","click","doubleClick","contextMenu"]},constructor:function(t){this._tool=t;this._rect=null;this._gesture=false;this._nomenu=false;this._selectionRect=null}});e.prototype.destroy=function(){this._tool=null;this._rect=null;this._gesture=false};e.prototype.activate=function(t){this._deactivate=false;if(t._loco){this._viewport=t;t._loco.addHandler(this,1)}};e.prototype.deactivate=function(){if(this._gesture){this._deactivate=true}else if(this._viewport){this._deactivate=false;this._viewport._loco.removeHandler(this);this._viewport=null}};e.prototype._getOffset=function(t){var e=t.getBoundingClientRect();var i={x:e.left+window.pageXOffset,y:e.top+window.pageYOffset};return i};e.prototype._inside=function(t){var e=this._tool._viewport.getIdForLabel();var i=document.getElementById(e);if(i==null){return false}var s=this._getOffset(i);this._rect={x:s.x,y:s.y,w:i.offsetWidth,h:i.offsetHeight};if(document.activeElement){try{document.activeElement.blur()}catch(t){}}i.focus();return t.x>=this._rect.x&&t.x<=this._rect.x+this._rect.w&&t.y>=this._rect.y&&t.y<=this._rect.y+this._rect.h};e.prototype.beginGesture=function(t){if(t.n===1&&this._inside(t)&&!this._gesture){this._gesture=true;t.handled=true;var e=t.x-this._rect.x,i=t.y-this._rect.y;this._selectionRect={x1:e,y1:i,x2:e,y2:i};return}};e.prototype.move=function(t){if(this._gesture){t.handled=true;this._nomenu=true;if(this._selectionRect){this._selectionRect.x2=t.x-this._rect.x;this._selectionRect.y2=t.y-this._rect.y;if(this._viewport){this._viewport.setSelectionRect(this._selectionRect)}}}};e.prototype.endGesture=function(t){if(this._gesture){this._gesture=false;t.handled=true;if(this._selectionRect){if(this._viewport){var e=t.x-this._rect.x,i=t.y-this._rect.y;if(this._tool.isViewportType("sap.ui.vk.svg.Viewport")||this._tool.isViewportType("sap.ui.vk.dvl.Viewport")){this._tool.select(this._selectionRect.x1,this._selectionRect.y1,e,i,null,null)}else if(this._tool.isViewportType("sap.ui.vk.threejs.Viewport")){this._tool.select(this._selectionRect.x1,this._selectionRect.y1,e,i,this._viewport.getScene(),this._viewport.getCamera())}}this._viewport.setSelectionRect(null);this._selectionRect=null}if(this._deactivate){this.deactivate()}}};e.prototype.getViewport=function(){return this._viewport};return e});
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/tools/RedlineTool", ["sap/base/Log","./Tool","./RedlineToolHandler","./RedlineToolGizmo","../Redline","../RedlineElementRectangle","../RedlineElementEllipse","../RedlineElementFreehand","../RedlineElementLine","../RedlineElementText"],function(e,t,i,n,r,o,a,s,l,p){"use strict";var d=t.extend("sap.ui.vk.tools.RedlineTool",{metadata:{library:"sap.ui.vk",properties:{editable:{type:"boolean",defaultValue:true}},events:{elementCreated:{parameters:{element:"object"}},elementClicked:{parameters:{elementId:"string"}},elementHovered:{parameters:{elementId:"string"}}},aggregations:{redlineElements:{type:"sap.ui.vk.RedlineElement",multiple:true,forwarding:{getter:"getGizmo",aggregation:"redlineElements",forwardBinding:true}}}},constructor:function(e,n){if(d._instance){return d._instance}t.apply(this,arguments);this._viewport=null;this._handler=new i(this);d._instance=this;return this}});d.prototype.init=function(){if(t.prototype.init){t.prototype.init.call(this)}this.setFootprint(["sap.ui.vk.svg.Viewport","sap.ui.vk.threejs.Viewport","sap.ui.vk.dvl.Viewport","sap.ui.vk.NativeViewport","sap.ui.vk.pdf.Viewport"]);this.setAggregation("gizmo",new n)};d.prototype.exit=function(){d._instance=null};d.prototype.setActive=function(e,i,n){t.prototype.setActive.call(this,e,i,n);var r=this._viewport;if(r){if(e){if(r._activateRedline){r._activateRedline()}else if(r.getMetadata().getName()==="sap.ui.vk.threejs.Viewport"&&r._viewportGestureHandler){r._viewportGestureHandler._activateRedline()}r._redlineHandler=this._handler;this._handler._zoomFactor=1;this._gizmo=this.getGizmo();if(this._gizmo){this._gizmo.show()}this._addLocoHandler()}else{this._removeLocoHandler();if(this._gizmo){this._gizmo.hide();this._gizmo=null}delete r._redlineHandler;if(r._deactivateRedline){r._deactivateRedline()}else if(r.getMetadata().getName()==="sap.ui.vk.threejs.Viewport"&&r._viewportGestureHandler){r._viewportGestureHandler._deactivateRedline()}}}return this};var u={rectangle:o,ellipse:a,freehand:s,line:l,text:p};var m={rect:o,ellipse:a,path:s,line:l,text:p};d.prototype.startAdding=function(e){this.getGizmo()._startAdding(e);return this};d.prototype.stopAdding=function(){this.getGizmo()._stopAdding(false);return this};d.prototype.exportJSON=function(){return this.getGizmo().getRedlineElements().map(function(e){return e.exportJSON()})};d.prototype.importJSON=function(t){var i=this.getGizmo();t=Array.isArray(t)?t:[t];t.forEach(function(t){var n=u[t.type];if(n){i.addRedlineElement((new n).importJSON(t))}else{e.warning("Unsupported JSON element type "+t.type)}});i.rerender();return this};d.prototype.exportSVG=function(){var e=document.createElementNS(r.svgNamespace,"svg");this.getGizmo().getRedlineElements().map(function(t){e.appendChild(t.exportSVG())});return e};d.prototype.importSVG=function(t){var i=this.getGizmo();t.childNodes.forEach(function(t){if(t.getAttribute){var n=m[t.tagName];if(n){i.addRedlineElement((new n).importSVG(t))}else{e.warning("Unsupported SVG element type "+n)}}});i.rerender();return this};d.prototype.queueCommand=function(e){if(this._addLocoHandler()){if(this.isViewportType("sap.ui.vk.threejs.Viewport")||this.isViewportType("sap.ui.vk.NativeViewport")){e()}}return this};d.prototype.onElementClicked=function(e){this.fireElementClicked({elementId:e.getParameter("elementId")})};return d});
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/tools/RedlineToolGizmo", ["./Gizmo","./RedlineToolGizmoRenderer"],function(e,t){"use strict";var i=e.extend("sap.ui.vk.tools.RedlineToolGizmo",{metadata:{library:"sap.ui.vk",aggregations:{redlineElements:{type:"sap.ui.vk.RedlineElement"},activeElement:{type:"sap.ui.vk.RedlineElement",multiple:false,visibility:"hidden"}}}});i.prototype.init=function(){if(e.prototype.init){e.prototype.init.apply(this)}this._activeElement=null;this._virtualLeft=0;this._virtualTop=0;this._virtualSideLength=1};i.prototype.show=function(){this.getParent()._viewport.attachEvent("resize",null,this._onResize,this);this.addStyleClass("sapUiVizkitRedlineInteractionMode")};i.prototype.hide=function(){this.getParent()._viewport.detachEvent("resize",this._onResize,this);this.removeStyleClass("sapUiVizkitRedlineDesignMode");this.removeStyleClass("sapUiVizkitRedlineInteractionMode")};i.prototype._startAdding=function(e){this._activeElement=null;this.setAggregation("activeElement",e);this.removeStyleClass("sapUiVizkitRedlineInteractionMode");this.addStyleClass("sapUiVizkitRedlineDesignMode")};i.prototype._stopAdding=function(e){var t=e?this._activeElement:null;this._activeElement=null;this.setAggregation("activeElement",null);this.removeStyleClass("sapUiVizkitRedlineDesignMode");this.addStyleClass("sapUiVizkitRedlineInteractionMode");if(t){if(t instanceof sap.ui.vk.RedlineElementLine&&t.getLength()===0){t.destroy();t=null}else{this.addRedlineElement(t);if(this.getParent().getEditable()&&t instanceof sap.ui.vk.RedlineElementText){this._createdTextElement=t;this.editTextElement(t,true)}}this.getParent().fireElementCreated({element:t})}};i.prototype._toVirtualSpace=function(e,t){if(arguments.length===1){return e/this._virtualSideLength}else{return{x:(e-this._virtualLeft)/this._virtualSideLength,y:(t-this._virtualTop)/this._virtualSideLength}}};i.prototype._toPixelSpace=function(e,t){if(arguments.length===1){return e*this._virtualSideLength}else{return{x:e*this._virtualSideLength+this._virtualLeft,y:t*this._virtualSideLength+this._virtualTop}}};i.prototype._onResize=function(){if(this.getDomRef()){this.rerender()}};i.prototype._getPanningRatio=function(){var e=this.getDomRef().getBoundingClientRect(),t=e.height,i=e.width;if(this._virtualLeft===0&&(t<i&&this._virtualTop<0||t>i&&this._virtualTop>0)){return t/i}return 1};i.prototype.editTextElement=function(e,t){if(!this.getParent().getEditable()){return}var i=this._textEditingElement&&this._textEditingElement.getDomRef();if(i){i.childNodes[0].blur()}i=e.getDomRef();if(i){e._nextElementSibling=i.nextElementSibling;i.parentNode.appendChild(i);i.childNodes[0].focus();if(t){i.childNodes[0].select()}}};i.prototype.onBeforeRendering=function(){var e=this.getParent()._viewport;if(e&&e.getDomRef()){var t=e.getOutputSize();this._virtualLeft=t.left;this._virtualTop=t.top;this._virtualSideLength=t.sideLength}};i.prototype.onAfterRendering=function(){var e=this;function t(t){var i=t.getDomRef();var n=i&&i.childNodes[0];if(!n){return}n.onfocus=function(i){e._textEditingElement=t;this.style.background="#0004";this.style.backdropFilter="blur(8px)";this.style.resize="both";this.style.overflow="auto"};n.onblur=function(n){e._textEditingElement=null;this.style.background="none";this.style.backdropFilter=null;this.style.resize="none";this.style.overflow="hidden";this.scrollTop=0;const l=window.getComputedStyle(this);let s=l.getPropertyValue("--sapUiVizKitRedlineScale");s=s===""?1:Number(s);t.setWidth(parseFloat(l.width)/s);var o=parseFloat(l.height)/s;const r=this.style.fontSize;this.style.fontSize=`${t.getFontSize()}px`;this.style.height="1px";o=Math.max(o,this.scrollHeight);this.style.height=`calc(${o}px * var(--sapUiVizKitRedlineScale, 1))`;t.setHeight(o);this.style.fontSize=r;if(i===t.getDomRef()){i.parentNode.insertBefore(i,t._nextElementSibling)}delete t._nextElementSibling;if(e._createdTextElement===t){e._createdTextElement=null;e.getParent().fireElementCreated({element:t})}};n.onchange=function(e){t.setText(this.value)};n.addEventListener("keypress",function(e){e.stopPropagation()})}this.getRedlineElements().forEach(function(e){if(e instanceof sap.ui.vk.RedlineElementText){t(e)}});if(this._activeElement instanceof sap.ui.vk.RedlineElementText&&this._activeElement.getDomRef()){t(this._activeElement)}};i.prototype.onkeydown=function(e){if(this._textEditingElement){e.setMarked(true);e.stopPropagation()}};return i});
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/tools/RedlineToolGizmoRenderer", [],function(){"use strict";var e={apiVersion:2};e.render=function(e,r){e.openStart("svg",r);e.class("sapUiVizkitRedlineTool");e.openEnd();var t=[];var o=[];var a=["rgba(255,0,0,1)"];var n=["255001"];var l=r.getRedlineElements();for(var i=0;i<l.length;i++){var s=l[i];var p=s.getHaloColor();if(!t.includes(p)){t.push(p);var d=s._colorToArray(p);o.push(d)}var f=s.getStrokeColor();var c=s._colorToArray(f).join("");if(!n.includes(c)){n.push(c);a.push(f)}}var u;if(r.getParent()._haloColor){u=r.getParent()._haloColor.replace(/[^\d,.]/g,"").split(",")}else{u=[255,0,0,1]}if(!u[3]){u.push(1)}var g=u.join("");e.openStart("defs");e.openEnd();e.openStart("filter");e.attr("id","halo"+g);e.attr("filterUnits","userSpaceOnUse");e.openEnd();e.openStart("feGaussianBlur");e.attr("in","SourceAlpha");e.attr("stdDeviation","3");e.attr("result","blur");e.openEnd();e.close("feGaussianBlur");e.openStart("feColorMatrix");e.attr("result","color");e.attr("type","matrix");e.attr("values","0 0 0 0 "+u[0]/255+" 0 0 0 0 "+u[1]/255+" 0 0 0 0 "+u[2]/255+" 0 0 0 "+u[3]+" 0");e.openEnd();e.close("feColorMatrix");e.openStart("feMerge");e.openEnd();e.openStart("feMergeNode");e.attr("in","blur");e.openEnd();e.close("feMergeNode");e.openStart("feMergeNode");e.attr("in","color");e.openEnd();e.close("feMergeNode");e.openStart("feMergeNode");e.attr("in","SourceGraphic");e.openEnd();e.close("feMergeNode");e.close("feMerge");e.close("filter");for(var v=0;v<o.length;v++){var S=o[v];var E=S.join("");e.openStart("filter");e.attr("id","halo"+E);e.attr("filterUnits","userSpaceOnUse");e.openEnd();e.openStart("feGaussianBlur");e.attr("in","SourceAlpha");e.attr("stdDeviation","3");e.attr("result","blur");e.openEnd();e.close("feGaussianBlur");e.openStart("feColorMatrix");e.attr("result","color");e.attr("type","matrix");e.attr("values","0 0 0 0 "+S[0]/255+" 0 0 0 0 "+S[1]/255+" 0 0 0 0 "+S[2]/255+" 0 0 0 "+S[3]+" 0");e.openEnd();e.close("feColorMatrix");e.openStart("feMerge");e.openEnd();e.openStart("feMergeNode");e.attr("in","blur");e.openEnd();e.close("feMergeNode");e.openStart("feMergeNode");e.attr("in","color");e.openEnd();e.close("feMergeNode");e.openStart("feMergeNode");e.attr("in","SourceGraphic");e.openEnd();e.close("feMergeNode");e.close("feMerge");e.close("filter")}for(var M=0;M<n.length;M++){e.openStart("marker");e.attr("id","endArrowHead"+n[M]);e.attr("markerWidth","10");e.attr("markerHeight","7");e.attr("refX","0");e.attr("refY","3.5");e.attr("orient","auto");e.openEnd();e.openStart("polygon");e.attr("points","0 0, 10 3.5, 0 7");e.attr("fill",a[M]);e.openEnd();e.close("polygon");e.close("marker")}e.close("defs");l.forEach(function(r){if(!r.getSuppress()){r.render(e)}});if(r._activeElement){r._activeElement.render(e)}e.close("svg")};return e},true);
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/tools/RedlineToolHandler", ["sap/ui/base/EventProvider","sap/ui/core/Element"],function(t,e){"use strict";var i=t.extend("sap.ui.vk.tools.RedlineToolHandler",{metadata:{library:"sap.ui.vk"},constructor:function(t){this._priority=30;this._tool=t;this._rect=null;this._zoomFactor=1}});i.prototype.destroy=function(){this._tool=null;this._rect=null};i.prototype.init=function(){this._previousHoverTarget=null};i.prototype.beginGesture=function(t){var e=this._tool.getGizmo();if(e&&this._inside(t)){if(e._textEditingElement){t.handled=true;var i=this.hitTest(t.x,t.y);if(i!==e._textEditingElement){var n=e._textEditingElement.getDomRef();if(n){n.childNodes[0].blur()}return}t.passEvent=true;if(i===e._textEditingElement){return}}this._gesture=true;e._activeElement=t.buttons===1&&e.getAggregation("activeElement")||null;if(e._activeElement){t.handled=true;var r=e.getDomRef().getBoundingClientRect(),o=e._toVirtualSpace(t.x-r.left-window.pageXOffset,t.y-r.top-window.pageYOffset);e._activeElement.setOriginX(o.x);e._activeElement.setOriginY(o.y);e.rerender()}else{this._pivotPoint=e._toVirtualSpace(t.x-this._rect.x,t.y-this._rect.y)}}};i.prototype.move=function(t){var e=this._tool.getGizmo();if(e&&this._gesture){if(e._textEditingElement){t.handled=true;t.passEvent=true}else if(e._activeElement){t.handled=true;var i=e.getDomRef().getBoundingClientRect(),n=t.x-i.left-window.pageXOffset,r=t.y-i.top-window.pageYOffset;e._activeElement.edit(n,r,t.event&&t.event.shiftKey)}}};i.prototype.endGesture=function(t){var e=this._tool.getGizmo();if(e&&this._inside(t)){this._gesture=false;if(e._textEditingElement){t.handled=true;t.passEvent=true}else if(e._activeElement){t.handled=true;e._stopAdding(true)}}};i.prototype.pan=function(t,e){var i=this._tool.getGizmo();if(i&&(t||e)){i.getRedlineElements().forEach(function(n){n.setOriginX(n.getOriginX()+i._toVirtualSpace(t));n.setOriginY(n.getOriginY()+i._toVirtualSpace(e))});i.rerender()}};i.prototype.zoom=function(t,e,i){var n=this._tool.getGizmo();if(n&&t!==1){var r=1-t,o=e!==undefined&&i!==undefined?n._toVirtualSpace(e,i):this._pivotPoint;n.getRedlineElements().forEach(function(e){e.applyZoom(t);var i=e.getOriginX(),n=e.getOriginY();i+=(o.x-i)*r;n+=(o.y-n)*r;e.setOriginX(i);e.setOriginY(n)});n.rerender()}};i.prototype.hitTest=function(t,i){var n;var r=6;var o=6;var s=function(t,i){var n=document.elementFromPoint(t,i);if(n){var r=e.getElementById(n.id||n.parentNode.id);if(r instanceof sap.ui.vk.RedlineElement){return r}}return null};n=s(t,i);if(!n){for(var l=i-o;l<i+o;l++){for(var a=t-r;a<t+r;a++){n=s(a,l);if(n){return n}}}}return n?n:null};i.prototype.click=function(t){var e=this.hitTest(t.x,t.y);if(e){this._tool.fireElementClicked({elementId:e.getElementId()})}};i.prototype.doubleClick=function(t){var e=this._tool.getGizmo();if(e&&this._tool.getEditable()){var i=this.hitTest(t.x,t.y);if(i instanceof sap.ui.vk.RedlineElementText){e.editTextElement(i);t.handled=true}}};i.prototype.hover=function(t){var e=this._tool.getGizmo();if(e&&e._textEditingElement){t.passEvent=true;return}var i=this.hitTest(t.x,t.y);if(i&&i.getElementId()!=this._previousHoverTarget){this._previousHoverTarget=i.getElementId();this._tool.fireElementHovered({elementId:i.getElementId()})}else if(!i&&i!=this._previousHoverTarget){this._previousHoverTarget=i;this._tool.fireElementHovered({elementId:null})}};i.prototype.contextMenu=function(t){};i.prototype.getViewport=function(){return this._tool._viewport};i.prototype._getOffset=function(t){var e=t.getBoundingClientRect();var i={x:e.left+window.pageXOffset,y:e.top+window.pageYOffset};return i};i.prototype._inside=function(t){var e=this._tool._viewport.getIdForLabel();var i=document.getElementById(e);if(i==null){return false}var n=this._getOffset(i);this._rect={x:n.x,y:n.y,w:i.offsetWidth,h:i.offsetHeight};return t.x>=this._rect.x&&t.x<=this._rect.x+this._rect.w&&t.y>=this._rect.y&&t.y<=this._rect.y+this._rect.h};return i});
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/tools/RotatableAxis", ["sap/ui/base/DataType"],function(e){"use strict";var t={All:"All",X:"X",Y:"Y",Z:"Z"};e.registerEnum("sap.ui.vk.tools.RotatableAxis",t);return t},true);
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/tools/RotateOrbitTool", ["./Tool","../helpers/RotateOrbitHelperDvl","../helpers/RotateOrbitHelperThree"],function(t,e,i){"use strict";var r=t.extend("sap.ui.vk.tools.RotateOrbitTool",{metadata:{library:"sap.ui.vk",events:{rotate:{parameters:{dx:"int",dy:"int"}}}},constructor:function(e,i){if(r._instance){return r._instance}t.apply(this,arguments);this.setToolid("1a1fced1-9b42-d7f3-5fdf-8d338b3591a6");this._viewport=null;this._rotateOrbitHelper=null;r._instance=this;return this}});r.prototype.init=function(){if(t.prototype.init){t.prototype.init.call(this)}this.setFootprint(["sap.ui.vk.dvl.Viewport","sap.ui.vk.threejs.Viewport"])};r.prototype.setActive=function(e,i,r){t.prototype.setActive.call(this,e,i,r);if(this._viewport){if(e){if(this._prepare()){this._rotateOrbitHelper.activateOrbitMode()}}else if(this._rotateOrbitHelper){this._rotateOrbitHelper.deactivateOrbitMode();this._rotateOrbitHelper=null}}return this};r.prototype._prepare=function(){if(this.isViewportType("sap.ui.vk.dvl.Viewport")&&this._viewport._dvl){if(this._rotateOrbitHelper==null){this._dvlRendererId=this._viewport._dvlRendererId;this._dvl=this._viewport._dvl;this._rotateOrbitHelper=new e(this,this._dvl)}}if(this.isViewportType("sap.ui.vk.threejs.Viewport")){if(this._rotateOrbitHelper==null){this._rotateOrbitHelper=new i(this)}}else{return false}return true};r.prototype.rotate=function(t,e){if(this._prepare()){this._rotateOrbitHelper.rotate(t,e)}};r.prototype.destroy=function(){t.prototype.destroy.call(this);this._viewport=null;this._rotateOrbitHelper=null;delete r._instance};return r});
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/tools/RotateTool", ["./Tool","../thirdparty/three","./RotatableAxis","./CoordinateSystem","./RotateToolHandler","./RotateToolGizmo","./GizmoPlacementMode","./ToolNodeSet"],function(t,e,o,i,s,r,a,n){"use strict";var p=t.extend("sap.ui.vk.tools.RotateTool",{metadata:{library:"sap.ui.vk",properties:{coordinateSystem:{type:"sap.ui.vk.tools.CoordinateSystem",defaultValue:i.World},axis:{type:"sap.ui.vk.tools.RotatableAxis",defaultValue:o.All},enableStepping:{type:"boolean",defaultValue:false},enableSnapping:{type:"boolean",defaultValue:false},showEditingUI:{type:"boolean",defaultValue:false},autoResetValues:{type:"boolean",defaultValue:true},allowContextMenu:{type:"boolean",defaultValue:true},nodeSet:{type:"sap.ui.vk.tools.ToolNodeSet",defaultValue:n.Highlight},placementMode:{type:"sap.ui.vk.tools.GizmoPlacementMode",defaultValue:a.Default}},events:{rotating:{parameters:{x:"float",y:"float",z:"float",nodesProperties:"any[]"}},rotated:{parameters:{x:"float",y:"float",z:"float",nodesProperties:"any[]"}},axisChanged:{parameters:{axis:"sap.ui.vk.tools.RotatableAxis"}},coordinateSystemChanged:{parameters:{coordinateSystem:"sap.ui.vk.tools.CoordinateSystem"}},placementModeChanged:{parameters:{placementMode:"sap.ui.vk.tools.GizmoPlacementMode"}}}},constructor:function(e,o){t.apply(this,arguments);this._viewport=null;this._handler=new s(this);this._gizmo=null}});p.prototype.init=function(){t.prototype.init.call(this);this.setFootprint(["sap.ui.vk.threejs.Viewport"]);this.setAggregation("gizmo",new r)};p.prototype.setActive=function(e,o,i){t.prototype.setActive.call(this,e,o,i);if(this._viewport){if(e){this._gizmo=this.getGizmo();this._gizmo.setAxis(this.getAxis());this._gizmo.setCoordinateSystem(this.getCoordinateSystem());this._gizmo.show(this._viewport,this);this._addLocoHandler()}else{this._removeLocoHandler();this._gizmo?.hide();this._gizmo=null}}return this};p.prototype.setPlacementMode=function(t){var e=this.getPlacementMode();if(e!==t){this.setProperty("placementMode",t,true);this.getGizmo().setPlacementMode(t);this._viewport?.setShouldRenderFrame();this.firePlacementModeChanged({placementMode:t})}return this};p.prototype.queueCommand=function(t){if(this._addLocoHandler()){if(this.isViewportType("sap.ui.vk.threejs.Viewport")){t()}}return this};p.prototype.setAxis=function(t){var e=this.getAxis();if(e!==t){this.setProperty("axis",t,true);this.getGizmo().setAxis(t);this._viewport?.setShouldRenderFrame();this.fireAxisChanged({axis:t})}return this};p.prototype.setCoordinateSystem=function(t){var e=this.getCoordinateSystem();if(e!==t){this.setProperty("coordinateSystem",t,true);this.getGizmo().setCoordinateSystem(t);this._viewport?.setShouldRenderFrame();this.fireCoordinateSystemChanged({coordinateSystem:t})}return this};p.prototype.setShowEditingUI=function(t){this.setProperty("showEditingUI",t,true);this._viewport?.setShouldRenderFrame();return this};p.prototype.setEnableSnapping=function(t){this.setProperty("enableSnapping",t,true);if(t&&this.getActive()){this.getGizmo()._computeBoundsTree()}else{this.getGizmo()._disposeBoundsTree()}return this};p.prototype.resetValues=function(){this.getGizmo().resetValues();this._viewport?.setShouldRenderFrame();return this};p.prototype.setNodeSet=function(t){this.setProperty("nodeSet",t,true);this._gizmo?.handleSelectionChanged()};p.prototype.rotate=function(t,e,o,i){var s;if(i&&i!==this.getCoordinateSystem()){s=this.getCoordinateSystem();this.setCoordinateSystem(i)}this._gizmo?.rotate(t,e,o);if(s){this.setCoordinateSystem(s)}this._gizmo?.endGesture();this._viewport?.setShouldRenderFrame();return this};p.prototype.prepareForCreatingRotationKey=function(t,e,o){if(this._gizmo){this._gizmo._prepareForCreatingRotationKey(t,e,o);return this._gizmo._getNodesProperties()}return null};p.prototype.rotateRestPosition=function(t,e,o){this._gizmo?.rotateRestPosition(t,e,o);this._viewport?.setShouldRenderFrame();return this};p.prototype.rotateFromRestPosition=function(t,e,o){this._gizmo?.rotateFromRestPosition(t,e,o);this._viewport?.setShouldRenderFrame();return this};return p});
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/tools/RotateToolGizmo", ["../thirdparty/three","./Gizmo","./RotatableAxis","./CoordinateSystem","./AxisColours","../AnimationTrackType","../AnimationTrackValueType","./GizmoPlacementMode","sap/base/assert","sap/base/Log"],function(e,t,i,o,r,a,n,s,l,u){"use strict";var h=t.extend("sap.ui.vk.tools.RotateToolGizmo",{metadata:{library:"sap.ui.vk"},renderer:{apiVersion:2,render:function(e,t){e.openStart("div",t);e.class("sapUiVkTransformationToolEdit");e.openEnd();e.renderControl(t._editingForm);e.close("div")}}});h.prototype.init=function(){t.prototype.init.apply(this);this._createEditingForm(String.fromCharCode(176),84);this._gizmoIndex=-1;this._handleIndex=-1;this._value=new e.Vector3;this._rotationDelta=new e.Vector3;this._noHitRotation=new e.Euler;this._viewport=null;this._tool=null;this._sceneGizmo=new e.Scene;this._gizmo=new e.Group;this._touchAreas=new e.Group;this._sceneGizmo.add(this._gizmo);this._axis=i.All;this._coordinateSystem=o.World;this._nodes=[];this._matViewProj=new e.Matrix4;this._gizmoSize=96;function a(t,i,o,r){var a=new e.TorusGeometry(o,1/96,4,r);if(t===0){a.rotateY(Math.PI/2)}else if(t===1){a.rotateX(Math.PI/2)}var n=new e.Mesh(a,new e.MeshBasicMaterial({color:i,transparent:true}));n.matrixAutoUpdate=false;n.userData.color=i;return n}function n(t,i,o){var r=new e.TorusGeometry(i,16/96,4,o);if(t===0){r.rotateY(Math.PI/2)}else if(t===1){r.rotateX(Math.PI/2)}return new e.Mesh(r,new e.MeshBasicMaterial({opacity:.2,transparent:true}))}for(var s=0;s<3;s++){this._gizmo.add(a(s,r[["x","y","z"][s]],1,128));this._touchAreas.add(n(s,1,24))}this._gizmo.add(new e.AxesHelper(.75));var l=new e.MeshBasicMaterial({color:33023,opacity:.5,transparent:true,side:e.DoubleSide});this._arcMesh=new e.Mesh(new e.BufferGeometry,l);this._arcMesh.visible=false;this._gizmo.add(this._arcMesh);this._axisTitles=this._createAxisTitles();this._sceneGizmo.add(this._axisTitles)};h.prototype.hasDomElement=function(){return true};h.prototype.setAxis=function(e){this._axis=e;var t=[i.All,i.X,i.Y,i.Z];if(this._coordinateSystem!==o.Screen){for(var r=0;r<3;r++){if(e!==i.All&&t[r+1]!==e){this._gizmo.children[r].visible=this._touchAreas.children[r].visible=false}else{this._gizmo.children[r].visible=this._touchAreas.children[r].visible=true}}}};h.prototype.resetValues=function(){this._value.setScalar(0)};h.prototype.setCoordinateSystem=function(e){this._coordinateSystem=e;var t=e===o.Screen;if(t){this._gizmo.children[0].visible=this._gizmo.children[1].visible=false;this._touchAreas.children[0].visible=this._touchAreas.children[1].visible=false;this._gizmo.children[2].visible=this._touchAreas.children[2].visible=true}else{this._gizmo.children[0].visible=this._touchAreas.children[0].visible=this._axis===i.All||this._axis===i.X;this._gizmo.children[1].visible=this._touchAreas.children[1].visible=this._axis===i.All||this._axis===i.Y;this._gizmo.children[2].visible=this._touchAreas.children[2].visible=this._axis===i.All||this._axis===i.Z}this._axisTitles.visible=!t;this._gizmoIndex=this._handleIndex=-1};h.prototype.show=function(e,t){this._viewport=e;this._tool=t;this._nodes.length=0;this._updateSelection(e._viewStateManager);var i=this._getNodesProperties();this._tool.fireEvent("rotating",{x:0,y:0,z:0,nodesProperties:i},true);this._attachVisibilityChanged()};h.prototype._prepareForCreatingRotationKey=function(t,i,o){this._nodes.forEach(function(r){var n=r.node;var s=[0,0,0];t.setTime(i,o);var l=t.getAnimatedProperty(n,a.Rotate);if(l.offsetToPrevious){s=l.offsetToPrevious}if(!this._nodeUserDataMap){this._nodeUserDataMap=new Map}var u=this._nodeUserDataMap.get(n);if(!u){u={};this._nodeUserDataMap.set(n,u)}u.eulerInParentCoors=new e.Euler(s[0],s[1],s[2]);u.startEulerInParentCoors=new e.Euler(s[0],s[1],s[2])}.bind(this));var r=t.getCurrentPlayback();if(r){this._prepareForCreatingKey(r)}};h.prototype.hide=function(){this._detachVisibilityChanged();this._cleanTempData();this._disposeBoundsTree();this._viewport=null;this._tool=null;this._gizmoIndex=this._handleIndex=-1;this._updateEditingForm(false)};h.prototype._onVisibilityChanged=function(e){if(this._tool.getEnableSnapping()){this._computeBoundsTree()}};h.prototype.getGizmoCount=function(){if(this._coordinateSystem===o.Local||this._coordinateSystem===o.Parent){return this._nodes.length}else{return this._nodes.length>0?1:0}};h.prototype.getTouchObject=function(e){if(this._nodes.length===0){return null}this._updateGizmoObjectTransformation(this._touchAreas,e);return this._touchAreas};h.prototype.highlightHandle=function(e,t){for(var i=0;i<3;i++){var o=this._gizmo.children[i];var r=i===e?16776960:o.userData.color;o.material.color.setHex(r);o.material.opacity=e===-1||i===e?1:.35;o.material.visible=t||i===e;var a=this._axisTitles.children[i];a.material.color.setHex(r);a.material.opacity=e===-1||i===e?1:.35;a.material.visible=t||i===e}};h.prototype.selectHandle=function(e,t){this._gizmoIndex=t;this._handleIndex=e;if(this._tool.getAutoResetValues()){this.resetValues()}this._viewport.setShouldRenderFrame(true)};h.prototype.beginGesture=function(){this._beginValue=this._value.clone();this._rotationDelta.setScalar(0);this._noHitRotation.set(0,0,0);this._nodes.forEach((t,i)=>{this._updateGizmoObjectTransformation(this._gizmo,i);t.matGizmo=this._gizmo.matrixWorld.clone();t.node.parent.updateMatrixWorld(true);t.matOrigin=t.node.matrixWorld.clone();t.matLocalOrigin=t.node.matrix.clone();if(t.node.parent){t.matParentInv=(new e.Matrix4).copy(t.node.parent.matrixWorld).invert()}else{t.matParentInv=new e.Matrix4}t.quaternion=t.node.quaternion.clone()})};h.prototype._printEventInfo=function(e,t,i,o,r){u.debug(e+" is fired:"+" x = "+t+"; y = "+i+"; z = "+o);r.forEach(function(e){u.debug("Node: "+e.node.name);if(e.offsetToRest){u.debug("offsetToRest: [ "+e.offsetToRest[0]+", "+e.offsetToRest[1]+", "+e.offsetToRest[2]+", "+e.offsetToRest[3]+" ] ")}else{u.debug("offsetToRest: null")}if(e.offsetToRestInCoordinates){u.debug("offsetToRestInCoordinates: [ "+e.offsetToRestInCoordinates[0]+", "+e.offsetToRestInCoordinates[1]+", "+e.offsetToRestInCoordinates[2]+" ] ")}else{u.debug("offsetToRestInCoordinates: null")}if(e.offsetToPrevious){u.debug("offsetToPrevious: [ "+e.offsetToPrevious[0]+", "+e.offsetToPrevious[1]+", "+e.offsetToPrevious[2]+" ] ")}else{u.debug("offsetToPrevious: null")}if(e.absolute){u.debug("absolute: [ "+e.absolute[0]+", "+e.absolute[1]+", "+e.absolute[2]+", "+e.absolute[3]+" ] ")}else{u.debug("absolute: null")}if(e.world){u.debug("world: [ "+e.world[0]+", "+e.world[1]+", "+e.world[2]+", "+e.world[3]+" ] ")}else{u.debug("world: null")}if(e.restDifference){u.debug("restDifference: [ "+e.restDifference[0]+", "+e.restDifference[1]+", "+e.restDifference[2]+", "+e.restDifference[3]+" ] ")}else{u.debug("restDifference: null")}if(e.restDifferenceInCoordinates){u.debug("restDifference: [ "+e.restDifferenceInCoordinates[0]+", "+e.restDifferenceInCoordinates[1]+", "+e.restDifferenceInCoordinates[2]+", "+e.restDifferenceInCoordinates[3]+" ] ")}else{u.debug("restDifference: null")}})};h.prototype._getNodesProperties=function(){var t=[];this._nodes.forEach(function(i){var o=i.node;var r={};r.node=o;var n;if(this._nodeUserDataMap){n=this._nodeUserDataMap.get(o)}if(n&&n.eulerInParentCoors){var s=new e.Euler(n.eulerInParentCoors.x,n.eulerInParentCoors.y,n.eulerInParentCoors.z);var l=(new e.Quaternion).setFromEuler(s);if(this._playback){var u=this._viewport._viewStateManager._getEndPropertyInPreviousPlayback(o,a.Rotate,this._playback);if(u){var h=new e.Quaternion(u[0],u[1],u[2],u[3]);l.multiply(h)}}r.offsetToRest=[l.x,l.y,l.z,l.w];r.offsetToPrevious=[n.eulerInParentCoors.x,n.eulerInParentCoors.y,n.eulerInParentCoors.z]}else{r.offsetToRest=null;r.offsetToPrevious=null}var d=this._viewport._viewStateManager.getTransformation(o);r.absolute=[d.quaternion[0],d.quaternion[1],d.quaternion[2],d.quaternion[3]];var f=this._viewport._viewStateManager.getTransformationWorld(o);var _=new e.Quaternion(f.quaternion[0],f.quaternion[1],f.quaternion[2],f.quaternion[3]);var p=(new e.Euler).setFromQuaternion(_);r.world=[p.x,p.y,p.z];if(n&&n.quatInitialDiffInv){var c=new e.Quaternion(d.quaternion[0],d.quaternion[1],d.quaternion[2],d.quaternion[3]);c.multiply(n.quatInitialDiffInv);r.restDifference=[c.x,c.y,c.z,c.w]}else{r.restDifference=null}if(n.euler){r.restDifferenceInCoordinates=[n.euler.x,n.euler.y,n.euler.z]}else{r.restDifferenceInCoordinates=null}r.offsetToRestInCoordinates=null;t.push(r)},this);return t};h.prototype.endGesture=function(){this._arcMesh.visible=false;var e=this._getNodesProperties();delete this._beginValue;this._nodes.forEach(function(e){var t=e.node;var i;if(this._nodeUserDataMap){i=this._nodeUserDataMap.get(t)}if(i&&i.euler){i.startEuler.x=i.euler.x;i.startEuler.y=i.euler.y;i.startEuler.z=i.euler.z;i.startEulerInParentCoors.x=i.eulerInParentCoors.x;i.startEulerInParentCoors.y=i.eulerInParentCoors.y;i.startEulerInParentCoors.z=i.eulerInParentCoors.z}if(this._coordinateSystem!==o.Custom){delete t.userData.skipUpdateJointNode}this._viewport._viewStateManager._setJointNodeOffsets(t,a.Rotate)},this);this._tool.fireRotated({x:this._rotationDelta.x,y:this._rotationDelta.y,z:this._rotationDelta.z,nodesProperties:e});this._printEventInfo("Event 'rotated'",this._rotationDelta.x,this._rotationDelta.y,this._rotationDelta.z,e)};var d=function(e,t){if(Math.abs(e-t)<1e-6){return e}if(e>t){while(e>t){t+=2*Math.PI}if(t-e<=Math.PI){return t}else{return t-2*Math.PI}}else{while(e<t){t-=2*Math.PI}if(e-t<=Math.PI){return t}else{return t+2*Math.PI}}};h.prototype.rotateFromRestPosition=function(t,i,r){if(this._coordinateSystem!==o.Parent){return}this.beginGesture();this._nodes.forEach(function(e){var t=e.node;t.userData.skipUpdateJointNode=true});t=e.MathUtils.degToRad(t);i=e.MathUtils.degToRad(i);r=e.MathUtils.degToRad(r);for(var n=0,s=this._nodes.length;n<s;n++){var l=this._nodes[n];if(!l.ignore){var u=l.node;var h;if(this._nodeUserDataMap){h=this._nodeUserDataMap.get(u)}if(h&&h.euler&&h.eulerInParentCoors){this._rotationDelta.set(e.MathUtils.radToDeg(t-h.eulerInParentCoors.x),e.MathUtils.radToDeg(i-h.eulerInParentCoors.y),e.MathUtils.radToDeg(r-h.eulerInParentCoors.z));h.eulerInParentCoors.x=t;h.eulerInParentCoors.y=i;h.eulerInParentCoors.z=r;var d=new e.Euler(h.eulerInParentCoors.x,h.eulerInParentCoors.y,h.eulerInParentCoors.z);var f=(new e.Quaternion).setFromEuler(d);var _=this._viewport._viewStateManager.getRestTransformationUsingJoint(u);var p=new e.Quaternion(_.quaternion[0],_.quaternion[1],_.quaternion[2],_.quaternion[3]);if(this._playback){var c=this._viewport._viewStateManager._getEndPropertyInPreviousPlayback(u,a.Rotate,this._playback);if(c){var m=new e.Quaternion(c[0],c[1],c[2],c[3]);f.multiply(m)}}var v=this._getEffectiveParent(u);if(v!==u.parent){this._viewport._viewStateManager._setJointNodeOffsets(u,a.Rotate);u.userData.offsetQuaternion=[f.x,f.y,f.z,f.w];u.userData.skipUpdateJointNode=false;this._viewport._viewStateManager._setJointNodeMatrix();u.userData.skipUpdateJointNode=true}else{u.quaternion.copy(f.multiply(p))}u.updateMatrix();h.euler.x=h.eulerInParentCoors.x-h.startEulerInParentCoors.x+h.startEuler.x;h.euler.y=h.eulerInParentCoors.y-h.startEulerInParentCoors.y+h.startEuler.y;h.euler.z=h.eulerInParentCoors.z-h.startEulerInParentCoors.z+h.startEuler.z}}}this.endGesture()};h.prototype.rotateRestPosition=function(t,i,r){this.beginGesture();this._nodes.forEach(function(e){var t=e.node;t.userData.skipUpdateJointNode=true});t=e.MathUtils.degToRad(t);i=e.MathUtils.degToRad(i);r=e.MathUtils.degToRad(r);for(var a=0,n=this._nodes.length;a<n;a++){var s=this._nodes[a];if(!s.ignore){var l=s.node;var u;if(this._nodeUserDataMap){u=this._nodeUserDataMap.get(l)}if(u&&u.euler&&u.eulerInParentCoors){this._rotationDelta.set(e.MathUtils.radToDeg(t-u.euler.x),e.MathUtils.radToDeg(i-u.euler.y),e.MathUtils.radToDeg(r-u.euler.z));u.euler.x=t;u.euler.y=i;u.euler.z=r;var h=new e.Euler(u.euler.x,u.euler.y,u.euler.z);var f=(new e.Quaternion).setFromEuler(h);var _=new e.Matrix4;var p=new e.Matrix4;if(this._coordinateSystem===o.Local){_=l.parent.matrixWorld.clone().multiply(u.matRest);p=u.matRestInv.clone().multiply(s.matParentInv)}else if(this._gizmo&&this._coordinateSystem!==o.Parent){_=this._gizmo.matrixWorld.clone();p=p.copy(_).invert()}var c=(new e.Matrix4).makeRotationFromQuaternion(f);var m=c;if(this._coordinateSystem!==o.Parent){m=s.matParentInv.clone().multiply(_).multiply(c).multiply(p).multiply(l.parent.matrixWorld)}var v=(new e.Matrix4).makeRotationFromQuaternion(u.quatInitialDiff).multiply(m);var g=(new e.Euler).setFromRotationMatrix(v);if(Math.abs(g.x)<1e-6){g.x=0}if(Math.abs(g.y)<1e-6){g.y=0}if(Math.abs(g.z)<1e-6){g.z=0}u.eulerInParentCoors.x=d(u.eulerInParentCoors.x,g.x);u.eulerInParentCoors.y=d(u.eulerInParentCoors.y,g.y);u.eulerInParentCoors.z=d(u.eulerInParentCoors.z,g.z);l.matrix=u.matInitialDiff.clone().multiply(m.multiply(u.matRest));l.matrix.decompose(l.position,l.quaternion,l.scale);l.updateMatrix()}}}this.endGesture()};h.prototype._updateEulerForCreatingAnimationKey=function(t){for(var i=0,r=this._nodes.length;i<r;i++){var n=this._nodes[i];if(!n.ignore){var s=n.node;var l;if(this._nodeUserDataMap){l=this._nodeUserDataMap.get(s)}if(l&&l.euler){l.euler.x=l.startEuler.x+t[0];l.euler.y=l.startEuler.y+t[1];l.euler.z=l.startEuler.z+t[2];var u=false;if(Math.abs(l.euler.x)<1e-6&&(Math.abs(l.euler.y)<1e-6||Math.abs(l.euler.z)<1e-6)||Math.abs(l.euler.y)<1e-6&&Math.abs(l.euler.z)<1e-6){u=true}if(u&&this._coordinateSystem===o.Parent){l.eulerInParentCoors.x=l.startEulerInParentCoors.x+t[0];l.eulerInParentCoors.y=l.startEulerInParentCoors.y+t[1];l.eulerInParentCoors.z=l.startEulerInParentCoors.z+t[2];continue}var h=this._viewport._viewStateManager.getRelativeTransformation(s);var f;var _=this._getEffectiveParent(s);if(_!==s.parent&&this._coordinateSystem!==o.Custom){this._viewport._viewStateManager._setJointNodeOffsets(s,a.Rotate);f=new e.Quaternion(s.userData.offsetQuaternion[0],s.userData.offsetQuaternion[1],s.userData.offsetQuaternion[2],s.userData.offsetQuaternion[3]);s.userData.skipUpdateJointNode=false;this._viewport._viewStateManager._setJointNodeMatrix();s.userData.skipUpdateJointNode=true}else{f=new e.Quaternion(h.quaternion[0],h.quaternion[1],h.quaternion[2],h.quaternion[3])}var p=(new e.Matrix4).makeRotationFromQuaternion(f);if(this._playback){var c=this._viewport._viewStateManager._getEndPropertyInPreviousPlayback(s,a.Rotate,this._playback);if(c){var m=new e.Quaternion(c[0],c[1],c[2],c[3]);var v=(new e.Matrix4).makeRotationFromQuaternion(m);p.multiply((new e.Matrix4).copy(v).invert())}}var g=(new e.Euler).setFromRotationMatrix(p);if(Math.abs(g.x)<1e-5){g.x=0}if(Math.abs(g.y)<1e-5){g.y=0}if(Math.abs(g.z)<1e-5){g.z=0}l.eulerInParentCoors.x=d(l.eulerInParentCoors.x,g.x);l.eulerInParentCoors.y=d(l.eulerInParentCoors.y,g.y);l.eulerInParentCoors.z=d(l.eulerInParentCoors.z,g.z);if(u){continue}var y=new e.Matrix4;var x=new e.Matrix4;if(this._coordinateSystem===o.Local){y=s.parent.matrixWorld.clone().multiply(l.matRest);x=l.matRestInv.clone().multiply(n.matParentInv)}else if(this._gizmo&&this._coordinateSystem!==o.Parent){y=this._gizmo.matrixWorld.clone();x=x.copy(y).invert()}var M=new e.Quaternion(h.quaternion[0],h.quaternion[1],h.quaternion[2],h.quaternion[3]);M.multiply(l.quatInitialDiffInv);var z=(new e.Matrix4).makeRotationFromQuaternion(M);var I=z;if(this._coordinateSystem!==o.Parent){I=x.clone().multiply(s.parent.matrixWorld).multiply(z).multiply(n.matParentInv).multiply(y)}g=(new e.Euler).setFromRotationMatrix(I);if(Math.abs(g.x)<1e-6){g.x=0}if(Math.abs(g.y)<1e-6){g.y=0}if(Math.abs(g.z)<1e-6){g.z=0}l.euler.x=d(l.euler.x,g.x);l.euler.y=d(l.euler.y,g.y);l.euler.z=d(l.euler.z,g.z)}}}};h.prototype._rotate=function(t,i=false){this._rotationDelta.set(e.MathUtils.radToDeg(t.x),e.MathUtils.radToDeg(t.y),e.MathUtils.radToDeg(t.z));this._value.addVectors(this._beginValue,this._rotationDelta);this._nodes.forEach(function(e){var t=e.node;t.userData.skipUpdateJointNode=true});const r=new e.Quaternion;const a=t.toArray();for(let t=0;t<3;t++){const i=a[t];if(i){const n=a[3].charCodeAt(t)-88;if(n>=0&&n<3){this._nodes.forEach(t=>{if(t.ignore&&this._coordinateSystem!==o.Local){return}const a=(new e.Vector3).setFromMatrixColumn(t.matGizmo,n).normalize();const s=(new e.Matrix4).makeRotationAxis(a,i);const l=(new e.Vector3).setFromMatrixPosition(t.matGizmo);s.setPosition(l.sub(l.clone().applyMatrix4(s)));const u=t.node;if(this._coordinateSystem!==o.Parent){u.position.setFromMatrixPosition(t.matOrigin).applyMatrix4(s).applyMatrix4(t.matParentInv)}const h=(new e.Vector3).setFromMatrixScale(t.matOrigin);const d=a.clone().transformDirection((new e.Matrix4).copy(t.matOrigin).invert()).multiply(h).normalize();r.setFromAxisAngle(d,i);u.quaternion.copy(t.quaternion).multiply(r);u.updateMatrix();u.updateMatrixWorld()})}}}this._updateEulerForCreatingAnimationKey(a);if(!i&&this._tool.getEnableSnapping()){if(this._checkSceneSelectionIntersection()){const i=new e.Euler;for(let e=0;e<6;e++){i.set((t.x+this._noHitRotation.x)*.5,(t.y+this._noHitRotation.y)*.5,(t.z+this._noHitRotation.z)*.5);this._rotate(i,true);(this._checkSceneSelectionIntersection()?t:this._noHitRotation).copy(i)}if(!this._noHitRotation.equals(i)){this._rotate(this._noHitRotation,true)}}else{this._noHitRotation.copy(t)}}this._viewport.setShouldRenderFrame()};h.prototype._setRotationAxisAngle=function(t,i,r){var a=(r-i)%(Math.PI*2);var n=new e.Euler;n[["x","y","z"][t]]=a;var s=this._getNodesProperties();if(this._tool.fireEvent("rotating",{x:e.MathUtils.radToDeg(n.x),y:e.MathUtils.radToDeg(n.y),z:e.MathUtils.radToDeg(n.z),nodesProperties:s},true)){this._printEventInfo("Event 'rotating'",e.MathUtils.radToDeg(n.x),e.MathUtils.radToDeg(n.y),e.MathUtils.radToDeg(n.z),s);this._rotate(n);var l=[0,0,0];var u=new e.Vector3;var h=(t+1)%3,d=(t+2)%3;var f,_=Math.max(Math.ceil(Math.abs(a)*64/Math.PI),1);a*=this._coordinateSystem===o.Local?-1:1;for(f=0;f<=_;f++){var p=i+a*(f/_);u.set(0,0,0).setComponent(h,Math.cos(p)).setComponent(d,Math.sin(p));l.push(u.x,u.y,u.z)}var c=[];for(f=0;f<_;f++){c.push(0,f+1,f+2)}var m=this._arcMesh.geometry;m.setIndex(c);m.setAttribute("position",new e.Float32BufferAttribute(l,3));this._arcMesh.visible=true}};h.prototype.rotate=function(t,i,o){this.beginGesture();this._rotate(new e.Euler(e.MathUtils.degToRad(t||0),e.MathUtils.degToRad(i||0),e.MathUtils.degToRad(o||0)))};h.prototype._getValueLocaleOptions=function(){return{useGrouping:false,minimumFractionDigits:1,maximumFractionDigits:2}};h.prototype.getValue=function(){return this._gizmoIndex>=0&&this._handleIndex>=0&&this._handleIndex<3?this._value.getComponent(this._handleIndex):0};h.prototype.setValue=function(t){if(this._gizmoIndex>=0&&this._handleIndex>=0&&this._handleIndex<3){var i=new e.Euler;i[["x","y","z"][this._handleIndex]]=e.MathUtils.degToRad(t-this._value.getComponent(this._handleIndex));this.beginGesture();this._rotate(i);this.endGesture()}};h.prototype.expandBoundingBox=function(e){if(this._viewport){this._expandBoundingBox(e,this._viewport.getCamera().getCameraRef(),true)}};h.prototype._updateSelection=function(e){t.prototype._updateSelection.call(this,e);if(this._tool.getEnableSnapping()){this._computeBoundsTree()}};h.prototype.handleSelectionChanged=function(e){if(this._viewport){this._updateSelection(this._viewport._viewStateManager);var t=this._getNodesProperties();this._tool.fireEvent("rotating",{x:0,y:0,z:0,nodesProperties:t},true);this._gizmoIndex=this._handleIndex=-1}};h.prototype._getLevelingQuaternion=function(e,t){e.set(0,0,0,1);switch(this._coordinateSystem){case o.Local:e.setFromRotationMatrix(this._nodes[t].node.parent.matrixWorld);break;case o.Screen:e.copy(this._viewport.getCamera().getCameraRef().quaternion);break;case o.Custom:var i=this._getAnchorPoint();if(i){e.copy(i.quaternion)}break;default:break}};h.prototype._getObjectSize=function(t){var i=new e.Box3;if(this._nodes.length===1){this._nodes[0].node._expandBoundingBox(i,true,false)}else if(this._coordinateSystem===o.Local){this._nodes[0].node._expandBoundingBox(i,true,false)}if(i.isEmpty()){return 0}var r=new e.Vector3;i.getSize(r);return r.length()};h.prototype._updateGizmoTransformation=function(e,t){const i=this._updateGizmoObjectTransformation(this._gizmo,e);if(this._beginValue!=null&&this._placementMode===s.ObjectCenter){this._gizmo.position.setFromMatrixPosition(this._nodes[e].matGizmo);this._gizmo.matrix.setPosition(this._gizmo.position);this._gizmo.matrixWorld.setPosition(this._gizmo.position)}this._updateAxisTitles(this._axisTitles,this._gizmo,t,this._gizmoSize-12,i)};h.prototype._getEditingFormPosition=function(){var t=this._updateGizmoObjectTransformation(this._gizmo,this._gizmoIndex);var i=(new e.Vector3).setFromMatrixColumn(this._gizmo.matrixWorld,this._handleIndex).normalize();return i.clone().multiplyScalar((this._gizmoSize-12)*t).add(this._gizmo.position).applyMatrix4(this._matViewProj)};h.prototype.render=function(){l(this._viewport&&this._viewport.getMetadata().getName()==="sap.ui.vk.threejs.Viewport","Can't render gizmo without sap.ui.vk.threejs.Viewport");if(this._nodes.length>0){var e=this._viewport.getRenderer(),t=this._viewport.getCamera().getCameraRef();this._matViewProj.multiplyMatrices(t.projectionMatrix,t.matrixWorldInverse);e.clearDepth();for(var i=0,o=this.getGizmoCount();i<o;i++){this._updateGizmoTransformation(i,t);e.render(this._sceneGizmo,t)}}this._updateEditingForm(this._nodes.length>0&&this._gizmoIndex>=0&&this._handleIndex>=0&&this._handleIndex<3,this._handleIndex)};return h});
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/tools/RotateToolHandler", ["sap/ui/base/EventProvider","sap/m/Menu","sap/m/MenuItem","../getResourceBundle","../thirdparty/three","./CoordinateSystem"],function(t,e,i,s,n,r){"use strict";var o=t.extend("sap.ui.vk.tools.RotateToolHandler",{metadata:{library:"sap.ui.vk"},constructor:function(t){this._priority=12;this._tool=t;this._gizmo=t.getGizmo();this._rect=null;this._rayCaster=new n.Raycaster;this._rayCaster.linePrecision=.2;this._handleIndex=-1;this._gizmoIndex=-1;this._matrixOrigin=new n.Matrix4;this._levelingQuaternion=new n.Quaternion;this._mouse=new n.Vector2;this._mouseOrigin=new n.Vector2}});o.prototype._updateMouse=function(t){var e=this.getViewport().getRenderer().getSize(new n.Vector2);this._mouse.x=(t.x-this._rect.x)/e.width*2-1;this._mouse.y=(t.y-this._rect.y)/e.height*-2+1;this._rayCaster.setFromCamera(this._mouse,this.getViewport().getCamera().getCameraRef())};o.prototype._updateHandles=function(t,e){var i=this._handleIndex;this._handleIndex=-1;if(t.n===1||t.event&&t.event.type==="contextmenu"){for(var s=0,n=this._gizmo.getGizmoCount();s<n;s++){var r=this._gizmo.getTouchObject(s);var o=this._rayCaster.intersectObject(r,true);if(o.length>0){this._handleIndex=r.children.indexOf(o[0].object);if(this._handleIndex>=0&&this._handleIndex<3){this._gizmoIndex=s;this._matrixOrigin.copy(r.matrixWorld);this._gizmo._getLevelingQuaternion(this._levelingQuaternion,s);this._objectSize=this._gizmo._getObjectSize(s)/this._gizmo._getGizmoScale(r.position)}}}}this._gizmo.highlightHandle(this._handleIndex,e||this._handleIndex===-1);if(i!==this._handleIndex){this.getViewport().setShouldRenderFrame(true)}};o.prototype.hover=function(t){if(this._inside(t)&&!this._gesture){this._updateMouse(t);this._updateHandles(t,true);t.handled|=this._handleIndex>=0}};o.prototype.click=function(t){if(this._inside(t)&&!this._gesture){this._updateMouse(t);this._updateHandles(t,true);this._gizmo.selectHandle(this._handleIndex,this._gizmoIndex);t.handled|=this._handleIndex>=0}};o.prototype._getMouseAngle=function(){var t=this._rayCaster.ray;var e=this._rotationPoint.clone().sub(t.origin);var i=this._rotationAxis.dot(e)/this._rotationAxis.dot(t.direction);var s=t.direction.clone().multiplyScalar(i).sub(e).normalize();return Math.atan2(s.dot(this._axis2),s.dot(this._axis1))};o.prototype.beginGesture=function(t){if(this._inside(t)&&!this._gesture){this._updateMouse(t);this._updateHandles(t,false);if(this._handleIndex>=0&&this._handleIndex<3){t.handled=true;this._gesture=true;this._mouseOrigin.copy(t);this._gizmo.selectHandle(this._handleIndex,this._gizmoIndex);this._gizmo.beginGesture();this._axis1=(new n.Vector3).setFromMatrixColumn(this._matrixOrigin,(this._handleIndex+1)%3).normalize();this._axis2=(new n.Vector3).setFromMatrixColumn(this._matrixOrigin,(this._handleIndex+2)%3).normalize();this._rotationAxis=(new n.Vector3).crossVectors(this._axis1,this._axis2).normalize();this._rotationPoint=(new n.Vector3).setFromMatrixPosition(this._matrixOrigin);if(Math.abs(this._rayCaster.ray.direction.dot(this._rotationAxis))<Math.cos(Math.PI*85/180)){var e=this.getViewport().getCamera().getCameraRef().matrixWorld;this._axis1.setFromMatrixColumn(e,0).normalize();this._axis2.setFromMatrixColumn(e,1).normalize();this._rotationAxis.setFromMatrixColumn(e,2).normalize()}this._startAngle=this._getMouseAngle();this._prevDeltaAngle=0}}};o.prototype.move=function(t){if(this._gesture){t.handled=true;this._updateMouse(t);var e=this._startAngle;var i=this._getMouseAngle()-e;if(i>Math.PI){i-=Math.PI*2}else if(i<-Math.PI){i+=Math.PI*2}if(Math.abs(this._prevDeltaAngle)>Math.PI/4){if(this._prevDeltaAngle*i<0){i+=Math.PI*2*Math.sign(this._prevDeltaAngle)}}i=i%(Math.PI*2);var s=e+i;if(this._tool.getEnableStepping()){var r=5;if(this._objectSize>0){var o=[.1,1,5,15];var a=[2e3,1e3,300,0];for(var h=0;h<4;h++){if(this._objectSize>=a[h]){r=o[h];break}}}r=n.MathUtils.degToRad(r);var _=s-e;s+=Math.round(_/r)*r-_}this._prevDeltaAngle=s-e;if(isFinite(e)&&isFinite(s)){this._gizmo._setRotationAxisAngle(this._handleIndex,e,s)}}};o.prototype.endGesture=function(t){if(this._gesture){this._gesture=false;t.handled=true;this._updateMouse(t);this._gizmo.endGesture();this._updateHandles(t,true);this.getViewport().setShouldRenderFrame()}};o.prototype.contextMenu=function(t){if(!this._tool.getAllowContextMenu()){return}if(this._inside(t)){this._updateMouse(t);this._updateHandles(t,true);if(this._handleIndex>=0){t.handled=true;var n=new e({items:[new i({text:s().getText("TOOL_COORDINATE_SYSTEM_WORLD"),key:r.World}),new i({text:s().getText("TOOL_COORDINATE_SYSTEM_LOCAL"),key:r.Local}),new i({text:s().getText("TOOL_COORDINATE_SYSTEM_SCREEN"),key:r.Screen}),new i({text:s().getText("TOOL_COORDINATE_SYSTEM_CUSTOM"),key:r.Custom})],itemSelected:function(t){var e=t.getParameters("item").item;this._tool.setCoordinateSystem(e.getKey())}.bind(this)});n.openAsContextMenu(t.event,this.getViewport())}}};o.prototype.getViewport=function(){return this._tool._viewport};o.prototype._getOffset=function(t){var e=t.getBoundingClientRect();var i={x:e.left+window.pageXOffset,y:e.top+window.pageYOffset};return i};o.prototype._inside=function(t){var e=this._tool._viewport.getIdForLabel();var i=document.getElementById(e);if(i===null){return false}var s=this._getOffset(i);this._rect={x:s.x,y:s.y,w:i.offsetWidth,h:i.offsetHeight};return t.x>=this._rect.x&&t.x<=this._rect.x+this._rect.w&&t.y>=this._rect.y&&t.y<=this._rect.y+this._rect.h};return o});
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/tools/RotateTurntableTool", ["./Tool","../helpers/RotateTurntableHelperDvl","../helpers/RotateTurntableHelperThree"],function(t,e,r){"use strict";var i=t.extend("sap.ui.vk.tools.RotateTurntableTool",{metadata:{library:"sap.ui.vk",events:{rotate:{parameters:{dx:"int",dy:"int"}}}},constructor:function(e,r){if(i._instance){return i._instance}t.apply(this,arguments);this.setToolid("f271c082-676c-adc6-167f-0d5ce602aa45");this._viewport=null;this._rotateTurntableHelper=null;i._instance=this;return this}});i.prototype.init=function(){if(t.prototype.init){t.prototype.init.call(this)}this.setFootprint(["sap.ui.vk.dvl.Viewport","sap.ui.vk.threejs.Viewport"])};i.prototype.setActive=function(e,r,i){t.prototype.setActive.call(this,e,r,i);if(this._viewport){if(e){if(this._prepare()){this._rotateTurntableHelper.activateTurntableMode()}}else if(this._rotateTurntableHelper){this._rotateTurntableHelper.deactivateTurntableMode();this._rotateTurntableHelper=null}}return this};i.prototype._prepare=function(){if(this.isViewportType("sap.ui.vk.dvl.Viewport")&&this._viewport._dvl){if(this._rotateTurntableHelper==null){this._dvlRendererId=this._viewport._dvlRendererId;this._dvl=this._viewport._dvl;this._rotateTurntableHelper=new e(this,this._dvl)}}if(this.isViewportType("sap.ui.vk.threejs.Viewport")){if(this._rotateTurntableHelper==null){this._rotateTurntableHelper=new r(this)}}else{return false}return true};i.prototype.rotate=function(t,e){if(this._prepare()){this._rotateTurntableHelper.rotate(t,e)}};i.prototype.destroy=function(){t.prototype.destroy.call(this);this._viewport=null;this._rotateTurntableHelper=null};return i});
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/tools/ScaleTool", ["./Tool","./CoordinateSystem","./ScaleToolHandler","./ScaleToolGizmo","./ToolNodeSet","./GizmoPlacementMode"],function(e,t,o,i,s,n){"use strict";var r=e.extend("sap.ui.vk.tools.ScaleTool",{metadata:{library:"sap.ui.vk",properties:{coordinateSystem:{type:"sap.ui.vk.tools.CoordinateSystem",defaultValue:t.World},nonUniformScaleEnabled:{type:"boolean",defaultValue:false},enableStepping:{type:"boolean",defaultValue:false},enableSnapping:{type:"boolean",defaultValue:false},showEditingUI:{type:"boolean",defaultValue:false},autoResetValues:{type:"boolean",defaultValue:true},allowContextMenu:{type:"boolean",defaultValue:true},nodeSet:{type:"sap.ui.vk.tools.ToolNodeSet",defaultValue:s.Highlight},placementMode:{type:"sap.ui.vk.tools.GizmoPlacementMode",defaultValue:n.Default}},events:{scaling:{parameters:{x:"float",y:"float",z:"float",nodesProperties:"any[]"}},scaled:{parameters:{x:"float",y:"float",z:"float",nodesProperties:"any[]"}},coordinateSystemChanged:{parameters:{coordinateSystem:"sap.ui.vk.tools.CoordinateSystem"}},placementModeChanged:{parameters:{placementMode:"sap.ui.vk.tools.GizmoPlacementMode"}}}},constructor:function(t,i){e.apply(this,arguments);this._viewport=null;this._handler=new o(this);this._gizmo=null}});r.prototype.init=function(){e.prototype.init.call(this);this.setFootprint(["sap.ui.vk.threejs.Viewport"]);this.setAggregation("gizmo",new i)};r.prototype.setActive=function(t,o,i){e.prototype.setActive.call(this,t,o,i);if(this._viewport){if(t){this._gizmo=this.getGizmo();this._gizmo.setCoordinateSystem(this.getCoordinateSystem());this._gizmo.setNonUniformScaleEnabled(this.getNonUniformScaleEnabled());this._gizmo.show(this._viewport,this);this._addLocoHandler()}else{this._removeLocoHandler();this._gizmo?.hide();this._gizmo=null}}return this};r.prototype.setPlacementMode=function(e){var t=this.getPlacementMode();if(t!==e){this.setProperty("placementMode",e,true);this.getGizmo().setPlacementMode(e);this._viewport?.setShouldRenderFrame();this.firePlacementModeChanged({placementMode:e})}return this};r.prototype.queueCommand=function(e){if(this._addLocoHandler()){if(this.isViewportType("sap.ui.vk.threejs.Viewport")){e()}}return this};r.prototype.setCoordinateSystem=function(e){var t=this.getCoordinateSystem();if(t!==e){this.setProperty("coordinateSystem",e,true);this.getGizmo().setCoordinateSystem(e);this._viewport?.setShouldRenderFrame();this.fireCoordinateSystemChanged({coordinateSystem:e})}return this};r.prototype.setNonUniformScaleEnabled=function(e){this.setProperty("nonUniformScaleEnabled",e,true);this.getGizmo().setNonUniformScaleEnabled(e);this._viewport?.setShouldRenderFrame();return this};r.prototype.setShowEditingUI=function(e){this.setProperty("showEditingUI",e,true);this._viewport?.setShouldRenderFrame();return this};r.prototype.setEnableSnapping=function(e){this.setProperty("enableSnapping",e,true);if(e&&this.getActive()){this.getGizmo()._computeBoundsTree()}else{this.getGizmo()._disposeBoundsTree()}return this};r.prototype.resetValues=function(){this.getGizmo().resetValues();this._viewport?.setShouldRenderFrame();return this};r.prototype.setNodeSet=function(e){this.setProperty("nodeSet",e,true);this._gizmo?.handleSelectionChanged()};r.prototype.scale=function(e,t,o,i){var s;if(i&&i!==this.getCoordinateSystem()){s=this.getCoordinateSystem();this.setCoordinateSystem(i)}this._gizmo?.scale(e,t,o);if(s){this.setCoordinateSystem(s)}this._gizmo?.endGesture();this._viewport?.setShouldRenderFrame();return this};r.prototype.prepareForCreatingScaleKey=function(e){if(this._gizmo){this._gizmo._prepareForCreatingKey(e);return this._gizmo._getNodesProperties()}return null};return r});
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/tools/ScaleToolGizmo", ["../thirdparty/three","./Gizmo","./CoordinateSystem","./AxisColours","../AnimationTrackType","sap/base/assert","sap/base/Log"],function(e,t,i,o,r,n,a){"use strict";var s=t.extend("sap.ui.vk.tools.ScaleToolGizmo",{metadata:{library:"sap.ui.vk"},renderer:{apiVersion:2,render:function(e,t){e.openStart("div",t);e.class("sapUiVkTransformationToolEdit");e.openEnd();e.renderControl(t._editingForm);e.close("div")}}});s.prototype.init=function(){t.prototype.init.apply(this);this._createEditingForm(null,64);this._gizmoIndex=-1;this._handleIndex=-1;this._value=(new e.Vector3).setScalar(1);this._scaleDelta=(new e.Vector3).setScalar(1);this._noHitScale=(new e.Vector3).setScalar(1);this._viewport=null;this._tool=null;this._nonUniformScaleEnabled=false;this._sceneGizmo=new e.Scene;const r=new e.DirectionalLight(16777215,.5*Math.PI);r.position.set(1,3,2);this._sceneGizmo.add(r);this._sceneGizmo.add(new e.AmbientLight(16777215,.5*Math.PI));this._gizmo=new e.Group;this._touchAreas=new e.Group;this._sceneGizmo.add(this._gizmo);this._coordinateSystem=i.World;this._nodes=[];this._matViewProj=new e.Matrix4;this._gizmoSize=96;var n=96,a=16/n,s=48/n;function l(t,i,o){var r=(new e.Matrix4).makeBasis(new e.Vector3(t.y,t.z,t.x),t,new e.Vector3(t.z,t.x,t.y));var l=new e.BoxGeometry(a,a,a);l.applyMatrix4(r);var c=new e.MeshLambertMaterial({color:i,transparent:true});var h=new e.Mesh(l,c);h.userData.color=i;if(t){h.position.copy(t);var d=1/n;var u=new e.CylinderGeometry(d,d,1,4);r.setPosition(t.clone().multiplyScalar(-.5));u.applyMatrix4(r);var f=new e.Mesh(u,c);f.renderOrder=1;h.add(f);r.setPosition(t)}var _=new e.BoxGeometry(s,s,s);_.applyMatrix4(r);o.add(new e.Mesh(_,c));return h}function c(t,i,o){var r=new e.BufferGeometry;var n=new Float32Array(6);n[t]=n[i+3]=.7;r.setAttribute("position",new e.Float32BufferAttribute(n,3));var a=new Float32Array(6);a[t]=a[i+3]=1;r.setAttribute("color",new e.Float32BufferAttribute(a,3));var s=new e.Line(r,new e.LineBasicMaterial({vertexColors:true,transparent:true,linewidth:window.devicePixelRatio}));s.userData.colors=a;var l=new e.BufferGeometry;var c=new Float32Array(9);c[3+t]=c[6+i]=.7;l.setAttribute("position",new e.Float32BufferAttribute(c,3));l.setIndex([0,1,2]);var h=new e.Mesh(l,new e.MeshBasicMaterial({color:16776960,opacity:.5,transparent:true,side:e.DoubleSide,visible:false}));h.renderOrder=1;s.add(h);o.add(h.clone());return s}this._gizmo.add(l(new e.Vector3(1,0,0),o.x,this._touchAreas));this._gizmo.add(l(new e.Vector3(0,1,0),o.y,this._touchAreas));this._gizmo.add(l(new e.Vector3(0,0,1),o.z,this._touchAreas));this._gizmo.add(c(1,2,this._touchAreas));this._gizmo.add(c(2,0,this._touchAreas));this._gizmo.add(c(0,1,this._touchAreas));a-=.1/n;var h=new e.MeshLambertMaterial({color:12632256,transparent:true});this._gizmo.add(new e.Mesh(new e.BoxGeometry(a,a,a),h));this._touchAreas.add(new e.Mesh(new e.BoxGeometry(s,s,s),new e.MeshBasicMaterial));this._axisTitles=this._createAxisTitles();this._sceneGizmo.add(this._axisTitles);this._updateGizmoPartVisibility()};s.prototype.hasDomElement=function(){return true};s.prototype._updateGizmoPartVisibility=function(){var e=this._coordinateSystem===i.Screen;var t=this._gizmo.children,o=this._touchAreas.children;t[2].visible=o[2].visible=!e;t[3].visible=t[4].visible=o[3].visible=o[4].visible=!e&&this._nonUniformScaleEnabled;t[5].visible=o[5].visible=this._nonUniformScaleEnabled;this._axisTitles.children[2].visible=!e};s.prototype.resetValues=function(){this._value.setScalar(1)};s.prototype.setCoordinateSystem=function(e){this._coordinateSystem=e;this._gizmoIndex=this._handleIndex=-1;this._updateGizmoPartVisibility()};s.prototype.setNonUniformScaleEnabled=function(e){this._nonUniformScaleEnabled=!!e;this._updateGizmoPartVisibility()};s.prototype.show=function(e,t){this._viewport=e;this._tool=t;this._nodes.length=0;this._sequence=null;this._updateSelection(e._viewStateManager);var i=this._getNodesProperties();this._tool.fireEvent("scaling",{x:0,y:0,z:0,nodesProperties:i},true);this._attachVisibilityChanged()};s.prototype.hide=function(){this._detachVisibilityChanged();this._cleanTempData();this._disposeBoundsTree();this._viewport=null;this._tool=null;this._gizmoIndex=this._handleIndex=-1;this._sequence=null;this._updateEditingForm(false)};s.prototype._onVisibilityChanged=function(e){if(this._tool.getEnableSnapping()){this._computeBoundsTree()}};s.prototype.getGizmoCount=function(){if(this._coordinateSystem===i.Local||this._coordinateSystem===i.Parent){return this._nodes.length}else{return this._nodes.length>0?1:0}};s.prototype.getTouchObject=function(e){if(this._nodes.length===0){return null}this._updateGizmoObjectTransformation(this._touchAreas,e);return this._touchAreas};var l=[1,2,4,6,5,3];s.prototype.highlightHandle=function(e,t){var i=e===6||e>=0&&!this._nonUniformScaleEnabled;var o,r;for(o=0;o<3;o++){r=this._gizmo.children[o];var n=i||l[e]&1<<o;var a=n?16776960:r.userData.color;r.material.color.setHex(a);r.children[0].material.color.setHex(a);r.children[0].material.opacity=r.material.opacity=n||t?1:.35;var s=this._axisTitles.children[o];s.material.color.setHex(a);s.material.opacity=n||t?1:.35}for(o=3;o<6;o++){r=this._gizmo.children[o];var c=r.geometry.attributes.color;c.copyArray(i||o===e?[1,1,0,1,1,0]:r.userData.colors);c.needsUpdate=true;r.material.opacity=t||o===e?1:.35;r.children[0].material.visible=o===e}r=this._gizmo.children[6];r.material.color.setHex(i?16776960:12632256);r.material.opacity=i||t?1:.35};s.prototype.selectHandle=function(e,t){this._gizmoIndex=t;this._handleIndex=e;if(this._tool.getAutoResetValues()){this.resetValues()}this._viewport.setShouldRenderFrame(true)};s.prototype.beginGesture=function(){this._beginValue=this._value.clone();this._scaleDelta.setScalar(1);this._noHitScale.setScalar(1);this._nodes.forEach((t,i)=>{this._updateGizmoObjectTransformation(this._gizmo,i);t.matGizmo=this._gizmo.matrixWorld.clone();t.scaleOrigin=t.node.scale.clone();t.matOrigin=t.node.matrixWorld.clone();if(t.node.parent){t.matParentInv=(new e.Matrix4).copy(t.node.parent.matrixWorld).invert()}else{t.matParentInv=new e.Matrix4}})};s.prototype._prepareForCreatingScaleKey=function(e){this._sequence=e};s.prototype._printEventInfo=function(e,t,i,o,r){a.debug(e+" is fired:"+" x = "+t+"; y = "+i+"; z = "+o);r.forEach(function(e){a.debug("Node: "+e.node.name);if(e.offsetToRest){a.debug("offsetToRest: [ "+e.offsetToRest[0]+", "+e.offsetToRest[1]+", "+e.offsetToRest[2]+" ] ")}else{a.debug("offsetToRest: null")}if(e.offsetToPrevious){a.debug("offsetToPrevious: [ "+e.offsetToPrevious[0]+", "+e.offsetToPrevious[1]+", "+e.offsetToPrevious[2]+" ] ")}else{a.debug("offsetToPrevious: null")}if(e.absolute){a.debug("absolute: [ "+e.absolute[0]+", "+e.absolute[1]+", "+e.absolute[2]+" ] ")}else{a.debug("absolute: null")}if(e.world){a.debug("world: [ "+e.world[0]+", "+e.world[1]+", "+e.world[2]+" ] ")}else{a.debug("world: null")}if(e.restDifference){a.debug("restDifference: [ "+e.restDifference[0]+", "+e.restDifference[1]+", "+e.restDifference[2]+" ] ")}else{a.debug("restDifference: null")}if(e.restDifferenceInCoordinates){a.debug("restDifferenceInCoordinates: [ "+e.restDifferenceInCoordinates[0]+", "+e.restDifferenceInCoordinates[1]+", "+e.restDifferenceInCoordinates[2]+" ] ")}else{a.debug("restDifferenceInCoordinates: null")}})};s.prototype._getNodesProperties=function(){var t=[];this._nodes.forEach(function(o){var n=o.node;const a={node:n};var s=this._viewport._viewStateManager.getRelativeTransformation(n);a.offsetToRest=[s.scale[0],s.scale[1],s.scale[2]];a.offsetToPrevious=a.offsetToRest.slice();var l=this._getEffectiveParent(n);if(l!==n.parent){if(n.userData.skipUpdateJointNode){this._viewport._viewStateManager._setJointNodeOffsets(n,r.Scale)}if(n.userData&&n.userData.offsetScale){a.offsetToRest=n.userData.offsetScale.slice()}else{a.offsetToRest=[1,1,1]}a.offsetToPrevious=a.offsetToRest.slice();if(n.userData.skipUpdateJointNode){n.userData.skipUpdateJointNode=false;this._viewport._viewStateManager._setJointNodeMatrix();n.userData.skipUpdateJointNode=true}}if(this._playback){var c=this._viewport._viewStateManager._getEndPropertyInPreviousPlayback(n,r.Scale,this._playback);if(c){a.offsetToPrevious[0]/=c[0];a.offsetToPrevious[1]/=c[1];a.offsetToPrevious[2]/=c[2]}}var h=this._viewport._viewStateManager.getTransformation(n);a.absolute=[h.scale[0],h.scale[1],h.scale[2]];var d=this._viewport._viewStateManager.getTransformationWorld(n);a.world=d.scale;const u=this._nodeUserDataMap?.get(n);o.matParentInv??=n.parent.matrixWorld.clone().invert();const f=(o.matGizmo??this._gizmo.matrixWorld).clone();var _=new e.Vector3;var p,m,v;if(u?.initialScale){a.restDifference=[h.scale[0]/u.initialScale[0],h.scale[1]/u.initialScale[1],h.scale[2]/u.initialScale[2]];v=new e.Vector3(a.restDifference[0],a.restDifference[1],a.restDifference[2]);var g=new e.Quaternion(h.quaternion[0],h.quaternion[1],h.quaternion[2],h.quaternion[3]);var y=(new e.Matrix4).makeRotationFromQuaternion(g);var w=(new e.Matrix4).makeRotationFromQuaternion(u.initialQuaternion);var x=new e.Vector3;var z=new e.Vector3;var b=new e.Vector3;y.extractBasis(x,z,b);var S=new e.Vector3;var M=new e.Vector3;var D=new e.Vector3;w.extractBasis(S,M,D);if(x.dot(S)<0){a.restDifference[0]=-a.restDifference[0]}if(z.dot(M)<0){a.restDifference[1]=-a.restDifference[1]}if(b.dot(D)<0){a.restDifference[2]=-a.restDifference[2]}p=n.parent.matrixWorld.clone().scale(v).multiply(o.matParentInv);p.decompose(new e.Vector3,new e.Quaternion,_);if(this._coordinateSystem===i.World){a.restDifferenceInCoordinates=[_.x,_.y,_.z]}else{m=(new e.Matrix4).copy(f).invert().multiply(p).multiply(f);m.decompose(new e.Vector3,new e.Quaternion,_);a.restDifferenceInCoordinates=[_.x,_.y,_.z]}var V=this._alignAxesBetweenGizmoAndNodeCoordinates(n);for(var I=0;I<3;I++){if(a.restDifference[I]>0){a.restDifferenceInCoordinates[V[I]]=Math.abs(a.restDifferenceInCoordinates[V[I]])}else{a.restDifferenceInCoordinates[V[I]]=-Math.abs(a.restDifferenceInCoordinates[V[I]])}}}t.push(a)},this);return t};s.prototype.endGesture=function(){var e=this._getNodesProperties();delete this._beginValue;this._nodes.forEach(e=>{var t=e.node;delete t.userData.skipUpdateJointNode;this._viewport._viewStateManager._setJointNodeOffsets(t,r.Scale)});this._tool.fireScaled({x:this._scaleDelta.x,y:this._scaleDelta.y,z:this._scaleDelta.z,nodesProperties:e});this._printEventInfo("Event 'scaled'",this._scaleDelta.x,this._scaleDelta.y,this._scaleDelta.z,e)};s.prototype._alignAxesBetweenGizmoAndNodeCoordinates=function(t,i){function o(e,t,i,o){var r=Math.abs(e.dot(t));var n=Math.abs(e.dot(i));var a=Math.abs(e.dot(o));if(r>=n&&r>=a){return 0}else if(n>=r&&n>=a){return 1}else{return 2}}var r=t.parent.matrixWorld.clone().multiply((new e.Matrix4).makeRotationFromQuaternion(t.quaternion.clone()));var n=new e.Vector3;var a=new e.Vector3;var s=new e.Vector3;r.extractBasis(n,a,s);n.normalize();a.normalize();s.normalize();const l=this._gizmo.matrixWorld.clone();var c=new e.Vector3;var h=new e.Vector3;var d=new e.Vector3;l.extractBasis(c,h,d);c.normalize();h.normalize();d.normalize();var u=[];var f;if(i){f=o(c,n,a,s);u.push(f);f=o(h,n,a,s);u.push(f);f=o(d,n,a,s);u.push(f)}else{f=o(n,c,h,d);u.push(f);f=o(a,c,h,d);u.push(f);f=o(s,c,h,d);u.push(f)}return u};s.prototype._scale=function(t,o){function r(e,t,i,o){if(t===0){if(o&&i.x>0||!o&&i.x<0){e.x=Math.abs(e.x)}else{e.x=-Math.abs(e.x)}}else if(t===1){if(o&&i.y>0||!o&&i.y<0){e.y=Math.abs(e.y)}else{e.y=-Math.abs(e.y)}}else if(t===2){if(o&&i.z>0||!o&&i.z<0){e.z=Math.abs(e.z)}else{e.z=-Math.abs(e.z)}}}this._value.multiplyVectors(this._beginValue,t);this._scaleDelta.copy(t);this._nodes.forEach(function(e){var t=e.node;t.userData.skipUpdateJointNode=true});this._nodes.forEach(o=>{if(!o.ignore){var n=o.node;const c=o.matGizmo.clone().scale(t).multiply(o.matGizmo.clone().invert());n.matrixWorld.multiplyMatrices(c,o.matOrigin);n.matrix.multiplyMatrices(o.matParentInv,n.matrixWorld);if(this._coordinateSystem===i.Parent){var a=(new e.Matrix4).makeRotationFromQuaternion(n.quaternion.clone().invert()).multiply(n.matrix);var s=a.elements;n.scale.x=s[0];n.scale.y=s[5];n.scale.z=s[10]}else{n.matrix.decompose(n.position,new e.Quaternion,n.scale);var l=this._alignAxesBetweenGizmoAndNodeCoordinates(n,true);r(n.scale,l[0],o.scaleOrigin,t.x>0);r(n.scale,l[1],o.scaleOrigin,t.y>0);r(n.scale,l[2],o.scaleOrigin,t.z>0)}n.updateMatrix();n.updateMatrixWorld(true)}});if(!o&&this._tool.getEnableSnapping()){if(this._checkSceneSelectionIntersection()){const i=new e.Vector3;for(let e=0;e<6;e++){i.copy(t).add(this._noHitScale).multiplyScalar(.5);this._scale(i,true);(this._checkSceneSelectionIntersection()?t:this._noHitScale).copy(i)}if(!this._noHitScale.equals(i)){this._scale(this._noHitScale,true)}}else{this._noHitScale.copy(t)}}this._viewport.setShouldRenderFrame()};s.prototype.scale=function(t,i,o){this.beginGesture();this._scale(new e.Vector3(t,i,o))};s.prototype._setScale=function(e){var t=this._getNodesProperties();if(this._tool.fireEvent("scaling",{x:e.x,y:e.y,z:e.z,nodesProperties:t},true)){this._printEventInfo("Event 'scaling'",e.x,e.y,e.z,t);this._scale(e)}};s.prototype.getValue=function(){return this._gizmoIndex>=0&&this._handleIndex>=0&&this._handleIndex<3?this._value.getComponent(this._handleIndex):1};s.prototype.setValue=function(t){if(this._gizmoIndex>=0&&this._handleIndex>=0&&this._handleIndex<3){var i=t/this._value.getComponent(this._handleIndex);var o=new e.Vector3(1,1,1);if(this._nonUniformScaleEnabled){o.setComponent(this._handleIndex,i)}else{o.setScalar(i)}this.beginGesture();this._scale(o);this.endGesture()}};s.prototype.expandBoundingBox=function(e){if(this._viewport){this._expandBoundingBox(e,this._viewport.getCamera().getCameraRef(),true)}};s.prototype._updateSelection=function(e){t.prototype._updateSelection.call(this,e);if(this._tool.getEnableSnapping()){this._computeBoundsTree()}};s.prototype.handleSelectionChanged=function(e){this._sequence=null;if(this._viewport){this._updateSelection(this._viewport._viewStateManager);this._gizmoIndex=this._handleIndex=-1;var t=this._getNodesProperties();this._tool.fireEvent("scaling",{x:0,y:0,z:0,nodesProperties:t},true)}};s.prototype._getObjectScale=function(t){if(this._nodes.length===1){return this._nodes[0].node.scale}else if(this._coordinateSystem===i.Local){return this._nodes[t].node.scale}return new e.Vector3(1,1,1)};s.prototype._getObjectSize=function(t){var o=new e.Box3;if(this._nodes.length===1){this._nodes[0].node._expandBoundingBox(o,true,false)}else if(this._coordinateSystem===i.Local){this._nodes[0].node._expandBoundingBox(o,true,false)}if(o.isEmpty()){return 0}var r=new e.Vector3;o.getSize(r);return r.length()};s.prototype._updateGizmoTransformation=function(e,t){var i=this._updateGizmoObjectTransformation(this._gizmo,e);this._updateAxisTitles(this._axisTitles,this._gizmo,t,this._gizmoSize+30,i)};s.prototype._getEditingFormPosition=function(){var t=this._updateGizmoObjectTransformation(this._gizmo,this._gizmoIndex);var i=(new e.Vector3).setFromMatrixColumn(this._gizmo.matrixWorld,this._handleIndex).normalize();return i.clone().multiplyScalar((this._gizmoSize+18)*t).add(this._gizmo.position).applyMatrix4(this._matViewProj)};s.prototype.render=function(){n(this._viewport&&this._viewport.getMetadata().getName()==="sap.ui.vk.threejs.Viewport","Can't render gizmo without sap.ui.vk.threejs.Viewport");if(this._nodes.length>0){var e=this._viewport.getRenderer(),t=this._viewport.getCamera().getCameraRef();this._matViewProj.multiplyMatrices(t.projectionMatrix,t.matrixWorldInverse);e.clearDepth();for(var i=0,o=this.getGizmoCount();i<o;i++){this._updateGizmoTransformation(i,t);e.render(this._sceneGizmo,t)}}this._updateEditingForm(this._nodes.length>0&&this._gizmoIndex>=0&&this._handleIndex>=0&&this._handleIndex<3,this._handleIndex)};return s});
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/tools/ScaleToolHandler", ["sap/ui/base/EventProvider","sap/m/Menu","sap/m/MenuItem","../getResourceBundle","../thirdparty/three","./CoordinateSystem"],function(e,t,i,s,n,r){"use strict";var o=e.extend("sap.ui.vk.tools.ScaleToolHandler",{metadata:{library:"sap.ui.vk"},constructor:function(e){this._priority=11;this._tool=e;this._gizmo=e.getGizmo();this._rect=null;this._rayCaster=new n.Raycaster;this._handleIndex=-1;this._gizmoIndex=-1;this._handleAxis=new n.Vector3;this._handleDirection=new n.Vector3;this._gizmoOrigin=new n.Vector3;this._mouse=new n.Vector2;this._mouseOrigin=new n.Vector2;this._originScale=1;this._objectSize=1}});o.prototype._updateMouse=function(e){var t=this.getViewport().getRenderer().getSize(new n.Vector2);this._mouse.x=(e.x-this._rect.x)/t.width*2-1;this._mouse.y=(e.y-this._rect.y)/t.height*-2+1;this._rayCaster.setFromCamera(this._mouse,this.getViewport().getCamera().getCameraRef())};o.prototype._updateHandles=function(e,t){var i=this._handleIndex;this._handleIndex=-1;if(e.n===1||e.event&&e.event.type==="contextmenu"){for(var s=0,r=this._gizmo.getGizmoCount();s<r;s++){var o=this._gizmo.getTouchObject(s);var h=this._rayCaster.intersectObjects(o.children,false);if(h.length>0){this._handleIndex=o.children.indexOf(h[0].object);if(this._handleIndex>=0){this._gizmoIndex=s;this._gizmoOrigin.setFromMatrixPosition(o.matrixWorld);this._handleAxis.setFromMatrixColumn(o.matrixWorld,this._handleIndex%3).normalize();this._originScale=this._gizmo._getObjectScale(s).x;this._objectSize=this._gizmo._getObjectSize(s)/o.scale.x||1;var a=(new n.Vector3).setFromMatrixColumn(o.matrixWorld,(this._handleIndex+1)%3).normalize();var d=(new n.Vector3).setFromMatrixColumn(o.matrixWorld,(this._handleIndex+2)%3).normalize();this._handleDirection.addVectors(a,d).normalize()}}}}this._gizmo.highlightHandle(this._handleIndex,t||this._handleIndex===-1);if(i!==this._handleIndex){this.getViewport().setShouldRenderFrame(true)}};o.prototype.hover=function(e){if(this._inside(e)&&!this._gesture){this._updateMouse(e);this._updateHandles(e,true);e.handled|=this._handleIndex>=0}};o.prototype.click=function(e){if(this._inside(e)&&!this._gesture){this._updateMouse(e);this._updateHandles(e,true);this._gizmo.selectHandle(this._handleIndex,this._gizmoIndex);e.handled|=this._handleIndex>=0}};o.prototype._getAxisOffset=function(){var e=this._rayCaster.ray;var t=this._handleAxis.clone().cross(e.direction).cross(e.direction).normalize();var i=e.origin.clone().sub(this._gizmoOrigin);return t.dot(i)/t.dot(this._handleAxis)};o.prototype._getPlaneOffset=function(){var e=this._rayCaster.ray;var t=this._gizmoOrigin.clone().sub(e.origin);var i=this._handleAxis.dot(t)/this._handleAxis.dot(e.direction);return e.direction.clone().multiplyScalar(i).sub(t)};o.prototype.beginGesture=function(e){if(this._inside(e)&&!this._gesture){this._updateMouse(e);this._updateHandles(e,false);if(this._handleIndex>=0){this._gesture=true;e.handled=true;this._mouseOrigin.set(e.x,e.y);this._gizmo.selectHandle(this._handleIndex,this._gizmoIndex);this._gizmo.beginGesture();if(this._handleIndex<3){this._dragOrigin=this._getAxisOffset()}else if(this._handleIndex<6){this._dragOrigin=this._handleDirection.dot(this._getPlaneOffset())}}}};o.prototype.move=function(e){if(this._gesture){e.handled=true;this._updateMouse(e);var t=(new n.Vector3).setScalar(1);if(this._handleIndex<3){if(this._tool.getNonUniformScaleEnabled()){t.setComponent(this._handleIndex,this._getAxisOffset()/this._dragOrigin)}else{t.setScalar(this._getAxisOffset()/this._dragOrigin)}}else if(this._handleIndex<6){t.setScalar(this._handleDirection.dot(this._getPlaneOffset())/this._dragOrigin).setComponent(this._handleIndex-3,1)}else{var i=(this._mouseOrigin.y-e.y)/60;t.setScalar(i>=0?1+i:1/(1-i))}if(t.x&&t.y&&t.z&&isFinite(t.x)&&isFinite(t.y)&&isFinite(t.z)){if(this._tool.getEnableStepping()){var s=Math.pow(10,Math.round(Math.log10(this._originScale/this._objectSize)))/this._originScale;if(s>0&&isFinite(s)){t.setScalar(Math.max(Math.round(t.x/s),1)*s)}}this._gizmo._setScale(t)}}};o.prototype.endGesture=function(e){if(this._gesture){this._gesture=false;e.handled=true;this._updateMouse(e);this._gizmo.endGesture();this._dragOrigin=undefined;this._updateHandles(e,true);this.getViewport().setShouldRenderFrame()}};o.prototype.contextMenu=function(e){if(!this._tool.getAllowContextMenu()){return}if(this._inside(e)){this._updateMouse(e);this._updateHandles(e,true);if(this._handleIndex>=0){e.handled=true;var n=new t({items:[new i({text:s().getText("TOOL_COORDINATE_SYSTEM_WORLD"),key:r.World}),new i({text:s().getText("TOOL_COORDINATE_SYSTEM_LOCAL"),key:r.Local}),new i({text:s().getText("TOOL_COORDINATE_SYSTEM_SCREEN"),key:r.Screen}),new i({text:s().getText("TOOL_COORDINATE_SYSTEM_CUSTOM"),key:r.Custom})],itemSelected:function(e){var t=e.getParameters("item").item;this._tool.setCoordinateSystem(t.getKey())}.bind(this)});n.openAsContextMenu(e.event,this.getViewport())}}};o.prototype.getViewport=function(){return this._tool._viewport};o.prototype._getOffset=function(e){var t=e.getBoundingClientRect();var i={x:t.left+window.pageXOffset,y:t.top+window.pageYOffset};return i};o.prototype._inside=function(e){var t=this._tool._viewport.getIdForLabel();var i=document.getElementById(t);if(i===null){return false}var s=this._getOffset(i);this._rect={x:s.x,y:s.y,w:i.offsetWidth,h:i.offsetHeight};return e.x>=this._rect.x&&e.x<=this._rect.x+this._rect.w&&e.y>=this._rect.y&&e.y<=this._rect.y+this._rect.h};return o});
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/tools/SceneOrientationTool", ["./Tool","./SceneOrientationToolGizmo"],function(t,e){"use strict";var i=t.extend("sap.ui.vk.tools.SceneOrientationTool",{metadata:{library:"sap.ui.vk",properties:{enablePredefinedViews:{type:"boolean",defaultValue:true},enableInitialView:{type:"boolean",defaultValue:true}}},constructor:function(e,o){if(i._instance){return i._instance}t.apply(this,arguments);this._viewport=null;this._menu=null;i._instance=this;return this}});i.prototype.init=function(){if(t.prototype.init){t.prototype.init.call(this)}this.setFootprint(["sap.ui.vk.threejs.Viewport"]);this.setAggregation("gizmo",new e)};i.prototype.setActive=function(e,i,o){t.prototype.setActive.call(this,e,i,o);this.getGizmo()._viewport=this._viewport;return this};i.prototype.setView=function(t,e){this.getGizmo().setView(t,e);return this};i.prototype.setEnableInitialView=function(t){this.setProperty("enableInitialView",t);this.getGizmo().setEnableInitialView(t)};i.prototype.queueCommand=function(t){if(this.isViewportType("sap.ui.vk.dvl.Viewport")){if(this._dvlRendererId){this._dvl.Renderer._queueCommand(t,this._dvlRendererId)}}else if(this.isViewportType("sap.ui.vk.threejs.Viewport")){t()}return this};i.prototype.destroy=function(){t.prototype.destroy.call(this);this._viewport=null;delete i._instance};return i});
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/tools/SceneOrientationToolGizmo", ["./Gizmo","sap/m/MenuButton","sap/m/Menu","sap/m/MenuItem","../thirdparty/three","../threejs/ThreeUtils","../getResourceBundle","./PredefinedView","./AxisColours"],function(e,t,i,n,a,r,s,o,l){"use strict";sap.ui.require("sap.m.Menu");var c=e.extend("sap.ui.vk.tools.SceneOrientationToolGizmo",{metadata:{library:"sap.ui.vk"},renderer:{apiVersion:2,render:function(e,t){e.openStart("div",t);e.class("sapUiVizKitSceneOrientationGizmo");e.openEnd();if(t.getParent().getEnablePredefinedViews()){e.renderControl(t._button)}e.close("div")}}});function d(e,t){var i=64,n=.5,r=15,s=3,o=29,l=30;e.multiplyScalar(1/80);var c=new a.Vector3(e.y,e.z,e.x),d=new a.Vector3(e.z,e.x,e.y);var p=new a.MeshLambertMaterial({color:t}),h=new a.MeshBasicMaterial({color:16777215,transparent:true,opacity:.8}),m=new a.MeshBasicMaterial({color:0,transparent:true,opacity:.8});var u=new a.CylinderGeometry(n,n,i-r,4);var w=(new a.Matrix4).makeBasis(c,e,d).setPosition(e.clone().multiplyScalar((i-r)*.5));u.applyMatrix4(w);var _=new a.Mesh(u,p);var y=new a.CylinderGeometry(0,s,r,12,1);w.setPosition(e.clone().multiplyScalar(i-r*.5));y.applyMatrix4(w);_.add(new a.Mesh(y,p));var x=new a.CylinderGeometry(n,n,o,4);w.makeBasis(e,d,c).setPosition(d.clone().multiplyScalar(.5).add(e).multiplyScalar(o));x.applyMatrix4(w);_.add(new a.Mesh(x,h));x=new a.CylinderGeometry(n,n,o,4);w.setPosition(d.clone().multiplyScalar(.5).add(e).add(c).multiplyScalar(o));x.applyMatrix4(w);_.add(new a.Mesh(x,h));x=new a.CylinderGeometry(n,n,o,4);w.makeBasis(d,c,e).setPosition(c.clone().multiplyScalar(.5).add(e).multiplyScalar(o));x.applyMatrix4(w);_.add(new a.Mesh(x,h));x=new a.CylinderGeometry(n,n,l,4);w.makeBasis(e,d,c).setPosition(d.clone().multiplyScalar(.5).add(e).multiplyScalar(l));x.applyMatrix4(w);_.add(new a.Mesh(x,m));x=new a.CylinderGeometry(n,n,l,4);w.setPosition(d.clone().multiplyScalar(.5).add(e).add(c).multiplyScalar(l));x.applyMatrix4(w);_.add(new a.Mesh(x,m));x=new a.CylinderGeometry(n,n,l,4);w.makeBasis(d,c,e).setPosition(c.clone().multiplyScalar(.5).add(e).multiplyScalar(l));x.applyMatrix4(w);_.add(new a.Mesh(x,m));return _}c.prototype.init=function(){if(e.prototype.init){e.prototype.init.apply(this)}this._enableInitialView=true;this._viewport=null;this._renderer=r.createWebGLRenderer(window.devicePixelRatio,false);this._camera=new a.OrthographicCamera(-1,1,1,-1,.1,100);this._scene=new a.Scene;const c=new a.DirectionalLight(16777215,.5*Math.PI);c.position.set(1,3,2);this._scene.add(c);this._scene.add(new a.AmbientLight(16777215,.5*Math.PI));this._scene.add(d(new a.Vector3(1,0,0),l.x));this._scene.add(d(new a.Vector3(0,1,0),l.y));this._scene.add(d(new a.Vector3(0,0,1),l.z));this._scene.traverse(function(e){e.matrixAutoUpdate=false});this._axisTitles=this._createAxisTitles(32,16);this._scene.add(this._axisTitles);var p=[o.Initial,o.Front,o.Back,o.Left,o.Right,o.Top,o.Bottom];this._menu=new i({items:[new n({text:s().getText("PREDEFINED_VIEW_INITIAL")}),new n({text:s().getText("PREDEFINED_VIEW_FRONT")}),new n({text:s().getText("PREDEFINED_VIEW_BACK")}),new n({text:s().getText("PREDEFINED_VIEW_LEFT")}),new n({text:s().getText("PREDEFINED_VIEW_RIGHT")}),new n({text:s().getText("PREDEFINED_VIEW_TOP")}),new n({text:s().getText("PREDEFINED_VIEW_BOTTOM")})]}).attachItemSelected(function(e){var t=e.getParameters("item").item;var i=e.getSource().indexOfItem(t);this.setView(p[i],1e3)},this);this._button=new t({icon:"sap-icon://vk-icons/predefined-views",tooltip:s().getText("PREDEFINED_VIEW_MENUBUTTONTOOLTIP"),menu:this._menu}).addStyleClass("sapUiVizKitSceneOrientationGizmoButton").addStyleClass("sapUiSizeCompact")};c.prototype.setView=function(e,t){var i;switch(e){case o.Initial:i=null;break;case o.Front:i=(new a.Quaternion).setFromAxisAngle(new a.Vector3(0,1,0),0);break;case o.Back:i=(new a.Quaternion).setFromAxisAngle(new a.Vector3(0,1,0),Math.PI);break;case o.Left:i=(new a.Quaternion).setFromAxisAngle(new a.Vector3(0,1,0),-Math.PI/2);break;case o.Right:i=(new a.Quaternion).setFromAxisAngle(new a.Vector3(0,1,0),Math.PI/2);break;case o.Top:i=(new a.Quaternion).setFromAxisAngle(new a.Vector3(1,0,0),-Math.PI/2);break;case o.Bottom:i=(new a.Quaternion).setFromAxisAngle(new a.Vector3(1,0,0),Math.PI/2);break;default:return this}this._viewport._viewportGestureHandler.setView(i,t||0);return this};c.prototype.setEnableInitialView=function(e){this._enableInitialView=e;var t=this._menu.getItems();t[0].setVisible(e);t[1].setStartsSection(e)};c.prototype.render=function(e){this._viewport=e;this._camera.quaternion.copy(e.getCamera().getCameraRef().quaternion);this._camera.position.set(0,0,1).applyQuaternion(this._camera.quaternion);var t=this._renderer.getSize(new a.Vector2).x;this._updateAxisTitles(this._axisTitles,this._scene,this._camera,t*.45,2/t);this._renderer.render(this._scene,this._camera)};c.prototype.onBeforeRendering=function(){};c.prototype.onAfterRendering=function(){var e=this.getDomRef();this._renderer.setSize(e.clientWidth,e.clientHeight);e.appendChild(this._renderer.domElement)};c.prototype.exit=function(){if(this._axisTitles){if(this._scene){this._scene.remove(this._axisTitles)}this._axisTitles=null}if(this._camera){if(this._scene){this._scene.remove(this._camera)}this._camera=null}this._scene=null;e.prototype.exit.call(this)};return c});
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/tools/Tool", ["sap/ui/core/Element","sap/base/Log"],function(t,e){"use strict";var i=t.extend("sap.ui.vk.tools.Tool",{metadata:{library:"sap.ui.vk",properties:{targetViewportType:"any",toolid:"string",active:{type:"boolean",defaultValue:false},footprint:{type:"string[]"}},associations:{gizmoContainer:{type:"sap.ui.core.Control",multiple:false}},aggregations:{gizmo:{type:"sap.ui.vk.tools.Gizmo",multiple:false}},events:{enabled:{parameters:{enabled:"boolean",reason:"string"}}}},constructor:function(e,i){this._viewport=null;this._handler=null;t.apply(this,arguments)}});i.prototype.init=function(){if(t.prototype.init){t.prototype.init.call(this)}};i.prototype.getViewport=function(){return this._viewport};i.prototype.setViewport=function(t){var e=t&&t.getMetadata().getName();this._viewport=e!=null&&this.getFootprint().indexOf(e)>=0?t:null};i.prototype.isViewportType=function(t){if(this._viewport&&this._viewport.getMetadata().getName()===t){return true}return false};i.prototype.getViewportImplementation=function(t){var e=t;if(t&&typeof t.getImplementation==="function"){e=t.getImplementation()||t}return e};i.prototype.setActive=function(t,i,o){if(t===this.getProperty("active")){return}var r=this.getViewportImplementation(i)||this._viewport;var n=r&&r.getMetadata().getName();var a;if(this.getFootprint().indexOf(n)>=0){this._viewport=r;this.setProperty("active",t,true);if(this.getGizmo()){o=o||r;this.setAssociation("gizmoContainer",o);if(o.getDomRef()){o.invalidate()}}this._viewport.setShouldRenderFrame();a=t?"":"Disabled by application logic"}else{this._viewport=null;this.setProperty("active",false,true);a=`Tool ${this.getMetadata().getName()} does not support viewport type: ${n}`;e.warning(a)}this.fireEnabled({enabled:this.getActive(),reason:a})};i.prototype.getGizmoForContainer=function(t){var e=this.getGizmo();if(t.getId()===this.getGizmoContainer()&&e&&this.getActive()){return e}return undefined};i.prototype.destroy=function(){t.prototype.destroy.call(this);this._viewport=null;this._handler=null};i.prototype._addLocoHandler=function(){if(!this._viewport||!this._viewport._loco){return false}this._viewport._loco.addHandler(this._handler,this._handler._priority);return true};i.prototype._removeLocoHandler=function(t){if(this._viewport&&this._viewport._loco){this._viewport._loco.removeHandler(this._handler)}};return i});
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/tools/ToolHandlerBase", ["sap/ui/base/EventProvider"],function(t){"use strict";var o=t.extend("sap.ui.vk.tools.ToolHandlerBase",{metadata:{library:"sap.ui.vk"},constructor:function(t){this._priority=0;this._tool=t;this._rect=null}});o.prototype.destroy=function(){this._tool=null;this._rect=null};o.prototype.hover=function(t){};o.prototype.beginGesture=function(t){};o.prototype.move=function(t){};o.prototype.endGesture=function(t){};o.prototype.click=function(t){};o.prototype.doubleClick=function(t){};o.prototype.contextMenu=function(t){};o.prototype.getViewport=function(){return this._tool._viewport};o.prototype._getOffset=function(t){const o=t.getBoundingClientRect();const e={x:o.left+window.scrollX,y:o.top+window.scrollY};return e};o.prototype._inside=function(t){const o=this._tool._viewport.getIdForLabel();const e=document.getElementById(o);if(e==null){return false}const n=this._getOffset(e);this._rect={x:n.x,y:n.y,w:e.offsetWidth,h:e.offsetHeight};return t.x>=this._rect.x&&t.x<=this._rect.x+this._rect.w&&t.y>=this._rect.y&&t.y<=this._rect.y+this._rect.h};return o});
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/tools/ToolNodeSet", ["sap/ui/base/DataType"],function(e){"use strict";var i={Highlight:"Highlight",Outline:"Outline"};e.registerEnum("sap.ui.vk.tools.ToolNodeSet",i);return i},true);
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/tools/TooltipTool", ["./Tool","./TooltipToolHandler","./TooltipToolGizmo"],function(t,e,i){"use strict";var o=t.extend("sap.ui.vk.tools.TooltipTool",{metadata:{library:"sap.ui.vk",properties:{followCursor:{type:"boolean",defaultValue:true},animate:{type:"boolean",defaultValue:false},offsetX:{type:"float",defaultValue:10},offsetY:{type:"float",defaultValue:15},timeout:{type:"int",defaultValue:0}},events:{hover:{parameters:{x:"int",y:"int",nodeRef:"any"}}}},constructor:function(i,o){t.apply(this,arguments);this._handler=new e(this);return this}});o.prototype.init=function(){t.prototype.init.call(this);this.setFootprint(["sap.ui.vk.threejs.Viewport","sap.ui.vk.svg.Viewport"]);this.setAggregation("gizmo",new i)};o.prototype.setAnimate=function(t){this.setProperty("animate",t);var e=this.getGizmo();e.rerender()};o.prototype.setActive=function(e,i,o){t.prototype.setActive.call(this,e,i,o);if(this._viewport){if(e){this._gizmo=this.getGizmo();this._gizmo?.show(this._viewport,this);this._addLocoHandler()}else{this._handler._deactivate();this._removeLocoHandler();this._gizmo?.hide();this._gizmo=null}}return this};o.prototype.setTitle=function(t){this._gizmo?.setTitle(t);return this};o.prototype.queueCommand=function(t){if(this._addLocoHandler()){var e=this.getFootprint();for(var i=0;i<e.length;i++){if(this.isViewportType(e[i])){t();break}}}return this};return o});
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/tools/TooltipToolGizmo", ["./Gizmo"],function(t){"use strict";var o=t.extend("sap.ui.vk.tools.TooltipToolGizmo",{metadata:{library:"sap.ui.vk"},renderer:{apiVersion:2,render(t,o){t.openStart("div",o);t.class("sapUiVizKitTooltip");if(o.getParent().getAnimate()){t.class("sapUiVizKitTooltipAnimation")}t.openEnd();t.close("div")}}});o.prototype.init=function(){if(t.prototype.init){t.prototype.init.apply(this)}this._viewport=null;this._tool=null;this._previousNodeRef=null};o.prototype.show=function(t,o){this._viewport=t;this._tool=o;var e=this.getDomRef();if(e){e.style.display="none"}};o.prototype.hide=function(){this._tool=null;var t=this.getDomRef();if(t){t.style.display="none"}};o.prototype.setTitle=function(t){var o=this.getDomRef();if(o){o.style.display=t?"block":"none";o.innerText=t}};o.prototype.update=function(t,o,e,i,n){if(!this._tool.getFollowCursor()){if(n===this._previousNodeRef){return}else{this._previousNodeRef=n}}if(this._tool.fireEvent("hover",{x:t,y:o,nodeRef:n},true)){var r=this.getDomRef();if(r){var s=r.offsetParent;while(s){e-=s.offsetLeft||0;i-=s.offsetTop||0;s=s.offsetParent}e+=this._tool.getOffsetX();i+=this._tool.getOffsetY();r.style.left=Math.round(e)+"px";r.style.top=Math.round(i)+"px";var p=this._viewport.getDomRef().getBoundingClientRect();var f=r.getBoundingClientRect();if(f.right>p.right){r.style.left=Math.round(e+p.right-f.right)+"px"}if(f.bottom>p.bottom){r.style.top=Math.round(i+p.bottom-f.bottom)+"px"}}}};o.prototype.onBeforeRendering=function(){};o.prototype.onAfterRendering=function(){};return o});
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/tools/TooltipToolHandler", ["sap/ui/vk/tools/ToolHandlerBase"],function(t){"use strict";var i=t.extend("sap.ui.vk.tools.TooltipToolHandler",{metadata:{library:"sap.ui.vk"}});i.prototype.hover=function(t){const i=this._tool.getGizmo();const e=this.getViewport();if(i&&this._inside(t)&&e.getScene()){const o=t.x,s=t.y;const r=o-this._rect.x,n=s-this._rect.y;const c=()=>{this._timer=0;let t=e.hitTest(r,n);if(t?.object){t=t.object}if(e.isECAD?.()===true){t=e.findElement(t)}i.update(r,n,o,s,t)};const h=this._tool.getTimeout();if(h>0){if(this._timer){clearTimeout(this._timer)}this._timer=setTimeout(c,h)}else{c()}}};i.prototype._deactivate=function(){if(this._timer){clearTimeout(this._timer);this._timer=0}};t.prototype.beginGesture=function(t){const i=this._tool.getGizmo();if(i&&this._inside(t)){i.update(t.x-this._rect.x,t.y-this._rect.y,t.x,t.y,null)}};return i});
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/tools/TransformSvgElementTool", ["sap/base/Log","../library","./Tool","./TransformSvgElementToolHandler","./TransformSvgElementToolGizmo","./ToolNodeSet","../svg/Rectangle"],function(t,e,o,i,s,a,r){"use strict";var n=o.extend("sap.ui.vk.tools.TransformSvgElementTool",{metadata:{library:"sap.ui.vk",properties:{nodeSet:{type:"sap.ui.vk.tools.ToolNodeSet",defaultValue:a.Highlight},uniformScaleEnabled:{type:"boolean",defaultValue:false}},events:{moving:{parameters:{x:"float",y:"float",nodesProperties:{type:"any[]"}}},moved:{parameters:{x:"float",y:"float",nodesProperties:{type:"any[]"}}},rotating:{parameters:{angle:"float",nodesProperties:{type:"any[]"}}},rotated:{parameters:{angle:"float",nodesProperties:{type:"any[]"}}},scaling:{parameters:{x:"float",y:"float",nodesProperties:{type:"any[]"}}},scaled:{parameters:{x:"float",y:"float",nodesProperties:{type:"any[]"}}}}},constructor:function(t,e){if(n._instance){return n._instance}o.apply(this,arguments);this._viewport=null;this._handler=new i(this);n._instance=this;return this}});n.prototype.init=function(){if(o.prototype.init){o.prototype.init.call(this)}this.setFootprint(["sap.ui.vk.svg.Viewport","sap.ui.vk.pdf.Viewport"]);this.setAggregation("gizmo",new s)};n.prototype.setActive=function(t,e,i){o.prototype.setActive.call(this,t,e,i);var s=this._viewport;if(s){if(t){this._gizmo=this.getGizmo();if(this._gizmo){this._gizmo.show(s,this)}this._addLocoHandler()}else{this._removeLocoHandler();if(this._gizmo){this._gizmo.hide();this._gizmo=null}}}return this};n.prototype.setNodeSet=function(t){this.setProperty("nodeSet",t,true);if(this._gizmo){this._gizmo.handleSelectionChanged()}};n.prototype.queueCommand=function(t){if(this._addLocoHandler()){if(this.isViewportType("sap.ui.vk.svg.Viewport")){t()}}return this};return n});
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/tools/TransformSvgElementToolGizmo", ["./Gizmo","./TransformSvgElementToolGizmoRenderer","../svg/Element","./ToolNodeSet"],function(t,e,r,i){"use strict";var a=t.extend("sap.ui.vk.tools.TransformSvgElementToolGizmo",{metadata:{library:"sap.ui.vk"}});a.prototype.show=function(t,e){this._viewport=t;this._tool=e;this._nodes=[];this._cursor=null;this.handleSelectionChanged();t.attachCameraChanged(this._handleChanged,this);if(t._viewStateManager){t._viewStateManager.attachTransformationChanged(this._handleChanged,this)}};a.prototype.hide=function(){if(this._cursor){this._viewport.removeStyleClass(this._cursor);this._cursor=null}if(this._viewport._viewStateManager){this._viewport._viewStateManager.detachTransformationChanged(this._handleChanged,this)}this._viewport.detachCameraChanged(this._handleChanged,this);this._viewport=null;this._tool=null;this._nodes=[]};a.prototype._handleChanged=function(){if(this.getDomRef()){this.rerender()}};a.prototype._getHandleLocalPositions=function(t,e){var r=t.bbox;var i=r.x;var a=r.x+r.width;var n=(i+a)*.5;var o=r.y+r.height*.5;var s=r.height*.5*t.ySign;var h=o-s;var l=o+s;var v=h-48*t.ySign/(this._viewport._camera.zoom*Math.sqrt(e[2]*e[2]+e[3]*e[3]));return[n,h,a,h,a,o,a,l,n,l,i,l,i,o,i,h,n,v,n,o]};a.prototype._selectHandle=function(t,e){this._gizmoIndex=t;this._handleIndex=e;var r=null;if(t>=0){if(e>=0){if(e<8){var i=this._nodes[t];var a=i.node._matrixWorld();var n=Math.round(Math.atan2(a[2],a[3])*4/Math.PI);r=["NSResize","NESWResize","EWResize","NWSEResize"][(16-n+e*i.xSign*i.ySign)%4]}else{r="Rotate"}}else{r="Move"}r="sapUiVkTransformationToolCursor"+r}if(this._cursor!=r){if(this._cursor){this._viewport.removeStyleClass(this._cursor)}if(r){this._viewport.addStyleClass(r)}this._cursor=r}};function n(t){return{x:t[4],y:t[5]}}function o(t){return{x:Math.sqrt(t[0]*t[0]+t[1]*t[1]),y:Math.sqrt(t[2]*t[2]+t[3]*t[3])}}function s(t){return Math.atan2(t[0],t[1])}function h(t){if(t<-Math.PI){return t+Math.PI*2}else if(t>Math.PI){return t-Math.PI*2}return t}function l(t){var e=null;while(t.parent){e=t;t=t.parent}return e&&e.matrix[3]<0?-1:1}function v(t,e,r,i){return t*r+e*i}function d(t){return t[0]*t[3]-t[1]*t[2]}a.prototype.handleSelectionChanged=function(){var t=this._viewport?this._viewport._viewStateManager:null;if(t===null){return}var e=[];if(this._tool){t[this._tool.getNodeSet()===i.Highlight?"enumerateSelection":"enumerateOutlinedNodes"](function(t){var i=t._matrixWorld();var a=d(i)<0?-1:1;if(t.parent){i=r._multiplyMatrices(r._invertMatrix(t.parent._matrixWorld()),i)}e.push({node:t,bbox:t._getBBox(null,true),position:n(i),scale:o(i),angle:s(i),xSign:a,ySign:l(t)})})}if(this._nodes.length===e.length&&this._nodes.every(function(t,r){return e[r].node===t.node})){return}this._nodes=e;if(this.getDomRef()){this.rerender()}};a.prototype._beginGesture=function(){this._nodes.forEach(function(t){var e=t.node;t.beginWorldMatrix=e._matrixWorld();t.bbox=e._getBBox(null,true)});this._eventParameters=null};function u(t,e,r,i,a,n){var o=v(t,e,r+a,i+n);var s=v(t,e,r,i);return s!==0?o/s:1}a.prototype._update=function(t,e,i){var a=this._handleIndex;var l=a>=0&&a<8?(a+4)%8:9;var _=1,f=1,c=1,g=0;var p=[];var x;var m={nodesProperties:p};if(a<0){x="moving";m.x=t;m.y=e}else{var y=this._nodes[this._gizmoIndex];var M=y.beginWorldMatrix;var S=this._getHandleLocalPositions(y,M);if(a<8){x="scaling";var w=S[l*2];var C=S[l*2+1];var P=S[a*2];var b=S[a*2+1];var E=v(P-w,b-C,M[0],M[2]);var W=v(P-w,b-C,M[1],M[3]);_=a===0||a===4?1:u(M[0],M[1],E,W,t,e);f=a===2||a===6?1:u(M[2],M[3],E,W,t,e);if(this._tool.getUniformScaleEnabled()^i){if(a===0||a===4){_=f}else if(a===2||a===6){f=_}else{_=f=Math.max(_,f)}}m.x=_;m.y=f}else{x="rotating";var z=r._transformPoint(S[18],S[19],M);var I=r._transformPoint(S[16],S[17],M);var T=Math.atan2(I.x-z.x,I.y-z.y);var R=Math.atan2(I.x-z.x+t,I.y-z.y+e);var N=h(R-T);m.angle=N;c=Math.cos(N);g=Math.sin(N)}}this._nodes.forEach(function(i){var v=i.node;var u=i.beginWorldMatrix.slice();var x={node:v};if(a<0){u[4]+=t;u[5]+=e}else{var m=this._getHandleLocalPositions(i,u);if(a<8){var y=m[l*2];var M=m[l*2+1];u[4]+=y*u[0]+M*u[2];u[5]+=y*u[1]+M*u[3];u[0]*=_;u[1]*=_;u[2]*=f;u[3]*=f;u[4]-=y*u[0]+M*u[2];u[5]-=y*u[1]+M*u[3]}else{var S=r._transformPoint(m[18],m[19],u);var w=new Float32Array([c,-g,g,c,S.x-(S.x*c+S.y*g),S.y-(S.x*-g+S.y*c)]);u=r._multiplyMatrices(w,u)}}i.xSign=d(u)<0?-1:1;if(v.parent){u=r._multiplyMatrices(r._invertMatrix(v.parent._matrixWorld()),u)}if(a<0){var C=n(u);x.x=C.x-i.position.x;x.y=C.y-i.position.y}else if(a<8){var P=o(u);x.x=P.x/i.scale.x;x.y=P.y/i.scale.y}else{x.angle=h(s(u)-i.angle)}v.setMatrix(u);p.push(x)}.bind(this));this.rerender();this._eventParameters=m;this._tool.fireEvent(x,m,true)};a.prototype._endGesture=function(){if(this._eventParameters){var t=this._handleIndex;var e;if(t<0){e="moved"}else if(t<8){e="scaled"}else{e="rotated"}this._tool.fireEvent(e,this._eventParameters,true)}};return a});
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/tools/TransformSvgElementToolGizmoRenderer", [],function(){"use strict";var t={apiVersion:2};t.render=function(t,r){if(!r._viewport){return}var e=r._viewport._getViewBox();t.openStart("svg",r);t.class("sapUiVkTransformationSvgElementToolSurface");t.attr("xmlns","http://www.w3.org/2000/svg");t.attr("width","100%");t.attr("height","100%");t.attr("viewBox",e.join(" "));t.style("position","absolute");t.style("pointer-events","none");t.openEnd();t.openStart("defs");t.openEnd();t.openStart("filter");t.attr("id","shadow-effect");t.openEnd();t.openStart("feDropShadow");t.attr("dx","0");t.attr("dy","0");t.attr("stdDeviation","2");t.attr("flood-color","#000");t.openEnd();t.close("feDropShadow");t.close("filter");t.close("defs");var a=1/r._viewport._camera.zoom;function o(r,e,a,o){t.openStart("rect");t.attr("fill","#fff");t.attr("stroke","#000");t.attr("stroke-width",1);t.attr("vector-effect","non-scaling-stroke");t.attr("filter","url(#shadow-effect)");var n=Math.abs(8*a);var i=Math.abs(8*o);t.attr("x",r-n*.5);t.attr("y",e-i*.5);t.attr("width",n);t.attr("height",i);t.openEnd();t.close("rect")}r._nodes.forEach(function(e){var n=e.node;var i=e.bbox;if(i){var s=n._matrixWorld();var c=r._getHandleLocalPositions(e,s);var l=a*e.xSign*e.ySign/Math.sqrt(s[0]*s[0]+s[1]*s[1]);var f=a*e.ySign/Math.sqrt(s[2]*s[2]+s[3]*s[3]);t.openStart("g");t.attr("transform","matrix("+s.join(",")+")");t.openEnd();t.openStart("rect");t.attr("fill","none");t.attr("stroke","#fff");t.attr("vector-effect","non-scaling-stroke");t.attr("x",i.x);t.attr("y",i.y);t.attr("width",i.width);t.attr("height",i.height);t.openEnd();t.close("rect");t.openStart("rect");t.attr("fill","none");t.attr("stroke","#000");t.attr("stroke-dasharray","5 5");t.attr("vector-effect","non-scaling-stroke");t.attr("x",i.x);t.attr("y",i.y);t.attr("width",i.width);t.attr("height",i.height);t.openEnd();t.close("rect");t.openStart("line");t.attr("stroke","#fff");t.attr("vector-effect","non-scaling-stroke");t.attr("x1",c[0]);t.attr("y1",c[1]);t.attr("x2",c[16]);t.attr("y2",c[17]);t.openEnd();t.close("line");t.openStart("line");t.attr("stroke","#000");t.attr("stroke-dasharray","5 5");t.attr("vector-effect","non-scaling-stroke");t.attr("x1",c[0]);t.attr("y1",c[1]);t.attr("x2",c[16]);t.attr("y2",c[17]);t.openEnd();t.close("line");t.openStart("g");t.attr("transform","matrix("+l+",0,0,"+f+","+(c[16]-8*l)+","+(c[17]-8*f)+")");t.openEnd();t.openStart("circle");t.attr("fill","#fff");t.attr("stroke","#000");t.attr("cx","8");t.attr("cy","8");t.attr("r","7.5");t.openEnd();t.close("circle");t.openStart("path");t.attr("fill","#000");t.attr("d","M8,12.94A4.84,4.84,0,1,1,8,3.27h2.84v1H8a3.84,3.84,0,1,0,3.84,3.84h1A4.84,4.84,0,0,1,8,12.94Z");t.openEnd();t.close("path");t.openStart("path");t.attr("fill","#000");t.attr("d","M9.89,5.59a.5.5,0,0,1-.34-.88l1.09-1L9.56,2.83a.51.51,0,0,1-.05-.71.49.49,0,0,1,.7-.05l1.51,1.31a.48.48,0,0,1,.17.37.49.49,0,0,1-.16.38L10.22,5.46A.5.5,0,0,1,9.89,5.59Z");t.openEnd();t.close("path");t.openStart("circle");t.attr("fill","#000");t.attr("cx","8");t.attr("cy","8");t.attr("r","0.83");t.openEnd();t.close("circle");t.close("g");for(var p=0;p<8;p++){o(c[p*2],c[p*2+1],l,f)}t.close("g")}});t.close("svg")};return t},true);
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/tools/TransformSvgElementToolHandler", ["sap/ui/base/EventProvider","../svg/Element"],function(t,e){"use strict";var i=t.extend("sap.ui.vk.tools.TransformSvgElementToolHandler",{metadata:{library:"sap.ui.vk"},constructor:function(t){this._priority=10;this._tool=t;this._gizmo=t.getGizmo();this._rect=null}});i.prototype._getPosition=function(t){return this._tool._viewport._camera._screenToWorld(t.x-this._rect.x,t.y-this._rect.y)};i.prototype._getGizmoHandle=function(t){var i=this._tool._viewport;if(!i||!this._gizmo||!this._inside(t)){return null}if(t.scroll!==undefined){return null}var o=i._camera;var n=this._gizmo._nodes;if(!o||!n||n.length===0){return null}var r=t.x-this._rect.x;var s=t.y-this._rect.y;var a=this._getPosition(t);var h=12;var l=-1;for(var _=0;_<n.length;_++){var d=n[_];var u=d.node;var c=u._getBBox(null,true);if(!c){continue}var f=u._matrixWorld();var v=this._gizmo._getHandleLocalPositions(d,f);var g=[0,4,2,6,8,1,3,5,7];for(var p=0;p<9;p++){var y=g[p];var m=e._transformPoint(v[y*2],v[y*2+1],f);var x=o._worldToScreen(m.x,m.y);if(r>=x.x-h&&r<=x.x+h&&s>=x.y-h&&s<=x.y+h){return{gizmoIndex:_,handleIndex:y,angle:Math.atan2(f[2],f[3])}}}if(l<0){var z=h/(o.zoom*Math.sqrt(f[0]*f[0]+f[1]*f[1]));var w=h/(o.zoom*Math.sqrt(f[2]*f[2]+f[3]*f[3]));var P=e._transformPoint(a.x,a.y,e._invertMatrix(f));if(P.x>=c.x-z&&P.x<=c.x+c.width+z&&P.y>=c.y-w&&P.y<=c.y+c.height+w){l=_}}}return l<0?null:{gizmoIndex:l,handleIndex:-1}};i.prototype.hover=function(t){if(this._gizmo){var e=this._getGizmoHandle(t);if(e){this._gizmo._selectHandle(e.gizmoIndex,e.handleIndex)}else{this._gizmo._selectHandle(-1,-1)}}};i.prototype.beginGesture=function(t){this._handle=t.buttons===1&&this._getGizmoHandle(t)||null;if(this._handle){t.handled=true;this._gizmo._selectHandle(this._handle.gizmoIndex,this._handle.handleIndex);this._startPos=this._getPosition(t);this._gizmo._beginGesture()}};i.prototype.move=function(t){if(this._handle&&this._inside(t)){t.handled=true;var e=this._getPosition(t);this._gizmo._update(e.x-this._startPos.x,e.y-this._startPos.y,t.event&&(sap.ui.Device.os.macintosh?t.event.metaKey:t.event.ctrlKey))}};i.prototype.endGesture=function(t){if(this._handle){this._handle=null;t.handled=true;this._gizmo._endGesture()}};i.prototype.click=function(t){};i.prototype.doubleClick=function(t){};i.prototype.contextMenu=function(t){};i.prototype.getViewport=function(){return this._tool._viewport};i.prototype._getOffset=function(t){var e=t.getBoundingClientRect();var i={x:e.left+window.pageXOffset,y:e.top+window.pageYOffset};return i};i.prototype._inside=function(t){var e=this._tool._viewport.getIdForLabel();var i=document.getElementById(e);if(i==null){return false}var o=this._getOffset(i);this._rect={x:o.x,y:o.y,w:i.offsetWidth,h:i.offsetHeight};return t.x>=this._rect.x&&t.x<=this._rect.x+this._rect.w&&t.y>=this._rect.y&&t.y<=this._rect.y+this._rect.h};return i});
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/totara/CallbackHandler", [],function(){"use strict";var t=function(){this.callbacks=[]};t.prototype.attach=function(t){this.callbacks.push(t)};t.prototype.detach=function(t){var c=this.callbacks.indexOf(t);if(c!==-1){this.callbacks.splice(c,1);return true}return false};t.prototype.execute=function(t){for(var c=0;c<this.callbacks.length;c++){this.callbacks[c](t)}};t.prototype.detachAll=function(){this.callbacks=[]};return t});
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/totara/Command", ["sap/ui/base/DataType"],function(e){"use strict";var t={addClientLog:"addClientLog",getAnnotation:"getAnnotation",getDynamicView:"getDynamicView",getHighlightStyle:"getHighlightStyle",getImage:"getImage",getImageDetails:"getImageDetails",getMaterial:"getMaterial",getMesh:"getMesh",getParametric:"getParametric",getGeomMesh:"getGeomMesh",getScene:"getScene",getSequence:"getSequence",getTrack:"getTrack",getTree:"getTree",getView:"getView",getViewAnimations:"getViewAnimations",getViewGroups:"getViewGroups",notifyError:"notifyError",notifyFinishedTree:"notifyFinishedTree",notifyFinishedView:"notifyFinishedView",requestScene:"requestScene",setAnnotation:"setAnnotation",setCamera:"setCamera",setGeometry:"setGeometry",setHighlightStyle:"setHighlightStyle",setImage:"setImage",setSvgImage:"setSvgImage",setMaterial:"setMaterial",setMesh:"setMesh",setLineStyle:"setLineStyle",setFillStyle:"setFillStyle",setTextStyle:"setTextStyle",setParametric:"setParametric",setPointCloudGroup:"setPointCloudGroup",setDynamicContent:"setDynamicContent",setScene:"setScene",setPlayback:"setPlayback",setSequence:"setSequence",setStreamingToken:"setStreamingToken",setTrack:"setTrack",setTree:"setTree",setTreeNode:"setTreeNode",setView:"setView",setViewGroup:"setViewGroup",setViewNode:"setViewNode",timestamp:"timestamp",performanceTiming:"performanceTiming",suppressSendRequests:"suppressSendRequests",unsuppressSendRequests:"unsuppressSendRequests",setMaxActiveRequests:"setMaxActiveRequests",setConsumptionScenario:"setConsumptionScenario",allocateMeshBuffer:"allocateMeshBuffer",setMarker:"setMarker"};e.registerEnum("sap.ui.vk.totara.Command",t);return t});
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/totara/GeometryFactory", ["./IndexCompressor"],function(e){"use strict";const r=1;const t=2;const o=4;const a=16;const n=32;var f=0;var u=3;var i=function(){};i.getGeometryInfo=function(f,u,i){var c=new DataView(u.buffer,u.byteOffset,u.byteLength);var d=0;const m=(f.flags&t)>0;const g=(f.flags&n)>0;const C=(f.flags&o)>0;const y=(f.flags&a)>0;let w=f.pointCount;const F=f.elementCount;const h=F===0;const B=h?false:(f.flags&r)>0;const p=B?2:3;const R=F*p;if(!w){throw"No points in geometry"}var U=i?i.points.subarray(0,w*3):new Float32Array(w*3);var I=null;if(m){I=i?i.normals.subarray(0,w*3):new Float32Array(w*3)}var b=null;if(g){b=i?i.colors.subarray(0,w*3):new Float32Array(w*3)}var A=null;if(C){A=i?i.uvs.subarray(0,w*2):new Float32Array(w*2)}var D;if(h){D=null}else if(i){if(i.indices.length<R){i.indices=new Uint16Array(R)}if(i.previousIndexCount<R){i.previousIndexCount=R}D=i.indices.subarray(0,R)}else{D=new Uint16Array(R)}if(f.encodingType===0){for(var M=0;M<w;++M){U[M*3]=c.getFloat32(d,true);U[M*3+1]=c.getFloat32(d+4,true);U[M*3+2]=c.getFloat32(d+8,true);d+=12;if(m){I[M*3]=c.getFloat32(d,true);I[M*3+1]=c.getFloat32(d+4,true);I[M*3+2]=c.getFloat32(d+8,true);d+=12}if(C){A[M*2]=c.getFloat32(d,true);A[M*2+1]=c.getFloat32(d+4,true);d+=8}}for(var x=0;x<R;++x){D[x]=c.getUint16(d,true);d+=2}}else{var q=new e(u,u.length);q.setCurByte(d);if(!q.ReadCommand()){throw"Buffer overflow 1"}var z=q.rvalue;if(z){if(!s(q,w,z,f.box,U)){throw"Unquantize positions failed"}}var P=1;if(m){if(!q.ReadCommand()){throw"Buffer overflow 2"}P=q.rvalue;if(P){if(!l(q,w,P,I)){throw"Unquantize normals failed"}}}var G=1;var L=false;if(C){if(!q.ReadCommand()){throw"Buffer overflow 3"}G=q.rvalue;if(G){if(!v(q,w,G,A)){throw"Unquantize uvs failed"}L=true}}if(!z||!P||!G||L){if(L){d=q.getCurByte();var N=c.getFloat32(d,true);var O=c.getFloat32(d+4,true);q.moveCurByte(8);if(N!==0||O!==1){var T=O-N;for(var V=0,j=w*2;V<j;V++){A[V]=A[V]*T+N}}}var k;if(!z){d=q.getCurByte();for(k=0;k<w;k++){U[k*3]=c.getFloat32(d+k*4,true);U[k*3+1]=c.getFloat32(d+(k+w)*4,true);U[k*3+2]=c.getFloat32(d+(k+w*2)*4,true)}q.moveCurByte(w*3*4)}if(!P&&m){d=q.getCurByte();for(k=0;k<w;k++){I[k*3]=c.getFloat32(d+k*4,true);I[k*3+1]=c.getFloat32(d+(k+w)*4,true);I[k*3+2]=c.getFloat32(d+(k+w*2)*4,true)}q.moveCurByte(w*3*4)}if(!G&&C){d=q.getCurByte();for(k=0;k<w;k++){A[k*2]=c.getFloat32(d+k*4,true);A[k*2+1]=c.getFloat32(d+(k+w)*4,true)}q.moveCurByte(w*2*4)}}let r,t;if(F>0){const e=q.getCurByte();q.Reset();q.setCurByte(e);let o=[0,0,0];for(r=0;r<F;r++){for(t=0;t<p;t++){if(!q.ReadCommand(o[t])){throw"UIC1 Decompression error - elements"}D[r*p+t]=q.rvalue;o[t]=q.rvalue}}}if(g){if(y){const e=q.getCurByte();q.Reset();q.setCurByte(e);for(r=0;r<F;r++){if(!q.ReadCommand()){throw"UIC1 Decompression error - face ids"}}}const e=q.getCurByte();q.Reset();q.setCurByte(e);if(!q.ReadCommand()){throw"UIC1 Decompression error - colors1"}if(q.rvalue===0){throw"UIC1 Decompression error - colors2"}const o=1/q.rvalue;for(t=0;t<3;++t){for(r=0;r<w;++r){if(!q.ReadCommand()){throw"UIC1 Decompression error - colors3"}b[r*3+t]=o*q.rvalue}}}}return{id:f.id,isPointCloud:h,isPolyline:B,data:{indices:D,points:U,colors:b,normals:I,uvs:A}}};function s(e,r,t,o,a){for(var n=0;n<3;n++){var i=o[f+n];var s=(o[u+n]-i)/t;for(var l=0;l<r;l++){if(!e.ReadCommand()){return false}a[l*3+n]=s*e.rvalue+i}}return true}function l(e,r,t,o){var a;for(a=0;a<r;a++){if(!e.ReadCommand()){return false}o[a*3]=e.rvalue}var n=2*Math.PI/t;var f;var u;var i;for(a=0;a<r;a++){if(!e.ReadCommand()){return false}f=n*o[a*3];u=n*e.rvalue;i=Math.sin(u);o[a*3]=i*Math.cos(f);o[a*3+1]=i*Math.sin(f);o[a*3+2]=Math.cos(u)}return true}function v(e,r,t,o){var a=1/t;for(var n=0;n<2;n++){for(var f=0;f<r;f++){if(!e.ReadCommand()){return false}o[f*2+n]=a*e.rvalue}}return true}return i});
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/totara/IndexCompressor", [],function(){"use strict";var a=function(a,r){var e=32;var s=16;var v=13;var t=14;var i=0;var u=1;var c=3;var l=4;var n=5;var h=6;var f=7;var b=8;var k=9;var o=10;var d=11;var y=12;var w=15;var C=0;var m=1;var B=2;var R=3;var A=4;var g=5;var p=6;var j=7;var q=8;var x=9;var z=10;var D=11;var E=12;var F=13;var G=4294967295;var H=0;this.rvalue=0;var I=0;var J=a;var K=r;var L=0;var M=new Array(e);var N=new Array(s);var O=e-1;var P=s-1;var Q=false;this.Reset=function(){H=0;this.rvalue=0;I=0;L=0;var a;for(a=0;a<e;a++){M[a]=e-a-1}for(a=0;a<s;a++){N[a]=1}O=e-1;P=s-1};this.Reset();function S(a){return M[O>=a?O-a:e+O-a]}function T(a){return N[P>=a?P-a:s+P-a]}function U(a){O++;if(O>=e){O=0}M[O]=a}function V(a){P++;if(P>=s){P=0}N[P]=a}function W(){if(L<K){return J[L++]}Q=true;return 0}function X(){return W()+W()*256}function Y(){return W()+W()*256+W()*65536+W()*16777216}this.ReadCommand=function(a){if(a===undefined){a=G}Q=false;var r=this.rvalue;if(H){H--;this.rvalue=S(I)}else{var e=W();if(Q){e=u}var s=e>>>4;switch(e&15){case i:this.rvalue=S(s);break;case n:this.rvalue=S(16+s);break;case v:this.rvalue=S(s>>>2);I=s&3;H=1;break;case t:this.rvalue=S(0);I=0;H=s+2;break;case h:this.rvalue+=T(s);break;case u:if(e&16){this.rvalue+=(e>>>5)+1}else{this.rvalue-=(e>>>5)+1}break;case c:this.rvalue=a+(s+1);break;case l:this.rvalue=a-(s+1);break;case f:this.rvalue=a+(s+17);break;case b:this.rvalue=a-(s+17);break;case k:this.rvalue+=s+(W()<<4)+3;break;case o:this.rvalue-=s+(W()<<4)+3;break;case d:this.rvalue=s+(W()<<4);break;case y:var J=X();this.rvalue=s+(J<<4);break;case w:switch(e>>>4){case C:case m:case B:case R:case A:this.rvalue=e>>>4;break;case g:this.rvalue=255;break;case p:this.rvalue=65280;break;case j:this.rvalue=16711680;break;case q:this.rvalue=4278190080;break;case x:this.rvalue=16777215;break;case z:this.rvalue=4294967295;break;case F:I=0;H=X()+36;break;case D:{const a=W();this.rvalue=(X()<<8)+a;break}case E:this.rvalue=Y();break;default:return false}break;default:return false}}if(this.rvalue>4294967295){this.rvalue=this.rvalue-4294967295-1}U(this.rvalue);var K;if(this.rvalue!=r){if(this.rvalue>r){K=this.rvalue-r;if(K<2147483647){V(K)}}else{K=r-this.rvalue;if(K<2147483647){V(-K)}}}if(Q){H=0;this.rvalue=0;return false}return true};this.getCurByte=function(){return L};this.setCurByte=function(a){L=a};this.moveCurByte=function(a){L=L+a}};return a});
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/totara/ProgressCounter", [],function(){"use strict";function t(){this._count=0;this._total=0;var t;this.setOnValueChanged=function(n){t=n};this.callOnValueChanged=function(){if(t){t()}}}var n=t.prototype;Object.defineProperty(n,"count",{get:function(){return this._count},set:function(t){if(t!==this._count){this._count=t;this.callOnValueChanged()}}});Object.defineProperty(n,"total",{get:function(){return this._total},set:function(t){if(t!==this._total){this._total=t;this.callOnValueChanged()}}});var e=function(){var n;function e(){if(n){n(this)}}this.mesh=new t;this.geometry=new t;this.mesh.setOnValueChanged(e);this.geometry.setOnValueChanged(e);this.setOnProgressChanged=function(t){n=t}};return e});
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/totara/RequestQueue", ["./TotaraUtils","./Command"],function(t,e){"use strict";function i(t){this.getBatchSize=t;this.globalList=new Set;this.waitingList=new Map;this.requestedList=new Set}i.prototype.push=function(t,e){if(this.globalList.has(t)){return false}this.globalList.add(t);this.waitingList.set(t,e);this.requestedList.add(t);return true};i.prototype.setBatchSizeInfo=function(t){this.batchSizeInfo=t};i.prototype.fetchBatch=function(){var t=this.getBatchSize?this.getBatchSize:1;if(typeof this.getBatchSize==="function"){t=this.getBatchSize()}var e=this.batchSizeInfo;var i=e?e.maxBatchStringLength:Number.MAX_SAFE_INTEGER;var s=e?e.separatorLength:0;var n=[];var a=0;var r=this.requestedList.keys();var h=r.next();for(var o=0;o<t&&!h.done;o++,h=r.next()){var c=h.value;a+=c.toString().length+(o==0?0:s);if(a>i){break}this.requestedList.delete(c);n.push(c)}return n};i.prototype.pop=function(t){this.requestedList.delete(t);return this.waitingList.delete(t)};i.prototype.isReady=function(t){return this.globalList.has(t)&&!this.waitingList.has(t)};i.prototype.clear=function(t){this.globalList.clear();this.waitingList.clear();this.requestedList.clear()};i.prototype.isEmpty=function(){return this.requestedList.size===0};i.prototype.isWaiting=function(){return this.waitingList.size>0};i.prototype.isInitialViewCompleted=function(){var t=this.waitingList;for(var e=t.values(),i=e.next();!i.done;i=e.next()){var s=i.value;if(s&&s.isInitial){return false}}return true};function s(t,e){i.call(this,t);this.getMaxBatchDataSize=e;this.priorityMap=new Map;this.sortedList=null}s.prototype=Object.create(i.prototype);s.prototype.constructor=s;s.prototype.push=function(t,e){if(i.prototype.push.call(this,t,e)){this.priorityMap.set(t,{});this.sortedList=null;return true}return false};s.prototype.pop=function(t){this.priorityMap.delete(t);return i.prototype.pop.call(this,t)};s.prototype.clear=function(){i.prototype.clear.call(this);this.priorityMap.clear();this.sortedList=null};s.prototype.setData=function(t,e){var i=this.priorityMap.get(t);if(i!=null){Object.assign(i,e);this.sortedList=null;return true}return false};s.prototype.fetchBatch=function(){var t=this.priorityMap;var e=this.requestedList;var i=this.sortedList;if(i==null){i=this.sortedList=Array.from(e.keys()).sort(function(e,i){return t.get(e).priority-t.get(i).priority})}var s=this.batchSizeInfo;var n=s?s.maxBatchStringLength:Number.MAX_SAFE_INTEGER;var a=this.getMaxBatchDataSize?this.getMaxBatchDataSize():10*1024*1024;var r=1e3;var h=s?s.separatorLength:0;var o=[];var c=0;var u=this.getBatchSize?this.getBatchSize():1;var p=0;var l=0;for(var m=0;m<u&&i.length>0;m++){var g=i[i.length-1];var d=t.get(g);c+=d.dataSize;l+=d.submeshCount;p+=g.toString().length+(m==0?0:h);if(m>0&&(p>n||c>a||l>r)){break}e.delete(g);t.delete(g);i.pop();o.push(g)}return o};var n=function(e,n){this.context=e;this.sceneId=n;this.token=e.token||t.generateToken();var a=e.loader;this.meshes=new i(a.getMeshesBatchSize.bind(a));this.materials=new i(a.getMaterialsBatchSize.bind(a));this.textures=new i;this.geomMeshes=new s(a.getGeomMeshesBatchSize.bind(a),a.getGeomMeshesMaxBatchDataSize.bind(a));this.annotations=new i(a.getAnnotationsBatchSize.bind(a));this.views=new i;this.thumbnails=new i;this.images=new i};n.prototype.isEmpty=function(){return this.meshes.isEmpty()&&this.annotations.isEmpty()&&this.materials.isEmpty()&&this.textures.isEmpty()&&this.geomMeshes.isEmpty()&&this.views.isEmpty()&&this.thumbnails.isEmpty()&&this.images.isEmpty()};n.prototype.isWaitingForContent=function(){return this.meshes.isWaiting()||this.textures.isWaiting()||this.materials.isWaiting()||this.geomMeshes.isWaiting()||this.annotations.isWaiting()||this.views.isWaiting()||this.thumbnails.isWaiting()||this.images.isWaiting()};n.prototype.clearContent=function(){this.meshes.clear();this.annotations.clear();this.materials.clear();this.textures.clear();this.geomMeshes.clear();this.views.clear();this.thumbnails.clear();this.images.clear()};n.prototype.createGetContentCommand=function(e,i,s){var n={sceneId:this.sceneId,ids:i.map(function(t){return parseInt(t,10)}),token:this.token};return t.createRequestCommand(e,s?Object.assign(n,s):n)};function a(t){var e=t.keys().next();if(e.done){return null}var i=e.value;t.delete(i);return i}n.prototype.generateRequestCommand=function(){var i;var s;var n;var r=null;if(!this.meshes.isEmpty()){s=this.meshes.fetchBatch();var h=s.map(function(t){return t.id?t.id:t});r=this.createGetContentCommand(e.getMesh,h);r.sceneId=this.sceneId;r.meshIds=h}else if(!this.geomMeshes.isEmpty()){s=this.geomMeshes.fetchBatch();r=this.createGetContentCommand(e.getGeomMesh,s);r.sceneId=this.sceneId;r.meshIds=s}else if(!this.annotations.isEmpty()){s=this.annotations.fetchBatch();r={method:e.getAnnotation,parameters:{sceneId:this.sceneId,annotationIds:s}}}else if(!this.materials.isEmpty()){s=this.materials.fetchBatch();r={method:e.getMaterial,parameters:{sceneId:this.sceneId,materialIds:s}}}else if(!this.textures.isEmpty()){i=a(this.textures.requestedList);n=this.textures.waitingList.get(i);r=this.createGetContentCommand(e.getImage,[i]);r.sceneId=this.sceneId;r=Object.assign(r,n)}else if(!this.views.isEmpty()){i=a(this.views.requestedList);r={method:e.getView,parameters:{sceneId:this.sceneId,viewId:i,query:t.configureSceneViewQuery(this.context)}}}else if(!this.thumbnails.isEmpty()){i=a(this.thumbnails.requestedList);n=this.thumbnails.waitingList.get(i);r=this.createGetContentCommand(e.getImage,[i]);r.sceneId=this.sceneId;r=Object.assign(r,n)}else if(!this.images.isEmpty()){i=a(this.images.requestedList);n=this.images.waitingList.get(i);r=this.createGetContentCommand(e.getImage,[i]);r.sceneId=this.sceneId;r=Object.assign(r,n)}return r};return n});
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/totara/SceneContext", ["sap/base/Log","./CallbackHandler","./TotaraUtils","./GeometryFactory","./ProgressCounter","./RequestQueue","../getResourceBundle","../AnimationRotateType"],function(e,t,i,s,r,n,a,o){"use strict";var d=function(e,i,s){this.root=null;this.onActiveCameraCallbacks=new t;this.onInitialSceneFinishedCallbacks=new t;this.onPartialRetrievalFinishedCallbacks=new t;this.onSceneCompletedCallbacks=new t;this.onSetPlaybackCallbacks=new t;this.onViewFinishedCallbacks=new t;this.onViewGroupFinishedCallbacks=new t;this.onContentChangesProgressCallbacks=new t;this.onInitialViewCompletedCallbacks=new t;Object.assign(this,i);this.sceneId=e;this.loader=s;this.sceneBuilder=s.sceneBuilder;this.requestQueue=new n(this,e);this.phase=d.Phase.Started;this.retrievalType=d.RetrievalType.Initial;this.rootNodeId=null;this.parametricNodeMap=new Map;this.dynamicContentNodeMap=new Map;this.annotationNodeMap=new Map;this.leaderLineMaterialIdMap=new Map;this.imageNoteMaterialIdMap=new Map;this.thumbnailViewMap=new Map;this.viewThumbnailMap=new Map;this.viewAnimatedThumbnailMap=new Map;this.progressCount=new r;this.treeNodes=[];this.viewIdTreeNodesMap=new Map;this.viewIdBoxMap=new Map;this.nodeSidsForPartialTree=new Set;this.replacedNodes=new Map;this.updatedNodes=new Set;this.currentViewId=null;this.initialViewId=null;this.initialViewDecided=false;this.initialViewFired=false;this.eventObject={};this.eventObject.percentage=0;this.loadingGeometry=0};d.Phase={Started:0,FinishedHierarchy:1,FinishedMesh:2,FinishedGeometry:3};d.RetrievalType={Initial:0,Partial:1};d.ProgressPhase={FinishedTree:a().getText("SCENE_CONTEXT_FINISHED_TREE"),FinishedMeshes:a().getText("SCENE_CONTEXT_FINISHED_MESHES"),FinishedMaterials:a().getText("SCENE_CONTEXT_FINISHED_MATERIALS"),FinishedGeomMeshes:a().getText("SCENE_CONTEXT_FINISHED_GEOMETRIES"),LoadingGeomMeshes:a().getText("SCENE_CONTEXT_LOADING_GEOMETRIES"),FinishedTextures:a().getText("SCENE_CONTEXT_FINISHED_TEXTURES"),FinishedImages:a().getText("SCENE_CONTEXT_FINISHED_IMAGES")};d.prototype.setOnProgressChanged=function(e){this.progressCount.setOnProgressChanged(e)};d.prototype.isLoadingFinished=function(){if(!this.requestQueue.isEmpty()||this.requestQueue.isWaitingForContent()||this.thumbnailViewMap.size>0||this.viewThumbnailMap.size>0||this.viewAnimatedThumbnailMap.size>0||this.annotationNodeMap.size>0||this.parametricNodeMap.size>0||this.dynamicContentNodeMap.size>0||this.leaderLineMaterialIdMap.size>0||this.imageNoteMaterialIdMap.size>0||this.viewIdTreeNodesMap.size>0||this.nodeSidsForPartialTree.size>0){return false}return true};d.prototype.isSceneCompleted=function(){return!this.requestQueue.meshes.isWaiting()&&!this.requestQueue.annotations.isWaiting()&&!this.requestQueue.materials.isWaiting()&&!this.requestQueue.geomMeshes.isWaiting()&&!this.requestQueue.textures.isWaiting()&&!this.requestQueue.images.isWaiting()};d.prototype.isInitialViewCompleted=function(){var e=this.requestQueue.textures.isInitialViewCompleted();var t=this.requestQueue.meshes.isInitialViewCompleted();var i=this.requestQueue.geomMeshes.isInitialViewCompleted();var s=this.requestQueue.images.isInitialViewCompleted();return e&&t&&i&&s};d.prototype._checkSceneCompletion=function(){if(!this.initialViewFired&&this.isInitialViewCompleted()){e.info("initialView completed.");this.initialViewFired=true;this.onInitialViewCompletedCallbacks.execute()}if(this.isSceneCompleted()){if(this.eventObject.percentage<100){this.eventObject.percentage=100;this.onContentChangesProgressCallbacks.execute(this.eventObject)}this.onSceneCompletedCallbacks.execute();e.info("Scene completed.");i.mark("sceneCompleted");this.logPerformance("sceneCompleted")}};d.prototype._fireProgress=function(e){switch(e){case d.ProgressPhase.FinishedTree:this.eventObject.percentage+=10;this.eventObject.phase=d.ProgressPhase.FinishedTree;this.onContentChangesProgressCallbacks.execute(this.eventObject);break;case d.ProgressPhase.FinishedMeshes:if(!this.requestQueue.meshes.isWaiting()){this.eventObject.percentage+=10;this.eventObject.phase=d.ProgressPhase.FinishedMeshes;this.onContentChangesProgressCallbacks.execute(this.eventObject)}break;case d.ProgressPhase.FinishedMaterials:if(!this.requestQueue.materials.isWaiting()){this.eventObject.percentage+=10;this.eventObject.phase=d.ProgressPhase.FinishedMaterials;this.onContentChangesProgressCallbacks.execute(this.eventObject)}break;case d.ProgressPhase.LoadingGeomMeshes:this.eventObject.percentage+=51*(1/this.requestQueue.geomMeshes.globalList.size);if(this.eventObject.percentage>100){this.eventObject.percentage=100}this.loadingGeometry+=51*(1/this.requestQueue.geomMeshes.globalList.size);if(this.loadingGeometry>=50){this.eventObject.phase=d.ProgressPhase.FinishedGeomMeshes}else{this.eventObject.phase=d.ProgressPhase.LoadingGeomMeshes}this.onContentChangesProgressCallbacks.execute(this.eventObject);break;case d.ProgressPhase.FinishedTextures:if(!this.requestQueue.textures.isWaiting()){this.eventObject.percentage+=10;this.eventObject.phase=d.ProgressPhase.FinishedTextures;this.onContentChangesProgressCallbacks.execute(this.eventObject)}break;case d.ProgressPhase.FinishedImages:if(!this.requestQueue.images.isWaiting()){this.eventObject.percentage+=10;this.eventObject.phase=d.ProgressPhase.FinishedImages;this.onContentChangesProgressCallbacks.execute(this.eventObject)}break;default:}};d.prototype.dispose=function(){this.sceneId=null;this.progressCount=null;this.requestQueue=null;this.suppressedBoundingBoxListMap=null;this.treeNodes=null;this.nodeSidsForPartialTree=null;this.annotationNodeMap=null;this.parametricNodeMap=null;this.dynamicContentNodeMap=null;this.leaderLineMaterialIdMap=null;this.imageNoteMaterialIdMap=null;this.thumbnailViewMap=null;this.viewThumbnailMap=null;this.viewAnimatedThumbnailMap=null;this.replacedNodes=null;this.updatedNodes=null;this.viewIdTreeNodesMap=null;this.viewIdBoxMap=null;this.onActiveCameraCallbacks=null;this.onInitialSceneFinishedCallbacks=null;this.onPartialRetrievalFinishedCallbacks=null;this.onSceneCompletedCallbacks=null;this.onViewFinishedCallbacks=null;this.onSetPlaybackCallbacks=null;this.onContentChangesProgressCallbacks=null;this.onInitialViewCompletedCallbacks=null};d.prototype.logPerformance=function(e){if(this.progressLogger&&this.token){this.progressLogger.logPerformance(e,this.token)}};d.prototype.setCameraSingle=function(e){this.sceneBuilder.createCamera(e,this.sceneId);return this.sceneBuilder.getCamera(e.id)};d.prototype.getPartialTreeNodes=function(e){var t=[];var i=[];var s,r,n;if(e&&e.length){for(s=0;s<e.length;s++){n=e[s];if(n==null){continue}if(n&&n.children){if(n.entityId!=null&&n.children.length===1){var a=e[n.children[0]];if(a.entityId==null){a.visualisable=false;if(a.visible===false){n.visible=false}else if(n.visible===false){a.visible=false}}}if(n.children){for(r=0;r<n.children.length;r++){var o=n.children[r];e[o].parentNode=n;if(n.renderOrder){e[o].renderOrder=n.renderOrder}}}}}for(s=0;s<e.length;s++){n=e[s];if(n==null){continue}if(n.parent){t.push(n)}else if(!n.parentNode){t.push(n);if(this.rootNodeId){n.parent=this.rootNodeId}}if(this.nodeSidsForPartialTree.has(n.sid)){i.push(n)}}}this.nodeSidsForPartialTree.clear();if(!i.length){return t}t=[];for(r=0;r<i.length;r++){var d=i[r];var l=d.parentNode;while(l){if(this.sceneBuilder.getNode(l.sid,this.sceneId)){d.parent=l.sid;t.push(d);break}else{d=l;l=l.parentNode}}}return t.length?t:i};d.prototype.buildTree=function(e){var t={};if(!this.treeNodes||!this.treeNodes.length){t.error="no tree information";return t}var i=this.treeNodes;var s=this.getPartialTreeNodes(i);this.replacedNodes.clear();var r=[];var n;var a;for(n=0;n<s.length;n++){a=s[n].parent;if(this.sceneBuilder.getNode(a,this.sceneId)){this.buildNode(s[n],a,true,e)}else{r.push(s[n])}}for(n=0;n<r.length;n++){a=r[n].parent;if(this.sceneBuilder.getNode(a,this.sceneId)){this.buildNode(s[n],a,true,e)}else{t.error=(t.error||"")+"parent ${parentSid} does not exist in the scene. \n"}}if(this.retrievalType===d.RetrievalType.Partial){this.sceneBuilder.updateViewsForReplacedNodes(this.treeNodes)}this.treeNodes=[];this.progressCount.mesh.total=this.requestQueue.meshes.globalList.size;return t};d.prototype.buildNode=function(e,t,i,s){if(!e||!t){this.loader.reportError(this,"SceneContext - buildNode - invalid args");return null}var r=this.sceneBuilder.getNode(e.sid,this.sceneId);if(r){this.sceneBuilder.remove(e.sid,this.sceneId)}if(e.suppressed===true){return null}if(!e.sid){this.loader.reportError(this,"sid is missing in treeNode");return null}e.parentId=t;this.sceneBuilder.createNode(e,this.sceneId);var n=e.parametricId;var a=e.meshId;const o=e.imageId;const d=e.dynamicContentId;if(n&&a){if(this.sceneBuilder.preferMeshes()){n=null}else{a=null}}if(n){if(this.parametricNodeMap.get(n)==null){this.parametricNodeMap.set(n,[e.sid])}else{this.parametricNodeMap.get(n).push(e.sid)}}else if(d){if(this.dynamicContentNodeMap.get(d)==null){this.dynamicContentNodeMap.set(d,[e.sid])}else{this.dynamicContentNodeMap.get(d).push(e.sid)}}else if(a&&!this.sceneBuilder.hasMesh(a)){if(this.loader.getSkipLowLODRendering()){this.requestQueue.geomMeshes.push(a,{id:a,isInitial:s})}else{this.requestQueue.meshes.push(a,{id:a,isInitial:s})}}else if(o){this.requestQueue.images.push("image_"+o,{imageId:o,usedBy:"SvgImage",isInitial:s})}if(e.annotationId&&!this.sceneBuilder.hasAnnotation(e.annotationId)){this._requestAnnotationForNode(e.annotationId,e.sid)}var l=this.sceneBuilder.getNode(e.sid,this.sceneId);if(r&&l){this.replacedNodes.set(r,l)}if(i&&e.children){for(var h=0;h<e.children.length;h++){this.buildNode(this.treeNodes[e.children[h]],e.sid,i,s)}}return l};d.prototype.setTree=function(e){if(e.sid){var t=this.sceneBuilder.getNode(e.sid,this.sceneId);if(!t||t!==this.root){var s=this.root;s.userData.treeNode={sid:e.sid,name:this.root.name?this.root.name:"root"};s.userData.skipIt=!this.root.name;this.sceneBuilder.setRootNode(s,e.sid,this.sceneId,this.vkScene);this.rootNodeId=e.sid;s.userData.entityId=this.defaultRootEntityId}}if(e.camera){e.camera.id="initial";var r=this.setCameraSingle(e.camera);if(r){this.onActiveCameraCallbacks.execute(r)}}i.measure("setTreeMeasure-"+this.sceneId,"setTree-"+this.sceneId)};d.prototype.setTreeNode=function(e){if(!Array.isArray(e.nodes)){return{error:"setTreeNode error: nodes are not properly defined"}}this.treeNodes=this.treeNodes.concat(e.nodes);return{}};d.prototype.suppressSendRequests=function(){this.loader.setSuppressSendRequests(true)};d.prototype.unsuppressSendRequests=function(){this.loader.setSuppressSendRequests(false);this.loader.sendRequest(this.requestQueue)};d.prototype.notifyFinishedTree=function(e,t){this.buildTree(t);this.phase=d.Phase.FinishedHierarchy;this._fireProgress(d.ProgressPhase.FinishedTree);if(this.retrievalType===d.RetrievalType.Initial){this.onInitialSceneFinishedCallbacks.execute(this.initialView)}else if(this.retrievalType===d.RetrievalType.Partial){this.onPartialRetrievalFinishedCallbacks.execute()}this._checkSceneCompletion()};d.prototype.setViewGroup=function(e){this.sceneBuilder.insertViewGroup(e,this.sceneId);if(!Array.isArray(e.views)){return}var t=e.id;var s,r;if(!this.currentViewGroupId){if(this.currentViewId){for(s=0;s<e.views.length;s++){r=e.views[s];if(r.id===this.currentViewId){this.currentViewGroupId=t;break}}}else{this.currentViewGroupId=t}}if(this.currentViewGroupId!==t){return}if(!this.currentViewId){this.currentViewId=e.views[0].id}for(s=0;s<e.views.length;s++){r=e.views[s];var n=this.sceneBuilder.getView(r.id,this.sceneId);for(var a=0;a<2;a++){var o=["thumbnailId","animatedThumbnailId"][a];var d=r[o];if(d!==undefined){r[o]=d=d.toString();if(this.sceneBuilder.hasImage(d)){this.sceneBuilder.setViewThumbnail(d,r.id,this.sceneId);this.loader.onViewGroupUpdatedCallbacks.execute()}else{this.thumbnailViewMap.set(d,r.id);this.requestQueue.thumbnails.push(d,{imageId:d,viewId:r.id})}if(!n){this[["viewThumbnailMap","viewAnimatedThumbnailMap"][a]].set(r.id,d)}}}if(n){n.userData.viewInfo.thumbnailId=r.thumbnailId;n.userData.viewInfo.animatedThumbnailId=r.animatedThumbnailId;continue}this.requestQueue.views.push(r.id,{viewId:r.id,viewGroupId:t})}if(!this.requestQueue.views.isWaiting()){this.sceneBuilder.finalizeViewGroups(this.sceneId);this.loader.onViewGroupUpdatedCallbacks.execute();this.onViewGroupFinishedCallbacks.execute()}i.measure("setViewGroupMeasure-"+t,"setViewGroup-"+t)};d.prototype.setView=function(e){var t=e.viewId;this.viewIdBoxMap.set(t!==undefined?t:"default",e.box);if(!t){this.setTree(e);this.initialViewDecided=true;return}if(!this.initialViewId&&!this.initialViewDecided){this.initialViewId=t;this.currentViewId=t;this.initialViewDecided=true}var s;if(this.initialViewId===t){if(e.camera){s=e.camera.id}this.setTree(e)}var r=this.viewThumbnailMap.get(t);if(r){this.viewThumbnailMap.delete(t);e.thumbnailId=r}var n=this.viewAnimatedThumbnailMap.get(t);if(n){this.viewAnimatedThumbnailMap.delete(t);e.animatedThumbnailId=n}this.sceneBuilder.insertView(e,this.sceneId);var a=this.sceneBuilder.getView(e.viewId,e.sceneId);if(a&&this.initialViewId===e.viewId){this.initialView=a}var o=[];this.viewIdTreeNodesMap.set(t,o);this.viewIdBoxMap.set(t,e.box);if(e.camera){if(s){e.camera.id=s}this.setCameraSingle(e.camera);this.sceneBuilder.setViewCamera(e.camera.id,t,this.sceneId)}this.logPerformance("setView");i.measure("setViewMeasure-"+t,"setView-"+t)};d.prototype.setViewNode=function(e,t,i){var s={context:this};if(!e.viewId){this.setTreeNode(e,i);return s}if(this.initialViewId===e.viewId){this.setTreeNode(e,i)}var r=this.sceneBuilder.getView(e.viewId,e.sceneId);if(!r){s.error="setViewNode error: setViewNode - no setView was in the chain";return s}if(this.initialViewId===e.viewId){this.initialView=r}var n=this.viewIdTreeNodesMap.get(e.viewId);n=n.concat(e.nodes);this.viewIdTreeNodesMap.set(e.viewId,n);return s};d.prototype.notifyFinishedView=function(e){var t=e.viewId;if(!t){this.notifyFinishedTree(e);return undefined}this.requestQueue.views.pop(t);if(this.initialViewId===t){this.notifyFinishedTree(e,true);this.initialViewId=null}var i=this.sceneBuilder.getView(t,this.sceneId);if(!i){return{error:"notifyFinishedView error: setViewNode - no setView was in the chain"}}if(i.activeCameraId!==undefined){i.setCamera(this.sceneBuilder.getCamera(i.activeCameraId))}this.updatedNodes.clear();var s=this.buildView(t);this.sceneBuilder.setViewNodeInfos(s.nodeInfos,t,this.sceneId);i.updatedNodes=Array.from(this.updatedNodes);if(!this.requestQueue.views.isWaiting()){this.sceneBuilder.finalizeViewGroups(this.sceneId);this.loader.onViewGroupUpdatedCallbacks.execute();this.onViewGroupFinishedCallbacks.execute()}this.onViewFinishedCallbacks.execute(i);this.logPerformance("notifyFinishedView");return undefined};d.prototype.buildView=function(e){var t={};this.treeNodes=this.viewIdTreeNodesMap.get(e);var i=this.getPartialTreeNodes(this.treeNodes);var s=[];for(var r=0;r<i.length;r++){var n=i[r].parent;this.processNodeRecursively(e,i[r],s,n,true)}t.nodeInfos=s;this.treeNodes=[];this.viewIdTreeNodesMap.delete(e);return t};d.prototype.processNodeRecursively=function(e,t,s,r,n){var a=this.sceneBuilder.getNode(t.sid,this.sceneId);var o="annotationId"in t?t.annotationId:null;if(o!=null&&a!=null&&a.userData.annotationType==="html"&&!this.sceneBuilder.hasAnnotation(o)){this._requestAnnotationForNode(o,t.sid)}if(!a){a=this.buildNode(t,r,false);if(!a){return}if(!a.userData.skipIt){a.visible=false}}if(t.materialId){this._checkIfNeededAndOrderMaterial(t.materialId,true)}var d=t.visible==undefined?true:t.visible;s.push({target:a,visible:d,materialId:t.materialId,opacity:t.opacity,meshId:t.meshId,annotationId:t.annotationId,transform:Array.isArray(t.transform)?i.arrayToColumnMajorMatrixArray16(t.transform):[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]});var l=this.treeNodes;var h=this.sceneBuilder.getChildNodeIds(t.sid,this.sceneId);var u=t.children?t.children.map(function(e){return l[e].sid}):[];var c;var p;for(p=0;p<h.length;p++){c=h[p];for(var f=0;f<u.length;f++){if(c===u[f]){h[p]=undefined;break}}}for(p=0;p<h.length;p++){var g=h[p];if(g!==undefined){var m=this.sceneBuilder.getNode(g,this.sceneId);var I=false;s.push({target:m,visible:I})}}if(t.children){for(p=0;p<t.children.length;p++){this.processNodeRecursively(e,l[t.children[p]],s,t.sid,d)}}if(t.highlightStyleId){this.sceneBuilder.recordHighlightedNodeInView(t.highlightStyleId,t.sid,e,this.sceneId)}};d.prototype.setAnnotationSingle=function(e){var t=this.annotationNodeMap.get(e.id)||[];this.annotationNodeMap.delete(e.id);var s=function(t){var s=JSON.parse(JSON.stringify(e));if(t){s.nodeId=t}if(s.detailView||s.cutaway){this.sceneBuilder.createDetailView(s,this.sceneId)}else if(s.labelMaterialId||s.label&&s.label.materialId){var r=s.labelMaterialId||s.label.materialId;if(this.sceneBuilder.checkMaterialExists(r,false)){this.sceneBuilder.createImageNote(s,this.sceneId);this.loader.onAnnotationFinishedCallbacks.execute(s.id)}else{this.requestQueue.materials.push(r);i.pushElementIntoMapArray(this.imageNoteMaterialIdMap,r,s)}}else{this.sceneBuilder.createAnnotation(s,this.sceneId);var n=s.leaderLines;if(n){for(var a=0,o=n.length;a<o;a++){var d=n[a];d.annotationId=s.id;if(this.sceneBuilder.checkMaterialExists(d.materialId,false)){this.sceneBuilder.insertLeaderLine(d,this.sceneId)}else{this.requestQueue.materials.push(d.materialId);i.pushElementIntoMapArray(this.leaderLineMaterialIdMap,d.materialId,d)}}}}}.bind(this);if(t.length>0){for(var r=0;r<t.length;r++){s(t[r])}}else{s()}this.requestQueue.annotations.pop(e.id)};d.prototype.setCamera=function(e){if(!Array.isArray(e.cameras)){return{error:"setCamera error: cameras are not properly defined"}}e.cameras.forEach(this.setCameraSingle.bind(this));return undefined};d.prototype.allocateMeshBuffer=function(e){var t=e.meshes;var i=this.sceneBuilder;if(i.preprocessMeshes){i.preprocessMeshes(t)}var s=t.length;var r,n,a,o,d,l,h,u;for(r=0;r<s;++r){n=t[r];a=n.id;if(n.skipPointCloud===true){this.requestQueue.geomMeshes.pop(a)}else if(!i.hasMesh(a)){o=n.submeshes;d=o.length;u=0;for(l=0;l<d;++l){h=o[l];h.meshId=a;if(h.clusterIndex!=null){u+=h.clusterIndex}this._checkIfNeededAndOrderMaterial(h.materialId,true);i.insertSubmesh(h)}this.requestQueue.geomMeshes.setData(a,{priority:u/d,dataSize:n.geometrySize,submeshCount:d});this.progressCount.mesh.count++}}};d.prototype.setMesh=function(e,t){var s=e.meshes;if(!Array.isArray(s)){return{error:"setMesh error: meshes are not properly defined"}}var r=this.requestQueue.geomMeshes;s.forEach(function(e){r.pop(e.id)});if(t){var n=new DataView(t.buffer,t.byteOffset,t.byteLength);var a=n.getUint16(2,true),o=0;while(a-- >0&&o<t.byteLength){var l={sceneId:this.sceneId,id:n.getUint32(o+4,true).toString(),box:[n.getFloat32(o+14,true),n.getFloat32(o+18,true),n.getFloat32(o+22,true),n.getFloat32(o+26,true),n.getFloat32(o+30,true),n.getFloat32(o+34,true)]};var h=n.getUint16(o+12,true);o+=38;if(h!==3){l.flags=n.getUint16(o,true);l.quality=n.getFloat32(o+4,true);l.pointCount=n.getUint16(o+8,true);l.elementCount=n.getUint16(o+10,true);l.encodingType=n.getUint16(o+12,true);o+=14}var u=n.getUint32(o,true);var c=t.subarray(o+4,o+4+u);o+=u;this.setGeometry(l,c)}}i.measure("setMeshMeasure-"+this.sceneId,"setMesh-"+this.sceneId);if(!r.isWaiting()){this.phase=d.Phase.FinishedGeometry;this.logPerformance("geometryFinished")}this._checkSceneCompletion();return undefined};d.prototype.setMaterialSingle=function(e,t){var i=e.id;this.requestQueue.materials.pop(i);var s;var r=this.sceneBuilder.createMaterial(e);for(s=0;s<r.length;s++){var n=r[s].imageId;this.requestQueue.textures.push(n,{imageId:n,materialId:i,isInitial:t})}var a=this.leaderLineMaterialIdMap.get(i);if(a){this.leaderLineMaterialIdMap.delete(i);for(s=0;s<a.length;s++){this.sceneBuilder.insertLeaderLine(a[s],this.sceneId)}}var o=this.imageNoteMaterialIdMap.get(i);if(o){this.imageNoteMaterialIdMap.delete(i);for(s=0;s<o.length;s++){this.sceneBuilder.createImageNote(o[s],this.sceneId)}}this.loader.onMaterialFinishedCallbacks.execute(i)};d.prototype.setMaterial=function(e,t,s){if(!Array.isArray(e.materials)){return{error:"setMaterial error: materials are not properly defined"}}e.materials.forEach(function(e){this.setMaterialSingle(e,s)}.bind(this));i.measure("setMaterialMeasure-"+this.sceneId,"setMaterial-"+this.sceneId);this._fireProgress(d.ProgressPhase.FinishedMaterials);this._checkSceneCompletion();return undefined};d.prototype.setGeometry=function(e,t){var r=e.id;if(e.data&&!t){t=i.base64ToUint8Array(e.data)}if(!t||t.length===0){return{error:"setGeometry error: no data for geometry "+r}}var n=this.sceneBuilder.getTempGeometryBuffer?this.sceneBuilder.getTempGeometryBuffer():undefined;var a=s.getGeometryInfo(e,t,n);if(!a){return{error:"setGeometry error: failed to parse geometry "+r+" data"}}this.sceneBuilder.setGeometry(a);this.progressCount.geometry.count++;i.measure("setGeometryMeasure-"+r,"setGeometry-"+r);return undefined};d.prototype.setImage=function(t,s){var r=t.id;if(!s){return{error:"setImage error: no image content for "+r}}t.binaryData=s;this.sceneBuilder.createImage(t);if(this.requestQueue.textures.pop(r)){e.info("Received texture image id: "+r);this.loader.onImageFinishedCallbacks.execute({id:r});this._fireProgress(d.ProgressPhase.FinishedTextures);this._checkSceneCompletion()}else if(this.requestQueue.thumbnails.pop(r)){var n=this.thumbnailViewMap.get(r);if(n){this.thumbnailViewMap.delete(r);this.sceneBuilder.setViewThumbnail(r,n,this.sceneId,t.tileWidth);this.loader.onViewGroupUpdatedCallbacks.execute()}}i.measure("setImageMeasure-"+r,"setImage-"+r);return undefined};d.prototype.setSvgImage=function(e){const t=e.id;const i=e.svgContent;if(!i){return{error:"setImage error: no image content for "+t}}for(const e of this.sceneBuilder._nodes.values()){if(e.nodeContentType=="SvgImage"&&e.imageId==t){const t="data:image/svg+xml;base64,"+btoa(i);e.setImageData(t)}}this.requestQueue.images.pop("image_"+t);this._fireProgress(d.ProgressPhase.FinishedImages);this._checkSceneCompletion();return undefined};d.prototype.setAnnotation=function(e){if(!Array.isArray(e.annotations)){return{error:"setAnnotation error: annotations are not properly defined"}}e.annotations.forEach(this.setAnnotationSingle,this);this._checkSceneCompletion();return undefined};d.prototype.setHighlightStyle=function(e){e.id=e.id.toString();this.sceneBuilder.insertHighlightStyle(e)};d.prototype.setLineStyle=function(e){e.lineStyles.forEach(function(e){this.sceneBuilder.insertLineStyle(e)},this)};d.prototype.setFillStyle=function(e){e.fillStyles.forEach(function(e){this.sceneBuilder.insertFillStyle(e)},this)};d.prototype.setTextStyle=function(e){e.textStyles.forEach(function(e){this.sceneBuilder.insertTextStyle(e)},this)};d.prototype._checkIfNeededAndOrderMaterial=function(e,t,i){if(e&&this.sceneBuilder.materialNeeded(i)&&this.sceneBuilder.checkMaterialExists(e,t)===false){this.requestQueue.materials.push(e)}};d.prototype.setParametric=function(e){for(var t=0;t<e.parametrics.length;t++){var i=e.parametrics[t];var s=i.id.toString();var r=this.parametricNodeMap.get(s);this.parametricNodeMap.delete(s);for(var n=0;r&&n<r.length;n++){if(i.shapes!=null){for(var a=0;a<i.shapes.length;a++){this._checkIfNeededAndOrderMaterial(i.shapes[a].materialID,false,i)}}else{this._checkIfNeededAndOrderMaterial(i.materialID,false,i)}this.sceneBuilder.setParametricContent(r[n],i,this.sceneId)}}};d.prototype.setMarker=function(e){if(!Array.isArray(e.markers)){return}e.markers.forEach(e=>{this.sceneBuilder.bindMarkerNodeTransformationToReferenceNode(e.referenceNode,e.makrerNodeSid,e.coordinateSpace)});this._checkSceneCompletion()};d.prototype.setPointCloudGroup=function(e){this.sceneBuilder.setPointCloudGroups(e.pointCloudGroups,this.sceneId)};d.prototype.setDynamicContent=function(e){for(const t of e.dynamicContents){const e=t.id.toString();const i=this.dynamicContentNodeMap.get(e);if(i){this.dynamicContentNodeMap.delete(e);for(const e of i){this.sceneBuilder.setDynamicContent(e,t,this.sceneId)}}}};d.prototype.setPlayback=function(e){if(!Array.isArray(e.playbacks)){return{error:"setPlayback error: playbacks are not properly defined"}}var t=this.sceneBuilder.getView(e.viewId,this.sceneId);var i=false;var s,r;if(this.playbackIds){for(s=0;s<e.playbacks.length;s++){r=e.playbacks[s];for(var n=0;n<this.playbackIds.length;n++){if(r.id===this.playbackIds[n]){r.notLoading=false;break}}if(r.notLoading===undefined){r.notLoading=true}}delete this.playbackIds;i=true;if(!t.sortPlaybacks(true)){t.resetPlaybacksStartTimes(true)}}if(Array.isArray(e.joints)){this.sceneBuilder.insertJoints(e.joints,this.sceneId)}for(s=0;s<e.playbacks.length;s++){r=e.playbacks[s];if(r.notLoading){continue}if(r.id==null){r.id=e.viewId+"-playback";r.sequence.id=e.viewId+"-cont";r.sequenceId=r.sequence.id;this.setSequence({sequences:[r.sequence]})}this.sceneBuilder.insertPlayback(r,e.viewId,this.sceneId)}this.sceneBuilder.finalizeAnimation();this.sceneBuilder.finalizePlaybacks();if(i){this.onSetPlaybackCallbacks.execute(t)}return undefined};d.prototype.setSequenceSingle=function(e,t){function i(e){for(var t in e){if(e.hasOwnProperty(t)){return false}}return true}if(e.nodes){var s=[];for(var r=0;r<e.nodes.length;r++){var n=e.nodes[r];var a=n.rrotate||n.rotate;if(a){var o={};if(a.trackId){o.trackId=a.trackId}else if(t&&a.track!==undefined){o.trackId=t[a.track].id}o.sid=n.sid;o.binding="ROTATE";if(a.pivot){o.pivot=a.pivot}if(n.rotate){o.isAbsoluteValue=true}if(i(a)){o.empty=true}s.push(o)}var d=n.rtranslate||n.translate;if(d){var l={};if(d.trackId){l.trackId=d.trackId}else if(t&&d.track!==undefined){l.trackId=t[d.track].id}l.sid=n.sid;l.binding="TRANSLATE";if(d.pivot){l.pivot=d.pivot}if(n.translate){l.isAbsoluteValue=true}if(i(d)){l.empty=true}s.push(l)}var h=n.rscale||n.scale;if(h){var u={};if(h.trackId){u.trackId=h.trackId}else if(t&&h.track!==undefined){u.trackId=t[h.track].id}u.sid=n.sid;u.binding="SCALE";if(h.pivot){u.pivot=h.pivot}if(n.scale){u.isAbsoluteValue=true}if(i(h)){u.empty=true}s.push(u)}if(n.opacity!==undefined||n.ropacity!==undefined){var c;if(n.opacity){c=n.opacity}else{c=n.ropacity}var p={};if(c.trackId){p.trackId=c.trackId}else if(t&&c.track!==undefined){p.trackId=t[c.track].id}p.sid=n.sid;p.binding="OPACITY";if(n.opacity){p.isAbsoluteValue=true}if(i(c)){p.empty=true}s.push(p)}}e.nodes=s}this.sceneBuilder.insertSequence(e,this.sceneId)};d.prototype.setSequence=function(e){if(!Array.isArray(e.sequences)){return{error:"setSequence error: sequences are not properly defined"}}if(Array.isArray(e.joints)){this.sceneBuilder.insertJoints(e.joints,this.sceneId)}for(var t=0;t<e.sequences.length;t++){this.setSequenceSingle(e.sequences[t],e.tracks)}if(e.tracks){this.setTrack(e)}this.loader.onSetSequenceCallbacks.execute();return undefined};d.prototype.setTrack=function(e){if(!Array.isArray(e.tracks)){return{error:"setTrack error: tracks are not properly defined"}}var t=[];for(var i=0;i<e.tracks.length;i++){var s=e.tracks[i];s.times=s.time;if(s.vector3){s.values=s.vector3}else if(s.quaternion){s.values=s.quaternion;s.rotateType=o.Quaternion}else if(s.angleAxis){s.values=s.angleAxis;s.rotateType=o.AngleAxis}else if(s.euler){s.values=s.euler;s.rotateType=o.Euler}else if(s.scalar){s.values=s.scalar}s.cyclicInfo={};s.cyclicInfo.cyclicStart=s.cyclicStart;s.cyclicInfo.cyclicEnd=s.cyclicEnd;t.push(s)}this.sceneBuilder.insertTracks(t);return undefined};d.prototype.notifyError=function(e){if(!e.error){e.error="Unknown error"}return e};d.prototype._requestAnnotationForNode=function(e,t){var i=this.annotationNodeMap.get(e);if(i==null){this.annotationNodeMap.set(e,[t]);this.requestQueue.annotations.push(e)}else if(!i.includes(t)){i.push(t)}return this};return d});
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/totara/TotaraLoader", ["sap/base/Log","./SceneContext","./CallbackHandler","./Command","./TotaraUtils","../helpers/WorkerScriptLoader"],function(e,t,i,n,s,a){"use strict";var r=s.mark;var o=function(){this._performanceTimingMsg=[];this._isPostable=true;this._suppressSendRequests=false;this._loadingFinishedSent=false;this.currentSceneInfo={};this.contextMap=new Map;this.tokenContextMap=new Map;this._skipLowLODRendering=true;this._maxUrlLength=2048;this._maxActiveRequests=4;this._consumptionScenario=null;this._meshesBatchSize=1024;this._materialsBatchSize=128;this._geomMeshesBatchSize=1024;this._geomMeshesMaxBatchDataSize=10*1024*1024;this._annotationsBatchSize=128;this._voxelThreshold=.03;this.onErrorCallbacks=new i;this.onImageFinishedCallbacks=new i;this.onImageDetailsFinishedCallbacks=new i;this.onMaterialFinishedCallbacks=new i;this.onAnnotationFinishedCallbacks=new i;this.onSetSequenceCallbacks=new i;this.onSetTrackCallbacks=new i;this.onViewGroupUpdatedCallbacks=new i;this.onLoadingFinishedCallbacks=new i};o.prototype.running=function(){return this._worker!==null&&this._worker!==undefined};o.prototype.run=function(){if(!this._worker){this._worker=a.loadScript("sap/ui/vk/totara/TotaraLoaderWorker.js");var e=this;this._worker.onmessage=function(t){var i=t.data;i.jsonContent=i.jsonContent||{};if(i.jsonString){var n=JSON.parse(i.jsonString);delete i.jsonString;i.jsonContent=Object.assign(n,i.jsonContent)}var s=e.processCommand(i.name,i.jsonContent,i.binaryContent,i.isInitial);if(s){e.sendRequest(s.requestQueue)}};this._worker.onerror=function(e){}}return Promise.resolve("TotaraLoader is ready")};o.prototype.getUrl=function(){return this._url};o.prototype.setUrl=function(e){this._url=e;if(!this._url.endsWith("/")){this._url+="/"}return this};o.prototype.getSessionId=function(){return this._sessionId};o.prototype.setSessionId=function(e){this._sessionId=e;return this};o.prototype.getSkipLowLODRendering=function(){return this._skipLowLODRendering};o.prototype.setSkipLowLODRendering=function(e){this._skipLowLODRendering=e;return this};o.prototype.getMaxUrlLength=function(){return this._maxUrlLength};o.prototype.setMaxUrlLength=function(e){this._maxUrlLength=e;return this};o.prototype.getMaxActiveRequests=function(){return this._maxActiveRequests};o.prototype.setMaxActiveRequests=function(e){this._maxActiveRequests=e;this.postMessage({method:n.setMaxActiveRequests,maxActiveRequests:e})};o.prototype.getConsumptionScenario=function(){return this._consumptionScenario};o.prototype.setConsumptionScenario=function(e){this._consumptionScenario=e;this.postMessage({method:n.setConsumptionScenario,consumptionScenario:e})};o.prototype.getMeshesBatchSize=function(){return this._meshesBatchSize};o.prototype.setMeshesBatchSize=function(e){this._meshesBatchSize=e;return this};o.prototype.getMaterialsBatchSize=function(){return this._materialsBatchSize};o.prototype.setMaterialsBatchSize=function(e){this._materialsBatchSize=e;return this};o.prototype.getGeomMeshesBatchSize=function(){return this._geomMeshesBatchSize};o.prototype.setGeomMeshesBatchSize=function(e){this._geomMeshesBatchSize=e;return this};o.prototype.getGeomMeshesMaxBatchDataSize=function(){return this._geomMeshesMaxBatchDataSize};o.prototype.setGeomMeshesMaxBatchDataSize=function(e){this._geomMeshesMaxBatchDataSize=e;return this};o.prototype.getAnnotationsBatchSize=function(){return this._annotationsBatchSize};o.prototype.setAnnotationsBatchSize=function(e){this._annotationsBatchSize=e;return this};o.prototype.getVoxelThreshold=function(){return this._voxelThreshold};o.prototype.setVoxelThreshold=function(e){this._voxelThreshold=e;if(this.sceneBuilder){this.sceneBuilder.setVoxelThreshold(e)}return this};o.prototype.setSceneBuilder=function(e){this.sceneBuilder=e;this.sceneBuilder.setVoxelThreshold(this.getVoxelThreshold())};o.prototype.removeContext=function(e){this.contextMap.delete(e);return this};o.prototype.dispose=function(){this.contextMap.forEach(function(e){e.dispose()});this.contextMap.clear();this.tokenContextMap.clear();if(this._worker!=null){this.postMessage({method:"close"});this._worker=this._worker.onmessage=this._worker.onerror=null}this.currentSceneInfo=null;if(this.sceneBuilder){this.sceneBuilder.cleanup();this.sceneBuilder=null}this.onErrorCallbacks=null;this.onMaterialFinishedCallbacks=null;this.onImageFinishedCallbacks=null;this.onImageDetailsFinishedCallbacks=null;this.onSetTrackCallbacks=null;this.onSetSequenceCallbacks=null;this.onAnnotationFinishedCallbacks=null};o.prototype.cleanup=function(){this.currentSceneInfo={};this.contextMap.clear();this.tokenContextMap.clear();this.sceneBuilder.cleanup()};o.prototype.getSceneBuilder=function(){return this.sceneBuilder};o.prototype.getContext=function(e){return this.contextMap.get(e)};o.prototype.createContext=function(e,i){var n=new t(e,i,this);this.contextMap.set(e,n);this.tokenContextMap.set(n.requestQueue.token,n);if(n.onActiveCamera){n.onActiveCameraCallbacks.attach(n.onActiveCamera);delete n.onActiveCamera}if(n.onInitialSceneFinished){n.onInitialSceneFinishedCallbacks.attach(n.onInitialSceneFinished);delete n.onInitialSceneFinished}if(n.onPartialRetrievalFinished){n.onPartialRetrievalFinishedCallbacks.attach(n.onPartialRetrievalFinished);delete n.onPartialRetrievalFinished}if(n.onViewFinished){n.onViewFinishedCallbacks.attach(n.onViewFinished);delete n.onViewFinished}if(n.onSceneCompleted){n.onSceneCompletedCallbacks.attach(n.onSceneCompleted);delete n.onSceneCompleted}if(n.onProgressChanged){n.setOnProgressChanged(n.onProgressChanged);delete n.onProgressChanged}if(n.onLoadingFinished){this.onLoadingFinishedCallbacks.detachAll();this.onLoadingFinishedCallbacks.attach(n.onLoadingFinished);delete n.onLoadingFinished}if(n.onContentChangesProgress){n.onContentChangesProgressCallbacks.attach(n.onContentChangesProgress);delete n.onContentChangesProgress}if(n.onInitialViewCompleted){n.onInitialViewCompletedCallbacks.attach(n.onInitialViewCompleted);delete n.onInitialViewCompleted}return n};o.prototype.isLoadingFinished=function(){var e=this.contextMap.values();var t=e.next();while(!t.done){if(!t.value.isLoadingFinished()){return false}t=e.next()}return true};o.prototype.decrementResourceCountersForDeletedTreeNode=function(e,t){if(e){this.sceneBuilder.decrementResourceCountersForDeletedTreeNode(t,e.sceneId)}};function c(e,t){if(e.progressLogger){e.progressLogger.logPerformance(t,e.token)}}o.prototype.request=function(e,i,a){if(!i.root){throw"Context must include root where loaded objects are attached to"}var o=this.createContext(e,i);o.token=o.requestQueue.token;this.currentSceneInfo.id=e;o.retrievalType=t.RetrievalType.Initial;o.authorizationHandler=a;o.initialRequestTime=Date.now();if(o.enableLogger){s.createLogger(e,o,this)}var l;if(sap.ui.Device.browser.mobile){l=Math.min(8*1024,this.getMaxUrlLength())}else{l=Math.min(64*1024,this.getMaxUrlLength())}var u=h(this.getUrl()+"streaming-http",this.getUrl(),e,this.getSessionId(),l);var d=o.requestQueue;d.meshes.setBatchSizeInfo(u[n.getMesh]);d.materials.setBatchSizeInfo(u[n.getMaterial]);d.geomMeshes.setBatchSizeInfo(u[n.getGeomMesh]);d.annotations.setBatchSizeInfo(u[n.getAnnotation]);var p=this;(a&&a(this.getUrl())||Promise.resolve()).then(function(t){c(o,"modelRequested");r("modelRequested");p.postMessage({method:"useAccessTokenResponse",accessTokenResponse:t});p.postMessage({method:"initializeConnection",url:p.getUrl(),sessionId:p.getSessionId(),maxActiveRequests:p.getMaxActiveRequests(),consumptionScenario:p.getConsumptionScenario()});p.postMessage({method:n.getScene,sceneId:e})})};o.prototype.postMessage=function(e){this._worker?.postMessage(e)};o.prototype.processSetSceneCommand=function(e){var t=this.getContext(e.id);if(t){t.defaultViewId=e.defaultViewId;t.defaultViewGroupId=e.defaultViewGroupId;t.sceneThumbnailId=e.thumbnailId;t.dimension=e.dimension;t.defaultRootEntityId=e.defaultRootEntityId;if(t.defaultViewGroupId){t.currentViewGroupId=t.defaultViewGroupId}if(this.sceneBuilder){this.sceneBuilder.setSceneMetadata(e.metadata)}var i;if(t.activateView){i=t.activateView}else if(t.defaultViewId){i=t.defaultViewId}if(i){t.initialViewId=t.currentViewId=i;t.initialViewDecided=true}this.postMessage({method:n.getView,parameters:{sceneId:t.sceneId,viewId:i,query:s.configureSceneViewQuery(t)},pushViewGroups:t.pushViewGroups,isInitial:true})}};o.prototype.update=function(e,i,a){this.currentSceneInfo.id=e;var r=this.getContext(e);if(!r){return Promise.reject("no context for ${sceneVeId}")}var o=this;return new Promise(function(l,u){r.nodeSidsForPartialTree=new Set(i);r.retrievalType=t.RetrievalType.Partial;var h=function(){r.onPartialRetrievalFinishedCallbacks.detach(h);c(r,"updateFinished(mesh)");var t=[];var n=[];r.replacedNodes.forEach(function(e,i){n.push(e);t.push(i)});var s=t;var a=n;l({sceneVeId:e,sids:i,replacedNodeRefs:s,replacementNodeRefs:a})};r.onPartialRetrievalFinishedCallbacks.attach(h);c(r,"updateRequested");o.postMessage({method:n.getView,parameters:{sceneId:e,viewId:a,query:Object.assign(s.configureSceneViewQuery(r),{breadcrumbs:true}),sids:i},isPartialTree:true})})};o.prototype.requestViewGroup=function(e,t,i,n){if(!t){return Promise.reject("invalid arg: viewGroupId undefined")}var s=this.getContext(e);if(!s){return Promise.reject("no context for ${sceneVeId}")}if(i!==undefined){s.includeAnimation=i}var a=this;var r=new Promise(function(i,r){if(!n){var o=a.sceneBuilder.getViewGroup(t,e);if(o&&o.length){i(o);return}}var l=function(){s.onViewGroupFinishedCallbacks.detach(l);c(s,"onViewGroupFinished");var n=a.sceneBuilder.getViewGroup(t,e);if(n&&n.length){i(n)}else{r("no view ground data")}};s.onViewGroupFinishedCallbacks.attach(l);s.currentViewGroupId=t;a.postMessage({method:"getViewGroups",parameters:{sceneId:e,viewGroupId:t}})});return r};o.prototype.requestView=function(e,t,i,a,r){this.currentSceneInfo.id=e;if(t!=="static"){return Promise.reject("invalid arg: supported type - static")}if(!i){return Promise.reject("invalid arg: viewId undefined")}var o=this.getContext(e);if(!o){return Promise.reject("no context for ${sceneVeId}")}o.currentViewId=i;var l;var u;if(a&&a.length>0){u=n.getViewAnimations;l={$expand:[]};o.playbackIds=a}else{u=n.getView;l=s.configureSceneViewQuery(o)}var h=this;var d=new Promise(function(e,t){o.onSetPlaybackCallbacks.detachAll();var n=function(i){o.onSetPlaybackCallbacks.detach(n);c(o,"onSetPlayback");if(i){e(i)}else{t("no view data")}};o.onSetPlaybackCallbacks.attach(n);o.onViewFinishedCallbacks.detachAll();var s=function(i){o.onViewFinishedCallbacks.detach(s);c(o,"onViewFinished");if(i){e(i)}else{t("no view data")}};o.onViewFinishedCallbacks.attach(s);h.onSetSequenceCallbacks.detachAll();var a=function(){h.onSetSequenceCallbacks.detach(a);c(o,"onSetSequence");if(o.currentView){e(o.currentView)}};h.onSetSequenceCallbacks.attach(a);h.onSetTrackCallbacks.detachAll();var r=function(t){h.onSetTrackCallbacks.detach(r);c(o,"onSetTrack");if(o.currentView){e(o.currentView)}};h.onSetTrackCallbacks.attach(r);c(o,"viewRequested");h.postMessage({method:u,parameters:{sceneId:o.sceneId,viewId:i,query:l}})});return d};o.prototype.requestMaterial=function(e,t){if(!t){return Promise.reject("invalid arg: requestedMaterial undefined")}var i=this.getContext(e);if(!i){return Promise.reject("no context for ${sceneVeId}")}var n=this;var s=new Promise(function(e,s){var a="";if(typeof t=="string"){a=t}else if(typeof t=="object"){if(typeof t.getMaterialRef==="function"){e(t.getMaterialRef());return}else if(t.id){a=t.id}else if(t.veId){a=t.veId}else{s("invalid arg: invalid requestedMaterial object");return}}else{s("invalid arg: requestedMaterial must be an object or a string");return}var r=i.sceneBuilder.getMaterial(a);if(r){e(r);return}i.requestQueue.materials.push(a);var o=function(t){if(a!==t.materialId){return}var i=n.sceneBuilder.getMaterial(a);if(i&&!i.userData.imageIdsToAddAsTexture){n.sceneBuilder.detachImageAddedToMaterial(o);e(i)}};var c=function(t){if(a!=t){return}n.onMaterialFinishedCallbacks.detach(c);var i=n.sceneBuilder.getMaterial(a);if(!i){n.sceneBuilder.detachImageAddedToMaterial(o);s("no material data")}if(i.userData.imageIdsToAddAsTexture){return}n.sceneBuilder.detachImageAddedToMaterial(o);e(i)};n.onMaterialFinishedCallbacks.attach(c);n.sceneBuilder.attachImageAddedToMaterial(o);n.sendRequest(i.requestQueue)});return s};o.prototype.requestAnnotation=function(e,t){if(!t){return Promise.reject("invalid arg: annotationId undefined")}var i=this.getContext(e);if(!i){return Promise.reject("no context for ${sceneVeId}")}var n=this;var s=new Promise(function(e,s){var a=function(e){return i.sceneBuilder.getAnnotation?i.sceneBuilder.getAnnotation(e):null};var r=a(t);if(r){e(r);return}i.requestQueue.annotations.push(t);var o;var c;var l=function(i){n.onAnnotationFinishedCallbacks.detach(o);var s=a(t);var r=n.sceneBuilder._getMaterial(s.label.materialId);if(r&&r.userData.imageDetailsToLoad&&!r.userData.imageDetailsToLoad.size){n.onImageDetailsFinishedCallbacks.detach(l);if(r.userData.imageIdsToLoad&&r.userData.imageIdsToLoad.size){return}e(s)}};var u=function(i){n.onAnnotationFinishedCallbacks.detach(o);var s=a(t);var r=n.sceneBuilder._getMaterial(s.label.materialId);if(r&&r.userData.imageIdsToLoad&&!r.userData.imageIdsToLoad.size){n.onImageFinishedCallbacks.detach(u);if(r.userData.imageDetailsToLoad&&r.userData.imageDetailsToLoad.size){return}e(s)}};c=function(i){n.onAnnotationFinishedCallbacks.detach(o);var r=a(t);if(r.label.materialId!=i){return}n.onMaterialFinishedCallbacks.detach(c);if(!n.sceneBuilder.checkMaterialExists(i,false)){n.onImageFinishedCallbacks.detach(u);s("no material data")}var h=n.sceneBuilder._getMaterial(i);if(h.userData.imageIdsToLoad&&h.userData.imageIdsToLoad.size||h.userData.imageDetailsToLoad&&h.userData.imageDetailsToLoad.size){return}n.onImageFinishedCallbacks.detach(u);n.onImageDetailsFinishedCallbacks.detach(l);e(r)};o=function(i){if(t!==i){return}n.onAnnotationFinishedCallbacks.detach(o);var a=n.sceneBuilder.getAnnotation?n.sceneBuilder.getAnnotation(t):null;if(!a){n.onMaterialFinishedCallbacks.detach(c);n.onImageFinishedCallbacks.detach(u);n.onImageDetailsFinishedCallbacks.detach(l);s("no annotation data")}n.onMaterialFinishedCallbacks.detach(c);n.onImageFinishedCallbacks.detach(u);n.onImageDetailsFinishedCallbacks.detach(l);e(a)};n.onAnnotationFinishedCallbacks.attach(o);n.onMaterialFinishedCallbacks.attach(c);n.onImageFinishedCallbacks.attach(u);n.onImageDetailsFinishedCallbacks.attach(l);n.sendRequest(i.requestQueue)});return s};o.prototype.setSuppressSendRequests=function(e){this._suppressSendRequests=e};o.prototype.sendRequest=function(e){if(!this._worker||this._suppressSendRequests){return false}var t=false;while(!e.isEmpty()){var i=e.generateRequestCommand();this.postMessage(i);t=true}return t};o.prototype.timestamp=function(e){};o.prototype.performanceTiming=function(e){};o.prototype.checkError=function(e){if(!e){return true}var t=e.result==="failure";if(t){if(e.message){e.error=e.message;delete e.message}else{e.error="Unknown error"}}return t};o.prototype.reportError=function(e,t){this.onErrorCallbacks.execute({error:t,context:e})};o.prototype.processContextCommand=function(t,i,n,s,a){if(!t){var r=i+" error: unknown context - "+JSON.stringify(n);this.contextMap.forEach(function(e){e[i].call(e,n,s)});return{error:r}}var o;try{o=t[i].call(t,n,s,a)}catch(t){e.error("An error happened while processing an HTTP response",t);o={error:t}}return o};o.prototype.processCommand=function(t,i,s,a){if(this.checkError(i)){if(t===n.setTree){if(i.events&&i.events.length){var r=i.events[0];if(r.values&&r.values.id){this.contextMap.delete(r.values.id)}}}this.onErrorCallbacks.execute(i);return null}var o=null;if(i.sceneId!==undefined){o=this.getContext(i.sceneId)}else if(i.token!==undefined){o=this.tokenContextMap.get(i.token)}if(o){this.currentSceneInfo.id=o.sceneId}this.setPerformance(t,i,o?o.sceneId:null);var c;switch(t){case n.setScene:this.processSetSceneCommand(i);break;case n.setTree:case n.setTreeNode:case n.notifyFinishedTree:case n.setView:case n.setViewNode:case n.setViewGroup:case n.notifyFinishedView:case n.setCamera:case n.allocateMeshBuffer:case n.setMesh:case n.setMaterial:case n.setGeometry:case n.setImage:case n.setSvgImage:case n.setAnnotation:case n.setLineStyle:case n.setFillStyle:case n.setTextStyle:case n.setParametric:case n.setPointCloudGroup:case n.setDynamicContent:case n.setPlayback:case n.setHighlightStyle:case n.setSequence:case n.setTrack:case n.suppressSendRequests:case n.unsuppressSendRequests:case n.setMarker:c=this.processContextCommand(o,t,i,s,a);break;case n.notifyError:c={error:i.errorText};break;case n.timestamp:c=this.timestamp(i);break;case n.performanceTiming:c=this.performanceTiming(i);break;default:c={error:"Unknown command: "+t};break}if(this.isLoadingFinished()){if(t!==n.setScene&&t!==n.setView&&t!==n.setViewNode&&t!==n.timestamp&&t!==n.performanceTiming&&t!==n.suppressSendRequests&&t!==n.unsuppressSendRequests&&this._loadingFinishedSent===false){this.onLoadingFinishedCallbacks.execute();this._loadingFinishedSent=true;e.info("Loading is finished - all streaming requests are fulfilled.")}}else if(this._loadingFinishedSent){this._loadingFinishedSent=false}if(c&&c.error){e.error(c.error);this.onErrorCallbacks.execute(c)}return o};o.prototype.setPerformance=function(e,t,i){var s;switch(e){case n.setGeometry:s=t.id;r("setGeometry-"+s);break;case n.setImage:s=t.id;r("setImage-"+s);break;case n.setView:s=t.viewId;r("setView-"+s);break;case n.setViewGroup:s=t.id;r("setViewGroup-"+s);break;case n.setMesh:r("setMesh-"+i);break;case n.setMaterial:r("setMaterial-"+i);break;case n.setTree:r("setTree-"+i);break;case n.performanceTiming:this._isPostable=true;this.postPerformanceTiming();break;default:break}};o.prototype.postPerformanceTiming=function(e){if(e){this._performanceTimingMsg.push(e)}if(this._isPostable&&this._performanceTimingMsg.length>0){this.postMessage(this._performanceTimingMsg.shift());this._isPostable=false}};o.prototype.printLogTokens=function(){this.contextMap.forEach(function(t,i){e.info("log tokens for scene => "+i);e.info("---------------------------------------");if(t.progressLogger){t.progressLogger.getTokens().forEach(function(t){e.info(t)})}e.info("---------------------------------------")})};function l(e,t,i,n,s,a){var r;var o;switch(e){case"getGeomMesh":o=a-(i+"scenes/"+n+"/meshes?types=box&ids="+r).length;break;default:r="?request="+encodeURI(e+"["+a+"]"+JSON.stringify({sceneId:n,ids:[],token:s}));o=a-(t+r).length;break}return o}function u(e){return",".length}function h(e,t,i,n,s){e=e.indexOf("?")===-1?e:e.substring(0,e.indexOf("?"));var a=["getAnnotation","getGeomMesh","getMaterial","getMesh","getParametric","getSequence","getTrack"];var r={};a.forEach(function(a){r[a]={maxBatchStringLength:l(a,e,t,i,n,s),separatorLength:u(a)}});return r}return o});
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/totara/TotaraUtils", ["./Command","../IncludeUsageIdType","../TransformationMatrix"],function(e,r,n){"use strict";var t={};t.createCommand=function(e,r){var n=JSON.stringify(r);return e+("["+n.length+"]")+n};t.createRequestCommand=function(e,r,n){return{command:t.createCommand(e,r),method:e,isInitial:n===true}};t.createRequest=function(e,r,n){return{method:e,parameters:r,isInitial:n===true}};function a(r,n,a){if(!r||!n||!a){throw"ProgressLogger: invalid args"}this.context=n;this.loader=a;var i=new Set;this.logPerformance=function(r,a){if(!r||!a){return}i.add(a);var o={name:r,timestamp:Date.now(),token:a};var u={method:e.addClientLog,url:this.loader.getUrl(),token:n.token,command:t.createCommand(e.addClientLog,o)};this.loader.postMessage(u)};this.getTokens=function(){return i};this.logPerformanceTiming=function(r,a){var o=this;r.sort(function(e,r){return e.timestamp-r.timestamp});if(!r.length){return}i.add(n.token);var u=[];while(r.length){u.push(r.splice(0,10))}u.forEach(function(r){var i={records:[],timestamp:Date.now()};r.forEach(function(e){i.records.push({name:e.name,timestamp:e.timestamp,uuid:e.uuid,duration:e.duration,value:e.value,parent_uuid:a})});var u=t.createCommand(e.performanceTiming,i);o.loader.postPerformanceTiming({method:e.performanceTiming,url:o.loader.getUrl(),token:n.token,command:u})})}}t.mark=function(e){window.performance.mark(e)};t.measure=function(e,r,n){var t=window.performance;if(performance.getEntriesByName(r).length!==0){if(!n){t.measure(e,r)}else{t.measure(e,r,n)}}t.clearMarks(r);if(n){t.clearMarks(n)}t.clearMeasures(e)};t.perfObserve=function(e){if(!window.PerformanceObserver){return}var r=[];var n;var a=performance.timing.navigationStart;var i=new window.PerformanceObserver(function(i){i.getEntries().forEach(function(e){e.uuid=t.generateToken();e.timestamp=a+e.startTime;if(e.name==="sceneMeasure"){n=e.uuid}r.push(e)});if(r.find(function(e){return e.name==="sceneCompleted"})){t.measure("sceneMeasure","modelRequested","sceneCompleted")}if(n){r=r.filter(function(e){return e instanceof PerformanceMeasure});e.progressLogger.logPerformanceTiming(r,n);n=""}});i.observe({entryTypes:["mark","measure"]})};t.createLogger=function(e,r,n){if(!r){return null}r.progressLogger=new a(e,r,n);t.perfObserve(r);return r.progressLogger};t.base64ToUint8Array=function(e){var r=atob(e);var n=r.length;var t=new Uint8Array(n);for(var a=0;a<n;a++){t[a]=r.charCodeAt(a)}return t};t.arrayToColumnMajorMatrixArray16=function(e){if(e.length===16){return e}if(e.length===12){return n.convertTo4x4(e)}if(e.length===3){return[1,0,0,0,0,1,0,0,0,0,1,0,e[0],e[1],e[2],1]}return null};t.pushElementIntoMapArray=function(e,r,n){var t=e.get(r);if(!t){t=[];e.set(r,t)}else if(t.length>0&&t[t.length-1]===n){return t.length}t.push(n);return t.length};t.generateToken=function(){return i()};function i(){function e(){return Math.floor((1+Math.random())*65536).toString(16).substring(1)}return e()+e()+"-"+e()+"-"+e()+"-"+e()+"-"+e()+e()+e()}var o=["annotationId","closed","contentType","entityId","highlightStyleId","materialId","meshId","name","opacity","renderOrder","renderStage","transform","visible","selectable"];var u=["annotation","bounds","meshes","box","image","highlight","nodes","markers","pointCloudGroups","dynamicContents"];var s=["annotation","drawing","geometry","hotspot","reference","sectionplane","solid","symbol","markers","pointCloudGroup","dynamicContent","svg","unknown"];t.configureSceneViewQuery=function(e){var n=o.slice();var t=u.slice();var a=s.slice();if(e.includeAnimation){t.push("animation")}if(e.includeBackground){a.push("background")}if(e.includeParametric){t.push("parametric");a.push("parametric")}if(e.includeMetadata){t.push("metadata");a.push("metadata")}if(e.includeUsageId){t=t.concat(r.to$expandQueryParameter(e.includeUsageId))}if(e.pushPMI){a.push("pmi")}var i={$select:n.join(","),$expand:t.join(","),contentTypes:a.join(","),hidden:e.includeHidden};if(e.metadataFilter!=null){i.metadataFilter=e.metadataFilter}return i};return t});
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/utf8ArrayBufferToString", [],function(){"use strict";var e=function(e){return decodeURIComponent(escape(String.fromCharCode.apply(null,new Uint8Array(e))))};return e},true);
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine("sap/ui/vk/uuidv4", [],function(){"use strict";var x=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(x){var r=Math.random()*16|0,n=x=="x"?r:r&3|8;return n.toString(16)})};return x},true);
sap.ui.require.preload({
	"sap/ui/vk/manifest.json":'{"_version":"1.21.0","sap.app":{"id":"sap.ui.vk","type":"library","embeds":[],"applicationVersion":{"version":"1.141.0"},"title":"SAPUI5 Visualization Toolkit.","description":"SAPUI5 Visualization Toolkit.","ach":"CA-UI5-VTK","resources":"resources.json","offline":true,"openSourceComponents":[{"name":"gl-matrix","packagedWithMySelf":true,"version":"3.4.3"},{"name":"html2canvas","packagedWithMySelf":true,"version":"1.0.0-alpha.12"},{"name":"pdfjs-dist","packagedWithMySelf":true,"version":"4.2.67"},{"name":"threejs","packagedWithMySelf":true,"version":"0.164.0"},{"name":"imagetracer","packagedWithMySelf":true,"version":"1.2.6"}]},"sap.ui":{"technology":"UI5","supportedThemes":["base","sap_belize","sap_belize_base","sap_belize_hcb","sap_belize_hcw","sap_belize_plus","sap_bluecrystal","sap_bluecrystal_base","sap_fiori_3","sap_fiori_3_dark","sap_fiori_3_hcb","sap_fiori_3_hcw","sap_hcb","sap_horizon","sap_horizon_dark","sap_horizon_hcb","sap_horizon_hcw"]},"sap.ui5":{"dependencies":{"minUI5Version":"1.141","libs":{"sap.ui.core":{"minVersion":"1.141.0"},"sap.ui.unified":{"minVersion":"1.141.0","lazy":true},"sap.m":{"minVersion":"1.141.0","lazy":true},"sap.ui.layout":{"minVersion":"1.141.0","lazy":true},"sap.ui.vbm":{"minVersion":"1.141.0","lazy":true},"sap.ui.richtexteditor":{"minVersion":"1.141.0","lazy":true},"sap.ui.comp":{"minVersion":"1.141.0","lazy":true},"sap.f":{"minVersion":"1.141.0","lazy":true}}},"library":{"i18n":false,"content":{"controls":["sap.ui.vk.AnimationTimeSlider","sap.ui.vk.ContainerBase","sap.ui.vk.ContainerContent","sap.ui.vk.DrawerToolbar","sap.ui.vk.FlexibleControl","sap.ui.vk.LegendItem","sap.ui.vk.ListPanel","sap.ui.vk.ListPanelStack","sap.ui.vk.MapContainer","sap.ui.vk.NativeViewport","sap.ui.vk.Notifications","sap.ui.vk.Overlay","sap.ui.vk.ProgressIndicator","sap.ui.vk.RedlineDesign","sap.ui.vk.RedlineSurface","sap.ui.vk.SceneTree","sap.ui.vk.StepNavigation","sap.ui.vk.Toolbar","sap.ui.vk.Viewer","sap.ui.vk.ViewGallery","sap.ui.vk.Viewport","sap.ui.vk.ViewportBase","sap.ui.vk.dvl.Viewport","sap.ui.vk.threejs.Viewport","sap.ui.vk.svg.Viewport","sap.ui.vk.tools.AnchorPointToolGizmo","sap.ui.vk.tools.CrossSectionToolGizmo","sap.ui.vk.tools.Gizmo","sap.ui.vk.tools.MoveToolGizmo","sap.ui.vk.tools.RotateToolGizmo","sap.ui.vk.tools.ScaleToolGizmo","sap.ui.vk.tools.SceneOrientationToolGizmo","sap.ui.vk.tools.TooltipToolGizmo","sap.ui.vk.ecad.LayersPanel","sap.ui.vk.ecad.ElementsPanel"],"elements":["sap.ui.vk.ContentConnector","sap.ui.vk.FlexibleControlLayoutData","sap.ui.vk.OverlayArea","sap.ui.vk.RedlineElement","sap.ui.vk.RedlineElementEllipse","sap.ui.vk.RedlineElementFreehand","sap.ui.vk.RedlineElementLine","sap.ui.vk.RedlineElementRectangle","sap.ui.vk.RedlineElementText","sap.ui.vk.ViewStateManager","sap.ui.vk.ViewStateManagerBase","sap.ui.vk.dvl.ViewStateManager","sap.ui.vk.threejs.ViewStateManager","sap.ui.vk.svg.ViewStateManager","sap.ui.vk.tools.AnchorPointTool","sap.ui.vk.tools.CrossSectionTool","sap.ui.vk.tools.HitTestTool","sap.ui.vk.tools.MoveTool","sap.ui.vk.tools.RectSelectTool","sap.ui.vk.tools.RotateOrbitTool","sap.ui.vk.tools.RotateTool","sap.ui.vk.tools.RotateTurntableTool","sap.ui.vk.tools.ScaleTool","sap.ui.vk.tools.SceneOrientationTool","sap.ui.vk.tools.Tool","sap.ui.vk.tools.TooltipTool","sap.ui.vk.tools.PoiManipulationTool"],"types":[],"interfaces":["sap.ui.vk.AuthorizationHandler","sap.ui.vk.DecryptionHandler","sap.ui.vk.IPlaybackCollection"]}}}}',
	"sap/ui/vk/matai/MataiLoaderWorker.js":function(){
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
(function(){"use strict";console.log("MataiLoaderWorker started.");var e={calls:[],transferable:[],lastFlushTime:null};function t(t,i){var n=e.calls;n.push(t);if(Array.isArray(i)){i.forEach(function(t){e.transferable.push(t)})}if(n.length>=1e4){r()}else if(e.lastFlushTime==null){e.lastFlushTime=performance.now()}else{var o=performance.now();if(o-e.lastFlushTime>=500){r()}}}function r(){e.lastFlushTime=performance.now();var t=e.calls.splice(0);if(t.length>0){var r=e.transferable.splice(0);self.postMessage(t,r)}}function i(e){r();self.postMessage(e)}function n(e){this.sceneBuilderId=e}n.prototype.setScene=function(e){e.cameraId=e.cameraRef;t({sceneBuilderId:this.sceneBuilderId,method:"setScene",args:[e]})};function o(e){var t=[];for(var r in e){var i=r.indexOf("/");if(i>=0){var n=[];var o=e[r];if(o){for(var s in o){n.push({name:s,value:o[s]})}}t.push({source:r.substr(0,i),type:r.substr(i+1),fields:n})}}return t}n.prototype.createNode=function(e){const r=[e.transform.buffer];if(e.objectTransform){r.push(e.objectTransform.buffer)}e.parentId=e.parentRef;if(e.transformType===1){e.transformType="BILLBOARD_VIEW"}else if(e.transformType===257){e.transformType="LOCK_TOVIEWPORT"}e.sid=e.nodeRef;if(e.contentType===2){e.contentType="PMI"}else if(e.contentType===18){e.contentType="Hotspot"}else{e.contentType=undefined}if(e.veids){e.veids=o(e.veids)}t({sceneBuilderId:this.sceneBuilderId,method:"createNode",args:[e]},r)};n.prototype.createSubMesh=function(e){var r=[e.boundingBox.buffer];if(e.transform){r.push(e.transform.buffer)}t({sceneBuilderId:this.sceneBuilderId,method:"insertSubmesh",args:[{meshId:e.meshRef,materialId:e.materialRef,transform:e.transform,lods:[{id:e.geometryId,flags:e.flags,pointCount:e.pointCount,elementCount:e.elementCount,boundingBox:e.boundingBox}]}]},r)};n.prototype.createSubMeshes=function(e){const r=[];e.forEach(e=>{e.submeshes.forEach(e=>{r.push(e.lods[0].boundingBox.buffer);if(e.transform){r.push(e.transform.buffer)}})});t({sceneBuilderId:this.sceneBuilderId,method:"setSubmeshes",args:[e]},r)};n.prototype.setMeshGeometry=function(e){var r=[e.data.index.buffer,e.data.position.buffer];if(e.data.normal){r.push(e.data.normal.buffer)}if(e.data.uv){r.push(e.data.uv.buffer)}if(e.data.colors){r.push(e.data.colors.buffer)}t({sceneBuilderId:this.sceneBuilderId,method:"setGeometry",args:[{id:e.geometryId,isPolyline:(e.flags&1)>0,isPointCloud:(e.flags&32)>0,data:{indices:e.data.index,points:e.data.position,normals:e.data.normal,colors:e.data.colors,uvs:e.data.uv}}]},r)};n.prototype.insertMesh=function(e,r){t({sceneBuilderId:this.sceneBuilderId,method:"setMeshNode",args:[e,r]})};n.prototype.createTextAnnotation=function(e){e.coordinateSpace=0;e.nodeId=e.nodeRef;e.fontFace=e.font;e.shape=e.style;t({sceneBuilderId:this.sceneBuilderId,method:"createAnnotation",args:[e]})};n.prototype.createTextNote=function(e){e.coordinateSpace=2;e.nodeId=e.nodeRef;e.id=e.nodeRef;e.sid=e.targetNodeRef;e.fontFace=e.font;e.shape=e.style;t({sceneBuilderId:this.sceneBuilderId,method:"createAnnotation",args:[e]})};n.prototype.createImageNote=function(e){e.properlyAligned=true;e.nodeId=e.nodeRef;e.labelMaterialId=e.materialRef;t({sceneBuilderId:this.sceneBuilderId,method:"createImageNote",args:[e]})};n.prototype.insertLeaderLine=function(e){var r=[];for(var i=0;i<e.points.length;i+=3){var n=[e.points[i],e.points[i+1],e.points[i+2]];r.push(n)}e.points=r;e.annotationId=e.nodeRef;e.nodeId=e.nodeRef;e.startPointSid=e.targetNodeRef;e.materialId=e.materialRef;e.startPointHeadStyle=e.startPointStyle;e.endPointHeadStyle=e.endPointStyle;e.pointHeadConstant=e.styleConstant;t({sceneBuilderId:this.sceneBuilderId,method:"insertLeaderLine",args:[e]})};n.prototype.setParametricContent=function(e,r){r.materialID=r.materialID||undefined;var i=[];if(r.t){i.push(r.t.buffer)}if(r.r){i.push(r.r.buffer)}if(r.s){i.push(r.s.buffer)}if(r.segments){r.segments.forEach(function(e){if(e.points){i.push(e.points.buffer)}})}var n=r.lineStyle;if(n){if(n.colour){i.push(n.colour.buffer)}}var o=r.fillStyle;if(o){if(o.colour){i.push(o.colour.buffer)}if(o.start){i.push(o.start.buffer)}if(o.end){i.push(o.end.buffer)}if(o.radii){i.push(o.radii.buffer)}if(o.gradient){i.push(o.gradient.buffer)}if(o.gradientTransform){i.push(o.gradientTransform.buffer)}}t({sceneBuilderId:this.sceneBuilderId,method:"setParametricContent",args:[e,r]},i)};n.prototype.createCamera=function(e){e.ortho=e.projection==="orthographic";e.near=e.nearClip;e.far=e.farClip;e.fov=e.fov*Math.PI/180;e.zoom=e.orthoZoomFactor;e.id=e.cameraRef;var r=[e.origin.buffer,e.up.buffer,e.target.buffer];if(e.matrix){r.push(e.matrix.buffer)}e.notUseDirectionVector=true;t({sceneBuilderId:this.sceneBuilderId,method:"createCamera",args:[e]},r)};n.prototype.insertCamera=function(e,r){t({sceneBuilderId:this.sceneBuilderId,method:"insertCamera",args:[e,r]})};n.prototype.createViewportGroup=function(e){e.id=e.viewportGroupRef;if(e.veids){e.veids=o(e.veids)}t({sceneBuilderId:this.sceneBuilderId,method:"insertViewGroup",args:[e]})};n.prototype.finalizePlaybacks=function(e){e.viewGroupId=e.viewportGroupRef;t({sceneBuilderId:this.sceneBuilderId,method:"setAnimationPlaybacks",args:[e]})};n.prototype.insertModelView=function(e){e.viewGroupId=e.viewportGroupRef;e.viewId=e.modelViewRef;e.thumbnailId=e.thumbnail;e.cameraId=e.cameraRef;e.navigationMode=["NoChange","Orbit","NoChange","Turntable","Zoom","Pan"][e.navigationMode]||"NoChange";t({sceneBuilderId:this.sceneBuilderId,method:"insertView",args:[e]})};n.prototype.setModelViewVisibilitySet=function(e){e.viewId=e.modelViewRef;t({sceneBuilderId:this.sceneBuilderId,method:"setModelViewVisibilitySet",args:[e]})};n.prototype.insertModelViewHighlight=function(e){e.viewId=e.modelViewRef;t({sceneBuilderId:this.sceneBuilderId,method:"insertModelViewHighlight",args:[e]})};n.prototype.createThumbnail=function(e){e.imageId=e.imageRef;t({sceneBuilderId:this.sceneBuilderId,method:"createThumbnail",args:[e]})};n.prototype.createDetailView=function(e){e.nodeId=e.nodeRef;e.detailViewId=e.detailViewRef;e.cameraId=e.cameraRef;e.attachment=e.attachmentPoint;var r=[e.origin.buffer,e.size.buffer];if(e.attachment){r.push(e.attachment.buffer)}if(e.visibleNodes){r.push(e.visibleNodes.buffer)}if(e.targetNodes){r.push(e.targetNodes.buffer)}e.properlyAligned=true;t({sceneBuilderId:this.sceneBuilderId,method:"createDetailView",args:[e]},r)};n.prototype.createMaterial=function(e){e.id=e.materialRef;var r=[e.ambientColour.buffer,e.diffuseColour.buffer,e.specularColour.buffer,e.emissiveColour.buffer];if(e.lineColour&&e.lineDashPattern){r.push(e.lineColour.buffer,e.lineDashPattern.buffer)}if(e.textures){for(var i=0;i<e.textures.length;i++){var n=e.textures[i];var o="texture"+n.type.charAt(0).toUpperCase()+n.type.slice(1);e[o]={imageId:n.imageRef,matrix:n.matrix,uvHorizontalScale:n.scaleX,uvVerticalScale:n.scaleY,uvHorizontalOffset:n.offsetX,uvVerticalOffset:n.offsetY,uvRotationAngle:n.angle,influence:n.amount,filterMode:n.filterMode,uvHorizontalTilingEnabled:n.repeatX,uvVerticalTilingEnabled:n.repeatY,uvClampToBordersEnabled:n.clampToBorder,inverted:n.invert,modulate:n.modulate}}}t({sceneBuilderId:this.sceneBuilderId,method:"createMaterial",args:[e]},r)};n.prototype.createImage=function(e){e.id=e.imageRef;e.binaryData=e.data;t({sceneBuilderId:this.sceneBuilderId,method:"createImage",args:[e]},[e.binaryData.buffer])};n.prototype.progress=function(e){t({sceneBuilderId:this.sceneBuilderId,method:"progress",args:[e]})};n.prototype.insertThrustline=function(e){e.thrustlineId=e.thrustlineRef;e.materialId=e.material;t({sceneBuilderId:this.sceneBuilderId,method:"insertThrustline",args:[e]})};n.prototype.insertAnimationGroup=function(e){t({sceneBuilderId:this.sceneBuilderId,method:"insertAnimationGroup",args:[e]})};n.prototype.insertAnimation=function(e){t({sceneBuilderId:this.sceneBuilderId,method:"insertAnimation",args:[e]})};n.prototype.insertAnimationTarget=function(e){t({sceneBuilderId:this.sceneBuilderId,method:"insertAnimationTarget",args:[e]})};n.prototype.insertAnimationTrack=function(e){t({sceneBuilderId:this.sceneBuilderId,method:"insertAnimationTrack",args:[e]})};n.prototype.finalizeAnimation=function(e){t({sceneBuilderId:this.sceneBuilderId,method:"setAnimationTracks",args:[e]})};n.prototype.requestReferencedFile=function(e){i({sceneBuilderId:this.sceneBuilderId,event:"referencedFileRequested",fileName:e.FileName,veId:e.VEID,veVersion:e.VEVersion})};var s=new Map;self.onmessage=function(e){const{method:t,args:r}=e.data;switch(t){case"createRuntime":console.log("MataiLoaderWorker starting runtime.");sap.ve.matai.createRuntime({prefixURL:r.scriptDirectory}).then(function(e){console.log("MataiLoaderWorker runtime created.");self.matai=e;self.postMessage({event:"runtimeCreated"})});break;case"createContext":{const e=new n(r.sceneBuilderId);const t=new Map;const o={sceneBuilder:e,files:t};const a=`${t.size}.vds`;t.set(r.fileName,a);s.set(r.sceneBuilderId,o);const d=self.matai.createContext(e,r.buffer,a,r.locale,"");i({event:"contextCreated",sceneBuilderId:r.sceneBuilderId,result:d});break}case"destroyContext":{const{sceneBuilder:e}=s.get(r.sceneBuilderId);s.delete(r.sceneBuilderId);self.matai.destroyContext(e);break}case"loadFile":{const{sceneBuilder:e}=s.get(r.sceneBuilderId);const t=self.matai.loadFile(e);i({event:"fileLoaded",sceneBuilderId:r.sceneBuilderId,result:t});break}case"loadReferencedFile":{const{sceneBuilder:e,files:t}=s.get(r.sceneBuilderId);const n=`${t.size}.vds`;t.set(r.fileName,n);const o=self.matai.loadReferencedFile(e,r.buffer,n,r.veId,r.veVersion);i({event:"referencedFileLoaded",sceneBuilderId:r.sceneBuilderId,fileName:r.fileName,result:o});break}case"buildScene":{const{sceneBuilder:e}=s.get(r.sceneBuilderId);const t=self.matai.buildScene(e);i({sceneBuilderId:r.sceneBuilderId,event:"sceneBuilt",result:t});break}default:{break}}};console.log("MataiLoaderWorker initialized.")})();
},
	"sap/ui/vk/measurements/Calibration.fragment.xml":'<core:FragmentDefinition\n  xmlns="sap.m"\n  xmlns:core="sap.ui.core"\n  xmlns:vkm="sap.ui.vk.measurements"\n><Dialog\n    id="measurementCalibration"\n    title="{i18n>MEASUREMENTS_CALIBRATION_DIALOG_TITLE}"\n    draggable="true"\n    afterClose=".onAfterClose"\n    initialFocus="distance"\n  ><VBox fitContainer="true" renderType="Bare" class="sapUiResponsiveMargin"><Label text="{/label}" showColon="true"/><HBox fitContainer="true" renderType="Bare"><Input id="distance" type="Number" placeholder="{i18n>MEASUREMENTS_CALIBRATION_INPUT_PLACEHOLDER}" value=\'{ path: "/distance", type: "sap.ui.model.type.Float" }\'/><Button id="reset" icon="sap-icon://reset" type="Transparent" class="sapUiTinyMarginBegin" tooltip="{i18n>MEASUREMENTS_CALIBRATION_RESET_BUTTON_TOOLTIP}" press=".onResetPressed"/></HBox></VBox><beginButton><Button id="ok" text="{i18n>MEASUREMENTS_CALIBRATION_OK_BUTTON}" press=".onOkPressed"/></beginButton><endButton><Button id="cancel" text="{i18n>MEASUREMENTS_CALIBRATION_CANCEL_BUTTON}" press=".onCancelPressed"/></endButton></Dialog></core:FragmentDefinition>\n',
	"sap/ui/vk/measurements/Settings.fragment.xml":'<core:FragmentDefinition\n  xmlns="sap.m"\n  xmlns:core="sap.ui.core"\n  xmlns:vkm="sap.ui.vk.measurements"\n><Dialog\n    id="measurementSettings"\n    title="{i18n>MEASUREMENTS_SETTINGS_DIALOG_TITLE}"\n    resizable="true"\n    draggable="true"\n    contentWidth="400px"\n    afterClose=".onAfterClose"\n    initialFocus="precision"\n  ><VBox fitContainer="true" renderType="Bare" class="sapUiResponsiveMargin"><Label text="{i18n>MEASUREMENTS_SETTINGS_PRECISIONS_LABEL}" showColon="true"/><Select id="precision" selectedKey=\'{ path: "settings>/precision", type: "sap.ui.model.type.Integer" }\' change=".onChange"><core:Item key="0" text="{value: 0, formatter: \'.formatPrecision\'}"/><core:Item key="1" text="{value: 1, formatter: \'.formatPrecision\'}"/><core:Item key="2" text="{value: 2, formatter: \'.formatPrecision\'}"/><core:Item key="3" text="{value: 3, formatter: \'.formatPrecision\'}"/><core:Item key="4" text="{value: 4, formatter: \'.formatPrecision\'}"/><core:Item key="5" text="{value: 5, formatter: \'.formatPrecision\'}"/></Select><Label text="{i18n>MEASUREMENTS_SETTINGS_UNITS_LABEL}" showColon="true" class="sapUiSmallMarginTop"/><Select id="units" selectedKey="{settings>/units}" change=".onChange"><core:Item key="mm" text="{i18n>UNITS_MM}"/><core:Item key="cm" text="{i18n>UNITS_CM}"/><core:Item key="m" text="{i18n>UNITS_M}"/><core:Item key="in" text="{i18n>UNITS_IN}"/><core:Item key="ft" text="{i18n>UNITS_FT}"/></Select><Label text="{i18n>MEASUREMENTS_SETTINGS_LINE_COLOR_LABEL}" showColon="true" class="sapUiSmallMarginTop"/><RadioButtonGroup selectedIndex="{settings>/color}" select=".onChange" ><vkm:ColorRadioButton color="#0A6ED1"/><vkm:ColorRadioButton color="#107E3E"/><vkm:ColorRadioButton color="#BB0000"/><vkm:ColorRadioButton color="#925ACE"/><vkm:ColorRadioButton color="#C0399F"/></RadioButtonGroup><Label text="{i18n>MEASUREMENTS_SETTINGS_REFERENCE_FEATURES_TITLE}" showColon="true" class="sapUiSmallMarginTop"/><HBox fitContainer="true" renderType="Bare" alignItems="Center" justifyContent="SpaceBetween"><HBox alignItems="Center" fitContainer="true" renderType="Bare"><core:Icon size="1.5rem" src="sap-icon://vk-icons/measurement-vertex"/><Label class="sapUiTinyMarginBegin" text="{i18n>MEASUREMENTS_SETTINGS_FEATURE_VERTEX}"/></HBox><Switch customTextOn="&#8203;" customTextOff="&#8203;" change=".onChange" state="{settings>/featureVertex}"/></HBox><HBox fitContainer="true" renderType="Bare" alignItems="Center" justifyContent="SpaceBetween"><HBox alignItems="Center" fitContainer="true" renderType="Bare"><core:Icon size="1.5rem" src="sap-icon://vk-icons/measurement-edge"/><Label class="sapUiTinyMarginBegin" text="{i18n>MEASUREMENTS_SETTINGS_FEATURE_EDGE}"/></HBox><Switch customTextOn="&#8203;" customTextOff="&#8203;" change=".onChange" state="{settings>/featureEdge}"/></HBox><HBox fitContainer="true" renderType="Bare" alignItems="Center" justifyContent="SpaceBetween"><HBox alignItems="Center" fitContainer="true" renderType="Bare"><core:Icon size="1.5rem" src="sap-icon://vk-icons/measurement-face"/><Label class="sapUiTinyMarginBegin" text="{i18n>MEASUREMENTS_SETTINGS_FEATURE_FACE}"/></HBox><Switch customTextOn="&#8203;" customTextOff="&#8203;" change=".onChange" state="{settings>/featureFace}"/></HBox><Text text="{i18n>MEASUREMENTS_SETTINGS_REFERENCE_FEATURES_FOOTNOTE}" class="sapUiSmallMarginTop"/></VBox><beginButton><Button\n        id="close"\n        text="{i18n>MEASUREMENTS_SETTINGS_CLOSE_BUTTON}"\n        press=".onClosePressed"\n      /></beginButton></Dialog></core:FragmentDefinition>\n',
	"sap/ui/vk/totara/TotaraLoaderWorker.js":function(){
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
(function(){"use strict";var e={};["initializeConnection","getScene","getGeomMesh","getAnnotation","getMaterial","getImage","getView"].reverse().forEach(function(n,t){e[n]=t});var n=new Map;var t;var s;var a;var i;var r;var o=[];var c=4;var u=0;function d(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var n=Math.random()*16|0,t=e=="x"?n:n&3|8;return t.toString(16).toLowerCase()})}function l(n,s,a){return new Promise(function(i,r){o.push({url:t+n,context:s,priority:e[s&&s.method]||0,responseType:a,resolve:i,reject:r});if(u<c){f()}})}function f(){if(!o.length){return}o.sort(function(e,n){return e.priority-n.priority});var e=o.pop();u++;m(encodeURI(e.url),e.responseType).then(function(n){e.resolve(n)}).catch(function(n){R({errorText:"Could not connect to server: "+t,error:n.status,reason:n.message?n.message:n,context:e.context});if(e.reject){e.reject(n)}}).finally(function(){u--;f()})}function m(e,t){return new Promise(function(o,c){var u=new XMLHttpRequest;u.onload=function(){if(this.status>=200&&this.status<300){if(this.getAllResponseHeaders().includes("tile-width")){var e=this.getResponseHeader("tile-width");var t=new RegExp("[^/]+$");var s=this.responseURL.match(t);n.set(s[0],e)}o(this.response)}else{c({status:this.status,statusText:this.statusText})}};u.onerror=function(){c({status:this.status,statusText:this.statusText})};u.open("GET",e,true);if(a){u.setRequestHeader("Authorization",a)}if(i){u.setRequestHeader("X-TenantUuid",i)}if(r){u.setRequestHeader("X-ConsumptionScenario",r.toUpperCase())}u.setRequestHeader("X-CorrelationID",d());u.setRequestHeader("X-SessionId",s);u.responseType=t||"arraybuffer";u.send()})}var h="TextDecoder"in self?function(){var e=new TextDecoder;return function(n,t,s){return e.decode(new DataView(n,t,s-t))}}():function(e,n,t){var s="";var a=1e3;try{while(n<t){var i=Math.min(a,t-n);var r=new Uint8Array(e,n,i);s+=String.fromCharCode.apply(null,r);n+=i}}catch(e){return""}return decodeURIComponent(escape(s))};function p(e){var n=e.split(",");if(n.length<0||n.length>2){throw"invalid content length"}var t=0;var s=0;try{t=parseInt(n[0],10);if(n.length===2){s=parseInt(n[1],10)}}catch(e){throw"invalid content length"}return{jsonContentLength:t,binaryContentLength:s}}function v(e,n){var t="[".charCodeAt(0);var s="]".charCodeAt(0);var a=[];var i=0;var r=0;var o;var c;var u;var d=new Uint8Array(e);while(r<e.byteLength){r=d.indexOf(t,i);if(r===-1){break}var l=h(e,i,r).replace(/\n|\r|\s/g,"");i=r+1;r=d.indexOf(s,i);if(r===-1){throw"No matching [] for command length. abort"}o=p(h(e,i,r));i=r+1;r=i+o.jsonContentLength;c=h(e,i,r);if(o.binaryContentLength){i=r;r=i+o.binaryContentLength;u=new Uint8Array(e,i,o.binaryContentLength)}else{u=undefined}i=r;var f={name:l,jsonString:c,isInitial:n};if(u){f.binaryContent=u}a.push(f)}return a}function I(e){var t;var s=-1;var a,i;var r=false;var o=false;var c=false;for(i=0;i<e.length;i++){t=e[i];if(t.name==="setView"){if(!r){if(!t.jsonContent.viewId){r=true}}o=true}else if(t.name==="setViewNode"){if(a===undefined){a=t.jsonContent.viewId}}else if(t.name==="setSequence"&&o){c=true}}if(a&&r){for(i=0;i<e.length;i++){t=e[i];if(t.name==="setView"){t.jsonContent={viewId:a};break}}}for(i=0;i<e.length;i++){t=e[i];if(t.name==="setPlayback"&&c){s=i;continue}if(t.name==="setImage"){var u=t.jsonContent.id;var d=u?n.get(u):null;if(d){t.jsonContent.tileWidth=d}}if(t.name==="setScene"&&e.length>1){continue}g(t)}if(s!==-1){t=e[s];g(t)}}function g(e){if(e.binaryContent){self.postMessage({name:e.name,jsonString:e.jsonString,jsonContent:e.jsonContent,binaryContent:e.binaryContent,isInitial:"isInitial"in e?e.isInitial:false},[e.binaryContent.buffer])}else{self.postMessage({name:e.name,jsonString:e.jsonString,jsonContent:e.jsonContent,isInitial:"isInitial"in e?e.isInitial:false})}}function y(e){var n="";for(var t in e){if(e[t]==null){continue}if(n.length!==0){n+="&"}n+=t+"="+e[t]}return n}async function C(e){const[n,t]=await Promise.all([l(`scenes/${e.sceneId}/info?includeInMetering=true`,e,"json"),l(`scenes/${e.sceneId}?sid=9223372036854775807`,e,"json")]);n.metadata=t.scene.metadata;I([{name:"setScene",jsonContent:n}])}function x(e){var n=e.parameters.sceneId;var t=e.parameters.viewId;var s=e.parameters.sids;var a=e.isInitial;var i="scenes/"+n;if(t){i+="/views/"+t}i+="?"+y(e.parameters.query);if(s&&s.length>0){i+="&sid="+s.join("&sid=")}var r=e.isPartialTree;l(i,e,"text").then(function(s){var i;try{i=JSON.parse(s)}catch(e){R({errorText:"Failed to parse JSON"});return}var o=[];var c=t?i.views[0]:i.tree;var u=c.nodes;delete c.nodes;var d=i.highlightStyles;var l=i.annotations;var f=i.parametrics;var m=i.textStyles;var h=i.linestyles;var p=i.fillstyles;var v=i.meshes;var g=i.markers;var y=i.images;const C=i.pointCloudGroups;const x=i.dynamicContents;function w(e){if("style"in e&&m){e["style_id"]=m[e.style].veid}if("stroke"in e&&h){e["stroke_id"]=h[e.stroke].veid}if("fill"in e&&p){e["fill_id"]=p[e.fill].veid}}if(u){u.forEach(function(e){if("highlightStyle"in e&&d){e.highlightStyleId=d[e.highlightStyle].id}if("annotation"in e&&l){e.annotationId=l[e.annotation].id}if("parametric"in e&&f){e.parametricId=f[e.parametric].id}if("marker"in e&&g){g[e.marker].makrerNodeSid=e.sid}if("pointCloudGroup"in e&&C){const n=C[e.pointCloudGroup];e.pointCloudGroupId=n.id;n.nodeId=e.sid}if("dynamicContent"in e&&x){e.dynamicContentId=x[e.dynamicContent].id}if("image"in e&&y){const n=y[e.image];e.imageId=n.id;e.width=n.width;e.height=n.height}})}if(f){f.forEach(function(e){if("shapes"in e){e.shapes.forEach(w)}else{w(e)}})}o.push({name:"suppressSendRequests",jsonContent:{sceneId:n}});if(!r){c.sceneId=n;c.viewId=t;o.push({name:"setView",jsonContent:c,isInitial:a})}if(u){o.push({name:r?"setTreeNode":"setViewNode",jsonContent:{sceneId:n,viewId:t,nodes:u},isInitial:a})}o.push({name:r?"notifyFinishedTree":"notifyFinishedView",jsonContent:{sceneId:n,viewId:t},isInitial:a});if(d){d.forEach(function(e){e.sceneId=n;o.push({name:"setHighlightStyle",jsonContent:e,isInitial:a})})}if(m){o.push({name:"setTextStyle",jsonContent:{sceneId:n,textStyles:m},isInitial:a})}if(h){o.push({name:"setLineStyle",jsonContent:{sceneId:n,lineStyles:h},isInitial:a})}if(p){o.push({name:"setFillStyle",jsonContent:{sceneId:n,fillStyles:p},isInitial:a})}if(f){o.push({name:"setParametric",jsonContent:{sceneId:n,parametrics:i.parametrics},isInitial:a})}if(l){o.push({name:"setAnnotation",jsonContent:{sceneId:n,annotations:l},isInitial:a})}if(v){o.push({name:"allocateMeshBuffer",jsonContent:{sceneId:n,meshes:v},isInitial:a})}if(g){o.push({name:"setMarker",jsonContent:{sceneId:n,markers:g},isInitial:a})}if(C){o.push({name:"setPointCloudGroup",jsonContent:{sceneId:n,pointCloudGroups:i.pointCloudGroups},isInitial:a})}if(x){o.push({name:"setDynamicContent",jsonContent:{sceneId:n,dynamicContents:i.dynamicContents},isInitial:a})}var k=i.animation;if(k&&k.sequences&&k.playbacks){var b={sceneId:n,viewId:t,tracks:k.tracks,sequences:k.sequences};if(k.joints){b.joints=k.joints}o.push({name:"setSequence",jsonContent:b,isInitial:a});k.playbacks.forEach(function(e){var n=k.sequences[e.sequence];e.sequenceId=n&&n.id});k.playbacks=k.playbacks.filter(function(e){return e.sequenceId!=null});o.push({name:"setPlayback",jsonContent:{sceneId:n,viewId:t,playbacks:k.playbacks},isInitial:a})}o.push({name:"unsuppressSendRequests",jsonContent:{sceneId:n}});I(o);if(e.pushViewGroups){j({method:"getViewGroups",parameters:{sceneId:n}})}})}function w(e){var n=e.parameters.sceneId;var t=e.parameters.viewId;var s="scenes/"+n+"/views/"+t+"/animations?"+y(e.parameters.query);l(s,e,"text").then(function(e){var s;try{s=JSON.parse(e)}catch(e){R({errorText:"Failed to parse JSON"});return}I([{name:"setPlayback",jsonContent:{sceneId:n,viewId:t,playbacks:s.playbacks}}])})}function j(e){var n=e.parameters.sceneId;var t=e.parameters.viewGroupId;var s="scenes/"+n+"/viewGroups";if(t){s+="/"+t}l(s,e,"text").then(function(e){var n;try{n=JSON.parse(e)}catch(e){R({errorText:"Failed to parse JSON"});return}I(n.groups.map(function(e){return{name:"setViewGroup",jsonContent:e}}))})}function k(e){var n=e.parameters.sceneId;var t=e.parameters.materialIds;var s=t.map(function(e){return"id="+e}).join("&");var a="scenes/"+n+"/materials?"+s;l(a,e,"text").then(function(e){var t;try{t=JSON.parse(e)}catch(e){R({errorText:"Failed to parse JSON"});return}t.sceneId=n;I([{name:"setMaterial",jsonContent:t}])})}function b(e){var n=e.parameters.sceneId;var t=e.parameters.annotationIds;var s=t.map(function(e){return"id="+e}).join("&");var a="scenes/"+n+"/annotations?"+s;l(a,e,"text").then(function(e){var t;try{t=JSON.parse(e)}catch(e){R({errorText:"Failed to parse JSON"});return}t.sceneId=n;I([{name:"setAnnotation",jsonContent:t}])})}function S(e){var n;const t=e.usedBy=="SvgImage";if(e.materialId){n="scenes/"+e.sceneId+"/materials/"+e.materialId+"/images/"+e.imageId}else if(e.viewId){n="scenes/"+e.sceneId+"/views/"+e.viewId+"/images/"+e.imageId}else if(t){n="scenes/"+e.sceneId+"/images/"+e.imageId;l(n,e,"text").then(function(n){I([{name:"setSvgImage",jsonContent:{sceneId:e.sceneId,id:e.imageId,isInitial:e.isInitial,svgContent:n}}])});return}else{return}l(n,e,"arraybuffer").then(function(n){I([{name:"setImage",jsonContent:{sceneId:e.sceneId,id:e.imageId,isInitial:e.isInitial},binaryContent:new Uint8Array(n)}])})}function T(e){var n="scenes/"+e.sceneId+"/meshes?ids="+e.meshIds.join(",");l(n,e,"arraybuffer").then(function(n){var t=v(n);t.forEach(function(n){n.jsonContent={sceneId:e.sceneId}});I(t)})}function q(e){var n="scenes/"+e.sceneId+"/meshes?ids="+e.meshIds.join(",")+"&types=box";l(n,e,"arraybuffer").then(function(n){var t=v(n);t.forEach(function(n){n.jsonContent={sceneId:e.sceneId}});I(t)})}function R(e){self.postMessage({name:"notifyError",jsonContent:e})}self.onmessage=function(e){var n=e.data;switch(n.method){case"getAnnotation":{b(n);break}case"getGeomMesh":{T(n);break}case"getMesh":{q(n);break}case"getImage":{S(n);break}case"getMaterial":{k(n);break}case"getScene":{C(n);break}case"getView":{x(n);break}case"getViewAnimations":{w(n);break}case"getViewGroups":{j(n);break}case"initializeConnection":{t=n.url;s=n.sessionId;c=n.maxActiveRequests;r=n.consumptionScenario;break}case"close":{self.close();break}case"useAccessTokenResponse":{if(n.accessTokenResponse){a=n.accessTokenResponse.token_type+" "+n.accessTokenResponse.access_token;i=n.accessTokenResponse.tenant_uuid}else{a=null;i=null}break}case"setMaxActiveRequests":{c=n.maxActiveRequests;break}case"setConsumptionScenario":r=n.consumptionScenario;break;case"addClientLog":{break}default:{console.warn("Unknown TotaraLoader command: "+n.method);break}}}})();
}
});
//# sourceMappingURL=library-preload.js.map
