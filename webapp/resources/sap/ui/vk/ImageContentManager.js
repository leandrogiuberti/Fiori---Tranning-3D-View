/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.define(["./Messages","./ContentManager","./getResourceBundle","sap/m/Image"],function(e,t,n,i){"use strict";var s=t.extend("sap.ui.vk.ImageContentManager",{metadata:{library:"sap.ui.vk"}});var o=s.getMetadata().getParent().getClass().prototype;s.prototype.init=function(){if(o.init){o.init.call(this)}this._handleLoadSucceededProxy=this._handleLoadSucceeded.bind(this);this._handleLoadFailedProxy=this._handleLoadFailed.bind(this)};s.prototype.exit=function(){if(o.exit){o.exit.call(this)}};s.prototype.loadContent=function(e,t){if(t.length!==1){setTimeout(function(){this.fireContentChangesStarted();this.fireContentChangesFinished({content:null,failureReason:{errorMessage:n().getText("IMAGECONTENTMANAGER_ONLY_LOAD_SINGLE_IMAGE")}})}.bind(this),0)}else if(t[0].getContentResources().length>0){setTimeout(function(){this.fireContentChangesStarted();this.fireContentChangesFinished({content:null,failureReason:{errorMessage:n().getText("IMAGECONTENTMANAGER_CANNOT_LOAD_IMAGE_HIERARCHY")}})}.bind(this),0)}else{var s=t[0],o=s.getSource(),r=s.getSourceType(),a=null;if(s._contentManagerResolver&&s._contentManagerResolver.settings&&s._contentManagerResolver.settings.loader){a=s._contentManagerResolver.settings.loader}if(o instanceof File){var d=new FileReader;d.onload=function(t){this._loadImageFromUrl(e,d.result,r,a)}.bind(this);d.readAsDataURL(o)}else{var l=new i({src:o});o=l.getSrc();l.destroy();this._loadImageFromUrl(e,o,r,a)}}};s.prototype._addEventListeners=function(e){e.addEventListener("load",this._handleLoadSucceededProxy);e.addEventListener("error",this._handleLoadFailedProxy)};s.prototype._removeEventListeners=function(e){e.removeEventListener("error",this._handleLoadFailedProxy);e.removeEventListener("load",this._handleLoadSucceededProxy)};s.prototype._addSvgQuirks=function(e){e.style.setProperty("visibility","collapse");e.style.setProperty("width","0");e.style.setProperty("height","0");e.style.setProperty("position","absolute");document.body.appendChild(e);return this};s.prototype._removeSvgQuirks=function(e){e.parentElement.removeChild(e);e.style.removeProperty("visibility");e.style.removeProperty("width");e.style.removeProperty("height");e.style.removeProperty("position");return this};s.prototype._loadImageFromUrl=function(e,t,i,s){this.fireContentChangesStarted();switch(i.toLowerCase()){case"svg":var o=document.createElement("object");this._addEventListeners(o);o.type="image/svg+xml";o.data=t;o.className="SVGImage";this._addSvgQuirks(o);break;case"jpg":case"jpeg":case"png":case"gif":case"bmp":case"tif":case"tiff":var r=document.createElement("img");this._addEventListeners(r);if(s){var a=this;s(t).then(function(e){r.src=e},function(e){a.fireContentChangesFinished({content:null,failureReason:{errorMessage:e}})})}else{r.src=t}break;default:setTimeout(function(){this.fireContentChangesFinished({content:null,failureReason:{errorMessage:n().getText("IMAGECONTENTMANAGER_UNSUPPORTED_IMAGE_TYPE"),sourcesFailedToDownload:[{source:t}]}})}.bind(this),0);break}};s.prototype._handleLoadSucceeded=function(e){var t=e.target;this._removeEventListeners(t);if(t instanceof HTMLObjectElement){this._removeSvgQuirks(t)}this.fireContentChangesFinished({content:t})};s.prototype._handleLoadFailed=function(e){var t=e.target;this._removeEventListeners(t);if(t instanceof HTMLObjectElement){this._removeSvgQuirks(t)}this.fireContentChangesFinished({content:null,failureReason:{errorMessage:n().getText("IMAGECONTENTMANAGER_IMAGE_LOAD_FAILED"),sourcesFailedToDownload:[{source:t instanceof HTMLImageElement?t.src:t.data}]}})};return s});
//# sourceMappingURL=ImageContentManager.js.map