/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.define(["sap/ui/thirdparty/jquery","sap/ui/base/Object"],function(jQuery,t){"use strict";const e=250;const i=0;const n=1;const s=2;const o=4;const h=8;const r=16;const c=t.extend("sap.ui.vk.Loco",{metadata:{library:"sap.ui.vk"},constructor:function(e){if(c._instance&&this.viewport===e){return c._instance}t.apply(this);this._handlers=[];this._gesture=false;this._n=0;this._touchStart=0;this._touchOrigin={x:0,y:0};this._touchMoved=false;this._clickTimer=0;this._clickFunc=null;if(e){this._attachViewportEventHandlers(e)}c._instance=this;return this}});c.prototype.destroy=function(){if(this._clickTimer>0){clearTimeout(this._clickTimer);this._clickTimer=0;this._clickFunc=null}this._handlers.length=0;this._detachViewportEventHandlers()};function u(t){const e=[];const n={points:e,buttons:t.buttons??i,handled:false,passEvent:false,event:t,timeStamp:t.timeStamp,scroll:t.wheelDelta};if(t.touches?.length>0){for(const i of t.touches){e.push({x:i.pageX,y:i.pageY})}}else if(t.pageX!=null){e.push({x:t.pageX,y:t.pageY})}else{e.push({x:t.originalEvent.pageX,y:t.originalEvent.pageY})}if(t.buttons&s&&e.length===1){e.push(e[0])}const{x:o,y:h}=e[0];n.n=e.length;if(n.n===2){const{x:t,y:i}=e[1];const s=o-t;const r=h-i;n.x=(o+t)*.5;n.y=(h+i)*.5;n.d=Math.sqrt(s*s+r*r)}else{n.x=o;n.y=h;n.d=0}return n}c.prototype._attachViewportEventHandlers=function(t){this.viewport=t;t.addEventDelegate(this);if(sap.ui.Device.support.touch){t.attachBrowserEvent("touchmove",this._onpointermove,this)}t.attachBrowserEvent("mousemove",this._onpointermove,this);t.attachBrowserEvent(sap.ui.Device.browser.firefox?"DOMMouseScroll":"mousewheel",this._onscroll,this)};c.prototype._detachViewportEventHandlers=function(){const t=this.viewport;if(t==null){return}t.detachBrowserEvent(sap.ui.Device.browser.firefox?"DOMMouseScroll":"mousewheel",this._onscroll,this);t.detachBrowserEvent("mousemove",this._onpointermove,this);if(sap.ui.Device.support.touch){t.detachBrowserEvent("touchmove",this._onpointermove,this)}t.removeEventDelegate(this);this.viewport=null};c.prototype.ontouchstart=function(t){if(!t.isMarked()){const e=u(t);if(this._gesture){this._endGesture(e);e.handled=false}this._beginGesture(e)}};c.prototype.ontouchend=function(t){const e=u(t);if(e.buttons!==i){const t=jQuery(document);const e=t=>{this._move(u(t))};const i=n=>{this._endGesture(u(n));t.off("mousemove",e);t.off("mouseup",i)};t.on("mousemove",e);t.on("mouseup",i);return}this._endGesture(e);if(t.touches.length>0){e.handled=false;this._beginGesture(e)}};c.prototype.ontap=function(t){if(!t.isMarked()&&!this._touchMoved){const i=u(t);if(this._clickTimer>0){this._click(i,true)}else{this._clickFunc=this._click.bind(this,i,false);this._clickTimer=setTimeout(this._clickFunc,e)}}};c.prototype.oncontextmenu=function(t){this._contextMenu(u(t))};c.prototype.onkeyup=function(t){this._keyEventHandler(t)};c.prototype._onpointermove=function(t){this._move(u(t))};c.prototype._onscroll=function(t){if(!t.isMarked()){const{originalEvent:e,buttons:i}=t;let n=e.detail?e.detail*-40:e.wheelDelta;if(!e.touches){n=Math.min(Math.max(n,-20),20)}const s={x:e.pageX,y:e.pageY,d:0,buttons:i,scroll:n,n:2,points:[{x:e.pageX,y:e.pageY},{x:e.pageX,y:e.pageY}],handled:false,passEvent:false,timeStamp:t.timeStamp};this._beginGesture(s);s.points[0].y-=n*.2;s.points[1].y+=n*.2;s.d=Math.pow(2,n/640);s.handled=false;this._move(s);s.handled=false;this._endGesture(s);if(s.handled){t.setMarked();if(!s.passEvent){t.preventDefault()}}}};c.prototype.addHandler=function(t,e){if(this.viewport==null){this._attachViewportEventHandlers(t.getViewport())}t.priority=e??0;const i=this._handlers;if(!i.includes(t)){i.push(t)}i.sort((t,e)=>t.priority-e.priority);return this};c.prototype.removeHandler=function(t){const e=this._handlers.indexOf(t);if(e>=0){this._handlers.splice(e,1)}return this};c.prototype._handleInput=function(t,e){const i=this._handlers;for(let n=i.length-1;n>=0&&!e.handled;n--){i[n][t]?.(e)}if(e.handled&&e.event&&!e.passEvent){e.event.preventDefault()}};c.prototype._beginGesture=function(t){this._handleInput("beginGesture",t);this._touchStart=t.timeStamp;this._touchMoved=false;this._gesture=true;this._touchOrigin.x=t.x;this._touchOrigin.y=t.y;this._n=t.n};c.prototype._move=function(t){this._clickFunc?.();if(this._gesture&&this._n===t.n){if(!this._touchMoved){this._touchMoved=t.timeStamp-this._touchStart>200&&(Math.abs(this._touchOrigin.x-t.x)>3||Math.abs(this._touchOrigin.y-t.y)>3)}this._handleInput("move",t)}else{this._handleInput("hover",t)}};c.prototype._endGesture=function(t){if(!this._gesture){return}this._handleInput("endGesture",t);this._gesture=false};c.prototype._click=function(t,e){if(this._clickTimer>0){clearTimeout(this._clickTimer);this._clickTimer=0;this._clickFunc=null}this._handleInput(e?"doubleClick":"click",t)};c.prototype._contextMenu=function(t){this._handleInput("contextMenu",t)};c.prototype._keyEventHandler=function(t){this._handleInput("keyEventHandler",t)};return c});
//# sourceMappingURL=Loco.js.map