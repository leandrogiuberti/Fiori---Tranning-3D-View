/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.define(["../abgrToColor","../ObjectType","../thirdparty/three","../NodeContentType","./ThreeUtils"],function(e,t,i,r,n){"use strict";i.Object3D.prototype._vkCalculateObjectOrientedBoundingBox=function(){n.computeObjectOrientedBoundingBox(this,this.userData.boundingBox=new i.Box3)};i.Object3D.prototype._vkTraverseNodeGeometry=function(e){e(this);for(var t=0,i=this.children.length;t<i;t++){var r=this.children[t];if(r.geometry!==undefined&&r.userData.skipIt){if(r.children){r._vkTraverseNodeGeometry(e)}else{e(r)}}else if(r.children){r._vkTraverseNodeGeometry(e)}}};i.Object3D.prototype._vkSetOpacityRecursive=function(e){this.traverseVisible(function(t){if(t.material){t.material.opacity=e;t.material.transparent=e<1}})};i.Object3D.prototype._vkGetTotalOpacity=function(e,t){var i;if(e){i=new Map;e.forEach(function(e){if(!e.node||!e.parent){return}i.set(e.node,e)})}var r=1;var n=this;do{var a=null,o=null;if(i){o=i.get(n)}if(o&&o.opacity!=null){a=o.opacity}else if(t){a=t._getOpacity(n)}else if(n.userData&&n.userData.opacity!==undefined){a=n.userData.opacity}var s=1;if(o&&o.opacity!=null&&n.userData&&n.userData.offsetOpacity!=null){s=n.userData.offsetOpacity}if(a!=null){r*=a;r*=s}if(o&&o.parent){n=o.parent;continue}n=n.parent}while(n);return r};i.Object3D.prototype._vkTraverseMeshNodes=function(e){if(this._vkUpdate!==undefined||this.isDetailView||this.userData.nodeContentType===r.PMI){return}e(this);var t=this.children;for(var i=0,n=t.length;i<n;i++){t[i]._vkTraverseMeshNodes(e)}};i.Object3D.prototype._vkTraverseNodes=function(e,t,i){e(this);var r;if(i){r=i.get(this)}var n;if(r){for(n=0;n<r.length;n++){r[n].node._vkTraverseNodes(e,t,i)}}var a=this.children;if(a){for(n=0;n<a.length;n++){var o=a[n];if(t){var s=t.get(o);if(s){continue}}o._vkTraverseNodes(e,t,i)}}};function a(e,t){var i=e.min,r=e.max,n=t.elements,a=(i.x+r.x)*.5,o=(i.y+r.y)*.5,s=(i.z+r.z)*.5,u=r.x-a,c=r.y-o,h=r.z-s;var p=n[0]*a+n[4]*o+n[8]*s+n[12];var d=n[1]*a+n[5]*o+n[9]*s+n[13];var f=n[2]*a+n[6]*o+n[10]*s+n[14];var l=Math.abs(n[0]*u)+Math.abs(n[4]*c)+Math.abs(n[8]*h);var y=Math.abs(n[1]*u)+Math.abs(n[5]*c)+Math.abs(n[9]*h);var v=Math.abs(n[2]*u)+Math.abs(n[6]*c)+Math.abs(n[10]*h);i.set(p-l,d-y,f-v);r.set(p+l,d+y,f+v)}i.Object3D.prototype._expandBoundingBox=function(e,t,r,n){var o=new i.Box3;function s(i){const r=i.userData;var n=i.geometry;if(n!==undefined){const t=r.renderGroup;if(t?.boundingBox){o.setFromPackedArray(t.boundingBox)}else{if(!n.boundingBox){n.computeBoundingBox()}o.copy(n.boundingBox)}if(!o.isEmpty()){a(o,i.matrixWorld);if(isFinite(o.min.x)&&isFinite(o.min.y)&&isFinite(o.min.z)&&isFinite(o.max.x)&&isFinite(o.max.y)&&isFinite(o.max.z)){e.union(o)}}}else if(r.pcgBoundingBox?.isEmpty()===false){o.copy(r.pcgBoundingBox);a(o,i.matrixWorld);e.union(o)}const s=r.boundingBox;if(s!==undefined&&s.min&&s.max&&!s.isEmpty()&&!t){o.copy(s);a(o,i.matrixWorld);e.union(o)}}function u(e){if(e._vkUpdate!==undefined&&(r||n&&e.userData.is2D)){return}if(!t||e.visible){s(e);var i=e.children;for(var a=0,o=i.length;a<o;a++){u(i[a])}}}u(this);return e};i.Object3D.prototype._vkPersistentId=function(){var e=this;do{if(e.userData.treeNode&&e.userData.treeNode.sid){return e.userData.treeNode.sid}e=e.parent}while(e);return null};i.Object3D.prototype._vkSetNodeContentType=function(e){this.userData.nodeContentType=e;if(e===r.Reference){this.visible=false;this.userData.skipIt=true}else if(e===r.Background){this.userData.renderStage=-1}else if(e===r.Symbol){this.userData.symbolContent=true;this.userData.renderStage=1;this.updateMatrix();this.updateMatrixWorld(true);this.userData.direction=(new i.Vector3).setFromMatrixColumn(this.matrixWorld,2).normalize()}};i.Object3D.prototype._vkGetNodeContentType=function(){return this.userData.nodeContentType};i.Camera.prototype._vkZoomTo=function(e,t){t=t||0;var r=new i.Vector3;e.getSize(r);if(r.lengthSq()===0){return this}var n=e.min,a=e.max;var o=[new i.Vector3(n.x,n.y,n.z),new i.Vector3(a.x,a.y,a.z),new i.Vector3(n.x,n.y,a.z),new i.Vector3(n.x,a.y,a.z),new i.Vector3(a.x,n.y,a.z),new i.Vector3(a.x,a.y,n.z),new i.Vector3(n.x,a.y,n.z),new i.Vector3(a.x,n.y,n.z)];var s=new i.Matrix4,u=new i.Vector3,c=new i.Box2;function h(e){o.forEach(function(t){u=t.project(e);c.expandByPoint(new i.Vector2(u.x,u.y))})}var p=this.view;if(p&&p.enabled){h(this);var d=p.offsetX+p.width*(.5+.25*(c.min.x+c.max.x));var f=p.offsetY+p.height*(.5-.25*(c.min.y+c.max.y));var l=Math.max(c.max.x-c.min.x,c.max.y-c.min.y)*.5*(1+t);p.width*=l;p.height*=l;p.offsetX=d-p.width*.5;p.offsetY=f-p.height*.5;return this}function y(e){s.multiplyMatrices(e.projectionMatrix,e.matrixWorldInverse);for(var t in o){u.copy(o[t]).applyMatrix4(s);if(u.x<-1||u.x>1||u.y<-1||u.y>1){return false}}return true}var v=new i.Vector3;e.getCenter(v);var x=new i.Vector3;this.getWorldDirection(x);x.multiplyScalar(r.length());this.position.copy(v).sub(x);this.updateMatrixWorld(true);if(this.isPerspectiveCamera){while(!y(this)){this.position.sub(x);this.updateMatrixWorld(true)}var m=10;var b=this.position.clone();var g=v.clone();for(var D=0;D<m;D++){this.position.copy(b).add(g).multiplyScalar(.5);this.updateMatrixWorld(true);if(y(this)){b.copy(this.position)}else{g.copy(this.position)}}this.position.copy(b).sub(v).multiplyScalar(t).add(b);this.updateMatrixWorld(true)}else if(this.isOrthographicCamera){h(this);this.zoom/=Math.max(c.max.x-c.min.x,c.max.y-c.min.y)*.5*(1+t);this.updateProjectionMatrix()}return this};i.Mesh.prototype._vkClone=function(){var e=new i.Mesh;n.disposeMaterial(e.material);e.copy(this);return e}});
//# sourceMappingURL=ThreeExtensions.js.map