{"version":3,"file":"PoiHelper.js","names":["sap","ui","define","ContentConnector","ContentResource","ContentDeliveryService","NodeContentType","TransformationMatrix","THREE","assert","uid","unitVector","Vector3","cleanUpUserData","child","userData","skipIt","children","forEach","PoiHelper","this","_symbolSceneCache","prototype","createPOI","url","scene","poiSceneId","viewport","poiPosition","nodeInfo","getNearestEntityOrVisibleElementNodes","_implementation","sid","viewportRect","getDomRef","getBoundingClientRect","screenX","x","left","screenY","y","top","hit","hitTest","ignoreOverlay","Promise","reject","matrix","Matrix4","compose","point","_getNativeCamera","quaternion","pickedNodes","object","invertParent","length","copy","matrixWorld","invert","premultiply","transform","convertTo4x3","elements","referenceNode","nodeId","transformType","nodeHierarchy","getDefaultNodeHierarchy","symbolNode","createNode","name","Symbol","view","getCurrentView","getViews","loadSymbolScene","then","rootNodeRef","entityId","add","apply","treeNode","updateNodeInfos","target","visible","setShouldRenderFrame","slice","veId","contentType","updatePOI","symbolNodeSid","persistentIdToNodeRef","position","set","removeNode","_symbolCenterFixed","resolve","removePOI","nodeRef","vsm","getViewStateManager","setVisibilityState","nodeRefArray","Array","isArray","node","getReferenceNodeFromMarkerNodeId","unbindMarkerNodeTransformationFromReferenceNode","getPoiRect","camera","boundingBox","Box3","setFromObject","vertices","min","z","max","frustum","Frustum","setFromProjectionMatrix","multiplyMatrices","projectionMatrix","matrixWorldInverse","intersectsBox","vertex","i","containsPoint","vertexWorldCoord","vertexScreenSpace","project","box2","Box2","halfScreen","Vector2","width","height","box2min","clone","multiply","box2max","adjustPoi","poiNodeRef","getBackgroundProjection","screenPos","getWorldPosition","_width","_height","updateMatrix","updateMatrixWorld","direction","setFromMatrixColumn","normalize","updateNodeId","newNodeId","poiNode","bindMarkerNodeTransformationToReferenceNode","setNodePersistentId","findSymbolSceneInCache","sceneId","find","item","cacheEntry","sourceType","contentResource","source","veid","sourceId","contentConnector","cds","cleanup","removeContentManagerResolver","setTimeout","destroy","attachEventOnce","getNodeProxy","getNodeRef","push","event","getParameter","addContentManagerResolver","pattern","dimension","contentManagerClassName","settings","loader","addContentResource","bind"],"sources":["PoiHelper-dbg.js"],"mappings":";;;;;;AASAA,IAAIC,GAAGC,OAAO,CACb,sBACA,qBACA,2BACA,qBACA,0BACA,sBACA,kBACA,qBACE,SACFC,EACAC,EACAC,EACAC,EACAC,EACAC,EACAC,EACAC,GAEA,aAEA,IAAIC,EAAa,IAAIH,EAAMI,QAAQ,EAAG,EAAG,GAGzC,SAASC,EAAgBC,GACxBA,EAAMC,SAAW,CAAEC,OAAQ,MAC3BF,EAAMG,SAASC,QAAQL,EACxB,CAEA,IAAIM,EAAY,WAOfC,KAAKC,kBAAoB,EAC1B,EASAF,EAAUG,UAAUC,UAAY,SAASC,EAAKC,EAAOC,EAAYC,EAAUC,EAAaC,EAAUC,GACjGH,EAAWA,EAASI,iBAAmBJ,EACvC,KAAM,QAASE,GAAW,CACzBA,EAASG,IAAMtB,GAChB,CACA,KAAM,cAAemB,GAAW,CAG/BpB,EAAOqB,GAAyC,KAAM,oGAEtD,IAAIG,EAAeN,EAASO,YAAYC,wBACxC,IAAIC,EAAUR,EAAYS,EAAIJ,EAAaK,KAC3C,IAAIC,EAAUX,EAAYY,EAAIP,EAAaQ,IAC3C,IAAIC,EAAMf,EAASgB,QAAQP,EAASG,EAAS,CAAEK,cAAe,OAC9D,GAAIF,GAAO,KAAM,CAChB,OAAOG,QAAQC,OAAO,0CACvB,CAEA,IAAIC,GAAS,IAAIvC,EAAMwC,SAAUC,QAAQP,EAAIQ,MAAOvB,EAASwB,mBAAmBC,WAAYzC,GAE5F,IAAI0C,EAAcvB,EAAsCY,EAAIY,QAC5D,IAAIC,EAAeF,EAAYG,OAAS,GAAI,IAAIhD,EAAMwC,SAAUS,KAAKJ,EAAY,GAAGK,aAAaC,SAAW,IAAInD,EAAMwC,QACtHD,EAAOa,YAAYL,GACnB1B,EAASgC,UAAYtD,EAAqBuD,aAAaf,EAAOgB,UAC9DlC,EAASmC,eAAiBX,EAAYG,OAAS,EAAIH,EAAY,GAAKX,EAAIY,QAAQvC,SAASkD,MAC1F,CACApC,EAASqC,cAAgB,iBAEzB,IAAIC,EAAgB1C,EAAM2C,0BAC1B,IAAIC,EAAaF,EAAcG,WAAW,KAAMzC,EAAS0C,KAAM,KAAMjE,EAAgBkE,OAAQ3C,GAC7F,IAAI4C,EAAO9C,EAAS+C,kBAAoBjD,EAAMkD,WAAW,GAEzD,OAAOvD,KAAKwD,gBAAgBpD,EAAKE,GAAYmD,KAAK,SAASC,GAC1D,IAAIC,EAAWD,EAAY/D,SAASgE,SACpCV,EAAWW,IAAIC,MAAMZ,EAAYS,EAAY7D,UAC7CoD,EAAWpD,SAASC,QAAQL,GAC5BwD,EAAWtD,SAASmE,SAASH,SAAWA,EACxCN,EAAKU,gBAAgB,CAAC,CAAEC,OAAQf,EAAYgB,QAAS,KAAMxB,UAAWhC,EAASgC,aAC/ElC,EAAS2D,uBACT,MAAO,CACNzB,UAAWhC,EAASgC,UAAU0B,QAC9BC,KAAM3D,EAASG,IACf+C,SAAUA,EACVR,KAAM1C,EAAS0C,KACfL,cAAe,iBACfuB,YAAa,SACbzB,cAAenC,EAASmC,cACxBK,WAAYA,EAEd,EACD,EAIAlD,EAAUG,UAAUoE,UAAY,SAASlE,EAAKC,EAAOE,EAAUgE,EAAejE,EAAYG,GACzF,IAAIwC,EAAa5C,EAAMmE,sBAAsBD,GAC7C,GAAI,SAAU9D,EAAU,CACvBwC,EAAWE,KAAO1C,EAAS0C,IAC5B,CACA,GAAI,cAAe1C,EAAU,CAC5B,GAAIwC,EAAWtD,SAASmE,SAASrB,UAAW,CAC3CQ,EAAWtD,SAASmE,SAASrB,UAAYhC,EAASgC,UAAU0B,OAC7D,KAAO,CACNlB,EAAWwB,SAASC,IAAIjE,EAASgC,UAAU,GAAIhC,EAASgC,UAAU,IAAKhC,EAASgC,UAAU,IAC3F,CACD,CACA,GAAInC,EAAY,CACf,IAAIyC,EAAgB1C,EAAM2C,0BAC1BD,EAAc4B,WAAW1B,EAAWpD,UACpC,OAAOG,KAAKwD,gBAAgBpD,EAAKE,GAAYmD,KAAK,SAASC,GAK1D,IAAIC,EAAWD,EAAY/D,SAASgE,SACpCV,EAAWW,IAAIC,MAAMZ,EAAYS,EAAY7D,UAC7CoD,EAAWpD,SAASC,QAAQL,GAC5BwD,EAAWtD,SAASiF,mBAAqB,MACzC3B,EAAWtD,SAASmE,SAASH,SAAWA,EACxCpD,EAAS2D,uBACT,OAAOP,CACR,EACD,KAAO,CACNpD,EAAS2D,uBACT,OAAOzC,QAAQoD,QAAQ5B,EAAWtD,SAASmE,SAASH,SACrD,CACD,EAEA5D,EAAUG,UAAU4E,UAAY,SAASzE,EAAO0E,GAC/C,IAAIhC,EAAgB1C,EAAM2C,0BAC1B,IAAIgC,EAAM3E,EAAM4E,sBAChBD,EAAIE,mBAAmBH,EAAS,MAAO,MAGvC,IAAII,EAAeC,MAAMC,QAAQN,GAAWA,EAAU,CAACA,GACvD,GAAII,GAAgBA,EAAa/C,OAAQ,CACxC+C,EAAarF,QAAQ,SAASwF,GAC7B,IAAIzC,EAASyC,EAAK3F,SAASkD,OAC3B,IAAID,EAAgBvC,EAAMkF,iCAAiC1C,GAC3D,GAAID,EAAe,CAClBvC,EAAMmF,gDAAgD5C,EAAcjD,SAASkD,OAAQA,EACtF,CACD,EACD,CACAE,EAAc4B,WAAWI,EAC1B,EAEAhF,EAAUG,UAAUuF,WAAa,SAASlF,EAAUwE,GACnD,IAAIW,EAASnF,EAASwB,mBACtB,IAAI4D,EAAc,IAAIvG,EAAMwG,KAC5BD,EAAYE,cAAcd,GAC1B,IAAIe,EAAW,CACd,IAAI1G,EAAMI,QAAQmG,EAAYI,IAAI9E,EAAG0E,EAAYI,IAAI3E,EAAGuE,EAAYI,IAAIC,GACxE,IAAI5G,EAAMI,QAAQmG,EAAYM,IAAIhF,EAAG0E,EAAYM,IAAI7E,EAAGuE,EAAYM,IAAID,GACxE,IAAI5G,EAAMI,QAAQmG,EAAYI,IAAI9E,EAAG0E,EAAYI,IAAI3E,EAAGuE,EAAYM,IAAID,GACxE,IAAI5G,EAAMI,QAAQmG,EAAYI,IAAI9E,EAAG0E,EAAYM,IAAI7E,EAAGuE,EAAYM,IAAID,GACxE,IAAI5G,EAAMI,QAAQmG,EAAYM,IAAIhF,EAAG0E,EAAYI,IAAI3E,EAAGuE,EAAYM,IAAID,GACxE,IAAI5G,EAAMI,QAAQmG,EAAYM,IAAIhF,EAAG0E,EAAYM,IAAI7E,EAAGuE,EAAYI,IAAIC,GACxE,IAAI5G,EAAMI,QAAQmG,EAAYI,IAAI9E,EAAG0E,EAAYM,IAAI7E,EAAGuE,EAAYI,IAAIC,GACxE,IAAI5G,EAAMI,QAAQmG,EAAYM,IAAIhF,EAAG0E,EAAYI,IAAI3E,EAAGuE,EAAYI,IAAIC,IAGzE,IAAIE,EAAU,IAAI9G,EAAM+G,QACxBD,EAAQE,yBAAwB,IAAIhH,EAAMwC,SAAUyE,iBAAiBX,EAAOY,iBAAkBZ,EAAOa,qBACrG,IAAKL,EAAQM,cAAcb,GAAc,CAAE,OAAO,KAAO,CAEzD,IAAII,EAAM,IAAI3G,EAAMI,QAAQ,EAAG,EAAG,GAClC,IAAIyG,EAAM,IAAI7G,EAAMI,SAAS,GAAI,GAAI,GACrC,IAAIiH,EAAS,IAAIrH,EAAMI,QACvB,IAAK,IAAIkH,EAAI,EAAGA,EAAIZ,EAAS1D,SAAUsE,EAAG,CACzC,IAAKR,EAAQS,cAAcb,EAASY,IAAK,CAAE,OAAO,KAAO,CACzD,IAAIE,EAAmBH,EAAOpE,KAAKyD,EAASY,IAC5C,IAAIG,EAAoBD,EAAiBE,QAAQpB,GACjDK,EAAIA,IAAIc,GACRZ,EAAIA,IAAIY,EACT,CAEA,IAAIE,EAAO,IAAI3H,EAAM4H,KAAKjB,EAAKE,GAC/B,IAAIpF,EAAeN,EAASO,YAAYC,wBACxC,IAAIkG,EAAa,IAAI7H,EAAM8H,QAAQrG,EAAasG,MAAQ,EAAGtG,EAAauG,OAAS,GACjF,IAAIC,EAAUN,EAAKhB,IAAIuB,QAAQC,SAASN,GACxC,IAAIO,EAAUT,EAAKd,IAAIqB,QAAQC,SAASN,GACxC,IAAIE,EAAQK,EAAQvG,EAAIoG,EAAQpG,EAChC,IAAImG,EAASI,EAAQpG,EAAIiG,EAAQjG,EACjC,MAAO,CAAE+F,MAAOA,EAAOC,OAAQA,EAChC,EAEArH,EAAUG,UAAUuH,UAAY,SAASlH,EAAUmH,GAClD,GAAInH,EAASoH,4BAA8B,SAAU,CACpD,IAAIC,EAAYF,EAAWG,iBAAiB,IAAIzI,EAAMI,SAAWsH,QAAQvG,EAASwB,oBAClF,IAAIT,EAAMf,EAASgB,SAASqG,EAAU3G,EAAI,GAAM,IAAOV,EAASuH,QAASF,EAAUxG,GAAK,GAAM,IAAOb,EAASwH,QAAS,CAAEvG,cAAe,OACxI,GAAIF,EAAK,CACRoG,EAAWjD,SAASpC,KAAKf,EAAIQ,MAC9B,CACA4F,EAAW1F,WAAWK,KAAK9B,EAASwB,mBAAmBC,YACvD0F,EAAWM,eACXN,EAAWO,oBACXP,EAAW/H,SAASuI,WAAY,IAAI9I,EAAMI,SAAU2I,oBAAoBT,EAAWpF,YAAa,GAAG8F,WACpG,CAEAV,EAAW/H,SAAS8C,UAAYtD,EAAqBuD,aAAagF,EAAW/F,OAAOgB,SACrF,EAEA5C,EAAUG,UAAUmI,aAAe,SAAShI,EAAOwC,EAAQyF,GAC1D,IAAIC,EAAUlI,EAAMmE,sBAAsB3B,GAC1C,GAAI0F,GAAW,KAAM,CACpB,IAAI3F,EAAgBvC,EAAMkF,iCAAiC1C,GAC3D,GAAID,EAAe,CAClBvC,EAAMmF,gDAAgD5C,EAAcjD,SAASkD,OAAQA,GACrFxC,EAAMmI,4CAA4C5F,EAAcjD,SAASkD,OAAQyF,EAClF,CAEAjI,EAAMoI,oBAAoBF,EAASD,EACpC,CACA,OAAOC,CACR,EAEAxI,EAAUG,UAAUwI,uBAAyB,SAAStI,EAAKuI,GAC1D,OAAO3I,KAAKC,kBAAkB2I,KAAK,SAASC,GAAQ,OAAOA,EAAKzI,MAAQA,GAAOyI,EAAKF,UAAYA,CAAS,EAC1G,EAWA5I,EAAUG,UAAUsD,gBAAkB,SAASpD,EAAKuI,GACnD,IAAIG,EAAa9I,KAAK0I,uBAAuBtI,EAAKuI,GAElD,GAAIG,GAAc,KAAM,CACvB,OAAOrH,QAAQoD,QAAQiE,EAAWpF,YAAY4D,QAC/C,CAEA,OAAO,IAAI7F,QAAQ,SAASoD,EAASnD,GAMpC,IAAIqH,EAAa,UAAYzJ,IAE7B,IAAI0J,EAAkB,IAAIhK,EAAgB,CACzC+J,WAAYA,EACZE,OAAQ7I,EACR8I,KAAMP,EACNQ,SAAU,QAIX,IAAIC,EAAmB,IAAIrK,EAC3B,IAAIsK,EAAM,IAAIpK,EAGd,IAAIqK,EAAU,WAGbvK,EAAiBwK,6BAA6BR,GAI9CS,WAAW,WACVJ,EAAiBK,UACjBJ,EAAII,SACL,EAAG,EACJ,EAEAJ,EAAIK,gBACH,iBACA,WACC,IAAIhG,EAAcsF,EAAgBW,eAAeC,aAMjD,GAAI5J,KAAK0I,uBAAuBtI,EAAKuI,IAAY,KAAM,CAGtD3I,KAAKC,kBAAkB4J,KAAK,CAC3BzJ,IAAKA,EACLuI,QAASA,EACTjF,YAAaA,EAAY4D,SAE3B,CAEAzC,EAAQnB,EAAY4D,SAEpBgC,GACD,EACAtJ,MAGDqJ,EAAIK,gBACH,gBACA,SAASI,GACRpI,EAAOoI,EAAMC,aAAa,UAC1BT,GACD,GAGDvK,EAAiBiL,0BAA0B,CAC1CC,QAASlB,EACTmB,UAAW,EACXC,wBAAyB,mCACzBC,SAAU,CACTC,OAAQhB,KAIVD,EAAiBkB,mBAAmBtB,EACrC,EAAEuB,KAAKvK,MACR,EAEA,OAAOD,CACR","ignoreList":[]}