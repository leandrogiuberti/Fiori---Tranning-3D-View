{"version":3,"file":"HitTester.js","names":["sap","ui","define","Log","THREE","RENDER_TARGET_WIDTH","RENDER_TARGET_HEIGHT","HitTester","this","_maskMaterial","MeshBasicMaterial","side","DoubleSide","fog","_depthMaterial","ShaderMaterial","vertexShader","join","fragmentShader","clipping","_renderTarget","WebGLRenderTarget","minFilter","NearestFilter","magFilter","texture","generateMipmaps","depthBuffer","testCamera","matViewProj","Matrix4","frustum","Frustum","inverseMatrix","screenPos","Vector2","raycaster","Raycaster","ray","Ray","sphere","Sphere","objects","data","Uint8Array","point","Vector3","getMeshNode","object","parent","userData","closed","skipIt","prototype","hitTest","x","y","width","height","renderer","scene","camera","clippingPlanes","options","constructor","copy","vx","vy","cameraX","cameraY","view","w","h","setViewOffset","fullWidth","fullHeight","offsetX","offsetY","updateMatrixWorld","updateProjectionMatrix","multiplyMatrices","projectionMatrix","matrixWorldInverse","setFromProjectionMatrix","setFromCamera","set","rBits","getContextRedBits","gBits","getContextGreenBits","bBits","getContextBlueBits","rgBits","rMask","gMask","bMask","rMaskInv","gMaskInv","bMaskInv","maskMaterial","oldClearColor","Color","getClearColor","oldClearAlpha","getClearAlpha","oldAutoClear","autoClear","setRenderTarget","setClearColor","clear","color","index","length","underlayObjects","ignoreUnderlay","regularObjects","overlayObjects","ignoreOverlay","addObject","node","renderStage","push","traverseVisible","visible","selectable","geometry","material","isPointCloud","intersectsObject","matrixWorld","rg","renderGroup","boundingSphere","setFromPackedArray","computeBoundingSphere","applyMatrix4","intersectsSphere","invert","bbox","boundingBox","Box3","newFromPackedArray","intersectsBox","children","i","l","renderNode","nodeMaterial","specularMap","render","renderObject","setRGB","forEach","clearDepth","readRenderTargetPixels","z","unproject","_instanceIndexToNodeMap","Map","_clusterIndexMaterial","instanceIndex","get","distance","origin","distanceTo","hitTestPrecise","pi","plane","dist","distanceToPoint","t","normal","dot","direction","near","Math","max","far","min","intersects","intersectObjects","Infinity","result","isBillboard","isDetailView","hitTestPoint"],"sources":["HitTester-dbg.js"],"mappings":"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","ignoreList":[]}