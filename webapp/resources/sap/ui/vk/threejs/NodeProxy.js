/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.define(["../NodeProxy","./Material","../cssColorToColor","../colorToCSSColor","../abgrToColor","../colorToABGR","../TransformationMatrix","./ThreeExtensions","../ObjectType","../thirdparty/three"],function(t,e,r,a,i,o,n,s,c,u){"use strict";var l=t.extend("sap.ui.vk.threejs.NodeProxy",{metadata:{library:"sap.ui.vk"},constructor:function(e,r){t.call(this);this._object3D=r;this._nodeHierarchy=e}});l.prototype.destroy=function(){this._object3D=null;t.prototype.destroy.call(this)};l.prototype.getNodeHierarchy=function(){return this._nodeHierarchy};l.prototype.getNodeRef=function(){return this._object3D};l.prototype.getNodeId=function(){return this._object3D};l.prototype.getVeIds=function(){return this._object3D.userData.veids||[]};l.prototype.getVeId=function(){return this._object3D.userData.treeNode?this._object3D.userData.treeNode.sid:null};l.prototype.getMaterialId=function(){var t=this._object3D;if(this._object3D&&!this._object3D.geometry){if(this._object3D.children.length===1&&this._object3D.children[0].geometry&&(this._object3D.children[0].name===""||this._object3D.children[0].name===undefined)){t=this._object3D.children[0]}}if(t.material!==undefined&&t.material.userData!==undefined&&t.material.userData.materialId!==undefined){return t.material.userData.materialId}else if(t.userData.originalMaterial!==undefined&&t.userData.originalMaterial.userData!==undefined&&t.userData.originalMaterial.userData.materialId!==undefined){return t.userData.originalMaterial.userData.materialId}return undefined};l.prototype.getName=function(){return this._object3D.name||"<"+this._object3D.type+">"};l.prototype._updateAncestorsBoundingBox=function(){var t=this._object3D.parent;while(t){if(t.userData.boundingBox!==undefined){t._vkCalculateObjectOrientedBoundingBox()}t=t.parent}};l.prototype.getLocalMatrix=function(){return n.convertTo4x3(this._object3D.matrix.elements)};l.prototype.setLocalMatrix=function(t){if(t){var e=this._object3D;e.matrix.fromArray(n.convertTo4x4(t));e.matrix.decompose(e.position,e.quaternion,e.scale);e.updateMatrixWorld(true);this._updateAncestorsBoundingBox()}this.setProperty("localMatrix",t,true);return this};l.prototype.setLocalMatrixNotUpdatingBBox=function(t){if(t){var e=this._object3D;e.matrix.fromArray(n.convertTo4x4(t));e.matrix.decompose(e.position,e.quaternion,e.scale);e.updateMatrixWorld(true)}this.setProperty("localMatrix",t,true);return this};l.prototype.getWorldMatrix=function(){return n.convertTo4x3(this._object3D.matrixWorld.elements)};l.prototype.setWorldMatrix=function(t){if(t){var e=this._object3D;e.matrixWorld.fromArray(n.convertTo4x4(t));if(e.parent){e.matrix.multiplyMatrices((new u.Matrix4).copy(e.parent.matrixWorld).invert(),e.matrixWorld)}else{e.matrix.copy(e.matrixWorld)}e.matrix.decompose(e.position,e.quaternion,e.scale);e.updateMatrixWorld(true);this._updateAncestorsBoundingBox()}this.setProperty("worldMatrix",t,true);return this};l.prototype.getOpacity=function(){const t=this._nodeHierarchy.getScene().getViewStateManager();return t?.getOpacity(this._object3D)??this._object3D.userData.opacity};l.prototype.setOpacity=function(t){var e=this._nodeHierarchy.getScene().getViewStateManager();if(e){e.setOpacity(this._object3D,t)}else{this._object3D.userData.opacity=t}this.setProperty("opacity",t,true);return this};l.prototype.getTintColorABGR=function(){const t=this._nodeHierarchy.getScene().getViewStateManager();return t?._getTintColorABGR(this._object3D)??this._object3D.userData.tintColor};l.prototype.setTintColorABGR=function(t){var e=this._nodeHierarchy.getScene().getViewStateManager();if(e){e.setTintColor(this._object3D,t)}else{this._object3D.userData.tintColor=t}this.setProperty("tintColorABGR",t,true);this.setProperty("tintColor",a(i(t)),true);return this};l.prototype.getTintColor=function(){return a(i(this.getTintColorABGR()))};l.prototype.setTintColor=function(t){var e=o(r(t));var a=this._nodeHierarchy.getScene().getViewStateManager();if(a){a.setTintColor(this._object3D,e)}else{this._object3D.userData.tintColor=e}this.setProperty("tintColorABGR",e,true);this.setProperty("tintColor",t,true);return this};l.prototype.getNodeMetadata=function(){return this._object3D.userData.metadata||{}};l.prototype.getHasChildren=function(){return this._object3D.children.length>0};l.prototype.getClosed=function(){return!!this._object3D.userData.closed};l.prototype.getBoundingBox=function(){return this._object3D.userData.boundingBox};l.prototype.assignMaterial=function(t){var e=function(t,e){var r;if(t.userData){r=t.userData.materialId;e.userData.materialId=r}if(e.material!==undefined){if(e.material.side){t.side=e.material.side}e.material=t;t.userData.materialUsed++;delete e.userData.originalMaterial}};e(t.getMaterialRef(),this._object3D);if(!this._object3D.children){return this}this._object3D.children.forEach(function(r){if(!r||r.userData.objectType===c.PMI||r.userData.objectType===c.Hotspot){return}e(t.getMaterialRef(),r)});return this};l.prototype.enumerateMaterials=function(t){var r=function(t,e,a){if(t){if(t.userData.originalMaterial){e.add(t.userData.originalMaterial)}else if(t.material){e.add(t.material)}if(t.children){t.children.forEach(function(t){if(t){if(a){r(t,e,a)}else if(t.userData.originalMaterial){e.add(t.userData.originalMaterial)}else if(t.material){e.add(t.material)}}})}}};var a=new Set;r(this._object3D,a,t);var i=[];a.forEach(function(t){i.push(t)});var o=[];for(var n=0;n<i.length;n++){var s=new e;s.setMaterialRef(i[n]);o.push(s)}return o};l.prototype.replaceMaterial=function(t,e){var r=typeof t.getMaterialRef==="function"?t.getMaterialRef():t;var a=typeof e.getMaterialRef==="function"?e.getMaterialRef():e;if(this._object3D.userData.originalMaterial&&this._object3D.userData.originalMaterial===r){this._object3D.userData.originalMaterial=a}else if(this._object3D.material&&this._object3D.material===r){this._object3D.material=a}if(e.id){this._object3D.userData.materialId=e.id}if(!this._object3D.children){return this}this._object3D.children.forEach(function(t){if(t&&t.userData.originalMaterial&&t.userData.originalMaterial===r){t.userData.originalMaterial=a}else if(t&&t.material&&t.material===r){t.material=a}});return this};l.prototype.getLocalTranslate=function(){var t=this._object3D;return[t.position.x,t.position.y,t.position.z]};l.prototype.getLocalScale=function(){var t=this._object3D;return[t.scale.x,t.scale.y,t.scale.z]};l.prototype.getLocalRotationInQuaternion=function(){var t=this._object3D;return[t.quaternion.x,t.quaternion.y,t.quaternion.z,t.quaternion.w]};l.prototype.getLocalRotationInAngleAxis=function(){var t=this._object3D;var e=t.quaternion;if(e.w>1){e.normalise()}var r=2*Math.acos(e.w);var a=Math.sqrt(1-e.w*e.w);var i,o,n;if(a<.001){i=e.x;o=e.y;n=e.z}else{i=e.x/a;o=e.y/a;n=e.z/a}return[i,o,n,r]};l.prototype.getLocalRotationInEuler=function(){var t=this._object3D;var e=t.quaternion;if(e.w>1){e.normalise()}var r=26;var a=e.x*e.y+e.z*e.w;var i,o,n;if(a>.499){i=2*Math.atan2(e.x,e.w);o=Math.PI/2;n=0}if(a<-.499){i=-2*Math.atan2(e.x,e.w);o=-Math.PI/2;n=0}else{var s=e.x*e.x;var c=e.y*e.y;var u=e.z*e.z;i=Math.atan2(2*e.y*e.w-2*e.x*e.z,1-2*c-2*u);o=Math.asin(2*a);n=Math.atan2(2*e.x*e.w-2*e.y*e.z,1-2*s-2*u)}return[i,o,n,r]};return l});
//# sourceMappingURL=NodeProxy.js.map