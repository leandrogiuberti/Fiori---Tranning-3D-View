/*!
 * OpenUI5
 * (c) Copyright 2025 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["./Table","./TableRenderer","./utils/TableUtils","./plugins/BindingSelection","sap/base/Log","sap/ui/model/ClientTreeBindingAdapter","sap/ui/model/TreeBindingCompatibilityAdapter","sap/ui/model/controlhelper/TreeBindingProxy"],function(e,t,o,i,n,r,s,p){"use strict";const a=o.createWeakMapFacade();const l=e.extend("sap.ui.table.TreeTable",{metadata:{library:"sap.ui.table",properties:{expandFirstLevel:{type:"boolean",defaultValue:false,deprecated:true},useGroupMode:{type:"boolean",group:"Appearance",defaultValue:false},groupHeaderProperty:{type:"string",group:"Data",defaultValue:null},collapseRecursive:{type:"boolean",defaultValue:true,deprecated:true},rootLevel:{type:"int",group:"Data",defaultValue:0,deprecated:true}},events:{toggleOpenState:{parameters:{rowIndex:{type:"int"},rowContext:{type:"object"},expanded:{type:"boolean"}}}}},renderer:t});l.prototype.init=function(){e.prototype.init.apply(this,arguments);a(this).bPendingRequest=false;o.Grouping.setHierarchyMode(this,o.Grouping.HierarchyMode.Tree);o.Hook.register(this,o.Hook.Keys.Row.UpdateState,u,this);o.Hook.register(this,o.Hook.Keys.Row.Expand,d,this);o.Hook.register(this,o.Hook.Keys.Row.Collapse,y,this);this._oProxy=new p(this,"rows")};l.prototype._bindRows=function(t){a(this).bPendingRequest=false;const o=this.getExpandFirstLevel()?1:0;this._oProxy.applyLegacySettingsToBindingInfo(t,{rootLevel:this.isPropertyInitial("rootLevel")?undefined:this.getRootLevel(),collapseResursive:this.isPropertyInitial("collapseRecursive")?undefined:this.getCollapseRecursive(),numberOfExpandedLevels:this.isPropertyInitial("expandFirstLevel")?undefined:o});return e.prototype._bindRows.call(this,t)};function u(e){const t=e.context["_mProxyInfo"];e.level=t.level;e.expandable=!t.isLeaf;e.expanded=t.isExpanded;if(o.Grouping.isInGroupMode(this)){const t=this.getGroupHeaderProperty();if(t){e.title=e.context.getProperty(t)}if(e.expandable){e.type=e.Type.GroupHeader;e.contentHidden=true}}}function d(e){const t=e.getIndex();this._oProxy.expand(t);const o=this._oProxy.isExpanded(t);if(typeof o==="boolean"){this._onGroupHeaderChanged(e,o)}}function y(e){const t=e.getIndex();this._oProxy.collapse(t);const o=this._oProxy.isExpanded(t);if(typeof o==="boolean"){this._onGroupHeaderChanged(e,o)}}l.prototype.setFixedRowCount=function(e){n.warning('TreeTable: the property "fixedRowCount" is not supported and will be ignored!');return this};l.prototype.isTreeBinding=function(t){t=t||"rows";if(t==="rows"){return this._oProxy.isTreeBinding()}return e.prototype.isTreeBinding.apply(this,arguments)};l.prototype.getBinding=function(t){t=t==null?"rows":t;const o=e.prototype.getBinding.call(this,t);if(o&&t==="rows"&&!o.getLength){if(o.isA("sap.ui.model.odata.ODataTreeBinding")){s(o,this)}else if(o.isA("sap.ui.model.odata.v2.ODataTreeBinding")){o.applyAdapterInterface()}else if(o.isA("sap.ui.model.ClientTreeBinding")){r.apply(o)}else{n.error("Binding not supported by sap.ui.table.TreeTable")}}return o};l.prototype._getContexts=function(e,t,o,i){if(!this.getVisible()&&this.getBinding()?.isSuspended()){return[]}return this._oProxy.getContexts(e,t,o,i)};l.prototype._getRowContexts=function(e){return c(this,e)};function c(t,o,i){const n=t._getTotalRowCount();let r=e.prototype._getRowContexts.call(t,o);if(i===true){return r}const s=t._getTotalRowCount();const p=t._getFirstRenderedRowIndex();const a=t._getMaxFirstRenderedRowIndex();t._adjustToTotalRowCount();if(a<p&&t._bContextsAvailable){r=c(t,o,true)}else if(n!==s){r=c(t,o,true)}return r}l.prototype._onGroupHeaderChanged=function(e,t){this.fireToggleOpenState({rowIndex:e.getIndex(),rowContext:o.getBindingContextOfRow(e),expanded:t})};l.prototype.expand=function(e){this._oProxy.expand(e);return this};l.prototype.collapse=function(e){this._oProxy.collapse(e);return this};l.prototype.collapseAll=function(){this._oProxy.collapseAll();if(this.getBinding()){this.setFirstVisibleRow(0)}return this};l.prototype.expandToLevel=function(e){this._oProxy.expandToLevel(e);return this};l.prototype.isExpanded=function(e){return this._oProxy.isExpanded(e)};l.prototype.setRootLevel=function(e){this.setFirstVisibleRow(0);this._oProxy.setRootLevel(e);this.setProperty("rootLevel",e,true);return this};l.prototype.setCollapseRecursive=function(e){this._oProxy.setCollapseRecursive(e);this.setProperty("collapseRecursive",!!e,true);return this};l.prototype.setUseGroupMode=function(e){this.setProperty("useGroupMode",!!e);g(this);return this};l.prototype.setEnableGrouping=function(){n.warning("The property enableGrouping is not supported by the sap.ui.table.TreeTable control");return this};l.prototype.setGroupBy=function(){n.warning("The groupBy association is not supported by the sap.ui.table.TreeTable control");return this};l.prototype.setUseFlatMode=function(e){this._bFlatMode=!!e;g(this);return this};function g(e){if(e.getUseGroupMode()){o.Grouping.setHierarchyMode(e,o.Grouping.HierarchyMode.GroupedTree)}else if(e._bFlatMode){o.Grouping.setHierarchyMode(e,o.Grouping.HierarchyMode.Flat)}else if(!e._bFlatMode){o.Grouping.setHierarchyMode(e,o.Grouping.HierarchyMode.Tree)}}l.prototype._createLegacySelectionPlugin=function(){return new i};l.prototype._onBindingDataRequested=function(t){a(this).bPendingRequest=true;e.prototype._onBindingDataRequested.apply(this,arguments)};l.prototype._onBindingDataReceived=function(t){a(this).bPendingRequest=false;e.prototype._onBindingDataReceived.apply(this,arguments)};l.prototype._isWaitingForData=function(){return a(this).bPendingRequest&&e.prototype._isWaitingForData.apply(this)};return l});
//# sourceMappingURL=TreeTable.js.map