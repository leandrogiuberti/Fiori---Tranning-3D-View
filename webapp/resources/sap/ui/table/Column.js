/*!
 * OpenUI5
 * (c) Copyright 2025 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["./utils/TableUtils","./menus/ColumnHeaderMenuAdapter","sap/ui/core/Element","sap/ui/core/library","sap/ui/model/Filter","sap/ui/model/FilterOperator","sap/ui/model/FilterType","sap/ui/model/Sorter","sap/ui/model/Type","sap/ui/model/type/String","sap/base/util/ObjectPath","sap/base/util/JSTokenizer","sap/base/Log"],function(e,t,r,n,i,o,l,s,a,u,p,f,d){"use strict";const g=n.HorizontalAlign;const c=n.SortOrder;const h=n.ValueState;const y={Standard:"Standard",Creation:"Creation"};const m=e.createWeakMapFacade();const b=new window.WeakMap;const C=r.extend("sap.ui.table.Column",{metadata:{library:"sap.ui.table",properties:{width:{type:"sap.ui.core.CSSSize",group:"Dimension",defaultValue:null},minWidth:{type:"int",group:"Dimension",defaultValue:0},flexible:{type:"boolean",group:"Behavior",defaultValue:true,deprecated:true},resizable:{type:"boolean",group:"Behavior",defaultValue:true},hAlign:{type:"sap.ui.core.HorizontalAlign",group:"Appearance",defaultValue:g.Begin},sorted:{type:"boolean",group:"Appearance",defaultValue:false,deprecated:true},sortOrder:{type:"sap.ui.core.SortOrder",group:"Appearance",defaultValue:c.None},sortProperty:{type:"string",group:"Behavior",defaultValue:null},filtered:{type:"boolean",group:"Appearance",defaultValue:false},filterProperty:{type:"string",group:"Behavior",defaultValue:null},filterValue:{type:"string",group:"Behavior",defaultValue:null},filterOperator:{type:"string",group:"Behavior",defaultValue:null},defaultFilterOperator:{type:"string",group:"Behavior",defaultValue:null},filterType:{type:"any",group:"Misc",defaultValue:null},grouped:{type:"boolean",group:"Appearance",defaultValue:false,deprecated:true},visible:{type:"boolean",group:"Appearance",defaultValue:true},name:{type:"string",group:"Appearance",defaultValue:null},showFilterMenuEntry:{type:"boolean",group:"Appearance",defaultValue:true},showSortMenuEntry:{type:"boolean",group:"Appearance",defaultValue:true},headerSpan:{type:"any",group:"Behavior",defaultValue:1},autoResizable:{type:"boolean",group:"Behavior",defaultValue:false}},defaultAggregation:"label",aggregations:{label:{type:"sap.ui.core.Control",altTypes:["string"],multiple:false},multiLabels:{type:"sap.ui.core.Control",multiple:true,singularName:"multiLabel"},template:{type:"sap.ui.core.Control",altTypes:["string"],multiple:false},creationTemplate:{type:"sap.ui.core.Control",multiple:false,visibility:"hidden"},menu:{type:"sap.ui.unified.Menu",multiple:false},_action:{type:"sap.ui.core.Control",multiple:false,visibility:"hidden"}},associations:{headerMenu:{type:"sap.ui.core.IColumnHeaderMenu",multiple:false}},events:{columnMenuOpen:{allowPreventDefault:true,parameters:{menu:{type:"sap.ui.unified.Menu"}}}}}});C._DEFAULT_FILTER_TYPE=new u;C.prototype.init=function(){this.mSkipPropagation={template:true,creationTemplate:true};m(this).oSorter=null;m(this).mCellContentVisibilitySettings=F(this);m(this).bHasDefaultLabel=false;m(this).bHasDefaultTemplate=false;this._initTemplateClonePool()};C.prototype._initTemplateClonePool=function(){this._mTemplateClones=Object.keys(y).reduce(function(e,t){e[t]=[];return e},{})};C.prototype.exit=function(){this._destroyTemplateClones();t.unlink(this)};C.prototype.invalidate=function(t){if(t!==this.getTemplate()&&t!==this.getCreationTemplate()&&!e.isA(t,"sap.ui.table.ColumnMenu")){r.prototype.invalidate.apply(this,arguments)}};C.prototype.setLabel=function(t){let r=t;if(typeof t==="string"){if(m(this).bHasDefaultLabel){this.getLabel().setText(t);return this}r=e._getTableTemplateHelper().createLabel({text:t});m(this).bHasDefaultLabel=true}else if(m(this).bHasDefaultLabel){this.destroyLabel();m(this).bHasDefaultLabel=false}if(r&&r.setIsInColumnHeaderContext){r.setIsInColumnHeaderContext(true)}const n=this.getLabel();if(n&&r!==n&&n.setIsInColumnHeaderContext){n.setIsInColumnHeaderContext(false)}return this.setAggregation("label",r)};C.prototype.setTemplate=function(t){let r=t;const n=this._getTable();const i=this.getTemplate();let o=true;if(typeof t==="string"){if(m(this).bHasDefaulTemplate){this.getTemplate().bindProperty("text",t);o=false}else{r=e._getTableTemplateHelper().createTextView().bindProperty("text",t);m(this).bHasDefaulTemplate=true}}else if(m(this).bHasDefaulTemplate){this.destroyTemplate();m(this).bHasDefaulTemplate=false}if(o){this.setAggregation("template",r,true)}if(this.getVisible()){this.invalidate()}this._destroyTemplateClones("Standard");if(n&&this.getVisible()){if(r){n.invalidateRowsAggregation()}if(!i||!r){const e=n.getCreationRow();if(e){e._update()}}}return this};C.prototype.destroyTemplate=function(){this.destroyAggregation("template");this._destroyTemplateClones("Standard");const e=this._getTable();const t=e?e.getCreationRow():null;if(t){t._update()}return this};C.prototype.setCreationTemplate=function(e){const t=this._getTable();this.setAggregation("creationTemplate",e,true);this._destroyTemplateClones("Creation");if(e&&t&&this.getVisible()){const e=t.getCreationRow();if(e){e._update()}}return this};C.prototype.getCreationTemplate=function(){return this.getAggregation("creationTemplate")};C.prototype.destroyCreationTemplate=function(){this.destroyAggregation("creationTemplate",true);this._destroyTemplateClones("Creation");return this};C.prototype._menuHasItems=function(){const e=this._getTable();const t=(e?e.getEnableColumnFreeze():false)||(e?e.getShowColumnVisibilityMenu():false)||this.isSortableByMenu()||this.isFilterableByMenu()||this.isGroupableByMenu();return t};C.prototype.isFilterableByMenu=function(){return!!(this.getFilterProperty()&&this.getShowFilterMenuEntry())};C.prototype.isSortableByMenu=function(){return!!(this.getSortProperty()&&this.getShowSortMenuEntry())};C.prototype.isGroupableByMenu=function(){const e=this._getTable();return!!(e&&e.getEnableGrouping&&e.getEnableGrouping()&&this.getSortProperty())};C.prototype._isGroupableByMenu=function(){let e=false;e=this.isGroupableByMenu();return e};C.prototype.setSorted=function(e){if(e&&this.getSortOrder()===c.None&&!this.isBound("sortOrder")){this.setSortOrder(c.Ascending)}return this.setProperty("sorted",e)};C.prototype.setFilterValue=function(e){return this.setProperty("filterValue",e,true)};C.prototype.setFilterOperator=function(e){return this.setProperty("filterOperator",e,true)};C.prototype.setDefaultFilterOperator=function(e){return this.setProperty("defaultFilterOperator",e,true)};C.prototype._openHeaderMenu=function(e){const r=this.getHeaderMenuInstance();this._cellPressed=e;t.activateFor(this).then(function(){if(r){r.openBy(e)}})};C.prototype._isHeaderMenuOpen=function(){const e=this.getHeaderMenuInstance();return e?.isOpen()||false};C.prototype._setGrouped=function(e){const t=this._getTable();t.setGroupBy(e?this:null)};C.prototype._isAggregatableByMenu=function(){return false};C.prototype.toggleSort=function(){this.sort(this.getSorted()&&this.getSortOrder()===c.Ascending)};C.prototype.sort=function(e,t){this._sort(e?c.Descending:c.Ascending,t);return this};C.prototype._sort=function(e,t){const r=this._getTable();if(!r||this.getSortProperty()===""){return}const n=r.fireSort({column:this,sortOrder:e,columnAdded:e!==c.None&&t===true});if(!n){return}if(e===c.None){r._removeSortedColumn(this)}else{r.pushSortedColumn(this,t)}this.setSorted(e!==c.None);this.setSortOrder(e);this._updateSorters()};C.prototype._updateSorters=function(){const e=this._getTable();const t=e.getSortedColumns();const r=e.getColumns();const n=this.getSortOrder();for(let e=0,n=r.length;e<n;e++){if(t.indexOf(r[e])<0){r[e].resetProperty("sorted");r[e].resetProperty("sortOrder");delete m(r[e]).oSorter}}if(n!==c.None){m(this).oSorter=new s(this.getSortProperty(),n===c.Descending)}this._applySorters()};C.prototype._applySorters=function(){const e=this._getTable();const t=e.getBinding();if(!t){d.warning("Sorting not performed because no binding present",this);return}const r=e.getSortedColumns();const n=r.map(e=>m(e).oSorter);t.sort(n)};C.prototype._getFilterState=function(){try{this._getFilter();return h.None}catch(e){return h.Error}};C.prototype._getFilter=function(){let e;const t=this.getFilterProperty();const r=this.getFilterValue();let n=this.getFilterOperator();let l;let s;const a=this.getFilterType()||C._DEFAULT_FILTER_TYPE;const p=a instanceof u;let f;if(r){if(!n){f=r.match(/(.*)\s*\.\.\s*(.*)/);if(r.indexOf("=")===0){n=o.EQ;l=r.substr(1)}else if(r.indexOf("!=")===0){n=o.NE;l=r.substr(2)}else if(r.indexOf("<=")===0){n=o.LE;l=r.substr(2)}else if(r.indexOf("<")===0){n=o.LT;l=r.substr(1)}else if(r.indexOf(">=")===0){n=o.GE;l=r.substr(2)}else if(r.indexOf(">")===0){n=o.GT;l=r.substr(1)}else if(f){if(f[1]&&f[2]){n=o.BT;l=f[1];s=f[2]}else if(f[1]&&!f[2]){n=o.GE;l=f[1]}else{n=o.LE;l=f[2]}}else if(p&&r.indexOf("*")===0&&r.lastIndexOf("*")===r.length-1){n=o.Contains;l=r.substr(1,r.length-2)}else if(p&&r.indexOf("*")===0){n=o.EndsWith;l=r.substr(1)}else if(p&&r.lastIndexOf("*")===r.length-1){n=o.StartsWith;l=r.substr(0,r.length-1)}else{if(this.getDefaultFilterOperator()){n=this.getDefaultFilterOperator()}else if(p){n=o.Contains}else{n=o.EQ}l=r.substr(0)}if(!s){e=new i(t,n,this._parseFilterValue(l))}else{e=new i(t,n,this._parseFilterValue(l),this._parseFilterValue(s))}}else{e=new i(t,n,this._parseFilterValue(r))}}return e};C.prototype.filter=function(t){const r=this._getTable();if(!r?.getBinding()||this.getFilterProperty()===""){return}const n=r.fireFilter({column:this,value:t});if(!n){return}const i=[];const o=r.getColumns();this.setFiltered(!!t);this.setFilterValue(t);for(let t=0,r=o.length;t<r;t++){const r=o[t];let n;let l;try{n=r._getFilter();l=h.None}catch(e){l=h.Error}if(n){i.push(n)}e.Hook.call(this._getTable(),e.Hook.Keys.Column.SetFilterState,r,l)}r.getBinding().filter(i,l.Control)};C.prototype._parseFilterValue=function(e){const t=this.getFilterType();if(t){if(typeof t==="function"){e=t(e)}else{e=t.parseValue(e,"string")}}return e};C.prototype.shouldRender=function(){let e=this.getVisible()&&this.getTemplate()!=null;e=e&&!this.getGrouped();return e};C.prototype.setProperty=function(e,t){const n=this._getTable();const i=n&&this.getProperty(e)!==t;const o=i&&e==="visible";const l=i&&(e==="visible"||e==="headerSpan");const s=r.prototype.setProperty.apply(this,arguments);if(o){n.invalidateRowsAggregation();const e=n.getCreationRow();if(e){e._update()}}if(l){n._invalidateComputedFixedColumnCount()}return s};C.prototype.setFilterType=function(e){let t=e;if(typeof e==="string"){try{const r=f.parseJS(e);if(typeof r.type==="string"){let n=sap.ui.require(r.type.replaceAll(".","/"));if(!n){n=p.get(e)}t=n&&new n(r.formatOptions,r.constraints)}}catch(r){let n=sap.ui.require(e.replaceAll(".","/"));if(!n){n=p.get(e)}t=n&&new n}if(!(t instanceof a)){d.error("The filter type is not an instance of sap.ui.model.Type! Ignoring the filter type!");t=undefined}}this.setProperty("filterType",t,true);return this};C.prototype.getIndex=function(){const e=this._getTable();if(e){return e.indexOfColumn(this)}else{return-1}};C.prototype.isDragAllowed=function(t){return e.Column.isColumnMovable(this,true)};C.prototype._getFreeTemplateClone=function(e){const t=this._mTemplateClones[e];let r=null;if(!t){return null}for(let e=0;e<t.length;e++){if(!t[e]||t[e].bIsDestroyed){t.splice(e,1);e--}else if(!r&&!t[e].getParent()){r=t[e]}}return r};C.prototype.getTemplateClone=function(e,t){if(typeof e!=="number"||this.getTemplate()==null){return null}const r=t==null?"Standard":t;let n=this._getFreeTemplateClone(r);if(!n&&y.hasOwnProperty(r)){const e=this["get"+(r==="Standard"?"":r)+"Template"];const t=e.call(this);if(t){n=t.clone();if(!n.getFieldHelpDisplay()){n.setFieldHelpDisplay(this)}this._mTemplateClones[r].push(n)}}if(n){b.set(n,this);const e=this._getTable();if(e){e._getAccExtension().addColumnHeaderLabel(this,n)}}return n};function T(e){for(let t=0;t<e.length;t++){if(e[t]!=null&&!e[t].bIsDestroyed){e[t].destroy()}}}C.prototype._destroyTemplateClones=function(e){if(e==null){for(const e in y){T(this._mTemplateClones[e])}this._initTemplateClonePool()}else{T(this._mTemplateClones[e]);this._mTemplateClones[e]=[]}};C.prototype._getTable=function(){const t=this.getParent();return e.isA(t,"sap.ui.table.Table")?t:null};C.prototype._setCellContentVisibilitySettings=function(e){_(e);m(this).mCellContentVisibilitySettings=F(this,e)};C.prototype._getCellContentVisibilitySettings=function(){return m(this).mCellContentVisibilitySettings};C.prototype.getHeaderMenuInstance=function(){return r.getElementById(this.getHeaderMenu())};function _(e){if(e==null){return}S(e,null,false,["standard","groupHeader","summary"]);S(e.standard,"standard",true);S(e.groupHeader,"groupHeader",true,["nonExpandable","expanded","collapsed"]);S(e.summary,"summary",true,["group","total"])}function S(e,t,r,n){if(e!=null&&!(r&&typeof e==="boolean"||n&&typeof e==="object")){throw new Error("Invalid value"+(t?" for '"+t+"'":""))}if(n&&e!=null&&typeof e==="object"){Object.keys(e).forEach(function(r){if(n.includes(r)){if(t!=null){S(e[r],t+"."+r,true)}}else{throw new Error("Unsupported setting '"+(t?t+".":"")+r+"'")}})}}function F(e,t){t=t?t:{};return{standard:H(t.standard),groupHeader:{nonExpandable:H(t.groupHeader,"nonExpandable"),expanded:H(t.groupHeader,"expanded"),collapsed:H(t.groupHeader,"collapsed")},summary:{group:H(t.summary,"group"),total:H(t.summary,"total")}}}function H(e,t){if(typeof e==="boolean"){return e}else if(t&&e){return e[t]!==false}else{return true}}C.ofCell=function(e){return b.get(e)||null};C.prototype.autoResize=function(){if(!this.getDomRef()){throw new Error("Column is not rendered")}const t=this._getTable();const r=this.getWidth();const n=V(this);if(n+"px"!==r){e.Column.resizeColumn(t,this,n)}};function V(t){const r=t._getTable().getDomRef();const n=document.createElement("div");n.classList.add("sapUiTableHiddenSizeDetector","sapUiTableHeaderDataCell","sapUiTableDataCell");r.appendChild(n);const i=Array.from(r.querySelectorAll(`td[data-sap-ui-colid="${t.getId()}"]:not([colspan])`)).filter(e=>!e.classList.contains("sapUiTableHidden")).map(e=>e.firstElementChild.cloneNode(true));i.forEach(e=>{e.removeAttribute("id");n.appendChild(e)});let o=n.getBoundingClientRect().width+4;const l=r.querySelector(".sapUiTableCnt").getBoundingClientRect().width;o=Math.min(o,l);o=Math.max(o,e.Column.getMinColumnWidth());r.removeChild(n);return Math.round(o)}C.prototype.getFieldHelpInfo=function(){return{label:e.Column.getHeaderText(this)}};return C});
//# sourceMappingURL=Column.js.map