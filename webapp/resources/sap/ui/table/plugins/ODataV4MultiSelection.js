/*
 * OpenUI5
 * (c) Copyright 2025 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["./ODataV4Selection","./PluginBase","../utils/TableUtils","../library","sap/ui/core/Icon","sap/ui/core/IconPool"],function(e,t,i,n,o,s){"use strict";const l=i.createWeakMapFacade();const r=e.extend("sap.ui.table.plugins.ODataV4MultiSelection",{metadata:{library:"sap.ui.table",properties:{limit:{type:"int",group:"Behavior",defaultValue:200},enableNotification:{type:"boolean",group:"Behavior",defaultValue:false},hideHeaderSelector:{type:"boolean",group:"Appearance",defaultValue:false}},aggregations:{icon:{type:"sap.ui.core.Icon",multiple:false,visibility:"hidden"}}}});r.findOn=t.findOn;r.prototype.init=function(){e.prototype.init.apply(this,arguments);const t=new o({src:s.getIconURI(i.ThemeParameters.checkboxIcon),useIconTooltip:false});t.addStyleClass("sapUiTableSelectClear");this.setAggregation("icon",t,true);l(this).bLimitReached=false;l(this).oRangeSelectionStartContext=null};r.prototype.onActivate=function(t){e.prototype.onActivate.apply(this,arguments);t.setProperty("selectionMode",n.SelectionMode.MultiToggle);f(this,t.getBinding());i.Hook.register(t,i.Hook.Keys.Table.RowsBound,u,this);i.Hook.register(t,i.Hook.Keys.Table.UpdateRows,S,this);i.Hook.register(t,i.Hook.Keys.Table.UnbindRows,S,this)};r.prototype.onDeactivate=function(t){e.prototype.onDeactivate.apply(this,arguments);t.setProperty("selectionMode",n.SelectionMode.None);l(this).bLimitReached=false;l(this).oRangeSelectionStartContext=null;p(this,t.getBinding());i.Hook.deregister(t,i.Hook.Keys.Table.RowsBound,u,this);i.Hook.deregister(t,i.Hook.Keys.Table.UpdateRows,S,this);i.Hook.register(t,i.Hook.Keys.Table.UnbindRows,S,this);S.call(this)};r.prototype.setSelected=function(e,t,n){const o=i.getBindingContextOfRow(e);if(!this.isActive()||!o||!this.isContextSelectable(o)){return}if(n?.range){a(this,e);return}if(this.isSelected(e)===t){return}o.setSelected(t);l(this).oRangeSelectionStartContext=t?o:null};function a(e,t){if(!l(e).oRangeSelectionStartContext){return}let n=l(e).oRangeSelectionStartContext.getIndex();const o=i.getBindingContextOfRow(t);const s=o?o.getIndex():-1;if(n!==s){n+=s>n?1:-1}b(e,n,s)}function c(e){const t=e.getControl().getBinding();let i=-1;if(!t||t.getLength()===0){return 0}if(l(e).iSelectableCount!=null){return l(e).iSelectableCount}if(t.getAggregation()){if(e._isLimitDisabled()){const n=t.getAllCurrentContexts();if(t.getLength()===n.length){i=n.filter(t=>e.isContextSelectable(t)).length}}}else if(t.isLengthFinal()){i=t.getLength()}l(e).iSelectableCount=i;return i}function g(e){if(e._isLimitDisabled()){return}let t=s.getIconURI(i.ThemeParameters.checkboxIcon);if(e.getSelectedCount()>0){if(d(e)){t=s.getIconURI(i.ThemeParameters.allSelectedIcon)}else{t=s.getIconURI(i.ThemeParameters.clearSelectionIcon)}}e.getAggregation("icon").setSrc(t)}r.prototype.getRenderConfig=function(){if(!this.isActive()){return e.prototype.getRenderConfig.apply(this,arguments)}g(this);const t={headerSelector:{type:this._isLimitDisabled()?"toggle":"custom",icon:this.getAggregation("icon"),visible:!this.getHideHeaderSelector(),enabled:c(this)!==0,selected:d(this),tooltip:this.getSelectedCount()===0?i.getResourceText("TBL_SELECT_ALL"):i.getResourceText("TBL_DESELECT_ALL")}};return t};function h(e){if(d(e)){e.clearSelection();return false}else if(e._isLimitDisabled()){const t=e.getControl().getBinding();if(t?.getLength()){b(e,0,t.getLength()-1);return true}}return undefined}function d(e){const t=c(e);return t>0&&t===e.getSelectedCount()}r.prototype.onHeaderSelectorPress=function(){e.prototype.onHeaderSelectorPress.apply(this,arguments);if(!this.isActive()){return}const t=this.getRenderConfig();if(!t.headerSelector.visible||!t.headerSelector.enabled){return}if(t.headerSelector.type==="toggle"){h(this)}else if(t.headerSelector.type==="custom"){if(this.getSelectedCount()>0){this.clearSelection()}else{const e=this.getControl().getBinding();if(e?.getLength()>0){b(this,0,e.getLength()-1)}}}};r.prototype.onKeyboardShortcut=function(t,i){e.prototype.onKeyboardShortcut.apply(this,arguments);if(!this.isActive()){return}if(t==="toggle"){if(this._isLimitDisabled()){if(h(this)===false){i.setMarked("sapUiTableClearAll")}}else{const e=this.getControl().getBinding();if(e?.getLength()>0){b(this,0,e.getLength()-1)}}}};r.prototype.setLimit=function(e){this.setProperty("limit",e);l(this).bLimitReached=false;return this};function u(e){f(this,e)}function f(e,t){t?.attachEvent("selectionChanged",S,e)}function p(e,t){t?.detachEvent("selectionChanged",S,e)}function S(){delete l(this).aSelectedContexts;delete l(this).iSelectableCount}r.prototype._isLimitDisabled=function(){return this.getLimit()===0};function b(e,t,n){const o=e.getControl();const s=e.getLimit();const r=n<t;let a=r?n:t;let c=Math.abs(n-t)+1;if(!e._isLimitDisabled()){l(e).bLimitReached=c>s;if(l(e).bLimitReached){if(r){n=t-s+1;a=n}else{n=t+s-1}c=s+1}}i.loadContexts(o.getBinding(),a,c).then(function(t){t.forEach(function(t){if(!e.isContextSelectable(t)||t.isSelected()){return}if(r&&t.getIndex()>=n||t.getIndex()<=n){t.setSelected(true)}if(t.getIndex()===n){l(e).oRangeSelectionStartContext=t}});if(l(e).bLimitReached){i.scrollTableToIndex(o,n,r).then(function(){if(e.getEnableNotification()){i.showNotificationPopoverAtIndex(o,n,e.getLimit())}})}})}r.prototype.getSelectedContexts=function(){if(!this.isActive()){return[]}l(this).aSelectedContexts??=this.getControl().getBinding()?.getAllCurrentContexts().filter(e=>e.isSelected())??[];return l(this).aSelectedContexts};r.prototype.onThemeChanged=function(){g(this)};return r});
//# sourceMappingURL=ODataV4MultiSelection.js.map