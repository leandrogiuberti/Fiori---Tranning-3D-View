/*
 * OpenUI5
 * (c) Copyright 2025 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["./SelectionPlugin","./PluginBase","../utils/TableUtils"],function(e,t,i){"use strict";const n=i.createWeakMapFacade();const o=e.extend("sap.ui.table.plugins.ODataV4Selection",{metadata:{abstract:true,library:"sap.ui.table"}});o.findOn=t.findOn;o.prototype.onActivate=function(t){const n=t.getBinding();s(this,n);e.prototype.onActivate.apply(this,arguments);c(this,n);i.Hook.register(t,i.Hook.Keys.Table.RowsBound,a,this)};o.prototype.onDeactivate=function(t){e.prototype.onDeactivate.apply(this,arguments);clearTimeout(n(this).iSelectionChangeTimeout);delete n(this).iSelectionChangeTimeout;l(this,t.getBinding());i.Hook.deregister(t,i.Hook.Keys.Table.RowsBound,a,this)};o.prototype.isSelected=function(e){if(!this.isActive()){return false}return i.getBindingContextOfRow(e)?.isSelected()??false};o.prototype.getSelectedCount=function(){if(!this.isActive()){return 0}return this.getControl().getBinding()?.getSelectionCount()??0};o.prototype.clearSelection=function(){if(!this.isActive()){return}this.getControl().getBinding()?.getHeaderContext()?.setSelected(false)};o.prototype.getSelectedContexts=function(){if(!this.isActive()){return[]}return this.getControl().getBinding()?.getAllCurrentContexts().filter(e=>e.isSelected())??[]};o.prototype.onKeyboardShortcut=function(e,t){if(!this.isActive()){return}if(e==="clear"){this.clearSelection();t.setMarked("sapUiTableClearAll")}};o.prototype.isContextSelectable=function(e){const t=e.getBinding();const i=e===t.getHeaderContext();if(i){return false}const n=e.getProperty("@$ui5.node.isExpanded")===undefined;const o=e.getProperty("@$ui5.node.isTotal");const s="hierarchyQualifier"in(t.getAggregation()||{});return s||n&&!o};o.prototype.validateSelection=function(e){};function s(e,t){if(!t){return}if(!t.getModel().isA("sap.ui.model.odata.v4.ODataModel")){throw new Error("Model must be sap.ui.model.odata.v4.ODataModel")}r(e,t)}function r(e,t,i){const n=t.getHeaderContext();let o=[];if(i){o=i.isSelected()?[i]:[]}else{o=e.getSelectedContexts();if(n?.isSelected()){o.unshift(n)}}for(const t of o){if(!e.isContextSelectable(t)){throw new Error(`Context ${t} is not allowed to be selected`)}}e.validateSelection(o)}function a(e){s(this,e);c(this,e)}function c(e,t){t?.attachEvent("selectionChanged",u,e)}function l(e,t){t?.detachEvent("selectionChanged",u,e)}function u(e){const t=e.getParameter("context");try{r(this,t.getBinding(),t)}catch(e){t.setSelected(false);throw e}if(n(this).iSelectionChangeTimeout){return}n(this).iSelectionChangeTimeout=setTimeout(()=>{this.fireSelectionChange();delete n(this).iSelectionChangeTimeout},0)}return o});
//# sourceMappingURL=ODataV4Selection.js.map