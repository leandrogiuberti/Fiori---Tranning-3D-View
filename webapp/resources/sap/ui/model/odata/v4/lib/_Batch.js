/*!
 * OpenUI5
 * (c) Copyright 2025 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["./_Helper","sap/base/strings/escapeRegExp"],function(e,n){"use strict";var t={POST:true,PUT:true,PATCH:true,DELETE:true},r=/^\$-?(\d+)/,i=/(\S*?)=(?:"(.+)"|(\S+))/;function o(e){var t=s(e,"boundary"),r=e.trim().indexOf("multipart/mixed");if(r!==0||!t){throw new Error('Invalid $batch response header "Content-Type": '+e)}t=n(t);return new RegExp("--"+t+"(?:[ \t]*\r\n|--)")}function s(e,n){var t,r=e.split(";"),o;n=n.toLowerCase();for(t=1;t<r.length;t+=1){o=i.exec(r[t]);if(o[1].toLowerCase()===n){return o[2]||o[3]}}}function a(e){var n=c(e,"content-type");return n.startsWith("multipart/mixed;")?n:undefined}function u(e){var n=c(e,"content-id"),t;if(!n){throw new Error("Content-ID MIME header missing for the change set response.")}t=parseInt(n);if(isNaN(t)){throw new Error("Invalid Content-ID value in change set response.")}return t}function c(e,n){var t,r=e.split("\r\n"),i;for(i=0;i<r.length;i+=1){t=r[i].split(":");if(t[0].toLowerCase().trim()===n){return t[1].trim()}}}function f(e,n,t){var r=n.split(o(e)),i=[];r=r.slice(1,-1);r.forEach(function(e){var n,r,o,c,d,h,p,l,y,m,C,T,E={},w,v;T=e.indexOf("\r\n\r\n");C=e.slice(0,T);y=e.indexOf("\r\n\r\n",T+4);l=e.slice(T+4,y);n=a(C);if(n){i.push(f(n,e.slice(T+4),true));return}p=l.split("\r\n");m=p[0].split(" ");E.status=parseInt(m[1]);E.statusText=m.slice(2).join(" ");E.headers={};for(v=1;v<p.length;v+=1){c=p[v];o=c.indexOf(":");d=c.slice(0,o).trim();h=c.slice(o+1).trim();E.headers[d]=h;if(d.toLowerCase()==="content-type"){r=s(h,"charset");if(r&&r.toLowerCase()!=="utf-8"){throw new Error('Unsupported "Content-Type" charset: '+r)}}}E.responseText=e.slice(y+4,-2);if(t){w=u(C);i[w]=E}else{i.push(E)}});return i}function d(e){var n,t=[];for(n in e){t.push(n,":",e[n],"\r\n")}return t}function h(n,i,o,s){var a=(i!==undefined?"changeset_":"batch_")+e.uid(),u=i!==undefined,c=[];if(u){c.push("Content-Type: multipart/mixed;boundary=",a,"\r\n\r\n")}n.forEach(function(n,o){var f="",p=n.url;if(u){n.$ContentID=o+"."+i;f="Content-ID:"+n.$ContentID+"\r\n"}c.push("--",a,"\r\n");if(Array.isArray(n)){if(u){throw new Error("Change set must not contain a nested change set.")}c=c.concat(h(n,o,"",s).body)}else{if(u&&!t[n.method]){throw new Error("Invalid HTTP request method: "+n.method+". Change set must contain only POST, PUT, PATCH, or DELETE requests.")}if(i!==undefined&&p[0]==="$"){const e=r.exec(p);if(e){const n=p.startsWith("$-")?o-parseInt(e[1]):e[1];p=p.replace(e[0],"$"+n+"."+i)}}c=c.concat("Content-Type:application/http\r\n","Content-Transfer-Encoding:binary\r\n",f,"\r\n",n.method," ",p," HTTP/1.1\r\n",d(e.resolveIfMatchHeader(n.headers,s)),"\r\n",JSON.stringify(n.body)||"","\r\n")}});c.push("--",a,"--\r\n",o);return{body:c,batchBoundary:a}}return{deserializeBatchResponse:function(e,n){return f(e,n,false)},serializeBatchRequest:function(e,n,t){var r=h(e,undefined,n,t);return{body:r.body.join(""),headers:{"Content-Type":"multipart/mixed; boundary="+r.batchBoundary,"MIME-Version":"1.0"}}}}},false);
//# sourceMappingURL=_Batch.js.map