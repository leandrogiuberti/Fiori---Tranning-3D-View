"use strict";var event=require("../lib/event");var UA=require("../lib/useragent");var ace=require("../ace");module.exports=exports=ace;var getCSSProperty=function(e,t,i){var r=e.style[i];if(!r){if(window.getComputedStyle){r=window.getComputedStyle(e,"").getPropertyValue(i)}else{r=e.currentStyle[i]}}if(!r||r=="auto"||r=="intrinsic"){r=t.style[i]}return r};function applyStyles(e,t){for(var i in t){e.style[i]=t[i]}}function setupContainer(e,t){if(e.type!="textarea"){throw new Error("Textarea required!")}var i=e.parentNode;var r=document.createElement("div");var n=function(){var t="position:relative;";["margin-top","margin-left","margin-right","margin-bottom"].forEach(function(i){t+=i+":"+getCSSProperty(e,r,i)+";"});var i=getCSSProperty(e,r,"width")||e.clientWidth+"px";var n=getCSSProperty(e,r,"height")||e.clientHeight+"px";t+="height:"+n+";width:"+i+";";t+="display:inline-block;";r.style.cssText=t};event.addListener(window,"resize",n);n();i.insertBefore(r,e.nextSibling);while(i!==document){if(i.tagName.toUpperCase()==="FORM"){var a=i.onsubmit;i.onsubmit=function(i){e.value=t();if(a){a.call(this,i)}};break}i=i.parentNode}return r}exports.transformTextarea=function(e,t){var i=e.autofocus||document.activeElement==e;var r;var n=setupContainer(e,function(){return r.getValue()});e.style.display="none";n.style.background="white";var a=document.createElement("div");applyStyles(a,{top:"0px",left:"0px",right:"0px",bottom:"0px",border:"1px solid gray",position:"absolute"});n.appendChild(a);var o=document.createElement("div");applyStyles(o,{position:"absolute",right:"0px",bottom:"0px",cursor:"nw-resize",border:"solid 9px",borderColor:"lightblue gray gray #ceade6",zIndex:101});var s=document.createElement("div");var l={top:"0px",left:"20%",right:"0px",bottom:"0px",position:"absolute",padding:"5px",zIndex:100,color:"white",display:"none",overflow:"auto",fontSize:"14px",boxShadow:"-5px 2px 3px gray"};if(!UA.isOldIE){l.backgroundColor="rgba(0, 0, 0, 0.6)"}else{l.backgroundColor="#333"}applyStyles(s,l);n.appendChild(s);t=t||exports.defaultOptions;var p=ace.edit(a);r=p.getSession();r.setValue(e.value||e.innerHTML);if(i)p.focus();n.appendChild(o);setupApi(p,a,s,ace,t);setupSettingPanel(s,o,p);var u="";event.addListener(o,"mousemove",function(e){var t=this.getBoundingClientRect();var i=e.clientX-t.left,r=e.clientY-t.top;if(i+r<(t.width+t.height)/2){this.style.cursor="pointer";u="toggle"}else{u="resize";this.style.cursor="nw-resize"}});event.addListener(o,"mousedown",function(e){e.preventDefault();if(u=="toggle"){p.setDisplaySettings();return}n.style.zIndex=1e5;var t=n.getBoundingClientRect();var i=t.width+t.left-e.clientX;var r=t.height+t.top-e.clientY;event.capture(o,function(e){n.style.width=e.clientX-t.left+i+"px";n.style.height=e.clientY-t.top+r+"px";p.resize()},function(){})});return p};function setupApi(e,t,i,r,n){function a(e){return e==="true"||e==true}e.setDisplaySettings=function(t){if(t==null)t=i.style.display=="none";if(t){i.style.display="block";i.hideButton.focus();e.on("focus",function t(){e.removeListener("focus",t);i.style.display="none"})}else{e.focus()}};e.$setOption=e.setOption;e.$getOption=e.getOption;e.setOption=function(t,i){switch(t){case"mode":e.$setOption("mode","ace/mode/"+i);break;case"theme":e.$setOption("theme","ace/theme/"+i);break;case"keybindings":switch(i){case"vim":e.setKeyboardHandler("ace/keyboard/vim");break;case"emacs":e.setKeyboardHandler("ace/keyboard/emacs");break;default:e.setKeyboardHandler(null)}break;case"wrap":case"fontSize":e.$setOption(t,i);break;default:e.$setOption(t,a(i))}};e.getOption=function(t){switch(t){case"mode":return e.$getOption("mode").substr("ace/mode/".length);break;case"theme":return e.$getOption("theme").substr("ace/theme/".length);break;case"keybindings":var i=e.getKeyboardHandler();switch(i&&i.$id){case"ace/keyboard/vim":return"vim";case"ace/keyboard/emacs":return"emacs";default:return"ace"}break;default:return e.$getOption(t)}};e.setOptions(n);return e}function setupSettingPanel(e,t,i){var r=null;var n={mode:"Mode:",wrap:"Soft Wrap:",theme:"Theme:",fontSize:"Font Size:",showGutter:"Display Gutter:",keybindings:"Keyboard",showPrintMargin:"Show Print Margin:",useSoftTabs:"Use Soft Tabs:",showInvisibles:"Show Invisibles"};var a={mode:{text:"Plain",javascript:"JavaScript",xml:"XML",html:"HTML",css:"CSS",scss:"SCSS",python:"Python",php:"PHP",java:"Java",ruby:"Ruby",c_cpp:"C/C++",coffee:"CoffeeScript",json:"json",perl:"Perl",clojure:"Clojure",ocaml:"OCaml",csharp:"C#",haxe:"haXe",svg:"SVG",textile:"Textile",groovy:"Groovy",liquid:"Liquid",Scala:"Scala"},theme:{clouds:"Clouds",clouds_midnight:"Clouds Midnight",cobalt:"Cobalt",crimson_editor:"Crimson Editor",dawn:"Dawn",gob:"Green on Black",eclipse:"Eclipse",idle_fingers:"Idle Fingers",kr_theme:"Kr Theme",merbivore:"Merbivore",merbivore_soft:"Merbivore Soft",mono_industrial:"Mono Industrial",monokai:"Monokai",pastel_on_dark:"Pastel On Dark",solarized_dark:"Solarized Dark",solarized_light:"Solarized Light",textmate:"Textmate",twilight:"Twilight",vibrant_ink:"Vibrant Ink"},showGutter:r,fontSize:{"10px":"10px","11px":"11px","12px":"12px","14px":"14px","16px":"16px"},wrap:{off:"Off",40:"40",80:"80",free:"Free"},keybindings:{ace:"ace",vim:"vim",emacs:"emacs"},showPrintMargin:r,useSoftTabs:r,showInvisibles:r};var o=[];o.push("<table><tr><th>Setting</th><th>Value</th></tr>");function s(e,t,i,r){if(!i){e.push("<input type='checkbox' title='",t,"' ",r+""=="true"?"checked='true'":"","'></input>");return}e.push("<select title='"+t+"'>");for(var n in i){e.push("<option value='"+n+"' ");if(r==n){e.push(" selected ")}e.push(">",i[n],"</option>")}e.push("</select>")}for(var l in exports.defaultOptions){o.push("<tr><td>",n[l],"</td>");o.push("<td>");s(o,l,a[l],i.getOption(l));o.push("</td></tr>")}o.push("</table>");e.innerHTML=o.join("");var p=function(e){var t=e.currentTarget;i.setOption(t.title,t.value)};var u=function(e){var t=e.currentTarget;i.setOption(t.title,t.checked)};var c=e.getElementsByTagName("select");for(var d=0;d<c.length;d++)c[d].onchange=p;var h=e.getElementsByTagName("input");for(var d=0;d<h.length;d++)h[d].onclick=u;var f=document.createElement("input");f.type="button";f.value="Hide";event.addListener(f,"click",function(){i.setDisplaySettings(false)});e.appendChild(f);e.hideButton=f}exports.defaultOptions={mode:"javascript",theme:"textmate",wrap:"off",fontSize:"12px",showGutter:"false",keybindings:"ace",showPrintMargin:"false",useSoftTabs:"true",showInvisibles:"false"};
//# sourceMappingURL=ext-textarea.js.map