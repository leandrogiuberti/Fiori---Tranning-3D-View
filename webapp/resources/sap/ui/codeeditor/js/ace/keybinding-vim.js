ace.define("ace/ext/hardwrap",["require","exports","module","ace/range","ace/editor","ace/config"],function(e,t,r){"use strict";var n=e("../range").Range;function i(e,t){var r=t.column||e.getOption("printMarginColumn");var i=t.allowMerge!=false;var a=Math.min(t.startRow,t.endRow);var o=Math.max(t.startRow,t.endRow);var s=e.session;while(a<=o){var l=s.getLine(a);if(l.length>r){var c=m(l,r,5);if(c){var u=/^\s*/.exec(l)[0];s.replace(new n(a,c.start,a,c.end),"\n"+u)}o++}else if(i&&/\S/.test(l)&&a!=o){var f=s.getLine(a+1);if(f&&/\S/.test(f)){var h=l.replace(/\s+$/,"");var d=f.replace(/^\s+/,"");var p=h+" "+d;var c=m(p,r,5);if(c&&c.start>h.length||p.length<r){var v=new n(a,h.length,a+1,f.length-d.length);s.replace(v," ");a--;o--}else if(h.length<l.length){s.remove(new n(a,h.length,a,l.length))}}}a++}function m(e,t,r){if(e.length<t)return;var n=e.slice(0,t);var i=e.slice(t);var a=/^(?:(\s+)|(\S+)(\s+))/.exec(i);var o=/(?:(\s+)|(\s+)(\S+))$/.exec(n);var s=0;var l=0;if(o&&!o[2]){s=t-o[1].length;l=t}if(a&&!a[2]){if(!s)s=t;l=t+a[1].length}if(s){return{start:s,end:l}}if(o&&o[2]&&o.index>r){return{start:o.index,end:o.index+o[2].length}}if(a&&a[2]){s=t+a[2].length;return{start:s,end:s+a[3].length}}}}function a(e){if(e.command.name=="insertstring"&&/\S/.test(e.args)){var t=e.editor;var r=t.selection.cursor;if(r.column<=t.renderer.$printMarginColumn)return;var n=t.session.$undoManager.$lastDelta;i(t,{startRow:r.row,endRow:r.row,allowMerge:false});if(n!=t.session.$undoManager.$lastDelta)t.session.markUndoGroup()}}var o=e("../editor").Editor;e("../config").defineOptions(o.prototype,"editor",{hardWrap:{set:function(e){if(e){this.commands.on("afterExec",a)}else{this.commands.off("afterExec",a)}},value:false}});t.hardWrap=i});ace.define("ace/keyboard/vim",["require","exports","module","ace/range","ace/lib/event_emitter","ace/lib/dom","ace/lib/oop","ace/lib/keys","ace/lib/event","ace/search","ace/lib/useragent","ace/search_highlight","ace/commands/multi_select_commands","ace/mode/text","ace/ext/hardwrap","ace/multi_select"],function(e,t,r){// CodeMirror, copyright (c) by Marijn Haverbeke and others
"use strict";function n(){var e="";function t(e){if(typeof e!="object")return e+"";if("line"in e){return e.line+":"+e.ch}if("anchor"in e){return t(e.anchor)+"->"+t(e.head)}if(Array.isArray(e))return"["+e.map(function(e){return t(e)})+"]";return JSON.stringify(e)}for(var r=0;r<arguments.length;r++){var n=arguments[r];var i=t(n);e+=i+"  "}console.log(e)}var i=e("../range").Range;var a=e("../lib/event_emitter").EventEmitter;var o=e("../lib/dom");var s=e("../lib/oop");var l=e("../lib/keys");var c=e("../lib/event");var u=e("../search").Search;var f=e("../lib/useragent");var h=e("../search_highlight").SearchHighlight;var d=e("../commands/multi_select_commands");var p=e("../mode/text").Mode.prototype.tokenRe;var v=e("../ext/hardwrap").hardWrap;e("../multi_select");var m=function(e){this.ace=e;this.state={};this.marks={};this.options={};this.$uid=0;this.onChange=this.onChange.bind(this);this.onSelectionChange=this.onSelectionChange.bind(this);this.onBeforeEndOperation=this.onBeforeEndOperation.bind(this);this.ace.on("change",this.onChange);this.ace.on("changeSelection",this.onSelectionChange);this.ace.on("beforeEndOperation",this.onBeforeEndOperation)};m.Pos=function(e,t){if(!(this instanceof C))return new C(e,t);this.line=e;this.ch=t};m.defineOption=function(e,t,r){};m.commands={redo:function(e){e.ace.redo()},undo:function(e){e.ace.undo()},newlineAndIndent:function(e){e.ace.insert("\n")},goLineLeft:function(e){e.ace.selection.moveCursorLineStart()},goLineRight:function(e){e.ace.selection.moveCursorLineEnd()}};m.keyMap={};m.addClass=m.rmClass=function(){};m.e_stop=m.e_preventDefault=c.stopEvent;m.keyName=function(e){var t=l[e.keyCode]||e.key||"";if(t.length==1)t=t.toUpperCase();t=c.getModifierString(e).replace(/(^|-)\w/g,function(e){return e.toUpperCase()})+t;return t};m.keyMap["default"]=function(e){return function(t){var r=t.ace.commands.commandKeyBinding[e.toLowerCase()];return r&&t.ace.execCommand(r)!==false}};m.lookupKey=function e(t,r,n){if(!r)r="default";if(typeof r=="string")r=m.keyMap[r]||m.keyMap["default"];var i=typeof r=="function"?r(t):r[t];if(i===false)return"nothing";if(i==="...")return"multi";if(i!=null&&n(i))return"handled";if(r.fallthrough){if(!Array.isArray(r.fallthrough))return e(t,r.fallthrough,n);for(var a=0;a<r.fallthrough.length;a++){var o=e(t,r.fallthrough[a],n);if(o)return o}}};m.findMatchingTag=function(e,t){return e.findMatchingTag(t)};m.findEnclosingTag=function(e,t){};m.signal=function(e,t,r){return e._signal(t,r)};m.on=c.addListener;m.off=c.removeListener;m.isWordChar=function(e){if(e<"")return/^\w$/.test(e);p.lastIndex=0;return p.test(e)};(function(){s.implement(m.prototype,a);this.destroy=function(){this.ace.off("change",this.onChange);this.ace.off("changeSelection",this.onSelectionChange);this.ace.off("beforeEndOperation",this.onBeforeEndOperation);this.removeOverlay()};this.virtualSelectionMode=function(){return this.ace.inVirtualSelectionMode&&this.ace.selection.index};this.onChange=function(e){if(this.$lineHandleChanges){this.$lineHandleChanges.push(e)}var t={text:e.action[0]=="i"?e.lines:[]};var r=this.curOp=this.curOp||{};if(!r.changeHandlers)r.changeHandlers=this._eventRegistry["change"]&&this._eventRegistry["change"].slice();if(!r.lastChange){r.lastChange=r.change=t}else{r.lastChange.next=r.lastChange=t}this.$updateMarkers(e)};this.onSelectionChange=function(){var e=this.curOp=this.curOp||{};if(!e.cursorActivityHandlers)e.cursorActivityHandlers=this._eventRegistry["cursorActivity"]&&this._eventRegistry["cursorActivity"].slice();this.curOp.cursorActivity=true;if(this.ace.inMultiSelectMode){this.ace.keyBinding.removeKeyboardHandler(d.keyboardHandler)}};this.operation=function(e,t){if(!t&&this.curOp||t&&this.curOp&&this.curOp.force){return e()}if(t||!this.ace.curOp){if(this.curOp)this.onBeforeEndOperation()}if(!this.ace.curOp){var r=this.ace.prevOp;this.ace.startOperation({command:{name:"vim",scrollIntoView:"cursor"}})}var n=this.curOp=this.curOp||{};this.curOp.force=t;var i=e();if(this.ace.curOp&&this.ace.curOp.command.name=="vim"){if(this.state.dialog)this.ace.curOp.command.scrollIntoView=this.ace.curOp.vimDialogScroll;this.ace.endOperation();if(!n.cursorActivity&&!n.lastChange&&r)this.ace.prevOp=r}if(t||!this.ace.curOp){if(this.curOp)this.onBeforeEndOperation()}return i};this.onBeforeEndOperation=function(){var e=this.curOp;if(e){if(e.change){this.signal("change",e.change,e)}if(e&&e.cursorActivity){this.signal("cursorActivity",null,e)}this.curOp=null}};this.signal=function(e,t,r){var n=r?r[e+"Handlers"]:(this._eventRegistry||{})[e];if(!n)return;n=n.slice();for(var i=0;i<n.length;i++)n[i](this,t)};this.firstLine=function(){return 0};this.lastLine=function(){return this.ace.session.getLength()-1};this.lineCount=function(){return this.ace.session.getLength()};this.setCursor=function(e,t){if(typeof e==="object"){t=e.ch;e=e.line}var r=!this.curOp&&!this.ace.inVirtualSelectionMode;if(!this.ace.inVirtualSelectionMode)this.ace.exitMultiSelectMode();this.ace.session.unfold({row:e,column:t});this.ace.selection.moveTo(e,t);if(r){this.ace.renderer.scrollCursorIntoView();this.ace.endOperation()}};this.getCursor=function(e){var t=this.ace.selection;var r=e=="anchor"?t.isEmpty()?t.lead:t.anchor:e=="head"||!e?t.lead:t.getRange()[e];return y(r)};this.listSelections=function(e){var t=this.ace.multiSelect.rangeList.ranges;if(!t.length||this.ace.inVirtualSelectionMode)return[{anchor:this.getCursor("anchor"),head:this.getCursor("head")}];return t.map(function(e){return{anchor:this.clipPos(y(e.cursor==e.end?e.start:e.end)),head:this.clipPos(y(e.cursor))}},this)};this.setSelections=function(e,t){var r=this.ace.multiSelect;var n=e.map(function(e){var t=g(e.anchor);var r=g(e.head);var n=i.comparePoints(t,r)<0?new i.fromPoints(t,r):new i.fromPoints(r,t);n.cursor=i.comparePoints(n.start,r)?n.end:n.start;return n});if(this.ace.inVirtualSelectionMode){this.ace.selection.fromOrientedRange(n[0]);return}if(!t){n=n.reverse()}else if(n[t]){n.push(n.splice(t,1)[0])}r.toSingleRange(n[0].clone());var a=this.ace.session;for(var o=0;o<n.length;o++){var s=a.$clipRangeToDocument(n[o]);r.addRange(s)}};this.setSelection=function(e,t,r){var n=this.ace.selection;n.moveTo(e.line,e.ch);n.selectTo(t.line,t.ch);if(r&&r.origin=="*mouse"){this.onBeforeEndOperation()}};this.somethingSelected=function(e){return!this.ace.selection.isEmpty()};this.clipPos=function(e){var t=this.ace.session.$clipPositionToDocument(e.line,e.ch);return y(t)};this.foldCode=function(e){this.ace.session.$toggleFoldWidget(e.line,{})};this.markText=function(e){return{clear:function(){},find:function(){}}};this.$updateMarkers=function(e){var t=e.action=="insert";var r=e.start;var n=e.end;var a=(n.row-r.row)*(t?1:-1);var o=(n.column-r.column)*(t?1:-1);if(t)n=r;for(var s in this.marks){var l=this.marks[s];var c=i.comparePoints(l,r);if(c<0){continue}if(c===0){if(t){if(!l.$insertRight){c=1}else if(l.bias==1){c=1}else{l.bias=-1;continue}}}var u=t?c:i.comparePoints(l,n);if(u>0){l.row+=a;l.column+=l.row==n.row?o:0;continue}if(!t&&u<=0){l.row=r.row;l.column=r.column;if(u===0)l.bias=1}}};var e=function(e,t,r,n){this.cm=e;this.id=t;this.row=r;this.column=n;e.marks[this.id]=this};e.prototype.clear=function(){delete this.cm.marks[this.id]};e.prototype.find=function(){return y(this)};this.setBookmark=function(t,r){var n=new e(this,this.$uid++,t.line,t.ch);if(!r||!r.insertLeft)n.$insertRight=true;this.marks[n.id]=n;return n};this.moveH=function(e,t){if(t=="char"){var r=this.ace.selection;r.clearSelection();r.moveCursorBy(0,e)}};this.findPosV=function(e,t,r,n){if(r=="page"){var i=this.ace.renderer;var a=i.layerConfig;t=t*Math.floor(a.height/a.lineHeight);r="line"}if(r=="line"){var o=this.ace.session.documentToScreenPosition(e.line,e.ch);if(n!=null)o.column=n;o.row+=t;o.row=Math.min(Math.max(0,o.row),this.ace.session.getScreenLength()-1);var s=this.ace.session.screenToDocumentPosition(o.row,o.column);return y(s)}else{debugger}};this.charCoords=function(e,t){if(t=="div"||!t){var r=this.ace.session.documentToScreenPosition(e.line,e.ch);return{left:r.column,top:r.row}}if(t=="local"){var n=this.ace.renderer;var r=this.ace.session.documentToScreenPosition(e.line,e.ch);var i=n.layerConfig.lineHeight;var a=n.layerConfig.characterWidth;var o=i*r.row;return{left:r.column*a,top:o,bottom:o+i}}};this.coordsChar=function(e,t){var r=this.ace.renderer;if(t=="local"){var n=Math.max(0,Math.floor(e.top/r.lineHeight));var i=Math.max(0,Math.floor(e.left/r.characterWidth));var a=r.session.screenToDocumentPosition(n,i);return y(a)}else if(t=="div"){throw"not implemented"}};this.getSearchCursor=function(e,t,r){var n=false;var i=false;if(e instanceof RegExp&&!e.global){n=!e.ignoreCase;e=e.source;i=true}if(e=="\\n"){e="\n";i=false}var a=new u;if(t.ch==undefined)t.ch=Number.MAX_VALUE;var o={row:t.line,column:t.ch};var s=this;var l=null;return{findNext:function(){return this.find(false)},findPrevious:function(){return this.find(true)},find:function(t){a.setOptions({needle:e,caseSensitive:n,wrap:false,backwards:t,regExp:i,start:l||o});var r=a.find(s.ace.session);l=r;return l&&[!l.isEmpty()]},from:function(){return l&&y(l.start)},to:function(){return l&&y(l.end)},replace:function(e){if(l){l.end=s.ace.session.doc.replace(l,e)}}}};this.scrollTo=function(e,t){var r=this.ace.renderer;var n=r.layerConfig;var i=n.maxHeight;i-=(r.$size.scrollerHeight-r.lineHeight)*r.$scrollPastEnd;if(t!=null)this.ace.session.setScrollTop(Math.max(0,Math.min(t,i)));if(e!=null)this.ace.session.setScrollLeft(Math.max(0,Math.min(e,n.width)))};this.scrollInfo=function(){return 0};this.scrollIntoView=function(e,t){if(e){var r=this.ace.renderer;var n={top:0,bottom:t};r.scrollCursorIntoView(g(e),r.lineHeight*2/r.$size.scrollerHeight,n)}};this.getLine=function(e){return this.ace.session.getLine(e)};this.getRange=function(e,t){return this.ace.session.getTextRange(new i(e.line,e.ch,t.line,t.ch))};this.replaceRange=function(e,t,r){if(!r)r=t;var n=new i(t.line,t.ch,r.line,r.ch);this.ace.session.$clipRangeToDocument(n);return this.ace.session.replace(n,e)};this.replaceSelection=this.replaceSelections=function(e){var t=Array.isArray(e)&&e;var r=this.ace.selection;if(this.ace.inVirtualSelectionMode){this.ace.session.replace(r.getRange(),t?e[0]||"":e);return}r.inVirtualSelectionMode=true;var n=r.rangeList.ranges;if(!n.length)n=[this.ace.multiSelect.getRange()];for(var i=n.length;i--;)this.ace.session.replace(n[i],t?e[i]||"":e);r.inVirtualSelectionMode=false};this.getSelection=function(){return this.ace.getSelectedText()};this.getSelections=function(){return this.listSelections().map(function(e){return this.getRange(e.anchor,e.head)},this)};this.getInputField=function(){return this.ace.textInput.getElement()};this.getWrapperElement=function(){return this.ace.container};var t={indentWithTabs:"useSoftTabs",indentUnit:"tabSize",tabSize:"tabSize",firstLineNumber:"firstLineNumber",readOnly:"readOnly"};this.setOption=function(e,r){this.state[e]=r;switch(e){case"indentWithTabs":e=t[e];r=!r;break;case"keyMap":this.state.$keyMap=r;return;break;default:e=t[e]}if(e)this.ace.setOption(e,r)};this.getOption=function(e){var r;var n=t[e];if(n)r=this.ace.getOption(n);switch(e){case"indentWithTabs":e=t[e];return!r;case"keyMap":return this.state.$keyMap||"vim"}return n?r:this.state[e]};this.toggleOverwrite=function(e){this.state.overwrite=e;return this.ace.setOverwrite(e)};this.addOverlay=function(e){if(!this.$searchHighlight||!this.$searchHighlight.session){var t=new h(null,"ace_highlight-marker","text");var r=this.ace.session.addDynamicMarker(t);t.id=r.id;t.session=this.ace.session;t.destroy=function(e){t.session.off("change",t.updateOnChange);t.session.off("changeEditor",t.destroy);t.session.removeMarker(t.id);t.session=null};t.updateOnChange=function(e){var r=e.start.row;if(r==e.end.row)t.cache[r]=undefined;else t.cache.splice(r,t.cache.length)};t.session.on("changeEditor",t.destroy);t.session.on("change",t.updateOnChange)}var n=new RegExp(e.query.source,"gmi");this.$searchHighlight=e.highlight=t;this.$searchHighlight.setRegexp(n);this.ace.renderer.updateBackMarkers()};this.removeOverlay=function(e){if(this.$searchHighlight&&this.$searchHighlight.session){this.$searchHighlight.destroy()}};this.getScrollInfo=function(){var e=this.ace.renderer;var t=e.layerConfig;return{left:e.scrollLeft,top:e.scrollTop,height:t.maxHeight,width:t.width,clientHeight:t.height,clientWidth:t.width}};this.getValue=function(){return this.ace.getValue()};this.setValue=function(e){return this.ace.setValue(e,-1)};this.getTokenTypeAt=function(e){var t=this.ace.session.getTokenAt(e.line,e.ch);return t&&/comment|string/.test(t.type)?"string":""};this.findMatchingBracket=function(e){var t=this.ace.session.findMatchingBracket(g(e));return{to:t&&y(t)}};this.findMatchingTag=function(e){var t=this.ace.session.getMatchingTags(g(e));if(!t)return;return{open:{from:y(t.openTag.start),to:y(t.openTag.end)},close:{from:y(t.closeTag.start),to:y(t.closeTag.end)}}};this.indentLine=function(e,t){if(t===true)this.ace.session.indentRows(e,e,"\t");else if(t===false)this.ace.session.outdentRows(new i(e,0,e,0))};this.indexFromPos=function(e){return this.ace.session.doc.positionToIndex(g(e))};this.posFromIndex=function(e){return y(this.ace.session.doc.indexToPosition(e))};this.focus=function(e){return this.ace.textInput.focus()};this.blur=function(e){return this.ace.blur()};this.defaultTextHeight=function(e){return this.ace.renderer.layerConfig.lineHeight};this.scanForBracket=function(e,t,r,n){var i=n.bracketRegex.source;var a=/paren|text|operator|tag/;if(t==1){var o=this.ace.session.$findClosingBracket(i.slice(1,2),g(e),a)}else{var o=this.ace.session.$findOpeningBracket(i.slice(-2,-1),{row:e.line,column:e.ch+1},a);if(!o&&n.bracketRegex&&n.bracketRegex.test(this.getLine(e.line)[e.ch-1])){o={row:e.line,column:e.ch-1}}}return o&&{pos:y(o)}};this.refresh=function(){return this.ace.resize(true)};this.getMode=function(){return{name:this.getOption("mode")}};this.execCommand=function(e){if(m.commands.hasOwnProperty(e))return m.commands[e](this);if(e=="indentAuto")return this.ace.execCommand("autoindent");console.log(e+" is not implemented")};this.getLineNumber=function(e){var t=this.$lineHandleChanges;if(!t)return null;var r=e.row;for(var n=0;n<t.length;n++){var i=t[n];if(i.start.row!=i.end.row){if(i.action[0]=="i"){if(i.start.row<r)r+=i.end.row-i.start.row}else{if(i.start.row<r){if(r<i.end.row||r==i.end.row&&i.start.column>0){return null}r-=i.end.row-i.start.row}}}}return r};this.getLineHandle=function(e){if(!this.$lineHandleChanges)this.$lineHandleChanges=[];return{text:this.ace.session.getLine(e),row:e}};this.releaseLineHandles=function(){this.$lineHandleChanges=undefined};this.getLastEditEnd=function(){var e=this.ace.session.$undoManager;if(e&&e.$lastDelta)return y(e.$lastDelta.end)}}).call(m.prototype);function g(e){return{row:e.line,column:e.ch}}function y(e){return new C(e.row,e.column)}var w=m.StringStream=function(e,t){this.pos=this.start=0;this.string=e;this.tabSize=t||8;this.lastColumnPos=this.lastColumnValue=0;this.lineStart=0};w.prototype={eol:function(){return this.pos>=this.string.length},sol:function(){return this.pos==this.lineStart},peek:function(){return this.string.charAt(this.pos)||undefined},next:function(){if(this.pos<this.string.length)return this.string.charAt(this.pos++)},eat:function(e){var t=this.string.charAt(this.pos);if(typeof e=="string")var r=t==e;else var r=t&&(e.test?e.test(t):e(t));if(r){++this.pos;return t}},eatWhile:function(e){var t=this.pos;while(this.eat(e)){}return this.pos>t},eatSpace:function(){var e=this.pos;while(/[\s\u00a0]/.test(this.string.charAt(this.pos)))++this.pos;return this.pos>e},skipToEnd:function(){this.pos=this.string.length},skipTo:function(e){var t=this.string.indexOf(e,this.pos);if(t>-1){this.pos=t;return true}},backUp:function(e){this.pos-=e},column:function(){throw"not implemented"},indentation:function(){throw"not implemented"},match:function(e,t,r){if(typeof e=="string"){var n=function(e){return r?e.toLowerCase():e};var i=this.string.substr(this.pos,e.length);if(n(i)==n(e)){if(t!==false)this.pos+=e.length;return true}}else{var a=this.string.slice(this.pos).match(e);if(a&&a.index>0)return null;if(a&&t!==false)this.pos+=a[0].length;return a}},current:function(){return this.string.slice(this.start,this.pos)},hideFirstChars:function(e,t){this.lineStart+=e;try{return t()}finally{this.lineStart-=e}}};m.defineExtension=function(e,t){m.prototype[e]=t};o.importCssString(".normal-mode .ace_cursor{\n    border: none;\n    background-color: rgba(255,0,0,0.5);\n}\n.normal-mode .ace_hidden-cursors .ace_cursor{\n  background-color: transparent;\n  border: 1px solid red;\n  opacity: 0.7\n}\n.ace_dialog {\n  position: absolute;\n  left: 0; right: 0;\n  background: inherit;\n  z-index: 15;\n  padding: .1em .8em;\n  overflow: hidden;\n  color: inherit;\n}\n.ace_dialog-top {\n  border-bottom: 1px solid #444;\n  top: 0;\n}\n.ace_dialog-bottom {\n  border-top: 1px solid #444;\n  bottom: 0;\n}\n.ace_dialog input {\n  border: none;\n  outline: none;\n  background: transparent;\n  width: 20em;\n  color: inherit;\n  font-family: monospace;\n}","vimMode",false);(function(){function e(e,t,r){var n=e.ace.container;var i;i=n.appendChild(document.createElement("div"));if(r)i.className="ace_dialog ace_dialog-bottom";else i.className="ace_dialog ace_dialog-top";if(typeof t=="string"){throw new Error("Can not use string template for the dialog. This is required to avoid CSP inline styles violations")}else{i.appendChild(t)}return i}function t(e,t){if(e.state.currentNotificationClose)e.state.currentNotificationClose();e.state.currentNotificationClose=t}m.defineExtension("openDialog",function(r,n,i){if(this.virtualSelectionMode())return;if(!i)i={};t(this,null);var a=e(this,r,i.bottom);var o=false,s=this;this.state.dialog=a;function l(e){if(typeof e=="string"){c.value=e}else{if(o)return;if(e&&e.type=="blur"){if(document.activeElement===c)return}if(s.state.dialog==a){s.state.dialog=null;s.focus()}o=true;a.remove();if(i.onClose)i.onClose(a);var t=s;if(t.state.vim){t.state.vim.status=null;t.ace._signal("changeStatus");t.ace.renderer.$loop.schedule(t.ace.renderer.CHANGE_CURSOR)}}}var c=a.getElementsByTagName("input")[0],u;if(c){if(i.value){c.value=i.value;if(i.selectValueOnOpen!==false)c.select()}if(i.onInput)m.on(c,"input",function(e){i.onInput(e,c.value,l)});if(i.onKeyUp)m.on(c,"keyup",function(e){i.onKeyUp(e,c.value,l)});m.on(c,"keydown",function(e){if(i&&i.onKeyDown&&i.onKeyDown(e,c.value,l)){return}if(e.keyCode==13)n(c.value);if(e.keyCode==27||i.closeOnEnter!==false&&e.keyCode==13){m.e_stop(e);l()}});if(i.closeOnBlur!==false)m.on(c,"blur",l);c.focus()}else if(u=a.getElementsByTagName("button")[0]){m.on(u,"click",function(){l();s.focus()});if(i.closeOnBlur!==false)m.on(u,"blur",l);u.focus()}return l});m.defineExtension("openNotification",function(r,n){if(this.virtualSelectionMode())return;t(this,l);var i=e(this,r,n&&n.bottom);var a=false,o;var s=n&&typeof n.duration!=="undefined"?n.duration:5e3;function l(){if(a)return;a=true;clearTimeout(o);i.remove()}m.on(i,"click",function(e){m.e_preventDefault(e);l()});if(s)o=setTimeout(l,s);return l})})();var C=m.Pos;function k(e,t,r){if(t.line===r.line&&t.ch>=r.ch-1){var n=e.getLine(t.line);var i=n.charCodeAt(t.ch);if(55296<=i&&i<=55551){r.ch+=1}}return{start:t,end:r}}var S=[{keys:"<Left>",type:"keyToKey",toKeys:"h"},{keys:"<Right>",type:"keyToKey",toKeys:"l"},{keys:"<Up>",type:"keyToKey",toKeys:"k"},{keys:"<Down>",type:"keyToKey",toKeys:"j"},{keys:"g<Up>",type:"keyToKey",toKeys:"gk"},{keys:"g<Down>",type:"keyToKey",toKeys:"gj"},{keys:"<Space>",type:"keyToKey",toKeys:"l"},{keys:"<BS>",type:"keyToKey",toKeys:"h"},{keys:"<Del>",type:"keyToKey",toKeys:"x"},{keys:"<C-Space>",type:"keyToKey",toKeys:"W"},{keys:"<C-BS>",type:"keyToKey",toKeys:"B"},{keys:"<S-Space>",type:"keyToKey",toKeys:"w"},{keys:"<S-BS>",type:"keyToKey",toKeys:"b"},{keys:"<C-n>",type:"keyToKey",toKeys:"j"},{keys:"<C-p>",type:"keyToKey",toKeys:"k"},{keys:"<C-[>",type:"keyToKey",toKeys:"<Esc>"},{keys:"<C-c>",type:"keyToKey",toKeys:"<Esc>"},{keys:"<C-[>",type:"keyToKey",toKeys:"<Esc>",context:"insert"},{keys:"<C-c>",type:"keyToKey",toKeys:"<Esc>",context:"insert"},{keys:"<C-Esc>",type:"keyToKey",toKeys:"<Esc>"},{keys:"<C-Esc>",type:"keyToKey",toKeys:"<Esc>",context:"insert"},{keys:"s",type:"keyToKey",toKeys:"cl",context:"normal"},{keys:"s",type:"keyToKey",toKeys:"c",context:"visual"},{keys:"S",type:"keyToKey",toKeys:"cc",context:"normal"},{keys:"S",type:"keyToKey",toKeys:"VdO",context:"visual"},{keys:"<Home>",type:"keyToKey",toKeys:"0"},{keys:"<End>",type:"keyToKey",toKeys:"$"},{keys:"<PageUp>",type:"keyToKey",toKeys:"<C-b>"},{keys:"<PageDown>",type:"keyToKey",toKeys:"<C-f>"},{keys:"<CR>",type:"keyToKey",toKeys:"j^",context:"normal"},{keys:"<Ins>",type:"keyToKey",toKeys:"i",context:"normal"},{keys:"<Ins>",type:"action",action:"toggleOverwrite",context:"insert"},{keys:"H",type:"motion",motion:"moveToTopLine",motionArgs:{linewise:true,toJumplist:true}},{keys:"M",type:"motion",motion:"moveToMiddleLine",motionArgs:{linewise:true,toJumplist:true}},{keys:"L",type:"motion",motion:"moveToBottomLine",motionArgs:{linewise:true,toJumplist:true}},{keys:"h",type:"motion",motion:"moveByCharacters",motionArgs:{forward:false}},{keys:"l",type:"motion",motion:"moveByCharacters",motionArgs:{forward:true}},{keys:"j",type:"motion",motion:"moveByLines",motionArgs:{forward:true,linewise:true}},{keys:"k",type:"motion",motion:"moveByLines",motionArgs:{forward:false,linewise:true}},{keys:"gj",type:"motion",motion:"moveByDisplayLines",motionArgs:{forward:true}},{keys:"gk",type:"motion",motion:"moveByDisplayLines",motionArgs:{forward:false}},{keys:"w",type:"motion",motion:"moveByWords",motionArgs:{forward:true,wordEnd:false}},{keys:"W",type:"motion",motion:"moveByWords",motionArgs:{forward:true,wordEnd:false,bigWord:true}},{keys:"e",type:"motion",motion:"moveByWords",motionArgs:{forward:true,wordEnd:true,inclusive:true}},{keys:"E",type:"motion",motion:"moveByWords",motionArgs:{forward:true,wordEnd:true,bigWord:true,inclusive:true}},{keys:"b",type:"motion",motion:"moveByWords",motionArgs:{forward:false,wordEnd:false}},{keys:"B",type:"motion",motion:"moveByWords",motionArgs:{forward:false,wordEnd:false,bigWord:true}},{keys:"ge",type:"motion",motion:"moveByWords",motionArgs:{forward:false,wordEnd:true,inclusive:true}},{keys:"gE",type:"motion",motion:"moveByWords",motionArgs:{forward:false,wordEnd:true,bigWord:true,inclusive:true}},{keys:"{",type:"motion",motion:"moveByParagraph",motionArgs:{forward:false,toJumplist:true}},{keys:"}",type:"motion",motion:"moveByParagraph",motionArgs:{forward:true,toJumplist:true}},{keys:"(",type:"motion",motion:"moveBySentence",motionArgs:{forward:false}},{keys:")",type:"motion",motion:"moveBySentence",motionArgs:{forward:true}},{keys:"<C-f>",type:"motion",motion:"moveByPage",motionArgs:{forward:true}},{keys:"<C-b>",type:"motion",motion:"moveByPage",motionArgs:{forward:false}},{keys:"<C-d>",type:"motion",motion:"moveByScroll",motionArgs:{forward:true,explicitRepeat:true}},{keys:"<C-u>",type:"motion",motion:"moveByScroll",motionArgs:{forward:false,explicitRepeat:true}},{keys:"gg",type:"motion",motion:"moveToLineOrEdgeOfDocument",motionArgs:{forward:false,explicitRepeat:true,linewise:true,toJumplist:true}},{keys:"G",type:"motion",motion:"moveToLineOrEdgeOfDocument",motionArgs:{forward:true,explicitRepeat:true,linewise:true,toJumplist:true}},{keys:"g$",type:"motion",motion:"moveToEndOfDisplayLine"},{keys:"g^",type:"motion",motion:"moveToStartOfDisplayLine"},{keys:"g0",type:"motion",motion:"moveToStartOfDisplayLine"},{keys:"0",type:"motion",motion:"moveToStartOfLine"},{keys:"^",type:"motion",motion:"moveToFirstNonWhiteSpaceCharacter"},{keys:"+",type:"motion",motion:"moveByLines",motionArgs:{forward:true,toFirstChar:true}},{keys:"-",type:"motion",motion:"moveByLines",motionArgs:{forward:false,toFirstChar:true}},{keys:"_",type:"motion",motion:"moveByLines",motionArgs:{forward:true,toFirstChar:true,repeatOffset:-1}},{keys:"$",type:"motion",motion:"moveToEol",motionArgs:{inclusive:true}},{keys:"%",type:"motion",motion:"moveToMatchedSymbol",motionArgs:{inclusive:true,toJumplist:true}},{keys:"f<character>",type:"motion",motion:"moveToCharacter",motionArgs:{forward:true,inclusive:true}},{keys:"F<character>",type:"motion",motion:"moveToCharacter",motionArgs:{forward:false}},{keys:"t<character>",type:"motion",motion:"moveTillCharacter",motionArgs:{forward:true,inclusive:true}},{keys:"T<character>",type:"motion",motion:"moveTillCharacter",motionArgs:{forward:false}},{keys:";",type:"motion",motion:"repeatLastCharacterSearch",motionArgs:{forward:true}},{keys:",",type:"motion",motion:"repeatLastCharacterSearch",motionArgs:{forward:false}},{keys:"'<register>",type:"motion",motion:"goToMark",motionArgs:{toJumplist:true,linewise:true}},{keys:"`<register>",type:"motion",motion:"goToMark",motionArgs:{toJumplist:true}},{keys:"]`",type:"motion",motion:"jumpToMark",motionArgs:{forward:true}},{keys:"[`",type:"motion",motion:"jumpToMark",motionArgs:{forward:false}},{keys:"]'",type:"motion",motion:"jumpToMark",motionArgs:{forward:true,linewise:true}},{keys:"['",type:"motion",motion:"jumpToMark",motionArgs:{forward:false,linewise:true}},{keys:"]p",type:"action",action:"paste",isEdit:true,actionArgs:{after:true,isEdit:true,matchIndent:true}},{keys:"[p",type:"action",action:"paste",isEdit:true,actionArgs:{after:false,isEdit:true,matchIndent:true}},{keys:"]<character>",type:"motion",motion:"moveToSymbol",motionArgs:{forward:true,toJumplist:true}},{keys:"[<character>",type:"motion",motion:"moveToSymbol",motionArgs:{forward:false,toJumplist:true}},{keys:"|",type:"motion",motion:"moveToColumn"},{keys:"o",type:"motion",motion:"moveToOtherHighlightedEnd",context:"visual"},{keys:"O",type:"motion",motion:"moveToOtherHighlightedEnd",motionArgs:{sameLine:true},context:"visual"},{keys:"d",type:"operator",operator:"delete"},{keys:"y",type:"operator",operator:"yank"},{keys:"c",type:"operator",operator:"change"},{keys:"=",type:"operator",operator:"indentAuto"},{keys:">",type:"operator",operator:"indent",operatorArgs:{indentRight:true}},{keys:"<",type:"operator",operator:"indent",operatorArgs:{indentRight:false}},{keys:"g~",type:"operator",operator:"changeCase"},{keys:"gu",type:"operator",operator:"changeCase",operatorArgs:{toLower:true},isEdit:true},{keys:"gU",type:"operator",operator:"changeCase",operatorArgs:{toLower:false},isEdit:true},{keys:"n",type:"motion",motion:"findNext",motionArgs:{forward:true,toJumplist:true}},{keys:"N",type:"motion",motion:"findNext",motionArgs:{forward:false,toJumplist:true}},{keys:"gn",type:"motion",motion:"findAndSelectNextInclusive",motionArgs:{forward:true}},{keys:"gN",type:"motion",motion:"findAndSelectNextInclusive",motionArgs:{forward:false}},{keys:"gq",type:"operator",operator:"hardWrap"},{keys:"gw",type:"operator",operator:"hardWrap",operatorArgs:{keepCursor:true}},{keys:"x",type:"operatorMotion",operator:"delete",motion:"moveByCharacters",motionArgs:{forward:true},operatorMotionArgs:{visualLine:false}},{keys:"X",type:"operatorMotion",operator:"delete",motion:"moveByCharacters",motionArgs:{forward:false},operatorMotionArgs:{visualLine:true}},{keys:"D",type:"operatorMotion",operator:"delete",motion:"moveToEol",motionArgs:{inclusive:true},context:"normal"},{keys:"D",type:"operator",operator:"delete",operatorArgs:{linewise:true},context:"visual"},{keys:"Y",type:"operatorMotion",operator:"yank",motion:"expandToLine",motionArgs:{linewise:true},context:"normal"},{keys:"Y",type:"operator",operator:"yank",operatorArgs:{linewise:true},context:"visual"},{keys:"C",type:"operatorMotion",operator:"change",motion:"moveToEol",motionArgs:{inclusive:true},context:"normal"},{keys:"C",type:"operator",operator:"change",operatorArgs:{linewise:true},context:"visual"},{keys:"~",type:"operatorMotion",operator:"changeCase",motion:"moveByCharacters",motionArgs:{forward:true},operatorArgs:{shouldMoveCursor:true},context:"normal"},{keys:"~",type:"operator",operator:"changeCase",context:"visual"},{keys:"<C-u>",type:"operatorMotion",operator:"delete",motion:"moveToStartOfLine",context:"insert"},{keys:"<C-w>",type:"operatorMotion",operator:"delete",motion:"moveByWords",motionArgs:{forward:false,wordEnd:false},context:"insert"},{keys:"<C-w>",type:"idle",context:"normal"},{keys:"<C-i>",type:"action",action:"jumpListWalk",actionArgs:{forward:true}},{keys:"<C-o>",type:"action",action:"jumpListWalk",actionArgs:{forward:false}},{keys:"<C-e>",type:"action",action:"scroll",actionArgs:{forward:true,linewise:true}},{keys:"<C-y>",type:"action",action:"scroll",actionArgs:{forward:false,linewise:true}},{keys:"a",type:"action",action:"enterInsertMode",isEdit:true,actionArgs:{insertAt:"charAfter"},context:"normal"},{keys:"A",type:"action",action:"enterInsertMode",isEdit:true,actionArgs:{insertAt:"eol"},context:"normal"},{keys:"A",type:"action",action:"enterInsertMode",isEdit:true,actionArgs:{insertAt:"endOfSelectedArea"},context:"visual"},{keys:"i",type:"action",action:"enterInsertMode",isEdit:true,actionArgs:{insertAt:"inplace"},context:"normal"},{keys:"gi",type:"action",action:"enterInsertMode",isEdit:true,actionArgs:{insertAt:"lastEdit"},context:"normal"},{keys:"I",type:"action",action:"enterInsertMode",isEdit:true,actionArgs:{insertAt:"firstNonBlank"},context:"normal"},{keys:"gI",type:"action",action:"enterInsertMode",isEdit:true,actionArgs:{insertAt:"bol"},context:"normal"},{keys:"I",type:"action",action:"enterInsertMode",isEdit:true,actionArgs:{insertAt:"startOfSelectedArea"},context:"visual"},{keys:"o",type:"action",action:"newLineAndEnterInsertMode",isEdit:true,interlaceInsertRepeat:true,actionArgs:{after:true},context:"normal"},{keys:"O",type:"action",action:"newLineAndEnterInsertMode",isEdit:true,interlaceInsertRepeat:true,actionArgs:{after:false},context:"normal"},{keys:"v",type:"action",action:"toggleVisualMode"},{keys:"V",type:"action",action:"toggleVisualMode",actionArgs:{linewise:true}},{keys:"<C-v>",type:"action",action:"toggleVisualMode",actionArgs:{blockwise:true}},{keys:"<C-q>",type:"action",action:"toggleVisualMode",actionArgs:{blockwise:true}},{keys:"gv",type:"action",action:"reselectLastSelection"},{keys:"J",type:"action",action:"joinLines",isEdit:true},{keys:"gJ",type:"action",action:"joinLines",actionArgs:{keepSpaces:true},isEdit:true},{keys:"p",type:"action",action:"paste",isEdit:true,actionArgs:{after:true,isEdit:true}},{keys:"P",type:"action",action:"paste",isEdit:true,actionArgs:{after:false,isEdit:true}},{keys:"r<character>",type:"action",action:"replace",isEdit:true},{keys:"@<register>",type:"action",action:"replayMacro"},{keys:"q<register>",type:"action",action:"enterMacroRecordMode"},{keys:"R",type:"action",action:"enterInsertMode",isEdit:true,actionArgs:{replace:true},context:"normal"},{keys:"R",type:"operator",operator:"change",operatorArgs:{linewise:true,fullLine:true},context:"visual",exitVisualBlock:true},{keys:"u",type:"action",action:"undo",context:"normal"},{keys:"u",type:"operator",operator:"changeCase",operatorArgs:{toLower:true},context:"visual",isEdit:true},{keys:"U",type:"operator",operator:"changeCase",operatorArgs:{toLower:false},context:"visual",isEdit:true},{keys:"<C-r>",type:"action",action:"redo"},{keys:"m<register>",type:"action",action:"setMark"},{keys:'"<register>',type:"action",action:"setRegister"},{keys:"<C-r><register>",type:"action",action:"insertRegister",context:"insert",isEdit:true},{keys:"<C-o>",type:"action",action:"oneNormalCommand",context:"insert"},{keys:"zz",type:"action",action:"scrollToCursor",actionArgs:{position:"center"}},{keys:"z.",type:"action",action:"scrollToCursor",actionArgs:{position:"center"},motion:"moveToFirstNonWhiteSpaceCharacter"},{keys:"zt",type:"action",action:"scrollToCursor",actionArgs:{position:"top"}},{keys:"z<CR>",type:"action",action:"scrollToCursor",actionArgs:{position:"top"},motion:"moveToFirstNonWhiteSpaceCharacter"},{keys:"zb",type:"action",action:"scrollToCursor",actionArgs:{position:"bottom"}},{keys:"z-",type:"action",action:"scrollToCursor",actionArgs:{position:"bottom"},motion:"moveToFirstNonWhiteSpaceCharacter"},{keys:".",type:"action",action:"repeatLastEdit"},{keys:"<C-a>",type:"action",action:"incrementNumberToken",isEdit:true,actionArgs:{increase:true,backtrack:false}},{keys:"<C-x>",type:"action",action:"incrementNumberToken",isEdit:true,actionArgs:{increase:false,backtrack:false}},{keys:"<C-t>",type:"action",action:"indent",actionArgs:{indentRight:true},context:"insert"},{keys:"<C-d>",type:"action",action:"indent",actionArgs:{indentRight:false},context:"insert"},{keys:"a<register>",type:"motion",motion:"textObjectManipulation"},{keys:"i<register>",type:"motion",motion:"textObjectManipulation",motionArgs:{textObjectInner:true}},{keys:"/",type:"search",searchArgs:{forward:true,querySrc:"prompt",toJumplist:true}},{keys:"?",type:"search",searchArgs:{forward:false,querySrc:"prompt",toJumplist:true}},{keys:"*",type:"search",searchArgs:{forward:true,querySrc:"wordUnderCursor",wholeWordOnly:true,toJumplist:true}},{keys:"#",type:"search",searchArgs:{forward:false,querySrc:"wordUnderCursor",wholeWordOnly:true,toJumplist:true}},{keys:"g*",type:"search",searchArgs:{forward:true,querySrc:"wordUnderCursor",toJumplist:true}},{keys:"g#",type:"search",searchArgs:{forward:false,querySrc:"wordUnderCursor",toJumplist:true}},{keys:":",type:"ex"}];var x=S.length;var M=[{name:"colorscheme",shortName:"colo"},{name:"map"},{name:"imap",shortName:"im"},{name:"nmap",shortName:"nm"},{name:"vmap",shortName:"vm"},{name:"omap",shortName:"om"},{name:"noremap",shortName:"no"},{name:"nnoremap",shortName:"nn"},{name:"vnoremap",shortName:"vn"},{name:"inoremap",shortName:"ino"},{name:"onoremap",shortName:"ono"},{name:"unmap"},{name:"mapclear",shortName:"mapc"},{name:"nmapclear",shortName:"nmapc"},{name:"vmapclear",shortName:"vmapc"},{name:"imapclear",shortName:"imapc"},{name:"omapclear",shortName:"omapc"},{name:"write",shortName:"w"},{name:"undo",shortName:"u"},{name:"redo",shortName:"red"},{name:"set",shortName:"se"},{name:"setlocal",shortName:"setl"},{name:"setglobal",shortName:"setg"},{name:"sort",shortName:"sor"},{name:"substitute",shortName:"s",possiblyAsync:true},{name:"startinsert",shortName:"start"},{name:"nohlsearch",shortName:"noh"},{name:"yank",shortName:"y"},{name:"delmarks",shortName:"delm"},{name:"registers",shortName:"reg",excludeFromCommandHistory:true},{name:"vglobal",shortName:"v"},{name:"delete",shortName:"d"},{name:"join",shortName:"j"},{name:"normal",shortName:"norm"},{name:"global",shortName:"g"}];var b=he("");function A(e){e.setOption("disableInput",true);e.setOption("showCursorWhenSelecting",false);m.signal(e,"vim-mode-change",{mode:"normal"});e.on("cursorActivity",cr);X(e);m.on(e.getInputField(),"paste",E(e))}function L(e){e.setOption("disableInput",false);e.off("cursorActivity",cr);m.off(e.getInputField(),"paste",E(e));e.state.vim=null;if(Wt)clearTimeout(Wt)}function E(e){var t=e.state.vim;if(!t.onPasteFn){t.onPasteFn=function(){if(!t.insertMode){e.setCursor(Oe(e.getCursor(),0,1));Ae.enterInsertMode(e,{},t)}}}return t.onPasteFn}var T=/[\d]/;var O=[m.isWordChar,function(e){return e&&!m.isWordChar(e)&&!/\s/.test(e)}],R=[function(e){return/\S/.test(e)}];var B=["<",">"];var I=["-",'"',".",":","_","/","+"];var N=/^\w$/;var K;try{K=new RegExp("^[\\p{Lu}]$","u")}catch(e){K=/^[A-Z]$/}function P(e,t){return t>=e.firstLine()&&t<=e.lastLine()}function H(e){return/^[a-z]$/.test(e)}function _(e){return"()[]{}".indexOf(e)!=-1}function $(e){return T.test(e)}function D(e){return K.test(e)}function V(e){return/^\s*$/.test(e)}function W(e){return".?!".indexOf(e)!=-1}function j(e,t){for(var r=0;r<t.length;r++){if(t[r]==e){return true}}return false}var F={};function U(e,t,r,n,i){if(t===undefined&&!i){throw Error("defaultValue is required unless callback is provided")}if(!r){r="string"}F[e]={type:r,defaultValue:t,callback:i};if(n){for(var a=0;a<n.length;a++){F[n[a]]=F[e]}}if(t){z(e,t)}}function z(e,t,r,n){var i=F[e];n=n||{};var a=n.scope;if(!i){return new Error("Unknown option: "+e)}if(i.type=="boolean"){if(t&&t!==true){return new Error("Invalid argument: "+e+"="+t)}else if(t!==false){t=true}}if(i.callback){if(a!=="local"){i.callback(t,undefined)}if(a!=="global"&&r){i.callback(t,r)}}else{if(a!=="local"){i.value=i.type=="boolean"?!!t:t}if(a!=="global"&&r){r.state.vim.options[e]={value:t}}}}function Q(e,t,r){var n=F[e];r=r||{};var i=r.scope;if(!n){return new Error("Unknown option: "+e)}if(n.callback){var a=t&&n.callback(undefined,t);if(i!=="global"&&a!==undefined){return a}if(i!=="local"){return n.callback()}return}else{var a=i!=="global"&&(t&&t.state.vim.options[e]);return(a||i!=="local"&&n||{}).value}}U("filetype",undefined,"string",["ft"],function(e,t){if(t===undefined){return}if(e===undefined){var r=t.getOption("mode");return r=="null"?"":r}else{var r=e==""?"null":e;t.setOption("mode",r)}});U("textwidth",80,"number",["tw"],function(e,t){if(t===undefined){return}if(e===undefined){var r=t.getOption("textwidth");return r}else{var n=Math.round(e);if(n>1){t.setOption("textwidth",n)}}});var q=function(){var e=100;var t=-1;var r=0;var n=0;var i=new Array(e);function a(a,o,s){var l=t%e;var c=i[l];function u(r){var n=++t%e;var o=i[n];if(o){o.clear()}i[n]=a.setBookmark(r)}if(c){var f=c.find();if(f&&!Pe(f,o)){u(o)}}else{u(o)}u(s);r=t;n=t-e+1;if(n<0){n=0}}function o(a,o){t+=o;if(t>r){t=r}else if(t<n){t=n}var s=i[(e+t)%e];if(s&&!s.find()){var l=o>0?1:-1;var c;var u=a.getCursor();do{t+=l;s=i[(e+t)%e];if(s&&(c=s.find())&&!Pe(u,c)){break}}while(t<r&&t>n)}return s}function s(e,r){var n=t;var i=o(e,r);t=n;return i&&i.find()}return{cachedCursor:undefined,add:a,find:s,move:o}};var J=function(e){if(e){return{changes:e.changes,expectCursorActivityForChange:e.expectCursorActivityForChange}}return{changes:[],expectCursorActivityForChange:false}};function G(){this.latestRegister=undefined;this.isPlaying=false;this.isRecording=false;this.replaySearchQueries=[];this.onRecordingDone=undefined;this.lastInsertModeChanges=J()}G.prototype={exitMacroRecordMode:function(){var e=Z.macroModeState;if(e.onRecordingDone){e.onRecordingDone()}e.onRecordingDone=undefined;e.isRecording=false},enterMacroRecordMode:function(e,t){var r=Z.registerController.getRegister(t);if(r){r.clear();this.latestRegister=t;if(e.openDialog){var n=Kt("span",{class:"cm-vim-message"},"recording @"+t);this.onRecordingDone=e.openDialog(n,null,{bottom:true})}this.isRecording=true}}};function X(e){if(!e.state.vim){e.state.vim={inputState:new de,lastEditInputState:undefined,lastEditActionCommand:undefined,lastHPos:-1,lastHSPos:-1,lastMotion:null,marks:{},insertMode:false,insertModeReturn:false,insertModeRepeat:undefined,visualMode:false,visualLine:false,visualBlock:false,lastSelection:null,lastPastedText:null,sel:{},options:{},expectLiteralNext:false}}return e.state.vim}var Z;function Y(){Z={searchQuery:null,searchIsReversed:false,lastSubstituteReplacePart:undefined,jumpList:q(),macroModeState:new G,lastCharacterSearch:{increment:0,forward:true,selectedCharacter:""},registerController:new ye({}),searchHistoryController:new we,exCommandHistoryController:new we};for(var e in F){var t=F[e];t.value=t.defaultValue}}var ee;var te={enterVimMode:A,leaveVimMode:L,buildKeyMap:function(){},getRegisterController:function(){return Z.registerController},resetVimGlobalState_:Y,getVimGlobalState_:function(){return Z},maybeInitVimState_:X,suppressErrorLogging:false,InsertModeKey:fr,map:function(e,t,r){Yt.map(e,t,r)},unmap:function(e,t){return Yt.unmap(e,t)},noremap:function(e,t,r){Yt.map(e,t,r,true)},mapclear:function(e){var t=S.length,r=x;var n=S.slice(0,t-r);S=S.slice(t-r);if(e){for(var i=n.length-1;i>=0;i--){var a=n[i];if(e!==a.context){if(a.context){this._mapCommand(a)}else{var o=["normal","insert","visual"];for(var s in o){if(o[s]!==e){var l={};for(var c in a){l[c]=a[c]}l.context=o[s];this._mapCommand(l)}}}}}}},langmap:fe,vimKeyFromEvent:ue,setOption:z,getOption:Q,defineOption:U,defineEx:function(e,t,r){if(!t){t=e}else if(e.indexOf(t)!==0){throw new Error('(Vim.defineEx) "'+t+'" is not a prefix of "'+e+'", command not registered')}Zt[e]=r;Yt.commandMap_[t]={name:e,shortName:t,type:"api"}},handleKey:function(e,t,r){var n=this.findKey(e,t,r);if(typeof n==="function"){return n()}},multiSelectHandleKey:Cr,findKey:function(e,t,r){var n=X(e);function i(){var n=Z.macroModeState;if(n.isRecording){if(t=="q"){n.exitMacroRecordMode();pe(e);return true}if(r!="mapping"){ar(n,t)}}}function a(){if(t=="<Esc>"){if(n.visualMode){et(e)}else if(n.insertMode){tr(e)}else{return}pe(e);return true}}function o(){if(a()){return true}n.inputState.keyBuffer.push(t);var r=n.inputState.keyBuffer.join("");var i=t.length==1;var o=Ce.matchCommand(r,S,n.inputState,"insert");var s=n.inputState.changeQueue;if(o.type=="none"){pe(e);return false}else if(o.type=="partial"){if(o.expectLiteralNext)n.expectLiteralNext=true;if(ee){window.clearTimeout(ee)}ee=i&&window.setTimeout(function(){if(n.insertMode&&n.inputState.keyBuffer.length){pe(e)}},Q("insertModeEscKeysTimeout"));if(i){var l=e.listSelections();if(!s||s.removed.length!=l.length)s=n.inputState.changeQueue=new ve;s.inserted+=t;for(var c=0;c<l.length;c++){var u=_e(l[c].anchor,l[c].head);var f=$e(l[c].anchor,l[c].head);var h=e.getRange(u,e.state.overwrite?Oe(f,0,1):f);s.removed[c]=(s.removed[c]||"")+h}}return!i}n.expectLiteralNext=false;if(ee){window.clearTimeout(ee)}if(o.command&&s){var l=e.listSelections();for(var c=0;c<l.length;c++){var d=l[c].head;e.replaceRange(s.removed[c]||"",Oe(d,0,-s.inserted.length),d,"+input")}Z.macroModeState.lastInsertModeChanges.changes.pop()}if(!o.command)pe(e);return o.command}function s(){if(i()||a()){return true}n.inputState.keyBuffer.push(t);var r=n.inputState.keyBuffer.join("");if(/^[1-9]\d*$/.test(r)){return true}var o=/^(\d*)(.*)$/.exec(r);if(!o){pe(e);return false}var s=n.visualMode?"visual":"normal";var l=o[2]||o[1];if(n.inputState.operatorShortcut&&n.inputState.operatorShortcut.slice(-1)==l){l=n.inputState.operatorShortcut}var c=Ce.matchCommand(l,S,n.inputState,s);if(c.type=="none"){pe(e);return false}else if(c.type=="partial"){if(c.expectLiteralNext)n.expectLiteralNext=true;return true}else if(c.type=="clear"){pe(e);return true}n.expectLiteralNext=false;n.inputState.keyBuffer.length=0;o=/^(\d*)(.*)$/.exec(r);if(o[1]&&o[1]!="0"){n.inputState.pushRepeatDigit(o[1])}return c.command}var l;if(n.insertMode){l=o()}else{l=s()}if(l===false){return!n.insertMode&&t.length===1?function(){return true}:undefined}else if(l===true){return function(){return true}}else{return function(){if((l.operator||l.isEdit)&&e.getOption("readOnly"))return;return e.operation(function(){e.curOp.isVimOp=true;try{if(l.type=="keyToKey"){oe(e,l.toKeys,l)}else{Ce.processCommand(e,n,l)}}catch(t){e.state.vim=undefined;X(e);if(!te.suppressErrorLogging){console["log"](t)}throw t}return true})}}},handleEx:function(e,t){Yt.processCommand(e,t)},defineMotion:Se,defineAction:Le,defineOperator:be,mapCommand:nr,_mapCommand:rr,defineRegister:ge,exitVisualMode:et,exitInsertMode:tr};var re=[];var ne=false;var ie;function ae(e){if(e[0]=="<"){var t=e.toLowerCase().slice(1,-1);var r=t.split("-");t=r.pop()||"";if(t=="lt")e="<";else if(t=="space")e=" ";else if(t=="cr")e="\n";else if(ce[t]){var n=ie.value;var i={key:ce[t],target:{value:n,selectionEnd:n.length,selectionStart:n.length}};if(ie.onKeyDown){ie.onKeyDown(i,ie.value,o)}if(ie&&ie.onKeyUp){ie.onKeyUp(i,ie.value,o)}return}}if(e=="\n"){var a=ie;ie=null;a.onClose&&a.onClose(a.value)}else{ie.value=(ie.value||"")+e}function o(e){if(typeof e=="string"){ie.value=e}else{ie=null}}}function oe(e,t,r){var n=ne;if(r){if(re.indexOf(r)!=-1)return;re.push(r);ne=r.noremap!=false}try{var i=X(e);var a=/<(?:[CSMA]-)*\w+>|./gi;var o;while(o=a.exec(t)){var s=o[0];var l=i.insertMode;if(ie){ae(s);continue}var c=te.handleKey(e,s,"mapping");if(!c&&l&&i.insertMode){if(s[0]=="<"){var u=s.toLowerCase().slice(1,-1);var f=u.split("-");u=f.pop()||"";if(u=="lt")s="<";else if(u=="space")s=" ";else if(u=="cr")s="\n";else if(ce.hasOwnProperty(u)){s=ce[u];pr(e,s);continue}else{s=s[0];a.lastIndex=o.index+1}}e.replaceSelection(s)}}}finally{re.pop();ne=re.length?n:false;if(!re.length&&ie){var h=ie;ie=null;_t(e,h)}}}var se={Return:"CR",Backspace:"BS",Delete:"Del",Escape:"Esc",Insert:"Ins",ArrowLeft:"Left",ArrowRight:"Right",ArrowUp:"Up",ArrowDown:"Down",Enter:"CR"," ":"Space"};var le={Shift:1,Alt:1,Command:1,Control:1,CapsLock:1,AltGraph:1,Dead:1,Unidentified:1};var ce={};"Left|Right|Up|Down|End|Home".split("|").concat(Object.keys(se)).forEach(function(e){ce[(se[e]||"").toLowerCase()]=ce[e.toLowerCase()]=e});function ue(e,t){var r=e.key;if(le[r])return;if(r.length>1&&r[0]=="n"){r=r.replace("Numpad","")}r=se[r]||r;var n="";if(e.ctrlKey){n+="C-"}if(e.altKey){n+="A-"}if(e.metaKey){n+="M-"}if(m.isMac&&e.altKey&&!e.metaKey&&!e.ctrlKey){n=n.slice(2)}if((n||r.length>1)&&e.shiftKey){n+="S-"}if(t&&!t.expectLiteralNext&&r.length==1){if(b.keymap&&r in b.keymap){if(b.remapCtrl!=false||!n)r=b.keymap[r]}else if(r.charCodeAt(0)>255){var i=e.code&&e.code.slice(-1)||"";if(!e.shiftKey)i=i.toLowerCase();if(i)r=i}}n+=r;if(n.length>1){n="<"+n+">"}return n}function fe(e,t){if(b.string!==e){b=he(e)}b.remapCtrl=t}function he(e){var t={};if(!e)return{keymap:t,string:""};function r(e){return e.split(/\\?(.)/).filter(Boolean)}e.split(/((?:[^\\,]|\\.)+),/).map(function(e){if(!e)return;var n=e.split(/((?:[^\\;]|\\.)+);/);if(n.length==3){var i=r(n[1]);var a=r(n[2]);if(i.length!==a.length)return;for(var o=0;o<i.length;++o)t[i[o]]=a[o]}else if(n.length==1){var s=r(e);if(s.length%2!==0)return;for(var o=0;o<s.length;o+=2)t[s[o]]=s[o+1]}});return{keymap:t,string:e}}U("langmap",undefined,"string",["lmap"],function(e,t){if(e===undefined){return b.string}else{fe(e)}});function de(){this.prefixRepeat=[];this.motionRepeat=[];this.operator=null;this.operatorArgs=null;this.motion=null;this.motionArgs=null;this.keyBuffer=[];this.registerName=null;this.changeQueue=null}de.prototype.pushRepeatDigit=function(e){if(!this.operator){this.prefixRepeat=this.prefixRepeat.concat(e)}else{this.motionRepeat=this.motionRepeat.concat(e)}};de.prototype.getRepeat=function(){var e=0;if(this.prefixRepeat.length>0||this.motionRepeat.length>0){e=1;if(this.prefixRepeat.length>0){e*=parseInt(this.prefixRepeat.join(""),10)}if(this.motionRepeat.length>0){e*=parseInt(this.motionRepeat.join(""),10)}}return e};function pe(e,t){e.state.vim.inputState=new de;e.state.vim.expectLiteralNext=false;m.signal(e,"vim-command-done",t)}function ve(){this.removed=[];this.inserted=""}function me(e,t,r){this.clear();this.keyBuffer=[e||""];this.insertModeChanges=[];this.searchQueries=[];this.linewise=!!t;this.blockwise=!!r}me.prototype={setText:function(e,t,r){this.keyBuffer=[e||""];this.linewise=!!t;this.blockwise=!!r},pushText:function(e,t){if(t){if(!this.linewise){this.keyBuffer.push("\n")}this.linewise=true}this.keyBuffer.push(e)},pushInsertModeChanges:function(e){this.insertModeChanges.push(J(e))},pushSearchQuery:function(e){this.searchQueries.push(e)},clear:function(){this.keyBuffer=[];this.insertModeChanges=[];this.searchQueries=[];this.linewise=false},toString:function(){return this.keyBuffer.join("")}};function ge(e,t){var r=Z.registerController.registers;if(!e||e.length!=1){throw Error("Register name must be 1 character")}r[e]=t;I.push(e)}function ye(e){this.registers=e;this.unnamedRegister=e['"']=new me;e["."]=new me;e[":"]=new me;e["/"]=new me;e["+"]=new me}ye.prototype={pushText:function(e,t,r,n,i){if(e==="_")return;if(n&&r.charAt(r.length-1)!=="\n"){r+="\n"}var a=this.isValidRegister(e)?this.getRegister(e):null;if(!a){switch(t){case"yank":this.registers["0"]=new me(r,n,i);break;case"delete":case"change":if(r.indexOf("\n")==-1){this.registers["-"]=new me(r,n)}else{this.shiftNumericRegisters_();this.registers["1"]=new me(r,n)}break}this.unnamedRegister.setText(r,n,i);return}var o=D(e);if(o){a.pushText(r,n)}else{a.setText(r,n,i)}if(e==="+"&&typeof navigator!=="undefined"&&typeof navigator.clipboard!=="undefined"&&typeof navigator.clipboard.readText==="function"){navigator.clipboard.writeText(r)}this.unnamedRegister.setText(a.toString(),n)},getRegister:function(e){if(!this.isValidRegister(e)){return this.unnamedRegister}e=e.toLowerCase();if(!this.registers[e]){this.registers[e]=new me}return this.registers[e]},isValidRegister:function(e){return e&&(j(e,I)||N.test(e))},shiftNumericRegisters_:function(){for(var e=9;e>=2;e--){this.registers[e]=this.getRegister(""+(e-1))}}};function we(){this.historyBuffer=[];this.iterator=0;this.initialPrefix=null}we.prototype={nextMatch:function(e,t){var r=this.historyBuffer;var n=t?-1:1;if(this.initialPrefix===null)this.initialPrefix=e;for(var i=this.iterator+n;t?i>=0:i<r.length;i+=n){var a=r[i];for(var o=0;o<=a.length;o++){if(this.initialPrefix==a.substring(0,o)){this.iterator=i;return a}}}if(i>=r.length){this.iterator=r.length;return this.initialPrefix}if(i<0)return e},pushInput:function(e){var t=this.historyBuffer.indexOf(e);if(t>-1)this.historyBuffer.splice(t,1);if(e.length)this.historyBuffer.push(e)},reset:function(){this.initialPrefix=null;this.iterator=this.historyBuffer.length}};var Ce={matchCommand:function(e,t,r,n){var i=Re(e,t,n,r);if(!i.full&&!i.partial){return{type:"none"}}else if(!i.full&&i.partial){return{type:"partial",expectLiteralNext:i.partial.length==1&&i.partial[0].keys.slice(-11)=="<character>"}}var a;for(var o=0;o<i.full.length;o++){var s=i.full[o];if(!a){a=s}}if(a.keys.slice(-11)=="<character>"||a.keys.slice(-10)=="<register>"){var l=Ie(e);if(!l||l.length>1)return{type:"clear"};r.selectedCharacter=l}return{type:"full",command:a}},processCommand:function(e,t,r){t.inputState.repeatOverride=r.repeatOverride;switch(r.type){case"motion":this.processMotion(e,t,r);break;case"operator":this.processOperator(e,t,r);break;case"operatorMotion":this.processOperatorMotion(e,t,r);break;case"action":this.processAction(e,t,r);break;case"search":this.processSearch(e,t,r);break;case"ex":case"keyToEx":this.processEx(e,t,r);break;default:break}},processMotion:function(e,t,r){t.inputState.motion=r.motion;t.inputState.motionArgs=Te(r.motionArgs);this.evalInput(e,t)},processOperator:function(e,t,r){var n=t.inputState;if(n.operator){if(n.operator==r.operator){n.motion="expandToLine";n.motionArgs={linewise:true};this.evalInput(e,t);return}else{pe(e)}}n.operator=r.operator;n.operatorArgs=Te(r.operatorArgs);if(r.keys.length>1){n.operatorShortcut=r.keys}if(r.exitVisualBlock){t.visualBlock=false;Xe(e)}if(t.visualMode){this.evalInput(e,t)}},processOperatorMotion:function(e,t,r){var n=t.visualMode;var i=Te(r.operatorMotionArgs);if(i){if(n&&i.visualLine){t.visualLine=true}}this.processOperator(e,t,r);if(!n){this.processMotion(e,t,r)}},processAction:function(e,t,r){var n=t.inputState;var i=n.getRepeat();var a=!!i;var o=Te(r.actionArgs)||{};if(n.selectedCharacter){o.selectedCharacter=n.selectedCharacter}if(r.operator){this.processOperator(e,t,r)}if(r.motion){this.processMotion(e,t,r)}if(r.motion||r.operator){this.evalInput(e,t)}o.repeat=i||1;o.repeatIsExplicit=a;o.registerName=n.registerName;pe(e);t.lastMotion=null;if(r.isEdit){this.recordLastEdit(t,n,r)}Ae[r.action](e,o,t)},processSearch:function(e,t,r){if(!e.getSearchCursor){return}var n=r.searchArgs.forward;var i=r.searchArgs.wholeWordOnly;Mt(e).setReversed(!n);var a=n?"/":"?";var o=Mt(e).getQuery();var s=e.getScrollInfo();function l(n,i,a){Z.searchHistoryController.pushInput(n);Z.searchHistoryController.reset();try{Dt(e,n,i,a)}catch(t){Pt(e,"Invalid regex: "+n);pe(e);return}Ce.processMotion(e,t,{type:"motion",motion:"findNext",motionArgs:{forward:true,toJumplist:r.searchArgs.toJumplist}})}function c(e){l(e,true,true);var t=Z.macroModeState;if(t.isRecording){sr(t,e)}}function u(t,r,i){var a=ue(t),o,l;if(a=="<Up>"||a=="<Down>"){o=a=="<Up>"?true:false;l=t.target?t.target.selectionEnd:0;r=Z.searchHistoryController.nextMatch(r,o)||"";i(r);if(l&&t.target)t.target.selectionEnd=t.target.selectionStart=Math.min(l,t.target.value.length)}else if(a&&a!="<Left>"&&a!="<Right>"){Z.searchHistoryController.reset()}var c;try{c=Dt(e,r,true,true)}catch(t){}if(c){e.scrollIntoView(Ft(e,!n,c),30)}else{zt(e);e.scrollTo(s.left,s.top)}}function f(t,r,n){var i=ue(t);if(i=="<Esc>"||i=="<C-c>"||i=="<C-[>"||i=="<BS>"&&r==""){Z.searchHistoryController.pushInput(r);Z.searchHistoryController.reset();Dt(e,o);zt(e);e.scrollTo(s.left,s.top);m.e_stop(t);pe(e);n();e.focus()}else if(i=="<Up>"||i=="<Down>"){m.e_stop(t)}else if(i=="<C-u>"){m.e_stop(t);n("")}}switch(r.searchArgs.querySrc){case"prompt":var h=Z.macroModeState;if(h.isPlaying){var d=h.replaySearchQueries.shift();l(d,true,false)}else{_t(e,{onClose:c,prefix:a,desc:"(JavaScript regexp)",onKeyUp:u,onKeyDown:f})}break;case"wordUnderCursor":var p=it(e,{noSymbol:true});var v=true;if(!p){p=it(e,{noSymbol:false});v=false}if(!p){Pt(e,"No word under cursor");pe(e);return}var d=e.getLine(p.start.line).substring(p.start.ch,p.end.ch);if(v&&i){d="\\b"+d+"\\b"}else{d=je(d)}Z.jumpList.cachedCursor=e.getCursor();e.setCursor(p.start);l(d,true,false);break}},processEx:function(e,t,r){function n(t){Z.exCommandHistoryController.pushInput(t);Z.exCommandHistoryController.reset();Yt.processCommand(e,t);if(e.state.vim)pe(e)}function i(t,r,n){var i=ue(t),a,o;if(i=="<Esc>"||i=="<C-c>"||i=="<C-[>"||i=="<BS>"&&r==""){Z.exCommandHistoryController.pushInput(r);Z.exCommandHistoryController.reset();m.e_stop(t);pe(e);n();e.focus()}if(i=="<Up>"||i=="<Down>"){m.e_stop(t);a=i=="<Up>"?true:false;o=t.target?t.target.selectionEnd:0;r=Z.exCommandHistoryController.nextMatch(r,a)||"";n(r);if(o&&t.target)t.target.selectionEnd=t.target.selectionStart=Math.min(o,t.target.value.length)}else if(i=="<C-u>"){m.e_stop(t);n("")}else if(i&&i!="<Left>"&&i!="<Right>"){Z.exCommandHistoryController.reset()}}if(r.type=="keyToEx"){Yt.processCommand(e,r.exArgs.input)}else{if(t.visualMode){_t(e,{onClose:n,prefix:":",value:"'<,'>",onKeyDown:i,selectValueOnOpen:false})}else{_t(e,{onClose:n,prefix:":",onKeyDown:i})}}},evalInput:function(e,t){var r=t.inputState;var n=r.motion;var i=r.motionArgs||{};var a=r.operator;var o=r.operatorArgs||{};var s=r.registerName;var l=t.sel;var c=Ke(t.visualMode?Ee(e,l.head):e.getCursor("head"));var u=Ke(t.visualMode?Ee(e,l.anchor):e.getCursor("anchor"));var f=Ke(c);var h=Ke(u);var d,p;var v;if(a){this.recordLastEdit(t,r)}if(r.repeatOverride!==undefined){v=r.repeatOverride}else{v=r.getRepeat()}if(v>0&&i.explicitRepeat){i.repeatIsExplicit=true}else if(i.noRepeat||!i.explicitRepeat&&v===0){v=1;i.repeatIsExplicit=false}if(r.selectedCharacter){i.selectedCharacter=o.selectedCharacter=r.selectedCharacter}i.repeat=v;pe(e);if(n){var m=ke[n](e,c,i,t,r);t.lastMotion=ke[n];if(!m){return}if(i.toJumplist){if(!a&&e.ace.curOp!=null)e.ace.curOp.command.scrollIntoView="center-animate";var g=Z.jumpList;var y=g.cachedCursor;if(y){ot(e,y,m);delete g.cachedCursor}else{ot(e,c,m)}}if(m instanceof Array){p=m[0];d=m[1]}else{d=m}if(!d){d=Ke(c)}if(t.visualMode){if(!(t.visualBlock&&d.ch===Infinity)){d=Ee(e,d,f)}if(p){p=Ee(e,p)}p=p||h;l.anchor=p;l.head=d;Xe(e);mt(e,t,"<",He(p,d)?p:d);mt(e,t,">",He(p,d)?d:p)}else if(!a){if(e.ace.curOp)e.ace.curOp.vimDialogScroll="center-animate";d=Ee(e,d,f);e.setCursor(d.line,d.ch)}}if(a){if(o.lastSel){p=h;var w=o.lastSel;var S=Math.abs(w.head.line-w.anchor.line);var x=Math.abs(w.head.ch-w.anchor.ch);if(w.visualLine){d=new C(h.line+S,h.ch)}else if(w.visualBlock){d=new C(h.line+S,h.ch+x)}else if(w.head.line==w.anchor.line){d=new C(h.line,h.ch+x)}else{d=new C(h.line+S,h.ch)}t.visualMode=true;t.visualLine=w.visualLine;t.visualBlock=w.visualBlock;l=t.sel={anchor:p,head:d};Xe(e)}else if(t.visualMode){o.lastSel={anchor:Ke(l.anchor),head:Ke(l.head),visualBlock:t.visualBlock,visualLine:t.visualLine}}var M,b,A,L;var E;if(t.visualMode){M=_e(l.head,l.anchor);b=$e(l.head,l.anchor);A=t.visualLine||o.linewise;L=t.visualBlock?"block":A?"line":"char";var T=k(e,M,b);E=Ze(e,{anchor:T.start,head:T.end},L);if(A){var O=E.ranges;if(L=="block"){for(var R=0;R<O.length;R++){O[R].head.ch=Ve(e,O[R].head.line)}}else if(L=="line"){O[0].head=new C(O[0].head.line+1,0)}}}else{M=Ke(p||h);b=Ke(d||f);if(He(b,M)){var B=M;M=b;b=B}A=i.linewise||o.linewise;if(A){rt(e,M,b)}else if(i.forward){tt(e,M,b)}L="char";var I=!i.inclusive||A;var T=k(e,M,b);E=Ze(e,{anchor:T.start,head:T.end},L,I)}e.setSelections(E.ranges,E.primary);t.lastMotion=null;o.repeat=v;o.registerName=s;o.linewise=A;var N=Me[a](e,o,E.ranges,h,d);if(t.visualMode){et(e,N!=null)}if(N){e.setCursor(N)}}},recordLastEdit:function(e,t,r){var n=Z.macroModeState;if(n.isPlaying){return}e.lastEditInputState=t;e.lastEditActionCommand=r;n.lastInsertModeChanges.changes=[];n.lastInsertModeChanges.expectCursorActivityForChange=false;n.lastInsertModeChanges.visualBlock=e.visualBlock?e.sel.head.line-e.sel.anchor.line:0}};var ke={moveToTopLine:function(e,t,r){var n=qt(e).top+r.repeat-1;return new C(n,nt(e.getLine(n)))},moveToMiddleLine:function(e){var t=qt(e);var r=Math.floor((t.top+t.bottom)*.5);return new C(r,nt(e.getLine(r)))},moveToBottomLine:function(e,t,r){var n=qt(e).bottom-r.repeat+1;return new C(n,nt(e.getLine(n)))},expandToLine:function(e,t,r){var n=t;return new C(n.line+r.repeat-1,Infinity)},findNext:function(e,t,r){var n=Mt(e);var i=n.getQuery();if(!i){return}var a=!r.forward;a=n.isReversed()?!a:a;jt(e,i);return Ft(e,a,i,r.repeat)},findAndSelectNextInclusive:function(e,t,r,n,i){var a=Mt(e);var o=a.getQuery();if(!o){return}var s=!r.forward;s=a.isReversed()?!s:s;var l=Ut(e,s,o,r.repeat,n);if(!l){return}if(i.operator){return l}var c=l[0];var u=new C(l[1].line,l[1].ch-1);if(n.visualMode){if(n.visualLine||n.visualBlock){n.visualLine=false;n.visualBlock=false;m.signal(e,"vim-mode-change",{mode:"visual",subMode:""})}var f=n.sel.anchor;if(f){if(a.isReversed()){if(r.forward){return[f,c]}return[f,u]}else{if(r.forward){return[f,u]}return[f,c]}}}else{n.visualMode=true;n.visualLine=false;n.visualBlock=false;m.signal(e,"vim-mode-change",{mode:"visual",subMode:""})}return s?[u,c]:[c,u]},goToMark:function(e,t,r,n){var i=Jt(e,n,r.selectedCharacter);if(i){return r.linewise?{line:i.line,ch:nt(e.getLine(i.line))}:i}return null},moveToOtherHighlightedEnd:function(e,t,r,n){if(n.visualBlock&&r.sameLine){var i=n.sel;return[Ee(e,new C(i.anchor.line,i.head.ch)),Ee(e,new C(i.head.line,i.anchor.ch))]}else{return[n.sel.head,n.sel.anchor]}},jumpToMark:function(e,t,r,n){var i=t;for(var a=0;a<r.repeat;a++){var o=i;for(var s in n.marks){if(!H(s)){continue}var l=n.marks[s].find();var c=r.forward?He(l,o):He(o,l);if(c){continue}if(r.linewise&&l.line==o.line){continue}var u=Pe(o,i);var f=r.forward?De(o,l,i):De(i,l,o);if(u||f){i=l}}}if(r.linewise){i=new C(i.line,nt(e.getLine(i.line)))}return i},moveByCharacters:function(e,t,r){var n=t;var i=r.repeat;var a=r.forward?n.ch+i:n.ch-i;return new C(n.line,a)},moveByLines:function(e,t,r,n){var i=t;var a=i.ch;switch(n.lastMotion){case this.moveByLines:case this.moveByDisplayLines:case this.moveByScroll:case this.moveToColumn:case this.moveToEol:a=n.lastHPos;break;default:n.lastHPos=a}var o=r.repeat+(r.repeatOffset||0);var s=r.forward?i.line+o:i.line-o;var l=e.firstLine();var c=e.lastLine();if(s<l&&i.line==l){return this.moveToStartOfLine(e,t,r,n)}else if(s>c&&i.line==c){return dt(e,t,r,n,true)}var u=e.ace.session.getFoldLine(s);if(u){if(r.forward){if(s>u.start.row)s=u.end.row+1}else{s=u.start.row}}if(r.toFirstChar){a=nt(e.getLine(s));n.lastHPos=a}n.lastHSPos=e.charCoords(new C(s,a),"div").left;return new C(s,a)},moveByDisplayLines:function(e,t,r,n){var i=t;switch(n.lastMotion){case this.moveByDisplayLines:case this.moveByScroll:case this.moveByLines:case this.moveToColumn:case this.moveToEol:break;default:n.lastHSPos=e.charCoords(i,"div").left}var a=r.repeat;var o=e.findPosV(i,r.forward?a:-a,"line",n.lastHSPos);if(o.hitSide){if(r.forward){var s=e.charCoords(o,"div");var l={top:s.top+8,left:n.lastHSPos};var o=e.coordsChar(l,"div")}else{var c=e.charCoords(new C(e.firstLine(),0),"div");c.left=n.lastHSPos;o=e.coordsChar(c,"div")}}n.lastHPos=o.ch;return o},moveByPage:function(e,t,r){var n=t;var i=r.repeat;return e.findPosV(n,r.forward?i:-i,"page")},moveByParagraph:function(e,t,r){var n=r.forward?1:-1;return yt(e,t,r.repeat,n)},moveBySentence:function(e,t,r){var n=r.forward?1:-1;return Ct(e,t,r.repeat,n)},moveByScroll:function(e,t,r,n){var i=e.getScrollInfo();var a=null;var o=r.repeat;if(!o){o=i.clientHeight/(2*e.defaultTextHeight())}var s=e.charCoords(t,"local");r.repeat=o;a=ke.moveByDisplayLines(e,t,r,n);if(!a){return null}var l=e.charCoords(a,"local");e.scrollTo(null,i.top+l.top-s.top);return a},moveByWords:function(e,t,r){return ht(e,t,r.repeat,!!r.forward,!!r.wordEnd,!!r.bigWord)},moveTillCharacter:function(e,t,r){var n=r.repeat;var i=pt(e,n,r.forward,r.selectedCharacter,t);var a=r.forward?-1:1;st(a,r);if(!i)return null;i.ch+=a;return i},moveToCharacter:function(e,t,r){var n=r.repeat;st(0,r);return pt(e,n,r.forward,r.selectedCharacter,t)||t},moveToSymbol:function(e,t,r){var n=r.repeat;return ut(e,n,r.forward,r.selectedCharacter)||t},moveToColumn:function(e,t,r,n){var i=r.repeat;n.lastHPos=i-1;n.lastHSPos=e.charCoords(t,"div").left;return vt(e,i)},moveToEol:function(e,t,r,n){return dt(e,t,r,n,false)},moveToFirstNonWhiteSpaceCharacter:function(e,t){var r=t;return new C(r.line,nt(e.getLine(r.line)))},moveToMatchedSymbol:function(e,t){var r=t;var n=r.line;var i=r.ch;var a=e.getLine(n);var o;for(;i<a.length;i++){o=a.charAt(i);if(o&&_(o)){var s=e.getTokenTypeAt(new C(n,i+1));if(s!=="string"&&s!=="comment"){break}}}if(i<a.length){var l=/[<>]/.test(a[i])?/[(){}[\]<>]/:/[(){}[\]]/;var c=e.findMatchingBracket(new C(n,i+1),{bracketRegex:l});return c.to}else{return r}},moveToStartOfLine:function(e,t){return new C(t.line,0)},moveToLineOrEdgeOfDocument:function(e,t,r){var n=r.forward?e.lastLine():e.firstLine();if(r.repeatIsExplicit){n=r.repeat-e.getOption("firstLineNumber")}return new C(n,nt(e.getLine(n)))},moveToStartOfDisplayLine:function(e){e.execCommand("goLineLeft");return e.getCursor()},moveToEndOfDisplayLine:function(e){e.execCommand("goLineRight");var t=e.getCursor();if(t.sticky=="before")t.ch--;return t},textObjectManipulation:function(e,t,r,n){var i={"(":")",")":"(","{":"}","}":"{","[":"]","]":"[","<":">",">":"<"};var a={"'":true,'"':true,"`":true};var o=r.selectedCharacter;if(o=="b"){o="("}else if(o=="B"){o="{"}var s=!r.textObjectInner;var l,c;if(i[o]){c=true;l=kt(e,t,o,s);if(!l){var u=e.getSearchCursor(new RegExp("\\"+o,"g"),t);if(u.find()){l=kt(e,u.from(),o,s)}}}else if(a[o]){c=true;l=St(e,t,o,s)}else if(o==="W"||o==="w"){var f=r.repeat||1;while(f-- >0){var h=it(e,{inclusive:s,innerWord:!s,bigWord:o==="W",noSymbol:o==="W",multiline:true},l&&l.end);if(h){if(!l)l=h;l.end=h.end}}}else if(o==="p"){l=yt(e,t,r.repeat,0,s);r.linewise=true;if(n.visualMode){if(!n.visualLine){n.visualLine=true}}else{var d=n.inputState.operatorArgs;if(d){d.linewise=true}l.end.line--}}else if(o==="t"){l=at(e,t,s)}else if(o==="s"){var p=e.getLine(t.line);if(t.ch>0&&W(p[t.ch])){t.ch-=1}var v=wt(e,t,r.repeat,1,s);var m=wt(e,t,r.repeat,-1,s);if(V(e.getLine(m.line)[m.ch])&&V(e.getLine(v.line)[v.ch-1])){m={line:m.line,ch:m.ch+1}}l={start:m,end:v}}if(!l){return null}if(!e.state.vim.visualMode){return[l.start,l.end]}else{return Ge(e,l.start,l.end,c)}},repeatLastCharacterSearch:function(e,t,r){var n=Z.lastCharacterSearch;var i=r.repeat;var a=r.forward===n.forward;var o=(n.increment?1:0)*(a?-1:1);e.moveH(-o,"char");r.inclusive=a?true:false;var s=pt(e,i,a,n.selectedCharacter);if(!s){e.moveH(o,"char");return t}s.ch+=o;return s}};function Se(e,t){ke[e]=t}function xe(e,t){var r=[];for(var n=0;n<t;n++){r.push(e)}return r}var Me={change:function(e,t,r){var n,i;var a=e.state.vim;var o=r[0].anchor,s=r[0].head;if(!a.visualMode){i=e.getRange(o,s);var l=a.lastEditInputState||{};if(l.motion=="moveByWords"&&!V(i)){var c=/\s+$/.exec(i);if(c&&l.motionArgs&&l.motionArgs.forward){s=Oe(s,0,-c[0].length);i=i.slice(0,-c[0].length)}}if(t.linewise){o=new C(o.line,nt(e.getLine(o.line)));if(s.line>o.line){s=new C(s.line-1,Number.MAX_VALUE)}}e.replaceRange("",o,s);n=o}else if(t.fullLine){s.ch=Number.MAX_VALUE;s.line--;e.setSelection(o,s);i=e.getSelection();e.replaceSelection("");n=o}else{i=e.getSelection();var u=xe("",r.length);e.replaceSelections(u);n=_e(r[0].head,r[0].anchor)}Z.registerController.pushText(t.registerName,"change",i,t.linewise,r.length>1);Ae.enterInsertMode(e,{head:n},e.state.vim)},delete:function(e,t,r){var n,i;var a=e.state.vim;if(!a.visualBlock){var o=r[0].anchor,s=r[0].head;if(t.linewise&&s.line!=e.firstLine()&&o.line==e.lastLine()&&o.line==s.line-1){if(o.line==e.firstLine()){o.ch=0}else{o=new C(o.line-1,Ve(e,o.line-1))}}i=e.getRange(o,s);e.replaceRange("",o,s);n=o;if(t.linewise){n=ke.moveToFirstNonWhiteSpaceCharacter(e,o)}}else{i=e.getSelection();var l=xe("",r.length);e.replaceSelections(l);n=_e(r[0].head,r[0].anchor)}Z.registerController.pushText(t.registerName,"delete",i,t.linewise,a.visualBlock);return Ee(e,n)},indent:function(e,t,r){var n=e.state.vim;if(e.indentMore){var i=n.visualMode?t.repeat:1;for(var a=0;a<i;a++){if(t.indentRight)e.indentMore();else e.indentLess()}}else{var o=r[0].anchor.line;var s=n.visualBlock?r[r.length-1].anchor.line:r[0].head.line;var i=n.visualMode?t.repeat:1;if(t.linewise){s--}for(var l=o;l<=s;l++){for(var a=0;a<i;a++){e.indentLine(l,t.indentRight)}}}return ke.moveToFirstNonWhiteSpaceCharacter(e,r[0].anchor)},indentAuto:function(e,t,r){e.execCommand("indentAuto");return ke.moveToFirstNonWhiteSpaceCharacter(e,r[0].anchor)},hardWrap:function(e,t,r,n,i){if(!e.hardWrap)return;var a=r[0].anchor.line;var o=r[0].head.line;if(t.linewise)o--;var s=e.hardWrap({from:a,to:o});if(s>a&&t.linewise)s--;return t.keepCursor?n:new C(s,0)},changeCase:function(e,t,r,n,i){var a=e.getSelections();var o=[];var s=t.toLower;for(var l=0;l<a.length;l++){var c=a[l];var u="";if(s===true){u=c.toLowerCase()}else if(s===false){u=c.toUpperCase()}else{for(var f=0;f<c.length;f++){var h=c.charAt(f);u+=D(h)?h.toLowerCase():h.toUpperCase()}}o.push(u)}e.replaceSelections(o);if(t.shouldMoveCursor){return i}else if(!e.state.vim.visualMode&&t.linewise&&r[0].anchor.line+1==r[0].head.line){return ke.moveToFirstNonWhiteSpaceCharacter(e,n)}else if(t.linewise){return n}else{return _e(r[0].anchor,r[0].head)}},yank:function(e,t,r,n){var i=e.state.vim;var a=e.getSelection();var o=i.visualMode?_e(i.sel.anchor,i.sel.head,r[0].head,r[0].anchor):n;Z.registerController.pushText(t.registerName,"yank",a,t.linewise,i.visualBlock);return o}};function be(e,t){Me[e]=t}var Ae={jumpListWalk:function(e,t,r){if(r.visualMode){return}var n=t.repeat;var i=t.forward;var a=Z.jumpList;var o=a.move(e,i?n:-n);var s=o?o.find():undefined;s=s?s:e.getCursor();e.setCursor(s);e.ace.curOp.command.scrollIntoView="center-animate"},scroll:function(e,t,r){if(r.visualMode){return}var n=t.repeat||1;var i=e.defaultTextHeight();var a=e.getScrollInfo().top;var o=i*n;var s=t.forward?a+o:a-o;var l=Ke(e.getCursor());var c=e.charCoords(l,"local");if(t.forward){if(s>c.top){l.line+=(s-c.top)/i;l.line=Math.ceil(l.line);e.setCursor(l);c=e.charCoords(l,"local");e.scrollTo(null,c.top)}else{e.scrollTo(null,s)}}else{var u=s+e.getScrollInfo().clientHeight;if(u<c.bottom){l.line-=(c.bottom-u)/i;l.line=Math.floor(l.line);e.setCursor(l);c=e.charCoords(l,"local");e.scrollTo(null,c.bottom-e.getScrollInfo().clientHeight)}else{e.scrollTo(null,s)}}},scrollToCursor:function(e,t){var r=e.getCursor().line;var n=e.charCoords(new C(r,0),"local");var i=e.getScrollInfo().clientHeight;var a=n.top;switch(t.position){case"center":a=n.bottom-i/2;break;case"bottom":var o=new C(r,e.getLine(r).length-1);var s=e.charCoords(o,"local");var l=s.bottom-a;a=a-i+l;break}e.scrollTo(null,a)},replayMacro:function(e,t,r){var n=t.selectedCharacter;var i=t.repeat;var a=Z.macroModeState;if(n=="@"){n=a.latestRegister}else{a.latestRegister=n}while(i--){ir(e,r,a,n)}},enterMacroRecordMode:function(e,t){var r=Z.macroModeState;var n=t.selectedCharacter;if(Z.registerController.isValidRegister(n)){r.enterMacroRecordMode(e,n)}},toggleOverwrite:function(e){if(!e.state.overwrite){e.toggleOverwrite(true);e.setOption("keyMap","vim-replace");m.signal(e,"vim-mode-change",{mode:"replace"})}else{e.toggleOverwrite(false);e.setOption("keyMap","vim-insert");m.signal(e,"vim-mode-change",{mode:"insert"})}},enterInsertMode:function(e,t,r){if(e.getOption("readOnly")){return}r.insertMode=true;r.insertModeRepeat=t&&t.repeat||1;var n=t?t.insertAt:null;var i=r.sel;var a=t.head||e.getCursor("head");var o=e.listSelections().length;if(n=="eol"){a=new C(a.line,Ve(e,a.line))}else if(n=="bol"){a=new C(a.line,0)}else if(n=="charAfter"){var s=k(e,a,Oe(a,0,1));a=s.end}else if(n=="firstNonBlank"){var s=k(e,a,ke.moveToFirstNonWhiteSpaceCharacter(e,a));a=s.end}else if(n=="startOfSelectedArea"){if(!r.visualMode)return;if(!r.visualBlock){if(i.head.line<i.anchor.line){a=i.head}else{a=new C(i.anchor.line,0)}}else{a=new C(Math.min(i.head.line,i.anchor.line),Math.min(i.head.ch,i.anchor.ch));o=Math.abs(i.head.line-i.anchor.line)+1}}else if(n=="endOfSelectedArea"){if(!r.visualMode)return;if(!r.visualBlock){if(i.head.line>=i.anchor.line){a=Oe(i.head,0,1)}else{a=new C(i.anchor.line,0)}}else{a=new C(Math.min(i.head.line,i.anchor.line),Math.max(i.head.ch,i.anchor.ch)+1);o=Math.abs(i.head.line-i.anchor.line)+1}}else if(n=="inplace"){if(r.visualMode){return}}else if(n=="lastEdit"){a=Gt(e)||a}e.setOption("disableInput",false);if(t&&t.replace){e.toggleOverwrite(true);e.setOption("keyMap","vim-replace");m.signal(e,"vim-mode-change",{mode:"replace"})}else{e.toggleOverwrite(false);e.setOption("keyMap","vim-insert");m.signal(e,"vim-mode-change",{mode:"insert"})}if(!Z.macroModeState.isPlaying){e.on("change",lr);if(r.insertEnd)r.insertEnd.clear();r.insertEnd=e.setBookmark(a,{insertLeft:true});m.on(e.getInputField(),"keydown",hr)}if(r.visualMode){et(e)}ze(e,a,o)},toggleVisualMode:function(e,t,r){var n=t.repeat;var i=e.getCursor();var a;if(!r.visualMode){r.visualMode=true;r.visualLine=!!t.linewise;r.visualBlock=!!t.blockwise;a=Ee(e,new C(i.line,i.ch+n-1));var o=k(e,i,a);r.sel={anchor:o.start,head:o.end};m.signal(e,"vim-mode-change",{mode:"visual",subMode:r.visualLine?"linewise":r.visualBlock?"blockwise":""});Xe(e);mt(e,r,"<",_e(i,a));mt(e,r,">",$e(i,a))}else if(r.visualLine^t.linewise||r.visualBlock^t.blockwise){r.visualLine=!!t.linewise;r.visualBlock=!!t.blockwise;m.signal(e,"vim-mode-change",{mode:"visual",subMode:r.visualLine?"linewise":r.visualBlock?"blockwise":""});Xe(e)}else{et(e)}},reselectLastSelection:function(e,t,r){var n=r.lastSelection;if(r.visualMode){Je(e,r)}if(n){var i=n.anchorMark.find();var a=n.headMark.find();if(!i||!a){return}r.sel={anchor:i,head:a};r.visualMode=true;r.visualLine=n.visualLine;r.visualBlock=n.visualBlock;Xe(e);mt(e,r,"<",_e(i,a));mt(e,r,">",$e(i,a));m.signal(e,"vim-mode-change",{mode:"visual",subMode:r.visualLine?"linewise":r.visualBlock?"blockwise":""})}},joinLines:function(e,t,r){var n,i;if(r.visualMode){n=e.getCursor("anchor");i=e.getCursor("head");if(He(i,n)){var a=i;i=n;n=a}i.ch=Ve(e,i.line)-1}else{var o=Math.max(t.repeat,2);n=e.getCursor();i=Ee(e,new C(n.line+o-1,Infinity))}var s=0;for(var l=n.line;l<i.line;l++){s=Ve(e,n.line);var c="";var u=0;if(!t.keepSpaces){var f=e.getLine(n.line+1);u=f.search(/\S/);if(u==-1){u=f.length}else{c=" "}}e.replaceRange(c,new C(n.line,s),new C(n.line+1,u))}var h=Ee(e,new C(n.line,s));if(r.visualMode){et(e,false)}e.setCursor(h)},newLineAndEnterInsertMode:function(e,t,r){r.insertMode=true;var n=Ke(e.getCursor());if(n.line===e.firstLine()&&!t.after){e.replaceRange("\n",new C(e.firstLine(),0));e.setCursor(e.firstLine(),0)}else{n.line=t.after?n.line:n.line-1;n.ch=Ve(e,n.line);e.setCursor(n);var i=m.commands.newlineAndIndentContinueComment||m.commands.newlineAndIndent;i(e)}this.enterInsertMode(e,{repeat:t.repeat},r)},paste:function(e,t,r){var n=this;var i=Z.registerController.getRegister(t.registerName);var a=function(){var a=i.toString();n.continuePaste(e,t,r,a,i)};if(t.registerName==="+"&&typeof navigator!=="undefined"&&typeof navigator.clipboard!=="undefined"&&typeof navigator.clipboard.readText==="function"){navigator.clipboard.readText().then(function(a){n.continuePaste(e,t,r,a,i)},function(){a()})}else{a()}},continuePaste:function(e,t,r,n,i){var a=Ke(e.getCursor());if(!n){return}if(t.matchIndent){var o=e.getOption("tabSize");var s=function(e){var t=e.split("\t").length-1;var r=e.split(" ").length-1;return t*o+r*1};var l=e.getLine(e.getCursor().line);var c=s(l.match(/^\s*/)[0]);var u=n.replace(/\n$/,"");var f=n!==u;var h=s(n.match(/^\s*/)[0]);var n=u.replace(/^\s*/gm,function(t){var r=c+(s(t)-h);if(r<0){return""}else if(e.getOption("indentWithTabs")){var n=Math.floor(r/o);return Array(n+1).join("\t")}else{return Array(r+1).join(" ")}});n+=f?"\n":""}if(t.repeat>1){var n=Array(t.repeat+1).join(n)}var d=i.linewise;var p=i.blockwise;if(p){n=n.split("\n");if(d){n.pop()}for(var v=0;v<n.length;v++){n[v]=n[v]==""?" ":n[v]}a.ch+=t.after?1:0;a.ch=Math.min(Ve(e,a.line),a.ch)}else if(d){if(r.visualMode){n=r.visualLine?n.slice(0,-1):"\n"+n.slice(0,n.length-1)+"\n"}else if(t.after){n="\n"+n.slice(0,n.length-1);a.ch=Ve(e,a.line)}else{a.ch=0}}else{a.ch+=t.after?1:0}var m;if(r.visualMode){r.lastPastedText=n;var g;var y=qe(e,r);var w=y[0];var k=y[1];var S=e.getSelection();var x=e.listSelections();var M=new Array(x.length).join("1").split("1");if(r.lastSelection){g=r.lastSelection.headMark.find()}Z.registerController.unnamedRegister.setText(S);if(p){e.replaceSelections(M);k=new C(w.line+n.length-1,w.ch);e.setCursor(w);Ue(e,k);e.replaceSelections(n);m=w}else if(r.visualBlock){e.replaceSelections(M);e.setCursor(w);e.replaceRange(n,w,w);m=w}else{e.replaceRange(n,w,k);m=e.posFromIndex(e.indexFromPos(w)+n.length-1)}if(g){r.lastSelection.headMark=e.setBookmark(g)}if(d){m.ch=0}}else{if(p){e.setCursor(a);for(var v=0;v<n.length;v++){var b=a.line+v;if(b>e.lastLine()){e.replaceRange("\n",new C(b,0))}var A=Ve(e,b);if(A<a.ch){Fe(e,b,a.ch)}}e.setCursor(a);Ue(e,new C(a.line+n.length-1,a.ch));e.replaceSelections(n);m=a}else{e.replaceRange(n,a);if(d){var b=t.after?a.line+1:a.line;m=new C(b,nt(e.getLine(b)))}else{m=Ke(a);if(!/\n/.test(n)){m.ch+=n.length-(t.after?1:0)}}}}if(r.visualMode){et(e,false)}e.setCursor(m)},undo:function(e,t){e.operation(function(){Ne(e,m.commands.undo,t.repeat)();e.setCursor(Ee(e,e.getCursor("start")))})},redo:function(e,t){Ne(e,m.commands.redo,t.repeat)()},setRegister:function(e,t,r){r.inputState.registerName=t.selectedCharacter},insertRegister:function(e,t,r){var n=t.selectedCharacter;var i=Z.registerController.getRegister(n);var a=i&&i.toString();if(a){e.replaceSelection(a)}},oneNormalCommand:function(e,t,r){tr(e,true);r.insertModeReturn=true;m.on(e,"vim-command-done",function t(){if(r.visualMode)return;if(r.insertModeReturn){r.insertModeReturn=false;if(!r.insertMode){Ae.enterInsertMode(e,{},r)}}m.off(e,"vim-command-done",t)})},setMark:function(e,t,r){var n=t.selectedCharacter;mt(e,r,n,e.getCursor())},replace:function(e,t,r){var n=t.selectedCharacter;var i=e.getCursor();var a;var o;var s=e.listSelections();if(r.visualMode){i=e.getCursor("start");o=e.getCursor("end")}else{var l=e.getLine(i.line);a=i.ch+t.repeat;if(a>l.length){a=l.length}o=new C(i.line,a)}var c=k(e,i,o);i=c.start;o=c.end;if(n=="\n"){if(!r.visualMode)e.replaceRange("",i,o);(m.commands.newlineAndIndentContinueComment||m.commands.newlineAndIndent)(e)}else{var u=e.getRange(i,o);u=u.replace(/[\uD800-\uDBFF][\uDC00-\uDFFF]/g,n);u=u.replace(/[^\n]/g,n);if(r.visualBlock){var f=new Array(e.getOption("tabSize")+1).join(" ");u=e.getSelection();u=u.replace(/[\uD800-\uDBFF][\uDC00-\uDFFF]/g,n);u=u.replace(/\t/g,f).replace(/[^\n]/g,n).split("\n");e.replaceSelections(u)}else{e.replaceRange(u,i,o)}if(r.visualMode){i=He(s[0].anchor,s[0].head)?s[0].anchor:s[0].head;e.setCursor(i);et(e,false)}else{e.setCursor(Oe(o,0,-1))}}},incrementNumberToken:function(e,t){var r=e.getCursor();var n=e.getLine(r.line);var i=/(-?)(?:(0x)([\da-f]+)|(0b|0|)(\d+))/gi;var a;var o;var s;var l;while((a=i.exec(n))!==null){o=a.index;s=o+a[0].length;if(r.ch<s)break}if(!t.backtrack&&s<=r.ch)return;if(a){var c=a[2]||a[4];var u=a[3]||a[5];var f=t.increase?1:-1;var h={"0b":2,0:8,"":10,"0x":16}[c.toLowerCase()];var d=parseInt(a[1]+u,h)+f*t.repeat;l=d.toString(h);var p=c?new Array(u.length-l.length+1+a[1].length).join("0"):"";if(l.charAt(0)==="-"){l="-"+c+p+l.substr(1)}else{l=c+p+l}var v=new C(r.line,o);var m=new C(r.line,s);e.replaceRange(l,v,m)}else{return}e.setCursor(new C(r.line,o+l.length-1))},repeatLastEdit:function(e,t,r){var n=r.lastEditInputState;if(!n){return}var i=t.repeat;if(i&&t.repeatIsExplicit){r.lastEditInputState.repeatOverride=i}else{i=r.lastEditInputState.repeatOverride||i}dr(e,r,i,false)},indent:function(e,t){e.indentLine(e.getCursor().line,t.indentRight)},exitInsertMode:tr};function Le(e,t){Ae[e]=t}function Ee(e,t,r){var n=e.state.vim;var i=n.insertMode||n.visualMode;var a=Math.min(Math.max(e.firstLine(),t.line),e.lastLine());var o=e.getLine(a);var s=o.length-1+Number(!!i);var l=Math.min(Math.max(0,t.ch),s);var c=o.charCodeAt(l);if(56320<=c&&c<=57343){var u=1;if(r&&r.line==a&&r.ch>l){u=-1}l+=u;if(l>s)l-=2}return new C(a,l)}function Te(e){var t={};for(var r in e){if(e.hasOwnProperty(r)){t[r]=e[r]}}return t}function Oe(e,t,r){if(typeof t==="object"){r=t.ch;t=t.line}return new C(e.line+t,e.ch+r)}function Re(e,t,r,n){if(n.operator)r="operatorPending";var i,a=[],o=[];var s=ne?t.length-x:0;for(var l=s;l<t.length;l++){var c=t[l];if(r=="insert"&&c.context!="insert"||c.context&&c.context!=r||n.operator&&c.type=="action"||!(i=Be(e,c.keys))){continue}if(i=="partial"){a.push(c)}if(i=="full"){o.push(c)}}return{partial:a.length&&a,full:o.length&&o}}function Be(e,t){var r=t.slice(-11)=="<character>";var n=t.slice(-10)=="<register>";if(r||n){var i=t.length-(r?11:10);var a=e.slice(0,i);var o=t.slice(0,i);return a==o&&e.length>i?"full":o.indexOf(a)==0?"partial":false}else{return e==t?"full":t.indexOf(e)==0?"partial":false}}function Ie(e){var t=/^.*(<[^>]+>)$/.exec(e);var r=t?t[1]:e.slice(-1);if(r.length>1){switch(r){case"<CR>":r="\n";break;case"<Space>":r=" ";break;default:r="";break}}return r}function Ne(e,t,r){return function(){for(var n=0;n<r;n++){t(e)}}}function Ke(e){return new C(e.line,e.ch)}function Pe(e,t){return e.ch==t.ch&&e.line==t.line}function He(e,t){if(e.line<t.line){return true}if(e.line==t.line&&e.ch<t.ch){return true}return false}function _e(e,t){if(arguments.length>2){t=_e.apply(undefined,Array.prototype.slice.call(arguments,1))}return He(e,t)?e:t}function $e(e,t){if(arguments.length>2){t=$e.apply(undefined,Array.prototype.slice.call(arguments,1))}return He(e,t)?t:e}function De(e,t,r){var n=He(e,t);var i=He(t,r);return n&&i}function Ve(e,t){return e.getLine(t).length}function We(e){if(e.trim){return e.trim()}return e.replace(/^\s+|\s+$/g,"")}function je(e){return e.replace(/([.?*+$\[\]\/\\(){}|\-])/g,"\\$1")}function Fe(e,t,r){var n=Ve(e,t);var i=new Array(r-n+1).join(" ");e.setCursor(new C(t,n));e.replaceRange(i,e.getCursor())}function Ue(e,t){var r=[],n=e.listSelections();var i=Ke(e.clipPos(t));var a=!Pe(t,i);var o=e.getCursor("head");var s=Qe(n,o);var l=Pe(n[s].head,n[s].anchor);var c=n.length-1;var u=c-s>s?c:0;var f=n[u].anchor;var h=Math.min(f.line,i.line);var d=Math.max(f.line,i.line);var p=f.ch,v=i.ch;var m=n[u].head.ch-p;var g=v-p;if(m>0&&g<=0){p++;if(!a){v--}}else if(m<0&&g>=0){p--;if(!l){v++}}else if(m<0&&g==-1){p--;v++}for(var y=h;y<=d;y++){var w={anchor:new C(y,p),head:new C(y,v)};r.push(w)}e.setSelections(r);t.ch=v;f.ch=p;return f}function ze(e,t,r){var n=[];for(var i=0;i<r;i++){var a=Oe(t,i,0);n.push({anchor:a,head:a})}e.setSelections(n,0)}function Qe(e,t,r){for(var n=0;n<e.length;n++){var i=r!="head"&&Pe(e[n].anchor,t);var a=r!="anchor"&&Pe(e[n].head,t);if(i||a){return n}}return-1}function qe(e,t){var r=t.lastSelection;var n=function(){var t=e.listSelections();var r=t[0];var n=t[t.length-1];var i=He(r.anchor,r.head)?r.anchor:r.head;var a=He(n.anchor,n.head)?n.head:n.anchor;return[i,a]};var i=function(){var t=e.getCursor();var n=e.getCursor();var i=r.visualBlock;if(i){var a=i.width;var o=i.height;n=new C(t.line+o,t.ch+a);var s=[];for(var l=t.line;l<n.line;l++){var c=new C(l,t.ch);var u=new C(l,n.ch);var f={anchor:c,head:u};s.push(f)}e.setSelections(s)}else{var h=r.anchorMark.find();var d=r.headMark.find();var p=d.line-h.line;var v=d.ch-h.ch;n={line:n.line+p,ch:p?n.ch:v+n.ch};if(r.visualLine){t=new C(t.line,0);n=new C(n.line,Ve(e,n.line))}e.setSelection(t,n)}return[t,n]};if(!t.visualMode){return i()}else{return n()}}function Je(e,t){var r=t.sel.anchor;var n=t.sel.head;if(t.lastPastedText){n=e.posFromIndex(e.indexFromPos(r)+t.lastPastedText.length);t.lastPastedText=null}t.lastSelection={anchorMark:e.setBookmark(r),headMark:e.setBookmark(n),anchor:Ke(r),head:Ke(n),visualMode:t.visualMode,visualLine:t.visualLine,visualBlock:t.visualBlock}}function Ge(e,t,r,n){var i=e.state.vim.sel;var a=n?t:i.head;var o=n?t:i.anchor;var s;if(He(r,t)){s=r;r=t;t=s}if(He(a,o)){a=_e(t,a);o=$e(o,r)}else{o=_e(t,o);a=$e(a,r);a=Oe(a,0,-1);if(a.ch==-1&&a.line!=e.firstLine()){a=new C(a.line-1,Ve(e,a.line-1))}}return[o,a]}function Xe(e,t,r){var n=e.state.vim;t=t||n.sel;var r=r||n.visualLine?"line":n.visualBlock?"block":"char";var i=Ze(e,t,r);e.setSelections(i.ranges,i.primary)}function Ze(e,t,r,n){var i=Ke(t.head);var a=Ke(t.anchor);if(r=="char"){var o=!n&&!He(t.head,t.anchor)?1:0;var s=He(t.head,t.anchor)?1:0;i=Oe(t.head,0,o);a=Oe(t.anchor,0,s);return{ranges:[{anchor:a,head:i}],primary:0}}else if(r=="line"){if(!He(t.head,t.anchor)){a.ch=0;var l=e.lastLine();if(i.line>l){i.line=l}i.ch=Ve(e,i.line)}else{i.ch=0;a.ch=Ve(e,a.line)}return{ranges:[{anchor:a,head:i}],primary:0}}else if(r=="block"){var c=Math.min(a.line,i.line),u=a.ch,f=Math.max(a.line,i.line),h=i.ch;if(u<h){h+=1}else{u+=1}var d=f-c+1;var p=i.line==c?0:d-1;var v=[];for(var m=0;m<d;m++){v.push({anchor:new C(c+m,u),head:new C(c+m,h)})}return{ranges:v,primary:p}}}function Ye(e){var t=e.getCursor("head");if(e.getSelection().length==1){t=_e(t,e.getCursor("anchor"))}return t}function et(e,t){var r=e.state.vim;if(t!==false){e.setCursor(Ee(e,r.sel.head))}Je(e,r);r.visualMode=false;r.visualLine=false;r.visualBlock=false;if(!r.insertMode)m.signal(e,"vim-mode-change",{mode:"normal"})}function tt(e,t,r){var n=e.getRange(t,r);if(/\n\s*$/.test(n)){var i=n.split("\n");i.pop();var a;for(var a=i.pop();i.length>0&&a&&V(a);a=i.pop()){r.line--;r.ch=0}if(a){r.line--;r.ch=Ve(e,r.line)}else{r.ch=0}}}function rt(e,t,r){t.ch=0;r.ch=0;r.line++}function nt(e){if(!e){return 0}var t=e.search(/\S/);return t==-1?e.length:t}function it(e,t,r){var n=t.inclusive,i=t.innerWord,a=t.bigWord,o=t.noSymbol,s=t.multiline;var l=r||Ye(e);var c=e.getLine(l.line);var u=c;var f=l.line;var h=f;var d=l.ch;var p;var v=o?O[0]:R[0];if(i&&/\s/.test(c.charAt(d))){v=function(e){return/\s/.test(e)}}else{while(!v(c.charAt(d))){d++;if(d>=c.length){if(!s)return null;d--;p=ft(e,l,true,a,true);break}}if(a){v=R[0]}else{v=O[0];if(!v(c.charAt(d))){v=O[1]}}}var m=d,g=d;while(v(c.charAt(g))&&g>=0){g--}g++;if(p){m=p.to;h=p.line;u=e.getLine(h);if(!u&&m==0)m++}else{while(v(c.charAt(m))&&m<c.length){m++}}if(n){var y=m;var w=l.ch<=g&&/\s/.test(c.charAt(l.ch));if(!w){while(/\s/.test(u.charAt(m))&&m<u.length){m++}}if(y==m||w){var k=g;while(/\s/.test(c.charAt(g-1))&&g>0){g--}if(!g&&!w){g=k}}}return{start:new C(f,g),end:new C(h,m)}}function at(e,t,r){var n=t;if(!m.findMatchingTag||!m.findEnclosingTag){return{start:n,end:n}}var i=m.findMatchingTag(e,t)||m.findEnclosingTag(e,t);if(!i||!i.open||!i.close){return{start:n,end:n}}if(r){return{start:i.open.from,end:i.close.to}}return{start:i.open.to,end:i.close.from}}function ot(e,t,r){if(!Pe(t,r)){Z.jumpList.add(e,t,r)}}function st(e,t){Z.lastCharacterSearch.increment=e;Z.lastCharacterSearch.forward=t.forward;Z.lastCharacterSearch.selectedCharacter=t.selectedCharacter}var lt={"(":"bracket",")":"bracket","{":"bracket","}":"bracket","[":"section","]":"section","*":"comment","/":"comment",m:"method",M:"method","#":"preprocess"};var ct={bracket:{isComplete:function(e){if(e.nextCh===e.symb){e.depth++;if(e.depth>=1)return true}else if(e.nextCh===e.reverseSymb){e.depth--}return false}},section:{init:function(e){e.curMoveThrough=true;e.symb=(e.forward?"]":"[")===e.symb?"{":"}"},isComplete:function(e){return e.index===0&&e.nextCh===e.symb}},comment:{isComplete:function(e){var t=e.lastCh==="*"&&e.nextCh==="/";e.lastCh=e.nextCh;return t}},method:{init:function(e){e.symb=e.symb==="m"?"{":"}";e.reverseSymb=e.symb==="{"?"}":"{"},isComplete:function(e){if(e.nextCh===e.symb)return true;return false}},preprocess:{init:function(e){e.index=0},isComplete:function(e){if(e.nextCh==="#"){var t=e.lineText.match(/^#(\w+)/)[1];if(t==="endif"){if(e.forward&&e.depth===0){return true}e.depth++}else if(t==="if"){if(!e.forward&&e.depth===0){return true}e.depth--}if(t==="else"&&e.depth===0)return true}return false}}};function ut(e,t,r,n){var i=Ke(e.getCursor());var a=r?1:-1;var o=r?e.lineCount():-1;var s=i.ch;var l=i.line;var c=e.getLine(l);var u={lineText:c,nextCh:c.charAt(s),lastCh:null,index:s,symb:n,reverseSymb:(r?{")":"(","}":"{"}:{"(":")","{":"}"})[n],forward:r,depth:0,curMoveThrough:false};var f=lt[n];if(!f)return i;var h=ct[f].init;var d=ct[f].isComplete;if(h){h(u)}while(l!==o&&t){u.index+=a;u.nextCh=u.lineText.charAt(u.index);if(!u.nextCh){l+=a;u.lineText=e.getLine(l)||"";if(a>0){u.index=0}else{var p=u.lineText.length;u.index=p>0?p-1:0}u.nextCh=u.lineText.charAt(u.index)}if(d(u)){i.line=l;i.ch=u.index;t--}}if(u.nextCh||u.curMoveThrough){return new C(l,u.index)}return i}function ft(e,t,r,n,i){var a=t.line;var o=t.ch;var s=e.getLine(a);var l=r?1:-1;var c=n?R:O;if(i&&s==""){a+=l;s=e.getLine(a);if(!P(e,a)){return null}o=r?0:s.length}while(true){if(i&&s==""){return{from:0,to:0,line:a}}var u=l>0?s.length:-1;var f=u,h=u;while(o!=u){var d=false;for(var p=0;p<c.length&&!d;++p){if(c[p](s.charAt(o))){f=o;while(o!=u&&c[p](s.charAt(o))){o+=l}h=o;d=f!=h;if(f==t.ch&&a==t.line&&h==f+l){continue}else{return{from:Math.min(f,h+1),to:Math.max(f,h),line:a}}}}if(!d){o+=l}}a+=l;if(!P(e,a)){return null}s=e.getLine(a);o=l>0?0:s.length}}function ht(e,t,r,n,i,a){var o=Ke(t);var s=[];if(n&&!i||!n&&i){r++}var l=!(n&&i);for(var c=0;c<r;c++){var u=ft(e,t,n,a,l);if(!u){var f=Ve(e,e.lastLine());s.push(n?{line:e.lastLine(),from:f,to:f}:{line:0,from:0,to:0});break}s.push(u);t=new C(u.line,n?u.to-1:u.from)}var h=s.length!=r;var d=s[0];var p=s.pop();if(n&&!i){if(!h&&(d.from!=o.ch||d.line!=o.line)){p=s.pop()}return new C(p.line,p.from)}else if(n&&i){return new C(p.line,p.to-1)}else if(!n&&i){if(!h&&(d.to!=o.ch||d.line!=o.line)){p=s.pop()}return new C(p.line,p.to)}else{return new C(p.line,p.from)}}function dt(e,t,r,n,i){var a=t;var o=new C(a.line+r.repeat-1,Infinity);var s=e.clipPos(o);s.ch--;if(!i){n.lastHPos=Infinity;n.lastHSPos=e.charCoords(s,"div").left}return o}function pt(e,t,r,n,i){var a=i||e.getCursor();var o=a.ch;var s;for(var l=0;l<t;l++){var c=e.getLine(a.line);s=gt(o,c,n,r,true);if(s==-1){return null}o=s}return new C(e.getCursor().line,s)}function vt(e,t){var r=e.getCursor().line;return Ee(e,new C(r,t-1))}function mt(e,t,r,n){if(!j(r,B)&&!N.test(r)){return}if(t.marks[r]){t.marks[r].clear()}t.marks[r]=e.setBookmark(n)}function gt(e,t,r,n,i){var a;if(n){a=t.indexOf(r,e+1);if(a!=-1&&!i){a-=1}}else{a=t.lastIndexOf(r,e-1);if(a!=-1&&!i){a+=1}}return a}function yt(e,t,r,n,i){var a=t.line;var o=e.firstLine();var s=e.lastLine();var l,c,u=a;function f(t){return!/\S/.test(e.getLine(t))}function h(e,t,r){if(r){return f(e)!=f(e+t)}return!f(e)&&f(e+t)}function d(t){n=n>0?1:-1;var r=e.ace.session.getFoldLine(t);if(r){if(t+n>r.start.row&&t+n<r.end.row)n=(n>0?r.end.row:r.start.row)-t}}if(n){while(o<=u&&u<=s&&r>0){d(u);if(h(u,n)){r--}u+=n}return new C(u,0)}var p=e.state.vim;if(p.visualLine&&h(a,1,true)){var v=p.sel.anchor;if(h(v.line,-1,true)){if(!i||v.line!=a){a+=1}}}var m=f(a);for(u=a;u<=s&&r;u++){if(h(u,1,true)){if(!i||f(u)!=m){r--}}}c=new C(u,0);if(u>s&&!m){m=true}else{i=false}for(u=a;u>o;u--){if(!i||f(u)==m||u==a){if(h(u,-1,true)){break}}}l=new C(u,0);return{start:l,end:c}}function wt(e,t,r,n,i){function a(e){if(e.pos+e.dir<0||e.pos+e.dir>=e.line.length){e.line=null}else{e.pos+=e.dir}}function o(e,t,r,n){var o=e.getLine(t);var s={line:o,ln:t,pos:r,dir:n};if(s.line===""){return{ln:s.ln,pos:s.pos}}var l=s.pos;a(s);while(s.line!==null){l=s.pos;if(W(s.line[s.pos])){if(!i){return{ln:s.ln,pos:s.pos+1}}else{a(s);while(s.line!==null){if(V(s.line[s.pos])){l=s.pos;a(s)}else{break}}return{ln:s.ln,pos:l+1}}}a(s)}return{ln:s.ln,pos:l+1}}function s(e,t,r,n){var o=e.getLine(t);var s={line:o,ln:t,pos:r,dir:n};if(s.line===""){return{ln:s.ln,pos:s.pos}}var l=s.pos;a(s);while(s.line!==null){if(!V(s.line[s.pos])&&!W(s.line[s.pos])){l=s.pos}else if(W(s.line[s.pos])){if(!i){return{ln:s.ln,pos:l}}else{if(V(s.line[s.pos+1])){return{ln:s.ln,pos:s.pos+1}}else{return{ln:s.ln,pos:l}}}}a(s)}s.line=o;if(i&&V(s.line[s.pos])){return{ln:s.ln,pos:s.pos}}else{return{ln:s.ln,pos:l}}}var l={ln:t.line,pos:t.ch};while(r>0){if(n<0){l=s(e,l.ln,l.pos,n)}else{l=o(e,l.ln,l.pos,n)}r--}return new C(l.ln,l.pos)}function Ct(e,t,r,n){function i(e,t){if(t.pos+t.dir<0||t.pos+t.dir>=t.line.length){t.ln+=t.dir;if(!P(e,t.ln)){t.line=null;t.ln=null;t.pos=null;return}t.line=e.getLine(t.ln);t.pos=t.dir>0?0:t.line.length-1}else{t.pos+=t.dir}}function a(e,t,r,n){var a=e.getLine(t);var o=a==="";var s={line:a,ln:t,pos:r,dir:n};var l={ln:s.ln,pos:s.pos};var c=s.line==="";i(e,s);while(s.line!==null){l.ln=s.ln;l.pos=s.pos;if(s.line===""&&!c){return{ln:s.ln,pos:s.pos}}else if(o&&s.line!==""&&!V(s.line[s.pos])){return{ln:s.ln,pos:s.pos}}else if(W(s.line[s.pos])&&!o&&(s.pos===s.line.length-1||V(s.line[s.pos+1]))){o=true}i(e,s)}var a=e.getLine(l.ln);l.pos=0;for(var u=a.length-1;u>=0;--u){if(!V(a[u])){l.pos=u;break}}return l}function o(e,t,r,n){var a=e.getLine(t);var o={line:a,ln:t,pos:r,dir:n};var s={ln:o.ln,pos:null};var l=o.line==="";i(e,o);while(o.line!==null){if(o.line===""&&!l){if(s.pos!==null){return s}else{return{ln:o.ln,pos:o.pos}}}else if(W(o.line[o.pos])&&s.pos!==null&&!(o.ln===s.ln&&o.pos+1===s.pos)){return s}else if(o.line!==""&&!V(o.line[o.pos])){l=false;s={ln:o.ln,pos:o.pos}}i(e,o)}var a=e.getLine(s.ln);s.pos=0;for(var c=0;c<a.length;++c){if(!V(a[c])){s.pos=c;break}}return s}var s={ln:t.line,pos:t.ch};while(r>0){if(n<0){s=o(e,s.ln,s.pos,n)}else{s=a(e,s.ln,s.pos,n)}r--}return new C(s.ln,s.pos)}function kt(e,t,r,n){var i=t,a,o;var s={"(":/[()]/,")":/[()]/,"[":/[[\]]/,"]":/[[\]]/,"{":/[{}]/,"}":/[{}]/,"<":/[<>]/,">":/[<>]/}[r];var l={"(":"(",")":"(","[":"[","]":"[","{":"{","}":"{","<":"<",">":"<"}[r];var c=e.getLine(i.line).charAt(i.ch);var u=c===l?1:0;a=e.scanForBracket(new C(i.line,i.ch+u),-1,undefined,{bracketRegex:s});o=e.scanForBracket(new C(i.line,i.ch+u),1,undefined,{bracketRegex:s});if(!a||!o)return null;a=a.pos;o=o.pos;if(a.line==o.line&&a.ch>o.ch||a.line>o.line){var f=a;a=o;o=f}if(n){o.ch+=1}else{a.ch+=1}return{start:a,end:o}}function St(e,t,r,n){var i=Ke(t);var a=e.getLine(i.line);var o=a.split("");var s,l,c,u;var f=o.indexOf(r);if(i.ch<f){i.ch=f}else if(f<i.ch&&o[i.ch]==r){var h=/string/.test(e.getTokenTypeAt(Oe(t,0,1)));var d=/string/.test(e.getTokenTypeAt(t));var p=h&&!d;if(!p){l=i.ch;--i.ch}}if(o[i.ch]==r&&!l){s=i.ch+1}else{for(c=i.ch;c>-1&&!s;c--){if(o[c]==r){s=c+1}}}if(s&&!l){for(c=s,u=o.length;c<u&&!l;c++){if(o[c]==r){l=c}}}if(!s||!l){return{start:i,end:i}}if(n){--s;++l}return{start:new C(i.line,s),end:new C(i.line,l)}}U("pcre",true,"boolean");function xt(){}xt.prototype={getQuery:function(){return Z.query},setQuery:function(e){Z.query=e},getOverlay:function(){return this.searchOverlay},setOverlay:function(e){this.searchOverlay=e},isReversed:function(){return Z.isReversed},setReversed:function(e){Z.isReversed=e},getScrollbarAnnotate:function(){return this.annotate},setScrollbarAnnotate:function(e){this.annotate=e}};function Mt(e){var t=e.state.vim;return t.searchState_||(t.searchState_=new xt)}function bt(e){return Lt(e,"/")}function At(e){return Et(e,"/")}function Lt(e,t){var r=Et(e,t)||[];if(!r.length)return[];var n=[];if(r[0]!==0)return;for(var i=0;i<r.length;i++){if(typeof r[i]=="number")n.push(e.substring(r[i]+1,r[i+1]))}return n}function Et(e,t){if(!t)t="/";var r=false;var n=[];for(var i=0;i<e.length;i++){var a=e.charAt(i);if(!r&&a==t){n.push(i)}r=!r&&a=="\\"}return n}function Tt(e){var t="|(){";var r="}";var n=false;var i=[];for(var a=-1;a<e.length;a++){var o=e.charAt(a)||"";var s=e.charAt(a+1)||"";var l=s&&t.indexOf(s)!=-1;if(n){if(o!=="\\"||!l){i.push(o)}n=false}else{if(o==="\\"){n=true;if(s&&r.indexOf(s)!=-1){l=true}if(!l||s==="\\"){i.push(o)}}else{i.push(o);if(l&&s!=="\\"){i.push("\\")}}}}return i.join("")}var Ot={"\\n":"\n","\\r":"\r","\\t":"\t"};function Rt(e){var t=false;var r=[];for(var n=-1;n<e.length;n++){var i=e.charAt(n)||"";var a=e.charAt(n+1)||"";if(Ot[i+a]){r.push(Ot[i+a]);n++}else if(t){r.push(i);t=false}else{if(i==="\\"){t=true;if($(a)||a==="$"){r.push("$")}else if(a!=="/"&&a!=="\\"){r.push("\\")}}else{if(i==="$"){r.push("$")}r.push(i);if(a==="/"){r.push("\\")}}}}return r.join("")}var Bt={"\\/":"/","\\\\":"\\","\\n":"\n","\\r":"\r","\\t":"\t","\\&":"&"};function It(e){var t=new m.StringStream(e);var r=[];while(!t.eol()){while(t.peek()&&t.peek()!="\\"){r.push(t.next())}var n=false;for(var i in Bt){if(t.match(i,true)){n=true;r.push(Bt[i]);break}}if(!n){r.push(t.next())}}return r.join("")}function Nt(e,t,r){var n=Z.registerController.getRegister("/");n.setText(e);if(e instanceof RegExp){return e}var i=At(e);var a;var o;if(!i.length){a=e}else{a=e.substring(0,i[0]);var s=e.substring(i[0]);o=s.indexOf("i")!=-1}if(!a){return null}if(!Q("pcre")){a=Tt(a)}if(r){t=/^[^A-Z]*$/.test(a)}var l=new RegExp(a,t||o?"im":"m");return l}function Kt(e){if(typeof e==="string")e=document.createElement(e);for(var t,r=1;r<arguments.length;r++){if(!(t=arguments[r]))continue;if(typeof t!=="object")t=document.createTextNode(t);if(t.nodeType)e.appendChild(t);else for(var n in t){if(!Object.prototype.hasOwnProperty.call(t,n))continue;if(n[0]==="$")e.style[n.slice(1)]=t[n];else e.setAttribute(n,t[n])}}return e}function Pt(e,t){var r=Kt("div",{$color:"red",$whiteSpace:"pre",class:"cm-vim-message"},t);if(e.openNotification){e.openNotification(r,{bottom:true,duration:5e3})}else{alert(r.innerText)}}function Ht(e,t){return Kt("div",{$display:"flex"},Kt("span",{$fontFamily:"monospace",$whiteSpace:"pre",$flex:1},e,Kt("input",{type:"text",autocorrect:"off",autocapitalize:"off",spellcheck:"false",$width:"100%"})),t&&Kt("span",{$color:"#888"},t))}function _t(e,t){if(re.length){if(!t.value)t.value="";ie=t;return}var r=Ht(t.prefix,t.desc);if(e.openDialog){e.openDialog(r,t.onClose,{onKeyDown:t.onKeyDown,onKeyUp:t.onKeyUp,bottom:true,selectValueOnOpen:false,value:t.value})}else{var n="";if(typeof t.prefix!="string"&&t.prefix)n+=t.prefix.textContent;if(t.desc)n+=" "+t.desc;t.onClose(prompt(n,""))}}function $t(e,t){if(e instanceof RegExp&&t instanceof RegExp){var r=["global","multiline","ignoreCase","source"];for(var n=0;n<r.length;n++){var i=r[n];if(e[i]!==t[i]){return false}}return true}return false}function Dt(e,t,r,n){if(!t){return}var i=Mt(e);var a=Nt(t,!!r,!!n);if(!a){return}jt(e,a);if($t(a,i.getQuery())){return a}i.setQuery(a);return a}function Vt(e){if(e.source.charAt(0)=="^"){var t=true}return{token:function(r){if(t&&!r.sol()){r.skipToEnd();return}var n=r.match(e,false);if(n){if(n[0].length==0){r.next();return"searching"}if(!r.sol()){r.backUp(1);if(!e.exec(r.next()+n[0])){r.next();return null}}r.match(e);return"searching"}while(!r.eol()){r.next();if(r.match(e,false))break}},query:e}}var Wt=0;function jt(e,t){clearTimeout(Wt);var r=Mt(e);r.highlightTimeout=Wt;Wt=setTimeout(function(){if(!e.state.vim)return;var r=Mt(e);r.highlightTimeout=null;var n=r.getOverlay();if(!n||t!=n.query){if(n){e.removeOverlay(n)}n=Vt(t);e.addOverlay(n);if(e.showMatchesOnScrollbar){if(r.getScrollbarAnnotate()){r.getScrollbarAnnotate().clear()}r.setScrollbarAnnotate(e.showMatchesOnScrollbar(t))}r.setOverlay(n)}},50)}function Ft(e,t,r,n){if(n===undefined){n=1}return e.operation(function(){var i=e.getCursor();var a=e.getSearchCursor(r,i);for(var o=0;o<n;o++){var s=a.find(t);if(o==0&&s&&Pe(a.from(),i)){var l=t?a.from():a.to();s=a.find(t);if(s&&!s[0]&&Pe(a.from(),l)){if(e.getLine(l.line).length==l.ch)s=a.find(t)}}if(!s){a=e.getSearchCursor(r,t?new C(e.lastLine()):new C(e.firstLine(),0));if(!a.find(t)){return}}}return a.from()})}function Ut(e,t,r,n,i){if(n===undefined){n=1}return e.operation(function(){var a=e.getCursor();var o=e.getSearchCursor(r,a);var s=o.find(!t);if(!i.visualMode&&s&&Pe(o.from(),a)){o.find(!t)}for(var l=0;l<n;l++){s=o.find(t);if(!s){o=e.getSearchCursor(r,t?new C(e.lastLine()):new C(e.firstLine(),0));if(!o.find(t)){return}}}return[o.from(),o.to()]})}function zt(e){var t=Mt(e);if(t.highlightTimeout){clearTimeout(t.highlightTimeout);t.highlightTimeout=null}e.removeOverlay(Mt(e).getOverlay());t.setOverlay(null);if(t.getScrollbarAnnotate()){t.getScrollbarAnnotate().clear();t.setScrollbarAnnotate(null)}}function Qt(e,t,r){if(typeof e!="number"){e=e.line}if(t instanceof Array){return j(e,t)}else{if(typeof r=="number"){return e>=t&&e<=r}else{return e==t}}}function qt(e){var t=e.ace.renderer;return{top:t.getFirstFullyVisibleRow(),bottom:t.getLastFullyVisibleRow()}}function Jt(e,t,r){if(r=="'"||r=="`"){return Z.jumpList.find(e,-1)||new C(0,0)}else if(r=="."){return Gt(e)}var n=t.marks[r];return n&&n.find()}function Gt(e){if(e.getLastEditEnd){return e.getLastEditEnd()}var t=e.doc.history.done;for(var r=t.length;r--;){if(t[r].changes){return Ke(t[r].changes[0].to)}}}var Xt=function(){this.buildCommandMap_()};Xt.prototype={processCommand:function(e,t,r){var n=this;e.operation(function(){e.curOp.isVimOp=true;n._processCommand(e,t,r)})},_processCommand:function(e,t,r){var n=e.state.vim;var i=Z.registerController.getRegister(":");var a=i.toString();var o=new m.StringStream(t);i.setText(t);var s=r||{};s.input=t;try{this.parseInput_(e,o,s)}catch(t){Pt(e,t.toString());throw t}if(n.visualMode){et(e)}var l;var c;if(!s.commandName){if(s.line!==undefined){c="move"}}else{l=this.matchCommand_(s.commandName);if(l){c=l.name;if(l.excludeFromCommandHistory){i.setText(a)}this.parseCommandArgs_(o,s,l);if(l.type=="exToKey"){oe(e,l.toKeys,l);return}else if(l.type=="exToEx"){this.processCommand(e,l.toInput);return}}}if(!c){Pt(e,'Not an editor command ":'+t+'"');return}try{Zt[c](e,s);if((!l||!l.possiblyAsync)&&s.callback){s.callback()}}catch(t){Pt(e,t.toString());throw t}},parseInput_:function(e,t,r){t.eatWhile(":");if(t.eat("%")){r.line=e.firstLine();r.lineEnd=e.lastLine()}else{r.line=this.parseLineSpec_(e,t);if(r.line!==undefined&&t.eat(",")){r.lineEnd=this.parseLineSpec_(e,t)}}if(r.line==undefined){if(e.state.vim.visualMode){var n=Jt(e,e.state.vim,"<");r.selectionLine=n&&n.line;n=Jt(e,e.state.vim,">");r.selectionLineEnd=n&&n.line}else{r.selectionLine=e.getCursor().line}}else{r.selectionLine=r.line;r.selectionLineEnd=r.lineEnd}var i=t.match(/^(\w+|!!|@@|[!#&*<=>@~])/);if(i){r.commandName=i[1]}else{r.commandName=t.match(/.*/)[0]}return r},parseLineSpec_:function(e,t){var r=t.match(/^(\d+)/);if(r){return parseInt(r[1],10)-1}switch(t.next()){case".":return this.parseLineSpecOffset_(t,e.getCursor().line);case"$":return this.parseLineSpecOffset_(t,e.lastLine());case"'":var n=t.next();var i=Jt(e,e.state.vim,n);if(!i)throw new Error("Mark not set");return this.parseLineSpecOffset_(t,i.line);case"-":case"+":t.backUp(1);return this.parseLineSpecOffset_(t,e.getCursor().line);default:t.backUp(1);return undefined}},parseLineSpecOffset_:function(e,t){var r=e.match(/^([+-])?(\d+)/);if(r){var n=parseInt(r[2],10);if(r[1]=="-"){t-=n}else{t+=n}}return t},parseCommandArgs_:function(e,t,r){if(e.eol()){return}t.argString=e.match(/.*/)[0];var n=r.argDelimiter||/\s+/;var i=We(t.argString).split(n);if(i.length&&i[0]){t.args=i}},matchCommand_:function(e){for(var t=e.length;t>0;t--){var r=e.substring(0,t);if(this.commandMap_[r]){var n=this.commandMap_[r];if(n.name.indexOf(e)===0){return n}}}return null},buildCommandMap_:function(){this.commandMap_={};for(var e=0;e<M.length;e++){var t=M[e];var r=t.shortName||t.name;this.commandMap_[r]=t}},map:function(e,t,r,n){if(e!=":"&&e.charAt(0)==":"){if(r){throw Error("Mode not supported for ex mappings")}var i=e.substring(1);if(t!=":"&&t.charAt(0)==":"){this.commandMap_[i]={name:i,type:"exToEx",toInput:t.substring(1),user:true}}else{this.commandMap_[i]={name:i,type:"exToKey",toKeys:t,user:true}}}else{var a={keys:e,type:"keyToKey",toKeys:t,noremap:!!n};if(r){a.context=r}S.unshift(a)}},unmap:function(e,t){if(e!=":"&&e.charAt(0)==":"){if(t){throw Error("Mode not supported for ex mappings")}var r=e.substring(1);if(this.commandMap_[r]&&this.commandMap_[r].user){delete this.commandMap_[r];return true}}else{var n=e;for(var i=0;i<S.length;i++){if(n==S[i].keys&&S[i].context===t){S.splice(i,1);return true}}}}};var Zt={colorscheme:function(e,t){if(!t.args||t.args.length<1){Pt(e,e.getOption("theme"));return}e.setOption("theme",t.args[0])},map:function(e,t,r,n){var i=t.args;if(!i||i.length<2){if(e){Pt(e,"Invalid mapping: "+t.input)}return}Yt.map(i[0],i[1],r,n)},imap:function(e,t){this.map(e,t,"insert")},nmap:function(e,t){this.map(e,t,"normal")},vmap:function(e,t){this.map(e,t,"visual")},omap:function(e,t){this.map(e,t,"operatorPending")},noremap:function(e,t){this.map(e,t,undefined,true)},inoremap:function(e,t){this.map(e,t,"insert",true)},nnoremap:function(e,t){this.map(e,t,"normal",true)},vnoremap:function(e,t){this.map(e,t,"visual",true)},onoremap:function(e,t){this.map(e,t,"operatorPending",true)},unmap:function(e,t,r){var n=t.args;if(!n||n.length<1||!Yt.unmap(n[0],r)){if(e){Pt(e,"No such mapping: "+t.input)}}},mapclear:function(e,t){te.mapclear()},imapclear:function(e,t){te.mapclear("insert")},nmapclear:function(e,t){te.mapclear("normal")},vmapclear:function(e,t){te.mapclear("visual")},omapclear:function(e,t){te.mapclear("operatorPending")},move:function(e,t){Ce.processCommand(e,e.state.vim,{type:"motion",motion:"moveToLineOrEdgeOfDocument",motionArgs:{forward:false,explicitRepeat:true,linewise:true},repeatOverride:t.line+1})},set:function(e,t){var r=t.args;var n=t.setCfg||{};if(!r||r.length<1){if(e){Pt(e,"Invalid mapping: "+t.input)}return}var i=r[0].split("=");var a=i[0];var o=i[1];var s=false;var l=false;if(a.charAt(a.length-1)=="?"){if(o){throw Error("Trailing characters: "+t.argString)}a=a.substring(0,a.length-1);s=true}else if(a.charAt(a.length-1)=="!"){a=a.substring(0,a.length-1);l=true}if(o===undefined&&a.substring(0,2)=="no"){a=a.substring(2);o=false}var c=F[a]&&F[a].type=="boolean";if(c){if(l){o=!Q(a,e,n)}else if(o==undefined){o=true}}if(!c&&o===undefined||s){var u=Q(a,e,n);if(u instanceof Error){Pt(e,u.message)}else if(u===true||u===false){Pt(e," "+(u?"":"no")+a)}else{Pt(e,"  "+a+"="+u)}}else{var f=z(a,o,e,n);if(f instanceof Error){Pt(e,f.message)}}},setlocal:function(e,t){t.setCfg={scope:"local"};this.set(e,t)},setglobal:function(e,t){t.setCfg={scope:"global"};this.set(e,t)},registers:function(e,t){var r=t.args;var n=Z.registerController.registers;var i="----------Registers----------\n\n";if(!r){for(var a in n){var o=n[a].toString();if(o.length){i+='"'+a+"    "+o+"\n"}}}else{var a;r=r.join("");for(var s=0;s<r.length;s++){a=r.charAt(s);if(!Z.registerController.isValidRegister(a)){continue}var l=n[a]||new me;i+='"'+a+"    "+l.toString()+"\n"}}Pt(e,i)},sort:function(e,t){var r,n,i,a,o;function s(){if(t.argString){var e=new m.StringStream(t.argString);if(e.eat("!")){r=true}if(e.eol()){return}if(!e.eatSpace()){return"Invalid arguments"}var s=e.match(/([dinuox]+)?\s*(\/.+\/)?\s*/);if(!s&&!e.eol()){return"Invalid arguments"}if(s[1]){n=s[1].indexOf("i")!=-1;i=s[1].indexOf("u")!=-1;var l=s[1].indexOf("d")!=-1||s[1].indexOf("n")!=-1&&1;var c=s[1].indexOf("x")!=-1&&1;var u=s[1].indexOf("o")!=-1&&1;if(l+c+u>1){return"Invalid arguments"}a=l&&"decimal"||c&&"hex"||u&&"octal"}if(s[2]){o=new RegExp(s[2].substr(1,s[2].length-2),n?"i":"")}}}var l=s();if(l){Pt(e,l+": "+t.argString);return}var c=t.line||e.firstLine();var u=t.lineEnd||t.line||e.lastLine();if(c==u){return}var f=new C(c,0);var h=new C(u,Ve(e,u));var d=e.getRange(f,h).split("\n");var p=o?o:a=="decimal"?/(-?)([\d]+)/:a=="hex"?/(-?)(?:0x)?([0-9a-f]+)/i:a=="octal"?/([0-7]+)/:null;var v=a=="decimal"?10:a=="hex"?16:a=="octal"?8:null;var g=[],y=[];if(a||o){for(var w=0;w<d.length;w++){var k=o?d[w].match(o):null;if(k&&k[0]!=""){g.push(k)}else if(!o&&p.exec(d[w])){g.push(d[w])}else{y.push(d[w])}}}else{y=d}function S(e,t){if(r){var i;i=e;e=t;t=i}if(n){e=e.toLowerCase();t=t.toLowerCase()}var o=a&&p.exec(e);var s=a&&p.exec(t);if(!o){return e<t?-1:1}o=parseInt((o[1]+o[2]).toLowerCase(),v);s=parseInt((s[1]+s[2]).toLowerCase(),v);return o-s}function x(e,t){if(r){var i;i=e;e=t;t=i}if(n){e[0]=e[0].toLowerCase();t[0]=t[0].toLowerCase()}return e[0]<t[0]?-1:1}g.sort(o?x:S);if(o){for(var w=0;w<g.length;w++){g[w]=g[w].input}}else if(!a){y.sort(S)}d=!r?y.concat(g):g.concat(y);if(i){var M=d;var b;d=[];for(var w=0;w<M.length;w++){if(M[w]!=b){d.push(M[w])}b=M[w]}}e.replaceRange(d.join("\n"),f,h)},vglobal:function(e,t){this.global(e,t)},normal:function(e,t){var r=t.argString;if(r&&r[0]=="!"){r=r.slice(1);ne=true}r=r.trimStart();if(!r){Pt(e,"Argument is required.");return}var n=t.line;if(typeof n=="number"){var i=isNaN(t.lineEnd)?n:t.lineEnd;for(var a=n;a<=i;a++){e.setCursor(a,0);oe(e,t.argString.trimStart());if(e.state.vim.insertMode){tr(e,true)}}}else{oe(e,t.argString.trimStart());if(e.state.vim.insertMode){tr(e,true)}}},global:function(e,t){var r=t.argString;if(!r){Pt(e,"Regular Expression missing from global");return}var n=t.commandName[0]==="v";if(r[0]==="!"&&t.commandName[0]==="g"){n=true;r=r.slice(1)}var i=t.line!==undefined?t.line:e.firstLine();var a=t.lineEnd||t.line||e.lastLine();var o=bt(r);var s=r,l;if(o.length){s=o[0];l=o.slice(1,o.length).join("/")}if(s){try{Dt(e,s,true,true)}catch(t){Pt(e,"Invalid regex: "+s);return}}var c=Mt(e).getQuery();var u=[];for(var f=i;f<=a;f++){var h=e.getLine(f);var d=c.test(h);if(d!==n){u.push(l?e.getLineHandle(f):h)}}if(!l){Pt(e,u.join("\n"));return}var p=0;var v=function(){if(p<u.length){var t=u[p++];var r=e.getLineNumber(t);if(r==null){v();return}var n=r+1+l;Yt.processCommand(e,n,{callback:v})}else if(e.releaseLineHandles){e.releaseLineHandles()}};v()},substitute:function(e,t){if(!e.getSearchCursor){throw new Error("Search feature not available. Requires searchcursor.js or "+"any other getSearchCursor implementation.")}var r=t.argString;var n=r?Lt(r,r[0]):[];var i,a="",o,s,l;var c=false;var u=false;if(n.length){i=n[0];if(Q("pcre")&&i!==""){i=new RegExp(i).source}a=n[1];if(a!==undefined){if(Q("pcre")){a=It(a.replace(/([^\\])&/g,"$1$$&"))}else{a=Rt(a)}Z.lastSubstituteReplacePart=a}o=n[2]?n[2].split(" "):[]}else{if(r&&r.length){Pt(e,"Substitutions should be of the form "+":s/pattern/replace/");return}}if(o){s=o[0];l=parseInt(o[1]);if(s){if(s.indexOf("c")!=-1){c=true}if(s.indexOf("g")!=-1){u=true}if(Q("pcre")){i=i+"/"+s}else{i=i.replace(/\//g,"\\/")+"/"+s}}}if(i){try{Dt(e,i,true,true)}catch(t){Pt(e,"Invalid regex: "+i);return}}a=a||Z.lastSubstituteReplacePart;if(a===undefined){Pt(e,"No previous substitute regular expression");return}var f=Mt(e);var h=f.getQuery();var d=t.line!==undefined?t.line:e.getCursor().line;var p=t.lineEnd||d;if(d==e.firstLine()&&p==e.lastLine()){p=Infinity}if(l){d=p;p=d+l-1}var v=Ee(e,new C(d,0));var m=e.getSearchCursor(h,v);er(e,c,u,d,p,m,h,a,t.callback)},startinsert:function(e,t){oe(e,t.argString=="!"?"A":"i",{})},redo:m.commands.redo,undo:m.commands.undo,write:function(e){if(m.commands.save){m.commands.save(e)}else if(e.save){e.save()}},nohlsearch:function(e){zt(e)},yank:function(e){var t=Ke(e.getCursor());var r=t.line;var n=e.getLine(r);Z.registerController.pushText("0","yank",n,true,true)},delete:function(e,t){var r=t.selectionLine;var n=isNaN(t.selectionLineEnd)?r:t.selectionLineEnd;Me.delete(e,{linewise:true},[{anchor:new C(r,0),head:new C(n+1,0)}])},join:function(e,t){var r=t.selectionLine;var n=isNaN(t.selectionLineEnd)?r:t.selectionLineEnd;e.setCursor(new C(r,0));Ae.joinLines(e,{repeat:n-r},e.state.vim)},delmarks:function(e,t){if(!t.argString||!We(t.argString)){Pt(e,"Argument required");return}var r=e.state.vim;var n=new m.StringStream(We(t.argString));while(!n.eol()){n.eatSpace();var i=n.pos;if(!n.match(/[a-zA-Z]/,false)){Pt(e,"Invalid argument: "+t.argString.substring(i));return}var a=n.next();if(n.match("-",true)){if(!n.match(/[a-zA-Z]/,false)){Pt(e,"Invalid argument: "+t.argString.substring(i));return}var o=a;var s=n.next();if(H(o)&&H(s)||D(o)&&D(s)){var l=o.charCodeAt(0);var c=s.charCodeAt(0);if(l>=c){Pt(e,"Invalid argument: "+t.argString.substring(i));return}for(var u=0;u<=c-l;u++){var f=String.fromCharCode(l+u);delete r.marks[f]}}else{Pt(e,"Invalid argument: "+o+"-");return}}else{delete r.marks[a]}}}};var Yt=new Xt;function er(e,t,r,n,i,a,o,s,l){e.state.vim.exMode=true;var c=false;var u,f,h;function d(){e.operation(function(){while(!c){p();g()}y()})}function p(){var t=e.getRange(a.from(),a.to());var r=t.replace(o,s);var n=a.to().line;a.replace(r);f=a.to().line;i+=f-n;h=f<n}function v(){var e=u&&Ke(a.to());var t=a.findNext();if(t&&!t[0]&&e&&Pe(a.from(),e)){t=a.findNext()}return t}function g(){while(v()&&Qt(a.from(),n,i)){if(!r&&a.from().line==f&&!h){continue}e.scrollIntoView(a.from(),30);e.setSelection(a.from(),a.to());u=a.from();c=false;return}c=true}function y(t){if(t){t()}e.focus();if(u){e.setCursor(u);var r=e.state.vim;r.exMode=false;r.lastHPos=r.lastHSPos=u.ch}if(l){l()}}function w(t,r,n){m.e_stop(t);var i=ue(t);switch(i){case"y":p();g();break;case"n":g();break;case"a":var a=l;l=undefined;e.operation(d);l=a;break;case"l":p();case"q":case"<Esc>":case"<C-c>":case"<C-[>":y(n);break}if(c){y(n)}return true}g();if(c){Pt(e,"No matches for "+o.source);return}if(!t){d();if(l){l()}return}_t(e,{prefix:Kt("span","replace with ",Kt("strong",s)," (y/n/a/q/l)"),onKeyDown:w})}function tr(e,t){var r=e.state.vim;var n=Z.macroModeState;var i=Z.registerController.getRegister(".");var a=n.isPlaying;var o=n.lastInsertModeChanges;if(!a){e.off("change",lr);if(r.insertEnd)r.insertEnd.clear();r.insertEnd=null;m.off(e.getInputField(),"keydown",hr)}if(!a&&r.insertModeRepeat>1){dr(e,r,r.insertModeRepeat-1,true);r.lastEditInputState.repeatOverride=r.insertModeRepeat}delete r.insertModeRepeat;r.insertMode=false;if(!t){e.setCursor(e.getCursor().line,e.getCursor().ch-1)}e.setOption("keyMap","vim");e.setOption("disableInput",true);e.toggleOverwrite(false);i.setText(o.changes.join(""));m.signal(e,"vim-mode-change",{mode:"normal"});if(n.isRecording){or(n)}}function rr(e){S.unshift(e)}function nr(e,t,r,n,i){var a={keys:e,type:t};a[t]=r;a[t+"Args"]=n;for(var o in i)a[o]=i[o];rr(a)}U("insertModeEscKeysTimeout",200,"number");function ir(e,t,r,n){var i=Z.registerController.getRegister(n);if(n==":"){if(i.keyBuffer[0]){Yt.processCommand(e,i.keyBuffer[0])}r.isPlaying=false;return}var a=i.keyBuffer;var o=0;r.isPlaying=true;r.replaySearchQueries=i.searchQueries.slice(0);for(var s=0;s<a.length;s++){var l=a[s];var c,u;while(l){c=/<\w+-.+?>|<\w+>|./.exec(l);u=c[0];l=l.substring(c.index+u.length);te.handleKey(e,u,"macro");if(t.insertMode){var f=i.insertModeChanges[o++].changes;Z.macroModeState.lastInsertModeChanges.changes=f;vr(e,f,1);tr(e)}}}r.isPlaying=false}function ar(e,t){if(e.isPlaying){return}var r=e.latestRegister;var n=Z.registerController.getRegister(r);if(n){n.pushText(t)}}function or(e){if(e.isPlaying){return}var t=e.latestRegister;var r=Z.registerController.getRegister(t);if(r&&r.pushInsertModeChanges){r.pushInsertModeChanges(e.lastInsertModeChanges)}}function sr(e,t){if(e.isPlaying){return}var r=e.latestRegister;var n=Z.registerController.getRegister(r);if(n&&n.pushSearchQuery){n.pushSearchQuery(t)}}function lr(e,t){var r=Z.macroModeState;var n=r.lastInsertModeChanges;if(!r.isPlaying){var i=e.state.vim;while(t){n.expectCursorActivityForChange=true;if(n.ignoreCount>1){n.ignoreCount--}else if(t.origin=="+input"||t.origin=="paste"||t.origin===undefined){var a=e.listSelections().length;if(a>1)n.ignoreCount=a;var o=t.text.join("\n");if(n.maybeReset){n.changes=[];n.maybeReset=false}if(o){if(e.state.overwrite&&!/\n/.test(o)){n.changes.push([o])}else{if(o.length>1){var s=i&&i.insertEnd&&i.insertEnd.find();var l=e.getCursor();if(s&&s.line==l.line){var c=s.ch-l.ch;if(c>0&&c<o.length){n.changes.push([o,c]);o=""}}}if(o)n.changes.push(o)}}}t=t.next}}}function cr(e){var t=e.state.vim;if(t.insertMode){var r=Z.macroModeState;if(r.isPlaying){return}var n=r.lastInsertModeChanges;if(n.expectCursorActivityForChange){n.expectCursorActivityForChange=false}else{n.maybeReset=true;if(t.insertEnd)t.insertEnd.clear();t.insertEnd=e.setBookmark(e.getCursor(),{insertLeft:true})}}else if(!e.curOp.isVimOp){ur(e,t)}}function ur(e,t,r){var n=e.getCursor("anchor");var i=e.getCursor("head");if(t.visualMode&&!e.somethingSelected()){et(e,false)}else if(!t.visualMode&&!t.insertMode&&e.somethingSelected()){t.visualMode=true;t.visualLine=false;m.signal(e,"vim-mode-change",{mode:"visual"})}if(t.visualMode){var a=!He(i,n)?-1:0;var o=He(i,n)?-1:0;i=Oe(i,0,a);n=Oe(n,0,o);t.sel={anchor:n,head:i};mt(e,t,"<",_e(i,n));mt(e,t,">",$e(i,n))}else if(!t.insertMode&&!r){t.lastHPos=e.getCursor().ch}}function fr(e,t){this.keyName=e;this.key=t.key;this.ctrlKey=t.ctrlKey;this.altKey=t.altKey;this.metaKey=t.metaKey;this.shiftKey=t.shiftKey}function hr(e){var t=Z.macroModeState;var r=t.lastInsertModeChanges;var n=m.keyName?m.keyName(e):e.key;if(!n){return}if(n.indexOf("Delete")!=-1||n.indexOf("Backspace")!=-1){if(r.maybeReset){r.changes=[];r.maybeReset=false}r.changes.push(new fr(n,e))}}function dr(e,t,r,n){var i=Z.macroModeState;i.isPlaying=true;var a=!!t.lastEditActionCommand;var o=t.inputState;function s(){if(a){Ce.processAction(e,t,t.lastEditActionCommand)}else{Ce.evalInput(e,t)}}function l(r){if(i.lastInsertModeChanges.changes.length>0){r=!t.lastEditActionCommand?1:r;var n=i.lastInsertModeChanges;vr(e,n.changes,r)}}t.inputState=t.lastEditInputState;if(a&&t.lastEditActionCommand.interlaceInsertRepeat){for(var c=0;c<r;c++){s();l(1)}}else{if(!n){s()}l(r)}t.inputState=o;if(t.insertMode&&!n){tr(e)}i.isPlaying=false}function pr(e,t){m.lookupKey(t,"vim-insert",function t(r){if(typeof r=="string"){m.commands[r](e)}else{r(e)}return true})}function vr(e,t,r){var n=e.getCursor("head");var i=Z.macroModeState.lastInsertModeChanges.visualBlock;if(i){ze(e,n,i+1);r=e.listSelections().length;e.setCursor(n)}for(var a=0;a<r;a++){if(i){e.setCursor(Oe(n,a,0))}for(var o=0;o<t.length;o++){var s=t[o];if(s instanceof fr){pr(e,s.keyName,s)}else if(typeof s=="string"){e.replaceSelection(s)}else{var l=e.getCursor();var c=Oe(l,0,s[0].length-(s[1]||0));e.replaceRange(s[0],l,s[1]?l:c);e.setCursor(c)}}}if(i){e.setCursor(Oe(n,0,1))}}m.Vim=te;var mr={return:"CR",backspace:"BS",delete:"Del",esc:"Esc",left:"Left",right:"Right",up:"Up",down:"Down",space:"Space",insert:"Ins",home:"Home",end:"End",pageup:"PageUp",pagedown:"PageDown",enter:"CR"};function gr(e,t,r,n){if(t.length>1&&t[0]=="n"){t=t.replace("numpad","")}t=mr[t]||t;var i="";if(r.ctrlKey){i+="C-"}if(r.altKey){i+="A-"}if((i||t.length>1)&&r.shiftKey){i+="S-"}if(n&&!n.expectLiteralNext&&t.length==1){if(b.keymap&&t in b.keymap){if(b.remapCtrl!==false||!i)t=b.keymap[t]}else if(t.charCodeAt(0)>255){var a=r.code&&r.code.slice(-1)||"";if(!r.shiftKey)a=a.toLowerCase();if(a)t=a}}i+=t;if(i.length>1){i="<"+i+">"}return i}var yr=te.handleKey.bind(te);te.handleKey=function(e,t,r){return e.operation(function(){return yr(e,t,r)},true)};function wr(e){var t=new e.constructor;Object.keys(e).forEach(function(r){if(r=="insertEnd")return;var n=e[r];if(Array.isArray(n))n=n.slice();else if(n&&typeof n=="object"&&n.constructor!=Object)n=wr(n);t[r]=n});if(e.sel){t.sel={head:e.sel.head&&Ke(e.sel.head),anchor:e.sel.anchor&&Ke(e.sel.anchor)}}return t}function Cr(e,t,r){var n=false;var i=te.maybeInitVimState_(e);var a=i.visualBlock||i.wasInVisualBlock;var o=e.ace.inMultiSelectMode;if(i.wasInVisualBlock&&!o){i.wasInVisualBlock=false}else if(o&&i.visualBlock){i.wasInVisualBlock=true}if(t=="<Esc>"&&!i.insertMode&&!i.visualMode&&o){e.ace.exitMultiSelectMode()}else if(a||!o||e.ace.inVirtualSelectionMode){n=te.handleKey(e,t,r)}else{var s=wr(i);var l=i.inputState.changeQueueList||[];e.operation(function(){e.curOp.isVimOp=true;var a=0;e.ace.forEachSelection(function(){var i=e.ace.selection;e.state.vim.lastHPos=i.$desiredColumn==null?i.lead.column:i.$desiredColumn;e.state.vim.inputState.changeQueue=l[a];var o=e.getCursor("head");var c=e.getCursor("anchor");var u=!He(o,c)?-1:0;var f=He(o,c)?-1:0;o=Oe(o,0,u);c=Oe(c,0,f);e.state.vim.sel.head=o;e.state.vim.sel.anchor=c;n=yr(e,t,r);i.$desiredColumn=e.state.vim.lastHPos==-1?null:e.state.vim.lastHPos;if(e.ace.inVirtualSelectionMode){l[a]=e.state.vim.inputState.changeQueue}if(e.virtualSelectionMode()){e.state.vim=wr(s)}a++});if(e.curOp.cursorActivity&&!n)e.curOp.cursorActivity=false;i.status=e.state.vim.status;e.state.vim=i;i.inputState.changeQueueList=l;i.inputState.changeQueue=null},true)}if(n&&!i.visualMode&&!i.insert&&i.visualMode!=e.somethingSelected()){ur(e,i,true)}return n}Y();t.CodeMirror=m;var kr=te.maybeInitVimState_;t.handler={$id:"ace/keyboard/vim",drawCursor:function(e,t,r,n,a){var s=this.state.vim||{};var l=r.characterWidth;var c=r.lineHeight;var u=t.top;var f=t.left;if(!s.insertMode){var h=!n.cursor?a.selection.isBackwards()||a.selection.isEmpty():i.comparePoints(n.cursor,n.start)<=0;if(!h&&f>l)f-=l}if(!s.insertMode&&s.status){c=c/2;u+=c}o.translate(e,f,u);o.setStyle(e.style,"width",l+"px");o.setStyle(e.style,"height",c+"px")},$getDirectionForHighlight:function(e){var t=e.state.cm;var r=kr(t);if(!r.insertMode){return e.session.selection.isBackwards()||e.session.selection.isEmpty()}},handleKeyboard:function(e,t,r,n,i){var a=e.editor;var o=a.state.cm;var s=kr(o);if(n==-1)return;if(!s.insertMode){if(t==-1){if(r.charCodeAt(0)>255){if(e.inputKey){r=e.inputKey;if(r&&e.inputHash==4)r=r.toUpperCase()}}e.inputChar=r}else if(t==4||t==0){if(e.inputKey==r&&e.inputHash==t&&e.inputChar){r=e.inputChar;t=-1}else{e.inputChar=null;e.inputKey=r;e.inputHash=t}}else{e.inputChar=e.inputKey=null}}if(o.state.overwrite&&s.insertMode&&r=="backspace"&&t==0){return{command:"gotoleft"}}if(r=="c"&&t==1){if(!f.isMac&&a.getCopyText()){a.once("copy",function(){if(s.insertMode)a.selection.clearSelection();else o.operation(function(){et(o)})});return{command:"null",passEvent:true}}}if(r=="esc"&&!s.insertMode&&!s.visualMode&&!o.ace.inMultiSelectMode){var l=Mt(o);var c=l.getOverlay();if(c)o.removeOverlay(c)}if(t==-1||t&1||t===0&&r.length>1){var u=s.insertMode;var h=gr(t,r,i||{},s);if(s.status==null)s.status="";var d=Cr(o,h,"user");s=kr(o);if(d&&s.status!=null)s.status+=h;else if(s.status==null)s.status="";o._signal("changeStatus");if(!d&&(t!=-1||u))return;return{command:"null",passEvent:!d}}},attach:function(e){if(!e.state)e.state={};var t=new m(e);e.state.cm=t;e.$vimModeHandler=this;A(t);kr(t).status=null;t.on("vim-command-done",function(){if(t.virtualSelectionMode())return;kr(t).status=null;t.ace._signal("changeStatus");t.ace.session.markUndoGroup()});t.on("changeStatus",function(){t.ace.renderer.updateCursor();t.ace._signal("changeStatus")});t.on("vim-mode-change",function(){if(t.virtualSelectionMode())return;r();t._signal("changeStatus")});function r(){var r=kr(t).insertMode;t.ace.renderer.setStyle("normal-mode",!r);e.textInput.setCommandMode(!r);e.renderer.$keepTextAreaAtCursor=r;e.renderer.$blockCursor=!r}r();e.renderer.$cursorLayer.drawCursor=this.drawCursor.bind(t)},detach:function(e){var t=e.state.cm;L(t);t.destroy();e.state.cm=null;e.$vimModeHandler=null;e.renderer.$cursorLayer.drawCursor=null;e.renderer.setStyle("normal-mode",false);e.textInput.setCommandMode(false);e.renderer.$keepTextAreaAtCursor=true},getStatusText:function(e){var t=e.state.cm;var r=kr(t);if(r.insertMode)return"INSERT";var n="";if(r.visualMode){n+="VISUAL";if(r.visualLine)n+=" LINE";if(r.visualBlock)n+=" BLOCK"}if(r.status)n+=(n?" ":"")+r.status;return n}};te.defineOption({name:"wrap",set:function(e,t){if(t){t.ace.setOption("wrap",e)}},type:"boolean"},false);te.defineEx("write","w",function(){console.log(":write is not implemented")});S.push({keys:"zc",type:"action",action:"fold",actionArgs:{open:false}},{keys:"zC",type:"action",action:"fold",actionArgs:{open:false,all:true}},{keys:"zo",type:"action",action:"fold",actionArgs:{open:true}},{keys:"zO",type:"action",action:"fold",actionArgs:{open:true,all:true}},{keys:"za",type:"action",action:"fold",actionArgs:{toggle:true}},{keys:"zA",type:"action",action:"fold",actionArgs:{toggle:true,all:true}},{keys:"zf",type:"action",action:"fold",actionArgs:{open:true,all:true}},{keys:"zd",type:"action",action:"fold",actionArgs:{open:true,all:true}},{keys:"<C-A-k>",type:"action",action:"aceCommand",actionArgs:{name:"addCursorAbove"}},{keys:"<C-A-j>",type:"action",action:"aceCommand",actionArgs:{name:"addCursorBelow"}},{keys:"<C-A-S-k>",type:"action",action:"aceCommand",actionArgs:{name:"addCursorAboveSkipCurrent"}},{keys:"<C-A-S-j>",type:"action",action:"aceCommand",actionArgs:{name:"addCursorBelowSkipCurrent"}},{keys:"<C-A-h>",type:"action",action:"aceCommand",actionArgs:{name:"selectMoreBefore"}},{keys:"<C-A-l>",type:"action",action:"aceCommand",actionArgs:{name:"selectMoreAfter"}},{keys:"<C-A-S-h>",type:"action",action:"aceCommand",actionArgs:{name:"selectNextBefore"}},{keys:"<C-A-S-l>",type:"action",action:"aceCommand",actionArgs:{name:"selectNextAfter"}});S.push({keys:"gq",type:"operator",operator:"hardWrap"});te.defineOperator("hardWrap",function(e,t,r,n,i){var a=r[0].anchor.line;var o=r[0].head.line;if(t.linewise)o--;v(e.ace,{startRow:a,endRow:o});return C(o,0)});U("textwidth",undefined,"number",["tw"],function(e,t){if(t===undefined){return}if(e===undefined){var r=t.ace.getOption("printMarginColumn");return r}else{var n=Math.round(e);if(n>1){t.ace.setOption("printMarginColumn",n)}}});Ae.aceCommand=function(e,t,r){e.vimCmd=t;if(e.ace.inVirtualSelectionMode)e.ace.on("beforeEndOperation",Sr);else Sr(null,e.ace)};function Sr(e,t){t.off("beforeEndOperation",Sr);var r=t.state.cm.vimCmd;if(r){t.execCommand(r.exec?r:r.name,r.args)}t.curOp=t.prevOp}Ae.fold=function(e,t,r){e.ace.execCommand(["toggleFoldWidget","toggleFoldWidget","foldOther","unfoldall"][(t.all?2:0)+(t.open?1:0)])};x=S.length;t.handler.defaultKeymap=S;t.handler.actions=Ae;t.Vim=te});(function(){ace.require(["ace/keyboard/vim"],function(e){if(typeof module=="object"&&typeof exports=="object"&&module){module.exports=e}})})();
//# sourceMappingURL=keybinding-vim.js.map