/*!
 * OpenUI5
 * (c) Copyright 2025 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["sap/ui/base/ManagedObject","sap/ui/core/Fragment","sap/ui/core/Lib","sap/m/MessageToast","sap/ui/fl/write/_internal/fieldExtensibility/cap/editor/getEditorConfig","sap/base/util/ObjectPath","sap/base/util/deepClone","sap/ui/model/resource/ResourceModel","sap/ui/model/json/JSONModel"],function(e,t,n,o,i,s,a,l,r){"use strict";const d=n.getResourceBundleFor("sap.ui.fl");function u(e,t,n){const o=e.getContent()[0];o.setJson(a(t));o.setConfig(i(n));return o}function c(e){if(!e||!e.element){return{}}const t=a(e);if(!s.get(["element","@Common.Label"],t)){const e=s.get(["element","name"],t);s.set(["element","@Common.Label"],e,t)}const n=s.get(["element","@assert.range"],t);if(s.get(["element","type"],t)==="cds.String"&&Array.isArray(n)){s.set(["element","enum"],n.reduce(function(e,t){e[t]={};return e},{}),t);s.set(["element","@assert.range"],true,t)}if(t.element.annotations){t.element={...t.element,...t.element.annotations};delete t.element.annotations}const o={extend:t.extend,elements:{}};o.elements[t.element.name]=t.element;return o}const p=e.extend("sap.ui.fl.write._internal.fieldExtensibility.cap.dialog.CustomFieldCAPDialog",{metadata:{library:"sap.ui.fl",properties:{_dialog:{type:"any",visibility:"hidden"}}}});p.prototype.open=function(e,n){const o={element:{name:"NewField",type:"cds.String"},extend:e.boundEntitySet.$Type};const i=this.getProperty("_dialog");if(i){this._oEditor.setJson(a(o));i.open()}else{t.load({name:"sap.ui.fl.write._internal.fieldExtensibility.cap.dialog.CustomFieldCAPDialog",controller:this}).then(function(t){this._oDialogModel=new r({isValid:true});this._oDialogModel.setDefaultBindingMode("OneWay");t.setModel(this._oDialogModel,"dialog");t.setModel(new l({bundle:d}),"i18n");t.addStyleClass(n);this.setProperty("_dialog",t);this._oJson=a(o);this._oEditor=u(t,this._oJson,{entityTypes:e.entityTypes});this._oEditor.attachJsonChange(function(e){this._oJson=e.getParameter("json")}.bind(this));this._oEditor.attachValidationErrorChange(function(e){const t=e.getParameter("hasError");this._oDialogModel.setData({isValid:!t})}.bind(this));t.open()}.bind(this))}};p.prototype.exit=function(){const e=this.getProperty("_dialog");if(e){e.destroy()}if(this.oEditor){this.oEditor.destroy()}};p.prototype.onSave=function(){const e=c(this._oJson);const t={extensions:[JSON.stringify(e)]};const n=new Promise(function(e,n){const o=new XMLHttpRequest;o.open("POST","/-/cds/extensibility/addExtension");o.setRequestHeader("Content-Type","application/json");o.onload=function(){if(o.status>=200&&o.status<400){e(o.response)}else{n({status:o.status,message:o.statusText})}};o.send(JSON.stringify(t))});n.then(function(){o.show(d.getText("CAP_ADD_FIELD_SUCCESS"))});this.getProperty("_dialog").close()};p.prototype.onCancel=function(){this.getProperty("_dialog").close()};return p});
//# sourceMappingURL=CustomFieldCAPDialog.js.map