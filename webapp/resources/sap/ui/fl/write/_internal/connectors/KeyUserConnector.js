/*!
 * OpenUI5
 * (c) Copyright 2025 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["sap/base/util/merge","sap/ui/core/Lib","sap/ui/fl/Layer","sap/ui/fl/write/_internal/connectors/BackendConnector","sap/ui/fl/initial/_internal/connectors/KeyUserConnector","sap/ui/fl/initial/_internal/connectors/Utils","sap/ui/fl/write/_internal/connectors/Utils","sap/base/util/restricted/_pick","sap/ui/fl/initial/_internal/FlexInfoSession","sap/ui/core/BusyIndicator","sap/base/Log","sap/m/MessageBox"],function(e,t,n,r,s,i,a,o,u,l,c,S){"use strict";var R="/flex/keyuser";var E=e({},r,{layers:[n.CUSTOMER,n.PUBLIC],ROUTES:{CHANGES:`${R+s.API_VERSION}/changes/`,SETTINGS:`${R+s.API_VERSION}/settings`,TOKEN:`${R+s.API_VERSION}/settings`,VERSIONS:{GET:`${R+s.API_VERSION}/versions/`,ACTIVATE:`${R+s.API_VERSION}/versions/activate/`,DISCARD:`${R+s.API_VERSION}/versions/draft/`,PUBLISH:`${R+s.API_VERSION}/versions/publish/`},TRANSLATION:{UPLOAD:`${R+s.API_VERSION}/translation/texts`,DOWNLOAD:`${R+s.API_VERSION}/translation/texts/`,GET_SOURCELANGUAGE:`${R+s.API_VERSION}/translation/sourcelanguages/`},CONTEXTS:`${R+s.API_VERSION}/contexts/`},isLanguageInfoRequired:true,getContexts(e){var t=["type","$skip","$filter"];var n=o(e,t);var r=i.getUrl(this.ROUTES.CONTEXTS,e,n);return i.sendRequest(r,"GET",{initialConnector:s}).then(function(e){return e.response})},loadContextDescriptions(e){var t={};i.addLanguageInfo(t);T.call(this,e);var n=i.getUrl(this.ROUTES.CONTEXTS,e,t);e.payload=JSON.stringify(e.flexObjects);e.dataType="json";e.contentType="application/json; charset=utf-8";return a.sendRequest(n,"POST",e).then(function(e){return e.response})},getFlexInfo(e){return u.getByReference(e.reference)}});function T(e){e.initialConnector=s;e.tokenUrl=this.ROUTES.TOKEN}function O(e){var t={title:e.title};e.payload=JSON.stringify(t);e.dataType="json";e.contentType="application/json; charset=utf-8"}function g(e){e.version=e.versionNumber.toString();delete e.versionNumber;return e}E.versions={load(e){T.call(this,e);var t={};i.addLanguageInfo(t);t.limit=e.limit;var n=i.getUrl(this.ROUTES.VERSIONS.GET,e,t);return i.sendRequest(n,"GET",e).then(function(e){return e.response.versions.map(function(e){return g(e)})})},activate(e){T.call(this,e);O(e);var t={version:e.version};i.addLanguageInfo(t);var n=i.getUrl(this.ROUTES.VERSIONS.ACTIVATE,e,t);return a.sendRequest(n,"POST",e).then(function(e){var t=e.response;return g(t)})},discardDraft(e){T.call(this,e);var t=i.getUrl(this.ROUTES.VERSIONS.DISCARD,e);return a.sendRequest(t,"DELETE",e)},publish(e){var n=t.getResourceBundleFor("sap.ui.fl");var r=function(t){l.hide();var r=n.getText("MSG_CF_PUBLISH_ERROR",t?[t.message||t]:undefined);var s=n.getText("HEADER_TRANSPORT_ERROR");c.error(`publish version error${t}`);S.show(r,{icon:S.Icon.ERROR,title:s,styleClass:e.styleClass});return"Error"};T.call(this,e);var s={version:e.version};var o=i.getUrl(this.ROUTES.VERSIONS.PUBLISH,e,s);return a.sendRequest(o,"POST",e).then(function(){l.hide();return n.getText("MSG_CF_PUBLISH_SUCCESS")}).catch(r)}};E.translation={getTexts(e){T.call(this,e);var t=o(e,["sourceLanguage","targetLanguage"]);var n=i.getUrl(this.ROUTES.TRANSLATION.DOWNLOAD,e,t);return i.sendRequest(n,"GET",e).then(function(e){return e.response})},getSourceLanguages(e){T.call(this,e);var t={};var n=i.getUrl(this.ROUTES.TRANSLATION.GET_SOURCELANGUAGE,e,t);return i.sendRequest(n,"GET",e).then(function(e){return e&&e.response&&e.response.sourceLanguages?e.response.sourceLanguages:[]})},postTranslationTexts(e){T.call(this,e);var t=i.getUrl(this.ROUTES.TRANSLATION.UPLOAD,e,{});return i.sendRequest(t,"POST",e)}};E.initialConnector=s;return E});
//# sourceMappingURL=KeyUserConnector.js.map