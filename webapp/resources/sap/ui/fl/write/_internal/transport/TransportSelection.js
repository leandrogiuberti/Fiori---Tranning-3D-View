/*
 * OpenUI5
 * (c) Copyright 2025 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["sap/ui/core/BusyIndicator","sap/ui/fl/initial/_internal/Settings","sap/ui/fl/write/_internal/transport/TransportDialog","sap/ui/fl/write/_internal/transport/Transports","sap/ui/fl/Layer","sap/ui/fl/LayerUtils","sap/ui/fl/Utils"],function(e,t,a,r,n,s,o){"use strict";var i=function(){};i.prototype.selectTransport=function(e,a,i,c,p,l,u){if(!o.getLrepUrl()){a(this._createEventObject(e,{transportId:""}));return}var f=function(e,t,a,n,o,i){r.getTransports(e).then(function(r){if(this._checkDialog(r,i)){this._openDialog({hidePackage:!s.doesCurrentLayerRequirePackage(),pkg:e.package,transports:r.transports,localObjectVisible:u,lrepObject:this._toLREPObject(e)},t,a,n,o)}else{var c=!r.localonly&&i?{transportId:"ATO_NOTIFICATION"}:this._getTransport(r);t(this._createEventObject(e,c))}}.bind(this),function(e){a(e)})};var g=s.getCurrentLayer();if(g&&(g===n.CUSTOMER||g===n.CUSTOMER_BASE)){t.getInstance().then(function(t){if(t.getIsAtoEnabled()){if(!(e&&e.name&&e.namespace&&e.type)){var r={transportId:"ATO_NOTIFICATION"};a(this._createEventObject(e,r))}else{f.apply(this,[e,a,i,c,l,true])}}else{f.apply(this,[e,a,i,c,l,false])}}.bind(this))}else{f.apply(this,[e,a,i,c,l,false])}};i.prototype._createEventObject=function(e,t){return{mParameters:{selectedTransport:t.transportId,selectedPackage:e.package,dialog:false},getParameters(){return this.mParameters},getParameter(e){return this.mParameters[e]}}};i.prototype._toLREPObject=function(e){var t={};if(e.namespace){t.namespace=e.namespace}if(e.name){t.name=e.name}if(e.type){t.type=e.type}return t};i.prototype._openDialog=function(t,r,n,s,o){var i=new a(t);i.attachOk(r);i.attachCancel(n);i.addStyleClass(o);if(s){i.addStyleClass("sapUiSizeCompact")}else{i.removeStyleClass("sapUiSizeCompact")}i.open();e.hide();return i};i.prototype._getTransport=function(e){var t;if(!e.localonly){t=this._hasLock(e.transports)}else{t={transportId:""}}return t};i.prototype._checkDialog=function(e,t){if(e){if(e.localonly||this._hasLock(e.transports)||!e.localonly&&t){return false}}return true};i.prototype._hasLock=function(e){var t=e.length;while(t--){var a=e[t];if(a.locked){return a}}return false};i.prototype.setTransports=function(e,t){var a=e.length-1;var r=this;var n=function(e,t,a,s,o){if(t>=0){var i=e[t];if(o===true){if(i.getFlexObjectMetadata().packageName!=="$TMP"){i.setRequest(s)}t--;return n(e,t,a,s,o)}if(i.getFlexObjectMetadata().packageName!=="$TMP"){var c={name:i.getId(),type:i.getFileType(),package:i.getFlexObjectMetadata().packageName,namespace:i.getNamespace()};return r.openTransportSelection(c,a).then(function(r){if(r==="cancel"){return Promise.reject("cancel")}i.setRequest(r.transport);if(r.fromDialog===true){s=r.transport;o=true}t--;return n(e,t,a,s,o)},function(){return null})}t--;return n(e,t,a,s,o)}return Promise.resolve()};return n(e,a,t)};i.prototype.openTransportSelection=function(e,t,a,r){var n=this;return new Promise(function(s,o){var i=function(e){if(e&&e.getParameters){var t=e.getParameters().selectedTransport;var a=e.getParameters().selectedPackage;var r=e.getParameters().dialog;var n={transport:t,packageName:a,fromDialog:r};s(n)}else{s({})}};var c=function(e){if(e.sId==="cancel"){s(e.sId)}else{o(e)}};n.selectTransport(e||{},i,c,false,t,a,r)})};i.prototype.checkTransportInfo=function(e){return e&&e.transport&&e.packageName!=="$TMP"};i.prototype._prepareChangesForTransport=function(e,t,a,n){var s=r.convertToChangeTransportData(t,a);var o={};o.package=e.packageName;o.transportId=e.transport;o.changeIds=s;o.reference=n.reference;o.layer=n.layer;return r.makeChangesTransportable(o).then(function(){t.forEach(function(t){var a=t.getFlexObjectMetadata();if(a.packageName==="$TMP"){a.packageName=e.packageName;t.setFlexObjectMetadata(a)}})})};return i});
//# sourceMappingURL=TransportSelection.js.map