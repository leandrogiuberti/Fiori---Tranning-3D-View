/*!
 * OpenUI5
 * (c) Copyright 2025 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["sap/ui/fl/apply/_internal/flexState/FlexState","sap/ui/fl/initial/_internal/FlexInfoSession","sap/ui/fl/initial/_internal/Loader","sap/ui/fl/initial/_internal/ManifestUtils","sap/ui/fl/initial/_internal/Settings","sap/ui/fl/initial/api/Version","sap/ui/fl/write/_internal/flexState/compVariants/CompVariantManager","sap/ui/fl/write/api/FeaturesAPI","sap/ui/fl/write/api/PersistenceWriteAPI","sap/ui/fl/write/api/VersionsAPI","sap/ui/fl/Layer","sap/ui/fl/LayerUtils","sap/ui/fl/write/_internal/init"],function(e,r,a,t,n,i,l,s,o,f,c,u){"use strict";async function v(e,a){if(r.getByReference(a).version){return false}const t=await s.isVersioningEnabled(e.layer);return t&&f.isDraftAvailable({control:e.selector,layer:e.layer})}async function y(e,a){var t=r.getByReference(a);var n=e.layer===c.USER;if(n||t.maxLayer&&t.maxLayer===e.layer){return false}const i=await o.hasHigherLayerChanges({selector:e.selector,ignoreMaxLayerParameter:e.ignoreMaxLayerParameter,upToLayer:e.layer,includeCtrlVariants:e.includeCtrlVariants,includeDirtyChanges:true});return i||g(e)}function g(e){if(u.isOverLayer(c.USER,e.layer)){return l.checkSVMControlsForDirty(t.getFlexReferenceForControl(e.selector))}return false}async function d(e,t){let n=r.getByReference(t);if(n.initialAllContexts){return false}if(n.allContextsProvided===undefined){const a={selector:e.selector,layer:e.layer};await o.updateResetAndPublishInfo(a);n=r.getByReference(t)}else{a.setAllContextsProvided(t,n.allContextsProvided)}n.initialAllContexts=!n.allContextsProvided;r.setByReference(n,t);return!n.allContextsProvided}function h(e){if(!n.getInstanceOrUndef()?.getIsContextSharingEnabled()){return false}return r.getByReference(e).allContextsProvided===false}function x(e){return r.getByReference(e).isEndUserAdaptation===false}var C={async getReloadReasonsForStart(e){const r=t.getFlexReferenceForControl(e.selector);const a=await Promise.all([y.call(this,e,r),v(e,r),d(e,r)]);const n={};[n.hasHigherLayerChanges,n.isDraftAvailable,n.allContexts]=a;return n},hasVersionStorage(e,a){const n=t.getFlexReferenceForControl(a);var i=r.getByReference(n);return!!(i.version&&i.version===e.value)},removeInfoSessionStorage(e){const a=t.getFlexReferenceForControl(e);r.removeByReference(a)},hasMaxLayerStorage(e,a){const n=t.getFlexReferenceForControl(a);var i=r.getByReference(n);return!!(i.maxLayer&&i.maxLayer===e.value)},handleReloadInfo(e){const a=t.getFlexReferenceForControl(e.selector);var n=false;var l=r.getByReference(a);if(!e.ignoreMaxLayerParameter&&e.hasHigherLayerChanges){delete l.maxLayer;delete l.adaptationLayer;n=true}if(e.versionSwitch&&l.version!==e.version){l.version=e.version;n=true}if(l.version&&e.removeVersionParameter||l.version===i.Number.Draft&&e.removeDraft){delete l.version;n=true}r.setByReference(l,a);return n},handleReloadInfoOnStart(e){const a=t.getFlexReferenceForControl(e.selector);var n=false;var l=r.getByReference(a);if(e.hasHigherLayerChanges){l.maxLayer=e.layer;n=true}if(e.isDraftAvailable){l.version=i.Number.Draft;n=true}r.setByReference(l,a);return n},initialDraftGotActivated(e){if(e.versioningEnabled){var r=this.hasVersionStorage({value:i.Number.Draft},e.selector);return!f.isDraftAvailable({control:e.selector,layer:e.layer})&&r}return false},getReloadInfo(e){const a=t.getFlexReferenceForControl(e.selector);const n={};n.isDraftAvailable=e.isDraftAvailable||C.hasVersionStorage({value:i.Number.Draft},e.selector);n.hasVersionStorage=!!r.getByReference(a).version;if(e.activeVersion&&e.activeVersion!==i.Number.Original&&n.hasVersionStorage){n.activeVersionNotSelected=!C.hasVersionStorage({value:e.activeVersion},e.selector)}n.hasHigherLayerChanges=C.hasMaxLayerStorage({value:e.layer},e.selector);n.initialDraftGotActivated=C.initialDraftGotActivated(e);if(n.initialDraftGotActivated){n.isDraftAvailable=false}n.allContexts=h(a);n.switchEndUserAdaptation=x(a);n.reloadNeeded=n.isDraftAvailable||n.hasHigherLayerChanges||n.initialDraftGotActivated||n.activeVersionNotSelected||n.allContexts||n.switchEndUserAdaptation;return n}};return C});
//# sourceMappingURL=ReloadInfoAPI.js.map