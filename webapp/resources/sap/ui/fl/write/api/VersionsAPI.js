/*!
 * OpenUI5
 * (c) Copyright 2025 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["sap/ui/fl/apply/_internal/flexState/FlexObjectState","sap/ui/fl/apply/_internal/flexState/FlexState","sap/ui/fl/initial/_internal/FlexInfoSession","sap/ui/fl/initial/_internal/ManifestUtils","sap/ui/fl/initial/api/Version","sap/ui/fl/write/_internal/flexState/FlexObjectManager","sap/ui/fl/write/_internal/Versions","sap/ui/fl/write/api/ContextBasedAdaptationsAPI","sap/ui/fl/write/api/FeaturesAPI","sap/ui/fl/Utils","sap/ui/fl/write/_internal/init"],function(e,r,t,n,i,o,a,s,l,c){"use strict";function d(e){const r=n.getFlexReferenceForControl(e);if(!r){throw Error("The application ID could not be determined")}return r}function f(r){const t=e.getDirtyFlexObjects(r);return t.length>0}function p(e){if(!e.control){throw Error("No control was provided")}if(!e.layer){throw Error("No layer was provided")}var r=d(e.control);const t=a.getVersionsModel({reference:r,layer:e.layer});if(f(r)){t.updateDraftVersion()}return t}function u(e){var r=d(e.control);var t=s.hasAdaptationsModel({layer:e.layer,reference:r});if(!e.adaptationId&&t){return s.refreshAdaptationModel(e)}else if(e.adaptationId&&t){var n=s.getAdaptationsModel(e);n.switchDisplayedAdaptation(e.adaptationId);return Promise.resolve(e.adaptationId)}return Promise.resolve()}var v={};v.initialize=function(e){if(!e.control){return Promise.reject("No control was provided")}if(!e.layer){return Promise.reject("No layer was provided")}var r=c.getAppComponentForControl(e.control);return a.initialize({reference:d(r),layer:e.layer})};v.clearInstances=function(){a.clearInstances()};v.isDraftAvailable=function(e){var r=p(e);var t=r.getProperty("/versions");var n=t.find(function(e){return e.version===i.Number.Draft});return!!n};v.getDraftFilenames=function(e){const r=p(e);return r.getProperty("/draftFilenames")};v.isOldVersionDisplayed=function(e){var r=p(e);var t=r.getProperty("/displayedVersion");var n=r.getProperty("/activeVersion");return t!==i.Number.Draft&&t!==n};v.loadDraftForApplication=function(e){e.version=i.Number.Draft;return v.loadVersionForApplication(e)};v.loadVersionForApplication=function(e){if(!e.control){return Promise.reject("No control was provided")}if(!e.layer){return Promise.reject("No layer was provided")}const n=p(e);if(n){if(e.version===undefined){e.version=n.getProperty("/activeVersion")}n.setProperty("/displayedVersion",e.version);n.setProperty("/persistedVersion",e.version);if(e.version!==i.Number.Draft&&l.isPublishAvailable()){const r=n.getProperty("/versions");if(r.length){const t=r.find(function(r){return r.version===e.version});if(t){n.setProperty("/publishVersionEnabled",!t.isPublished)}}}}return u(e).then(function(n){const i=c.getAppComponentForControl(e.control);const o=d(i);const a=t.getByReference(o);a.version=e.version;a.displayedAdaptationId=n;t.setByReference(a,o);r.clearState(o)})};v.activate=function(e){if(!e.control){return Promise.reject("No control was provided")}if(!e.layer){return Promise.reject("No layer was provided")}if(!e.title){return Promise.reject("No version title was provided")}const r=d(e.control);if(f(r)){return Promise.reject("Unsaved changes exist")}const n=t.getByReference(r);delete n.version;t.setByReference(n,r);return a.activate({reference:r,layer:e.layer,title:e.title,appComponent:c.getAppComponentForControl(e.control),displayedVersion:e.displayedVersion})};v.discardDraft=function(n){const i=c.getAppComponentForControl(n.control);const l=d(i);function f(){const r=e.getDirtyFlexObjects(l);o.deleteFlexObjects({reference:l,flexObjects:r});return r.length>0}if(!n.control){return Promise.reject("No control was provided")}if(!n.layer){return Promise.reject("No layer was provided")}return a.discardDraft({reference:l,layer:n.layer,discardDraftAndKeepActiveVersion:n.discardDraftAndKeepActiveVersion}).then(function(e){var i=false;if(!n.discardDraftAndKeepActiveVersion){i=f()}e.dirtyChangesDiscarded=i;if(e.backendChangesDiscarded){const i=s.hasAdaptationsModel({layer:n.layer,reference:l});if(i){return s.refreshAdaptationModel(n).then(function(i){const o=t.getByReference(l);o.displayedAdaptationId=i;t.setByReference(o,l);if(!n.discardDraftAndKeepActiveVersion){r.clearState(l)}return e})}}if(!n.discardDraftAndKeepActiveVersion){r.clearState(l)}return e})};v.publish=function(e){if(!e.selector){return Promise.reject("No selector was provided")}if(!e.layer){return Promise.reject("No layer was provided")}if(!e.version){return Promise.reject("No version was provided")}e.styleClass||="";e.reference=d(e.selector);return a.publish(e)};v.getCreatedVersionsByUser=function(e,r){const t=p(e);const n=t.getProperty("/versions");return n.filter(e=>e.activatedBy===r)};return v});
//# sourceMappingURL=VersionsAPI.js.map