/*!
 * OpenUI5
 * (c) Copyright 2025 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["sap/base/util/restricted/_omit","sap/base/util/merge","sap/base/Log","sap/ui/core/util/reflection/JsControlTreeModifier","sap/ui/fl/apply/_internal/changes/Utils","sap/ui/fl/apply/_internal/flexObjects/FlexObjectFactory","sap/ui/fl/apply/_internal/flexObjects/States","sap/ui/fl/apply/_internal/flexState/changes/DependencyHandler","sap/ui/fl/apply/_internal/flexState/FlexObjectState","sap/ui/fl/apply/_internal/flexState/FlexState","sap/ui/fl/initial/_internal/changeHandlers/ChangeHandlerStorage","sap/ui/fl/initial/_internal/ManifestUtils","sap/ui/fl/Utils"],(e,t,n,i,a,o,r,s,l,c,g,p,f)=>{"use strict";const d={};function u(e,t){if(t.fragmentId){const n=e.getExtensionPointInfo&&e.getExtensionPointInfo();if(n){return t.fragmentId!==n.fragmentId}return true}return false}function C(e,n,i){let a=e.getSelector();if(n.closestAggregationBindingCarrier&&n.closestAggregationBinding){a=t(a,{id:n.closestAggregationBindingCarrier,idIsLocal:false});const o={id:n.targetControl.getId(),idIsLocal:false};if(i){e.originalSelectorToBeAdjusted=o}else{e.setDependentSelectors({originalSelector:o})}e.setContent({boundAggregation:n.closestAggregationBinding})}else{a=t(a,{id:n.targetControl.getId(),idIsLocal:false})}e.setSelector(a)}function m(e){const t=o.createUIChange(e.changeSpecificData);return g.getChangeHandler(t.getChangeType(),e.controlType,e.selector,i,t.getLayer()).then(n=>n.completeChangeContent(t,e.changeSpecificData,{modifier:i,appComponent:e.appComponent,view:f.getViewForControl(e.selector)})).then(()=>{t.setState(r.LifecycleState.NEW);return t})}function h(e){if(e.selector.name&&e.selector.view){const t=f.getAppComponentForSelector(e.selector.view);const n=e.selector.appId||p.getFlexReferenceForControl(t);e.appComponent=t;e.changeSpecificData.reference=n;e.changeSpecificData.selector={name:e.selector.name,viewSelector:i.getSelector(e.selector.view.getId(),t)};return m(e)}return undefined}d.getChangesForExtensionPoint=function(e,t){if(!t.extensionPointName){n.error("Missing name from extension point info!");return[]}const i=l.getAllApplicableUIChanges(e);return i.filter(e=>{if(e.getSelector().name!==t.extensionPointName){return false}return a.isChangeInView(t,e)})};d.enhanceExtensionPointChanges=function(t,n){t.extensionPointName=n.name;const i=p.getFlexReferenceForControl(n.targetControl);const a=d.getChangesForExtensionPoint(i,t);const o=[];a.forEach(function(a){if(a.isInInitialState()&&!(a.getExtensionPointInfo&&a.getExtensionPointInfo())){a.setExtensionPointInfo(n);C(a,n,false);if(c.isInitialized(t)){s.addChangeAndUpdateDependencies(a,t.appComponent,l.getLiveDependencyMap(i))}}else if(u(a,n)){const r=a.convertToFileContent();const c=e(r,["dependentSelector","fileName","selector","adaptationId"]);c.support.sourceChangeFileName=a.getId()||"";o.push(h({changeSpecificData:c,selector:{view:n.view,name:n.name}}).then(function(e){C(e,n,true);e.setExtensionPointInfo(n);const r=e.getFlexObjectMetadata();r.moduleName=a.getFlexObjectMetadata().moduleName;e.setFlexObjectMetadata(r);e.setCreation(a.getCreation());s.insertChange(e,l.getLiveDependencyMap(i),a);s.addChangeAndUpdateDependencies(e,t.appComponent,l.getLiveDependencyMap(i));o.push(e)}))}});return Promise.all(o).then(function(){return a})};return d});
//# sourceMappingURL=ExtensionPointState.js.map