/*!
 * OpenUI5
 * (c) Copyright 2025 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["sap/base/Log","sap/ui/fl/apply/_internal/changes/Applier","sap/ui/fl/apply/_internal/changes/FlexCustomData","sap/ui/fl/apply/_internal/changes/Utils","sap/ui/fl/apply/_internal/flexState/changes/DependencyHandler","sap/ui/fl/apply/_internal/flexState/FlexObjectState","sap/ui/fl/Utils"],function(e,t,r,n,o,i,a){"use strict";const s={};async function l(e){if(!e.isApplyProcessFinished()&&e.hasApplyProcessStarted()){const t=await e.addPromiseForApplyProcessing();if(t&&t.error){e.markRevertFinished(t.error);throw Error(t.error)}}}function c(e,t){const r=e.getId();const n=i.getLiveDependencyMap(t);o.removeChangeFromMap(n,r);o.removeChangeFromDependencies(n,r)}async function p(e,t,n,o){const i=await s.revertChangeOnControl(e,t,n);r.destroyAppliedCustomData(i||t,e,o.modifier);if(i){c(e,o.reference)}}s.revertChangeOnControl=async function(t,r,o){const i=n.getControlIfTemplateAffected(t,r,o);try{const e=await n.getChangeHandler({flexObject:t,control:i.control,controlType:i.controlType,modifier:o.modifier});await l(t);if(t.isSuccessfullyApplied()){t.startReverting()}else{throw Error("Change was never applied")}await e.revertChange(t,i.control,o);i.control=o.modifier.bySelector(t.getSelector(),o.appComponent,o.view);if(i.bTemplateAffected){await o.modifier.updateAggregation(i.control,t.getContent().boundAggregation)}t.markRevertFinished();return i.control}catch(r){const n=`Change could not be reverted: ${r.message}`;e.error(n);t.markRevertFinished(n);return false}};s.revertMultipleChanges=function(e,r){const n=[];e.forEach(e=>{if(!r.skipSetQueued){e.setQueuedForRevert()}n.push(()=>{const t=e.getSelector&&e.getSelector();const n=r.modifier.bySelector(t,r.appComponent);if(!n){c(e,r.reference);return a.FakePromise?new a.FakePromise:Promise.resolve()}const o={modifier:r.modifier,appComponent:r.appComponent,view:a.getViewForControl(n)};return p(e,n,o,r)})});const o=a.execPromiseQueueSequentially(n);t.addPreConditionForInitialChangeApplying(o);return o};return s});
//# sourceMappingURL=Reverter.js.map