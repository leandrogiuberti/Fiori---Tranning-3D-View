/*!
 * OpenUI5
 * (c) Copyright 2025 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["sap/base/Log","sap/m/VariantItem","sap/m/VariantManagement","sap/ui/core/Control","sap/ui/core/Lib","sap/ui/core/library","sap/ui/fl/apply/api/ControlVariantApplyAPI","sap/ui/fl/initial/_internal/Settings","sap/ui/fl/Utils","sap/ui/model/Context","sap/ui/model/Filter","sap/ui/model/FilterOperator"],function(t,e,n,a,i,o,r,s,l,p,h,c){"use strict";var{TitleLevel:d}=o;var u=a.extend("sap.ui.fl.variants.VariantManagement",{metadata:{interfaces:["sap.ui.core.IShrinkable","sap.m.IOverflowToolbarContent","sap.m.IToolbarInteractiveControl"],library:"sap.ui.fl",designtime:"sap/ui/fl/designtime/variants/VariantManagement.designtime",properties:{updateVariantInURL:{type:"boolean",group:"Misc",defaultValue:false},resetOnContextChange:{type:"boolean",group:"Misc",defaultValue:true},modelName:{type:"string",group:"Misc",defaultValue:""},editable:{type:"boolean",group:"Misc",defaultValue:true},showSetAsDefault:{type:"boolean",group:"Misc",defaultValue:true},inErrorState:{type:"boolean",group:"Misc",defaultValue:false},executeOnSelectionForStandardDefault:{type:"boolean",group:"Misc",defaultValue:false},displayTextForExecuteOnSelectionForStandardVariant:{type:"string",group:"Misc",defaultValue:""},headerLevel:{type:"sap.ui.core.TitleLevel",group:"Appearance",defaultValue:d.Auto},titleStyle:{type:"sap.ui.core.TitleLevel",group:"Appearance",defaultValue:d.Auto},maxWidth:{type:"sap.ui.core.CSSSize",group:"Dimension",defaultValue:"100%"}},events:{initialized:{},save:{parameters:{name:{type:"string"},overwrite:{type:"boolean"},key:{type:"string"},execute:{type:"boolean"},public:{type:"boolean"},def:{type:"boolean"},contexts:{type:"object[]"},tile:{type:"boolean"}}},cancel:{},manage:{parameters:{renamed:{type:"object[]"},deleted:{type:"string[]"},exe:{type:"object[]"},fav:{type:"object[]"},def:{type:"string"},contexts:{type:"object[]"}}},select:{parameters:{key:{type:"string"}}}},associations:{for:{type:"sap.ui.core.Control",multiple:true}},aggregations:{_embeddedVM:{type:"sap.m.VariantManagement",multiple:false,visibility:"hidden"}}},renderer:{apiVersion:2,render(t,e){t.openStart("div",e);t.style("max-width",e.getMaxWidth());t.openEnd();t.renderControl(e._oVM);t.close("div")}},constructor:function(...t){a.prototype.constructor.apply(this,t);this._oInitPromise=new Promise(t=>{this.attachEventOnce("initialized",()=>{t()})})}});u.prototype.init=function(){a.prototype.init.apply(this);this.addStyleClass("sapUiFlVarMngmt");this._oRb=i.getResourceBundleFor("sap.ui.fl");this.setModelName(r.getVariantModelName());this.attachModelContextChange(this._setModel,this);this._oVM=new n(`${this.getId()}-vm`);this.setAggregation("_embeddedVM",this._oVM,true);this._aCancelEventHandlers=[];this._aSaveEventHandlers=[];this._aManageEventHandlers=[];this._aSelectEventHandlers=[];this._oVariantAppliedListeners={};this._oVM.attachManage(this._fireManage,this);this._oVM.attachCancel(this._fireCancel,this);this._oVM.attachSave(this._fireSave,this);this._oVM.attachSelect(this._fireSelect,this);this._updateWithSettingsInfo()};u.prototype.waitForInit=function(){return this._oInitPromise};u.prototype.getOverflowToolbarConfig=function(){return{canOverflow:false,invalidationEvents:["save","manage","select"]}};u.prototype.attachCancel=function(t,e,n){this.attachEvent("cancel",t,e,n);return this};u.prototype._findCallback=function(t,e,n){var a=-1;t.some(function(t,i){if(t.fCallback===e&&t.oObj===n){a=i}return a>=0});return a};u.prototype.detachCancel=function(t,e){var n=this._findCallback(this._aCancelEventHandlers,t,e);if(n>=0){this.detachEvent("cancel",t,e);this._aCancelEventHandlers.splice(n,1)}return this};u.prototype.fireManage=function(t){this._oVM.fireManage(t)};u.prototype.fireSave=function(t){this._oVM.fireSave(t)};u.prototype._fireCancel=function(t){for(var e=0;e<this._aCancelEventHandlers.length;e++){t.oSource=this;this._aCancelEventHandlers[e].fCallbackBound(t,this._aCancelEventHandlers[e].mProps)}};u.prototype.attachSave=function(t,e,n){this.attachEvent("save",t,e,n);return this};u.prototype.detachSave=function(t,e){var n=this._findCallback(this._aSaveEventHandlers,t,e);if(n>-1){this.detachEvent("save",t,e);this._aSaveEventHandlers.splice(n,1)}return this};u.prototype._fireSave=function(t){this._handleAllListeners(t,this._aSaveEventHandlers)};u.prototype.hasListeners=function(...t){const[e]=t;const n=["save","select","cancel","manage"];if(n.indexOf(e)>-1){var i=null;if(e==="select"){i=this._aSelectEventHandlers}else if(e==="save"){i=this._aSaveEventHandlers}else if(e==="manage"){i=this._aManageEventHandlers}else if(e==="cancel"){i=this._aCancelEventHandlers}return i.length>0}return a.prototype.hasListeners.apply(this,t)};u.prototype.attachEvent=function(...t){const[e,,n]=t;let[,i,,o]=t;const r=["save","select","cancel","manage"];if(r.indexOf(e)>-1){var s=null;var l=n;if(typeof i==="function"){l=i;o=n;i=undefined}o=o===this?undefined:o;if(e==="select"){s=this._aSelectEventHandlers}else if(e==="save"){s=this._aSaveEventHandlers}else if(e==="manage"){s=this._aManageEventHandlers}else if(e==="cancel"){s=this._aCancelEventHandlers}s.push({fCallback:l,fCallbackBound:o?l.bind(o):l,oObj:o,mProps:i})}else{a.prototype.attachEvent.apply(this,t)}};u.prototype.attachEventOnce=function(...t){const[e,n,i,o]=t;var r;if(e==="manage"){r=this._findCallback(this._aManageEventHandlers,i,o);if(r>-1&&this._aManageEventHandlers[r].bOnce){this._aManageEventHandlers.splice(r,1)}this.attachManage(n,i,o);r=this._findCallback(this._aManageEventHandlers,i,o);if(r>-1){this._aManageEventHandlers[r].bOnce=true}}else if(e==="save"){r=this._findCallback(this._aSaveEventHandlers,i,o);if(r>-1&&this._aSaveEventHandlers[r].bOnce){this._aSaveEventHandlers.splice(r,1)}this.attachSave(n,i,o);r=this._findCallback(this._aSaveEventHandlers,i,o);if(r>-1){this._aSaveEventHandlers[r].bOnce=true}}else if(e==="select"){r=this._findCallback(this._aSelectEventHandlers,i,o);if(r>-1&&this._aSelectEventHandlers[r].bOnce){this._aSelectEventHandlers.splice(r,1)}this.attachSelect(n,i,o);r=this._findCallback(this._aSelectEventHandlers,i,o);if(r>-1){this._aSelectEventHandlers[r].bOnce=true}}else{a.prototype.attachEventOnce.apply(this,t)}};u.prototype.attachManage=function(t,e,n){this.attachEvent("manage",t,e,n);return this};u.prototype._handleAllListeners=function(t,e){var n=0;var a=[];while(n<e.length){t.oSource=this;e[n].fCallbackBound(t,e[n].mProps);if(e[n]){if(e[n].hasOwnProperty("bOnce")&&e[n].bOnce){a.push(n)}n+=1}}for(n=a.length-1;n>-1;n--){e.splice(a[n],1)}};u.prototype._fireManage=function(t){this._handleAllListeners(t,this._aManageEventHandlers)};u.prototype.detachManage=function(t,e){var n=this._findCallback(this._aManageEventHandlers,t,e);if(n>-1){this.detachEvent("manage",t,e);this._aManageEventHandlers.splice(n,1)}return this};u.prototype.attachSelect=function(t,e,n){this.attachEvent("select",t,e,n);return this};u.prototype._fireSelect=function(t){this._handleAllListeners(t,this._aSelectEventHandlers)};u.prototype.detachSelect=function(t,e){var n=this._findCallback(this._aSelectEventHandlers,t,e);if(n>-1){this.detachEvent("select",t,e);this._aSelectEventHandlers.splice(n,1)}return this};u.prototype._createSaveAsDialog=function(){this._oVM._createSaveAsDialog()};u.prototype._handleVariantSaveAs=function(t){this._oVM._handleVariantSaveAs(t)};u.prototype.getFocusDomRef=function(){if(this._oVM){return this._oVM.oVariantPopoverTrigger.getFocusDomRef()}return null};u.prototype.getManageDialog=function(){if(this._oVM){return this._oVM.oManagementDialog}return null};u.prototype.getVariants=function(){return this._oVM?this._oVM.getItems():[]};u.prototype.getVariantByKey=function(t){return this._oVM?this._oVM._getItemByKey(t):null};u.prototype.getTitle=function(){return this._oVM.getTitle()};u.prototype.refreshTitle=function(){this._oVM.refreshTitle()};u.prototype.setPopoverTitle=function(t){this._oVM.setPopoverTitle(t);return this};u.prototype.setHeaderLevel=function(t){this.setProperty("headerLevel",t);this._oVM.setLevel(t);return this};u.prototype.setTitleStyle=function(t){this.setProperty("titleStyle",t);this._oVM.setTitleStyle(t);return this};u.prototype.setShowAsText=function(t){this._oVM.setShowAsText(t);return this};u.prototype.getShowAsText=function(){return this._oVM.getShowAsText()};u.prototype.setEditable=function(t){this.setProperty("editable",t);this._oVM.setShowFooter(t);return this};u.prototype.setShowExecuteOnSelection=function(t){this._oVM.setSupportApplyAutomatically(t);return this};u.prototype.setShowSetAsDefault=function(t){this.setProperty("showSetAsDefault",t);this._oVM.setSupportDefault(t);return this};u.prototype.setDisplayTextForExecuteOnSelectionForStandardVariant=function(t){this.setProperty("displayTextForExecuteOnSelectionForStandardVariant",t);this._oVM.setDisplayTextForExecuteOnSelectionForStandardVariant(t);return this};u.prototype.setInErrorState=function(t){this.setProperty("inErrorState",t);this._oVM.setInErrorState(t);return this};u.prototype._setStandardVariantKey=function(t){this._oVM.setStandardVariantKey(t)};u.prototype.openManagementDialog=function(t,e,n){this._oVM.openManagementDialog(t,e,n)};u.prototype.openSaveAsDialogForKeyUser=function(t,e){this._oVM.openSaveAsDialog(t,e)};u.prototype.setEditable=function(t){this._oVM.setProperty("showFooter",t);return this};u.prototype.setCurrentVariantKey=function(t){this._oVM.setCurrentVariantKey(t)};u.prototype.getCurrentVariantKey=function(){return this._oVM.getSelectedKey()};u.prototype.setDefaultVariantKey=function(t){this._oVM.setDefaultKey(t)};u.prototype.getDefaultVariantKey=function(){return this._oVM.getDefaultKey()};u.prototype.enteringDesignMode=function(){this._oVM.setDesignMode(true)};u.prototype.leavingDesignMode=function(){this._oVM.setDesignMode(false)};u.prototype.getModified=function(){return this._oVM.getModified()};u.prototype.setModified=function(t){this._oVM.setModified(t)};u.prototype.getStandardVariantKey=function(){return this._oVM.getStandardVariantKey()};u.prototype._getEmbeddedVM=function(){return this._oVM};u.prototype._updateWithSettingsInfo=function(){s.getInstance().then(function(t){if(this._oVM){this._oVM.setShowSaveAs(t.getIsVariantPersonalizationEnabled());this._oVM.setSupportPublic(t.getIsPublicFlVariantEnabled())}}.bind(this)).catch(function(e){t.error(e)})};u.prototype.getModelName=function(){return this.getProperty("modelName")};u.prototype.setModelName=function(t){if(this.getModelName()){this.oContext=null;this._aCancelEventHandlers=[];this._aSaveEventHandlers=[];this._aManageEventHandlers=[];this._aSelectEventHandlers=[]}this.setProperty("modelName",t);return this};u.prototype._setModel=function(){this._setBindingContext()};u.prototype._setBindingContext=function(){var t;var e;var n=this.getModelName();if(!this.oContext){t=this.getModel(n);if(t){e=this.getVariantManagementReference();if(e){this.oContext=new p(t,`/${e}`);this.setBindingContext(this.oContext,n);if(t.registerToModel){t.registerToModel(this)}this.fireInitialized();this._oVM.setModel(t,n);this._createItemsModel(n);this._oVM.bindProperty("selectedKey",{path:`${this.oContext}/currentVariant`,model:n});this._oVM.bindProperty("defaultKey",{path:`${this.oContext}/defaultVariant`,model:n});this._oVM.bindProperty("modified",{path:`${this.oContext}/modified`,model:n});this._oVM.bindProperty("supportFavorites",{path:`${this.oContext}/showFavorites`,model:n});this._oVM.bindProperty("showFooter",{path:`${this.oContext}/variantsEditable`,model:n});this._oVM.setPopoverTitle(this._oRb.getText("VARIANT_MANAGEMENT_VARIANTS"));this._setStandardVariantKey(e)}}}};u.prototype._createItemsModel=function(t){this._oItemsTemplate=new e({key:`{${t}>key}`,title:`{${t}>title}`,sharing:`{${t}>sharing}`,remove:`{${t}>remove}`,favorite:`{${t}>favorite}`,executeOnSelect:`{${t}>executeOnSelect}`,rename:`{${t}>rename}`,visible:`{${t}>visible}`,changeable:`{${t}>change}`,author:`{${t}>author}`,contexts:`{${t}>contexts}`});this._oVM.bindAggregation("items",{path:`${this.oContext}/variants`,model:t,template:this._oItemsTemplate,filters:new h({path:"visible",operator:c.EQ,value1:true})})};u.prototype._getInnerItems=function(){var t=[];if(this.oContext&&this.oContext.getObject()){t=this.oContext.getObject().variants.filter(function(t){if(!t.hasOwnProperty("visible")){return true}return t.visible})}return t};u.prototype._getInnerItemByKey=function(t){var e=null;var n=this._getInnerItems();n.some(function(n){if(n.key===t){e=n}return e!==null});return e};u.prototype.registerApplyAutomaticallyOnStandardVariant=function(t){this._fRegisteredApplyAutomaticallyOnStandardVariant=t;return this};u.prototype.getApplyAutomaticallyOnVariant=function(e){var n=false;if(e){n=e.executeOnSelect;if(this._fRegisteredApplyAutomaticallyOnStandardVariant&&this.getDisplayTextForExecuteOnSelectionForStandardVariant()&&e.key===this._oVM.getStandardVariantKey()){try{n=this._fRegisteredApplyAutomaticallyOnStandardVariant(e)}catch(e){t.error("callback for determination of apply automatically on standard variant failed")}}}return n};u.prototype.exit=function(...t){this._oVM.detachManage(this._fireManage,this);this._oVM.detachCancel(this._fireCancel,this);this._oVM.detachSelect(this._fireSelect,this);this._oVM.detachSave(this._fireSave,this);if(this._oVM){this._oVM.destroy();this._oVM=undefined}if(this._oItemsTemplate){this._oItemsTemplate.destroy();this._oItemsTemplate=undefined}this._fRegisteredApplyAutomaticallyOnStandardVariant=null;this.oContext=undefined;this._oRb=undefined;this._aCancelEventHandlers=undefined;this._aSaveEventHandlers=undefined;this._aManageEventHandlers=undefined;this._aSelectEventHandlers=undefined;a.prototype.exit.apply(this,t)};u.prototype.addFor=function(t){this.addAssociation("for",t);return this};u.prototype._getToolbarInteractive=function(){return true};u.prototype._addVariantAppliedListener=function(t,e){this._oVariantAppliedListeners[t.getId()]=e};u.prototype._removeVariantAppliedListener=function(t){delete this._oVariantAppliedListeners[t.getId()]};u.prototype._executeAllVariantAppliedListeners=function(t){Object.values(this._oVariantAppliedListeners).forEach(function(e){e(t)})};u.prototype.getVariantManagementReference=function(){const t=this.getId();const e=l.getAppComponentForControl(this);return e&&e.getLocalId(t)||t};return u});
//# sourceMappingURL=VariantManagement.js.map