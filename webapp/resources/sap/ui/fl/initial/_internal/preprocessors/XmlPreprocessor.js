/*!
 * OpenUI5
 * (c) Copyright 2025 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["sap/base/util/merge","sap/base/Log","sap/ui/core/util/reflection/XmlTreeModifier","sap/ui/core/Component","sap/ui/fl/initial/_internal/Loader","sap/ui/fl/initial/_internal/ManifestUtils","sap/ui/fl/initial/_internal/StorageUtils","sap/ui/fl/requireAsync","sap/ui/fl/Utils"],function(e,t,n,a,i,r,o,l,s){"use strict";var c=function(){};c.NOTAG="<NoTag>";async function p(e){const t=await l("sap/ui/fl/apply/_internal/flexState/FlexObjectState");const n=t.getAllApplicableUIChanges(e.reference);const a=await l("sap/ui/fl/apply/_internal/changes/Utils");return n.filter(a.isChangeInView.bind(undefined,e))}c.process=async function(c,f){try{f.viewId=f.id;var u=a.getComponentById(f.componentId);if(!u){t.warning("View is generated without a component. Flexibility features are not possible.");return c}var g=s.getAppComponentForControl(u);if(!s.isApplication(g.getManifestObject())){return c}const d=r.getFlexReferenceForControl(g);await i.waitForInitialization(d);const w=i.getCachedFlexData(d);if(!o.isStorageResponseFilled(w.changes)){return c}const y=await l("sap/ui/fl/apply/_internal/flexState/FlexState");await y.waitForInitialization(d);const C=e({appComponent:g,modifier:n,view:c,reference:d},f);const F=await p(C);const h=await l("sap/ui/fl/apply/_internal/changes/Applier");await h.applyAllChangesForXMLView(C,F);t.debug(`flex processing view ${f.id} finished`);return c}catch(e){var d=`view ${f.id}: ${e}`;t.info(d);return c}};function f(e,t){if(!t){return e}return e.concat("-",t)}function u(e){return e.replace(/(^W\/|")/g,"")}c.getCacheKey=async function(e){const t=a.getComponentById(e.componentId);const n=s.getAppComponentForControl(t);if(s.isVariantByStartupParameter(n)){return undefined}const p=r.getFlexReferenceForControl(n);let g=c.NOTAG;if(p){await i.waitForInitialization(p);const e=i.getCachedFlexData(p);if(e&&e.cacheKey&&o.isStorageResponseFilled(e.changes)){g=u(e.cacheKey);const t=await l("sap/ui/fl/apply/_internal/flexState/controlVariants/VariantManagementState");const n=t.getAllCurrentVariants(p).filter(e=>!e.getStandardVariant()).map(e=>e.getId());g=f(g,n.join("-"))}}return g};return c},true);
//# sourceMappingURL=XmlPreprocessor.js.map