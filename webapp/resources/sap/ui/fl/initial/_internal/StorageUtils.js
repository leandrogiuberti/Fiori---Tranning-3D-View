/*!
 * OpenUI5
 * (c) Copyright 2025 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["sap/base/util/isEmptyObject","sap/base/util/ObjectPath","sap/base/Log","sap/ui/fl/initial/_internal/FlexConfiguration","sap/ui/fl/Layer","sap/ui/fl/LayerUtils"],function(e,n,t,a,r,o){"use strict";const i={};var c={load:{LrepConnector:"sap/ui/fl/initial/_internal/connectors/LrepConnector",NeoLrepConnector:"sap/ui/fl/initial/_internal/connectors/NeoLrepConnector",PersonalizationConnector:"sap/ui/fl/initial/_internal/connectors/PersonalizationConnector",KeyUserConnector:"sap/ui/fl/initial/_internal/connectors/KeyUserConnector",BtpServiceConnector:"sap/ui/fl/initial/_internal/connectors/BtpServiceConnector",StaticFileConnector:"sap/ui/fl/initial/_internal/connectors/StaticFileConnector",JsObjectConnector:"sap/ui/fl/write/_internal/connectors/JsObjectConnector",ObjectPathConnector:"sap/ui/fl/write/_internal/connectors/ObjectPathConnector",LocalStorageConnector:"sap/ui/fl/write/_internal/connectors/LocalStorageConnector",SessionStorageConnector:"sap/ui/fl/write/_internal/connectors/SessionStorageConnector"},write:{LrepConnector:"sap/ui/fl/write/_internal/connectors/LrepConnector",NeoLrepConnector:"sap/ui/fl/write/_internal/connectors/NeoLrepConnector",PersonalizationConnector:"sap/ui/fl/write/_internal/connectors/PersonalizationConnector",KeyUserConnector:"sap/ui/fl/write/_internal/connectors/KeyUserConnector",BtpServiceConnector:"sap/ui/fl/write/_internal/connectors/BtpServiceConnector",StaticFileConnector:"sap/ui/fl/write/_internal/connectors/StaticFileConnector",JsObjectConnector:"sap/ui/fl/write/_internal/connectors/JsObjectConnector",ObjectPathConnector:"sap/ui/fl/write/_internal/connectors/ObjectPathConnector",LocalStorageConnector:"sap/ui/fl/write/_internal/connectors/LocalStorageConnector",SessionStorageConnector:"sap/ui/fl/write/_internal/connectors/SessionStorageConnector"}};var s="sap/ui/fl/initial/_internal/connectors/";var l={connector:"StaticFileConnector"};function p(e,n){var t=[];if(!e){t=n}else{t=e.filter(function(e){return n.indexOf(e)!==-1||n[0]==="ALL"})}return t}function u(e,n,t){return t.map(function(e){var t=e.connector;var a;if(!e.loadConnector&&!e.applyConnector&&!e.loadConnector){a=n?c.load[t]:c.write[t]}else if(n){a=e.loadConnector||e.applyConnector}else{a=e.writeConnector||"sap/ui/fl/write/connectors/BaseConnector"}return a})}function f(e){switch(e.fileType){case"change":if(e.selector&&e.selector.persistencyKey){return["comp","changes"]}if(e.variantReference){return"variantDependentControlChanges"}if(e.appDescriptorChange){return"appDescriptorChanges"}return"changes";case"ctrl_variant":return"variants";case"ctrl_variant_change":return"variantChanges";case"ctrl_variant_management_change":return"variantManagementChanges";case"variant":return["comp","variants"];case"annotation_change":return"annotationChanges";default:return""}}i.requireConnectors=function(e){return new Promise(function(n){sap.ui.require(e,function(...e){n(e)})})};async function g(e,n,t){var a=u(e,n,t);const r=await i.requireConnectors(a,n,t);r.forEach(function(e,a){if(!t[a].layers){t[a].layers=e.layers}else{t[a].layers=p(t[a].layers,e.layers)}if(n){t[a].loadConnectorModule=e}else{t[a].writeConnectorModule=e}});return t}i.getConnectors=function(e,n,t){var r=a.getFlexibilityServices();var o=[];if(n&&!t){o=[l]}o=o.concat(r);return g(e,n,o)};i.getLoadConnectors=function(e){return this.getConnectors(s,true,e)};i.getStaticFileConnector=function(){return g(s,true,[l])};i.logAndResolveDefault=function(e,n,a,r){t.error(`Connector (${n.connector}) failed call '${a}': ${r}\n\t\t\tApplication startup continues without data from this storage.`);return e};i.filterAndSortResponses=function(e){var n=[];Object.keys(e).forEach(function(t){n.push(e[t])});n=n.filter(function(e){return e.changes.length>0||e.appDescriptorChanges.length>0||e.variants.length>0||e.variantChanges.length>0||e.variantManagementChanges.length>0||e.variantDependentControlChanges.length>0||e.comp.variants.length>0||e.comp.changes.length>0||e.comp.defaultVariants.length>0||e.comp.standardVariants.length>0||e.annotationChanges.length>0});n.sort(function(e,n){return e.index-n.index});return n};i.sortFlexObjects=function(e){const n=e.filter(e=>e.creation);const t=e.filter(e=>!e.creation);n.sort(function(e,n){return Date.parse(e.creation)-Date.parse(n.creation)});return t.concat(n)};i.getGroupedFlexObjects=function(e){const n=this.sortFlexObjects(e);var t={};Object.keys(r).forEach(function(e){t[e]=this.getEmptyFlexDataResponse();t[e].index=o.getLayerIndex(e)}.bind(this));n.forEach(function(e){var n=e.layer;if(e.fileType==="annotation_change"){t[n].annotationChanges.push(e)}else if(e.fileType==="ctrl_variant"&&e.variantManagementReference){t[n].variants.push(e)}else if(e.fileType==="ctrl_variant_change"){t[n].variantChanges.push(e)}else if(e.fileType==="ctrl_variant_management_change"){t[n].variantManagementChanges.push(e)}else if(e.fileType==="variant"){t[n].comp.variants.push(e)}else if(e.fileType==="change"){if(e.variantReference){t[n].variantDependentControlChanges.push(e)}else if(e.appDescriptorChange){t[n].appDescriptorChanges.push(e)}else{switch(e.changeType){case"addFavorite":case"removeFavorite":case"updateVariant":t[n].comp.changes.push(e);break;case"defaultVariant":t[n].comp.defaultVariants.push(e);break;case"standardVariant":t[n].comp.standardVariants.push(e);break;default:t[n].changes.push(e)}}}});return t};i.getEmptyFlexDataResponse=function(){return{appDescriptorChanges:[],annotationChanges:[],changes:[],comp:{variants:[],changes:[],defaultVariants:[],standardVariants:[]},variants:[],variantChanges:[],variantDependentControlChanges:[],variantManagementChanges:[],ui2personalization:{}}};i.getAllFlexObjectNamespaces=function(){return["appDescriptorChanges","annotationChanges","changes","comp.changes","comp.changes","comp.defaultVariants","comp.standardVariants","variants","variantChanges","variantDependentControlChanges","variantManagementChanges"]};i.isStorageResponseFilled=function(t){const a=!e(t.ui2personalization);return a||i.getAllFlexObjectNamespaces().some(function(e){return n.get(e,t)?.length>0})};i.updateStorageResponse=function(e,t){t.forEach(t=>{if(t.type==="ui2"){e.changes.ui2personalization=t.newData}else{const a=f(t.flexObject);const r=t.flexObject.fileName;const o=n.get(a,e.changes);switch(t.type){case"add":o.push(t.flexObject);break;case"delete":o.splice(o.findIndex(e=>e.fileName===r),1);break;case"update":o.splice(o.findIndex(e=>e.fileName===r),1,t.flexObject);break;default:}}})};return i});
//# sourceMappingURL=StorageUtils.js.map