/*!
 * OpenUI5
 * (c) Copyright 2025 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["sap/base/i18n/Localization","sap/base/util/isPlainObject","sap/base/util/uid","sap/base/util/restricted/_isEqual","sap/base/Log","sap/ui/base/BindingInfo","sap/ui/base/SyncPromise","sap/ui/base/ManagedObject","sap/ui/core/util/reflection/BaseTreeModifier","sap/ui/core/Component","sap/ui/core/Element","sap/ui/fl/initial/_internal/FlexConfiguration","sap/ui/fl/Scenario","sap/ui/thirdparty/hasher","sap/ui/core/mvc/View"],function(e,t,r,n,i,o,a,s,p,u,c,l,f,g,m){"use strict";function h(e){if(e?.getEntry){return e.getEntry?.("sap.app")?.type}return e?.["sap.app"]?.type}function d(e,t){if(e?.startupParameters&&t&&Array.isArray(e.startupParameters[t])){return e.startupParameters[t][0]}return undefined}const C={isVariantByStartupParameter(e){const t=this.getAppComponentForControl(e);if(t?.getComponentData){return!!d(t.getComponentData(),"sap-app-id")}return false},getAppDescriptor(e){return this.getAppComponentForControl(e)?.getMetadata?.()?.getManifestObject?.().getJson()},isBinding(e,r){let n;try{n=o.parse(e,r)}catch(e){return false}return typeof e==="string"&&!!n||t(e)&&((e.hasOwnProperty("path")||e.hasOwnProperty("parts"))&&!e.hasOwnProperty("ui5object"))},getComponentForControl(e){function t(e){const r=u.getOwnerIdFor(e);if(!r){if(typeof e?.getParent==="function"){const r=e.getParent();if(r){return t(r)}}}return r||""}if(e){const r=t(e);if(r){return u.getComponentById(r)}}return undefined},getAppComponentForControl(e){let t=e instanceof u?e:C.getComponentForControl(e);if(t?.getAppComponent?.()instanceof u){return t.getAppComponent()}if(t?.oComponentData?.appComponent){return t.oComponentData.appComponent}if(t?.getManifestEntry){const e=t.getManifestEntry("sap.app");if(e?.type&&e.type!=="application"){if(t instanceof u){t=C.getComponentForControl(t)}return this.getAppComponentForControl(t)}}return t},getAppComponentForSelector(e){return e.appComponent||C.getAppComponentForControl(e)},getViewForControl(e){if(e instanceof m){return e}if(typeof e?.getParent==="function"){e=e.getParent();return C.getViewForControl(e)}return undefined},getClient(){return new URLSearchParams(window.location.search).get("sap-client")},getConnectors(){const e=l.getFlexibilityServices();return e.map(e=>e?.connector)},getLrepUrl(){const e=l.getFlexibilityServices();const t=e.find(e=>e.connector==="LrepConnector");return t?.url||""},getCurrentLanguage(){const t=e.getLanguage();if(typeof t!=="string"){return""}const r=t.indexOf("-");if(r<0&&t.length<=2){return t.toUpperCase()}if(r>0&&r<=2){return t.substring(0,r).toUpperCase()}return""},getControlType(e){return e?.getMetadata?.()?.getElementName?.()},checkControlId(e,t){if(!t){e=e instanceof s?e:c.getElementById(e);t=C.getAppComponentForControl(e)}return p.checkControlId(e,t)},hasLocalIdSuffix:p.hasLocalIdSuffix,getParsedURLHash(e){return e?.parseShellHash(g.getHash())||{}},getUrlParameter(e){return new URLSearchParams(window.location.search).get(e)},getUshellContainer(){const e=sap.ui.require("sap/ushell/Container");return e?.isInitialized()?e:undefined},createDefaultFileName(e){const t=r().replace(/-/g,"_");return e?`${t}_${e}`:t},createNamespace(e,t){const r=t==="ctrl_variant"?"variants":"changes";const n=e.reference.replace(".Component","");return`apps/${n}/${r}/`},buildLrepRootNamespace(e,t,r){const n="apps";const i="Error in sap.ui.fl.Utils#buildLrepRootNamespace:";if(!e){throw new Error(`${i} for every scenario you need a base ID`)}switch(t){case f.VersionedAppVariant:case f.AppVariant:if(!r){throw new Error(`${i} in the ${t} scenario you additionally need a project ID`)}return`${n}/${e}/appVariants/${r}/`;case f.AdaptationProject:if(!r){throw new Error(`${i} in the ${t} scenario you additionally need a project ID`)}return`${n}/${e}/adapt/${r}/`;case f.FioriElementsFromScratch:case f.UiAdaptation:default:return`${n}/${e}/`}},isApplication(e){return h(e)==="application"},isApplicationComponent(e){return e instanceof u&&C.isApplication(e.getManifestObject())},isEmbeddedComponent(e){const t=C.getAppComponentForControl(e);return!!(e instanceof u&&h(e.getManifestObject())==="component"&&t&&C.isApplicationComponent(t))},indexOfObject(e,t){return e.findIndex(e=>n(e,t))},execPromiseQueueSequentially(e,t,r,n){if(e.length===0){if(r){return Promise.resolve()}return C.FakePromise?new C.FakePromise:Promise.resolve()}const o=e.shift();if(typeof o==="function"){let a;try{a=o()}catch(e){a=Promise.reject(e)}return a.then(function(){if(!r&&a instanceof Promise){r=true}}).catch(function(e){let r="Error during execPromiseQueueSequentially processing occurred";r+=e?`: ${e.message}`:"";i.error(r,e);if(t){if(n){throw new Error(e.message)}else{throw new Error(r)}}}).then(function(){return this.execPromiseQueueSequentially(e,t,r,n)}.bind(this))}i.error("Changes could not be applied, promise not wrapped inside function.");return this.execPromiseQueueSequentially(e,t,r,n)},FakePromise:function(e,t,r){C.FakePromise.fakePromiseIdentifier="sap.ui.fl.Utils.FakePromise";this.vValue=e;this.vError=t;this.bContinueWithFakePromise=arguments.length<3||r===C.FakePromise.fakePromiseIdentifier;const n=function(e,t){try{const r=t(e,C.FakePromise.fakePromiseIdentifier);if(a.isThenable(r)){return r}return new C.FakePromise(r)}catch(e){const t=e;return new C.FakePromise(undefined,t)}};C.FakePromise.prototype.then=function(e,t){if(!this.bContinueWithFakePromise){return Promise.resolve(e(this.vValue))}if(!this.vError){return n(this.vValue,e)}else if(t){return n(this.vError,t)}return this};C.FakePromise.prototype.catch=function(e){if(!this.bContinueWithFakePromise){return Promise.reject(e(this.vError))}if(this.vError){return n(this.vError,e)}return this};if(this.vValue instanceof Promise||this.vValue instanceof C.FakePromise){return this.vValue}return undefined},getChangeFromChangesMap(e,t){let r;Object.values(e).some(e=>{r=e.find(e=>e.getId()===t);return r});return r},handleUrlParameters(e,t,r,n){if(C.hasParameterAndValue(t,r,n)){if(e.startsWith("?")){e=e.substr(1,e.length)}const n=e.split("&").filter(e=>e!==`${t}=${r}`);e="";if(n.length>0){e=`?${n.join("&")}`}}else{e+=`${(e.length>0?"&":"?")+t}=${r}`}return e},hasParameterAndValue(e,t,r){return C.getParameter(e,r)===t},getParameter(e,t){return C.getParsedURLHash(t)?.params?.[e]?.[0]||C.getUrlParameter(e)},findAggregation(e,t){return e?.getMetadata?.()?.getAllAggregations?.()?.[t]},getAggregation(e,t){const r=C.findAggregation(e,t);if(r){return e[r._sGetter]()}return undefined},getProperty(e,t){const r=e.getMetadata().getPropertyLikeSetting(t)?._sGetter;return e[r]()},getUShellService(e){if(e){const t=this.getUshellContainer();if(t){return t.getServiceAsync(e)}}return Promise.resolve()},async getUShellServices(e){const t={};for(const r of e){t[r]=await this.getUShellService(r)}return t}};return C});
//# sourceMappingURL=Utils.js.map