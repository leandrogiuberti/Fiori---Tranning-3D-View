/*!
 * OpenUI5
 * (c) Copyright 2025 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["sap/base/util/LoaderExtensions","sap/ui/fl/apply/_internal/DelegateMediator","sap/ui/fl/changeHandler/common/revertAddedControls","sap/ui/fl/changeHandler/Base"],function(t,e,n,a){"use strict";const o={};o.applyChange=async function(n,r,i,s){const g=i.modifier;const c=s.aggregationName;const f=n.getFlexObjectMetadata();const d=f.moduleName;const l=await g.findAggregation(r,c);if(!l){throw Error(`The given Aggregation is not available in the given control: ${g.getId(r)}`)}let h=await t.loadResource(d,{dataType:"text"});const m=e.getAddXMLAdjustFragmentHandlers();if(m){for(const t in m){h=await m[t](h,i)}}const u=await a.instantiateFragment(n,{...i,fragment:h});let p=0;for(const t of u){const e=await g.validateType(t,l,r,h,p);p++;if(!e){o._destroyArrayOfControls(u);throw Error(`The content of the xml fragment does not match the type of the targetAggregation: ${l.type}`)}}const w=[];let y=0;for(const t of u){await g.insertAggregation(r,c,t,s.index+y,i.view,s.skipAdjustIndex);y++;w.push({id:g.getId(t),aggregationName:c})}n.setRevertData(w);return u};o.revertChange=n;o._throwMissingAttributeError=function(t){throw new Error(`Attribute missing from the change specific content '${t}'`)};o._destroyArrayOfControls=function(t){t.forEach(function(t){if(t.destroy){t.destroy()}})};o.completeChangeContent=function(t,e,n){n||={};const a=e.content||e;if(!a.fragmentPath){o._throwMissingAttributeError("fragmentPath")}n.fragmentPath??=a.fragmentPath;t.setContent(n);let r=t.getFlexObjectMetadata().reference.replace(/\.Component/g,"").replace(/\./g,"/");r+="/changes/";r+=n.fragmentPath;const i=t.getFlexObjectMetadata();i.moduleName=r;t.setFlexObjectMetadata(i)};return o});
//# sourceMappingURL=BaseAddXml.js.map