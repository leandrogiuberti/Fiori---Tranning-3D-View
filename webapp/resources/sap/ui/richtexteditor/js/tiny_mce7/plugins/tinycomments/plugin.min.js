/*!
 * Tiny Comments plugin
 *
 * Copyright (c) 2023 Ephox Corporation DBA Tiny Technologies, Inc.
 * Licensed under the Tiny commercial license. See https://www.tiny.cloud/legal/
 *
 * Version: 7.7.2-153
 */

!function(){"use strict";var e=function(e){if(null===e)return"null";if(void 0===e)return"undefined";var t=typeof e;return"object"===t&&(Array.prototype.isPrototypeOf(e)||e.constructor&&"Array"===e.constructor.name)?"array":"object"===t&&(String.prototype.isPrototypeOf(e)||e.constructor&&"String"===e.constructor.name)?"string":t},t=function(e){return{eq:e}},n=t((function(e,t){return e===t})),o=function(e){return t((function(t,n){if(t.length!==n.length)return!1;for(var o=t.length,r=0;r<o;r++)if(!e.eq(t[r],n[r]))return!1;return!0}))},r=t((function(s,a){if(s===a)return!0;var i,c=e(s);return c===e(a)&&(function(e){return-1!==["undefined","boolean","number","string","function","xml","null"].indexOf(e)}(c)?s===a:"array"===c?o(r).eq(s,a):"object"===c&&(i=r,t((function(e,r){var s=Object.keys(e),a=Object.keys(r);if(!function(e,n){return function(e,n){return t((function(t,o){return e.eq(n(t),n(o))}))}(o(e),(function(e){return function(e,t){return Array.prototype.slice.call(e).sort(t)}(e,n)}))}(n).eq(s,a))return!1;for(var c=s.length,l=0;l<c;l++){var m=s[l];if(!i.eq(e[m],r[m]))return!1}return!0}))).eq(s,a))}));const s=Object.getPrototypeOf,a=(e,t,n)=>{var o;return!!n(e,t.prototype)||(null===(o=e.constructor)||void 0===o?void 0:o.name)===t.name},i=e=>t=>(e=>{const t=typeof e;return null===e?"null":"object"===t&&Array.isArray(e)?"array":"object"===t&&a(e,String,((e,t)=>t.isPrototypeOf(e)))?"string":t})(t)===e,c=e=>t=>typeof t===e,l=e=>t=>e===t,m=i("string"),d=i("object"),u=e=>((e,t)=>d(e)&&a(e,t,((e,t)=>s(e)===t)))(e,Object),_=l(null),v=c("boolean"),h=l(void 0),p=e=>!(e=>null==e)(e),g=c("function"),f=c("number"),y=()=>{},b=e=>()=>e,w=e=>e,C=e=>e(),S=b(!1),A=b(!0);class x{constructor(e,t){this.tag=e,this.value=t}static some(e){return new x(!0,e)}static none(){return x.singletonNone}fold(e,t){return this.tag?t(this.value):e()}isSome(){return this.tag}isNone(){return!this.tag}map(e){return this.tag?x.some(e(this.value)):x.none()}bind(e){return this.tag?e(this.value):x.none()}exists(e){return this.tag&&e(this.value)}forall(e){return!this.tag||e(this.value)}filter(e){return!this.tag||e(this.value)?this:x.none()}getOr(e){return this.tag?this.value:e}or(e){return this.tag?this:e}getOrThunk(e){return this.tag?this.value:e()}orThunk(e){return this.tag?this:e()}getOrDie(e){if(this.tag)return this.value;throw new Error(null!=e?e:"Called getOrDie on None")}static from(e){return p(e)?x.some(e):x.none()}getOrNull(){return this.tag?this.value:null}getOrUndefined(){return this.value}each(e){this.tag&&e(this.value)}toArray(){return this.tag?[this.value]:[]}toString(){return this.tag?`some(${this.value})`:"none()"}}x.singletonNone=new x(!1);const O=Array.prototype.slice,k=Array.prototype.indexOf,D=(e,t)=>{return n=e,o=t,k.call(n,o)>-1;var n,o},R=(e,t)=>{const n=e.length,o=new Array(n);for(let r=0;r<n;r++){const n=e[r];o[r]=t(n,r)}return o},E=(e,t)=>{for(let n=0,o=e.length;n<o;n++)t(e[n],n)},T=(e,t)=>{const n=[];for(let o=0,r=e.length;o<r;o++){const r=e[o];t(r,o)&&n.push(r)}return n},M=(e,t)=>((e,t,n)=>{for(let o=0,r=e.length;o<r;o++){const r=e[o];if(t(r,o))return x.some(r);if(n(r,o))break}return x.none()})(e,t,S),N=(e,t)=>t>=0&&t<e.length?x.some(e[t]):x.none(),j=e=>N(e,0),P=e=>{let t=e;return{get:()=>t,set:e=>{t=e}}},L=Object.keys,U=Object.hasOwnProperty,$=(e,t)=>{const n=L(e);for(let o=0,r=n.length;o<r;o++){const r=n[o];t(e[r],r)}},B=(e,t)=>I(e,((e,n)=>({k:n,v:t(e,n)}))),I=(e,t)=>{const n={};return $(e,((e,o)=>{const r=t(e,o);n[r.k]=r.v})),n},F=(e,t)=>{const n={};var o;return((e,t,n,o)=>{$(e,((e,r)=>{(t(e,r)?n:o)(e,r)}))})(e,t,(o=n,(e,t)=>{o[t]=e}),y),n},H=(e,t)=>U.call(e,t),q=e=>parseInt(e,10),Y=(e,t)=>{const n=e-t;return 0===n?0:n>0?1:-1},V=(e,t,n)=>({major:e,minor:t,patch:n}),W=e=>{const t=/([0-9]+)\.([0-9]+)\.([0-9]+)(?:(\-.+)?)/.exec(e);return t?V(q(t[1]),q(t[2]),q(t[3])):V(0,0,0)};let z=[],G=(e,t)=>{let n=[],o={get:()=>(o.lc||o.listen((()=>{}))(),o.value),l:t||0,lc:0,listen:(e,t)=>(o.lc=n.push(e,t||o.l)/2,()=>{let t=n.indexOf(e);~t&&(n.splice(t,2),--o.lc||o.off())}),notify(e,t){let r=!z.length;for(let r=0;r<n.length;r+=2)z.push(n[r],n[r+1],o.value,e,t);if(r){for(let e=0;e<z.length;e+=5){let t;for(let n=e+1;!t&&(n+=5)<z.length;)z[n]<z[e+1]&&(t=z.push(z[e],z[e+1],z[e+2],z[e+3],z[e+4]));t||z[e](z[e+2],z[e+3],z[e+4])}z.length=0}},off(){},set(e){let t=o.value;t!==e&&(o.value=e,o.notify(t))},subscribe(e,t){let n=o.listen(e,t);return e(o.value),n},value:e};return o},Q=0;const J=e=>{const t=(new Date).getTime(),n=Math.floor(window.crypto.getRandomValues(new Uint32Array(1))[0]/4294967295*1e9);return Q++,e+"_"+n+Q+String(t)},K="undefined"!=typeof window?window:Function("return this;")(),X=(e,t)=>((e,t)=>{let n=null!=t?t:K;for(let t=0;t<e.length&&null!=n;++t)n=n[e[t]];return n})(e.split("."),t),Z=Object.getPrototypeOf,ee=e=>{const t=X("ownerDocument.defaultView",e);return d(e)&&((e=>((e,t)=>{const n=((e,t)=>X(e,t))(e,t);if(null==n)throw new Error(e+" not available on this browser");return n})("HTMLElement",e))(t).prototype.isPrototypeOf(e)||/^HTML\w*Element$/.test(Z(e).constructor.name))},te=e=>1===(e=>e.dom.nodeType)(e);const ne=e=>t=>te(t)&&t.dom.nodeName.toLowerCase()===e,oe=(e,t,n)=>{if(!(m(n)||v(n)||f(n)))throw console.error("Invalid call to Attribute.set. Key ",t,":: Value ",n,":: Element ",e),new Error("Attribute value was not simple");e.setAttribute(t,n+"")},re=(e,t,n)=>{oe(e.dom,t,n)},se=(e,t)=>{const n=e.dom.getAttribute(t);return null===n?void 0:n},ae=(e,t)=>x.from(se(e,t)),ie=(e,t)=>{e.dom.removeAttribute(t)},ce=(e,t,n=0,o)=>{const r=e.indexOf(t,n);return-1!==r&&(!!h(o)||r+t.length<=o)},le=(e,t)=>((e,t)=>""===t||e.length>=t.length&&e.substr(0,0+t.length)===t)(e,t),me=e=>t=>t.replace(e,""),de=me(/^\s+|\s+$/g),ue=me(/^\s+/g),_e=e=>e.length>0,ve=e=>{if(null==e)throw new Error("Node cannot be null or undefined");return{dom:e}},he=(e,t)=>{const n=(t||document).createElement(e);return ve(n)},pe=ve,ge=(e,t)=>{const n=e.dom;if(1!==n.nodeType)return!1;{const e=n;if(void 0!==e.matches)return e.matches(t);if(void 0!==e.msMatchesSelector)return e.msMatchesSelector(t);if(void 0!==e.webkitMatchesSelector)return e.webkitMatchesSelector(t);if(void 0!==e.mozMatchesSelector)return e.mozMatchesSelector(t);throw new Error("Browser lacks native selectors")}},fe=e=>1!==e.nodeType&&9!==e.nodeType&&11!==e.nodeType||0===e.childElementCount,ye=e=>x.from(e.dom.parentNode).map(pe),be=e=>R(e.dom.childNodes,pe),we=()=>Ce(pe(document)),Ce=e=>{const t=e.dom.body;if(null==t)throw new Error("Body is not available yet");return pe(t)},Se=(e,t)=>{e.dom.appendChild(t.dom)},Ae=e=>{const t=e.dom;null!==t.parentNode&&t.parentNode.removeChild(t)},xe=e=>{const t=be(e);var n,o;t.length>0&&(n=e,E(o=t,((e,t)=>{((e,t)=>{const n=(e=>x.from(e.dom.nextSibling).map(pe))(e);n.fold((()=>{ye(e).each((e=>{Se(e,t)}))}),(e=>{((e,t)=>{ye(e).each((n=>{n.dom.insertBefore(t.dom,e.dom)}))})(e,t)}))})(0===t?n:o[t-1],e)}))),Ae(e)},Oe=(e,t)=>{const n=(e=>pe(e.dom.ownerDocument))(e),o=n.dom,r=pe(o.createDocumentFragment());((e,t)=>{E(t,(t=>{Se(e,t)}))})(r,((e,t)=>{const n=(t||document).createElement("div");return n.innerHTML=e,be(pe(n))})(t,o)),(e=>{e.dom.textContent="",E(be(e),(e=>{Ae(e)}))})(e),Se(e,r)},ke=()=>De(0,0),De=(e,t)=>({major:e,minor:t}),Re={nu:De,detect:(e,t)=>{const n=String(t).toLowerCase();return 0===e.length?ke():((e,t)=>{const n=((e,t)=>{for(let n=0;n<e.length;n++){const o=e[n];if(o.test(t))return o}})(e,t);if(!n)return{major:0,minor:0};const o=e=>Number(t.replace(n,"$"+e));return De(o(1),o(2))})(e,n)},unknown:ke},Ee=(e,t)=>{const n=String(t).toLowerCase();return M(e,(e=>e.search(n)))},Te=/.*?version\/\ ?([0-9]+)\.([0-9]+).*/,Me=e=>t=>ce(t,e),Ne=[{name:"Edge",versionRegexes:[/.*?edge\/ ?([0-9]+)\.([0-9]+)$/],search:e=>ce(e,"edge/")&&ce(e,"chrome")&&ce(e,"safari")&&ce(e,"applewebkit")},{name:"Chromium",brand:"Chromium",versionRegexes:[/.*?chrome\/([0-9]+)\.([0-9]+).*/,Te],search:e=>ce(e,"chrome")&&!ce(e,"chromeframe")},{name:"IE",versionRegexes:[/.*?msie\ ?([0-9]+)\.([0-9]+).*/,/.*?rv:([0-9]+)\.([0-9]+).*/],search:e=>ce(e,"msie")||ce(e,"trident")},{name:"Opera",versionRegexes:[Te,/.*?opera\/([0-9]+)\.([0-9]+).*/],search:Me("opera")},{name:"Firefox",versionRegexes:[/.*?firefox\/\ ?([0-9]+)\.([0-9]+).*/],search:Me("firefox")},{name:"Safari",versionRegexes:[Te,/.*?cpu os ([0-9]+)_([0-9]+).*/],search:e=>(ce(e,"safari")||ce(e,"mobile/"))&&ce(e,"applewebkit")}],je=[{name:"Windows",search:Me("win"),versionRegexes:[/.*?windows\ nt\ ?([0-9]+)\.([0-9]+).*/]},{name:"iOS",search:e=>ce(e,"iphone")||ce(e,"ipad"),versionRegexes:[/.*?version\/\ ?([0-9]+)\.([0-9]+).*/,/.*cpu os ([0-9]+)_([0-9]+).*/,/.*cpu iphone os ([0-9]+)_([0-9]+).*/]},{name:"Android",search:Me("android"),versionRegexes:[/.*?android\ ?([0-9]+)\.([0-9]+).*/]},{name:"macOS",search:Me("mac os x"),versionRegexes:[/.*?mac\ os\ x\ ?([0-9]+)_([0-9]+).*/]},{name:"Linux",search:Me("linux"),versionRegexes:[]},{name:"Solaris",search:Me("sunos"),versionRegexes:[]},{name:"FreeBSD",search:Me("freebsd"),versionRegexes:[]},{name:"ChromeOS",search:Me("cros"),versionRegexes:[/.*?chrome\/([0-9]+)\.([0-9]+).*/]}],Pe={browsers:b(Ne),oses:b(je)},Le=e=>{const t=e.current,n=e.version,o=e=>()=>t===e;return{current:t,version:n,isEdge:o("Edge"),isChromium:o("Chromium"),isIE:o("IE"),isOpera:o("Opera"),isFirefox:o("Firefox"),isSafari:o("Safari")}},Ue=()=>Le({current:void 0,version:Re.unknown()}),$e=Le,Be=e=>{const t=e.current,n=e.version,o=e=>()=>t===e;return{current:t,version:n,isWindows:o("Windows"),isiOS:o("iOS"),isAndroid:o("Android"),isMacOS:o("macOS"),isLinux:o("Linux"),isSolaris:o("Solaris"),isFreeBSD:o("FreeBSD"),isChromeOS:o("ChromeOS")}},Ie=()=>Be({current:void 0,version:Re.unknown()}),Fe=Be,He=(e,t,n)=>{const o=Pe.browsers(),r=Pe.oses(),s=t.bind((e=>((e,t)=>((e,t)=>{for(let n=0;n<e.length;n++){const o=t(e[n]);if(o.isSome())return o}return x.none()})(t.brands,(t=>{const n=t.brand.toLowerCase();return M(e,(e=>{var t;return n===(null===(t=e.brand)||void 0===t?void 0:t.toLowerCase())})).map((e=>({current:e.name,version:Re.nu(parseInt(t.version,10),0)})))})))(o,e))).orThunk((()=>((e,t)=>Ee(e,t).map((e=>{const n=Re.detect(e.versionRegexes,t);return{current:e.name,version:n}})))(o,e))).fold(Ue,$e),a=((e,t)=>Ee(e,t).map((e=>{const n=Re.detect(e.versionRegexes,t);return{current:e.name,version:n}})))(r,e).fold(Ie,Fe),i=((e,t,n,o)=>{const r=e.isiOS()&&!0===/ipad/i.test(n),s=e.isiOS()&&!r,a=e.isiOS()||e.isAndroid(),i=a||o("(pointer:coarse)"),c=r||!s&&a&&o("(min-device-width:768px)"),l=s||a&&!c,m=t.isSafari()&&e.isiOS()&&!1===/safari/i.test(n),d=!l&&!c&&!m;return{isiPad:b(r),isiPhone:b(s),isTablet:b(c),isPhone:b(l),isTouch:b(i),isAndroid:e.isAndroid,isiOS:e.isiOS,isWebView:b(m),isDesktop:b(d)}})(a,s,e,n);return{browser:s,os:a,deviceType:i}},qe=e=>window.matchMedia(e).matches,Ye=(e=>{let t,n=!1;return(...o)=>(n||(n=!0,t=e.apply(null,o)),t)})((()=>He(window.navigator.userAgent,x.from(window.navigator.userAgentData),qe)))().os.isMacOS()?"\u2318":"Ctrl",Ve=B({tc_conversations_title:"Comments",tc_announce_sidebar_available:`Comment. Sidebar available. Press ${Ye} + Alt + M to switch to sidebar`,tc_items_addcomment:"Add comment",tc_items_showcomments:"Show comments",tc_items_deleteall:"Delete all conversations",tc_edit_buttons_save:"Save",tc_edit_buttons_saving:"Saving",tc_edit_buttons_cancel:"Cancel",tc_reply_buttons_comment:"Comment",tc_reply_buttons_clear:"Clear",tc_reply_placeholders:"Add comment...",tc_reply_with_mentions_placeholders:"Comment or mention with @",tc_kebab_tooltip:"Comment Actions",tc_kebab_tooltip_conversation:"Conversation Actions",tc_kebab_delete_conversation:"Delete conversation",tc_kebab_resolve_conversation:"Resolve conversation",tc_kebab_delete:"Delete",tc_kebab_edit:"Edit",tc_edit_problem_comment:"An error occurred editing this comment. See the console for details.",tc_edit_unauthorised_comment:"You are not allowed to edit this comment",tc_delete_buttons_cancel:"Cancel",tc_delete_buttons_proceed:"Delete",tc_resolve_buttons_proceed:"Resolve",tc_create_problem:"An error occurred while creating a comment. See the console for details",tc_reply_problem:"An error occurred while replying to a comment. See the console for details",tc_delete_prompts_conversation:"Delete this conversation?",tc_delete_prompts_conversation_detail_sing:"1 comment will be deleted. You can't undo this action.",tc_delete_prompts_conversation_detail_pl:"{0} comments will be deleted. You can't undo this action.",tc_delete_prompts_all:"Delete all conversations in the content? This cannot be undone.",tc_delete_prompts_comment:"Are you sure you want to delete this comment?",tc_resolve_prompts_conversation:"Resolve this conversation?",tc_resolve_prompts_conversation_detail_sing:"1 comment will be resolved. You can't undo this action.",tc_resolve_prompts_conversation_detail_pl:"{0} comments will be resolved. You can't undo this action.",tc_delete_problem_all:"An error occurred deleting all the conversations. See the console for details.",tc_delete_problem_conversation:"An error occurred deleting the conversation. See the console for details.",tc_delete_problem_comment:"An error occurred deleting the comment. See the console for details.",tc_delete_unauthorised_all:"You are not allowed to delete all the conversations",tc_delete_unauthorised_conversation:"You are not allowed to delete this conversation",tc_delete_unauthorised_comment:"You are not allowed to delete this comment",tc_resolve_unauthorised_conversation:"You are not allowed to resolve this conversation",tc_resolve_problem_conversation:"An error occurred resolving the conversation. See the console for details.",tc_date_less_than_a_minute_ago:"a moment ago",tc_date_1_minute_ago:"1 minute ago",tc_date_x_minutes_ago:"{0} minutes ago",tc_date_1_hour_ago:"1 hour ago",tc_date_x_hours_ago:"{0} hours ago",tc_date_1_day_ago:"1 day ago",tc_date_x_days_ago:"{0} days ago",tc_date_1_week_ago:"1 week ago",tc_date_x_weeks_ago:"{0} weeks ago",tc_date_1_month_ago:"1 month ago",tc_date_x_months_ago:"{0} months ago",tc_date_1_year_ago:"1 year ago",tc_date_x_years_ago:"{0} years ago",tc_date_comment_edited:" (edited)",tc_conversations_one_reply:"1 reply",tc_conversations_multiple_replies:"{0} replies",tc_dialog_delete_conversation:"Delete Conversation",tc_dialog_resolve_conversation:"Resolve Conversation",tc_dialog_delete_comment:"Delete Comment",tc_mentions_no_results:"No users found"},w),We=J("aria-comment-description");let ze=0;const Ge=e=>{const t=(n=we(),o=`#${We}`,((e,t)=>{const n=void 0===t?document:t.dom;return fe(n)?x.none():x.from(n.querySelector(e)).map(pe)})(o,n)).getOrThunk((()=>{const e=he("span");return((e,t)=>{const n=e.dom;$(t,((e,t)=>{oe(n,t,e)}))})(e,{id:We,"aria-live":"polite","aria-atomic":"true",role:"alert"}),(e=>{const t=e.dom;$({position:"absolute",left:"-10000px",top:"-1000px"},((e,n)=>{((e,t,n)=>{if(!m(n))throw console.error("Invalid call to CSS.set. Property ",t,":: Value ",n,":: Element ",e),new Error("CSS value must be a string: "+n);(e=>void 0!==e.style&&g(e.style.getPropertyValue))(e)&&e.style.setProperty(t,n)})(t,n,e)}))})(e),Se(we(),e),e}));var n,o;return ze++,((e,t)=>({onComment:()=>{Oe(t,e.translate(Ve.tc_announce_sidebar_available))},notOnComment:()=>{Oe(t,"")},getMarker:()=>t,release:()=>{ze--,0===ze&&Ae(t)}}))(e,t)},Qe=()=>(new Date).toISOString();var Je;!function(e){e[e.LessThanMinute=0]="LessThanMinute",e[e.Minute=1]="Minute",e[e.Hour=2]="Hour",e[e.Day=3]="Day",e[e.Week=4]="Week",e[e.Month=5]="Month",e[e.Year=6]="Year"}(Je||(Je={}));const Ke=(e,t="")=>{const n=e.get(),o=""===t?0:Date.parse(t);return{timestamp:Qe(),events:o>0?T(n,(e=>Date.parse(e.timestamp)>o)):n}},Xe=e=>(t={})=>m(t.after)?Ke(e,t.after):Ke(e),Ze=(e,t)=>((e,t)=>{const n=void 0===t?document:t.dom;return fe(n)?[]:R(n.querySelectorAll(e),pe)})(t,e),et=b("tox-comment"),tt=b("tinycomments"),nt=b("mce-annotation"),ot=b("data-mce-annotation"),rt=b("data-mce-annotation-uid"),st=b("data-mce-annotation-active"),at=b("data-mce-annotation-classes"),it=b("data-mce-annotation-attrs"),ct=b("tmp"),lt=b("tox-comments-visible"),mt=e=>L(e.annotator.getAll(tt())),dt=e=>le(e,ct()),ut=(e,t)=>{const n=pe(t.commonAncestorContainer),o=te(r=n)&&ee(r.dom)?x.some(n):(e=>x.from(e.dom.parentElement).map(pe))(n);var r;const s=`[${ot()}="${tt()}"]`,a=o.map((e=>Ze(e,s))).getOr([]),i=(e=>{const t=O.call(e,0);return t.reverse(),t})(((t,n)=>((e,t,n)=>T(((e,t)=>{const n=g(t)?t:S;let o=e.dom;const r=[];for(;null!==o.parentNode&&void 0!==o.parentNode;){const e=o.parentNode,t=pe(e);if(r.push(t),!0===n(t))break;o=e}return r})(e,n),t))(t,(e=>ge(e,n)),(t=>t.dom===e.getBody())))(n,s));return ge(n,s)&&i.push(n),T(i.concat(a),(e=>{return!(se(n=e,ot())===tt()&&ae(n,rt()).exists(dt))&&((e,t)=>e.intersectsNode(t.dom))(t,e);var n}))},_t=ne("hr"),vt=e=>{const t=pe(e.selection.getNode()),n=pe(e.selection.getStart());return(e=>{let t=e.selection.getRng().commonAncestorContainer;return 3===t.nodeType&&(t=t.parentNode),!!p(t)&&e.dom.isEmpty(t)})(e)||_t(t)||_t(n)},ht=(e,t)=>vt(e)||!(e=>{if(e.selection){const t=e.selection.getRng(),n=ut(e,t);return j(n).forall((e=>{return(o=n,N(o,o.length-1)).forall((o=>{const r=se(e,rt());if((e=>{for(let n=0,o=e.length;n<o;n++)if(t=e[n],se(t,rt())!==r)return!0;var t;return!1})(n))return!1;const s=new window.Range;return s.setStartBefore(e.dom),s.setEndAfter(o.dom),s.compareBoundaryPoints(window.Range.START_TO_START,t)<=0&&s.compareBoundaryPoints(window.Range.END_TO_END,t)>=0}));var o}))}return!1})(e)||!t.get().canWrite,pt=(e,t)=>{const n=se(e,t);return void 0===n||""===n?[]:n.split(" ")},gt=e=>void 0!==e.dom.classList,ft=(e,t)=>{gt(e)?e.dom.classList.remove(t):((e,t)=>{((e,t,n)=>{const o=T(pt(e,t),(e=>e!==n));o.length>0?re(e,t,o.join(" ")):ie(e,t)})(e,"class",t)})(e,t),(e=>{const t=gt(e)?e.dom.classList:(e=>pt(e,"class"))(e);0===t.length&&ie(e,"class")})(e)},yt=ne("span"),bt=e=>{yt(e)?xe(e):(e=>{ft(e,nt()),ie(e,`${rt()}`),ie(e,`${ot()}`),ie(e,`${st()}`);const t=ae(e,`${it()}`).map((e=>e.split(","))).getOr([]),n=ae(e,`${at()}`).map((e=>e.split(","))).getOr([]);E(t,(t=>ie(e,t))),((e,t)=>{E(t,(t=>{ft(e,t)}))})(e,n),ie(e,`${at()}`),ie(e,`${it()}`)})(e)},wt=(e,t,n,o)=>(Oe(e,t),E(Ze(e,n),o),e.dom.innerHTML),Ct=(e,t,n)=>{const o=he("div");E(e,(e=>{if(e.content=wt(o,e.content,t,n),p(e.fragments))for(let r=0;r<e.fragments.length;r++)e.fragments[r]=wt(o,e.fragments[r],t,n)}))},St=(e,t,n)=>{e.notificationManager.open({text:t,type:"error"}),n&&console.error(t,n)},At="tc-try-delete-all-conversations",xt=(e,t)=>{e.addCommand("tc-delete-conversation-at-cursor",((n,o)=>{if(vt(e))return;const r=(null==o?void 0:o.conversationUid)?x.from(o.conversationUid):(e=>{const t=F(e.annotator.getAll(tt()),(t=>D(t,e.selection.getNode())));return j(L(t))})(e);r.each((n=>{var o;e.undoManager.transact((()=>e.annotator.remove(tt()))),o=e.undoManager.data,Ct(o,(e=>`[${rt()}="${e}"]`)(n),bt),t.set(t.get().filter((e=>e!==n))),e.focus()}))}))},Ot=(e,t,n,o)=>{xt(e,o),((e,t,n,o)=>{e.addCommand(At,(()=>{vt(e)||e.windowManager.confirm(Ve.tc_delete_prompts_all,(r=>{if(r)return t.deleteAllConversations({}).get((t=>{t.fold((t=>St(e,Ve.tc_delete_problem_all,t)),(t=>{var r;t.canDelete?(n({type:"delete-all-conversations",timestamp:Qe()}),e.annotator.removeAll(tt()),r=e.undoManager.data,Ct(r,`[${ot()}="${tt()}"]`,bt),e.undoManager.dispatchChange(),o.set([]),e.focus()):St(e,Ve.tc_delete_unauthorised_all)}))}))}))}))})(e,t,n,o)},kt=e=>{e.execCommand("ToggleSidebar",!1,"showcomments")},Dt=e=>{let t=x.none(),n=[];const o=e=>{r()?s(e):n.push(e)},r=()=>t.isSome(),s=e=>{t.each((t=>{setTimeout((()=>{e(t)}),0)}))};return e((e=>{r()||(t=x.some(e),E(n,s),n=[])})),{get:o,map:e=>Dt((t=>{o((n=>{t(e(n))}))})),isReady:r}},Rt={nu:Dt,pure:e=>Dt((t=>{t(e)}))},Et=e=>{setTimeout((()=>{throw e}),0)},Tt=e=>{const t=t=>{e().then(t,Et)};return{map:t=>Tt((()=>e().then(t))),bind:t=>Tt((()=>e().then((e=>t(e).toPromise())))),anonBind:t=>Tt((()=>e().then((()=>t.toPromise())))),toLazy:()=>Rt.nu(t),toCached:()=>{let t=null;return Tt((()=>(null===t&&(t=e()),t)))},toPromise:e,get:t}},Mt=e=>Tt((()=>new Promise(e))),Nt=e=>Tt((()=>Promise.resolve(e))),jt=e=>{const t=t=>t(e),n=b(e),o=()=>r,r={tag:!0,inner:e,fold:(t,n)=>n(e),isValue:A,isError:S,map:t=>Lt.value(t(e)),mapError:o,bind:t,exists:t,forall:t,getOr:n,or:o,getOrThunk:n,orThunk:o,getOrDie:n,each:t=>{t(e)},toOptional:()=>x.some(e)};return r},Pt=e=>{const t=()=>n,n={tag:!1,inner:e,fold:(t,n)=>t(e),isValue:S,isError:A,map:t,mapError:t=>Lt.error(t(e)),bind:t,exists:S,forall:A,getOr:w,or:w,getOrThunk:C,orThunk:C,getOrDie:(o=String(e),()=>{throw new Error(o)}),each:y,toOptional:x.none};var o;return n},Lt={value:jt,error:Pt,fromOption:(e,t)=>e.fold((()=>Pt(t)),jt)},Ut=e=>({...e,toCached:()=>Ut(e.toCached()),bindFuture:t=>Ut(e.bind((e=>e.fold((e=>Nt(Lt.error(e))),(e=>t(e)))))),bindResult:t=>Ut(e.map((e=>e.bind(t)))),mapResult:t=>Ut(e.map((e=>e.map(t)))),mapError:t=>Ut(e.map((e=>e.mapError(t)))),foldResult:(t,n)=>e.map((e=>e.fold(t,n))),withTimeout:(t,n)=>Ut(Mt((o=>{let r=!1;const s=setTimeout((()=>{r=!0,o(Lt.error(n()))}),t);e.get((e=>{r||(clearTimeout(s),o(e))}))})))}),$t=e=>Ut(Nt(Lt.value(e))),Bt=e=>Ut(Mt(e)),It=$t,Ft=$t,Ht=e=>Ut(Nt(Lt.error(e))),qt=e=>t=>Bt((n=>e(t,(e=>{n(Lt.value(e))}),(e=>{n(Lt.error(e))})))),Yt=e=>t=>t.options.get(e),Vt=e=>t=>x.from(Yt(e)(t)).filter(g),Wt=e=>t=>Vt(e)(t).getOrDie(e+" has not been implemented."),zt=(e,t)=>n=>{var o;return null!==(o=n.options.get(e))&&void 0!==o?o:t(n)},Gt=(e,t)=>n=>{const o=zt(e,(()=>t(rn(n))))(n);return qt(o)},Qt=Wt("tinycomments_create"),Jt=Wt("tinycomments_reply"),Kt=Wt("tinycomments_delete"),Xt=Vt("tinycomments_resolve"),Zt=Wt("tinycomments_delete_all"),en=Wt("tinycomments_delete_comment"),tn=Wt("tinycomments_edit_comment"),nn=Wt("tinycomments_lookup"),on=Vt("tinycomments_fetch"),rn=Yt("tinycomments_author"),sn=zt("tinycomments_author_name",rn),an=Yt("tinycomments_author_avatar"),cn=Gt("tinycomments_can_delete",(e=>(t,n,o)=>{n({canDelete:t.comments.length>0&&t.comments[0].author===e&&!0})})),ln=Vt("tinycomments_can_resolve"),mn=Gt("tinycomments_can_delete_comment",(e=>(t,n,o)=>{n({canDelete:t.comment.author===e&&!0})})),dn=Gt("tinycomments_can_edit_comment",(e=>(t,n,o)=>{n({canEdit:t.comment.author===e&&!0})})),un=Yt("tinycomments_access"),_n=Yt("tinycomments_mode"),vn=Yt("tinycomments_css_url"),hn=Yt("tinycomments_js_url"),pn=Yt("disabled"),gn=(fn=(e,t)=>u(e)&&u(t)?gn(e,t):t,(...e)=>{if(0===e.length)throw new Error("Can't merge zero objects");const t={};for(let n=0;n<e.length;n++){const o=e[n];for(const e in o)H(o,e)&&(t[e]=fn(t[e],o[e]))}return t});var fn;const yn=e=>{const t=Qt(e),n=Jt(e),o=nn(e),r=on(e),s=Kt(e),a=Xt(e),i=Zt(e),c=en(e),l=tn(e);return{create:qt(t),reply:qt(n),lookup:qt((m=o,(e,t,n)=>{m(e,(e=>{const n=R(e.conversation.comments,(e=>({authorName:e.author,...e})));t(gn(e,{conversation:{comments:n}}))}),n)})),fetchConversations:r.map((e=>qt(e))),deleteConversation:qt(s),resolveConversation:a.map((e=>qt(e))),deleteAllConversations:qt(i),editComment:qt(l),deleteComment:qt(c),lifecycleHooks:{onPreInit:y,onGetContent:x.none}};var m},bn={base64:{versions:["2.0","2.1"],encryptor:{encryptText:e=>{const t=new Blob([e],{type:"application/json"}),n=new FileReader;return Bt((e=>{n.addEventListener("loadend",(()=>e(Lt.value({encrypted:[n.result]})))),n.addEventListener("error",(()=>e(Lt.error(n.error||new Error("error decoding text"))))),n.readAsDataURL(t)}))},decryptText:e=>{return(t=e[0],(e=>{const t=e.split(","),n=/data:([^;]+)/.exec(t[0]);if(!n)return x.none();const o=n[1],r=t[1],s=1024,a=atob(r),i=a.length,c=Math.ceil(i/s),l=new Array(c);for(let e=0;e<c;++e){const t=e*s,n=Math.min(t+s,i),o=new Array(n-t);for(let e=t,r=0;e<n;++r,++e)o[r]=a[e].charCodeAt(0);l[e]=new Uint8Array(o)}return x.some(new Blob(l,{type:o}))})(t)).fold((()=>Ht("Could not decode URI")),(e=>{const t=new FileReader;return Bt((n=>{t.addEventListener("loadend",(()=>n(Lt.value({decrypted:t.result})))),t.addEventListener("error",(()=>{var e;return n(Lt.error((null===(e=t.error)||void 0===e?void 0:e.message)||"error decoding text"))})),t.readAsText(e)}))}));var t}}}};bn.current=bn.base64;const wn=(e,t,n)=>t===e?n:"2.0"===e?wn("2.1",t,(e=>({...e,authorName:e.author}))(n)):n,Cn="tinycomments",Sn="2.1",An=e=>le(ue(e),Cn),xn=e=>{const t=de(e).split("|");return t.length>2?Lt.value({version:t[1],rest:t.slice(2)}):Lt.error("Embedded comments not in expected format.")},On=(e,t,n)=>((e,t)=>{const n=(e=>{try{const t=JSON.parse(e);return Lt.value(t)}catch(e){return Lt.error("Could not JSON parse conversations.")}})(t);return e!==Sn?n.map((t=>B(t,(t=>({...t,comments:R(t.comments,(t=>wn(e,Sn,t)))}))))):n})(e,n).map((e=>({conversations:e,encrypted:{encrypted:t}}))),kn=e=>An(e)?xn(e).fold((e=>Ht(e)),(({version:e,rest:t})=>((e,t)=>(e=>((e,t)=>{const n=L(e);for(let o=0,r=n.length;o<r;o++){const r=e[n[o]];if(t(r))return x.some(r)}return x.none()})(bn,(t=>D(t.versions,e))).map((e=>e.encryptor)))(e).fold((()=>Ht(`No Encryptor for version: ${e}`)),(e=>e.decryptText(t))))(e,t).bindResult((({decrypted:n})=>On(e,t,n))))):Ft({conversations:{},encrypted:{encrypted:[]}}),Dn=e=>{const t=rn(e),n=sn(e),o=an(e),r=(()=>{let e={},t=x.none();const n=t=>Object.prototype.hasOwnProperty.call(e,t)?x.some(e[t]):x.none();return{get:()=>gn(e,{}),clear:()=>{e={},t=x.none()},addData:(t,n)=>{e[t]=n},setData:(n,o)=>{e=n,t=x.some(o)},setEncryptedData:e=>{t=x.some(e)},getEncryptedData:()=>t,lookupData:n,removeData:t=>{delete e[t]},updateData:(t,o)=>n(t).map((n=>{const r=o(n);return e[t]=r,r}))}})(),s=cn(e),a=mn(e),i=dn(e),c=ln(e).map((e=>qt(e))),l={author:t,authorName:n},m=F({authorAvatar:o},(e=>!h(e))),d=bn.current.encryptor,u=()=>d.encryptText(JSON.stringify(r.get())).mapResult((e=>r.setEncryptedData(e))),_=x.some((e=>{return It({conversations:(t=e,n=(e,t)=>({...e,[t]:r.get()[t]}),o={},E(t,((e,t)=>{o=n(o,e)})),o)});var t,n,o})),v=c.map((e=>t=>r.lookupData(t.conversationUid).fold((()=>Ht("Could not find conversation to resolve")),(n=>e({conversationUid:n.uid,comments:n.comments}).bindFuture((e=>e.canResolve?(r.removeData(t.conversationUid),u().mapResult((()=>({canResolve:!0})))):Ft({canResolve:!1}))))))),p=(e,t,n,o)=>(e=>r.lookupData(e.conversationUid).fold((()=>Lt.error(`Could not find conversation with uid ${e.conversationUid}`)),(t=>M(t.comments,(t=>t.uid===e.commentUid)).fold((()=>Lt.error(`Could not find comment with uid ${e.commentUid} in conversation ${e.conversationUid}`)),(e=>Lt.value({conversationUid:t.uid,comment:e}))))))(e).fold((e=>Ht(e)),(s=>n(s).bindFuture((n=>!0===n[t]?r.updateData(e.conversationUid,o(s)).fold((()=>Ht("Could not operate on comment ("+t+")")),(e=>u().mapResult((()=>({[t]:!0}))))):Ft({[t]:!1}))))),g={onPreInit:t=>{e.parser.addNodeFilter("#comment",((t,n,o)=>{o.isRootContent&&(r.clear(),E(t,(t=>{const n=t.value;n&&An(n)&&(t.remove(),xn(n).each((e=>r.setEncryptedData({encrypted:e.rest}))),kn(n).get((t=>t.fold((e=>console.error("Error extracting embedded conversations: "+e)),(t=>{r.setData(t.conversations,t.encrypted),(e=>{e.dispatch("mce-tinycomments-update",{})})(e)})))))})))}))},onGetContent:(e,t)=>r.getEncryptedData().map((e=>t+(e=>{const t=pe(document.createComment((e=>[Cn,Sn,...e.encrypted].join("|"))(e)));return(e=>{const t=he("div"),n=pe(e.dom.cloneNode(!0));return Se(t,n),(e=>e.dom.innerHTML)(t)})(t)})(e)))};return{create:e=>{const t=J("mce-conversation");return r.addData(t,{uid:t,comments:[{uid:t,...l,...m,content:e.content,createdAt:e.createdAt,modifiedAt:e.createdAt}]}),u().mapResult((()=>({conversationUid:t})))},reply:e=>{const t=J("mce-reply"),n={uid:t,...l,...m,content:e.content,createdAt:e.createdAt,modifiedAt:e.createdAt};return r.updateData(e.conversationUid,(e=>({...e,comments:e.comments.concat([n])}))).fold((()=>Ht("Could not reply to uid: "+e.conversationUid)),(()=>u().mapResult((()=>({commentUid:t,author:n.author,authorName:n.authorName})))))},lookup:e=>r.lookupData(e.conversationUid).fold((()=>Ht("Could not find uid: "+e.conversationUid)),(e=>Ft({conversation:e}))),fetchConversations:_,deleteConversation:e=>r.lookupData(e.conversationUid).fold((()=>Ht("Could not find conversation to delete")),(t=>s({conversationUid:t.uid,comments:t.comments}).bindFuture((t=>t.canDelete?(r.removeData(e.conversationUid),u().mapResult((()=>({canDelete:!0})))):Ft({canDelete:!1}))))),resolveConversation:v,deleteAllConversations:()=>{const e=L(r.get()),t=R(e,(e=>r.lookupData(e).fold((()=>Ht("Could not find conversation")),(e=>s({conversationUid:e.uid,comments:e.comments})))));return Bt((e=>{var n;(n=t,((e,t)=>t((t=>{const n=[];let o=0;0===e.length?t([]):E(e,((r,s)=>{r.get((r=>s=>{n[r]=s,o++,o>=e.length&&t(n)})(s))}))})))(n,Mt)).get((t=>{const n=(e=>{for(let t=0,n=e.length;t<n;++t)if(!0!==e[t].exists((e=>e.canDelete)))return!1;return!0})(t);n&&r.clear(),e(Lt.value({canDelete:n}))}))}))},deleteComment:e=>p(e,"canDelete",a,(e=>{return t=e.comment.uid,e=>({uid:e.uid,comments:T(e.comments,(e=>e.uid!==t))});var t})),editComment:e=>p(e,"canEdit",(t=>i({...t,edit:{modifiedAt:e.modifiedAt,content:e.content}})),(()=>{return t=e.commentUid,n=e.content,o=e.modifiedAt,e=>({uid:e.uid,comments:R(e.comments,(e=>e.uid===t?{...e,content:n,modifiedAt:o}:e))});var t,n,o})),lifecycleHooks:g}},Rn=(e,t)=>{if(pn(e))return"disabled";const n=un(e);return"readonly"===t&&"full"===n?"read":n};var En,Tn;!function(e){e[e.Before=0]="Before",e[e.QueryingDelete=1]="QueryingDelete",e[e.QueryingResolve=2]="QueryingResolve",e[e.PostDelete=3]="PostDelete",e[e.PostResolve=4]="PostResolve"}(En||(En={})),function(e){e[e.Open=0]="Open",e[e.Closed=1]="Closed",e[e.Closing=2]="Closing"}(Tn||(Tn={}));const Mn=e=>{return((e=(()=>pe(document))())=>x.from(e.dom.activeElement).map(pe))((t=e,pe(t.dom.getRootNode()))).filter((t=>e.dom.contains(t.dom)));var t},Nn=e=>`.${e}`;[".tox-menu",`[role="menuitem"]:contains(${Ve.tc_kebab_edit})`].join(" "),[".tox-menu",`[role="menuitem"]:contains(${Ve.tc_kebab_delete})`].join(" "),[".tox-menu",`[role="menuitem"]:contains(${Ve.tc_kebab_delete_conversation})`].join(" "),[".tox-menu",`[role="menuitem"]:contains(${Ve.tc_kebab_resolve_conversation})`].join(" "),Ve.tc_edit_buttons_save,Ve.tc_edit_buttons_saving,Ve.tc_reply_placeholders,Ve.tc_edit_buttons_cancel,Ve.tc_reply_buttons_clear,Ve.tc_delete_buttons_proceed,Ve.tc_resolve_buttons_proceed,[Nn("tox-collection__item--state-disabled"),Nn("tox-mentions__username")+`:contains(${Ve.tc_mentions_no_results})`].join(" ");const jn={outerContainer:["tox-conversations"]},Pn=(e,t,n,o,r,s,a,i,c,l,m,d)=>u=>{var _,v;if(t.set(Tn.Open),_=pe(e.getBody()),v=lt(),gt(_)?_.dom.classList.add(v):((e,t)=>{((e,t,n)=>{const o=pt(e,t).concat([n]);re(e,t,o.join(" "))})(e,"class",t)})(_,v),a.set(mt(e)),n.get()){const t=document.createElement("div");t.className=jn.outerContainer.join(" "),u.element().append(t),m.then((()=>l.then((n=>{const l=n(e,o,r,s,a,i,c,d,t);e.on("remove",l)})))),n.set(!1)}},Ln=(e,t)=>n=>{Mn(pe(n.element())).each((t=>{e.focus()})),t.set(Tn.Closed),ft(pe(e.getBody()),lt())},Un=(e,t,n)=>{t.get()!==Tn.Closed&&t.get()!==Tn.Closing||kt(e),n.set(mt(e))},$n=(e,t,n,o,r)=>{r.set(!0),o.set(!1),Un(e,t,n)},Bn=(e,t,n,o,r,s,a)=>{const i="comment-add";e.ui.registry.addToggleMenuItem("showcomments",{text:Ve.tc_items_showcomments,icon:"comment",onAction:()=>kt(e),onSetup:e=>n.subscribe((t=>{e.setActive(t===Tn.Open)})),context:"any"});const c=t=>{const n=()=>{t(!ht(e,a))};return n(),e.on("SelectionChange NodeChange SwitchMode DisabledStateChange",n),()=>e.off("SelectionChange NodeChange SwitchMode DisabledStateChange",n)},l=()=>{ht(e,a)||((e=>!!e.selection&&ut(e,e.selection.getRng()).length>0)(e)?$n(e,n,s,o,r):((e=>{const t=J(ct());e.selection.expand(),(e=>{const t=e.selection.bookmarkManager.getBookmark();$(e.annotator.getAll(tt()),((t,n)=>{dt(n)&&t.forEach((t=>{e.selection.select(t),e.annotator.remove(tt())}))})),e.selection.bookmarkManager.moveToBookmark(t)})(e),e.annotator.annotate(tt(),{uid:t})})(e),((e,t,n,o,r)=>{r.set(!1),o.set(!0),Un(e,t,n)})(e,n,s,o,r)))};e.ui.registry.addButton("addcomment",{tooltip:Ve.tc_items_addcomment,icon:i,onAction:l,onSetup:e=>c(e.setEnabled),context:"any"}),e.ui.registry.addMenuItem("addcomment",{text:Ve.tc_items_addcomment,shortcut:"meta+Alt+M",icon:i,onAction:l,onSetup:e=>c(e.setEnabled),context:"any"}),e.ui.registry.addMenuItem("deleteallconversations",{text:Ve.tc_items_deleteall,onAction:()=>{(e=>{e.execCommand(At,!1,{})})(e)},onSetup:t=>{const n=e.annotator.getAll(tt());return t.setEnabled(!(e=>{for(const t in e)if(U.call(e,t))return!1;return!0})(n)&&a.get().canWrite),y},context:"any"}),e.shortcuts.add("meta+alt+m","TinyComments addComment",(()=>{const t=F(e.annotator.getAll(tt()),(t=>t.includes(e.selection.getNode())));j(L(t)).fold((()=>l()),(()=>$n(e,n,s,o,r)))}))},In=(e,t)=>{const s=P(!1),a=P([]),i=G([]),c=G(Tn.Closed),l=G(Rn(e,e.mode.get())),d=((e,t)=>{let n;Array.isArray(e)||(e=[e]);let o=0,r=()=>{let r=e.map((e=>e.get()));if(void 0===n||r.some(((e,t)=>e!==n[t]))){let e=++o;n=r;let a=t(...r);a&&a.then&&a.t?a.then((t=>{e===o&&s.set(t)})):s.set(a)}},s=G(void 0,Math.max(...e.map((e=>e.l)))+1),a=r;var i,c,l,m,d;return c=()=>{let t=e.map((e=>e.listen(a,-1/s.l)));return r(),()=>{for(let e of t)e()}},m=e=>{let t=c();t&&i.events[6].push(t)},d=e=>{let t=i.listen;i.listen=(...n)=>(i.lc||i.active||(i.active=!0,e()),t(...n));let n=i.off;return i.events[6]=[],i.off=()=>{n(),setTimeout((()=>{if(i.active&&!i.lc){i.active=!1;for(let e of i.events[6])e();i.events[6]=[]}}),1e3)},()=>{i.listen=t,i.off=n}},(l=i=s).events=l.events||{},l.events[15]||(l.events[15]=d((e=>{l.events[5].reduceRight(((e,t)=>(t(e),e)),{shared:{},...e})}))),l.events[5]=l.events[5]||[],l.events[5].push(m),s})(l,(e=>{return t=e,{canWrite:(()=>{switch(t){case"read":case"disabled":return!1;default:return!0}})()};var t})),u=G(!1),v=G(!1),h=((e,t)=>n=>{const o=Xe(t);t.set(t.get().concat([n])),((e,t)=>{const n={getEventLog:t};e.dispatch("CommentChange",n)})(e,o)})(e,a);((e,t)=>{const n=e.options.register;n("tinycomments_css_url",{processor:"string",default:t+"/css"}),n("tinycomments_js_url",{processor:"string",default:t+"/js"}),n("tinycomments_mode",{processor:"string",default:"callback"}),n("tinycomments_access",{processor:e=>{const t=D(["full","comment"],e);return t?{value:e,valid:t}:{valid:!1,message:"Must be full, or comment."}},default:"full"}),n("tinycomments_author",{processor:e=>{const t="Must be a non-empty string";return m(e)?_e(e)?{valid:!0,value:e}:{valid:!1,value:"Anon",message:t}:{valid:!1,message:t}},default:"Anon"}),n("tinycomments_author_name",{processor:e=>{const t="Must be a non-empty string";return m(e)?_e(e)?{valid:!0,value:e}:{valid:!1,value:"Anon",message:t}:{valid:!1,message:t}}}),n("tinycomments_author_avatar",{processor:"string"}),n("tinycomments_mentions_enabled",{processor:"boolean",default:!0}),E(["tinycomments_create","tinycomments_reply","tinycomments_lookup","tinycomments_fetch","tinycomments_delete","tinycomments_delete_all","tinycomments_delete_comment","tinycomments_can_delete","tinycomments_can_delete_comment","tinycomments_resolve","tinycomments_can_resolve","tinycomments_edit_comment","tinycomments_can_edit_comment"],(e=>n(e,{processor:"function"})))})(e,t);const p=(e=>("embedded"===_n(e)?Dn:yn)(e))(e),g={translate:e=>tinymce.translate(e),getIcon:t=>{var n;return null!==(n=e.ui.registry.getAll().icons[t])&&void 0!==n?n:"temporary-placeholder"}},f=((e,t)=>tinymce.Resource.load("tinymce.plugins.tinycomments.sidebar",t))(0,(e=>hn(e)+"/")(e)+"tinycomments-sidebar.min.js").then((e=>(s.set(!0),e))),y=Ge(g);e.on("remove",y.release),e.on("PreInit",(()=>{p.lifecycleHooks.onPreInit(e),((e,t)=>{e.annotator.register(tt(),{decorate:()=>({classes:[et()],attributes:{}})}),e.annotator.annotationChanged(tt(),((e,n,o)=>{o&&dt(o.uid)||(e?t.onComment():t.notOnComment())}))})(e,y)})),Ot(e,p,h,i),Bn(e,0,c,u,v,i,d),((e,t,n,o,r,s,a,i,c,l)=>{const m=P(!0),d=new Promise((t=>{e.initialized?t():e.on("init",(()=>{t()}),!0)}));e.ui.registry.addSidebar("showcomments",{tooltip:Ve.tc_items_showcomments,icon:"comment",onShow:Pn(e,s,m,t,n,o,l,a,i,r,d,c),onHide:Ln(e,s)})})(e,p,g,h,f,c,u,v,d,i),((e,t)=>{e.on("init DisabledStateChange",(()=>{n(e.mode.get())})),e.on("SwitchMode",(e=>{n(e.mode)}));const n=n=>{const o=Rn(e,n);var r;t.set(o),"readonly"!==n&&((e=>"read"===e)(r=o)||(e=>"comment"===e)(r))&&e.mode.set("readonly")}})(e,l),e.on("PostRender",(()=>{(e=>{var t;const n=vn(e)+"/tinycomments.css",o=x.from(null===(t=e.ui)||void 0===t?void 0:t.styleSheetLoader).getOr(tinymce.DOM.styleSheetLoader);((e,t,n)=>{const o=null!=n?n:tinymce.DOM.styleSheetLoader;if(tinymce.Resource.has(e)){const t=tinymce.Resource.get(e);return tinymce.DOM.styleSheetLoader.loadRawCss(e,t),Promise.resolve()}o.load(t)})("tinycomments/css/tinycomments.css",n,o),e.on("remove",(()=>o.unload(n)))})(e)}));const b=()=>{const t=L(e.annotator.getAll("tinycomments"));((e,t,n=r)=>o(n).eq(e,t))(t,i.get(),n)||i.set(t)},w=(e=>{let t=null;const n=()=>{_(t)||(clearTimeout(t),t=null)};return{cancel:n,throttle:(...o)=>{n(),t=setTimeout((()=>{t=null,e.apply(null,o)}),250)}}})(b);return e.on("LoadContent",b),e.on("SetContent input Change",w.throttle),e.on("remove",w.cancel),e.on("GetContent",(t=>{if(m(t.content)){const n=!0===t.source_view,o=!0===t.contextual,r=!0===t.selection,s=n||o||r?x.none():p.lifecycleHooks.onGetContent(e,t.content);t.content=s.getOr(t.content)}})),((e,t)=>({getEventLog:Xe(t),hasLoadedUi:e.get}))(s,a)};tinymce.PluginManager.requireLangPack("tinycomments","ar,bg_BG,ca,cs,da,de,el,es,eu,fa,fi,fr_FR,he_IL,hi,hr,hu_HU,id,it,ja,kk,ko_KR,ms,nb_NO,nl,pl,pt_PT,pt_BR,ro,ru,sk,sl_SI,sv_SE,th_TH,tr,uk,vi,zh_CN,zh_TW"),tinymce.PluginManager.add("tinycomments",((e,t)=>((e,t)=>!!e&&-1===((e,t)=>{const n=Y(e.major,t.major);if(0!==n)return n;const o=Y(e.minor,t.minor);if(0!==o)return o;const r=Y(e.patch,t.patch);return 0!==r?r:0})((e=>W((e=>[e.majorVersion,e.minorVersion].join(".").split(".").slice(0,3).join("."))(e)))(e),W(t)))(tinymce,"6.8.0")?(console.error("The tinycomments plugin requires at least version 6.8.0 of TinyMCE."),{}):In(e,t)))}();