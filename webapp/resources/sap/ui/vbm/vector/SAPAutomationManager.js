sap.ui.define(["sap/ui/core/Lib","./VBITransformer"],function(e,t){"use strict";class a{constructor(e,t){this.map=e;this.LngLatBounds=t}load(e){if(!e?.Call)return;const t=Array.isArray(e.Call)?e.Call:[e.Call];t.forEach(e=>this.addAutomation(e))}createHandler(e){if(e.handler==="FLYTOHANDLER"){return this.flyToHandler(e.Param)}else{return false}}addAutomation(e){let t=this.createHandler(e);if(!t){return}let a={name:e.name||"Unnamed",handler:e.handler,delay:e.delay||1,earliest:e.earliest||1,retryAfterMS:e.retryAfterMS||0,reattempts:e.reattempts||-1,attempts:0,params:e.Param,start:()=>t.start()};this.scheduleAutomation(a)}scheduleAutomation(e){const t=(new Date).getTime();const a=t-(this.map.startTime||t);let r=e.delay;if(a<e.earliest){r=Math.max(r,e.earliest-a)}setTimeout(()=>this.executeAutomation(e),r)}executeAutomation(e){const t=e.start();if(!t&&e.retryAfterMS){e.attempts++;if(e.reattempts===-1||e.attempts<e.reattempts){setTimeout(()=>this.executeAutomation(e),e.retryAfterMS)}}}calculatebounds(){let e=[];let t=VBI.VBITransformer.getTransformedJSON();t[1].features.forEach(t=>{let a=t.geometry.coordinates;if(t.geometry.type==="LineString"){a.forEach(t=>{if(!e.some(e=>e[0]===t[0]&&e[1]===t[1])){e.push(t)}})}else{if(!e.some(e=>e[0]===a[0]&&e[1]===a[1])){e.push(a)}}});let a;if(e.length>0){a=e.reduce((e,t)=>e.extend(t),new this.LngLatBounds(e[0],e[0]))}return a}flyToHandler(e){const t=parseFloat(e.find(e=>e.name==="x")?.["#"]);const a=parseFloat(e.find(e=>e.name==="y")?.["#"]);const r=parseFloat(e.find(e=>e.name==="lod")?.["#"])||12;const s=parseFloat(e.find(e=>e.name==="velocity")?.["#"])||1;const n=e.find(e=>e.name==="zoomToAll")?.["#"]||false;if(n){let e=this.calculatebounds();if(e){map.fitBounds(e,{padding:150})}return true}else if(t!==undefined&&a!==undefined){this.map.flyTo({center:[t,a],zoom:r,speed:s,essential:true});return true}return false}}return a});
//# sourceMappingURL=SAPAutomationManager.js.map