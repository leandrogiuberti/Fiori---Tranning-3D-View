/*!
* OpenUI5
 * (c) Copyright 2025 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
*/
sap.ui.define(["./BaseContent","./ObjectContentRenderer","sap/ui/core/Lib","sap/ui/integration/library","sap/m/library","sap/m/IllustratedMessageType","sap/m/FlexItemData","sap/m/HBox","sap/m/VBox","sap/m/Text","sap/m/Avatar","sap/m/Link","sap/m/Label","sap/m/RatingIndicator","sap/m/Image","sap/m/ComboBox","sap/m/TextArea","sap/m/Input","sap/m/TimePicker","sap/base/Log","sap/base/util/isEmptyObject","sap/base/util/isPlainObject","sap/base/util/merge","sap/ui/core/ResizeHandler","sap/ui/layout/AlignedFlowLayout","sap/ui/dom/units/Rem","sap/ui/integration/util/ObjectStatusFactory","sap/ui/integration/util/BindingHelper","sap/ui/integration/util/BindingResolver","sap/ui/integration/util/Utils","sap/ui/integration/util/Form","sap/ui/integration/util/DateRangeHelper","sap/ui/integration/util/Duration","sap/ui/integration/util/subtitleToSubTitle","sap/ui/integration/controls/ImageWithOverlay","sap/f/AvatarGroup","sap/f/AvatarGroupItem","sap/f/cards/NumericIndicators","sap/f/cards/NumericSideIndicator","sap/f/cards/loading/ObjectPlaceholder","sap/f/library","sap/m/OverflowToolbar","sap/m/OverflowToolbarButton","sap/ui/core/ListItem"],function(e,t,a,i,r,o,n,s,l,u,p,c,d,m,g,f,h,v,y,b,I,C,_,F,S,w,x,A,B,O,R,P,T,G,L,D,j,V,k,z,E,M,N,U){"use strict";var W=r.AvatarSize;var q=r.AvatarColor;var H=r.AvatarImageFitType;var K=r.ButtonType;var X=r.FlexRendertype;var J=r.FlexJustifyContent;var Q=i.CardActionArea;var Y=E.AvatarGroupType;var Z=r.ToolbarStyle;var $=r.ImageMode;var ee=e.extend("sap.ui.integration.cards.ObjectContent",{metadata:{library:"sap.ui.integration",aggregations:{_form:{type:"sap.ui.integration.util.Form",multiple:false,visibility:"hidden"}}},renderer:t});ee.prototype.onAfterRendering=function(){e.prototype.onAfterRendering.apply(this,arguments);const t=this._getRootContainer();if(t.getDomRef()){const e=t.getDomRef().offsetWidth;const a=t.getItems();a.forEach((t,i)=>{if(t.isA("sap.ui.layout.AlignedFlowLayout")){this._resizeAlignedFlowLayout(t,e,i===a.length-1)}})}};ee.prototype.exit=function(){e.prototype.exit.apply(this,arguments);if(this._sResizeListenerId){F.deregister(this._sResizeListenerId);this._sResizeListenerId=""}};ee.prototype.createLoadingPlaceholder=function(e){return new z};ee.prototype.onDataChanged=function(){var e=this.getCardInstance();if(this._hasData()){this.hideNoDataMessage()}else{this.showNoDataMessage({illustrationType:o.NoData,title:a.getResourceBundleFor("sap.ui.integration").getText("CARD_NO_ITEMS_ERROR_CHART")})}this._getForm().updateModel();if(e.isReady()){this.validateControls(false)}};ee.prototype._getForm=function(){var e=this.getAggregation("_form");if(!e){e=new R(this.getCardInstance());this.setAggregation("_form",e)}return e};ee.prototype.validateControls=function(e,t){this._getForm().validate(e,t)};ee.prototype._hasData=function(){var e=this.getConfiguration();if(!e.hasOwnProperty("hasData")){return true}var t=B.resolveValue(e.hasData,this,this.getBindingContext().getPath());if(Array.isArray(t)&&!t.length||C(t)&&I(t)){return false}return!!t};ee.prototype.applyConfiguration=function(){var e=this.getParsedConfiguration();if(!e){return}if(e.groups){this._addGroups(e)}};ee.prototype.getStaticConfiguration=function(){const e=this.getParsedConfiguration();const t=A.prependPath(this.getDataPath(),this.getCardDataPath());if(e.groups){e.groups.forEach(function(e){var a=[];if(e.items){e.items.forEach(function(e){a.push(this._resolveGroupItem(e,t))}.bind(this))}e.items=a}.bind(this))}return e};ee.prototype._resolveGroupItem=function(e,t){var a=_({},e),i=e.path||"/",r=e.template,o=["TextArea","Input","ComboBox","Duration","DateRange"].includes(e.type),n=["ButtonGroup","IconGroup"].includes(e.type);if(o){a=_(a,this._getForm().resolveControl(e))}if(e.type==="ComboBox"){if(e.item){n=true;i=e.item.path;r=e.item.template;delete a.item}else{n=false}}if(e.type==="Image"&&a.overlay){G(a.overlay)}if(n){const e=B.resolveListBinding(i,t,r,this);e.forEach(function(e){if(e.icon&&e.icon.src){e.icon.src=this._oIconFormatter.formatSrc(e.icon.src)}else if(e.icon&&typeof e.icon==="string"){e.icon=this._oIconFormatter.formatSrc(e.icon)}}.bind(this));a.items=e;delete a.path;delete a.template}if(e.icon&&e.icon.src){a.icon.src=this._oIconFormatter.formatSrc(B.resolveValue(e.icon.src,this))}if(e.src){a.src=this._oIconFormatter.formatSrc(B.resolveValue(e.src,this))}return a};ee.prototype._getRootContainer=function(){var e=this.getAggregation("_content");if(!e){e=new l({renderType:X.Bare});this.setAggregation("_content",e);this._sResizeListenerId=F.register(e,this._onResize.bind(this))}return e};ee.prototype._addGroups=function(e){var t=this._getRootContainer(),a,i=true,r=e.groups||[];r.forEach(function(e,o){var s=this._createGroup(e,"/sap.card/content/groups/"+o);if(e.alignment==="Stretch"){s.setLayoutData(new n({growFactor:1}));t.addItem(s);i=true}else{if(i){a=this._createAFLayout();t.addItem(a);i=false}a.addContent(s)}if(o===r.length-1){s.addStyleClass("sapFCardObjectGroupLastInColumn")}},this);this._oActions.attach({area:Q.Content,actions:e.actions,control:this})};ee.prototype._createGroup=function(e,t){var a;if(typeof e.visible=="string"){a=!O.hasFalsyValueAsString(e.visible)}else{a=e.visible}var i=new l({visible:a,renderType:X.Bare}).addStyleClass("sapFCardObjectGroup");if(e.title){i.addItem(new u({text:e.title,maxLines:e.titleMaxLines||1}).addStyleClass("sapFCardObjectItemTitle sapMTitle sapMTitleStyleAuto"));i.addStyleClass("sapFCardObjectGroupWithTitle")}e.items.forEach(function(a,r){a.labelWrapping=e.labelWrapping;this._createGroupItems(a,t+"/items/"+r).forEach(i.addItem,i)},this);return i};ee.prototype._createGroupItems=function(e,t){var a=e.label,i=e.showColon,r,o,n;e.showColon=i===undefined?true:i;if(typeof e.visible=="string"){o=!O.hasFalsyValueAsString(e.visible)}else{o=e.visible}if(a){r=new d({text:a,visible:o,wrapping:e.labelWrapping,showColon:e.showColon}).addStyleClass("sapFCardObjectItemLabel");r.addEventDelegate({onBeforeRendering:function(){r.setVisible(r.getVisible()&&!!r.getText())}})}n=this._createItem(e,o,r,t);if(n&&!n.isA("sap.m.Image")){n.addStyleClass("sapFCardObjectItemValue")}if(e.icon){var u=new l({renderType:X.Bare,justifyContent:J.Center,items:[r,n]}).addStyleClass("sapFCardObjectItemPairContainer");var p=new s({visible:o,renderType:X.Bare,items:[this._createGroupItemAvatar(e.icon),u]}).addStyleClass("sapFCardObjectItemLabel");return[p]}else{return[r,n]}};ee.prototype._createGroupItemAvatar=function(e){var t=A.formattedProperty(e.src,function(e){return this._oIconFormatter.formatSrc(e)}.bind(this));var a=e.initials||e.text;var i=new p({displaySize:e.size||W.XS,src:t,initials:a,displayShape:e.shape,tooltip:e.alt,backgroundColor:e.backgroundColor||(a?undefined:q.Transparent),imageFitType:e.fitType||H.Cover,visible:e.visible}).addStyleClass("sapFCardObjectItemAvatar sapFCardIcon");return i};ee.prototype._createItem=function(e,t,a,i){var r,o=e.value,n=e.tooltip,s;switch(e.type){case"NumericData":r=this._createNumericDataItem(e,t);break;case"Status":r=this._createStatusItem(e);break;case"IconGroup":r=this._createIconGroupItem(e,t);break;case"ButtonGroup":r=this._createButtonGroupItem(e,t);break;case"ComboBox":r=this._createComboBoxItem(e,t,a,i);break;case"TextArea":r=this._createTextAreaItem(e,t,a,i);break;case"RatingIndicator":r=this._createRatingIndicatorItem(e,t);break;case"Image":r=this._createImageItem(e,t);break;case"Input":r=this._createInputItem(e,t,a,i);break;case"Duration":r=this._createDurationItem(e,t,a,i);break;case"DateRange":r=this._createDateRangeItem(e,t,a,i);break;case"link":b.warning("Usage of Object Group Item property 'type' with value 'link' is deprecated. Use Card Actions for navigation instead.",null,"sap.ui.integration.widgets.Card");r=new c({href:e.url||o,text:o,tooltip:n,target:e.target||"_blank",visible:A.reuse(t)});break;case"email":b.warning("Usage of Object Group Item property 'type' with value 'email' is deprecated. Use Card Actions for navigation instead.",null,"sap.ui.integration.widgets.Card");var l=[];if(e.value){l.push(e.value)}if(e.emailSubject){l.push(e.emailSubject)}s=A.formattedProperty(l,function(e,t){if(t){return"mailto:"+e+"?subject="+t}else{return"mailto:"+e}});r=new c({href:s,text:o,tooltip:n,visible:A.reuse(t)});break;case"phone":b.warning("Usage of Object Group Item property 'type' with value 'phone' is deprecated. Use Card Actions for navigation instead.",null,"sap.ui.integration.widgets.Card");s=A.formattedProperty(o,function(e){return"tel:"+e});r=new c({href:s,text:o,tooltip:n,visible:A.reuse(t)});break;default:r=this._createTextItem(e,t,a)}return r};ee.prototype._createNumericDataItem=function(e,t){var a=new l({visible:A.reuse(t)});var i=new V({number:e.mainIndicator.number,numberSize:e.mainIndicator.size,scale:e.mainIndicator.unit,trend:e.mainIndicator.trend,state:e.mainIndicator.state}).addStyleClass("sapUiIntOCNumericIndicators");a.addItem(i);if(e.sideIndicators){e.sideIndicators.forEach(function(e){i.addSideIndicator(new k({title:e.title,number:e.number,unit:e.unit,state:e.state}))})}if(e.details){a.addItem(new u({text:e.details,maxLines:1}).addStyleClass("sapUiIntOCNumericIndicatorsDetails"))}return a};ee.prototype._createStatusItem=function(e){const t=x.createStatusItem(e);this._oActions.attach({area:Q.ContentItemDetail,actions:e.actions,control:t,enabledPropertyName:"active"});return t};ee.prototype._createTextItem=function(e,t,a){var i=e.value,r=e.tooltip,o;if(i&&e.actions){o=new c({text:i,tooltip:r,visible:A.reuse(t)});if(a){o.addAriaLabelledBy(a)}else{b.warning("Missing label for Object group item with actions.",null,"sap.ui.integration.widgets.Card")}this._oActions.attach({area:Q.ContentItemDetail,actions:e.actions,control:this,actionControl:o,enabledPropertyName:"enabled"});o=new s({renderType:X.Bare,items:o})}else if(i){o=new u({text:i,visible:A.reuse(t),maxLines:e.maxLines})}return o};ee.prototype._createButtonGroupItem=function(e,t){var a=e.template;if(!a){return null}var i=new M({visible:A.reuse(t),style:Z.Clear});i.addStyleClass("sapUiIntCardObjectButtonGroup");var r=new N({icon:A.formattedProperty(a.icon,function(e){return this._oIconFormatter.formatSrc(e)}.bind(this)),text:a.text||a.tooltip,tooltip:a.tooltip||a.text,type:K.Transparent,visible:a.visible});if(a.actions){r.attachPress(function(e){this._onButtonGroupPress(e,a.actions)}.bind(this))}i.bindAggregation("content",{path:e.path||"/",template:r,templateShareable:false});return i};ee.prototype._onButtonGroupPress=function(e,t){var a=e.getSource();var i=B.resolveValue(t,a,a.getBindingContext().getPath());var r=i[0];this.getActions().fireAction(this,r.type,r.parameters)};ee.prototype._createIconGroupItem=function(e,t){var a=e.template;if(!a){return null}var i=new D({avatarDisplaySize:e.size||W.XS,groupType:Y.Individual,visible:A.reuse(t)});i._oShowMoreButton.setType(K.Transparent);i._oShowMoreButton.setEnabled(false);if(a.actions){i.attachPress(function(e){this._onIconGroupPress(e,a.actions)}.bind(this))}else{i._setInteractive(false)}var r=new j({src:A.formattedProperty(a.icon.src,function(e){return this._oIconFormatter.formatSrc(e)}.bind(this)),initials:a.icon.initials||a.icon.text,tooltip:a.icon.alt});i.bindAggregation("items",{path:e.path||"/",template:r,templateShareable:false});return i};ee.prototype._onIconGroupPress=function(e,t){if(e.getParameter("overflowButtonPressed")){}else{var a=e.getParameter("eventSource");var i=B.resolveValue(t,a,a.getBindingContext().getPath());var r=i[0];this.getActions().fireAction(this,r.type,r.parameters)}};ee.prototype._createComboBoxItem=function(e,t,a,i){var r=this._getForm(),o={visible:A.reuse(t),placeholder:e.placeholder,required:r.getRequiredValidationValue(e)},n,s;if(e.selectedKey){o.selectedKey=e.selectedKey}else if(e.value){o.value=e.value}n=new f(o);if(a){a.setLabelFor(n)}if(e.item){s=new U({key:e.item.template.key,text:e.item.template.title});n.bindItems({path:e.item.path||"/",template:s,templateShareable:false})}r.addControl("change",n,e,i);return n};ee.prototype.setFormFieldValue=function(e){this._getForm().setControlValue(e)};ee.prototype._createTextAreaItem=function(e,t,a,i){var r=this._getForm(),o=new h({required:r.getRequiredValidationValue(e),value:e.value,visible:A.reuse(t),rows:e.rows,placeholder:e.placeholder});if(a){a.setLabelFor(o)}r.addControl("liveChange",o,e,i);return o};ee.prototype._createInputItem=function(e,t,a,i){var r=this._getForm(),o=new v({required:r.getRequiredValidationValue(e),value:e.value,visible:A.reuse(t),placeholder:e.placeholder});if(a){a.setLabelFor(o)}r.addControl("liveChange",o,e,i);return o};ee.prototype._createDurationItem=function(e,t,a,i){var r=this._getForm(),o=new y({valueFormat:"HH:mm",displayFormat:"HH:mm",support2400:true,required:r.getRequiredValidationValue(e),value:A.formattedProperty(e.value,T.fromISO),visible:A.reuse(t),placeholder:e.placeholder});if(a){a.setLabelFor(o)}r.addControl("change",o,e,i);return o};ee.prototype._createRatingIndicatorItem=function(e,t){var a=new m({editable:false,displayOnly:true,maxValue:e.maxValue,value:e.value,visualMode:e.visualMode,visible:A.reuse(t),iconSize:"1rem"});return a};ee.prototype._createImageItem=function(e,t){var a=A.formattedProperty(e.src,function(e){return this._oIconFormatter.formatSrc(e)}.bind(this));var i;var r=new g({src:a,alt:e.alt,height:e.height});if(e.imageFit||e.imagePosition){r.setMode($.Background);r.setBackgroundSize(e.imageFit);r.setBackgroundPosition(e.imagePosition)}if(e.overlay){r.addStyleClass("sapUiIntImgWithOverlayImg");i=new L({image:r,tooltip:e.tooltip,supertitle:e.overlay.supertitle,title:e.overlay.title,subtitle:e.overlay.subtitle||e.overlay.subTitle,verticalPosition:e.overlay.verticalPosition,horizontalPosition:e.overlay.horizontalPosition,textColor:e.overlay.textColor,textFilter:e.overlay.textFilter,background:e.overlay.background,padding:e.overlay.padding,animation:e.overlay.animation,visible:A.reuse(t)}).addStyleClass("sapFCardObjectImage");this.addStyleClass("sapFCardObjectContentWithOverlay")}else{r.setTooltip(e.tooltip);r.setVisible(A.reuse(t));r.addStyleClass("sapFCardObjectImage");i=r}if(e.fullWidth){i.addStyleClass("sapFCardObjectImageFullWidth")}const o=()=>{r.detachError(o);const t=this._oIconFormatter.formatSrc(B.resolveValue(e.fallbackSrc,this));if(t&&t!==r.getSrc()){r.setSrc(t)}};r.attachError(o);return i};ee.prototype._createDateRangeItem=function(e,t,a,i){var r={options:["date"],value:e.value,placeholder:e.placeholder};var o=this._getForm();var n=P.createInput(r,this.getCardInstance(),true);if(A.isBindingInfo(t)){n.bindProperty("visible",A.reuse(t))}else{n.setVisible(t)}n.setRequired(o.getRequiredValidationValue(e));if(a){a.setLabelFor(n)}o.addControl("change",n,e,i);return n};ee.prototype._createAFLayout=function(){var e=new S;e.addEventDelegate({onAfterRendering:function(){this.getContent().forEach(function(e){if(!e.getVisible()){document.getElementById("sap-ui-invisible-"+e.getId()).parentElement.classList.add("sapFCardInvisibleContent")}})}},e);return e};ee.prototype._onResize=function(e){if(e.size.width===e.oldSize.width){return}this.invalidate()};ee.prototype._resizeAlignedFlowLayout=function(e,t,a){var i=e.getMinItemWidth(),r,o=e.getContent().filter(function(e){return e.getVisible()}).length;if(i.lastIndexOf("rem")!==-1){r=w.toPx(i)}else if(i.lastIndexOf("px")!==-1){r=parseFloat(i)}var n=Math.floor(t/r);if(n>o){n=o}var s=n-1,l=Math.ceil(o/n);e.getContent().forEach(function(e,t){e.addStyleClass("sapFCardObjectSpaceBetweenGroup");if(s===t&&s<o){e.removeStyleClass("sapFCardObjectSpaceBetweenGroup");s+=n}if(a&&t+1>(l-1)*n){e.addStyleClass("sapFCardObjectGroupLastInColumn")}else{e.removeStyleClass("sapFCardObjectGroupLastInColumn")}})};return ee});
//# sourceMappingURL=ObjectContent.js.map