/*!
 * OpenUI5
 * (c) Copyright 2025 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["sap/ui/core/Element","sap/ui/integration/editor/fields/BaseField","sap/m/Panel","sap/m/IconTabBar","sap/m/IconTabFilter","sap/m/MessageStrip","sap/ui/integration/editor/Constants"],function(e,t,r,i,n,s,a){"use strict";var o=t.extend("sap.ui.integration.editor.fields.GroupField",{metadata:{library:"sap.ui.integration"},renderer:t.getMetadata().getRenderer()});o.prototype.initVisualization=function(t){var n=t.visualization;if(!n||n.type==="Panel"){n={type:r,settings:{headerText:t.label,visible:t.visible,expandable:t.expandable!==false,expanded:"{currentSettings>expanded}",width:"auto",backgroundDesign:"Transparent",objectBindings:{currentSettings:{path:"currentSettings>"+(t._settingspath||"/form/items")},items:{path:"items>/form/items"},context:{path:"context>/"}},expand:function(t){var r=t.getParameter("expand");if(r){var i=t.getSource();var n=this.getConfiguration();if(!i._level){i._level=n.level||0}var s=i._level==="1"&&this.getParent().getParent()?this.getParent().getParent().getAggregation("_messageStrip"):this.getParent().getAggregation("_messageStrip");if(s===null){s=e.getElementById(this.getAssociation("_messageStrip"))}i.addContent(s);i.focus()}}.bind(this)}}}else if(n.type==="Tab"){n={type:i,settings:{expandable:t.expandable!==false,visible:t.visible,expanded:"{currentSettings>expanded}",objectBindings:{currentSettings:{path:"currentSettings>"+(t._settingspath||"/form/items")},items:{path:"items>/form/items"},context:{path:"context>/"}},select:this.checkErrorsInIconTabBar.bind(this)}}}this._visualization=n;this.attachAfterInit(this._afterInit)};o.prototype._afterInit=function(){var e=this.getConfiguration();var t=this.getAggregation("_field");if(t instanceof r){if(this.getMode()!==a.EDITOR_MODE.TRANSLATION){var o=this.getResourceBundle();var g=new s({id:this.getParameterId()+"_strip",showIcon:false,visible:"{= !${currentSettings>expanded} && ${currentSettings>hasError} === true}",text:{path:"currentSettings>errorType",formatter:function(e){var t="";switch(e){case"Error":t=o.getText("EDITOR_GROUP_ERRORS");break;case"Warning":t=o.getText("EDITOR_GROUP_WARNINGS");break;default:}return t}},type:"{currentSettings>errorType}",objectBindings:{currentSettings:{path:"currentSettings>"+(e._settingspath||"/form/items")}}});if(e.level!=="1"){g.setModel(this._settingsModel,"currentSettings")}g.addStyleClass("sapUiIntegrationEditorPanelMessageStrip");t._messageStrip=g}t._cols=e.cols||2;t._level=e.level||0;var l={onAfterRendering:function(t){var n=t.srcControl;var s=document.getElementById(n.getId());s.setAttribute("aria-label",e.label);if(n._subItems&&n._subItems.length>0){this.checkErrorsInSubItems(this._settingsModel,n)}var a=n._messageStrip;if(n._level!=="1"&&a){a.invalidate()}if(n.getExpanded()){var o=n.getContent();o.forEach(function(e){if(e.isA("sap.ui.integration.editor.fields.GroupField")){var t=e.getAggregation("_field");if(t instanceof r&&t._subItems&&t._subItems.length>0){e.checkErrorsInSubItems(e._settingsModel,t)}else if(t instanceof i&&t.getItems().length>0){e.checkErrorsInIconTabBar()}}})}}.bind(this)};t.addEventDelegate(l)}else if(t instanceof i){var d=new n(this.getParameterId()+"_control_icontabfilter",{text:e.label,visible:e.visible,objectBindings:{currentSettings:{path:"currentSettings>"+(e._settingspath||"/form/items")},items:{path:"items>/form/items"},context:{path:"context>/"}}});t.addItem(d);t.setBackgroundDesign("Transparent");t.setHeaderBackgroundDesign("Transparent");if(this.getMode()!==a.EDITOR_MODE.TRANSLATION){var u=new s({id:this.getParameterId()+"_strip",showIcon:false,visible:false,objectBindings:{currentSettings:{path:"currentSettings>"+(e._settingspath||"/form/items")}}});u.addStyleClass("sapUiIntegrationEditorTabMessageStrip");t._messageStrip=u}d._level=e.level||0}};o.prototype.checkErrorsInIconTabBar=function(t){var r=this.getAggregation("_field"),i=r.getSelectedKey(),s=r.getItems(),a=r.getExpanded(),o=false;for(var g=0;g<s.length;g++){if(!a){o=true}else if(s[g].getId()!==i){o=true}else if(s[g].getId()===i){o=false}if(o){var l=false,d="None";if(s[g]._subItems&&s[g]._subItems.length>0){var u=s[g].getModel("currentSettings");var c=this.checkErrorsInSubItems(u,s[g]);l=c.hasError;d=c.errorType}if(l){var p=new n,f=s[g];if(f.getItems().length>0){f.removeAllItems()}f.addItem(p);this._handleITBValidation(f,d);if(f._oExpandButton===undefined){this._delayHandleITBValidation(f,d)}else{this._handleITBValidation(f,d)}}}else if(s[g].getItems().length>0){s[g].removeItem(s[g].getItems()[0]);if(s[g]._oExpandButton){s[g]._oExpandButton.visible=false}var h=this.getParent().getParent().getAggregation("_messageStrip");if(h===null){h=e.getElementById(this.getAssociation("_messageStrip"))}s[g].addContent(h)}}};o.prototype.checkErrorsInSubItems=function(t,r){var i=false;var n="None";for(var s=0;s<r._subItems.length;s++){var a=r._subItems[s].settingspath;var o=e.getElementById(r._subItems[s].itemId);if(t.getProperty(a+"/hasError")===true&&o.getVisible()){i=true;var g=t.getProperty(a+"/errorType");if(g==="Error"){n="Error";break}else if(g==="Warning"&&n!=="Error"){n="Warning"}}}t.setProperty("hasError",i,this.getBindingContext("currentSettings"));t.setProperty("errorType",n,this.getBindingContext("currentSettings"));return{hasError:i,errorType:n}};o.prototype._handleITBValidation=function(t,r){var i=this.getResourceBundle();if(t.getItems().length>0&&t._oExpandButton){var n=t._oExpandButton;var s=null;if(r==="Error"){s=i.getText("EDITOR_GROUP_ERRORS");n.setIcon("sap-icon://message-error");n.addStyleClass("errorBTNImage")}else if(r==="Warning"){s=i.getText("EDITOR_GROUP_WARNINGS");n.setIcon("sap-icon://message-warning");n.addStyleClass("warningBTNImage")}n.setTooltip(null);n.addEventDelegate({onAfterRendering:function(e){var t=document.getElementById(n.getId());t.setAttribute("aria-label","With validation errors");t.setAttribute("title","")}});n.setEnabled(false);n.addStyleClass("errorBTN").addStyleClass("errorBTNDisabled");var a=e.getElementById(this.getParameterId()+"_strip");n.addEventDelegate({onmouseover:function(){a.setVisible(true);a.setType(r);a.setText(s)},onmouseout:function(){a.setVisible(false)}},this)}};o.prototype._delayHandleITBValidation=function(e,t){var r=this;var i=setInterval(function(){if(e._oExpandButton){r._handleITBValidation(e,t);clearInterval(i)}},50)};return o});
//# sourceMappingURL=GroupField.js.map