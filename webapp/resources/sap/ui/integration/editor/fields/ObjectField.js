/*!
 * OpenUI5
 * (c) Copyright 2025 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["sap/ui/integration/editor/fields/BaseField","sap/m/Text","sap/m/TextArea","sap/m/Input","sap/m/NavContainer","sap/m/Page","sap/m/Popover","sap/m/OverflowToolbar","sap/m/ToolbarSpacer","sap/m/Button","sap/ui/model/json/JSONModel","sap/m/Label","sap/ui/model/Filter","sap/ui/model/FilterOperator","sap/base/util/deepEqual","sap/ui/core/Icon","sap/m/Switch","sap/m/CheckBox","sap/m/MessageBox","sap/m/MessageToast","sap/base/util/deepClone","sap/m/Link","sap/ui/layout/form/SimpleForm","sap/base/util/merge","sap/ui/model/Sorter","sap/ui/integration/util/Utils","sap/m/table/columnmenu/Menu","sap/m/ComboBox","sap/ui/core/ListItem","sap/ui/model/type/Integer","sap/ui/model/type/Float","sap/m/HBox","sap/ui/core/CustomData","sap/ui/integration/editor/fields/viz/IconSelect","sap/m/Image","sap/ui/core/Lib"],function(e,t,a,r,o,n,l,i,s,d,u,p,_,c,g,v,f,T,b,h,y,O,P,m,E,I,S,D,w,L,C,x,V,B,A,R){"use strict";let M,j,N;var U=/\{\{(?!parameters.)(?!destinations.)([^\}\}]+)\}\}/g;var F=e.extend("sap.ui.integration.editor.fields.ObjectField",{metadata:{library:"sap.ui.integration",events:{tableUpdated:{},translationPopoverOpened:{}}},renderer:e.getMetadata().getRenderer()});F.loadDependencies=function(){return R.load("sap.ui.table").then(()=>new Promise((e,t)=>{sap.ui.require(["sap/ui/table/Table","sap/ui/table/Column","sap/ui/table/rowmodes/Fixed"],(t,a,r)=>{M=t;j=a;N=r;e()},t)}))};F.prototype.initVisualization=function(e){var t=this;t._newObjectTemplate={_dt:{_selected:true,_uuid:""}};var a=e.visualization;if(!a){if(e.value&&!e.properties&&(!e.values||e.values&&!e.values.metadata)){t.parseValueProperties()}if(e.values){a=t.createTableVisualization(e)}else if(e.properties){a=t.createSimpleFormVisualization(e)}else{a=t.createTextAreaVisualization(e)}e.withLabel=true}this._visualization=a;this.attachAfterInit(this._afterInit)};F.prototype._afterInit=function(){var e=this;var t=this.getAggregation("_field");if(t instanceof P){t.addStyleClass("sapUiIntegrationEditorItemObjectFieldForm");var a=y(e.getConfiguration().value,500)||{};t.setModel(new u({value:a,editMode:"Properties"}))}else if(t instanceof M){t.addStyleClass("sapUiIntegrationEditorItemObjectFieldTable");e._oMenu=new S;var r=t.getColumns();for(var o=0;o<r.length;o++){if(r[o].getFilterProperty()||r[o].getSortProperty()){r[o].setHeaderMenu(e._oMenu.getId())}}}};F.prototype.parseValueProperties=function(){var e=this;var t=e.getConfiguration();if(typeof t.value==="object"&&!g(t.value,{})&&!Array.isArray(t.value)&&!t.properties){var a={};for(var r in t.value){if(r!=="_dt"){var o=typeof t.value[r];var n=o==="string"?{}:{type:o};a[r]=n}}if(!g(a,{})){t.properties=a;t._propertiesParsedFromValue=true}}};F.prototype.createTableVisualization=function(e){var t=this;var a=t.createTableToolbar(e);var r=[];var o=e.values?e.values.data.path||"/":"/value";if(e.values&&e.values.metadata){r={path:"meta>/"+e.values.metadata.namespace+"."+e.values.metadata.entityTypeName,filters:new _({path:"$kind",operator:c.EQ,value1:"Property"}),factory:t.columnFactory.bind(t)}}else{r=t.buildTableColumns()}var n={type:M,settings:{rowMode:new N({rowCount:5}),busy:"{currentSettings>_loading}",busyIndicatorDelay:200,columns:r,selectionBehavior:"RowOnly",rowSelectionChange:t.onTableSelectionChange.bind(t),extension:a,filter:t.onFilter.bind(t)}};if(e.type==="object"){n.settings.rows="{"+o+"}"}else{n.settings.rows="{path: '"+o+"', sorter: {path: '_dt/_position', descending: false}}"}return n};F.prototype.createSimpleFormVisualization=function(e){var t=this;var a=t.getParameterId();var r=t.getResourceBundle();var o=function(){var e=this.getAggregation("_field").getModel();e.checkUpdate(true);var t=e.getProperty("/value")||{};if(!t._dt){t._dt={_uuid:I.generateUuidV4()}}else if(!t._dt._uuid){t._dt._uuid=I.generateUuidV4()}t=y(t,500);this.setValue(t)}.bind(t);var n=t.createFormContents(o,"/value/",false,t.openTranslationListPopup);var l=new d(a+"_control_form_editmode_btn",{icon:{path:"/editMode",formatter:function(e){if(e==="Properties"){return"sap-icon://syntax"}else{return"sap-icon://form"}}},tooltip:{path:"/editMode",formatter:function(e){if(e==="Properties"){return r.getText("EDITOR_FIELD_OBJECT_FORM_EDITMODE_JSON")}else{return r.getText("EDITOR_FIELD_OBJECT_FORM_EDITMODE_PROPERTIES")}}},press:function(){var e=t.getAggregation("_field").getModel();var a=e.getProperty("/editMode");if(a==="Properties"){e.setProperty("/editMode","Json")}else{e.setProperty("/editMode","Properties")}}});var u=new d(a+"_control_form_delete_btn",{icon:"sap-icon://delete",tooltip:r.getText("EDITOR_FIELD_OBJECT_DELETE"),visible:e.enabled,enabled:{path:"currentSettings>value",formatter:function(e){if(!e||e===""){return false}return true}},press:function(e){t.setValue(undefined);var a=t.getAggregation("_field").getModel();var r=a.getProperty("/value");if(r&&r._dt&&r._dt._uuid){t.deleteTranslationValueInTexts(undefined,r._dt._uuid)}a.setProperty("/value",{});a.checkUpdate(true)}});var p={type:P,settings:{layout:"ResponsiveGridLayout",visible:e.visible,labelSpanXL:2,labelSpanL:2,labelSpanM:2,labelSpanS:12,emptySpanXL:1,emptySpanL:1,emptySpanM:1,emptySpanS:0,columnsXL:1,columnsL:1,columnsM:1,toolbar:new i({content:[new s,l,u]}).addStyleClass("sapMTB"),content:n}};return p};F.prototype.createTextAreaVisualization=function(e){var t=this;var r={type:a,settings:{value:{path:"currentSettings>value",formatter:function(e){if(!e||e===""){return undefined}e=JSON.stringify(e,null,"\t");if(typeof e==="object"&&!e.length){e=e.replace(/\"\$\$([a-zA-Z]*)\$\$\"/g,function(e){return e.substring(3,e.length-3)})}return e}},editable:"{config/editable}",width:"100%",enabled:"{config/enabled}",placeholder:"{config/placeholder}",visible:e.visible,change:this.onChangeOfTextArea.bind(t),rows:7}};return r};F.prototype.buildSelectionColumnLabels=function(){var e=this;var t=e.getConfiguration();var a=e.getResourceBundle();return new d(e.getParameterId()+"_control_table_column_selection_label_clearall_btn",{icon:"sap-icon://clear-all",type:"Transparent",enabled:typeof t.values==="undefined"?false:"{/_hasSelected}",tooltip:a.getText("EDITOR_FIELD_OBJECT_TABLE_COLUMN_SELECTION_TOOLTIP_REMOVE"),press:e.onUnSelectAll.bind(e)})};F.prototype.buildTableColumns=function(){var e=this;var o=e.getParameterId();var n=e.getConfiguration();var _=[];var c=Object.keys(n.properties);if(c.length>0){var g=e.getResourceBundle();var b=typeof n.values==="undefined"?false:true;if(b){b=typeof n.showSelectionColumn==="undefined"?true:n.showSelectionColumn}var h=e.buildSelectionColumnLabels();var S=new j(o+"_control_table_column_selection",{width:"3.2rem",hAlign:"Center",visible:b,multiLabels:[h],template:new T({selected:"{_dt/_selected}",enabled:typeof n.values==="undefined"?false:true,tooltip:{path:"_dt/_selected",formatter:function(e){if(e){if(n.type==="object"){return g.getText("EDITOR_FIELD_OBJECT_TABLE_COLUMN_SELECTION_CELL_TOOLTIP_UNSELECT")}else{return g.getText("EDITOR_FIELD_OBJECT_LIST_TABLE_COLUMN_SELECTION_CELL_TOOLTIP_REMOVE")}}else if(n.type==="object"){return g.getText("EDITOR_FIELD_OBJECT_TABLE_COLUMN_SELECTION_CELL_TOOLTIP_SELECT")}else{return g.getText("EDITOR_FIELD_OBJECT_LIST_TABLE_COLUMN_SELECTION_CELL_TOOLTIP_ADD")}}},select:e.onSelectionChange.bind(e)})});_.push(S);for(var L in n.properties){var C=o+"_control_table_column_property_"+L;var B=n.properties[L];var R=B.label||L;var M="{"+L+"}";if(B.defaultValue){e._newObjectTemplate[L]=B.defaultValue}var N={width:"7rem",label:R};if(B.column){N=m(N,B.column)}if(N.label.match(U)){N.label="{i18n>"+N.label.substring(2,N.label.length-1)}N.tooltip=N.label;N.label=new p({text:N.label});var F=B.cell&&B.cell.type?B.cell.type:B.type||"Text";var k;var J;var $=y(B.cell)||{};if(!$.values&&B.values){$.values=B.values}delete $.type;if(F==="string"&&$.values){F="ComboBox"}if(F==="Text"&&$.editable){F="Input"}F=F.toLowerCase();switch(F){case"int":case"number":J={text:M,wrapping:false};J=m(J,$);k=new t(J);break;case"string":case"text":J={text:M,wrapping:false};J=m(J,$);var H=J.text;var z=new u({translatable:B.translatable||false,property:L});if(typeof H==="string"){var K=e.getTranslationKey(H);if(K){J.text=g.getText(K)}else if(H.startsWith("{")&&H.endsWith("}")){J.text={path:H.substring(1,H.length-1),formatter:function(t){var a=this.getBindingContext(),r,o=this.getModel("settings").getData(),n=e.getTranslationKey(t);if(o.translatable||n){if(a&&a.getObject()&&a.getObject()._dt){r=e.getTranslationValueInTexts(I._language,a.getObject()._dt._uuid,o.property);if(r){return r}}if(n){t=g.getText(n);return t}}return t}}}}J.tooltip=$.tooltip||J.text;k=new t(J);k.setModel(z,"settings");break;case"icon":var W={src:M,visible:"{= $"+M+".indexOf('data:image/') === 0}",press:function(e){var t=e.getSource();if(!t._oImagePopover){t._oImagePopover=new l(t.getId()+"-imagePopover",{placement:"Right",showHeader:false}).addStyleClass("sapUiIntegrationImageSelect")}t._oImagePopover.destroyContent();t._oImagePopover.addContent(new A(t.getId()+"-imagePopover-image",{src:t.getSrc()}).addStyleClass("image"));t._oImagePopover.openBy(t)}};var G={src:M,visible:"{= $"+M+".indexOf('data:image/') === -1}"};W=m(W,A.getMetadata().removeUnknownSettings($));G=m(G,v.getMetadata().removeUnknownSettings($));k=new x({alignItems:"Center",justifyContent:"Center",items:[new A(W).addStyleClass("imageCell"),new v(G)]});break;case"boolean":J={selected:M,enabled:false};J=m(J,$);k=new T(J);break;case"switch":J={state:M,enabled:false};J=m(J,$);k=new f(J);break;case"link":J={text:M,target:"_blank",href:M};J=m(J,$);k=new O(J);break;case"combobox":var X=this.addModelPrefix($.values.item,"settings");J={width:"100%",selectedKey:M,editable:false,items:{path:"settings>"+$.values.data.path,template:new w(X),templateShareable:false}};if($.values.sorter){J.items.sorter=[new E({path:$.values.sorter})];delete $.values.sorter}J=m(J,$);var q=new u($.values.data.json);delete J.values;k=new D(J);k.setModel(q,"settings");break;case"input":J={value:M};if($.text){J.value=$.text}J.tooltip=$.tooltip||J.text;k=new r(J);break;case"object":J={value:{path:L,formatter:function(e){if(!e||e===""){return undefined}e=JSON.stringify(e,null,"\t");if(typeof e==="object"&&!e.length){e=e.replace(/\"\$\$([a-zA-Z]*)\$\$\"/g,function(e){return e.substring(3,e.length-3)})}return e}},editable:false};J=m(J,$);k=new x({items:[new r(J),new d({icon:"sap-icon://display",customData:[new V({key:"value",value:M})],press:function(t){var r=t.getSource();if(!e._oObjectPropertyDetailsPopover){var n=new a(o+"_control_objectproperty_details_popover_textarea",{editable:false,rows:9});var u=new d(o+"_control_objectproperty_details_popover_close_btn",{text:g.getText("EDITOR_FIELD_OBJECT_DETAILS_POPOVER_BUTTON_CLOSE"),press:function(){e._oObjectPropertyDetailsPopover.close()}});e._oObjectPropertyDetailsPopover=new l(o+"_control_objectproperty_details_popover",{placement:"Right",contentWidth:"200px",contentHeight:"240px",modal:true,title:g.getText("EDITOR_FIELD_OBJECT_PROPERTY_POPOVER_TITLE"),content:[new P({layout:"ResponsiveGridLayout",labelSpanXL:4,labelSpanL:4,labelSpanM:4,labelSpanS:12,emptySpanXL:1,emptySpanL:1,emptySpanM:1,emptySpanS:0,columnsXL:1,columnsL:1,columnsM:1,content:[n]})],footer:new i({content:[new s,u]})}).addStyleClass("sapUiIntegrationEditorItemObjectFieldDetailsPopover");e._oObjectPropertyDetailsPopover._oTextArea=n;e._oObjectPropertyDetailsPopover._oCloseButton=u}var p=r.getCustomData()[0];var _=p.getValue();if(_){_=JSON.stringify(_,null,"\t");if(typeof _==="object"&&!_.length){_=_.replace(/\"\$\$([a-zA-Z]*)\$\$\"/g,function(e){return e.substring(3,e.length-3)})}}e._oObjectPropertyDetailsPopover._oTextArea.setValue(_);e._oObjectPropertyDetailsPopover.openBy(r)}})]});break;default:k=new t({text:M,wrapping:false});break}N.template=k;var Z=new j(C,N);_.push(Z)}}return _};F.prototype.checkHasFilterDefined=function(e){var t=true;if(e._propertiesParsedFromValue===true){t=false}else{var a=JSON.stringify(e.properties,null,"\t");t=a.indexOf("filterProperty")>-1?true:false}return t};F.prototype.createTableToolbar=function(e){var t=this;var a=t.getParameterId();var r=t.getResourceBundle();var o=t.checkHasFilterDefined(e);var n=e.enabled!==false;var l=e.addButtonText||r.getText("EDITOR_FIELD_OBJECT_TABLE_BUTTON_ADD_TOOLTIP");if(n&&e.values){n=e.values.allowAdd===true}var u=[new s,new d(a+"_control_table_add_btn",{icon:"sap-icon://add",visible:n,tooltip:l,press:t.addNewObject.bind(t)}),new d(a+"_control_table_edit_btn",{icon:"{= ${/_hasNotEditableItemSelected} ===  true ? 'sap-icon://display' : 'sap-icon://edit' }",tooltip:{path:"/_hasNotEditableItemSelected",formatter:function(e){return e===true?r.getText("EDITOR_FIELD_OBJECT_TABLE_BUTTON_DISPLAY_TOOLTIP"):r.getText("EDITOR_FIELD_OBJECT_TABLE_BUTTON_EDIT_TOOLTIP")}},enabled:"{= !!${/_hasTableSelected}}",visible:t.getAllowPopover(),press:t.onEditOrViewDetail.bind(t)}),new d(a+"_control_table_delete_btn",{icon:"sap-icon://delete",tooltip:r.getText("EDITOR_FIELD_OBJECT_DELETE"),enabled:"{= !!${/_canDelete}}",press:t.onDelete.bind(t)}),new d(a+"_control_table_filter_btn",{icon:"sap-icon://clear-filter",visible:o,enabled:"{= !!${/_hasFilter}}",tooltip:r.getText("EDITOR_FIELD_OBJECT_TABLE_BUTTON_CLEAR_ALL_FILTERS_TOOLTIP"),press:t.clearAllFilters.bind(t)}),new d(a+"_control_table_multiselect_all_btn",{icon:"sap-icon://multiselect-all",visible:false,enabled:"{= !${/_hasTableAllSelected}}",tooltip:r.getText("EDITOR_FIELD_OBJECT_TABLE_BUTTON_SELECT_ALL_SELETIONS_TOOLTIP"),press:t.selectAllTableSelections.bind(t)}),new d(a+"_control_table_multiselect_none_btn",{icon:"sap-icon://multiselect-none",visible:false,enabled:"{= !!${/_hasTableSelected}}",tooltip:r.getText("EDITOR_FIELD_OBJECT_TABLE_BUTTON_CLEAR_ALL_SELETIONS_TOOLTIP"),press:t.clearAllTableSelections.bind(t)})];if(e.type==="object[]"){u=u.concat([new d(a+"_control_table_navigationup_btn",{icon:"sap-icon://navigation-up-arrow",enabled:"{= !!${/_hasOnlyOneRowSelected}}",tooltip:r.getText("EDITOR_FIELD_OBJECT_TABLE_BUTTON_MOVE_UP_TOOLTIP"),press:t.moveRowUp.bind(t)}),new d(a+"_control_table_navigationdown_btn",{icon:"sap-icon://navigation-down-arrow",enabled:"{= !!${/_hasOnlyOneRowSelected}}",tooltip:r.getText("EDITOR_FIELD_OBJECT_TABLE_BUTTON_MOVE_DOWN_TOOLTIP"),press:t.moveRowDown.bind(t)})])}return new i({content:u})};F.prototype.onUnSelectAll=function(e){var t=this;var a=t.getAggregation("_field");var r=a.getBindingContext().getPath();var o=a.getModel();var n=o.getProperty(r);n.forEach(function(e){e._dt=e._dt||{};e._dt._selected=false});o.setProperty("/_hasSelected",false);o.checkUpdate(true);t.setValue(undefined)};F.prototype.onEditOrViewDetail=function(e){var t=this;var a=t.getAggregation("_field");var r=a.getSelectedIndices()[0];var o=a.getBinding("rows").getContexts();var n=o[r].getObject();var l=a.getFirstVisibleRow();if(r<l){a.setFirstVisibleRow(r);l=r}else if(r>=l+5){a.setFirstVisibleRow(r-5+1);l=r-5+1}var i=a.getRows()[r-l];var s=i.getCells()[0];t.openObjectDetailsPopover(n,s,!n._dt||n._dt._editable!==false?"update":"view")};F.prototype.onFilter=function(e){var t=this;var a=t.getAggregation("_field");a.detachEvent("rowsUpdated",t.updateTable,t);a.attachEventOnce("rowsUpdated",t.updateTable,t)};F.prototype.updateTable=function(e){var t=this;t.updateSelectionColumn();t.updateToolbar();t.fireTableUpdated()};F.prototype.updateSelectionColumn=function(){var e=this;var t=e.getAggregation("_field");var a=t.getBinding("rows").getContexts();var r=false;for(var o=0;o<a.length;o++){var n=a[o].getObject();if(n._dt&&n._dt._selected){r=true;break}}t.getModel().setProperty("/_hasSelected",r)};F.prototype.updateToolbar=function(){var e=this;var t=e.getAggregation("_field");var a=t.getColumns();var r=false;for(var o=0;o<a.length;o++){if(a[o].getFiltered()){r=true;break}}t.getModel().setProperty("/_hasFilter",r)};F.prototype.columnFactory=function(e,a){var r=a.getPath();var o=r.substring(a.getPath().lastIndexOf("/")+1);var n=a.getProperty("$Type");var l=a.getProperty("$MaxLength");var i="7rem";l=l?parseInt(l):10;l=l<7?7:l;if(l>50){i="15rem"}else if(l>9){i="10rem"}return new j(e,{visible:true,filterProperty:n&&n.indexOf("String")>=0?o:null,width:i,label:new p({text:o}),hAlign:n&&n.indexOf("Decimal")>=0?"End":"Begin",template:new t({text:{path:o},wrapping:false})})};F.prototype.onTableSelectionChange=function(e){var t=this;var a=t.getAggregation("_field");var r=a.getModel();var o=a.getSelectedIndices();var n=a.getBinding("rows").getContexts();if(o.length>0){r.setProperty("/_hasTableSelected",true);if(o.length===1){r.setProperty("/_hasOnlyOneRowSelected",true)}else{r.setProperty("/_hasOnlyOneRowSelected",false)}var l=n[o[0]].getObject();if(l._dt&&l._dt._editable===false){r.setProperty("/_hasNotEditableItemSelected",true)}else{r.setProperty("/_hasNotEditableItemSelected",false)}}else{r.setProperty("/_hasTableSelected",false);r.setProperty("/_hasNotEditableItemSelected",false);r.setProperty("/_hasOnlyOneRowSelected",false);r.setProperty("/_canDelete",false);return}if(o.length===a.getBinding("rows").getContexts().length){r.setProperty("/_hasTableAllSelected",true)}else{r.setProperty("/_hasTableAllSelected",false)}var i=[];o.forEach(function(e){var t=n[e].getObject();if(t._dt&&t._dt._editable!==false){var a=n[e].getPath();i.push(a)}});if(i.length===0){r.setProperty("/_canDelete",false)}else{r.setProperty("/_canDelete",true)}};F.prototype.selectAllTableSelections=function(e){var t=this;var a=t.getAggregation("_field");a.selectAll();a.getModel().setProperty("/_hasTableAllSelected",true)};F.prototype.clearAllTableSelections=function(e){var t=this;var a=t.getAggregation("_field");var r=a.getModel();a.clearSelection();r.setProperty("/_hasTableSelected",false);r.setProperty("/_hasNotEditableItemSelected",false);r.setProperty("/_hasOnlyOneRowSelected",false);r.setProperty("/_canDelete",false);r.setProperty("/_hasTableAllSelected",false)};F.prototype.moveRowUp=function(e){this.moveSelectedRow("Up")};F.prototype.moveRowDown=function(e){this.moveSelectedRow("Down")};F.prototype.moveSelectedRow=function(e){var t=this;var a=t.getAggregation("_field");var r=a.getModel();var o=a.getSelectedIndices()[0];var n=a.getContextByIndex(o);var l=o+(e==="Up"?-1:1);var i=a.getContextByIndex(l);if(!i){return}var s=i.getProperty("_dt/_position");var d=n.getProperty("_dt/_position");r.setProperty("_dt/_position",s,n);r.setProperty("_dt/_position",d,i);r.refresh(true);a.setSelectedIndex(l);t.refreshValue();t.updateTable()};F.prototype.onSelectionChange=function(e){var t=this;var a=e.getSource();var r=e.getParameter("selected");var o=t.getAggregation("_field");var n=o.getBindingContext().getPath();var l=o.getModel();if(r){var i=l.getProperty(n);i.forEach(function(e){e._dt=e._dt||{};e._dt._selected=false});var s=a.getBindingContext().getObject();s._dt._selected=true;var d=y(s);l.setProperty("/_hasSelected",true);t.setValue(d)}else{l.setProperty("/_hasSelected",false);t.setValue(undefined)}};F.prototype.addNewObject=function(e){var t=this;var a=e.getSource();t._newObjectTemplate._dt._uuid=I.generateUuidV4();if(t.getAllowPopover()){t.openObjectDetailsPopover(t._newObjectTemplate,a,"add")}else{t.onAddDirectly(t._newObjectTemplate)}};F.prototype.mergeValueWithRequestResult=function(e){var t=this;var a=t.getConfiguration();var r=t.getAggregation("_field");var o=r.getModel();var n=r.getBinding("rows").getPath();if(a.value&&typeof a.value==="object"&&!g(a.value,{})){var l=y(a.value,500);if(Array.isArray(e)&&e.length>0){if(l._dt&&l._dt._editable===false){var i=l._dt._uuid||I.generateUuidV4();delete l._dt._uuid;e.forEach(function(e){if(g(e,l)){e._dt._selected=true;e._dt._uuid=i}else{e._dt._uuid=I.generateUuidV4()}})}else{e.forEach(function(e){e._dt._uuid=I.generateUuidV4()});l._dt=l._dt||{};l._dt._selected=true;l._dt._uuid=l._dt._uuid||I.generateUuidV4();e.unshift(l)}}else{l._dt=l._dt||{};l._dt._selected=true;l._dt._uuid=l._dt._uuid||I.generateUuidV4();e=[l]}o.setProperty("/_hasSelected",true);o.setProperty(n,e)}else{if(Array.isArray(e)&&e.length>0){e.forEach(function(e){e._dt._uuid=I.generateUuidV4()})}else{o.setProperty(n,{})}o.setProperty("/_hasSelected",false)}o.checkUpdate();t.updateTable()};F.prototype.onChangeOfTextArea=function(e){var t=this;var a=t.getResourceBundle();var r=e.getSource();var o=r.getValue();if(!o||o===""){t.saveValue(undefined,r)}else{try{var n=JSON.parse(o);if(n instanceof Array){r.setValueState("Error");r.setValueStateText(a.getText("EDITOR_VAL_NOT_A_SINGLE_JSONOBJECT"));return}t.saveValue(n,r)}catch(e){r.setValueState("Error");r.setValueStateText(a.getText("EDITOR_VAL_NOT_A_JSONOBJECT"))}}};F.prototype.onChangeOfTextAreaInPopover=function(e){var t=this;var a=t.getResourceBundle();var r=e.getSource();var o=r.getValue();if(!o||o===""){t.saveValue(undefined,r,true)}else{try{var n=JSON.parse(o);if(n instanceof Array){r.setValueState("Error");r.setValueStateText(a.getText("EDITOR_VAL_NOT_A_SINGLE_JSONOBJECT"));return}t.saveValue(n,r,true)}catch(e){r.setValueState("Error");r.setValueStateText(a.getText("EDITOR_VAL_NOT_A_JSONOBJECT"))}}};F.prototype.createFormContents=function(e,t,r,o){var n=this;var l=n.getConfiguration();var i=n.createPropertyContents(e,t,r,o);i.push(new p({visible:false}).addStyleClass("sapFormLabel"));var s=r?n.getParameterId()+"_control_objectdetails_popover_form_textarea":n.getParameterId()+"_control_form_textarea";i.push(new a(s,{value:{path:t,formatter:function(e){if(!e||e===""){return undefined}if(g(e,{})&&!r&&!n._getCurrentProperty("value")){return undefined}e=JSON.stringify(e,null,"\t");if(typeof e==="object"&&!e.length){e=e.replace(/\"\$\$([a-zA-Z]*)\$\$\"/g,function(e){return e.substring(3,e.length-3)})}return e}},editable:l.editable===false?false:"{= ${"+t+"_dt/_editable} !== false}",width:"100%",placeholder:"{config/placeholder}",visible:"{= ${/editMode} === 'Json'}",change:r===true?this.onChangeOfTextAreaInPopover.bind(n):this.onChangeOfTextArea.bind(n),rows:r===true?11:7}));return i};F.prototype.createPropertyContents=function(e,t,o,n){var l=this;var i=l.getParameterId();var s=o?i+"_control_objectdetails_popover_form_property_":i+"_control_form_property_";var d=l.getConfiguration();var _=[];if(!t){t="currentSettings>value/"}var c={};if(d.values&&d.values.metadata){var v=l.getModel("meta");var b="/"+d.values.metadata.namespace+"."+d.values.metadata.entityTypeName;var h=v.getProperty(b);for(var O in h){var P=h[O];var E=P["$Type"];if(P["$kind"]==="Property"&&E){if(E.indexOf("Int")>=0){c[O]={type:"int"}}else if(E.indexOf("Boolean")>=0){c[O]={type:"boolean"}}else if(E.indexOf("Decimal")>=0){c[O]={type:"number"}}else{c[O]={type:"string"}}}}}if(g(c,{})){c=d.properties}for(var I in c){var S=c[I];var x=S.label||I;if(x.match(U)){var V=x.substring(2,x.length-2);x="{i18n>"+V+"}"}var A=s+I+"_label";var R=s+I+"_control";var M=new p(A,{text:x,visible:"{= ${/editMode} === 'Properties'}",required:S.required||false}).addStyleClass("propertyLabel");_.push(M);var j;S.values=S.values||S.cell&&S.cell.values;if(S.type==="string"&&S.values){S.type="ComboBox"}var N=y(S,500);delete N.type;delete N.label;delete N.translatable;delete N.defaultValue;delete N.formatter;delete N.column;delete N.cell;delete N.values;var F;if(S.type){S.type=S.type.toLowerCase()}switch(S.type){case"boolean":if(S.cell&&S.cell.type==="Switch"){F={state:"{"+t+I+"}",visible:"{= ${/editMode} === 'Properties'}",enabled:d.editable===false?false:"{= ${"+t+"_dt/_editable} !== false}",change:e};if(S.cell.customTextOn){F.customTextOn=S.cell.customTextOn}if(S.cell.customTextOff){F.customTextOff=S.cell.customTextOff}F=m(F,N);j=new f(R,F)}else{F={selected:"{"+t+I+"}",visible:"{= ${/editMode} === 'Properties'}",enabled:d.editable===false?false:"{= ${"+t+"_dt/_editable} !== false}",select:e};F=m(F,N);j=new T(R,F)}break;case"int":case"integer":F={value:{path:t+I,type:new L(S.formatter)},visible:"{= ${/editMode} === 'Properties'}",editable:d.editable===false?false:"{= ${"+t+"_dt/_editable} !== false}",type:"Number",change:e};F=m(F,N);j=new r(R,F);break;case"number":F={value:{path:t+I,type:new C(S.formatter)},visible:"{= ${/editMode} === 'Properties'}",editable:d.editable===false?false:"{= ${"+t+"_dt/_editable} !== false}",type:"Number",change:e};F=m(F,N);j=new r(R,F);break;case"combobox":var k=this.addModelPrefix(S.values.item,"settings");F={width:"100%",selectedKey:"{"+t+I+"}",visible:"{= ${/editMode} === 'Properties'}",editable:d.editable===false?false:"{= ${"+t+"_dt/_editable} !== false}",items:{path:"settings>"+S.values.data.path,template:new w(k),templateShareable:false},change:e};F=m(F,N);j=new D(R,F);var J=new u(S.values.data.json);j.setModel(J,"settings");break;case"object":F={value:{path:t+I,formatter:function(e){if(!e||e===""){return undefined}e=JSON.stringify(e,null,"\t");if(typeof e==="object"&&!e.length){e=e.replace(/\"\$\$([a-zA-Z]*)\$\$\"/g,function(e){return e.substring(3,e.length-3)})}return e}},visible:"{= ${/editMode} === 'Properties'}",editable:d.editable===false?false:"{= ${"+t+"_dt/_editable} !== false}",change:function(t){var a=t.getSource();var r=t.getParameter("value");var o=a.getModel();if(!r||r===""){o.setProperty(a.getBindingPath("value"),undefined);o.checkUpdate(true);a.setValueState("None");a.setValueStateText("");e(t)}else{try{var n=JSON.parse(r);o.setProperty(a.getBindingPath("value"),n);o.checkUpdate(true);a.setValueState("None");a.setValueStateText("");e(t)}catch(e){var i=l.getResourceBundle();a.setValueState("Error");a.setValueStateText(i.getText("EDITOR_VAL_NOT_A_JSONOBJECT"))}}},rows:3};F=m(F,N);j=new a(R,F);break;case"icon":var $=new u({uuidPath:t+"_dt/_uuid",property:I});F={value:"{"+t+I+"}",allowNone:!S.required&&S.allowNone!==false,allowFile:S.allowFile!==false,visible:"{= ${/editMode} === 'Properties'}",editable:d.editable===false?false:"{= ${"+t+"_dt/_editable} !== false}",change:e};j=new B(R,F);j.setModel($,"settings");break;default:var H=new u({translatable:S.translatable||false,uuidPath:t+"_dt/_uuid",property:I});F={value:"{"+t+I+"}",visible:"{= ${/editMode} === 'Properties'}",editable:d.editable===false?false:"{= ${"+t+"_dt/_editable} !== false}",change:function(t){var a=t.getSource();var r=t.getParameter("value");if(r&&r.match(U)){var o=r.substring(2,r.length-2);r="{i18n>"+o+"}";a.setValue(r);a.fireChange()}else if(e){e(t)}}};F=m(F,N);if(n){F.valueHelpIconSrc="sap-icon://translate";F.valueHelpRequest=n.bind(l,I);if(S.translatable){F.showValueHelp=true}else{F.showValueHelp={path:t+I,formatter:function(e){var t=this.getModel("settings").getData();var a=this.getModel().getProperty(t.uuidPath);var r="translatable";if(l.getTranslationKey(e)){if(!this.getShowValueHelp()&&l.getObjectPropertyConfigValueInDesigntime(a,t.property,r)===false){l.setObjectPropertyConfigValueInDesigntime(a,t.property,r,true)}return true}if(this.getShowValueHelp()){l.deleteTranslationValueInTexts(undefined,a,t.property);l.setObjectPropertyConfigValueInDesigntime(a,t.property,r,false);l._oUpdatedTranslations={}}return false}}}}j=new r(R,F);j.setModel(H,"settings")}_.push(j)}return _};F.prototype.saveValue=function(e,t,a){var r=this;var o;if(!a){r.setValue(e);o=r.getAggregation("_field").getModel();if(o){e=y(e,500);o.setProperty("/value",e||{})}t.setValueState("None");t.setValueStateText("");if(r.getConfiguration()._propertiesParsedFromValue){r.refreshSimpleForm()}}else{o=t.getModel();o.setProperty("/value",e);t.setValueState("None");t.setValueStateText("")}};F.prototype.refreshSimpleForm=function(){var e=this;var t=e.getConfiguration();var a=e.getAggregation("_field");var r=a.removeAllContent();for(var o=0;o<r.length-2;o++){r[o].destroy()}r=r.slice(-2);delete t.properties;e.parseValueProperties();var n=function(){var t=a.getModel();t.checkUpdate(true);var r=t.getProperty("/value");r=y(r,500);e.setValue(r)};var l=e.createPropertyContents(n,"/value/");l=l.concat(r);l.forEach(function(e){a.addContent(e)})};F.prototype.getOriginTranslatedValues=function(e){var t=[];var a=this._oEditorResourceBundles.getResourceBundles();for(var r in a){var o=a[r];var n="";var l="";if(e&&o){var i=o.resourceBundle&&o.resourceBundle.getText(e);n=i;l=i}else{n="";l=""}var s={key:r,description:o.language,value:n,originValue:l,editable:true};t.push(s)}return t};F.prototype.buildPropertyTranslationValues=function(e){var t=[];var a=this._oEditorResourceBundles.getResourceBundles();for(var r in a){t.push({key:r,description:a[r].language,value:e,originValue:e,editable:true})}return t};F.prototype.openObjectDetailsPopover=function(e,t,a){var r=this;var p=r.getParameterId();var _=r.getResourceBundle();var c=y(e,500);var v;var f="Right";if(a==="add"){f=this.getPopoverPlacement(t)}if(!r._oObjectDetailsPopover){var T=new d(p+"_control_objectdetails_popover_add_btn",{text:_.getText("EDITOR_FIELD_OBJECT_DETAILS_POPOVER_BUTTON_ADD"),visible:a==="add",enabled:{path:"/value",formatter:function(e){if(typeof e!=="object"||g(e,{})){return false}else{var t=y(e);delete t._dt;if(g(t,{})){return false}}return true}},press:r.onAdd.bind(r)});var b=new d(p+"_control_objectdetails_popover_update_btn",{text:_.getText("EDITOR_FIELD_OBJECT_DETAILS_POPOVER_BUTTON_UPDATE"),visible:a==="update",enabled:{path:"/value",formatter:function(e){if(!e||e===""||g(e,{})){return false}return true}},press:r.onUpdate.bind(r)});var h=new d(p+"_control_objectdetails_popover_cancel_btn",{text:_.getText("EDITOR_FIELD_OBJECT_DETAILS_POPOVER_BUTTON_CANCEL"),visible:a!=="view",press:function(){if(a==="add"){var e=r._oObjectDetailsPopover.getModel().getProperty("/value");r.deleteTranslationValueInTexts(undefined,e._dt._uuid)}r._oObjectDetailsPopover.close()}});var O=new d(p+"_control_objectdetails_popover_close_btn",{text:_.getText("EDITOR_FIELD_OBJECT_DETAILS_POPOVER_BUTTON_CLOSE"),visible:a==="view",press:function(){r._oObjectDetailsPopover.close()}});var m=new d(p+"_control_objectdetails_popover_editmode_btn",{icon:{path:"/editMode",formatter:function(e){if(e==="Properties"){return"sap-icon://syntax"}else{return"sap-icon://form"}}},tooltip:{path:"/editMode",formatter:function(e){if(e==="Properties"){return _.getText("EDITOR_FIELD_OBJECT_FORM_EDITMODE_JSON")}else{return _.getText("EDITOR_FIELD_OBJECT_FORM_EDITMODE_PROPERTIES")}}},press:function(e){var t=e.getSource();var a=t.getModel();var r=a.getProperty("/editMode");if(r==="Properties"){a.setProperty("/editMode","Json")}else{a.setProperty("/editMode","Properties")}}});var E;r._oNavContainer=new o;r._oObjectDetailsPage=new n({title:_.getText("EDITOR_FIELD_OBJECT_DETAILS_POPOVER_TITLE"),headerContent:m,footer:new i({content:[new s,T,b,h,O]})});var I=function(e){r._oNavContainer.back();r._oObjectDetailsPage.focus()};var S=r.buildTranslationsList(p+"_control_objectdetails_popover_translation_page_value_list");var D=r.buildTranslationsFooter(S,false);r._oTranslationListPage=new n({title:_.getText("EDITOR_FIELD_OBJECT_TRANSLATION_LIST_TITLE",["{languages>/property}"]),showNavButton:true,navButtonPress:I,content:S,footer:D});var w=function(e){var t=r._oObjectDetailsPopover.getModel();t.checkUpdate(true);var a=t.getProperty("/value");if(a&&a!==""&&typeof a==="object"&&!g(a,{})){T.setEnabled(true)}else{T.setEnabled(false)}};var L=function(){};if(e._dt&&e._dt._editable===false){E=r.createFormContents(L,"/value/",true,r.navToTranslationListPage)}else{E=r.createFormContents(w,"/value/",true,r.navToTranslationListPage)}var C=new P({layout:"ResponsiveGridLayout",labelSpanXL:4,labelSpanL:4,labelSpanM:4,labelSpanS:12,emptySpanXL:1,emptySpanL:1,emptySpanM:1,emptySpanS:0,columnsXL:1,columnsL:1,columnsM:1,content:E});r._oObjectDetailsPage.addContent(C);r._oNavContainer.addPage(r._oObjectDetailsPage);r._oNavContainer.addPage(r._oTranslationListPage);r._oObjectDetailsPopover=new l(p+"_control_objectdetails_popover",{placement:f,showHeader:false,contentWidth:"300px",contentHeight:"345px",modal:true,content:r._oNavContainer}).addStyleClass("sapUiIntegrationEditorItemObjectFieldDetailsPopover");v=new u({value:c,editMode:"Properties"});r._oObjectDetailsPopover.setModel(v);r._oObjectDetailsPopover.setModel(r.getModel("i18n"),"i18n");r._oObjectDetailsPopover._oAddButton=T;r._oObjectDetailsPopover._oUpdateButton=b;r._oObjectDetailsPopover._oCancelButton=h;r._oObjectDetailsPopover._oCloseButton=O;r._oObjectDetailsPopover._openBy=t}else{v=r._oObjectDetailsPopover.getModel();v.setProperty("/value",c);v.checkUpdate(true);if(a==="add"){r._oObjectDetailsPopover._oAddButton.setVisible(true);r._oObjectDetailsPopover._oUpdateButton.setVisible(false);r._oObjectDetailsPopover._oCancelButton.setVisible(true);r._oObjectDetailsPopover._oCloseButton.setVisible(false)}else if(a==="update"){r._oObjectDetailsPopover._oAddButton.setVisible(false);r._oObjectDetailsPopover._oUpdateButton.setVisible(true);r._oObjectDetailsPopover._oCancelButton.setVisible(true);r._oObjectDetailsPopover._oCloseButton.setVisible(false)}else{r._oObjectDetailsPopover._oAddButton.setVisible(false);r._oObjectDetailsPopover._oUpdateButton.setVisible(false);r._oObjectDetailsPopover._oCancelButton.setVisible(false);r._oObjectDetailsPopover._oCloseButton.setVisible(true)}r._oObjectDetailsPopover._openBy=t;r._oObjectDetailsPopover.setPlacement(f);r._oNavContainer.back()}r._oObjectDetailsPopover.openBy(t)};F.prototype.buildTranslationsData=function(e,t,a,r){var o=this;var n=o.getResourceBundle();o._oOriginTranslatedValues=o._oOriginTranslatedValues||{};o._oUpdatedTranslations=o._oUpdatedTranslations||{};var l=a+"_"+r;var i=e;if(t==="key"){if(!o._oOriginTranslatedValues[e]){o._oOriginTranslatedValues[e]=o.getOriginTranslatedValues(e)}}else if(t==="property"){i=l;o._oOriginTranslatedValues[i]=o.buildPropertyTranslationValues(e)}var s=[];o._oOriginTranslatedValues[i].forEach(function(e){var t=y(e,500);t.updated=false;var l=o.getTranslationValueInTexts(t.key,a,r);if(l){t.value=l;if(Array.isArray(o._oUpdatedTranslations[i])){if(o._oUpdatedTranslations[i].includes(t.key)){t.value=o.getTranslationValueInTexts(t.key,a,r);t.updated=true}else{t.originValue=t.value}}}if(t.key===I._language){t.description+=" ("+n.getText("EDITOR_FIELD_TRANSLATION_LIST_POPOVER_CURRENTLANGUAGE")+")";s.unshift(t)}else{s.push(t)}});var d={isUpdated:false,key:e,translationKey:i,translationType:t,uuid:a,property:r,translatedLanguages:s};return d};F.prototype.getTranslationKey=function(e){var t;if(e&&e.match(U)){t=e.substring(2,e.length-2)}else if(e&&e.startsWith("{i18n>")&&e.endsWith("}")){t=e.substring(6,e.length-1)}return t};F.prototype.buildTranslationsFooter=function(e,t){var a=this;var r=a.getParameterId();var o=a.getResourceBundle();var n=t?r+"_control_translation_popover":r+"_control_objectdetails_popover_translation_page";var l=new d(n+"_save_btn",{type:"Emphasized",text:o.getText("EDITOR_FIELD_TRANSLATION_LIST_POPOVER_BUTTON_SAVE"),enabled:"{languages>/isUpdated}",press:function(){var r=e.getModel("languages");var o=r.getData();var n=[];var l=o.key;var i=o.translationKey;var s=o.translationType;var d=o.uuid;var u=o.property;o.translatedLanguages.forEach(function(e){if(e.value!==e.originValue){if(e.updated){a.setTranslationValueInTexts(e.key,d,u,e.value);n.push(e.key)}}else if(e.updated){a.deleteTranslationValueInTexts(e.key,d,u)}});var p=false;if(n.length>0){a._oUpdatedTranslations=a._oUpdatedTranslations||{};a._oUpdatedTranslations[i]=n;if(n.includes(I._language)){p=true}}else if(a._oUpdatedTranslations){delete a._oUpdatedTranslations[i]}o=a.buildTranslationsData(l,s,d,u);r.setData(o);r.checkUpdate(true);if(a.getModel()){a.getModel().checkUpdate(true)}if(p&&a._oValueBinding){a._oValueBinding.fireEvent("change")}if(t){a._oTranslationPopover.close()}}});var u=new d(n+"_reset_btn",{text:o.getText("EDITOR_FIELD_OBJECT_DETAILS_POPOVER_BUTTON_RESET"),enabled:"{languages>/isUpdated}",press:function(t){var a=e.getModel("languages");var r=a.getData();r.translatedLanguages.forEach(function(e){e.value=e.originValue;e.updated=false});r.isUpdated=false;a.setData(r);a.checkUpdate(true)}});var p=new d(n+"_cancel_btn",{text:o.getText("EDITOR_FIELD_TRANSLATION_LIST_POPOVER_BUTTON_CANCEL"),visible:t,press:function(){a._oTranslationPopover.close()}});return new i({content:[new s,l,u,p]})};F.prototype.openTranslationListPopup=function(e,t){var a=this;if(!a._oEditorResourceBundles.isReady()){a._oEditorResourceBundles.attachEventOnce("ready",function(){a.openTranslationListPopup(e,t)});return}var r=t.getSource();var o=a.getResourceBundle();var n=r.getModel().getProperty("/value");if(!n._dt){n._dt={_uuid:I.generateUuidV4()}}else if(!n._dt._uuid){n._dt._uuid=I.generateUuidV4()}var i=r.getValue();var s=a.getTranslationKey(i);var d="property";if(s&&s!==""){d="key"}else{s=i}var u=a.buildTranslationsData(s,d,n._dt._uuid,e);var p;var _=this.getPopoverPlacement(r._oValueHelpIcon);if(!a._oTranslationPopover){var c=a.getParameterId();var g=a.buildTranslationsList(c+"_control_translation_popover_value_list");var v=a.buildTranslationsFooter(g,true);a._oTranslationPopover=new l(c+"_control_translation_popover",{placement:_,contentWidth:"300px",contentHeight:"345px",title:o.getText("EDITOR_FIELD_OBJECT_TRANSLATION_LIST_TITLE",["{languages>/property}"]),content:g,afterOpen:function(){a.fireTranslationPopoverOpened()},footer:v}).addStyleClass("sapUiIntegrationFieldTranslation");p=a.buildTranslationsModel(u);a._oTranslationPopover.setModel(p,"languages")}else{a._oTranslationPopover.setPlacement(_);p=a._oTranslationPopover.getModel("languages");p.setData(u);p.checkUpdate(true)}a._oTranslationPopover.openBy(r._oValueHelpIcon)};F.prototype.navToTranslationListPage=function(e,t){var a=this;if(!a._oEditorResourceBundles.isReady()){a._oEditorResourceBundles.attachEventOnce("ready",function(){a.navToTranslationListPage(t)});return}var r=a._oObjectDetailsPopover.getModel().getProperty("/value");var o=r[e];var n=a.getTranslationKey(o);var l="property";if(n&&n!==""){l="key"}else{n=o}var i=a.buildTranslationsData(n,l,r._dt._uuid,e);var s=a._oTranslationListPage.getModel("languages");if(!s){s=a.buildTranslationsModel(i);a._oTranslationListPage.setModel(s,"languages")}else{s.setData(i)}a._oNavContainer.to(a._oTranslationListPage);a._oTranslationListPage.focus()};F.prototype.onAdd=function(e){var t=this;var a=t.getAggregation("_field");var r=a.getModel();var o=t._oObjectDetailsPopover.getModel().getProperty("/value");var n=a.getBinding("rows").getPath();var l=r.getProperty(n);l.forEach(function(e){if(e._dt._selected){e._dt._selected=false}});l.push(o);r.setProperty("/_hasSelected",true);r.setProperty("/_hasTableAllSelected",false);r.setProperty("/_hasTableSelected",false);r.setProperty("/_hasNotEditableItemSelected",false);r.setProperty("/_hasOnlyOneRowSelected",false);r.checkUpdate();t.refreshValue();t.updateTable();t._oObjectDetailsPopover.close()};F.prototype.onAddDirectly=function(e){var t=this;var a=y(e,500);var r=t.getAggregation("_field");var o=r.getModel();var n=r.getBinding("rows").getPath();var l=o.getProperty(n);var i=1;l.unshift(a);l.forEach(function(e){e._dt=e._dt||{};e._dt._selected=false;e._dt._position=i;i++});o.checkUpdate();t.refreshValue();t.updateTable()};F.prototype.onUpdate=function(e){var t=this;var a=t.getAggregation("_field");var r=t._oObjectDetailsPopover.getModel().getProperty("/value");var o=a.getModel();var n=t._oObjectDetailsPopover._openBy.getParent();var l=n.getIndex();var i=a.getBinding("rows").getContexts();var s=i[l].getPath();o.setProperty(s,y(r,500));o.checkUpdate();if(r._dt&&r._dt._selected){t.refreshValue()}t.updateTable();t._oObjectDetailsPopover.close()};F.prototype.onDelete=function(e){var t=this;var a=t.getAggregation("_field");var r=t.getResourceBundle();var o=a.getSelectedIndices();var n=[];var l=a.getBinding("rows").getContexts();o.forEach(function(e){var t=l[e].getObject();if(t._dt&&t._dt._editable!==false){var a=l[e].getPath();var r=a.substring(a.lastIndexOf("/")+1);n.push(r)}});if(n.length===0){b.error(r.getText("EDITOR_FIELD_OBJECT_DELETE_ERROR_MSG"));return}if(t.getAllowPopover()){b.confirm(r.getText("EDITOR_FIELD_OBJECT_DELETE_CONFIRM_MSG"),{title:r.getText("EDITOR_FIELD_OBJECT_DELETE_CONFIRM_TITLE"),onClose:function(e){if(e===b.Action.OK){var o=a.getBindingContext().getPath();var l=a.getModel();var i=l.getProperty(o);var s=[];for(var d=0;d<i.length;d++){if(n.includes(d+"")){t.deleteTranslationValueInTexts(undefined,i[d]._dt._uuid)}else{s.push(i[d])}}l.setProperty(o,s);l.checkUpdate(true);t.refreshValue();t.updateTable()}else{h.show(r.getText("EDITOR_FIELD_OBJECT_DELETE_CONFIRM_CANCLE"))}}})}else{var i=a.getBinding("rows").getPath();var s=a.getModel();var d=s.getProperty(i);var u=[];for(var p=0;p<d.length;p++){if(n.includes(p+"")){t.deleteTranslationValueInTexts(undefined,d[p]._dt._uuid)}else{u.push(d[p])}}s.setProperty(i,u);s.checkUpdate(true);t.refreshValue();t.updateTable()}};F.prototype.refreshValue=function(){var e=this;var t=e.getAggregation("_field");var a=t.getModel();var r=t.getBinding("rows").getPath();var o=a.getProperty(r);var n;for(var l=0;l<o.length;l++){var i=o[l];if(i._dt._selected){n=y(i);break}}e.setValue(n)};F.prototype.resetControl=function(){var e=this;var t=e.getAggregation("_field");var a=e._getCurrentProperty("value");var r=t.getModel();if(t instanceof P){var o=r.getProperty("/value");if(o&&o._dt&&o._dt._uuid){e.deleteTranslationValueInTexts(undefined,o._dt._uuid)}a=a||{};r.setProperty("/value",a);r.checkUpdate(true)}else if(t instanceof M){var n=e.getConfiguration();var l;if(n.values){var i=t.getBinding("rows").getPath();l=r.getProperty(i);l.forEach(function(e){delete e._dt._selected})}e.mergeValueWithRequestResult(l)}};F.prototype.clearAllFilters=function(e){var t=this;var a=t.getAggregation("_field");var r=a.getColumns();for(var o=0;o<r.length;o++){var n=r[o];if(o<r.length-1){n._applySelection=false}a.filter(n,undefined)}};F.prototype.setValue=function(e){var t=this;t.cleanDT(e);t._setCurrentProperty("value",e)};F.prototype.cleanDT=function(e){if(e&&e._dt&&e._dt._selected){delete e._dt._selected}if(e&&e._dt&&g(e._dt,{})){delete e._dt}};F.prototype.getTranslationValueInTexts=function(e,t,a){var r=this;var o=r.getConfiguration();var n="/texts/"+e;var l=this._settingsModel.getProperty(n)||{};var i=l[o.manifestpath];var s;if(i&&i[t]){s=i[t][a]}return s};F.prototype.setObjectPropertyConfigValueInDesigntime=function(e,t,a,r){var o=this;var n=o.getConfiguration();var l="/:designtime";var i=this._settingsModel.getData();if(!i){return}var s;if(!i.hasOwnProperty(":designtime")){s={}}else{s=y(i[":designtime"],500)}if(!s.hasOwnProperty(n.manifestpath)){s[n.manifestpath]={}}if(!s[n.manifestpath].hasOwnProperty(e)){s[n.manifestpath][e]={}}if(!s[n.manifestpath][e].hasOwnProperty(t)){s[n.manifestpath][e][t]={}}s[n.manifestpath][e][t][a]=r;this._settingsModel.setProperty(l,s)};F.prototype.getObjectPropertyConfigValueInDesigntime=function(e,t,a){var r=this;var o;var n=r.getConfiguration();var l=this._settingsModel.getData();if(l&&l[":designtime"]&&l[":designtime"][n.manifestpath]&&l[":designtime"][n.manifestpath][e]&&l[":designtime"][n.manifestpath][e][t]&&l[":designtime"][n.manifestpath][e][t].hasOwnProperty(a)){o=l[":designtime"][n.manifestpath][e][t][a]}return o};F.prototype.setTranslationValueInTexts=function(e,t,a,r){var o=this;var n=o.getConfiguration();var l="/texts";var i=this._settingsModel.getData();if(!i){return}var s;if(!i.hasOwnProperty("texts")){s={}}else{s=y(i.texts,500)}if(!s.hasOwnProperty(e)){s[e]={}}if(!s[e].hasOwnProperty(n.manifestpath)){s[e][n.manifestpath]={}}if(!s[e][n.manifestpath].hasOwnProperty(t)){s[e][n.manifestpath][t]={}}s[e][n.manifestpath][t][a]=r;this._settingsModel.setProperty(l,s)};F.prototype.deleteTranslationValueInTexts=function(e,t,a){var r=this;var o=r._settingsModel.getData();if(!o||!o.texts||!t){return}var n=r.getConfiguration();var l="/texts";var i=y(o.texts,500);if(e){if(i[e]&&i[e][n.manifestpath]&&i[e][n.manifestpath][t]){if(a){if(i[e][n.manifestpath][t].hasOwnProperty(a)){delete i[e][n.manifestpath][t][a];if(g(i[e][n.manifestpath][t],{})){delete i[e][n.manifestpath][t]}this._settingsModel.setProperty(l,i)}}else{delete i[e][n.manifestpath][t];if(g(i[e][n.manifestpath],{})){delete i[e][n.manifestpath];if(g(i[e],{})){delete i[e]}}this._settingsModel.setProperty(l,i)}}}else{for(var s in i){r.deleteTranslationValueInTexts(s,t,a)}}};return F});
//# sourceMappingURL=ObjectField.js.map