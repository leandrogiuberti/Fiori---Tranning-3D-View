/*!
 * OpenUI5
 * (c) Copyright 2025 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["sap/base/util/merge","sap/ui/model/json/JSONModel","sap/base/util/deepClone","sap/ui/integration/util/Utils"],function(e,t,a,r){"use strict";var n={layers:{admin:0,content:5,translation:10,all:20},mergeManifestPathChanges:function(e,t){Object.keys(t).forEach(function(a){if(a.match(/^\/sap.card\/configuration\/childCards\/.+\/_manifestChanges$/)){return}if(a.charAt(0)==="/"){var r=t[a];n.updateManifestProperty(e,a,r)}})},updateManifestProperty:function(e,t,a){var r=e.setProperty(t,a);if(!r){var i=t.lastIndexOf("/");var s=t.substring(0,i||1);var f=t.substring(i+1);var o={};o[f]=a;n.updateManifestProperty(e,s,o)}},mergeTextsChanges:function(e,t,a){var i=r._language;if(t&&t.hasOwnProperty(i)){var s=t[i];for(var f in s){var o=s[f];if(typeof o==="object"){n.translateObject(e,f,o,a)}else{var c=e.getProperty(f);var u=true;if(c&&typeof c==="string"&&(c.indexOf("{context>")===0||c.indexOf("{{parameters")===0)){u=false}if(u){e.setProperty(f,o)}}}}},mergeCardDelta:function(a,i,s){var f=e({},a);if(typeof s==="undefined"){s="sap.card"}if(Array.isArray(i)&&i.length>0){var o,c,u;r.mapLanguagesInManifestChanges(i);i.forEach(function(a){if(a.content){e(f[s],a.content)}else{var i=a.hasOwnProperty(":layer")?a[":layer"]:1e3;if(i===n.layers["translation"]){var l=r._language;var p={texts:{}};p.texts[l]={};delete a.texts;Object.keys(a).forEach(function(e){if(e.charAt(0)==="/"){p.texts[l][e]=a[e]}else{p[e]=a[e]}});a=p}c=e(c,a.texts);u=e(u,a[":designtime"]);o=o||new t(f);n.mergeManifestPathChanges(o,a)}});n.mergeTextsChanges(o,c,u)}return f},mergeCardDesigntimeMetadata:function(t,a){var r=e({},t);a.forEach(function(e){var t=e.content.entityPropertyChange||[];t.forEach(function(e){var t=e.propertyPath;switch(e.operation){case"UPDATE":if(r.hasOwnProperty(t)){r[t]=e.propertyValue}break;case"DELETE":delete r[t];break;case"INSERT":if(!r.hasOwnProperty(t)){r[t]=e.propertyValue}break;default:break}})});return r},translateObject:function(t,r,n,i){var s=t.getProperty(r);if(!s||typeof s!=="object"){return}s=a(s,500);if(!Array.isArray(s)){var f=(s._dt||{})._uuid;if(f&&n[f]){if(i&&i[r]&&i[r][f]){for(var o in i[r][f]){if(i[r][f][o].translatable===false){delete n[f][o]}}}e(s,n[f]);t.setProperty(r,s)}}else{s.forEach(function(t){var a=(t._dt||{})._uuid;if(a&&n[a]){if(i&&i[r]&&i[r][a]){for(var s in i[r][a]){if(i[r][a][s].translatable===false){delete n[a][s]}}}e(t,n[a])}});t.setProperty(r,s);return}},extractChildCardChanges:function(e,t){return e.map(e=>{const a=`/sap.card/configuration/childCards/${t}/_manifestChanges`;return e[a]}).filter(e=>e&&Object.keys(e).length>0)}};return n});
//# sourceMappingURL=CardMerger.js.map