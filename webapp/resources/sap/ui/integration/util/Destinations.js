/*!
 * OpenUI5
 * (c) Copyright 2025 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["sap/ui/base/Object","sap/base/Log","sap/base/util/isPlainObject","sap/ui/integration/util/Utils"],function(t,i,n,e){"use strict";const s=/\{\{destinations.([^\}]+)/;const r=/\{\{mainDestinations.([^\}]+)/;const o={DESTINATIONS:"/sap.card/configuration/destinations"};function a(t,i){return e.find(t,t=>typeof t==="string"&&t.match(i))}var c=t.extend("sap.ui.integration.util.Destinations",{metadata:{library:"sap.ui.integration"},constructor:function(i){t.call(this);this._oHost=i.host;this._oCard=i.card;this._oResolverCard=i.resolverCard;this._oConfiguration=i.manifestConfig;this._mResolved=new Map;this._sPrefix=i.prefix}});c.create=function(t){const i=t.card;const n=t.mainCard;const e=t.isPaginationCard;if(!e){c._validateConfiguration(i,n)}let s=i;let r="destinations";const a=n!==i;const u=i.getManifestEntry("/sap.card/configuration/useMainDestinations")===true;if(a&&u){s=n;r="mainDestinations"}return new c({host:i.getHostInstance(),card:i,resolverCard:s,manifestConfig:s.getManifestEntry(o.DESTINATIONS),prefix:r})};c._validateConfiguration=function(t,n){const e=n!==t;const r=t.getManifestEntry("/sap.card/configuration/useMainDestinations")===true;const c=t.getManifestEntry(o.DESTINATIONS)!==undefined;if(r&&!e){throw new Error("Unsupported configuration: 'sap.card/configuration/useMainDestinations' is for child cards only. ")}if(e&&r){if(c){throw new Error("Unsupported configuration: 'sap.card/configuration/useMainDestinations' is set to true, yet 'sap.card/configuration/destinations' is also defined in the card manifest."+"Remove 'sap.card/configuration/destinations' from the card manifest and refer exclusively to the main card destinations.\n")}const n=a(t.getManifestEntry("/sap.card"),s);if(n){i.error(`Unsupported syntax: ${n}. {{destinations.<destination>}} cannot be used in child card that has 'sap.card/configuration/useMainDestinations' set to true. Use {{mainDestinations.<destination>}} instead.`)}}if(e&&!r&&c){i.error("The configuration 'sap.card/configuration/destinations' for child cards is deprecated since 1.140. "+"Use the property 'sap.card/configuration/useMainDestinations' instead and refer to the main card destinations.","sap.ui.integration.widgets.Card")}};c.prototype.setHost=function(t){this._oHost=t;this._mResolved.clear()};c.prototype.process=function(t){var n=[];this._processObject(t,undefined,n);return Promise.all(n).then(function(){return t}).catch(function(n){i.error(n,"sap.ui.integration.util.Destinations");return t})};c.prototype._processObject=function(t,e,s){if(!t){return Promise.resolve(t)}var r=t.hasOwnProperty(e)?t[e]:t;if(typeof r==="string"){s.push(this.processString(r).then(function(i){if(e!==undefined){t[e]=i}}).catch(function(n){i.error(n,"sap.ui.integration.util.Destinations");if(e!==undefined){t[e]=""}}))}if(n(r)){Object.keys(r).forEach(function(t){this._processObject(r,t,s)}.bind(this))}if(Array.isArray(r)){r.forEach(function(t,i){this._processObject(r,i,s)}.bind(this))}};c.prototype.getUrl=function(t){var i;if(this._mResolved.has(t)){return this._mResolved.get(t)}i=this._resolveUrl(t);this._mResolved.set(t,i);return i};c.prototype._resolveUrl=function(t){var n=this._oConfiguration?this._oConfiguration[t]:null,s,r,o;if(!n){return Promise.reject("Configuration for destination '"+t+"' was not found in the manifest.")}s=n.name;r=n.defaultUrl;if(!s&&!r){return Promise.reject("Can not resolve destination '"+t+"'. Neither 'name' nor 'defaultUrl' is configured.")}if(!s&&r){return Promise.resolve(r)}if(!this._oHost&&!r){return Promise.reject("Can not resolve destination '"+t+"'. There is no 'host' and no defaultUrl specified.")}if(!this._oHost&&r){return Promise.resolve(r)}o=e.timeoutPromise(this._oHost.getDestination(s,this._oResolverCard));if(r){return o.catch(function(t){i.info(t+" Fallback to default url.","sap.ui.integration.util.Destinations");return r})}return o};c.prototype.processString=function(t){const i=this._sPrefix==="destinations"?t.match(s):t.match(r);if(!i){return Promise.resolve(t)}const n=i[1];return this.getUrl(n).then(function(i){return this._replaceUrl(t,n,i)}.bind(this))};c.prototype._replaceUrl=function(t,i,n){const e=n.trim().replace(/\/$/,"");if(this._sPrefix==="destinations"){return t.replace("{{destinations."+i+"}}",e)}return t.replace("{{mainDestinations."+i+"}}",e)};return c});
//# sourceMappingURL=Destinations.js.map