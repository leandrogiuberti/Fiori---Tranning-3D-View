/*!
 * OpenUI5
 * (c) Copyright 2025 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["sap/base/util/restricted/_omit","sap/m/MessageBox","sap/ui/core/Fragment","sap/ui/core/Lib","sap/ui/dt/DOMUtil","sap/ui/dt/ElementUtil","sap/ui/dt/MetadataPropagationUtil","sap/ui/dt/OverlayUtil","sap/ui/fl/apply/api/FlexRuntimeInfoAPI","sap/ui/fl/initial/api/Version","sap/ui/fl/Layer","sap/ui/fl/LayerUtils","sap/ui/fl/Utils","sap/ui/model/json/JSONModel","sap/ui/rta/util/BindingsExtractor","sap/ui/rta/util/hasStableId"],function(e,t,r,n,i,a,s,l,o,u,c,g,f,v,d,y){"use strict";var m={};m.RESOLVED_PROMISE=Promise.resolve(true);m._sFocusableOverlayClass=".sapUiDtOverlaySelectable";m._sRtaStyleClassName="";m.getRtaStyleClassName=function(){return m._sRtaStyleClassName};m.setRtaStyleClassName=function(e){if(e===c.USER){m._sRtaStyleClassName=""}else if(g.getLayerIndex(e)>-1){m._sRtaStyleClassName="sapUiRTABorder"}};m.openRemoveConfirmationDialog=function(e,t){var i=n.getResourceBundleFor("sap.ui.rta");var a;return new Promise(function(e){a=i.getText("CTX_REMOVE_TITLE");var n={messageText:t,titleText:a,icon:"sap-icon://question-mark",removeText:i.getText("BTN_FREP_REMOVE"),cancelText:i.getText("BTN_FREP_CANCEL")};var s=new v;s.setData(n);var l;var o=function(){if(l){l.close();l.destroy();l=null}};var u={removeField(){o();e(true)},closeDialog(){o();e(false)}};if(!l){r.load({name:"sap.ui.rta.view.RemoveElementDialog",controller:u}).then(function(e){l=e;l.setModel(s);l.addStyleClass(m.getRtaStyleClassName());l.open()})}else{l.addStyleClass(m.getRtaStyleClassName());l.open()}})};m.isOverlaySelectable=function(e){return e.isSelectable()&&i.isVisible(e.getDomRef())};m.getFocusableParentOverlay=function(e){if(!e){return undefined}var t=e.getParentElementOverlay();while(t&&!t.getSelectable()){t=t.getParentElementOverlay()}return t};m.getFirstFocusableDescendantOverlay=function(e){return l.getFirstDescendantByCondition(e,this.isOverlaySelectable)};m.getLastFocusableDescendantOverlay=function(e){return l.getLastDescendantByCondition(e,this.isOverlaySelectable)};m.getNextFocusableSiblingOverlay=function(e){var t=true;var r=l.getNextSiblingOverlay(e);while(r&&!this.isOverlaySelectable(r)){r=l.getNextSiblingOverlay(r)}r||=this._findSiblingOverlay(e,t);return r};m.getPreviousFocusableSiblingOverlay=function(e){var t=false;var r=l.getPreviousSiblingOverlay(e);while(r&&!this.isOverlaySelectable(r)){r=l.getPreviousSiblingOverlay(r)}r||=this._findSiblingOverlay(e,t);return r};m._findSiblingOverlay=function(e,t){var r=e.getParentElementOverlay();if(r){var n=t?l.getNextSiblingOverlay(r):l.getPreviousSiblingOverlay(r);if(!n){return this._findSiblingOverlay(r,t)}var i=t?this.getFirstFocusableDescendantOverlay(n):this.getLastFocusableDescendantOverlay(n);return i}return undefined};m.getIndex=function(e,t,r,n){var i;if(n&&typeof n==="function"){i=n(e,t)}else{var a=e.getMetadata();var s=a.getAggregation(r);var l=s._sGetter;var o=e[l]();if(Array.isArray(o)&&t){i=o.indexOf(t)+1}else{i=0}}return i};m.isOriginalFioriToolbarAccessible=function(){var e=m.getFiori2Renderer();return e&&e.getRootControl&&e.getRootControl().getShellHeader()};m.getFiori2Renderer=function(){var e=f.getUshellContainer()||{};return typeof e.getRenderer==="function"?e.getRenderer("fiori2"):undefined};m.extendWith=function(e,t,r){if(!(typeof r==="function")){throw new Error("In order to use extendWith() utility function fnCustomizer should be provided!")}for(var n in t){if(t.hasOwnProperty(n)){if(r(e[n],t[n],n,e,t)){e[n]=t[n]}}}};m.showMessageBox=function(r,i,a){var s=n.getResourceBundleFor("sap.ui.rta");a||={};var l=s.getText(i,a.error?[a.error.userMessage||a.error.message||a.error]:undefined);var o=a.titleKey&&s.getText(a.titleKey);var u=a.actionKeys&&a.actionKeys.map(function(e){return s.getText(e)});var c=a.emphasizedActionKey?s.getText(a.emphasizedActionKey):undefined;var g=a.showCancel;var f=e(a,["titleKey","error","actionKeys","emphasizedAction","emphasizedActionKey","showCancel"]);f.title=o;f.styleClass=m.getRtaStyleClassName();f.actions||=u;f.emphasizedAction=c||a.emphasizedAction;if(g){f.actions.push(t.Action.CANCEL)}return h(r,l,f)};function h(e,r,n){return new Promise(function(i){n.onClose=i;t[e](r,n)})}m.checkSourceTargetBindingCompatibility=function(e,t,r){r||=e.getModel();var n=d.collectBindingPaths(e,r);var i;var a;if(n.bindingPaths.length===0){return true}i=d.getBindingContextPath(e);a=d.getBindingContextPath(t);if(i===a){return true}return false};m.doIfAllControlsAreAvailable=function(e,t){if(e.every(function(e){return e&&!e._bIsBeingDestroyed})){return t()}return undefined};m.isS4HanaCloud=function(){return o.isAtoEnabled()&&o.getSystem()};m.checkTargetZone=function(e,t,r,n){function i(e,t,r,n){var i=e.getDesignTimeMetadata();var a=i.getAction("move",t);if(!a){return Promise.resolve(false)}return n.hasChangeHandler(a.changeType,r)}return a.checkTargetZone(e,t,n).then(function(n){if(!n){return false}var a=t.getElement();var l=e.getParent();var o=t.getRelevantContainer();if(!a||!l){return false}var u=l.getElement();var c=e.getDesignTimeMetadata();var g=s.getRelevantContainerForPropagation(c.getData(),a);g||=u;if(!o||!g||!y(l)||o!==g){return false}if(t.getParent().getElement()!==u&&!m.checkSourceTargetBindingCompatibility(a,u)){return false}return i(e,a,g,r)})};m.checkDraftOverwrite=function(e,r){var n=e.getProperty("/backendDraft");var i=e.getProperty("/displayedVersion")===u.Number.Draft;if(i||!n||r){return Promise.resolve(false)}return m.showMessageBox("warning","MSG_DRAFT_DISCARD_AND_CREATE_NEW_DIALOG",{titleKey:"TIT_DRAFT_DISCARD_DIALOG",actions:[t.Action.OK,t.Action.CANCEL],emphasizedAction:t.Action.OK}).then(function(e){if(e!==t.Action.OK){throw"cancel"}return true})};m.isElementVisible=function(e){if(!e){return false}return!!(e.offsetWidth||e.offsetHeight||e.getClientRects().length)};return m},true);
//# sourceMappingURL=Utils.js.map