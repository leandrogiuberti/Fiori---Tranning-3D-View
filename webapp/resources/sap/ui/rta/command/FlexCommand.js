/*!
 * OpenUI5
 * (c) Copyright 2025 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["sap/base/util/merge","sap/base/util/values","sap/base/Log","sap/ui/core/util/reflection/JsControlTreeModifier","sap/ui/core/Element","sap/ui/fl/apply/api/ControlVariantApplyAPI","sap/ui/fl/write/api/ChangesWriteAPI","sap/ui/fl/Utils","sap/ui/rta/command/BaseCommand","sap/ui/rta/library"],function(e,t,n,o,r,a,i,p,s,c){"use strict";const l=s.extend("sap.ui.rta.command.FlexCommand",{metadata:{library:"sap.ui.rta",properties:{changeType:{type:"string"},jsOnly:{type:"boolean",defaultValue:false},selector:{type:"object"},variantIndependent:{type:"boolean",defaultValue:false}}}});l.prototype.getElementId=function(){const e=this.getElement();return e?e.getId():this.getSelector().id};l.prototype.getAppComponent=function(){const e=this.getElement();return e?p.getAppComponentForControl(e):this.getSelector().appComponent};l.prototype.prepare=async function(e,t,o){try{let n;if(!this.getSelector()&&e&&e.templateSelector){n={id:e.templateSelector,appComponent:this.getAppComponent(),controlType:p.getControlType(r.getElementById(e.templateSelector))};this.setSelector(n)}else if(!this.getSelector()&&this.getElement()){n={id:this.getElement().getId(),appComponent:this.getAppComponent(),controlType:p.getControlType(this.getElement())};this.setSelector(n)}this._oPreparedChange=await this._createChange(e,t,o);return true}catch(e){n.error(e.message||e.name);return false}};l.prototype.getPreparedChange=function(){return this._oPreparedChange};l.prototype.execute=function(){const e=this.getPreparedChange();return this._applyChange(e)};l.prototype._getChangeSpecificData=function(){const e=this.getMetadata().getProperties();const n={changeType:this.getChangeType(),content:e.content?.get(this)};t(e).filter(e=>e.group==="content").forEach(e=>{n.content||={};n.content[e.name]=e.get(this)});return n};l.prototype._createChange=function(e,t,n){return this._createChangeFromData(this._getChangeSpecificData(),e,t,n)};l.prototype._createChangeFromData=async function(t,n,r,p){if(n){t=e({},t,n)}t.jsOnly=this.getJsOnly();const s=this.getAppComponent().getModel(a.getVariantModelName());let l;if(s&&r){l=s.getCurrentVariantReference(r)}if(l&&!this.getVariantIndependent()){const e={variantManagementReference:r,variantReference:l,isChangeOnStandardVariant:r===l};t={...t,...e}}t.command=p;t.generator=n.generator||c.GENERATOR_NAME;const g=await i.create({changeSpecificData:t,selector:this._validateControlForChange(n)});if(n&&n.originalSelector){g.addDependentControl(n.originalSelector,"originalSelector",{modifier:o,appComponent:this.getAppComponent()});g.setSelector({...g.getSelector(),...o.getSelector(this.getSelector().id,this.getAppComponent())});g.setContent({...g.getContent(),...n.content})}return g};l.prototype.undo=function(){const e=this.getElement()||o.bySelector(this.getSelector());const t=this.getPreparedChange();return i.revert({change:t,element:e})};l.prototype._applyChange=async function(e){const t=this.getAppComponent();const n=o.bySelector(e.getSelector(),t);const r={modifier:o,appComponent:t,view:p.getViewForControl(n)};const a=await i.apply({change:e,element:n,...r});if(!a.success){throw new Error(a.error)}};l.prototype._validateControlForChange=function(e){if(e?.originalSelector&&e?.content?.boundAggregation){return{id:e.originalSelector,appComponent:this.getAppComponent(),controlType:p.getControlType(r.getElementById(e.originalSelector))}}return this.getElement()||this.getSelector()};return l});
//# sourceMappingURL=FlexCommand.js.map