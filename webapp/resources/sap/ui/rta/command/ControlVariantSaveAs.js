/*!
 * OpenUI5
 * (c) Copyright 2025 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["sap/ui/fl/apply/api/FlexRuntimeInfoAPI","sap/ui/fl/variants/VariantManager","sap/ui/fl/write/api/ContextSharingAPI","sap/ui/fl/write/api/PersistenceWriteAPI","sap/ui/fl/Utils","sap/ui/rta/command/BaseCommand","sap/ui/rta/library","sap/ui/rta/Utils"],function(e,a,t,n,r,i,o,s){"use strict";const h=i.extend("sap.ui.rta.command.ControlVariantSaveAs",{metadata:{library:"sap.ui.rta",properties:{sourceVariantReference:{type:"string"},sourceDefaultVariant:{type:"string"},newVariantParameters:{type:"object"}},associations:{},events:{}}});h.prototype.prepare=async function(e){this.oVariantManagementControl=this.getElement();this.oAppComponent=r.getAppComponentForControl(this.oVariantManagementControl);this.sVariantManagementReference=this.oVariantManagementControl.getVariantManagementReference();this.setSourceDefaultVariant(this.oVariantManagementControl.getDefaultVariantKey());this.sLayer=e.layer;const a=e;a.variantManagementControl=this.oVariantManagementControl;function n(e,a){const t=e.getParameters();this.setNewVariantParameters(t);this.oVariantManagementControl.detachSave(n,this);this.oVariantManagementControl.detachCancel(i,this);a.resolve(true)}function i(e,a){this.oVariantManagementControl.detachSave(n,this);this.oVariantManagementControl.detachCancel(i,this);a.resolve(false)}const o=await new Promise(e=>{this.oVariantManagementControl.attachSave({resolve:e},n,this);this.oVariantManagementControl.attachCancel({resolve:e},i,this);this.oVariantManagementControl.openSaveAsDialogForKeyUser(s.getRtaStyleClassName(),t.createComponent(a))});return o};h.prototype.getPreparedChange=function(){if(!this._aPreparedChanges){return undefined}return this._aPreparedChanges};h.prototype.execute=async function(){const t=e.getFlexReference({element:this.oVariantManagementControl});this._aControlChangesWithoutVariant=a.getControlChangesForVariant(t,this.sVariantManagementReference,this.getSourceVariantReference()).filter(e=>!e.getSavedToVariant());const n=this.getNewVariantParameters();n.layer=this.sLayer;n.newVariantReference=this.sNewVariantReference;n.generator=o.GENERATOR_NAME;const r=await a.handleSaveEvent(this.oVariantManagementControl,n);this._aPreparedChanges=r;[this._oVariantChange]=r;this.sNewVariantReference=this._oVariantChange.getId();this._aPreparedChanges.forEach(function(e){if(e.getFileType()==="change"){e.setSavedToVariant(true)}});a.updateVariantManagementMap(t)};h.prototype.undo=async function(){if(this._oVariantChange){const e=[];this._aPreparedChanges.forEach(a=>{if(a.getFileType()==="ctrl_variant_management_change"){e.push(a)}});await n.remove({flexObjects:e,selector:this.oAppComponent});const t={variant:this._oVariantChange,sourceVariantReference:this.getSourceVariantReference(),variantManagementReference:this.sVariantManagementReference,appComponent:this.oAppComponent};await a.removeVariant(t,true);await a.addAndApplyChangesOnVariant(this._aControlChangesWithoutVariant,this.oAppComponent);this._aPreparedChanges=null;this._oVariantChange=null}};return h});
//# sourceMappingURL=ControlVariantSaveAs.js.map