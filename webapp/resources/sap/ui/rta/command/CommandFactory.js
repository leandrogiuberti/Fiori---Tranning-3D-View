/*!
 * OpenUI5
 * (c) Copyright 2025 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["sap/base/util/merge","sap/base/Log","sap/ui/base/ManagedObject","sap/ui/core/Element","sap/ui/dt/ElementUtil","sap/ui/dt/OverlayRegistry","sap/ui/dt/Util","sap/ui/fl/Utils","sap/ui/fl/Layer"],function(e,t,n,a,r,o,i,c,m){"use strict";function d(e){const t=r.getAggregationInformation(e.getElement());if(t.elementId){const e=o.getOverlay(t.elementId);const n=e.getParentElementOverlay();const a=n?!!r.getAggregationInformation(n.getElement()).templateId:false;if(a){throw i.createError("CommandFactory#evaluateTemplateBinding","Multiple template bindings are not supported","sap.ui.rta")}const c=r.extractTemplateId(t);if(c){return{templateSelector:t.elementId,originalSelector:c,content:{boundAggregation:t.aggregation}}}}return undefined}function l(e,t){const n=typeof e==="string"?a.getElementById(e):e;const i=o.getOverlay(n);if(i){const e=r.getAggregationInformation(n);if(typeof t==="number"){e.stack[0].index=t}return r.extractTemplateId(e)}return n.getId()}function s(e){if(!e){throw new Error("adjustment for template failed")}}function u(e,n){let a;let r=false;let o=false;if(typeof n==="string"){a=n}else if(n){a=n.changeType;r=n.jsOnly===true;o=n.CAUTION_variantIndependent===true}if(!a){return false}e.setChangeType(a);e.setJsOnly(r);if(e.setVariantIndependent){e.setVariantIndependent(o)}else if(o){t.error("the variant independent Flag is not available for the action",a)}return true}function g(e,t,n){const a=n?.getAction(t.name,e)||{};Object.assign(a,{changeType:t.name});return a}function p(e,t,n){const a=n?.getAction(t.name,e)||{};Object.assign(a,{changeType:t.name});return a}function f(e){e.element=a.getElementById(l(e.element));s(e.element)}function z(e,t,n){const r=t.element||a.getElementById(t.element.id);const o=n.getActionDataFromAggregations("createContainer",r)[0];return o}function y(e){e.element=a.getElementById(l(e.element));s(e.element);e.parentId=l(e.parentId);s(e.parentId)}function E(e,t,n){const r=t.movedElements[0].element||a.getElementById(t.movedElements[0].id);const o=n.getAction("move",r);return o}function I(e){const t=e.movedElements.map(function(e){const t=a.getElementById(l(e.element,e.sourceIndex));s(t);return t});e.movedElements.forEach(function(e,n){e.element=t[n]});e.element=a.getElementById(l(e.element));s(e.element);e.source.parent=a.getElementById(l(e.source.parent));s(e.source.parent);e.target.parent=a.getElementById(l(e.target.parent));s(e.target.parent)}function v(e,t,n){return n.getAction("localReset",e)}function C(e,t,n){const a=t.renamedElement;const r=n.getAction("rename",a);return r}function B(e){e.element=a.getElementById(l(e.element));s(e.element);e.renamedElement=a.getElementById(l(e.renamedElement));s(e.renamedElement)}function A(e,t,a){const r=t.removedElement||e;if(!(r instanceof n)){throw new Error("No valid 'removedElement' found")}const o=a.getAction("remove",r);return o}function F(e){e.element=a.getElementById(l(e.element));s(e.element);e.removedElement=a.getElementById(l(e.removedElement));s(e.removedElement)}function h(e,t,n){const a=t.source;const r=n.getAction("combine",a);return r}function S(e){e.element=a.getElementById(l(e.element));s(e.element);e.source=a.getElementById(l(e.source));s(e.source);const t=e.combineElements.map(function(e){e=a.getElementById(l(e));s(e);return e});e.combineElements=t}function b(e,t,n){const a=t.source;const r=n.getAction("split",a);return r}function j(e){e.element=a.getElementById(l(e.element));s(e.element);e.parentElement=a.getElementById(l(e.parentElement));s(e.parentElement);e.source=a.getElementById(l(e.source));s(e.source)}function O(e,t,n){const a=t.element;return n.getAction("add",a,"delegate")}function V(e){e.element=a.getElementById(l(e.element));s(e.element);e.parentId=l(e.parentId);s(e.parentId)}function x(e,t,n){return n.getAction("reveal",t.element)}function P(e){e.element=a.getElementById(l(e.element));s(e.element);if(e.revealedElementId){e.revealedElementId=l(e.revealedElementId);s(e.revealedElementId)}if(e.directParent){e.directParent=a.getElementById(l(e.directParent));s(e.directParent)}}function R(e,t,n){const a=n.getAction("add",t.element);if(a&&a.custom&&typeof a.custom.getItems==="function"){const e={...a.custom,changeOnRelevantContainer:t.changeOnRelevantContainer,changeType:t.changeType};delete t.changeOnRelevantContainer;return e}return undefined}function w(e,t,n){return n.getAction("addIFrame",t.element)||n.getActionDataFromAggregations("addIFrame",t.element)[0]}function T(){return"propertyBindingChange"}function M(){return"propertyChange"}const L={composite:{clazz:"sap/ui/rta/command/CompositeCommand",noSelector:true},property:{clazz:"sap/ui/rta/command/Property",adjustForBinding:f,configure:M},bindProperty:{clazz:"sap/ui/rta/command/BindProperty",configure:T},addXML:{clazz:"sap/ui/rta/command/AddXML",configure:g,adjustForBinding:f},addXMLAtExtensionPoint:{clazz:"sap/ui/rta/command/AddXMLAtExtensionPoint",configure:g,adjustForBinding:f},codeExt:{clazz:"sap/ui/rta/command/ExtendControllerCommand",configure:p,adjustForBinding:f},createContainer:{clazz:"sap/ui/rta/command/CreateContainer",configure:z,adjustForBinding:y},move:{clazz:"sap/ui/rta/command/Move",configure:E,adjustForBinding:I},remove:{clazz:"sap/ui/rta/command/Remove",configure:A,adjustForBinding:F},localReset:{clazz:"sap/ui/rta/command/LocalReset",configure:v},rename:{clazz:"sap/ui/rta/command/Rename",configure:C,adjustForBinding:B},addDelegateProperty:{clazz:"sap/ui/rta/command/AddProperty",configure:O,adjustForBinding:V},reveal:{clazz:"sap/ui/rta/command/Reveal",configure:x,adjustForBinding:P},customAdd:{clazz:"sap/ui/rta/command/CustomAdd",configure:R},combine:{clazz:"sap/ui/rta/command/Combine",configure:h,adjustForBinding:S},split:{clazz:"sap/ui/rta/command/Split",configure:b,adjustForBinding:j},resize:{clazz:"sap/ui/rta/command/Resize"},switch:{clazz:"sap/ui/rta/command/ControlVariantSwitch"},save:{clazz:"sap/ui/rta/command/ControlVariantSave"},saveAs:{clazz:"sap/ui/rta/command/ControlVariantSaveAs"},setTitle:{clazz:"sap/ui/rta/command/ControlVariantSetTitle"},configure:{clazz:"sap/ui/rta/command/ControlVariantConfigure"},settings:{clazz:"sap/ui/rta/command/Settings"},addLibrary:{clazz:"sap/ui/rta/command/manifest/AddLibrary",noSelector:true},appDescriptor:{clazz:"sap/ui/rta/command/ManifestCommand",noSelector:true},manifest:{clazz:"sap/ui/rta/command/ManifestCommand",noSelector:true},annotation:{clazz:"sap/ui/rta/command/AnnotationCommand",noSelector:true},addIFrame:{clazz:"sap/ui/rta/command/AddIFrame",configure:w},compVariantContent:{clazz:"sap/ui/rta/command/compVariant/CompVariantContent"},compVariantSaveAs:{clazz:"sap/ui/rta/command/compVariant/CompVariantSaveAs"},compVariantSwitch:{clazz:"sap/ui/rta/command/compVariant/CompVariantSwitch"},compVariantUpdate:{clazz:"sap/ui/rta/command/compVariant/CompVariantUpdate"}};function U(e){return new Promise(function(t){const n=e.clazz;sap.ui.require([n],function(e){t(e)})})}async function N(t,a,r,c,m,l){const s=a[0].toLowerCase()+a.slice(1);const g=L[s];let p=m;if(!g){return i.createError("CommandFactory#getCommandFor",`Command '${s}' doesn't exist, check typing`,"sap.ui.rta")}const f=await U(g);const z=t instanceof n;if(!g.noSelector&&!z){r={...r,selector:t}}r={...r,element:z?t:undefined,name:s};const y=g.configure?g.configure(t,r,c):undefined;let E=z?o.getOverlay(t):undefined;if(y?.changeOnRelevantContainer){Object.assign(r,{element:E.getRelevantContainer()});t=r.element;E=o.getOverlay(t)}if(E&&t.sParentAggregationName){const t=d(E);if(t){if(g.adjustForBinding){g.adjustForBinding(r)}p=e(t,p)}}const I=new f(r);const v=g.configure?u(I,y):true;if(v){const e=await I.prepare(p,l,s);if(e){return I}}I.destroy();return undefined}const D=n.extend("sap.ui.rta.command.CommandFactory",{metadata:{library:"sap.ui.rta",properties:{flexSettings:{type:"object"}}}});D.prototype.init=function(){this.setProperty("flexSettings",{layer:m.CUSTOMER,developerMode:true})};D.prototype.setFlexSettings=function(e){this.setProperty("flexSettings",{...this.getFlexSettings(),...e})};D.prototype.getCommandFor=function(e,t,n,a,r){return N(e,t,n,a,this.getFlexSettings(),r)};D.getCommandFor=function(e,t,n,a,r){r||={layer:m.CUSTOMER,developerMode:true};if(r.scenario||r.baseId){const e=c.buildLrepRootNamespace(r.baseId,r.scenario,r.projectId);r.rootNamespace=e;r.namespace=`${e}changes/`}return N(e,t,n,a,r)};return D},true);
//# sourceMappingURL=CommandFactory.js.map