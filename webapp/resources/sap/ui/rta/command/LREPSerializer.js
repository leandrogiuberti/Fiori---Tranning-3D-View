/*!
 * OpenUI5
 * (c) Copyright 2025 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["sap/ui/base/ManagedObject","sap/ui/fl/Utils","sap/ui/dt/ElementUtil","sap/base/Log","sap/ui/fl/write/api/PersistenceWriteAPI"],function(e,t,a,o,s){"use strict";const n=e.extend("sap.ui.rta.command.LREPSerializer",{metadata:{library:"sap.ui.rta",associations:{rootControl:{type:"sap.ui.core.Control"}},properties:{commandStack:{type:"object"}},aggregations:{}}});function r(e){return a.getElementInstance(e)}n.prototype._lastPromise=Promise.resolve();n.prototype.setCommandStack=function(e){this.setProperty("commandStack",e)};n.prototype.needsReload=function(){this._lastPromise=this._lastPromise.catch(()=>{}).then(()=>{const e=this.getCommandStack().getAllExecutedCommands();return e.some(e=>!!e.needsReload)});return this._lastPromise};n.prototype.saveCommands=function(e){this._lastPromise=this._lastPromise.catch(e=>{o.error(e)}).then(async()=>{const t=r(this.getRootControl());if(!t){throw new Error("Can't save commands without root control instance!")}await s.save({selector:t,skipUpdateCache:false,draft:!!e.saveAsDraft,layer:e.layer,removeOtherLayerChanges:!!e.removeOtherLayerChanges,version:e.version,adaptationId:e.adaptationId,condenseAnyLayer:e.condenseAnyLayer});o.info("UI adaptation successfully wrote changes to the persistence");this.getCommandStack().setSaved(true);this.getCommandStack().removeAllCommands()});return this._lastPromise};n.prototype._triggerUndoChanges=function(e){const a=this.getCommandStack();let o=[];const s=a.getAllExecutedCommands();if(e){s.forEach(function(){o.push(a.undo.bind(a))})}else{s.forEach(function(e){o.push(e.undo.bind(e))});o=o.reverse()}return t.execPromiseQueueSequentially(o,false,true)};n.prototype.clearCommandStack=async function(e){const t=this.getCommandStack();await this._triggerUndoChanges(e);t.removeAllCommands();return true};return n});
//# sourceMappingURL=LREPSerializer.js.map