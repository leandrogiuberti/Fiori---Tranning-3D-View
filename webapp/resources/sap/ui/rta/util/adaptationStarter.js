/*!
 * OpenUI5
 * (c) Copyright 2025 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["sap/base/Log","sap/ui/core/Lib","sap/ui/fl/initial/api/InitialFlexAPI","sap/ui/fl/write/api/PersistenceWriteAPI","sap/ui/fl/Layer","sap/ui/fl/Utils","sap/ui/rta/util/showMessageBox","sap/ui/rta/RuntimeAuthoring"],function(t,e,o,r,a,n,s,i){"use strict";async function l(t){if(a.CUSTOMER===t){const t=await o.isKeyUser();if(!t){const t=e.getResourceBundleFor("sap.ui.rta");const o=new Error(t.getText("MSG_NO_KEY_USER_RIGHTS_ERROR_MESSAGE"));o.reason="isKeyUser";throw o}}}function c(t){const e=new URLSearchParams(window.location.search).get("fiori-tools-rta-mode");if(!e||e==="false"){const e=t.getManifest()||{};const o=e["sap.ui5"]&&e["sap.ui5"].flexEnabled;if(o===false){const t=Error("This app is not enabled for key user adaptation");t.reason="flexEnabled";throw t}}}function A(t){const o=t.getComponentData?.();if(o?.startupParameters&&Array.isArray(o.startupParameters["sap-app-id"])){const o=t.getManifest()["sap.app"]?.ach;const r=e.getResourceBundleFor("sap.ui.rta");const a=r.getText("MSG_PSEUDO_APP_VARIANT_ERROR_MESSAGE",[o]);const n=Error(a);n.reason="pseudoAppVariant";throw n}}async function T(o,T,_,p,u){const E=e.getResourceBundleFor("sap.ui.rta");try{if(!o.rootControl?.isA("sap.ui.core.Control")&&!o.rootControl?.isA("sap.ui.core.UIComponent")){const t=Error("An invalid root control was passed");t.reason="rootControl";throw t}o.rootControl=n.getAppComponentForControl(o.rootControl);await l(o.flexSettings.layer);c(o.rootControl);A(o.rootControl);const t=new i(o);if(_){t.attachEvent("start",_)}if(p){t.attachEvent("failed",p)}t.attachEvent("stop",u||function(){t.destroy()});if(T){await T(t)}await t.start();if(o.flexSettings.layer==="CUSTOMER"){const t={oComponent:o.rootControl,selector:o.rootControl,invalidateCache:false,includeCtrlVariants:true,currentLayer:a.CUSTOMER};const e=await r.getChangesWarning(t);if(e.showWarning){const t=e.warningType==="mixedChangesWarning"?{text:"MSG_ADAPTATION_STARTER_MIXED_CHANGES_WARNING",title:"TIT_ADAPTATION_STARTER_MIXED_CHANGES_TITLE"}:{text:"MSG_ADAPTATION_STARTER_NO_CHANGES_IN_P_WARNING",title:"TIT_ADAPTATION_STARTER_NO_CHANGES_IN_P_TITLE"};s(E.getText(t.text),{title:E.getText(t.title)},"warning")}}return t}catch(e){if(e.message!=="Reload triggered"&&!(n.getUshellContainer()&&e.reason==="flexEnabled")){if(e.reason==="isKeyUser"||e.reason==="pseudoAppVariant"){s(e.message,{title:E.getText("MSG_ADAPTATION_COULD_NOT_START")},"error")}else{s(E.getText("MSG_GENERIC_ERROR_MESSAGE",[e.message]),{title:E.getText("MSG_ADAPTATION_COULD_NOT_START")},"error")}t.error("UI Adaptation could not be started",e.message)}throw e}}return T});
//# sourceMappingURL=adaptationStarter.js.map