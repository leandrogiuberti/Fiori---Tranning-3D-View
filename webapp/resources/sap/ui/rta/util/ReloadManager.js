/*!
 * OpenUI5
 * (c) Copyright 2025 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["sap/base/util/merge","sap/ui/fl/apply/api/FlexRuntimeInfoAPI","sap/ui/fl/write/api/ReloadInfoAPI","sap/ui/fl/write/api/VersionsAPI","sap/ui/fl/Layer","sap/ui/fl/Utils","sap/ui/rta/Utils"],function(e,t,a,n,i,r,o){"use strict";const s={};let l={};function _(e){let t;const a=e.layer===i.CUSTOMER;if(e.hasHigherLayerChanges&&e.isDraftAvailable){t=a?"MSG_VIEWS_OR_PERSONALIZATION_AND_DRAFT_EXISTS":"MSG_HIGHER_LAYER_CHANGES_AND_DRAFT_EXISTS"}else if(e.hasHigherLayerChanges&&e.allContexts){t="MSG_RESTRICTED_CONTEXT_EXIST_AND_PERSONALIZATION"}else if(e.hasHigherLayerChanges){t=a?"MSG_PERSONALIZATION_OR_PUBLIC_VIEWS_EXISTS":"MSG_HIGHER_LAYER_CHANGES_EXIST"}else if(e.isDraftAvailable){t="MSG_DRAFT_EXISTS"}else if(e.allContexts){t="MSG_RESTRICTED_CONTEXT_EXIST"}return t}function A(e){const t=e.layer===i.CUSTOMER;if(e.hasHigherLayerChanges){if(!t){return"MSG_RELOAD_WITH_ALL_CHANGES"}if(e.isDraftAvailable){return"MSG_RELOAD_WITH_VIEWS_PERSONALIZATION_AND_WITHOUT_DRAFT"}if(e.allContexts){return"MSG_RELOAD_WITH_PERSONALIZATION_AND_RESTRICTED_CONTEXT"}if(e.switchEndUserAdaptation){return"MSG_RELOAD_WITH_PERSONALIZATION_AND_CONTEXT_BASED_ADAPTATION"}return"MSG_RELOAD_WITH_PERSONALIZATION_AND_VIEWS"}if(e.changesNeedReload){return"MSG_RELOAD_NEEDED"}if(e.initialDraftGotActivated||e.activeVersionNotSelected){return"MSG_RELOAD_ACTIVATED_DRAFT"}if(e.isDraftAvailable){return"MSG_RELOAD_WITHOUT_DRAFT"}if(e.allContexts){return"MSG_RELOAD_WITHOUT_ALL_CONTEXT"}if(e.switchEndUserAdaptation){return"MSG_RELOAD_OTHER_CONTEXT_BASED_ADAPTATION"}return undefined}async function E(e){const t=A(e);if(t){await o.showMessageBox("information",t,{titleKey:"HEADER_RELOAD_NEEDED"})}}async function f(e){if(l.Navigation&&e.versioningEnabled){if(e.isDraftAvailable){await n.loadDraftForApplication({control:e.selector,layer:e.layer,allContexts:e.allContexts,adaptationId:e.adaptationId})}else{await n.loadVersionForApplication({control:e.selector,layer:e.layer,allContexts:e.allContexts,adaptationId:e.adaptationId})}}const t=_(e);if(!e.developerMode){await o.showMessageBox("information",t)}s.enableAutomaticStart(e.layer,e.selector);e.onStart=true;s.triggerReload(e);return true}s.setUShellServices=function(e){l=e};s.enableAutomaticStart=function(e,a){const n=t.getFlexReference({element:a});const i=n||true;window.sessionStorage.setItem(`sap.ui.rta.restart.${e}`,i)};s.disableAutomaticStart=function(e){window.sessionStorage.removeItem(`sap.ui.rta.restart.${e}`)};s.needsAutomaticStart=function(e){return!!window.sessionStorage.getItem(`sap.ui.rta.restart.${e}`)};s.triggerReload=function(e){if(e.onStart){a.handleReloadInfoOnStart(e)}else{a.handleReloadInfo(e)}if(r.getUshellContainer()){l.AppLifeCycle.reloadCurrentApp()}else{s.reloadPage()}};s.reloadPage=function(){window.location.reload()};s.setUriParameters=function(e){document.location.search=e};s.handleReloadOnStart=async function(t){e(t,{ignoreMaxLayerParameter:false,includeCtrlVariants:true});const n=await a.getReloadReasonsForStart(t);if(n.hasHigherLayerChanges||n.isDraftAvailable||n.allContexts){return f(e(t,n))}return undefined};s.checkReloadOnExit=async function(e){const t=await e.changesNeedReloadPromise;e.changesNeedReload=t;const n=a.getReloadInfo(e);await E(n);return n};s.handleReloadOnExit=function(e){if(e.reloadNeeded){e.removeVersionParameter=true;s.triggerReload(e)}};return s});
//# sourceMappingURL=ReloadManager.js.map