/*!
 * OpenUI5
 * (c) Copyright 2025 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["sap/base/Log","sap/ui/core/Element","sap/ui/core/util/reflection/JsControlTreeModifier","sap/ui/dt/OverlayRegistry","sap/ui/fl/write/api/ChangesWriteAPI"],function(e,t,n,i,o){"use strict";const a="sapUiFlexibilitySupportExtension_Selected";const l="ui5flex$temp";window[l]={};const s=window[l];let r=0;function c(e,t){console.log(`Flextention: ${e}`);if(t){console.log(t)}}function d(e,t,i){const a=e.getAction(t);if(a&&a.changeType){const e=a.changeOnRelevantContainer?t.getRelevantContainer():t.getElement();return o.getChangeHandler({changeType:a.changeType,element:e,modifier:n,layer:i.getLayer()}).then(function(e){return e}).catch(function(){return})}return Promise.resolve(undefined)}function u(e){if(e.endsWith(".asSibling")){return true}if(e.endsWith(".asChild")){return false}return undefined}function g(e,t){const n=u(t);const i=e.getPlugins();return Object.values(i).find(function(e){const i=e._retrievePluginName?e._retrievePluginName(n):e.getMetadata().getName();return i===t})}function f(){const e=document.getElementsByClassName(a);if(e.length>0){e[0].classList.remove(a)}}async function p(e,n){const i=t.getElementById(n.overlayId);if(!i){return null}const o=i.getElement();if(i.getSelectable()){f()}const a=i.getEditableByPlugins();const l=Object.keys(a).filter(function(e){return a[e]});const s=await Promise.all(l.map(async function(t){const n=g(e,t);const o=u(t);const a=await d(n,i,e);return{name:t,isAvailable:n.isAvailable([i],o),hasChangeHandler:!!a}}));return{elementId:o.getId(),elementControlType:o.getMetadata().getName(),overlayId:i.getId(),plugins:s}}async function y(e,n){const i=t.getElementById(n.overlayId);const o=g(e,n.pluginName);const a=await d(o,i,e);if(o){try{const e=o.getId();const t=s[e]&&s[e].savedAs||`ui5flex$${r++}`;s[e]={description:`ChangeHandler for Plugin: ${e} - ${n.pluginName}`,changeHandler:a,savedAs:t};const i=s[e];window[t]=s[e];const d=`ChangeHandler copied to global var ${t}, all vars are collected in global var ${l}`;c(d,i)}catch(e){}}else{c("ChangeHandler could not be logged",undefined)}}function m(e){if(document.getElementsByClassName("sapUiDtContextMenu").length>0){const t=e.getPlugins().contextMenu;t.oContextMenuControl.close()}}function v(e,n){const i=t.getElementById(n.overlayId);i.focus();window.postMessage({type:"getOverlayInfo",id:"ui5FlexibilitySupport.submodules.overlayInfo",content:{overlayId:i.getId()}});f();m(e);const o=e.getSelection();o.forEach(function(e){e.setSelected(false)});if(i.getSelectable()){i.setSelected(true)}else if(i.getDomRef()){i.getDomRef().classList.add("sapUiFlexibilitySupportExtension_Selected")}}function b(){const e=i.getOverlays();const t=[];e.forEach(function(e){if(!e.isA("sap.ui.dt.AggregationOverlay")){const n=e.getParentElementOverlay()?.getId();const i=e.getChildren().map(function(e){return e.getId()});t.push({id:e.getId(),parentId:n,elementId:e.getElement().getId(),visible:e.getSelectable()&&e.isVisible(),idNum:parseInt(e.getId().replace("__overlay","")),children:i,hasParent:n!==undefined})}});return t}function I(e,n){const i=t.getElementById(n.overlayId);const o=i.getDesignTimeMetadata().getData();if(o){try{const e=i.getDesignTimeMetadata().getId();const t=s[e]&&s[e].savedAs||`ui5flex$${r++}`;s[e]={description:`DesignTimeMetaData: ${e} for Overlay: ${n.overlayId}`,metaData:o,savedAs:t};const a=s[e];window[t]=s[e];const d=`MetaData copied to global var ${t}, all vars are collected in global var ${l}`;c(d,a)}catch(e){}}else{c("DesignTimeMetaData could not be logged",undefined)}}const h={getOverlayInfo:{handler:p,returnMessageType:"overlayInfo",id:"ui5FlexibilitySupport.submodules.overlayInfo"},printChangeHandler:{handler:y,id:"ui5FlexibilitySupport.submodules.overlayInfo"},printDesignTimeMetadata:{handler:I,id:"ui5FlexibilitySupport.submodules.overlayInfo"},changeOverlaySelection:{handler:v,id:"ui5FlexibilitySupport.submodules.overlayInfo"},collectOverlayTableData:{handler:b,returnMessageType:"overlayInfoTableData",id:"ui5FlexibilitySupport.submodules.overlayInfo"}};function w(){window.postMessage({type:"rtaStopped",id:"ui5FlexibilitySupport.submodules.overlayInfo",content:{}})}function S(){window.postMessage({type:"rtaStarted",id:"ui5FlexibilitySupport.submodules.overlayInfo",content:{}})}function M(e,t){if(t.source!==window){return}const n=Object.entries(h).find(function(e){return e[0]===t.data.type&&e[1].id===t.data.id});const i=n&&n[1];if(i){Promise.resolve(i.handler(e,t.data.content)).then(function(e){if(i.returnMessageType){t.source.postMessage({id:i.id,type:i.returnMessageType,content:e})}})}}return function(e){const t=M.bind(null,e);window.addEventListener("message",t);e.attachEventOnce("stop",w);S();return{destroy(){window.removeEventListener("message",t)}}}});
//# sourceMappingURL=SupportTools.js.map