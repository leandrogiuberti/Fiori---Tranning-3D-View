/*!
 * OpenUI5
 * (c) Copyright 2025 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["sap/base/util/isPlainObject","sap/base/util/ObjectPath","sap/ui/core/util/reflection/JsControlTreeModifier","sap/ui/dt/ElementUtil","sap/ui/dt/OverlayRegistry","sap/ui/fl/apply/api/DelegateMediatorAPI","sap/ui/rta/util/BindingsExtractor"],function(e,t,n,a,r,i,o){"use strict";function l(e,t,n){if(!e){return false}const a=e.getBindingInfo(t,n);let r=a&&a.path;if(!r){return false}if(r.indexOf(">")>-1){r=r.split(">").pop()}return r.indexOf("/")===0}function u(e,t,n,a){let r;if(t){r=e.getBindingInfo(n,a);if(typeof r.model==="string"&&r.model!==a){r=undefined}}else{r=e.getBindingContext(a)}return r}function c(e,t,n){const a=l(e,t,n);const r=u(e,a,t,n);if(r){return a?r.path:r.getPath()}}function s(e){const t=e.reduce(function(e,t){if(Array.isArray(t.properties)){e=e.concat(t.properties.map(function(e){e.parentPropertyName=t.label||t.name;return e}))}else{e.push(t)}return e},[]);return t}async function g(e,t,n){const a=await n.delegateInfo.delegate.getPropertyInfo({element:e,aggregationName:t,payload:n.delegateInfo.payload||{}});return s(a)}async function f(e,t){const a=await i.getReadDelegateForControl({control:e,modifier:n});if(a&&a.instance){return a.instance.getPropertyInfo({element:e,aggregationName:t,payload:a.payload||{}})}return[]}async function d(e,t,n){const a=n.addViaDelegate;let r;if(a){r=g.bind(null,e,t,a)}else{r=f.bind(null,e,t)}const i=await r();return P(i)}function p(e){return e.filter(function(e){return!(e.unsupported||e.hideFromReveal)})}function m(e){return{selected:false,label:e.label||e.name,parentPropertyName:e.parentPropertyName?e.parentPropertyName:"",duplicateName:e.duplicateName?e.duplicateName:false,tooltip:e.tooltip||e.label,originalLabel:"",type:"delegate",entityType:e.entityType,name:e.name,bindingPath:e.bindingPath}}function b(e,t){const n=r.getOverlay(e);return t.getLabel||!n?a.getLabelForElement(e,t.getLabel):n.getDesignTimeMetadata().getLabel(e)}function _(e){const t=e.element;const n=b(t,e.action);return{selected:false,label:t.__label||n,tooltip:t.__tooltip||n||t.__bindingPath,parentPropertyName:t.__parentPropertyName?t.__parentPropertyName:"",duplicateName:t.__duplicateName?t.__duplicateName:false,originalLabel:t.__renamedLabel&&t.__label!==t.__originalLabel?t.__originalLabel:"",bindingPath:t.__bindingPath,type:"invisible",elementId:t.getId(),sourceAggregation:e.sourceAggregation}}function y(e,t,n,r){if(t&&t!==e){const i=c(e,n,r);return a.findAllSiblingsInContainer(e,t).filter(function(e){return i===c(e,n,r)})}return[e]}function P(e){e.forEach(function(e,t,n){if(e.duplicateName!==true){for(let a=t+1;a<n.length-1;a++){if(e.label===n[a].label){e.duplicateName=true;n[a].duplicateName=true}}}});return e}function h(e,t){return t.some(function(t){return t.label===e.__label})}function N(e){return Array.isArray(e)&&e.length>0}function I(e,t){return t.sort(function(e,t){return!!t.hideFromReveal-!!e.hideFromReveal}).filter(function(t){return e.some(function(e){return e===t.bindingPath||e.startsWith(`${t.bindingPath}/`)})}).pop()}function v(t){return e(t)?t.parts[0].path:!!t.getPath&&t.getPath()}function A(e,t,n,a){const r=e.getModel(n);const i=y(e,t.relevantContainer,a,n);let l=[];i.forEach(function(e){l=l.concat(o.getBindings({element:e,model:r,parent:e.getParent()}).map(v))});return l}function L(e,t){const n={element:e.relevantContainer,aggregationName:t,payload:e.delegateInfo.payload||{}};return e.delegateInfo.delegate.getRepresentedProperties(n)}async function R(e,t,n,a){const r=await L(t,a);if(r===undefined){return A(e,t,n,a)}let i=[];r.forEach(function(e){i=i.concat(e.bindingPaths)});return i}function B(e,n,a,r){const i=!!t.get("delegateInfo.delegate.getRepresentedProperties",n);if(i){return R(e,n,a,r)}return A(e,n,a,r)}function E(e,t){e.__originalLabel=t.label;e.__tooltip=t.tooltip;e.__bindingPath=t.name;if(e.__label!==e.__originalLabel){e.__renamedLabel=true}if(t.parentPropertyName){e.__parentPropertyName=t.parentPropertyName}}function C(e,n){const a=!!t.get("delegateInfo.delegate.getRepresentedProperties",e);if(a){return L(e,n)}}function D(e,t){let n;t.some(function(t){if(t.id===e.getId()){n=t;return true}});return n.bindingPaths||[]}function M(e,t,n,a){if(!N(n)){return true}const r=I(n,t);if(r){if(r.hideFromReveal){return false}if(a){E(e,r)}return true}return!a}function O(e,t,n,a,r,i){const l=a.addViaDelegate;const u=w(l);const s=e.getModel(u);let g=true;let f=[];const d=n.element;const p=n.action.depthOfRelevantBindings;if(r){f=D(d,r)}else if(c(e,t,u)===c(d,t,u)){f=o.collectBindingPaths(d,s,null,p).bindingPaths}else if(l&&o.getBindings({element:d,model:s}).length>0){g=false}if(g){d.__duplicateName=h(d,i);g=M(d,i,f,!!l)}return g}function w(e){return t.get("delegateInfo.payload.modelName",e)}const F={async enhanceInvisibleElements(e,t){const n=t.reveal;const a=t.addViaDelegate;const r=e.getMetadata().getAggregation();const i=r?r.name:t.aggregation;const[o,l]=await Promise.all([d(e,i,t),C(a,i)]);const u=[];const c=n.elements||[];c.forEach(function(n){const a=n.element;const r=n.action;a.__label=b(a,r);const c=O(e,i,n,t,l,o);if(c){u.push({element:a,action:r,sourceAggregation:n.sourceAggregation})}});return u.map(_)},async getUnrepresentedDelegateProperties(e,t){const n=w(t);const a=e.getMetadata().getAggregation();const r=a?a.name:t.action.aggregation;const[i,o]=await Promise.all([g(e,r,t),B(e,t,n,r)]);const l=t.action.filter?t.action.filter:function(){return true};let u=p(i);u=u.filter(function(e){let n=false;if(o){n=o.some(function(t){return t===e.bindingPath})}return!n&&l(t.relevantContainer,e)});u=P(u);return u.map(m)}};return F});
//# sourceMappingURL=AdditionalElementsAnalyzer.js.map