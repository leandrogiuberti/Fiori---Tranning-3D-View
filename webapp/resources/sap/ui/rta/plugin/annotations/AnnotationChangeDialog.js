/*!
 * OpenUI5
 * (c) Copyright 2025 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["sap/ui/base/ManagedObject","sap/ui/core/Fragment","sap/ui/dt/ElementUtil","sap/ui/fl/write/api/PersistenceWriteAPI","sap/ui/model/json/JSONModel","sap/ui/model/resource/ResourceModel","sap/ui/rta/plugin/annotations/AnnotationChangeDialogController","sap/ui/rta/Utils"],function(t,e,o,n,a,i,l,s){"use strict";const r=t.extend("sap.ui.rta.plugin.annotations.AnnotationChangeDialog");function p(t,e,o){const n=t.find(t=>t.annotationPath===e);if(n){n.currentValue=o;n.originalValue=o}}function c(t,e,n){const a=o.getLabelForElement(n);p(t,e,a)}function u(t,e,o){t.forEach(t=>{const n=t.getContent().annotationPath;p(e,n,o?JSON.stringify(t.getValue()):t.getValue())})}r.prototype._createDialog=async function(){this._oController=new l;const t=await e.load({name:"sap.ui.rta.plugin.annotations.AnnotationChangeDialog",controller:this._oController});t.addStyleClass(s.getRtaStyleClassName());this.oChangeAnnotationModel=new a;t.setModel(this.oChangeAnnotationModel);const o=new i({bundleName:"sap.ui.rta.messagebundle"});t.setModel(o,"i18n");return t};r.prototype._openDialog=function(){this._oDialog.open();return this._oController.initialize()};r.prototype.openDialogAndHandleChanges=async function(t){const{title:e,type:o,delegate:a,control:i,annotation:l,description:s,singleRename:r}=t;const{serviceUrl:p,properties:g,possibleValues:h,preSelectedProperty:d}=await a.getAnnotationsChangeInfo(i,l);const f=!!h?.some(t=>typeof t.key==="object");const y=g.map(t=>({...t,currentValue:f?JSON.stringify(t.currentValue):t.currentValue,originalValue:f?JSON.stringify(t.currentValue):t.currentValue,label:t.label||t.propertyName}));const C=(h||[]).map(t=>({...t,key:f?JSON.stringify(t.key):t.key}));y.sort((t,e)=>t.label.localeCompare(e.label));const m=n._getAnnotationChanges({control:i});const _=m.map(t=>t.getContent().annotationPath);this._oDialog||=await this._createDialog();const D=d&&y.find(t=>t.annotationPath===d)?.label||"";if(y.length>100){this.oChangeAnnotationModel.setSizeLimit(y.length)}if(r){c(y,d,i)}u(m.filter(t=>!t._appliedOnModel),y,f);this.oChangeAnnotationModel.setData({objectAsKey:f,control:i,title:e,description:s||"",properties:y,changedProperties:y.filter(({annotationPath:t})=>_.includes(t)),propertiesToDisplay:y,showChangedPropertiesOnly:false,filterText:D,singleRename:r||false,possibleValues:C,valueType:o,serviceUrl:p});if(D){this._oController.filterProperties(D,!!r)}this.oChangeAnnotationModel.refresh(true);const b=await this._openDialog();this._oController.filterProperties("");this._oDialog.close();return b};r.prototype.destroy=function(...e){t.prototype.destroy.apply(this,e);if(this._oDialog){this._oDialog.destroy()}if(this._oController){this._oController.destroy()}};return r});
//# sourceMappingURL=AnnotationChangeDialog.js.map