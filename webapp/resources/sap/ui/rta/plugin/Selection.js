/*!
 * OpenUI5
 * (c) Copyright 2025 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["sap/m/InstanceManager","sap/ui/core/Element","sap/ui/dt/OverlayRegistry","sap/ui/dt/OverlayUtil","sap/ui/events/KeyCodes","sap/ui/rta/plugin/Plugin","sap/ui/rta/Utils"],function(e,t,i,s,o,r,n){"use strict";var a=r.extend("sap.ui.rta.plugin.Selection",{metadata:{library:"sap.ui.rta",properties:{multiSelectionRequiredPlugins:{type:"string[]"},isActive:{type:"boolean",defaultValue:true}},associations:{},events:{elementEditableChange:{parameters:{editable:{type:"boolean"}}}}}});function l(e){e.preventDefault();e.stopPropagation()}function c(e,t){var i=t.slice();e.forEach(function(e){i=i.filter(function(t){return e.getEditableByPlugins()[t]})});return i.length>0}function u(e){return e.every(function(t){return t.getRelevantContainer()===e[0].getRelevantContainer()})}function v(e){return e.every(function(t){return t.getParentElementOverlay()===e[0].getParentElementOverlay()})}function g(e){return e.every(function(t){return t.getElement().getMetadata().getName()===e[0].getElement().getMetadata().getName()})}a.prototype.init=function(...e){this._multiSelectionValidator=this._multiSelectionValidator.bind(this);r.prototype.init.apply(this,e)};a.prototype._checkDeveloperMode=function(e,t){if(t){var i=this.getCommandFactory().getFlexSettings().developerMode;if(i&&this.hasStableId(e)){e.setEditable(true);e.setSelectable(true);this.fireElementEditableChange({editable:true});return true}}return false};a.prototype.setIsActive=function(e){this.setProperty("isActive",e);if(e===false){this._deselectOverlays()}};a.prototype.registerElementOverlay=function(e){var t=e.getDesignTimeMetadata();if(!t.markedAsNotAdaptable()&&!this._checkDeveloperMode(e,t)){e.attachEditableChange(this._onEditableChange,this);this._adaptSelectable(e)}e.attachBrowserEvent("click",this._selectOverlay,this);e.attachBrowserEvent("contextmenu",this._selectOverlay,this);e.attachBrowserEvent("keydown",this._onKeyDown,this);e.attachBrowserEvent("mousedown",this._onMouseDown,this);e.attachBrowserEvent("mouseover",this._onMouseover,this);e.attachBrowserEvent("mouseleave",this._onMouseleave,this)};a.prototype._onEditableChange=function(e){var t=e.getSource();this._adaptSelectable(t)};a.prototype._adaptSelectable=function(e){var t=e.getEditable();if(e.getSelectable()!==t){e.setSelectable(t);if(!t){this._removePreviousHover()}this.fireElementEditableChange({editable:t})}};a.prototype.deregisterElementOverlay=function(e){e.detachBrowserEvent("click",this._selectOverlay,this);e.detachBrowserEvent("contextmenu",this._selectOverlay,this);e.detachBrowserEvent("keydown",this._onKeyDown,this);e.detachBrowserEvent("mousedown",this._onMouseDown,this);e.detachBrowserEvent("mouseover",this._onMouseover,this);e.detachBrowserEvent("mouseleave",this._onMouseleave,this);e.detachEditableChange(this._onEditableChange,this)};a.prototype._setFocusOnOverlay=function(e,t){if(e&&e.getSelectable()){e.focus();t.stopPropagation()}};a.prototype._getFocusedOverlay=function(){if(document.activeElement){var e=t.getElementById(document.activeElement.id);if(e&&e.isA("sap.ui.dt.ElementOverlay")){return e}}return undefined};a.prototype._onKeyDown=function(e){if(!this.getIsActive()){return}var t=this._getFocusedOverlay();if(e.keyCode===o.ENTER){this._selectOverlay(e)}else if(e.keyCode===o.ARROW_UP&&e.shiftKey===false&&e.altKey===false){if(t){var i=n.getFocusableParentOverlay(t);this._setFocusOnOverlay(i,e);e.preventDefault()}}else if(e.keyCode===o.ARROW_DOWN&&e.shiftKey===false&&e.altKey===false){if(t){var s=n.getFirstFocusableDescendantOverlay(t);this._setFocusOnOverlay(s,e);e.preventDefault()}}else if(e.keyCode===o.ARROW_LEFT&&e.shiftKey===false&&e.altKey===false){if(t){var r=n.getPreviousFocusableSiblingOverlay(t);this._setFocusOnOverlay(r,e);e.preventDefault()}}else if(e.keyCode===o.ARROW_RIGHT&&e.shiftKey===false&&e.altKey===false){if(t){var a=n.getNextFocusableSiblingOverlay(t);this._setFocusOnOverlay(a,e);e.preventDefault()}}else if(e.keyCode===o.ESCAPE){if(t){this._deselectOverlays()}}};a.prototype._deselectOverlays=function(){this.getDesignTime().getSelectionManager().reset()};a.prototype._selectOverlay=function(e){const t=i.getOverlay(e.currentTarget.id);if(!this.getIsActive()){if(t.isRoot()){l(e)}return}const s=this.getDesignTime().getSelectionManager();const o=s.get().length>1;const r=e.metaKey||e.ctrlKey||e.shiftKey;const n=e.type==="contextmenu";if(t&&t.getSelectable()){if(t.isSelected()){if(!n){if(!r&&o){s.set([t])}else{s.remove(t)}}}else if(r){s.add(t)}else{s.set(t)}l(e)}else if(t&&t.isRoot()){l(e)}};a.prototype._onMouseDown=function(t){if(!this.getIsActive()){var s=i.getOverlay(t.currentTarget.id);if(s.isRoot()){l(t)}e.getOpenPopovers().forEach(function(e){if(e._bOpenedByChangeIndicator){e.close()}});return}};a.prototype._onMouseover=function(e){var t=i.getOverlay(e.currentTarget.id);if(!this.getIsActive()||this.getDesignTime()&&this.getDesignTime().getBusyPlugins().length){if(t.isRoot()){l(e)}return}if(t.isSelectable()){s.setFirstParentMovable(t,false);if(t!==this._oHoverTarget){this._removePreviousHover();this._oHoverTarget=t;this.getDesignTime().getSelectionManager().addHover(t)}l(e)}};a.prototype._onMouseleave=function(e){var t=i.getOverlay(e.currentTarget.id);if(!this.getIsActive()){if(t.isRoot()){l(e)}return}if(t.isSelectable()){s.setFirstParentMovable(t,true);this._removePreviousHover();l(e)}};a.prototype._removePreviousHover=function(){if(this._oHoverTarget){this.getDesignTime().getSelectionManager().removeHover(this._oHoverTarget)}delete this._oHoverTarget};a.prototype.setDesignTime=function(...e){if(this.getDesignTime()){this.getDesignTime().getSelectionManager().removeValidator(this._multiSelectionValidator)}r.prototype.setDesignTime.apply(this,e);if(this.getDesignTime()){this.getDesignTime().getSelectionManager().addValidator(this._multiSelectionValidator)}};a.prototype._multiSelectionValidator=function(e){return e.length===1||c(e,this.getMultiSelectionRequiredPlugins())&&u(e)&&(v(e)||g(e))};return a});
//# sourceMappingURL=Selection.js.map