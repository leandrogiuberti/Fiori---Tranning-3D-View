/*!
 * OpenUI5
 * (c) Copyright 2025 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["sap/base/security/encodeXML","sap/m/GroupHeaderListItem","sap/ui/base/ManagedObject","sap/ui/core/format/DateFormat","sap/ui/core/Fragment","sap/ui/core/message/MessageType","sap/ui/fl/initial/api/Version","sap/ui/model/Sorter","sap/ui/rta/Utils"],function(e,t,i,o,r,s,n,a,l){"use strict";var u="sapUiRtaDraftVersionAccent";var c="sapUiRtaActiveVersionAccent";var g="sapUiRtaVersionColor";var T=i.extend("sap.ui.rta.toolbar.versioning.Versioning",{metadata:{properties:{toolbar:{type:"any"}}},constructor:function(...e){i.prototype.constructor.apply(this,e);this.oTextResources=this.getToolbar().getTextResources()}});function h(e){var t=e.getSource().getBindingContext("versions");var i=n.Number.Original;if(t){i=t.getProperty("version")}this.getToolbar().fireEvent("switchVersion",{version:i})}function f(e){return e.some(function(e){return e.type===n.Type.Active})}function p(e){return f(e)?s.None:s.Success}function v(e){return f(e)?this.oTextResources.getText("LBL_INACTIVE"):this.oTextResources.getText("LBL_ACTIVE")}function d(e){switch(e){case n.Type.Draft:return s.Warning;case n.Type.Active:return s.Success;default:return s.None}}function V(e){switch(e){case n.Type.Draft:return this.oTextResources.getText("TIT_DRAFT");case n.Type.Active:return this.oTextResources.getText("LBL_ACTIVE");default:return this.oTextResources.getText("LBL_INACTIVE")}}function y(t,i){if(i===n.Type.Draft){return this.oTextResources.getText("TIT_DRAFT")}return t?e(t):this.oTextResources.getText("TIT_VERSION_1")}function b(e,t){var i=t||e;if(!i){return""}if(i.indexOf("Z")===-1){i=`${i}Z`}return o.getInstance({format:"yMMMdjm"}).format(new Date(i))}function m(e){return new t({title:e.key?this.oTextResources.getText("TIT_VERSION_HISTORY_PUBLISHED"):this.oTextResources.getText("TIT_VERSION_HISTORY_UNPUBLISHED"),visible:this.getToolbar().getModel("versions").getProperty("/publishVersionVisible")}).addStyleClass("sapUiRtaVersionHistoryGrouping").addStyleClass("sapUiRtaVersionHistory")}function D(e,t){switch(t){case n.Type.Draft:e.addStyleClass(u);e.removeStyleClass(c);e.removeStyleClass(g);break;case n.Type.Active:e.addStyleClass(c);e.removeStyleClass(u);e.removeStyleClass(g);break;default:e.addStyleClass(g);e.removeStyleClass(c);e.removeStyleClass(u)}}T.prototype.formatVersionButtonText=function(e,t){var i="";var o="Active";e||=[];if(t===undefined||t===n.Number.Original){i=this.oTextResources.getText("TIT_ORIGINAL_APP");o=n.Type.Inactive;if(e.length===0||e.length===1&&e[0].type===n.Type.Draft){o=n.Type.Active}}else{var r=e.find(function(e){return e.version===t});if(r){o=r.type;if(t===n.Number.Draft){i=this.oTextResources.getText("TIT_DRAFT")}else{i=r.title||this.oTextResources.getText("TIT_VERSION_1")}}}D(this.getToolbar().getControl("versionButton"),o);return i};T.prototype.formatPublishVersionVisibility=function(e,t,i,o){return e&&t&&i!==n.Number.Draft&&o==="adaptation"};T.prototype.formatDiscardDraftVisible=function(e,t,i){return e===n.Number.Draft&&t&&i==="adaptation"};T.prototype.showVersionHistory=function(e){var t=e.getSource();this._oVersionHistoryDialogPromise||=r.load({name:"sap.ui.rta.toolbar.versioning.VersionHistory",id:`${this.getToolbar().getId()}_fragment--sapUiRta_versionHistoryDialog`,controller:{formatVersionTitle:y.bind(this),formatVersionTimeStamp:b,formatHighlight:d,formatHighlightText:V.bind(this),formatOriginalAppHighlight:p,formatOriginalAppHighlightText:v.bind(this),versionSelected:h.bind(this),getGroupHeaderFactory:m.bind(this)}}).then(function(e){this.getToolbar().addDependent(e);return e}.bind(this));return this._oVersionHistoryDialogPromise.then(function(e){if(!e.isOpen()){e.openBy(t);if(this.getToolbar().getModel("versions").getProperty("/publishVersionVisible")){var i=this.getToolbar().getControl("versionHistoryDialog--versionList");var o=new a({path:"isPublished",group:true});i.getBinding("items").sort(o)}}else{e.close()}}.bind(this))};T.prototype.openActivateVersionDialog=function(e){if(!this._oActivateVersionDialogPromise){this._oActivateVersionDialogPromise=r.load({name:"sap.ui.rta.toolbar.versioning.VersionTitleDialog",id:`${this.getToolbar().getId()}_fragment--sapUiRta_activateVersionDialog`,controller:{onConfirmVersioningDialog:function(){var e=this.getToolbar().getControl("activateVersionDialog--versionTitleInput").getValue();if(e.length>0){this.getToolbar().fireEvent("activate",{versionTitle:e});this._oActivateVersionDialog.close()}}.bind(this),onCancelVersioningDialog:function(){this._oActivateVersionDialog.close()}.bind(this),onVersionTitleLiveChange:function(e){var t=e.getParameter("value");this.getToolbar().getControl("activateVersionDialog--confirmVersionTitleButton").setEnabled(!!t)}.bind(this)}}).then(function(e){this._oActivateVersionDialog=e;e.addStyleClass(l.getRtaStyleClassName());this.getToolbar().addDependent(this._oActivateVersionDialog)}.bind(this))}else{this.getToolbar().getControl("activateVersionDialog--versionTitleInput").setValue("");this.getToolbar().getControl("activateVersionDialog--confirmVersionTitleButton").setEnabled(false)}return this._oActivateVersionDialogPromise.then(function(){var t=this.oTextResources.getText("TIT_VERSION_TITLE_DIALOG");if(e!==n.Number.Draft){t=this.oTextResources.getText("TIT_REACTIVATE_VERSION_TITLE_DIALOG")}this._oActivateVersionDialog.setTitle(t);return this._oActivateVersionDialog.open()}.bind(this))};return T});
//# sourceMappingURL=Versioning.js.map