/*
 * SAPUI5

(c) Copyright 2009-2020 SAP SE. All rights reserved
 */
sap.ui.define(["sap/ui/base/Object","sap/ui/generic/app/util/ModelUtil","sap/base/Log"],function(t,e,a){"use strict";var r=t.extend("sap.ui.generic.app.transaction.DraftContext",{metadata:{publicMethods:["isDraftEnabled","isDraftRoot","hasDraft","hasDraftRoot","hasDraftValidationFunction","hasDraftPreparationAction","isTechnicalKey","isSemanticKey","getSemanticKey","checkUpdateOnChange","getODataDraftFunctionImportName","hasDraftAdministrativeData","hasSiblingEntity","destroy","hasPreserveChanges"]},constructor:function(t){if(!t){throw new Error("No model")}this._oModel=t;this._oMeta=t.getMetaModel();this._oModelUtil=new e(t);return this.getInterface()}});r.prototype.isDraftEnabled=function(t){var e=this._getODataDraftEntitySet(t);return!!(e&&e.isDraft)};r.prototype.isDraftRoot=function(t){var e=this._getODataDraftEntitySet(t);return!!(e&&e.isRoot)};r.prototype.hasDraft=function(t){var a=e.getEntitySetFromContext(t);if(a==null){return false}return this.isDraftEnabled(a)};r.prototype.hasDraftRoot=function(t){var a=e.getEntitySetFromContext(t);return this.isDraftRoot(a)};r.prototype.hasDraftValidationFunction=function(t){return!!this.getODataDraftFunctionImportName(t,"ValidationFunction")};r.prototype.hasDraftPreparationAction=function(t){return!!this.getODataDraftFunctionImportName(t,"PreparationAction")};r.prototype.isTechnicalKey=function(t,e){var a,r,o,i,n;if(!t){throw new Error("No entity set")}a=this._oMeta.getODataEntitySet(t);r=this._oMeta.getODataEntityType(a.entityType);o=r.key.propertyRef.length;if(Object.keys(e).length!==o){return false}for(i=0;i<o;i++){n=r.key.propertyRef[i].name;if(!e[n]){return false}}return true};r.prototype.isSemanticKey=function(t,e){var a,r,o;if(this.isDraftEnabled(t)){a=this.getSemanticKey(t);o=a.length;for(r=0;r<o;r++){if(!e[a[r].name]){return false}}return true}return false};r.prototype.getSemanticKey=function(t){var e,a,r,o=[],i,n;if(!t){throw new Error("No entity set")}e=this._oMeta.getODataEntitySet(t);a=this._oMeta.getODataEntityType(e.entityType);r=a["com.sap.vocabularies.Common.v1.SemanticKey"];if(r){n=r.length;for(i=0;i<n;i++){o.push({name:r[i].PropertyPath})}}return o};r.prototype.getODataDraftFunctionImportName=function(t,a){var r,o;r=e.getEntitySetFromContext(t);o=this._getODataDraftEntitySet(r);if(o.oDraft[a]&&o.oDraft[a].String){return o.oDraft[a].String}return null};r.prototype._getODataDraftEntitySet=function(t){var e={},r;if(!t){throw new Error("No entity set")}r=this._oMeta.getODataEntitySet(t);e.ODataEntitySet=r;if(r){if(r["com.sap.vocabularies.Common.v1.DraftRoot"]){e.isDraft=true;e.isRoot=true;e.oDraft=r["com.sap.vocabularies.Common.v1.DraftRoot"]}else if(r["com.sap.vocabularies.Common.v1.DraftNode"]){e.isDraft=true;e.isRoot=false;e.oDraft=r["com.sap.vocabularies.Common.v1.DraftNode"]}}else{a.warning("EntitySet "+t+" is not available in the main model")}return e};r.prototype.hasDraftAdministrativeData=function(t){return this._hasNavigationProperty(t,"DraftAdministrativeData")};r.prototype.hasSiblingEntity=function(t){return this._hasNavigationProperty(t,"SiblingEntity")};r.prototype._hasNavigationProperty=function(t,e){var a,r,o,i;a=this._oMeta.getODataEntitySet(t);r=this._oMeta.getODataEntityType(a.entityType);if(r.navigationProperty){i=r.navigationProperty.length;for(o=0;o<i;o++){if(r.navigationProperty[o].name===e){return true}}}return false};r.prototype.hasPreserveChanges=function(t){var e=this._oMeta.getODataFunctionImport(this.getODataDraftFunctionImportName(t,"EditAction"));if(e&&e.parameter){for(var a=0;a<e.parameter.length;a++){var r=e.parameter[a];if(r.mode==="In"&&r.name==="PreserveChanges"){return true}}}return false};r.prototype.destroy=function(){if(this._oModelUtil){this._oModelUtil.destroy()}this._oModelUtil=null;this._oModel=null;this._oMeta=null};return r},true);
//# sourceMappingURL=DraftContext.js.map