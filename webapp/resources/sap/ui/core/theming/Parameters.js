/*!
 * OpenUI5
 * (c) Copyright 2025 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["sap/ui/core/Theming","../Element","sap/base/future","sap/base/Log","sap/base/util/syncFetch","sap/ui/base/OwnStatics","./ThemeManager"],function(e,t,r,a,n,s,i){"use strict";const o=sap.ui.loader._.getSyncCallBehavior();const{attachChange:c}=s.get(e);const{getAllLibraryInfoObjects:u}=s.get(i);var f={};var l=null;var p=null;var m=[...u().keys()];var h=[];var d=new URL(sap.ui.require.toUrl(""),document.baseURI).origin;var g={};var v=/url[\s]*\('?"?([^\'")]*)'?"?\)/;function y(e,t){function r(e){if(e.startsWith("//")||/^[a-z][a-z0-9+.-]*:/i.test(e)){return false}return true}const a=v.exec(e);if(a){const n=new URL(a[1],t);if(r(a[1])){const t=n.href;e="url('"+t+"')"}}return e}function b(e,t,r){for(var a in t){if(typeof e[a]==="undefined"){e[a]=y(t[a],r)}}return e}function w(e,t){if(typeof e["default"]!=="object"){e={default:e,scopes:{}}}l=l||{};l["default"]=l["default"]||{};l["scopes"]=l["scopes"]||{};b(l["default"],e["default"],t);if(typeof e["scopes"]==="object"){for(var r in e["scopes"]){l["scopes"][r]=l["scopes"][r]||{};b(l["scopes"][r],e["scopes"][r],t)}}}function U(e){for(const[t,r]of u()){e(t,r)}}function P(e,t){var n=A(e);var s=e.finishedLoading;if(!s&&!t){a.warning("Parameters have been requested but theme is not applied, yet.","sap.ui.core.theming.Parameters")}if(s){var i=document.getElementById(e.linkId);var o=window.getComputedStyle(i).getPropertyValue("background-image");var c=/\(["']?data:text\/plain;utf-8,(.*?)['"]?\)$/i.exec(o);if(c&&c.length>=2){var u=c[1];if(u.charAt(0)!=="{"&&u.charAt(u.length-1)!=="}"){try{u=decodeURIComponent(u)}catch(e){r.warningThrows("Could not decode theme parameters URI from "+n.styleSheetUrl,{cause:e})}}try{var f=JSON.parse(u);w(f,n.themeBaseUrl);return true}catch(e){r.warningThrows("Could not parse theme parameters from "+n.styleSheetUrl+".",{cause:e,suffix:"Loading library-parameters.json as fallback solution."})}}}return t?s:false}function L(e){var t=A(e);if(!P(e)){var r=t.styleSheetUrl.replace(/\/(?:css_variables|library)([^\/.]*)\.(?:css|less)($|[?#])/,function(e,t,r){return"/library-parameters.json"+(r?r:"")});if(o===2){a.error("[nosync] Loading library-parameters.json ignored",r,"sap.ui.core.theming.Parameters");return}else if(o===1){a.error("[nosync] Loading library-parameters.json with sync XHR",r,"sap.ui.core.theming.Parameters")}const e=new URL(t.themeBaseUrl).origin;var n=g[e];var s=[];if(n===undefined){if(r.startsWith(d)){s=[false,true]}else{s=[true,false]}}else{s=[n]}T(r,t.themeBaseUrl,s)}}function A(e){if(!e.getUrl().url&&!e.cssLinkElement){r.warningThrows(`sap.ui.core.theming.Parameters: Could not find stylesheet element with ID "${e.id}"`);return undefined}var t=e.getUrl().url||e.cssLinkElement?.getAttribute("href");const a=e.getUrl().baseUrl.replace(/\/[^\/]*$/,"/");return{themeBaseUrl:a,styleSheetUrl:t}}function T(e,t,s){var i={Accept:n.ContentTypes.JSON};var o=s.shift();if(o){i["X-Requested-With"]="XMLHttpRequest"}function c(n){r.errorThrows("Could not load theme parameters from: "+e,{cause:n});if(s.length>0){a.warning("Initial library-parameters.json request failed ('withCredentials="+o+"'; sUrl: '"+e+"').\n"+"Retrying with 'withCredentials="+!o+"'.","sap.ui.core.theming.Parameters");T(e,t,s)}}try{var u=n(e,{credentials:o?"include":"omit",headers:i});if(u.ok){var f=u.json();const e=new URL(t).origin;g[e]=o;if(Array.isArray(f)){for(var l=0;l<f.length;l++){var p=f[l];w(p,t)}}else{w(f,t)}}else{throw new Error(u.statusText||u.status)}}catch(e){c(e)}}function j(e){if(!l){w({},"");U(function(t,r){if(e){if(!P(r,e)){m.push(t)}}else{L(r)}})}return l}function N(){var e=[];m.forEach(function(t){if(!P(u(t),true)){e.push(t)}});m=e}function I(){m.map(e=>u(e)).forEach(L);m=[]}f._addLibraryTheme=function(e){m.push(e)};function O(e){var t=e.async,r=j(t);if(e.scopeName){r=r["scopes"][e.scopeName]}else{r=r["default"]}var a=r[e.parameterName];if(!a){var n=e.parameterName.indexOf(":");if(n!=-1){var s=e.parameterName.substr(n+1);a=r[s]}}if(e.loadPendingParameters&&typeof a==="undefined"&&!t){I();a=O({parameterName:e.parameterName,scopeName:e.scopeName,loadPendingParameters:false})}return a}function R(e,t,r){var a=f.getActiveScopesFor(t,r);var n=a.flat().reduce(function(e,t){if(e.indexOf(t)===-1){e.push(t)}return e},[]);for(var s=0;s<n.length;s++){var i=n[s];var o=O({parameterName:e,scopeName:i,async:r});if(o){return o}}return O({parameterName:e,async:r})}f._getScopes=function(e,t){if(e&&!l){return undefined}var r=j(t);var a=Object.keys(r["scopes"]);return a};f.getActiveScopesFor=function(e,r){var a=[];if(e instanceof t){var n=e.getDomRef();if(r){N()}else{I()}var s=this._getScopes(undefined,r);if(s.length){if(n){var i=function(e){var t=n.classList;return t&&t.contains(e)};while(n){const e=s.filter(i);if(e.length>0){a.push(e)}n=n.parentNode}}else{var o=function(t){return typeof e.hasStyleClass==="function"&&e.hasStyleClass(t)};while(e){const t=s.filter(o);if(t.length>0){a.push(t)}e=typeof e.getParent==="function"&&e.getParent()}}}}return a};f.get=function(n,s){let i,o,c,u,f;let l;var m=function(e){return e.callback===o};if(!p){p=e.getTheme()}if(arguments.length===0){a.warning("[FUTURE FATAL] Legacy variant usage of sap.ui.core.theming.Parameters.get API detected. Do not use the Parameters.get() API to retrieve ALL theming parameters, "+"as this will lead to unwanted synchronous requests. "+"Use the asynchronous API variant instead and retrieve a fixed set of parameters.","LegacyParametersGet","sap.ui.support",function(){return{type:"LegacyParametersGet"}});var d=j();return Object.assign({},d["default"])}if(!n){return undefined}if(n instanceof Object&&!Array.isArray(n)){if(!n.name){r.warningThrows("sap.ui.core.theming.Parameters: Get was called with an object argument without one or more parameter names.");return undefined}s=n.scopeElement;o=n.callback;l=n._restrictedParseUrls||false;u=typeof n.name==="string"?[n.name]:n.name;c=true}else{if(typeof n==="string"){u=[n]}else{u=n}a.warning("[FUTURE FATAL] Legacy variant usage of sap.ui.core.theming.Parameters.get API detected for parameter(s): '"+u.join(", ")+"'. This could lead to bad performance and additional synchronous XHRs, as parameters might not be available yet. Use asynchronous variant instead.","LegacyParametersGet","sap.ui.support",function(){return{type:"LegacyParametersGet"}})}var g;var v=function(e){if(s instanceof t){return R(e,s,c)}else{if(c){N()}return O({parameterName:e,loadPendingParameters:!c,async:c})}};const y={};for(var b=0;b<u.length;b++){i=u[b];var w=v(i);if(!c||w){y[i]=w}}if(c&&o&&Object.keys(y).length!==u.length){g=function(){e.detachApplied(g);var t=this.get({name:n.name,scopeElement:n.scopeElement});if(!t||typeof t==="object"&&Object.keys(t).length!==u.length){a.error(`sap.ui.core.theming.Parameters: The following parameters could not be found: "${u.length===1?u[0]:u.filter(e=>t&&!Object.hasOwn(t,e))}"`)}o(t);h.splice(h.findIndex(m),1)}.bind(this);f=h.findIndex(m);if(f>=0){e.detachApplied(h[f].eventHandler);h[f].eventHandler=g}else{h.push({callback:o,eventHandler:g})}e.attachApplied(g);return undefined}if(l){S(y)}return u.length===1?y[u[0]]:y};function S(e){for(const t in e){if(Object.hasOwn(e,t)){let r=e[t];const a=v.exec(r);if(a){r=a[1]}else if(r==="''"||r==="none"){r=null}e[t]=r}}}f.reset=function(){k(true)};function k(){const t=arguments[0]===true;if(t||e.getTheme()!==p){p=e.getTheme();m=[...u().keys()];l=null}}f._getThemeImage=function(e,t){e=e||"sapUiGlobalLogo";var r=f.get(e);if(r){var a=v.exec(r);if(a){r=a[1]}else if(r==="''"||r==="none"){r=null}}if(t&&!r){return sap.ui.require.toUrl("sap/ui/core/themes/base/img/1x1.gif")}return r};c(k);return f},true);
//# sourceMappingURL=Parameters.js.map