/*!
 * OpenUI5
 * (c) Copyright 2025 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["sap/base/Log","sap/base/i18n/LanguageFallback","sap/base/i18n/Localization","sap/ui/Device","sap/ui/core/Element","sap/ui/core/LabelEnablement","sap/ui/core/Lib","sap/ui/util/XMLHelper"],function(t,e,n,o,s,r,a,i){"use strict";const c="sap.ui.interaction.UpdateDisplay";const l="1.0.0";const u={_version:l,elements:[],docs:{}};const d=new Map;const f=t=>{const e=t.split("+").map(t=>t.trim());const n={ctrl:false,alt:false,shift:false};let s=null;for(const t of e){const e=t.toLowerCase();if(e==="ctrl"){n.ctrl=true}else if(e==="alt"){n.alt=true}else if(e==="shift"){n.shift=true}else if(!s){if(t.length===1){s=t.toUpperCase()}else{s=t}}}const r=[];if(n.ctrl){r.push(o.os.macintosh?"Cmd":"Ctrl")}if(n.alt){r.push("Alt")}if(n.shift){r.push("Shift")}if(s){r.push(s)}return r.join("+")};const g=t=>{const e=a.getResourceBundleFor("sap.ui.core");return t.split("+").map(t=>{const n=t.trim();const o=`Keyboard.Shortcut.${n}`;const s=n.length>1?e.getText(o):n;return s===o?t.trim():s}).join("+")};const m=t=>{t.forEach(t=>{if(!t.hasAttribute("data-sap-ui-kbd-raw")){const e=f(t.textContent);t.setAttribute("data-sap-ui-kbd-raw",e);t.textContent=g(e)}});return t};const p=t=>{const e=t.documentElement;const n=Array.from(e.querySelectorAll("kbd"));m(n);return t};const h=t=>{const e=[];const n=t.getDependents?.()||[];for(const t of n){if(t.isA("sap.ui.core.CommandExecution")&&t.getVisible()){const n=t._getCommandInfo();const o=f(n.shortcut);e.push({name:t.getCommand(),kbd:[{raw:o,translated:g(o)}],description:n.description})}}return e};const b=(t,e)=>{const n=t.getFieldHelpDisplay();const o=n?s.getElementById(n):t;let a=r._getLabelTexts(o)[0];if(!a){const e=t.getAccessibilityInfo?.();if(e){a=e.description||e.children?.[0]?.getAccessibilityInfo?.()?.description||null}}const i="aria-labelledby";if(!a){let n;let o=t;let s=false;while(o&&!n&&!a){const r=t.getDomRef();n=r?.getAttribute(i);if(!n&&!s){s=true;const n=e.documentElement;if(n){const e=[...n.querySelectorAll("control-interactions")];const o=e.find(e=>Array.from(e.querySelectorAll(`control[name]`)).find(e=>e.getAttribute("name")===t.getMetadata().getName()));a=o?.querySelector("control")?.querySelector("defaultLabel")?.textContent}}if(!n&&!a){const t=r.querySelector("[aria-labelledby]");n=t?.getAttribute(i)}o=o.getParent?.()}if(!a&&n){const t=document.getElementById(n);a=t?.textContent||null}}return a||t.getMetadata().getName()};const y=async(o,s)=>{let r=o;while(r&&!s){s=r.getMetadata().getLibraryName();r=r.getParent()}if(!s){return null}const c=a._get(s);if(!c?.interactionDocumentation){return null}const l=n.getLanguage();const u=e.getFallbackLocales(l);let f=null;while(u.length){const e=u.shift();const n=e?`interaction_${e}.xml`:`interaction.xml`;const o=sap.ui.require.toUrl(`${s.replace(/\./g,"/")}/i18n/${n}`);const r=`${s}:${e}`;if(d.has(r)){return d.get(r)}try{const t=await fetch(o);if(!t.ok){const e=t.statusText||`HTTP status ${t.status}`;throw new Error(`Failed to load resource: ${o} - ${e}`)}const e=await t.text();f=i.parse(e);if(f){f=p(f);d.set(r,f);break}}catch(e){t.error(`Error loading interaction XML for library ${s}:`,e)}}return f};const A=(t,e)=>{const n=e.documentElement;if(!n){return[]}const o=[...n.querySelectorAll("control-interactions")];const s=o.find(e=>Array.from(e.querySelectorAll(`control[name]`)).find(e=>e.getAttribute("name")===t));if(!s){return[]}return[...s.querySelectorAll("interaction")].map(t=>{const e=Array.from(t.children).filter(t=>t.tagName==="kbd");const n=e.map(t=>({raw:t.getAttribute("data-sap-ui-kbd-raw"),translated:t.textContent}));return{kbd:n,description:t.querySelector("description")?.innerHTML||""}})};let v;let w=false;const x=async t=>{if(w){return}w=true;setTimeout(()=>{w=false},300);const e=[];const n={};const o=new Map;let r;if(t){r=t.type==="focusin"?t.target:t.relatedTarget}r??=document.activeElement;const i=s.closestTo(r);const l=await y(null,"sap.ui.core");if(l){const t=a.getResourceBundleFor("sap.ui.core");const e=t.getText("Generic.Keyboard.Interaction.Text");n["sap.ui.core.Control"]={interactions:A("sap.ui.core.Control",l)};o.set(e,{index:-1,class:"sap.ui.core.Control",label:e,interactions:[{$ref:`docs/sap.ui.core.Control/interactions`}]})}let d=i;while(d){e.push(d);d=d.getParent()}for(let t=0;t<e.length;t++){const s=e[t];const r=s.getMetadata().getName();const a=h(s);const i=await y(s);const c=i?A(r,i):[];if(!a.length&&!c.length){continue}const l=s.getMetadata().getName();if(c.length>0){n[l]={interactions:c};a.push({$ref:`docs/${l}/interactions`})}const u=b(s,i);if(!o.has(u)){o.set(u,{interactions:[],label:u})}const d=o.get(u);d.index=t;d.id=s.getId();d.class=l;d.interactions.unshift(...a.reverse())}u.elements=Array.from(o.values()).sort((t,e)=>t.index-e.index).map(t=>{delete t.index;return t});u.docs=n;v?.postMessage(JSON.parse(JSON.stringify({service:c,type:"request",payload:{...u}})))};return{_isActive:false,async activate(t){v=t;if(this._isActive){return}this._isActive=true;await x();document.addEventListener("focusin",x);document.addEventListener("focusout",x);n.attachChange(x)},deactivate(){if(!this._isActive){return}this._isActive=false;document.removeEventListener("focusin",x);document.removeEventListener("focusout",x);n.detachChange(x)},_:{getNormalizedShortcutString:f,translateInteractionXML:p,localizeKeys:g,annotateAndTranslateKbdTags:m,getInteractions:A,getCommandInfosFor:h}}});
//# sourceMappingURL=KeyboardInteractionDisplay.js.map