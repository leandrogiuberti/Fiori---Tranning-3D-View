/*!
 * OpenUI5
 * (c) Copyright 2025 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["../base/ManagedObject","../base/OwnStatics","./Element","./DeclarativeSupport","./XMLTemplateProcessor","sap/base/future","sap/base/Log","sap/base/util/LoaderExtensions","sap/base/util/merge","sap/ui/util/XMLHelper","sap/ui/core/Component","sap/ui/core/mvc/XMLProcessingMode"],function(e,t,n,i,r,o,a,s,f,m,g,u){"use strict";var p={},c={};const{getCurrentOwnerId:l,runWithPreprocessors:h}=t.get(e);var d=e.extend("sap.ui.core.Fragment",{metadata:{properties:{type:"string"},specialSettings:{async:{type:"boolean",visibility:"hidden"},fragmentName:"string",fragmentContent:"any",containingView:{type:"sap.ui.core.mvc.View",visibility:"hidden"},oController:{type:"sap.ui.core.mvc.Controller",visibility:"hidden"},sId:{type:"sap.ui.core.ID",visibility:"hidden"},sOwnerId:{type:"sap.ui.core.ID",visibility:"hidden"},processingMode:{type:"sap.ui.core.mvc.XMLProcessingMode",visibility:"hidden"}}},constructor:function(t,n){e.apply(this,arguments);if(!this._bAsync){if(this._aContent&&this._aContent.length==1){return this._aContent[0]}else{return this._aContent}}}});d.registerType=function(e,t){if(typeof e!=="string"){o.errorThrows("Invalid non-string Fragment type: '"+e+"'.",{suffix:"It will be ignored."});return}if(c[e]){a.warning("sap.ui.core.Fragment.registerType(): Fragment type '"+e+"' is already defined. Overriding this type now!")}c[e]=t};d.prototype._initCompositeSupport=function(e){if(!e){throw new Error("Settings must be set")}if(!(e.fragmentName||e.fragmentContent)){throw new Error("Please provide a fragment name")}if(e.oController){this.oController=e.oController}this._bAsync=e.async||false;this._sExplicitId=e.sId||e.id;this._sFragmentName=e.fragmentName;this.fnScopedRunWithOwner=e.containingView&&e.containingView.fnScopedRunWithOwner;if(!this.fnScopedRunWithOwner&&this._sOwnerId){var t=g.getComponentById(this._sOwnerId);this.fnScopedRunWithOwner=function(e){return t.runAsOwner(e)}}var n=d.getType(e.type);if(n){this._pContentPromise=n.init.apply(this,[e]);if(!this._pContentPromise){this._pContentPromise=Promise.resolve(this._aContent)}}else{throw new Error("No type for the fragment has been specified: "+e.type)}};d.prototype.getFragmentName=function(){return this._sFragmentName};d.prototype.getController=function(){return this.oController};d.byId=function(e,t){if(!(typeof e==="string"&&typeof t==="string")){o.errorThrows("sap.ui.core.Fragment.byId: two strings must be given as parameters, but are: "+e+" and "+t);return undefined}return n.getElementById(e+"--"+t)};d.createId=function(e,t){if(!(typeof e==="string"&&typeof t==="string")){o.errorThrows("sap.ui.core.Fragment.createId: two strings must be given as parameters, but are: "+e+" and "+t);return undefined}return e+"--"+t};d.prototype.createId=function(e){var t=this._sExplicitId?this._sExplicitId+"--"+e:e;if(this._oContainingView&&this._oContainingView!=this){t=this._oContainingView.createId(t)}return t};d.prototype.isSubView=function(){return true};sap.ui.fragment=function(e,t,n){var i;if(typeof t==="string"){i=t.toLowerCase()}else if(typeof e==="object"&&typeof e.type==="string"){i=e.type.toLowerCase()}else{i=""}a.info("Do not use deprecated factory function 'sap.ui."+i+"fragment'.","sap.ui."+i+"fragment",null,function(){var t={type:"sap.ui."+i+"fragment",name:(e.fragmentName||e)+".fragment."+i};if(e.fragmentContent){t.content=e.fragmentContent;t.name=""}return t});if(typeof e==="object"&&e.fragmentName?.startsWith("module:")||typeof e==="string"&&e.startsWith("module:")){throw new Error(`sap.ui.fragment(): module name syntax '${e.fragmentName||e}' is not supported.`)}return y(e,t,n)};function y(e,t,n){var i={};if(typeof e==="string"){i.fragmentName=e;i.oController=n;i.type=t}else if(typeof e==="object"){i=e;i.async=i.async===true?i.async:false;if(t){i.oController=t}if(i.async){var r=function(){var e=i.sOwnerId||i.containingView&&i.containingView._sOwnerId;var t=g.getComponentById(e);if(t){return t.runAsOwner(function(){return new d(i)})}return new d(i)};var o=d.getType(i.type);if(i.fragmentName&&i.fragmentContent){delete i.fragmentName}if(i.fragmentName&&typeof o.load=="function"){return new Promise(function(e,t){o.load(i).then(function(t){i.fragmentContent=t;e(r())}).catch(function(e){t(e)})})}else{return Promise.resolve(r())}}}else{a.error("sap.ui.fragment() must be called with Fragment name or config object as first parameter, but is: "+e)}return new d(i)}d.load=function(e){var t=Object.assign({},e);if(t.name&&t.definition){a.error("The properties 'name' and 'definition' shouldn't be provided at the same time. The fragment definition will be used instead of the name. Fragment name was: "+t.name);delete t.name}if(t.name?.startsWith("module:")){if(t.type){throw new TypeError(`Invalid arguments: If the fragment name is given in module name syntax the type must be omitted. Found type: '${t.type}'.`)}else{t.type="JS"}}else{t.type??="XML"}t.async=true;t.processingMode=t.processingMode||u.Sequential;t.fragmentName=t.fragmentName||t.name;t.fragmentContent=t.fragmentContent||t.definition;t.oController=t.controller;t.sOwnerId=l();delete t.name;delete t.definition;delete t.controller;var n=y(t);return n.then(function(e){return e._pContentPromise})};d.getType=function(e){return c[e]};sap.ui.xmlfragment=function(e,t,n){if(typeof e==="string"){if(typeof t==="string"){return sap.ui.fragment({fragmentName:t,sId:e,type:"XML"},n)}else{return sap.ui.fragment(e,"XML",t)}}else{e.type="XML";return sap.ui.fragment(e,t)}};sap.ui.jsfragment=function(e,t,n){if(typeof e==="string"&&typeof t==="object"){if(t.createContent){p[e]=t;sap.ui.loader._.declareModule(e.replace(/\./g,"/")+".fragment.js")}else{return sap.ui.fragment(e,"JS",t)}}else if(typeof e==="string"&&t===undefined){return sap.ui.fragment(e,"JS")}else if(typeof e==="object"){e.type="JS";return sap.ui.fragment(e,t)}else if(arguments.length>=3){return sap.ui.fragment({id:e,fragmentName:t,type:"JS"},n)}else{a.error("sap.ui.jsfragment() was called with wrong parameter set: "+e+" + "+t)}};sap.ui.htmlfragment=function(e,t,n){if(typeof e==="string"){if(typeof t==="string"){return sap.ui.fragment({fragmentName:t,sId:e,type:"HTML"},n)}else{return sap.ui.fragment(e,"HTML",t)}}else{e.type="HTML";return sap.ui.fragment(e,t)}};d.registerType("XML",{load:function(e){return r.loadTemplatePromise(e.fragmentName,"fragment").then(function(e){return e})},init:function(e){this._aContent=[];if(e.fragmentContent){if(typeof e.fragmentContent==="string"){this._xContent=m.parse(e.fragmentContent).documentElement}else{this._xContent=e.fragmentContent}}else{a.warning("Synchronous loading of fragment, due to Fragment.init() call for '"+e.fragmentName+"'. Use 'sap/ui/core/Fragment' module with Fragment.load() instead.","SyncXHR",null,function(){return{type:"SyncXHR",name:"Fragment"}});this._xContent=r.loadTemplate(e.fragmentName,"fragment")}this._oContainingView=this._sExplicitId?this:e.containingView||this;if(this._oContainingView===this){this._oContainingView.oController=e.containingView&&e.containingView.oController||e.oController}this._sProcessingMode=e.processingMode;var t=this._oContainingView._fnSettingsPreprocessor;var i={fnRunWithPreprocessor:function(e){return h(e,{settings:t})}};var s=r.parseTemplatePromise(this._xContent,this,this._bAsync,i).then(function(t){this._aContent=t;if(this._aContent&&this._aContent.length&&e.objectBindings){this._aContent.forEach(function(t,i){if(t instanceof n){for(var r in e.objectBindings){t.bindObject(e.objectBindings[r])}}})}return this._aContent.length>1?this._aContent:this._aContent[0]}.bind(this));if(!this._bAsync){try{s.unwrap()}catch(t){o.errorThrows(this.getMetadata().getName()+": An Error occured during XML processing of '"+(e.fragmentName||e.fragmentContent)+"' with id '"+this.getId()+"'",{cause:t})}}return s}});d.registerType("JS",{load:function(e){let t;if(e.fragmentName.startsWith("module:")){t=e.fragmentName.substring(7)}else{t=e.fragmentName.replace(/\./g,"/")+".fragment"}return new Promise(function(e,n){sap.ui.require([t],function(t){e(t)},n)})},init:function(e){this._aContent=[];if(e.fragmentContent){f(this,e.fragmentContent)}else{(()=>{if(!p[e.fragmentName]){sap.ui.requireSync(e.fragmentName.replace(/\./g,"/")+".fragment")}})();f(this,p[e.fragmentName])}this._oContainingView=e.containingView||this;return h(function(){var t;if(this.fnScopedRunWithOwner){this.fnScopedRunWithOwner(function(){t=this.createContent(e.oController||this._oContainingView.oController)}.bind(this))}else{t=this.createContent(e.oController||this._oContainingView.oController)}if(t instanceof Promise){return t.then(function(e){this._aContent=this._aContent.concat(e);return this._aContent.length>1?this._aContent:this._aContent[0]}.bind(this))}else{return new Promise(function(e,n){this._aContent=this._aContent.concat(t);e(this._aContent.length>1?this._aContent:this._aContent[0])}.bind(this))}}.bind(this),{settings:this._oContainingView._fnSettingsPreprocessor})}});(function(){var e={};var t=function(t){var n=sap.ui.require.toUrl(t.replace(/\./g,"/"))+".fragment.html";var i=e[n];var r;if(!i){r=t.replace(/\./g,"/")+".fragment.html";i=s.loadResource(r);e[n]=i}return i};d.registerType("HTML",{load:function(e){var t=e.fragmentName.replace(/\./g,"/")+".fragment";return s.loadResource(t+".html",{async:true}).then(function(e){return e})},init:function(e){this._aContent=[];this.getContent=function(){return this._aContent};this.addContent=function(e){this._aContent.push(e)};this._oContainingView=e.containingView||this;this._sProcessingMode=e.processingMode;var n=e.fragmentContent||t(e.fragmentName);this._oTemplate=document.createElement("div");if(typeof n==="string"){this._oTemplate.innerHTML=n}else{var r=n;var o=document.createDocumentFragment();for(var a=0;a<r.length;a++){o.appendChild(r.item(a))}this._oTemplate.appendChild(o)}var s=this._oTemplate.getElementsByTagName("template")[0];var f=this.getMetadata().getAllProperties();if(s){var m=this;var g=s.getAttributeNames();for(var a=0;a<g.length-1;a++){var u=g[a];var p=i.convertAttributeToSettingName(u,m.getId());var c=s.getAttribute(u);var l=f[p];if(!e[p]){if(l){e[p]=i.convertValueToType(i.getPropertyDataType(l),c)}else if(sap.ui.core.mvc.HTMLView._mAllowedSettings[p]){e[p]=c}}}this._oTemplate=s}if(this._oTemplate.content){var d=this._oTemplate.content;this._oTemplate=document.createElement("div");this._oTemplate.appendChild(d)}return h(function(){if(this.fnScopedRunWithOwner){this.fnScopedRunWithOwner(function(){i.compile(this._oTemplate,this)}.bind(this))}else{i.compile(this._oTemplate,this)}var e=this.getContent();if(e&&e.length===1){this._aContent=[e[0]];return new Promise(function(e,t){e(this._aContent[0])}.bind(this))}}.bind(this),{settings:this._oContainingView._fnSettingsPreprocessor})}})})();return d});
//# sourceMappingURL=Fragment.js.map