/*!
 * OpenUI5
 * (c) Copyright 2025 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["sap/base/assert","sap/base/future","sap/base/Log","sap/base/util/extend","sap/base/util/isEmptyObject","sap/base/util/merge","sap/ui/base/ManagedObject","sap/ui/base/OwnStatics","sap/ui/core/Control","sap/ui/base/DesignTime","sap/ui/core/Element","./Controller","./ViewRenderer","./ViewType","./_ViewFactory","./XMLProcessingMode"],function(e,t,r,o,n,i,s,a,c,u,p,l,f,d,g,h){"use strict";const{getCurrentOwnerId:m,runWithPreprocessors:y}=a.get(s);var w=c.extend("sap.ui.core.mvc.View",{metadata:{interfaces:["sap.ui.core.IDScope"],abstract:true,library:"sap.ui.core",properties:{width:{type:"sap.ui.core.CSSSize",group:"Dimension",defaultValue:"100%"},height:{type:"sap.ui.core.CSSSize",group:"Dimension",defaultValue:null},viewName:{type:"string",group:"Misc",defaultValue:null},displayBlock:{type:"boolean",group:"Appearance",defaultValue:false}},defaultAggregation:"content",aggregations:{content:{type:"sap.ui.core.Control",multiple:true,singularName:"content"}},events:{afterInit:{},beforeExit:{},afterRendering:{},beforeRendering:{}},specialSettings:{controller:"sap.ui.core.mvc.Controller",controllerName:"string",preprocessors:"Object",resourceBundleName:"string",resourceBundleUrl:"sap.ui.core.URI",resourceBundleLocale:"string",resourceBundleAlias:"string",type:"string",definition:"any",viewContent:{type:"any",deprecated:true},viewData:"any",async:{type:"boolean",defaultValue:false}},designtime:"sap/ui/core/designtime/mvc/View.designtime"},renderer:f});const v={};function C(e){e._settings={};for(var t in e){if(t.indexOf("_")!==0){e._settings[t]=e[t]}}}function P(e,t){var r;if(typeof e.preprocessor==="string"){var o=e.preprocessor.replace(/\./g,"/");if(t){return new Promise(function(e,t){sap.ui.require([o],function(t){e(t)},t)})}else{return sap.ui.requireSync(o)}}else if(typeof e.preprocessor==="function"&&!e.preprocessor.process){r={process:e.preprocessor}}else{r=e.preprocessor}if(t){return Promise.resolve(r)}else{return r}}function b(e,t){var r=this.mPreprocessors[t]||[],n=[],i,s,a,c=[];if(v[e]&&v[e][t]){n=v[e][t].map(function(e){return Object.assign({},e)})}for(i=0,s=n.length;i<s;i++){if(n[i]._onDemand){a=n[i]}else{c.push(n[i])}}for(i=0,s=r.length;i<s;i++){var u=!r[i].preprocessor;if(u&&a){c.unshift(o(r[i],a))}else if(!u){c.push(r[i])}}return c}function I(e,t){var r=e.getMetadata().getClass();function o(e){e.preprocessor=P(e,t.async)}e.mPreprocessors=Object.assign({},t.preprocessors);for(var n in r.PreprocessorType){var i=r.PreprocessorType[n];if(e.mPreprocessors[i]&&!Array.isArray(e.mPreprocessors[i])){e.mPreprocessors[i]=[e.mPreprocessors[i]]}else if(!e.mPreprocessors[i]){e.mPreprocessors[i]=[]}e.mPreprocessors[i].forEach(C);e.mPreprocessors[i]=b.call(e,r._sType,i);e.mPreprocessors[i].forEach(o)}}function V(e){e.oAsyncState={};e.oAsyncState.promise=null}var S=function(e,t){var r=t.async;var o=function(t){e.oController=t;t.oView=e};if(!u.isControllerCodeDeactivated()){var n=t.controller,i=n&&typeof n.getMetadata==="function"&&n.getMetadata().getName();if(!n){e.bControllerIsViewManaged=true;let t=e._getControllerModuleName()||e._getControllerName();if(t){var s=sap.ui.require("sap/ui/core/Component");if(s){var a=s.getCustomizing(e,{type:"sap.ui.controllerReplacements",name:t});if(a){t=typeof a==="string"?a:a.controllerName}}if(r){n=l.create({name:t,_viewId:e.sId})}else{n=sap.ui.controller(t,true,false,e.sId)}}}else{e.bControllerIsViewManaged=false;var c=m();if(!n._isExtended()){n=l.applyExtensions(n,i,c,e.sId,r)}else if(r){n=Promise.resolve(n)}}if(n){if(r){if(!e.oAsyncState){throw new Error("The view "+e.sViewName+" runs in sync mode and therefore cannot use async controller extensions!")}return n.then(o)}else{o(n)}}}else if(r){const e=Object.assign(new l,{"_sap.ui.core.mvc.EmptyControllerImpl":true});return Promise.resolve(e).then(o)}else{sap.ui.controller("sap.ui.core.mvc.EmptyControllerImpl",{"_sap.ui.core.mvc.EmptyControllerImpl":true});e.oController=sap.ui.controller("sap.ui.core.mvc.EmptyControllerImpl")}};w.prototype._initCompositeSupport=function(i){i=i||{};e(!i.preprocessors||this.getMetadata().getName().indexOf("XMLView"),"Preprocessors only available for XMLView");this.oViewData=i.viewData;this.sViewName=i.viewName;if(this.sViewName&&this.sViewName.startsWith("module:")){this.sViewName=this.sViewName.slice("module:".length).replace(/\//g,".")}var s=this;I(this,i);if(i.async){V(this)}var a=sap.ui.require("sap/ui/core/Component");if(a){var c=a.getCustomizing(this,{type:"sap.ui.viewModifications",name:this.sViewName});if(!n(c)){this._fnSettingsPreprocessor=function(e){var n=this.getId();if(n){if(s.isPrefixedId(n)){n=n.substring((s.getId()+"--").length)}var i=Object.assign({},c[n]);if(i){for(var a in i){if(a!=="visible"){t.warningThrows(`Customizing: property '${a}' of control '${n}' in View '${s.sViewName}' cannot be customized, only 'visible' can.`,{suffix:"Property will be ignored"});delete i[a]}}r.info("Customizing: custom value for property 'visible' of control '"+n+"' in View '"+s.sViewName+"' applied: "+i.visible);e=o(e,i)}}}}}var u=function(t,r){e(typeof t==="function","fn must be a function");var o=a&&a.getOwnerComponentFor(s);if(o){if(r){s.fnScopedRunWithOwner=s.fnScopedRunWithOwner||function(e){return o.runAsOwner(e)}}return o.runAsOwner(t)}return t()};var p=function(e){if(e.oController&&e.oController.connectToView){return e.oController.connectToView(e)}};var l=function(e){if(s.onControllerConnected){return s.onControllerConnected(s.oController,e)}};if(i.async){this.oAsyncState.promise=this.initViewSettings(i).then(function(){return u(S.bind(null,s,i),true)}).then(function(){return u(l.bind(null,i),true)}).then(function(){return p(s)}).then(function(){return s.runPreprocessor("controls",s,false)}).then(function(){return u(s.fireAfterInit.bind(s),true)}).then(function(){return s}).catch(function(e){this.deregister();throw e}.bind(this))}else{this.initViewSettings(i);S(this,i);l(i);p(this);this.runPreprocessor("controls",this,true);this.fireAfterInit()}};w.prototype.getController=function(){return this.oController};w.prototype._getControllerName=function(){return this.getControllerName?.()};w.prototype._getControllerModuleName=function(){return this.getControllerModuleName?.()};w.prototype.byId=function(e){return p.getElementById(this.createId(e))};w.prototype.createId=function(e){if(!this.isPrefixedId(e)){e=this.getId()+"--"+e}return e};w.prototype.getLocalId=function(e){var t=this.getId()+"--";return e&&e.indexOf(t)===0?e.slice(t.length):null};w.prototype.isPrefixedId=function(e){return!!(e&&e.indexOf(this.getId()+"--")===0)};w.prototype.getViewData=function(){return this.oViewData};function N(){this.oAsyncState=null}w.prototype.exit=function(){this.fireBeforeExit();if(this.oController&&this.bControllerIsViewManaged){this.oController.destroy();delete this.oController}delete this.oPreprocessorInfo;if(this.oAsyncState){var e=N.bind(this);this.oAsyncState.promise.then(e,e)}};w.prototype.onAfterRendering=function(){this.fireAfterRendering()};w.prototype.onBeforeRendering=function(){this.fireBeforeRendering()};w.prototype.clone=function(e,r){t.errorThrows("Cloning a View and/or using a View as a binding template is deprecated. Please call the corresponding View factory instead, e.g. XMLView.create()");var o={},n,i;for(n in this.mProperties&&!(this.isBound&&this.isBound(n))){if(this.mProperties.hasOwnProperty(n)){o[n]=this.mProperties[n]}}i=c.prototype.clone.call(this,e,r,{cloneChildren:false,cloneBindings:true});var s,a,u;for(s in i.mEventRegistry){a=i.mEventRegistry[s];for(u=a.length-1;u>=0;u--){if(a[u].oListener===this.getController()){a[u]={oListener:i.getController(),fFunction:a[u].fFunction,oData:a[u].oData}}}}i.applySettings(o);return i};w.prototype.getPreprocessors=function(){return this.mPreprocessors};w.prototype.getPreprocessorInfo=function(e){if(!this.oPreprocessorInfo){this.oPreprocessorInfo={name:this.sViewName,componentId:this._sOwnerId,id:this.getId(),caller:this+" ("+this.sViewName+")",sync:!!e}}if(w._supportInfo){this.oPreprocessorInfo._supportInfo=w._supportInfo}return this.oPreprocessorInfo};w.prototype.runPreprocessor=function(e,t,o){var n=this.getPreprocessorInfo(o),i=this.mPreprocessors&&this.mPreprocessors[e]||[],s,a,c;if(!o){a=function(e,t){return function(r){return t.preprocessor.then(function(o){return o.process(r,e,t._settings)})}};c=Promise.resolve(t)}for(var u=0,p=i.length;u<p;u++){if(o&&i[u]._syncSupport===true){s=i[u].preprocessor.process;t=s(t,n,i[u]._settings)}else if(!o){c=c.then(a(n,i[u]))}else{r.debug('Async "'+e+'"-preprocessor was skipped in sync view execution for '+this.getMetadata().getClass()._sType+"View",this.getId())}}return o?t:c};function _(e,t){if(!v[t]){v[t]={}}if(!v[t][e]){v[t][e]=[]}}function M(e,t){return v[e][t].some(function(e){return!!e._onDemand})}w.registerPreprocessor=function(e,o,n,i,s,a){if(typeof s!=="boolean"){a=s;s=false}if(o){_(e,n);if(s&&M(n,e)){t.errorThrows(`${this.getMetadata().getName()}: Registration for "${e}" failed, only one on-demand-preprocessor allowed`);return}v[n][e].push({preprocessor:o,_onDemand:s,_syncSupport:i,_settings:a});r.debug("Registered "+(s?"on-demand-":"")+'preprocessor for "'+e+'"'+(i?" with syncSupport":""),this.getMetadata().getName())}else{t.errorThrows(`${this.getMetadata().getName()}: Registration for "${e}" failed, no preprocessor specified`)}};w.prototype.hasPreprocessor=function(e){return!!this.mPreprocessors[e].length};w.create=function(e){var t=i({},e);t.async=true;t.viewContent=t.definition;var r=sap.ui.require("sap/ui/core/Component");var o;if(r&&m()){o=r.getComponentById(m())}function n(){return g.create(t.id,t,t.type).loaded()}return new Promise(function(e,r){var o=g.getViewClassName(t);sap.ui.require([o],function(t){e(t)},r)}).then(function(e){if(e.getMetadata().isA("sap.ui.core.mvc.XMLView")){t.processingMode=h.Sequential}if(o){return o.runAsOwner(n)}else{return n()}})};sap.ui.view=function(e,t,o){var n=typeof e==="string"?e:t;n=typeof n==="object"?n.viewName:n;r.warning("Do not use deprecated view factory functions (View: "+n+"). "+"Use the static create function on the view module instead: [XML|HTML|JSON]View.create().","sap.ui.view",null,function(){return{type:"sap.ui.view",name:n}});return g.create(e,t,o)};w.prototype.loaded=function(){if(this.oAsyncState&&this.oAsyncState.promise){return this.oAsyncState.promise}else{return Promise.resolve(this)}};w.prototype.getAutoPrefixId=function(){return false};w.prototype.onControllerConnected=function(e,t){if(!this.createContent&&typeof this.createContent!=="function"){return}var r={id:this.getAutoPrefixId()?this.createId.bind(this):undefined,settings:this._fnSettingsPreprocessor};return y(function(){var r=this.createContent(e);if(t.async){r=Promise.resolve(r);return r.then(function(e){this.applySettings({content:e})}.bind(this))}else if(r instanceof Promise){throw new Error("An asynchronous view (createContent) cannot be instantiated synchronously. Affected view: '"+this.getMetadata().getName()+"'.")}else{this.applySettings({content:r})}}.bind(this),r)};w.prototype.initViewSettings=function(e){if(!this.getMetadata()._oRenderer){this.getMetadata().getRenderer=function(){return w.getMetadata().getRenderer()};this.getMetadata().getRendererName=function(){return w.getMetadata().getRendererName()}}if(e.async){return Promise.resolve()}};a.set(w,{_getPreprocessors:function(e,t){if(!v[e]){return[]}return v[e][t]||[]},_removePreprocessor:function(e,t,r,o,n){if(v[e]&&v[e][t]){const i=v[e][t];const s=i.findIndex(e=>!!e._onDemand===!!o&&!!e._syncSupport===!!n&&e.preprocessor===r);if(s>=0){return i.splice(s,1)[0]}}return null}});return w});
//# sourceMappingURL=View.js.map