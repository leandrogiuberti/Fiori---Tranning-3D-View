/*!
 * OpenUI5
 * (c) Copyright 2025 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["sap/base/util/restricted/_intersection","sap/base/util/restricted/_uniq","sap/ui/core/StaticArea","sap/ui/base/ManagedObject","sap/ui/dt/DOMUtil","sap/ui/dt/OverlayUtil"],function(t,e,n,i,o,r){"use strict";var s=i.extend("sap.ui.dt.MutationObserver",{metadata:{library:"sap.ui.dt",events:{domChanged:{parameters:{type:{type:"string"},targetNodes:{type:"element[]"}}}}}});s.prototype.init=function(){this._mutationOnTransitionend=this._callDomChangedCallback.bind(this,"MutationOnTransitionend");this._mutationOnAnimationEnd=this._callDomChangedCallback.bind(this,"MutationOnAnimationEnd");this._fireDomChangeOnScroll=this._fireDomChangeOnScroll.bind(this);this._mutationOnResize=this._callDomChangedOnResizeWithRoot.bind(this,"MutationOnResize");window.addEventListener("transitionend",this._mutationOnTransitionend,true);window.addEventListener("animationend",this._mutationOnAnimationEnd,true);window.addEventListener("scroll",this._fireDomChangeOnScroll,true);window.addEventListener("resize",this._mutationOnResize);this._aIgnoredMutations=[];this._bHandlerRegistered=false;this._mMutationHandlers={};this._aRootIds=[];this._startMutationObserver()};s.prototype.exit=function(){this._stopMutationObserver();window.removeEventListener("transitionend",this._mutationOnTransitionend,true);window.removeEventListener("animationend",this._mutationOnAnimationEnd,true);window.removeEventListener("scroll",this._fireDomChangeOnScroll,true);window.removeEventListener("resize",this._mutationOnResize);this._aIgnoredMutations=[];this._bHandlerRegistered=false;this._mMutationHandlers={}};s.prototype.ignoreOnce=function(t){this._aIgnoredMutations.push(t)};s.prototype.registerHandler=function(t,e,n){if(!this._mMutationHandlers[t]){this._mMutationHandlers[t]=[];this._bHandlerRegistered=true}this._mMutationHandlers[t].push(e);if(n&&this._aRootIds.indexOf(t)===-1){this._aRootIds.push(t)}};s.prototype.deregisterHandler=function(t){delete this._mMutationHandlers[t];if(Object.keys(this._mMutationHandlers).length===0){this._bHandlerRegistered=false}this._aRootIds=this._aRootIds.filter(function(e){return e!==t})};s.prototype._hasScrollbar=function(t,e){return t||o.hasScrollBar(e)};s.prototype._getIdsWhenRegistered=function(t,e,n){var i;if(e&&this._mMutationHandlers[e]){i=e;n.closestElementInWhitlist||=e}n.result=t?i:n.closestElementInWhitlist;return n};s.prototype._getClosestParentIdForNodeRegisteredWithScrollbar=function(t,e){var n={closestElementInWhitlist:undefined,result:undefined};var i=false;var o=e;var r=t;do{i=this._hasScrollbar(i,o);n=this._getIdsWhenRegistered(i,r,n);o=o.parentElement;r=o?o.getAttribute("data-sap-ui"):null}while(!(n.result&&i)&&o.length&&o[0]!==document);return n.result||n.closestElementInWhitlist};s.prototype._isNodeOverlayRelated=function(t,e){var n="overlay-container";if(o.contains(n,t)){return true}if(t===document.body){return e&&e.addedNodes&&e.addedNodes[0]&&e.addedNodes[0].getAttribute&&e.addedNodes[0].getAttribute("id")===n}return false};s.prototype._getRelevantElementId=function(t,e){var i=t&&t.getAttribute&&t.getAttribute("id");var r;if(!this._isNodeOverlayRelated(t,e)&&document.body.contains(t)&&i!==n.STATIC_UIAREA_ID&&!o.contains("sap-ui-preserve",t)){var s=0;while(this._aRootIds.length>s&&!r){if(o.contains(this._aRootIds[s],t)||t.contains(document.getElementById(this._aRootIds[s]))){r=this._aRootIds[s]}s++}}return r};s.prototype._getRelevantElementIdsFromStaticArea=function(e){return e.target.id===n.STATIC_UIAREA_ID&&t([].concat(Array.prototype.slice.call(e.addedNodes),Array.prototype.slice.call(e.removedNodes)).map(function(t){return t.id}),Object.keys(this._mMutationHandlers))};s.prototype._ignoreMutation=function(t){return this._aIgnoredMutations.some(function(e,n,i){if(e.target===t.target&&(!e.type||e.type===t.type)){i.splice(n,1);return true}return false})};s.prototype._getTargetNode=function(t){var e=t.type==="characterData"?t.target.parentNode:t.target;if(e&&e.getRootNode()&&e.getRootNode().host){return e.getRootNode().host}return e};s.prototype._callRelevantCallbackFunctions=function(t,n){t=e(t);t.forEach(function(t){(this._mMutationHandlers[t]||[]).forEach(function(t){t({type:n})})}.bind(this))};function a(t){this._oMutationObserver.observe(t,{childList:true,subtree:true,attributes:true,attributeFilter:["style","class","width","height","border"],characterData:true})}s.prototype._startMutationObserver=function(){this._oMutationObserver=new window.MutationObserver(function(t){if(this._bHandlerRegistered){var e=t.reduce(function(t,e){var n=[];var i=this._getTargetNode(e);var o=this._getRelevantElementId(i,e);if(o){n.push(o)}else{n=this._getRelevantElementIdsFromStaticArea(e)}if(n.length&&!this._ignoreMutation(e)){return t.concat(n)}return t}.bind(this),[]);if(e.length){this._callRelevantCallbackFunctions(e,"MutationObserver")}}}.bind(this));a.call(this,window.document)};s.prototype.addNode=function(t){a.call(this,t)};s.prototype._stopMutationObserver=function(){if(this._oMutationObserver){this._oMutationObserver.disconnect();delete this._oMutationObserver}};s.prototype._callDomChangedCallback=function(t,e){var n=e.target;if(this._bHandlerRegistered&&n!==window){var i=this._getRelevantElementId(n);if(i){this._callRelevantCallbackFunctions([i],t)}}};s.prototype._callDomChangedOnResizeWithRoot=function(t){if(this._aRootIds.length){if(this._iApplyStylesRequest){window.cancelAnimationFrame(this._iApplyStylesRequest)}this._iApplyStylesRequest=window.requestAnimationFrame(function(){this._callRelevantCallbackFunctions(this._aRootIds,t);delete this._iApplyStylesRequest}.bind(this))}};s.prototype._fireDomChangeOnScroll=function(t){var e=t.target;var i=[];if(this._bHandlerRegistered&&e!==document){var o=this._getRelevantElementId(e);if(o){i.push(o)}else if(e.getAttribute("id")!==n.STATIC_UIAREA_ID){i=this._aRootIds.filter(function(t){return e.contains(document.getElementById(t))})}if(i.length&&!r.getClosestOverlayForNode(e)){this._callRelevantCallbackFunctions(i,"MutationOnScroll")}}};return s});
//# sourceMappingURL=MutationObserver.js.map