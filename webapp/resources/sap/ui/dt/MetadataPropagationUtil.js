/*!
 * OpenUI5
 * (c) Copyright 2025 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["sap/ui/dt/Util","sap/base/util/merge","sap/base/util/isEmptyObject"],function(t,n,e){"use strict";var a={};a._getParentPropagationInfo=function(t){if(!t||!t.propagationInfos){return false}return[...t.propagationInfos]};a._getCurrentRelevantContainerPropagation=function(n,e){const a={};const o=typeof n.propagateRelevantContainer;if(!n.propagateRelevantContainer){return a}else if(o==="function"){a.relevantContainerFunction=n.propagateRelevantContainer;a.relevantContainerElement=e}else if(o==="boolean"){a.relevantContainerFunction=function(){return true};a.relevantContainerElement=e}else{const n=t.wrapError(`Wrong type: it should be either a function or a boolean value and it is:${o}`);const e="sap.ui.dt.MetadataPropagationUtil#_getCurrentRelevantContainerPropagation";n.name=`Error in ${e}`;n.message=`${e} / ${n.message}`;throw n}return a};a._getCurrentDesigntimePropagation=function(n,e){const a={};const o=typeof n.propagateMetadata;if(!n.propagateMetadata){return a}else if(o==="function"){a.relevantContainerElement=e;a.metadataFunction=n.propagateMetadata}else{const n=t.wrapError(`Wrong type: it should be a function and it is:${o}`);const e="sap.ui.dt.MetadataPropagationUtil#_getCurrentDesigntimePropagation";n.name=`Error in ${e}`;n.message=`${e} / ${n.message}`;throw n}return a};a._getPropagatedActions=function(t,n,e){const a=[];const o=t.getName(e)?.singular||e.getMetadata().getName().split(".").pop();t.getPropagateActions(e).forEach(n=>{const o=typeof n==="string"?n:n.action;const r=t.getAction(o,e);if(r&&!a.find(t=>t.name===o)){const t={name:o};if(n.isActive){t.isActive=n.isActive}a.push(t)}});n.propagatedActions?.forEach(t=>{const e=typeof t==="string"?t:t.action;const o=n.actions?.[e];if(o){const n={name:e};if(t.isActive){n.isActive=t.isActive}a.push(n)}});return a.length?{propagatedActionInfo:{propagatingControl:e,propagatingControlName:o,actions:a}}:null};a._setPropagationInfo=function(t,n,a){if(!a&&e(n)){return false}t.propagationInfos=a||[];if(!e(n)){t.propagationInfos.push(n)}return t};a.propagateMetadataToAggregationOverlay=function(t,n,o){const r=t.getDesignTimeMetadata();const i=r.getAggregation(n);const g=t.getElement();let s;let p;let c;let f;const u={...i};const l=a._getParentPropagationInfo(o);if(u&&!e(u)){c=a._getCurrentRelevantContainerPropagation(u,g);p=a._getCurrentDesigntimePropagation(u,g);f=a._getPropagatedActions(r,u,g)}if(l||!e(c)||!e(p)||!e(f)){s={...c,...p,...f};return a._setPropagationInfo(u,s,l)}return u};a.getRelevantContainerForPropagation=function(t,n){var e=false;if(!t||!t.propagationInfos){return false}t.propagationInfos.some(function(t){if(t.relevantContainerFunction&&t.relevantContainerFunction(n)){e=t.relevantContainerElement;return true}});return e||false};a.getMetadataForPropagation=function(t,a){let o={};if(!t||!t.propagationInfos){return false}function r(t,n){if(t&&n.propagatedActionInfo){n.propagatedActionInfo.actions.forEach(function(e){if(e.isActive&&!e.isActive(a)){return}t.propagatedActions||=[];t.propagatedActions.push({name:e.name,propagatingControl:n.propagatedActionInfo.propagatingControl,propagatingControlName:n.propagatedActionInfo.propagatingControlName})})}return t}const i=t.propagationInfos.slice().reverse();o=i.reduce(function(t,e){if(e.metadataFunction){let o=e.metadataFunction(a,e.relevantContainerElement);if(o&&e.propagatedActionInfo){o=r(o,e)}return n(t,o)}return n(r(t,e),t)},o);return e(o)?false:o};a.propagateMetadataToElementOverlay=function(t,e,o){var r=a.getRelevantContainerForPropagation(e,o);var i=a.getMetadataForPropagation(e,o);if(!r&&!i){return t}var g=n({},t);if(r){g.relevantContainer=r}if(i){if(i.actions===null||i.actions==="not-adaptable"){var s=o.getMetadata().getAllAggregations();var p=Object.keys(s);if(g.aggregations){p=p.concat(Object.keys(g.aggregations).filter(function(t){return p.indexOf(t)<0}))}else{g.aggregations={}}p.forEach(function(t){if(g.aggregations[t]&&g.aggregations[t].actions){g.aggregations[t].actions=i.actions}})}return n(g,i)}return g};return a},true);
//# sourceMappingURL=MetadataPropagationUtil.js.map