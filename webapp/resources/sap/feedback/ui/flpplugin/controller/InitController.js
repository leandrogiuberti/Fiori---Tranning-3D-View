"use strict";sap.ui.define(["sap/feedback/ui/thirdparty/sap-px/pxapi","sap/base/Log","sap/ui/Device","../common/Constants","../common/Util","../embeddedCfg/EmbeddedPxConfig","../pxapi/PxApiWrapper","../storage/PushStateMigrator"],function(e,r,n,t,i,a,u,o){"use strict";function f(e){return e&&e.__esModule&&typeof e.default!=="undefined"?e.default:e}function s(e){"@babel/helpers - typeof";return s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},s(e)}function l(e,r){if(!(e instanceof r))throw new TypeError("Cannot call a class as a function")}function c(e,r){for(var n=0;n<r.length;n++){var t=r[n];t.enumerable=t.enumerable||!1,t.configurable=!0,"value"in t&&(t.writable=!0),Object.defineProperty(e,p(t.key),t)}}function N(e,r,n){return r&&c(e.prototype,r),n&&c(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}function p(e){var r=O(e,"string");return"symbol"==typeof r?r:r+""}function O(e,r){if("object"!=s(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var t=n.call(e,r||"default");if("object"!=s(t))return t;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===r?String:Number)(e)}var d=e["Environment"];var T=f(t);var P=f(i);var v=f(a);var m=f(u);var I=f(o);var _=function(){function e(r){l(this,e);this._pxApiWrapper=new m(r)}return N(e,[{key:"pxApiWrapper",get:function e(){return this._pxApiWrapper}},{key:"init",value:function e(n,t){try{var i=function e(n){if(a)return n;r.error(T.ERROR.INIT_PARAMS_INCONSISTENT,undefined,T.COMPONENT.INIT_CONTROLLER);return false};var a=false;var u=this;if(!I.migrate()){r.error(T.ERROR.PUSH_STATE_MIGRATION_FAILED,undefined,T.COMPONENT.INIT_CONTROLLER);return Promise.resolve(false)}if(u.isPhone()){r.info(T.INFO.PHONE_NOT_SUPPORTED,undefined,T.COMPONENT.INIT_CONTROLLER);return Promise.resolve(false)}var o=function(){if(u.hasOldParameters(n)){return Promise.resolve(u.initWithOldParameters(n,t)).then(function(e){a=true;return e})}else return function(){if(u.hasNewParameters(n)){if(u.hasUrlParameters()){u.overwriteWithUrlParameters(n)}return Promise.resolve(u.initWithNewParameters(n,t)).then(function(e){a=true;return e})}}()}();return Promise.resolve(o&&o.then?o.then(i):i(o))}catch(e){return Promise.reject(e)}}},{key:"isPhone",value:function e(){return n.system.phone}},{key:"hasNewParameters",value:function e(n){if(n.configUrl&&n.unitId&&n.environment){r.debug(T.DEBUG.INIT_PARAMS_MANDATORY_FOUND_NEW,undefined,T.COMPONENT.INIT_CONTROLLER);return true}r.debug(T.DEBUG.INIT_PARAMS_MANDATORY_NOT_SET_NEW,undefined,T.COMPONENT.INIT_CONTROLLER);if(n.configJson){r.debug(T.DEBUG.INIT_PARAMS_MANDATORY_FOUND_JSON,undefined,T.COMPONENT.INIT_CONTROLLER);return true}r.debug(T.DEBUG.INIT_PARAMS_MANDATORY_NOT_SET_JSON,undefined,T.COMPONENT.INIT_CONTROLLER);return false}},{key:"hasOldParameters",value:function e(n){if(n.qualtricsInternalUri&&n.tenantId){r.debug(T.DEBUG.INIT_PARAMS_MANDATORY_FOUND_OLD,undefined,T.COMPONENT.INIT_CONTROLLER);return true}r.debug(T.DEBUG.INIT_PARAMS_MANDATORY_NOT_SET_OLD,undefined,T.COMPONENT.INIT_CONTROLLER);return false}},{key:"hasUrlParameters",value:function e(){if(P.isUnitIdUrlParamSet()&&P.isEnvironmentUrlParamSet()){r.debug(T.DEBUG.INIT_PARAMS_URL_MODIFIED,undefined,T.COMPONENT.INIT_CONTROLLER);return true}return false}},{key:"overwriteWithUrlParameters",value:function e(r){var n=P.getUnitIdUrlParamValue();if(n){r.unitId=n}var t=P.getEnvironmentUrlParamValue();if(t){r.environment=t}}},{key:"initWithNewParameters",value:function e(n,t){try{var i=function e(n){if(a)return n;r.error(T.ERROR.INIT_PARAMS_INCONSISTENT,undefined,T.COMPONENT.INIT_CONTROLLER);return false};var a=false;var u=this;var o=function(){if(n.configUrl&&!n.configJson){var e={tenantId:n.tenantId,tenantRole:n.tenantRole};var r={configUrl:n.configUrl,unitId:n.unitId,environment:n.environment};return Promise.resolve(u._pxApiWrapper.initialize(e,r,undefined,t)).then(function(e){a=true;return e})}else return function(){if(!n.configUrl&&n.configJson){var e={tenantId:n.tenantId,tenantRole:n.tenantRole};var r=n.configJson;return Promise.resolve(u._pxApiWrapper.initialize(e,undefined,r,t)).then(function(e){a=true;return e})}}()}();return Promise.resolve(o&&o.then?o.then(i):i(o))}catch(e){return Promise.reject(e)}}},{key:"initWithOldParameters",value:function e(r,n){try{var t=this;var i={version:"0.4.0",unitId:"83cec47d-199c-4fc9-8848-330c6e3ec6bb",environment:d.prod,startupConfig:{qualtricsInternalUri:r.qualtricsInternalUri,productName:r.productName,platformType:r.platformType,scopeSet:t.convertScopeSet(r.scopeSet)},runtimeConfig:{useApi:true},themingConfig:{writeToGlobals:true},pushConfig:v.pushConfig()};var a={tenantId:r.tenantId,tenantRole:r.tenantRole};return Promise.resolve(t._pxApiWrapper.initialize(a,undefined,i,n))}catch(e){return Promise.reject(e)}}},{key:"convertScopeSet",value:function e(r){var n={featurePush:T.SCOPE_SETS.APP_PUSH,dynamicPush:T.SCOPE_SETS.TIMED_PUSH};if(r){var t=r.split(",");t=this.appendManualScopeSet(t);var i=t.map(function(e){return n[e.trim()]||e.trim()});return i}return[T.SCOPE_SETS.MANUAL]}},{key:"appendManualScopeSet",value:function e(r){if(r.indexOf(T.SCOPE_SETS.MANUAL)>-1){return r}r.push(T.SCOPE_SETS.MANUAL);return r}}])}();return _});
//# sourceMappingURL=InitController.js.map