{"version":3,"file":"PluginController-dbg.js","names":["_catch","body","recover","result","e","then","_typeof","o","Symbol","iterator","constructor","prototype","_classCallCheck","a","n","TypeError","_defineProperties","r","t","length","enumerable","configurable","writable","Object","defineProperty","_toPropertyKey","key","_createClass","i","_toPrimitive","toPrimitive","call","String","Number","Constants","_interopRequireDefault","__Constants","UI5Util","__UI5Util","Util","__Util","AppContextData","__AppContextData","ThemeData","__ThemeData","ShellBarButton","__ShellBarButton","PluginController","pxApiWrapper","resourceBundle","_pxApiWrapper","_resourceBundle","value","initPlugin","_temp2","_this","prepareThemingSupport","initAppTriggeredPush","_temp","pxApi","isUserInitiatedFeedbackEnabled","Promise","resolve","initUserInitiatedFeedback","reject","initLastTheme","updateThemeId","getTheme","subscribeThemeChanged","_this2","initShellBarButton","openSurveyCallback","bind","Theming","attachApplied","themeChanged","eventData","onThemeChanged","theme","_this3","_temp3","getData","appContextData","openSurvey","error","message","Error","Log","ERROR","CANNOT_TRIGGER_USER_INITIATED_FEEDBACK","COMPONENT","PLUGIN_CONTROLLER","themeId","newThemeId","convertStringToThemeId","updateCurrentTheme","getEventBus","subscribe","EVENT_BUS","CHANNEL_ID","EVENT_ID","eventBusCallback","_","__","requestPush","unsubscribeFromTheEventBusForTesting","unsubscribe"],"sourceRoot":".","sources":["PluginController.ts"],"sourcesContent":["import { ThemeId } from '@sap-px/pxapi';\nimport { PushFeedbackRequestData } from '@sap-px/pxapi/dist/api/common/Types';\nimport ResourceBundle from 'sap/base/i18n/ResourceBundle';\nimport Log from 'sap/base/Log';\nimport Theming, { Theming$AppliedEvent } from 'sap/ui/core/Theming';\nimport Constants from '../common/Constants';\nimport UI5Util from '../common/UI5Util';\nimport Util from '../common/Util';\nimport AppContextData from '../data/AppContextData';\nimport ThemeData from '../data/ThemeData';\nimport PxApiWrapper from '../pxapi/PxApiWrapper';\nimport ShellBarButton from '../ui/ShellBarButton';\n\nexport default class PluginController {\n\tprivate _pxApiWrapper: PxApiWrapper;\n\tprivate _resourceBundle: ResourceBundle;\n\n\tconstructor(pxApiWrapper: PxApiWrapper, resourceBundle: ResourceBundle) {\n\t\tthis._pxApiWrapper = pxApiWrapper;\n\t\tthis._resourceBundle = resourceBundle;\n\t}\n\n\t// init\n\tasync initPlugin(): Promise<void> {\n\t\tif (this._pxApiWrapper.pxApi.isUserInitiatedFeedbackEnabled) {\n\t\t\tawait this.initUserInitiatedFeedback();\n\t\t}\n\t\tthis.prepareThemingSupport();\n\t\tthis.initAppTriggeredPush();\n\t}\n\n\tprivate prepareThemingSupport() {\n\t\tThemeData.initLastTheme();\n\t\tthis._pxApiWrapper.updateThemeId(UI5Util.getTheme() as ThemeId);\n\t\tthis.subscribeThemeChanged();\n\t}\n\n\tprivate async initUserInitiatedFeedback(): Promise<void> {\n\t\tawait ShellBarButton.initShellBarButton(this._resourceBundle, this.openSurveyCallback.bind(this));\n\t}\n\n\tprivate subscribeThemeChanged() {\n\t\t//ActionItem:  UI5 2.0 Refactoring required\n\t\t// Done but untested\n\t\tTheming.attachApplied(this.themeChanged.bind(this));\n\t}\n\n\tprivate themeChanged(eventData: Theming$AppliedEvent) {\n\t\tthis.onThemeChanged(eventData.theme);\n\t}\n\n\tprivate async openSurveyCallback(): Promise<void> {\n\t\ttry {\n\t\t\tconst appContextData = await AppContextData.getData();\n\t\t\tthis._pxApiWrapper.openSurvey(appContextData);\n\t\t} catch (error: unknown) {\n\t\t\tlet message;\n\t\t\tif (error instanceof Error) {\n\t\t\t\tmessage = error.message;\n\t\t\t}\n\t\t\tLog.error(Constants.ERROR.CANNOT_TRIGGER_USER_INITIATED_FEEDBACK, message, Constants.COMPONENT.PLUGIN_CONTROLLER);\n\t\t}\n\t}\n\n\tprivate onThemeChanged(themeId: string) {\n\t\tconst newThemeId = Util.convertStringToThemeId(themeId);\n\t\tthis._pxApiWrapper.updateThemeId(newThemeId);\n\t\tThemeData.updateCurrentTheme(newThemeId);\n\t}\n\n\tprivate initAppTriggeredPush(): void {\n\t\tUI5Util.getEventBus().subscribe(Constants.EVENT_BUS.CHANNEL_ID, Constants.EVENT_BUS.EVENT_ID, this.eventBusCallback, this);\n\t}\n\n\tprivate eventBusCallback(_: string, __: string, eventData: any): void {\n\t\tthis._pxApiWrapper.requestPush(eventData as PushFeedbackRequestData);\n\t}\n\n\tprivate unsubscribeFromTheEventBusForTesting(): void {\n\t\tUI5Util.getEventBus().unsubscribe(Constants.EVENT_BUS.CHANNEL_ID, Constants.EVENT_BUS.EVENT_ID, this.eventBusCallback, this);\n\t}\n}\n"],"mappings":"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","ignoreList":[]}