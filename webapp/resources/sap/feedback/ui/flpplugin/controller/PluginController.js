"use strict";sap.ui.define(["sap/base/Log","sap/ui/core/Theming","../common/Constants","../common/UI5Util","../common/Util","../data/AppContextData","../data/ThemeData","../ui/ShellBarButton"],function(e,t,r,n,i,o,u,a){"use strict";function s(e){return e&&e.__esModule&&typeof e.default!=="undefined"?e.default:e}function c(e,t){try{var r=e()}catch(e){return t(e)}if(r&&r.then){return r.then(void 0,t)}return r}function p(e){"@babel/helpers - typeof";return p="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},p(e)}function h(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function l(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,v(n.key),n)}}function f(e,t,r){return t&&l(e.prototype,t),r&&l(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function v(e){var t=m(e,"string");return"symbol"==typeof t?t:t+""}function m(e,t){if("object"!=p(e)||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!=p(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}var b=s(r);var y=s(n);var d=s(i);var T=s(o);var E=s(u);var g=s(a);var _=function(){function r(e,t){h(this,r);this._pxApiWrapper=e;this._resourceBundle=t}return f(r,[{key:"initPlugin",value:function e(){try{var t=function e(){r.prepareThemingSupport();r.initAppTriggeredPush()};var r=this;var n=function(){if(r._pxApiWrapper.pxApi.isUserInitiatedFeedbackEnabled){return Promise.resolve(r.initUserInitiatedFeedback()).then(function(){})}}();return Promise.resolve(n&&n.then?n.then(t):t(n))}catch(e){return Promise.reject(e)}}},{key:"prepareThemingSupport",value:function e(){E.initLastTheme();this._pxApiWrapper.updateThemeId(y.getTheme());this.subscribeThemeChanged()}},{key:"initUserInitiatedFeedback",value:function e(){try{var t=this;return Promise.resolve(g.initShellBarButton(t._resourceBundle,t.openSurveyCallback.bind(t))).then(function(){})}catch(e){return Promise.reject(e)}}},{key:"subscribeThemeChanged",value:function e(){t.attachApplied(this.themeChanged.bind(this))}},{key:"themeChanged",value:function e(t){this.onThemeChanged(t.theme)}},{key:"openSurveyCallback",value:function t(){try{var r=this;var n=c(function(){return Promise.resolve(T.getData()).then(function(e){r._pxApiWrapper.openSurvey(e)})},function(t){var r;if(t instanceof Error){r=t.message}e.error(b.ERROR.CANNOT_TRIGGER_USER_INITIATED_FEEDBACK,r,b.COMPONENT.PLUGIN_CONTROLLER)});return Promise.resolve(n&&n.then?n.then(function(){}):void 0)}catch(e){return Promise.reject(e)}}},{key:"onThemeChanged",value:function e(t){var r=d.convertStringToThemeId(t);this._pxApiWrapper.updateThemeId(r);E.updateCurrentTheme(r)}},{key:"initAppTriggeredPush",value:function e(){y.getEventBus().subscribe(b.EVENT_BUS.CHANNEL_ID,b.EVENT_BUS.EVENT_ID,this.eventBusCallback,this)}},{key:"eventBusCallback",value:function e(t,r,n){this._pxApiWrapper.requestPush(n)}},{key:"unsubscribeFromTheEventBusForTesting",value:function e(){y.getEventBus().unsubscribe(b.EVENT_BUS.CHANNEL_ID,b.EVENT_BUS.EVENT_ID,this.eventBusCallback,this)}}])}();return _});
//# sourceMappingURL=PluginController.js.map