{"version":3,"file":"PluginController.js","names":["_catch","body","recover","result","e","then","_typeof","o","Symbol","iterator","constructor","prototype","_classCallCheck","a","n","TypeError","_defineProperties","r","t","length","enumerable","configurable","writable","Object","defineProperty","_toPropertyKey","key","_createClass","i","_toPrimitive","toPrimitive","call","String","Number","Constants","_interopRequireDefault","__Constants","UI5Util","__UI5Util","Util","__Util","AppContextData","__AppContextData","ThemeData","__ThemeData","ShellBarButton","__ShellBarButton","PluginController","pxApiWrapper","resourceBundle","this","_pxApiWrapper","_resourceBundle","value","initPlugin","_temp2","_this","prepareThemingSupport","initAppTriggeredPush","_temp","pxApi","isUserInitiatedFeedbackEnabled","Promise","resolve","initUserInitiatedFeedback","reject","initLastTheme","updateThemeId","getTheme","subscribeThemeChanged","_this2","initShellBarButton","openSurveyCallback","bind","Theming","attachApplied","themeChanged","eventData","onThemeChanged","theme","_this3","_temp3","getData","appContextData","openSurvey","error","message","Error","Log","ERROR","CANNOT_TRIGGER_USER_INITIATED_FEEDBACK","COMPONENT","PLUGIN_CONTROLLER","themeId","newThemeId","convertStringToThemeId","updateCurrentTheme","getEventBus","subscribe","EVENT_BUS","CHANNEL_ID","EVENT_ID","eventBusCallback","_","__","requestPush","unsubscribeFromTheEventBusForTesting","unsubscribe"],"sources":["./PluginController.ts"],"sourcesContent":["import { ThemeId } from '@sap-px/pxapi';\nimport { PushFeedbackRequestData } from '@sap-px/pxapi/dist/api/common/Types';\nimport ResourceBundle from 'sap/base/i18n/ResourceBundle';\nimport Log from 'sap/base/Log';\nimport Theming, { Theming$AppliedEvent } from 'sap/ui/core/Theming';\nimport Constants from '../common/Constants';\nimport UI5Util from '../common/UI5Util';\nimport Util from '../common/Util';\nimport AppContextData from '../data/AppContextData';\nimport ThemeData from '../data/ThemeData';\nimport PxApiWrapper from '../pxapi/PxApiWrapper';\nimport ShellBarButton from '../ui/ShellBarButton';\n\nexport default class PluginController {\n\tprivate _pxApiWrapper: PxApiWrapper;\n\tprivate _resourceBundle: ResourceBundle;\n\n\tconstructor(pxApiWrapper: PxApiWrapper, resourceBundle: ResourceBundle) {\n\t\tthis._pxApiWrapper = pxApiWrapper;\n\t\tthis._resourceBundle = resourceBundle;\n\t}\n\n\t// init\n\tasync initPlugin(): Promise<void> {\n\t\tif (this._pxApiWrapper.pxApi.isUserInitiatedFeedbackEnabled) {\n\t\t\tawait this.initUserInitiatedFeedback();\n\t\t}\n\t\tthis.prepareThemingSupport();\n\t\tthis.initAppTriggeredPush();\n\t}\n\n\tprivate prepareThemingSupport() {\n\t\tThemeData.initLastTheme();\n\t\tthis._pxApiWrapper.updateThemeId(UI5Util.getTheme() as ThemeId);\n\t\tthis.subscribeThemeChanged();\n\t}\n\n\tprivate async initUserInitiatedFeedback(): Promise<void> {\n\t\tawait ShellBarButton.initShellBarButton(this._resourceBundle, this.openSurveyCallback.bind(this));\n\t}\n\n\tprivate subscribeThemeChanged() {\n\t\t//ActionItem:  UI5 2.0 Refactoring required\n\t\t// Done but untested\n\t\tTheming.attachApplied(this.themeChanged.bind(this));\n\t}\n\n\tprivate themeChanged(eventData: Theming$AppliedEvent) {\n\t\tthis.onThemeChanged(eventData.theme);\n\t}\n\n\tprivate async openSurveyCallback(): Promise<void> {\n\t\ttry {\n\t\t\tconst appContextData = await AppContextData.getData();\n\t\t\tthis._pxApiWrapper.openSurvey(appContextData);\n\t\t} catch (error: unknown) {\n\t\t\tlet message;\n\t\t\tif (error instanceof Error) {\n\t\t\t\tmessage = error.message;\n\t\t\t}\n\t\t\tLog.error(Constants.ERROR.CANNOT_TRIGGER_USER_INITIATED_FEEDBACK, message, Constants.COMPONENT.PLUGIN_CONTROLLER);\n\t\t}\n\t}\n\n\tprivate onThemeChanged(themeId: string) {\n\t\tconst newThemeId = Util.convertStringToThemeId(themeId);\n\t\tthis._pxApiWrapper.updateThemeId(newThemeId);\n\t\tThemeData.updateCurrentTheme(newThemeId);\n\t}\n\n\tprivate initAppTriggeredPush(): void {\n\t\tUI5Util.getEventBus().subscribe(Constants.EVENT_BUS.CHANNEL_ID, Constants.EVENT_BUS.EVENT_ID, this.eventBusCallback, this);\n\t}\n\n\tprivate eventBusCallback(_: string, __: string, eventData: any): void {\n\t\tthis._pxApiWrapper.requestPush(eventData as PushFeedbackRequestData);\n\t}\n\n\tprivate unsubscribeFromTheEventBusForTesting(): void {\n\t\tUI5Util.getEventBus().unsubscribe(Constants.EVENT_BUS.CHANNEL_ID, Constants.EVENT_BUS.EVENT_ID, this.eventBusCallback, this);\n\t}\n}\n"],"mappings":"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","ignoreList":[]}