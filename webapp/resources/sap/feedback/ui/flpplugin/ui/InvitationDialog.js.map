{"version":3,"file":"InvitationDialog.js","names":["PushType","___sap_px_pxapi","ButtonType","sap_m_library","DialogType","Ui5ControlFactory","_interopRequireDefault","__Ui5ControlFactory","Constants","__Constants","AppContextData","__AppContextData","InvitationDialog","resourceBundle","_classCallCheck","this","_resourceBundle","_createClass","key","value","surveyInvitationDialogShowCallback","eventData","_this","surveyInvitationDialogResponse","Promise","resolve","_resolveSurveyInvitation","_temp","showInvitation","showInvitationDialog","pushType","sendInvitationCallbackResponse","then","e","reject","_invitationDialog","createInvitationDialog","isOpen","setDismissButtonText","open","dismissButtonText","getText","timedPush","getEndButton","setText","onInvitationDialogClose","willProvideFeedback","_this2","close","_this3","getData","appContextData","surveyUser","textKey","_this$_resourceBundle","createFeedbackButton","_this4","createButton","type","Emphasized","text","press","createDismissButton","_this5","createDialog","Message","title","content","createFormattedText","htmlText","beginButton","endButton","escapeHandler","handleEscape","bind","SURVEY_INVITATION_DIALOG_ID","promise"],"sources":["./InvitationDialog.ts"],"sourcesContent":["import { PushType } from '@sap-px/pxapi';\nimport { SurveyInvitationDialogDecision, SurveyInvitationDialogEventData, SurveyInvitationResultData } from '@sap-px/pxapi/dist/api/common/Types';\nimport ResourceBundle from 'sap/base/i18n/ResourceBundle';\nimport Button from 'sap/m/Button';\nimport Dialog from 'sap/m/Dialog';\nimport { ButtonType, DialogType } from 'sap/m/library';\nimport Ui5ControlFactory from './Ui5ControlFactory';\nimport Constants from '../common/Constants';\nimport AppContextData from '../data/AppContextData';\n\nexport default class InvitationDialog {\n\tprivate _resourceBundle: ResourceBundle;\n\tprivate _invitationDialog: Dialog;\n\tprivate _resolveSurveyInvitation: SurveyInvitationDialogDecision;\n\n\tconstructor(resourceBundle: ResourceBundle) {\n\t\tthis._resourceBundle = resourceBundle;\n\t}\n\n\tpublic async surveyInvitationDialogShowCallback(eventData: SurveyInvitationDialogEventData): Promise<SurveyInvitationResultData> {\n\t\tconst surveyInvitationDialogResponse = new Promise<SurveyInvitationResultData>((resolve) => (this._resolveSurveyInvitation = resolve));\n\t\tif (eventData.showInvitation) {\n\t\t\tthis.showInvitationDialog(eventData.pushType);\n\t\t} else {\n\t\t\tawait this.sendInvitationCallbackResponse(true);\n\t\t}\n\t\treturn surveyInvitationDialogResponse;\n\t}\n\n\tprivate showInvitationDialog(pushType: PushType) {\n\t\tif (!this._invitationDialog) {\n\t\t\tthis._invitationDialog = this.createInvitationDialog();\n\t\t}\n\t\tif (!this._invitationDialog.isOpen()) {\n\t\t\tthis.setDismissButtonText(pushType);\n\t\t\tthis._invitationDialog.open();\n\t\t}\n\t}\n\n\tprivate setDismissButtonText(pushType: PushType) {\n\t\tlet dismissButtonText = this.getText('YOUR_OPINION_NOTNOW');\n\t\tif (pushType === PushType.timedPush) {\n\t\t\tdismissButtonText = this.getText('YOUR_OPINION_ASKLATERBUTTON');\n\t\t}\n\t\tthis._invitationDialog.getEndButton().setText(dismissButtonText);\n\t}\n\n\tprivate async onInvitationDialogClose(willProvideFeedback: boolean) {\n\t\tthis._invitationDialog.close();\n\t\tawait this.sendInvitationCallbackResponse(willProvideFeedback);\n\t}\n\n\tprivate async sendInvitationCallbackResponse(willProvideFeedback: boolean) {\n\t\tconst appContextData = await AppContextData.getData();\n\t\tthis._resolveSurveyInvitation({ appContextData: appContextData, surveyUser: willProvideFeedback });\n\t}\n\n\tprivate getText(textKey: string): string {\n\t\treturn this._resourceBundle.getText(textKey) ?? textKey;\n\t}\n\n\tprivate createFeedbackButton(): Button {\n\t\treturn Ui5ControlFactory.createButton({\n\t\t\ttype: ButtonType.Emphasized,\n\t\t\ttext: this.getText('YOUR_OPINION_PROVIDEBUTTON'),\n\t\t\tpress: () => {\n\t\t\t\tthis.onInvitationDialogClose(true);\n\t\t\t}\n\t\t});\n\t}\n\n\tprivate createDismissButton(): Button {\n\t\treturn Ui5ControlFactory.createButton({\n\t\t\ttext: this.getText('YOUR_OPINION_NOTNOW'),\n\t\t\tpress: () => {\n\t\t\t\tthis.onInvitationDialogClose(false);\n\t\t\t}\n\t\t});\n\t}\n\n\tprivate createInvitationDialog(): Dialog {\n\t\treturn Ui5ControlFactory.createDialog(\n\t\t\t{\n\t\t\t\ttype: DialogType.Message,\n\t\t\t\ttitle: this.getText('YOUR_OPINION_TITLE'),\n\t\t\t\tcontent: Ui5ControlFactory.createFormattedText({ htmlText: this.getText('YOUR_OPINION_TEXT') }),\n\t\t\t\tbeginButton: this.createFeedbackButton(),\n\t\t\t\tendButton: this.createDismissButton(),\n\t\t\t\tescapeHandler: this.handleEscape.bind(this)\n\t\t\t},\n\t\t\tConstants.SURVEY_INVITATION_DIALOG_ID\n\t\t);\n\t}\n\n\tprivate handleEscape(promise: { resolve(): void; reject(): void }) {\n\t\tpromise.resolve();\n\t\tthis.onInvitationDialogClose(false);\n\t}\n}\n"],"mappings":"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","ignoreList":[]}