{"version":3,"file":"AppContextData.js","names":["ThemeData","_interopRequireDefault","__ThemeData","Constants","__Constants","UI5Util","__UI5Util","Util","__Util","AppContextData","_classCallCheck","this","_createClass","key","value","getData","_this","Promise","resolve","calculateAppContextData","e","reject","_this2","getCurrentApp","then","currentApp","isAppTypeSupported","applicationType","toLowerCase","getAppInfo","appInfo","getContextData","Log","warning","WARNING","UNSUPPORTED_APP_TYPE","undefined","COMPONENT","APP_CONTEXT_DATA","_appContextData","error","ERROR","CURRENT_APP_NOT_AVAILABLE","Error","appType","SUPPORTED_APP_TYPES","indexOf","getInfo","_currentApp$getInfo","metadata","AppConfiguration","getMetadata","title","appTitle","appId","LAUNCHPAD_VALUE","stringToTitleCase","_this3","contextData","previousTheme","getPreviousTheme","theme","getTheme","languageTag","getLanguage","appFrameworkId","convertAppFrameworkTypeToId","appFrameworkVersion","DEFAULT_VALUE_NA","technicalAppComponentId","appVersion","appSupportInfo","formatLanguageTag","_defineProperty"],"sources":["./AppContextData.ts"],"sourcesContent":["import * as PxApiTypes from '@sap-px/pxapi/dist/api/common/Types';\nimport Log from 'sap/base/Log';\nimport AppConfiguration from 'sap/ushell/services/AppConfiguration';\n\nimport { CurrentApplication } from 'sap/ushell/services/AppLifeCycle';\nimport ThemeData from './ThemeData';\nimport Constants from '../common/Constants';\nimport { AppInfo } from '../common/Types';\nimport UI5Util from '../common/UI5Util';\nimport Util from '../common/Util';\n\n/**\n * NOTE: Need to verify few un-identified UI5 Types which are currently missing in UI5 type definitions, marked them as TODO below.\n */\n\nexport default class AppContextData {\n\tprivate static readonly _appContextData: PxApiTypes.AppContextData = {\n\t\tappFrameworkId: Constants.DEFAULT_VALUE_NA,\n\t\tappFrameworkVersion: Constants.DEFAULT_VALUE_NA,\n\t\ttheme: Constants.DEFAULT_VALUE_NA,\n\t\tappId: Constants.DEFAULT_VALUE_NA,\n\t\tappTitle: Constants.DEFAULT_VALUE_NA,\n\t\tlanguageTag: Constants.DEFAULT_VALUE_NA,\n\t\ttechnicalAppComponentId: Constants.DEFAULT_VALUE_NA,\n\t\tappVersion: Constants.DEFAULT_VALUE_NA,\n\t\tappSupportInfo: Constants.DEFAULT_VALUE_NA\n\t};\n\n\tstatic async getData(): Promise<PxApiTypes.AppContextData> {\n\t\treturn await this.calculateAppContextData();\n\t}\n\n\tprivate static async calculateAppContextData(): Promise<PxApiTypes.AppContextData> {\n\t\tconst currentApp = await UI5Util.getCurrentApp();\n\t\tif (currentApp) {\n\t\t\tif (this.isAppTypeSupported(currentApp.applicationType.toLowerCase())) {\n\t\t\t\tconst appInfo = await this.getAppInfo(currentApp);\n\t\t\t\treturn this.getContextData(appInfo);\n\t\t\t} else {\n\t\t\t\tLog.warning(Constants.WARNING.UNSUPPORTED_APP_TYPE, undefined, Constants.COMPONENT.APP_CONTEXT_DATA);\n\t\t\t\treturn this._appContextData;\n\t\t\t}\n\t\t} else {\n\t\t\tLog.error(Constants.ERROR.CURRENT_APP_NOT_AVAILABLE, undefined, Constants.COMPONENT.APP_CONTEXT_DATA);\n\t\t\tthrow new Error(Constants.ERROR.CURRENT_APP_NOT_AVAILABLE);\n\t\t}\n\t}\n\n\tprivate static isAppTypeSupported(appType: string): boolean {\n\t\treturn Constants.SUPPORTED_APP_TYPES.indexOf(appType) > -1;\n\t}\n\n\tprivate static async getAppInfo(currentApp: CurrentApplication): Promise<AppInfo> {\n\t\tconst appInfo = (await currentApp.getInfo([\n\t\t\t'appId',\n\t\t\t'appVersion',\n\t\t\t'appSupportInfo',\n\t\t\t'technicalAppComponentId',\n\t\t\t'appFrameworkId',\n\t\t\t'appFrameworkVersion'\n\t\t])) as AppInfo;\n\t\tif (appInfo) {\n\t\t\tconst metadata = AppConfiguration.getMetadata(); // Open: no getMetadata function as per definition\n\t\t\tif (metadata?.title) {\n\t\t\t\tappInfo.appTitle = metadata.title;\n\t\t\t}\n\t\t\tif (appInfo?.appId === Constants.LAUNCHPAD_VALUE) {\n\t\t\t\tappInfo.appTitle = Util.stringToTitleCase(appInfo.appId);\n\t\t\t}\n\t\t}\n\t\treturn appInfo;\n\t}\n\n\tprivate static async getContextData(appInfo: AppInfo): Promise<PxApiTypes.AppContextData> {\n\t\tconst contextData = {} as PxApiTypes.AppContextData;\n\t\tcontextData.previousTheme = ThemeData.getPreviousTheme();\n\t\tcontextData.theme = UI5Util.getTheme();\n\n\t\tcontextData.languageTag = this.getLanguage();\n\t\tif (appInfo) {\n\t\t\tcontextData.appFrameworkId = Util.convertAppFrameworkTypeToId(appInfo['appFrameworkId']);\n\t\t\tcontextData.appFrameworkVersion = appInfo['appFrameworkVersion'] || Constants.DEFAULT_VALUE_NA;\n\t\t\tcontextData.appId = appInfo['appId'] || Constants.DEFAULT_VALUE_NA;\n\t\t\tcontextData.appTitle = appInfo['appTitle'] || Constants.DEFAULT_VALUE_NA;\n\t\t\tcontextData.technicalAppComponentId = appInfo['technicalAppComponentId'] || Constants.DEFAULT_VALUE_NA;\n\t\t\tcontextData.appVersion = appInfo['appVersion'] || Constants.DEFAULT_VALUE_NA;\n\t\t\tcontextData.appSupportInfo = appInfo['appSupportInfo'] || Constants.DEFAULT_VALUE_NA;\n\t\t} else {\n\t\t\tcontextData.appFrameworkId = Util.convertAppFrameworkTypeToId(undefined);\n\t\t\tcontextData.appFrameworkVersion = Constants.DEFAULT_VALUE_NA;\n\t\t\tcontextData.appId = Constants.DEFAULT_VALUE_NA;\n\t\t\tcontextData.appTitle = Constants.DEFAULT_VALUE_NA;\n\t\t\tcontextData.technicalAppComponentId = Constants.DEFAULT_VALUE_NA;\n\t\t\tcontextData.appVersion = Constants.DEFAULT_VALUE_NA;\n\t\t\tcontextData.appSupportInfo = Constants.DEFAULT_VALUE_NA;\n\t\t}\n\t\treturn contextData;\n\t}\n\n\tprivate static getLanguage(): string {\n\t\treturn Util.formatLanguageTag(UI5Util.getLanguage());\n\t}\n}\n"],"mappings":"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","ignoreList":[]}