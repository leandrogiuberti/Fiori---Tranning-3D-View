/*!
 * SAP UI development toolkit for HTML5 (SAPUI5) (c) Copyright 2009-2014 SAP SE. All rights reserved
 */
jQuery.sap.declare("sap.ca.ui.InPlaceEdit");jQuery.sap.require("sap.ca.ui.library");jQuery.sap.require("sap.ui.core.Control");sap.ui.core.Control.extend("sap.ca.ui.InPlaceEdit",{metadata:{deprecated:true,library:"sap.ca.ui",properties:{valueState:{type:"sap.ui.core.ValueState",group:"Data",defaultValue:sap.ui.core.ValueState.None},undoEnabled:{type:"boolean",group:"Misc",defaultValue:false}},aggregations:{content:{type:"sap.ui.core.Control",multiple:false}},events:{change:{parameters:{newValue:{type:"string"}}}}}});jQuery.sap.require("sap.m.Input");jQuery.sap.require("sap.m.Select");jQuery.sap.require("sap.m.Link");sap.ca.ui.InPlaceEdit.prototype.init=function(){this._bEditMode=false};sap.ca.ui.InPlaceEdit.prototype.exit=function(){this._bEditMode=undefined;this._oDisplayControl=undefined;this._oEditControl=undefined;this._sOldText=undefined;this._sOldTextAvailable=undefined;this._bUseEditButton=undefined;this._iHeight=undefined;if(this._oTextView){this._oTextView.destroy();delete this._oTextView}if(this._oTextField){this._oTextField.destroy();delete this._oTextField}if(this._oUndoButton){this._oUndoButton.destroy();delete this._oUndoButton}if(this._oEditButton){this._oEditButton.destroy();delete this._oEditButton}var t=this.getContent();if(t){t.detachEvent("_change",this._handleContentInvalidate,this);if(t instanceof sap.m.Input){t.detachEvent("change",this._handleContentChange,this);t.detachEvent("liveChange",this._handleContentLiveChange,this)}}};sap.ca.ui.InPlaceEdit.prototype.onBeforeRendering=function(){if(!jQuery.device.is.desktop){this.$().off("focusout blur",jQuery.proxy(this.onfocusout,this))}this._updateControls();this._createUndoButton()};sap.ca.ui.InPlaceEdit.prototype.onAfterRendering=function(){if(!jQuery.device.is.desktop){this.$().on("focusout blur",jQuery.proxy(this.onfocusout,this))}if(!this._bEditMode&&this.getEditable()&&this._oTextView&&jQuery.sap.domById(this._oTextView.getId())){jQuery.sap.byId(this._oTextView.getId()).attr("tabindex","0")}var t=jQuery.sap.byId(this.getId());if(this._bEditMode){jQuery.sap.byId(this._oEditControl.getId()).css("width","100%");if(this._iHeight>0){var e=t.height();var i=this._iHeight-e;var a=t.outerHeight(true)-t.outerHeight(false);i=i+a;var s=Math.floor(i/2);var n=i-s;t.css("margin-top",s+"px").css("margin-bottom",n+"px")}}else if(this._oDisplayControl instanceof sap.m.Link){jQuery.sap.byId(this._oDisplayControl.getId()).css("width","auto").css("max-width","100%")}else{var o=jQuery.sap.byId(this._oDisplayControl.getId());o.css("width","100%");if(!this._iHeight&&this._iHeight!=0){var d=o.outerHeight(true);var e=t.innerHeight();if(e<d){var l=t.outerHeight()-t.innerHeight();this._iHeight=d+l}else{this._iHeight=0}}if(this._iHeight>0){t.css("height",this._iHeight+"px")}}if(this._sOldTextAvailable&&this._oUndoButton&&jQuery.sap.domById(this._oUndoButton.getId())){jQuery.sap.byId(this._oUndoButton.getId()).attr("tabindex","-1")}if(this._oEditButton&&jQuery.sap.domById(this._oEditButton.getId())){jQuery.sap.byId(this._oEditButton.getId()).attr("tabindex","-1")}if(this._delayedCallId){jQuery.sap.clearDelayedCall(this._delayedCallId);this._delayedCallId=null}if(this.getValueState()==sap.ui.core.ValueState.Success){this._delayedCallId=jQuery.sap.delayedCall(3e3,this,"removeValidVisualization")}};sap.ca.ui.InPlaceEdit.prototype.removeValidVisualization=function(){var t=jQuery.sap.byId(this.getId());if(t){t.removeClass("sapCaUiIpeSucc")}};sap.ca.ui.InPlaceEdit.prototype.clearOldText=function(){if(!this.getUndoEnabled()){return}if(this._bEditMode){this._sOldText=this._oEditControl.getValue();this._sOldTextAvailable=true}else{this._sOldText=undefined;this._sOldTextAvailable=false}this.rerender()};sap.ca.ui.InPlaceEdit.prototype.getRequired=function(){if(this.getContent()&&this.getContent().getRequired){return this.getContent().getRequired()}else{return false}};sap.ca.ui.InPlaceEdit.prototype.getEditable=function(){var t=this.getContent();if(t.getEditable&&!t.getEditable()||t.getEnabled&&!t.getEnabled()){return false}else{return true}};sap.ca.ui.InPlaceEdit.prototype.onsapescape=function(t){if(this.getUndoEnabled()){if(!!!sap.ui.Device.browser.firefox){this._undoTextChange()}else{this._bEsc=true}if(jQuery.sap.byId(this.getId()).hasClass("sapCaUiIpeUndo")){t.stopPropagation()}this._oEditControl._bEsc=undefined;this._oEditControl._sValue=undefined}};sap.ca.ui.InPlaceEdit.prototype.onkeypress=function(t){if(this._bEsc){this._bEsc=undefined;this._undoTextChange()}};sap.ca.ui.InPlaceEdit.prototype.onkeydown=function(t){if(t.keyCode==jQuery.sap.KeyCodes.F2&&!this._bEditMode){this._switchToEditMode();jQuery.sap.byId(this.getId()).addClass("sapCaUiIpeFocus")}};sap.ca.ui.InPlaceEdit.prototype.ontap=function(t){if(!jQuery.device.is.desktop){this.onfocusin(t)}};sap.ca.ui.InPlaceEdit.prototype.onfocusin=function(t){if(!this._bEditMode){if(!this._bUseEditButton&&t.target.id!=this.getId()+"--X"){this._switchToEditMode()}jQuery.sap.byId(this.getId()).addClass("sapCaUiIpeFocus")}};sap.ca.ui.InPlaceEdit.prototype.onfocusout=function(t){if(this._focusDelay){jQuery.sap.clearDelayedCall(this._focusDelay);this._focusDelay=null}this._focusDelay=jQuery.sap.delayedCall(200,this,"_handleFocusOut",arguments)};sap.ca.ui.InPlaceEdit.prototype._handleFocusOut=function(t){var e=document.activeElement;if(!jQuery.sap.containsOrEquals(this.getDomRef(),e)){if(!this._bEditMode){jQuery.sap.byId(this.getId()).removeClass("sapCaUiIpeFocus")}this._switchToDisplayMode()}};sap.ca.ui.InPlaceEdit.prototype.setContent=function(t){var e=this.getContent();if(e){e.detachEvent("_change",this._handleContentInvalidate,this);if(e instanceof sap.m.Input){e.detachEvent("change",this._handleContentChange,this);e.detachEvent("liveChange",this._handleContentLiveChange,this);e._propagateEsc=undefined}}this._sOldText=undefined;this._sOldTextAvailable=false;this._oDisplayControl=undefined;this._oEditControl=undefined;this.setAggregation("content",t);if(t){t.attachEvent("_change",this._handleContentInvalidate,this);if(t instanceof sap.m.Input){t.attachEvent("change",this._handleContentChange,this);t.attachEvent("liveChange",this._handleContentLiveChange,this);t._propagateEsc=true}}this._updateControls()};sap.ca.ui.InPlaceEdit.prototype.setValueState=function(t){var e=this.getContent();if(e&&e.setValueState){e.setValueState(t)}else if(this._oEditControl&&this._oEditControl.setValueState){this._oEditControl.setValueState(t);this._handleContentInvalidate.call(this)}else{this.setProperty("valueState",t)}};sap.ca.ui.InPlaceEdit.prototype.getValueState=function(){var t=this.getContent();if(t&&t.getValueState){return t.getValueState()}else if(this._oEditControl&&this._oEditControl.getValueState){return this._oEditControl.getValueState()}else{return this.getProperty("valueState")}};sap.ca.ui.InPlaceEdit.prototype.setTooltip=function(t){var e=this.getContent();if(e){e.setTooltip(t)}else{if(t instanceof sap.ui.core.TooltipBase){t._currentControl=this;this.addDelegate(t)}this.setAggregation("tooltip",t)}return this};sap.ca.ui.InPlaceEdit.prototype.getTooltip=function(){var t=this.getContent();if(t){return t.getTooltip()}else{return this.getAggregation("tooltip")}};sap.ca.ui.InPlaceEdit.prototype.clone=function(){var t=this.getContent();if(t){t.detachEvent("_change",this._handleContentInvalidate,this);if(t instanceof sap.m.Input){t.detachEvent("change",this._handleContentChange,this);t.detachEvent("liveChange",this._handleContentLiveChange,this)}}var e=sap.ui.core.Control.prototype.clone.apply(this,arguments);if(t){t.attachEvent("_change",this._handleContentInvalidate,this);if(t instanceof sap.m.Input){t.attachEvent("change",this._handleContentChange,this);t.attachEvent("liveChange",this._handleContentLiveChange,this)}}return e};sap.ca.ui.InPlaceEdit.prototype.getFocusDomRef=function(){if(!this.getDomRef()){return}if(this._bEditMode){return this._oEditControl.getFocusDomRef()}else{return this._oDisplayControl.getFocusDomRef()}};sap.ca.ui.InPlaceEdit.prototype.getIdForLabel=function(){if(this._oDisplayControl){return this._oDisplayControl.getId()}else if(this._oEditControl){return this._oEditControl.getId()}else{return this.getId()}};sap.ca.ui.InPlaceEdit.prototype._contentDelegate={onAfterRendering:function(){this.onAfterRendering()}};sap.ca.ui.InPlaceEdit.prototype._updateControls=function(){var t=this;var e=t.getContent();if(!e){return}switch(e.getMetadata().getName()){case"sap.m.Input":case"sap.m.Select":if(!t._oTextView){t._oTextView=new sap.m.Text(t.getId()+"--TV",{wrapping:false});t._oTextView.setParent(t);t._oTextView.removeDelegate(this._contentDelegate);t._oTextView.addDelegate(this._contentDelegate,t)}t._oTextView.setText(e.getValue());t._oTextView.setVisible(e.getVisible());t._oTextView.setWidth("100%");t._oDisplayControl=t._oTextView;t._oEditControl=e;t._bUseEditButton=false;break;case"sap.m.Link":t._oDisplayControl=e;t._oDisplayControl.removeDelegate(this._contentDelegate);t._oDisplayControl.addDelegate(this._contentDelegate,t);if(t._oTextField){t._oTextField.setValue(e.getText());t._oTextField.setWidth("100%");t._oTextField.setTooltip(e.getTooltip());t._oEditControl=t._oTextField}this._createEditButton();t._bUseEditButton=true;break;default:throw new Error("Control '"+e.getMetadata().getName()+"' not supported for InPlaceEdit");break}};sap.ca.ui.InPlaceEdit.prototype._switchToEditMode=function(){var t=this;if(!t._bEditMode&&t.getEditable()){if(!t._oEditControl&&t.getContent().getMetadata().getName()=="sap.m.Link"){var e=t.getValueState();t._oTextField=new sap.m.Input(t.getId()+"--input",{valueState:e});t._oTextField.attachEvent("change",this._handleTextFieldChange,t);t._oTextField.attachEvent("liveChange",this._handleContentLiveChange,t);t._oTextField._propagateEsc=true}if(!t._sOldTextAvailable&&t.getUndoEnabled()){t._sOldText=this._getContentText();t._sOldTextAvailable=true}t._bEditMode=true;t.rerender();t._oEditControl.focus()}};sap.ca.ui.InPlaceEdit.prototype._switchToDisplayMode=function(){var t=this;if(t._bEditMode&&t.getEditable()){t._bEditMode=false;if(t._sOldText==this._getContentText()){t._sOldText=undefined;t._sOldTextAvailable=false}t.rerender()}};sap.ca.ui.InPlaceEdit.prototype._getContentText=function(){var t=this;var e=t.getContent();if(!e){return}if(e.getValue){return e.getValue()}else if(e.getText){return e.getText()}};sap.ca.ui.InPlaceEdit.prototype._createUndoButton=function(){var t=this;if(!t._oUndoButton&&t.getUndoEnabled()){t._oUndoButton=new sap.m.Button(t.getId()+"--X",{icon:"sap-icon://undo",type:sap.m.ButtonType.Transparent}).setParent(t);t._oUndoButton.attachEvent("press",this._handleUndoButtonPress,this)}};sap.ca.ui.InPlaceEdit.prototype._handleUndoButtonPress=function(t){this._undoTextChange();if(this._bEditMode){this._oEditControl.focus();jQuery.sap.byId(this.getId()).removeClass("sapCaUiIpeUndo")}};sap.ca.ui.InPlaceEdit.prototype._undoTextChange=function(){var t=this;if(t.getUndoEnabled()&&t._sOldTextAvailable){var e=t.getContent();if(!e){return}if(e.setValue){e.setValue(t._sOldText)}else if(e.setText){e.setText(t._sOldText)}if(t._bEditMode){t._oEditControl.setValue(t._sOldText)}if(e.fireChange){e.fireChange({newValue:t._sOldText})}else{t.fireChange({newValue:t._sOldText})}if(!t._bEditMode){t._sOldText=undefined;t._sOldTextAvailable=false}}};sap.ca.ui.InPlaceEdit.prototype._createEditButton=function(){var t=this;if(!t._oEditButton){t._oEditButton=new sap.m.Button(t.getId()+"--Edit",{icon:"sap-icon://edit",type:sap.m.ButtonType.Transparent}).setParent(t);t._oEditButton.addStyleClass("sapCaUiIpeEBtn");t._oEditButton.attachEvent("press",this._handleEditButtonPress,t)}};sap.ca.ui.InPlaceEdit.prototype._handleEditButtonPress=function(t){this._switchToEditMode();jQuery.sap.byId(this.getId()).addClass("sapCaUiIpeFocus")};sap.ca.ui.InPlaceEdit.prototype._handleTextFieldChange=function(t){var e=this.getContent();if(e.setText){var i=t.getParameter("newValue");e.setText(i);this.fireChange({newValue:i})}};sap.ca.ui.InPlaceEdit.prototype._handleContentChange=function(t){if(this._sOldText!=t.getParameter("newValue")&&this.getUndoEnabled()){jQuery.sap.byId(this.getId()).addClass("sapCaUiIpeUndo")}else{jQuery.sap.byId(this.getId()).removeClass("sapCaUiIpeUndo")}this.fireChange(t.getParameters())};sap.ca.ui.InPlaceEdit.prototype._handleContentLiveChange=function(t){if(this._sOldText!=t.getParameter("liveValue")&&this.getUndoEnabled()){jQuery.sap.byId(this.getId()).addClass("sapCaUiIpeUndo")}else{jQuery.sap.byId(this.getId()).removeClass("sapCaUiIpeUndo")}};sap.ca.ui.InPlaceEdit.prototype._handleContentInvalidate=function(){if(!this._bEditMode){this.invalidate()}else{switch(this.getValueState()){case sap.ui.core.ValueState.Error:if(!jQuery.sap.byId(this.getId()).hasClass("sapUiIpeErr")){jQuery.sap.byId(this.getId()).addClass("sapUiIpeErr");jQuery.sap.byId(this.getId()).removeClass("sapUiIpeWarn");jQuery.sap.byId(this.getId()).removeClass("sapUiIpeSucc")}break;case sap.ui.core.ValueState.Success:if(!jQuery.sap.byId(this.getId()).hasClass("sapUiIpeSucc")){jQuery.sap.byId(this.getId()).addClass("sapUiIpeSucc");jQuery.sap.byId(this.getId()).removeClass("sapUiIpeErr");jQuery.sap.byId(this.getId()).removeClass("sapUiIpeWarn")}break;case sap.ui.core.ValueState.Warning:if(!jQuery.sap.byId(this.getId()).hasClass("sapUiIpeWarn")){jQuery.sap.byId(this.getId()).addClass("sapUiIpeWarn");jQuery.sap.byId(this.getId()).removeClass("sapUiIpeErr");jQuery.sap.byId(this.getId()).removeClass("sapUiIpeSucc")}break;default:jQuery.sap.byId(this.getId()).removeClass("sapUiIpeWarn");jQuery.sap.byId(this.getId()).removeClass("sapUiIpeErr");jQuery.sap.byId(this.getId()).removeClass("sapUiIpeSucc");break}}};
//# sourceMappingURL=InPlaceEdit.js.map