/*!
 * SAP UI development toolkit for HTML5 (SAPUI5) (c) Copyright 2009-2014 SAP SE. All rights reserved
 */
jQuery.sap.declare("sap.ca.ui.charts.BubbleChart");jQuery.sap.require("sap.ca.ui.library");jQuery.sap.require("sap.ca.ui.charts.Chart");sap.ca.ui.charts.Chart.extend("sap.ca.ui.charts.BubbleChart",{metadata:{deprecated:true,library:"sap.ca.ui",properties:{dataLabelFormat:{type:"any",group:"Appearance",defaultValue:null,deprecated:true},showTitle:{type:"boolean",group:"Appearance",defaultValue:false},showXAxisLabel:{type:"boolean",group:"Appearance",defaultValue:true},xAxisFixedRange:{type:"boolean",group:"Appearance",defaultValue:false},xAxisMinValue:{type:"float",group:"Appearance",defaultValue:0},xAxisMaxValue:{type:"float",group:"Appearance",defaultValue:0},showYAxisLabel:{type:"boolean",group:"Appearance",defaultValue:true},yAxisFixedRange:{type:"boolean",group:"Appearance",defaultValue:false},yAxisMinValue:{type:"float",group:"Appearance",defaultValue:0},yAxisMaxValue:{type:"float",group:"Appearance",defaultValue:0},minimumLabelSize:{type:"int",group:"Appearance",defaultValue:60},showSizeLegend:{type:"boolean",group:"Appearance",defaultValue:false},xAxisTitle:{type:"string",group:"Appearance",defaultValue:null},yAxisTitle:{type:"string",group:"Appearance",defaultValue:null},showCustomLabels:{type:"boolean",group:"Appearance",defaultValue:false},labelProperty:{type:"object",group:"Appearance",defaultValue:null},xAxisFormatFunction:{type:"object",group:"Appearance",defaultValue:null,deprecated:true},xAxisFormatString:{type:"string",group:"Appearance",defaultValue:null,deprecated:true},yAxisFormatFunction:{type:"object",group:"Appearance",defaultValue:null,deprecated:true},yAxisFormatString:{type:"string",group:"Appearance",defaultValue:null,deprecated:true},axisTooltipFormatString:{type:"any",group:"Appearance",defaultValue:null,deprecated:true},axisFormatFunction:{type:"object",group:"Appearance",defaultValue:null,deprecated:true}},aggregations:{content:{type:"sap.ui.core.Control",multiple:true,singularName:"content",deprecated:true}}}});sap.ca.ui.charts.BubbleChart.prototype.init=function(){sap.ca.ui.charts.Chart.prototype.init.apply(this);this.setChartType("Bubble");this.setProperty("showSizeLegend",this.getShowSizeLegend());this.sId=this.getId();this._aVerticalLines=[]};sap.ca.ui.charts.BubbleChart.prototype._getChartSettings=function(){var t=sap.ca.ui.charts.Chart.prototype._getChartSettings.call(this);var e={sizeLegend:{visible:this.getShowLegend()},xAxis:{title:{visible:true,text:this.getXAxisTitle()},label:{visible:this.getShowXAxisLabel(),formatString:this.getXAxisFormatString()},scale:{fixedRange:this.getXAxisFixedRange(),minValue:this.getXAxisMinValue(),maxValue:this.getXAxisMaxValue()}},yAxis:{title:{visible:true,text:this.getYAxisTitle()},label:{visible:this.getShowYAxisLabel(),formatString:this.getYAxisFormatString()},scale:{fixedRange:this.getYAxisFixedRange(),minValue:this.getYAxisMinValue(),maxValue:this.getYAxisMaxValue()}},plotArea:{axisTooltip:{formatString:this.getAxisTooltipFormatString()}},dataLabel:{visible:this.getShowDataLabel(),formatString:this.getDataLabelFormat()}};return jQuery.extend(true,t,e)};sap.ca.ui.charts.BubbleChart.prototype.setXAxisFixedRange=function(t){this._oInternalVizChart.getXAxis().getScale().setFixedRange(t);this.setProperty("xAxisFixedRange",t)};sap.ca.ui.charts.BubbleChart.prototype.setYAxisFixedRange=function(t){this._oInternalVizChart.getYAxis().getScale().setFixedRange(t);this.setProperty("yAxisFixedRange",t)};sap.ca.ui.charts.BubbleChart.prototype.setXAxisMinValue=function(t){this._oInternalVizChart.getXAxis().getScale().setMinValue(t);this.setProperty("xAxisMinValue",t)};sap.ca.ui.charts.BubbleChart.prototype.setYAxisMinValue=function(t){this._oInternalVizChart.getYAxis().getScale().setMinValue(t);this.setProperty("yAxisMinValue",t)};sap.ca.ui.charts.BubbleChart.prototype.setXAxisMaxValue=function(t){this._oInternalVizChart.getXAxis().getScale().setMaxValue(t);this.setProperty("xAxisMaxValue",t)};sap.ca.ui.charts.BubbleChart.prototype.setYAxisMaxValue=function(t){this._oInternalVizChart.getYAxis().getScale().setMaxValue(t);this.setProperty("yAxisMaxValue",t)};sap.ca.ui.charts.BubbleChart.prototype.setXAxisTitle=function(t){this._oInternalVizChart.getXAxis().getTitle().setText(t);this.setProperty("xAxisTitle",t)};sap.ca.ui.charts.BubbleChart.prototype.setYAxisTitle=function(t){this._oInternalVizChart.getYAxis().getTitle().setText(t);this.setProperty("yAxisTitle",t)};sap.ca.ui.charts.BubbleChart.prototype.setShowXAxisLabel=function(t){this._oInternalVizChart.getXAxis().getLabel().setVisible(t);this.setProperty("xAxisLabel",t)};sap.ca.ui.charts.BubbleChart.prototype.setShowYAxisLabel=function(t){this._oInternalVizChart.getYAxis().getLabel().setVisible(t);this.setProperty("yAxisLabel",t)};sap.ca.ui.charts.BubbleChart.prototype.setDataLabelFormat=function(t){this._oInternalVizChart.getDataLabel().setFormatString(t);this.setProperty("dataLabelFormat",t)};sap.ca.ui.charts.BubbleChart.prototype.getDataLabelFormat=function(){if(!this.getProperty("dataLabelFormat")){return this.getProperty("dataLabelFormatter")}jQuery.sap.log.warning("dataLabelFormat property is deprecated. Please use dataLabelFormatter.");return this.getProperty("dataLabelFormat")};sap.ca.ui.charts.BubbleChart.prototype.setShowSizeLegend=function(t){this.setProperty("showSizeLegend",t);if(this._oInternalVizChart){this._oInternalVizChart.getSizeLegend().setVisible(t)}return this};sap.ca.ui.charts.BubbleChart.prototype.formatDataLabel=function(t){var e=this.getLabelProperty();if(!e||e.length==0){jQuery.sap.log.debug("BubbleChart: formatDataLabel not possible without defined properties ; use setLabelProperty(['prop1', 'prop2'])");if(this.getShowCustomLabels()&&this.getShowDataLabel()){jQuery.sap.log.error("showCustomLabels and showDataLabel should not be true at the same time")}return}var a=d3.select(jQuery.sap.byId(this.getId()).children()[0]).select(".v-m-root");a.selectAll(".sapBubbleTxt").remove();if(this._oInternalVizChart.getDataset()&&this.aData.length>0){a=d3.select(jQuery.sap.byId(this.getId()).children()[0]).select(".v-m-root");var r=a.selectAll(".v-datapoint");var i=a.node().getBoundingClientRect();var s=this.aData;var o=this.getProperty("minimumLabelSize");a.selectAll(".sapBubbleTxt").remove();r.each(function(t,r){var n=this.getBoundingClientRect();var p=n.left-i.left;var l=n.top+n.height/2-i.top;var u=n.right-n.left;if(sap.ui.Device.browser.firefox){l=l-10}if(n.right-n.left>o){var h=e[0];if(h){var c=s[this.__data__.ctx[0].path.dii_a1][h];if(sap.ui.Device.browser.internet_explorer){var g="path"+t.x+c;a.append("path").attr("id",g).attr("d","M "+(p+10)+" "+l+" h "+(u-20)).style("stroke","none");a.append("text").attr("pointer-events","none").append("textPath").attr("xlink:href","#"+g).attr("class","sapBubbleTxt").text(c)}else{a.append("foreignObject").attr("width",u).attr("height",20).attr("x",p).attr("y",l-7).attr("text-anchor","middle").attr("pointer-events","none").attr("class","sapBubbleTxt").append("xhtml:body").style("background","transparent").html("<div class='sapBubbleTxtDiv'>"+c+"</div>")}}var b=e[1];if(b){var x=s[this.__data__.ctx[0].path.dii_a1][b];if(sap.ui.Device.browser.internet_explorer){var y="path"+t.y+x;a.append("path").attr("id",y).attr("d","M "+(p+10)+" "+(l+12)+" h "+(u-20)).style("stroke","none");a.append("text").attr("pointer-events","none").append("textPath").attr("xlink:href","#"+y).attr("class","sapBubbleTxt").text(x)}else{a.append("foreignObject").attr("width",u).attr("height",20).attr("x",p).attr("y",l+4).attr("text-anchor","middle").attr("pointer-events","none").attr("class","sapBubbleTxt").append("xhtml:body").style("background","transparent").html("<div class='sapBubbleTxtDiv' >"+x+"</div>")}}}})}else{jQuery.sap.log.error("BubbleChart: formatDataLabel not possible without dataset")}};sap.ca.ui.charts.BubbleChart.prototype.setXAxisFormatFunction=function(t){if(t){this.setXAxisLabelFormatter(t);this.oChartFormatter._legacyBubbleFormatter=t}this.setProperty("xAxisFormatFunction",t)};sap.ca.ui.charts.BubbleChart.prototype.getXAxisFormatString=function(){if(!this.getProperty("xAxisFormatString")||this.getProperty("xAxisFormatString")==""){return this.getProperty("xAxisLabelFormatter")}jQuery.sap.log.warning("xAxisFormatString property is deprecated. Please use xAxisLabelFormatter.");return this.getProperty("xAxisFormatString")};sap.ca.ui.charts.BubbleChart.prototype.setXAxisFormatString=function(t){jQuery.sap.log.warning("xAxisFormatString property is deprecated. Please use xAxisLabelFormatter.");this.setProperty("xAxisFormatString",t);return this};sap.ca.ui.charts.BubbleChart.prototype.getYAxisFormatString=function(){if(!this.getProperty("yAxisFormatString")||this.getProperty("yAxisFormatString")==""){return this.getProperty("yAxisLabelFormatter")}jQuery.sap.log.warning("yAxisFormatString property is deprecated. Please use yAxisLabelFormatter.");return this.getProperty("yAxisFormatString")};sap.ca.ui.charts.BubbleChart.prototype.getAxisTooltipFormatString=function(){if(!this.getProperty("axisTooltipFormatString")||this.getProperty("axisTooltipFormatString")==""){return this.getProperty("plotAreaAxisTooltipFormatter")}jQuery.sap.log.warning("axisTooltipFormatString property is deprecated. Please use plotAreaAxisTooltipFormatter.");return this.getProperty("axisTooltipFormatString")};sap.ca.ui.charts.BubbleChart.prototype.setAxisTooltipFormatString=function(t){jQuery.sap.log.warning("axisTooltipFormatString property is deprecated. Please use axisTooltipFormatString.");this.setProperty("axisTooltipFormatString",t);return this};sap.ca.ui.charts.BubbleChart.prototype.setYAxisFormatString=function(t){jQuery.sap.log.warning("yAxisFormatString property is deprecated. Please use yAxisLabelFormatter.");this.setProperty("yAxisFormatString",t);return this};sap.ca.ui.charts.BubbleChart.prototype.setYAxisFormatFunction=function(t){if(t){jQuery.sap.log.warning("yAxisFormatFunction property is deprecated. Please use yAxisLabelFormatter.");this.setYAxisLabelFormatter(t);this.oChartFormatter._legacyBubbleFormatter=t}this.setProperty("yAxisFormatFunction",t)};sap.ca.ui.charts.BubbleChart.prototype.setAxisFormatFunction=function(t){if(t){jQuery.sap.log.warning("axisFormatFunction property is deprecated. Please use plotAreaAxisTooltipFormatter.");this.axisLabelFormatter=t;this.oChartFormatter._legacyBubbleFormatter=t}this.setProperty("axisFormatFunction",t)};sap.ca.ui.charts.BubbleChart.prototype.getShowTitle=function(){return sap.ca.ui.charts.Chart.prototype.getTitle.apply(this)};sap.ca.ui.charts.BubbleChart.prototype.setShowTitle=function(t){sap.ca.ui.charts.Chart.prototype.setTitle.apply(this,t)};sap.ca.ui.charts.BubbleChart.prototype.drawVerticalLineAt=function(t,e){if(this._saveVerticalLine(t,e)){this._innerDrawVerticalLineAt(t,e)}};sap.ca.ui.charts.BubbleChart.prototype._innerDrawVerticalLineAt=function(t,e){var a=jQuery(".v-m-plot");var r=function(t){return typeof t!=="undefined"&&typeof t[0]!=="undefined"};if(r(a)===false){return}var i=jQuery(".v-m-xAxis .v-body");var s=jQuery(i).find("line");if(r(s)===false){return}var o=a[0].getBoundingClientRect("height").height;var n=parseFloat(s[0].getAttribute("x1"));var p=parseFloat(s[0].getAttribute("x1"));for(var l=1;l<s.length;l++){var u=s[l];var h=parseFloat(u.getAttribute("x1"));if(h>p){p=h}if(h<n){n=h}}var c=this.getXAxisMinValue();var g=this.getXAxisMaxValue();var b=d3.scale.linear().domain([c,g]).range([n,p]);var x="middle";if(c==t){x="start"}else if(g==t){x="end"}if(e){var y=2*this._getFontSize();a.append(this._createLine(b(t),b(t),y,o,"#000000"));a.append(this._createText(b(t),y-5,e,x))}else{a.append(this._createLine(b(t),b(t),0,o,"#000000"))}};sap.ca.ui.charts.BubbleChart.prototype.clearVerticalLines=function(){this._aVerticalLines=[]};sap.ca.ui.charts.BubbleChart.prototype._saveVerticalLine=function(t,e){var a=false;for(var r=0;r<this._aVerticalLines.length;r++){var i=this._aVerticalLines[r];if(i.xAxisValue===t&&i.text===e){a=true}}if(a===false){this._aVerticalLines.push({xAxisValue:t,text:e})}return!a};sap.ca.ui.charts.BubbleChart.prototype._redrawVerticalLines=function(){for(var t=0;t<this._aVerticalLines.length;t++){var e=this._aVerticalLines[t];this._innerDrawVerticalLineAt(e.xAxisValue,e.text)}};sap.ca.ui.charts.BubbleChart.prototype._createLine=function(t,e,a,r,i){var s=document.createElementNS("http://www.w3.org/2000/svg","line");s.setAttribute("x1",t);s.setAttribute("x2",e);s.setAttribute("y1",a);s.setAttribute("y2",r);s.setAttribute("stroke",i);s.setAttribute("stroke-width",1);s.setAttribute("stroke-dasharray","10, 10");return s};sap.ca.ui.charts.BubbleChart.prototype._createText=function(t,e,a,r){var i=document.createElementNS("http://www.w3.org/2000/svg","text");i.appendChild(document.createTextNode(a));i.setAttribute("x",t);i.setAttribute("y",e);var s=this._getFontSize();i.setAttribute("font-size",s);i.setAttribute("text-anchor",r);return i};sap.ca.ui.charts.BubbleChart.prototype._getFontSize=function(){if(!this._iBubbleFontSize){var t=15;var e=this._findInCss(/.sapCaUiChart .v-datalabel/);if(e.length>0){var a=e[0];var r=a.style["font-size"];if(r==null){r=a.style["fontSize"]}t=parseInt(this._getEMSize(r),10)}this._iBubbleFontSize=t}return this._iBubbleFontSize};sap.ca.ui.charts.BubbleChart.prototype.setContent=function(t){jQuery.sap.log.warning("Usage of deprecated feature, please use setAggregation('internalContent')")};sap.ca.ui.charts.BubbleChart.prototype.getContent=function(){jQuery.sap.log.warning("Usage of deprecated feature please use getAggregation('internalContent')");return null};sap.ca.ui.charts.BubbleChart.prototype.onChartInitialized=function(t){sap.ca.ui.charts.Chart.prototype.onChartInitialized.apply(this,arguments);var e=this._oInternalVizChart.getModel().getData();this.aData=[];for(var a in e){if(jQuery.isArray(e[a])){this.aData=e[a]}}if(this.getShowCustomLabels()){this.formatDataLabel()}};sap.ca.ui.charts.BubbleChart.prototype.getShowLegend=function(){return sap.ca.ui.charts.Chart.prototype.getShowLegend.call(this)||this.getShowSizeLegend()};sap.ca.ui.charts.BubbleChart.prototype.setShowLegend=function(t){sap.ca.ui.charts.Chart.prototype.setShowLegend.call(this,t);this.setShowSizeLegend(t);return this};sap.ca.ui.charts.BubbleChart.prototype._initChart=function(){sap.ca.ui.charts.Chart.prototype._initChart.apply(this);this._oInternalVizChart.attachInitialized(function(t){this._redrawVerticalLines()},this)};
//# sourceMappingURL=BubbleChart.js.map