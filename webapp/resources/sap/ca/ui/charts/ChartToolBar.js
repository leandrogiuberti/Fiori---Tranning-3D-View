/*!
 * SAP UI development toolkit for HTML5 (SAPUI5) (c) Copyright 2009-2014 SAP SE. All rights reserved
 */
jQuery.sap.declare("sap.ca.ui.charts.ChartToolBar");jQuery.sap.require("sap.ca.ui.library");jQuery.sap.require("sap.ui.core.Control");sap.ui.core.Control.extend("sap.ca.ui.charts.ChartToolBar",{metadata:{deprecated:true,library:"sap.ca.ui",properties:{showPersonalization:{type:"boolean",group:"Misc",defaultValue:false},showFullScreen:{type:"boolean",group:"Misc",defaultValue:false},fullScreen:{type:"boolean",group:"Misc",defaultValue:false},showLegend:{type:"boolean",group:"Misc",defaultValue:true},chartTitle:{type:"string",group:"Misc",defaultValue:""},firstDimensionPath:{type:"string",group:"Misc",defaultValue:""},firstDimensionKeyPath:{type:"string",group:"Misc",defaultValue:""},firstDimensionTextPath:{type:"string",group:"Misc",defaultValue:""},secondDimensionPath:{type:"string",group:"Misc",defaultValue:""},secondDimensionKeyPath:{type:"string",group:"Misc",defaultValue:""},secondDimensionTextPath:{type:"string",group:"Misc",defaultValue:""}},aggregations:{charts:{type:"sap.ui.core.Control",multiple:true,singularName:"chart"},toolBar:{type:"sap.m.Bar",multiple:false}},associations:{selectedChart:{type:"sap.ui.core.Control",multiple:false},firstDimensionSelect:{type:"sap.m.Select",multiple:false},secondDimensionSelect:{type:"sap.m.Select",multiple:false}},events:{personalizationPressed:{},firstDimensionKeySelected:{},secondDimensionKeySelected:{}}}});jQuery.sap.require("sap.m.Popover");jQuery.sap.require("sap.m.Button");jQuery.sap.require("sap.m.Bar");jQuery.sap.require("sap.m.Select");jQuery.sap.require("sap.m.Dialog");jQuery.sap.require("sap.ca.ui.Overlay");jQuery.sap.require("sap.ca.ui.utils.resourcebundle");sap.ui.getCore().loadLibrary("sap.viz");sap.ca.ui.charts.ChartToolBar.prototype.init=function(){this._aChartIcons=[];this._oShowLegendButton=new sap.m.Button({icon:"sap-icon://menu",type:sap.m.ButtonType.Transparent,press:jQuery.proxy(this._onLegendButtonPress,this)}).addStyleClass("legendIcon");this._oShowAllChartButton=new sap.m.Button({type:sap.m.ButtonType.Transparent,press:jQuery.proxy(this._onShowAllChartPress,this)}).addStyleClass("allChartsIcon");this._oChartTitle=(new sap.m.Label).addStyleClass("chartToolBarTitle");this._oPersonalizationButton=null;this._oShowLegendAndPersonalizationPopover=null;this._oShowLegendButtonSmall=null;this._oShowLegendButtonClone=null;this._oFullScreenButton=null;this._oFullScreenExitButton=null;this._oFullScreenDialog=null;this._oActiveChartButton=null;this._oFirstDimensionSelect=new sap.m.Select({width:"auto",change:jQuery.proxy(function(t){this.fireEvent("firstDimensionKeySelected",{selectedKey:t.getParameter("selectedItem").getKey()})},this)});this.setAssociation("firstDimensionSelect",this._oFirstDimensionSelect,false);this._oSecondDimensionSelect=new sap.m.Select({width:"auto",change:jQuery.proxy(function(t){this.fireEvent("secondDimensionKeySelected",{selectedKey:t.getParameter("selectedItem").getKey()})},this)});this.setAssociation("secondDimensionSelect",this._oSecondDimensionSelect,false);this._oSecondDimensionTemplate=new sap.ui.core.Item;this._oFirstDimensionTemplate=new sap.ui.core.Item;this._oAllChartList=new sap.m.List({mode:sap.m.ListMode.SingleSelectMaster,showSeparators:sap.m.ListSeparators.None,includeItemInSelection:true,width:"20em",select:jQuery.proxy(function(t){var e=t.getParameter("listItem").getCustomData()[0].getValue();this._switchChart(e)},this)});this._mapChartAndTableIdToListId={};this._oShowAllChartPopover=new sap.m.Popover({placement:sap.m.PlacementType.Bottom,showHeader:false,content:[this._oAllChartList]}).addStyleClass("sapCaUiChartToolBarShowAllChartListPopover");this._oToolBar=new sap.m.Bar({translucent:true,width:"100%",contentLeft:[this._oChartTitle,this._oFirstDimensionSelect,this._oSecondDimensionSelect]}).addStyleClass("iconBar");this.setAggregation("toolBar",this._oToolBar);this.sResizeListenerId=null;if(jQuery.device.is.desktop){this.sResizeListenerId=sap.ui.core.ResizeHandler.register(this,jQuery.proxy(this._setSelectMaxWidth,this))}else{sap.ui.Device.orientation.attachHandler(this._setSelectMaxWidth,this);sap.ui.Device.resize.attachHandler(this._setSelectMaxWidth,this)}this._fullScreenModeExit=false;this._fullScreenModeEntered=false};sap.ca.ui.charts.ChartToolBar.prototype.setToolBar=function(t,e){this.setAggregation("toolBar",t,e);jQuery.sap.log.warning("ChartToolBar: the built-in toolBar aggregation content should not be overridden")};sap.ca.ui.charts.ChartToolBar.prototype.setChartTitle=function(t){this._oChartTitle.setText(t);this.setProperty("chartTitle",t)};sap.ca.ui.charts.ChartToolBar.prototype.setShowLegend=function(t){this.setProperty("showLegend",t);var e=this.getAggregation("charts");var o;if(e){for(o=0;o<e.length;o++){if(e[o].setShowLegend){e[o].setShowLegend(t);jQuery.sap.log.info("ChartToolBar: propagate showLegend to chart id "+e[o].getId())}else{jQuery.sap.log.info("ChartToolBar: chart id "+e[o].getId()+" is missing the showLegend property")}}}};sap.ca.ui.charts.ChartToolBar.prototype.setFullScreen=function(t){var e=this.getProperty("fullScreen");if(e!=t){if(e){this._onFullScreenExitPress(null)}else{this._onFullScreenPress(null)}this.setProperty("fullScreen",t)}};sap.ca.ui.charts.ChartToolBar.prototype.setShowFullScreen=function(t){if(t&&!this._oFullScreenButton&&!this._oFullScreenExitButton){this._oFullScreenButton=new sap.m.Button({icon:"sap-icon://full-screen",type:sap.m.ButtonType.Transparent,visible:true,press:jQuery.proxy(this._onFullScreenPress,this)});this._oFullScreenExitButton=new sap.m.Button({icon:"sap-icon://exit-full-screen",type:sap.m.ButtonType.Transparent,visible:false,press:jQuery.proxy(this._onFullScreenExitPress,this)})}this.setProperty("showFullScreen",t)};sap.ca.ui.charts.ChartToolBar.prototype.setFirstDimensionPath=function(t,e){this._oFirstDimensionSelect.bindAggregation("items",{path:t,template:this._oFirstDimensionTemplate});this.setProperty("firstDimensionPath",t)};sap.ca.ui.charts.ChartToolBar.prototype.setFirstDimensionKeyPath=function(t,e){this._oFirstDimensionTemplate.bindProperty("key",{path:t});this.setProperty("firstDimensionKeyPath",t)};sap.ca.ui.charts.ChartToolBar.prototype.setFirstDimensionTextPath=function(t,e){this._oFirstDimensionTemplate.bindProperty("text",{path:t});this.setProperty("firstDimensionTextPath",t)};sap.ca.ui.charts.ChartToolBar.prototype.setSecondDimensionPath=function(t,e){this._oSecondDimensionSelect.bindAggregation("items",{path:t,template:this._oSecondDimensionTemplate});this.setProperty("secondDimensionPath",t)};sap.ca.ui.charts.ChartToolBar.prototype.setSecondDimensionKeyPath=function(t,e){this._oSecondDimensionTemplate.bindProperty("key",{path:t});this.setProperty("secondDimensionKeyPath",t)};sap.ca.ui.charts.ChartToolBar.prototype.setSecondDimensionTextPath=function(t,e){this._oSecondDimensionTemplate.bindProperty("text",{path:t});this.setProperty("secondDimensionTextPath",t)};sap.ca.ui.charts.ChartToolBar.prototype.setShowPersonalization=function(t){if(t){if(!this._oPersonalizationButton){this._oPersonalizationButton=new sap.m.Button({icon:"sap-icon://action-settings",type:sap.m.ButtonType.Transparent,press:jQuery.proxy(this.firePersonalizationPressed,this)}).addStyleClass("personalizationIcon")}if(!this._oShowLegendAndPersonalizationPopover){if(!this._oShowLegendButtonClone){this._oShowLegendButtonClone=this._oShowLegendButton.clone()}this._oShowLegendAndPersonalizationPopover=new sap.m.Popover({placement:sap.m.PlacementType.Bottom,showHeader:false,content:[this._oShowLegendButtonClone,this._oPersonalizationButton.clone()]})}if(!this._oShowLegendButtonSmall){this._oShowLegendButtonSmall=new sap.m.Button({icon:"sap-icon://overflow",type:sap.m.ButtonType.Transparent,press:jQuery.proxy(function(){this._oShowLegendAndPersonalizationPopover.openBy(this._oShowLegendButtonSmall)},this)}).addStyleClass("legendSmallIcon")}}else if(!this._oShowLegendButtonSmall){this._oShowLegendButtonSmall=this._oShowLegendButton.clone().removeStyleClass("legendIcon").addStyleClass("legendSmallIcon")}this.setProperty("showPersonalization",t)};sap.ca.ui.charts.ChartToolBar.prototype.onBeforeRendering=function(){this._oFirstDimensionSelect.setVisible(this._oFirstDimensionSelect.getItems().length>0);this._oSecondDimensionSelect.setVisible(this._oSecondDimensionSelect.getItems().length>0);this._oChartTitle.setVisible(this._oFirstDimensionSelect.getItems().length==0&&this._oSecondDimensionSelect.getItems().length==0);this._oToolBar.removeContentRight();var t=0;if(this._aChartIcons.length>1){for(t=0;t<this._aChartIcons.length;t++){this._oToolBar.insertContentRight(this._aChartIcons[t],t)}this._oToolBar.insertContentRight(this._oShowAllChartButton,t++)}if(this._aChartIcons.length>0){this._oToolBar.insertContentRight(this._oShowLegendButton,t++);this._oToolBar.insertContentRight(this._oShowLegendButtonSmall,t++)}if(this.getShowPersonalization()){this._oToolBar.insertContentRight(this._oPersonalizationButton,t++)}if(this.getShowFullScreen()){this._oToolBar.insertContentRight(this._oFullScreenButton,t++);this._oToolBar.insertContentRight(this._oFullScreenExitButton,t++)}};sap.ca.ui.charts.ChartToolBar.prototype.onAfterRendering=function(){this._setSelectMaxWidth();var t=this;if(this._fullScreenModeExit){if(this._oFullScreenButton&&this._oFullScreenButton.getVisible()){setTimeout(function(){t._oFullScreenButton.focus()},0)}this._fullScreenModeExit=false}if(this._fullScreenModeEntered){if(this._oFullScreenExitButton&&this._oFullScreenExitButton.getVisible()){setTimeout(function(){t._oFullScreenExitButton.focus()},0)}this._fullScreenModeEntered=false}};sap.ca.ui.charts.ChartToolBar.prototype.exit=function(){this._mapChartAndTableIdToListId=null;if(jQuery.device.is.desktop&&this.sResizeListenerId){sap.ui.core.ResizeHandler.deregister(this.sResizeListenerId);this.sResizeListenerId=null}else{sap.ui.Device.orientation.detachHandler(this._setSelectMaxWidth,this);sap.ui.Device.resize.detachHandler(this._setSelectMaxWidth,this)}if(this._oFirstDimensionTemplate){this._oFirstDimensionTemplate.destroy();this._oFirstDimensionTemplate=null}if(this._oSecondDimensionTemplate){this._oSecondDimensionTemplate.destroy();this._oSecondDimensionTemplate=null}if(this._oShowAllChartPopover){if(this._oShowAllChartPopover.isOpen()){this._oShowAllChartPopover.close()}this._oShowAllChartPopover.destroy();this._oShowAllChartPopover=null}if(this._oShowLegendAndPersonalizationPopover){this._oShowLegendAndPersonalizationPopover.destroy();this._oShowLegendAndPersonalizationPopover=null}if(this._oFullScreenDialog){if(this._oFullScreenDialog.isOpen()){this._oFullScreenDialog.close()}this._oFullScreenDialog.destroy();this._oFullScreenDialog=null}if(jQuery.device.is.desktop){if(this.sResizeListenerId){sap.ui.core.ResizeHandler.deregister(this.sResizeListenerId);this.sResizeListenerId=null}}else{sap.ui.Device.orientation.detachHandler(this._setSelectMaxWidth,this);sap.ui.Device.resize.detachHandler(this._setSelectMaxWidth,this)}};sap.ca.ui.charts.ChartToolBar.prototype.addChart=function(t,e){this._onAddingChart(t)};sap.ca.ui.charts.ChartToolBar.prototype.removeAllCharts=function(){var t;for(t=0;t<this._aChartIcons.length;t++){if(this._aChartIcons[t].destroy){this._aChartIcons[t].destroy()}}this._aChartIcons=[];this._oAllChartList.removeAllItems();this._mapChartAndTableIdToListId={};return this.removeAllAggregation("charts")};sap.ca.ui.charts.ChartToolBar.prototype.removeChart=function(t){jQuery.sap.log.error("ChartToolBar: removeChart method is not supported, doing removeAllCharts instead");return this.removeAllCharts()};sap.ca.ui.charts.ChartToolBar.prototype.insertChart=function(t,e,o){jQuery.sap.log.error("ChartToolBar: insertChart method is not supported, doing addChart instead");this._onAddingChart(t)};sap.ca.ui.charts.ChartToolBar.prototype.insertChart=function(t,e,o){this._onAddingChart(t)};sap.ca.ui.charts.ChartToolBar.prototype.setSelectedChart=function(t,e){var o=null;if(t instanceof sap.ui.core.Control){o=t}else{o=this._findChartById(t)}var s=!(o instanceof sap.m.Table);this._oShowLegendButton.setEnabled(s);if(this.getShowPersonalization()){if(this._oShowLegendButtonClone){this._oShowLegendButtonClone.setEnabled(s)}}else{if(this._oShowLegendButtonSmall){this._oShowLegendButtonSmall.setEnabled(s)}}this._oAllChartList.setSelectedItemById(this._mapChartAndTableIdToListId[o.getId()]);if(o instanceof sap.m.Table){this._oShowAllChartButton.setIcon("sap-icon://table-chart")}else if(o.getIcon){this._oShowAllChartButton.setIcon(o.getIcon())}else{jQuery.sap.log.error("ChartToolBar:control id "+o.getId()+" is not a sap.m.Table and has no getIcon method")}this.setAssociation("selectedChart",o,e)};sap.ca.ui.charts.ChartToolBar.prototype.setFirstDimensionSelect=function(t,e){jQuery.sap.log.error("ChartToolBar: setFirstDimensionSelect method is not supported")};sap.ca.ui.charts.ChartToolBar.prototype.setSecondDimensionSelect=function(t,e){jQuery.sap.log.error("ChartToolBar: setSecondDimensionSelect method is not supported")};sap.ca.ui.charts.ChartToolBar.prototype._setSelectMaxWidth=function(){if(this._oFirstDimensionSelect.getItems().length>0){var t=this._oToolBar.$();var e=t.find(".sapMBarRight").width();if(e===0){this._oFirstDimensionSelect.setMaxWidth("100%");if(this._oSecondDimensionSelect.getItems().length>0){this._oSecondDimensionSelect.setMaxWidth("100%")}jQuery.sap.log.debug("ChartToolBar: cannot set sap.m.Select maxWidth as sap.m.Bar rightContent width is evaluated to 0")}else{var o=t.width()-e;if(this._oSecondDimensionSelect.getItems().length>0){o=Math.floor(o/2);this._oFirstDimensionSelect.setMaxWidth(o+"px");this._oSecondDimensionSelect.setMaxWidth(o+"px")}else{this._oFirstDimensionSelect.setMaxWidth(o+"px")}}}};sap.ca.ui.charts.ChartToolBar.prototype._onAddingChart=function(t){if(t.setShowLegend){t.setShowLegend(this.getShowLegend())}this.addAggregation("charts",t);var e=new sap.m.Button({type:sap.m.ButtonType.Transparent,customData:[new sap.ui.core.CustomData({key:"chartId",value:t.getId()})],press:jQuery.proxy(function(t){var e=t.getSource().getCustomData()[0].getValue();this._switchChart(e)},this)}).addStyleClass("chartIcon");if(t instanceof sap.m.Table){e.setIcon("sap-icon://table-chart")}else if(t.getIcon){e.setIcon(t.getIcon())}else{jQuery.sap.log.error("ChartToolBar: inserted control id "+t.getId()+" is not a sap.m.Table and has no getIcon method")}this._aChartIcons.push(e);var o=new sap.m.StandardListItem({icon:e.getIcon(),title:this._findChartName(t),customData:[new sap.ui.core.CustomData({key:"chartId",value:t.getId()})]});this._oAllChartList.addItem(o);this._mapChartAndTableIdToListId[t.getId()]=o.getId();if(this.getAggregation("charts").length==1){this._oAllChartList.setSelectedItem(o);this.setSelectedChart(t);this._oActiveChartButton=e.addStyleClass("activeButton")}};sap.ca.ui.charts.ChartToolBar.prototype._findChartName=function(t){var e="";if(t.getBindingInfo("label")){var o=t.getBindingInfo("label");if(o.parts&&o.parts.length>0){var s=o.parts[0].path;var i=o.parts[0].model;var a=sap.ui.getCore().getModel(i);if(a){e=a.getProperty(s)}}}else if(t.getLabel){e=t.getLabel()}else if(t instanceof sap.m.Table){e=sap.ca.ui.utils.resourcebundle.getText("ChartToolBar.ChartName.Table")}else{jQuery.sap.log.error("ChartToolBar: can't find chart label for chart id "+t.getId())}return e};sap.ca.ui.charts.ChartToolBar.prototype._findChartById=function(t){var e=null;var o=this.getAggregation("charts");var s;if(o){for(s=0;!e&&s<o.length;s++){if(o[s].getId()===t){e=o[s]}}}return e};sap.ca.ui.charts.ChartToolBar.prototype._onLegendButtonPress=function(t){this.setShowLegend(!this.getShowLegend());if(this._oShowLegendAndPersonalizationPopover&&this._oShowLegendAndPersonalizationPopover.isOpen()){this._oShowLegendAndPersonalizationPopover.close()}};sap.ca.ui.charts.ChartToolBar.prototype._onFullScreenExitPress=function(t){jQuery.sap.log.info("ChartToolBar: exiting fullscreen");this._fullScreenModeExit=true;if(this._oFullScreenButton){this._oFullScreenButton.setVisible(true)}if(this._oFullScreenExitButton){this._oFullScreenExitButton.setVisible(false)}if(this._oFullScreenDialog){this._oFullScreenDialog.close()}this.setProperty("fullScreen",false);this.invalidate()};sap.ca.ui.charts.ChartToolBar.prototype._onFullScreenPress=function(t){jQuery.sap.log.info("ChartToolBar: toggle to fullscreen");this._fullScreenModeEntered=true;if(this._oFullScreenButton){this._oFullScreenButton.setVisible(false)}if(this._oFullScreenExitButton){this._oFullScreenExitButton.setVisible(true)}this._oToolBar.rerender();if(!this._oFullScreenDialog){this._oFullScreenDialog=new sap.ca.ui.Overlay}this._oFullScreenDialog.open(this,true);this.setProperty("fullScreen",true);this.invalidate()};sap.ca.ui.charts.ChartToolBar.prototype._switchChart=function(t){var e=null;var o;for(o=0;!e&&o<this._aChartIcons.length;o++){if(this._aChartIcons[o].getCustomData()[0].getValue()===t){e=this._aChartIcons[o]}}if(e){if(this._oActiveChartButton){this._oActiveChartButton.removeStyleClass("activeButton")}this._oActiveChartButton=e;this._oActiveChartButton.addStyleClass("activeButton")}var s=this._findChartById(t);this.setSelectedChart(s);if(this._oShowAllChartPopover.isOpen()){this._oShowAllChartPopover.close()}jQuery.sap.log.info("ChartToolBar: switch to chart id "+t)};sap.ca.ui.charts.ChartToolBar.prototype._onShowAllChartPress=function(t){this._oShowAllChartPopover.openBy(this._oShowAllChartButton)};
//# sourceMappingURL=ChartToolBar.js.map