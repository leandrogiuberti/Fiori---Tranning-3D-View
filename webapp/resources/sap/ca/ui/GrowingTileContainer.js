/*!
 * SAP UI development toolkit for HTML5 (SAPUI5) (c) Copyright 2009-2014 SAP SE. All rights reserved
 */
jQuery.sap.declare("sap.ca.ui.GrowingTileContainer");jQuery.sap.require("sap.ca.ui.library");jQuery.sap.require("sap.m.ScrollContainer");sap.m.ScrollContainer.extend("sap.ca.ui.GrowingTileContainer",{metadata:{deprecated:true,library:"sap.ca.ui",properties:{growing:{type:"boolean",group:"Misc",defaultValue:false},growingThreshold:{type:"int",group:"Misc",defaultValue:20},growingScrollToLoad:{type:"boolean",group:"Misc",defaultValue:false}}}});jQuery.sap.require("sap.ui.layout.Grid");sap.ca.ui.GrowingTileContainer.prototype.init=function(){sap.m.ScrollContainer.prototype.init.call(this);this._iItemCount=0};sap.ca.ui.GrowingTileContainer.prototype.destroy=function(){if(this._oBusyIndicator){this._oBusyIndicator.destroy();delete this._oBusyIndicator}if(this._oGridLayout){this._oGridLayout.destroy();delete this._oGridLayout}if(this._oScrollDelegate){this._unbindGrowingDelegate();this._oScrollDelegate=null}this._unbindDataEvents()};sap.ca.ui.GrowingTileContainer.prototype.onBeforRendering=function(){this._unbindDataEvents()};sap.ca.ui.GrowingTileContainer.prototype.onAfterRendering=function(){this._bCountChecked=false;this._bindGrowingDelegate();this._bindDataEvents()};sap.ca.ui.GrowingTileContainer.prototype._bindDataEvents=function(){var e=this.getBinding("content");if(e){e.attachDataRequested(this._onDataRequested,this);e.attachDataReceived(this._onDataReceived,this)}};sap.ca.ui.GrowingTileContainer.prototype._unbindDataEvents=function(){var e=this.getBinding("content");if(e){e.detachDataRequested(this._onDataRequested,this);e.detachDataReceived(this._onDataReceived,this)}};sap.ca.ui.GrowingTileContainer.prototype._onDataRequested=function(){this._getBusyIndicator().setVisible(true)};sap.ca.ui.GrowingTileContainer.prototype._onDataReceived=function(){this._getBusyIndicator().setVisible(false)};sap.ca.ui.GrowingTileContainer.prototype._getBusyIndicator=function(){if(!this._oBusyIndicator){this._oBusyIndicator=new sap.m.BusyIndicator({size:"2.0rem"})}if(!this._oBusyIndicator.getDomRef()){this._renderAndFlushLayoutItem(this._oBusyIndicator)}return this._oBusyIndicator};sap.ca.ui.GrowingTileContainer.prototype.updateContent=function(e){var t=this.getBindingInfo("content");if(t){if(this._iItemCount==0||e==sap.ui.model.ChangeReason.Filter){if(this.getGrowing()){this._iItemCount=this.getGrowingThreshold()}else{this._iItemCount=t.binding.getLength()}}var i=t.factory,a=t.binding,n=sap.ui.model&&sap.ui.model.odata&&sap.ui.model.odata.ODataListBinding,r=n&&a instanceof n,s=a?a.getContexts(0,this._iItemCount):[];var o=this.getId()+"-scroll";if(jQuery.sap.domById(o)!=null){if(s.diff){var d,l;for(var u=0,g=s.diff.length;u<g;u++){d=this.getContent();if(s.diff[u].type==="delete"){this.deleteListItem(s.diff[u].index)}if(s.diff[u].type==="insert"){l=i("",s[s.diff[u].index]);l.setBindingContext(s[s.diff[u].index],t.model);this.insertListItem(l,s.diff[u].index)}}}else if(!s.dataRequested){this._iRenderedDataItems=0;this.destroyAggregation("content");for(var u=0,g=s.length;u<g;u++){var l=i("",s[u]);l.setBindingContext(s[u],t.model);this.addListItem(l,false)}}}else{for(var u=0,g=s.length;u<g;u++){var l=i("",s[u]);l.setBindingContext(s[u],t.model);this.addListItem(l,true)}}}};sap.ca.ui.GrowingTileContainer.prototype.addListItem=function(e,t){if(!this._bCountChecked){this._bCountChecked=true}this._iRenderedDataItems++;var i=this.getBinding("content");this.addAggregation("content",e,t);if(t){this._renderAndFlushLayoutItem(e)}return this};sap.ca.ui.GrowingTileContainer.prototype.insertListItem=function(e,t){if(!this._bCountChecked){this._bCountChecked=true}this.insertAggregation("content",e,t,true);this._iRenderedDataItems++;this._renderAndFlushLayoutItem(e,t);return this};sap.ca.ui.GrowingTileContainer.prototype.deleteListItem=function(e){if(e!=null){this._iRenderedDataItems--;jQuery(jQuery(this._getItemsContainer()).children()[e]).remove()}return this};sap.ca.ui.GrowingTileContainer.prototype._getItemWrapperId=function(e){if(e){return e.getId()+"_wrapper"}return""};sap.ca.ui.GrowingTileContainer.prototype._getDomIndex=function(e){return typeof e==="number"?e:true};sap.ca.ui.GrowingTileContainer.prototype._getItemsContainer=function(){if(!this._oGridLayout){var e=this._getGridLayout();return e.getDomRef()}return this._oGridLayout.getDomRef()};sap.ca.ui.GrowingTileContainer.prototype._getGridLayout=function(){if(!this._oGridLayout){this._oGridLayout=new sap.ui.layout.Grid({id:this.getId()+"-grid",width:"auto",inContainer:true,vSpacing:1,hSpacing:1,position:sap.ui.layout.GridPosition.Center,defaultSpan:"L4 M6 S12",defaultIndent:"L0 M0 S0"})}return this._oGridLayout};sap.ca.ui.GrowingTileContainer.prototype.onLoadMorePressed=function(){jQuery.sap.delayedCall(0,this,function(){this._iItemCount+=this.getGrowingThreshold();this.updateContent()})},sap.ca.ui.GrowingTileContainer.prototype.setGrowing=function(e){if(this.getGrowing()!=e){this.setProperty("growing",e);if(e){this._iItemCount+=this.getGrowingThreshold();this.bUseExtendedChangeDetection=true}else if(this._oGrowingDelegate){this._oGrowingDelegate.destroy();this._oGrowingDelegate=null}}return this};sap.ca.ui.GrowingTileContainer.prototype._getListItemCount=function(){var e=this.getBinding("content");if(e){return e.getLength()||0}return this.getContent().length},sap.ca.ui.GrowingTileContainer.prototype._triggerLoadingByScroll=function(e){if(this._iItemCount<this._getListItemCount()){jQuery.sap.clearDelayedCall(this._delayCallId);this._delayCallId=jQuery.sap.delayedCall(1e3,this,function(){jQuery.sap.log.info("loading elements triggered on scroll");this._iItemCount+=this.getGrowingThreshold();this.updateContent()})}};sap.ca.ui.GrowingTileContainer.prototype._unbindGrowingDelegate=function(){if(this._oScrollDelegate){jQuery.sap.log.debug("unbinding scroll delegate");delete this._fnProxytriggerLoadingByScroll;this._oScrollDelegate.setGrowingList(null)}};sap.ca.ui.GrowingTileContainer.prototype._bindGrowingDelegate=function(){var e=sap.m.getScrollDelegate(this);if(e){jQuery.sap.log.debug("binding scroll delegate");this._oScrollDelegate=e;this._fnProxytriggerLoadingByScroll=jQuery.proxy(this._triggerLoadingByScroll,this);e.setGrowingList(this,this._fnProxytriggerLoadingByScroll)}};sap.ca.ui.GrowingTileContainer.prototype._renderAndFlushLayoutItem=function(e,t){var i=/^([L](?:[0-9]|1[0-1]))? ?([M](?:[0-9]|1[0-1]))? ?([S](?:[0-9]|1[0-1]))?$/i;var a=/^([L](?:[1-9]|1[0-2]))? ?([M](?:[1-9]|1[0-2]))? ?([S](?:[1-9]|1[0-2]))?$/i;var n=this._getGridLayout();var r=n.getDefaultSpan();var s=n.getDefaultIndent();var o=i.exec(s);var d=["","L3","M6","S12"];var l=a.exec(r);var u=this._getItemsContainer();if(u){var g=sap.ui.getCore().createRenderManager();g.write("<div id="+this._getItemWrapperId(e));var p=n._getLayoutDataForControl(e);if(p){if(p.getLinebreak()===true){g.addClass("sapUiRespGridBreak")}else{if(p.getLinebreakL()===true){g.addClass("sapUiRespGridBreakL")}if(p.getLinebreakM()===true){g.addClass("sapUiRespGridBreakM")}if(p.getLinebreakS()===true){g.addClass("sapUiRespGridBreakS")}}var h;var f=p.getSpan();if(!f||f.length==0){h=l}else{h=a.exec(f)}if(h){for(var c=1;c<h.length;c++){var C=h[c];if(!C){C=l[c];if(!C){C=d[c]}}var y=p.getSpanLarge();var _=p.getSpanMedium();var G=p.getSpanSmall();C=C.toUpperCase();if(C.substr(0,1)==="L"&&y>0&&y<13){g.addClass("sapUiRespGridSpanL"+y)}else if(C.substr(0,1)==="M"&&_>0&&_<13){g.addClass("sapUiRespGridSpanM"+_)}else if(C.substr(0,1)==="S"&&G>0&&G<13){g.addClass("sapUiRespGridSpanS"+G)}else{g.addClass("sapUiRespGridSpan"+C)}}}var v;var I=p.getIndent();if(!I||I.length==0){v=o}else{v=i.exec(I)}if(!v){v=o;if(!v){v=undefined}}if(v){for(var c=1;c<v.length;c++){var m=v[c];if(!m){if(o&&o[c]){m=o[c]}}if(m){m=m.toUpperCase();if(!/^(L0)? ?(M0)? ?(S0)?$/.exec(m)){var w=p.getIndentLarge();var L=p.getIndentMedium();var S=p.getIndentSmall();if(m.substr(0,1)==="L"&&w>0&&w<12){g.addClass("sapUiRespGridIndentL"+w)}else if(m.substr(0,1)==="M"&&L>0&&L<12){g.addClass("sapUiRespGridIndentM"+L)}else if(m.substr(0,1)==="S"&&S>0&&S<12){g.addClass("sapUiRespGridIndentS"+S)}else{g.addClass("sapUiRespGridIndent"+m)}}}}}var b=p.getVisibleOnLarge(),R=p.getVisibleOnMedium(),D=p.getVisibleOnSmall();if(!b&&R&&D){g.addClass("sapUiRespGridHiddenL")}else if(!b&&!R&&D){g.addClass("sapUiRespGridVisibleS")}else if(b&&!R&&!D){g.addClass("sapUiRespGridVisibleL")}else if(!b&&R&&!D){g.addClass("sapUiRespGridVisibleM")}else if(b&&!R&&D){g.addClass("sapUiRespGridHiddenM")}else if(b&&R&&!D){g.addClass("sapUiRespGridHiddenS")}var B=p.getMoveBackwards();if(B&&B.length>0){var T=i.exec(B);if(T){for(var c=1;c<T.length;c++){var U=T[c];if(U){g.addClass("sapUiRespGridBwd"+U.toUpperCase())}}}}var M=p.getMoveForward();if(M&&M.length>0){var x=i.exec(M);if(x){for(var c=1;c<x.length;c++){var j=x[c];if(j){g.addClass("sapUiRespGridFwd"+j.toUpperCase())}}}}if(p._sStylesInternal){g.addClass(p._sStylesInternal)}}if(!p){var C="";if(l){for(var c=1;c<l.length;c++){C=l[c];if(!C){C=d[c]}g.addClass("sapUiRespGridSpan"+C.toUpperCase())}}else{for(var c=1;c<d.length;c++){C=d[c];g.addClass("sapUiRespGridSpan"+C.toUpperCase())}}}g.writeClasses();g.write(">");g.renderControl(e);g.write("</div>");g.flush(u,false,this._getDomIndex(t));g.destroy()}};sap.ca.ui.GrowingTileContainer.prototype.getHorizontal=function(){return false};
//# sourceMappingURL=GrowingTileContainer.js.map