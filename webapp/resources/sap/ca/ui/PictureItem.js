/*!
 * SAP UI development toolkit for HTML5 (SAPUI5) (c) Copyright 2009-2014 SAP SE. All rights reserved
 */
jQuery.sap.declare("sap.ca.ui.PictureItem");jQuery.sap.require("sap.ca.ui.library");jQuery.sap.require("sap.ui.core.Control");sap.ui.core.Control.extend("sap.ca.ui.PictureItem",{metadata:{deprecated:true,library:"sap.ca.ui",properties:{status:{type:"string",group:"Behavior",defaultValue:null},source:{type:"string",group:"Data",defaultValue:null},name:{type:"string",group:"Data",defaultValue:null},width:{type:"sap.ui.core.CSSSize",group:"Data",defaultValue:"62px",deprecated:true},height:{type:"sap.ui.core.CSSSize",group:"Data",defaultValue:"62px",deprecated:true}},events:{loaded:{}}}});sap.ca.ui.PictureItem.STATUS={ADD:"Added",DELETE:"Deleted",READ:"Read"};sap.ca.ui.PictureItem.prototype.init=function(){this._oTapHandler=jQuery.proxy(this._onTap,this);this._oImage=new sap.m.Image({id:this.getId()+"-image"});this._oImage.attachPress(this._oTapHandler);this._oImage.addStyleClass("sapCaUiPictureItemImage");this._iRenderCount=0;this._sourceInfo={isDataUri:false,mimeType:"",data:""}};sap.ca.ui.PictureItem.prototype.exit=function(){if(this._oImage){this._oImage.detachPress(this._oTapHandler);this._oImage.destroy()}if(this._internalFile){delete this._internalFile}};sap.ca.ui.PictureItem.prototype.setSource=function(e){if(e==null||e==""){jQuery.sap.log.warning("Cannot set a NULL or empty to the image source");return}this._sourceInfo=this._getSourceInfo(e);this._oImage.setSrc(e);this.setProperty("source",e,false)};sap.ca.ui.PictureItem.prototype.setFile=function(e,t){var i=this;this._internalFile=e;var a=new sap.ca.ui.utils.CanvasHelper({width:t.width,height:t.height,crop:t.crop,quality:t.quality,minWeight:t.minWeight,done:function(e){i.setSource(e.getParameters().data);i.fireLoaded()}});a.resize(e)};sap.ca.ui.PictureItem.prototype.getFile=function(e){if(!this._internalFile){jQuery.sap.log.warning("no file has been set");return null}return this._internalFile};sap.ca.ui.PictureItem.prototype.isSourceDataUri=function(){if(!this._sourceInfo){return false}return this._sourceInfo.isDataUri};sap.ca.ui.PictureItem.prototype.getMimeType=function(){return this._sourceInfo.mimeType};sap.ca.ui.PictureItem.prototype.getBase64Encoding=function(){return this._sourceInfo.data};sap.ca.ui.PictureItem.prototype._resizeImage=function(){var e="auto";var t="auto";var i=this.$();var a=jQuery.sap.domById(this.getId()+"-image");if(a){if(a.width==0||a.height==0){var r=jQuery.proxy(this.onAfterRendering,this);this._iRenderCount++;if(this._iRenderCount<=5){setTimeout(r,100)}else{e=i.height();this._iRenderCount=0}}else{if(a.width<a.height){var s=parseInt(i.width(),10);t=s/a.width*a.height}else{var u=parseInt(i.height(),10);e=u/a.height*a.width}this._iRenderCount=0}var o=this._oImage.$();o.width(e);o.height(t)}};sap.ca.ui.PictureItem.prototype.onAfterRendering=function(){var e=this._oImage.$();var t=this.$();var i=function(){this._resizeImage();e.css({"margin-left":(t.width()-e.width())/2+"px","margin-top":(t.height()-e.height())/2+"px"})};if(e.height()>0){i.call(this)}else{e.load(jQuery.proxy(i,this))}e.attr("tabIndex",-1)};sap.ca.ui.PictureItem.prototype._onTap=function(){var e=sap.ui.getCore().byId(this._addPictureId);if(e){e._pictureTapped(this)}};sap.ca.ui.PictureItem.prototype.onkeyup=function(e){if(e.which==jQuery.sap.KeyCodes.SPACE||e.which==jQuery.sap.KeyCodes.ENTER){this._onTap()}};sap.ca.ui.PictureItem.prototype._getSourceInfo=function(e){if(!e){return}var t=/^data:(.+);base64,(.*)$/;var i=e.match(t);var a;if(i){var r=i[1];var s=i[2];a={isDataUri:true,mimeType:r,data:s}}else{a={isDataUri:false,mimeType:"",data:""}}return a};
//# sourceMappingURL=PictureItem.js.map