/*
 * Copyright (C) 2009-2014 SAP SE or an SAP affiliate company. All rights reserved
 */
jQuery.sap.declare("sap.ca.ui.NavigationHandler");jQuery.sap.require("jquery.sap.history");jQuery.sap.require("sap.m.InstanceManager");sap.ca.ui.NavigationHandler=function(a,e){this._app=a;this.config=e};sap.ca.ui.NavigationHandler.prototype._getValue=function(a){var e=this[a];if(typeof e=="string"||e instanceof String){return e}return e()};sap.ca.ui.NavigationHandler.prototype.subscribe=function(){var a=function(a,e){if(!a||!a.id){jQuery.sap.log.error("invalid parameter: "+a)}else{if(e===jQuery.sap.history.NavType.Back){this._navBack(a.id)}else{this._navTo(a.id,a.data,false)}}};jQuery.sap.history({routes:[{path:"page",handler:jQuery.proxy(a,this)}]});var e=sap.ui.getCore().getEventBus();e.subscribe("nav","to",this._navHandler,this);e.subscribe("nav","back",this._navHandler,this);e.subscribe("nav","backMaster",this._backMaster,this);e.subscribe("nav","virtual",this._navHandler,this)};sap.ca.ui.NavigationHandler.prototype._backMaster=function(a,e,i){this._app.backMaster()};sap.ca.ui.NavigationHandler.prototype._navHandler=function(a,e,i){if(e==="to"){this._navTo(i.id,i.data,true)}else if(e==="back"){this._navBack(i.id)}else if(e==="virtual"){jQuery.sap.history.addVirtualHistory()}else{jQuery.sap.log.error("'nav' event cannot be processed. There's no handler registered for event with id: "+e)}};sap.ca.ui.NavigationHandler.prototype._navTo=function(a,e,i){if(a===undefined){jQuery.sap.log.error("navTo failed due to missing id")}else{if(sap.m.InstanceManager.hasOpenPopover()){sap.m.InstanceManager.closeAllPopovers();jQuery.sap.log.info("navTo - closed popover(s)")}var s=this.config.getStringValue("transition");var t=this.config.getBoolValue("isMaster",[a]);var r=t||this.config.getBoolValue("masterVisible",[a]);if(a instanceof sap.ui.core.Control){if(this._app.getPage(a.getId())===null){this._app.addPage(a)}}else{var n=this.config.getStringValue("viewType");var o=this.config.getStringValue("viewName",[a]);if(this._app.getPage(a,t)===null){var p=sap.ui.view({id:a,viewName:o,type:n});this._app.addPage(p,t);jQuery.sap.log.info("app controller > loaded page: "+a)}}this._app.toggleStyleClass("sapMSplitAppFullscreen",!r);this._app.to(p!==undefined?p.getId():a,s,e);jQuery.sap.log.info("navTo - to page: "+a)}};sap.ca.ui.NavigationHandler.prototype._navBack=function(a){if(!a){jQuery.sap.log.error("navBack - parameters id must be given")}else{if(sap.m.InstanceManager.hasOpenPopover()){sap.m.InstanceManager.closeAllPopovers()}if(sap.m.InstanceManager.hasOpenDialog()){sap.m.InstanceManager.closeAllDialogs();jQuery.sap.log.info("navBack - closed dialog(s)")}var e=this._app.getCurrentPage()?this._app.getCurrentPage().getId():null;if(e!==a){var i=this.config.getBoolValue("isMaster",[a]);var s=i||this.config.getBoolValue("masterVisible",[a]);this._app.toggleStyleClass("sapMSplitAppFullscreen",!s);this._app.backToPage(a)}jQuery.sap.log.info("navBack - back to page: "+a)}};
//# sourceMappingURL=NavigationHandler.js.map