/*
 * Copyright (C) 2009-2016 SAP SE or an SAP affiliate company. All rights reserved
 */
(function(){var o=jQuery.sap.log.isLoggable(jQuery.sap.log.Level.DEBUG),t="sap.ca.scfld.md.app.CommonHeaderFooterHelper";jQuery.sap.declare("sap.ca.scfld.md.app.CommonHeaderFooterHelper");jQuery.sap.require("sap.ushell.ui.footerbar.JamShareButton");jQuery.sap.require("sap.ushell.ui.footerbar.JamDiscussButton");jQuery.sap.require("sap.ushell.ui.footerbar.AddBookmarkButton");jQuery.sap.require("sap.ca.scfld.md.app.ButtonListHelper");jQuery.sap.require("sap.ushell.services.AppConfiguration");jQuery.sap.require("sap.ca.scfld.md.app.BarOverflow");jQuery.sap.require("sap.ca.scfld.md.app.BarOverflowLayoutData");function e(e,r){var n,s=r.focusInfo,i=e.oOverflowButton;if(s){if(s.area==="share"){s.area="right";s.pos=1e3;s.controlInfo={icon:"sap-icon://action",text:"",tooltip:r.shareText}}n=e.findFocusedElement(s,i);if(n){setTimeout(function(){if(!jQuery(n.$()[0]).is(":visible")){n=i}if(n){n.focus();if(o){jQuery.sap.log.debug("Restored focus on "+n.getId(),t)}}r.focusInfo=undefined},100)}else{r.focusInfo=undefined}}}sap.ui.base.Object.extend("sap.ca.scfld.md.app.CommonHeaderFooterHelper",{constructor:function(o,t,e){this.oAppImp=o;this.detailHeaderFooterRules=t;this.bAutomaticOverflow=!!e},startBuild:function(e,r,n,s){var i=e._oControlStore;e._oHeaderFooterOptions=r;var a=e.getPage();if(i){if(!this.focusInfo){this.focusInfo=i.oButtonListHelper.getFocusInfo(i.oShareSheet);if(o){jQuery.sap.log.debug("Store focus information for "+e.getMetadata().getName(),JSON.stringify(this.focusInfo),t)}}e._oControlStore.oButtonListHelper.startBuild(s)}else{e._oControlStore={};if(n){jQuery.extend(e._oControlStore,n)}e._oControlStore.oButtonListHelper=new sap.ca.scfld.md.app.ButtonListHelper(this.oAppImp,20,e._oControlStore.bAllDisabled,this.bAutomaticOverflow,this.createId(e,"scfld_OVERFLOW"));this.oAppImp.registerExitModule(function(){var o,t;if(e._oControlStore){e._oControlStore.oButtonListHelper.destroy();delete e._oControlStore.oButtonListHelper;for(o in e._oControlStore){t=e._oControlStore[o];if(t&&typeof t.destroy==="function"){t.destroy()}delete e._oControlStore[o]}delete e._oControlStore}});var u=a.getFooter();if(u&&u.destroy){u.destroy()}a.setFooter(e._oControlStore.oButtonListHelper.oBar)}return a},endBuild:function(o){var t=o._oControlStore.oButtonListHelper;t.endBuild();e(t,this)},defineFooterRight:function(o,t,e,r,n){var s=false,i=this.isUsingStableIds(),a;if(this.bAutomaticOverflow){e=1e4}if(o._oHeaderFooterOptions.oEditBtn){a={};jQuery.extend(a,o._oHeaderFooterOptions.oEditBtn);if(i){this.addIds(a,o._oHeaderFooterOptions.oEditBtn.sId,o,"scfld_EDIT")}a.style=sap.m.ButtonType.Emphasized;o._oControlStore.oButtonListHelper.ensureButton(a,"b",e);s=true}else{if(o._oHeaderFooterOptions.oPositiveAction){a={};jQuery.extend(a,o._oHeaderFooterOptions.oPositiveAction);if(i){this.addIds(a,o._oHeaderFooterOptions.oPositiveAction.sId,o,"scfld_POSITIVE")}a.style=sap.m.ButtonType.Accept;o._oControlStore.oButtonListHelper.ensureButton(a,"b",e);s=true}if(o._oHeaderFooterOptions.oNegativeAction){a={};jQuery.extend(a,o._oHeaderFooterOptions.oNegativeAction);if(i){this.addIds(a,o._oHeaderFooterOptions.oNegativeAction.sId,o,"scfld_NEGATIVE")}a.style=sap.m.ButtonType.Reject;o._oControlStore.oButtonListHelper.ensureButton(a,"b",e);s=true}}if(o._oHeaderFooterOptions.buttonList){for(var u=0;u<o._oHeaderFooterOptions.buttonList.length;u++){a={};jQuery.extend(a,o._oHeaderFooterOptions.buttonList[u]);if(i){this.addIds(a,o._oHeaderFooterOptions.buttonList[u].sId,o,undefined)}a.style=sap.m.ButtonType.Default;o._oControlStore.oButtonListHelper.ensureButton(a,"b",e);s=true}}if(r){var d=this.getGenericButtons(e,o,o._oControlStore.oButtonListHelper);s=s||d.length>0}if(this.bAutomaticOverflow){o._oControlStore.oButtonListHelper.addOverflowButton()}s=this.defineShareButton(o)||s;return s},defineShareButton:function(o){var t=this.getShareButtons(o);if(t.length==0){return false}if(!o._oControlStore.oShareSheet){o._oControlStore.oShareSheet=new sap.m.ActionSheet;o._oControlStore.oShareSheet.setShowCancelButton(true);o._oControlStore.oShareSheet.setPlacement(sap.m.PlacementType.Top)}else{o._oControlStore.oShareSheet.removeAllButtons()}this.shareText=this.oAppImp.UilibI18nModel.getResourceBundle().getText("SHARE");var e={sIcon:"sap-icon://action",sTooltip:this.shareText,onBtnPressed:function(t){if(o._oHeaderFooterOptions.oJamOptions){if(o._oHeaderFooterOptions.oJamOptions.fGetShareSettings){var e=o._oHeaderFooterOptions.oJamOptions.fGetShareSettings();if(e){o._oControlStore.oJamShareButton.setJamData(e)}}if(o._oHeaderFooterOptions.oJamOptions.fGetDiscussSettings){var r=o._oHeaderFooterOptions.oJamOptions.fGetDiscussSettings();if(r){o._oControlStore.oJamDiscussButton.setJamData(r)}}}o._oControlStore.oShareSheet.openBy(t.getSource())}};if(this.isUsingStableIds()){this.addIds(e,undefined,o,"scfld_SHARE")}o._oControlStore.oButtonListHelper.ensureButton(e,"b");for(var r=0;r<t.length;r++){o._oControlStore.oShareSheet.addButton(t[r])}return true},hasShareButtons:function(o){return o.isMainScreen()||!!(o._oHeaderFooterOptions.oEmailSettings||o._oHeaderFooterOptions.oJamOptions&&(o._oHeaderFooterOptions.oJamOptions.oShareSettings||o._oHeaderFooterOptions.oJamOptions.fGetShareSettings||o._oHeaderFooterOptions.oJamOptions.oDiscussSettings||o._oHeaderFooterOptions.oJamOptions.fGetDiscussSettings)||o._oHeaderFooterOptions.oAddBookmarkSettings||o._oHeaderFooterOptions.additionalShareButtonList&&o._oHeaderFooterOptions.additionalShareButtonList.length>0)},getShareButtons:function(o){var t=[];var e=this.getEmailButton(o);var r=this.getJamShareButton(o);var n=this.getJamDiscussButton(o);var s=this.getBookmarkButton(o);if(e){t.push(e)}if(r){t.push(r)}if(n){t.push(n)}if(s){t.push(s)}if(o._oHeaderFooterOptions.additionalShareButtonList){var i=this.getAdditionalShareButtons(o);t=t.concat(i)}return t},getEmailButton:function(o){var t;if(!o._oHeaderFooterOptions.oEmailSettings){return null}if(!o._oControlStore.oEmailButton){o._oControlStore.oEmailButton=new sap.m.Button({id:this.createId(o,"scfld_MAIL")});o._oControlStore.oEmailButton.setIcon("sap-icon://email");o._oControlStore.oEmailButton.setText(this.oAppImp.UilibI18nModel.getResourceBundle().getText("SEND_EMAIL"));o._oControlStore.oEmailButton.attachPress(function(){if(o._oHeaderFooterOptions.oEmailSettings.fGetMailBody){t=o._oHeaderFooterOptions.oEmailSettings.fGetMailBody()}else{t=null}sap.m.URLHelper.triggerEmail(o._oHeaderFooterOptions.oEmailSettings.sRecepient,o._oHeaderFooterOptions.oEmailSettings.sSubject,t)})}this.supportEnablement(o,o._oControlStore.oEmailButton,o._oHeaderFooterOptions.oEmailSettings);return o._oControlStore.oEmailButton},getJamShareButton:function(o){if(!o._oHeaderFooterOptions.oJamOptions||!(o._oHeaderFooterOptions.oJamOptions.oShareSettings||o._oHeaderFooterOptions.oJamOptions.fGetShareSettings)){return null}if(!o._oControlStore.oJamShareButton){o._oControlStore.oJamShareButton=new sap.ushell.ui.footerbar.JamShareButton({id:this.createId(o,"scfld_JAMSHARE")})}if(o._oHeaderFooterOptions.oJamOptions.oShareSettings){o._oControlStore.oJamShareButton.setJamData(o._oHeaderFooterOptions.oJamOptions.oShareSettings);this.supportEnablement(o,o._oControlStore.oJamShareButton,o._oHeaderFooterOptions.oJamOptions.oShareSettings)}return o._oControlStore.oJamShareButton},getJamDiscussButton:function(o){if(!o._oHeaderFooterOptions.oJamOptions||!(o._oHeaderFooterOptions.oJamOptions.oDiscussSettings||o._oHeaderFooterOptions.oJamOptions.fGetDiscussSettings)){return null}if(!o._oControlStore.oJamDiscussButton){o._oControlStore.oJamDiscussButton=new sap.ushell.ui.footerbar.JamDiscussButton({id:this.createId(o,"scfld_JAMDISCUSS")})}if(o._oHeaderFooterOptions.oJamOptions.oDiscussSettings){o._oControlStore.oJamDiscussButton.setJamData(o._oHeaderFooterOptions.oJamOptions.oDiscussSettings);this.supportEnablement(o,o._oControlStore.oJamDiscussButton,o._oHeaderFooterOptions.oJamOptions.oDiscussSettings)}return o._oControlStore.oJamDiscussButton},getBookmarkButton:function(o){if(o._oHeaderFooterOptions.bSuppressBookmarkButton||!o._oHeaderFooterOptions.oAddBookmarkSettings&&!o.isMainScreen()){return null}if(!o._oControlStore.oBookmarkButton){o._oControlStore.oBookmarkButton=new sap.ushell.ui.footerbar.AddBookmarkButton({id:this.createId(o,"scfld_ADDBOOKMARK")})}var t={url:document.URL,title:o._oControlStore.oTitle.getText()};jQuery.extend(t,o._oHeaderFooterOptions.oAddBookmarkSettings||{});o._oControlStore.oBookmarkButton.setAppData(t);this.supportEnablement(o,o._oControlStore.oBookmarkButton,o._oHeaderFooterOptions.oAddBookmarkSettings||{});return o._oControlStore.oBookmarkButton},supportEnablement:function(o,t,e){t.setEnabled(!e.bDisabled);if(e.sId){o._oControlStore.oButtonListHelper.mButtons[e.sId]=t}},getAdditionalShareButtons:function(o){var t=[];if(!o._oControlStore.shareButtons){o._oControlStore.shareButtons=new sap.ca.scfld.md.app.ButtonListHelper(this.oAppImp,1);o._oControlStore.oButtonListHelper.addButtonListHelper(o._oControlStore.shareButtons)}for(var e=0;e<o._oHeaderFooterOptions.additionalShareButtonList.length;e++){var r={};jQuery.extend(r,o._oHeaderFooterOptions.additionalShareButtonList[e]);if(this.isUsingStableIds()){this.addIds(r,o._oHeaderFooterOptions.additionalShareButtonList[e].sId,o,undefined)}var n=o._oControlStore.shareButtons.ensureButton(r,"b");t.push(n)}return t},getFooterRightCount:function(o,t){var e;switch(t){case"XL":e=this.detailHeaderFooterRules.maxBtnCountXL;break;case"L":e=this.detailHeaderFooterRules.maxBtnCountL;break;case"M":e=this.detailHeaderFooterRules.maxBtnCountM;break;case"S":e=this.detailHeaderFooterRules.maxBtnCountS;break;default:e=this.detailHeaderFooterRules.maxBtnCountXL}return e},getActionsCount:function(o,t){var e=0;if(o._oHeaderFooterOptions.buttonList){e=o._oHeaderFooterOptions.buttonList.length}if(o._oHeaderFooterOptions.oEditBtn){if(!t){e++}}else{if(o._oHeaderFooterOptions.oPositiveAction){e++}if(o._oHeaderFooterOptions.oNegativeAction){e++}}return e},createSettingsButton:function(o){var t;if(o._oControlStore.oSettingsButton){t=false}else{t=true}if(o._oHeaderFooterOptions.aAdditionalSettingButtons){if(!o._oControlStore.oSettingsButtonListHelper){o._oControlStore.oSettingsButtonListHelper=new sap.ca.scfld.md.app.ButtonListHelper(this.oAppImp,0);o._oControlStore.oButtonListHelper.addButtonListHelper(o._oControlStore.oSettingsButtonListHelper)}var e=[];for(var r=0;r<o._oHeaderFooterOptions.aAdditionalSettingButtons.length;r++){var n={};jQuery.extend(n,o._oHeaderFooterOptions.aAdditionalSettingButtons[r]);delete n.sIcon;var s=o._oControlStore.oSettingsButtonListHelper.ensureButton(n,"b");s.setWidth("100%");e.push(s)}sap.ushell.services.AppConfiguration.addApplicationSettingsButtons(e)}return t},getGenericButtons:function(o,t,e){var r=[];if(t._oHeaderFooterOptions.oSortOptions){r.push(this.addSortButton(o,t,e))}if(t._oHeaderFooterOptions.oFilterOptions){r.push(this.addFilterButton(o,t,e))}if(t._oHeaderFooterOptions.oGroupOptions){r.push(this.addGroupButton(o,t,e))}return r},addFilterButton:function(o,t,e){var r=this.oAppImp.UilibI18nModel.getResourceBundle().getText("FILTER"),n={bDisabled:t._oHeaderFooterOptions.oFilterOptions.bDisabled,sIcon:"sap-icon://filter",sBtnTxt:r,sTooltip:t._oHeaderFooterOptions.oFilterOptions.sTooltip||r},s;this.addIds(n,t._oHeaderFooterOptions.oFilterOptions.sId,t,"scfld_FILTER");if(t._oHeaderFooterOptions.oFilterOptions.aFilterItems){n.onChange=jQuery.proxy(function(o){e._updateCurrentSelection("filter",o);t._oHeaderFooterOptions.oFilterOptions.onFilterSelected(o)},this);n.aItems=t._oHeaderFooterOptions.oFilterOptions.aFilterItems;n.sSelectedItemKey=e._getCurrentSelection("filter",t._oHeaderFooterOptions.oFilterOptions.sSelectedItemKey);s="s"}else{n.onBtnPressed=jQuery.proxy(function(o){t._oHeaderFooterOptions.oFilterOptions.onFilterPressed(o)},this);s="b"}return e.ensureButton(n,s,o)},addSortButton:function(o,t,e){var r=this.oAppImp.UilibI18nModel.getResourceBundle().getText("SORT"),n={bDisabled:t._oHeaderFooterOptions.oSortOptions.bDisabled,sIcon:"sap-icon://sort",sBtnTxt:r,sTooltip:t._oHeaderFooterOptions.oSortOptions.sTooltip||r},s;this.addIds(n,t._oHeaderFooterOptions.oSortOptions.sId,t,"scfld_SORT");if(t._oHeaderFooterOptions.oSortOptions.aSortItems){n.onChange=jQuery.proxy(function(o){e._updateCurrentSelection("sort",o);t._oHeaderFooterOptions.oSortOptions.onSortSelected(o)},this);n.aItems=t._oHeaderFooterOptions.oSortOptions.aSortItems;n.sSelectedItemKey=e._getCurrentSelection("sort",t._oHeaderFooterOptions.oSortOptions.sSelectedItemKey);s="s"}else{n.onBtnPressed=jQuery.proxy(function(o){t._oHeaderFooterOptions.oSortOptions.onSortPressed(o)},this);s="b"}return e.ensureButton(n,s,o)},addGroupButton:function(o,t,e){var r=this.oAppImp.UilibI18nModel.getResourceBundle().getText("GROUP"),n={bDisabled:t._oHeaderFooterOptions.oGroupOptions.bDisabled,sIcon:"sap-icon://group-2",sBtnTxt:r,sTooltip:t._oHeaderFooterOptions.oGroupOptions.sTooltip||r},s;this.addIds(n,t._oHeaderFooterOptions.oGroupOptions.sId,t,"scfld_GROUP");if(t._oHeaderFooterOptions.oGroupOptions.aGroupItems){n.onChange=jQuery.proxy(function(o){e._updateCurrentSelection("group",o);t._oHeaderFooterOptions.oGroupOptions.onGroupSelected(o)},this);n.aItems=t._oHeaderFooterOptions.oGroupOptions.aGroupItems;n.sSelectedItemKey=e._getCurrentSelection("group",t._oHeaderFooterOptions.oGroupOptions.sSelectedItemKey);s="s"}else{n.onBtnPressed=jQuery.proxy(function(o){t._oHeaderFooterOptions.oGroupOptions.onGroupPressed(o)},this);s="b"}return e.ensureButton(n,s,o)},ensureHeader:function(o,t,e,r,n){if(!o._oControlStore.oHeaderBar){o._oControlStore.oHeaderBar=new sap.m.Bar;n=this.isUsingStableIds()&&n?this.createId(o,n):undefined;o._oControlStore.oTitle=new sap.m.Title(n,{level:sap.ui.core.TitleLevel.H2});o._oControlStore.oHeaderBar.addContentMiddle(o._oControlStore.oTitle);var s=t.getCustomHeader();if(s&&s.destroy){s.destroy()}t.setCustomHeader(o._oControlStore.oHeaderBar)}this.setBackButton(o,o._oControlStore.oHeaderBar,e,r)},setAppHeaderBtn:function(o,t){if(!o._oControlStore.oHeaderBar){return}if(!o._oControlStore.oHeaderBtn){if(t.sId){o._oControlStore.oHeaderBtn=new sap.m.Button(t.sId)}else{o._oControlStore.oHeaderBtn=new sap.m.Button}o._oControlStore.oHeaderBar.addContentRight(o._oControlStore.oHeaderBtn)}var e=o._oControlStore.oHeaderBtn;if(t.sIcon){e.setIcon(t.sIcon)}if(t.onBtnPressed){e.attachPress(t.onBtnPressed)}if(t.sText){e.setText(t.sText)}else if(t.oTextBinding){if(t.oTextBinding.elementPath){if(t.oTextBinding.parameters){e.bindElement(t.oTextBinding.elementPath,t.oTextBinding.parameters)}else{e.bindElement(t.oTextBinding.elementPath)}}if(t.oTextBinding.property){e.bindProperty("text",t.oTextBinding.property)}}else if(this.oAppImp.bIsPhone&&t.i18nPhoneTxt){e.setText(this.oAppImp.UilibI18nModel.getResourceBundle().getText(t.i18nPhoneTxt))}else if(t.i18nTxt){e.setText(this.oAppImp.UilibI18nModel.getResourceBundle().getText(t.i18nTxt))}},setBackButton:function(o,t,e,r){if(r||e&&o._oHeaderFooterOptions.onBack===null){o._oControlStore.fBack=null}else if(e&&o._oHeaderFooterOptions.onBack==undefined){if(window.history.length==0){o._oControlStore.fBack=null}else{o._oControlStore.fBack=function(){window.history.back(1)}}}else{o._oControlStore.fBack=o._oHeaderFooterOptions.onBack}if(o._oControlStore.oBackButton){o._oControlStore.oBackButton.setVisible(!!o._oControlStore.fBack)}else if(o._oControlStore.fBack){o._oControlStore.oBackButton=new sap.m.Button({id:this.createId(o,"scfld_BACK")});o._oControlStore.oBackButton.setIcon("sap-icon://nav-back");o._oControlStore.oBackButton.setTooltip(this.oAppImp.UilibI18nModel.getResourceBundle().getText("BACK"));o._oControlStore.oBackButton.attachPress(function(t){o._oControlStore.fBack(t)});t.addContentLeft(o._oControlStore.oBackButton)}},getGenericCount:function(o){var t=0;if(o._oHeaderFooterOptions.oSortOptions){t++}if(o._oHeaderFooterOptions.oFilterOptions){t++}if(o._oHeaderFooterOptions.oGroupOptions){t++}return t},addIds:function(o,t,e,r){var n=sap.ui.core.ID.isValid(t)?t:r;delete o.sControlId;delete o.sId;if(this.isUsingStableIds()){o.sControlId=this.createId(e,n);o.sId=t||r}else{o.sId=t}},createId:function(o,t){if(this.isUsingStableIds()&&t&&sap.ui.core.ID.isValid(t)){return o.getView().createId(t)}return undefined},isUsingStableIds:function(){return this.oAppImp.oConfiguration&&this.oAppImp.oConfiguration.isUsingStableIds&&this.oAppImp.oConfiguration.isUsingStableIds()}});sap.ca.scfld.md.app.CommonHeaderFooterHelper.getPageFromController=function(o){return o.getView().getContent()[0]}})();
//# sourceMappingURL=CommonHeaderFooterHelper.js.map