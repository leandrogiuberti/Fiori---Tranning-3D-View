/*
 * Copyright (C) 2009-2014 SAP SE or an SAP affiliate company. All rights reserved
 */
sap.ui.define(["sap/ui/base/Object","./BarOverflowLayoutData","sap/ui/core/ResizeHandler"],function(e,t,i){"use strict";var o=e.extend("sap.ca.scfld.md.app.BarOverflow",{constructor:function(t,i,o){e.apply(this,arguments);this._oBar=t;this._oActionSheet=i;this._previousBarWidth=0;this._bActionSheetGotCleared=false;this._bInitialized=false;this._fnResized=o;this._oEventDelegate={onAfterRendering:this._attachResize,onBeforeRendering:this._detachResize};if(t.getDomRef()){this._handleSizeChange()}t.addEventDelegate(this._oEventDelegate,this)},buttonTextChanged:function(){if(this._iTimeout){return}var e=this;this._iTimeout=setTimeout(function(){e._handleSizeChange(true);e._iTimeout=null},0)},_detachResize:function(){if(this._sResizeListenerId===undefined){return}i.deregister(this._sResizeListenerId);this._sResizeListenerId=undefined},_attachResize:function(){if(!this._oBar.getDomRef()){return}if(this._sResizeListenerId!==undefined){return}this._handleSizeChange();this._sResizeListenerId=i.register(this._oBar.getDomRef(),jQuery.proxy(this._handleSizeChange,this))},_initialize:function(){var e=this._oBar.getContentRight();this._bInitialized=true;this._oControlOrder={};e.forEach(function(e,t){this._oControlOrder[e.sId]={index:t}},this);this._oActionSheet.getButtons().forEach(function(t,i){this._oControlOrder[t.sId]={index:i+e.length}},this)},_clearActionSheet:function(){this._bActionSheetGotCleared=true;if(this._fnResized){this._fnResized()}},_calculateLeftWidth:function(){var e=this._oBar._$LeftBar,t=0,i;if(e){i=e.css("width");e.css({width:"",visibility:"hidden"});t=e.outerWidth(true);e.css({width:i,visibility:""})}return t},_handleSizeChange:function(e){var t=this._oBar.$().width()-this._calculateLeftWidth();if(!this._bInitialized){this._initialize()}if(this._previousBarWidth===t&&!e&&!this._bActionSheetGotCleared){return}this._bActionSheetGotCleared=false;if(this._oActionSheet.getButtons().length){this._clearActionSheet();return}this._previousBarWidth=t;if(!this._oBar.getContentRight().length){return}this._moveControlsToOverflow(t)},_calculateOverflowData:function(e){var i=0,o=null,n=[];this._oBar.getContentRight().forEach(function(e){var s=false,r=e.$().outerWidth(true),h={stayInOverflow:false,isOverflowButton:s,moveToOverflow:true,control:e,width:r};var a=e.getLayoutData();if(a instanceof t){s=a.getOverflowButton();h.stayInOverflow=a.getStayInOverflow();h.isOverflowButton=s;if(!s){h.moveToOverflow=a.getMoveToOverflow()}else{if(!r){r=48;h.width=r}o=h;h.moveToOverflow=false}}var f=e.getMetadata().getName();if(f!=="sap.m.Button"&&f!=="sap.m.Select"){h.moveToOverflow=false}n.push(h);i+=r},this);var s=i-e;return{buttonInfos:n,overflowInPx:s,overflowButtonInfo:o}},_moveControlsToOverflow:function(e){var t=this._calculateOverflowData(e),i=t.buttonInfos,o=t.overflowInPx,n=false,s=t.overflowButtonInfo,r=[],h=[];i=i.filter(function(e){if(!e.stayInOverflow){return true}n=true;o-=e.width;r.push(e.control);return false},this);if(s){if(!n&&o-s.width<=0){o-=s.width}}i.reverse();i.some(function(e){var t=o<=0;if(t){return t}if(e.moveToOverflow){o-=e.width;h.push(e.control)}});h.reverse();h=h.concat(r);if(h.length>0){if(this._fnResized){this._fnResized(h)}}else{if(this._oActionSheet.isOpen()){this._oActionSheet.close()}}},destroy:function(){if(this._oActionSheet.isOpen()){this._oActionSheet.close()}e.apply(this,arguments);this._oBar.removeEventDelegate(this._oEventDelegate,this);this._detachResize()}});return o},true);
//# sourceMappingURL=BarOverflow.js.map