/*
 * Copyright (C) 2009-2014 SAP SE or an SAP affiliate company. All rights reserved
 */
jQuery.sap.declare("sap.ca.scfld.md.app.MasterHeaderFooterHelper");sap.ui.base.Object.extend("sap.ca.scfld.md.app.MasterHeaderFooterHelper",{constructor:function(e){this.oApplicationImplementation=e;this.oCommonHeaderFooterHelper=new sap.ca.scfld.md.app.CommonHeaderFooterHelper(e,{})},defineMasterHeaderFooter:function(e,t){this.defineMasterHeaderFooterInner(e,t)},defineMasterHeaderFooterInner:function(e,t){var o=e.getHeaderFooterOptions();this.setHeaderFooter(e,o,t)},setHeaderFooter:function(e,t,o,r){if(!t){return}var i=this.oCommonHeaderFooterHelper.startBuild(e,t,{bEditState:false,bIsSearching:false,bAllDisabled:o},r);this.defineHeader(e,i);this.defineFooter(e,i);this.oApplicationImplementation.oCurController.MasterCtrl=e;this.oApplicationImplementation.oCurController.FullCtrl=null;this.oCommonHeaderFooterHelper.endBuild(e)},defineHeader:function(e,t){var o=t.getCustomHeader();if(!o){o=new sap.m.Bar;t.setCustomHeader(o)}this.defineMasterSubHeader(e,t);var r=-1;if(!e.isBackendSearch()){if(e._oControlStore.oMasterSearchField){var i=e._oControlStore.oMasterSearchField.getValue();if(i){r=e.applySearchPattern(i);e.evaluateClientSearchResult(r,e.getList(),e._emptyList)}}}if(r<0){if(e._oMasterListBinding){r=e._oMasterListBinding.getLength()}else{var n=e.getList();var a=n.getItems();r=0;for(var s=0;s<a.length;s++){if(!(a[s]instanceof sap.m.GroupHeaderListItem)){r++}}}}this.defineMasterTitle(e,o,r);this.oCommonHeaderFooterHelper.setBackButton(e,o,true);this.defineEditButton(e,o)},defineFooter:function(e,t){this.defineSettingsButton(e);this.defineFooterRight(e)},defineMasterSubHeader:function(e,t){if(e._oControlStore.oMasterSearchField||e._oControlStore.oMasterPullToRefresh){return}var o=new sap.m.Bar;t.setSubHeader(o);var r=sap.ui.Device.support.touch;this.createMasterSearchField(e,o,r);if(r&&!e._oControlStore.bAllDisabled){this.createMasterPullToRefresh(e,t)}},createMasterSearchField:function(e,t,o){e._oControlStore.oMasterSearchField=new sap.m.SearchField({id:this.oCommonHeaderFooterHelper.createId(e,"scfld_SEARCH")});e._oControlStore.oMasterSearchField.setEnabled(!e._oControlStore.bAllDisabled);if(!o){e._oControlStore.oMasterSearchField.setShowRefreshButton(true);e._oControlStore.oMasterSearchField.setRefreshButtonTooltip(this.oApplicationImplementation.UilibI18nModel.getResourceBundle().getText("REFRESH"))}e._oControlStore.oMasterSearchField.setShowRefreshButton(!o);e._oControlStore.oMasterSearchField.setSelectOnFocus(false);e._oControlStore.sMasterSearchText=null;e._oControlStore.oMasterSearchField.attachSearch(jQuery.proxy(function(t){this.handleMasterSearch(e,t)},this));if(e.isLiveSearch()){var r=e;e._oControlStore.oMasterSearchField.attachLiveChange(jQuery.proxy(function(){r._applyClientSideSearch();r._oControlStore.sMasterSearchText=r._oControlStore.oMasterSearchField.getValue()},this))}if(e._oHeaderFooterOptions.sI18NSearchFieldPlaceholder){var i=this.oApplicationImplementation.AppI18nModel.getResourceBundle();var n=i.getText(e._oHeaderFooterOptions.sI18NSearchFieldPlaceholder)}else{var i=this.oApplicationImplementation.UilibI18nModel.getResourceBundle();var n=i.getText("MASTER_PLACEHOLDER_SEARCHFIELD")}e._oControlStore.oMasterSearchField.setPlaceholder(n);t.addContentMiddle(e._oControlStore.oMasterSearchField)},createMasterPullToRefresh:function(e,t){e._oControlStore.oMasterPullToRefresh=new sap.m.PullToRefresh;e._oControlStore.oMasterPullToRefresh.attachRefresh(jQuery.proxy(function(){this.handleMasterPullToRefresh(e)},this));t.insertContent(e._oControlStore.oMasterPullToRefresh,0)},handleMasterSearch:function(e,t){var o=e.isBackendSearch();var r=t.getParameter("refreshButtonPressed");if(!r){e._oControlStore.sMasterSearchText=e._oControlStore.oMasterSearchField.getValue()}if(r||o){this.refreshList(e,r)}if(!o&&!e.isLiveSearch()){e._applyClientSideSearch();e._oControlStore.sMasterSearchText=e._oControlStore.oMasterSearchField.getValue()}},handleMasterPullToRefresh:function(e){this.refreshList(e,true)},refreshList:function(e,t){var o=e.isBackendSearch();t=t&&(e._oControlStore.sMasterSearchText!=null||e._oMasterListBinding!=null);e._oControlStore.bIsSearching=!t;if(t){var r=e._oControlStore.sMasterSearchText;if(r===null){r=""}e._oControlStore.oMasterSearchField.setValue(r);this.oApplicationImplementation.bManualMasterRefresh=true}else{var r=e._oControlStore.oMasterSearchField.getValue()}var i=e.getList();this.oApplicationImplementation.aKeyValues=null;if(this.oApplicationImplementation.aMasterKeys){var n=i.getItems();for(var a=0;a<n.length;a++){var s=n[a];if(s.getSelected()){this.oApplicationImplementation.aKeyValues=[];var l=s.getBindingContext(e.sModelName);for(var d=0;d<this.oApplicationImplementation.aMasterKeys.length;d++){this.oApplicationImplementation.aKeyValues.push(l.getProperty(this.oApplicationImplementation.aMasterKeys[d]))}a=n.length}}}if(e._oHeaderFooterOptions.onRefresh){var h=jQuery.proxy(function(){this.oApplicationImplementation.onMasterRefreshed(e);if(e._oControlStore.oMasterPullToRefresh){e._oControlStore.oMasterPullToRefresh.hide()}},this);var c=e._oHeaderFooterOptions.onRefresh(r,h);if(c==0){this.aKeyValues=null;e._oControlStore.bIsSearching=false;if(e._oControlStore.oMasterPullToRefresh){e._oControlStore.oMasterPullToRefresh.hide()}}if(c<=0){if(c<0){this.setMasterListVisible(e)}return}}var p=e._oMasterListBinding;var u=!p;if(p){p.attachChange(e._onMasterListLoaded,e);var S=jQuery.proxy(function(){if(e._oControlStore.oMasterPullToRefresh){e._oControlStore.oMasterPullToRefresh.hide()}if(o){e._oControlStore.sMasterSearchText=r;e._oControlStore.oMasterSearchField.setValue(e._oControlStore.sMasterSearchText)}p.detachDataReceived(S)},this);var f=jQuery.proxy(function(){u=true;p.detachDataRequested(f)},this);p.attachDataRequested(f);p.attachDataReceived(S)}if(o&&!t){var C=e.applyBackendSearchPattern(r,p);if(C){p.detachDataRequested(f);p.detachDataReceived(S);return}if(p&&p!=e._oMasterListBinding){p.detachDataRequested(f);p.detachDataReceived(S);e._oControlStore.sMasterSearchText=r;this.setMasterListVisible(e);return}}if((o||t)&&(!u&&e._oMasterListBinding)){e._oMasterListBinding.refresh()}this.setMasterListVisible(e)},setMasterListVisible:function(e){if(e._emptyList&&!e._emptyList.hasStyleClass("hiddenList")){e._emptyList.addStyleClass("hiddenList");e.getList().removeStyleClass("hiddenList")}},defineMasterTitle:function(e,t,o){var r;if(!e._oHeaderFooterOptions.sI18NMasterTitle){return}if(!e._oControlStore.oMasterTitle){if(this.oCommonHeaderFooterHelper.isUsingStableIds()){r=e._oHeaderFooterOptions.sMasterTitleId;r=this.oCommonHeaderFooterHelper.createId(e,r)}e._oControlStore.oMasterTitle=new sap.m.Title(r,{level:sap.ui.core.TitleLevel.H2});e.getList().addAriaLabelledBy(e._oControlStore.oMasterTitle);t.addContentMiddle(e._oControlStore.oMasterTitle)}this.setMasterTitle(e,o)},setMasterTitle:function(e,t){if(!e._oControlStore.oMasterTitle){return}var o=this.oApplicationImplementation.AppI18nModel.getResourceBundle();var r=o.getText(e._oHeaderFooterOptions.sI18NMasterTitle,[t]);e._oControlStore.oMasterTitle.setText(r)},defineEditButton:function(e,t){var o;if(e._oHeaderFooterOptions.onEditPress||e._oHeaderFooterOptions.oEditBtn){if(!e._oControlStore.oEditBtn){var o=e._oHeaderFooterOptions.oEditBtn&&this.oCommonHeaderFooterHelper.createId(e,e._oHeaderFooterOptions.oEditBtn.sId);if(!o){o=this.oCommonHeaderFooterHelper.createId(e,"scfld_EDIT")}e._oControlStore.oEditBtn=new sap.m.Button({id:o});t.addContentRight(e._oControlStore.oEditBtn);e._oControlStore.oEditBtn.attachPress(jQuery.proxy(function(){if(e._oControlStore.bEditState){e._oControlStore.oEditBtn.setIcon("sap-icon://multi-select");e._oControlStore.oEditBtn.setTooltip(this.oApplicationImplementation.UilibI18nModel.getResourceBundle().getText("MULTI_SELECT"))}else{e._oControlStore.oEditBtn.setIcon("sap-icon://sys-cancel");e._oControlStore.oEditBtn.setTooltip(this.oApplicationImplementation.UilibI18nModel.getResourceBundle().getText("CANCEL"))}e._oControlStore.bEditState=!e._oControlStore.bEditState;(e._oHeaderFooterOptions.onEditPress||e._oHeaderFooterOptions.oEditBtn.onBtnPressed)(e._oControlStore.bEditState)},this))}if(e._oControlStore.bEditState){e._oControlStore.oEditBtn.setIcon("sap-icon://sys-cancel");e._oControlStore.oEditBtn.setTooltip(this.oApplicationImplementation.UilibI18nModel.getResourceBundle().getText("CANCEL"))}else{e._oControlStore.oEditBtn.setIcon("sap-icon://multi-select");e._oControlStore.oEditBtn.setTooltip(this.oApplicationImplementation.UilibI18nModel.getResourceBundle().getText("MULTI_SELECT"))}e._oControlStore.oEditBtn.setVisible(true);e._oControlStore.oEditBtn.setEnabled(!(!(e._oHeaderFooterOptions.onEditPress||!e._oHeaderFooterOptions.oEditBtn.bDisabled)||e._oControlStore.bAllDisabled));if(e._oHeaderFooterOptions.oEditBtn&&e._oHeaderFooterOptions.oEditBtn.sId){e._oControlStore.oButtonListHelper.mButtons[e._oHeaderFooterOptions.oEditBtn.sId]=e._oControlStore.oEditBtn}}else if(e._oControlStore.oEditBtn){e._oControlStore.oEditBtn.setVisible(false)}},defineSettingsButton:function(e){this.oCommonHeaderFooterHelper.createSettingsButton(e)},defineFooterRight:function(e){var t=this.getFooterRightCount(e);if(e._oHeaderFooterOptions.buttonList){for(var o=0;o<e._oHeaderFooterOptions.buttonList.length;o++){var r={};jQuery.extend(r,e._oHeaderFooterOptions.buttonList[o]);delete r.sIcon;if(this.oCommonHeaderFooterHelper.isUsingStableIds()){this.oCommonHeaderFooterHelper.addIds(r,e._oHeaderFooterOptions.buttonList[o].sId,e,undefined)}e._oControlStore.oButtonListHelper.ensureButton(r,"b",t)}}this.oCommonHeaderFooterHelper.getGenericButtons(t,e,e._oControlStore.oButtonListHelper);if(e._oHeaderFooterOptions.onAddPress||e._oHeaderFooterOptions.oAddOptions){this.addAddButton(e)}},getFooterRightCount:function(e){var t=1;var o=2;var r=t;var i=this.oCommonHeaderFooterHelper.getGenericCount(e);var n=this.oCommonHeaderFooterHelper.getActionsCount(e,true);if(this.oApplicationImplementation.bIsPhone&&sap.ui.Device.orientation.landscape){if(n===1&&i<4){return n+i}r=o}if(n===0){return 3}if(n===r&&i===1){return r+1}return r},addAddButton:function(e){if(e._oHeaderFooterOptions.onAddPress){var t={onBtnPressed:e._oHeaderFooterOptions.onAddPress,sTooltip:this.oApplicationImplementation.UilibI18nModel.getResourceBundle().getText("ADD")}}else{var t={};jQuery.extend(t,e._oHeaderFooterOptions.oAddOptions);delete t.sBtnText;delete t.sI18nBtnTxt}if(this.oCommonHeaderFooterHelper.isUsingStableIds()){this.oCommonHeaderFooterHelper.addIds(t,e._oHeaderFooterOptions.oAddOptions?e._oHeaderFooterOptions.oAddOptions.sId:undefined,e,"scfld_ADD")}t.sIcon="sap-icon://add";e._oControlStore.oButtonListHelper.ensureButton(t,"b")}});
//# sourceMappingURL=MasterHeaderFooterHelper.js.map