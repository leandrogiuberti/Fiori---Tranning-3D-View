/*!
 * OpenUI5
 * (c) Copyright 2025 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["sap/ui/core/Lib","sap/ui/core/Messaging","sap/ui/thirdparty/jquery","sap/ui/core/Control","sap/ui/core/CustomData","sap/ui/core/IconPool","sap/ui/core/HTML","sap/ui/core/Icon","./Button","./Toolbar","./Title","sap/ui/Device","./ToolbarSpacer","./List","./MessageListItem","./library","./Text","./SegmentedButton","./Page","./NavContainer","./Link","./MessageItem","./GroupHeaderListItem","sap/ui/core/InvisibleText","sap/ui/core/InvisibleMessage","sap/ui/core/library","sap/ui/core/message/MessageType","sap/ui/base/ManagedObject","./MessageViewRenderer","sap/ui/events/KeyCodes","sap/base/Log","sap/base/security/URLListValidator","sap/ui/thirdparty/caja-html-sanitizer"],function(e,t,jQuery,s,i,a,n,o,r,l,u,g,p,c,h,d,_,f,m,y,v,I,T,L,C,M,S,P,w,B,b,D){"use strict";var H=M.ValueState;var E=d.ListType;var A=s.extend("sap.m.MessageView",{metadata:{library:"sap.m",properties:{asyncDescriptionHandler:{type:"function",group:"Behavior",defaultValue:null},asyncURLHandler:{type:"function",group:"Behavior",defaultValue:null},groupItems:{type:"boolean",group:"Behavior",defaultValue:false},showDetailsPageHeader:{type:"boolean",group:"Behavior",defaultValue:true}},defaultAggregation:"items",aggregations:{items:{type:"sap.m.MessageItem",multiple:true,singularName:"item"},headerButton:{type:"sap.m.Button",multiple:false},_navContainer:{type:"sap.m.NavContainer",multiple:false,visibility:"hidden"}},events:{afterOpen:{parameters:{openBy:{type:"sap.ui.core.Control"}},deprecated:true},itemSelect:{parameters:{item:{type:"sap.m.MessageItem"},messageTypeFilter:{type:"module:sap/ui/core/message/MessageType"}}},listSelect:{parameters:{messageTypeFilter:{type:"module:sap/ui/core/message/MessageType"}}},longtextLoaded:{},urlValidated:{},activeTitlePress:{parameters:{item:{type:"sap.m.MessageItem"}}},onClose:{}}},renderer:w});var k="sapMMsgView";var V={back:a.getIconURI("nav-back"),close:a.getIconURI("decline"),information:a.getIconURI("information"),warning:a.getIconURI("alert"),error:a.getIconURI("error"),success:a.getIconURI("sys-enter-2")};var x=["all","error","warning","success","information"];var R=["asyncDescriptionHandler","asyncURLHandler"];var O={asyncDescriptionHandler:function(e){var t=e.item.getLongtextUrl();if(t){jQuery.ajax({type:"GET",url:t,success:function(t){e.item.setDescription(t);e.promise.resolve()},error:function(){var s="A request has failed for long text data. URL: "+t;b.error(s);e.promise.reject(s)}})}}};A.setDefaultHandlers=function(e){R.forEach(function(t){if(e.hasOwnProperty(t)){O[t]=e[t]}})};A.prototype.init=function(){var t=this;this._bHasHeaderButton=false;this._bShowCustomHeader=false;this._oResourceBundle=e.getResourceBundleFor("sap.m");this._createNavigationPages();this._createLists();R.forEach(function(e){if(O.hasOwnProperty(e)){t.setProperty(e,O[e])}})};A.prototype._afterNavigate=function(){setTimeout(this["_restoreFocus"].bind(this),0);setTimeout(this["_restoreItemsType"].bind(this),0)};A.prototype._restoreFocus=function(){if(this._isListPage()&&this.getItems().length){this._oLists[this._sCurrentList||"all"].focus()}else if(this._oBackButton){this._oBackButton.focus()}};A.prototype._restoreItemsType=function(){if(this._isListPage()&&this.getItems().length>1){var e=this;this._oLists[this._sCurrentList||"all"].getItems().forEach(function(t){if(t.isA("sap.m.MessageListItem")){e._setItemType(t)}})}};A.prototype._setItemType=function(e){var t=e.getTitleRef();if(t&&t.offsetWidth<t.scrollWidth){if(this.getItems().length===1){this._fnHandleForwardNavigation(e,"show")}}};A.prototype.onBeforeRendering=function(){var e,t,s=this.getItems();if(!this._oInvisibleMessage){this._oInvisibleMessage=C.getInstance()}this._clearLists();this._detailsPage.setShowHeader(this.getShowDetailsPageHeader());if(this.getGroupItems()){e=this._groupItems(s);this._fillGroupedLists(e)}else{this._fillLists(s)}var i=this.getHeaderButton();if(i){this._bHasHeaderButton=true;this._oListHeader.insertContent(i,2)}this._clearSegmentedButton();this._fillSegmentedButton();this._fnFilterList(this._getCurrentMessageTypeFilter()||"all");t=this._oLists.all.getItems().filter(function(e){return e.isA("sap.m.MessageListItem")});if(t.length===1&&t[0].getType()===E.Navigation){if(this._navContainer.getCurrentPage()!==this._detailsPage){this._fnHandleForwardNavigation(t[0],"show");this._navContainer._pageStack[this._navContainer._pageStack.length-1].transition="slide"}}else if(t.length===0){this._navContainer.backToTop()}this._makeAutomaticBinding()};A.prototype._updateDescription=function(e){if(this._isListPage()){return}if(!e._oListItem){this._mapItemToListItem(e)}this._updateDescriptionPage(e,e._oListItem)};A.prototype._updateDescriptionPage=function(e,t){this._clearDetailsPage();this._setTitle(e,t);this._setSubtitle(e);this._setDescription(e);this._setIcon(e,t);this._detailsPage.invalidate()};A.prototype._fillGroupedLists=function(e){var t=Object.keys(e),s=t.indexOf(""),i;if(s!==-1){i=e[""];this._fillLists(i);delete e[""];t.splice(s,1)}t.forEach(function(t){this._fillListsWithGroups(t,e[t])},this)};A.prototype._fillListsWithGroups=function(e,t){var s=new T({title:e});this._oLists["all"].addItemGroup(null,s,true);["error","warning","success","information"].forEach(function(e){if(this._hasGroupItemsOfType(t,e)){this._oLists[e].addItemGroup(null,s.clone(),true)}},this);this._fillLists(t)};A.prototype._hasGroupItemsOfType=function(e,t){return e.some(function(e){return e.getType().toLowerCase()===t})};A.prototype.exit=function(){if(this._oLists){this._destroyLists()}if(this._oInvisibleMessage){this._oInvisibleMessage.destroy();this._oInvisibleMessage=null}if(this._oMessageItemTemplate){this._oMessageItemTemplate.destroy()}this._oResourceBundle=null;this._oListHeader=null;this._oDetailsHeader=null;this._oSegmentedButton=null;this._oBackButton=null;this._navContainer=null;this._listPage=null;this._detailsPage=null;this._sCurrentList=null};A.prototype._makeAutomaticBinding=function(){var e=this.getItems();if(!this.getBindingInfo("items")&&!e.length){this._bindToMessageModel()}};A.prototype._bindToMessageModel=function(){var e=this;this.setModel(t.getMessageModel(),"message");this._oMessageItemTemplate=new I({type:"{message>type}",title:"{message>message}",description:"{message>description}",longtextUrl:"{message>longtextUrl}"});this.bindAggregation("items",{path:"message>/",template:e._oMessageItemTemplate})};A.prototype._groupItems=function(e){var t={},s;e.forEach(function(e){s=e.getGroupName();t[s]=t[s]||[];t[s].push(e)});return t};A.prototype._onkeypress=function(e){if(e.shiftKey&&e.keyCode==B.ENTER){this.navigateBack()}};A.prototype._getListHeader=function(){return this._oListHeader||this._createListHeader()};A.prototype._getDetailsHeader=function(){return this._oDetailsHeader||this._createDetailsHeader()};A.prototype._createListHeader=function(){var e=this._oResourceBundle.getText("MESSAGEPOPOVER_CLOSE");var t=this.getId()+"-CloseBtnDescr";var s=new n(t,{content:'<span id="'+t+'" class="sapMMsgViewHiddenContainer">'+e+"</span>"});var i=this._oResourceBundle.getText("MESSAGEPOPOVER_ARIA_HEADING"),a=this.getId()+"-HeadingDescr",o=L.getStaticId("sap.m","MESSAGEVIEW_SEGMENTED_BTN_DESCRIPTION"),r=new n(a,{content:'<span id="'+a+'" class="sapMMsgViewHiddenContainer" role="heading">'+i+"</span>"});this._oSegmentedButton=new f(this.getId()+"-segmented",{ariaLabelledBy:o}).addStyleClass("sapMSegmentedButtonNoAutoWidth");this._oListHeader=new l({content:[this._oSegmentedButton,new p,s,r]});return this._oListHeader};A.prototype._createDetailsHeader=function(){var e=this._oResourceBundle.getText("MESSAGEPOPOVER_CLOSE");var t=this.getId()+"-CloseBtnDetDescr";var s=new n(t,{content:'<span id="'+t+'" class="sapMMsgViewHiddenContainer">'+e+"</span>"});var i=this._oResourceBundle.getText("MESSAGEPOPOVER_ARIA_BACK_BUTTON_TOOLTIP");var a=this._oResourceBundle.getText("MESSAGEPOPOVER_ARIA_BACK_BUTTON");var o=this.getId()+"-BackBtnDetDescr";var u=new n(o,{content:'<span id="'+o+'" class="sapMMsgViewHiddenContainer">'+a+"</span>"});this._oBackButton=new r({icon:V["back"],press:this.navigateBack.bind(this),ariaLabelledBy:u,tooltip:i}).addStyleClass(k+"BackBtn");this._oDetailsHeader=new l({content:[this._oBackButton,new p,s,u]});return this._oDetailsHeader};A.prototype.insertTitle=function(e){const t=this._oResourceBundle.getText("MESSAGEPOPOVER_ARIA_BACK_BUTTON");const s=new u({text:t});e.insertContent(s,1)};A.prototype._createCustomHeader=function(){const e=this._oResourceBundle.getText("MESSAGEPOPOVER_ARIA_HEADING");const t=new l({content:[new u({text:e}),new p,this.getCloseBtn()]}).addStyleClass(k+"CustomHeader");return t};A.prototype.setupCustomHeader=function(){if(this._bShowCustomHeader){this._listPage.setCustomHeader(this._createCustomHeader());this._listPage.setSubHeader(this._getListHeader())}else{this._listPage.setCustomHeader(this._getListHeader())}};A.prototype.getCloseBtn=function(){const e=this;var t=this._oResourceBundle.getText("MESSAGEPOPOVER_CLOSE"),s=new r({icon:V["close"],visible:!g.system.phone,tooltip:t,press:function(){e.fireOnClose()}}).addStyleClass("sapMMsgPopoverCloseBtn");return s};A.prototype._createNavigationPages=function(){this._listPage=new m(this.getId()+"listPage",{});this.setupCustomHeader();this._detailsPage=new m(this.getId()+"-detailsPage",{customHeader:this._getDetailsHeader()}).addStyleClass("sapMMsgViewDetailsPage");this._detailsPage.addEventDelegate({onclick:function(e){var t=e.target;if(t.nodeName.toUpperCase()==="A"&&(t.className.indexOf("sapMMsgViewItemDisabledLink")!==-1||t.className.indexOf("sapMMsgViewItemPendingLink")!==-1)){e.preventDefault()}}});this._navContainer=new y(this.getId()+"-navContainer",{initialPage:this.getId()+"listPage",pages:[this._listPage,this._detailsPage],afterNavigate:this._afterNavigate.bind(this)});this.setAggregation("_navContainer",this._navContainer);return this};A.prototype._createLists=function(){this._oLists={};x.forEach(function(e){this._oLists[e]=new c({itemPress:this._fnHandleItemPress.bind(this),visible:false});this._listPage.addAggregation("content",this._oLists[e],true)},this);return this};A.prototype._clearLists=function(){x.forEach(function(e){if(this._oLists[e]){this._oLists[e].destroyAggregation("items",true)}},this);return this};A.prototype._destroyLists=function(){x.forEach(function(e){this._oLists[e]=null},this);this._oLists=null};A.prototype._fillLists=function(e){e.forEach(function(e){var t=this._mapItemToListItem(e),s=this._mapItemToListItem(e);this._oLists["all"].addAggregation("items",t,true);this._oLists[e.getType().toLowerCase()].addAggregation("items",s,true)},this)};A.prototype._mapItemToListItem=function(e){if(!e){return null}const t=140;var s=e.getType(),i=this,a=this._getItemType(e),n=new h({title:P.escapeSettingsValue(e.getTitle()),description:P.escapeSettingsValue(e.getSubtitle()),counter:e.getCounter(),icon:this._mapIcon(s),infoState:this._mapInfoState(s),info:"",type:a,messageType:e.getType(),activeTitle:e.getActiveTitle(),wrapping:true,wrapCharLimit:t,activeTitlePress:function(){i.fireActiveTitlePress({item:e})}}).addStyleClass(k+"Item").addStyleClass(k+"Item"+s).toggleStyleClass(k+"ItemActive",e.getActiveTitle());if(a!==E.Navigation){n.addEventDelegate({onAfterRendering:function(){i._setItemType(n)}},this)}n._oMessageItem=e;e._oListItem=n;return n};A.prototype._mapInfoState=function(e){if(!e){return null}switch(e){case S.Warning:return H.Warning;case S.Error:return H.Error;case S.Success:return H.Success;case S.Information:case S.None:return H.None;default:b.warning("The provided MessageType is not mapped to a specific ValueState",e);return null}};A.prototype._mapIcon=function(e){if(!e){return null}return V[e.toLowerCase()]};A.prototype._getItemType=function(e){return e.getDescription()||e.getMarkupDescription()||e.getLongtextUrl()?E.Navigation:E.Inactive};A.prototype._clearSegmentedButton=function(){if(this._oSegmentedButton){this._oSegmentedButton.destroyAggregation("buttons",true)}return this};A.prototype._fillSegmentedButton=function(){var e=this;var t=function(t){return function(){e._fnFilterList(t)}};x.forEach(function(e){var s=this._oLists[e],i=e=="all"?"MESSAGEPOPOVER_ALL":"MESSAGEVIEW_BUTTON_TOOLTIP_"+e.toUpperCase(),a=s.getItems().filter(function(e){return e instanceof h}).length,n;if(a>0){n=new r(this.getId()+"-"+e,{text:e=="all"?this._oResourceBundle.getText(i):a,tooltip:e==="all"?"":this._oResourceBundle.getText(i),icon:V[e],press:t(e)}).addStyleClass(k+"Btn"+e.charAt(0).toUpperCase()+e.slice(1));this._oSegmentedButton.addButton(n,true)}},this);var s=this._oSegmentedButton.getButtons().length>2;this._oSegmentedButton.setVisible(s);if(!s){this._oSegmentedButton.setSelectedButton(this._oSegmentedButton.getButtons()[0]);this._fnFilterList("all")}var i=s||this._bHasHeaderButton;if(this._bShowCustomHeader&&!i){this._listPage.setShowHeader(this._bShowCustomHeader);this._listPage.setShowSubHeader(false)}else{this._listPage.setShowHeader(i);this._listPage?.setShowSubHeader(true)}return this};A.prototype._setIcon=function(e,t){this._previousIconTypeClass=k+"DescIcon"+e.getType();this._oMessageIcon=new o({src:t.getIcon()}).addStyleClass(k+"DescIcon").addStyleClass(this._previousIconTypeClass);this._detailsPage.addContent(this._oMessageIcon)};A.prototype._setTitle=function(e,t){var s=e.getActiveTitle(),i,a=this,n=P.escapeSettingsValue(e.getTitle()),o=this.getId()+"MessageTitleText";if(s){i=new v(o,{text:n,ariaDescribedBy:t.getId()+"-link",press:function(){a.fireActiveTitlePress({item:e})}})}else{i=new _(o,{text:n})}i.addStyleClass("sapMMsgViewTitleText");this._detailsPage.addAggregation("content",i)};A.prototype._setSubtitle=function(e){var t=e.getSubtitle(),s=this.getId()+"MessageSubtitleText";this._oMessageSubtitleText=new _(s,{text:t}).addStyleClass("sapMMsgViewSubtitleText");this._detailsPage.addContent(this._oMessageSubtitleText)};A.prototype._setDescription=function(e){var t=e.getLink();var s=e.getDescription();if(e.getMarkupDescription()){var i=this._getTagPolicy();s=html.sanitizeWithPolicy(s,i)}this._oLastSelectedItem=e;if(e.getMarkupDescription()){this._oMessageDescriptionText=new n(this.getId()+"MarkupDescription",{content:"<div class='sapMMsgViewDescriptionText'>"+P.escapeSettingsValue(s)+"</div>"})}else{this._oMessageDescriptionText=new _(this.getId()+"MessageDescriptionText",{text:P.escapeSettingsValue(s)}).addStyleClass("sapMMsgViewDescriptionText")}this._detailsPage.addContent(this._oMessageDescriptionText);if(t){var a=this._createLinkCopy(t);this._detailsPage.addContent(a);a.addStyleClass("sapMMsgViewDescriptionLink")}};A.prototype._createLinkCopy=function(e){var t,s=e.clone("","",{cloneChildren:false,cloneBindings:false}),a=e.getCustomData()||[];t=Object.keys(e.getMetadata().getProperties());t.forEach(function(t){s.setProperty(t,e.getProperty(t))});s.destroyCustomData();a.forEach(function(e){var t=new i({key:e.getKey(),value:e.getValue()});s.addCustomData(t)});return s};A.prototype._iNextValidationTaskId=0;A.prototype._validateURL=function(e){if(D.validate(e)){return e}b.warning("You have entered invalid URL");return""};A.prototype._queueValidation=function(e){var t=this.getAsyncURLHandler();var s=++this._iNextValidationTaskId;var i={};var a=new Promise(function(a,n){i.resolve=a;i.reject=n;var o={url:e,id:s,promise:i};setTimeout(()=>{t(o)},0)});a.id=s;return a};A.prototype._getTagPolicy=function(){var e=this,t;var s=html.makeTagPolicy(this._validateURL());return function i(a,n){var o,r=false;if(a.toUpperCase()==="A"){for(t=0;t<n.length;){if(n[t]==="href"){r=true;o=n[t+1];n.splice(0,2);continue}t+=2}}n=s(a,n);if(r&&typeof e.getAsyncURLHandler()==="function"){n=n||[];var l="sapMMsgViewItemDisabledLink sapMMsgViewItemPendingLink sapMLnk";var u=n.indexOf("class");if(u>-1){n[u+1]+=l}else{n.unshift(l);n.unshift("class")}var g=n.indexOf("id");if(g>-1){n.splice(g+1,1);n.splice(g,1)}var p=e._queueValidation(o);n.push("href");n.push(o);n.push("target");n.push("_blank");n.push("id");n.push("sap-ui-"+e.getId()+"-link-under-validation-"+p.id);p.then(function(t){var s=jQuery(document.getElementById("sap-ui-"+e.getId()+"-link-under-validation-"+t.id));if(t.allowed){b.info("Allow link "+o)}else{b.info("Disallow link "+o)}s.removeClass("sapMMsgViewItemPendingLink");s.toggleClass("sapMMsgViewItemDisabledLink",!t.allowed);e.fireUrlValidated()}).catch(function(){b.warning("Async URL validation could not be performed.")})}return n}};A.prototype._fnHandleForwardNavigation=function(e,t){var s=e._oMessageItem,i=this.getAsyncDescriptionHandler();this._previousIconTypeClass=this._previousIconTypeClass||"";this.fireItemSelect({item:s,messageTypeFilter:this._getCurrentMessageTypeFilter()});this._clearDetailsPage.call(this);if(typeof i==="function"&&s.getLongtextUrl()){s.setMarkupDescription(true);var a={};var n=new Promise(function(e,t){a.resolve=e;a.reject=t});var o=function(){this._clearDetailsPage.call(this);this._detailsPage.setBusy(false);this._navigateToDetails.call(this,s,e,t,true)}.bind(this);n.then(o).catch(function(){b.warning("Async description loading could not be performed.");o()});this._navContainer.to(this._detailsPage);this._detailsPage.setBusy(true);i({promise:a,item:s})}else{this._navigateToDetails.call(this,s,e,t,false)}this._listPage.$().attr("aria-hidden","true")};A.prototype._fnHandleItemPress=function(e){this._fnHandleForwardNavigation(e.getParameter("listItem"),"slide")};A.prototype._navigateToDetails=function(e,t,s,i){this._setTitle(e,t);this._setSubtitle(e);this._setDescription(e);this._setIcon(e,t);this._detailsPage.invalidate();this.fireLongtextLoaded();const a=this._detailsPage.getContent()[0];if(a&&!a.isA("sap.m.Link")){const e=a.getText()+" Additional information available via reading keys";this._oInvisibleMessage.announce(e,"Assertive")}if(!i){this._navContainer.to(this._detailsPage,s)}};A.prototype._clearDetailsPage=function(){this._detailsPage.getContent().forEach(function(e){e.destroy()},this)};A.prototype.navigateBack=function(){this._listPage.$().removeAttr("aria-hidden");this._navContainer.back()};A.prototype._fnFilterList=function(e){x.forEach(function(t){if(t!=e&&this._oLists[t].getVisible()){this._oLists[t].setVisible(false)}},this);this._sCurrentList=e;this._oLists[e].setVisible(true);this.fireListSelect({messageTypeFilter:this._getCurrentMessageTypeFilter()})};A.prototype._getCurrentMessageTypeFilter=function(){return this._sCurrentList=="all"?"":this._sCurrentList};A.prototype._isListPage=function(){return this._navContainer.getCurrentPage()==this._listPage};return A});
//# sourceMappingURL=MessageView.js.map