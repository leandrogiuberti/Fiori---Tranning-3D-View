/*!
 * OpenUI5
 * (c) Copyright 2025 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["sap/ui/core/library","sap/ui/core/Control","sap/m/MenuWrapperRenderer","sap/ui/dom/containsOrEquals","sap/ui/events/KeyCodes","sap/ui/Device","sap/ui/core/Lib","sap/base/i18n/Localization","sap/ui/events/PseudoEvents"],function(e,t,s,o,n,i,r,u,l){"use strict";const a=e.ItemSelectionMode;const p=300;const c=t.extend("sap.m.MenuWrapper",{metadata:{library:"sap.m",properties:{title:{type:"string",defaultValue:""},isSubmenu:{type:"boolean",defaultValue:false}},aggregations:{items:{type:"sap.m.IMenuItem",multiple:true,singularName:"item",bindable:"bindable"}},events:{itemSelected:{enableEventBubbling:true,parameters:{item:{type:"sap.m.IMenuItem"}}},closePopover:{enableEventBubbling:true,parameters:{bubbleToRoot:{type:"boolean"},origin:{type:"sap.m.IMenuItem"}}},closeItemSubmenu:{enableEventBubbling:true,parameters:{item:{type:"sap.m.IMenuItem"}}}},renderer:s}});c.prototype.init=function(){this._aStyleClasses=[];this._oRb=r.getResourceBundleFor("sap.m")};c.prototype.onBeforeRendering=function(){const e=this.getItems().filter(function(e){return e.isA("sap.m.MenuItemGroup")});e.forEach(function(e){const t=e.getItems();t.forEach(function(t){t.setAssociation("_group",e);t._itemSelectionMode=e.getItemSelectionMode()});if(e.getItemSelectionMode()===a.SingleSelect){e._ensureSingleSelection()}})};c.prototype.onAfterRendering=function(){if(document.body.classList.contains("sapUiSizeCompact")||this.hasStyleClass("sapUiSizeCompact")||this.getDomRef()?.closest(".sapUiSizeCompact")){this.addStyleClass("sapUiSizeCompact")}};c.prototype.onmouseover=function(e){const t=this.getItemByDomRef(e.target);if(!t){return}if(t!==this.oHoveredItem){this._setHoveredItem(t)}this._handleSubmenusAppearance(t,false)};c.prototype.onclick=function(e){const t=this.getItemByDomRef(e.target);if(!t){return}if(e.target.closest(`#${CSS.escape(t.getId())}-endContent`)){this.fireClosePopover({bubbleToRoot:true});return}this._bPreventPopoverClose=this._isShiftKeyPressed(e);this._selectItem(t,true);e.preventDefault();e.stopPropagation()};c.prototype.onsapselect=function(e){this._sapSelectOnKeyDown=true;e.preventDefault();e.stopPropagation()};c.prototype.onsapselectmodifiers=function(e){this._sapSelectOnKeyDown=true;this._bPreventPopoverClose=this._isShiftKeyPressed(e);e.preventDefault();e.stopPropagation()};c.prototype.onkeydown=function(e){const t=this.oHoveredItem?this._getVisibleItems().indexOf(this.oHoveredItem):-1,s=u.getRTL(),o=s?n.ARROW_RIGHT:n.ARROW_LEFT,i=s?n.ARROW_LEFT:n.ARROW_RIGHT;let r=true;if(t===-1){return}if(e.keyCode===n.ARROW_DOWN){this._setHoveredItem(this._getNextFocusableItem(t,1),true)}else if(e.keyCode===n.ARROW_UP){this._setHoveredItem(this._getPrevFocusableItem(t,1),true)}else if(e.keyCode===o){const t=this.oHoveredItem?this.oHoveredItem.getEndContent():[];if(t.length){this._handleEndContentNavigation(e,t)}else if(this.getIsSubmenu()){this.fireClosePopover()}}else if(e.keyCode===i){const t=this.oHoveredItem?this.oHoveredItem.getEndContent():[];if(this.oHoveredItem&&this.oHoveredItem._hasSubmenu()){this._handleSubmenusAppearance(this.oHoveredItem,true)}else if(t.length){this._handleEndContentNavigation(e,t)}}else if(e.keyCode===n.ESCAPE){this.fireClosePopover()}else if(e.keyCode===n.HOME){this._setHoveredItem(this._getNextFocusableItem(-1,1),true)}else if(e.keyCode===n.END){this._setHoveredItem(this._getPrevFocusableItem(this._getItems().length,1),true)}else if(e.keyCode===n.PAGE_UP){this._setHoveredItem(this._getPrevFocusableItem(t,this._getPageSize()),true)}else if(e.keyCode===n.PAGE_DOWN){this._setHoveredItem(this._getNextFocusableItem(t,this._getPageSize()),true)}else if(e.keyCode===n.TAB){if(this.getIsSubmenu()){e.preventDefault()}this.fireClosePopover()}else if(e.keyCode===n.F6&&this.oFocusedEndContentItem){this.oHoveredItem.focus();this.oFocusedEndContentItem=null}else{r=false}if(r&&!e.metaKey&&!e.altKey){e.preventDefault();e.stopPropagation()}};c.prototype.onkeyup=function(e){if(!this._sapSelectOnKeyDown&&!this._bPreventPopoverClose){return}else{this._sapSelectOnKeyDown=false}if(!l.events.sapselect.fnCheck(e)&&e.keyCode!==n.ENTER&&!this._bPreventPopoverClose){return}this._selectItem(this.oHoveredItem,false,true);e.preventDefault();e.stopPropagation()};c.prototype.onsapbackspacemodifiers=c.prototype.onsapbackspace;c.prototype.onfocusin=function(e){const t=this.getItemByDomRef(e.target);if(t){this.oHoveredItem=t}};c.prototype.getItemByDomRef=function(e){const t=this._getItems();for(let s=0;s<t.length;s++){const n=t[s],i=n.getDomRef();if(o(i,e)){return n}}return null};c.prototype._isShiftKeyPressed=function(e){return e.shiftKey&&!e.metaKey&&!e.altKey&&!e.ctrlKey};c.prototype._processStyleClasses=function(e,t){if(t==="setStyleClass"){this._aStyleClasses=[];t="addStyleClass"}if(e===""){return}const s=e.split(/\s+/).filter(Boolean);const o=this._aStyleClasses.join(" ");s.forEach(e=>{const s=this._aStyleClasses.indexOf(e);const o=(t==="addStyleClass"||t==="toggleStyleClass")&&s===-1;const n=(t==="removeStyleClass"||t==="toggleStyleClass")&&s!==-1;if(o){this._aStyleClasses.push(e)}else if(n){this._aStyleClasses.splice(s,1)}});if(this.oOpenedSubmenuParent){const e=this._aStyleClasses.join(" ");const t=this.oOpenedSubmenuParent._getPopover();this.oOpenedSubmenuParent._getMenuWrapper()._processStyleClasses(o,"removeStyleClass");this.oOpenedSubmenuParent._getMenuWrapper()._processStyleClasses(this._aStyleClasses.join(" "),"addStyleClass");if(t){t.removeStyleClass(o);t.addStyleClass(e)}}};c.prototype._selectItem=function(e,t,s){if(this.oFocusedEndContentItem){this.fireClosePopover({bubbleToRoot:true});return}if(!e||!e.getEnabled()){return}if(e._hasSubmenu()){this._handleSubmenusAppearance(e,!t)}else if(e.isInteractive&&e.isInteractive()){if(e._getItemSelectionMode&&e._getItemSelectionMode()!==a.None){e.setSelected(!e.getSelected())}else{this._bPreventPopoverClose=false}this.fireItemSelected({item:e});e.firePress({item:e});if(!this._bPreventPopoverClose){this.fireClosePopover({bubbleToRoot:true,origin:e})}this._bPreventPopoverClose=false}};c.prototype._handleEndContentNavigation=function(e,t){const s=this.oFocusedEndContentItem?t.indexOf(this.oFocusedEndContentItem):-1,o=u.getRTL(),i=o?n.ARROW_LEFT:n.ARROW_RIGHT;let r;if(e.keyCode===i){r=s+1>=t.length?t.length-1:s+1}else{r=s-1<0?0:s-1}const l=t[r];if(!l){this.oFocusedEndContentItem=null;return}if(l&&l!==this.oFocusedEndContentItem&&l.isFocusable()){this.oFocusedEndContentItem=l;l.focus()}};c.prototype._handleSubmenusAppearance=function(e,t,s){if(this.oOpenedSubmenuParent&&this.oOpenedSubmenuParent._hasSubmenu()&&!this.oOpenedSubmenuParent._getPopover().isOpen()){this.oOpenedSubmenuParent.removeStyleClass("sapMMenuItemSubMenuOpen");this.oOpenedSubmenuParent=null}if(!t&&!i.system.phone&&e===this.oOpenedSubmenuParent){return}const o=e._hasSubmenu();this._closeOpenedSubmenu();this._discardOpenSubmenuDelayed();if(!o||!e.getEnabled()){return}if(s){this._openSubmenuDelayed(e,t)}else{this._openSubmenu(e,t)}};c.prototype._getItems=function(){const e=[];const t=s=>{s.forEach(s=>{if(!this._isMenuItemGroup(s)){e.push(s)}else{t(s.getItems())}})};t(this.getItems());return e};c.prototype._getVisibleItems=function(){return this._getItems().filter(e=>e.getVisible())};c.prototype._getPrevFocusableItem=function(e,t){const s=this._getVisibleItems();let o=e,n=e;if(!s.length){return undefined}while(n>0&&t>0){n--;if(s[n].isFocusable&&s[n].isFocusable()){t--;o=n}}return o!==e?s[o]:undefined};c.prototype._getNextFocusableItem=function(e,t){const s=this._getVisibleItems();let o=e,n=e;if(!s.length){return undefined}while(n<s.length-1&&t>0){n++;if(s[n].isFocusable&&s[n].isFocusable()){t--;o=n}}return o!==e?s[o]:undefined};c.prototype._setHoveredItem=function(e,t){if(!e||e===this.oHoveredItem){return}if(e){t&&this._closeOpenedSubmenu();this.oHoveredItem=e;e.focus();this.oFocusedEndContentItem=null}};c.prototype._isMenuItemGroup=function(e){return!!e.getItemSelectionMode};c.prototype._getPageSize=function(){return 5};c.prototype._closeOpenedSubmenu=function(e){if(this.oOpenedSubmenuParent){const t=this.oOpenedSubmenuParent._getPopover(),s=this.getItems().includes(this.oOpenedSubmenuParent)?this.oOpenedSubmenuParent._getMenuWrapper():null;if(t&&t._oControl){t._oControl._oPreviousFocus=undefined}this.oOpenedSubmenuParent=null;if(!s){return}if(e){setTimeout(()=>{s.fireClosePopover()},p)}else{s.fireClosePopover()}}};c.prototype._openSubmenu=function(e,t){if(!e){return}const s=e._getPopover();e._getMenuWrapper()._processStyleClasses(this._aStyleClasses.join(" "),"setStyleClass");s.setInitialFocus(t?null:e);e._openSubmenu();e._setExtraContent(this.getDomRef());this.oOpenedSubmenuParent=e;e.oParentWrapper=this};c.prototype._openSubmenuDelayed=function(e,t){this._delayedSubmenuTimer=setTimeout(()=>this._openSubmenu(e,t),p)};c.prototype._discardOpenSubmenuDelayed=function(){if(this._delayedSubmenuTimer){clearTimeout(this._delayedSubmenuTimer);this._delayedSubmenuTimer=null}};c.prototype._getItemsWithIconCount=function(){return this._getVisibleItems().filter(e=>e.getIcon&&e.getIcon()).length};c.prototype._getAccessibilityEnabled=function(){};c.prototype._prepareItemsAccessibilityInfo=function(){const e=this._getVisibleItems(),t=e.filter(e=>e.isCountable&&e.isCountable()).length;let s=1;e.forEach(e=>{const o={bAccessible:true};if(e.isCountable&&e.isCountable()){o["posinset"]=s;o["setsize"]=t;s++}e._oAccInfo=o})};return c});
//# sourceMappingURL=MenuWrapper.js.map