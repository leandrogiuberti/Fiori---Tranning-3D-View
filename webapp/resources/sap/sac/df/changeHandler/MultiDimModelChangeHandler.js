/*
 * SAPUI5
    (c) Copyright 2009-2021 SAP SE. All rights reserved
  
 */
sap.ui.define("sap/sac/df/changeHandler/MultiDimModelChangeHandler",["sap/ui/mdc/Control","sap/ui/fl/write/api/ControlPersonalizationWriteAPI","sap/ui/core/CustomData","sap/ui/core/Component"],function(e,t,i,n){"use strict";var o=e.extend("sap.sac.df.changeHandler.MultiDimModelChangeHandler",{metadata:{publicMethods:["registerMultiDimModel"]},renderer:"sap.ui.core.Renderer",init:function(){e.prototype.init.apply(this,arguments);this.skipApplyModelChange=false;var t=new i({key:"sap-ui-custom-settings",value:{"sap.ui.fl":{flexibility:"sap/sac/df/changeHandler/flexibility/MultiDimModelChangeHandler.flexibility"}}});this.addCustomData(t)},_getMultiDimModel:function(){if(this._MultiDimModel){var e=this._MultiDimModel}else{e=n.getOwnerComponentFor(this)&&n.getOwnerComponentFor(this).getModel("om")}if(!e){throw new Error("No MultiDimModel found.")}return e},_initialise:function(){this._createModelChangeInProcess=false;this._getMultiDimModel().attachEvent("dataProviderUpdated",null,this._createModelChange.bind(this))},_createModelChange:function(){var e=this;var i={selectorElement:this,changeSpecificData:{changeType:"MultiDimModelChange",content:this._getMultiDimModel().serialize("INA_REPOSITORY_DELTA"),transient:false}};this._createModelChangeInProcess=true;return Promise.resolve(t.add({selector:e,changes:[i]})).then(function(){e._createModelChangeInProcess=false})}});o.prototype.registerMultiDimModel=function(e){this._MultiDimModel=e;this._initialise()};o.prototype.applyModelChange=function(e){if(!this.skipApplyModelChange&&!this._createModelChangeInProcess){return Promise.resolve(this._getMultiDimModel().deserialize(e.getContent(),"INA_REPOSITORY_DELTA"))}this.skipApplyModelChange=false;return Promise.resolve()};o.prototype.revertModelChange=function(){if(!this.skipApplyModelChange&&!this._createModelChangeInProcess){return Promise.resolve(this._getMultiDimModel().resetModel())}return Promise.resolve()};o.prototype.skipApplyModelChangeOnce=function(){this.skipApplyModelChange=true};return o});
//# sourceMappingURL=MultiDimModelChangeHandler.js.map