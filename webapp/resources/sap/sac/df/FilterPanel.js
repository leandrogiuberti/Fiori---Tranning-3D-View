/* SAPUI5
    (c) Copyright 2009-2021 SAP SE. All rights reserved
   */
sap.ui.define("sap/sac/df/FilterPanel",["sap/ui/mdc/p13n/panels/FilterPanel","sap/ui/core/Lib","sap/ui/core/Element","sap/sac/df/FilterField","sap/sac/df/thirdparty/lodash"],function(e,t,i,a,n){const r=e.extend("sap.sac.df.FilterPanel",{metadata:{library:"sap.sac.df",properties:{metaPath:{type:"string"},enableReorder:{type:"boolean",defaultValue:false}}},renderer:{apiVersion:2,render:function(e,t){e.openStart("div",t);e.style("height","100%");e.style("width","100%");e.openEnd();e.renderControl(t.getAggregation("_content"));e.close("div")}},init:function(){if(e.prototype.init){e.prototype.init.apply(this,arguments)}this.setEnableReorder(false);this.attachChange(null,this.onChange,this)},onAfterRendering:function(){if(this.getP13nData().length===0){this._setPaths();if(!n.isEmpty(this._getMetaObject())){this._setupFilterPanel()}else{this._getMultiDimModel().attachEventOnce("dataProviderAdded",null,this._setupFilterPanel.bind(this))}}},_updateP13nData:function(e){const t=e.getParameter("dataProviderName");const i=this._getDataProvider();if(t===i.Name){let e=n.clone(this.getP13nData());n.map(e,e=>{const t=this._getMetaObject()[e.name];if(e.active!==Boolean(t.MemberFilter&&t.MemberFilter.length>0)){e.active=Boolean(t.MemberFilter&&t.MemberFilter.length>0)}});this._setP13nData(e)}},_setupFilterPanel:function(){this.setItemFactory(function(e){return this.createFilterField(e.name)});this._getMultiDimModel().attachEvent("dataLoaded",null,this._updateP13nData.bind(this));this._setP13nData()},_setP13nData:function(){const e=[];n.map(this._getMetaObject(),function(t){e.push({active:Boolean(t.MemberFilter&&t.MemberFilter.length>0),label:t.Description,name:t.Name})}.bind(this));this.setP13nData(e)},_setPaths:function(){this._metaObjectPath=this.getMetaPath().split(">")[1]},_getMetaObjectType:function(){if(this.getMetaPath().includes("/VariableGroups")){return"sap.sac.df.model.VariableGroup"}else if(this.getMetaPath().includes("/Variables")){return"sap.sac.df.model.Variable"}else if(this.getMetaPath().includes("/Dimensions")){return"sap.sac.df.model.Dimension"}},_isVariableGroup:function(){return this._getMetaObjectType()==="sap.sac.df.model.VariableGroup"},_getMetaObjectPath:function(){return this._metaObjectPath},_getMultiDimModel:function(){return this.getModel(this._getMultiDimModelName())},_getDataProvider:function(){if(this.getMetaPath().includes("/DataProviders")){const e=this.getMetaPath().split(">")[1].split("/DataProviders/")[1].split("/")[0];return this._getMultiDimModel().getDataProvider(e)}},_getMultiDimModelName:function(){return this.getMetaPath().split(">")[0]},_getMetaObject:function(){return this._getMultiDimModel().getProperty(this._metaObjectPath)},createFilterField:function(e){let t=i.getElementById(this.getFilterFieldId(e));if(!t){t=new a(this.getFilterFieldId(e),{width:"100%",metaPath:this.getMetaPath()+"/"+e,propertyKey:e,delegate:{name:"sap/sac/df/filter/delegate/FieldBaseDelegate"}})}return t},getFilterFieldId:function(e){return this.getId()+"::FilterField::"+e.replace(/[^0-9A-Z_.:-]/gi,"")},onChange:function(e){if(e.getParameter("reason")==="Remove"){let t=i.getElementById(this.getFilterFieldId(e.getParameter("item").name));if(t&&t._getMetaObject().getMemberFilter().length>0){t._getMetaObject().clearMemberFilter()}return t.destroy()}}});return r});
//# sourceMappingURL=FilterPanel.js.map