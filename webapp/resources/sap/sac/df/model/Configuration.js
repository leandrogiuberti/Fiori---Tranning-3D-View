/*
 * SAPUI5
    (c) Copyright 2009-2021 SAP SE. All rights reserved
  
 */
sap.ui.define("sap/sac/df/model/Configuration",["sap/ui/base/Object","sap/sac/df/model/internal/ConfigurationMapping","sap/sac/df/utils/ConfigLoader","sap/sac/df/firefly/library","sap/sac/df/utils/MetaPathHelper","sap/sac/df/types/configuration/ContextMenuVariant","sap/sac/df/types/configuration/DimensionGrouping","sap/sac/df/types/configuration/StylingPanelItem","sap/sac/df/types/configuration/TableTemplate","sap/sac/df/thirdparty/lodash"],function(t,e,i,o,a,r,n,l,u,g){"use strict";const s=t.extend("sap.sac.df.model.Configuration",{metadata:{properties:{Calculations:{type:"boolean",defaultValue:true},Commenting:{type:"boolean",defaultValue:false},ContextMenuVariant:{type:"sap.sac.df.types.configuration.ContextMenuVariant",defaultValue:r.sapui5},ImplicitVariableHandling:{type:"boolean",defaultValue:false},StylingPanelItems:{type:"sap.sac.df.types.configuration.StylingPanelItem[]",defaultValue:[l.TableProperties,l.NumberFormatting]},TableTemplates:{type:"sap.sac.df.types.configuration.TableTemplate[]",defaultValue:[u.Default,u.Basic]},TableTemplateSelection:{type:"String",defaultValue:u.Default}}},constructor:function(t,e){Object.assign(this,Object.getPrototypeOf(this));this._Model=t;this._Configuration=e},applyConfiguration:function(){this.ConsolidatedConfig=o.PrFactory.createStructure();return Promise.resolve(this._applyTechnicalSAPUI5Configuration()).then(()=>this._applyProvidedConfiguration()).then(()=>this._Model.getApplication()?.getConfigManager()?.m_configurationManager?.writePlatformConfiguration(this.ConsolidatedConfig)).then(()=>this._Model.getApplication()?.getConfigManager()?.preloadConfigurations(this._Model.getApplication()))},_applyProvidedConfiguration:function(){return Promise.resolve(o.CoConfigurationUtils.getResolvedConfigurationForName(this._Model.getApplication().getProcess(),"FeatureConfiguration")).then(t=>this._applyFeatureConfiguration(t.getConfigurationStructure().convertToNative())).then(()=>this._applyContextMenuConfiguration())},_applyTechnicalSAPUI5Configuration:function(){if(this._Configuration?.FilterDialogVariant==="Fiori"){return this._setFioriFilterDialogConfig()}else{return this._setSAPUI5FilterDialogConfig()}},_setSAPUI5FilterDialogConfig:function(){const t=this._getOrCreateProgramConfig(o.FilterDialog.DEFAULT_PROGRAM_NAME_DIMENSION);t.putString(o.FilterDialog.PARAM_SELECTION_MODE,o.UiSelectionMode.MULTI_SELECT.getName());t.putString(o.FilterDialog.PARAM_DIMENSION_TEXT_USAGE_TYPE,o.FilterDialogTextUsageType.RESULTSET_TEXT);t.putBoolean(o.FilterDialog.PARAM_OFFER_READMODE_CHANGE,true);t.putBoolean(o.FilterDialog.PARAM_OFFER_HIERARCHY_CHANGE,true);t.putBoolean(o.FilterDialog.PARAM_OFFER_READMODE_EXTENDED_SETTINGS,true);const e=this._getOrCreateProgramConfig(o.FilterDialog.DEFAULT_PROGRAM_NAME_VARIABLE);e.putString(o.FilterDialog.PARAM_DIMENSION_TEXT_USAGE_TYPE,o.FilterDialogTextUsageType.RESULTSET_TEXT);e.putBoolean(o.FilterDialog.PARAM_ALWAYS_SHOW_SELECTION_CONTAINER,true)},_setFioriFilterDialogConfig:function(){const t=this._getOrCreateProgramConfig(o.FilterDialog.DEFAULT_PROGRAM_NAME_DIMENSION);t.putString(o.FilterDialog.PARAM_SELECTION_MODE,o.UiSelectionMode.MULTI_SELECT.getName());t.putString(o.FilterDialog.PARAM_DIMENSION_TEXT_USAGE_TYPE,o.FilterDialogTextUsageType.RESULTSET_TEXT);t.putBoolean(o.FilterDialog.PARAM_OFFER_READMODE_CHANGE,true);t.putBoolean(o.FilterDialog.PARAM_OFFER_READMODE_EXTENDED_SETTINGS,true);t.putBoolean(o.FilterDialog.PARAM_OFFER_LIST_VIEW,true);t.putBoolean(o.FilterDialog.PARAM_OFFER_RANGE_VIEW,true);t.putBoolean(o.FilterDialog.PARAM_SIMPLIFIED_SEARCH,true);t.putBoolean(o.FilterDialog.PARAM_OFFER_EXCLUDE_ADVANCED,true);t.putBoolean(o.FilterDialog.PARAM_OFFER_HIERARCHY_CHANGE,true);t.putBoolean(o.FilterDialog.PARAM_OFFER_DISPLAY_INFO_EXTENDED_SETTINGS,true);t.putString(o.FilterDialog.PARAM_DISPLAY_PATTERN_RANGE,"$1...$2");const e=this._getOrCreateProgramConfig(o.FilterDialog.DEFAULT_PROGRAM_NAME_VARIABLE);e.putString(o.FilterDialog.PARAM_DIMENSION_TEXT_USAGE_TYPE,o.FilterDialogTextUsageType.RESULTSET_TEXT);e.putBoolean(o.FilterDialog.PARAM_ALWAYS_SHOW_SELECTION_CONTAINER,true);e.putBoolean(o.FilterDialog.PARAM_OFFER_LIST_VIEW,true);e.putBoolean(o.FilterDialog.PARAM_OFFER_RANGE_VIEW,true);e.putBoolean(o.FilterDialog.PARAM_SIMPLIFIED_SEARCH,true);e.putBoolean(o.FilterDialog.PARAM_OFFER_EXCLUDE_ADVANCED,true);e.putBoolean(o.FilterDialog.PARAM_OFFER_DISPLAY_INFO_EXTENDED_SETTINGS,true);e.putString(o.FilterDialog.PARAM_DISPLAY_PATTERN_RANGE,"$1...$2")},_applyFeatureConfiguration:function(t){if(t){g.map(t,(t,e)=>{if(e!=="ContextMenuVariant"){this._setConfigurationProperty(e,t);this.setProperty(e,t)}})}},_getOrCreateProgramConfig:function(t){let e=this.ConsolidatedConfig.getStructureByKey(t);if(!e){e=this.ConsolidatedConfig.putNewStructure(t)}return e},_applyContextMenuConfiguration:function(){let t=this._Configuration?.ContextMenuVariant||"sap-ui5";if(t){this.setProperty("ContextMenuVariant",t);const e=t?"sap/sac/df/fa/configs/"+t+"-config.json":"sap/sac/df/fa/configs/sap-ui5-config.json";return i.loadConfigFromFile(e).then(t=>{this._ContextMenuConfiguration=JSON.stringify(t?.QueryBuilder?.MenuSettings)})}},getContextMenuConfiguration:function(){return this._ContextMenuConfiguration},_setConfigurationProperty:function(t,i){if(!Object.hasOwn(e,t)){return}const a=e[t];const r=Array.isArray(a.Program)?g.map(a.Program,t=>this._getOrCreateProgramConfig(t)):[this._getOrCreateProgramConfig(a.Program)];switch(a.Type){case o.PrElementType.BOOLEAN:r.forEach(t=>{t.putBoolean(a.FFName,i)});break;case o.PrElementType.STRING:r.forEach(t=>{t.putString(a.FFName,i)});break;case o.PrElementType.LIST:r.forEach(t=>{let e=t.putNewList(a.FFName);i.forEach(t=>{e.addString(t)})});break;case o.PrElementType.STRUCTURE:r.forEach(t=>{let e=t.putNewStructure(a.FFName);Object.keys(i).forEach(t=>{e.putString(t,i[t])})});break}}});s.prototype.setProperty=function(t,e){return this._Model.setProperty(a.PathTo.Configuration+"/"+t,e)};s.prototype.getProperty=function(t){return this._Model.getProperty(a.PathTo.Configuration+"/"+t)};return s});
//# sourceMappingURL=Configuration.js.map