/*
 * SAPUI5
    (c) Copyright 2009-2021 SAP SE. All rights reserved
  
 */
sap.ui.define("sap/sac/df/model/internal/_DFKernel",["sap/ui/base/Object","sap/base/Log","sap/sac/df/types/SystemType","sap/sac/df/firefly/library"],function(e,t,s,a){"use strict";a.XLocalStorage.setInstance(null);const n=e.extend("sap.sac.df.model._DFKernel",{});n.prototype._enableToggles=function(e){const t=e.getKernelProcess().getSession();t.deactivateFeatureToggle(a.FeatureToggleOlap.FUSION_SERVICE);a.XStream.of(a.FeatureToggle.getAllFeatureToggles()).forEach(function(e){const s=e.getXVersion();if(s>a.FeatureToggleOlap.FUSION_SERVICE.getXVersion()&&s<=a.XVersion.MAX){t.activateFeatureToggle(e)}});t.activateFeatureToggle(a.FeatureToggleOlap.METADATA_CACHING);t.deactivateFeatureToggle(a.FeatureToggleOlap.MEMBER_VALUE_EXCEPTIONS);t.activateFeatureToggleByName(a.SuExportDialog.SAC_FF_DATA_ANALYZER_PDF_DEFAULT_FONT_72);a.FeFeatureToggle.enable(a.FeFeatureToggle.SYNTAX_HIGHLIGHTING);a.FeFeatureToggle.enable(a.FeFeatureToggle.DIMENSION_PROPERTIES);a.FeFeatureToggle.enable(a.FeFeatureToggle.LIKE);a.FeFeatureToggle.enable(a.FeFeatureToggle.SUBSTRING);a.FeFeatureToggle.enable(a.FeFeatureToggle.LENGTH);a.FeFeatureToggle.enable(a.FeFeatureToggle.FINDINDEX);a.FeFeatureToggle.enable(a.FeFeatureToggle.ENDSWITH);a.FeFeatureToggle.enable(a.FeFeatureToggle.TONUMBER)};n.prototype._setEnvironment=function(e){this.initProgram.setEnvironmentVariable(a.XEnvironmentConstants.FIREFLY_LOG_SEVERITY,"Print");if(e.systemLandscape){if(e.systemLandscape.URI){let t=e.systemLandscape.URI;if(!t.startsWith("http")){t=window.location.protocol+"//";t+=window.location.hostname;t+=window.location.port?":"+window.location.port:"";t+=e.systemLandscape.URI}this.initProgram.setEnvironmentVariable("ff_system_landscape_uri",t)}else if(e.systemLandscape.Systems){this.aSystemLandscapes=[];const t=Object.keys(e.systemLandscape.Systems);t.forEach(t=>{const s=e.systemLandscape.Systems[t];this.aSystemLandscapes.push(s)})}else if(e.systemLandscape.systemType){const t={systemName:"local"+e.systemLandscape.systemType,systemType:e.systemLandscape.systemType,protocol:window.location.protocol==="http:"?"HTTP":"HTTPS",host:window.location.hostname,port:window.location.port,authentication:"NONE",systemTimeout:-1};if(t.systemType===s.DWC){t.path="/lcs/dwc"}this.aSystemLandscapes=[t]}this.masterSystemName=e.systemLandscape.masterSystem?e.systemLandscape.masterSystem:"local"+e.systemLandscape.systemType}else{throw new Error("System Configuration is invalid")}};n.prototype.init=function(e){const t=this;if(!t.initPromise){t.initPromise=a.ui.FFUi5Preloader.load().then(()=>new Promise(s=>{if(!t.kernelProgram){a.XLogger.getInstance().setLogFilterLevel(a.Severity.PRINT);t.initProgram=a.KernelBoot.createByName("DragonflyAppProgram");if(!a.XVersion.V186_DISP_HIERARCHY_FIX_IN_FILTER){throw new Error("XVersion V186_DISP_HIERARCHY_FIX_IN_FILTER is undefined.")}t.initProgram.setXVersion(a.XVersion.V186_DISP_HIERARCHY_FIX_IN_FILTER);t.initProgram.addProgramStartedListener(function(n,o){if(!t.kernelProgram){t.kernelProgram=o;if(t.aSystemLandscapes){t.addSystemLandscapes(e.systemSettings.keepAliveInterval)}t.setMasterSystem();t.getApplication().setClientInfo(null,e.systemSettings.clientIdentifier,null);t.kernelProgram.getSession().deactivateFeatureToggle(a.FeatureToggleOlap.FUSION_SERVICE);s(t.kernelProgram)}});t.initProgram.setEnvironmentVariable(a.XEnvironmentConstants.FIREFLY_USER_PROFILE_SERIALIZED,e.userProfile);if(e.systemSettings.composableServiceLocal){t.initProgram.setEnvironmentVariable("ff_mount_30","/analyticalwidgets:"+"${ff_network_root_dir}"+e.systemSettings.composableServicePath+"/analyticalwidgets")}else{t.initProgram.setEnvironmentVariable("ff_mount_30","/analyticalwidgets:fscomposable://${ff_network_host}:${ff_network_port}/"+e.systemSettings.composableServicePath+"/analyticalwidgets")}t._setEnvironment(e.systemSettings);t.initProgram.setKernelReadyConsumer(t._enableToggles);t.initProgram.runFull()}else{s(t.kernelProgram)}}))}return t.initPromise};n.prototype.destroy=function(){this.kernelProgram?.terminate();this.kernelProgram?.releaseObject();e.prototype.destroy.apply(this,arguments);this.kernelProgram=null;this.initPromise=null;this.initProgram=null},n.prototype.getSession=function(){if(!this.kernelProgram){t.error("Kernel not initialized");return null}return this.kernelProgram.getSession()};n.prototype.getApplication=function(){if(!this.kernelProgram){t.error("Kernel not initialized");return null}return this.kernelProgram.getProcess().findEntity(a.ProcessEntity.DATA_APPLICATION)};n.prototype.setMasterSystem=function(){this.getApplication().getSystemLandscape().setMasterSystemName(this.masterSystemName)};n.prototype.addSystemLandscapes=function(e){const t=this.getApplication().getSystemLandscape();const s=this.getApplication();s.setSystemLandscape(t);this.aSystemLandscapes.forEach(function(n){const o=t.createSystem();o.setName(n.systemName);o.setTimeout(n.systemTimeout);o.setAuthenticationType(a.AuthenticationType[n.authentication||"NONE"]);const r=a.SystemType[n.systemType];o.setSystemType(r);o.setProtocolType(a.ProtocolType[n.protocol]);o.setHost(n.host);o.setPort(n.port);o.setPath(n.path);if(n.language){o.setLanguage(n.language)}t.setSystemByDescription(o);if(r.isTypeOf(a.SystemType.BW)){o.setSessionCarrierType(a.SessionCarrierType.SAP_CONTEXT_ID_HEADER);s.getConnectionPool().setMaximumSharedConnections(n.systemName,10)}const i=n.keepAliveIntervalSec|e|0;o.setKeepAliveDelayMs(i*1e3);o.setKeepAliveIntervalMs(i*1e3)})};return n});
//# sourceMappingURL=_DFKernel.js.map