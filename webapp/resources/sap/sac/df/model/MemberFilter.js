/*!
* SAPUI5
    (c) Copyright 2009-2021 SAP SE. All rights reserved
  
*/
sap.ui.define("sap/sac/df/model/MemberFilter",["sap/ui/base/Object","sap/sac/df/firefly/library","sap/sac/df/types/MemberFilterOperator","sap/ui/model/Filter","sap/ui/model/FilterOperator","sap/sac/df/utils/ListHelper","sap/fe/navigation/SelectionVariant","sap/sac/df/thirdparty/lodash"],function(e,t,r,n,i,a,o,l){"use strict";function s(e,t,r){const n=e.getDimensionMember();const i=t?n.getFieldValue(e.getDimension().getHierarchyDisplayKeyField()).getString():n.getFieldValue(e.getDimension().getDisplayKeyField()).getString();const o=new u([n.getFieldValue(e.getDimension().getKeyField()).getString()],[i],[n.getText()?n.getText():i]);if(t){const n=e.getChildren();if(n&&n.hasElements()){const e=a.arrayFromList(n).map(function(e){return this.transformValueHelpNode(e,t,r)}).filter(function(e){return e!==null});if(e.length!==0){o.Children=e}}}if(r&&!o.Children){if(!o.Key.includes(r)&&!o.Text.includes(r)){return null}}return o}var u=e.extend("sap.sac.df.model.MemberFilter",{constructor:function(e,t,r,n,a){Object.assign(this,Object.getPrototypeOf(this));return{InternalKey:e&&e,Key:t&&t,Text:r&&r,Operator:n?n:i.EQ,Hierarchy:a}}});u._createFFMemberFilter=function(e){const r=t.FilterDialogValueFactory.createValueExt(e.InternalKey&&e.InternalKey[0]?e.InternalKey[0]:null,e.Key&&e.Key[0]?e.Key[0]:null,e.Text&&e.Text[0]?e.Text[0]:null,e.Hierarchy?e.Hierarchy.name:null,this.getFFOperatorFromUI5Operator(e.Operator));if(e.Operator===i.BT||e.Operator===i.NB){const n=t.FilterDialogValueFactory.createValueExt(e.InternalKey&&e.InternalKey[1]?e.InternalKey[1]:null,e.Key&&e.Key[1]?e.Key[1]:null,e.Text&&e.Text[1]?e.Text[1]:null,e.Hierarchy?e.Hierarchy.name:null,this.getFFOperatorFromUI5Operator(e.Operator));return t.FilterDialogValueFactory.createRangeValue(r,n,e.Operator===i.NB)}return r};u.transformFromFilterToMemberFilter=function(e){return new u([e.getValue1(),e.getValue2()],[e.getValue1(),e.getValue2()],[],e.getOperator())};u.transformFromMemberFilterToFilter=function(e,t){return new n(t,e.Operator,e.Key[0],e.Key[1])};u.createSelectionVariantFromFFMemberFilter=function(e,t){const r=new o;l.forEach(t,t=>{const n=this.getUI5OperatorFromFFOperator({Sign:"INCLUDING",Operator:t.ComparisonOperator});if(t.LowExternal&&t.LowExternal.length>0){l.each(t?.LowExternal,(e,i)=>{r.addSelectOption(e.Dimension,"I",n,e.Member,t.HighExternal&&t?.HighExternal[i].Member)})}else{r.addSelectOption(e,t.IsExcluding?"E":"I",n,t.Low,t.High)}});return r};u._createFromFFFilter=function(e,t){const r=e.getDimension();const n=function(e,t){if(r.isMeasureStructure()){return}let n;if(e&&r&&r.getTextField()){n=e.getFlatOrHierarchicalTextSupplement(t)}if(!n){n=i(e,t)}return n};const i=function(t,r){const n=e.getDimension();if(n.isMeasureStructure()){return}let i;if(t&&n){i=t.getFlatOrHierarchicalDisplayKeySupplement(r);if(!i){i=t.getString()}}return i};let a={};if(e.getHierarchyName()){a={name:e.getHierarchyName(),version:e.getHierarchyVersion(),dueDate:e.getHierarchyDueDate(),levelOffset:e.getLevelOffset(),depth:e.getDepth()}}const o={Sign:e.getSetSign().getName?e.getSetSign().getName():e.getSetSign(),Operator:e.getComparisonOperator().getName()};let l=[e.getLow().getString()];let s=[i(e.getLow(),t)];let c=[n(e.getLow(),t)];if(e.getHigh()&&e.getHigh().getString()){l.push(e.getHigh().getString());s.push(i(e.getHigh(),t));c.push(n(e.getHigh(),t))}const g=new u(l,s,c,this.getUI5OperatorFromFFOperator(o),a);g.UniqueID=e.getUniqueId();return g};u.createFromFFMemberFilter=function(e){const t=[];l.forEach(e,e=>{const r=new u([e.Low,e.High].filter(e=>e!=null),[e.Low,e.High].filter(e=>e!=null),[e.Text].filter(e=>e!=null),this.getUI5OperatorFromFFOperator({Sign:e.IsExcluding?"EXCLUDING":"INCLUDING",Operator:e.ComparisonOperator}),e.Hierarchy);const n=[e.LowExternal,e.HighExternal].filter(e=>e!=null);if(n.length>0){r.KeyComponents=[];l.forEach(n,e=>{const t=[];r.KeyComponents.push(t);l.forEach(e,function(e){const r={};t.push(r);r.Dimension=e.Dimension;r.Member=e.Member})})}t.push(r)});return t};u.createFromFFValueHelpNode=function(e,t,r){const n=e.getIterator();const i=[];while(n.hasNext()){const e=n.next();if(t||e.getDisplayLevel()===0){const n=s(e,t,r);if(n){i.push(n)}}}return i};u._condenseDimensionMemberFilter=function(e,r,n){var i=t.XList.create();if(e&&e.length>0){const o=[];const s=[];l.forEach(e,e=>{e.UniqueID?o.push(e.UniqueID):s.push(e)});if(r&&a.arrayFromList(r).length>0){if(o.length>0){l.forEach(a.arrayFromList(r),e=>{if(!o.includes(e.m_uniqueId)){r.removeElement(e)}});if(a.arrayFromList(r).length>0){i=t.FilterDialogValueUtils.newSelectionFromFilter(n,r)}}}l.forEach(s,e=>{i.add(this._createFFMemberFilter(e))})}return i};u.getFFOperatorFromUI5Operator=function(e){return t.ComparisonOperator[r[e][0].Operator]};u.getUI5OperatorFromFFOperator=function(e){return l.findKey(r,t=>{if(t){return t.find(t=>t.Operator===e.Operator&&t.Sign===e.Sign)}})};return u});
//# sourceMappingURL=MemberFilter.js.map