/*!
 * SAPUI5
 * (c) Copyright 2025 SAP SE. All rights reserved.
 */
sap.ui.define(["./library","sap/base/i18n/Localization","sap/m/library","sap/ui/core/Control","sap/m/FlexBox","sap/ui/core/ResizeHandler","sap/ui/events/KeyCodes","sap/suite/ui/microchart/MicroChartUtils","./BulletMicroChartRenderer","sap/ui/core/Core","sap/ui/core/Theming","./BulletMicroChartData"],function(e,t,a,i,s,r,l,o,u,n,h,p){"use strict";var f=a.Size;var c=i.extend("sap.suite.ui.microchart.BulletMicroChart",{metadata:{library:"sap.suite.ui.microchart",properties:{size:{type:"sap.m.Size",group:"Misc",defaultValue:f.Auto},mode:{type:"sap.suite.ui.microchart.BulletMicroChartModeType",group:"Misc",defaultValue:"Actual"},scale:{type:"string",group:"Misc",defaultValue:""},forecastValue:{type:"float",group:"Misc",defaultValue:null},targetValue:{type:"float",group:"Misc",defaultValue:null},minValue:{type:"float",group:"Misc",defaultValue:null},maxValue:{type:"float",group:"Misc",defaultValue:null},showActualValue:{type:"boolean",group:"Misc",defaultValue:true},showDeltaValue:{type:"boolean",group:"Misc",defaultValue:true},showActualValueInDeltaMode:{type:"boolean",group:"Misc",defaultValue:false},showTargetValue:{type:"boolean",group:"Misc",defaultValue:true},showValueMarker:{type:"boolean",group:"Misc",defaultValue:false},showThresholds:{type:"boolean",group:"Misc",defaultValue:true},actualValueLabel:{type:"string",group:"Misc",defaultValue:""},deltaValueLabel:{type:"string",group:"Misc",defaultValue:""},targetValueLabel:{type:"string",group:"Misc",defaultValue:""},width:{type:"sap.ui.core.CSSSize",group:"Misc"},height:{type:"sap.ui.core.CSSSize",group:"Misc"},scaleColor:{type:"sap.suite.ui.microchart.CommonBackgroundType",group:"Misc",defaultValue:"MediumLight"},isResponsive:{type:"boolean",group:"Appearance",defaultValue:false},hideOnNoData:{type:"boolean",group:"Appearance",defaultValue:false},smallRangeAllowed:{type:"boolean",group:"Appearance",defaultValue:false}},associations:{ariaLabelledBy:{type:"sap.ui.core.Control",multiple:true,singularName:"ariaLabelledBy"}},defaultAggregation:"actual",aggregations:{actual:{type:"sap.suite.ui.microchart.BulletMicroChartData",defaultClass:p,multiple:false,bindable:"bindable"},thresholds:{type:"sap.suite.ui.microchart.BulletMicroChartData",defaultClass:p,multiple:true,singularName:"threshold",bindable:"bindable"}},events:{press:{}}},renderer:u});c.THRESHOLD_SMALL_LABEL=3.5;c.THRESHOLD_BIG_LABEL=4.5;c.THRESHOLD_SMALL_LOOK=3.5;c.THRESHOLD_EXTRASMALL_LOOK=1.3125;c.THRESHOLD_THRESHOLDS=6;c.prototype.init=function(){this._oRb=n.getLibraryResourceBundle("sap.suite.ui.microchart");this.setAggregation("tooltip","((AltText))",true);this._bThemeApplied=false;n.ready(this._handleCoreInitialized.bind(this))};c.prototype._handleCoreInitialized=function(){h.attachApplied(this._handleThemeApplied.bind(this))};c.prototype._handleThemeApplied=function(){this._bThemeApplied=true;this.invalidate();h.detachApplied(this._handleThemeApplied.bind(this))};c.prototype._calculateChartData=function(){var t=100,a=this.getThresholds(),i=[],s=this.getTargetValue(),r=this.getForecastValue(),l=this.getActual()&&this.getActual().getValue()?this.getActual().getValue():0,o=[],u=0,n=0,h=0,p;if(this.getActual()&&this.getActual()._isValueSet){o.push(l)}if(this._isForecastValueSet){o.push(r)}if(this._isTargetValueSet){o.push(s)}if(this._isMinValueSet){o.push(this.getMinValue())}if(this._isMaxValueSet){o.push(this.getMaxValue())}for(p=0;p<a.length;p++){o.push(a[p].getValue())}if(o.length>0){u=n=o[0];for(p=0;p<o.length;p++){if(o[p]<u){u=o[p]}if(o[p]>n){n=o[p]}}if(this.getSmallRangeAllowed()==false){n=n<0&&n<3*(u-n)?0:n;u=u>0&&u>3*(n-u)?0:u}h=n-u;for(p=0;p<a.length;p++){i[p]={color:a[p].getColor(),valuePct:!a[p]._isValueSet||h===0?0:((a[p].getValue()-u)*t/h).toFixed(2)}}}var f,c;if(this.getMode()===e.BulletMicroChartModeType.Delta){f=!this.getActual()||!this.getActual()._isValueSet||h===0?50:(.05+(l-u)*t/h).toFixed(2);c=!this._isTargetValueSet||h===0?50:((s-u)*t/h).toFixed(2)}else{f=!this.getActual()||!this.getActual()._isValueSet||h===0||u===0&&this.getActual().getValue()===0?0:(.05+(l-u)*t/h).toFixed(2);c=!this._isTargetValueSet||h===0?0:((s-u)*t/h).toFixed(2)}return{actualValuePct:f,targetValuePct:c,forecastValuePct:!this._isForecastValueSet||h===0?0:((r-u)*t/h).toFixed(2),thresholdsPct:i,fScaleWidthPct:t}};c.prototype._calculateDeltaValue=function(){if(!this.getActual()._isValueSet||!this._isTargetValueSet){return 0}else{var e=this.getActual().getValue();var t=this.getTargetValue();return Math.abs(e-t).toFixed(Math.max(this._digitsAfterDecimalPoint(e),this._digitsAfterDecimalPoint(t)))}};c.prototype.setMinValue=function(e){this._isMinValueSet=this._fnIsNumber(e);return this.setProperty("minValue",this._isMinValueSet?e:NaN)};c.prototype.setMaxValue=function(e){this._isMaxValueSet=this._fnIsNumber(e);return this.setProperty("maxValue",this._isMaxValueSet?e:NaN)};c.prototype.setTargetValue=function(e){this._isTargetValueSet=this._fnIsNumber(e);return this.setProperty("targetValue",this._isTargetValueSet?e:NaN)};c.prototype.setForecastValue=function(e){this._isForecastValueSet=this._fnIsNumber(e);return this.setProperty("forecastValue",this._isForecastValueSet?e:NaN)};c.prototype.setSize=function(e){if(this.getSize()!==e){this.setProperty("size",e,false)}return this};c.prototype.ontap=function(e){this.firePress()};c.prototype.onkeydown=function(e){if(e.which===l.SPACE){e.preventDefault()}};c.prototype.onkeyup=function(e){if(e.which===l.ENTER||e.which===l.SPACE){this.firePress();e.preventDefault()}};c.prototype._fnIsNumber=function(e){return typeof e==="number"&&!isNaN(e)&&isFinite(e)};c.prototype.attachEvent=function(e,t,a,s){i.prototype.attachEvent.call(this,e,t,a,s);if(this.hasListeners("press")){this.$().attr("tabindex",0).addClass("sapSuiteUiMicroChartPointer")}return this};c.prototype.detachEvent=function(e,t,a){i.prototype.detachEvent.call(this,e,t,a);if(!this.hasListeners("press")){this.$().removeAttr("tabindex").removeClass("sapSuiteUiMicroChartPointer")}return this};c.prototype.onBeforeRendering=function(){if(this._sChartResizeHandlerId){r.deregister(this._sChartResizeHandlerId)}this._unbindMouseEnterLeaveHandler()};c.prototype.onAfterRendering=function(){e._checkControlIsVisible(this,this._onControlIsVisible);this._bindMouseEnterLeaveHandler()};c.prototype._onControlIsVisible=function(){this._onResize();this._sChartResizeHandlerId=r.register(this,this._onResize.bind(this))};c.prototype._onResize=function(){var e=this.$(),t=Math.round(parseFloat(this.$().css("height"))),a=parseInt(e.css("width"));if(this.getShowValueMarker()){this._adjustValueToMarker()}e.removeClass("sapSuiteBMCSmallFont sapSuiteBMCNoLabels sapSuiteBMCSmallLook sapSuiteBMCExtraSmallLook sapSuiteBMCThresholdHidden");if(t<=this.convertRemToPixels(c.THRESHOLD_EXTRASMALL_LOOK)){e.addClass("sapSuiteBMCExtraSmallLook")}else if(t<=this.convertRemToPixels(c.THRESHOLD_SMALL_LOOK)){e.addClass("sapSuiteBMCSmallLook")}if(t>=this.convertRemToPixels(c.THRESHOLD_SMALL_LABEL)&&t<=this.convertRemToPixels(c.THRESHOLD_BIG_LABEL)){e.addClass("sapSuiteBMCSmallFont")}if(t<this.convertRemToPixels(c.THRESHOLD_SMALL_LABEL)||this._isAnyChartLabelTruncated()){e.addClass("sapSuiteBMCNoLabels")}if(a<this.convertRemToPixels(c.THRESHOLD_THRESHOLDS)){e.addClass("sapSuiteBMCThresholdHidden")}this._adjustLabelsPos()};c.prototype._isAnyChartLabelTruncated=function(){var e=this.$().find(".sapSuiteBMCItemValue, .sapSuiteBMCTargetValue");return this._isAnyLabelTruncated(e)};c.prototype.exit=function(){r.deregister(this._sChartResizeHandlerId)};c.prototype._adjustLabelsPos=function(){var a=t.getRTL();var i=this.$("bc-target-bar-value");var s=this.$("chart-bar");var r=s.width();if(r){var l=0;if(i&&i.offset()){l=i.offset().left-s.offset().left;if(a){l=r-l}this._adjustLabelPos(this.$("bc-target-value"),r,l,a)}var o=this.$("bc-bar-value");if(o&&o.offset()){var u=o.offset().left+o.width()-s.offset().left;if(a){u=o.offset().left-s.offset().left}if(this.getMode()===e.BulletMicroChartModeType.Delta){u=o.width();if(!this.getShowActualValueInDeltaMode()){u=u/2}var n=this.getTargetValue()<this.getActual().getValue()?1:-1;if(a){u=i.offset().left-s.offset().left-u*n}else{u=i.offset().left-s.offset().left+u*n}}this._adjustLabelPos(this.$("bc-item-value"),r,u,a)}}};c.prototype._adjustLabelPos=function(e,t,a,i){var s="left";var r=e.width();if(r>t){e.css(s,"0")}else{var l=a-.5*r;if(l<0){l=0}if(l+r>t){l=t-r}e.css(s,l)}};c.prototype._adjustValueToMarker=function(){var e=this.$("bc-bar-value");var a=this.$("bc-bar-value-marker");var i=this.$().find(".sapSuiteBMCVerticalAlignmentContainer");if(e.offset()&&a.offset()){var s=e.width();var r=e.offset().left;var l=a.width();var o=a.offset().left;if(t.getRTL()){if(o<r){a.css("right","");a.offset({left:r})}if(o+l>r+s){a.css("right","");a.offset({left:r+s-l})}}else{if(o<r){a.offset({left:r})}if(o+l>r+s){e.width((o+l-r)/i.width()*100+"%")}}}};c.prototype._getLocalizedColorMeaning=function(e){return this._oRb.getText(("SEMANTIC_COLOR_"+e).toUpperCase())};c.prototype._getAltHeaderText=function(t){var a=this._oRb.getText("BULLETMICROCHART");if(t){a+=" "+this._oRb.getText("IS_ACTIVE")}if(!this._hasData()){a+="\n"+this._oRb.getText("NO_DATA");return a}var i=this.getActual()&&this.getActual()._isValueSet;var s=this.getScale();var r=this.getTargetValueLabel();var l=!this.getActual()||!this.getActual().getColor()?"":this._getLocalizedColorMeaning(this.getActual().getColor());if(i){var o=this.getActualValueLabel();var u=o?o:""+this.getActual().getValue();a+="\n"+this._oRb.getText("BULLETMICROCHART_ACTUAL_TOOLTIP",[u+s,l])}if(this.getMode()===e.BulletMicroChartModeType.Delta){if(this._isTargetValueSet&&i){var n=this.getDeltaValueLabel();var h=n?n:""+this._calculateDeltaValue();a+="\n"+this._oRb.getText("BULLETMICROCHART_DELTA_TOOLTIP",[h+s,l])}}else if(this._isForecastValueSet){a+=this._isForecastValueSet?"\n"+this._oRb.getText("BULLETMICROCHART_FORECAST_TOOLTIP",[this.getForecastValue()+s,l]):""}if(this._isTargetValueSet){var p=r?r:""+this.getTargetValue();a+="\n"+this._oRb.getText("BULLETMICROCHART_TARGET_TOOLTIP",[p+s])}return a};c.prototype._getAltSubText=function(e){var t="";var a=this.getThresholds().sort(function(e,t){return e.getValue()-t.getValue()});for(var i=0;i<a.length;i++){var s=a[i],r=s.getTooltip_AsString(),l="";if(!r){continue}l+=(e?"":"\n")+this._oRb.getText("BULLETMICROCHART_THRESHOLD_TOOLTIP",[s.getValue()+this.getScale(),this._getLocalizedColorMeaning(s.getColor())]);l=r.split("((AltText))").join(l);if(l){t+=l;e=false}}return t};c.prototype.clone=function(e,t,a){var s=i.prototype.clone.apply(this,arguments);s._isMinValueSet=this._isMinValueSet;s._isMaxValueSet=this._isMaxValueSet;s._isForecastValueSet=this._isForecastValueSet;s._isTargetValueSet=this._isTargetValueSet;return s};c.prototype._addTitleAttribute=function(){if(!this.$().attr("title")&&this._hasData()){this.$().attr("title",this.getTooltip_AsString())}};c.prototype._removeTitleAttribute=function(){if(this.$().attr("title")){this.$().removeAttr("title")}};c.prototype._bindMouseEnterLeaveHandler=function(){if(!this._oMouseEnterLeaveHandler){this._oMouseEnterLeaveHandler={mouseEnterChart:this._addTitleAttribute.bind(this),mouseLeaveChart:this._removeTitleAttribute.bind(this)}}this.$().on("mouseenter",this._oMouseEnterLeaveHandler.mouseEnterChart);this.$().on("mouseleave",this._oMouseEnterLeaveHandler.mouseLeaveChart)};c.prototype._unbindMouseEnterLeaveHandler=function(){if(this._oMouseEnterLeaveHandler){this.$().off("mouseenter",this._oMouseEnterLeaveHandler.mouseEnterChart);this.$().off("mouseleave",this._oMouseEnterLeaveHandler.mouseLeaveChart)}};c.prototype._hasData=function(){return this.getActual()};c.prototype.firePress=function(){if(this._hasData()){i.prototype.fireEvent.call(this,"press",arguments)}};o.extendMicroChart(c);return c});
//# sourceMappingURL=BulletMicroChart.js.map