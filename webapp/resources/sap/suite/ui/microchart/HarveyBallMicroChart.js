/*!
 * SAPUI5
 * (c) Copyright 2025 SAP SE. All rights reserved.
 */
sap.ui.define(["./library","sap/ui/core/Control","sap/ui/Device","sap/ui/events/KeyCodes","sap/suite/ui/microchart/MicroChartUtils","sap/ui/core/ResizeHandler","./HarveyBallMicroChartRenderer","sap/ui/core/Core","sap/ui/core/Theming","./HarveyBallMicroChartItem"],function(t,e,i,a,r,s,o,n,l,p){"use strict";const h=t.MicroChartColorType;var u=e.extend("sap.suite.ui.microchart.HarveyBallMicroChart",{metadata:{library:"sap.suite.ui.microchart",properties:{total:{group:"Misc",type:"float",defaultValue:null},totalLabel:{group:"Misc",type:"string"},totalScale:{group:"Misc",type:"string"},formattedLabel:{group:"Misc",type:"boolean",defaultValue:false},showTotal:{group:"Misc",type:"boolean",defaultValue:true},showFractions:{group:"Misc",type:"boolean",defaultValue:true},size:{group:"Misc",type:"sap.m.Size",defaultValue:"Auto"},colorPalette:{type:"string[]",group:"Appearance",defaultValue:[]},width:{type:"sap.ui.core.CSSSize",group:"Misc"},height:{type:"sap.ui.core.CSSSize",group:"Misc"},alignContent:{group:"Misc",type:"sap.suite.ui.microchart.HorizontalAlignmentType",defaultValue:"Left"},isResponsive:{type:"boolean",group:"Appearance",defaultValue:false},hideOnNoData:{type:"boolean",group:"Appearance",defaultValue:false}},associations:{ariaLabelledBy:{type:"sap.ui.core.Control",multiple:true,singularName:"ariaLabelledBy"}},defaultAggregation:"items",aggregations:{items:{multiple:true,type:"sap.suite.ui.microchart.HarveyBallMicroChartItem",bindable:"bindable",defaultClass:p}},events:{press:{}}},renderer:o});u.VALUE_TRUNCATION_DIGITS=5;u.THRESHOLD_LOOK_XS=1.125;u.THRESHOLD_LOOK_S=3.5;u.THRESHOLD_LOOK_M=4.5;u.THRESHOLD_LOOK_L=5.875;u.prototype._getAltHeaderText=function(t){var e=this._oRb.getText("HARVEYBALLMICROCHART");if(t){e+=" "+this._oRb.getText("IS_ACTIVE")}if(!this._hasData()){e+="\n"+this._oRb.getText("NO_DATA");return e}return e};u.prototype._getAltSubText=function(t){var e="";var i=this.getItems();i.forEach(function(i){var a=i.getColor(),r=i.getTooltip_AsString(),s="";if(!r){return}var o=this.getColorPalette().length===0&&h.hasOwnProperty(a)?this._oRb.getText(("SEMANTIC_COLOR_"+a).toUpperCase()):"";var n=i.getFractionLabel();var l=i.getFractionScale();if(!n&&l){n=i.getFormattedLabel()?i.getFraction():i.getFraction()+i.getFractionScale().substring(0,3)}else if(!i.getFormattedLabel()&&i.getFractionLabel()&&l){n+=i.getFractionScale().substring(0,3)}s+=n+" "+o;s=r.split("((AltText))").join(s);if(s){e+="\n"+s;t=false}}.bind(this));if(this.getTotal()){var a=this.getTotalLabel();if(!a){if(this.getFormattedLabel()&&this.getTotal()){a=this.getTotal()}else if(this.getTotalScale()&&this.getTotal()){a=this.getTotal()+this.getTotalScale().substring(0,3)}}else if(!this.getFormattedLabel()&&this.getTotalScale()){a+=this.getTotalScale().substring(0,3)}e+=(t?"":"\n")+this._oRb.getText("HARVEYBALLMICROCHART_TOTAL_TOOLTIP")+" "+a}return e};u.prototype.getTooltip_AsString=function(t){var i=e.prototype.getTooltip_AsString.apply(this,arguments),a=this._getAltHeaderText(t),r=false;if(i){a=i.split("((AltText))").join(a)}if(!i||!a){a="";r=true}a+=this._getAltSubText(r);return a};u.prototype.init=function(){this._oRb=n.getLibraryResourceBundle("sap.suite.ui.microchart");this.setAggregation("tooltip","((AltText))",true);i.media.attachHandler(this.invalidate,this,i.media.RANGESETS.SAP_STANDARD);this._sChartResizeHandlerId=null;this._bThemeApplied=false;n.ready(this._handleCoreInitialized.bind(this))};u.prototype.setSize=function(t){if(this.getSize()!==t){this.setProperty("size",t,false)}return this};u.prototype._handleCoreInitialized=function(){l.attachApplied(this._handleThemeApplied.bind(this))};u.prototype._handleThemeApplied=function(){this._bThemeApplied=true;this.invalidate();l.detachApplied(this._handleThemeApplied.bind(this))};u.prototype.onBeforeRendering=function(){if(this._sChartResizeHandlerId){s.deregister(this._sChartResizeHandlerId)}this._unbindMouseEnterLeaveHandler()};u.prototype.onAfterRendering=function(){t._checkControlIsVisible(this,this._onControlIsVisible);this._bindMouseEnterLeaveHandler()};u.prototype._onControlIsVisible=function(){this._onResize();this._sChartResizeHandlerId=s.register(this,this._onResize.bind(this))};u.prototype._onResize=function(){var t=this.$(),e=t.height(),i=t.find(".sapSuiteHBMCChart").first(),a=t.find(".sapSuiteHBMCTextContainer").first(),r,s;t.removeClass("sapSuiteHBMCLookL sapSuiteHBMCLookM sapSuiteHBMCLookS sapSuiteHBMCLookXS");a.removeClass("sapSuiteHBMCTextContainerHide");i.css("width",i.css("height"));var o=t.find(".sapSuiteHBMCChartSvg")[0];if(o){o.setAttribute("viewBox","0 0 72 72")}if(e<this.convertRemToPixels(u.THRESHOLD_LOOK_S)){t.addClass("sapSuiteHBMCLookXS");if(o){o.setAttribute("viewBox","5 5 62 62")}}else if(e<this.convertRemToPixels(u.THRESHOLD_LOOK_M)){t.addClass("sapSuiteHBMCLookS")}else if(e<this.convertRemToPixels(u.THRESHOLD_LOOK_L)){t.addClass("sapSuiteHBMCLookM")}else{t.addClass("sapSuiteHBMCLookL")}r=t.width();s=i.width()+a.outerWidth();if(r<s){a.addClass("sapSuiteHBMCTextContainerHide")}};u.prototype._parseFormattedValue=function(t){return{scale:t.replace(/.*?([^+-.,\d]*)$/g,"$1").trim(),value:t.replace(/(.*?)[^+-.,\d]*$/g,"$1").trim()}};u.prototype.ontap=function(t){if(this.hasListeners("press")===true){t.setMarked();t.stopPropagation()}this.firePress()};u.prototype.onkeydown=function(t){if(t.which==a.SPACE){t.preventDefault()}};u.prototype.onkeyup=function(t){if(t.which===a.ENTER||t.which===a.SPACE){this.firePress();t.preventDefault()}};u.prototype.attachEvent=function(t,i,a,r){e.prototype.attachEvent.call(this,t,i,a,r);if(this.hasListeners("press")){this.$().attr("tabindex",0).addClass("sapSuiteUiMicroChartPointer")}return this};u.prototype.detachEvent=function(t,i,a){e.prototype.detachEvent.call(this,t,i,a);if(!this.hasListeners("press")){this.$().removeAttr("tabindex").removeClass("sapSuiteUiMicroChartPointer")}return this};u.prototype.exit=function(t){i.media.detachHandler(this.invalidate,this,i.media.RANGESETS.SAP_STANDARD);s.deregister(this._sChartResizeHandlerId)};u.prototype._addTitleAttribute=function(){if(!this.$().attr("title")&&this._hasData()){this.$().attr("title",this.getTooltip_AsString())}};u.prototype._removeTitleAttribute=function(){if(this.$().attr("title")){this.$().removeAttr("title")}};u.prototype._bindMouseEnterLeaveHandler=function(){this.$().on("mouseenter.tooltip",this._addTitleAttribute.bind(this));this.$().on("mouseleave.tooltip",this._removeTitleAttribute.bind(this))};u.prototype._unbindMouseEnterLeaveHandler=function(){this.$().off("mouseenter.tooltip");this.$().off("mouseleave.tooltip")};u._truncateValue=function(t,e){var i=t.replace(String.fromCharCode(8206),"").replace(String.fromCharCode(8207),"");var a=i.replace(/[+-., \d]*(.*)$/g,"$1").trim().replace(/\.$/,"");t=i.replace(/([+-., \d]*).*$/g,"$1").trim();var r=t[e-1]==="."||t[e-1]===",";if(t.length>=e&&r){return t.substring(0,e-1)+a}else{return t.substring(0,e)+a}};u.prototype._hasData=function(){return this.getItems().length>0};u.prototype.firePress=function(){if(this._hasData()){e.prototype.fireEvent.call(this,"press",arguments)}};r.extendMicroChart(u);return u});
//# sourceMappingURL=HarveyBallMicroChart.js.map