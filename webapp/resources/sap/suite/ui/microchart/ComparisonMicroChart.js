/*!
 * SAPUI5
 * (c) Copyright 2025 SAP SE. All rights reserved.
 */
sap.ui.define(["sap/ui/thirdparty/jquery","./library","sap/ui/core/Control","sap/ui/Device","sap/m/FlexBox","sap/suite/ui/microchart/MicroChartUtils","sap/m/library","sap/ui/core/ResizeHandler","./ComparisonMicroChartRenderer","sap/ui/core/Core","sap/ui/core/Theming","./ComparisonMicroChartData","sap/m/Menu","sap/m/MenuItem","sap/ui/core/Lib","sap/base/i18n/Localization"],function(jQuery,e,t,i,a,r,s,o,n,h,p,l,u,d,f,c){"use strict";const g=e.MicroChartColorType;var C=e.ComparisonMicroChartViewType;var v=s.Size;var _=["zh","zh-hk","zh-cn","zh-sg","zh-sw"];var m=t.extend("sap.suite.ui.microchart.ComparisonMicroChart",{metadata:{library:"sap.suite.ui.microchart",properties:{size:{type:"sap.m.Size",group:"Misc",defaultValue:"Auto"},scale:{type:"string",group:"Misc",defaultValue:""},minValue:{type:"float",group:"Appearance",defaultValue:null},maxValue:{type:"float",group:"Appearance",defaultValue:null},view:{type:"sap.suite.ui.microchart.ComparisonMicroChartViewType",group:"Appearance",defaultValue:"Normal"},colorPalette:{type:"string[]",group:"Appearance",defaultValue:[]},shrinkable:{type:"boolean",group:"Misc",defaultValue:false},width:{type:"sap.ui.core.CSSSize",group:"Appearance"},height:{type:"sap.ui.core.CSSSize",group:"Appearance"},isResponsive:{type:"boolean",group:"Appearance",defaultValue:false},hideOnNoData:{type:"boolean",group:"Appearance",defaultValue:false}},associations:{ariaLabelledBy:{type:"sap.ui.core.Control",multiple:true,singularName:"ariaLabelledBy"}},defaultAggregation:"data",aggregations:{data:{type:"sap.suite.ui.microchart.ComparisonMicroChartData",multiple:true,bindable:"bindable",defaultClass:l}},events:{press:{}}},renderer:n});m.THRESHOLD_LOOK_XS=6;m.THRESHOLD_LOOK_S=8.25;m.THRESHOLD_LOOK_M=10.5;m.THRESHOLD_LOOK_L=12;m.prototype.attachEvent=function(e,i,a,r){t.prototype.attachEvent.call(this,e,i,a,r);if(this.hasListeners("press")){this.$().attr("tabindex",0).addClass("sapSuiteUiMicroChartPointer")}return this};m.prototype.detachEvent=function(e,i,a){t.prototype.detachEvent.call(this,e,i,a);if(!this.hasListeners("press")){this.$().removeAttr("tabindex").removeClass("sapSuiteUiMicroChartPointer")}return this};m.prototype.onclick=function(e){if(!this.fireBarPress(e)){setTimeout(()=>{var e=this._oMenu;if(!e.isOpen()){this.firePress()}},0)}};m.prototype.oncontextmenu=function(e){this._openMenu();e.preventDefault();return false};m.prototype.fireBarPress=function(e){var t=e.target;var i=this._getBarIndex(t);var a=this._getSize()===v.L||this._getSize()===v.M;var r=!!t.getAttribute("data-bar-index");var s=false;if(a){s=i>=0?true:false}if(s||!a&&r){var o=this.getData()[i];if(o&&o.hasListeners("press")){var n=this.$().find(".sapSuiteUiMicroChartBarPointer");var h=n.index(this.$().find(".sapSuiteUiMicroChartBarPointer[tabindex='0']"));this._switchTabindex(h,i,n);return true}}return false};m.prototype.onsaptabprevious=function(){this.$().css("outline-color","")};m.prototype.onsaptabnext=function(){var e=this.$().next();if(e.hasClass("sapSuiteCpMC")&&e.attr("tabindex")){e.css("outline-color","")}};m.prototype.onsapenter=function(e){if(!this.fireBarPress(e)){this.firePress();e.preventDefault();e.stopImmediatePropagation()}};m.prototype.onsapspace=m.prototype.onsapenter;m.prototype.onsapup=function(e){var t=this.$().find(".sapSuiteUiMicroChartBarPointer");if(t.length>0){var i=t.index(e.target);this._switchTabindex(i,i-1,t)}e.preventDefault();e.stopImmediatePropagation()};m.prototype.onsapdown=function(e){var t=this.$().find(".sapSuiteUiMicroChartBarPointer");if(t.length>0){var i=t.index(e.target);this._switchTabindex(i,i+1,t)}e.preventDefault();e.stopImmediatePropagation()};m.prototype.onsaphome=function(e){var t=this.$().find(".sapSuiteUiMicroChartBarPointer");var i=t.index(e.target);if(i!==0&&t.length>0){this._switchTabindex(i,0,t)}e.preventDefault();e.stopImmediatePropagation()};m.prototype.onsapend=function(e){var t=this.$().find(".sapSuiteUiMicroChartBarPointer");var i=t.index(e.target),a=t.length;if(i!==a-1&&a>0){this._switchTabindex(i,a-1,t)}e.preventDefault();e.stopImmediatePropagation()};m.prototype.onsapleft=m.prototype.onsapup;m.prototype.onsapright=m.prototype.onsapdown;m.prototype.setMinValue=function(e){this._isMinValueSet=Number.isFinite(Number(e));return this.setProperty("minValue",this._isMinValueSet?e:NaN)};m.prototype.setMaxValue=function(e){this._isMaxValueSet=Number.isFinite(Number(e));return this.setProperty("maxValue",this._isMaxValueSet?e:NaN)};m.prototype.setSize=function(e){if(this.getSize()!==e){this.setProperty("size",e,false)}return this};m.prototype.init=function(){this._oRb=f.getResourceBundleFor("sap.suite.ui.microchart");this.setAggregation("tooltip","((AltText))",true);this._isMinValueSet=false;this._isMaxValueSet=false;this._bThemeApplied=false;this._oMenu=new u(this.getId()+"-detailView");this.addDependent(this._oMenu);h.ready(this._handleCoreInitialized.bind(this))};m.prototype._handleCoreInitialized=function(){p.attachApplied(this._handleThemeApplied.bind(this))};m.prototype._handleThemeApplied=function(){this._bThemeApplied=true;this.invalidate();p.detachApplied(this._handleThemeApplied.bind(this))};m.prototype._getBarIndex=function(e){var t=this.getData();for(var i=0;i<t.length;i++){if(t[i].getDomRef().contains(e)){return i}}return-1};m.prototype.onBeforeRendering=function(){if(this._sChartResizeHandlerId){o.deregister(this._sChartResizeHandlerId)}this._unbindMouseEnterLeaveHandler()};m.prototype.onAfterRendering=function(){e._checkControlIsVisible(this,this._onControlIsVisible);this._bindMouseEnterLeaveHandler();var t=c.getLanguageTag().language;var i=_.includes(t.toLowerCase());this.toggleStyleClass("sapCMCEastCharsPresent",i)};m.prototype._onControlIsVisible=function(){this._onResize();this._sChartResizeHandlerId=o.register(this,this._onResize.bind(this))};m.prototype.setBarPressable=function(e,t){if(t){var i=this._getBarAltText(e);this.$("chart-item-bar-"+e).addClass("sapSuiteUiMicroChartPointer").attr("tabindex",0).attr("title",i).attr("role","presentation").attr("aria-label",i)}else{this.$("chart-item-bar-"+e).removeAttr("tabindex").removeClass("sapSuiteUiMicroChartPointer").removeAttr("title").removeAttr("role").removeAttr("aria-label")}};m.prototype._getAltHeaderText=function(e){var t=this._oRb.getText("COMPARISONMICROCHART");if(e){t+=" "+this._oRb.getText("IS_ACTIVE")}if(!this._hasData()){t+="\n"+this._oRb.getText("NO_DATA");return t}return t};m.prototype._getAltSubText=function(e){var t="";for(var i=0;i<this.getData().length;i++){var a=this.getData()[i],r=this._getBarAltText(i),s=a.getTooltip_AsString(),o="";if(!s){continue}o=s.split("((AltText))").join(r);if(o){t+=(e?"":"\n")+o;e=false}}return t};m.prototype.exit=function(){o.deregister(this._sChartResizeHandlerId)};m.prototype._calculateChartData=function(){var e=[];var t=this.getData();var i=t.length;var a=0;var r=0;var s;var o;var n;var h;for(h=0;h<i;h++){var p=isNaN(t[h].getValue())?0:t[h].getValue();a=Math.max(a,p);r=Math.min(r,p)}if(this._isMinValueSet){r=Math.min(r,this.getMinValue())}if(this._isMaxValueSet){a=Math.max(a,this.getMaxValue())}s=a-r;o=s==0?0:Math.round(a*100/s);if(o==0&&a!=0){o=1}else if(o==100&&r!=0){o=99}n=100-o;for(h=0;h<i;h++){var l={};var u=isNaN(t[h].getValue())?0:t[h].getValue();l.value=s==0?0:Math.round(u*100/s);if(l.value==0&&u!=0){l.value=u>0?1:-1}else if(l.value==100){l.value=o}else if(l.value==-100){l.value=-n}if(l.value>=0){l.negativeNoValue=n;l.positiveNoValue=o-l.value}else{l.value=-l.value;l.negativeNoValue=n-l.value;l.positiveNoValue=o}e.push(l)}return e};m.prototype._getLocalizedColorMeaning=function(e){return g.hasOwnProperty(e)&&e!="None"?this._oRb.getText(("SEMANTIC_COLOR_"+e).toUpperCase()):""};m.prototype._getBarAltText=function(e){var i=this.getData()[e],a=t.prototype.getTooltip_AsString.apply(i,arguments),r=this.getColorPalette().length?"":this._getLocalizedColorMeaning(i.getColor()),s=i.getTitle()+" "+(i.getDisplayValue()?i.getDisplayValue():i.getValue())+this.getScale()+" "+r;if(!a){return""}return a.split("((AltText))").join(s)};m.prototype._onResize=function(){this.$().find(".sapSuiteCpMCChartItem").show();this._resizeHorizontally();this._resizeVertically()};m.prototype._resizeVertically=function(){var e,t,i,a,r,s,o,n,h,p=this.getData(),l=this.$(),u,d=l.find(".sapSuiteCpMCChartItem"),f=l.find(".sapSuiteCpMCChartBar");d.css("margin-bottom","");d.css("height","");f.css("height","");if(p.length>0&&p[0].getDomRef()){e=p[0].getDomRef().getBoundingClientRect().height;t=parseFloat(p[0].$().css("margin-bottom"));i=f.height();s=l.width();o=this._getCurrentBaseWidth();if(o>0){n=o/e;e=s/n;d.css("height",e);n=o/t;t=s/n;d.css("margin-bottom",t);n=o/i;f.css("height",s/n)}a=l.find(".sapSuiteCpMCVerticalAlignmentContainer")[0].getBoundingClientRect().height;r=0;for(var c=0;c<p.length;c++){r+=e;if(Math.floor(r)>Math.floor(a)){p[c].$().hide()}r+=t}u=this.$().find(".sapSuiteCpMCVerticalAlignmentContainer .sapSuiteCpMCChartItem:visible:last");if(u.length===1&&!this.getShrinkable()){u.css("margin-bottom","");h=this.getDomRef().getBoundingClientRect().bottom-u[0].getBoundingClientRect().bottom;if(h<t){u.css("margin-bottom",h<0?0:h)}}}};m.prototype._resizeHorizontally=function(){var e=this.$();var t=0;var i=0;var a=this.$().find(".sapSuiteCpMCChartItemTitle");var r=this.$().find(".sapSuiteCpMCChartItemValue");var s;var o;e.removeClass("sapSuiteCpMCLookL sapSuiteCpMCLookM sapSuiteCpMCLookS sapSuiteCpMCLookXS sapSuiteCpMCLookWide");o=this._getCurrentLookClass();e.addClass(o);if(!e.hasClass("sapSuiteCpMCLookXS")){this._hideTruncatedLabels(".sapSuiteCpMCChartItemValue")}a.width("auto");r.width("auto");if(e.hasClass("sapSuiteCpMCLookWide")){a.each(function(){s=this.getBoundingClientRect();if(s.width>t){t=Math.ceil(s.width)}});a.width(t);r.each(function(){s=this.getBoundingClientRect();if(s.width>i){i=Math.ceil(s.width)}});r.width(i)}};m.prototype._getCurrentBaseWidth=function(){var e=this.$();var t=parseInt(e.width());var i;if(this.getView()===C.Wide||t>this.convertRemToPixels(m.THRESHOLD_LOOK_L)||this.getSize()!==v.Responsive){i=0}else if(t>this.convertRemToPixels(m.THRESHOLD_LOOK_M)){i=this.convertRemToPixels(m.THRESHOLD_LOOK_L)}else if(t>this.convertRemToPixels(m.THRESHOLD_LOOK_S)){i=this.convertRemToPixels(m.THRESHOLD_LOOK_M)}else if(t>this.convertRemToPixels(m.THRESHOLD_LOOK_XS)){i=this.convertRemToPixels(m.THRESHOLD_LOOK_S)}else{i=0}return i};m.prototype._getCurrentLookClass=function(){var e=this.$();var t=parseInt(e.width());var i;if(this._shouldUseWideView()){i="sapSuiteCpMCLookWide"}else if(this.getSize()!==v.Responsive){i="sapSuiteCpMCLook"+this._getSize()}else if(t>this.convertRemToPixels(m.THRESHOLD_LOOK_M)){i="sapSuiteCpMCLookL"}else if(t>this.convertRemToPixels(m.THRESHOLD_LOOK_S)){i="sapSuiteCpMCLookM"}else if(t>this.convertRemToPixels(m.THRESHOLD_LOOK_XS)){i="sapSuiteCpMCLookS"}else{i="sapSuiteCpMCLookXS"}return i};m.prototype._getSize=function(){var e=this.getSize();if(e===v.Auto){if(i.system.phone){e=v.S}else{e=v.M}}return e};m.prototype._shouldUseWideView=function(){var e=parseInt(this.$().width());return this.getView()===C.Wide||this.getView()===C.Responsive&&e>this.convertRemToPixels(m.THRESHOLD_LOOK_L)};m.prototype._hideTruncatedLabels=function(e){var t=this.$();var i=t.find(e);for(var a=0;a<i.length;a++){jQuery(i[a]).removeClass("sapSuiteCpMCChartItemHiddenLabel");if(this._isLabelTruncated(i[a])){jQuery(i[a]).addClass("sapSuiteCpMCChartItemHiddenLabel")}}};m.prototype._addTitleAttribute=function(){var t=this.getTooltip_AsString();if(!e._isTooltipSuppressed(t)&&this._hasData()){if(this._isResponsive()){this.$().find(".sapSuiteCpMCVerticalAlignmentContainer").attr("title",t)}else{this.$().attr("title",t)}}};m.prototype._removeTitleAttribute=function(){if(this._isResponsive()){this.$().find(".sapSuiteCpMCVerticalAlignmentContainer").removeAttr("title")}else{this.$().removeAttr("title")}};m.prototype._resolveFocus=function(e){var t=jQuery(e.target);if(t&&t.attr("data-bar-index")){var i=parseInt(t.attr("data-bar-index"));var a=this.getData()[i];if(a&&a.hasListeners("press")){this.$().css("outline-color","transparent")}else{this.$().css("outline-color","")}}else{this.$().css("outline-color","")}};m.prototype._switchTabindex=function(e,t,i){if(e>=0&&e<i.length&&t>=0&&t<i.length){i.eq(e).removeAttr("tabindex");i.eq(t).attr("tabindex","0").trigger("focus")}};m.prototype._bindMouseEnterLeaveHandler=function(){if(!this._oMouseEnterLeaveHandler){this._oMouseEnterLeaveHandler={mouseEnterChart:this._addTitleAttribute.bind(this),mouseLeaveChart:this._removeTitleAttribute.bind(this),mouseDownChart:this._resolveFocus.bind(this)}}this.$().on("mouseenter",this._oMouseEnterLeaveHandler.mouseEnterChart);this.$().on("mouseleave",this._oMouseEnterLeaveHandler.mouseLeaveChart);this.$().on("mousedown",this._oMouseEnterLeaveHandler.mouseDownChart)};m.prototype._unbindMouseEnterLeaveHandler=function(){if(this._oMouseEnterLeaveHandler){this.$().off("mouseenter",this._oMouseEnterLeaveHandler.mouseEnterChart);this.$().off("mouseleave",this._oMouseEnterLeaveHandler.mouseLeaveChart);this.$().off("mousedown",this._oMouseEnterLeaveHandler.mouseDownChart)}};m.prototype._hasData=function(){return this.getData().length>0};m.prototype._openMenu=function(){if(this._isDataChanged()){this._oMenu.removeAllItems();this._oMenu.addItem(new d({text:this._oRb.getText("DELTAMICROCHART_ENTIRE_CHART"),press:this._fireChart.bind(this)}));this.getData().forEach(e=>{this._oMenu.addItem(new d({text:this._oRb.getText("DELTAMICROCHART_MENU_ITEM",[e.getTitle()]),press:this._onMenuItemClick.bind(this)}))})}if(this._hasData()){this._oMenu.openBy(this,true,"right")}};m.prototype._fireChart=function(){this.firePress()};m.prototype._isDataChanged=function(){var e=[];var t=[];this.getData().forEach(t=>{e.push(t.getTitle())});this._oMenu.getItems().forEach(e=>{t.push(e.getText())});if(e.length!==t.length){return true}for(var i=0;i<e.length;i++){if(e[i]!=t[i]){return true}}return false};m.prototype._onMenuItemClick=function(e){var t=e.getSource();var i=this._getIndex(t,t.getParent());var a=this.getData()[i-1];if(a&&a.hasListeners("press")){a.firePress()}};m.prototype._getIndex=function(e,t){var i=t.getItems();for(var a=0;a<i.length;a++){if(i[a]===e){return a}}return 0};m.prototype.firePress=function(){if(this._hasData()){t.prototype.fireEvent.call(this,"press",arguments)}};r.extendMicroChart(m);return m});
//# sourceMappingURL=ComparisonMicroChart.js.map