/*!
 * SAPUI5
 * (c) Copyright 2025 SAP SE. All rights reserved.
 */
sap.ui.define(["sap/ui/thirdparty/jquery","./library","sap/ui/core/Control","sap/m/library","sap/m/FlexBox","sap/suite/ui/microchart/MicroChartUtils","sap/ui/core/ResizeHandler","./StackedBarMicroChartRenderer","sap/ui/core/Core","sap/ui/core/Theming","sap/ui/core/Lib","./StackedBarMicroChartBar"],function(jQuery,t,e,i,r,a,o,s,n,l,p,u){"use strict";var h=i.Size;const d=t.MicroChartColorType;var c=e.extend("sap.suite.ui.microchart.StackedBarMicroChart",{metadata:{library:"sap.suite.ui.microchart",properties:{size:{type:"sap.m.Size",group:"Appearance",defaultValue:h.Auto},maxValue:{type:"float",group:"Appearance",defaultValue:null},precision:{type:"int",group:"Appearance",defaultValue:1},displayZeroValue:{type:"boolean",group:"Appearance",defaultValue:true},width:{type:"sap.ui.core.CSSSize",group:"Misc"},height:{type:"sap.ui.core.CSSSize",group:"Misc"},showLabels:{type:"boolean",group:"Misc",defaultValue:true},hideOnNoData:{type:"boolean",group:"Appearance",defaultValue:false}},associations:{ariaLabelledBy:{type:"sap.ui.core.Control",multiple:true,singularName:"ariaLabelledBy"}},defaultAggregation:"bars",aggregations:{bars:{type:"sap.suite.ui.microchart.StackedBarMicroChartBar",multiple:true,bindable:"bindable",defaultClass:u}},events:{press:{}}},renderer:s});c.THRESHOLD_SMALL_LOOK=1;c.BAR_COLOR_PARAM_DEFAULT="sapUiChartPaletteQualitativeHue";c.BAR_LABEL_CSSCLASS=".sapSuiteStackedMCBarLabel";c.BAR_CSSCLASS=".sapSuiteStackedMCBar";c.prototype.attachEvent=function(){e.prototype.attachEvent.apply(this,arguments);if(this.hasListeners("press")){this.$().attr("tabindex",0).addClass("sapSuiteUiMicroChartPointer")}return this};c.prototype.detachEvent=function(){e.prototype.detachEvent.apply(this,arguments);if(!this.hasListeners("press")){this.$().removeAttr("tabindex").removeClass("sapSuiteUiMicroChartPointer")}return this};c.prototype.onclick=function(t){if(this.hasListeners("press")){t.stopPropagation();this.firePress()}};c.prototype.onsapspace=c.prototype.onclick;c.prototype.onsapenter=c.prototype.onclick;c.prototype.setMaxValue=function(t){var e=Number.isFinite(Number(t));this.setProperty("maxValue",e?t:null);return this};c.prototype.setTooltip=function(t){this._title=null;this.setAggregation("tooltip",t,true);return this};c.prototype.init=function(){this._oRb=p.getResourceBundleFor("sap.suite.ui.microchart");this.setAggregation("tooltip","((AltText))",true);this._bThemeApplied=false;n.ready(this._handleCoreInitialized.bind(this))};c.prototype._handleCoreInitialized=function(){l.attachApplied(this._handleThemeApplied.bind(this))};c.prototype._handleThemeApplied=function(){this._bThemeApplied=true;this.invalidate()};c.prototype.onBeforeRendering=function(){if(this._sChartResizeHandlerId){o.deregister(this._sChartResizeHandlerId)}this.$().off("mouseenter");this.$().off("mouseleave")};c.prototype.onAfterRendering=function(){t._checkControlIsVisible(this,this._onControlIsVisible)};c.prototype._onControlIsVisible=function(){this._sChartResizeHandlerId=o.register(this,this._onResize.bind(this));this._onResize();this.$().on("mouseenter",this._addTitleAttribute.bind(this));this.$().on("mouseleave",this._removeTitleAttribute.bind(this))};c.prototype.exit=function(){o.deregister(this._sChartResizeHandlerId);l.detachApplied(this._handleThemeApplied.bind(this))};c.prototype._getLocalizedColorMeaning=function(t){return this._oRb.getText(("SEMANTIC_COLOR_"+t).toUpperCase())};c.prototype._calculateChartData=function(){var t=[];var e=this.getBars();var i=e.length;var r=12;var a=1;var o=this.getPrecision();var s=function(){if(r){if(a===r){a=1}return c.BAR_COLOR_PARAM_DEFAULT+a++}};var n=0;var l=this.getMaxValue();var p=0;for(p;p<i;p++){if(!isNaN(e[p].getValue())){n=n+e[p].getValue()}}var u=Math.max(l,n);var h=l>=n;var d=0;var f=0;var _;for(p=0;p<i;p++){_={oBarData:e[p]};_.color=e[p].getValueColor();if(!_.color){_.color=s()}var g=isNaN(e[p].getValue())?0:e[p].getValue();var y=u===0?0:g*100/u;_.value=this._roundFloat(y,o);_.width=this._roundFloat(y,2);d=d+_.value;f=f+_.width;if(h){_.displayValue=e[p].getDisplayValue()||String(g)}else{_.displayValue=e[p].getDisplayValue()||String(_.value+"%")}t.push(_)}d=this._roundFloat(d,o);f=this._roundFloat(f,2);var C;if(f>100&&t.length>0){C=t.slice(0).sort(function(t,e){return e.width-t.width})[0];C.width=this._roundFloat(C.width-f+100,2)}var S=function(t){return t.some(function(t){return t.width>0})};if(l>n){_={value:this._roundFloat(100-d,o),width:this._roundFloat(100-f,2)};t.push(_)}else if(t.length>0&&f<100&&(!this.getDisplayZeroValue()||S(t))){C=t.slice(0).sort(function(t,e){return e.width-t.width})[0];C.width=this._roundFloat(C.width-f+100,2)}return t};c.prototype._roundFloat=function(t,e){return parseFloat(t.toFixed(e))};c.prototype._onResize=function(){this._resizeVertically();this._resizeHorizontally()};c.prototype._resizeVertically=function(){var t=this.$();var e=parseFloat(t.height());if(e<=this.convertRemToPixels(c.THRESHOLD_SMALL_LOOK)){t.addClass("sapSuiteStackedMCSmallLook")}else{t.removeClass("sapSuiteStackedMCSmallLook")}};c.prototype._resizeHorizontally=function(){this._hideTruncatedLabels(c.BAR_LABEL_CSSCLASS)};c.prototype._hideTruncatedLabels=function(t){var e=this.$();var i=e.find(t);i.removeClass("sapSuiteStackedMCBarLabelHidden");for(var r=0;r<i.length;r++){if(this._isLabelTruncated(i[r])){e.find(i[r]).addClass("sapSuiteStackedMCBarLabelHidden")}}};c.prototype._getAltHeaderText=function(e){var i=this._calculateChartData(),r=this._oRb.getText("STACKEDBARMICROCHART");if(e){r+=" "+this._oRb.getText("IS_ACTIVE")}r+="\n";if(!this._hasData()){r+=this._oRb.getText("NO_DATA");return r}var a,o,s,n=false;for(var l=0;l<i.length;l++){a=i[l];o=a.oBarData;s=o&&o.getTooltip_AsString();if(t._isTooltipSuppressed(s)){continue}if(n){r+="\n"}n=true;if(s){r+=s}else if(a.displayValue){r+=a.displayValue;if(d.hasOwnProperty(a.color)){r+=" "+this._getLocalizedColorMeaning(a.color)}}}return r};c.prototype._isTooltipSuppressed=function(){var t=this.getTooltip_AsString();return t&&t.trim().length===0};c.prototype._addTitleAttribute=function(){if(this.$().attr("title")){return}if(!this._title&&this._hasData()){this._title=this.getTooltip_AsString()}if(this._title){this.$().attr("title",this._title)}};c.prototype._removeTitleAttribute=function(){if(this.$().attr("title")){this._title=this.$().attr("title");this.$().removeAttr("title")}};c.prototype._hasData=function(){return this.getBars().length>0};c.prototype.firePress=function(){if(this._hasData()){e.prototype.fireEvent.call(this,"press",arguments)}};a.extendMicroChart(c);return c});
//# sourceMappingURL=StackedBarMicroChart.js.map