/*!
 * SAPUI5
 * (c) Copyright 2025 SAP SE. All rights reserved.
 */
sap.ui.define(["./library","sap/ui/core/Control","sap/ui/core/ResizeHandler","sap/base/Log","sap/ui/events/KeyCodes","sap/suite/ui/microchart/MicroChartUtils","sap/m/library","./ColumnMicroChartRenderer","sap/ui/core/Core","sap/ui/core/Theming","./ColumnMicroChartData","./ColumnMicroChartLabel"],function(t,e,i,a,s,o,r,l,n,u,h,p){"use strict";var f=r.Size;const C=t.MicroChartColorType;var c=e.extend("sap.suite.ui.microchart.ColumnMicroChart",{metadata:{library:"sap.suite.ui.microchart",properties:{size:{group:"Misc",type:"sap.m.Size",defaultValue:f.Auto},width:{group:"Misc",type:"sap.ui.core.CSSSize"},height:{group:"Misc",type:"sap.ui.core.CSSSize"},isResponsive:{type:"boolean",group:"Appearance",defaultValue:false},showTopLabels:{type:"boolean",defaultValue:true},showBottomLabels:{type:"boolean",defaultValue:true},allowColumnLabels:{type:"boolean",group:"Appearance",defaultValue:false},hideOnNoData:{type:"boolean",group:"Appearance",defaultValue:false}},events:{press:{}},associations:{ariaLabelledBy:{type:"sap.ui.core.Control",multiple:true,singularName:"ariaLabelledBy"}},defaultAggregation:"columns",aggregations:{columns:{multiple:true,type:"sap.suite.ui.microchart.ColumnMicroChartData",defaultClass:h,defaultValue:null,bindable:"bindable"},leftTopLabel:{multiple:false,type:"sap.suite.ui.microchart.ColumnMicroChartLabel",defaultClass:p,defaultValue:null},rightTopLabel:{multiple:false,type:"sap.suite.ui.microchart.ColumnMicroChartLabel",defaultClass:p,defaultValue:null},leftBottomLabel:{multiple:false,type:"sap.suite.ui.microchart.ColumnMicroChartLabel",defaultClass:p,defaultValue:null},rightBottomLabel:{multiple:false,type:"sap.suite.ui.microchart.ColumnMicroChartLabel",defaultClass:p,defaultValue:null}}},renderer:l});c.THRESHOLD_LOOK_XS=1.125;c.THRESHOLD_LOOK_S=3.5;c.THRESHOLD_LOOK_M=4.5;c.THRESHOLD_LOOK_L=5.875;c.THRESHOLD_WIDTH_NO_LABEL=6;c.prototype.init=function(){this._oRb=n.getLibraryResourceBundle("sap.suite.ui.microchart");this.setAggregation("tooltip","((AltText))",true);this._bThemeApplied=false;n.ready(this._handleCoreInitialized.bind(this))};c.prototype._handleCoreInitialized=function(){u.attachApplied(this._handleThemeApplied.bind(this))};c.prototype._handleThemeApplied=function(){this._bThemeApplied=true;this.invalidate();u.detachApplied(this._handleThemeApplied.bind(this))};c.prototype.onBeforeRendering=function(){this.$().off("mouseenter");this.$().off("mouseleave")};c.prototype.onAfterRendering=function(){if(this._sChartResizeHandlerId){i.deregister(this._sChartResizeHandlerId)}t._checkControlIsVisible(this,this._onControlIsVisible);this.$().on("mouseenter",this._addTitleAttribute.bind(this));this.$().on("mouseleave",this._removeTitleAttribute.bind(this))};c.prototype._onControlIsVisible=function(){this._fChartHeight=undefined;this._aBars=[];var t=this.getColumns().length;for(var e=0;e<t;e++){this._aBars.push({})}this._onResize();this._sChartResizeHandlerId=i.register(this,this._onResize.bind(this))};c.prototype.exit=function(){i.deregister(this._sChartResizeHandlerId)};c.prototype._onResize=function(){this._calcColumns();var t=this.$(),e=parseInt(t.width()),i=parseInt(t.height()),s=t.find(".sapSuiteClMCPositionTop").children(),o=t.find(".sapSuiteClMCLabelColumn.sapSuiteClMCLabelColumnTop,.sapSuiteClMCLabelColumn.sapSuiteClMCLabelColumnBottom"),r=t.find(".sapSuiteClMCBars")[0],l=this.getColumns(),n=l.length;t.removeClass("sapSuiteClMCNoLabels sapSuiteClMCNoColumnLabels sapSuiteClMCNoTopLabels sapSuiteClMCLookM sapSuiteClMCLookS sapSuiteClMCLookXS");if(e<=this.convertRemToPixels(c.THRESHOLD_WIDTH_NO_LABEL)){t.addClass("sapSuiteClMCNoLabels")}if(i<this.convertRemToPixels(c.THRESHOLD_LOOK_S)){t.addClass("sapSuiteClMCLookXS")}else if(i<this.convertRemToPixels(c.THRESHOLD_LOOK_M)){if(this.getAllowColumnLabels()){t.addClass("sapSuiteClMCNoColumnLabels")}t.addClass("sapSuiteClMCLookS")}else if(i<this.convertRemToPixels(c.THRESHOLD_LOOK_L)){t.addClass("sapSuiteClMCLookM")}if(this._isAnyLabelTruncated(s)){t.addClass("sapSuiteClMCNoTopLabels")}if(this.getAllowColumnLabels()&&this._isAnyLabelTruncated(o)){t.addClass("sapSuiteClMCNoColumnLabels")}if(n>0&&r){t.find(".sapSuiteClMCBar").show();while(r.scrollWidth>r.offsetWidth){l[--n].$().hide();a.warning(this.toString()+" Chart overflow","Column "+n+" was not rendered")}}};c.prototype._calcColumns=function(){var t=this.getColumns();if(t&&t.length===this._aBars.length){var e=parseFloat(this.$().css("height"));if(e!==this._fChartHeight){this._fChartHeight=e;this._calcColumnsHeight(e,this._aBars)}for(var i=0;i<t.length;i++){t[i].$().css(this._aBars[i])}}};c.prototype._calcColumnsHeight=function(t,e){var i=this.getColumns().length;if(i!==e.length){return}var a,s,o;a=s=0;for(var r=0;r<i;r++){var l=this.getColumns()[r];if(a<l.getValue()){a=l.getValue()}else if(s>l.getValue()){s=l.getValue()}}if(a===0&&s===0){for(var n=0;n<i;n++){e[n].top="calc(100% - 1px)";e[n].height="1px"}return}var u=a-s;var h=u/t;var p,f;p=f=0;for(var C=0;C<i;C++){o=this.getColumns()[C].getValue();if(Math.abs(o)<h){if(o>=0){if(o===a){f=h-o}}else if(o===s){p=h+o}}}if(f){a+=f;s-=f}if(p){a-=p;s+=p}var c=0-h;for(var g=0;g<i;g++){o=this.getColumns()[g].getValue();var d=o;if(o>=0){d=Math.max(d+f-p,h)}else{d=Math.min(d+f-p,c)}e[g].value=d}function b(t){return(t/u*100).toFixed(2)+"%"}var m=b(a);for(var n=0;n<i;n++){o=e[n].value;e[n].top=o<0?m:b(a-o);e[n].height=b(Math.abs(o))}};c.prototype.attachEvent=function(t,i,a,s){e.prototype.attachEvent.call(this,t,i,a,s);if(this.hasListeners("press")){this.$().attr("tabindex",0).addClass("sapSuiteUiMicroChartPointer")}return this};c.prototype.detachEvent=function(t,i,a){e.prototype.detachEvent.call(this,t,i,a);if(!this.hasListeners("press")){this.$().removeAttr("tabindex").removeClass("sapSuiteUiMicroChartPointer")}return this};c.prototype.getLocalizedColorMeaning=function(t){return C.hasOwnProperty(t)?this._oRb.getText(("SEMANTIC_COLOR_"+t).toUpperCase()):""};c.prototype.setSize=function(t){if(this.getSize()!==t){this.setProperty("size",t,false)}return this};c.prototype._getAltHeaderText=function(t){var e=this._oRb.getText("COLUMNMICROCHART");if(t){e+=" "+this._oRb.getText("IS_ACTIVE")}if(!this._hasData()){e+="\n"+this._oRb.getText("NO_DATA");return e}var i=this.getLeftTopLabel();var a=this.getRightTopLabel();var s=this.getLeftBottomLabel();var o=this.getRightBottomLabel();var r;if(i&&i.getLabel()||s&&s.getLabel()){if(i){r=i.getColor()}else if(s){r=s.getColor()}else{r=""}e+="\n"+this._oRb.getText("COLUMNMICROCHART_START")+": "+(s?s.getLabel()+" ":"")+(i?i.getLabel()+" ":"")+this.getLocalizedColorMeaning(r)}if(a&&a.getLabel()||o&&o.getLabel()){if(a){r=a.getColor()}else if(o){r=o.getColor()}else{r=""}e+="\n"+this._oRb.getText("COLUMNMICROCHART_END")+": "+(o?o.getLabel()+" ":"")+(a?a.getLabel()+" ":"")+this.getLocalizedColorMeaning(r)}return e};c.prototype._getAltSubText=function(t){var e="";var i=this.getColumns();for(var a=0;a<i.length;a++){var s=i[a],o=s.getTooltip_AsString(),r="";if(!o){continue}r+=(t?"":"\n")+this._getBarAltText(s);r=o.split("((AltText))").join(r);if(r){e+=r;t=false}}return e};c.prototype.onclick=function(t){if(!this.fireBarPress(t)){this.firePress()}};c.prototype.onkeydown=function(t){var e,i;switch(t.keyCode){case s.SPACE:t.preventDefault();break;case s.ARROW_LEFT:case s.ARROW_UP:i=this.$().find(":focusable");e=i.index(t.target);if(i.length>1){if(e===-1){i.eq(i.length-2).get(0).focus()}else{i.eq(e-1>=0?e-1:i.length-1).get(0).focus()}t.preventDefault();t.stopPropagation()}break;case s.ARROW_DOWN:case s.ARROW_RIGHT:i=this.$().find(":focusable");e=i.index(t.target);if(i.length>0){i.eq(e+1<i.length?e+1:0).get(0).focus();t.preventDefault();t.stopPropagation()}break;default:}};c.prototype.onkeyup=function(t){if(t.which===s.ENTER||t.which===s.SPACE){if(!this.fireBarPress(t)){this.firePress();t.preventDefault()}}};c.prototype.fireBarPress=function(t){var e=t.srcControl;if(e&&e.isA("sap.suite.ui.microchart.ColumnMicroChartData")){if(e.hasListeners("press")){e.firePress();t.preventDefault();t.stopPropagation();return true}}return false};c.prototype._getBarAltText=function(t){var e=this.getLocalizedColorMeaning(t.getColor());return t.getLabel()+" "+t.getValue()+" "+e};c.prototype.setBarPressable=function(t,e){var i=t.$();if(e){var a=this._getBarAltText(t);i.addClass("sapSuiteUiMicroChartPointer").attr("tabindex",0).attr("title",a).attr("role","presentation").attr("aria-label",a)}else{i.removeAttr("tabindex").removeClass("sapSuiteUiMicroChartPointer").removeAttr("title").removeAttr("role").removeAttr("aria-label")}};c.prototype.onsaptabnext=function(t){var e=this.$().find(":focusable").last();if(e){this._bIgnoreFocusEvt=true;e.get(0).focus()}};c.prototype.onsaptabprevious=function(t){if(t.target.id!==t.currentTarget.id){var e=this.$().find(":focusable").first();if(e){e.get(0).focus()}}};c.prototype.onfocusin=function(t){if(this._bIgnoreFocusEvt){this._bIgnoreFocusEvt=false;return}if(this.getId()+"-hidden"===t.target.id){this.$().trigger("focus");t.preventDefault();t.stopPropagation()}};c.prototype._addTitleAttribute=function(){if(!this.$().attr("title")&&this._hasData()){this.$().attr("title",this.getTooltip_AsString())}};c.prototype._removeTitleAttribute=function(){if(this.$().attr("title")){this.$().removeAttr("title")}};c.prototype._hasData=function(){return this.getColumns().length>0};c.prototype.firePress=function(){if(this._hasData()){e.prototype.fireEvent.call(this,"press",arguments)}};o.extendMicroChart(c);return c});
//# sourceMappingURL=ColumnMicroChart.js.map