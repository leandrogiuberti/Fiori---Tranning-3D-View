/*!
 * 
		SAP UI development toolkit for HTML5 (SAPUI5)
		(c) Copyright 2009-2015 SAP SE. All rights reserved
	
 */
sap.ui.define(["sap/ui/thirdparty/jquery","./library","./util/DateUtils","sap/ui/commons/library","sap/ui/commons/Label","sap/ui/commons/RangeSlider","sap/ui/core/format/DateFormat","sap/ui/commons/Slider","sap/base/Log","./DateRangeSliderInternalRenderer","sap/base/i18n/Localization"],function(jQuery,t,e,i,a,s,r,n,o,h,l){"use strict";var u=s.extend("sap.suite.ui.commons.DateRangeSliderInternal",{metadata:{deprecated:true,library:"sap.suite.ui.commons",properties:{showBubbles:{type:"boolean",group:"Misc",defaultValue:true},pinGrip:{type:"boolean",group:"Misc",defaultValue:false},pinGrip2:{type:"boolean",group:"Misc",defaultValue:false}},events:{change:{},liveChange:{}}}});var p=12;var g="d";var f="m";u.prototype.init=function(){this.setSmallStepWidth(1);this._sGranularity=g;this._oDateFormat=null;var t=new Date;this._dMinDate=e.incrementDateByIndex(t,-365);if(!this.getTotalUnits()){this.setTotalUnits(p)}this.setMin(0);this.setMax(365);this.setValue(0);this.setValue2(365);var i=this.getLabels()&&this.getLabels().length>0;this._bUsingDefaultLabels=this.getStepLabels()&&!i;if(this._bUsingDefaultLabels){u.createRailLabels(this)}if(this.getShowBubbles()){this._oBubble=new a({id:this.getId()+"-bubbleTxt"});this._oBubble2=new a({id:this.getId()+"-bubbleTxt2"});this._oBubble.addStyleClass("sapSuiteUiCommonsDateRangeSliderBubbleLblTxt");this._oBubble2.addStyleClass("sapSuiteUiCommonsDateRangeSliderBubbleLblTxt");this._oBubble.setText(this.getFormattedDate(this.getValueDate()));this._oBubble2.setText(this.getFormattedDate(this.getValue2Date()))}};u.prototype.setVertical=function(t){o.error("DateRangeSliderInternal.setVertical method is not yet supported!");return this};u.prototype.setHeight=function(t){o.error("DateRangeSliderInternal.setHeight method is not yet supported!");return this};u.createRailLabels=function(t){var i=[];var a=t.getTotalUnits();var s=(t.getMax()-t.getMin())/a;for(var r=0;r<=a;r++){var n=Math.round(parseFloat(t.getMin()+r*s));if(n>t.getMax()){n=t.getMax()}var o=null;if(t._sGranularity===g){o=e.incrementDateByIndex(t.getMinDate(),n)}else if(t._sGranularity===f){o=e.incrementMonthByIndex(t.getMinDate(),n)}i[r]=t.getFormattedDate(o)}t.setProperty("labels",i);return i};u.repositionBubbles=function(t){var e=t.getId()+"-grip";var i=e?window.document.getElementById(e):null;var a=i.style.left;var s=a.substring(0,a.length-2);var r=parseInt(s,10);var n=t.getId()+"-grip2";var o=n?window.document.getElementById(n):null;var h=o.style.left;var u=h.substring(0,h.length-2);var p=parseInt(u,10);var g=t.getId()+"-bubble";var f=g?window.document.getElementById(g):null;var b=t.getId()+"-bubble2";var v=b?window.document.getElementById(b):null;var D=null,y=null;var d=f.style.left;if(d){D=d.substring(0,d.length-2)}var c=v.style.left;if(c){y=c.substring(0,c.length-2)}var M=jQuery(f).css("width");var m=parseInt(M,10);var G=41;if(r+m<p||!D&&!y){f.style.left=r-G+"px";v.style.left=p-G+"px"}if(l.getRTL()&&p+m<r){f.style.left=r-G+"px";v.style.left=p-G+"px"}var _=t.getFormattedDate(t.getValueDate());var L=t.getFormattedDate(t.getValue2Date());t._oBubble.setText(_);t._oBubble2.setText(L);if(t.isActive()){t._oBubble.rerender();t._oBubble2.rerender()}};u.prototype.changeGrip=function(t,i,a){n.prototype.changeGrip.apply(this,arguments);if(!isNaN(t)){var s=Math.round(t);var r=null;if(this._sGranularity===g){r=e.incrementDateByIndex(this._dMinDate,s)}else if(this._sGranularity===f){r=e.incrementMonthByIndex(this._dMinDate,s)}a.title=this.getFormattedDate(r)}};u.prototype.setAriaState=function(){var t=this.getFormattedDate(this.getValueDate());var e=this.getFormattedDate(this.getValue2Date());if(this.oMovingGrip===this.oGrip){this.oMovingGrip.setAttribute("aria-valuetext",t);this.oMovingGrip.setAttribute("aria-valuenow",this.getValue());this.oGrip2.setAttribute("aria-valuemin",t)}else{this.oMovingGrip.setAttribute("aria-valuetext",e);this.oMovingGrip.setAttribute("aria-valuenow",this.getValue2());this.oGrip.setAttribute("aria-valuemax",e)}};u.prototype.getFormattedDate=function(t){var e=null;switch(this._sGranularity){case g:e=this._oDateFormat||r.getDateInstance({style:"medium"});break;case f:e=this._oDateFormat||r.getDateInstance({pattern:"MMM YYYY"});break;default:break}return e.format(t)};u.updateLabelBubbleToolTipValues=function(t){if(t._bUsingDefaultLabels){u.createRailLabels(t)}if(t.getShowBubbles()){var e=t.getFormattedDate(t.getValueDate());var i=t.getFormattedDate(t.getValue2Date());t._oBubble.setText(e);t._oBubble2.setText(i)}};u.prototype.getDateFormat=function(){return this._oDateFormat};u.prototype.setDateFormat=function(t){if(t&&t instanceof r){this._oDateFormat=t}else{this._oDateFormat=null}u.updateLabelBubbleToolTipValues(this)};u.prototype.getDateRange=function(){var t=this.getValueDate();var e=this.getValue2Date();var i={valueDate:t,value2Date:e};return i};u.prototype.handleFireChange=function(){if(this.getShowBubbles()){u.repositionBubbles(this)}var t=this.getDateRange();this.fireChange({value:t.valueDate,value2:t.value2Date});this.fireLiveChange({value:t.valueDate,value2:t.value2Date})};u.prototype.handleFireChangeWithoutLive=function(){if(this.getShowBubbles()){u.repositionBubbles(this)}var t=this.getDateRange();this.fireChange({value:t.valueDate,value2:t.value2Date})};u.prototype.fireLiveChangeForGrip=function(t,e,i){if(this.getShowBubbles()&&i!==e){u.repositionBubbles(this)}var a;if(t===this.oGrip){if(i!==e){a=this.getDateRange();this.fireLiveChange({value:a.valueDate,value2:a.value2Date})}}else if(t===this.oGrip2){if(i!==e){a=this.getDateRange();this.fireLiveChange({value:a.valueDate,value2:a.value2Date})}}};u.prototype.onAfterRendering=function(){s.prototype.onAfterRendering.apply(this);if(this.getShowBubbles()){u.repositionBubbles(this)}};u.prototype.onresize=function(t){s.prototype.onresize.apply(this,arguments);if(this.getDomRef()){if(this.getShowBubbles()){u.repositionBubbles(this)}}};u.prototype.setStepLabels=function(t){this.setProperty("stepLabels",t);if(t===true){var e=this.getLabels()&&this.getLabels().length>0;if(!e){u.createRailLabels(this);this._bUsingDefaultLabels=true}}return this};u.prototype.setLabels=function(t){this.setProperty("labels",t);var e=this.getLabels()&&this.getLabels().length>0;if(this.getStepLabels()&&!e){u.createRailLabels(this);this._bUsingDefaultLabels=true}return this};u.prototype.setSmallStepWidth=function(t){this.setProperty("smallStepWidth",Math.round(t));return this};u.prototype.setTotalUnits=function(t){this.setProperty("totalUnits",t);if(this._bUsingDefaultLabels){u.createRailLabels(this)}return this};u.prototype.getMaxDate=function(){var t=null;switch(this._sGranularity){case g:t=e.incrementDateByIndex(this._dMinDate,this.getMax());e.resetDateToEndOfDay(t);break;case f:t=e.incrementMonthByIndex(this._dMinDate,this.getMax());e.resetDateToEndOfMonth(t);break;default:break}return t};u.prototype.setMaxDate=function(t){var i=this.getMinDate();var a=this.getValueDate();var s=this.getValue2Date();var r=false;var n=0,o=0,h=0;switch(this._sGranularity){case g:n=e.numberOfDaysApart(i,t);o=e.numberOfDaysApart(i,a);h=e.numberOfDaysApart(i,s);break;case f:n=e.numberOfMonthsApart(i,t);o=e.numberOfMonthsApart(i,a);h=e.numberOfMonthsApart(i,s);break;default:break}r=o>n||h>n;o=o>n?n:o;h=h>n?n:h;this.setProperty("min",0,true);this.setProperty("max",n,true);this.setProperty("value",o,true);this.setProperty("value2",h,true);if(this._bUsingDefaultLabels){u.createRailLabels(this)}if(r){var l=this.getDateRange();this.fireChange({value:l.valueDate,value2:l.value2Date})}return this};u.prototype.getMinDate=function(){var t=new Date(this._dMinDate);switch(this._sGranularity){case g:e.resetDateToStartOfDay(t);break;case f:e.resetDateToStartOfMonth(t);break;default:break}return t};u.prototype.setMinDate=function(t){var i=this.getMaxDate();var a=this.getValueDate();var s=this.getValue2Date();this._dMinDate=new Date(t);var r=false;var n=0,o=0,h=0;switch(this._sGranularity){case g:n=e.numberOfDaysApart(t,i);o=e.numberOfDaysApart(t,a);h=e.numberOfDaysApart(t,s);break;case f:n=e.numberOfMonthsApart(t,i);o=e.numberOfMonthsApart(t,a);h=e.numberOfMonthsApart(t,s);break;default:break}r=o<0||h<0;o=o<0?0:o;h=h<0?0:h;this.setProperty("min",0,true);this.setProperty("max",n,true);this.setProperty("value",o,true);this.setProperty("value2",h,true);if(this._bUsingDefaultLabels){u.createRailLabels(this)}if(r){var l=this.getDateRange();this.fireChange({value:l.valueDate,value2:l.value2Date})}return this};u.prototype.getValue2Date=function(){var t=null;switch(this._sGranularity){case g:t=e.incrementDateByIndex(this._dMinDate,this.getValue2());e.resetDateToEndOfDay(t);break;case f:t=e.incrementMonthByIndex(this._dMinDate,this.getValue2());e.resetDateToEndOfMonth(t);break;default:break}return t};u.prototype.setValue2Date=function(t){var i=0;switch(this._sGranularity){case g:i=e.numberOfDaysApart(this._dMinDate,t);break;case f:i=e.numberOfMonthsApart(this._dMinDate,t);break;default:break}this.setProperty("value2",i,true);var a=this.getDateRange();this.fireChange({value:a.valueDate,value2:a.value2Date});return this};u.prototype.getValueDate=function(){var t;switch(this._sGranularity){case g:t=e.incrementDateByIndex(this._dMinDate,this.getValue());e.resetDateToStartOfDay(t);break;case f:t=e.incrementMonthByIndex(this._dMinDate,this.getValue());e.resetDateToStartOfMonth(t);break;default:break}return t};u.prototype.setValueDate=function(t){var i=0;switch(this._sGranularity){case g:i=e.numberOfDaysApart(this._dMinDate,t);break;case f:i=e.numberOfMonthsApart(this._dMinDate,t);break;default:break}this.setProperty("value",i,true);var a=this.getDateRange();this.fireChange({value:a.valueDate,value2:a.value2Date});return this};u.prototype.setDayGranularity=function(){var t=this.getMinDate();var i=this.getValueDate();var a=this.getValue2Date();var s=this.getMaxDate();var r=e.numberOfDaysApart(t,i);var n=e.numberOfDaysApart(t,a);var o=e.numberOfDaysApart(t,s);this.setProperty("min",0,true);this.setProperty("value",r,true);this.setProperty("value2",n,true);this.setProperty("max",o,true);this._sGranularity=g;if(this._bUsingDefaultLabels){u.createRailLabels(this)}var h=this.getDateRange();this.fireChange({value:h.valueDate,value2:h.value2Date});return this};u.prototype.setMonthGranularity=function(){var t=this.getMinDate();var i=this.getValueDate();var a=this.getValue2Date();var s=this.getMaxDate();var r=e.numberOfMonthsApart(t,i);var n=e.numberOfMonthsApart(t,a);var o=e.numberOfMonthsApart(t,s);this.setProperty("min",0,true);this.setProperty("value",r,true);this.setProperty("value2",n,true);this.setProperty("max",o,true);this._sGranularity=f;e.resetDateToStartOfMonth(this._dMinDate);if(this._bUsingDefaultLabels){u.createRailLabels(this)}var h=this.getDateRange();this.fireChange({value:h.valueDate,value2:h.value2Date});return this};u.prototype.handleMove=function(t){if(this.oMovingGrip===this.oGrip2&&!this.getPinGrip2()||this.oMovingGrip===this.oGrip&&!this.getPinGrip()){s.prototype.handleMove.apply(this,[t])}};u.prototype.onsapend=function(t){if(this.oMovingGrip===this.oGrip2&&!this.getPinGrip2()||this.oMovingGrip===this.oGrip&&!this.getPinGrip()){s.prototype.onsapend.apply(this,[t])}};u.prototype.onsaphome=function(t){if(this.oMovingGrip===this.oGrip2&&!this.getPinGrip2()||this.oMovingGrip===this.oGrip&&!this.getPinGrip()){s.prototype.onsaphome.apply(this,[t])}};u.prototype.onsaprightmodifiers=function(t){if(this.oMovingGrip===this.oGrip2&&!this.getPinGrip2()||this.oMovingGrip===this.oGrip&&!this.getPinGrip()){s.prototype.onsaprightmodifiers.apply(this,[t])}};u.prototype.onsapleftmodifiers=function(t){if(this.oMovingGrip===this.oGrip2&&!this.getPinGrip2()||this.oMovingGrip===this.oGrip&&!this.getPinGrip()){s.prototype.onsapleftmodifiers.apply(this,[t])}};u.prototype.onsapright=function(t){if(this.oMovingGrip===this.oGrip2&&!this.getPinGrip2()||this.oMovingGrip===this.oGrip&&!this.getPinGrip()){s.prototype.onsapright.apply(this,[t])}};u.prototype.onsapleft=function(t){if(this.oMovingGrip===this.oGrip2&&!this.getPinGrip2()||this.oMovingGrip===this.oGrip&&!this.getPinGrip()){s.prototype.onsapleft.apply(this,[t])}};u.prototype.onclick=function(t){var e=this.oMovingGrip;if(this.getEditable()&&this.getEnabled()){var i;var a=t.target.getAttribute("ID");var s=this.getValue();var r=this.getOffsetLeft(this.oGrip)+this.iShiftGrip;switch(a){case this.oBar.id:case this.oHiLi.id:if(this.getVertical()){i=this.getBarWidth()-this.getOffsetX(t)}else{i=this.getOffsetX(t)}if(a===this.oHiLi.id){if(this.getVertical()){i-=this.getOffsetLeft(this.oHiLi)}else{i+=this.getOffsetLeft(this.oHiLi)}}s=this.convertRtlValue(this.getMin()+(this.getMax()-this.getMin())/this.getBarWidth()*i);r=this.getOffsetX(t);if(a===this.oHiLi.id){r+=this.getOffsetLeft(this.oHiLi)}if(this.oStartTarget&&this.targetIsGrip(this.oStartTarget.id)){e=this.oStartTarget}else if(this.targetIsGrip(a)){e=t.target}else{e=this.getNearestGrip(r)}break;case this.getId()+"-left":r=0;if(this.getVertical()){s=this.getMax();e=this.getRightGrip()}else{s=this.getMin();e=this.getLeftGrip()}break;case this.getId()+"-right":r=this.getBarWidth();if(!this.getVertical()){s=this.getMax();e=this.getRightGrip()}else{s=this.getMin();e=this.getLeftGrip()}break;default:if(this.targetIsGrip(a)){return}var n=a.search("-tick");if(n>=0){var o=parseInt(a.slice(this.getId().length+5),10);r=this.fTickDist*o;s=this.convertRtlValue(this.getMin()+(this.getMax()-this.getMin())/this.getTotalUnits()*o);if(this.oStartTarget&&this.targetIsGrip(this.oStartTarget.id)){e=this.oStartTarget}else if(this.targetIsGrip(a)){e=t.target}else{e=this.getNearestGrip(r)}break}var h=jQuery(this.oBar).offset();var l=jQuery(t.target).offset();if(this.getVertical()){r=this.getOffsetX(t)-(h.top-l.top)}else{r=this.getOffsetX(t)-(h.left-l.left)}if(r<=0){r=0;if(this.getVertical()){s=this.getMax()}else{s=this.getMin()}}else if(r>=this.getBarWidth()){r=this.getBarWidth();if(this.getVertical()){s=this.getMin()}else{s=this.getMax()}}else{if(this.getVertical()){i=this.getBarWidth()-r}else{i=r}s=this.getMin()+(this.getMax()-this.getMin())/this.getBarWidth()*i}s=this.convertRtlValue(s);if(this.oStartTarget&&this.targetIsGrip(this.oStartTarget.id)){e=this.oStartTarget}else if(this.targetIsGrip(a)){e=t.target}else{e=this.getNearestGrip(r)}break}if(e===this.oGrip2&&this.getPinGrip2()||e===this.oGrip&&this.getPinGrip()){return}var u=this.validateNewPosition(s,r,e,this.getValueForGrip(e)>s);s=u.fNewValue;r=u.iNewPos;this.changeGrip(s,r,e);this.handleFireChange()}e.focus();this.oMovingGrip=e;this.oStartTarget=null};u.prototype.onkeydown=function(t){this.oMovingGrip.setAttribute("aria-busy","true")};u.prototype.onkeyup=function(t){this.oMovingGrip.setAttribute("aria-busy","false")};return u});
//# sourceMappingURL=DateRangeSliderInternal.js.map