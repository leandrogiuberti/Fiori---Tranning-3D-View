/*
 * 
		SAP UI development toolkit for HTML5 (SAPUI5)
		(c) Copyright 2009-2015 SAP SE. All rights reserved
	
 */
sap.ui.define(["sap/ui/thirdparty/jquery","./library","./ProcessFlowLaneHeader","./AriaProperties","sap/ui/Device","sap/base/security/encodeXML","sap/ui/core/Element","sap/ui/core/Core","sap/ui/core/Lib","sap/ui/core/InvisibleText"],function(jQuery,e,t,o,r,n,a,s,l,i){"use strict";var d=e.ProcessFlowZoomLevel;var c={apiVersion:2};c.render=function(e,t){var o=this._getZoomStyleClass(t),r,a,s,d=c,p,g;if(!this._oResBundle){this._oResBundle=l.getResourceBundleFor("sap.suite.ui.commons")}if(!t._oInvisibleText){t._oInvisibleText=new i;t._oInvisibleText.toStatic();t._oInvisibleText.setText(this._oResBundle.getText("PF_ARIA_PROCESS_FLOW_NODE_DESC"))}g=d._renderBasicStructure(e,t);if(g){return}try{r=t._getOrCreateProcessFlow();a=t._getOrCreateLaneMap();p=t._getConnectionsMap()}catch(e){t._handleException(e);return}e.openStart("table");e.attr("id",t.getId()+"-table");e.attr("aria-label",t._getAriaText());e.class("sapSuiteUiCommonsPF");e.class(n(o));e.openEnd();s=Object.keys(a).length;d._renderTableHeader(e,t,a,s);d._renderTableBody(e,t,s,r,p);e.close("table");e.close("div");e.close("div");this._writeCounter(e,t,"Right");e.renderControl(t._getScrollingArrow("right"));e.close("div")};c._renderNormalNodeHeader=function(e,o,r,n,a){e.openStart("th").attr("scope","colgroup").attr("colspan","3").attr("id",o.getId()+"-colgroup"+n).openEnd();e.renderControl(r);e.close("th");if(n<a-1){e.openStart("th").attr("scope","colgroup").attr("colspan","2").attr("id",o.getId()+"-separator"+n).openEnd();var s=t.createNewProcessSymbol(o._isHeaderMode());s.attachPress(o.ontouchend.bind(o));e.renderControl(s);e.close("th")}};c._renderMergedNodeHeader=function(e,o,r,n,a,s){var l=o._mergeLaneIdNodeStates(a);r.setState(l);n++;var i=n*3+(n-1)*2;e.openStart("th").attr("scope","colgroup").attr("colspan",i).attr("id",o.getId()+"-colgroup"+i).openEnd();e.renderControl(r);e.close("th");if(s){e.openStart("th").attr("scope","colgroup").attr("colspan","2").openEnd();var d=t.createNewProcessSymbol(o._isHeaderMode());d.attachPress(o.ontouchend.bind(o));e.renderControl(d);e.close("th")}};c._renderNode=function(e,t,r,n){if(n){var a=r.getId()+"-node";var s=r._getCurrentZoomLevelContent();e.attr("id",a);e.attr("tabindex",0);e.attr("aria-describedby",t._oInvisibleText.getId());var l={};l.label=r._getAriaText();if(s){l.labelledBy=a+" "+s.getId()}o.writeAriaProperties(e,l,r.getAriaProperties());e.openEnd();n=false}r._setParentFlow(t);r._setZoomLevel(t.getZoomLevel());r._setFoldedCorner(t.getFoldedCorners());e.renderControl(r);return n};c._renderConnection=function(e,t,o,r){if(r){if(o.getAggregation("_labels")&&o.getAggregation("_labels").length>0){e.attr("tabindex",0)}e.openEnd();e.openStart("span").class("sapUiPseudoInvisibleText").openEnd();e.text(this._oResBundle.getText("PF_ARIA_PROCESS_FLOW_EMPTY_NODE_DESC"));e.close("span");r=false}o.setZoomLevel(t.getZoomLevel());t.addAggregation("_connections",o);e.renderControl(o);return r};c._renderTableHeader=function(e,o,r,n){var a,s=null,l=null,i,d;e.openStart("thead");e.attr("id",o.getId()+"-thead");e.openEnd();e.openStart("tr");e.class("sapSuiteUiCommonsPFHeader");e.class("sapSuiteUiCommonsPFHeaderHidden");if(o.getShowLabels()){e.class("sapSuiteUiPFWithLabel")}e.openEnd();e.openStart("th").openEnd().close("th");a=0;while(a<n-1){e.openStart("th").openEnd().close("th");e.openStart("th").openEnd().close("th");e.openStart("th").openEnd().close("th");e.openStart("th").openEnd().close("th");e.openStart("th").openEnd().close("th");a++}e.openStart("th").openEnd().close("th");e.openStart("th").openEnd().close("th");e.openStart("th").openEnd().close("th");e.openStart("th").openEnd().close("th");e.close("tr");e.openStart("tr");e.class("sapSuiteUiCommonsPFHeaderRow");e.openEnd();e.openStart("th").attr("scope","col").attr("id",o.getId()+"-colstart").openEnd();i=t.createNewStartSymbol(o._isHeaderMode());e.renderControl(i);e.close("th");a=0;var c=0;var p=[];var g="#";d=false;while(a<n-1){s=r[a];l=r[a+1];if(s.getLaneId()+g===l.getLaneId()){c=c+1;p.push(s.getState())}else if(c===0){this._renderNormalNodeHeader(e,o,s,a,n)}else{p.push(s.getState());d=true;this._renderMergedNodeHeader(e,o,s,c,p,d);p=[];c=0}a++}if(c===0){if(!l){l=r[0]}this._renderNormalNodeHeader(e,o,l,a,n)}else{p.push(l.getState());d=false;this._renderMergedNodeHeader(e,o,s,c,p,d);c=0}e.openStart("th").attr("scope","col").attr("id",o.getId()+"-colend").openEnd();i=t.createNewEndSymbol(o._isHeaderMode());e.renderControl(i);e.close("th");e.close("tr");e.close("thead")};c._renderTableBody=function(e,t,o,n,a){var s,l,i,d,p;var g=c._checkIfHighlightedOrSelectedNodesExists(a);e.openStart("tbody").openEnd();i=n.length;if(i>0){e.openStart("tr").openEnd();e.openStart("td");e.attr("colspan",(o*5).toString());e.openEnd();e.openStart("span").class("sapUiPseudoInvisibleText").openEnd();e.text(this._oResBundle.getText("PF_ARIA_PROCESS_FLOW_EMPTY_NODE_DESC"));e.close("span");e.close("td");e.close("tr")}s=0;while(s<i){e.openStart("tr").openEnd();e.openStart("td").openEnd();e.openStart("span").class("sapUiPseudoInvisibleText").openEnd();e.text(this._oResBundle.getText("PF_ARIA_PROCESS_FLOW_EMPTY_NODE_DESC"));e.close("span");e.close("td");d=n[s].length;l=0;while(l<d-1){p=n[s][l];var u=true;if(l==0||l%2){e.openStart("td")}else{e.openStart("td").attr("colspan","4");if(r.browser.chrome){e.class("sapSuiteUiCommonsProcessFlowZIndexForConnectors")}}if(p){if(p.getMetadata().getName()==="sap.suite.ui.commons.ProcessFlowNode"){u=c._renderNode(e,t,p,u)}else{p._setShowLabels(t.getShowLabels());c._setLabelsInConnection(n,a,p,{row:s,column:l},t,g);u=c._renderConnection(e,t,p,u)}}if(u){e.openEnd();e.openStart("span").class("sapUiPseudoInvisibleText").openEnd();e.text(this._oResBundle.getText("PF_ARIA_PROCESS_FLOW_EMPTY_NODE_DESC"));e.close("span")}e.close("td");l++}e.openStart("td").openEnd();e.openStart("span").class("sapUiPseudoInvisibleText").openEnd();e.text(this._oResBundle.getText("PF_ARIA_PROCESS_FLOW_EMPTY_NODE_DESC"));e.close("span");e.close("td");e.openStart("td").openEnd();e.openStart("span").class("sapUiPseudoInvisibleText").openEnd();e.text(this._oResBundle.getText("PF_ARIA_PROCESS_FLOW_EMPTY_NODE_DESC"));e.close("span");e.close("td");e.close("tr");s++}e.close("tbody")};c._renderBasicStructure=function(e,t){e.openStart("div",t);var r={};r.label=t._getAriaText();o.writeAriaProperties(e,r,t.getAriaProperties());e.class("sapSuiteUiPFContainer");if(t._arrowScrollable){e.class("sapPFHScrollable");if(t._bPreviousScrollForward){e.class("sapPFHScrollForward")}else{e.class("sapPFHNoScrollForward")}if(t._bPreviousScrollBack){e.class("sapPFHScrollBack")}else{e.class("sapPFHNoScrollBack")}}else{e.class("sapPFHNotScrollable")}e.openEnd();this._writeCounter(e,t,"Left");e.renderControl(t._getScrollingArrow("left"));e.openStart("div");e.attr("id",t.getId()+"-scrollContainer");e.attr("role","region");e.attr("aria-roledescription","Process Flow");e.class("sapSuiteUiScrollContainerPF");e.class("sapSuiteUiDefaultCursorPF");e.openEnd();e.openStart("div");e.attr("id",t.getId()+"-scroll-content");e.attr("tabindex",0);e.openEnd();if(!t.getLanes()||t.getLanes().length==0){e.close("div");e.close("div");e.close("div");return true}return false};c._getZoomStyleClass=function(e){switch(e.getZoomLevel()){case d.One:return"sapSuiteUiCommonsPFZoomLevel1";case d.Two:return"sapSuiteUiCommonsPFZoomLevel2";case d.Three:return"sapSuiteUiCommonsPFZoomLevel3";case d.Four:return"sapSuiteUiCommonsPFZoomLevel4";default:break}};c._setLabelsInConnection=function(e,t,o,r,n,a){for(var s=0;s<t.length;s++){var l=t[s];if(l&&l.label){for(var i=0;i<l.connectionParts.length;i++){var d=l.connectionParts[i];if(d.x===r.column&&d.y===r.row){if(e[r.row][r.column+1]&&e[r.row][r.column+1].getMetadata().getName()==="sap.suite.ui.commons.ProcessFlowNode"&&e[r.row][r.column+1].getNodeId()===l.targetNode.getNodeId()){c._setLineTypeInLabel(l,a);if(n._bHighlightedMode&&!l.label._getHighlighted()){l.label.setEnabled(false)}if(l.label.getEnabled()){if(l.label.hasListeners("press")){l.label.detachEvent("press",n._handleLabelClick,n)}l.label.attachPress(n._handleLabelClick,n)}o.addAggregation("_labels",l.label,true)}}}}}};c._setLineTypeInLabel=function(e,t){var o=false,r,n=false,s=false;if(e.sourceNode.getSelected()&&e.targetNode.getSelected()){o=true;e.label._setSelected(true)}else{e.label._setSelected(false)}r=e.targetNode;if(r.getHighlighted()){var l=r.getParents(),i;for(var d=0;d<l.length;d++){i=a.getElementById(l[d]);if(i.getHighlighted()){n=true;break}}}if(n){s=true;e.label._setHighlighted(true)}else{e.label._setHighlighted(false)}if(t&&!o&&!s){e.label._setDimmed(true)}else{e.label._setDimmed(false)}};c._checkIfHighlightedOrSelectedNodesExists=function(e){var t=false;for(var o=0;o<e.length;o++){var r=e[o];if(r.label){if(r.sourceNode.getSelected()&&r.targetNode.getSelected()||r.sourceNode.getHighlighted()&&r.targetNode.getHighlighted()){t=true}}}return t};c._writeCounter=function(e,t,o){e.openStart("span");e.attr("id",t.getId()+"-counter"+o);e.class("suiteUiPFHCounter");e.class(n("suiteUiPFHCounter"+o));e.openEnd();e.text("0");e.close("span")};return c},true);
//# sourceMappingURL=ProcessFlowRenderer.js.map