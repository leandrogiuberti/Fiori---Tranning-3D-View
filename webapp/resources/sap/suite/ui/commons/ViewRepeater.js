/*!
 * 
		SAP UI development toolkit for HTML5 (SAPUI5)
		(c) Copyright 2009-2015 SAP SE. All rights reserved
	
 */
sap.ui.define(["sap/ui/thirdparty/jquery","./library","sap/ui/commons/library","sap/ui/commons/RowRepeater","sap/ui/commons/SegmentedButton","sap/ui/commons/SearchField","sap/ui/commons/Button","sap/ui/base/ManagedObject","sap/ui/core/ResizeHandler","./ViewRepeaterRenderer","sap/ui/core/Lib","sap/base/i18n/Localization"],function(jQuery,e,t,i,s,r,o,n,a,h,g,d){"use strict";var u=i.extend("sap.suite.ui.commons.ViewRepeater",{metadata:{deprecated:true,library:"sap.suite.ui.commons",properties:{itemMinWidth:{type:"int",group:"Misc",defaultValue:null},responsive:{type:"boolean",group:"Misc",defaultValue:false},defaultViewIndex:{type:"int",group:"Misc",defaultValue:0},showSearchField:{type:"boolean",group:"Misc",defaultValue:true},showViews:{type:"boolean",group:"Misc",defaultValue:true},external:{type:"boolean",group:"Misc",defaultValue:false},itemHeight:{type:"int",group:"Misc",defaultValue:null},height:{type:"sap.ui.core.CSSSize",group:"Misc",defaultValue:"100%"}},aggregations:{views:{type:"sap.suite.ui.commons.RepeaterViewConfiguration",multiple:true,singularName:"view"}},associations:{externalRepresentation:{type:"sap.ui.core.Control",multiple:false}},events:{search:{parameters:{query:{type:"string"}}},changeView:{parameters:{oldViewIndex:{type:"int"},newViewIndex:{type:"int"},filterId:{type:"string"},sorterId:{type:"string"},page:{type:"int"}}}}}});u.prototype.init=function(){this._rb=g.getResourceBundleFor("sap.suite.ui.commons");this.addStyleClass("suiteUiVr");i.prototype.init.call(this);this._oSegBtn=new s({id:this.getId()+"-segBtn"});this._repopulateViewSelector();this._oSearchField=new r({id:this.getId()+"-searchFld",enableFilterMode:true,enableListSuggest:false,search:function(e){this.fireSearch({query:e.getParameter("query")})}.bind(this)});this.attachFilter(function(e){this._currentFilterId=e.getParameter("filterId")});this.attachSort(function(e){this._currentSorterId=e.getParameter("sorterId")})};u.prototype.setDefaultViewIndex=function(e){this.setProperty("defaultViewIndex",e);this._selectDefaultView();return this};u.prototype._selectDefaultView=function(){var e=this.getDefaultViewIndex();if(e===this._currentViewIndex){return}var t=this.getViews()||[];if(t.length>0){if(e>=t.length){e=t.length-1}this.selectView(e);var i=this.getId()+"-"+t[e].getId()+"-triggerBtn";this._oSegBtn.setSelectedButton(i)}};u.prototype._repopulateViewSelector=function(){var e=this;var t=e._oSegBtn.removeAllAggregation("buttons",true);jQuery.each(t,function(e,t){t.destroy()});var i=this.getViews()||[];for(var s=0;s<i.length;s++){var r=i[s];if(r.getExternal()){var n=r.getExternalRepresentation();if(!n.getModel()){n.setModel(this.getModel())}}var a=new o({id:this.getId()+"-"+r.getId()+"-triggerBtn",text:r.getTitle()||(r.getIcon()?undefined:this._rb.getText("VIEWREPEATER_TAB_DEFAULT_NAME",[s+1])),icon:r.getIcon(),iconHovered:r.getIconHovered(),iconSelected:r.getIconSelected(),tooltip:r.getTooltip(),lite:true});e._oSegBtn.addButton(a);a.attachPress(r,function(t,i){e.selectView(i);e._oSegBtn.rerender()})}this._selectDefaultView()};u.prototype.setModel=function(e,t){n.prototype.setModel.call(this,e,t);this._repopulateViewSelector();return this};u.prototype.addView=function(e){this.addAggregation("views",e);this._repopulateViewSelector();return this};u.prototype.removeAllViews=function(){var e=this.removeAllAggregation("views");this._repopulateViewSelector();return e};u.prototype.insertView=function(e,t){this.insertAggregation("views",e,t);this._repopulateViewSelector();return this};u.prototype.removeView=function(e){var t=this.removeAggregation("views",e);this._repopulateViewSelector();return t};u.prototype.selectView=function(e){var t,i=0;switch(typeof e){case"number":{t=this.getViews()[e];i=e;break}case"object":{var s=this.getViews().length;for(var r=0;r<s;r++){if(e.getId()===this.getViews()[r].getId()){t=e;i=r;break}}}default:break}if(!t){return}var o=t.getResponsive();if(typeof o==="boolean"){this.setResponsive(o)}var n=t.getItemMinWidth();if(typeof n==="number"&&n>0&&n!==this.setItemMinWidth()){this.setItemMinWidth(n)}var a=t.getItemHeight();if(a!==this.getItemHeight()&&a>0){this.setItemHeight(a)}if(t.getNumberOfTiles()>0&&t.getNumberOfTiles()!==this.setNumberOfRows()){this.setNumberOfRows(t.getNumberOfTiles())}var h=t.getExternal();if(h===true){this.setExternal(true);this.setExternalRepresentation(t.getExternalRepresentation())}else{this.setExternal(false);this.setExternalRepresentation(null)}var g=this.getCurrentPage();var d=t.getPath();var u=t.getTemplate();if(d&&u){this.bindRows(d,u);this._applyFilter(this._currentFilterId);this._applySorter(this._currentSorterId)}if(this._currentViewIndex||i!==this._currentViewIndex){this.fireChangeView({newViewIndex:i,oldViewIndex:this._currentViewIndex,filterId:this._currentFilterId,sorterId:this._currentSorterId,page:g})}this._currentViewIndex=i;this._oView=t};u.prototype._applyFilter=function(e,t){if(e){if(!t){t=this.getBinding("rows")}var i=this.getFilters();var s;var r=i.length;for(var o=0;o<r;o++){if(i[o].getId()===e){s=i[o];break}}if(s){t.filter(s.getFilters())}}};u.prototype._applySorter=function(e,t){if(e){if(!t){t=this.getBinding("rows")}var i;var s=this.getSorters();var r=s.length;for(var o=0;o<r;o++){if(s[o].getId()===e){i=s[o];break}}if(i){t.sort(i.getSorter())}}};u.prototype.onBeforeRendering=function(){if(this.getResponsive()&&this.getShowMoreSteps()===0){if(!this._bInit){this.setNumberOfRows(0)}}else if(this._oView&&this._oView.getNumberOfTiles()>0&&this._oView.getNumberOfTiles()!==this.getNumberOfRows()&&!this.getResponsive()){this.setNumberOfRows(this._oView.getNumberOfTiles())}this._bInit=false};u.prototype._updateBodyPosition=function(){var e=jQuery("#"+this.getId()+">div.suiteUiVrViewSwHolder").outerHeight();var t=jQuery("#"+this.getId()+">div.sapUiRrPtb").outerHeight();var i=jQuery("#"+this.getId()+">div.sapUiRrStb").outerHeight();var s=jQuery("#"+this.getId()+">div.sapUiRrFtr").outerHeight();var r=jQuery(document.getElementById(this.getId()+"-body"));r.css("top",e+t+i+3+"px");r.css("bottom",s+"px")};u.prototype.onAfterRendering=function(){this._computeWidths(true);a.deregister(this._sResizeListenerId);if(this.getResponsive()){if(this.getShowMoreSteps()===0){jQuery("#"+this.getId()+">div.sapUiRrFtr").hide()}setTimeout(function(){this._sResizeListenerId=a.register(this.getId()+"-body"?window.document.getElementById(this.getId()+"-body"):null,this._handleResize.bind(this));if(this.getShowMoreSteps()===0){this._updateBodyPosition()}}.bind(this),100)}};u.prototype._handleResize=function(){if(!this.getDomRef()){return}this._computeWidths();if(this.getResponsive()&&this.getShowMoreSteps()===0){var e=jQuery(document.getElementById(this.getId()+"-body"));var t=e.height();var i=this._itemsPerRow;var s=Math.floor(t/(this.getItemHeight()+3));var r=s*i;if(r!==this.getNumberOfRows()){this._bInit=true;this.setNumberOfRows(r)}else{jQuery("#"+this.getId()+">div.sapUiRrFtr").show()}}};u.prototype._computeWidths=function(e){var t=this;var i=this.$();var s=t.getItemMinWidth();var r=this.getResponsive()===true?Math.floor(i.width()/s):1;var o=Math.floor(100/r);if(i.width()*o/100<s){r--;o=Math.floor(100/r)}if(e||t._height!==i.height()||t._itemsPerRow!==r){jQuery("#"+this.getId()+" .sapUiRrBody").css("width","100%");var n=100-r*o;var a;jQuery("#"+this.getId()+" .sapUiRrBody li").each(function(e){a=o;if(e%r<n){a++}jQuery(this).css("width",a+"%");jQuery(this).css("margin","0")});t._height=i.height();t._itemsPerRow=r;t._percentWidth=o}};u.prototype.startPagingAnimation=function(){a.deregister(this._sResizeListenerId);var e=sap.ui.getCore(),t=e.getRenderManager(),i=this.getId(),s=this.iPreviousPage,r=this.getCurrentPage(),o=this.getNumberOfRows(),n=(r-1)*o,h=this.getRows(),g=this._getRowCount()>o*r?o:this._getRowCount()-o*(r-1),u,l,p,c=this.getBinding("rows");var f,w=jQuery(i+"-page_"+s?window.document.getElementById(i+"-page_"+s):null),m=i+"-body"?window.document.getElementById(i+"-body"):null,v=jQuery(m);v.css("height",v.outerHeight()+"px");var _;if(d.getRTL()){_=r<s?"left":"right"}else{_=r<s?"right":"left"}if(c){this._bSecondPage=!this._bSecondPage;this.updateRows(true);h=this.getRows();n=(this._bSecondPage?1:0)*o}jQuery('<ul id="'+i+"-page_"+r+'" class="sapUiRrPage"></ul>').css("top",w.outerHeight(true)+"px").css(_,w.outerWidth(true)+"px").appendTo(m);var y=m.lastChild;var I=jQuery(y);var R=100-this._itemsPerRow*this._percentWidth;for(u=n,l=0;u<n+g;u++,l++){p=this._percentWidth;if(l%this._itemsPerRow<R){p++}jQuery('<li id="'+i+"-row_"+u+'" class="sapUiRrRow"></li>').css("width",p+"%").appendTo(y);f=y.lastChild;t.render(h[u],f)}if(_==="right"){w.animate({right:-w.outerWidth(true)},"slow");I.animate({right:0},"slow")}else{w.animate({left:-w.outerWidth(true)},"slow");I.animate({left:0},"slow")}v.animate({height:I.outerHeight(true)},"slow",this.endPagingAnimation.bind(this))};u.prototype.endPagingAnimation=function(){i.prototype.endPagingAnimation.call(this);this._sResizeListenerId=a.register(this.getId()+"-body"?window.document.getElementById(this.getId()+"-body"):null,this._handleResize.bind(this))};u.prototype.exit=function(){this._oSegBtn.destroy();this._oSearchField.destroy();a.deregister(this._sResizeListenerId)};return u});
//# sourceMappingURL=ViewRepeater.js.map