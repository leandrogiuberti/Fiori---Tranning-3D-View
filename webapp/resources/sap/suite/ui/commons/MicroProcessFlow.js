/*!
 * 
		SAP UI development toolkit for HTML5 (SAPUI5)
		(c) Copyright 2009-2015 SAP SE. All rights reserved
	
 */
sap.ui.define(["sap/ui/thirdparty/jquery","./library","sap/ui/core/Control","sap/ui/core/Icon","sap/ui/core/delegate/ItemNavigation","sap/ui/core/ResizeHandler","sap/ui/core/Lib","sap/base/i18n/Localization","sap/ui/core/Theming"],function(jQuery,t,e,i,s,o,r,n,l){"use strict";var a=t.MicroProcessFlowRenderType;var c=r.getResourceBundleFor("sap.suite.ui.commons");var h=function(t){return t[t.length-1]};var p=e.extend("sap.suite.ui.commons.MicroProcessFlow",{metadata:{library:"sap.suite.ui.commons",interfaces:["sap.ui.core.IFormContent"],properties:{ariaLabel:{type:"string",defaultValue:null},renderType:{type:"sap.suite.ui.commons.MicroProcessFlowRenderType",defaultValue:sap.suite.ui.commons.MicroProcessFlowRenderType.Wrap},width:{type:"sap.ui.core.CSSSize",defaultValue:""}},aggregations:{content:{type:"sap.suite.ui.commons.MicroProcessFlowItem",multiple:true,singularName:"content"}}},renderer:{apiVersion:2,render:function(t,e){var i=e.getContent(),s=e.getWidth(),o=i.length,r=e.getAriaLabel();if(!e._bThemeApplied){return}t.openStart("div",e);t.attr("role","listbox");t.attr("aria-roledescription",c.getText("ACC_CTR_TYPE_MICRO_PROCESS_FLOW"));t.attr("aria-label",r);if(s){t.style("width",s)}t.class("sapSuiteUiCommonsMicroProcessFlow");t.openEnd();if(e._hasScrolling()){t.openStart("div");t.attr("tabindex","-1");t.attr("id",e.getId()+"-leftscroller");t.class("sapSuiteUiCommonsMicroProcessFlowScroller").class("sapSuiteUiCommonsMicroProcessFlowLeftScroller");t.openEnd();t.renderControl(e._getLeftScroller());t.openStart("span");t.attr("id",e.getId()+"-leftlabel");t.class("sapSuiteUiCommonsMicroProcessFlowLeftLabel");t.openEnd();t.close("span");t.close("div")}t.openStart("div");t.attr("id",e.getId()+"-content");t.class("sapSuiteUiCommonsMicroProcessFlowContent");t.openEnd();t.openStart("div");t.attr("id",e.getId()+"-scrolling");t.class("sapSuiteUiCommonsMicroProcessFlowScrolling").class("sapSuiteUiCommonsMicroProcessFlowScrollingTransition");if(e.getRenderType()===a.Wrap){t.style("flex-wrap","wrap")}t.openEnd();i.forEach(function(e,i){e._setAccessibilityData(i+1,o);t.renderControl(e)});t.close("div");t.close("div");if(e._hasScrolling()){t.openStart("div");t.attr("id",e.getId()+"-rightscroller");t.attr("tabindex","-1");t.class("sapSuiteUiCommonsMicroProcessFlowScroller").class("sapSuiteUiCommonsMicroProcessFlowRightScroller");t.openEnd();t.openStart("span");t.attr("id",e.getId()+"-rightlabel");t.class("sapSuiteUiCommonsMicroProcessFlowRightLabel");t.openEnd();t.close("span");t.renderControl(e._getRightScroller());t.close("div")}t.close("div")}}});p.prototype.exit=function(){if(this._oLeftScroller){this._oLeftScroller.destroy()}if(this._oRightScroller){this._oRightScroller.destroy()}};p.prototype.init=function(){l.attachApplied(function(){this._bThemeApplied=true;this.invalidate()}.bind(this));this._iScrollingIndex=0;this._iLastVisibleIndex=0;this._aEdges=[];this._aWidths=[];this._aSeperatorWidth=[]};p.prototype.onAfterRendering=function(){this._correctSeparatorWidth();this._setupKeyboard();if(this._hasScrolling()){this._setupScrolling();this._collectEdgesAndWidths();this._updateScrollingElements();if(this.getRenderType()===a.ScrollingWithResizer){this._oResizer=o.register(this,this._performResizeChanges.bind(this))}}};p.prototype._performResizeChanges=function(){this._collectEdgesAndWidths();this._updateScrollingElements()};p.prototype._isLastItem=function(t){return t===this.getContent()[this.getContent().length-1]};p.prototype._getMaxHeight=function(t){return Math.max.apply(null,this.$().find(".sapSuiteUiCommonsMicroProcessFlowItemWrapper").map(function(){return jQuery(this).height()}).get())};p.prototype._correctSeparatorWidth=function(){var t=this._getMaxHeight();if(t){this.getContent().forEach(function(e){var i=e.getStepWidth(),s;if(i.indexOf("%")!==-1){s=parseInt(i,10);if(!isNaN(s)){e.$("separator").width(t/s*100)}}},this)}};p.prototype._firePress=function(t){if(this._oItemNavigation){var e=this._oItemNavigation.getFocusedIndex(),i=this.getContent()[e];if(i){i._firePress(t)}}};p.prototype._setupKeyboard=function(){var t=this.getDomRef(),e=this.getContent(),i=[];e.forEach(function(t,e){var s=t._getAccessibleItem();i.push(s[0])});if(!this._oItemNavigation){this._oItemNavigation=new s;this.addDelegate(this._oItemNavigation)}this._oItemNavigation.setRootDomRef(t);this._oItemNavigation.setItemDomRefs(i);this._oItemNavigation.setCycling(false);this._oItemNavigation.attachEvent(s.Events.AfterFocus,function(t){if(this._bKeyBoard===true){this._findEdgeItems(t.getParameter("index"));this._updateScrollingElements()}this._bKeyBoard=false}.bind(this))};p.prototype._hasScrolling=function(){var t=this.getRenderType();return t===a.Scrolling||t===a.ScrollingWithResizer};p.prototype._setupScrolling=function(){var t=this.$("leftscroller"),e=this.$("rightscroller");this._iScrollingIndex=0;this._iLastVisibleIndex=0;t.off("click").on("click",this._scroll.bind(this,-1));e.off("click").on("click",this._scroll.bind(this,1));this._iScrollingIndex<=0?t.hide():t.show()};p.prototype._updateScrollingElements=function(t){var e=this.getContent(),i=this.$("leftscroller"),s=this.$("rightscroller");i[this._iScrollingIndex<=0?"hide":"show"]();this._iLastVisibleIndex=this._findLastVisibleItemIndex(t);s[this._iLastVisibleIndex>=e.length-1?"hide":"show"]();this.$("leftlabel").text(this._iScrollingIndex);this.$("rightlabel").text(e.length-1-this._iLastVisibleIndex)};p.prototype._scroll=function(t,e){e.stopPropagation();var i=this.$("rightscroller"),s=this.$("leftscroller"),o=n.getRTL(),r,l,a;var c=function(){if(t>0){var e=this.$("content").width()-(s.is(":visible")?0:s.width()),o=h(this._aEdges)+h(this._aWidths);if(r+e>o){r-=r+e-o+i.width();for(var n=0;n<this._aEdges;n++){if(this._aEdges[n]+this._aWidths[n]>r){this._iScrollingIndex=n;break}}}}}.bind(this);var p=function(){if(!o&&g[0].scrollLeft!=0){this._clearScroll(g)}if(o){a=g.scrollRightRTL();if(a){this._clearScroll(g)}}}.bind(this);var d=this.$("scrolling"),g=d.parent();this._bKeyBoard=false;if(t<0&&this._iScrollingIndex<=0){return}p();t<0?i.show():s.show();this._iScrollingIndex+=t;r=this._aEdges[this._iScrollingIndex];c();l="translateX("+(o?1:-1)*r+"px)";this.$("scrolling").css("transform",l);if(!d.hasClass("sapSuiteUiCommonsMicroProcessFlowScrollingTransition")){setTimeout(function(){d.addClass("sapSuiteUiCommonsMicroProcessFlowScrollingTransition")},0)}this._updateScrollingElements(t);p()};p.prototype._clearScroll=function(t){var e=n.getRTL();if(t&&t[0]){e?t.scrollLeftRTL(t[0].scrollWidth-t[0].clientWidth):t[0].scrollLeft=0}};p.prototype._findLastVisibleItemIndex=function(t){var e=this._aEdges[this._iScrollingIndex],i=this.$("content").width(),s=i+this.$("rightscroller").width(),o,r=0,n;for(var l=0;l<this._aEdges.length;l++){o=this._aEdges[l];if(o+this._aWidths[l]-this._aSeperatorWidth[l]<e+i){r=l}else{if(o+this._aWidths[l]<e+s){n=true}else{n=false;break}}}return n&&t!==-1?this.getContent().length-1:r};p.prototype._collectEdgesAndWidths=function(){var t=0;this._aEdges=[];this._aWidths=[];this._aSeperatorWidth=[];this.getContent().forEach(function(e,i){var s=e.$().width(),o=e.$().find(".sapSuiteUiCommonsMicroProcessFlowItemSeparatorWrapper").width();this._aEdges.push(t);this._aWidths.push(s);this._aSeperatorWidth.push(o?o:0);t+=s},this)};p.prototype._getLeftScroller=function(){if(!this._oLeftScroller){this._oLeftScroller=new i(this.getId()+"leftscroller",{src:"sap-icon://navigation-left-arrow"});this._oLeftScroller.addStyleClass("sapSuiteUiCommonsMicroProcessFlowArrow")}return this._oLeftScroller};p.prototype._getRightScroller=function(){if(!this._oRightScroller){this._oRightScroller=new i(this.getId()+"rightscroller",{src:"sap-icon://navigation-right-arrow"});this._oRightScroller.addStyleClass("sapSuiteUiCommonsMicroProcessFlowArrow")}return this._oRightScroller};p.prototype._findEdgeItems=function(t){var e=this.$("scrolling"),i=e.parent(),s=this.getContent(),o=Math.abs(e.position().left),r,n,l=-1,a=-1;if(o<10||t===0){l=0;this._clearScroll(i)}if(t===s.length-1){a=s.length-1}r=e.width();for(var c=0;c<this._aEdges.length;c++){n=this._aEdges[c];if(l===-1&&n>=o){l=c}if(a===-1&&n+this._aWidths[c]>o+r+5){a=c-1;break}}this._iScrollingIndex=l;this._iLastVisibleIndex=a!==-1?a:s.length-2};p.prototype._processKeyPress=function(){if(this._hasScrolling()){var t=this.$("scrolling");this._bKeyBoard=true;t.removeClass("sapSuiteUiCommonsMicroProcessFlowScrollingTransition");t.css("transform","")}};p.prototype.onsapspace=function(t){this._firePress(t)};p.prototype.onsapenter=function(t){this._firePress(t)};p.prototype.onsapnext=function(t){this._processKeyPress()};p.prototype.onsapprevious=function(){this._processKeyPress()};p.prototype.onsaphome=function(t){this._processKeyPress()};p.prototype.onsapend=function(){this._processKeyPress()};p.prototype.getAccessibilityInfo=function(){var t="";this.getAggregation("content").forEach(function(e){t=t.concat(e._getAriaText())});return{type:c.getText("ACC_CTR_TYPE_MICRO_PROCESS_FLOW"),description:t}};p.prototype.getFormDoNotAdjustWidth=function(){return true};return p});
//# sourceMappingURL=MicroProcessFlow.js.map