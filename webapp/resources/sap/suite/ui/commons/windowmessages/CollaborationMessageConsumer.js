/*!
 * 
		SAP UI development toolkit for HTML5 (SAPUI5)
		(c) Copyright 2009-2015 SAP SE. All rights reserved
	
 */
sap.ui.define(["sap/base/Log"],function(n){"use strict";const t=n.getLogger("sap.suite.ui.commons.windowmessages.CollaborationMessageConsumer");let e;let o;const s="sap-suite-ui-commons-collaboration-client-appruntime";const i="collaboration-channel";const c="get-provider-config";const r="update-top-level-url";const a=[{channelId:i,version:"1.0"}];const u=["sap-suite-ui-commons-collaboration-message-broker"];const l=function(n,e,o,s,i,c){t.info(`Message Received from CLIENT_ID: ${n} on CHANNEL_ID: ${e}`);if(o===i){c(s)}else{t.info(`Message: '${o}' is not supported`)}};const f=function(n,t,s,i){l(n,t,s,i,c,function(n){e=JSON.parse(n);o(e)})};const p=function(n,e,o,s){l(n,e,o,s,r,function(n){const{success:e}=JSON.parse(n);if(e){t.info("Parent page URL successfully updated.")}})};const d=function(n){e={};n(e)};const g=async function(n,e,o){const i=sap.ui.require("sap/ushell/Container");let c;try{c=await i.getServiceAsync("MessageBroker");try{await c.connect(n);t.info(`Client ID: ${n} is connected successfully`)}catch{t.warn("Could not connect to the Message Broker");return null}await c.subscribe(n,e,o,Function.prototype);return c}catch(n){t.error(`Error during connect or subscribe: ${n}`);c?.disconnect(s);return null}};return{getProviderConfiguration:function(){return new Promise(async function(n){if(e){n(e);return}o=n;const r=sap.ui.require("sap/ushell/Container");if(!r){t.info("UShell Container instance doesn't exist");d(n);return}let l;try{l=await g(s,a,f);if(l){await l.publish(i,s,Date.now().toString(),c,u);try{l.disconnect(s)}catch(t){n(e)}}else{d(n)}}catch(e){t.info("Provider Configuration doesn't exist");l?.disconnect(s);d(n)}})},updateTopLevelURLforAppRuntime:async function(n){let e;try{e=await g(s,a,p);if(e){const o=JSON.stringify({url:n});await e.publish(i,s,Date.now().toString(),r,u,o);try{e.disconnect(s);t.info(`Client ID: ${s} disconnected successfully`)}catch(n){t.info("Disconnect failed")}}}catch(n){e?.disconnect(s)}}}});
//# sourceMappingURL=CollaborationMessageConsumer.js.map