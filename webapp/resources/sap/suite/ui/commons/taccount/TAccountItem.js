/*!
 * 
		SAP UI development toolkit for HTML5 (SAPUI5)
		(c) Copyright 2009-2015 SAP SE. All rights reserved
	
 */
sap.ui.define(["sap/ui/thirdparty/jquery","sap/suite/ui/commons/library","sap/ui/core/Control","sap/ui/core/theming/Parameters","sap/suite/ui/commons/taccount/TAccountPanel","sap/suite/ui/commons/taccount/TAccountGroup","sap/ui/core/format/NumberFormat","sap/ui/core/Core","sap/ui/core/library","./TAccountUtils","sap/ui/thirdparty/bignumber","sap/ui/core/Lib","sap/ui/core/Element","../library","sap/m/library"],function(jQuery,t,e,i,r,o,a,s,n,u,c,p,l,g,m){"use strict";var h=p.getResourceBundleFor("sap.suite.ui.commons");var d=g.SemanticColorType;var f=m.ValueCSSColor;var C=e.extend("sap.suite.ui.commons.taccount.TAccountItem",{metadata:{library:"sap.suite.ui.commons",properties:{value:{type:"any",group:"Misc",defaultValue:0},color:{type:"string",group:"Misc",defaultValue:null},group:{type:"string",group:"Misc",defaultValue:""},ariaLabel:{type:"string",group:"Misc",defaultValue:""}},aggregations:{properties:{type:"sap.suite.ui.commons.taccount.TAccountItemProperty",multiple:true,singularName:"property"}},events:{press:{}}},renderer:{apiVersion:2,render:function(t,e){var r=e.getColor(),o=e.getParent()&&e.getParent().getMeasureOfUnit(),a=e._getPanel(),s=u.formatCurrency(new c(e.getValue()),o,a?a.getMaxFractionDigits():0),p=s+" "+o;t.openStart("div",e);t.class("sapSuiteUiCommonsAccountItem");t.attr("tabindex","-1");if(e.getGroup()){t.attr("group",e.getGroup())}t.attr("aria-selected","false");t.attr("aria-setsize",e._indexSize);t.attr("aria-posinset",e._index);t.attr("role","option");t.attr("aria-label",e._getAriaLabel(p));t.openEnd();t.openStart("div").class("sapSuiteUiCommonsAccountColorBar");if(r){if(d.hasOwnProperty(r)){t.class("backgroundSemanticColor"+r)}if(n.CSSColor.isValid(r)){t.style("background-color",r)}if(n.CSSColor.isValid(i.get(r))){t.style("background-color",i.get(r))}}t.openEnd();t.close("div");t.openStart("div").attr("id",e.getId()+"-content").class("sapSuiteUiCommonsAccountContent").openEnd();t.openStart("div").class("sapSuiteUiCommonsAccountItemTitleWrapper").openEnd();t.openStart("span").class("sapSuiteUiCommonsAccountItemTitle").openEnd();t.text(p);t.close("span");t.close("div");t.openStart("div").class("sapSuiteUiCommonsAccountItemProperties").openEnd();e.getProperties().forEach(function(e){t.renderControl(e)});t.close("div");t.close("div");t.close("div")}}});C.prototype.onBeforeRendering=function(){this._prepareProperties()};C.prototype.onAfterRendering=function(){this.$().off("click");this.$().on("click",this._click.bind(this))};C.prototype._refreshAriaLabel=function(t){this.$().attr("aria-label",this._getAriaLabel())};C.prototype._getAriaLabel=function(t){var e=this.getAriaLabel();if(e){return e}if(!t){var i=this.getParent()&&this.getParent().getMeasureOfUnit(),r=this._getPanel(),o=u.formatCurrency(this.getValue(),i,r?r.getMaxFractionDigits():0),t=o+" "+i}var a=(this._bIsDebit?h.getText("TACCOUNT_DEBIT"):h.getText("TACCOUNT_CREDIT"))+" "+h.getText("TACCOUNT_ITEM");a+=" "+t+" ";this.getProperties().forEach(function(t){if(t.getVisible()){a+=t.getLabel()+":"+t.getValue()+" "}});return a};C.prototype._click=function(){var t=this.fireEvent("press",{},true);if(t){this._highlightItems()}};C.prototype._highlightItems=function(){var t=this.$(),e=this.getGroup(),i=!t.is(".sapSuiteUiCommonsAccountItemSelected, .sapSuiteUiCommonsAccountItemSelectedByGroup"),r=jQuery(".sapSuiteUiCommonsAccountItemSelected");this._setAriaHighlighted(r,false);this._setAriaHighlighted(t,i);r.removeClass("sapSuiteUiCommonsAccountItemSelected");i?t.addClass("sapSuiteUiCommonsAccountItemSelected"):t.removeClass("sapSuiteUiCommonsAccountItemSelected");var a=this._findHighlightParent();if(a){var s=jQuery(".sapSuiteUiCommonsAccountItemSelectedByGroup");s.removeClass("sapSuiteUiCommonsAccountItemSelectedByGroup");this._setAriaHighlighted(s,false);if(e&&i){var n=jQuery(".sapSuiteUiCommonsAccountItem[group="+e+"]");n.addClass("sapSuiteUiCommonsAccountItemSelectedByGroup");var u=this;n.each(function(t,e){var i=l.getElementById(e.id);if(i){u._setAriaHighlighted(i.$(),true);var r=i.getParent();if(r){r.$().addClass("sapSuiteUiCommonsAccountItemSelectedByGroup");var a=r.getParent();if(a instanceof o){a.$().addClass("sapSuiteUiCommonsAccountItemSelectedByGroup")}}}})}}};C.prototype.onsapenter=function(){this._highlightItems()};C.prototype.onsapspace=function(){this._highlightItems()};C.prototype._setAriaHighlighted=function(t,e){t.attr("aria-selected",e);t.attr("aria-label",e?h.getText("COLORED_ITEM_FROM")+" "+this.getGroup():this._getAriaLabel())};C.prototype._findHighlightParent=function(){var t=this.getParent();t=t&&t.getParent();if(t instanceof o){var e=t.getParent();return e instanceof r||t}return null};C.prototype._getPanel=function(){var t=this.getParent();t=t&&t.getParent();if(t instanceof o){var e=t.getParent();if(e instanceof r){return e}}return null};C.prototype._prepareProperties=function(){this._mProperties={};this.getProperties().forEach(function(t){var e=t.getKey();if(e){this._mProperties[e]=t}}.bind(this))};C.prototype.setValue=function(t){var e=new c(t);var i=new c(this.getValue());var r=this._bIsDebit?-1:1;var o=new c(r).times(e.minus(i));var a=o.isGreaterThan(0);this.setProperty("value",t);this.getParent()&&this.getParent()._valueChanged(o,this._bIsDebit&&!a)};C.prototype.setColor=function(t,e){var i=false;if(d.hasOwnProperty(t)){i=true}else{i=f.isValid(t)}if(t!=null&&!i){throw new Error(`Value ${t} is not valid for property "color"`)}return this.setProperty("color",i?t:null,e)};return C});
//# sourceMappingURL=TAccountItem.js.map