/*!
 * 
		SAP UI development toolkit for HTML5 (SAPUI5)
		(c) Copyright 2009-2015 SAP SE. All rights reserved
	
 */
sap.ui.define(["sap/ui/thirdparty/jquery","sap/suite/ui/commons/library","sap/ui/core/Control","sap/ui/core/theming/Parameters","./TAccountPanel","sap/ui/core/IconPool","sap/m/Button","sap/base/security/encodeXML","sap/ui/core/Configuration","sap/ui/core/delegate/ItemNavigation","./TAccountUtils","sap/ui/core/ResizeHandler","sap/ui/thirdparty/bignumber","sap/ui/core/InvisibleText","sap/ui/core/Core","sap/ui/core/Lib","sap/ui/core/Theming"],function(jQuery,t,e,o,i,n,s,a,r,p,u,c,l,d,h,m,_){"use strict";var C=m.getResourceBundleFor("sap.suite.ui.commons");var g=e.extend("sap.suite.ui.commons.taccount.TAccountGroup",{metadata:{library:"sap.suite.ui.commons",properties:{title:{type:"string",group:"Misc",defaultValue:null},collapsed:{type:"boolean",group:"Misc",defaultValue:false}},aggregations:{accounts:{type:"sap.suite.ui.commons.taccount.TAccount",multiple:true,singularName:"account"}},events:{}},renderer:{apiVersion:2,render:function(t,e){if(!e._bThemeApplied){return}t.openStart("div",e);t.class("sapSuiteUiCommonsAccountGroup");if(e.getCollapsed()){t.class("sapSuiteUiCommonsAccountGroupCollapsed")}t.attr("tabindex",0);t.attr("role","attribute");t.attr("aria-label",e._getAriaText());t.openEnd();t.openStart("div").class("sapSuiteUiCommonsGroupHeader").openEnd();t.openStart("div").class("sapSuiteUiCommonsGroupHeaderExpandWrapper").openEnd();t.renderControl(e._getExpandCollapse());t.close("div");t.openStart("div").class("sapSuiteUiCommonsGroupHeaderFirst").openEnd();t.openStart("span").class("sapSuiteUiCommonsGroupHeaderTitle").openEnd().unsafeHtml(a(e.getTitle())).close("span");t.openStart("span").attr("id",e.getId()+"-sum").class("sapSuiteUiCommonsGrouptHeaderSUM").openEnd().text(e._getSumText()).close("span");t.openStart("div").class("sapSuiteUiCommonsGroupInfoIconWrapper").class("sapSuiteUiCommonsTAccountBaseInfoIconWrapper").attr("title",C.getText("TACCOUNT_SELECTED")).openEnd();t.openStart("span").class("sapSuiteUiCommonsInfoIcon").openEnd();t.text("!");t.close("span");t.close("div");t.close("div");t.openStart("div").class("sapSuiteUiCommonsGroupHeaderSecond").openEnd();t.renderControl(e._getExpandAllAccounts());t.renderControl(e._getCollapseAllAccounts());t.close("div");t.close("div");t.openStart("div").attr("id",e.getId()+"-content").class("sapSuiteUiCommonsAccountGroupContent").openEnd();e.getAccounts().forEach(function(e){t.renderControl(e)});t.close("div");t.close("div")}}});g.prototype.init=function(){_.attachApplied(function(){this._bThemeApplied=true;this.invalidate()}.bind(this));if(!this._sResizeHandlerId){this._sResizeHandlerId=c.register(this,this._adjustUI.bind(this))}this._oInvisibleText=new d;this._oInvisibleText.toStatic()};g.prototype.exit=function(){if(this._oIconExpand){this._oIconExpand.destroy()}if(this._oIconCollapse){this._oIconCollapse.destroy()}if(this._sResizeHandlerId){c.deregister(this._sResizeHandlerId);this._sResizeHandlerId=""}this._bAttachEventListener=false};g.prototype.onBeforeRendering=function(){this._bRendered=false;this._oSum=null;this._iColumnCount=-1};g.prototype.onAfterRendering=function(){this._adjustUI();this._bRendered=true;var t=this.getParent();if(t&&this._hasPanelParent(t)&&t._bRendered){t._recalculate()}if(this.getCollapsed()){this.$("content").hide()}};g.prototype.reset=function(){this._oSum=null};g.prototype.updateBindingContext=function(){this.reset();return e.prototype.updateBindingContext.apply(this,arguments)};g.prototype._hasPanelParent=function(t){return(t||this.getParent())instanceof i};g.prototype._getExpandCollapse=function(){var t=this.getCollapsed(),e=this._getExpandAltText(!t);if(!this._oArrowDown){this._oArrowDown=new s({type:"Transparent",icon:t?"sap-icon://navigation-right-arrow":"sap-icon://navigation-down-arrow",tooltip:e,press:function(){this._expandCollapse()}.bind(this)})}return this._oArrowDown};g.prototype._getExpandAltText=function(t){return(t?C.getText("TACCOUNT_COLLAPSE"):C.getText("TACCOUNT_EXPAND"))+" "+(this.getTitle()?this.getTitle():C.getText("TACCOUNT_GROUP_TITLE"))};g.prototype._expandCollapse=function(){var t=this.getCollapsed(),e=this._getExpandAltText(t);this._getExpandCollapse().setTooltip(e);this._getExpandCollapse().setIcon(t?"sap-icon://navigation-down-arrow":"sap-icon://navigation-right-arrow");this.setProperty("collapsed",!t);this._bIsExpanding=true;this.$("content")[t?"show":"hide"]("medium",function(){this._bIsExpanding=false}.bind(this));this.$()[!t?"addClass":"removeClass"]("sapSuiteUiCommonsAccountGroupCollapsed")};g.prototype._expandCollapseAllAccounts=function(t){this.getAccounts().forEach(function(e){e.setCollapsed(!!t)});if(t==true){this._oInvisibleText.setText(C.getText("TACCOUNT_COLLAPSE_ALL"))}else{this._oInvisibleText.setText(C.getText("TACCOUNT_EXPAND_ALL"))}};g.prototype._getExpandAllAccounts=function(){if(!this._oIconExpand){this._oIconExpand=new s({icon:"sap-icon://expand-all",type:"Transparent",tooltip:C.getText("TACCOUNT_EXPAND")+" "+C.getText("TACCOUNT_ALL")+" "+C.getText("TACCOUNT_TITLE"),ariaDescribedBy:this._oInvisibleText.getId(),press:function(){this._expandCollapseAllAccounts(false);if(!this._bAttachEventListener){this._focusOutOnExpandCollapse();this._bAttachEventListener=true}}.bind(this)}).addStyleClass("sapSuiteUiCommonsGroupHeaderIcon")}return this._oIconExpand};g.prototype._getCollapseAllAccounts=function(){if(!this._oIconCollapse){this._oIconCollapse=new s({icon:"sap-icon://collapse-all",type:"Transparent",tooltip:C.getText("TACCOUNT_COLLAPSE")+" "+C.getText("TACCOUNT_ALL")+" "+C.getText("TACCOUNT_TITLE"),ariaDescribedBy:this._oInvisibleText.getId(),press:function(){this._expandCollapseAllAccounts(true);if(!this._bAttachEventListener){this._focusOutOnExpandCollapse();this._bAttachEventListener=true}}.bind(this)}).addStyleClass("sapSuiteUiCommonsGroupHeaderIcon")}return this._oIconCollapse};g.prototype._focusOutOnExpandCollapse=function(){this._oIconCollapse.getDomRef().addEventListener("focusout",function(){this._oInvisibleText.setText()}.bind(this));this._oIconExpand.getDomRef().addEventListener("focusout",function(){this._oInvisibleText.setText()}.bind(this))};g.prototype._getSum=function(t){var e=this.getAccounts(),o=new l("0"),i="",n=true;if(!this._oSum||t){for(var s=0;s<e.length;s++){var a=e[s];if(i&&i!==a.getMeasureOfUnit()){n=false;break}i=a.getMeasureOfUnit();o=o.plus(a._getSum())}this._oSum={sum:o,measure:i,correct:n}}return this._oSum};g.prototype._getSumText=function(){var t=this._getSum();var e=this.getParent();if(t&&t.correct){var o=u.formatCurrency(t.sum,t.measure,e instanceof i?e.getMaxFractionDigits():0);return(t.sum>0?C.getText("TACCOUNT_CREDIT"):C.getText("TACCOUNT_DEBIT"))+": "+o+" "+a(t.measure)}return"-"};g.prototype._getAriaText=function(){return C.getText("TACCOUNT_GROUP_TITLE")+" "+(this.getTitle()?this.getTitle()+" ":"")+this._getSumText()};g.prototype._adjustUI=function(){var t=320,e=16,o=t+e;var i=this.$("content"),n=i.width(),s=Math.max(Math.ceil(n/o)-1,1);if(s===this._iColumnCount){return}if(this._bIsExpanding||this._bRendered&&this.getCollapsed()){return}var a=jQuery('<div id="'+this.getId()+'-content" class="sapSuiteUiCommonsAccountGroupContent"></div>'),r=Array.apply(null,Array(s)).map(Number.prototype.valueOf,0);var p=this.$().find(".sapSuiteUiCommonsAccount"),u=0;this._iColumnCount=s;this._iDivs=[];var c='<div class="sapSuiteUiCommonsAccountGroupDroppingArea"><div class="sapSuiteUiCommonsAccountGroupDroppingAreaInner">'+'</div><div class="sapSuiteUiCommonsAccountGroupDroppingAreaInnerBall"></div><div class="sapSuiteUiCommonsAccountGroupDroppingAreaInnerText">'+C.getText("TACCOUNT_DROP_HERE")+"</div></div>";for(var l=0;l<s;l++){var d='<div class="sapSuiteUiCommonsAccountGroupColumn">'+c+"</div>",h=jQuery(d);a.append(h);this._iDivs.push(h)}for(var l=0;l<p.length;l++){var m=jQuery(p[l]),_=m.height(),g=this._iDivs[u];var f=Number.MAX_VALUE,T=0;for(var v=0;v<s;v++){var A=r[v];if(A<f){f=A;T=v}}var g=this._iDivs[T];m.detach().appendTo(g);jQuery(c).appendTo(g);r[T]+=_}i.detach();this.$().append(a);this._setupDroppable()};g.prototype._setupDroppable=function(){var t=function(t){var e=jQuery(t);return e.hasClass("sapSuiteUiCommonsTAccountDropZoneTop")?e.parent().prev():e.parent().next()};var e=function(t,e){var o=e.draggable,i=o.next();if(i[0]!==t[0]){i.detach().insertAfter(t);o.detach().insertAfter(t)}else{o.detach().insertBefore(t)}t.removeClass("sapSuiteUiCommonsAccountGroupDroppingAreaActiveSide");o.css("left","0px");o.css("top","0px")};var o=this.$().find(".sapSuiteUiCommonsAccountGroupDroppingArea");o.droppable({scope:this.getId()+"-content",tolerance:"pointer",activeClass:"sapSuiteUiCommonsAccountGroupDroppingAreaActive",hoverClass:"sapSuiteUiCommonsAccountGroupDroppingAreaActive",drop:function(t,o){var i=jQuery(this);e(i,o)}});var i=this.$().find(".sapSuiteUiCommonsTAccountDropZoneBottom, .sapSuiteUiCommonsTAccountDropZoneTop");i.droppable({scope:this.getId()+"-content",tolerance:"pointer",drop:function(t,o){var i=jQuery(this);i=i.hasClass("sapSuiteUiCommonsTAccountDropZoneTop")?i.parent().prev():i.parent().next();e(i,o)},over:function(e,o){t(this).addClass("sapSuiteUiCommonsAccountGroupDroppingAreaActiveSide")},out:function(e,o){t(this).removeClass("sapSuiteUiCommonsAccountGroupDroppingAreaActiveSide")}})};g.prototype._valueChanged=function(t,e){if(this._oSum){if(e){this._oSum.sum=this._oSum.sum.minus(t)}else{this._oSum.sum=this._oSum.sum.plus(t)}this.$("sum").text(this._getSumText());var o=this.getParent();if(this._hasPanelParent(o)){o._valueChanged(t,e)}}};g.prototype._measureChanged=function(t){if(this._oSum){if(this._oSum.measure===t&&!this._oSum.correct){this._recalculate();return}if(this._oSum.measure!==t&&this._oSum.correct){var e=this.getParent();this._oSum.correct=false;if(this._hasPanelParent(e)){e._setInvalid()}}this.$("sum").text(this._getSumText())}};g.prototype._recalculate=function(){this._oSum=this._getSum(true);this.$("sum").text(this._getSumText());var t=this.getParent();if(this._hasPanelParent(t)){t._recalculate()}};g.prototype._hasPanelParent=function(t){return(t||this.getParent())instanceof i};g.prototype.invalidate=function(){this._bRendered=false;e.prototype.invalidate.apply(this,arguments)};return g});
//# sourceMappingURL=TAccountGroup.js.map