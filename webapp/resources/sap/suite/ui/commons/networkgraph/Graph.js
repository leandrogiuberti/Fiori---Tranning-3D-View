/*!
 * 
		SAP UI development toolkit for HTML5 (SAPUI5)
		(c) Copyright 2009-2015 SAP SE. All rights reserved
	
 */
sap.ui.define(["sap/suite/ui/commons/library","sap/ui/thirdparty/jquery","sap/ui/core/Control","./SvgBase","./Node","./Line","./Group","./layout/LayeredLayout","./Tooltip","sap/ui/model/json/JSONModel","sap/m/SuggestionItem","./Utils","sap/m/Label","sap/m/OverflowToolbar","sap/m/OverflowToolbarButton","sap/m/SearchField","sap/m/ToolbarSpacer","sap/ui/core/CustomData","sap/ui/model/Filter","sap/m/OverflowToolbarLayoutData","./KeyboardNavigator","sap/base/Log","sap/ui/performance/Measurement","sap/base/security/encodeXML","sap/m/ToggleButton","sap/m/library","sap/suite/ui/commons/util/FullScreenUtil","sap/ui/core/InvisibleMessage","sap/ui/core/library","sap/ui/core/Core","sap/ui/core/Lib","sap/ui/core/Element","sap/base/i18n/Localization","sap/ui/core/RenderManager","sap/ui/core/Theming","sap/ui/core/InvisibleText","./GraphRenderer"],function(e,jQuery,t,i,s,o,n,r,a,h,l,u,c,g,p,f,d,_,m,y,L,v,T,b,S,N,E,I,C,A,O,w,F,R,x,G,$){"use strict";var U=N.ButtonType,D=e.networkgraph.Orientation,P=e.networkgraph.LayoutRenderType,k=e.networkgraph.RenderType,B=e.SemanticColorType;var M="nodes",H="lines",Z="groups";var W=[.05,.1,.25,.33,.5,.67,.75,.8,.9,1,1.1,1.25,1.5,1.75,2,2.5,3,4,5],K=1,Y=.4,z=100;var X={Group:"group",Node:"node",Line:"line",IsLastKey:"islast",TypeKey:"type"};var V=Object.freeze({Node:"Node",Line:"Line",Group:"Group"});var q=O.getResourceBundleFor("sap.suite.ui.commons");var j=C.InvisibleMessageMode;var J=i.extend("sap.suite.ui.commons.networkgraph.Graph",{metadata:{library:"sap.suite.ui.commons",properties:{height:{type:"sap.ui.core.CSSSize",group:"Appearance",defaultValue:"100%"},width:{type:"sap.ui.core.CSSSize",group:"Appearance",defaultValue:"100%"},orientation:{type:"sap.suite.ui.commons.networkgraph.Orientation",group:"Behavior",defaultValue:D.LeftRight},enableZoom:{type:"boolean",group:"Behavior",defaultValue:true},enableWheelZoom:{type:"boolean",group:"Behavior",defaultValue:true},backgroundImage:{type:"sap.ui.core.URI",group:"Appearance",defaultValue:null},backgroundColor:{type:"sap.suite.ui.commons.networkgraph.BackgroundColor",group:"Appearance",defaultValue:"White"},renderType:{type:"sap.suite.ui.commons.networkgraph.RenderType",group:"Appearance",defaultValue:k.Html},noData:{type:"boolean",group:"Behavior",defaultValue:false},noDataText:{type:"string",group:"Behavior",defaultValue:""},_smoothWheelZoom:{type:"int",group:"Behavior",defaultValue:125,visibility:"hidden"}},aggregations:{lines:{type:"sap.suite.ui.commons.networkgraph.Line",multiple:true,singularName:"line"},nodes:{type:"sap.suite.ui.commons.networkgraph.Node",multiple:true,singularName:"node"},groups:{type:"sap.suite.ui.commons.networkgraph.Group",multiple:true,singularName:"group"},legend:{type:"sap.ui.core.Control",multiple:false},layoutAlgorithm:{type:"sap.suite.ui.commons.networkgraph.layout.LayoutAlgorithm",multiple:false},statuses:{type:"sap.suite.ui.commons.networkgraph.Status",multiple:true,singularName:"status"}},associations:{ariaDescribedBy:{type:"sap.ui.core.Control",multiple:true,singularName:"ariaDescribedBy"},ariaLabelledBy:{type:"sap.ui.core.Control",multiple:true,singularName:"ariaLabelledBy"}},events:{graphReady:{},afterLayouting:{},beforeLayouting:{},zoomChanged:{},failure:{parameters:{type:"string",message:"string"}},selectionChange:{parameters:{items:{type:"sap.suite.ui.commons.networkgraph.ElementBase[]"}}},searchSuggest:{parameters:{term:{type:"string"}}},search:{parameters:{term:{type:"string"},key:{type:"string"}}}}}});J.FAILURE_TYPE={INCONSISTENT_MODEL:"Inconsistent model",LAYOUT_FAILURE:"Layout failure"};J.prototype.ZOOM_100=K;J.prototype.init=function(){this._fZoomLevel=1;this._mSelectedNodes={};this._mSelectedLines={};this._bIsLayedOut=false;this._bIsFullScreen=false;this._mNodes={};this._bNeedNodeProcessing=true;this._oFullScreenContainer=null;this._bRequiresDataProcessing=true;this._oPanning={};this._oLegendLabels={};this._iRunningLayouts=0;this._oLastLayout=null;this._bIsRtl=F.getRTL();this._oFocus=null;this._tooltip=this._createTooltip();this._bIsInvalid=false;this._oStatuses={};this._aShadedNodes=[];this._bEventsAdded=false;this._createToolbar()};J.prototype.onBeforeRendering=function(){this._bIsRtl=F.getRTL();this.setBusy(false);this.setBusyIndicatorDelay(0);this._iNodeMaxWidth=0;this.getNodes().forEach(function(e){e._resetDimensions();var t=e.getMaxWidth();if(t>this._iNodeMaxWidth){this._iNodeMaxWidth=t}}.bind(this));this.getLines().forEach(function(e){e._resetLayoutData()});if(!this.getNoData()){this.setDisableToolbarButtons(true);this._loadData()}else{this.setDisableToolbarButtons(false)}};J.prototype.onAfterRendering=function(){var e=this.getNodes();var t=new R;this.$divnodes=this.$("divnodes");this.$divgroups=this.$("divgroups");this.$background=this.$("background");this.$tooltips=this.$("tooltiplayer");this.$scroller=this.$("scroller");this._$innerscroller=this.$("innerscroller");this.$legend=this.$("legend");if(this._oFullScreenContainer&&this._bIsFullScreen){this._oFullScreenContainer.$content=this.$();this.$().addClass("sapSuiteUiCommonsNetworkGraphFullScreen")}if(e.length===0||this._bIsInvalid||this.getNoData()){if(this._bIsInvalid){t.openStart("span");t.class("sapSuiteNetworkGraphErrorText");t.openEnd();t.close("span");t.flush(this.$scroller[0])}if(this._oSuggestionItemsModel){this._oSuggestionItemsModel.setData("")}this.fireGraphReady();return}this.setBusy(true);e.forEach(function(e){e.bOutput=true});if(this._isDelayedLayouting()){var i=function(){if(this._iNodeMaxWidth){this.$divnodes.css("width",this._iNodeMaxWidth+50+"px")}if(this._isUseNodeHtml()){this._createDivNodes()}else{t.openStart("svg",this.getId()+"-sizesvg");if(this._bIsRtl){t.attr("direction","rtl")}t.class("sapSuiteUiCommonsNetworkGraphSvg");t.openEnd();e.forEach(function(e){e._setupWidthAndHeight();e._render({sizeDetermination:true,renderManager:t});t.close("g")});t.openStart("rect");t.class("sapSuiteFlickerFreeRect");t.attr("x","0").attr("y","0");t.openEnd();t.close("rect");t.close("svg");t.flush(this._$innerscroller[0],true,this._$innerscroller.children().length)}e.forEach(function(e){if(this._isUseNodeHtml()){e._setupDivDimensions()}else{e.calculateSizes();e._setupWidthAndHeight()}}.bind(this));this._preprocessData();x.detachApplied(i)}.bind(this);x.attachApplied(i)}this.oInvisibleMessage=I.getInstance();t.destroy()};J.prototype.exit=function(){if(this._oFullScreenUtil){this._oFullScreenUtil.cleanUpFullScreen(this)}};J.prototype._beforeRender=function(){this.fireEvent("afterLayouting")};J.prototype._fireFailure=function(e,t){var i=t;if(typeof t==="object"&&t.text){i=t.text}var s="Graph failure: "+e+": "+i;if(e===J.FAILURE_TYPE.INCONSISTENT_MODEL){s+=" This may be due to the model size restriction. For its increase use model's 'setSizeLimit' method."}this.fireFailure([e.toString(),i]);v.error(s)};J.prototype.isFullScreen=function(){return this._bIsFullScreen};J.prototype.toggleFullScreen=function(){this._toggleFullScreen()};J.prototype.preventInvalidation=function(e){this._bPreventInvalidation=e};J.prototype.scrollToElement=function(e){this._scrollToElement(e)};J.prototype.setSearchSuggestionItems=function(e){var t=[];if(e){e.forEach(function(e){t.push({text:e.getText(),icon:e.getIcon(),key:e.getKey(),description:e.getDescription()})})}this._oSuggestionItemsModel.setData({items:t})};J.prototype.destroyAllElements=function(){this.destroyAggregation(M,false);this.destroyAggregation(Z,false);this.destroyAggregation(H,false)};J.prototype.deselect=function(e){var t=[],i=this.$(),s=function(e){Object.keys(e).forEach(function(i){t.push(e[i]);e[i].setSelected(false)},this)}.bind(this);i.find("."+this.HIGHLIGHT_CLASS).removeClass(this.HIGHLIGHT_CLASS);i.find("."+this.SELECT_CLASS).removeClass(this.SELECT_CLASS);i.find("."+this.VISIBLE_ACTIONS_BUTTONS_CLASS).removeClass(this.VISIBLE_ACTIONS_BUTTONS_CLASS);s(this._mSelectedNodes);s(this._mSelectedLines);this._aShadedNodes.forEach(function(e){e._setNodeOpacity(false)});this._aShadedNodes=[];this.$(this.LINEBUTTONSID).hide();if(!e&&t.length){this.fireSelectionChange({items:t})}return t};J.prototype.getFocus=function(){return this._oFocus};J.prototype.getToolbar=function(){return this._toolbar};J.prototype.getNodeByKey=function(e){if(this._bRequiresDataProcessing){this._processData()}return this._mNodes[e]};J.prototype.setCustomLegendLabel=function(e){var t;if(e.isGroup===true){t=V.Group}else if(e.isLine===true){t=V.Line}else{t=e.isNode===false?V.Line:V.Node}if(e.status){this._oLegendLabels[t+e.status]=e.label;this._createLegend()}};J.prototype.updateLegend=function(){this._createLegend()};J.prototype.zoom=function(e){e=e||{};e.deltaY=e.zoomin!==false?1:-1;if(e.x&&e.y){e.point={x:e.x,y:e.y}}this._zoom(e)};J.prototype.getZoomLevelMilestones=function(){return W};J.prototype.getCurrentZoomLevel=function(){return this._fZoomLevel};J.prototype.setCurrentZoomLevel=function(e){this._fZoomLevel=e;this._zoomLabel.setText(this._getZoomText());this._oZoomLevelInvisibleText.setText(q.getText("NETWORK_GRAPH_ZOOM_LEVEL")+": "+this._getZoomText())};J.prototype.getCorrectMousePosition=function(e){var t=this.$svg.offset(),i=1,s=1;if(this._iWidth!==this.$svg.width()||this._iHeight!==this.$svg.height()){i=this._iWidth/this.$svg.width();s=this._iHeight/this.$svg.height()}return{x:parseInt((e.x-t.left)*i,10),y:parseInt((e.y-t.top)*s,10)}};J.prototype._createTooltip=function(){var e=new a(this.getId()+"-tooltip");this.addDependent(e);e.create(this);e.attachEvent("afterClose",function(){var e=this.getFocus();if(e){this.setFocus(e);if(e.button=="menu"){e.item._setMenuButtonFocus(true)}}}.bind(this));return e};J.prototype.defocus=function(){this.$().find("."+this.FOCUS_CLASS).removeClass(this.FOCUS_CLASS)};J.prototype.setFocus=function(e,t){if(!e&&!this._oFocus||e&&this._oFocus&&e.item===this._oFocus.item&&e.button===this._oFocus.button&&e.groupInFocused===this._oFocus.groupInFocused){if(t||this._oFocus&&this._oFocus.item&&(this._oFocus.item.isA("sap.suite.ui.commons.networkgraph.Line")||this._oFocus.item.isA("sap.suite.ui.commons.networkgraph.Node"))){this._updateAccessibility(e)}this._updateAccessibility(e);return}this.defocus();if(this.getFocusDomRef()){this.getFocusDomRef().focus()}if(e){if(e.button){if(e.item instanceof s||e.item instanceof o){e.item._setActionButtonFocus(e.button,true)}else if(e.item instanceof n){if(e.button===n.BUTTONS.MENU){e.item._setMenuButtonFocus(true)}else if(e.button===n.BUTTONS.COLLAPSE){e.item._setCollapseButtonFocus(true)}}}else if(e.item){if(e.item instanceof n){if(e.item.sParentAggregationName==="groups"&&!this._oFocus?.groupInFocused){e.item._setFocus(true);e.groupInFocused=true}else{e.item._setMenuButtonFocus(true);e.button=n.BUTTONS.MENU}}else{e.item._setFocus(true)}}}this._oFocus=e;this._ensureOnScreen(e?e.item:null);this._updateAccessibility(e)};J.prototype._updateAccessibility=function(e){var t=function(){this._setAccessibilityTitle(q.getText("NETWORK_GRAPH_ACCESSIBILITY_CONTENT"))}.bind(this),i=function(t){var i=t+" "+q.getText("NETWORK_GRAPH_ACCESSIBILITY_ACTION_BUTTON");if(t==="Expand/Collapse"){if(e.item.getCollapsed()){i=i+" "+q.getText("NETWORK_GRAPH_COLLAPSED")}else{i=i+" "+q.getText("NETWORK_GRAPH_EXPANDED")}return i+"."+q.getText("NETWORK_GRAPH_ACCESSIBILITY_TOGGLE_STATE")}return i};if(this.getDomRef("wrapper")){this.getDomRef("wrapper").setAttribute("aria-live","assertive");this._setAriaLabelForWrapper()}if(e){if(e.button){if(e.item instanceof s){if(e.button.title==="Expand/Collapse"){this._setAccessibilityTitle(e.item._getActionButtonTitle(e.button,this)+" "+e.item._oExpandState)}else{this._setAccessibilityTitle(e.item._getActionButtonTitle(e.button,this))}}else if(e.item instanceof n){if(e.button===n.BUTTONS.MENU){this._setAccessibilityTitle(i(q.getText("NETWORK_GRAPH_GROUP_DETAIL")))}else if(e.button===n.BUTTONS.COLLAPSE){this._setAccessibilityTitle(i(q.getText("NETWORK_GRAPH_EXPAND_COLLAPSE")))}else{t()}}else{t()}}else if(e.item){this._setAccessibilityTitle(e.item._getAccessibilityLabel(this))}else{this._setAriaLabelForWrapper(q.getText("NETWORK_GRAPH_ACCESSIBILITY_CONTENT"));this._setAccessibilityTitle(" ")}}else{t()}};J.prototype._setAriaLabelForWrapper=function(e){e=e?e:" ";this.getDomRef("wrapper").setAttribute("aria-label",e)};J.prototype._processProperties=function(){if(this._bNeedNodeProcessing){this._mSelectedNodes={};this._mSelectedLines={};this.getNodes().forEach(function(e){if(e.getSelected()){this._mSelectedNodes[e.getKey()]=e}if(e.getCollapsed()){e.setCollapsed(true)}},this);this.getLines().forEach(function(e){if(e.getSelected()){this._mSelectedLines[e._getLineId()]=e}},this);this._bNeedNodeProcessing=false}};J.prototype._loadData=function(){if(this.getNodes().length>0){if(!this._processData()){return}if(!this._isDelayedLayouting()){setTimeout(this._preprocessData.bind(this),0)}}};J.prototype._preprocessData=function(){this._bIsLayedOut=false;this._bImageLoaded=false;this.fireBeforeLayouting();this._applyLayout().then(this._render.bind(this))};J.prototype._getAllElements=function(){return this.getNodes().concat(this.getGroups())};J.prototype._render=function(){this._beforeRender();this._iRunningLayouts--;if(this._iRunningLayouts>0){return}this._oLastLayout=null;this._createSearchSuggestItems();this._innerRender();this._createLegend();this._processProperties();if(this._fZoomLevel!==1){this.$svg[0].setAttribute("viewBox","0 0 "+this.$svg.width()+" "+this.$svg.height());var e=this.$svg.width(),t=this.$svg.height();this.$svg.width(e*this._fZoomLevel);this.$svg.height(t*this._fZoomLevel);this.$background.width(e*this._fZoomLevel);this.$background.height(t*this._fZoomLevel);if(this._isUseNodeHtml()){var i="scale("+this._fZoomLevel+")";this.$("divnodes").css("transform",i)}this.$("tooltiplayer").css("transform",i);this.$("divgroups").css("transform",i)}this._setLineClasses();if(this._selectElementAfterScroll){this._scrollToElement(this._selectElementAfterScroll);this._selectElementAfterScroll=null}if(this._oFocus&&this._oFocus.button===n.BUTTONS.COLLAPSE){this._oFocus.item._setCollapseButtonFocus(true)}this._bIsLayedOut=true;this._setupEvents();this._setupKeyboardNavigation();this.setFocus(this.getFocus());if(!this.getBackgroundImage()||this._bImageLoaded){this.setBusy(false);this.fireGraphReady()}if(!this._isSwimLane()&&!this._isTwoColumnsLayout()){this.$("innerscroller").addClass(" sapSuiteUiCommonsNetworkGraphInnerScrollerCenter ")}};J.prototype._createDivNodes=function(){var e=new R;this.getNodes().forEach(function(t){t._bMainRender=true;e.renderControl(t);t._bMainRender=false});e.flush(this.$divnodes[0]);e.destroy()};J.prototype._innerRender=function(e){var t=function(){this.$svg.find(".sapSuiteFlickerFreeRect").remove();this._bImageLoaded=true;if(this._bIsLayedOut){this.setBusy(false);this.fireGraphReady()}}.bind(this);var i=function(){var e=new R;this.getGroups().forEach(function(t){e.renderControl(t)});e.flush(this.$("divgroups")[0],false,true);e.destroy()}.bind(this);var s=20,o=50,n=function(){var e=0,i=0;var n=function(t,s){if(t>e){e=t}if(s>i){i=s}};this._iWidth=0;this._iHeight=0;this._getAllElements().forEach(function(e){if(!e._isIgnored()){n(e._iWidth+e.getX(),e._iHeight+e.getY())}},this);this.getLines().forEach(function(e){if(!e._isIgnored()){e.getCoordinates().forEach(function(e){n(e.getX(),e.getY())})}},this);if(this.getBackgroundImage()){var r=new Image;r.onload=function(){this._iWidth=Math.max(this._iWidth,r.width);this._iHeight=Math.max(this._iHeight,r.height);this.$svg.width(this._iWidth);this.$svg.height(this._iHeight);this.$background.width(this._iWidth);this.$background.height(this._iHeight);this.$svg.css("background-image","url("+this.getBackgroundImage()+")");this.$svg.css("background-size","cover");t()}.bind(this);r.onerror=function(){v.warning("Unable to load background image.");t()};r.src=this.getBackgroundImage()}this._iWidth=Math.round(e+(this._isTwoColumnsLayout()?0:o));this._iHeight=Math.round(i+s);if(this.getWidth()==="auto"){this.$().width(this._iWidth)}if(this.getHeight()==="auto"){this.$("wrapper").height(this._iHeight)}if(this._isTwoColumnsLayout()){var a=this._$innerscroller.width();if(this._iWidth<a){this._iWidth=a}}this.$svg.width(this._iWidth);this.$svg.height(this._iHeight);this.$background.width(this._iWidth);this.$background.height(this._iHeight);if(this._isUseNodeHtml()){this.$divnodes.width(this._iWidth);this.$divnodes.height(this._iHeight);this.$divnodes.css("opacity",1)}this.$divgroups.width(this._iWidth);this.$divgroups.height(this._iHeight);this.$tooltips.width(this._iWidth);this.$tooltips.height(this._iHeight)}.bind(this);var r=function(e){e.forEach(function(e){e.forEach(function(e){e._afterRendering()})})};var a=this.getNodes(),h=this.getLines();T.start(this.getId(),"Rendering of a network graph");if(!this._isUseNodeHtml()){this.$("sizesvg").remove()}i();var l=new R;this._renderSvg(this._isUseNodeHtml()?[]:a,h,l);l.flush(this._$innerscroller[0],true,this._$innerscroller.children().length);l.destroy();this.$svg=this.$("networkGraphSvg");this.$background=this.$("background");n();if(this._isUseNodeHtml()){a.forEach(function(e){var t=e.$();if(e._isInCollapsedGroup()){t.hide()}t.css("top",e.getY()+"px");t.css("left",e.getX()+"px")})}r([this._isUseNodeHtml()?[]:a,h]);T.end(this.getId())};J.prototype._renderSvg=function(e,t,i){var s=["sapSuiteUiCommonsNetworkGraphSvg","sapSuiteUiCommonsNetworkGraphNoSelect","sapSuiteNetworkGraphSvgMargin"];if(this._fZoomLevel<Y){s.push("sapSuiteUiCommonsNetworkGraphZoomedOut")}if(!this._isUseNodeHtml()){s.push("sapSuiteNetworkGraphSvgPosition")}var o=function(e,t){e.forEach(function(e){e._render({renderManager:t});e.bOutput=true})};var n=function(e,t,s){i.openStart("g",this._getDomId(e));if(s){i.class(s)}i.openEnd();o(t,i);i.close("g")}.bind(this);i.openStart("svg",this.getId()+"-networkGraphSvg");if(this._bIsRtl){i.attr("direction","rtl")}i.attr("aria-label",q.getText("NETWORK_GRAPH_SVG_ACCESSIBILITY_LABEL"));s.forEach(function(e){i.class(e)});i.attr("preserveAspectRatio","none");i.openEnd();i.openStart("g",this.getId()+"-svgbody");i.openEnd();n("lines",t,"sapSuiteUiCommonsNetworkLines");if(!this._isUseNodeHtml()){n("nodes",e,"sapSuiteUiCommonsNetworkNodes")}i.close("g");if(this.getBackgroundImage()){i.openStart("rect");i.class("sapSuiteFlickerFreeRect");i.attr("x","0");i.attr("y","0");i.attr("height","100%");i.attr("width","100%");i.openEnd();i.close("rect")}i.close("svg");if(this._isUseNodeHtml()){i.openStart("div",this.getId()+"-background");i.openEnd();i.close("div")}};J.prototype._isProperKey=function(e){return e||e==="0"};J.prototype._processData=function(){var e=this._isSwimLane();var t=function(){var t=0,i;this.mGroups={};i=this.getGroups().some(function(i){var s=i.getKey();i._iNestedLevel=0;if(!this._isProperKey(s)){this._fireFailure(J.FAILURE_TYPE.INCONSISTENT_MODEL,"Group without a proper key [index: "+t+"] found.");return true}i._bIsSwimLane=e;i._resetSize();i._clearChildren();if(this.mGroups[s]){this._fireFailure(J.FAILURE_TYPE.INCONSISTENT_MODEL,"Group with a duplicit key "+s+" found.");return true}this.mGroups[s]=i;t++;return false},this);return i||this.getGroups().some(function(e){if(e.getParentGroupKey()&&!this.mGroups[e.getParentGroupKey()]){this._fireFailure(J.FAILURE_TYPE.INCONSISTENT_MODEL,"Group '"+e.getKey()+"' reffers to a nonexistent parent group '"+e.getParentGroupKey()+"'.");return true}return false},this)}.bind(this);var i=function(){var e=0;this._mNodes={};return this.getNodes().some(function(t){if(!this._isProperKey(t.getKey())){this._fireFailure(J.FAILURE_TYPE.INCONSISTENT_MODEL,"Node without a proper ID [index: "+e+"] found.");return true}var i=t.getGroup(),s;t._oGroup=null;if(i){s=this.mGroups[i];if(s){t._oGroup=s;s.aNodes.push(t)}else{this._fireFailure(J.FAILURE_TYPE.INCONSISTENT_MODEL,"Node belonging to a nonexistent group with key "+i+" found.");return true}}this._isUseNodeHtml()?t._resetDimensions():t._setupWidthAndHeight();t._clearChildren();t._rendered=false;if(this._mNodes[t.getKey()]){this._fireFailure(J.FAILURE_TYPE.INCONSISTENT_MODEL,"Node with a duplicit key "+t.getKey()+" found.");return true}this._mNodes[t.getKey()]=t;e++;return false},this)}.bind(this);var s=function(){return this.getLines().some(function(e,t){var i=this.getNodeByKey(e.getFrom()),s=this.getNodeByKey(e.getTo());if(!i){this._fireFailure(J.FAILURE_TYPE.INCONSISTENT_MODEL,"Line going from a nonexistent node with key "+e.getFrom()+" found.");return true}if(!s){this._fireFailure(J.FAILURE_TYPE.INCONSISTENT_MODEL,"Line going to a nonexistent node with key "+e.getTo()+" found.");return true}e._rendered=false;e._initialized=false;if(i&&s){i.aChildren.push(s);i.aLines.push(e);s.aParents.push(i);s.aParentLines.push(e);e._oFrom=i;e._oTo=s;e._sKey="line_"+i.getKey()+"-"+s.getKey()+"["+t+"]"}if(i._oGroup){i._oGroup.aLines.push(e);i._oGroup.aChildren.push(s)}if(s._oGroup){s._oGroup.aParentLines.push(e);s._oGroup.aParents.push(i)}return false},this)}.bind(this);var o=function(){this.getGroups().forEach(function(e){var t=e.getParentGroupKey();if(t){var i=this.mGroups[t];if(i){e._oParentGroup=i;i.aChildGroups.push(e)}}}.bind(this));this.getGroups().forEach(function(e){var t=0,i=e._oParentGroup,s=false,o=e;while(i){if(i.getCollapsed()&&!s){e._oCollapsedByParent=i;s=true}o=i;i=i._oParentGroup;t++}e._iNestedLevel=t;e._oTopParentGroup=o})}.bind(this);this._bRequiresDataProcessing=false;if(t()||i()||s()){this._bIsInvalid=true;return false}o();this._oStatuses={};this.getStatuses().forEach(function(e){var t=e.getKey();if(t){this._oStatuses[t]=e}},this);this._bIsInvalid=false;return true};J.prototype._validateLayout=function(){var e,t,i,s="";e=this.getNodes().some(function(e){if(e._isIgnored()){return false}s="Missing coordinates: Node("+e.getKey()+")";return!(e._oGroup&&e._oGroup.getCollapsed()||isFinite(e.getX())&&isFinite(e.getY()))});if(e){this._fireFailure(J.FAILURE_TYPE.LAYOUT_FAILURE,s);return false}if(this._isLayered()){t=this.getGroups().some(function(e){if(e._isIgnored()){return false}s="Missing coordinates: Group("+e.getKey()+")";return!e._isEmpty()&&(!isFinite(e.getX())||!isFinite(e.getY()))});if(t){this._fireFailure(J.FAILURE_TYPE.LAYOUT_FAILURE,s);return false}}i=this.getLines().some(function(e){if(e._isIgnored()){return false}s="Missing coordinates: Line("+e.getKey()+")";return!e._validateLayout()});if(i){this._fireFailure(J.FAILURE_TYPE.LAYOUT_FAILURE,s);return false}return true};J.prototype._suggest=function(e){var t=function(e){e.addCustomData(new _({key:X.IsLastKey,value:"true",writeToDom:true}))};var i=function(e){var t=u.find(e.getCustomData(),function(e){return e.getKey()===X.IsLastKey});if(t){e.removeCustomData(t)}};var s=function(e){var t=u.find(e.getCustomData(),function(e){return e.getKey()===X.TypeKey});return t&&t.getValue()};var o=function(){var e=this._searchField.getSuggestionItems(),o,n,r;for(var a=0;a<e.length;a++){o=e[a];i(o);if(a<e.length-1){n=s(o);r=s(e[a+1]);if(n&&r){if(n===X.Node&&r===X.Line||n===X.Line&&r===X.Group){t(o)}}}}}.bind(this);var n=[],r=this.fireEvent("searchSuggest",{term:e},true);if(r){if(e){n=[new m([new m("text",function(t){return(t.toLowerCase()||"").indexOf(e.toLowerCase())>-1}),new m("description",function(t){return(t.toLowerCase()||"").indexOf(e.toLowerCase())>-1})],false)]}this._searchField.getBinding("suggestionItems").filter(n);o()}this._searchField.suggest()};J.prototype._getElementSelectFunctionName=function(e){var t="";if(e instanceof s){t="_selectNode"}if(e instanceof o){t="_selectLine"}if(e instanceof n){t="_selectGroup"}return t};J.prototype._search=function(e,t){var i,s,o;s=this.fireEvent("search",{term:e,key:t},true);if(!s){return}if(e){o=u.find(this.getNodes(),function(i){return t?i.getKey()===t:i.getTitle()===e});if(!o){o=u.find(this.getLines(),function(i){if(i._isLoop()){return false}return t?i._getLineId()===t:i._createSuggestionHelpText()===e})}if(!o){o=u.find(this.getGroups(),function(i){return i.aNodes.length>0&&(t?i.getKey()===t:i.getTitle()===e)})}if(o){i=this._getElementSelectFunctionName(o);if(i){this[i]({element:o,scroll:true,alwaysSelect:true})}}}else{this.deselect(false);this.setFocus(null)}};J.prototype._createToolbar=function(){var e=this;this._toolbar=new g(this.getId()+"-toolbar",{content:[new d]}).addStyleClass("sapSuiteUiCommonsNetworkGraphToolbar");this.addDependent(this._toolbar);this._toolbar.ontouchstart=function(){this.setFocus(null);this.getDomRef("wrapper").setAttribute("aria-live","off");this._setAriaLabelForWrapper(q.getText("NETWORK_GRAPH_ACCESSIBILITY_LABEL"))}.bind(this);this._searchField=new f({layoutData:new y({priority:sap.m.OverflowToolbarPriority.NeverOverflow,shrinkable:true}),enableSuggestions:true,suggest:function(t){e._suggest(t.getParameter("suggestValue"))},search:function(t){var i=t.getParameter("query"),s=t.getParameter("suggestionItem"),o;if(s){o=s.getProperty("key")}e._search(i,o)}}).addStyleClass("sapSuiteUiCommonsNetworkGraphSearchField");this._toolbar.addContent(this._searchField);this._toolbar.addContent(new S({id:this.getId()+"-legendButton",type:U.Transparent,icon:"sap-icon://legend",tooltip:q.getText("NETWORK_GRAPH_LEGEND"),press:function(t){if(e.$legend.is(":visible")){e.$legend.hide()}else{e.$legend.show()}}}));if(this.getEnableZoom()){if(!this._oZoomLevelInvisibleText){this._oZoomLevelInvisibleText=new G;this._oZoomLevelInvisibleText.toStatic()}this._zoomLabel=new c({layoutData:new y({group:1,priority:sap.m.OverflowToolbarPriority.Disappear}),text:"100%"});this._oZoomLevelInvisibleText.setText(q.getText("NETWORK_GRAPH_ZOOM_LEVEL")+": "+"100%");this._zoomIn=new p({layoutData:new y({group:1}),type:U.Transparent,ariaDescribedBy:[this._oZoomLevelInvisibleText.getId()],text:q.getText("CHARTCONTAINER_ZOOMIN"),icon:"sap-icon://zoom-in",tooltip:q.getText("CHARTCONTAINER_ZOOMIN"),press:function(t){e._zoom({deltaY:1})}});this._toolbar.addContent(this._zoomIn);this._toolbar.addContent(this._zoomLabel);this._zoomOut=new p({layoutData:new y({group:1}),type:U.Transparent,ariaDescribedBy:[this._oZoomLevelInvisibleText.getId()],text:q.getText("CHARTCONTAINER_ZOOMOUT"),icon:"sap-icon://zoom-out",tooltip:q.getText("CHARTCONTAINER_ZOOMOUT"),press:function(t){e._zoom({deltaY:-1})}});this._toolbar.addContent(this._zoomOut)}this._toolbar.addContent(new p({type:U.Transparent,icon:"sap-icon://popup-window",tooltip:q.getText("NETWORK_GRAPH_ZOOMTOFIT"),text:q.getText("NETWORK_GRAPH_ZOOMTOFIT"),press:this._fitToScreen.bind(this)}));this._oFullScreenButton=new p({type:U.Transparent,text:q.getText("CALCULATION_BUILDER_ENTER_FULL_SCREEN_BUTTON"),icon:"sap-icon://full-screen",tooltip:q.getText("CALCULATION_BUILDER_ENTER_FULL_SCREEN_BUTTON"),press:this._toggleFullScreen.bind(this)});this._toolbar.addContent(this._oFullScreenButton)};J.prototype._fitToScreen=function(){var e=this.$scroller.height()/this._iHeight,t=this.$scroller.width()/this._iWidth,i=Math.min(e,t),s=W.slice(-1);for(var o=1;o<W.length;o++){if(i<W[o]){s=W[o-1];break}}this._zoom({zoomLevel:s});this.oInvisibleMessage.announce(q.getText("NETWORK_GRAPH_ZOOMTOFIT_ANNOUNCEMENT",[s*100]),j.Assertive)};J.prototype._getZoomText=function(){return Math.floor(this._fZoomLevel*100)+"%"};J.prototype._toggleFullScreen=function(){if(this._bIsFullScreen==false){this._sControlHeight=this.getHeight();this.setHeight("100%");this._sControlWidth=this.getWidth();this.setWidth("100%")}var e=function(e,t){this._oFullScreenButton.setIcon(e);this._oFullScreenButton.setText(t);this._oFullScreenButton.setTooltip(t)}.bind(this);if(this._bIsFullScreen){e("sap-icon://full-screen",q.getText("CALCULATION_BUILDER_ENTER_FULL_SCREEN_BUTTON"))}else{e("sap-icon://exit-full-screen",q.getText("CALCULATION_BUILDER_EXIT_FULL_SCREEN_BUTTON"))}this._bIsFullScreen=!this._bIsFullScreen;if(!this._oFullScreenUtil){this._oFullScreenUtil=E}this._oFullScreenUtil.toggleFullScreen(this,this._bIsFullScreen,this._oFullScreenButton,this._toggleFullScreen);if(this._bIsFullScreen==false){this.setHeight(this._sControlHeight);this.setWidth(this._sControlWidth)}};J.prototype._setupKeyboardNavigation=function(){var e=[],t=[[]],i,s;if(!this._isLayedOut()){return}this.getNodes().forEach(function(t){if(t.isHidden()||t._isIgnored()||!t.getVisible()){return}e.push({item:t,x:t.getX(),y:t.getY()})});this.getLines().forEach(function(t){if(t.isHidden()||t._isIgnored()||!t.getVisible()||t.getCoordinates().length<2){return}var i=t.getCoordinates()[0],s=i.getX(),o=i.getY();t.getCoordinates().forEach(function(e){if(s>e.getX()){s=e.getX()}if(o>e.getY()){o=e.getY()}});e.push({item:t,x:s,y:o})});this.getGroups().forEach(function(t){if(t.isHidden()||t._isEmpty()||!t.getVisible()){return}e.push({item:t,x:t.getX(),y:t.getY()})});e.sort(function(e,t){if(e.y<t.y){return-1}else if(e.y>t.y){return 1}else if(e.x<t.x){return-1}else if(e.x>t.x){return 1}else{return 0}});if(e.length>0){s=[e[0]];t=[s];i=e[0];e.forEach(function(e,o){if(o===0){return}if(e.y===i.y){s.push(e)}else{s=[e];t.push(s)}i=e})}t=this._normalizeGrid(t,e);if(!this._oKeyboardNavigator){this._oKeyboardNavigator=new L(this);this.addDelegate(this._oKeyboardNavigator)}this._oKeyboardNavigator.setItems(t);this._oKeyboardNavigator.setWrapperDom(this.getFocusDomRef())};J.prototype._normalizeGrid=function(e,t){if(t.length===0){return e}var i=t[0],s=i.x,o=i.x,n=1,r,a,h=[],l;t.forEach(function(e){if(e.x<s){s=e.x}if(e.x>o){o=e.x}});e.forEach(function(e){if(e.length>n){n=e.length}});r=Math.abs(o-s)/n;a=s;for(l=0;l<n;l++){a+=r;h.push(a)}return e.map(function(e){var t,i;if(e.length===n){t=e}else{t=[];i=0;while(i<n-e.length&&h[i]<e[0].x){i++;t.push(null)}e.forEach(function(e){t.push(e);i++});while(i<n){t.push(null);i++}}return t.map(function(e){return e?e.item:null})})};J.prototype.getFocusDomRef=function(){return this.getDomRef("wrapper")};J.prototype._setupEvents=function(){var e=5;var t=0,i={},s=this.$("ctrlalert"),o=this.$scroller;var n=function(e,t){return Math.sqrt(Math.pow(e.clientX-t.clientX,2)+Math.pow(e.clientY-t.clientY,2))};var r=function(e){if(e.touches&&e.touches.length===2){i={t1:e.touches[0],t2:e.touches[1],diff:n(e.touches[0],e.touches[1])}}};var a=function(s){if(s.touches&&s.touches.length===2){if(++t===e){var o=s.touches[0],r=s.touches[1],a=n(o,r);this._zoom({point:{x:(o.clientX+r.clientX)/2,y:(o.clientY+r.clientY)/2},deltaY:a-i.diff});t=0;i={t1:o,t2:r,diff:a}}s.preventDefault()}}.bind(this);if(!this._bEventsAdded){o.on("mousemove",function(e){this._mouseMove(e.clientX,e.clientY)}.bind(this));o.on("mouseleave",this._endDragging.bind(this));o.on("mouseup",this._mouseUp.bind(this));if(this.getEnableZoom()){o.on("wheel",function(e){if(this._wheel({x:e.originalEvent.clientX,y:e.originalEvent.clientY,deltaY:e.originalEvent.deltaY,div:s,ctrl:e.ctrlKey})){e.preventDefault()}}.bind(this))}o.on("touchstart",function(e){r(e)});o.on("touchmove",function(e){a(e)});this._bEventsAdded=true}var h=this._isSwimLane()?this.$svg:this.$divgroups;if(!h._eventAdded){h.on("mousedown",function(e){this._mouseDown(e.clientX,e.clientY);e.preventDefault()}.bind(this));h._eventAdded=true}};J.prototype._wheel=function(e){if(this.getEnableWheelZoom()||e.ctrl){e.div.css("opacity","0");var t=this.getProperty("_smoothWheelZoom");var i=t>0?u.throttle(this._zoom.bind(this),t):this._zoom.bind(this);i({point:{x:e.x,y:e.y},deltaY:-e.deltaY});this._zoomLabel.setText(this._getZoomText());this._oZoomLevelInvisibleText.setText(q.getText("NETWORK_GRAPH_ZOOM_LEVEL")+": "+this._getZoomText());return true}};J.prototype._endDragging=function(){this._oPanning.dragging=false;this.$scroller.removeClass("sapSuiteUiCommonsNetworkGraphPanning")};J.prototype._mouseMove=function(e,t){var i=this.$scroller[0];if(this._oPanning.dragging){if(!this.$scroller.hasClass("sapSuiteUiCommonsNetworkGraphPanning")){this.$scroller.addClass("sapSuiteUiCommonsNetworkGraphPanning")}i.scrollTop=i.scrollTop-(t-this._oPanning.lastY);i.scrollLeft=i.scrollLeft-(e-this._oPanning.lastX);this._oPanning.lastX=e;this._oPanning.lastY=t}};J.prototype._mouseDown=function(e,t){this.deselect(false);this.setFocus(null);this._oPanning.lastX=e;this._oPanning.lastY=t;this._oPanning.dragging=true;this._tooltip.instantClose()};J.prototype._mouseUp=function(){this._endDragging()};J.prototype._preventZoomToChangeLineWidth=function(){return this._isLayered()&&(this._fZoomLevel>=.5&&this._fZoomLevel<2)};J.prototype._setLineClasses=function(){var e=this.$(),t=this._preventZoomToChangeLineWidth()?"addClass":"removeClass",i=this._fZoomLevel<.5?"removeClass":"addClass";e[t]("sapSuiteUiCommonsNetworkGraphDefaultLineWidth");e[i]("sapSuiteUiCommonsNetworkGraphCrispEdges")};J.prototype._zoom=function(e){var t=this.$svg[0].getAttribute("viewBox"),i=e.deltaY<0?-1:1,s,o,n,r;var a=function(e){var t=0,i;W.forEach(function(s,o){var n=Math.abs(e-s);if(n<i||i===undefined){t=o;i=n}});return t};if(!e.point){e.point={x:this.$scroller.width()/2,y:this.$scroller.height()/2}}s=this.getCorrectMousePosition({x:e.point.x,y:e.point.y});if(e.zoomLevel||e.zoomLevel===0){this._fZoomLevel=e.zoomLevel}else{n=a(this._fZoomLevel);if(W.indexOf(this._fZoomLevel)<0){if(this._fZoomLevel>W[n]){n=i<0?n:n+i}else{n=i>0?n:n+i}}else{n+=i}if(n<0){n=0}else if(n>W.length-1){n=W.length-1}this._fZoomLevel=W[n]}if(this._fZoomLevel<0){this._fZoomLevel=0}if(!t){r="0 0 "+Math.round(this.$svg.width())+" "+Math.round(this.$svg.height());this.$svg[0].setAttribute("viewBox",r)}this.$svg.width(Math.round(this._iWidth*this._fZoomLevel));this.$svg.height(Math.round(this._iHeight*this._fZoomLevel));this.$background.width(Math.round(this._iWidth*this._fZoomLevel));this.$background.height(Math.round(this._iHeight*this._fZoomLevel));o=this.getCorrectMousePosition({x:e.point.x,y:e.point.y});this.$scroller[0].scrollLeft+=(s.x-o.x)*this._fZoomLevel;this.$scroller[0].scrollTop+=(s.y-o.y)*this._fZoomLevel;this._zoomLabel.setText(this._getZoomText());this._oZoomLevelInvisibleText.setText(q.getText("NETWORK_GRAPH_ZOOM_LEVEL")+": "+this._getZoomText());if(this._fZoomLevel<Y){this.$svg.addClass("sapSuiteUiCommonsNetworkGraphZoomedOut")}else{this.$svg.removeClass("sapSuiteUiCommonsNetworkGraphZoomedOut")}if(this._isUseNodeHtml()){this.$("divnodes").css("transform","scale("+this._fZoomLevel+")")}this.$("divgroups").css("transform","scale("+this._fZoomLevel+")");this.$tooltips.css("transform","scale("+this._fZoomLevel+")");this._setLineClasses();this.fireEvent("zoomChanged")};J.prototype._createSearchSuggestItems=function(){var e=50;var t={items:[]},i=this.getNodes().sort(function(e,t){return e.getTitle().localeCompare(t.getTitle())}),s=this.getLines().sort(function(e,t){var i=e.getTitle(),s=t.getTitle();if(i===s){return e.getFromNode().getTitle().localeCompare(t.getFromNode().getTitle())}return i.localeCompare(s)}),o=this.getGroups().sort(function(e,t){return e.getTitle().localeCompare(t.getTitle())});this._oSuggestionItemsModel=new h;this._oSuggestionItemsModel.setSizeLimit(z);i.forEach(function(i){var s=u.trimText(i.getTitle(),e);t.items.push({text:s?s:i.getKey(),type:X.Node,icon:i.getIcon(),key:i.getKey(),description:"("+q.getText("NETWORK_GRAPH_NODE")+")"})});s.forEach(function(e){if(e._isLoop()){return}if(e.getTitle()||e.getFromNode().getTitle()||e.getToNode().getTitle()){t.items.push({text:e._createSuggestionHelpText(),type:X.Line,key:e._getLineId(),description:"("+q.getText("NETWORK_GRAPH_LINE")+")"})}});o.forEach(function(i){var s=u.trimText(i.getTitle(),e);if(i.aNodes.length>0){t.items.push({text:s?s:i.getKey(),key:i.getKey(),type:X.Group,description:"("+q.getText("NETWORK_GRAPH_GROUP")+")"})}});this._oSuggestionItemsModel.setData(t);this._searchField.setModel(this._oSuggestionItemsModel);this._searchField.bindAggregation("suggestionItems",{path:"/items",template:new l({text:"{text}",icon:"{icon}",key:"{key}",description:"{description}",customData:new _({key:"type",value:"{type}"})})})};J.prototype._scrollToElement=function(e){var t=e._oGroup&&e._oGroup.getCollapsed(),i,s,n,r,a,h;if(t){e=e._oGroup}if(e instanceof o){a=e.getSource();h=e.getTarget();n=Math.abs(h.getX()-a.getX());r=Math.abs(h.getY()-a.getY());i=Math.min(a.getX(),h.getX());s=Math.max(a.getY(),h.getY())}else{i=e.getX();s=e.getY();n=e._iWidth;r=e._iHeight}this.$scroller.get(0).scrollLeft=(i+(n?n:0)/2)*this._fZoomLevel-this.$scroller.width()/2;this.$scroller.get(0).scrollTop=(s+(r?r:0)/2)*this._fZoomLevel-this.$scroller.height()/2};J.prototype._ensureOnScreen=function(e){if(!e||!this.$scroller){return}var t,i,r,a=this.$scroller[0],h=a.scrollLeft/this._fZoomLevel,l=a.scrollTop/this._fZoomLevel,u=h+this.$scroller.width()/this._fZoomLevel,c=l+this.$scroller.height()/this._fZoomLevel;if(!e._isOnScreen(h,u,l,c)){if(e instanceof s){i=e.getX()+e._iWidth/2;r=e.getY()+e._iHeight/2}else if(e instanceof o){t=e._getArrowFragmentVector();i=(t.center.x+t.apex.x)/2;r=(t.center.y+t.apex.y)/2}else if(e instanceof n){i=e.getX();r=e.getY()}if(i<h||i>u){a.scrollLeft=i*this._fZoomLevel-this.$scroller.width()/2}if(r<l||r>c){a.scrollTop=r*this._fZoomLevel-this.$scroller.height()/2}}};J.prototype._createLegend=function(){var e=new R;var t=this.$("legend"),i=this,s={},o={},n={};var r=function(e,t){var i=b(e.getStatus());if(i){if(t[i]){t[i].push(e)}else{t[i]=[e]}}};var a=function(e){return Object.keys(e).length>0};var h=function(t,s,o){var n=this._oStatuses[t],r=n&&n._getLegendColor(),a=B.hasOwnProperty(r),h=r&&!a?"background-color:"+r:"",l=r&&a?u.SEMANTIC_CLASS_NAME.BACKGROUND+r:"";this._renderControl.call(i,"div",{status:t,elementtype:o,class:"sapSuiteUiCommonsNetworkGraphLegendLine"},false,e);this._renderControl.call(i,"div",{class:"sapSuiteUiCommonsNetworkGraphLegendColorLine "+this._getStatusClass(t)+" "+l,style:h},null,e);this._renderControl.call(i,"label",{class:"sapSuiteUiCommonsNetworkGraphLegendLineLabel"},false,e);e.text(this._oLegendLabels[o+t]?this._oLegendLabels[o+t]:s);e.close("label");e.close("div")}.bind(this);var l=function(t,i,s,o,n){t.forEach(function(e){r(e,i)});if(a(i)){e.openStart("div").class(s).openEnd();e.openStart("label").class("sapSuiteUiCommonsNetworkGraphLegendTitle").openEnd();e.text(q.getText(o));e.close("label");e.close("div");var l=Object.keys(i).reduce(function(e,t){var i;if(this._oLegendLabels[n+t]){i=this._oLegendLabels[n+t]}else{var s=this._oStatuses[t];i=s?s.getTitle()||t:q.getText("NETWORK_GRAPH_"+t.toUpperCase())}e[t]=i;return e}.bind(this),{});Object.keys(i).sort(function(e,t){return(l[e]||"").localeCompare(l[t])}).forEach(function(e){h(e,l[e],n)})}}.bind(this);if(this.getLegend()){return}if(!t[0]){return}l(this.getNodes(),s,"sapSuiteUiCommonsNetworkGraphLegendTitleNode","NETWORK_GRAPH_NODES",V.Node);l(this.getLines(),o,"sapSuiteUiCommonsNetworkGraphLegendTitleLine","NETWORK_GRAPH_LINES",V.Line);l(this.getGroups(),n,"sapSuiteUiCommonsNetworkGraphLegendTitleLine","NETWORK_GRAPH_GROUPS",V.Group);e.flush(t[0]);e.destroy();if(w.getElementById(this.getId()+"-legendButton").getPressed()){this.getDomRef("legend").style.display="block"}this.$().find(".sapSuiteUiCommonsNetworkGraphLegendLine").on("click",function(e){var t=jQuery(this).attr("status"),n=jQuery(this).attr("elementtype"),r;if(n===V.Node){r=s}if(n===V.Line){r=o}if(!e.ctrlKey){i.deselect(false);i.setFocus(null)}if(n!==V.Group&&r[t]){r[t].forEach(function(e){e.setSelected(true)})}})};J.prototype._selectElement=function(e){var t=e.element&&!e.element.getSelected(),i=[];var s=function(t){e.element.setSelected(t);if(e.setFocus!==false){this.setFocus({item:e.element})}}.bind(this);this.$("svg").find("."+this.VISIBLE_ACTIONS_BUTTONS_CLASS).removeClass(this.VISIBLE_ACTIONS_BUTTONS_CLASS);if(!e.preventDeselect){i=this.deselect(true);if(e.setFocus){this.setFocus(null)}s(t||e.alwaysSelect)}else{s(t)}if(!e.element._hasFocus()&&e.forceFocus){this.setFocus({item:e.element})}if(!i.some(function(t){return t===e.element})){i.push(e.element)}this.fireSelectionChange({items:i})};J.prototype._selectLine=function(e){var t=e.element.getFromNode(),i=e.element.getToNode(),s=t._isInCollapsedGroup()&&t._oGroup===i._oGroup?i._oGroup:null;if(e.scroll){this._scrollToElement(s||e.element)}if(!s){this._selectElement(e)}};J.prototype._selectNode=function(e){var t=e.element._isInCollapsedGroup()?e.element._oGroup:null;if(e.scroll){this._scrollToElement(t||e.element)}if(!t){this._selectElement(e);if(e.renderActionButtons!==false){e.element.showActionButtons(true)}}};J.prototype._selectGroup=function(e){if(e.scroll){this._scrollToElement(e.element)}this.setFocus({item:e.element})};J.prototype._applyLayout=function(){var e;this._iRunningLayouts++;e=this._getLayoutAlgorithm().layout().catch(function(e){this._fireFailure(J.FAILURE_TYPE.LAYOUT_FAILURE,e);return Promise.reject()}.bind(this)).then(function(){return new Promise(function(t,i){if(e.isTerminated()){t();return}if(this._validateLayout()){t()}else{i()}}.bind(this))}.bind(this));if(this._oLastLayout&&this._iRunningLayouts>1){this._oLastLayout.terminate()}this._oLastLayout=e;return e};J.prototype._setAccessibilityTitle=function(e){var t,i=this.$("accessibility");if(e===null){t=q.getText("NETWORK_GRAPH_ACCESSIBILITY_CONTENT")}else if(typeof e==="string"){t=e}else{t=e._getAccessibilityLabel(this)}if(i){i.html(b(t))}};J.prototype._isTopBottom=function(){return this.getOrientation()===D.TopBottom||this.getOrientation()===D.BottomTop};J.prototype._getLayoutAlgorithm=function(){return this.getLayoutAlgorithm()||this._getDefalutLayout()};J.prototype._isUseNodeHtml=function(){return this.getRenderType()===k.Html};J.prototype._getDefalutLayout=function(){if(!this._oDefalutLayout){this._oDefaultLayout=new r;this._oDefaultLayout.setParent(this,null,true)}return this._oDefaultLayout};J.prototype._isLayered=function(){var e=this._getLayoutAlgorithm().getLayoutRenderType();return e===P.SwimLanes||e===P.LayeredWithGroups||e===P.TwoColumns};J.prototype._isSwimLane=function(){return this._getLayoutAlgorithm().getLayoutRenderType()===P.SwimLanes};J.prototype._isTwoColumnsLayout=function(){return this._getLayoutAlgorithm().getLayoutRenderType()===P.TwoColumns};J.prototype._isDelayedLayouting=function(){if(this._isUseNodeHtml()){return true}return this.getNodes().some(function(e){var t=e.hasListeners("computeSizes");return t||e._useAutomaticSize()||e.getTitleLineSize()!==1||e._displayDescription()})};J.prototype._isLayedOut=function(){return this._bIsLayedOut};J.prototype.setEnableZoom=function(e){if(this._toolbar){this._zoomLabel.setVisible(e);this._zoomIn.setVisible(e);this._zoomOut.setVisible(e)}this.setProperty("enableZoom",e);return this};J.prototype.setDisableToolbarButtons=function(e){this._toolbar.setEnabled(e);return this};J.prototype.destroyAggregation=function(e,i){this._bRequiresDataProcessing=true;t.prototype.destroyAggregation.call(this,e,i)};J.prototype.insertAggregation=function(e,i,s,o){this._bRequiresDataProcessing=true;t.prototype.insertAggregation.call(this,e,i,s,o)};J.prototype.removeAggregation=function(e,i,s){this._bRequiresDataProcessing=true;t.prototype.removeAggregation.call(this,e,i,s)};J.prototype.addAggregation=function(e,i,s){this._bRequiresDataProcessing=true;t.prototype.addAggregation.call(this,e,i,s)};J.prototype.removeAllAggregation=function(e,i){this._bRequiresDataProcessing=true;t.prototype.removeAllAggregation.call(this,e,i)};J.prototype.updateAggregation=function(e){this._bNeedNodeProcessing=true;t.prototype.updateAggregation.call(this,e)};J.prototype.invalidate=function(){if(this._bPreventInvalidation!==true){t.prototype.invalidate.call(this)}};return J});
//# sourceMappingURL=Graph.js.map