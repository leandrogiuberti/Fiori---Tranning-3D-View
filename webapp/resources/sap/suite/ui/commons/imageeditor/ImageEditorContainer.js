/*!
 * 
		SAP UI development toolkit for HTML5 (SAPUI5)
		(c) Copyright 2009-2015 SAP SE. All rights reserved
	
 */
sap.ui.define(["sap/ui/thirdparty/jquery","sap/ui/core/Control","sap/suite/ui/commons/library","sap/ui/core/library","sap/m/library","./ImageEditor","sap/m/OverflowToolbar","sap/m/OverflowToolbarButton","sap/m/OverflowToolbarToggleButton","sap/m/ToggleButton","sap/m/ToolbarSeparator","sap/m/ToolbarSpacer","sap/m/Label","sap/m/Slider","sap/m/Input","sap/ui/model/json/JSONModel","sap/m/Button","sap/m/ResponsivePopover","sap/m/List","sap/m/StandardListItem","sap/m/CustomListItem","sap/m/FlexBox","sap/m/FlexItemData","sap/m/IconTabBar","sap/m/IconTabFilter","sap/ui/core/Icon","sap/ui/core/HTML","sap/m/Switch","sap/suite/ui/commons/ControlProxy","sap/base/Log","sap/ui/unified/FileUploader","sap/ui/base/ManagedObjectObserver","sap/ui/core/ResizeHandler","sap/ui/core/Core","sap/ui/core/Lib","sap/ui/model/type/Integer","sap/ui/core/Theming","./ImageEditorContainerRenderer"],function(jQuery,t,e,o,i,r,s,a,n,l,p,h,d,u,g,c,m,_,I,f,y,T,C,b,S,M,E,R,O,P,L,B,w,A,v,F,x){"use strict";var G=v.getResourceBundleFor("sap.suite.ui.commons");var H=i.InputType,z=i.ListType,D=e.ImageEditorMode,N=e.ImageEditorContainerMode,Z=e.ImageEditorContainerButton,k=o.ValueState,V=i.ListMode,U=i.ButtonType,K=i.FlexDirection,W=i.FlexRendertype,X=i.FlexJustifyContent,j=i.FlexAlignItems,Y=i.IconTabDensityMode,$=i.BackgroundDesign,J=i.SwitchType,q=o.TextAlign,Q=Object.freeze({WIDTH:{min:r.LIMITS.WIDTH_MIN,max:r.LIMITS.WIDTH_MAX,callback:"_setWidth"},HEIGHT:{min:r.LIMITS.HEIGHT_MIN,max:r.LIMITS.HEIGHT_MAX,callback:"_setHeight"},ROTATION:{min:r.LIMITS.ROTATION_MIN,max:r.LIMITS.ROTATION_MAX,callback:"_rotate"},FILTER:{callback:"_applyCurrentFilter"}}),tt=Object.freeze({CUSTOMSIZE:"sap-icon://write-new-document",ORIGINALSIZE:"sap-icon://table-view",ROTATELEFT:"sap-icon://response",ROTATERIGHT:"sap-icon://forward",CROPRECTANGLE:"sap-icon://color-fill",CROPELLIPSE:"sap-icon://circle-task-2",CROPCUSTOMSHAPE:"sap-icon://add-favorite",TRANSFORM:"sap-icon://draw-rectangle",FILTER:"sap-icon://palette",CROP:"sap-icon://crop",UNDO:"sap-icon://undo",DROPDOWN:"sap-icon://slim-arrow-down",ZONES:"sap-icon://tag",LOCK:"sap-icon://locked",RESET:"sap-icon://reset",FLIPVERTICAL:"sap-icon://resize-vertical",FLIPHORIZONTAL:"sap-icon://resize-horizontal",RELATIVE:"sap-icon://resize",ZOOMIN:"sap-icon://zoom-in",ZOOMOUT:"sap-icon://zoom-out",ZOOMFIT:"sap-icon://popup-window"});var et=t.extend("sap.suite.ui.commons.imageeditor.ImageEditorContainer",{metadata:{library:"sap.suite.ui.commons",properties:{mode:{type:"sap.suite.ui.commons.ImageEditorContainerMode",defaultValue:N.Filter},enabledButtons:{type:"sap.suite.ui.commons.ImageEditorContainerButton[]",defaultValue:[Z.Filter,Z.Transform,Z.Crop]}},defaultAggregation:"imageEditor",aggregations:{imageEditor:{type:"sap.suite.ui.commons.imageeditor.ImageEditor",multiple:false,singularName:"imageEditor"},customToolbarControls:{type:"sap.ui.core.Control",multiple:true,singularName:"customToolbarControl"},customResizeItems:{type:"sap.suite.ui.commons.imageeditor.CustomSizeItem",multiple:true,singularName:"customResizeItem"},customRectangleCropItems:{type:"sap.suite.ui.commons.imageeditor.CustomSizeItem",multiple:true,singularName:"customRectangleCropItem"},customEllipseCropItems:{type:"sap.suite.ui.commons.imageeditor.CustomSizeItem",multiple:true,singularName:"customEllipseCropItem"}}}});var ot=Object.freeze({NUM_KEPT_ITEMS:2});et.prototype.init=function(){var t={enabled:false,mode:null,zoom:100,transform:{keepAspectRatio:true,width:null,height:null,widthValueState:k.None,widthValueStateText:null,heightValueState:k.None,heightValueStateText:null,rotate:0,rotateValueState:k.None,rotateValueStateText:null,selectedTypeKey:"Resize",flipVertical:false,flipHorizontal:false,resizes:[{key:"custom",text:G.getText("IMGEDITOR_CUSTOM_SIZE"),icon:tt.CUSTOMSIZE,unlockRatio:true},{key:"original",text:G.getText("IMGEDITOR_ORIGINAL_SIZE"),icon:tt.ORIGINALSIZE}],rotates:[{key:"90left",text:G.getText("IMGEDITOR_ROTATE_90LEFT"),rotate:-90,icon:tt.ROTATELEFT},{key:"90right",text:G.getText("IMGEDITOR_ROTATE_90RIGHT"),rotate:90,icon:tt.ROTATERIGHT},{key:"45left",text:G.getText("IMGEDITOR_ROTATE_45LEFT"),rotate:-45,icon:tt.ROTATELEFT},{key:"45right",text:G.getText("IMGEDITOR_ROTATE_45RIGHT"),rotate:45,icon:tt.ROTATERIGHT}],flips:[{key:"vertical",text:G.getText("IMGEDITOR_FLIP_VERTICAL"),icon:tt.FLIPVERTICAL,flipVertical:true,flipHorizontal:false},{key:"horizontal",text:G.getText("IMGEDITOR_FLIP_HORIZONTAL"),icon:tt.FLIPHORIZONTAL,flipVertical:false,flipHorizontal:true}]},crop:{scaleCropArea:false,customShapeLoaded:false,zoom:100,zoomValueState:k.None,zoomValueStateText:null,width:null,widthValueState:k.None,widthValueStateText:null,height:null,heightValueState:k.None,heightValueStateText:null,keepAspectRatio:true,selectedTypeKey:"Rectangle",selectedType:null,enabled:true,areaRectangle:{x:10,y:10,width:80,height:80},types:[{key:"Rectangle",text:"",icon:tt.CROPRECTANGLE,apply:"applyVisibleCrop"},{key:"Ellipse",text:"",icon:tt.CROPELLIPSE,apply:"applyVisibleCrop"},{key:"CustomShape",text:"",icon:tt.CROPCUSTOMSHAPE,apply:"applyVisibleCrop"}],ratiosRectangle:[{key:"custom",text:G.getText("IMGEDITOR_CUSTOM_SIZE"),icon:tt.CUSTOMSIZE,unlockRatio:true,relative:true},{key:"original",text:G.getText("IMGEDITOR_CROP_RATIO_ORIGINAL"),width:null,height:null,icon:tt.ORIGINALSIZE,relative:true}],ratiosCircle:[{key:"custom",text:G.getText("IMGEDITOR_CUSTOM_SIZE"),icon:tt.CUSTOMSIZE,unlockRatio:true,relative:true},{key:"original",text:G.getText("IMGEDITOR_CROP_RATIO_ORIGINAL"),width:null,height:null,icon:tt.ORIGINALSIZE,relative:true}],ratiosCustomShape:[{key:"custom",text:G.getText("IMGEDITOR_CUSTOM_SIZE"),icon:tt.CUSTOMSIZE,unlockRatio:true,relative:true},{key:"original",text:G.getText("IMGEDITOR_CROP_RATIO_ORIGINAL"),callback:"_setCustomShapeCropAreaRatio",icon:tt.ORIGINALSIZE,relative:true}]},filter:{filterValueState:k.None,filterValueStateText:null,selectedFilter:null,filters:[{text:G.getText("IMGEDITOR_FILTER_BRIGHTNESS"),type:"brightness",value:100,defaultValue:100,unit:"%",min:r.LIMITS.BRIGHTNESS_MIN,max:r.LIMITS.BRIGHTNESS_MAX},{text:G.getText("IMGEDITOR_FILTER_CONTRAST"),type:"contrast",value:100,defaultValue:100,unit:"%",min:r.LIMITS.CONTRAST_MIN,max:r.LIMITS.CONTRAST_MAX},{text:G.getText("IMGEDITOR_FILTER_SATURATION"),type:"saturate",value:100,defaultValue:100,unit:"%",min:r.LIMITS.SATURATE_MIN,max:r.LIMITS.SATURATE_MAX},{text:G.getText("IMGEDITOR_FILTER_GRAYSCALE"),type:"grayscale",value:0,defaultValue:0,unit:"%",min:r.LIMITS.GRAYSCALE_MIN,max:r.LIMITS.GRAYSCALE_MAX},{text:G.getText("IMGEDITOR_FILTER_INVERT"),type:"invert",value:0,defaultValue:0,unit:"%",min:r.LIMITS.INVERT_MIN,max:r.LIMITS.INVERT_MAX},{text:G.getText("IMGEDITOR_FILTER_SEPIA"),type:"sepia",value:0,defaultValue:0,unit:"%",min:r.LIMITS.SEPIA_MIN,max:r.LIMITS.SEPIA_MAX}]},history:[],historyIndex:0};this._bFirstTimeRendered=true;this._oObserver=new B(this._onManagedObjectChange.bind(this));this._oObserver.observe(this,{properties:["enabledButtons"],aggregations:["customToolbarControls"]});this._oModel=new c(t);this._oThumbnailCanvas=document.createElement("canvas");this._updateToolbarsContent();this["_setMode"+this.getMode()]()};et.prototype.onBeforeRendering=function(){if(this._sResizeHandlerId){w.deregister(this._sResizeHandlerId)}};et.prototype.onAfterRendering=function(){var t=this;this._bIsSmallSize=this._isSmallSize();function e(){t._zoomToFit()}if(this._bFirstTimeRendered&&this.getImageEditor()){this._bFirstTimeRendered=false;x.attachApplied(e)}this._sResizeHandlerId=w.register(this,this._onResize.bind(this))};et.prototype.onExit=function(){if(this._sResizeHandlerId){w.deregister(this._sResizeHandlerId)}};et.prototype._onResize=function(){var t=this._isSmallSize();if(this._bIsSmallSize!==t){this._bIsSmallSize=t;this.rerender()}};et.prototype._isSmallSize=function(){var t=600;return this.$()[0]&&this.$().width()<t};et.prototype._zoomToFit=function(){var t=this.getImageEditor();if(t&&t._isReady()&&this.getDomRef()){t.zoomToFit();this._oModel.setProperty("/zoom",t.getZoomLevel());this._refreshCropAreaSize()}};et.prototype.exit=function(){this._oObserver.disconnect();this._oObserver.destroy()};et.prototype.setMode=function(t){this.setProperty("mode",t,true);this["_setMode"+this.getMode()]();return this};et.prototype.setImageEditor=function(t){this._detachEditorEvents(this.getImageEditor());this.setAggregation("imageEditor",t);this._attachEditorEvents(t);if(t&&t.getLoaded()){this._onImageLoaded()}if(t&&t.getCustomShapeLoaded()){this._onCustomShapeLoaded()}return this};et.prototype.destroyImageEditor=function(){this._detachEditorEvents(this.getImageEditor());this.destroyAggregation("imageEditor");this._oModel.setProperty("/enabled",false);return this};et.prototype.getToolbar=function(){return this._getHeaderToolbar()};et.prototype.getToolbarIds=function(){return{filter:this.getId()+"-filterButton",crop:this.getId()+"-cropButton",transform:this.getId()+"-transformButton",undo:this.getId()+"-undoButton",history:this.getId()+"-historyButton",zoomIn:this.getId()+"-zoominButton",zoomOut:this.getId()+"-zoomoutButton",zoomToFit:this.getId()+"-zoomToFitButton",zoomLabel:this.getId()+"-zoomLabel",separator:this.getId()+"-separator"}};et.prototype.getMobileHeaderToolbar=function(){return this._getMobileHeaderToolbar()};et.prototype.getMobileZoomToolbar=function(){return this._getMobileZoomToolbar()};et.prototype.getMobileZoomToolbarIds=function(){return{zoomIn:this.getId()+"-mobileZoominButton",zoomLabel:this.getId()+"-mobileZoomLabel",zoomOut:this.getId()+"-mobilezoomoutButton",zoomToFit:this.getId()+"-mobileZoomToFitButton",scaleSwitch:this.getId()+"-mobileScaleSwitch",scaleLabel:this.getId()+"-mobileScaleLabel"}};et.prototype.getMobileFooterToolbar=function(){return this._getMobileFooterToolbar()};et.prototype.getMobileFooterToolbarIds=function(){return{filter:this.getId()+"-mobileFilterButton",crop:this.getId()+"-mobileCropButton",transform:this.getId()+"-mobileTransformButton",undo:this.getId()+"-mobileUndoButton",history:this.getId()+"-mobileHistoryButton",apply:this.getId()+"-mobileApplyButton"}};et.prototype._attachEditorEvents=function(t){if(!t){return}t.attachLoaded(this._onImageLoaded,this);t.attachCustomShapeLoaded(this._onCustomShapeLoaded,this);t.attachError(this._onImageError,this);t.attachCropAreaChanged(this._onCropAreaChange,this);t.attachHistoryChanged(this._onHistoryChange,this);t.attachSizeChanged(this._onSizeChange,this);t.attachZoomChanged(this._onZoomChange,this)};et.prototype._detachEditorEvents=function(t){if(!t){return}t.detachLoaded(this._onImageLoaded,this);t.detachCustomShapeLoaded(this._onCustomShapeLoaded,this);t.detachError(this._onImageError,this);t.detachCropAreaChanged(this._onCropAreaChange,this);t.detachHistoryChanged(this._onHistoryChange,this);t.detachSizeChanged(this._onSizeChange,this);t.detachZoomChanged(this._onZoomChange,this)};et.prototype._onManagedObjectChange=function(t){if(t.object===this._oMobileHeaderToolbar){this._oMobileHeaderToolbar.setVisible(t.object.getContent().length>0)}else if(t.object===this){this._updateToolbarsContent()}};et.prototype._refreshImageSize=function(){if(!this.getImageEditor()||!this.getImageEditor().getLoaded()){return}var t=this.getImageEditor().getWidth(),e=this.getImageEditor().getHeight();this._oModel.setProperty("/transform/resizes/1/width",t);this._oModel.setProperty("/transform/resizes/1/height",e);this._oModel.setProperty("/crop/ratiosRectangle/1/width",t);this._oModel.setProperty("/crop/ratiosRectangle/1/height",e);this._oModel.setProperty("/crop/ratiosCircle/1/width",t);this._oModel.setProperty("/crop/ratiosCircle/1/height",e);this._updateCurrentSize(t,e)};et.prototype._refreshCropAreaSize=function(){var t=this.getImageEditor().getCropArea();if(!t){return}this._updateCropSize(Math.round(t.width),Math.round(t.height))};et.prototype._onImageLoaded=function(){var t=this.getImageEditor();this._resetValueStates();this._oModel.setProperty("/enabled",!!t.getSrc());if(!t.getSrc()){this._changeOptionsPanelContent();return}this["_setMode"+this.getMode()]();this._refreshImageSize();this._oModel.setProperty("/history",[]);this._oModel.setProperty("/historyIndex",0);this._zoomToFit();this._updateOrigThumbnail();this._resetCurrentPanel()};et.prototype._onCustomShapeLoaded=function(){var t=this.getImageEditor();if(t.getCustomShapeSrc()&&t.getLoaded()&&t.getMode()===D.CropCustomShape){this._setCustomShapeCropAreaRatio()}this._oModel.setProperty("/crop/customShapeLoaded",!!t.getCustomShapeSrc())};et.prototype._onImageError=function(){this._resetValueStates();this._changeOptionsPanelContent();this._oModel.setProperty("/enabled",false)};et.prototype._onCropAreaChange=function(t){this._resetValueStates();this._updateCropSize(Math.round(t.getParameter("cropArea").width),Math.round(t.getParameter("cropArea").height))};et.prototype._onHistoryChange=function(t){var e=t.getParameter("history"),o=t.getParameter("index");this._resetValueStates();this._refreshImageSize();e.push({noChange:"NoChange"});this._oModel.setProperty("/history",e);this._oModel.setProperty("/historyIndex",o)};et.prototype._onSizeChange=function(t){this._resetValueStates();this._updateCurrentSize(t.getParameter("width"),t.getParameter("height"));this._selectResizeCustomSizeItem(this.getImageEditor().getKeepResizeAspectRatio())};et.prototype._onZoomChange=function(t){var e=t.getParameter("zoom");this._oModel.setProperty("/zoom",e);this._refreshCropAreaSize()};et.prototype._updateCropSize=function(t,e){this._oModel.setProperty("/crop/width",t);this._oModel.setProperty("/crop/height",e)};et.prototype._updateCurrentSize=function(t,e){this._oModel.setProperty("/transform/width",t);this._oModel.setProperty("/transform/height",e)};et.prototype._updateOrigThumbnail=function(){var t=this.$("origThumbnail"),e=this.getImageEditor(),o,i,r=this._oThumbnailCanvas.getContext("2d");if(e.getWidth()>=e.getHeight()){o=300;i=Math.round(e.getHeight()*o/e.getWidth())}else{i=300;o=Math.round(e.getWidth()*i/e.getHeight())}this._oThumbnailCanvas.width=o;this._oThumbnailCanvas.height=i;r.clearRect(0,0,o,i);r.drawImage(e._oCanvas,0,0,o,i);t.attr({href:this._oThumbnailCanvas.toDataURL()});if(t[0]){t[0].setAttribute("viewBox","0 0 "+o+" "+i)}};et.prototype._getHeaderToolbar=function(){if(!this._oHeaderToolbar){this._oHeaderToolbar=new s({enabled:"{/enabled}"}).addStyleClass("sapSuiteUiCommonsImageEditorContainerHeaderToolbar");this._oHeaderToolbar.setModel(this._oModel);this.addDependent(this._oHeaderToolbar)}return this._oHeaderToolbar};et.prototype._destroyDisabledToolbarButtons=function(){const t=this.getEnabledButtons();[Z.Filter,Z.Transform,Z.Crop].forEach(function(e){if(t.indexOf(e)===-1){if(e===Z.Filter){if(this._oFilterButton){this._oFilterButton.destroy();this._oFilterButton=null}if(this._oMobileFilterButton){this._oMobileFilterButton.destroy();this._oMobileFilterButton=null}}if(e===Z.Crop){if(this._oCropButton){this._oCropButton.destroy();this._oCropButton=null}if(this._oMobileCropButton){this._oMobileCropButton.destroy();this._oMobileCropButton=null}}if(e===Z.Transform){if(this._oTransformButton){this._oTransformButton.destroy();this._oTransformButton=null}if(this._oMobileTransformButton){this._oMobileTransformButton.destroy();this._oMobileTransformButton=null}}}}.bind(this))};et.prototype._updateToolbarsContent=function(){var t=this._getHeaderToolbar(),e=this._getMobileHeaderToolbar(),o=this._getMobileFooterToolbar(),i=this.getEnabledButtons(),r;t.removeAllContent();e.removeAllContent();o.removeAllContent();this._destroyDisabledToolbarButtons();this._getHistoryItems().forEach(function(e){t.addContent(e)});this._getMobileHistoryItems().forEach(function(t){o.addContent(t)});this._getZoomItems().forEach(function(e){t.addContent(e)});t.addContent(this._getToolbarSeparator());for(r=0;r<i.length;r++){switch(i[r]){case Z.Filter:{t.addContent(this._getFilterButton());o.addContent(this._getMobileFilterButton());break}case Z.Crop:{t.addContent(this._getCropButton());o.addContent(this._getMobileCropButton());break}case Z.Transform:{t.addContent(this._getTransformButton());o.addContent(this._getMobileTransformButton());break}case Z.History:{break}default:break}}t.addContent(this._getToolbarSpacer());o.addContent(this._getMobileFooterToolbarSpacer());o.addContent(this._getMobileApplyButton());if(this.getCustomToolbarControls().length>0){e.addContent(this._getMobileHeaderToolbarSpacer())}this.getCustomToolbarControls().forEach(function(o){var i=new O,r=new O;this.addDependent(i);i.setAssociation("control",o);t.addContent(i);this.addDependent(r);r.setAssociation("control",o);e.addContent(r)},this)};et.prototype._getToolbarSpacer=function(){if(!this._oSpacer){this._oSpacer=new h({id:this.getId()+"-spacer"});this.addDependent(this._oSpacer)}return this._oSpacer};et.prototype._getMobileHeaderToolbarSpacer=function(){if(!this._oMobileHeaderSpacer){this._oMobileHeaderSpacer=new h({id:this.getId()+"-mobileSpacer"});this.addDependent(this._oMobileHeaderSpacer)}return this._oMobileHeaderSpacer};et.prototype._getMobileFooterToolbarSpacer=function(){if(!this._oMobileFooterSpacer){this._oMobileFooterSpacer=new h({id:this.getId()+"-mobileFooterSpacer"});this.addDependent(this._oMobileFooterSpacer)}return this._oMobileFooterSpacer};et.prototype._getMobileHeaderToolbar=function(){if(!this._oMobileHeaderToolbar){this._oMobileHeaderToolbar=new s({enabled:"{/enabled}",visible:false}).addStyleClass("sapSuiteUiCommonsImageEditorContainerMobileToolbar");this.addDependent(this._oMobileHeaderToolbar);this._oObserver.observe(this._oMobileHeaderToolbar,{aggregations:["content"]})}return this._oMobileHeaderToolbar};et.prototype._getMobileZoomToolbar=function(){if(!this._oMobileZoomToolbar){this._oMobileZoomToolbar=new s({enabled:"{/enabled}",content:[this._getMobileZoomInButton(),this._getMobileZoomLabel(),this._getMobileZoomOutButton(),this._getMobileZoomToFitButton(),this._getMobileScaleSwitch(),this._getMobileScaleLabel()]}).addStyleClass("sapSuiteUiCommonsImageEditorContainerMobileToolbar");this._oMobileZoomToolbar.setModel(this._oModel);this.addDependent(this._oMobileZoomToolbar)}return this._oMobileZoomToolbar};et.prototype._getMobileFooterToolbar=function(){if(!this._oMobileFooterToolbar){this._oMobileFooterToolbar=new s({enabled:"{/enabled}"}).addStyleClass("sapSuiteUiCommonsImageEditorContainerMobileToolbar");this._oMobileFooterToolbar.setModel(this._oModel);this.addDependent(this._oMobileFooterToolbar);if(this._oMobileFooterToolbar._applyContextClassFor){this._oMobileFooterToolbar._applyContextClassFor("footer")}else{P.warning("ImageEditorContainer: _applyContextClassFor method doesn't exist, footer look is not applied on mobile footer toolbar")}}return this._oMobileFooterToolbar};et.prototype._getHistoryPopover=function(){var t=this;if(!this._oHistoryPopover){this._oHistoryPopover=new _({title:{path:"/history",formatter:function(t){return G.getText("IMGEDITOR_HISTORY_TITLE",[t.length-1])}},endButton:new m({text:G.getText("IMGEDITOR_HISTORY_CLOSE"),press:function(){t._oHistoryPopover.close()}}),afterOpen:function(){var e=t._oModel.getProperty("/historyIndex"),o=t._oHistoryList.getItems()[e];t._oHistoryList.setSelectedItem(o);o.focus()}});this._oHistoryList=new I({mode:V.SingleSelectMaster,selectionChange:function(e){var o=e.getParameter("listItem"),i=o.getParent().indexOfItem(o);t._jumpToHistory(i)},items:{path:"/history",factory:this._historyItemFactory.bind(this)}});this._oHistoryPopover.setModel(this._oModel);this._oHistoryPopover.addContent(this._oHistoryList);this.addDependent(this._oHistoryPopover)}return this._oHistoryPopover};et.prototype._historyItemFactory=function(t,e){var o=this._oModel.getProperty("/history").indexOf(e.getProperty()),i=e.getProperty(),r,s,a,n;switch(i.noChange||i.getMetadata().getName()){case"sap.suite.ui.commons.imageeditor.RotateHistoryItem":{s=G.getText("IMGEDITOR_ROTATE");a=i.getDegrees();n=tt.TRANSFORM;break}case"sap.suite.ui.commons.imageeditor.ResizeHistoryItem":{s=G.getText("IMGEDITOR_RESIZE");a=G.getText("IMGEDITOR_HISTORY_TEXT",[i.getOldWidth()+" x "+i.getOldHeight(),i.getWidth()+" x "+i.getHeight()]);n=tt.TRANSFORM;break}case"sap.suite.ui.commons.imageeditor.FlipHistoryItem":{s=G.getText("IMGEDITOR_FLIP");if(i.getVertical()&&i.getHorizontal()){a=G.getText("IMGEDITOR_FLIP_BOTH");n=tt.FLIPHORIZONTAL}else{a=i.getVertical()?G.getText("IMGEDITOR_FLIP_VERTICAL"):G.getText("IMGEDITOR_FLIP_HORIZONTAL");n=i.getVertical()?tt.FLIPVERTICAL:tt.FLIPHORIZONTAL}break}case"sap.suite.ui.commons.imageeditor.FilterHistoryItem":{s=i.getType();s=s[0].toUpperCase()+s.slice(1);a=i.getValue();n=tt.FILTER;break}case"sap.suite.ui.commons.imageeditor.CropRectangleHistoryItem":case"sap.suite.ui.commons.imageeditor.CropEllipseHistoryItem":case"sap.suite.ui.commons.imageeditor.CropCustomShapeHistoryItem":{s=G.getText("IMGEDITOR_CROP");a=G.getText("IMGEDITOR_HISTORY_TEXT",[i.getOldWidth()+" x "+i.getOldHeight(),i.getWidth()+" x "+i.getHeight()]);n=tt.CROP;break}case"NoChange":{s=G.getText("IMGEDITOR_HISTORY_ORIGINAL");a=G.getText("IMGEDITOR_HISTORY_ORIGINAL_TEXT");n=tt.RESET;break}default:{break}}r=new f({title:s,description:a,icon:n,selected:{path:"/historyIndex",formatter:function(t){return o===t}}});return r};et.prototype._getHistoryItems=function(){if(!this._aHistoryItems){this._aHistoryItems=[this._getUndoButton(),this._getHistoryArrowButton()]}return this._aHistoryItems};et.prototype._getMobileHistoryItems=function(){if(!this._aMobileHistoryItems){this._aMobileHistoryItems=[this._getMobileUndoButton(),this._getMobileHistoryArrowButton()]}return this._aMobileHistoryItems};et.prototype._getUndoButton=function(){if(!this._oHistoryButton){this._oHistoryButton=this._createUndoButton(this.getId()+"-undoButton");this.addDependent(this._oHistoryButton)}return this._oHistoryButton};et.prototype._getMobileUndoButton=function(){if(!this._oMobileHistoryButton){this._oMobileHistoryButton=this._createUndoButton(this.getId()+"-mobileUndoButton");this.addDependent(this._oMobileHistoryButton)}return this._oMobileHistoryButton};et.prototype._createUndoButton=function(t){var e=this;return new a({id:t,type:U.Transparent,icon:tt.UNDO,enabled:{parts:["/history","/historyIndex"],formatter:function(t,e){return t.length>1&&e<t.length-1}},press:function(){e._undo()},tooltip:G.getText("IMGEDITOR_PANEL_UNDO")})};et.prototype._getHistoryArrowButton=function(){var t=this;if(!this._oHistoryArrowButton){this._oHistoryArrowButton=this._createHistoryArrowButton(this.getId()+"-historyButton",function(){t._resetValueStates();t._getHistoryPopover().openBy(t._oHistoryArrowButton)});this.addDependent(this._oHistoryArrowButton)}return this._oHistoryArrowButton};et.prototype._getMobileHistoryArrowButton=function(){var t=this;if(!this._oMobileHistoryArrowButton){this._oMobileHistoryArrowButton=this._createHistoryArrowButton(this.getId()+"-mobileHistoryButton",function(){t._resetValueStates();t._getHistoryPopover().openBy(t._oMobileHistoryArrowButton)});this.addDependent(this._oMobileHistoryArrowButton)}return this._oMobileHistoryArrowButton};et.prototype._createHistoryArrowButton=function(t,e){return new a({id:t,type:U.Transparent,icon:tt.DROPDOWN,enabled:{path:"/history",formatter:function(t){return t.length>1}},press:e,tooltip:G.getText("IMGEDITOR_PANEL_HISTORY")})};et.prototype._getZoomItems=function(){if(!this._aZoomItems){this._aZoomItems=[this._getZoomInButton(),this._getZoomLabel(),this._getZoomOutButton(),this._getZoomToFitButton()]}return this._aZoomItems};et.prototype._getZoomInButton=function(){if(!this._oZoomInButton){this._oZoomInButton=this._createZoomInButton(this.getId()+"-zoominButton");this.addDependent(this._oZoomInButton)}return this._oZoomInButton};et.prototype._getMobileZoomInButton=function(){if(!this._oMobileZoomInButton){this._oMobileZoomInButton=this._createZoomInButton(this.getId()+"-mobileZoominButton");this.addDependent(this._oMobileZoomInButton)}return this._oMobileZoomInButton};et.prototype._createZoomInButton=function(t){var e=this;return new a({id:t,type:U.Transparent,icon:tt.ZOOMIN,press:function(){var t=e.getImageEditor();t.zoomIn();e._oModel.setProperty("/zoom",t.getZoomLevel());e._refreshCropAreaSize()},tooltip:G.getText("IMGEDITOR_PANEL_ZOOMIN")})};et.prototype._getZoomLabel=function(){if(!this._oZoomLabel){this._oZoomLabel=this._createZoomLabel(this.getId()+"-zoomLabel");this.addDependent(this._oZoomLabel)}return this._oZoomLabel};et.prototype._getMobileZoomLabel=function(){if(!this._oMobileZoomLabel){this._oMobileZoomLabel=this._createZoomLabel(this.getId()+"-mobileZoomLabel");this.addDependent(this._oMobileZoomLabel)}return this._oMobileZoomLabel};et.prototype._createZoomLabel=function(t){return new d({id:t,text:{path:"/zoom",formatter:function(t){return t+"%"}}})};et.prototype._getZoomOutButton=function(){if(!this._oZoomOutButton){this._oZoomOutButton=this._createZoomOutButton(this.getId()+"-zoomoutButton");this.addDependent(this._oZoomOutButton)}return this._oZoomOutButton};et.prototype._getMobileZoomOutButton=function(){if(!this._oMobileZoomOutButton){this._oMobileZoomOutButton=this._createZoomOutButton(this.getId()+"-mobileZoomoutButton");this.addDependent(this._oMobileZoomOutButton)}return this._oMobileZoomOutButton};et.prototype._createZoomOutButton=function(t){var e=this;return new a({id:t,type:U.Transparent,icon:tt.ZOOMOUT,press:function(){var t=e.getImageEditor();t.zoomOut();e._oModel.setProperty("/zoom",t.getZoomLevel());e._refreshCropAreaSize()},tooltip:G.getText("IMGEDITOR_PANEL_ZOOMOUT")})};et.prototype._getZoomToFitButton=function(){if(!this._oZoomToFit){this._oZoomToFit=this._createZoomToFitButton(this.getId()+"-zoomToFitButton");this.addDependent(this._oZoomToFit)}return this._oZoomToFit};et.prototype._getMobileZoomToFitButton=function(){if(!this._oMobileZoomToFit){this._oMobileZoomToFit=this._createZoomToFitButton(this.getId()+"-mobileZoomToFitButton");this.addDependent(this._oMobileZoomToFit)}return this._oMobileZoomToFit};et.prototype._createZoomToFitButton=function(t){var e=this;return new a({id:t,type:U.Transparent,icon:tt.ZOOMFIT,press:e._zoomToFit.bind(e),tooltip:G.getText("IMGEDITOR_PANEL_ZOOMTOFIT")})};et.prototype._getScaleSwitch=function(){if(!this._oScaleSwitch){this._oScaleSwitch=this._createScaleSwitch(this.getId()+"-scaleSwitch");this.addDependent(this._oScaleSwitch)}return this._oScaleSwitch};et.prototype._getMobileScaleSwitch=function(){if(!this._oMobileScaleSwitch){this._oMobileScaleSwitch=this._createScaleSwitch(this.getId()+"-mobileScaleSwitch");this.addDependent(this._oMobileScaleSwitch)}return this._oMobileScaleSwitch};et.prototype._createScaleSwitch=function(t){var e=this;return new R({id:t,type:J.AcceptReject,state:"{/crop/scaleCropArea}",visible:{path:"/mode",formatter:function(t){return t==="Crop"}},change:function(t){e._setScaleCropArea(t.getParameter("state"))}}).addStyleClass("sapUiTinyMarginEnd")};et.prototype._getScaleLabel=function(){if(!this._oScaleLabel){this._oScaleLabel=this._createScaleLabel(this.getId()+"-scaleLabel");this.addDependent(this._oScaleLabel)}return this._oScaleLabel};et.prototype._getMobileScaleLabel=function(){if(!this._oMobileScaleLabel){this._oMobileScaleLabel=this._createScaleLabel(this.getId()+"-mobileScaleLabel");this.addDependent(this._oMobileScaleLabel)}return this._oMobileScaleLabel};et.prototype._createScaleLabel=function(t){return new d({text:G.getText("IMGEDITOR_CROP_SCALE"),labelFor:t,visible:{path:"/mode",formatter:function(t){return t==="Crop"}}})};et.prototype._getToolbarSeparator=function(){if(!this._oSeparator){this._oSeparator=new p({id:this.getId()+"-separator"});this.addDependent(this._oSeparator)}return this._oSeparator};et.prototype._getTransformButton=function(){if(!this._oTransformButton){this._oTransformButton=this._createTransformButton(this.getId()+"-transformButton");this.addDependent(this._oTransformButton)}return this._oTransformButton};et.prototype._getMobileTransformButton=function(){if(!this._oMobileTransformButton){this._oMobileTransformButton=this._createTransformButton(this.getId()+"-mobileTransformButton");this.addDependent(this._oMobileTransformButton)}return this._oMobileTransformButton};et.prototype._createTransformButton=function(t){return new n({id:t,icon:tt.TRANSFORM,type:U.Transparent,pressed:{path:"/mode",formatter:function(t){return t===N.Transform}},enabled:{path:"/mode",formatter:function(t){return t!==N.Transform}},press:this._onButtonPress.bind(this,this._setModeTransform.bind(this)),tooltip:G.getText("IMGEDITOR_PANEL_TRANSFORM")})};et.prototype._getCropButton=function(){if(!this._oCropButton){this._oCropButton=this._createCropButton(this.getId()+"-cropButton");this.addDependent(this._oCropButton)}return this._oCropButton};et.prototype._getMobileCropButton=function(){if(!this._oMobileCropButton){this._oMobileCropButton=this._createCropButton(this.getId()+"-mobileCropButton");this.addDependent(this._oMobileCropButton)}return this._oMobileCropButton};et.prototype._createCropButton=function(t){return new n({id:t,icon:tt.CROP,type:U.Transparent,pressed:{path:"/mode",formatter:function(t){return t===N.Crop}},enabled:{path:"/mode",formatter:function(t){return t!==N.Crop}},press:this._onButtonPress.bind(this,this._setModeCrop.bind(this)),tooltip:G.getText("IMGEDITOR_PANEL_CROP")})};et.prototype._getFilterButton=function(){if(!this._oFilterButton){this._oFilterButton=this._createFilterButton(this.getId()+"-filterButton");this.addDependent(this._oFilterButton)}return this._oFilterButton};et.prototype._getMobileFilterButton=function(){if(!this._oMobileFilterButton){this._oMobileFilterButton=this._createFilterButton(this.getId()+"-mobileFilterButton");this.addDependent(this._oMobileFilterButton)}return this._oMobileFilterButton};et.prototype._createFilterButton=function(t){return new n({id:t,icon:tt.FILTER,type:U.Transparent,pressed:{path:"/mode",formatter:function(t){return t===N.Filter}},enabled:{path:"/mode",formatter:function(t){return t!==N.Filter}},press:this._onButtonPress.bind(this,this._setModeFilter.bind(this)),tooltip:G.getText("IMGEDITOR_PANEL_FILTER")})};et.prototype._getMobileApplyButton=function(){if(!this._oMobileApplyButton){this._oMobileApplyButton=new m({id:this.getId()+"-mobileApplyButton",text:G.getText("IMGEDITOR_APPLY"),type:U.Default,press:this._applyPreview.bind(this)})}return this._oMobileApplyButton};et.prototype._changeOptionsPanelContent=function(t){var e=this._getOptionsPanel();e.removeAllItems();if(!this.getImageEditor()||!this.getImageEditor().getLoaded()||!t){return}t().forEach(function(t){e.addItem(t)})};et.prototype._onButtonPress=function(t){this.getImageEditor()._cancelPreview();t()};et.prototype._setModeTransform=function(t){this._changeOptionsPanelContent(this._getTransformPanelContent.bind(this));if(this.getImageEditor()){this.getImageEditor().setMode(D.Resize)}if(this.getMode()!==N.Transform){this.setProperty("mode",N.Transform,true)}this._setTransformTypeByKey(t||"Resize");this._oModel.setProperty("/mode",N.Transform)};et.prototype._setModeCrop=function(t){this._changeOptionsPanelContent(this._getCropPanelContent.bind(this));if(this.getImageEditor()){this._setCropTypeByKey(t||"Rectangle")}if(this.getMode()!==N.Crop){this.setProperty("mode",N.Crop,true)}this._oModel.setProperty("/mode",N.Crop);this._setScaleCropArea(this._oModel.getProperty("/crop/scaleCropArea"))};et.prototype._setModeFilter=function(){this._changeOptionsPanelContent(this._getFilterPanelContent.bind(this));if(this.getImageEditor()){this.getImageEditor().setMode(D.Default)}if(this.getMode()!==N.Filter){this.setProperty("mode",N.Filter,true)}this._resetFilterValues();this._selectFilterItem(0);this._oModel.setProperty("/mode",N.Filter)};et.prototype._constraintValue=function(t,e,o){var i=o.getBinding("value"),r=o.getBinding("valueState"),s=o.getBinding("valueStateText"),a;if(isNaN(t)||t<e.min||t>e.max){a=G.getText("IMGEDITOR_BAD_NUMBER",[e.min,e.max]);t=this._oModel.getProperty(i.getPath())}if(a){this._oModel.setProperty(r.getPath(),k.Warning);this._oModel.setProperty(s.getPath(),a)}this._oModel.setProperty(i.getPath(),t);o.setValue(t);return t};et.prototype._onNumberInputChange=function(t,e){var o=e.getParameter("value"),i=e.getParameter("newValue"),r;this._resetValueStates();if(typeof o==="number"){r=o}else if(typeof i==="number"){r=i}else{r=parseInt(e.getParameter("value")||e.getParameter("newValue"),10)}r=this._constraintValue(r,t,e.getSource());this[t.callback](r)};et.prototype._setRatio=function(t,e){if(!this.getImageEditor()||!this.getImageEditor().getLoaded()){return}this.getImageEditor().setCropAreaByRatio(t,e);this._refreshCropAreaSize()};et.prototype._setCropAreaBySize=function(t,e){this.getImageEditor().setCropAreaBySize(t,e);this._refreshCropAreaSize()};et.prototype._setRatioByKey=function(t){if(t==="Rectangle"){this._setRatio(this._oModel.getProperty("/crop/ratiosRectangle/1/width"),this._oModel.getProperty("/crop/ratiosRectangle/1/height"))}else if(t==="Ellipse"){this._setRatio(1,1)}else if(t==="CustomShape"&&this.getImageEditor().getCustomShapeLoaded()){this._setCustomShapeCropAreaRatio()}};et.prototype._setCustomShapeCropAreaRatio=function(){this.getImageEditor().setCustomShapeCropAreaRatio();this._refreshCropAreaSize()};et.prototype._setTransformTypeByKey=function(t){var e=t==="Resize"?D.Resize:D.Default;if(t==="Resize"){this._refreshImageSize();this._selectResizeCustomSizeItem()}else if(t==="Rotate"){this._oModel.setProperty("/transform/rotate",0)}else if(t==="Flip"){this._resetFlips()}this._oModel.setProperty("/transform/selectedTypeKey",t);this._resetValueStates();if(this.getImageEditor()){this.getImageEditor()._cancelPreview();this.getImageEditor().setMode(e)}};et.prototype._setCropTypeByKey=function(t,e){var o=this._oModel.getProperty("/crop/types").filter(function(e){return e.key===t})[0];this._setRatioByKey(t);this._oModel.setProperty("/crop/selectedTypeKey",t);this._oModel.setProperty("/crop/selectedType",o);if(this["_select"+t+"CropCustomSizeItem"]){this["_select"+t+"CropCustomSizeItem"](e)}this.getImageEditor().setMode("Crop"+t);this._resetValueStates()};et.prototype._resetCurrentPanel=function(){this.getImageEditor().cancelPreview();switch(this.getMode()){case N.Transform:{this._setTransformTypeByKey(this._oModel.getProperty("/transform/selectedTypeKey"));break}case N.Crop:{this._setCropTypeByKey(this._oModel.getProperty("/crop/selectedTypeKey"));break}case N.Filter:{this._selectFilterItem(this._getSelectedFilterIndex());break}default:break}this._resetValueStates()};et.prototype._undo=function(){this.getImageEditor().undo();this._resetCurrentPanel()};et.prototype._redo=function(){this.getImageEditor().redo();this._resetCurrentPanel()};et.prototype._jumpToHistory=function(t){this.getImageEditor().jumpToHistory(t);this._resetCurrentPanel()};et.prototype._setZoom=function(t){this._oModel.setProperty("/zoom",t);this.getImageEditor().zoom(t);this._refreshCropAreaSize()};et.prototype._setWidth=function(t){this.getImageEditor().setWidth(t,true);this._oModel.setProperty("/transform/height",this.getImageEditor().getPreviewHeight());this._selectResizeCustomSizeItem(this.getImageEditor().getKeepResizeAspectRatio())};et.prototype._setHeight=function(t){this.getImageEditor().setHeight(t,true);this._oModel.setProperty("/transform/width",this.getImageEditor().getPreviewWidth());this._selectResizeCustomSizeItem(this.getImageEditor().getKeepResizeAspectRatio())};et.prototype._setSize=function(t,e,o){if(o){t=this.getImageEditor().getWidth()*t;e=this.getImageEditor().getHeight()*e}this._updateCurrentSize(t,e);if(this.getImageEditor().getPreviewWidth()===t&&this.getImageEditor().getPreviewHeight()===e){return}this.getImageEditor().setSize(t,e,true)};et.prototype._rotate=function(t){t=t>r.LIMITS.ROTATION_MAX?r.LIMITS.ROTATION_MAX:t;t=t<r.LIMITS.ROTATION_MIN?r.LIMITS.ROTATION_MIN:t;this._oModel.setProperty("/transform/rotate",t);this.getImageEditor().rotate(t,true)};et.prototype._flip=function(t,e){this.getImageEditor().flip(t,e,true)};et.prototype._setKeepResizeAspectRatio=function(t){this._oModel.setProperty("/transform/keepAspectRatio",t);if(this.getImageEditor()){this.getImageEditor().setKeepResizeAspectRatio(t)}};et.prototype._getKeepCropAspectRatio=function(){return this._oModel.getProperty("/crop/keepAspectRatio")};et.prototype._setKeepCropAspectRatio=function(t){this._oModel.setProperty("/crop/keepAspectRatio",t);if(this.getImageEditor()){this.getImageEditor().setKeepCropAspectRatio(t)}};et.prototype._setScaleCropArea=function(t){this._oModel.setProperty("/crop/scaleCropArea",t);if(this.getImageEditor()){this.getImageEditor().setScaleCropArea(t)}};et.prototype._applyCurrentFilter=function(t){var e=this._oModel.getProperty("/filter/selectedFilter");if(typeof t!=="undefined"){this._oModel.setProperty("/filter/selectedFilter/value",t)}this.getImageEditor()[e.type](e.value,true)};et.prototype._resetFilterValues=function(){var t=this._oModel.getProperty("/filter/filters");t.forEach(function(t,e){this._oModel.setProperty("/filter/filters/"+e+"/value",t.defaultValue)},this)};et.prototype._resetValueStates=function(){var t=["/transform/widthValueState","/transform/heightValueState","/transform/rotateValueState","/crop/widthValueState","/crop/heightValueState","/filter/filterValueState"];t.forEach(function(t){this._oModel.setProperty(t,k.None)},this)};et.prototype._resetFlips=function(){this._oModel.setProperty("/transform/flipVertical",false);this._oModel.setProperty("/transform/flipHorizontal",false)};et.prototype._applyPreview=function(){this.getImageEditor().applyPreview();this._resetValueStates();switch(this.getMode()){case N.Transform:{switch(this._oModel.getProperty("/transform/selectedTypeKey")){case"Resize":{this._refreshImageSize();break}case"Rotate":{this._oModel.setProperty("/transform/rotate",0);this._refreshImageSize();break}case"Flip":{this._resetFlips();break}default:break}break}case N.Crop:{var t=this._oModel.getProperty("/crop/selectedType/apply");if(t){this.getImageEditor()[t]()}this._refreshImageSize();this._setRatioByKey(this._oModel.getProperty("/crop/selectedTypeKey"));this._deselectCropItem();this.getImageEditor().setMode(D.Default);break}case N.Filter:{this._resetFilterValues();break}default:break}};et.prototype._createGridList=function(t,e,o){var i=this;var r=new I({width:"auto",mode:"SingleSelectMaster",itemPress:function(t){i._resetValueStates();o.call(i,t)},items:{path:t,factory:e.bind(this)}}).addStyleClass("sapSuiteUiCommonsImageEditorContainerGridList");r.setModel(this._oModel);if(!r._oItemNavigation){r._startItemNavigation()}if(r._oItemNavigation){r._oItemNavigation.setColumns(2)}return r};et.prototype._selectResizeCustomSizeItem=function(t){var e=this._getResizeGridList(),o=e.getItems()[0];e.setSelectedItem(o);this._setKeepResizeAspectRatio(!!t)};et.prototype._deselectCropItem=function(){this._getRectangleCropGridList().removeSelections();this._getEllipseCropGridList().removeSelections();this._disableCrop()};et.prototype._disableCrop=function(){this._oModel.setProperty("/crop/enabled",false)};et.prototype._enableCrop=function(){this._oModel.setProperty("/crop/enabled",true)};et.prototype._selectRectangleCropCustomSizeItem=function(t){var e=this._getRectangleCropGridList(),o=e.getItems()[0];e.setSelectedItem(o);this._setKeepCropAspectRatio(!!t);this._enableCrop()};et.prototype._selectEllipseCropCustomSizeItem=function(t){var e=this._getEllipseCropGridList(),o=e.getItems()[0];e.setSelectedItem(o);this._setKeepCropAspectRatio(!!t);this._enableCrop()};et.prototype._selectCustomShapeCropCustomSizeItem=function(t){var e=this._getCustomShapeCropGridList(),o=e.getItems()[0];e.setSelectedItem(o);this._setKeepCropAspectRatio(!!t);this._enableCrop()};et.prototype._selectFilterItem=function(t){var e=this._getFilterGridList(),o=e.getItems()[t];this._oModel.setProperty("/filter/selectedFilter",o.getBindingContext().getProperty());this._oModel.setProperty("/filter/selectedFilter/value",this._oModel.getProperty("/filter/selectedFilter/defaultValue"));e.setSelectedItem(o)};et.prototype._getSelectedFilterIndex=function(){var t=this._oModel.getProperty("/filter/selectedFilter"),e=t?this._oModel.getProperty("/filter/filters").indexOf(t):0;return e};et.prototype._getResizeGridList=function(){if(!this._oGridListResize){this._oGridListResize=this._createGridList("/transform/resizes",this._gridRectShapeItemFactory,this._onResizeGridListSelectionChange)}return this._oGridListResize};et.prototype._onResizeGridListSelectionChange=function(t){var e=t.getParameter("listItem"),o=e.getBindingContext();if(o.getProperty("width")){this._setSize(o.getProperty("width"),o.getProperty("height"),o.getProperty("relative"))}this._setKeepResizeAspectRatio(!o.getProperty("unlockRatio"))};et.prototype._getRotateGridList=function(){if(!this._oGridListRotate){this._oGridListRotate=this._createGridList("/transform/rotates",this._gridRectShapeItemFactory,this._onRotateGridListSelectionChange)}return this._oGridListRotate};et.prototype._onRotateGridListSelectionChange=function(t){var e=t.getParameter("listItem"),o=e.getBindingContext();this._getRotateGridList().removeSelections();this._rotate(this._oModel.getProperty("/transform/rotate")+o.getProperty("rotate"))};et.prototype._getFlipGridList=function(){if(!this._oGridListFlip){this._oGridListFlip=this._createGridList("/transform/flips",this._gridRectShapeItemFactory,this._onFlipGridListSelectionChange)}return this._oGridListFlip};et.prototype._onFlipGridListSelectionChange=function(t){var e=t.getParameter("listItem"),o=e.getBindingContext(),i=this._oModel.getProperty("/transform/flipVertical"),r=this._oModel.getProperty("/transform/flipHorizontal");this._getFlipGridList().removeSelections();i=i!==o.getProperty("flipVertical");r=r!==o.getProperty("flipHorizontal");this._oModel.setProperty("/transform/flipVertical",i);this._oModel.setProperty("/transform/flipHorizontal",r);this._flip(i,r)};et.prototype._getRectangleCropGridList=function(){if(!this._oGridListRectCrop){this._oGridListRectCrop=this._createGridList("/crop/ratiosRectangle",this._gridRectShapeItemFactory,this._onRectCropGridListSelectionChange)}return this._oGridListRectCrop};et.prototype._onRectCropGridListSelectionChange=function(t){var e=t.getParameter("listItem");this._onGridListSelectionChange(e,D.CropRectangle)};et.prototype._getEllipseCropGridList=function(){if(!this._oGridListEllipseCrop){this._oGridListEllipseCrop=this._createGridList("/crop/ratiosCircle",this._gridCircleShapeItemFactory,this._onEllipseCropGridListSelectionChange)}return this._oGridListEllipseCrop};et.prototype._onEllipseCropGridListSelectionChange=function(t){var e=t.getParameter("listItem");this._onGridListSelectionChange(e,D.CropEllipse)};et.prototype._getCustomShapeCropGridList=function(){if(!this._oGridListCustomShapeCrop){this._oGridListCustomShapeCrop=this._createGridList("/crop/ratiosCustomShape",this._gridRectShapeItemFactory,this._onCustomShapeCropGridListSelectionChange);this._oGridListCustomShapeCrop.setModel(this._oModel)}return this._oGridListCustomShapeCrop};et.prototype._onCustomShapeCropGridListSelectionChange=function(t){var e=t.getParameter("listItem");this._onGridListSelectionChange(e,D.CropCustomShape)};et.prototype._onGridListSelectionChange=function(t,e){var o=t.getBindingContext(),i=this.getImageEditor();i.setMode(e);if(o.getProperty("callback")){this[o.getProperty("callback")]()}if(o.getProperty("width")&&o.getProperty("relative")){this._setRatio(o.getProperty("width"),o.getProperty("height"))}else if(o.getProperty("width")&&!o.getProperty("relative")){this._setCropAreaBySize(o.getProperty("width"),o.getProperty("height"))}this._enableCrop();this._setKeepCropAspectRatio(!o.getProperty("unlockRatio"))};et.prototype._getFilterGridList=function(){if(!this._oGridListFilter){this._oGridListFilter=this._createGridList("/filter/filters",this._gridFilterItemFactory,this._onFilterGridListSelectionChange)}return this._oGridListFilter};et.prototype._onFilterGridListSelectionChange=function(t){var e=t.getParameter("listItem"),o=e.getBindingContext();this._resetFilterValues();this._oModel.setProperty("/filter/selectedFilter",o.getProperty());this.getImageEditor().cancelPreview();this.getImageEditor()[o.getProperty("type")](o.getProperty("value"),true)};et.prototype._gridRectShapeItemFactory=function(t,e){var o;if(e.getProperty("icon")){o=new T({renderType:W.Bare,alignItems:j.Center,justifyContent:X.Center,items:[new M({src:"{icon}"})]}).addStyleClass("sapSuiteUiCommonsImageEditorContainerGridItemIcon")}else{o=this._createGridItemRectShape(e.getProperty("width"),e.getProperty("height"))}return this._createGridListItem(o)};et.prototype._gridCircleShapeItemFactory=function(t,e){var o;if(e.getProperty("icon")){o=new T({renderType:W.Bare,alignItems:j.Center,justifyContent:X.Center,items:[new M({src:"{icon}"})]}).addStyleClass("sapSuiteUiCommonsImageEditorContainerGridItemIcon")}else{o=this._createGridItemCircleShape(e.getProperty("width"),e.getProperty("height"))}return this._createGridListItem(o)};et.prototype._refreshGridListsItems=function(){var t=this,e=[{path:"/transform/resizes",fnGetItems:this.getCustomResizeItems.bind(this)},{path:"/crop/ratiosRectangle",fnGetItems:this.getCustomRectangleCropItems.bind(this)},{path:"/crop/ratiosCircle",fnGetItems:this.getCustomEllipseCropItems.bind(this)}];this.getCustomResizeItems().forEach(function(t){if(t.getRelative()&&!t.getIcon()){t.setIcon(tt.RELATIVE)}});e.forEach(function(e){var o=t._oModel.getProperty(e.path),i=o.slice(0,ot.NUM_KEPT_ITEMS);e.fnGetItems().forEach(function(t){if(t.getWidth()>0&&t.getHeight()>0){i.push({width:t.getWidth(),height:t.getHeight(),text:t.getLabel(),icon:t.getIcon(),relative:t.getRelative()})}});t._oModel.setProperty(e.path,i)})};et.prototype._createGridListItem=function(t){return new y({type:z.Active,content:[t,new d({text:"{text}",wrapping:false,textAlign:q.Center,layoutData:[new C({growFactor:0,shrinkFactor:0,baseSize:"auto"})]}).addStyleClass("sapSuiteUiCommonsImageEditorContainerGridItemLabel")]}).addStyleClass("sapSuiteUiCommonsImageEditorContainerGridItem")};et.prototype._createGridItemRectShape=function(t,e){var o,i;if(t<100){t*=10;e*=10}else if(t>100){t/=10;e/=10}o=document.createElementNS("http://www.w3.org/2000/svg","svg");o.setAttribute("class","sapSuiteUiCommonsImageEditorContainerGridItemHeaderContent");o.setAttribute("viewBox","-1 -1 "+(t+2)+" "+(e+2));i=document.createElement("rect");i.setAttribute("x","0");i.setAttribute("y","0");i.setAttribute("width",t);i.setAttribute("height",e);o.appendChild(i);return new E({content:(new XMLSerializer).serializeToString(o)})};et.prototype._createGridItemCircleShape=function(t,e){var o,i;t*=100;e*=100;o=document.createElementNS("http://www.w3.org/2000/svg","svg");o.setAttribute("class","sapSuiteUiCommonsImageEditorContainerGridItemHeaderContent");o.setAttribute("viewBox","-"+(t+2)+" -"+(e+2)+" "+(t*2+4)+" "+(e*2+4));i=document.createElement("ellipse");i.setAttribute("cx","0");i.setAttribute("cy","0");i.setAttribute("rx",t);i.setAttribute("ry",e);o.appendChild(i);return new E({content:(new XMLSerializer).serializeToString(o)})};et.prototype._gridFilterItemFactory=function(t,e){var o,i,r;i=document.createElementNS("http://www.w3.org/2000/svg","svg");i.setAttribute("class","sapSuiteUiCommonsImageEditorContainerGridItemHeaderContent sapSuiteUiCommonsImageEditorContainerGridItemHeaderFilterContent");r=document.createElementNS("http://www.w3.org/2000/svg","use");r.setAttribute("href","#"+this.getId()+"-origThumbnail");r.setAttribute("filter","url(#"+this.getId()+"-"+e.getProperty("type")+")");i.appendChild(r);o=new E({content:(new XMLSerializer).serializeToString(i)});return this._createGridListItem(o)};et.prototype._getTransformPanelContent=function(){var t=this;if(!this._oTransformToolbarContent){this._oTransformToolbarContent=[new u({min:r.LIMITS.ROTATION_MIN,max:r.LIMITS.ROTATION_MAX,showAdvancedTooltip:true,visible:{path:"/transform/selectedTypeKey",formatter:function(t){return t==="Rotate"}},value:{path:"/transform/rotate",mode:"OneWay"},liveChange:this._onNumberInputChange.bind(this,Q.ROTATION),progress:true,ariaLabelledBy:[this.getId()+"-transformAngle"]}).addStyleClass("sapSuiteUiCommonsImageEditorContainerMobileSlider"),new b({tabDensityMode:Y.Compact,backgroundDesign:$.Transparent,headerBackgroundDesign:$.Transparent,expandable:false,select:function(e){var o=e.getParameter("key");t._setTransformTypeByKey(o)},selectedKey:"{/transform/selectedTypeKey}",items:[new S({key:"Resize",text:G.getText("IMGEDITOR_RESIZE"),content:[this._getResizeGridList(),new T({renderType:W.Bare,direction:K.Column,items:[new T({renderType:W.Bare,justifyContent:X.SpaceBetween,items:[new T({renderType:W.Bare,direction:K.Column,items:[new d({text:G.getText("IMGEDITOR_WIDTH"),labelFor:this.getId()+"-transformWidth"}),new g({id:this.getId()+"-transformWidth",type:H.Number,textAlign:q.Right,change:this._onNumberInputChange.bind(this,Q.WIDTH),value:{path:"/transform/width",type:new F,mode:"OneWay"},valueState:"{/transform/widthValueState}",valueStateText:"{/transform/widthValueStateText}",width:"5.9375rem",fieldWidth:"4.375rem",description:G.getText("IMGEDITOR_PX")})]}),new T({renderType:W.Bare,direction:K.Column,justifyContent:X.End,items:[new l({tooltip:G.getText("IMGEDITOR_LOCK_RATIO"),icon:tt.LOCK,type:U.Transparent,pressed:{path:"/transform/keepAspectRatio"},press:function(e){t._resetValueStates();t.getImageEditor().setKeepResizeAspectRatio(e.getParameter("pressed"));t._selectResizeCustomSizeItem(e.getParameter("pressed"))}})]}),new T({renderType:W.Bare,direction:K.Column,items:[new d({text:G.getText("IMGEDITOR_HEIGHT"),labelFor:this.getId()+"-transformHeight"}),new g({id:this.getId()+"-transformHeight",type:H.Number,textAlign:q.Right,change:this._onNumberInputChange.bind(this,Q.HEIGHT),value:{path:"/transform/height",type:new F,mode:"OneWay"},valueState:"{/transform/heightValueState}",valueStateText:"{/transform/heightValueStateText}",width:"5.9375rem",fieldWidth:"4.375rem",description:G.getText("IMGEDITOR_PX")})]})]}),new m({width:"50%",text:G.getText("IMGEDITOR_APPLY"),type:U.Default,press:this._applyPreview.bind(this)})]}).addStyleClass("sapSuiteUiCommonsImageEditorContainerPanelArea")]}),new S({key:"Rotate",text:G.getText("IMGEDITOR_ROTATE"),content:[this._getRotateGridList(),new T({renderType:W.Bare,direction:K.Column,items:[new d({id:this.getId()+"-transformAngle",text:G.getText("IMGEDITOR_TRANSFORM_ANGLE")}),new u({min:r.LIMITS.ROTATION_MIN,max:r.LIMITS.ROTATION_MAX,value:{path:"/transform/rotate",mode:"OneWay"},liveChange:this._onNumberInputChange.bind(this,Q.ROTATION),progress:true,ariaLabelledBy:[this.getId()+"-transformAngle"]}),new g({type:H.Number,textAlign:q.Right,width:"50%",fieldWidth:"50%",description:G.getText("IMGEDITOR_TRANSFORM_DEG"),change:this._onNumberInputChange.bind(this,Q.ROTATION),value:{path:"/transform/rotate",type:new F,mode:"OneWay"},valueState:"{/transform/rotateValueState}",valueStateText:"{/transform/rotateValueStateText}",ariaLabelledBy:[this.getId()+"-transformAngle"]}),new m({width:"50%",text:G.getText("IMGEDITOR_APPLY"),type:U.Default,press:this._applyPreview.bind(this)})]}).addStyleClass("sapSuiteUiCommonsImageEditorContainerPanelArea")]}),new S({key:"Flip",text:G.getText("IMGEDITOR_FLIP"),content:[this._getFlipGridList(),new T({renderType:W.Bare,direction:K.Column,items:[new m({width:"50%",text:G.getText("IMGEDITOR_APPLY"),type:U.Default,press:this._applyPreview.bind(this)})]}).addStyleClass("sapSuiteUiCommonsImageEditorContainerPanelArea")]})]}).addStyleClass("sapSuiteUiCommonsImageEditorContainerTabBar")];this._oTransformToolbarContent.forEach(function(t){this.addDependent(t)},this)}return this._oTransformToolbarContent};et.prototype._onCropSizeInputChange=function(t,e){var o=this._oModel.getProperty("/crop/width"),i=this._oModel.getProperty("/crop/height"),r=this._getKeepCropAspectRatio(),s,a,n,l,p,h=parseInt(e.getParameter("value"),10);h=isNaN(h)?0:h;if(t==="width"){n=o;s=h;a=r?s*i/o:i;p=this.getImageEditor()._getMaxCropAreaWidth(true);l=this.getImageEditor()._getMinCropAreaWidth(true)}else{n=i;a=h;s=r?a*o/i:o;p=this.getImageEditor()._getMaxCropAreaHeight(true);l=this.getImageEditor()._getMinCropAreaHeight(true)}this._resetValueStates();if(h>p||h<l){e.getSource().setValue(n);this._oModel.setProperty("/crop/"+t+"ValueState",k.Warning);this._oModel.setProperty("/crop/"+t+"ValueStateText",G.getText("IMGEDITOR_BAD_NUMBER",[l,p]))}else{this._setCropAreaBySize(s,a)}};et.prototype._getCropPanelContent=function(){var t=this;if(!this._oCropToolbarContent){this._oCropToolbarContent=[new b({tabDensityMode:Y.Compact,backgroundDesign:$.Transparent,headerBackgroundDesign:$.Transparent,expandable:false,select:function(e){var o=e.getParameter("key");t._setCropTypeByKey(o)},selectedKey:"{/crop/selectedTypeKey}",items:[new S({tooltip:G.getText("IMGEDITOR_CROP_RECTANGLE"),key:"Rectangle",text:"",content:[this._getRectangleCropGridList()]}),new S({tooltip:G.getText("IMGEDITOR_CROP_ELLIPSE"),key:"Ellipse",text:"",content:[this._getEllipseCropGridList()]}),new S({tooltip:G.getText("IMGEDITOR_CROP_CUSTOM"),key:"CustomShape",text:"",content:[this._getCustomShapeCropGridList(),this._getCustomShapeCropContent()]})]}).addStyleClass("sapSuiteUiCommonsImageEditorContainerTabBar").addStyleClass("sapSuiteUiCommonsImageEditorContainerFilterIcons"),new T({renderType:W.Bare,direction:K.Column,items:[new T({renderType:W.Bare,justifyContent:X.SpaceBetween,items:[new T({renderType:W.Bare,direction:K.Column,items:[new d({text:G.getText("IMGEDITOR_WIDTH"),labelFor:this.getId()+"-cropWidth"}),new g({id:this.getId()+"-cropWidth",type:H.Number,textAlign:q.Right,value:{path:"/crop/width",mode:"OneWay",type:new F},valueState:"{/crop/widthValueState}",valueStateText:"{/crop/widthValueStateText}",width:"5.9375rem",fieldWidth:"4.375rem",description:G.getText("IMGEDITOR_PX"),change:this._onCropSizeInputChange.bind(this,"width"),enabled:{parts:["/crop/selectedTypeKey","/crop/customShapeLoaded","/crop/enabled"],formatter:function(t,e,o){return!(t==="CustomShape"&&!e)&&o}}})]}),new T({renderType:W.Bare,direction:K.Column,justifyContent:X.End,items:[new l({tooltip:G.getText("IMGEDITOR_LOCK_RATIO"),icon:tt.LOCK,type:U.Transparent,pressed:{path:"/crop/keepAspectRatio"},press:function(e){var o=t.getImageEditor().getMode(),i,r;t._resetValueStates();if(t._oModel.getProperty("/crop/selectedTypeKey")==="Rectangle"){i=D.CropRectangle;r=t._selectRectangleCropCustomSizeItem.bind(t)}else if(t._oModel.getProperty("/crop/selectedTypeKey")==="Ellipse"){i=D.CropEllipse;r=t._selectEllipseCropCustomSizeItem.bind(t)}else{i=D.CropCustomShape;r=t._selectCustomShapeCropCustomSizeItem.bind(t)}if(o!==i){t.getImageEditor().setMode(i)}if(r){r(e.getParameter("pressed"))}}})]}),new T({renderType:W.Bare,direction:K.Column,items:[new d({text:G.getText("IMGEDITOR_HEIGHT"),labelFor:this.getId()+"-cropHeight"}),new g({id:this.getId()+"-cropHeight",type:H.Number,textAlign:q.Right,value:{path:"/crop/height",mode:"OneWay",type:new F},valueState:"{/crop/heightValueState}",valueStateText:"{/crop/heightValueStateText}",width:"5.9375rem",fieldWidth:"4.375rem",description:G.getText("IMGEDITOR_PX"),change:this._onCropSizeInputChange.bind(this,"height"),enabled:{parts:["/crop/selectedTypeKey","/crop/customShapeLoaded","/crop/enabled"],formatter:function(t,e,o){return!(t==="CustomShape"&&!e)&&o}}})]})]}),new T({renderType:W.Bare,alignItems:j.Center,items:[this._getScaleSwitch(),this._getScaleLabel()]}).addStyleClass("sapUiSmallMarginTopBottom"),new m({width:"50%",text:G.getText("IMGEDITOR_APPLY"),type:U.Default,press:this._applyPreview.bind(this),enabled:{parts:["/crop/selectedTypeKey","/crop/customShapeLoaded","/crop/enabled"],formatter:function(t,e,o){return!(t==="CustomShape"&&!e)&&o}}})]}).addStyleClass("sapSuiteUiCommonsImageEditorContainerPanelArea")];this._oCropToolbarContent.forEach(function(t){this.addDependent(t)},this)}return this._oCropToolbarContent};et.prototype._getCustomShapeCropContent=function(){var t=this;if(!this.oCustomShapeContent){this.oCustomShapeContent=new T({renderType:W.Bare,direction:K.Column,items:[new d({text:G.getText("IMGEDITOR_CROP_CUSTOM_FILE"),labelFor:this.getId()+"-customFile"}),new L({id:this.getId()+"-customFile",mimeType:"image/*",change:function(e){var o=e.getParameter("files")[0];if(!o){return}t._resetValueStates();t._enableCrop();t.getImageEditor().setMode(D.CropCustomShape);t.getImageEditor().setCustomShapeSrc(o)}})]}).addStyleClass("sapSuiteUiCommonsImageEditorContainerPanelArea").addStyleClass("sapSuiteUiCommonsImageEditorContainerPanelAreaMobile");this.addDependent(this.oCustomShapeContent)}return this.oCustomShapeContent};et.prototype._getFilterPanelContent=function(){var t=this;if(!this._oFilterToolbarContent){this._oFilterToolbarContent=[new u({min:"{/filter/selectedFilter/min}",max:"{/filter/selectedFilter/max}",showAdvancedTooltip:true,value:{path:"/filter/selectedFilter/value",mode:"OneWay"},liveChange:this._onNumberInputChange.bind(this,Q.FILTER),progress:true,ariaLabelledBy:[this.getId()+"-filterValue"]}).addStyleClass("sapSuiteUiCommonsImageEditorContainerMobileSlider"),this._getFilterGridList(),new T({renderType:W.Bare,direction:K.Column,items:[new u({min:"{/filter/selectedFilter/min}",max:"{/filter/selectedFilter/max}",value:{path:"/filter/selectedFilter/value",mode:"OneWay"},liveChange:this._onNumberInputChange.bind(this,Q.FILTER),progress:true,ariaLabelledBy:[this.getId()+"-filterValue"]}),new d({id:this.getId()+"-filterValue",text:G.getText("IMGEDITOR_FILTER_VALUE")}),new g({type:H.Number,textAlign:q.Right,width:"5.9375rem",fieldWidth:"4.375rem",description:"{/filter/selectedFilter/unit}",change:function(e){t._onNumberInputChange(jQuery.extend(Q.FILTER,t._oModel.getProperty("/filter/selectedFilter")),e)},value:{path:"/filter/selectedFilter/value",type:new F,mode:"OneWay"},valueState:"{/filter/filterValueState}",valueStateText:"{/filter/filterValueStateText}",ariaLabelledBy:[this.getId()+"-filterValue"]}),new m({width:"50%",text:G.getText("IMGEDITOR_APPLY"),type:U.Default,press:this._applyPreview.bind(this)})]}).addStyleClass("sapSuiteUiCommonsImageEditorContainerPanelArea")];this._oFilterToolbarContent.forEach(function(t){this.addDependent(t)},this)}return this._oFilterToolbarContent};et.prototype._getOptionsPanel=function(){if(!this._oOptionsPanel){this._oOptionsPanel=new T({renderType:W.Bare,direction:K.Column});this._oOptionsPanel.addStyleClass("sapSuiteUiCommonsImageEditorContainerPanel");this._oOptionsPanel.setModel(this._oModel);this.addDependent(this._oOptionsPanel)}return this._oOptionsPanel};et.prototype.onkeydown=function(t){var e=this;function o(){return e._oModel.getProperty("/historyIndex")<e._oModel.getProperty("/history").length-1}if(t.ctrlKey&&t.key!=="Control"&&t.shiftKey&&t.key!=="Shift"){switch(t.key){case"z":case"Z":if(o()){this.getImageEditor().undo();if(o()){this._getUndoButton().focus()}else{this._getHistoryArrowButton().focus()}}t.preventDefault();break;case"y":case"Y":if(this._oModel.getProperty("/historyIndex")>0){this.getImageEditor().redo();this._getUndoButton().focus()}t.preventDefault();break;case"h":case"H":if(this._oModel.getProperty("/history").length>1){this._getHistoryArrowButton().focus();this._getHistoryPopover().openBy(this._oHistoryArrowButton)}t.preventDefault();break;default:break}}else if(t.ctrlKey&&t.key!=="Control"&&!t.shiftKey){switch(t.key){case"u":case"U":this._focusOnToolbar();t.preventDefault();break;case"g":case"G":this._focusOnPanel();t.preventDefault();break;case"i":case"I":this._focusOnImageEditor();t.preventDefault();break;case"e":case"E":this._setModeTransform("Resize");this._focusOnItem(this._getResizeGridList().getItems()[0]);t.preventDefault();break;case"r":case"R":this._setModeTransform("Rotate");this._focusOnItem(this._getRotateGridList().getItems()[0]);t.preventDefault();break;case"f":case"F":this._setModeTransform("Flip");this._focusOnItem(this._getFlipGridList().getItems()[0]);t.preventDefault();break;case"j":case"J":this._setModeCrop("Rectangle");this._focusOnItem(this._getRectangleCropGridList().getItems()[0]);t.preventDefault();break;case"s":case"S":this._setModeFilter();this._focusOnItem(this._getFilterGridList().getItems()[0]);t.preventDefault();break;case"Enter":this._applyPreview();break;default:break}}else if(t.altKey&&t.key!=="Alt"){switch(t.key){case"Enter":this._switchFocusPanelImage();t.preventDefault();break;default:break}}};et.prototype._focusFirstTabbable=function(t){var e=t.find(":tabbable").get(0);if(e){e.focus()}};et.prototype._focusOnToolbar=function(){this._focusFirstTabbable(this._getHeaderToolbar().$())};et.prototype._focusOnPanel=function(){this._focusFirstTabbable(this._getOptionsPanel().$())};et.prototype._focusOnImageEditor=function(){this._focusFirstTabbable(this.getImageEditor().$())};et.prototype._focusOnItem=function(t){if(t.getDomRef()){if(!this._getHistoryPopover().isOpen()){t.focus()}}else{var e={onAfterRendering:function(){t.removeEventDelegate(e);t.focus();if(t.getParent()&&t.getParent().isA("sap.m.List")){t.getParent()._startItemNavigation()}}};t.addEventDelegate(e)}};et.prototype._switchFocusPanelImage=function(){var t=document.activeElement;if(this._getOptionsPanel().getDomRef().contains(t)){this._focusOnImageEditor()}else{this._focusOnPanel()}};return et});
//# sourceMappingURL=ImageEditorContainer.js.map