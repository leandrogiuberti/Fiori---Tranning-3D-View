/*!
 * 
		SAP UI development toolkit for HTML5 (SAPUI5)
		(c) Copyright 2009-2015 SAP SE. All rights reserved
	
 */
sap.ui.define(["sap/ui/core/Control","sap/ui/core/Core","sap/ui/core/Configuration","sap/ui/core/ControlBehavior","sap/suite/ui/commons/statusindicator/util/ProgressHandler","sap/base/Log"],function(e,t,i,r,o,a){"use strict";var s=e.extend("sap.suite.ui.commons.statusindicator.ShapeGroup",{metadata:{library:"sap.suite.ui.commons",properties:{weight:{type:"int",defaultValue:10}},defaultAggregation:"shapes",aggregations:{shapes:{type:"sap.suite.ui.commons.statusindicator.Shape",multiple:true}}},renderer:null});s.prototype.init=function(){this._iTargetValue=0;this._oAnimationPropertiesResolver=null;this._iLastDirectValueUpdate=0};s.prototype.discreteThresholdsChangeHandler=function(e){var t=this._oAnimationPropertiesResolver._getGroupValue(this,e);if(t!==this._iLastDirectValueUpdate){this.getShapes().forEach(function(e){e._updateDom(t,true)});this._iLastDirectValueUpdate=t}};s.prototype.propertyThresholdsChangeHandler=function(e){this.getShapes().forEach(function(t){if(t.getDisplayedValue()!==0){t.getRenderer()._updateDomColor(t,e)}})};s.prototype._injectAnimationPropertiesResolver=function(e){this._oAnimationPropertiesResolver=e;this._oAnimationPropertiesResolver.addDiscreteThresholdChange(this.discreteThresholdsChangeHandler.bind(this));this._oAnimationPropertiesResolver.addPropertyThresholdChange(this.propertyThresholdsChangeHandler.bind(this));this.getShapes().forEach(function(t){t._injectAnimationPropertiesResolver(e)})};s.prototype.addShape=function(e){this.addAggregation("shapes",e,true);e._injectAnimationPropertiesResolver(this._oAnimationPropertiesResolver);return this};s.prototype._setValue=function(e,t){var i=this;t=t||false;this._iTargetValue=e;if(!this._isAnimationAllowed()||t){this.getShapes().forEach(function(e){e._updateDom(i._iTargetValue)});return Promise.resolve()}this.getShapes().forEach(function(e){if(!e.getAnimationOnChange()){e._updateDom(i._iTargetValue)}});if(this.oCurrentProgressHandler&&this.oCurrentProgressHandler.isInProgress()){this.oCurrentProgressHandler.cancel()}this.oCurrentProgressHandler=new o(function(e){var t=performance.now();i._animationStep(t,e,t)});return this.oCurrentProgressHandler.start()};s.prototype._animationStep=function(e,t,i){a.debug("AnimationStep at time: "+i.toString(10),null,this);i=Math.max(i,e);if(t.isCanceled()){t.stop({cancelled:true});return}var r=true;var o=this._iTargetValue;this.getShapes().forEach(function(t){var a=t.getDisplayedValue();if(a===o){return}var s=e+250*Math.abs(o-a)/100;var n=o;if(i<s){var u=o-a;var h=s-e;var p=(i-e)/h;n=u*p+a;r=false}t._updateDom(n)});if(r){t.finish()}else{window.requestAnimationFrame(this._animationStep.bind(this,i,t))}};s.prototype._showsFullProgress=function(){return!this.getShapes().some(function(e){return e.getDisplayedValue()!==100})};s.prototype._setInitialValue=function(e){this._iTargetValue=e;this._iLastDirectValueUpdate=e;this.getShapes().forEach(function(t){t._setInitialValue(e)})};s.prototype._isAnimationAllowed=function(){var e=r.getAnimationMode();return e!==i.AnimationMode.none};return s});
//# sourceMappingURL=ShapeGroup.js.map