/*!
 * 
		SAP UI development toolkit for HTML5 (SAPUI5)
		(c) Copyright 2009-2015 SAP SE. All rights reserved
	
 */
sap.ui.define(["sap/m/Button","sap/m/Dialog","sap/m/DialogRenderer","sap/m/HBox","sap/m/Table","sap/m/ColumnListItem","sap/m/Column","sap/ui/model/odata/v4/ODataModel","sap/m/Select","sap/m/Label","sap/m/Input","sap/ui/layout/form/SimpleForm","sap/ui/core/IconPool","sap/ui/core/Icon","sap/m/Page","sap/m/Breadcrumbs","sap/m/Link","sap/m/Text","./CloudFileInfo","./library","sap/m/library","sap/ui/core/library","sap/ui/layout/FixFlex","sap/m/OverflowToolbar","sap/m/ToolbarSpacer","sap/m/Title","sap/m/table/columnmenu/ActionItem","sap/m/table/columnmenu/Menu","sap/ui/core/CustomData","sap/ui/model/Sorter","sap/m/SearchField","sap/m/OverflowToolbarLayoutData","sap/ui/Device","sap/base/Log","sap/ui/model/odata/type/DateTimeOffset","sap/ui/core/Item","sap/m/IllustratedMessage","sap/m/IllustratedMessageType","sap/m/IllustratedMessageSize","sap/ui/core/format/FileSizeFormat","sap/m/MessageToast","sap/m/CheckBox","sap/ui/core/Lib"],function(e,t,i,n,o,a,s,r,l,h,u,d,c,m,p,g,f,C,F,S,b,T,I,y,v,_,w,x,E,L,N,B,D,P,k,M,O,V,A,R,U,K,z){"use strict";var H=b.DialogType;var j=b.ButtonType;var W=T.SortOrder;var $=T.ValueState;var q=S.FilePickerModes;var G=S.FilePickerType;var Y=S.SelectionModes;var X=z.getResourceBundleFor("sap.suite.ui.commons");var Q=t.extend("sap.suite.ui.commons.CloudFilePicker",{metadata:{library:"sap.suite.ui.commons",properties:{serviceUrl:{type:"sap.ui.core.URI",group:"Data",defaultValue:""},sharedModel:{type:"object",group:"Misc",defaultValue:null},confirmButtonText:{type:"string",group:"Data",defaultValue:X.getText("CFP_BUTTON_SELECT")},filePickerMode:{type:"sap.suite.ui.commons.FilePickerModes",group:"Data",defaultValue:"All"},title:{type:"string",group:"Data"},enableDuplicateCheck:{type:"boolean",group:"Data",defaultValue:false},duplicateMessage:{type:"string",group:"Data"},suggestedFileName:{type:"string",group:"Data"},fileNameMandatory:{type:"boolean",group:"Data",defaultValue:false},filePickerType:{type:"sap.suite.ui.commons.FilePickerType",group:"Data",defaultValue:"Export"},MIMEType:{type:"string",group:"Data"},selectionMode:{type:"sap.suite.ui.commons.SelectionModes",group:"Data",defaultValue:"SingleSelectMaster"}},events:{select:{parameters:{replaceExistingFile:"boolean",selectedFileName:"string",selectedFiles:{type:"sap.suite.ui.commons.CloudFileInfo[]"},selectedFolder:{type:"sap.suite.ui.commons.CloudFileInfo"}}},cancel:{}}},constructor:function(){t.prototype.constructor.apply(this,arguments);this.oTableControl=null;this.oSelectControl=null;this.oBreadcrumbLinkControl=null;this.oFileNameControl=null;this.aVisibleLinks=null;this.oNavigationMap=null;this.oConfirmationButton=null;this.oNewFolderButton=null;this.oNewFolderColumnListItem=null;this.oCurrentParentData=null;this.oSelectedFiles=[];this.setResizable(true);this.setDraggable(true);this._createDialogContent();this._createButton();if(!this.getTitle()){this.setTitle(this.getFilePickerType()==="Export"?X.getText("CFP_EXPORT"):X.getText("CFP_UPLOAD"))}if(D.system.phone){this.setStretch(true)}else{this.setStretch(false);this.setContentWidth("780px");this.setContentHeight("48.75rem")}this.setHorizontalScrolling(false);this.setVerticalScrolling(false);this.setTitle(this.getTitle());this.setBusyIndicatorDelay(0);this.setBusy(true)},renderer:i});Q.prototype._createDialogContent=function(){var e=this.getServiceUrl(),t=this.getSharedModel();if(!e&&!t){P.error("Invalid Configuration")}if(!t&&e){t=new r({serviceUrl:e,earlyRequests:true})}if(t){t.setSizeLimit(200)}this.setModel(t);var i=this._createCloudDropdownAndFileNameField();this.oBreadcrumbLinkControl=this._createBreadcrumbLinks();var n=this._createTableContent();var o=new I({fixContent:[i,this.oBreadcrumbLinkControl],flexContent:n});this.addContent(o)};Q.prototype._createCloudDropdownAndFileNameField=function(){var t=new h({text:X.getText("CFP_LOCATION"),showColon:true,labelFor:this.getId()+"-cloudSpaceSelect"}).addStyleClass(D.system.desktop?"sapUiTinyMarginTop":"");this.oSelectControl=new l({id:this.getId()+"-cloudSpaceSelect",forceSelection:false,change:function(e){this.oTableControl.setBusyIndicatorDelay(0);this.oTableControl.setNoDataText(" ");this.oFileNameControl.setValue(this.getSuggestedFileName());this.oBreadcrumbLinkControl.destroyLinks();this._initializeVisibleLinks();var t=e.getParameters().selectedItem;this._loadFileShareRootFolder(t.getKey())}.bind(this)}).bindItems({path:"/FileShares",events:{dataReceived:function(t){var i=t.getParameters();if(i.error||!Object.keys(i.data).length&&!t.getSource().getCurrentContexts().length){this.setBusy(false);var n=new O({illustrationType:V.UnableToUpload,illustrationSize:A.Small,enableVerticalResponsiveness:true,title:X.getText("CFP_NO_FILESHARE_FOUND"),description:X.getText("CFP_NO_FILESHARE_FOUND_RELOAD"),additionalContent:[new e({text:X.getText("CFP_BUTTON_RELOAD"),press:function(){this.oSelectControl.getBinding("items").refresh()}})]});this.oTableControl.setNoData(n)}else if(t.getSource()&&t.getSource().getContexts()&&t.getSource().getContexts().length){var o=t.getSource().getContexts()[0].sPath;var a=o.split(/[']/)[1];this.oSelectControl.setSelectedKey(a);setTimeout(function(){this._initializeVisibleLinks()}.bind(this));this._loadFileShareRootFolder(this.oSelectControl.getSelectedKey())}}.bind(this)},template:new M({key:"{FileShare}",text:{parts:["FileShare","FileShareDescription"],formatter:function(e,t){return t?t:e}}})});var i=new d({layout:"ResponsiveGridLayout",singleContainerFullSize:false});i.addContent(t);i.addContent(this.oSelectControl);var n=new h({text:X.getText("CFP_FILENAME"),showColon:true,labelFor:this.getId()+"-fileName"}).addStyleClass(D.system.desktop?"sapUiTinyMarginTop":"");this.oFileNameControl=new u({id:this.getId()+"-fileName",liveChange:function(e){this.oTableControl.removeSelections();var t=this.oNavigationMap.get(this.aVisibleLinks[this.aVisibleLinks.length-1].fileShareItemId);this._setConfirmationButtonEnabled(null,t,true)}.bind(this)});i.addContent(n);i.addContent(this.oFileNameControl);if(this.getFilePickerMode()===q.FileOnly){this.oFileNameControl.setVisible(false)}else{this.oFileNameControl.setValue(this.getSuggestedFileName())}return i};Q.prototype._createBreadcrumbLinks=function(){this.oBreadcrumbLinkControl=new g(this.getId()+"-breadcrumbs").addStyleClass("sapUiSmallMarginBegin sapUiSmallMarginEnd");this.oNavigationMap=new Map;this._initializeVisibleLinks();return this.oBreadcrumbLinkControl};Q.prototype._initializeVisibleLinks=function(){var e=this.oSelectControl.getSelectedItem()?this.oSelectControl.getSelectedItem().getText():"";var t={fileShareItemId:"Root",title:e};this.aVisibleLinks=[t];this.oBreadcrumbLinkControl.setCurrentLocationText(e);this.oNavigationMap.clear()};Q.prototype._createTableContent=function(){var t=this.getFilePickerType();var i=this.getSelectionMode();var r=new O({illustrationType:V.NoSearchResults,illustrationSize:A.Small,enableVerticalResponsiveness:true,title:X.getText("CFP_EMPTY_FOLDER_TEXT"),description:X.getText("CFP_EMPTY_FOLDER_DESCRIPTION")});this.oNewFolderButton=new e({text:X.getText("CFP_TITLE_NEWFOLDER"),type:j.Transparent,enabled:false,visible:t===G.Upload?false:true,tooltip:X.getText("CFP_TITLE_NEWFOLDER"),press:function(){this._createNewFolderInline()}.bind(this)});this.oTableControl=new o({headerToolbar:new y({content:[new _({text:X.getText("CFP_LIST_HEADER")}),new v,new N({layoutData:new B({minWidth:"200px",maxWidth:"300px",shrinkable:true,priority:"NeverOverflow"}),visible:false}),this.oNewFolderButton],design:"Transparent"}),columns:[new s({header:new C({text:X.getText("CFP_NAME"),tooltip:X.getText("CFP_NAME")}),customData:[new E({key:"bindingProperty",value:"FileShareItemName"})],width:"auto",importance:"High"}),new s({hAlign:"Left",header:new C({text:X.getText("CFP_TYPE"),wrapping:false,tooltip:X.getText("CFP_TYPE")}),customData:[new E({key:"bindingProperty",value:"FileShareItemContentType"})],width:"17%",importance:"High"}),new s({header:new C({text:X.getText("CFP_OWNER"),wrapping:false,tooltip:X.getText("CFP_OWNER")}),customData:[new E({key:"bindingProperty",value:"CreatedByUser"})],width:"17%",importance:"Low",visible:D.system.phone?false:true}),new s({hAlign:"End",header:new C({text:X.getText("CFP_TITLE_LAST_CHANGED_ON"),wrapping:false,tooltip:X.getText("CFP_TITLE_LAST_CHANGED_ON")}),customData:[new E({key:"bindingProperty",value:"LastChangeDateTime"})],width:"17%",importance:"Low",visible:D.system.phone?false:true}),new s({hAlign:"End",header:new C({text:X.getText("CFP_FILESIZE"),wrapping:false,tooltip:X.getText("CFP_FILESIZE")}),customData:[new E({key:"bindingProperty",value:"FileShareItemContentSize"})],width:"10%",importance:"Low",visible:D.system.phone?false:true})],autoPopinMode:true,sticky:["HeaderToolbar","ColumnHeaders"],noDataText:" ",mode:t===G.Upload&&i===Y.MultiSelect?"None":"SingleSelectMaster",growing:true,growingScrollToLoad:true,itemPress:function(e){this.oTableControl.setBusyIndicatorDelay(0);var n=e.getParameters().listItem;var o=n.getBindingContext();var a=o.getObject("FileShareItemKind")==="folder";if(a){this._clearCheckboxFileSelections();var s=this._createSelectionParameter(n);var r=s.getFileShareItemId();s.path=o.getCanonicalPath();this.oCurrentParentData=s;this.oNavigationMap.set(r,s);var l=o.getModel().createBindingContext(s.path);this.aVisibleLinks.push({fileShareItemId:r,title:this.getFilePickerType()===G.Upload&&this.getSelectionMode()===Y.MultiSelect?n.getCells()[1].getItems()[1].getText():n.getCells()[0].getItems()[1].getText()});this._updateBreadcrumbLinks();this.oTableControl.setBindingContext(l)}else if(!a&&t===G.Upload&&i===Y.MultiSelect){return}else{var h=o.getProperty("FileShareItemName");this.oFileNameControl.setValue(h);if(t===G.Upload){this._setConfirmationButtonEnabled(true)}}}.bind(this),items:{path:"_Children",parameters:{$$operationMode:"Server"},sorter:[new L({path:"FileShareItemKind",descending:true}),new L({path:"FileShareItemName",descending:false})],events:{dataReceived:function(){this.oTableControl.setNoData(r);this.oTableControl.setBusy(false);this.setBusy(false)}.bind(this)},template:new a({cells:[new n({items:[new m({src:{parts:["FileShareItemKind","FileShareItemContentType","isDocumentCreationAllowed","FileShareItem"],formatter:function(e,i,n,o){var a={Recent:"sap-icon://history",Starred:"sap-icon://unfavorite"};if(e==="folder"){if(n==="No"){if(a[o]){return a[o]}else if(t!==G.Upload){return"sap-icon://locked"}else{return"sap-icon://folder-full"}}else{return"sap-icon://folder-full"}}else{return c.getIconForMimeType(i)}}},tooltip:{parts:["FileShareItemKind","isDocumentCreationAllowed"],formatter:function(e,i){if(e==="folder"&&i==="No"&&t===G.Export){return X.getText("CFP_LOCKED_FOLDER_INFO")}else{return""}}}}).addStyleClass("sapUiTinyMarginEnd"),new C({text:"{FileShareItemName}"})]}),new C({text:"{FileShareItemHumanContentType}"}),new C({text:"{= ${FileShareItemKind} === 'folder' ? '' : ${CreatedByUser}}"}),new C({text:{parts:["FileShareItemKind","LastChangeDateTime"],formatter:function(e,t){if(e==="folder"){return""}else{var i=new k({style:"short"});return i.formatValue(new Date(t),"string")}}}}),new C({text:{parts:["FileShareItemKind","FileShareItemContentSize"],formatter:function(e,t){if(e!=="folder"&&!!t&&t!=="0"){var i=R.getInstance({binaryFilesize:false,maxFractionDigits:1,maxIntegerDigits:3}).format(t.split(",").join(""));return i}else{return""}}}})],type:"{= ${FileShareItemKind} === 'folder' ? 'Navigation' : 'Active'}",visible:{path:"FileShareItem",targetType:"any",formatter:function(e){if(t===G.Export&&(e==="Recent"||e==="Starred")){return false}else{return true}}}})},updateFinished:function(e){this._checkListForFiles();if(!this.oTableControl.getBusy()){if(this.oCurrentParentData&&Object.keys(this.oCurrentParentData).length!==0){if(t===G.Export){this._setConfirmationButtonEnabled(this.oCurrentParentData.getProperty("isDocumentCreationAllowed"))}this._enableDisableNewFolderBtn()}}}.bind(this)});this.oTableControl.bActiveHeaders=true;this.oTableControl.attachEvent("columnPress",function(e){var t=e.getParameter("column"),i=t.getCustomData()[0].getValue();if(i==="CreatedByUser"||i==="FileShareItemContentSize"||i==="FileShareItemContentType"){return}var n=new x({items:[new w({icon:"sap-icon://sort-ascending",press:function(){this._fHandleSorting(t,true)}.bind(this)}),new w({icon:"sap-icon://sort-descending",press:function(){this._fHandleSorting(t,false)}.bind(this)})]});n.openBy(t)}.bind(this));if(this.getFilePickerType()===G.Upload&&this.getSelectionMode()===Y.MultiSelect){var l=new s({width:"10%",importance:"High"});this.oTableControl.insertColumn(l,0);var h=this.oTableControl.getBindingInfo("items").template;h.insertCell(new K({visible:{path:"FileShareItemKind",targetType:"any",formatter:function(e){return e!=="folder"}},select:function(e){var t=e.getSource().getParent();if(e.getSource().getSelected()){this.oSelectedFiles.push(t);this._setConfirmationButtonEnabled(true)}else{this.oSelectedFiles.splice(this.oSelectedFiles.indexOf(t),1);if(!this.oSelectedFiles.length){this._setConfirmationButtonEnabled(false)}}}.bind(this)}),0)}var u=new p({showHeader:false,content:[this.oTableControl],enableScrolling:true});return u};Q.prototype._createNewFolderInline=function(){var e=new u({placeholder:"Enter Folder Name",width:"100%",visible:true});var t=this.oSelectControl.getSelectedKey();var i="folder";this.setBusy(true);this._checkForDuplicateFileAndFolder(X.getText("CFP_TITLE_NEWFOLDER"),t,i,"",true).then(function(t){this.setBusy(false);var i=/\d+/g;var n=0;if(t.value.length){t.value.forEach(function(e){if(e.FileShareItemName.includes("(")){var t=e.FileShareItemName.match(i);var o=Number(t[0]);if(o>n){n=o}}});if(n){n=n+1}else{n=n+2}e.setValue(X.getText("CFP_TITLE_NEWFOLDER")+"("+n+")")}else{e.setValue(X.getText("CFP_TITLE_NEWFOLDER"))}}.bind(this));e.attachBrowserEvent("click",function(){e.selectText(0,e.getValue().length)});var o=function(n){if(e&&e.getValue()!==""){var o=n.target.value;var a=/[!@#$%^&*+\-=\[\]{};':"\\|,.<>\/?]/;if(a.test(o)){e.setValueState($.Error);e.setValueStateText(X.getText("CFP_FOLDERNAME_VALUESTATEMSG"))}else{this.setBusy(true);this._checkForDuplicateFileAndFolder(o,t,i,"",false).then(function(t){this.setBusy(false);if(t.value.length){e.setValueState($.Error);e.setValueStateText(X.getText("CFP_FOLDER_EXIST"))}else{e.setValueState($.None);e.setValueStateText("");this._makeNewFolderEntry(n.target.value)}}.bind(this))}}}.bind(this);e.attachBrowserEvent("focusout",function(e){o(e)});e.attachBrowserEvent("keypress",function(e){if(e.keyCode===13){o(e)}});this.oNewFolderColumnListItem=new a({cells:[new n({items:[e]}),new C({text:"{= ${FileShareItemKind} === 'folder' ? '' : ${FileShareItemContentType}}"}),new C({text:"{= ${FileShareItemKind} === 'folder' ? '' : ${CreatedByUser}}"}),new C({text:{parts:["FileShareItemKind","LastChangeDateTime"],formatter:function(e,t){if(e==="folder"){return""}else{if(t){var i=new k({style:"short"});return i.formatValue(new Date(t),"string")}}}}}),new C({text:"{= ${FileShareItemKind} === 'folder' ? '' : ${FileShareItemContentSize}}"})]});this._setConfirmationButtonEnabled(false);this.oNewFolderButton.setEnabled(false);this.oTableControl.insertItem(this.oNewFolderColumnListItem);setTimeout(function(){e.focus()})};Q.prototype._checkForDuplicateFileAndFolder=function(e,t,i,n,o){if(o){var a="startswith(FileShareItemName,'"+e+"') and FileShareItemKind eq '"+i+"'and FileShareItemContentType eq '"+n+"'"}else{a="FileShareItemName eq '"+e+"'and FileShareItemKind eq '"+i+"'and FileShareItemContentType eq '"+n+"'"}var s=this.aVisibleLinks[this.aVisibleLinks.length-1].fileShareItemId;var r="/FileShareQuery(FileShare='"+t+"',FileShareItem='"+s+"')/_Query";var l=this.getModel().bindContext(r,"",{$filter:a});return l.requestObject()};Q.prototype._enableDisableNewFolderBtn=function(){if(this.oNavigationMap.size&&this.oCurrentParentData.getProperty("isDocumentCreationAllowed")){this.oNewFolderButton.setEnabled(true)}else{this.oNewFolderButton.setEnabled(false)}};Q.prototype._makeNewFolderEntry=function(e){this.setBusy(true);var t=this.oTableControl.getBinding("items"),i,n=new Promise(function(e){i=e});this.oTableControl.removeItem(this.oNewFolderColumnListItem);this.oNewFolderColumnListItem.destroy();var o=t.create({FileShareItemName:e,FileShareItemKind:"folder"},false,false,false);var a=function(e){var n=e.getParameter("context"),s=e.getParameter("success");if(n===o){t.detachCreateCompleted(a,this);i(s)}};t.attachCreateCompleted(a,this);var s=function(){o.created().then(undefined,function(e){P.trace("transient creation context deleted")}).catch(function(e){P.trace("transient creation context deletion error",e)})};n.then(function(e){if(!e){s();t.resetChanges();this.setBusy(false)}else{o.created().then(function(){this.oTableControl.fireItemPress({listItem:this.oTableControl.getItems()[0]})}.bind(this));this.oTableControl.setSelectedItem(this.oTableControl.getItems().length>0?this.oTableControl.getItems()[0]:null);this.setBusy(false);new U.show(X.getText("CFP_FOLDERCREATION_MSG"))}}.bind(this))};Q.prototype._warningMessageDialog=function(i){var n=new t({type:H.Message,title:X.getText("CFP_TITLE_WARNING"),state:$.Warning,content:new C({text:i}),beginButton:new e({type:j.Emphasized,text:X.getText("CFP_BUTTON_OK"),press:function(){n.close()}})});n.open()};Q.prototype._fHandleSorting=function(e,t){this._clearCheckboxFileSelections();var i=t?W.Ascending:W.Descending;if(i===e.getSortIndicator()){i=W.None}this.oTableControl.getColumns().forEach(function(e){e.setSortIndicator("None")});e.setSortIndicator(i);var n=e.data("bindingProperty");var o=this.oTableControl.getBinding("items");o.sort([new L("FileShareItemKind",true),new L(n,!t)])};Q.prototype._resetAndApplyDefaultSorting=function(){this.oTableControl.getColumns().forEach(function(e){e.setSortIndicator("None")});var e=this.oTableControl.getBinding("items");e.sort([new L("FileShareItemKind",true),new L("FileShareItemName",false)])};Q.prototype._updateBreadcrumbLinks=function(){if(this.aVisibleLinks&&this.aVisibleLinks.length>1){var e=this.aVisibleLinks.slice().reverse();var t=[];e.forEach(function(e,i,n){if(i==0){this.oBreadcrumbLinkControl.setCurrentLocationText(e.title)}else{var o=new f({text:e.title,press:function(e){this._clearCheckboxFileSelections();if(this.oNewFolderColumnListItem&&this.oTableControl.indexOfItem(this.oNewFolderColumnListItem)>-1){this.oTableControl.removeItem(this.oNewFolderColumnListItem);this.oNewFolderColumnListItem.destroy()}var t=this.oBreadcrumbLinkControl.indexOfLink(e.getSource());var i=this.aVisibleLinks.splice(t+1);var n,o;this._updateBreadcrumbLinks();n=this.oNavigationMap.get(this.aVisibleLinks[this.aVisibleLinks.length-1].fileShareItemId);this.oCurrentParentData=n;if(this.aVisibleLinks.length>1){for(var a in i){this.oNavigationMap.delete(i[a].fileShareItemId)}this._setConfirmationButtonEnabled(null,n);o=this.getModel().createBindingContext(n.path);this.oTableControl.setBindingContext(o)}else{this._setConfirmationButtonEnabled(null,n);this._loadFileShareRootFolder(this.oSelectControl.getSelectedKey())}}.bind(this)});t.push(o)}}.bind(this));t.reverse();if(this.oBreadcrumbLinkControl.getLinks()){this.oBreadcrumbLinkControl.removeAllLinks()}for(var i=0;i<t.length;i++){this.oBreadcrumbLinkControl.addLink(t[i])}}else{this.oBreadcrumbLinkControl.destroyLinks();this._initializeVisibleLinks();this._enableDisableNewFolderBtn()}this._setConfirmationButtonEnabled(false)};Q.prototype._loadFileShareRootFolder=function(e){this.oNavigationMap.clear();var t="/FileShares("+"'"+e+"'"+")/_Root";var i=this.getModel().bindContext(t);i.requestObject().then(function(e){var t=this._createSelectionParameter(e,i.getBoundContext(e));this._setConfirmationButtonEnabled(null,t)}.bind(this));var n=this.getModel().createBindingContext(t);this.oTableControl.setBindingContext(n)};Q.prototype._createButton=function(){this.oConfirmationButton=new e({text:this.getConfirmButtonText(),type:j.Emphasized,enabled:false,tooltip:this.getConfirmButtonText(),press:function(){this.setBusy(true);var e=this.oFileNameControl.getValue();if(this.getMIMEType()&&this.getMIMEType()===".xlsx"&&e.indexOf(".xlsx")<0){e=e+this.getMIMEType()}if(this.getFilePickerMode()===q.FileOnly||e){if(this.getEnableDuplicateCheck()){var t="document";var i={".xlsx":"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet",".gsheet":"application/vnd.google-apps.spreadsheet"};var n=i[this.getMIMEType()];this._checkForDuplicateFileAndFolder(e,this.oSelectControl.getSelectedKey(),t,n?n:"",false).then(function(t){this.setBusy(false);var n=this.getMIMEType()?i[this.getMIMEType()]:i[".gsheet"];this.oReturnedDupFileInfo=t.value.find(function(e){return e.FileShareItemContentType===n});if(this.oReturnedDupFileInfo){this._showOverwriteMessage(e)}else{this.oFileNameControl.setValue(e);this._closeDialog()}}.bind(this)).catch(function(e){this._closeDialog()}.bind(this))}else{this.oFileNameControl.setValue(e);this._closeDialog()}}}.bind(this)});this.addButton(this.oConfirmationButton);this.addButton(new e({text:X.getText("CFP_BUTTON_CANCEL"),tooltip:X.getText("CFP_BUTTON_CANCEL"),press:function(){this.fireCancel();this.close();setTimeout(function(){this.destroy()}.bind(this))}.bind(this)}));this._setConfirmationButtonEnabled(false)};Q.prototype._setConfirmationButtonEnabled=function(e,t,i){var n=false;if(this.oFileNameControl&&this.oFileNameControl.getValue()){n=this.oFileNameControl.getValue()!==""}if(this.getFilePickerMode()===q.FileOnly){this.oConfirmationButton.setEnabled(!!e)}else if(t&&t.getIsDocumentCreationAllowed()){if(this.getFileNameMandatory()){n||e?this.oConfirmationButton.setEnabled(true):this.oConfirmationButton.setEnabled(false)}else{this.oConfirmationButton.setEnabled(true)}}else if(i){if(this.getFileNameMandatory()){this.oConfirmationButton.setEnabled(t&&t.getIsDocumentCreationAllowed()?n:false)}}else{this.oConfirmationButton.setEnabled(e?e:false)}};Q.prototype._showOverwriteMessage=function(i){var n=this.getDuplicateMessage();if(!n){n=X.getText("CFP_MESSAGE_DUPLICATE",[i])}var o=new t({type:H.Message,title:X.getText("CFP_TITLE_WARNING"),state:$.Warning,content:new C({text:n}),beginButton:new e({type:j.Emphasized,text:X.getText("CFP_BUTTON_YES"),press:function(){o.close();this._closeDialog(true)}.bind(this)}),endButton:new e({text:X.getText("CFP_BUTTON_NO"),press:function(){o.close()}})});o.open()};Q.prototype._closeDialog=function(e){var t={};if(this.aVisibleLinks.length>1){t.selectedFolder=this.oNavigationMap.get(this.aVisibleLinks[this.aVisibleLinks.length-1].fileShareItemId)}else{t.selectedFolder=new F;t.selectedFolder.setFileShareId(this.oSelectControl.getSelectedKey())}t.selectedFileName=this.oFileNameControl.getValue();t.replaceExistingFile=!!e;t.selectedFiles=[];var i=this.oTableControl.getSelectedItem();if(i){t.selectedFiles.push(this._createSelectionParameter(i))}else if(e){t.selectedFiles.push(this._createFileParameters(this.oReturnedDupFileInfo))}else{this.oSelectedFiles.forEach(function(e){t.selectedFiles.push(this._createSelectionParameter(e))}.bind(this))}this.fireEvent("select",t);this.close();setTimeout(function(){this.destroy()}.bind(this))};Q.prototype._checkListForFiles=function(){var e=this.oTableControl.getItems().some(function(e){return e.getBindingContext().getProperty("FileShareItemKind")!=="folder"});var t=this.oTableControl.getColumns();if(this.getFilePickerType()===G.Upload&&this.getSelectionMode()===Y.MultiSelect){t[0].setVisible(e)}for(var i=t.length-4;i<t.length;i++){t[i].setVisible(e)}};Q.prototype._clearCheckboxFileSelections=function(){if(this.getFilePickerType()===G.Upload&&this.getSelectionMode()===Y.MultiSelect){this.oSelectedFiles.length=0;this.oTableControl.getItems().forEach(function(e){e.getCells()[0].setSelected(false)});this._setConfirmationButtonEnabled(false)}};Q.prototype._createFileParameters=function(e){var t=new F;t.setFileShareId(e.FileShare);t.setFileShareItemId(e.FileShareItem);t.setParentFileShareItemId(e.ParentFileShareItem);t.setIsFolder(e.FileShareItemKind==="folder");t.setFileShareItemName(e.FileShareItemName);t.setCreatedByUser(e.CreatedByUser);t.setCreationDateTime(e.CreationDateTime);t.setLastChangedByUser(e.LastChangedByUser);t.setLastChangeDateTime(e.LastChangeDateTime);t.setFileShareItemContentType(e.FileShareItemContentType);t.setFileShareItemContentSize(e.FileShareItemContentSize);t.setFileShareItemContentLink(e.FileShareItemContentLink);t.setFileShareItemHumanContentType(e.FileShareItemHumanContentType);return t};Q.prototype._createSelectionParameter=function(e,t){var i=new F;var n;if(!t){n=e.getBindingContext()}else{n=t}i.setFileShareId(n.getObject("FileShare"));i.setFileShareItemId(n.getObject("FileShareItem"));i.setParentFileShareItemId(n.getObject("ParentFileShareItem"));i.setIsFolder(n.getObject("FileShareItemKind")==="folder");i.setFileShareItemName(n.getObject("FileShareItemName"));i.setCreatedByUser(n.getObject("CreatedByUser"));i.setCreationDateTime(n.getObject("CreationDateTime"));i.setLastChangedByUser(n.getObject("LastChangedByUser"));i.setLastChangeDateTime(n.getObject("LastChangeDateTime"));i.setFileShareItemContent(n.getObject("FileShareItemContent"));i.setFileShareItemContentType(n.getObject("FileShareItemContentType"));i.setFileShareItemContentSize(n.getObject("FileShareItemContentSize"));i.setFileShareItemContentLink(n.getObject("FileShareItemContentLink"));i.setIsDocumentCreationAllowed(n.getObject("isDocumentCreationAllowed"));i.setFileShareItemHumanContentType(n.getObject("FileShareItemHumanContentType"));return i};return Q});
//# sourceMappingURL=CloudFilePicker.js.map