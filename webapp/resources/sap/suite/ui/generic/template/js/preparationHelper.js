sap.ui.define(["sap/base/util/deepExtend","sap/suite/ui/generic/template/genericUtilities/FeError","sap/suite/ui/generic/template/genericUtilities/FeLogger"],function(e,t,i){"use strict";var a="js.preparationHelper";var n=new i(a).getLogger();function r(i,n,r,l,s,o,c){var g=e({},n);g.tableType=g.tableType||(g.gridTable?"GridTable":undefined);g.tableType=g.tableType||(g.treeTable?"TreeTable":undefined);g.tableSettings=g.tableSettings||{};g.tableSettings.type=g.tableSettings.type||g.tableType;g.tableSettings.multiSelect=g.tableSettings.multiSelect===undefined?g.multiSelect:g.tableSettings.multiSelect;g.tableSettings.inlineDelete=!!g.tableSettings.inlineDelete;g.tableSettings.multiSelect=!!g.tableSettings.multiSelect;g.tableSettings.selectionLimit=g.tableSettings.selectionLimit||200;if(g.tableSettings.copy===undefined){g.tableSettings.copy=true}var p=i.getODataEntitySet(l);var b=i.getODataEntityType(p.entityType);if(g.tableSettings.type!=="StandardList"&&g.tableSettings.type!=="ObjectList"&&l){g.tableSettings.type=g.tableSettings.type||(b["sap:semantics"]==="aggregate"?"AnalyticalTable":"ResponsiveTable");if(g.tableSettings.type==="AnalyticalTable"&&!(b["sap:semantics"]==="aggregate")){g.tableSettings.type="GridTable"}}if(c){var u=p["Org.OData.Capabilities.V1.SearchRestrictions"];if(!u||!u.Searchable||u.Searchable.Bool!=="false"){var m=c();g.tableSettings.searchSettings={};g.tableSettings.searchSettings.enabled=true;g.tableSettings.searchSettings.id=m}}var f=Object.create(null);if(g.columns){for(var S=0;S<Object.keys(g.columns).length;S++){var y=Object.create(null);var m=Object.keys(g.columns)[S];if(m.indexOf("com.sap.vocabularies.UI.v1.DataField::")>-1){m=m.split("com.sap.vocabularies.UI.v1.DataField::")[1]}y[m]={truncateLabel:!g.columns[Object.keys(g.columns)[S]].widthIncludingColumnHeader};Object.assign(f,y)}}if(g.tableSettings&&g.tableSettings.widthIncludingColumnHeader){Object.assign(f,{"*":{truncateLabel:!g.tableSettings.widthIncludingColumnHeader}})}g.tableSettings.calculateWidthIncludingColumnHeader=f;if(b["com.sap.vocabularies.UI.v1.HeaderInfo"]){g.tableSettings.headerInfo=b["com.sap.vocabularies.UI.v1.HeaderInfo"]}if(g.tableSettings.multiSelect&&g.tableSettings.inlineDelete){throw new t(a,"Both inlineDelete and multiSelect options for table are not possible")}if(g.tableSettings.type!=="ResponsiveTable"&&g.tableSettings.inlineDelete){throw new t(a,"InlineDelete property is not supported for "+g.tableSettings.type+" type table")}if(g.tableSettings.inlineDelete){g.tableSettings.mode="Delete";g.tableSettings.onlyForDelete=true}else{var d=Array.isArray(o)&&o.some(function(e){return!(e.Inline&&e.Inline.Bool)&&(e.RecordType==="com.sap.vocabularies.UI.v1.DataFieldForAction"||e.RecordType==="com.sap.vocabularies.UI.v1.DataFieldForIntentBasedNavigation"&&e.RequiresContext&&e.RequiresContext.Bool==="true")});if(!d){for(var v in s){if(s[v].requiresSelection!==false){d=true;break}}}if(!d&&p["Org.OData.Capabilities.V1.DeleteRestrictions"]&&p["Org.OData.Capabilities.V1.DeleteRestrictions"].Deletable&&p["Org.OData.Capabilities.V1.DeleteRestrictions"].Deletable.Bool==="false"){g.tableSettings.mode="None";g.tableSettings.onlyForDelete=false}else{if(g.tableSettings.type==="ResponsiveTable"){g.tableSettings.mode=g.tableSettings.multiSelect?"MultiSelect":"SingleSelectLeft"}else{g.tableSettings.mode=g.tableSettings.multiSelect?"MultiToggle":"Single"}g.tableSettings.onlyForDelete=!d}}delete g.gridTable;delete g.treeTable;delete g.tableType;delete g.multiSelect;return g.tableSettings}function l(e,t,i,a){var n=[i];if(a){n.push(a)}var r=n.join("#");return e.getODataEntityType(t)[r]}function s(e,t,i){function a(i){if(i[0]!=="/"){i=e.getODataEntityType(t,true)+"/"+i}return e.getObject(i.replace(/@/g,""))}function n(e){return e.PresentationVariant&&e.PresentationVariant.Path?a(e.PresentationVariant.Path):e.PresentationVariant}function r(e){var t=e.Visualizations&&e.Visualizations.find(function(e){return e.AnnotationPath.includes("com.sap.vocabularies.UI.v1.LineItem")});return t&&a(t.AnnotationPath)}var s=l(e,t,"com.sap.vocabularies.UI.v1.SelectionPresentationVariant",i);var o=s?n(s):l(e,t,"com.sap.vocabularies.UI.v1.PresentationVariant",i);return o&&r(o)||l(e,t,"com.sap.vocabularies.UI.v1.LineItem")}function o(e,t){var i={mTargetEntities:{},mProperty:{}};function a(){return{mTargetEntities:i.mTargetEntities,sForceLinkRendering:JSON.stringify(i.mProperty)}}var r=e.getODataEntityType(t.entityType);var l=[];var s={};if(!r||!r.navigationProperty){return a()}var o=r.property||[];o.forEach(function(e){if(e["com.sap.vocabularies.Common.v1.SemanticObject"]){l.push(e.name);s[e.name]={name:e.name,targetEntitiesWithSemanticObject:[],targetEntitiesWithDependent:[]}}});if(l.length==0){return a()}var c=function(e,t){return t.namespace===e};var g=function(e,t){return t.name===e};r.navigationProperty.forEach(function(t){if(t.name==="SiblingEntity"){return}var i=t.relationship;var a=i.lastIndexOf(".");var n=i.slice(0,a);var l=i.slice(a+1);var o=e.getObject("/dataServices/schema").find(c.bind(null,n));var p=o.association.find(g.bind(null,l));var b=p&&p.referentialConstraint;if(b&&b.dependent&&b.dependent.propertyRef){var u=e.getODataAssociationEnd(r,t.name);var m=e.getODataEntityType(u.type);if(m&&m["com.sap.vocabularies.UI.v1.QuickViewFacets"]){for(var f in b.dependent.propertyRef){var S=b.dependent.propertyRef[f];if(s.hasOwnProperty(S.name)){if(b.dependent.propertyRef.length==1){s[S.name].targetEntitiesWithDependent.unshift({entityType:m.namespace+"."+m.name,navName:t.name})}else{s[S.name].targetEntitiesWithDependent.push({entityType:m.namespace+"."+m.name,navName:t.name})}}}}}});var p=e.getODataEntityContainer();p.entitySet.forEach(function(t){if(r.name!==t.entityType){var i=e.getODataEntityType(t.entityType);if(i["com.sap.vocabularies.UI.v1.QuickViewFacets"]){var a=i.property||[];for(var n=0;n<a.length;n++){if(a[n]["com.sap.vocabularies.Common.v1.SemanticObject"]){for(var o=0;o<l.length;o++){if(a[n].name==l[o]){s[l[o]].targetEntitiesWithSemanticObject.push({entityType:i.namespace+"."+i.name});break}}}}}}});function b(e){return s[e].targetEntitiesWithDependent[0]}l.forEach(function(e){var t;if(s[e].targetEntitiesWithSemanticObject.length>0){if(s[e].targetEntitiesWithSemanticObject.length>1){n.warning("Quick View property "+e+"found in multiple Target Entities.")}for(var a=0;a<s[e].targetEntitiesWithSemanticObject.length;a++){for(var r=0;r<s[e].targetEntitiesWithDependent.length;r++){if(s[e].targetEntitiesWithSemanticObject[a].entityType==s[e].targetEntitiesWithDependent[r].entityType){t=s[e].targetEntitiesWithDependent[r];break}}if(t){break}}if(!t){t=b(e)}}else{t=b(e)}if(t){i.mTargetEntities[e]=t;i.mProperty[e]=true}});return a()}return{getNormalizedTableSettings:r,getAnnotation:l,getLineItemFromVariant:s,getTargetEntityForQuickView:o}});
//# sourceMappingURL=preparationHelper.js.map