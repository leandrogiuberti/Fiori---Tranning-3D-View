sap.ui.define(["sap/ui/base/Object","sap/base/util/extend","sap/m/MessageBox","sap/suite/ui/generic/template/lib/insights/InsightsCardHelper","sap/suite/ui/generic/template/lib/cards/DTCardHelper","sap/base/util/merge","sap/base/util/deepClone","sap/suite/ui/generic/template/genericUtilities/FeLogger"],function(e,t,r,a,n,i,o,s){"use strict";function l(e,t,l){var d=new s("lib.InsightsHandler").getLogger();var p=l.oComponentUtils.getTemplatePrivateModel();var g=l.oComponentUtils.getTemplatePrivateGlobalModel();var C=g.getProperty("/generic/insights/oInsightsInstance");function u(r,n){var i,s,l,d=t.getView().getId();var C=t.getOwnerComponent();var u=C.getAppComponent();var T=u.getManifestEntry("sap.app").id;var c=p.getProperty("/generic/viewLevel");n=n||e.oPresentationControlHandler;var y=C.getModel().getMetaModel();var A=C.getEntitySet();l=u.getManifestEntry("sap.app").title;if(n){var I;if(n.getEntitySet){A=n.getEntitySet()}var f=y.getODataEntitySet(A);var m=y.getODataEntityType(f.entityType);I=m["com.sap.vocabularies.UI.v1.HeaderInfo"];s=I&&I.TypeNamePlural&&I.TypeNamePlural.String}i={id:a.getCardId(u),descriptorContent:{"sap.card":{header:{title:s||l,subTitle:l}},"sap.insights":{parentAppId:T}}};var E=o(i);let S=Promise.resolve(i);if(r===a.CardTypes.DT_CARD){S=v()}return S.then(function(e){const t=[];if(e){E.cardType=r;E.viewId=d;g.setProperty("/generic/insights/shareCards/"+c,[E]);t.push(E)}return t})}async function v(){let t;try{t=await e.oDTCardHelper.getCardManifest(n.CardTypes.INTEGRATION)||null}catch(e){d.error("Error while fetching the DT Card manifest",e)}return t}function T(e){return a.isCardCreationAllowed(e)}function c(t){var r=e.oPresentationControlHandler.getModel().getMetaModel();return e.oPresentationControlHandler.getVisibleProperties().some(function(a){var n=r.getODataProperty(t,a.data("p13nData").leadingProperty);if(l.oCommonUtils.isSupportedColumn(a,n,e.oPresentationControlHandler.getControl())&&(n&&(n["sap:label"]||n["com.sap.vocabularies.Common.v1.Label"])&&a.getVisible())){return true}})}function y(t,r,n){var i="";if(t===a.CardTypes.ANALYTICAL&&!T(e)){i=r.getText("ST_CARD_CREATION_FAILURE_REASON_SEMANTIC_DATE_FILTERS")}else if(t===a.CardTypes.TABLE){if(!T(e)||!c(n)){i=r.getText("ST_CARD_CREATION_FAILURE")+"\n"+r.getText("ST_CARD_CREATION_FAILURE_INFO")+"\n"+r.getText("ST_CARD_FAILURE_REASON_SEMANTIC_DATE_FILTERS")+"\n"+r.getText("ST_CARD_FAILURE_TABLE_REASON_UNSUPPORTED_COLUMNS")}}return i.length===0?false:i}function A(n,s,d,g){var u=t.getOwnerComponent();if(!d&&s.cardType===a.CardTypes.ANALYTICAL){d=l.oServices.oPresentationControlHandlerFactory.getPresentationControlHandler(e.oSmartChart)}else if(s.cardType===a.CardTypes.DT_CARD){var T=u.getEntitySet();var c=o(s);var A=u.getModel().getMetaModel();var I=l.oServices.oInsightsFECardProvider.getCardProviderInsightsInstance();v().then(function(e){if(!e){return}c.descriptorContent=i(c.descriptorContent,e);I.channel.publishCard(I.id,c,g.consumerId)});return}else{d=d||e.oPresentationControlHandler}var f=d.getModel();var T=d.getEntitySet();var A=f.getMetaModel();var m=A.getODataEntitySet(T);var E=A.getODataEntityType(m.entityType);var S=u.getModel("i18n").getResourceBundle();function _(){var r=t.getView();var a={};a.currentControlHandler=d;a.component=u;a.view=r;a.entitySet=m;a.entityType=E;a.oSmartFilterbar=e.oSmartFilterbar;a.oTemplateUtils=l;var n=l.oComponentUtils.getTemplatePrivateModel();var i=n.getProperty("/listReport/vDraftState");if(i&&Number(i)){a.oFECustomFilterData={name:"IsActiveEntity",value:i}}return a}var h=function(e){s.descriptorContent=e.getParameter("manifest");var t=l.oServices.oInsightsFECardProvider.getCardProviderInsightsInstance();t.channel.publishCard(t.id,s,g.consumerId)};var P=y(s.cardType,S,E);if(!P){var R={};var D=a.createCardForPreview(_());if(p.getProperty("/listReport/bSupressCardRowNavigation")){R.text=S.getText("ST_CARD_NAVIGATION_FAILURE_INFO")}if(g&&g.sendManifestToCardConsumer){var M=S.getText("ST_SEND_CARD_TO_CHAT");D["sap.app"].id=s.id;C.showCardPreview(D,true,R,M,h)}else{C&&C.showCardPreview(D,true,R)}}else{r.error(P)}}return{prepareAndShowCard:A,getCardsToShare:u}}return e.extend("sap.suite.ui.generic.template.lib.InsightsCardHandler",{constructor:function(e,r,a){t(this,l(e,r,a))}})});
//# sourceMappingURL=InsightsHandler.js.map