sap.ui.define(["sap/base/util/ObjectPath","sap/ushell/ui/footerbar/AddBookmarkButton","sap/suite/ui/commons/collaboration/ServiceContainer","sap/ui/core/CustomData","sap/ui/performance/trace/FESRHelper","sap/ui/core/Component","sap/suite/ui/generic/template/lib/AdaptiveCardHelper","sap/m/MenuItem","sap/ui/core/Lib"],function(e,t,r,a,i,n,s,o,l){"use strict";var p={};var u;var c;function g(){var e=sap.ui.require("sap/ushell/Container");return e?new Promise(function(t){e.getFLPUrlAsync(true).done(function(e){t(e)})}):Promise.resolve(document.URL)}p.getCurrentUrl=g;p.setStaticShareData=function(t,r){var a=l.getResourceBundleFor("sap.m");r.setProperty("/emailButtonText",a.getText("SEMANTIC_CONTROL_SEND_EMAIL"));r.setProperty("/jamButtonText",a.getText("SEMANTIC_CONTROL_SHARE_ON_WORK_ZONE"));var i=e.get("sap.ushell.Container.getUser");r.setProperty("/jamVisible",!!i&&i().isJamActive())};p.openJamShareDialog=function(e){g().then(function(t){n.create({name:"sap.collaboration.components.fiori.sharing.dialog",settings:{object:{id:t,share:e}}}).then(function(e){e.open()})})};p.openSharePopup=function(e,t,a,i){var n;a.onCancelPressed=function(){n.close()};if(i){c=i}e.getDialogFragmentAsync("sap.suite.ui.generic.template.fragments.ShareSheet",a,"share",p.setStaticShareData,true).then(function(e){n=e;var i=n.getModel("share");a.getModelData().then(function(e){i.setData(e,true);r.getCollaborationServices().then(function(e){this.addMenuItem(i,e.oTeamsHelperService,n,t,e.oCMHelperService)}.bind(this))}.bind(this))}.bind(this))};p.addMenuItem=function(e,r,n,s,l){var p=2;if(!e.getProperty("/jamVisible")){p=1}var c={isShareAsCardEnabled:e.getProperty("/bEnableCollaborationShareAsCard")};var g=r.getOptions(c);if(g.length>0){g.forEach(function(e){if(e.subOptions&&e.subOptions.length>1){var t=[];e.subOptions.forEach(function(e){var r=new o({text:e.text,icon:e.icon,press:this.menuItemPress});r.addCustomData(new a({key:"data",value:e}));i.setSemanticStepname(r,"press",e.fesrStepName);t.push(r)}.bind(this));n.insertItem(new o({text:e.text,icon:e.icon,items:t}),p)}else{var r=new o({text:e.text,icon:e.icon,press:this.menuItemPress});r.addCustomData(new a({key:"data",value:e}));i.setSemanticStepname(r,"press",e.fesrStepName);n.insertItem(r,p)}p++}.bind(this))}var h=l.getOptions();if(h){var m=new o({text:h.text,icon:h.icon,press:this.CollaborationButtonPress.bind(this,h.press,e)});i.setSemanticStepname(m,"press",h.fesrStepName);n.insertItem(m,p);p++}u=new t;u.setCustomUrl(e.getProperty("/customUrl"));u.setServiceUrl(e.getProperty("/serviceUrl"));u.setTitle(e.getProperty("/shellTitle"));u.setSubtitle(e.getProperty("/pageTitle"));u.setTileIcon(e.getProperty("/icon"));u.setDataSource({type:"OData",settings:{odataVersion:"2.0"}});e.setProperty("/tileVisible",u.getEnabled());e.setProperty("/tileIcon",u.getIcon());e.setProperty("/tileText",u.getText());n.openBy(s)};p.CollaborationButtonPress=function(e,t){var r=g();r.then(function(r){var a=t&&t.getProperty("/shellTitle");e(a,r)})};p.menuItemPress=function(){var e=r.getServiceAsync();var t=sap.ui.require("sap/ushell/Container");var a=t&&t.getServiceAsync("URLParsing");var i=g();Promise.all([e,a,i]).then(function(e){var t=e[0];var r=e[1];var a=e[2];var i=this.getModel("share");var n="",o="";if(i.getProperty("/pageSubtitle")!==undefined){n=i.getProperty("/appTitle");o=i.getProperty("/pageTitle")+(i.getProperty("/pageSubtitle").length>0?" - "+i.getProperty("/pageSubtitle"):"")}else{n=i.getProperty("/shellTitle")}var l={url:a,appTitle:n,subTitle:o,minifyUrlForChat:true,appId:i.getProperty("/appId"),cardId:"",cardManifest:{}};if(this.getCustomData()[0].getValue().key==="COLLABORATION_MSTEAMS_CARD"){if(t.isFeatureFlagEnabled()){var p=i.getProperty("/oDtCardManifest");if(p){l.cardManifest=p}else{var u=c.getOwnerComponent();var g=s.createAdaptiveCard("HeaderInfo",{appTitle:i.getProperty("/shellTitle"),objectTitle:i.getProperty("/pageTitle"),objectSubtitle:i.getProperty("/pageSubtitle"),url:i.getProperty("/currentUrl"),controller:c,component:u});l.cardManifest=g}if(r){var h=r.parseShellHash(l.url.substring(l.url.indexOf("#")));l.cardId=h.semanticObject+"_"+h.action}}}t.share(this.getCustomData()[0].getValue(),l)}.bind(this))};p.fireBookMarkPress=function(){u.firePress()};p.getCustomUrl=function(){if(!window.hasher){sap.ui.require("sap/ui/thirdparty/hasher")}var e=window.hasher.getHash();return e?"#"+e:window.location.href};return p});
//# sourceMappingURL=ShareUtils.js.map