sap.ui.define(["sap/base/Log","sap/base/util/deepClone","sap/base/i18n/ResourceBundle"],function(e,t,a){"use strict";var i;var r={};var n=[];var o;var l=3;var s=Object.freeze({unitOfMeasure:"unit-of-measure",currencyCode:"currency-code"});var v=function(e){if(e){var t=e.indexOf("/")>-1?e.replaceAll("/","."):e;return"${if(int("+t+") == 0, 'Default', if(int("+t+") == 1 , 'Attention', if(int("+t+") == 2 , 'Warning', 'Good')))}"}return"Default"};var c=function(e,t){return t&&t.name===e||undefined};var p=function(e,t){var a=i.component;var r=a.getEntitySet();var n=a.getModel();var o=n.getMetaModel();var l=o.getODataEntitySet(r);var s=o.getODataEntityType(l.entityType);var v=e.split("/");var p=v.length;var u=0;while(p>0){var f=s.property.find(c.bind(null,v[u]));if(f&&f["com.sap.vocabularies.PersonalData.v1.IsPotentiallySensitive"]&&f["com.sap.vocabularies.PersonalData.v1.IsPotentiallySensitive"].Bool==="true"){return true}else if(p>1){var d=o.getODataAssociationEnd(s,v[u]);s=o.getODataEntityType(d.type);u++}p--}return false};var u=function(e,t){var a=i.component;var r=a.getEntitySet();var n=a.getModel();var o=n.getMetaModel();var l=o.getODataEntitySet(r);var s=o.getODataEntityType(l.entityType);var v=e.split("/");var p=v.length;var u=0;while(p>0){var f=s.property.find(c.bind(null,v[u]));if(f&&f["com.sap.vocabularies.PersonalData.v1.IsPotentiallyPersonal"]&&f["com.sap.vocabularies.PersonalData.v1.IsPotentiallyPersonal"].Bool==="true"){return true}else if(p>1){var d=o.getODataAssociationEnd(s,v[u]);s=o.getODataEntityType(d.type);u++}p--}return false};var f=function(e,t){var a=i.component;var r=a.getEntitySet();var n=a.getModel();var o=n.getMetaModel();var l=o.getODataEntitySet(r);var s=o.getODataEntityType(l.entityType);var v=e.split("/");var p=v.length;var u=0;while(p>0){var f=s.property.find(c.bind(null,v[u]));if(f){var d=s.property.find(c.bind(null,f["sap:unit"]));return{sEdmType:f["type"],sSapUnit:f["sap:unit"],sSemantic:d?d["sap:semantics"]:undefined}}else if(p>1){var g=o.getODataAssociationEnd(s,v[u]);s=o.getODataEntityType(g.type);u++}p--}return{edmType:undefined,sSemantic:undefined,sSapUnit:undefined}};var d=function(e){var t="";var a=e.getParent();if(e.getBindingPath("visible")){t="${"+e.getBindingPath("visible")+" !=0}"}else if(a.getBindingPath("visible")){t="${("+a.getBindingPath("visible")+" == false || "+a.getBindingPath("visible")+" == '' || "+a.getBindingPath("visible")+" == 0)}"}return t};var g=function(e,t){if(e.getItems().length>1){var a={type:"DataPoint",label:"",value:"",path:"",displayBehaviour:"",paths:{},objectStatus:"",color:"",edmType:"",visiblePath:""};var i=e.getItems();a.path=i[1].getBindingPath("value");a.visiblePath=d(i[1]);if(p(a.path,t)){return null}if(u(a.path,t)){return null}var r=f(a.path,t);a.edmType=r.sEdmType;a.semantic=r.sSemantic;a.sapUnit=r.sSapUnit;a.label=i[0].getText&&i[0].getText();a.value=i[1].getValue&&i[1].getValue();var n=i[1].getConfiguration&&i[1].getConfiguration();a.displayBehaviour=n&&n.getDisplayBehaviour&&n.getDisplayBehaviour();if(i[1].getInnerControls){var o=i[1].getInnerControls();if(o&&o.length>0){o.forEach(function(e){var t=e.getBinding("text");var i=t&&e.getBindingInfo("text");if(t&&i){var r=i.parts;if(r&&r.length>0){r.forEach(function(e){if(e.path!==a.path&&e.path!=="__$$SmartFieldNotExistingBindingPath"){a.paths[e.path]=e.path}})}}var n=e.getBinding("state");var o=n&&e.getBindingInfo("state");if(n&&o){a.objectStatus=e.getBindingPath("state");a.color=v(a.criticality);if(a.path===a.criticality){a.path=Object.keys(a.paths)[0];a.paths=[]}}})}}return a}return undefined};var h=function(e,t){if(e.getItems().length>1){var a={type:"PlainTextVBox",label:"",value:"",path:"",visiblePath:""};var i=e.getItems();a.label=i[0].getText&&i[0].getText();a.path=i[1].getBindingPath("text");a.visiblePath=d(i[1]);a.value=i[1].getText&&i[1].getText();return a}return undefined};var m=function(e,t){if(e.getItems().length>0){var a={type:"Form",header:"",fields:[]};var i=e.getItems();var r=0;if(i[0].getContent&&i[0].getContent()===null&&i[0].getText){a.header=i[0].getText();r=1}for(r;r<i.length;r++){var n=i[r];var o={type:"FormField",label:"",value:"",path:"",paths:{},displayBehaviour:"",expand:"",objectStatus:"",color:"",edmType:"",visiblePath:""};var l=n.getItems();o.label=l[0].getText&&l[0].getText();o.visiblePath=d(l[1]);if(l[1].getText){o.path=l[1].getBindingPath("text");o.value=l[1].getText()}else{o.path=l[1].getBindingPath("value");o.value=l[1].getValue()}if(p(o.path,t)){continue}if(u(o.path,t)){continue}var s=f(o.path,t);o.edmType=s.sEdmType;o.sapUnit=s.sSapUnit;o.semantic=s.sSemantic;var c=l[1].getObjectBinding&&l[1].getObjectBinding();if(c&&c.getPath){o.expand=l[1].getObjectBinding().getPath()}var g=l[1].getConfiguration&&l[1].getConfiguration();o.displayBehaviour=g&&g.getDisplayBehaviour&&g.getDisplayBehaviour();if(l[1].getInnerControls){var h=l[1].getInnerControls();if(h&&h.length>0){for(var m=0;m<h.length;m++){var y=h[m];var b=y.getBinding("text");var x=b&&y.getBindingInfo("text");if(b&&x){var P=x.parts;if(P&&P.length>0){for(var I=0;I<P.length;I++){var B=P[I];if(B.path!==o.path&&B.path!=="__$$SmartFieldNotExistingBindingPath"){o.paths[B.path]=B.path}}}}var C=y.getBinding("state");var T=C&&y.getBindingInfo("state");if(C&&T){o.objectStatus=y.getBindingPath("state");o.color=v(o.objectStatus)}}}}a.fields.push(o)}return a}};var y=function(e,t,a){var i=e+" == '' || "+e+" == null || "+e+" == undefined";if(t==="Edm.Decimal"){i=i+" || "+"formatNumber(float("+a+"), 2) == '0.00'"}return i};var b=function(e){return y(e)+" ? '&minus;' : "+e};var x=function(e,t,a,i){if(a&&i){return e+t+" + ' ' + "+"("+a+" ? "+a+" : '') + ' ' + ("+y(i)+" ? "+"' ' : "+"'(' + "+i+" + ')')"}else if(a){return e+t+" + ' ' + ("+y(a)+" ? "+"' ' : "+"'(' + "+a+" + ')')"}return""};var P=function(e){var t=[];if(e.paths){t=Object.keys(e.paths).filter(function(t){return t!==e.path&&t.indexOf("##@@")===-1})}var a=e.edmType==="Edm.Decimal"?"formatNumber(float("+e.path+"), 2)":e.path;var i=b(e.path);var r=null;var n=null;var o;var l="";if(e.semantic===s.unitOfMeasure){l="("+y(e.sapUnit)+")"+" ? "+a+" + ' ' + '&minus;' : "+""}else if(e.semantic===s.currencyCode){l="("+y(e.sapUnit)+")"+" ? "+" '&minus;' : "+""}if(t.length>1){var v=t.filter(function(e){return e.endsWith("_Text")});var c=t.filter(function(e){return!e.endsWith("_Text")});if(v&&v.length>0){n=v[0]}if(c&&c.length>0){r=c[0]}}else if(t.length>0){n=t[0]}if(e.displayBehaviour){switch(e.displayBehaviour){case"descriptionAndId":if(r&&n){o=x(l,a,n,r)}else if(r&&!n){o=x(l,a,r)}else if(n&&!r){o=l+" ("+y(a)+" ? ("+b(n)+") : ("+n+" + ' ' + "+"' (' + "+a+" + ')'"+"))"}else{o=i}break;case"descriptionOnly":o=b(n);break;case"idAndDescription":if(r&&n){o=x(l,a,r,n)}else if(r&&!n){o=l+a+" + ' ' + ("+r+" ? "+r+" : '')"}else if(!r&&n){o=x(l,a,n)}else{o=i}break;case"idOnly":o=i||r;break;default:o=i;break}}else{o=i}o=o&&o.indexOf("/")>-1?o.replaceAll("/","."):o;return"${"+o+"}"};var I=function(){var e=i.component;var t=e.getAppComponent();var a=t.getManifestEntry("sap.app");var r=e.getComponentContainer();var n=r.getElementBinding();var o=new URL(i.url);var l=o.origin+a.dataSources.mainService.uri;var s=n.sPath;if(a.dataSources.mainService.uri.endsWith("/")&&s.startsWith("/")){s=s.substring(1,s.length)}var v=o.origin+a.dataSources.mainService.uri+s+(n.mParameters.expand?"?$expand="+encodeURIComponent(n.mParameters.expand):"");return{serviceUrl:l,contextUrl:v}};var B=function(){var e={type:"TextBlock",size:"Small",weight:"Bolder",text:"${form1}",maxLines:2,wrap:true,spacing:"Medium"};var a={type:"TextBlock",size:"Small",text:"${field1}",maxLines:1,color:"Default",weight:"Default",wrap:false,isSubtle:true};var r={type:"TextBlock",size:"Small",text:"${field1desc}",maxLines:2,wrap:true,color:"Default"};var s={type:"ColumnSet",columns:[]};var v={type:"Column",items:[],verticalContentAlignment:"Top",width:1};var c={type:"ActionSet",actions:[]};var p={type:"Action.ShowCard",title:"",style:"default",card:{type:"AdaptiveCard",body:[],actions:[{type:"Action.Execute",verb:"",style:"positive",title:"OK",data:{serviceURI:"",contextURL:"",actionParams:{keys:[]},isConfirmationRequired:false}}],$schema:"https://adaptivecards.io/schemas/adaptive-card.json"}};var u={type:"Input.Text",id:"",isMultiline:false,isRequired:true,label:""};var f={type:"Input.Date",id:"",isRequired:true,label:""};var d={type:"AdaptiveCard",metadata:{webUrl:I().contextUrl},msTeams:{width:"full"},body:[{type:"ColumnSet",columns:[{type:"Column",items:[{type:"TextBlock",size:"Medium",weight:"Bolder",text:i.appTitle,maxLines:3},{type:"TextBlock",size:"Default",weight:"Bolder",text:"["+i.objectTitle+"]("+i.url+")",maxLines:1,spacing:"None"},{type:"TextBlock",size:"Default",text:i.objectSubtitle,maxLines:1,spacing:"None"}],verticalContentAlignment:"Top",width:"auto"}]}],$schema:"https://adaptivecards.io/schemas/adaptive-card.json",version:"1.4"};if(o&&o.length>0){var g;o.forEach(function(i){var n;var o;var c;var p;if(i.type!=="DataPoint"){if(g){d.body.push(g)}g=undefined}switch(i.type){case"Form":if(i.header&&i.header.length>0){n=t(e);n.text=i.header;d.body.push(n)}var u=i.fields;var f=Math.ceil(u.length/l);for(var h=1;h<=f;h++){var m=h*l;var y=m-l;var b=t(s);for(var x=y;x<m;x++){var I=u[x];p=t(v);if(!I){b.columns.push(p);continue}if(I.label){c=t(a);c.text=I.label;p.items.push(c);o=t(r);o.text=P(I);o.color=I.color?I.color:"Default";p.items.push(o);p["$when"]=I.visiblePath;b.columns.push(p)}}d.body.push(b)}break;case"PlainTextVBox":if(i.label){n=t(e);n.text=i.label;d.body.push(n);o=t(r);o.text=P(i);d.body.push(o);n["$when"]=i.visiblePath;o["$when"]=i.visiblePath}break;case"DataPoint":if(!g){g=t(s)}if(i.label){p=t(v);n=t(e);n.text=i.label;p.items.push(n);o=t(r);o.text=P(i);o.color=i.color?i.color:"Default";p.items.push(o);p["$when"]=i.visiblePath;g.columns.push(p)}break;default:break}if(g&&g.columns.length===3){d.body.push(g);g=undefined}});if(g){d.body.push(g);g=undefined}}if(n.length>0){n.sort(function(e,t){var a={"com.sap.vocabularies.UI.v1.ImportanceType/High":1,"com.sap.vocabularies.UI.v1.ImportanceType/Medium":2};var i=a[e.importance]||3;var r=a[t.importance]||3;return i-r});var h=t(c);var m=0;for(var y=0;y<n.length;y++){if(m===2){break}var b=n[y];var x=t(p);if(b.parameter&&b.parameter.additionalParameters&&b.parameter.additionalParameters.length>0){var B=b.parameter.additionalParameters;for(var C=0;C<B.length;C++){var T=B[C];if(T.type==="Edm.String"){var D=t(u);D.label=T.name;D.id=T.name;D.isRequired=T.nullable==="true";x.card.body.push(D)}else if(T.type==="Edm.DateTime"){var S=t(f);S.label=T.name;S.id=T.name;S.isRequired=T.nullable==="true";x.card.body.push(S)}}}x.title=b.label;x.card.actions[0].verb=b.action;x.card.actions[0].data.serviceURI=I().serviceUrl;x.card.actions[0].data.contextURL=I().contextUrl;x.card.actions[0].data.isConfirmationRequired=b.critical;if(b.parameter.parameterData){var U=Object.keys(b.parameter.parameterData);for(var E=0;E<U.length;E++){var O=U[E];if(x.card.actions[0].data.actionParams.keys.indexOf(O)===-1){x.card.actions[0].data.actionParams.keys.push(O)}}}var w=x;if(x.card.body.length===0){x.card.actions[0].title=x.title;w=x.card.actions[0]}var k=(b.hiddenPath?b.hiddenPath:true)+" && "+(b.applicablePath?b.applicablePath:true);w["$when"]="${"+k+"}";if(b.stylePath.length>0){w["$when"]="${"+k+" && ("+b.stylePath+" == '3' || "+b.stylePath+" == 'UI.CriticalityType/Positive')}";w.style="positive";h.actions.push(w);var A=t(w);A["$when"]="${"+k+" && ("+b.stylePath+" == '1' || "+b.stylePath+" == 'UI.CriticalityType/Negative')}";A.style="destructive";h.actions.push(A);m++}else if(b.styleValue.length>0){w.style=b.styleValue;h.actions.push(w);m++}else{h.actions.push(w);m++}}d.body.push(h)}return d};var C=function(){var e=i.component;var t=i.controller;var a=t.byId("objectPage-OPHeaderContent");var r=e.getAppComponent().getObjectPageHeaderType()==="Dynamic";if(r){if(a&&a.getContent()){var n=a.getContent();var l=[];n.forEach(function(e){if(e.getId().endsWith("DynamicHeaderContentFlexBox")){var t=e.getItems();t.forEach(function(e){l.push(e)})}else{l.push(e)}});l.forEach(function(e){var a;if(e.getId().endsWith("DataPoint")){a=g(e,t)}else if(e.getId().endsWith("PlainTextVBox")){a=h(e,t)}else if(e.getId().endsWith("Form")){a=m(e,t)}if(a){o.push(a)}})}}};var T=function(e){var t={};if(e&&e.key&&e.key.propertyRef){for(var a=0;a<e.key.propertyRef.length;a++){var i=e.key.propertyRef[a].name;t[i]=true}}return t};var D=function(e,t,a){if(t&&e&&!e["com.sap.vocabularies.Common.v1.Label"]){var i=a.getODataProperty(t,e.name,false);if(i&&i["com.sap.vocabularies.Common.v1.Label"]){e["com.sap.vocabularies.Common.v1.Label"]=i["com.sap.vocabularies.Common.v1.Label"]}}};var S=function(e){var t=e["com.sap.vocabularies.Common.v1.IsActionCritical"];if(!t){return false}if(t.Bool===undefined){return true}var a=t.Bool;if(typeof a==="string"){var i=a.toLowerCase();return!(i=="false"||i==""||i==" ")}return!!a};var U=function(){var t=i.controller;var a;n=[];var r=i.component;var o=r.getEntitySet();var l=r.getModel();var s=t.getView().getModel("@i18n").getResourceBundle();var v=t.getView().getModel("i18n").getResourceBundle();var c=v.getText("COPY");var p=l.getMetaModel();var u=p.getODataEntitySet(o);var f=p.getODataEntityType(u.entityType);var d=Object.keys(f);var g=d.filter(function(e){return e==="com.sap.vocabularies.UI.v1.Identification"});if(g.length>0){var h=f["com.sap.vocabularies.UI.v1.Identification"];for(var m=0;m<h.length;m++){var y=h[m].Label&&h[m].Label.String;if(y){a=y.indexOf("i18n>")>1?y.split("i18n>")[1].replace("}",""):"";if(a!==""){y=s.getText(a)}}if(y&&y.toUpperCase().indexOf(c.toUpperCase())>-1){continue}if(h[m].RecordType==="com.sap.vocabularies.UI.v1.DataFieldForAction"){var b;if(h[m]["com.sap.vocabularies.UI.v1.Hidden"]){if(h[m]["com.sap.vocabularies.UI.v1.Hidden"]["Bool"]){var x=h[m]["com.sap.vocabularies.UI.v1.Hidden"]["Bool"];if(typeof x==="string"){var P=x.toLowerCase();var I=!(P=="false"||P==""||P==" ");if(I){continue}}}else if(h[m]["com.sap.vocabularies.UI.v1.Hidden"]["Path"]){b=h[m]["com.sap.vocabularies.UI.v1.Hidden"]["Path"]}else{continue}}if(h[m]["Determining"]){if(h[m]["Determining"]["Bool"]){var B=h[m]["Determining"]["Bool"];if(typeof B==="string"){var C=B.toLowerCase();var U=!(C=="false"||C==""||C==" ");if(U){continue}}}else{continue}}var E="";var O="";if(h[m]["Criticality"]){if(h[m]["Criticality"]["EnumMember"]){var w=h[m]["Criticality"]["EnumMember"];if(w==="com.sap.vocabularies.UI.v1.CriticalityType/Negative"||w==="1"){O="destructive"}else{O="positive"}}else if(h[m]["Criticality"]["Path"]){var k=h[m]["Criticality"]["Path"];if(k&&k.length>0){k=k.replaceAll("/",".");E=k}}}if(h[m]["com.sap.vocabularies.UI.v1.IsCopyAction"]){if(h[m]["com.sap.vocabularies.UI.v1.IsCopyAction"]["Bool"]){var A=h[m]["com.sap.vocabularies.UI.v1.IsCopyAction"]["Bool"];if(typeof A==="string"){var M=A.toLowerCase();var $=!(M=="false"||M==""||M==" ");if($){continue}}}else{continue}}var L=h[m].Action.String.split("/")[1];var j=p.getODataFunctionImport(L);var R=t.getView().getBindingContext().getObject();var F=T(f);var V;var H={};var N={parameterData:{},additionalParameters:[]};if(j.parameter){for(var W=0;W<j.parameter.length;W++){var z=j.parameter[W];D(z,f,p);var q=z.name;var _=!!F[q];V=undefined;if(R&&R.hasOwnProperty(q)){V=R[q]}else if(_&&R&&j["sap:action-for"]){e.error("Key parameter of action not found in current context: "+q);throw new Error("Key parameter of action not found in current context: "+q)}N.parameterData[q]=V;var K=!!H[q];if(!K&&(!_||!j["sap:action-for"])&&z.mode.toUpperCase()=="IN"){N.additionalParameters.push(z)}}}var G={type:"Action",label:y,action:L,parameter:N,critical:S(j),rawFunctionImport:j,stylePath:E,styleValue:O,hiddenPath:b,applicablePath:j["sap:applicable-path"],importance:h[m]["com.sap.vocabularies.UI.v1.Importance"]?h[m]["com.sap.vocabularies.UI.v1.Importance"]["EnumMember"]:"com.sap.vocabularies.UI.v1.ImportanceType/Low"};n.push(G)}}}};var E=function(){C();U();return B()};r.createAdaptiveCard=function(e,t){o=[];var a;i=t;switch(e){case"HeaderInfo":a=E();break;default:break}return a};return r});
//# sourceMappingURL=AdaptiveCardHelper.js.map