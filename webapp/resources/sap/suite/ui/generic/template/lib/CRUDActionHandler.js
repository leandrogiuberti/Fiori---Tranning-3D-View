sap.ui.define(["sap/ui/base/Object","sap/ui/model/Filter","sap/ui/model/FilterOperator","sap/base/util/extend","sap/suite/ui/generic/template/lib/MessageUtils","sap/ui/model/json/JSONModel","sap/suite/ui/generic/template/genericUtilities/controlHelper","sap/ui/core/message/MessageType","sap/suite/ui/generic/template/genericUtilities/FeLogger"],function(e,t,n,r,o,i,a,s,c){"use strict";var l=new c("lib.CRUDActionHandler");var u=l.getLogger();u.setLevel(l.Level.ALL);var g=new t({filters:[new t({path:"type",operator:n.EQ,value1:s.Warning}),new t({path:"type",operator:n.EQ,value1:s.Error})],and:false});var f=new t({path:"type",operator:n.EQ,value1:s.Error});var p="model";function v(e,n,r,s){var c,l;var v;var m=function(){var t=n.getOwnerComponent();var r=e.componentRegistry[t.getId()];return!!(r.methods.showConfirmationOnDraftActivate&&r.methods.showConfirmationOnDraftActivate())}();function y(t){var n=e.oNavigationControllerProxy.getActiveComponents();var r;for(var o=0;o<n.length&&!r;o++){var i=n[o];var a=e.componentRegistry[i];r=a.viewLevel&&(a.methods.getScrollFunction||Function.prototype)(t)}return r||null}function d(u,m,d){var h=d&&d.messagesForUserDecison;var C,P;return r.getDialogFragmentAsync("sap.suite.ui.generic.template.fragments.MessageInfluencingCRUDAction",{onMessageSelect:function(){var e=C.getButtons().find(function(e){return e.isFocusable()});a.focusUI5Control(e);P.setProperty("/backbtnvisibility",true)},onBackButtonPress:function(){v.navigateBack();P.setProperty("/backbtnvisibility",false)},onAccept:function(){(c||Function.prototype)();C.close()},onReject:function(){o.clearWarningCache();(l||Function.prototype)();C.close()},isPositionable:function(e){return!!(e&&y(e))},titlePressed:function(e){C.close();var t=e.getParameter("item");var n=t.getBindingContext("msg").getObject();var r=y(n.controlIds);if(r){P.setProperty("/afterClose",r)}},afterClose:function(){c=null;l=null;P.setProperty("/messageToGroupName",Object.create(null));v.navigateBack();v.setModel(null,"msg");var e=P.getProperty("/afterClose");e()},getSeverityIconFromIconPool:o.getSeverityIconFromIconPool,getIconColor:o.getIconColor},p,function(e){v=e.getContent()[0]}).then(function(a){C=a;P=C.getModel(p);var c=h?new i(h):sap.ui.getCore().getMessageManager().getMessageModel();c.setSizeLimit(9999);v.setModel(c,"msg");P.setProperty("/situation",u);P.setProperty("/afterClose",Function.prototype);var l=g;var y=f;var b=n.getOwnerComponent().getModel("ui");var w=b.getProperty("/createMode");var A=v.getBinding("items");if(!h){var M=[];var F=e.oNavigationControllerProxy.getActiveComponents();var D=u<3;for(var E=0;E<F.length;E++){var O=F[E];var S=e.componentRegistry[O];if(S.oController===n||u!==2){var x=(S.methods.getMessageFilters||Function.prototype)(D);M=x?M.concat(x):M}}if(M.length===0){return null}l=M.length===1?M[0]:new t({filters:M,and:false})}if(u===3){y=new t({filters:[l,f],and:true});l=new t({filters:[l,g],and:true});var L;switch(m){case"Delete":L=r.getText("DELETE");break;case"BOPFAction":L=d.actionName;break;default:if(w){L=r.getText("CREATE")}else{L=r.getText("SAVE")}}P.setProperty("/CRUDAction",L);if(A.filter(y).getLength()===0){P.setProperty("/situation",4)}}P.setProperty("/backbtnvisibility",false);A.filter(l);if(A.getLength()===0){return null}var U=A.getAllCurrentContexts().map(function(e){return e.getObject()});var B=o.getMessageDialogTitleAndSeverity(U,e);P.setProperty("/title",B.sTitle);P.setProperty("/messageType",B.sSeverity);return s(U,A,P).then(function(){return C})})}function h(e){return new Promise(function(t,n){var r;d(e?1:2).then(function(o){r=o;if(r){r.open();return n()}if(!(e&&m)){return t()}d(3).then(function(e){r=e;if(r){c=t;l=n;r.open()}else{t()}})})})}function C(t,n){e.oApplicationProxy.performAfterSideEffectExecution(function(){h(t).then(n).catch(function(){u.info("Can't proceed with 'Save' as 'fnBeforeOperation' checks have failed")})},true)}function P(t,n,r,o){c=t;l=n;return d(3,r,o).then(function(t){if(t){e.oBusyHelper.getUnbusy().then(function(){t.open()},function(){t.open()})}else{n()}})}function b(e,t,n,r,o){if(e===4){return P(t,n,r,o)}else{return C(e===1,t)}}function w(){return new Promise(function e(t){d(1).then(function(e){t(!!e)})})}return{handleCRUDScenario:b,hasValidationMessageOnDetailsViews:w}}return e.extend("sap.suite.ui.generic.template.lib.CRUDActionHandler",{constructor:function(e,t,n,o){r(this,v(e,t,n,o))}})});
//# sourceMappingURL=CRUDActionHandler.js.map