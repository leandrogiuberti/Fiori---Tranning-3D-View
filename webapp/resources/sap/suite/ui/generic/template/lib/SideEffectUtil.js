sap.ui.define(["sap/suite/ui/generic/template/js/AnnotationHelper","sap/suite/ui/generic/template/genericUtilities/metadataAnalyser","sap/base/util/deepExtend","sap/ui/comp/util/SharedUtil","sap/suite/ui/generic/template/genericUtilities/controlHelper"],function(e,t,a,i,r){"use strict";var n={SINGLE_SOURCE_ONLY:"OnlySingleSource",SINLGE_AND_MULTIPLE_SOURCE:"SingleAndMultipleSource",MULTIPLE_SOURCE_ONLY:"OnlyMultipleSource",NO_SIDE_EFFECT:"NoSideEffect"};function o(e,i){var r;var n=a({},i);for(var o in i.entityType){if(o.startsWith("com.sap.vocabularies.Common.v1.SideEffects")){r=i.entityType[o];if(r.SourceProperties&&r.SourceProperties.length>1&&t.hasPropertyInSideEffect(r,i.path)){delete n.entityType[o]}}}return e._calculateFieldGroupIDs(n)}function p(t,a){var i=function(e){if(e){t.triggerValidateFieldGroup(e)}};var r=function(e,a){var r;switch(e){case n.SINGLE_SOURCE_ONLY:var p=t.getInnerControls();r=p&&p[0]&&p[0].getFieldGroupIds&&p[0].getFieldGroupIds();i(r);break;case n.SINLGE_AND_MULTIPLE_SOURCE:if(a){r=o(t,a);i(r)}else{t._getComputedMetadata().then(function(e){r=o(t,e);i(r)})}break;case n.MULTIPLE_SOURCE_ONLY:break;default:break}};if(!a){t._getComputedMetadata().then(function(a){var i,o=a.entityType.namespace+"."+a.entityType.name;i=e.getSideEffectSourcePropertyType(a.path,true,t.getModel().getMetaModel(),o);if(i===n.NO_SIDE_EFFECT){return}r(i,a)})}else{r(a)}}function l(e,t,a){if(!t.isDraftEnabled()){return}var i=e.getParameter("changeEvent")&&e.getParameter("changeEvent").getSource?e.getParameter("changeEvent").getSource():e.getSource();if(!r.isSmartField(i)){return}if(a){var n=i.getCustomData().find(function(e){return e.getKey()==="SideEffectSourcePropertyType"});n=n&&n.getValue();p(i,n)}else{p(i)}}function g(e,t,i){e._getComputedMetadata().then(function(r){if(r&&r.navigationPath&&!!e.getBindingContext()){var n=a({},r);n.entitySet=t.getODataEntitySet(i);n.entityType=t.getODataEntityType(n.entitySet.entityType);var o=e._calculateFieldGroupIDs(n);if(o){e._setInternalFieldGroupIds(o)}}})}function s(e,t,a){var i;if(t&&t.Value&&t.Value.Path){i=t.Value.Path}else{i=t.Target.AnnotationPath.split("/")[0]+"/"+a}var r={sEntitySetName:e.name,sEntityTypeName:e.entityType,sLinkProperty:i};return JSON.stringify(r)}function u(e){var a=e.getCustomData();var r=e.getModel().getMetaModel();var n=a.find(e=>e.getKey()==="SideEffects"&&e.getValue());if(e.getBindingContext()&&n){var o=n.getValue();var p=o.sEntitySetName;var l=o.sEntityTypeName;var g=o.sLinkProperty;var s=t.getFieldSourcePropertiesType(g,r,l);if(s==="NoSideEffect"){return}var u=e;var y=r.getODataEntityType(l);var d=r.getODataEntitySet(p);var c=t.getPropertyMetadata(r,l,g);var f={entitySet:d,entityType:y,path:g,property:{property:c}};if(g.includes("/")){while(!u.isA("sap.ui.comp.smartform.Group")){u=u.getParent()}i.applyFieldGroupIDs(e,f,null,u.getBindingContext())}else{i.applyFieldGroupIDs(e,f)}}}function y(e,t,a,r){var n=r.getView().getModel().getMetaModel();var o=n.getODataEntitySet(a);var p=n.getODataEntityType(o.entityType);var l=n.getODataProperty(p,t);r.extensionAPI.attachPageDataLoaded(()=>{i.applyFieldGroupIDs(e,{entitySet:o,entityType:p,path:t,property:{property:l}})})}function d(e,t,a,i){var r=e.getModel().getMetaModel().getODataEntitySet(i);var n=e.getModel().getMetaModel().getODataEntityType(r.entityType);for(var o in n){if(o.includes("com.sap.vocabularies.Common.v1.SideEffects")){var p=n[o].SourceProperties;if(!p){continue}for(var l=0;l<p.length;l++){if(p[l].PropertyPath===a){var g=o.split("#")[1];t.oServices.oApplicationController.registerGroupChange(g)}}}}}function c(e,t,a,r){var n;if(e.isA("sap.m.Table")){n=e.getAggregation("items")}else if(e.isA("sap.ui.table.Table")){n=e.getAggregation("rows")}var o=r.getView().getModel().getMetaModel();var p=o.getODataEntitySet(a);var l=o.getODataEntityType(p.entityType);var g=o.getODataProperty(l,t);let s=e.getAggregation("columns").findIndex(e=>e.data("p13nData").leadingProperty==t);n.forEach(e=>{var a=e.getCells();i.applyFieldGroupIDs(a[s],{entitySet:p,entityType:l,path:t,property:{property:g}})})}return{handleSideEffectForField:l,assignFieldGroupIds:g,getPropsForLinkFields:s,assignFieldGroupIdsToLinkField:u,registerCustomFieldForSideEffect:y,fieldGroupChangeRegister:d,registerCustomColumnForSideEffect:c}});
//# sourceMappingURL=SideEffectUtil.js.map