sap.ui.define(["sap/ui/base/Object","sap/ui/core/mvc/ControllerExtension","sap/m/MessageBox","sap/fe/navigation/SelectionVariant","sap/suite/ui/generic/template/genericUtilities/controlHelper","sap/suite/ui/generic/template/genericUtilities/metadataAnalyser","sap/suite/ui/generic/template/genericUtilities/testableHelper","sap/suite/ui/generic/template/genericUtilities/FeLogger","sap/ui/model/analytics/odata4analytics","sap/base/util/extend","sap/base/util/deepExtend","sap/suite/ui/generic/template/genericUtilities/FeError","sap/suite/ui/generic/template/genericUtilities/ControlStateWrapperFactory","sap/suite/ui/generic/template/genericUtilities/oDataModelHelper","sap/ui/core/IconPool","sap/ui/export/util/Filter","sap/ui/model/odata/ODataUtils","sap/ui/comp/util/TableUtil","sap/ui/core/Element"],function(e,t,a,r,n,i,o,l,s,c,u,f,p,g,v,d,m,y,b){"use strict";var h="lib.CommonUtils";var E=new l(h).getLogger();var P={0:[{property:"IsActiveEntity",operator:"==",value:false},{property:"SiblingEntity/IsActiveEntity",operator:"==",value:null}],1:[{property:"IsActiveEntity",operator:"==",value:true},{property:"HasDraftEntity",operator:"==",value:false}],2:[{property:"IsActiveEntity",operator:"==",value:false}],3:[{property:"IsActiveEntity",operator:"==",value:true},{property:"SiblingEntity/IsActiveEntity",operator:"==",value:null},{property:"DraftAdministrativeData/InProcessByUser",operator:"!=",value:""}],4:[{property:"IsActiveEntity",operator:"==",value:true},{property:"SiblingEntity/IsActiveEntity",operator:"==",value:null},{property:"DraftAdministrativeData/InProcessByUser",operator:"==",value:""}],5:[{property:"IsActiveEntity",operator:"==",value:true}]};function D(e,l,D){var C=new p(e);var S=Object.create(null);function A(e){var t=e.getToolbar&&e.getToolbar();if(t){var a=j(t);if(a&&a.annotatedActionIds){S[e.getId()]=JSON.parse(atob(a.annotatedActionIds))}if(a&&a.deleteButtonId){S[e.getId()].push({ID:a.deleteButtonId,RecordType:"CRUDActionDelete"})}if(a&&a.multiEditButtonId){S[e.getId()].push({ID:a.multiEditButtonId,RecordType:"CRUDActionMultiEdit"})}}}function I(e){var t=e.getId();if(!S[t]){A(e)}return S[t]||[]}function O(e,t){var a;var r=y.getCustomColumns(e);var n=r.find(function(e){return(t.data("p13nData")&&t.data("p13nData").columnKey)===(e.data("p13nData")&&e.data("p13nData").columnKey)});if(n){a=n.data("isFERenderedColumn")?false:true}return a}function T(t){var a,r,n;a=e.getOwnerComponent().getModel().getMetaModel();r=a.getODataEntitySet(t);n=a.getODataEntityType(r.entityType);return n}function x(e,t){var a=e.split("?");a[1]=a[1].split("&").map(function(e){if(e.startsWith("$filter")){return t}return e}).join("&");e=a.join("?");return e}function M(t){l.oApplication.attachControlToParent(t,e.getView())}function B(t,a,r){var i=function(e,t){if(e===t){return 0}var r=n.byId(e);var i=n.byId(t);if(!r){if(i){return 1}return e>t?1:-1}if(!i){return-1}if(a){var o=n.isTable(r);var l=n.isTable(i);if(o!==l){return o?1:-1}}var s=r.isFocusable();var c=i.isFocusable();if(s!==c){return s?-1:1}return e>t?1:-1};t=t.concat().sort(i);var o=e.getView();var l=t.find(function(e){var t;var a=r&&function(a){r(e,a,t);t=a};return n.isElementVisibleOnView(e,o,a)});return l}function F(t,a,r,n){return l.oApplication.getDialogFragmentForView(e.getView(),t,a,r,n)}function R(t,a,r,n,i,o){return l.oApplication.getDialogFragmentForViewAsync(e.getView(),t,a,r,n,i,o)}var w;function V(t,a,r){var n=e.getOwnerComponent();w=w||n.getModel("i18n").getResourceBundle();if(a&&!Array.isArray(a)){a=[a]}return w.getText(t,a,r)}function N(e,t,a,r){var n=a||e,i=t&&t!="|"?e+"|"+t:n;var o=V(i,r,true);if(!o&&i!=n){o=V(n,r)}return o}function L(t){var a=e.getOwnerComponent();var r=t.indexOf("::"+a.getEntitySet()+"--")+2;var n=t.substring(r,t.lastIndexOf("::")),n=n.replace(/--/g,"|").replace(/::/g,"|");return n}function k(e,t,a,r){var n=L(t);return N(e,n,a,r)}function U(e,t){var t=t||e.getSelectionBehavior();if(t==="DATAPOINT"){return{dataPoints:e.getSelectedDataPoints().dataPoints,count:e.getSelectedDataPoints().count}}else if(t==="CATEGORY"){return{dataPoints:e.getSelectedCategories().categories,count:e.getSelectedCategories().count}}else if(t==="SERIES"){return{dataPoints:e.getSelectedSeries().series,count:e.getSelectedSeries().count}}}function j(e){var t={};if(e instanceof sap.ui.core.Element){e.getCustomData().forEach(function(e){t[e.getKey()]=e.getValue()})}return t}function H(e){var t,a;var r=te(e,true);var n=l.oPresentationControlHandlerFactory.getPresentationControlHandler(r).getSelectedContexts();var i=r.getModel();Q(n,i,r);t=I(r);for(var o=0;o<t.length;o++){a=t[o];K(a,n,r)}}function _(t,a,r){var n=e.byId(t.ID);if(!n){return{}}var i;var o;var l;if(t.RecordType==="CRUDActionDelete"){l=q(r.getModel(),a,r);if(D.getViewLevel()===0){o="/listReport/deleteEnabled"}else{i=Promise.resolve(l)}}else if(t.RecordType==="com.sap.vocabularies.UI.v1.DataFieldForAction"||t.RecordType==="com.sap.vocabularies.UI.v1.DataFieldForIntentBasedNavigation"){var s=r.getModel();var c=s.getMetaModel();i=J(s,c,a,t.RecordType,t.Action,n)}else if(t.RecordType==="CRUDActionMultiEdit"){l=a.filter(Y).length>0;o="/listReport/multiEditEnabled";D.getTemplatePrivateModel().setProperty("/listReport/multiEditEnabled",a.filter(Y).length>0)}if(i){if(i&&!/generic\/controlProperties/.test(n.getBindingPath("enabled"))){i=null;l=n.getEnabled()}}return{enabledPromise:i,path:o,enabled:l}}function K(e,t,a){var r=_(e,t,a);if(r.path){D.getTemplatePrivateModel().setProperty(r.path,r.enabled)}if(r.enabledPromise){r.enabledPromise.then(W.bind(null,e.ID,"enabled"))}}function G(e){var t=ae(e);Q(l.oPresentationControlHandlerFactory.getPresentationControlHandler(t).getSelectedContexts(),e.getModel(),t)}function W(e,t,a){var r=D.getTemplatePrivateModel();var n=r.getProperty("/generic/controlProperties/"+e);if(!n){n={};n[t]=a;r.setProperty("/generic/controlProperties/"+e,n)}else{r.setProperty("/generic/controlProperties/"+e+"/"+t,a)}}function J(e,t,a,r,i,o){var l,s,c,u;var f=false;if(r==="com.sap.vocabularies.UI.v1.DataFieldForAction"){l=t.getODataFunctionImport(i);c=l&&l["sap:action-for"];if(c&&c!==""&&c!==" "){if(a.length>0){u=l["sap:applicable-path"];if(u&&u!==""&&u!==" "){for(var p=0;p<a.length;p++){if(!a[p]||a[p].isTransient()){continue}s=e.getObject(a[p].getPath());if(s&&s[u]){f=true;break}}}else{f=true}}}else{f=true}}else if(r==="com.sap.vocabularies.UI.v1.DataFieldForIntentBasedNavigation"){if(we(a).length>0){f=true}else if(n.isSmartChart(o)){return o.getChartAsync().then(function(){return o.getDrillStackFilters().length>0})}}return Promise.resolve(f)}function q(e,t,a){if(t.length===0){return false}var r=z(a);var n=r&&r.Deletable&&r.Deletable.Path;return t.some(function(t){if(t.isInactive()){return false}else if(t.isTransient()){return true}var a=e.getObject(t.getPath()+"/DraftAdministrativeData");var r=!(a&&a.InProcessByUser&&!a.DraftIsProcessedByMe);return r&&!(n&&!e.getProperty(n,t))})}function z(e){var t=e.getModel()&&e.getModel().getMetaModel();var a=t&&t.getODataEntitySet(e.getEntitySet());var r=a&&a["Org.OData.Capabilities.V1.DeleteRestrictions"];return r}function Y(e){var t=e.getModel();var a=t.getObject(e.getPath()+"/DraftAdministrativeData");var r=g.analyseContext(e);var n=l.oApplication.isObjectInEditMode(r.entitySet,r.key);if(!a&&!n){var i=t.getMetaModel().getODataEntitySet(g.analyseContext(e).entitySet);var o=i["Org.OData.Capabilities.V1.UpdateRestrictions"]&&i["Org.OData.Capabilities.V1.UpdateRestrictions"].Updatable;if(o){if(o.Path){return!!t.getProperty(o.Path,e)}else if(o.Bool!=="false"){return true}}else{return true}}}function Q(t,a,r){var n=ee(r);var i=D.getTemplatePrivateModel();var o=i.getProperty("/generic/listCommons/breakoutActionsEnabled");if(n){var l=e.byId("template::IconTabBar");var s="";if(l){s=l.getSelectedKey()}$(o,n,t,a,s,r)}i.setProperty("/generic/listCommons/breakoutActionsEnabled",o)}function X(e,t,a,r,n,i){var o=i.id+(r&&!i.determining?"-"+r:"");var l=n&&n.getId().indexOf("AnalyticalListPage")>-1;var s=!l||!!e[o].enabled;var c=Z(i,t,a,n,s,l);e[o]={enabled:c}}function Z(e,t,a,r,i,o){var l=i;var s=e.filter==="chart";if(e.requiresSelection){if(t.length>0){if(e.applicablePath){var c=g.splitAccessPath(e.applicablePath);l=t.some(function(e){var t=a.getObject(e.getPath()+c.navigationPath);return t[c.property]===true})}else{l=l||(s?n.isSmartChart(r):n.isSmartTable(r))}}else if(n.isSmartChart(r)){if(!o||s){l=r.getDrillStackFilters().length>0}}else{l=l&&s}}return l}function $(e,t,a,r,n,i){for(var o in t){var l=t[o];X(e,a,r,n,i,l)}}function ee(e){var t=D.getControllerExtensions();var a=j(e).sectionId;if(!a){return t&&t["Actions"]}else{return t&&t.Sections&&t.Sections[a]&&t.Sections[a].Actions}}function te(e,t){var a=[n.isSmartTable,n.isSmartChart,n.isSmartList];if(!t){a.push(n.isMTable);a.push(n.isUiTable)}var r=function(e,t){return t(e)};for(var i=e;i;i=i.getParent&&i.getParent()){var o=a.some(r.bind(null,i));if(o){return i}}return null}function ae(e){var t=e;while(t){if(n.isSmartTable(t)||n.isSmartChart(t)||n.isSmartList(t)){return t}t=t.getParent&&t.getParent()}return null}function re(t){if(!l.oApplication.checkEtags(t)){var a=e.getOwnerComponent();var r=a.getModel();var n=r.getMetaModel().getODataEntitySet(t);if(e.getMetadata().getName()==="sap.suite.ui.generic.template.AnalyticalListPage.view.AnalyticalListPage"&&ne(r,n)){r.invalidateEntityType(n.entityType)}else{var i=function(e){return g.analyseContextPath(e,r).entitySet===t};r.invalidate(i)}var o=a.getId();var s=Object.create(null);s[o]=true;l.oApplication.refreshAllComponents(s);return true}return false}function ne(e,t){var a=new s.Model(s.Model.ReferenceByModel(e));var r=a.findQueryResultByName(t.name);var n=r&&r.getParameterization();return!!n}function ie(t,a,r){var n;if(D.isDraftEnabled()){n=l.oDraftController.isActiveEntity(t)?1:6}else{var i=e.getOwnerComponent();n=i.getModel("ui").getProperty("/editable")?6:1}if(r){l.oApplication.setObjectInEditMode(true);n=6}D.navigateAccordingToContext(t,n,a)}function oe(e){D.openContextInNewTab(e)}function le(e){if(e instanceof sap.fe.navigation.NavError){if(e.getErrorCode()==="NavigationHandler.isIntentSupported.notSupported"){a.show(V("ST_NAV_ERROR_NOT_AUTHORIZED_DESC"),{title:V("ST_GENERIC_ERROR_TITLE"),icon:a.Icon.ERROR})}else{a.show(e.getErrorCode(),{title:V("ST_GENERIC_ERROR_TITLE"),icon:a.Icon.ERROR})}}}function se(t,a){Ce(function(){var a=l.oApplication.getNavigationHandler();var r={semanticObject:t.semanticObject,action:t.action};var n=a.mixAttributesAndSelectionVariant(t.parameters);if(typeof e.adaptNavigationParameterExtension==="function"){e.adaptNavigationParameterExtension(n,r)}Be(t);if(t.parameters["sap-ushell-navmode"]==="explace"){a.navigate(t.semanticObject,t.action,n.toJSONString(),null,null,null,t.parameters["sap-ushell-navmode"])}else{l.oApplication.navigateExternal(t.semanticObject,t.action,n.toJSONString(),null,le)}},Function.prototype,"LeaveApp")}function ce(t){var a=[],r,n,i;var o=e.getOwnerComponent();var l=o.getModel().getMetaModel();if(!t){return{}}var s=o.getAppComponent().getConfig().pages[0];if(!s){return{}}var c=function(e){i=l.getODataEntitySet(e.entitySet).entityType;n=l.getODataEntityType(i);r={};r={entitySet:e.entitySet,aKeys:l.getODataEntityType(i).key.propertyRef,navigationProperty:e.navigationProperty};for(var t=0,a=r.aKeys.length;t<a;t++){var o=0,s=n.property.length;for(o;o<s;o++){if(r.aKeys[t].name===n.property[o].name){r.aKeys[t].type=n.property[o].type;break}}}};var u=function(e,t){if(!t.pages){return a}for(var n=0,i=t.pages.length;n<i;n++){if(!t.pages[n]){break}if(e===t.pages[n].entitySet){c(t.pages[n]);a.splice(0,0,r);break}a=u(e,t.pages[n]);if(a.length>0){c(t.pages[n]);a.splice(0,0,r)}}return a};return u(t,s)}function ue(e,t){var a,r;for(var n=0,i=e.length;n<i;n++){if(e[n].navigationProperty){r+="/"+e[n].navigationProperty}else{r="/"+e[n].entitySet}for(var o=0,l=e[n].aKeys.length;o<l;o++){if(o===0){r+="(";a=""}else{a=","}var s=e[n].aKeys[o];var c=t[s.name];var u=encodeURIComponent(c);switch(s.type){case"Edm.Guid":if(t.DraftAdministrativeData&&t.DraftAdministrativeData.DraftIsCreatedByMe){r+=a+s.name+"="+"guid'"+t.DraftAdministrativeData.DraftUUID+"'"}else{r+=a+s.name+"="+"guid'"+u+"'"}break;case"Edm.Boolean":if(t.DraftAdministrativeData&&t.DraftAdministrativeData.DraftIsCreatedByMe){r+=a+s.name+"="+false}else{r+=a+s.name+"="+u}break;case"Edm.Decimal":case"Edm.Int16":case"Edm.Int32":case"Edm.Int64":case"Edm.Byte":case"Edm.DateTimeOffset":case"Edm.SByte":var f=m.formatValue(u,s.type);r+=a+s.name+"="+f;break;case"Edm.DateTime":var f=m.formatValue(c,s.type);r+=a+s.name+"="+encodeURIComponent(f);break;default:if(typeof u==="string"){r+=a+s.name+"="+"'"+u+"'"}else{r+=a+s.name+"="+u}break}if(o===l-1){r+=")"}}}return r}function fe(e){var t=e.getParameter("originalId"),a=b.getElementById(t),r=te(a,true),i=Object.create(null);i.smartLink=a;if(n.isSmartTable(r)){var o=l.oPresentationControlHandlerFactory.getPresentationControlHandler(r);i.smartTable=r;i.column=o.getColumnForCell(a)}return i}function pe(e,t,a){var r={getSourceInfo:fe.bind(null,e),oSelectionVariant:t};return!!a.beforeSmartLinkPopoverOpensExtension(r)}function ge(e,t,a,r){var n,i,o,s,c,u,f;var p=e.getParameters();var g=l.oApplication.getNavigationHandler();n=g.mixAttributesAndSelectionVariant({},t);if(pe(e,n,a)){return}var v=false;for(s in p.semanticAttributesOfSemanticObjects){v=v||s===p.semanticObject;var d=p.semanticAttributesOfSemanticObjects[s];for(o in d){if(!n.getSelectOption(o)){n.addParameter(o,"")}}c=n.getPropertyNames();u=n.getSelectOptionsPropertyNames();f=n.getParameterNames();for(var m=0,y=c.length;m<y;m++){var b=c[m];if(u.indexOf(b)<0&&f.indexOf(b)<0){delete d[b];n.removeSelectOption(b)}}}if(v){var h=p.semanticAttributesOfSemanticObjects[""];var E=p.semanticAttributesOfSemanticObjects[p.semanticObject];f=n.getParameterNames();f.forEach(function(e){n.removeParameter(e);if(!(e in h)){var t=E[e];t=typeof t==="undefined"||t===null?"":String(t);n.addParameter(e,t)}});n=g.mixAttributesAndSelectionVariant(E,n.toJSONString());n=ve(n,e.getSource(),r);var P={semanticObject:p.semanticObject,action:""};a.adaptNavigationParameterExtension(n,P);i=n.toJSONString()}delete p.semanticAttributes;g.processBeforeSmartLinkPopoverOpens(p,i)}function ve(t,a,r){var i;var o=[];var l=e.getOwnerComponent().getEntitySet();if(n.isSemanticObjectController(a)||n.isSmartTable(a)){i=a.getEntitySet()}else{var s=te(a);var c=s&&s.getParent();if(n.isSmartTable(c)){a=c;i=a.getEntitySet()}else{i=l}}o.push(i);var u=r&&r.oMultipleViewsHandler&&r.oMultipleViewsHandler.getMode&&r.oMultipleViewsHandler.getMode()==="multi";if(i!==l&&!u){o.push(l)}o.forEach(function(e){if(a){var r=a.getModel().getMetaModel();var n=r.getODataEntityType(r.getODataEntitySet(e).entityType);t.getPropertyNames().forEach(function(e){var a=r.getODataProperty(n,e);if(a&&(a["com.sap.vocabularies.UI.v1.ExcludeFromNavigationContext"]&&a["com.sap.vocabularies.UI.v1.ExcludeFromNavigationContext"].Bool!=="false"||a["com.sap.vocabularies.PersonalData.v1.IsPotentiallySensitive"]&&a["com.sap.vocabularies.PersonalData.v1.IsPotentiallySensitive"].Bool!=="false")){t.removeSelectOption(e)}})}});return t}function de(t,a){var r=function(e){for(var t=0;t<e.length;t++){a(e[t].name)}};var n=e.getView().getModel().getMetaModel();var i=n.getODataEntitySet(t,false);var o=n.getODataEntityType(i.entityType,false);r(o.key.propertyRef);var s=l.oDraftController.getDraftContext();if(s.isDraftEnabled(t)){r(s.getSemanticKey(t));a("IsActiveEntity");a("HasDraftEntity");a("HasActiveEntity")}}function me(){return!!(D&&D.getSettings()&&D.getSettings().quickVariantSelectionX)}function ye(t,a,r,n){if(n&&r&&r.getAnalyticBindingPath&&r.getConsiderAnalyticalParameters()){try{var o=r.getAnalyticBindingPath();var l=t.getEntitySet();var s=t.getModel();var c=s.getMetaModel();var u=c.getODataEntitySet(l);var f=e.getOwnerComponent();var p=f.getAppComponent();var g=i.getParametersByEntitySet(p.getModel(),l);if(c.getODataEntityType(u.entityType)["sap:semantics"]!=="aggregate"||me()){if(a){var v=a(u,g);o=v||o}}if(o){n(o)}}catch(e){E.warning("Mandatory parameters have no values")}}}function be(e,t,a){for(var r=0;r<t.length;r++){var n=t[r];var i=n.lastIndexOf("/");var o;if(i<0){if(l.oApplication.getNavigationProperty(e,n)){o=n}else{continue}}else{o=n.substring(0,i)}if(a.indexOf(o)===-1){a.push(o)}}}function he(a,r,n){var i=a.getParameter("bindingParams"),o=a.getSource(),l=o.getId();i.parameters=i.parameters||{};i.parameters.transitionMessagesOnly=D.getNoStateMessagesForTables();var s=function(e,a,n){if(r&&r[e]){var i=true;var o=function(){var r=arguments[0];if(!(r instanceof t)){throw new f(h,"Please provide a valid ControllerExtension in order to execute extension "+e)}if(!i){throw new f(h,"Extension "+e+" must be executed synchronously")}var n=Array.prototype.slice.call(arguments,1);a.apply(null,n)};r[e](o,n);i=false}};var c=function(t){if(!l||e.byId(l)===o){i.filters.push(t)}};if(r.addTemplateSpecificFilters){r.addTemplateSpecificFilters(i.filters)}s("addExtensionFilters",c,l);if(D.getViewLevel()===0){ye(o,r.resolveParamaterizedEntitySet,n,r.setBindingPath)}var u=o.getEntitySet();var p=i.parameters.select&&i.parameters.select.split(",")||[];var g=i.parameters.expand&&i.parameters.expand.split(",")||[];var v=function(t,a){if(t&&(!a||e.byId(a)===o)){var r=t.split(",");r.forEach(function(e){if(e&&p.indexOf(e)===-1){p.push(e)}})}};if(r.isMandatoryFiltersRequired){de(u,v)}s("ensureExtensionFields",v,l);(r.addNecessaryFields||Function.prototype)(p,v,u);be(u,p,g);if(g.length>0){i.parameters.expand=g.join(",")}if(p.length>0){i.parameters.select=p.join(",")}}function Ee(e,t,a){if(!e){return V("DRAFT_OBJECT")}else if(t){return V(a?"LOCKED_OBJECT":"UNSAVED_CHANGES")}else{return""}}function Pe(){return new Promise(function(e){var t;R("sap.suite.ui.generic.template.fragments.DraftAdminDataPopover",{formatText:function(){var e=Array.prototype.slice.call(arguments,1);var t=arguments[0];if(!t){return""}if(e.length>0&&(e[0]===null||e[0]===undefined||e[0]==="")){if(e.length>3&&(e[3]===null||e[3]===undefined||e[3]==="")){return e.length>2&&(e[1]===null||e[1]===undefined||e[1]==="")?"":e[2]}else{return V(t,e[3])}}else{return V(t,e[0])}},closeDraftAdminPopover:function(){t.close()},formatDraftLockText:Ee},"admin").then(function(a){t=a;e(t)})})}function De(e,t,a,r){return l.oDataLossHandler.performIfNoDataLoss(e,t,r,true,true)}function Ce(e,t,a,r){a=a||"LeavePage";if(D.isDraftEnabled()){return l.oPageLeaveHandler.performAfterDiscardOrKeepDraft(e,t,a,r,false)}else{return l.oDataLossHandler.performIfNoDataLoss(e,t,a,r,false)}}function Se(e,t){t=u({busy:{set:true,check:true},dataloss:{popup:true,navigation:false}},t);var a,r;var n=new Promise(function(e,t){a=e;r=t});var i=t.busy.set?function(){if(!D.isDraftEnabled()){l.oApplication.getBusyHelper().setBusy(n,false,{actionLabel:t.sActionLabel})}return e()}:e;var o=t.mConsiderObjectsAsDeleted?function(){l.oApplication.prepareDeletion(t.mConsiderObjectsAsDeleted);return i()}:i;var s=function(){var e;if(D.isDraftEnabled()){l.oApplication.getBusyHelper().setBusy(n,false,{actionLabel:t.sActionLabel});e=l.oApplicationController.synchronizeDraftAsync().then(function(){return o()})}else{e=t.dataloss.popup?Ce(o,r,t.dataloss.navigation?"LeavePage":"Proceed",true):o()}if(e instanceof Promise){e.then(a,r)}else{a(e)}};l.oApplication.performAfterSideEffectExecution(s,t.busy.check&&r);return n}function Ae(e){var t=e.getId()+"-variant";var a=b.getElementById(t);var r=a.getDefaultVariantKey();return r===a.STANDARDVARIANTKEY?"":r}function Ie(e){var t=e.getId()+"-variant";var a=b.getElementById(t);var r=a.getDefaultVariantKey();return r===a.STANDARDVARIANTKEY?"":r}function Oe(t){var a=t.getToolbar();var r=D.getTemplatePrivateModel();var n=e.getOwnerComponent();var i=[],o=[];var l=n.getAppComponent();var s=sap.ui.require("sap/ushell/Container");var u=s&&s.getServiceAsync("Navigation");var f=r.getProperty("/generic/supportedIntents/");var p=a.getContent();var g=p.length;for(var v=0;v<g;v++){var d=j(p[v]);if(d.hasOwnProperty("SemanticObject")&&d.hasOwnProperty("Action")){var m=d.SemanticObject;var y=d.Action;var b={semanticObject:m,action:y,ui5Component:l};i.push(b);var h=c({},b);h.bLinkIsSupported=false;o.push(h)}}if(!i.length||!u){return}u.then(function(e){var t=e.getLinks(i);t.then(function(t){f=r.getProperty("/generic/supportedIntents/");var a=t.length;var n=[],i=[];for(var s=0;s<a;s++){if(t[s].length>0){var c=e.getHref({target:{shellHash:t[s][0].intent}},l);n.push(c);i.push(o[s])}}Promise.all(n).then(function(e){for(var t=0;t<e.length;t++){if(e[t]){i[t].bLinkIsSupported=true}}}).then(function(){o.forEach(function(e){var t=e.semanticObject,a=e.action,n=r.getProperty("/generic/supportedIntents/"+t);if(!n){f[t]={};f[t][a]={visible:e.bLinkIsSupported}}else if(!n[a]){n[a]={visible:e.bLinkIsSupported}}else{n[a]["visible"]=e.bLinkIsSupported}});r.updateBindings()})})})}function Te(t,a){var r=a&&e.byId(a);var n=a&&!r?Promise.reject():new Promise(function(e,a){l.oApplication.performAfterSideEffectExecution(function(){var n=l.oApplication.getBusyHelper();if(n.isBusy()){a();return}if(r&&(!r.getVisible()||r.getEnabled&&!r.getEnabled())){a();return}var i=r?t(r):t();if(i instanceof Promise){i.then(e,a);n.setBusy(i)}else{e(i)}})});n.catch(Function.prototype);return n}function xe(t,a,r,n,i){var o;let s=n?.bInvocationGroupingChangeSet?"com.sap.vocabularies.UI.v1.OperationGroupingType/ChangeSet":"";let c=n?.sLabel??"";let u=n?.bStrict??false;if(!a){o=[]}else if(Array.isArray(a)){o=a}else{o=[a]}D.executeBeforeInvokeActionFromExtensionAPI(i);const f=l.oCRUDManager.callAction({contexts:o,functionImportPath:t,label:c,operationGrouping:s,skipProperties:{},urlParameters:r,bStrict:u,bInvokedByExtensionApi:true,oModelFromExtensionApi:e.getOwnerComponent()?.getModel()},i);if(n&&n.bSetBusy){D.getBusyHelper().setBusy(f)}f.then(D.executeAfterInvokeActionFromExtensionAPI.bind(null,i));return f}function Me(e){var t=l.oApplication.getChevronNavigationRefreshBehaviour(e);if(t!==Object.create(null)){l.oViewDependencyHelper.setRefreshBehaviour(t)}}function Be(e){var t=l.oApplication.getComponentRefreshBehaviour(e);l.oViewDependencyHelper.setRefreshBehaviour(t)}function Fe(e,t){var a=t.getModel();var r=t.getPath().split("/")[1];var n=a.oData[r];if(e){var i=n&&n[e]&&n[e].__ref;var o=a.oData[i];return o}else{return n}}function Re(t,a){if(t&&t.__metadata){var r=t.__metadata.edit_media;var n=t.__metadata.content_type;var i="";if(r){if(r.startsWith("http:")||r.startsWith("https:")){var o=r&&new URL(r);i=o&&o.pathname}else{i=r}}var l=v.getIconForMimeType(n);var s={url:i,fileType:n,icon:l};var c=D.getTemplatePrivateModel();var u=e.getOwnerComponent().getEntitySet();if(!c.getProperty("/generic/controlProperties/fileUploader")){c.setProperty("/generic/controlProperties/"+"fileUploader",{})}if(a){c.setProperty("/generic/controlProperties/"+"fileUploader/"+a,s)}else{c.setProperty("/generic/controlProperties/"+"fileUploader/"+u,s)}}}function we(e){return e.filter(function(e){return!e||!e.isTransient()})}function Ve(t,a,r,n){var o=e.getOwnerComponent().getModel().getMetaModel();var l=i.getNavigationPropertyRelationship(o,t,a);var s=i.getNavigationPropertyRelationship(o,r,n);return l.relationship===s.relationship&&l.fromRole===s.toRole&&l.toRole===s.fromRole}function Ne(t){var a=t.getSource();return n.isButton(a)?a.data():b.getElementById(e.createId(j(a)["ActionId"])).data()}function Le(t){if(!D.isDraftEnabled()){return}var a=e.byId("editStateFilter");if(!a){return}var r=a.getSelectedKey(),n=P[r];n.forEach(function(e){var a=t.findIndex(function(t){return e.property===t.property&&e.operator===t.rawValues[0].operator&&e.value===t.rawValues[0].value&&t.rawValues.length===1});if(a!==-1){t.splice(a,1)}});var i=a.getLabels().at(0).getText(),o=a.getSelectedItem().getText(),l={operator:"==",value:o};var s=new d("editStateFilter",l,i);t.push(s)}function ke(t,a){var n=t.getSmartFilterId();if(!n){return}var i=e.byId(n);var o=i.getAnalyticalParameters();if(!o.length){return}var l=i&&i.getUiState({allFilters:false});var s=l?JSON.stringify(l.getSelectionVariant()):"{}";var c=new r(s);o.forEach(function(e){var t=c.getParameter(e.name);if(!t){return}if(e.type==="Edm.DateTime"||e.type==="Edm.DateTimeOffset"){t=new Date(t)}var r=new d(e.name,{operator:"==",value:t},e.fieldLabel);r.setType(e.ui5Type);a.push(r)})}var Q=o.testable(Q,"fillEnabledMapForBreakoutActions");var te=o.testable(te,"getOwnerControl");var I=o.testable(I,"fnGetToolbarCustomData");var ve=o.testable(ve,"removePropertiesFromNavigationContext");return{getPositionableControlId:B,getMetaModelEntityType:T,fnReplaceFiltersWithGetDownloadUrl:x,getText:V,getSpecializedText:N,getSpecificI18nKeyForSmartControl:L,getContextText:k,getNavigationKeyProperties:ce,mergeNavigationKeyPropertiesWithValues:ue,isMultiViewMultiEntity:me,executeGlobalSideEffect:function(){if(D.isDraftEnabled()){var t=e.getView();var a=e.getOwnerComponent();var r=a.getAppComponent();var i=r.getForceGlobalRefresh();var o=a.getModel("ui");t.attachBrowserEvent("keydown",function(e){var a=e.target.type==="search";var r=e.target.type==="textarea";var s=e.target.id.indexOf("rowAction")>-1;var c=e.target.id.indexOf("ColumnListItem")>-1;if(e.keyCode===13&&e.ctrlKey!==true&&o.getProperty("/editable")&&!a&&!r&&!s&&!c){l.oApplication.addSideEffectPromise(new Promise(function(e,a){var r,o,s,c=false,u={draftRootContext:D.getMainComponentDetails().bindingContext,callPreparationOnDraftRoot:true,callPreparationOnly:false};var f=function(){setTimeout(function(){var t=l.oApplicationController.executeSideEffects(s,null,null,i,u);t.then(function(){e()},a)})};var p=function(e){var t=e.getFirstInnerControl&&e.getFirstInnerControl();if(t.getValue()!==t.getLastValue()){return true}return false};o=n.getControlWithFocus();while(o){if(n.isSmartField(o)){s=o.getBindingContext&&o.getBindingContext();if(s.isTransient()){if(!p(o)){u.callPreparationOnly=true}f();return e()}}else if(n.isOverflowToolbar(o)||n.isButton(o)||n.isLink(o)||n.isMultiInputField(o)&&(o._sTypedInValue&&o._sTypedInValue.length>0)){c=true}else if(n.isSmartForm(o)){r=o;break}else if(n.isSmartTable(o)){break}o=o.getParent()}if(c){u={}}s=s||o&&o.getBindingContext&&o.getBindingContext()||t.getBindingContext();var g=r?r.check():Promise.resolve();g.then(f)}))}})}},setEnabledToolbarButtons:H,setEnabledFooterButtons:G,getToolbarActionEnablementInfo:_,fillEnabledMapForBreakoutActions:Q,getBreakoutActions:ee,isBreakoutActionEnabled:Z,getSelectionPoints:U,getDeleteRestrictions:z,getSmartTableDefaultVariant:Ae,getSmartChartDefaultVariant:Ie,setPrivateModelControlProperty:W,removePropertiesFromNavigationContext:ve,navigateFromListItem:ie,navigateExternal:se,semanticObjectLinkNavigation:ge,getCustomData:function(e){var t=e.getSource().getCustomData();var a={};for(var r=0;r<t.length;r++){a[t[r].getKey()]=t[r].getValue()}return a},getToolbarCustomData:I,isSupportedColumn:function(e,t,a){var r=e.data("p13nData")&&e.data("p13nData").columnKey;if(r.indexOf("DataFieldForAnnotation")>-1||r.indexOf("DataFieldForAction")>-1||r.indexOf("DataFieldForIntentBasedNavigation")>-1||t&&t["com.sap.vocabularies.UI.v1.IsImageURL"]&&t["com.sap.vocabularies.UI.v1.IsImageURL"].Bool==="true"||e.data("addCardtoInsightsConfig")&&e.data("addCardtoInsightsConfig").isMultiValueColumn||O(a,e)){return false}return true},isCustomColumn:O,getCustomDataText:function(e){return new Promise(function(t,a){e.getCustomData().forEach(function(e){var a=e.getKey();if(a==="text"){var r=e.getBinding("value");var n=!r&&e.getBindingInfo("value");if(!r&&!n){t(e.getValue());return}var i=function(e){var a=e.getSource();a.detachChange(i);t(a.getExternalValue());return};if(r){if(!r.isInitial()){t(r.getExternalValue());return}r.attachChange(i)}else{n.events={change:i};for(var o=0;o<n.parts.length;o++){n.parts[o].targetType="string"}}}})})},onBeforeRebindTableOrChart:he,formatDraftLockText:Ee,showDraftPopover:function(e,t){Pe().then(function(a){var r=a.getModel("admin");r.setProperty("/IsActiveEntity",e.getProperty("IsActiveEntity"));r.setProperty("/HasDraftEntity",e.getProperty("HasDraftEntity"));a.bindElement({path:e.getPath()+"/DraftAdministrativeData"});if(a.getBindingContext()){a.openBy(t)}else{a.getObjectBinding().attachDataReceived(function(){a.openBy(t)})}})},getContentDensityClass:function(){return l.oApplication.getContentDensityClass()},attachControlToView:M,getDialogFragment:F,getDialogFragmentAsync:R,fnProcessDataLossOrDraftDiscardConfirmation:Ce,processDataLossTechnicalErrorConfirmation:De,securedExecution:Se,getOwnerControl:te,getOwnerPresentationControl:ae,refreshModel:re,getElementCustomData:j,triggerAction:function(t,a,r,n){l.oDataLossHandler.performIfNoDataLoss(function(){l.oCRUDManager.callAction({functionImportPath:r.Action,contexts:t,sourceControlHandler:n,label:r.Label,operationGrouping:"",actionType:r.ActionType}).then(function(n){if(n&&n.length>0){var i=n[0];var o=i.response&&i.response.context||i.context;var s=o&&o.getPath();var c=o&&(!i.actionContext||s!==i.actionContext.getPath());if(c){l.oViewDependencyHelper.setMeToDirty(e.getOwnerComponent(),a,false,s==="/undefined"||t.length>1);if(r.ActionType==="determining"){l.oViewDependencyHelper.setParentToDirty(e.getOwnerComponent(),a,1)}}}})},Function.prototype,"Proceed",undefined,false)},checkToolbarIntentsSupported:Oe,executeIfControlReady:Te,invokeActionsForExtensionAPI:xe,isContextEditable:Y,setExternalChevronRefreshBehaviour:Me,setComponentRefreshBehaviour:Be,getStreamData:Fe,setStreamData:Re,getControlStateWrapper:C.getControlStateWrapper,filterActiveContexts:we,checkInverseNavigation:Ve,getCustomDataFromEvent:Ne,getControlStateWrapperById:C.getControlStateWrapperById,handleError:le,transformTechnicalPropsOnExportedFile:Le,includeEntitySetParametersToExportedFile:ke,openContextInNewTabFromListItem:oe}}return e.extend("sap.suite.ui.generic.template.lib.CommonUtils",{constructor:function(e,t,a){c(this,D(e,t,a))}})});
//# sourceMappingURL=CommonUtils.js.map