sap.ui.define(["sap/fe/navigation/SelectionVariant","sap/ui/core/Element"],function(e,t){"use strict";var a={};function r(e){if(e){if(e.hasOwnProperty("SelectionVariantID")){delete e.SelectionVariantID}else if(e.hasOwnProperty("PresentationVariantID")){delete e.PresentationVariantID}delete e.Text;delete e.ODataFilterExpression;delete e.Version;delete e.FilterContextUrl;delete e.ParameterContextUrl;return e}return null}function n(e,t,a){var r;e.forEach(function(e){r=e&&e.Ranges;t.massAddSelectOption(a,r)})}function i(t){var a,i,o;var l=0;for(var u in t){var s=new e;if(t.hasOwnProperty(u)&&t[u]){a=t[u].value;if(a&&typeof a==="string"&&h(a)){a=JSON.parse(a);if(typeof a!=="object"){t[u].value=a.toString();continue}i=a.SelectOptions&&a.SelectOptions[0];if(i&&i.Ranges&&i.Ranges.length===1){o=i.Ranges[0]||{};if(o.Option==="EQ"&&!o.Low){i.Ranges=[];t[u].value=JSON.stringify(a)}}}else if(a&&Array.isArray(a)){var f,c;for(l=0;l<a.length;l++){f=JSON.parse(a[l]);c=f&&f.SelectOptions||[];n(c,s,u)}s=r(s&&s.toJSONObject());t[u].value=JSON.stringify(s)}}}}function o(e,t){var a=e.getMetaModel();var r=a.getODataEntitySet(t);var n=a.getODataEntityType(r.entityType);var i=n.navigationProperty||[];var o=i.find(function(e){return e.name==="Parameters"});if(o){var l=a.getODataAssociationEnd(n,o.name);var u=l&&l.type&&a.getODataEntityType(l.type);if(u&&u["sap:semantics"]==="parameters"&&u.key){return u}}return null}function l(e,t,a){var r=o(e,t);if(r){var n=r.property.find(function(e){return e.name===a});var i=n&&n["com.sap.vocabularies.Common.v1.FilterDefaultValue"]||{};var l=Object.keys(i);if(l.length){return i[l[0]]}return n.defaultValue===undefined?null:n.defaultValue}return null}function u(e,t){var a=t&&t.getFilterData();var r=a._CUSTOM&&a._CUSTOM["sap.suite.ui.generic.template.customData"];if(a&&(a["$Parameter."+e]||a[e])){return a["$Parameter."+e]||a[e]||""}else if(r&&(r["$Parameter."+e]||r[e])){return r["$Parameter."+e]||r[e]||""}}function s(e,t){var a=[];if(e){a=t&&t.property&&t.property.filter(function(t){return t&&t.name===e})||[]}var r=a&&a.length?a[0]:{};var n=r&&r["com.sap.vocabularies.Common.v1.FilterDefaultValue"]||{};var i=Object.keys(n);return r&&(i&&i.length&&n[i[0]]||r.defaultValue)}function f(e){var t;var a=[];if(e&&Array.isArray(e)){e.forEach(function(e){if(e){t=r(JSON.parse(e));a.push(JSON.stringify(t))}});return a}else if(e&&h(e)){t=r(JSON.parse(e));return JSON.stringify(t)}}function c(e){var t="";if(!e){return null}if(e.type){t=e.type.startsWith("Edm.")?e.type.split("Edm.")[1]:e.type}var a={Boolean:"boolean",Byte:"integer",SByte:"integer",Int16:"integer",Int32:"integer",Int64:"number",Single:"number",Double:"number",Float:"number",Decimal:"number",Guid:"string",String:"string",Date:"date",DateTime:"datetime",DateTimeOffset:"datetime",Time:"datetime",Binary:"",Stream:"",TimeOfDay:"",Duration:""};if(t&&t==="string"){return t}else if(t&&a[t]){return a[t]}else{return"string"}}function g(e,t,a,r){var n="";if(Array.isArray(t)){n=t.find(function(t){return t&&t.includes(e.Low)})||""}else if(typeof t==="string"){n=t}if(!n&&e.Low&&e.High){var i=a&&a.getFilterData()||{},o=i[r]||{};if(o.ranges){var l=o.ranges||[];var u=l.filter(function(t){return t.value1===e.Low});var s=u[0]||{};n=s.tokenText||""}}return n}function v(e,t,a,r){var n=e&&e.getUiState(),i=n&&n.getSelectionVariant(),o=i&&i.SelectOptions||[],l=false;o.filter(function(e){return e&&e["PropertyName"]===t}).map(function(n){l=true;var i=n&&n.Ranges||[];i.forEach(function(n){var i=g(n,r,e,t);a.addSelectOption(t,n.Sign,n.Option,n.Low,n.High,i)})});if(!l){a.addSelectOption(t,"I","EQ","")}}function p(e){var t=e["component"].getModel("_templPriv"),a=t.getProperty("/listReport/datePropertiesSettings");if(a){return a}}function m(e,t){var a=p(e);var r=t&&t.name;var n=a&&Object.keys(a);if(n&&n.length&&r){return n&&n.indexOf(r)>-1}else if(V(t)){var i=e["component"].getFilterSettings();return i&&i.dateSettings&&i.dateSettings.useDateRange}}function d(e,t){if(t){a[e.name]={"sap:filter-restriction":"single-value"}}else{a[e.name]={"sap:filter-restriction":e["sap:filter-restriction"]}}}function S(e,t){var a=p(e);if(a&&a[t]&&a[t]["defaultValue"]){return a[t]["defaultValue"]["operation"]}else{var r=e["component"].getFilterSettings();var n=r&&r.dateSettings&&r.dateSettings.fields;return n&&n[t]&&n[t]["defaultValue"]&&n[t]["defaultValue"]["operation"]}}function y(e,t){var a=e&&e.getUiState(),r=a&&a.getSelectionVariant(),n=r&&r.SelectOptions||[];var i=n.filter(function(e){return e&&e["PropertyName"]===t});i=i&&i[0]||[];var o=i.Ranges||[];return o&&o[0]}function O(e,t,a,r,n){if(e&&a){var i=e.conditionTypeInfo;return i&&i.data&&i.data["operation"]}if(!a){var o=u(t.name,r);var i=o&&o.conditionTypeInfo;var l=i&&i.data&&i.data["operation"];var s=o&&o["ranges"];var f=s&&s[0];if(l){switch(l){case"DATE":case"DATERANGE":case"SPECIFICMONTH":case"FROM":case"TO":var c=g({Low:f.Low},n,r,t.name);var v=y(r,t.name);if(v){v.Text=c;return v}break;case"LASTDAYS":case"LASTWEEKS":case"LASTMONTHS":case"LASTQUARTERS":case"LASTYEARS":case"NEXTDAYS":case"NEXTWEEKS":case"NEXTMONTHS":case"NEXTQUARTERS":case"NEXTYEARS":var p=i&&i.data&&i.data.value1;var c=g({Low:p},n,r,t.name);return{Low:l,High:p.toString(),Option:"BT",Text:c};case"TODAYFROMTO":var m=i&&i.data&&i.data.value1;var d=i&&i.data&&i.data.value2;var c=g({Low:m},n,r,t.name);return{Low:l,High:m.toString()+","+d.toString(),Option:"BT",Text:c};default:var c=g({Low:l},n,r,t.name)||"";c=c.substring(0,c.indexOf("(")-1);return{Low:l,High:null,Option:"EQ",Text:c}}}}}function T(e,t,a,r,n){var i=e.oSmartFilterbar,o=S(e,t.name)||a,l=O(null,t,false,i,n);if(l){r.addSelectOption(t.name,"I",l.Option,l.Low,l.High,l.Text)}else if(o){r.addSelectOption(t.name,"I","EQ",o,null,o)}}function D(e,a){if(a&&e){var r=a.getFiltersWithValues()||[],n="",i=r.filter(function(t){n=t&&t.getName();return n===e||"$Parameter."+e===n});var o=i&&i[0]&&i[0].getControl();if(o&&o.getMetadata()&&o.getMetadata().getName()==="sap.m.DynamicDateRange"){var l=o.getIdForLabel()||"";l=l.substring(0,l.lastIndexOf("-"));if(l){var u=t.getElementById(l);return u&&u.getValue()}}else if(o&&o.hasOwnProperty("value")){return o.getProperty("value")}else if(o&&typeof o.getTokens==="function"){var s=o.getTokens()||[],f=s.map(function(e){return e.getText()});return{type:"filters",value:f}}}}function E(e,t,a,r,n,i){var o=D(e,t);if(o&&typeof o==="string"){if(!a[e]){a[e]={}}a[e]["label"]=o;if(n){o=i?n:o}return o}else if(o&&o.value&&o.type==="filters"){return o.value}}function V(e){if((e["type"]==="Edm.DateTime"&&e["sap:display-format"]==="Date"||e["type"]==="Edm.String"&&e["com.sap.vocabularies.Common.v1.IsCalendarDate"]&&e["com.sap.vocabularies.Common.v1.IsCalendarDate"].Bool==="true")&&(e["sap:filter-restriction"]==="interval"||e["sap:filter-restriction"]==="single-value"||e["_filterRestriction"]==="single-value")){return true}return false}function h(e){try{if(JSON.parse(e)){return true}}catch(e){return false}}function R(e,t){var a=e.filter(function(e){return P(e)})||[];if(t&&t.length>0){e.forEach(function(e){var r="P_"+e.name;if(t.includes(r)){a.push(e)}})}return a}function P(e){return e["sap:filterable"]?e["sap:filterable"]!=="false":true}function b(t){var a=new e;t&&t.forEach(function(e){var t=e.values;a.addSelectOption(e.name,"I",e.operator,t[0].toString(),"")});return a}return{enhanceVariant:f,updateRangeValue:i,getPropertyType:c,getFilterDefaultValue:s,getParameterDefaultValue:l,addFiltervalues:v,getParameterActualValue:u,removeExtraInfoVariant:r,IsSemanticDateRangeValid:m,getDateRangeValue:O,getLabelForConfigParams:E,getRelatedTextToRange:g,setFilterRestrictionToSemanticDateRange:d,addDateRangeValueToSV:T,getDateRangeDefaultValue:S,getCommonFilterProperties:R,isPropertyFilterable:P,createSVFromFilter:b}});
//# sourceMappingURL=filterHelper.js.map