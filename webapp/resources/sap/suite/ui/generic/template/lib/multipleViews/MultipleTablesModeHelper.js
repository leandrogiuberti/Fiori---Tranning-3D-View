sap.ui.define(["sap/ui/base/Object","sap/ui/Device","sap/ui/model/Filter","sap/suite/ui/generic/template/genericUtilities/oDataModelHelper","sap/suite/ui/generic/template/genericUtilities/testableHelper","sap/base/util/extend","sap/suite/ui/generic/template/js/StableIdHelper","sap/base/util/isEmptyObject"],function(e,t,r,n,a,i,l,o){"use strict";function p(e,t){if(Array.isArray(e)){var n=true;var a;for(var i=0;i<e.length;i++){var l=p(e[i],t);if(n){if(l===e[i]){continue}n=false;a=e.slice(0,i)}if(l){a.push(l)}}return n?e:a}if(e.aFilters){var o=p(e.aFilters,t);if(o===e.aFilters){return e}if(o.length===0){return null}if(o.length===1){return o[0]}return new r({filters:o,and:e.bAnd})}return t(e)}function s(e,r,i){var s;var u;var c;var g=new Promise(function(e){c=e});var m=r.oComponentUtils.getTemplatePrivateModel();var f=i.pathInTemplatePrivateModel+"/implementingHelper";var d=f+"/ignoredFilters";m.setProperty(f,{ignoredFilters:[]});var v=e.getOwnerComponent().getEntitySet();var S=r.oCommonUtils.getMetaModelEntityType(v);function b(){var e;for(var t in s){var r=s[t];var n=r.presentationControlHandler.getEntitySet();if(e&&e!==n){return true}e=n}return false}function y(e,t){if(t.length===0){return e}var r=e.slice(0);F(r,t);return r}function h(e,t,r){var n=i.smartFilterBar;if(!n){return e}var a=n.getFilters();if(a.length===0){if(!r){m.setProperty(d,[]);t.implementingHelperAttributes.ignoredLabels=[]}return e}a=A(t,a,!r);return a.concat(e)}function C(e){var t=n.splitAccessPath(e);return t.property}function A(t,n,a){var i=t.presentationControlHandler;var l=i.getEntitySet();if(l===v){if(a){m.setProperty(d,[]);t.implementingHelperAttributes.ignoredLabels=[]}return n}var o=e.getOwnerComponent().getModel().getMetaModel();var s=r.oCommonUtils.getMetaModelEntityType(l);var u=a&&Object.create(null);var c=function(e){var t=e.sPath;var r=false;var n=C(t);var a=H(t,o,s);if(a){a.some(function(e){var t;if(e.name===n){var t=e["com.sap.vocabularies.UI.v1.Hidden"];r=!t||t.Bool!=="true";return true}return false})}if(r){return e}if(u){u[t]=true}return null};var g=p(n,c);if(u){var f=Object.keys(u);var b=f.map(function(e){var t=C(e);var r=H(e,o,S);var n=r&&r.find(function(e){return e.name===t});var a=n&&(n["sap:label"]||n["com.sap.vocabularies.Common.v1.Label"]&&n["com.sap.vocabularies.Common.v1.Label"].String)||t;return a});m.setProperty(d,b);t.implementingHelperAttributes.ignoredLabels=b}return g}function H(e,t,r){var n=e.split("/");for(var a=0;r&&a<n.length-1;a++){var i=n[a];var l=r.navigationProperty;var o=false;for(var p in l){if(l[p].name===i){o=true;break}}var s=o&&t.getODataAssociationEnd(r,i);r=s&&t.getODataEntityType(s.type)}return r&&r.property}function F(e,t){for(var r in t){var n=t[r];for(var a=e.length;a--;a>=0){if(JSON.stringify(e[a])===JSON.stringify(n)){e.splice(a,1);break}}}}function E(t){return{entityTypeProperty:r.oCommonUtils.getMetaModelEntityType(t.presentationControlHandler.getEntitySet()).property,dirtyState:0,controlStateWrapper:r.oCommonUtils.getControlStateWrapper(e.byId(l.getStableId({type:"ListReportTable",subType:"SmartTable",sQuickVariantKey:t.switchingKey}))),searchFieldWrapper:r.oCommonUtils.getControlStateWrapper(e.byId(l.getStableId({type:"ListReportAction",subType:"SearchField",sQuickVariantKey:t.switchingKey})))}}function I(e,t,r){s=e;for(var n in s){var a=s[n];a.implementingHelperAttributes=E(a);a.implementingHelperAttributes.controlStateWrapper.attachStateChanged(i.appStateChange);a.implementingHelperAttributes.searchFieldWrapper.attachStateChanged(i.appStateChange)}if(i.smartFilterBar){i.smartFilterBar.attachSearch(function(e){t(3)})}c()}function L(e,n){if(!n){return""}var a="";var i=s[n].text;if(e&&e.length>0){if((t.system.tablet||t.system.phone)&&!t.system.desktop){if(e.length>1){a=r.oCommonUtils.getText("MESSAGE_MULTIPLE_VALUES_S_FORM",[e.join(", "),i])}else{a=r.oCommonUtils.getText("MESSAGE_SINGLE_VALUE_S_FORM",[e[0],i])}}else if(e.length>1){a=r.oCommonUtils.getText("MESSAGE_MULTIPLE_VALUES_L_FORM",[e.join(", "),i])}else{a=r.oCommonUtils.getText("MESSAGE_SINGLE_VALUE_L_FORM",[e[0],i])}}return a}function M(e){var t=s[e];var r=t.implementingHelperAttributes.ignoredLabels||[];m.setProperty(d,r);i.adaptPresentationControl()}function W(e){u=e;g.then(function(){var t,r;if(e.controlStates){for(var n in s){s[n].implementingHelperAttributes.controlStateWrapper.setState(e.controlStates[s[n].presentationControlHandler.getId()]);s[n].implementingHelperAttributes.searchFieldWrapper.setState(e.controlStates[s[n].implementingHelperAttributes.searchFieldWrapper.getLocalId()])}}else{for(var n in s){t=s[n].presentationControlHandler;r=e.tableVariantIds[t.getId()];if(r){t.setCurrentVariantId(r)}}}M(e.selectedTab)});return e.selectedTab}function T(e){var t,r,n=Object.create(null);if(o(s)){return u}for(t in s){r=s[t].presentationControlHandler;n[r.getId()]=s[t].implementingHelperAttributes.controlStateWrapper.getState();if(s[t].implementingHelperAttributes.searchFieldWrapper.getLocalId()){n[s[t].implementingHelperAttributes.searchFieldWrapper.getLocalId()]=s[t].implementingHelperAttributes.searchFieldWrapper.getState()}}var a={selectedTab:e,controlStates:n};return a}function O(e){return e}function U(e){return{getState:function(){var e=Object.create(null);Object.values(s).forEach(function(t){e[t.implementingHelperAttributes.controlStateWrapper.getLocalId()]=t.implementingHelperAttributes.controlStateWrapper.getState();var r=t.implementingHelperAttributes.searchFieldWrapper;if(r.getLocalId()){e[r.getLocalId()]=r.getState()}});return{controlStates:e}},setState:function(e){if(e&&e.controlStates){Object.values(s).forEach(function(t){t.implementingHelperAttributes.controlStateWrapper.setState(e.controlStates[t.implementingHelperAttributes.controlStateWrapper.getLocalId()]);t.implementingHelperAttributes.searchFieldWrapper.setState(e.controlStates[t.implementingHelperAttributes.searchFieldWrapper.getLocalId()])})}else{}},attachStateChanged:function(e){g.then(function(){Object.values(s).forEach(function(t){t.implementingHelperAttributes.controlStateWrapper.attachStateChanged(e);t.implementingHelperAttributes.searchFieldWrapper.attachStateChanged(e)})})},bVMConnection:true}}function _(e,t,r,n,a,i,l){var o=function(t){if(t===n&&i){l(e);return}var r=s[t];if(r.implementingHelperAttributes.dirtyState>0&&r.implementingHelperAttributes.dirtyState!==e){r.implementingHelperAttributes.dirtyState=3}else{r.implementingHelperAttributes.dirtyState=e}};if(t){if(a){t.forEach(o);return}o(t);return}for(var p in s){if(!r||r[s[p].presentationControlHandler.getEntitySet()]){o(p)}}}function P(){return"multi"}function V(e){var t=s[e];var r=t.implementingHelperAttributes.dirtyState;t.implementingHelperAttributes.dirtyState=0;return r}function j(e,t){for(var r in s){var n=s[r].presentationControlHandler;n.setCurrentTableVariantId(t);n.setCurrentChartVariantId(e)}}function w(e){var t=e.getEntitySet();for(var r in s){var n=s[r];var a=n.presentationControlHandler;if(a!==e&&a.getEntitySet()===t&&n.implementingHelperAttributes.dirtyState<2){n.implementingHelperAttributes.dirtyState+=2}}}var A=a.testable(A,"fnCleanupIrrelevantFilters");return{init:I,getDefaultShowCounts:b,getFiltersAdaptedFromItem:h,getCommonFiltersForCounts:y,formatMessageStrip:L,onSelectedKeyChanged:M,getContentForIappState:T,getSelectedKeyAndRestoreFromIappState:W,getSFBVariantContentStateWrapper:O,getGeneralContentStateWrapper:U,refreshOperation:_,getMode:P,getRefreshMode:V,setControlVariant:j,refreshSiblingControls:w}}return e.extend("sap.suite.ui.generic.template.lib.multipleViews.MultipleTablesModeHelper",{constructor:function(e,t,r){i(this,s(e,t,r))}})});
//# sourceMappingURL=MultipleTablesModeHelper.js.map