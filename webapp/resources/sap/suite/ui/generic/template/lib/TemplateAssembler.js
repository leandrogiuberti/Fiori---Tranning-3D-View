sap.ui.define(["sap/ui/core/mvc/ControllerExtension","sap/ui/core/mvc/OverrideExecution","sap/ui/core/mvc/View","sap/ui/model/base/ManagedObjectModel","sap/suite/ui/generic/template/lib/TemplateViewController","sap/suite/ui/generic/template/lib/TemplateComponent","sap/suite/ui/generic/template/lib/CRUDManager","sap/suite/ui/generic/template/lib/CommonUtils","sap/suite/ui/generic/template/lib/ComponentUtils","sap/suite/ui/generic/template/lib/CommonEventHandlers","sap/suite/ui/generic/template/genericUtilities/testableHelper","sap/suite/ui/generic/template/genericUtilities/FeLogger","sap/base/util/deepExtend","sap/suite/ui/generic/template/lib/presentationControl/PresentationControlHandlerFactory","sap/suite/ui/generic/template/lib/info/InfoObjectHandler","sap/m/IllustratedMessageType","sap/suite/ui/generic/template/lib/ViewCreationHelper"],function(e,t,o,n,i,r,a,l,s,p,c,m,u,d,f,v,g){"use strict";var C=new m("lib.TemplateAssembler").getLogger();var h=Object.create(null);var y=Object.create(null);var R=function(e){var t=e.appComponent.getId();y[t]=e;return function(){delete y[t]}};function T(e){var t=e.getId();var o=y[t];return o}function w(e){return T(e.getAppComponent()).oTemplateContract.componentRegistry[e.getId()]}function A(e){while(e&&!(e instanceof o)){e=e.getParent()}return e}function b(e){while(e){var t=A(e);var o=t&&t.getController();var n=o&&o.getOwnerComponent();if(n instanceof r){var i=w(n);return i}else{e=n&&n.oContainer}}}function I(o,n,r){var a=h[o];if(a){return a}n=u({},n);r=u({},r);r.metadata=r.metadata||{};r.metadata.methods=r.metadata.methods||{};for(var l in r){if(typeof r[l]==="function"){var s=r.metadata.methods[l];if(!s){s={};r.metadata.methods[l]=s}s.public=s.public!==false;s.final=s.final||false;s.overrideExecution=s.overrideExecution||t.After}}r.metadata.methods.getExtensionAPI={public:true,final:true};r.getExtensionAPI=function(){var e=this.getView().getController();return e.extensionAPI};n.templateBaseExtension=e.extend(o+"BaseExtension",r);a=i.extend(o,n);h[o]=a;return a}function x(e){var t=e.methods.oControllerSpecification;return t?function(){var o=e.oComponent.getAppComponent();var i=T(o);var r=o.getTransactionController();var s=o.getNavigationController();var c={oComponentUtils:e.utils,oServices:{oTemplateCapabilities:{},oApplicationController:o.getApplicationController(),oTransactionController:r,oNavigationController:s,oDraftController:r.getDraftController(),oApplication:i.application,oViewDependencyHelper:i.oViewDependencyHelper}};e.viewRegistered.catch(function(t){C.debug(t.message);s.navigateToMessagePage({viewLevel:e.viewLevel,title:e.oTemplateContract.getText("ST_ERROR"),text:e.oTemplateContract.getText("ST_GENERIC_UNKNOWN_NAVIGATION_TARGET"),description:t.message,messageType:v.PageNotFound})});e.oControllerUtils=c;var m=e.methods.oComponentData.templateName;var u=I(m,t.oControllerDefinition,t.oControllerExtensionDefinition);var g=new u;e.oController=g;var h=t.getMethods(c,g);g._templateEventHandlers=Object.freeze(h.handlers||{});g._templateFormatters=Object.freeze(h.formatters||{});g.extensionAPI=Object.freeze(h.extensionAPI||{});var y;g.onInit=function(){var t=g.getView();y=t.getId();C.info("Init view "+y+" of template "+m);if(o.isDestroyed()){C.info("Skip Init view as AppComponent is no longer active");return}c.oServices.controllerServices=Object.freeze(h.controllerServices||{});c.oServices.oApplicationController.registerView(t);c.oServices.oDataLossHandler=i.oTemplateContract.oDataLossHandler;c.oServices.oInsightsFECardProvider=i.oTemplateContract.oInsightsFECardProvider;c.oServices.oFioriAIHandler=i.oTemplateContract.oFioriAIHandler;c.oCommonUtils=new l(g,c.oServices,c.oComponentUtils);c.oInfoObjectHandler=new f(g,c);c.oServices.oCRUDManager=new a(g,c.oComponentUtils,c.oServices,c.oCommonUtils,i.oTemplateContract.oBusyHelper);c.oCommonEventHandlers=new p(g,c.oComponentUtils,c.oServices,c.oCommonUtils);c.oServices.oPageLeaveHandler=i.oTemplateContract.oPageLeaveHandler;c.oServices.oPresentationControlHandlerFactory=new d(e.oController,c.oCommonUtils,c.oComponentUtils);var r=new n(t);e.oComponent.setModel(r,"_templPrivView");(h.onInit||Function.prototype)()};g.onExit=function(){i.oTemplateContract.oApplicationProxy.destroyView(y);(h.onExit||Function.prototype)();C.info("View "+y+" of template "+m+" exited")};return g}:Function.prototype}R=c.testableStatic(R,"TemplateComponent_RegisterAppComponent");return{getTemplateComponent:function(e,t,o){var n=t+".Component";o=o||{};o.init=function(){var t=this.getId();C.info("Init called for TemplateComponent "+t);var o=this.getComponentData();var i=o.registryEntry;var a=T(i.oAppComponent);var l=a.oTemplateContract;var p=a.oTemplateContract.mRoutingTree[i.route];g.initializeViewCreation(i);i.componentName=n;i.oComponent=this;i.aKeys=[];i.oTemplateContract=a.oTemplateContract;(r.prototype.init||Function.prototype).apply(this,arguments);i.utils=new s(this,i);i.methods=e(this,i.utils)||{};i.oGenericData={};i.mRefreshInfos=Object.create(null);i.bWithoutAssociationsRefresh=false;p.componentId=t;l.componentRegistry[t]=i;p.willBeDisplayed.then(l.oBusyHelper.setBusy.bind(null,i.viewRegistered,true,undefined,true));i.oApplication=a.application;i.createViewController=x(i);p.componentCreatedResolve(this);delete p.componentCreatedResolve;delete o.registryEntry;(i.methods.init||Function.prototype)();C.info("Init done for TemplateComponent "+t)};o.exit=function(){var e=this.getId();C.info("Exit called for TemplateComponent "+e);var t=w(this);var o=T(this.getAppComponent());var n=t.methods;(n.exit||Function.prototype)();t.utils.leaveApp(true);delete o.oTemplateContract.componentRegistry[e];(r.prototype.exit||Function.prototype).apply(this,arguments);C.info("Exit done for TemplateComponent "+e)};o.onBeforeRendering=function(){var e=this.getId();C.info("BeforeRendering called for TemplateComponent "+e);var t=w(this);(r.prototype.onBeforeRendering||Function.prototype).bind(this,t).apply(this,arguments);var o=t.methods;(o.onBeforeRendering||Function.prototype)();C.info("BeforeRendering done for TemplateComponent "+e)};o.onAfterRendering=function(){var e=this.getId();C.info("AfterRendering called for TemplateComponent "+e);var t=w(this);if(t.fnViewRenderdResolve&&!t.fnViewRegisteredResolve){t.fnViewRenderdResolve();delete t.fnViewRenderdResolve}(r.prototype.onAfterRendering||Function.prototype).bind(this,t).apply(this,arguments);var o=t.methods;(o.onAftereRendering||Function.prototype)();C.info("AfterRendering done for TemplateComponent "+e)};o.setIsRefreshRequired=function(e){if(e===this.getProperty("isRefreshRequired")){return}this.setProperty("isRefreshRequired",e);var t=w(this);if(e&&!t.oTemplateContract.oNavigationControllerProxy.isNavigating()){t.oTemplateContract.oNavigationObserver.getProcessFinished(true).then(function(){if(this.getProperty("isRefreshRequired")&&t.utils.isComponentActive()){t.utils.refreshBinding(true,{})}}.bind(this))}};o.onDeactivate=Function.prototype;return r.extend(n,o)},getRegisterAppComponent:function(){var e=R;R=null;return e},getExtensionAPIPromise:function(e){var t=b(e);if(!t){return Promise.reject()}return t.viewRegistered.then(function(){return t.oController.extensionAPI})},getExtensionAPI:function(e){var t=b(e);return t&&t.oController&&t.oController.extensionAPI}}});
//# sourceMappingURL=TemplateAssembler.js.map