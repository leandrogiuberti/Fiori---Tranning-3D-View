sap.ui.define(["sap/base/util/extend","sap/ui/core/routing/History"],function(e,t){"use strict";function n(e){var t=e.oNavigationControllerProxy.getActiveComponents();var n=[];for(var r=0;r<t.length;r++){var i=t[r];var o=e.componentRegistry[i];var a=o.viewLevel;if(a>0){var l=o.oComponent.getBindingContext();if(l){n[a]=l.getPath()}}}return n}function r(e,t){var n=e.oNavigationControllerProxy.getActiveComponents();for(var r=0;r<n.length;r++){var i=n[r];var o=e.componentRegistry[i];var a=o.viewLevel;if(a===t){return o}}}function i(e,t){var n=r(e,0);if(n&&n.methods.displayNextObject){return n.methods.displayNextObject(t)}return Promise.reject()}function o(e,t){var n=e.oFlexibleColumnLayoutHandler&&e.oFlexibleColumnLayoutHandler.isNextObjectLoadedAfterDelete();if(n){var i=r(e,0);if(i){if(t){return[e.oApplicationProxy.getPathOfLastShownDraftRoot()]}return i.methods.getItems&&i.methods.getItems()}}return null}function a(e,t){e.oNavigationControllerProxy.navigateUpAfterDeletion(t)}function l(e,t,n,r){var o=[];var l;var v=[];var f;for(var s=0;s<n.length;s++){f=n[s].getBindingContextPath();v.push(f)}for(var u=0;u<v.length;u++){if(v[u]===t){o.push(v[u]);l=u;break}}if(l>=0){var c=v.slice(l+1,v.length);var g;if(l>0){g=v.slice(0,l);g.reverse()}o=o.concat(c,g)}else{o=v}r.then(function(){var t=i(e,o);t.catch(function(){a(e,0)})})}function v(e){return function(){var n=e.oTemplatePrivateGlobalModel.getProperty("/generic/forceFullscreenCreate");if(n){var r=!!t.getInstance().getPreviousHash();if(r){e.oNavigationControllerProxy.navigateBack()}else{a(e,0)}}else{var l=o(e,true);if(l){i(e,l)}else{a(e,0)}}}}function f(t,r,i){var v=n(t);var f=[];var s=null;var u;var c;var g;var p;var d;for(p in t.componentRegistry){d=t.componentRegistry[p];var h=d.viewLevel&&d.oComponent.getBindingContext();c=h&&h.getPath();g=c&&r[c];if(g){var m=t.oViewDependencyHelper.unbindChildren.bind(null,d.oComponent,true);g.then(m)}}var y=Object.create(null);var C=function(e,t){if(t){y[t]=true}return{deleted:!!t,position:e}};for(c in r){var x=c.substring(1,c.indexOf("("));g=r[c];t.oApplicationProxy.prepareDeletion(c,g);var P=v.indexOf(c);if(P===1){u=o(t);if(u){s=c}}var b=g.then(C.bind(null,P,x),C.bind(null,P,null));f.push(b)}if(s){l(t,s,u,r[s])}else{Promise.all(f).then(function(e){var n=-1;for(var r=0;r<e.length;r++){var i=e[r];if(i.deleted&&i.position>0){if(n<0||n>=i.position){n=i.position-1}}}if(n>=0){a(t,n)}})}if(!i){Promise.all(f).then(function(n){for(p in t.componentRegistry){d=t.componentRegistry[p];var r=d.mRefreshInfos;e(r,y);if(d.utils.isComponentActive()){d.utils.refreshBinding()}}})}}return{prepareDeletion:f,getNavigateAfterDeletionOfCreateDraft:v}});
//# sourceMappingURL=deletionHelper.js.map