sap.ui.define(["sap/ui/base/Object","sap/base/util/extend","sap/m/MessageBox"],function(e,t,r){"use strict";function n(e,t){var n={SINGLE_CELL:"singleCell",MULTI_CELL:"multiCell",NO_CELL:"noCell"};var a,o,i,l;function s(t){var r=t.getId();var n=r.split("::Table")[0]+"::addEntry";var a=e.byId(n);return a}function u(e){if(!e||e.rows.length===0){a=n.NO_CELL}else if(e.columns.length===1&&e.rows.length===1){a=n.SINGLE_CELL}else{a=n.MULTI_CELL}}function c(r){var n=e.byId(r);var a=t.oServices.oPresentationControlHandlerFactory.getPresentationControlHandler(n);var o=a.getSelection();return o}function f(r){var n=e.byId(r);var a=t.oServices.oPresentationControlHandlerFactory.getPresentationControlHandler(n);var o=a.getBinding().getContexts();return o}function d(){return e.getView().getModel("ui").getProperty("/editable")}function v(e){var t=e.length-1;while(t>=0){if(e[t].ignore){e.splice(t,1)}t-=1}}function g(e,t,r){if(r){var n=e.findLastIndex(function(e){return e.columnId===t.columns[t.columns.length-1].getId()});e.splice(n+1)}var a=e.findIndex(function(e){return e.columnId===t.columns[0].getId()});e.splice(0,a)}function E(e,t){switch(a){case n.SINGLE_CELL:g(t,e,false);break;case n.MULTI_CELL:g(t,e,true);break;default:break}}function h(e,t){if(!d()){t.preventDefault();return}o=t.getParameter("columnInfos");var r=c(e);u(r);v(o);E(r,o)}function C(e){var n=e.map(function(e){return e.message});var a=t.oCommonUtils.getText("DATA_PASTE_ERROR_MESSAGE",[n.length]);var o=t.oCommonUtils.getText("DATA_PASTE_ERROR_CORRECTION_MESSAGE");var i=t.oCommonUtils.getText("DATA_PASTE_ERROR_CORRECTION_NOTE");n.unshift("");n.unshift(i);n.unshift(o);r.show(a,{icon:r.Icon.ERROR,title:t.oCommonUtils.getText("ST_ERROR"),actions:[sap.m.MessageBox.Action.CLOSE],details:n.join("<br>")})}function p(e,t){var r=new Set;var n=e.getEntitySet();var a=e.getModel();var o=a.getMetaModel();var i=o.getODataEntitySet(n);var l=i["Org.OData.Capabilities.V1.InsertRestrictions"]&&i["Org.OData.Capabilities.V1.InsertRestrictions"].NonInsertableProperties;if(!l||!l.length){return}for(var s=0;s<l.length;s++){r.add(l[s].PropertyPath)}for(var s=0;s<t.length;s++){for(var u in t[s].value){if(r.has(u)){delete t[s].value[u]}}}}function L(e,r,n){if(!R(n)){return}var a=e.getSource();var o=s(a);var i=o||a;p(a,r);if(r.length){var l=sap.m.DraftIndicatorState.Saved,u=r.length;var c=r.map(function(e,r){var n=r<u-1;return t.oCommonEventHandlers.addEntry(i,true,undefined,e.value,n)});Promise.all(c).then(function(){var e=t.oComponentUtils.getTemplatePrivateGlobalModel();e.setProperty("/generic/draftIndicatorState",l)})}}function m(e,t){var r=e.context.getObject();var n=l.find(function(e){return e.name===t});if(!n||r[n.fieldControl]===undefined){return true}if(r[n.fieldControl]>1){return true}return false}function P(e){e.forEach(function(e){var t=e.context.getModel();Object.entries(e.value).forEach(function(r){var n=r[0];var a=r[1];if(m(e,n)){t.setProperty(n,a,e.context)}})})}function I(e,t,r){var o=[],i=[],l=t.parsedData,s=t.errors!=null&&t.errors.length!=0;if(s){C(t.errors)}else{switch(a){case n.NO_CELL:l.forEach(function(e){o.push({value:e})});break;case n.SINGLE_CELL:var u=f(r);var c=u.findIndex(function(t){return t.getPath()===e.rows[0].getPath()});for(var d=0;d<l.length;d++){if(c<u.length){i.push({context:u[c],value:l[d]})}else{o.push({value:l[d]})}c++}break;case n.MULTI_CELL:var v=false;for(var d=0;d<l.length;d++){if(d<e.rows.length&&e.rows[d]){i.push({context:e.rows[d],value:l[d]});if(e.rows[d].isInactive()){v=true}continue}if(v){o.push({value:l[d]})}}break;default:break}}return{additionalRows:o,rowsToBeUpdated:i,hasError:s}}function T(e,t,r){if(a===n.NO_CELL){L(e,t.additionalRows,r)}else{P(t.rowsToBeUpdated);L(e,t.additionalRows,r)}}function R(t){var r=e.byId(t).data("creationMode");var n=["inline","creationRows","creationRowsHiddenInEditMode"].includes(r);return n}function _(r,n){var a=e.byId(r);var o=t.oServices.oPresentationControlHandlerFactory.getPresentationControlHandler(a);var s=o.getPotentiallyReadOnlyField(r);i=s.readOnlyFields;l=s.fieldControls;for(var u=0;u<i.length;u++){var c=i[u].name;for(var f=0;f<n.parsedData.length;f++){if(n.parsedData[f][c]!==undefined){i[u].ignoredFromPaste=true;delete n.parsedData[f][c]}}}return n}function O(){var e=[];o.forEach(function(t){if(t.additionalProperty){e.push(t.property)}});return e}function S(){var e="",r=false;var n=O();i.forEach(function(t){if(t.ignoredFromPaste&&!n.includes(t.name)){if(e){e+=", ";r=true}e+='"'+t.label+'"'}});var a=e?t.oCommonUtils.getText(r?"PARTIAL_PASTE_PLURAL":"PARTIAL_PASTE",[e]):t.oCommonUtils.getText("PASTE_COMPLETE");t.oServices.oApplication.showMessageToast(a,{duration:5e3})}function b(e,t){var r=t.getParameter("result");var o=c(e);if(a!==n.NO_CELL&&(r.errors===null||!r.errors.length)){r=_(e,r)}var i=I(o,r,e);if(!i.hasError){T(t,i,e);S()}}return{handlePaste:b,handleBeforePaste:h}}return e.extend("sap.suite.ui.generic.template.ObjectPage.controller.PasteHandler",{constructor:function(e,r){t(this,n(e,r))}})});
//# sourceMappingURL=PasteHandler.js.map