sap.ui.define(["sap/ui/base/Object","sap/base/util/extend","sap/ui/core/message/MessageType","sap/ui/model/Filter","sap/suite/ui/generic/template/lib/MessageStripHelper","sap/suite/ui/generic/template/lib/MessageUtils"],function(e,t,r,i,n,a){"use strict";function s(e,t,i,s){var g=Object.create(null);var l=t.getOwnerComponent().getModel("ui");l.bindProperty("/editable").attachChange(y);s.registerExternalListener(y);function m(e){var t=g[e];if(!t){t={maxBackendSeverity:-1,customSeverity:-2,waiting:[]};g[e]=t}return t}function o(e,t){var r=m(t);var i=r.implementingHelper.getCurrentCustomMessage();var n=r.technicalMessage;r.technicalMessage=e;if(i&&e){var s=n&&n.message===i.message;var g=a.getSeverityAsNumber(e);var l=a.getSeverityAsNumber(i);var o=s?g<l:g<=l;if(o){return}}var u="";r.implementingHelper.setCustomMessage(e,u)}function u(e,i,n,a){if(!i){var s=t.getOwnerComponent().getModel("_templPriv");s.setProperty("/objectPage/messageStripInfo/messageText",e?e.message:"");s.setProperty("/objectPage/messageStripInfo/messageType",e?e.type:r.None);return}var g=m(i);if(g.implementingHelper){g.customSeverity=-2;if(!e&&g.technicalMessage){e=g.technicalMessage}g.implementingHelper.setCustomMessage(e,n,a)}else{g.waiting.push({message:e,tabKey:n,onClose:a})}}function p(r,a){var s=r.getId();var g=m(s);var l=e.getKeyToPresentationControlHandler(r);var o=!!l;if(!o){l={"":function(){return i.oServices.oPresentationControlHandlerFactory.getPresentationControlHandler(r)}}}g.implementingHelper=new n(l,t,i);if(o){var u=a;e.getInitializationPromise(u).then(function(){g.implementingHelper.setCurrentTab(e.getSelectedKey(u));e.registerKeyChange(r,g.implementingHelper.setCurrentTab)})}else{g.implementingHelper.setCurrentTab("")}g.waiting.forEach(function(e){g.implementingHelper.setCustomMessage(e.message,e.tabKey,e.onClose)});delete g.waiting}function c(e){var t=e.getSource();var r=t.getId();var i=g[r];if(i){i.implementingHelper.onBeforeRebindControl(e)}}function v(e){if(e.maxBackendSeverity!==-1){e.refreshTriggered=true;setTimeout(function(){if(e.refreshTriggered){e.refreshTriggered=false;var t=e.implementingHelper.getCurrentCustomMessage();e.customSeverity=t?a.getSeverityAsNumber(t):-2;e.implementingHelper.refresh()}},0)}}function f(e,t){var r=t.getId();var i=g[r];if(i.refreshTriggered){return false}if(l.getProperty("/editable")){var n=i.implementingHelper.getCurrentCustomMessage();var s=e===n;var m=!s&&e.persistent;if(m){return false}if(!n){return true}var o=a.getSeverityAsNumber(e);if(s){var u=o!==i.customSeverity;if(u){v(i)}return o>=i.maxBackendSeverity}else{if(i.maxBackendSeverity>i.customSeverity){i.maxBackendSeverity=Math.max(i.maxBackendSeverity,o);return true}if(o<=i.customSeverity){i.maxBackendSeverity=Math.max(i.maxBackendSeverity,o);return false}v(i);i.maxBackendSeverity=o;return true}}else{return i.implementingHelper.dataStateFilter(e,t)}}function d(e){if(e.implementingHelper){e.maxBackendSeverity=-1;var t=e.implementingHelper.getCurrentCustomMessage();e.customSeverity=t?a.getSeverityAsNumber(t):-2;e.refreshTriggered=false;e.implementingHelper.refresh()}}function y(){for(var e in g){var t=g[e];d(t)}}function S(e){for(var t in g){var r=g[t];if(r.implementingHelper&&r.implementingHelper.isCustomMessage(e)){return true}}return false}function C(e){var t=e.getSource();var r=t.getParent();var i=r.getId();var n=g[i];n.implementingHelper.onClose()}return{setCustomMessage:u,initSmartTable:p,onBeforeRebindControl:c,dataStateFilter:f,isCustomMessage:S,onClose:C,setTechnicalMessage:o}}return e.extend("sap.suite.ui.generic.template.listTemplates.controller.MessageStripHelper",{constructor:function(e,r,i,n){t(this,s(e,r,i,n))}})});
//# sourceMappingURL=MessageStripHelper.js.map