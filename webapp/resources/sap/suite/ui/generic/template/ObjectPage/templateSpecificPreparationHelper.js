sap.ui.define(["sap/base/util/extend","sap/base/util/deepExtend","sap/ui/model/odata/AnnotationHelper","sap/suite/ui/generic/template/js/StableIdHelper","sap/suite/ui/generic/template/js/staticChecksHelper","sap/suite/ui/generic/template/js/preparationHelper","sap/suite/ui/generic/template/genericUtilities/FeLogger","sap/suite/ui/generic/template/js/AnnotationHelper","sap/suite/ui/generic/template/ObjectPage/annotationHelpers/AnnotationHelperActionButtons","sap/suite/ui/generic/template/genericUtilities/FeError","sap/base/util/isEmptyObject","sap/suite/ui/generic/template/ObjectPage/annotationHelpers/AnnotationHelperSideContent"],function(t,e,a,n,i,o,r,c,s,l,d,u){"use strict";var f=new r("ObjectPage.templateSpecificPreparationHelper").getLogger();var p="ObjectPage.templateSpecificPreparationHelper";function b(r,b,g,m,v,y){function S(e,a){var n=t({},a);switch(e){case"com.sap.vocabularies.UI.v1.ReferenceFacet":if(!n["com.sap.vocabularies.UI.v1.PartOfPreview"]||n["com.sap.vocabularies.UI.v1.PartOfPreview"].Bool!=="false"){n["com.sap.vocabularies.UI.v1.PartOfPreview"]={Bool:"true"}}break;default:break}return n}function P(t){if(!t.getObject().Target){return undefined}var e=a.resolvePath(b.getContext(t.sPath+"/Target"));return e&&b.getContext(e).getObject()}function I(e){e.subSections=e.subSections||[];if(e.subSections.find(function(t){return e.additionalData.facetId===t.additionalData.facetId})){return}var a=t({},e);delete a.subSections;a.blocks=[];e.subSections.push(a)}var A=0;function D(a,i,o,r){var c=[];var s=["sections","subSections","blocks"];o=o||0;var l=b.getObject(a);if(!Array.isArray(l)){return[]}l.forEach(function(l,d){var u={additionalData:{facetId:n.getStableId({type:"ObjectPage",subType:"Facet",sRecordType:l.RecordType,bIsHeaderFacet:i,sAnnotationPath:l.Target&&l.Target.AnnotationPath,sAnnotationId:l.ID&&l.ID.String})},temporaryData:{},annotations:{Facet:{annotation:e({},l)}},metaModelPath:a+"/"+d};u.facetIdAsObject={id:u.additionalData.facetId};u.fallbackIdByEnumerationForRuntime=u.additionalData.facetId||"missingStableId#"+A++;if(l.RecordType==="com.sap.vocabularies.UI.v1.CollectionFacet"){var p=D(a+"/"+d+"/Facets",i,o+1,u);if(o===0&&!u.subSections&&p.length===0){I(u)}else{var g=s[o+1]||"unsupportedNestingLevel";u[g]=u[g]||[];u[g]=u[g].concat(p)}}else if(l.RecordType==="com.sap.vocabularies.UI.v1.ReferenceFacet"){u.fallbackIdByAnnotationPathForManifest=n.getStableId({type:"ObjectPage",subType:"Facet",sRecordType:l.RecordType,bIsHeaderFacet:i,sAnnotationPath:l.Target&&l.Target.AnnotationPath});u.annotations.Facet.annotation=S("com.sap.vocabularies.UI.v1.ReferenceFacet",l);var m=t({},u);m.targetAnnotation=P(b.getContext(a+"/"+d));F(m);var v;switch(o){case 0:if(l.Target&&!l.Target.AnnotationPath){return}v=t({},u);v.blocks=[m];u.subSections=[v];break;case 1:I(r);v=r.subSections.find(function(t){return t.additionalData.facetId===r.additionalData.facetId});v.blocks.push(m);return;case 2:u.targetAnnotation=m.targetAnnotation;r.temporaryData.potentiallySeparateForms=true;break;default:f.warning("UnSupported Nesting of CollectionFacets");break}}else{f.warning("UnSupported Facet annotation record type: "+l.RecordType);return}c.push(u)});return c}function F(t){if(!t.annotations.Facet.annotation.Target||!t.annotations.Facet.annotation.Target.AnnotationPath||t.annotations.Facet.annotation.Target.AnnotationPath.indexOf("com.sap.vocabularies.UI.v1.PresentationVariant")<0){return}var e=t.annotations.Facet.annotation.Target&&t.annotations.Facet.annotation.Target.AnnotationPath&&t.annotations.Facet.annotation.Target.AnnotationPath.split("@")[1],n=b.getObject(a.gotoEntitySet(b.getContext(t.metaModelPath+"/Target"))).name,i=b.getODataEntitySet(n),o=b.getODataEntityType(i.entityType);if(!o[e]||!o[e].Visualizations||!o[e].Visualizations.length||!o[e].Visualizations[0]||!o[e].Visualizations[0].AnnotationPath||o[e].Visualizations[0].AnnotationPath.indexOf("com.sap.vocabularies.UI.v1.LineItem")<0){return}var r=o[e].Visualizations[0].AnnotationPath.split("@")[1];if(!o[r]){return}t.temporaryData.presentationVariantHasLineItem=true;t.targetAnnotation=o[r]}var h={};function E(t,e){if(!h[t.entityType]){h[t.entityType]=o.getTargetEntityForQuickView(b,t)}}E(b.getODataEntitySet(v));function T(t){switch(t&&t.variantManagement){case undefined:return"New";case true:return"Retain";case false:return"Remove";default:break}}function O(t,e){if(!t.annotations.Facet.annotation.Target||!t.annotations.Facet.annotation.Target.AnnotationPath){return""}var a="";if(t.annotations.Facet.annotation.Target.AnnotationPath.indexOf("com.sap.vocabularies.UI.v1.LineItem")>=0){a=t.annotations.Facet.annotation.Target.AnnotationPath}else if(t.annotations.Facet.annotation.Target.AnnotationPath.indexOf("com.sap.vocabularies.UI.v1.PresentationVariant")>=0){var n=t.annotations.Facet.annotation.Target.AnnotationPath.split("@")[1],i=b.getODataEntitySet(e),o=b.getODataEntityType(i.entityType);if(!o[n]||!o[n].Visualizations||!o[n].Visualizations.length||!o[n].Visualizations[0]||!o[n].Visualizations[0].AnnotationPath||o[n].Visualizations[0].AnnotationPath.indexOf("com.sap.vocabularies.UI.v1.LineItem")<0){return""}a=o[n].Visualizations[0].AnnotationPath}if(!a){return""}var r=a.split("#");if(r.length!==2){return""}return r[1]}function x(t,e){if(!t.annotations.Facet.annotation.Target||!t.annotations.Facet.annotation.Target.AnnotationPath){return""}var a="com.sap.vocabularies.UI.v1.PresentationVariant";if(t.annotations.Facet.annotation.Target.AnnotationPath.indexOf("com.sap.vocabularies.UI.v1.PresentationVariant")>=0){a=t.annotations.Facet.annotation.Target.AnnotationPath.split("@")[1]}var n=b.getODataEntitySet(e),i=b.getODataEntityType(n.entityType);if(!i[a]||!i[a].SortOrder||!i[a].SortOrder.length){return""}return c.getSortOrder(i[a].SortOrder)}function k(t){function e(){var e=n.getStableId({type:"ObjectPageAction",subType:"Delete",sFacet:t.additionalData.facetId});return{Create:{id:n.getStableId({type:"ObjectPageAction",subType:"Create",sFacet:t.additionalData.facetId}),text:"{i18n>CREATE_OBJECT}",press:"cmd:TableEntryAdd",action:"TableEntryAdd",callbackName:"._templateEventHandlers.addEntry('"+t.additionalData.facetId+"')",isStandardAction:true,enabled:true},Delete:{id:e,text:"{i18n>DELETE}",press:"cmd:TableEntryDelete",ariaHasPopup:sap.ui.core.aria.HasPopup.Dialog,action:"TableEntryDelete",callbackName:"._templateEventHandlers.deleteEntries('"+t.additionalData.facetId+"')",isStandardAction:true,enabled:"{_templPriv>/generic/controlProperties/"+e+"/enabled"+"}"}}}t.multiSelect=t.multiSelect||t.allTableMultiSelect;var c=a.gotoEntitySet(b.getContext(t.metaModelPath+"/Target"));var s=c&&b.getObject(c).name||v;var l=r.getControllerExtensions();var d=l&&l.Sections&&l.Sections[t.additionalData.facetId]&&l.Sections[t.additionalData.facetId].Actions;var u=function(){return t.additionalData.facetId+"::Table::Toolbar::SearchField"};var f=o.getNormalizedTableSettings(b,t,m,s,d,t.targetAnnotation,u);f.variantManagement=!(t.tableSettings&&t.tableSettings.variantManagement)||t.tableSettings.variantManagement;f.selectAll=!t.tableSettings||t.tableSettings.selectAll!==false;if(f.onlyForDelete){if(r.isDraftEnabled()){f.mode="{= ${ui>/editable} ? '"+f.mode+"' : 'None'}"}else{f.mode="{= ${ui>/editable} ? 'None' : '"+f.mode+"'}"}}var p=b.getODataEntitySet(s);if(f&&f.createWithParameterDialog&&f.createWithParameterDialog.fields){i.checkErrorforCreateWithDialog(b.getODataEntityType(p.entityType),f);f.createWithParameterDialog.id=n.getStableId({type:"ObjectPageAction",subType:"CreateWithDialog",sFacet:t.additionalData.facetId})}E(p);var g=N(t,p,f.type);f.bExportToExcel=!r.isDraftEnabled()&&!t.sections||g;f.vShowPasteButton=j(p);f.commandExecution=e();f.persistencyKeyState=T(t.tableSettings);f.lineItemQualifier=O(t,s);f.lineItemSortOrder=x(t,s);return f}function j(t){var e=B(t,"Insertable");var a=B(t,"Updatable");if(!(e||a)){return false}var n=[e,a].some(function(t){return t===true});if(n){return"{ui>/editable}"}var i=[e,a].filter(function(t){return typeof t==="string"}).map(function(t){return"${"+t+"}"}).join(" || ");return"{= ${ui>/editable} && ( "+i+" )}"}function B(t,e){var a={Insertable:"Org.OData.Capabilities.V1.InsertRestrictions",Updatable:"Org.OData.Capabilities.V1.UpdateRestrictions"};var n=b.getODataEntitySet(v);var i=c.handleNavigationRestrictions(b,n,t,e);var o=i&&i[e];var r=t[a[e]];var s=r&&r[e];if(o){if(o.Bool){return o.Bool!=="false"}else if(o.Path){var l=c._isPropertyPathBoolean(b,n.entityType,o.Path);if(!l){f.error("Service Broken: Restrictions annotations for entity type "+v+" for section '"+e+"' are invalid.");return false}return o.Path}}else if(s&&s.Bool){return s.Bool!=="false"}return true}function N(t,e,a){var n,i,o;var r=b.getODataEntityType(e.entityType)&&b.getODataEntityType(e.entityType)["sap:semantics"];if(a==="TreeTable"||a==="AnalyticalTable"&&r==="aggregate"){return false}var s=b.getODataEntitySet(v);var l=c.handleNavigationRestrictions(b,s,e,"Insertable");if(l){n=l["Insertable"];i=s.entityType}else{o=e["Org.OData.Capabilities.V1.InsertRestrictions"];n=o&&o["Insertable"];i=e.entityType}if(!n){return true}var d=n.Bool?!n.Path:!!(n.Path&&c._isPropertyPathBoolean(b,i,n.Path));if(!d){f.error("Service Broken: Restrictions annotations for entity type "+e.entityType+" for section Insertable are invalid.")}if(n.Bool==="false"){return false}return d}function C(t){return{variantManagement:!(t.chartSettings&&t.chartSettings.variantManagement)||t.chartSettings.variantManagement,chartTitle:t.targetAnnotation&&t.targetAnnotation.Title,persistencyKeyState:T(t.chartSettings)}}function w(t){return t.RecordType==="com.sap.vocabularies.UI.v1.DataFieldForAction"||t.RecordType==="com.sap.vocabularies.UI.v1.DataFieldForIntentBasedNavigation"}function U(t){return!t.apply(this,Array.prototype.slice.apply(arguments,[1]))}function H(n){var i=g.sections&&t({},g.sections[n.additionalData.facetId],g.sections[n.fallbackIdByAnnotationPathForManifest]);t(n,i,n);if(n.targetAnnotation||(n.additionalData.type==="SmartTable"||n.additionalData.type==="SmartChart")&&a.isMultiple(b.getContext(n.metaModelPath+"/Target"))){var o=e({},g,n);switch(n.additionalData.type){case"SmartTable":n.tableSettings=k(o);break;case"SmartChart":n.chartSettings=C(o);break;case"SmartForm":n.temporaryData.content=Array.isArray(n.targetAnnotation)?n.targetAnnotation.filter(U.bind(null,w)):n.targetAnnotation.Data;break;default:break}}}function R(e,a){var i={BeforeFacet:{withKey:{section:{type:"ObjectPageSection",subType:"BeforeFacetExtensionSectionWithKey"},subSection:{type:"ObjectPageSection",subType:"BeforeFacetExtensionSubSectionWithKey"}},withoutKey:{section:{type:"ObjectPageSection",subType:"BeforeFacetExtensionSection"},subSection:{type:"ObjectPageSection",subType:"BeforeFacetExtensionSubSection"}}},AfterFacet:{withKey:{section:{type:"ObjectPageSection",subType:"AfterFacetExtensionSectionWithKey"},subSection:{type:"ObjectPageSection",subType:"AfterFacetExtensionSubSectionWithKey"}},withoutKey:{section:{type:"ObjectPageSection",subType:"AfterFacetExtensionSection"},subSection:{type:"ObjectPageSection",subType:"AfterFacetExtensionSubSection"}}}};var o=i[e][a.sKey?"withKey":"withoutKey"];var r=t({},o.section);r.sEntitySet=a.sEntitySet;r.sFacet=a.sFacetId;r.sFacetExtensionKey=a.oExtensionDefinition.key||a.sKey;var c=n.getStableId(r);r.type=o.subSection.type;r.subType=o.subSection.subType;return{id:c,additionalData:{facetId:a.sFacetId},extensionPointName:a.sExtensionPointName,extensionPointNamePrefix:a.sExtensionPointNamePrefix,subSections:[V(a,r)]}}function V(t,e){var a={ReplaceSubSection:"ReplaceSubSectionExtensionSubSection"};e=e||{type:"ObjectPageSection",subType:a[t.sExtensionPointNamePrefix],sEntitySet:t.sEntitySet,sFacet:t.sFacetId};return{id:n.getStableId(e),additionalData:{facetId:t.sFacetId},temporaryData:{},extensionPointName:t.sExtensionPointName,extensionPointNamePrefix:t.sExtensionPointNamePrefix,blocks:[]}}var M;function z(){if(!M){var t=r.getViewExtensions()||{};M=Object.keys(t).map(function(e){var a=e.split("|");return{sExtensionPointNamePrefix:a[0],sEntitySet:a[1],sFacetId:a[2],sKey:a[3],oExtensionDefinition:t[e],sExtensionPointName:e}}).filter(function(t){return t.sEntitySet===v})}return M}function L(t,e){var a=r.getControllerExtensions();if(e==="Section"){return a&&a.Sections&&a.Sections[t]&&a.Sections[t].Actions}if(e==="Header"){return a&&a.Header&&a.Header.Actions||[]}}function K(t){var a=z();var n=[];t.forEach(function(t){var i=a.filter(function(e){return e.sFacetId===t.additionalData.facetId&&e.sExtensionPointNamePrefix==="BeforeFacet"});var o=a.filter(function(e){return e.sFacetId===t.additionalData.facetId&&e.sExtensionPointNamePrefix==="AfterFacet"});var r=a.find(function(e){return e.sFacetId===t.additionalData.facetId&&e.sExtensionPointNamePrefix==="ReplaceFacet"});n=n.concat(i.map(R.bind(null,"BeforeFacet")));n.push(r?e(r,t):t);n=n.concat(o.map(R.bind(null,"AfterFacet")));if(!r){t.subSections.forEach(function(e,n){var i=a.find(function(t){return t.sFacetId===e.additionalData.facetId&&t.sExtensionPointNamePrefix==="ReplaceSubSection"});if(i){t.subSections[n]=V(i)}})}});return n}function _(t){var e=z();var a=e.find(function(e){return e.sFacetId===t.additionalData.facetId&&e.sExtensionPointNamePrefix==="SmartFormExtension"});if(a){t.extensionPointName=a.sExtensionPointName;t.extensionPointNamePrefix="SmartFormExtension";t.additionalData.type=t.additionalData.type||"SmartForm"}}function W(t){var e=t.annotations.Facet.annotation.Target&&t.annotations.Facet.annotation.Target.AnnotationPath&&t.annotations.Facet.annotation.Target.AnnotationPath.split("@")[1];e=e&&e.split("#")[0];switch(e){case"com.sap.vocabularies.UI.v1.FieldGroup":case"com.sap.vocabularies.UI.v1.Identification":t.additionalData.type="SmartForm";break;case"com.sap.vocabularies.UI.v1.LineItem":t.additionalData.type="SmartTable";break;case"com.sap.vocabularies.UI.v1.PresentationVariant":if(t.temporaryData.presentationVariantHasLineItem){t.additionalData.type="SmartTable"}break;case"com.sap.vocabularies.UI.v1.Chart":t.additionalData.type="SmartChart";break;case"com.sap.vocabularies.Communication.v1.Address":t.additionalData.type="Address";break;case"com.sap.vocabularies.Communication.v1.Contact":t.additionalData.type="Contact";break;default:}H(t);_(t)}function $(t){if(t.annotations.Facet.annotation.RecordType!=="com.sap.vocabularies.UI.v1.ReferenceFacet"){return false}switch(t.additionalData.type){case"SmartForm":if(t.extensionPointName){return true}if(!t.targetAnnotation||!t.temporaryData.content){return false}return t.temporaryData.content.find(function(t){return t.RecordType!=="com.sap.vocabularies.UI.v1.DataFieldForAction"&&t.RecordType!=="com.sap.vocabularies.UI.v1.DataFieldForIntentBasedNavigation"});case"SmartTable":return t.tableSettings;case"SmartChart":return t.chartSettings;default:return t.targetAnnotation}}function G(t){return t.additionalData.type==="SmartForm"}function q(t,a){if(!t){throw new l(p,"Identified an invalid value of 'logicalAction' i.e., '"+a.logicalAction+"' for a custom action in the manifest.")}return e({},t,{id:a.id&&n.getStableId({type:"ObjectPageAction",subType:"CommonAction",sAction:a.id}),text:a.text,enabled:a.applicablePath&&c.getBreakoutActionEnabledKey(a),importance:a.importance,callbackName:a.press,isStandardAction:false,ariaHasPopup:sap.ui.core.aria.HasPopup.None})}function Q(t,e,n,i,o){var c={};var s="._templateEventHandlers.";var l=a.format(b.getContext(e+n+"/Action"));switch(t.RecordType){case"com.sap.vocabularies.UI.v1.DataFieldForAction":var d=[];d.push("'"+l+"'");d.push("'"+o+"'");var u=t.InvocationGrouping&&t.InvocationGrouping.EnumMember||"";d.push("'"+u+"'");s+="onCallAction("+d.join(", ")+")";c.sPressHandler=s;var f=i.annotatedActions&&i.annotatedActions[l.split("/")[1]];if(f){c.sDataFieldCommand=f.command}break;case"com.sap.vocabularies.UI.v1.DataFieldForIntentBasedNavigation":s+="onDataFieldForIntentBasedNavigation";c.sPressHandler=s;c.oIntent={semanticObject:a.format(b.getContext(e+n+"/SemanticObject")),action:l};var p=Object.keys(i.outbounds||{}).find(function(e){var a=r.getOutboundNavigationIntent(y,e);return a.semanticObject===t.SemanticObject.String&&a.action===t.Action.String});if(p){c.sDataFieldCommand=i.outbounds[p].command}break;default:break}return c}function J(t,e){var a=[],n;(t.targetAnnotation||[]).forEach(function(i){switch(i.RecordType){case"com.sap.vocabularies.UI.v1.DataFieldForAction":n=r.getToolbarDataFieldForActionCommandDetails(i,e,undefined,b.getObject(t.metaModelPath));if(!d(n)){a.push(n)}break;case"com.sap.vocabularies.UI.v1.DataFieldForIntentBasedNavigation":n=r.getToolbarDataFieldForIBNCommandDetails(i,e,y,undefined,b.getObject(t.metaModelPath));if(!d(n)){a.push(n)}break;default:break}});return a}function X(t,e){H(e);e.blocks.forEach(W);var i=u.getSideContentExtensionPoint(v,e.additionalData.facetId,r.getViewExtensions());if(i){e.sideContentSettings={id:n.getStableId({type:"ObjectPageSection",subType:"DynamicSideContent",sFacet:e.additionalData.facetId})}}e.actions=[];var o=r.getSettings();e.blocks.forEach(function(t){if(t.additionalData.type==="SmartForm"){var i=L(t.additionalData.facetId,"Section");Object.values(i||{}).forEach(function(t){var a={id:n.getStableId({type:"ObjectPageAction",subType:"CommonAction",sAction:t.id}),text:t.text,press:t.press};if(t.command){a.command=t.command}e.actions.push(a)})}if(t.additionalData.type==="SmartTable"&&t.tableSettings){var r=L(t.additionalData.facetId,"Section");if(r){t.tableSettings.extensionActions=[];Object.values(r).forEach(function(e){if(e.logicalAction){t.tableSettings.commandExecution[e.logicalAction]=q(t.tableSettings.commandExecution[e.logicalAction],e)}else{e.enabled=c.getBreakoutActionEnabledKey(e);t.tableSettings.extensionActions.push(e);if(e.command){t.tableSettings.commandExecution[e.id]={id:e.id,action:e.command,callbackName:e.press};e.press="cmd:"+e.command}}})}var s=J(t,o);s.forEach(function(e){t.tableSettings.commandExecution[e.id]=e})}if(!t.targetAnnotation||!t.temporaryData.content){return}var l=a.resolvePath(b.getContext(t.metaModelPath+"/Target"));var d=l+(t.targetAnnotation.Data?"/Data/":"/");t.temporaryData.content.forEach(function(a,i){if(!a||!a.Action||a.RecordType!=="com.sap.vocabularies.UI.v1.DataFieldForAction"&&a.RecordType!=="com.sap.vocabularies.UI.v1.DataFieldForIntentBasedNavigation"){return}var r=n.getStableId({type:"ObjectPage",subType:"DataField",sRecordType:a.RecordType,sSemanticObject:a.SemanticObject&&(a.SemanticObject.String||a.SemanticObject.Path),sAction:a.Action&&(a.Action.String||a.Action.Path)});var c=n.getStableId({type:"ObjectPageAction",subType:"AnnotatedAction",sFacet:t.additionalData.facetId,sDataField:r});var s=Q(a,d,i,o,c);e.actions.push({id:c,press:s.sPressHandler,semanticObject:s.oIntent&&s.oIntent.semanticObject,action:s.oIntent&&s.oIntent.action,metaModelPath:d+i,command:s.sDataFieldCommand,actionPress:s.sDataFieldCommand?"cmd:"+s.sDataFieldCommand:s.sPressHandler})})});e.blocks=e.blocks.filter($);if(e.temporaryData.potentiallySeparateForms&&!e.blocks.every(G)){e.blocks=e.blocks.map(function(t){if(G(t)){return{additionalData:{type:t.additionalData.type,facetId:t.additionalData.facetId},metaModelPath:t.metaModelPath,controlProperties:{id:n.getStableId({type:"ObjectPageSection",subType:"SmartForm",sFacet:t.additionalData.facetId,sIsPartOfPreview:t.annotations.Facet.annotation["com.sap.vocabularies.UI.v1.PartOfPreview"].Bool})},aggregations:{groups:[t]}}}else{return t}});e.moreBlocks=e.blocks.filter(function(t){if(t.additionalData.type==="SmartForm"){return t.aggregations.groups[0].annotations.Facet.annotation["com.sap.vocabularies.UI.v1.PartOfPreview"].Bool==="false"}else{return t.annotations.Facet.annotation["com.sap.vocabularies.UI.v1.PartOfPreview"].Bool==="false"}});e.blocks=e.blocks.filter(function(t){if(t.additionalData.type==="SmartForm"){return t.aggregations.groups[0].annotations.Facet.annotation["com.sap.vocabularies.UI.v1.PartOfPreview"].Bool==="true"}else{return t.annotations.Facet.annotation["com.sap.vocabularies.UI.v1.PartOfPreview"].Bool==="true"}})}else{var s={additionalData:{type:"SmartForm",facetId:e.additionalData.facetId},controlProperties:{id:n.getStableId({type:"ObjectPageSection",subType:"SmartForm",sFacet:e.additionalData.facetId,sIsPartOfPreview:"true"})},aggregations:{groups:e.blocks.filter(function(t){return G(t)&&t.annotations.Facet.annotation["com.sap.vocabularies.UI.v1.PartOfPreview"].Bool==="true"})}};var l={additionalData:{type:"SmartForm",facetId:e.additionalData.facetId},controlProperties:{id:n.getStableId({type:"ObjectPageSection",subType:"SmartForm",sFacet:e.additionalData.facetId,sIsPartOfPreview:"false"})},aggregations:{groups:e.blocks.filter(function(t){return G(t)&&t.annotations.Facet.annotation["com.sap.vocabularies.UI.v1.PartOfPreview"].Bool==="false"})}};e.moreBlocks=e.blocks.filter(function(t){return!G(t)&&t.annotations.Facet.annotation["com.sap.vocabularies.UI.v1.PartOfPreview"].Bool==="false"});e.blocks=e.blocks.filter(function(t){return!G(t)&&t.annotations.Facet.annotation["com.sap.vocabularies.UI.v1.PartOfPreview"].Bool==="true"});if(s.aggregations.groups.length>0){e.blocks.unshift(s)}if(l.aggregations.groups.length>0){e.moreBlocks.unshift(l)}}e.additionalData.useViewLazyLoading=r.isRenderingWaitingForViewportEntered();Y(t,e)}function Y(t,e){if(!e.isEmbeddedSubSection){if(!e.annotations){var a=z();var n=a.find(function(t){return t.sFacetId===e.additionalData.facetId});if(n){var i=n.oExtensionDefinition&&n.oExtensionDefinition["sap.ui.generic.app"];if(i&&i.enableLazyLoading){e.loadingStrategy="lazyLoadingAfterHeader"}return}}if(t){if(t.loadingBehavior){var o=t.loadingBehavior;if(o.waitForViewportEnter){e.loadingStrategy=o.waitForHeaderData?"lazyLoadingAfterHeader":"lazyLoading";return}e.loadingStrategy=o.waitForHeaderData?"activateAfterHeaderDataReceived":"activateWithBindingChange";return}}e.loadingStrategy="lazyLoading"}}function Z(){return true}function tt(t){H(t);t.subSections.forEach(X.bind(null,t));t.subSections=t.subSections.filter(Z)}function et(){return true}function at(){var t=b.getMetaContext("/"+v).getPath();var e=D(t+"/com.sap.vocabularies.UI.v1.Facets",false);var a=K(e);a.forEach(tt);return a.filter(et)}function nt(){var t=[];var e;var a=b.getODataEntitySet(v);var n=b.getODataEntityType(a.entityType);var i=Object.keys(n);var o=i.filter(function(t){return t.includes("com.sap.vocabularies.UI.v1.FieldGroup")||t.includes("com.sap.vocabularies.UI.v1.Identification")});for(var r=0;r<o.length;r++){var c=n[o[r]].Data||n[o[r]];for(var s=0;s<c.length;s++){e=c[s];if(ot(n,e)){t.push(it(e,n))}}}return t}function it(t,e){if(t.Value&&t.Value.Path){var a=t.Value.Path;var n;if(a.indexOf("/")>-1){var i=a.split("/")[0];n=b.getODataAssociationEnd(e,i);e=b.getODataEntityType(n&&n.type)||e;return i}return}}function ot(t,e){if(e.Value&&e.Value.Path){var a=e.Value.Path;var n;if(a.endsWith("$value")){var i=a.split("/");var o=i.length;if(o>1){for(var r=0;r<o-1;r++){var c=i[r];var n=b.getODataAssociationEnd(t,c);t=b.getODataEntityType(n&&n.type)}return t&&t.hasStream==="true"}}}return false}function rt(){var t=b.getODataEntityType(b.getODataEntitySet(v).entityType),a=c.buildEmphasizedButtonExpression(t["com.sap.vocabularies.UI.v1.Identification"]);function i(){var t={Delete:{action:"Delete",callbackName:"._templateEventHandlers.onDelete",id:n.getStableId({type:"ObjectPageAction",subType:"CommonAction",sAction:"delete"}),text:"{i18n>DELETE}",press:"cmd:Delete",ariaHasPopup:sap.ui.core.aria.HasPopup.Dialog,isStandardAction:true,determining:false},Edit:{action:"Edit",callbackName:"._templateEventHandlers.onEdit",id:n.getStableId({type:"ObjectPageAction",subType:"CommonAction",sAction:"edit"}),text:"{i18n>EDIT}",type:a,press:"cmd:Edit",isStandardAction:true,determining:false},Share:{action:"Share",callbackName:"._templateEventHandlers.onShareObjectPageActionButtonPress",isStandardAction:true,overrideForbidden:true,determining:false},NavigateForward:{id:"NavigateForward",visible:at().length>1,action:"NavigateForward",callbackName:"._templateEventHandlers.onSwitchTabs(true)",isStandardAction:true,overrideForbidden:true,determining:false},NavigateBackward:{id:"NavigateBackward",visible:at().length>1,action:"NavigateBackward",callbackName:"._templateEventHandlers.onSwitchTabs(false)",isStandardAction:true,overrideForbidden:true,determining:false},OpenMessageButtonMenu:{id:"showMessages",action:"OpenMessageButtonMenu",callbackName:"._templateEventHandlers.onShowMessages",isStandardAction:true,determining:true,press:"cmd:OpenMessageButtonMenu"}};if(m.system.desktop||!r.isDraftEnabled()){t.Save={action:"Save",callbackName:"._templateEventHandlers.onSave",id:n.getStableId({type:"ObjectPageAction",subType:"CommonAction",sAction:r.isDraftEnabled()?"activate":"save"}),text:"{= ${ui>/createMode} ? ${i18n>CREATE} : ${i18n>SAVE}}",type:a,press:"cmd:Save",visible:"{ui>/editable}",isStandardAction:true,determining:true}}return t}function o(t,i){if(t.overrideForbidden){throw new l(p,"Identified an invalid value of 'logicalAction' i.e., '"+i.logicalAction+"' for a custom action in the manifest.")}return e({},t,{id:i.id&&n.getStableId({type:"ObjectPageAction",subType:i.logicalAction==="Save"?"CommonAction":"HeaderExtensionAction",sAction:i.id}),text:i.text,visible:i.applicablePath&&s.getActionControlBreakoutVisibility(i.applicablePath),importance:i.importance,callbackName:i.press,isStandardAction:false,ariaHasPopup:sap.ui.core.aria.HasPopup.None,type:i.logicalAction==="Save"||i.logicalAction==="Edit"?a:sap.m.ButtonType.Default})}function u(t){var e=Object.create(null);var a=t.Action.String.split("/")[1];if(F.annotatedActions&&F.annotatedActions[a]){var n;if(!t.Determining||t.Determining.Bool==="false"){n="action::"+c.getStableIdPartFromDataField(t);e.callbackName=s.getCallAction(t,n)}else{n=c.getStableIdPartForDatafieldActionButton(t)+"::Determining";e.callbackName="._templateEventHandlers.onDeterminingDataFieldForAction"}e.id=n;e.action=F.annotatedActions[a].command;e.annotatedAction=true}return e}function f(t){if(t.Determining&&t.Determining.Bool==="true"){var e=Object.keys(F.outbounds||{}).find(function(e){var a=r.getOutboundNavigationIntent(y,e);return a.semanticObject===t.SemanticObject.String&&a.action===t.Action.String});if(e){return{id:c.getStableIdPartForDatafieldActionButton(t)+"::Determining",action:F.outbounds[e].command,callbackName:"._templateEventHandlers.onDeterminingDataFieldForIntentBasedNavigation",outboundAction:true}}}return Object.create(null)}var g=i();var S=r.getControllerExtensions();var P=[],I=Object.create(null),A=Object.create(null),D=Object.create(null);Object.values(S&&S.Header&&S.Header.Actions||{}).forEach(function(t){if(t.logicalAction&&g[t.logicalAction]){g[t.logicalAction]=o(g[t.logicalAction],t)}else{t.id=n.getStableId({type:"ObjectPageAction",subType:t.determining?"CommonAction":"HeaderExtensionAction",sAction:t.id});P.push(t);if(t.command){I[t.id]={id:t.id,action:t.command,callbackName:t.press};t.press="cmd:"+t.command}}});var F=r.getSettings();(t["com.sap.vocabularies.UI.v1.Identification"]||[]).forEach(function(t){switch(t.RecordType){case"com.sap.vocabularies.UI.v1.DataFieldForAction":var e=u(t);if(!d(e)){A[e.id]=e}break;case"com.sap.vocabularies.UI.v1.DataFieldForIntentBasedNavigation":var e=f(t);if(!d(e)){D[e.id]=e}break;default:break}});return{commandExecution:e(g,I,A,D),extensionActions:P}}return{streamEnabledAssociatedEntites:nt(),sections:at(),breadCrumb:r.getBreadCrumbInfo(),isSelflinkRequired:true,isIndicatorRequired:true,isSemanticallyConnected:false,targetEntities:h,pageLevelActions:rt()}}return{getTemplateSpecificParameters:b}});
//# sourceMappingURL=templateSpecificPreparationHelper.js.map