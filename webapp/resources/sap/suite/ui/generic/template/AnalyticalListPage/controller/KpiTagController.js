sap.ui.define(["sap/suite/ui/generic/template/AnalyticalListPage/controller/KpiCard.controller","sap/ui/model/json/JSONModel","sap/ui/core/mvc/ViewType","sap/ui/Device","sap/m/ResponsivePopover","sap/suite/ui/generic/template/genericUtilities/FeLogger","sap/ui/core/mvc/View","sap/ui/core/Element"],function(e,t,a,i,r,n,o,s){"use strict";var l=new n("AnalyticalListPage.controller.KpiTagController").getLogger();var p;var d={_kpiCards:[],init:function(e){var a=this;a.oState=e;a.oGenericModel=new t;var i={header:"Some Header",title:"Some Title",titleUrl:"",icon:"sap-icon://camera"};a.oGenericModel.setData(i);if(p===undefined){p=sap.ui.getCore().loadLibrary("sap.ovp",{async:true})}},openKpiCard:function(e){var t=this;var a;if(typeof e.currentTarget!="undefined"){a=s.getElementById(e.currentTarget.id)}else{a=e.getSource()}p.then(function(){t.createPopover(function(){t._openCard(a)}.bind(t,a),a)})},_openCard:function(e){var t=this;setTimeout(function(){t._kpiCards[e.getQualifier()].openBy(e)},0)},handleKpiPress:function(e){this.openKpiCard(e)},createPopover:function(n,s){var p=this;var d=s.getQualifier();var c=p.oState.oController.getOwnerComponent();var g=c.getKeyPerformanceIndicators();var u;for(var v in g){if(g[v].hasOwnProperty("qualifier")&&g[v].qualifier===d){u=g[v];break}}if(!u){l.error("KPI settings not found with qualifier.");return}var f=c.getAppComponent().getManifestEntry("/sap.app/crossNavigation/outbounds/"+u.detailNavigation);var C=c.getModel(u.model);C.getMetaModel().loaded().then(function(){var l=this;var p=new t;var c=arguments[0];l._oCardController=new e;var g=l.oState.oController.getOwnerComponent();var u=g.getModel(c.model);var v=u.getMetaModel();var C=v.getODataEntitySet(c.entitySet);c.metaModel=v;p.setData(c);var m=s.getFilterableKPISelectionVariant();o.create({preprocessors:{xml:{bindingContexts:{entityType:v.createBindingContext(v.getODataEntityType(C.entityType,true)),entitySet:v.createBindingContext(v.getODataEntitySet(c.entitySet,true))},models:{entitySet:v,entityType:v,parameter:p},dataModel:u,settings:p,preprocessorsData:g.getComponentData().preprocessorsData}},type:a.XML,viewName:"sap.suite.ui.generic.template.AnalyticalListPage.view.KpiCardSizeM",height:"100%"}).then(function(e){var a=s.kpiSettings.kpiPropertyPath;e.data({kpiTitle:s.getSmartKpiConfig().properties.title,qualifierSettings:c});if(a.selectionPresentationVariantPath){e.data({dataPointPath:a.dataPointPath,selectionPresentationVariantPath:a.selectionPresentationVariantPath})}else{e.data({kpiAnnotationPath:a.kpiAnnotationPath})}if(c.filterable){e.data({mergedSelectionVariant:m});e.data({searchQuery:s.getSmartFilterBarBasicSearchValue()})}else{e.data({selectionVariant:s.kpiSettings.selectionVariant})}e.setModel(g.getModel(c.model));var o=new t;var p={visible:c.detailNavigation?true:false};if(s.kpiSettings.navigation){p.target=s.kpiSettings.navigation.semanticObject;p.action=s.kpiSettings.navigation.action;p.parameters=JSON.stringify({EvaluationId:s.kpiSettings.navigation.kpiId})}else if(c.detailNavigation&&f){p.target=f.semanticObject;p.action=f.action;p.parameters=JSON.stringify(f.parameters?f.parameters:{})}else{p.visible=false}o.setData(p);e.setModel(o,"detailNavigation");if(typeof l._kpiCards[d]!="undefined"){l._kpiCards[d].destroy()}l._kpiCards[d]=new r;var u=i.system.phone?true:false;l._kpiCards[d].setShowHeader(u);if(!u){l._kpiCards[d].addStyleClass("sapSmartTemplatesAnalyticalListPageKpiCardStyle")}l._kpiCards[d].addAriaLabelledBy(s.getSmartKpiConfig().properties.title);l._kpiCards[d].setPlacement("Auto");l._kpiCards[d].addContent(e);l._oKpiCardController=e.getController();l._oKpiCardController._assignSmartTemplateDependencies(l.oState.oTemplateUtils,l.oState.oController);l.oState.oController.getView().addDependent(l._kpiCards[d]);n()})}.bind(this,u))},onExit:function(){if(this._oKpiCard){this._oKpiCard.destroy()}},_setModel:function(e){this._oKpiCard.setModel(e)}};return d});
//# sourceMappingURL=KpiTagController.js.map