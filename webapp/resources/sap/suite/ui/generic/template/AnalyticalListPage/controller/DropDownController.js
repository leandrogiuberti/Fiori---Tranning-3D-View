sap.ui.define(["sap/ui/core/mvc/Controller","sap/ui/model/Filter","sap/m/Button","sap/m/StandardListItem","sap/m/List","sap/m/ToolbarSpacer","sap/suite/ui/generic/template/AnalyticalListPage/util/FilterUtil","sap/m/ResponsivePopover","sap/m/Label","sap/m/ToggleButton","sap/m/SearchField","sap/m/Toolbar","sap/ui/core/Icon","sap/ui/model/Sorter","sap/ui/model/FilterOperator","sap/m/library","sap/base/util/extend","sap/base/util/deepExtend","sap/ui/core/Element"],function(e,t,i,l,n,r,s,o,a,d,g,p,u,m,c,f,h,D,E){"use strict";var F=false,P={},y={},L="",_=e.extend("sap.suite.ui.generic.template.AnalyticalListPage.controller.DropDownController",{});sap.suite.ui.generic.template.AnalyticalListPage.controller.DropDownController.createDropdown=function(e,t,l,n,r,s){L=r.filterRestriction=="multiple"?D({items:[],ranges:[],value:null},t.getDimensionFilter()):t.getDimensionFilter();var o=e.getModel("i18n"),a=E.getElementById(t.getSmartFilterId()),g={descriptionAndId:r.dimensionFieldDisplay,descriptionOnly:r.dimensionFieldDisplay,idAndDescription:r.dimensionField,idOnly:r.dimensionField},g=Object.keys(g).indexOf(r.textArrangement)!==-1?g[r.textArrangement]:r.dimensionFieldDisplay,p=new d({icon:"sap-icon://menu",type:"Transparent",iconFirst:true,enabled:L&&L.hasOwnProperty("items")?Boolean(L.items.length):Boolean(L),tooltip:o.getResourceBundle().getText("VIS_VALUEHELP_DROPDOWN_VIEW_SELECTED")}),u=this.createStandardListItem(l,t,o,n,r,p,a,g),m=this.createPopoverWithList(l,t,o,r,n,u,g,p,s,a),c=new i({text:o.getResourceBundle().getText("OK"),press:function(e){t.setDimensionFilter(L);t.fireFilterChange();m.close()},type:"Emphasized"}),f=new i({text:o.getResourceBundle().getText("CANCEL"),press:function(){m.close()}});F=false;m.addContent(u);u.attachSelectionChange(function(e){var t=e.getParameter("listItem").getBindingContext().getPath();var i=u.getModel().getProperty(t);i=i[r.dimensionField];var l=e.getParameters().listItem.mProperties.selected;if(r.filterRestriction==="multiple"){if(L.items&&L.items.length){for(var s=0;s<L.items.length;s++){if(L.items[s].key===i){L.items.splice(s,1)}else if(l){L.items.push({key:i});break}}}else if(L.items){L.items.push({key:i})}else{L.items=[]}if(L.items.length){P.setVisible(true);y.setText(o.getResourceBundle().getText("VIS_VALUEHELP_DROPDOWN_SELECTED_COUNT",[n,L.items.length]))}P.setVisible(Boolean(L.items.length));p.setEnabled(this.bUpdateToolbarButton||Boolean(L.items.length))}else if(r.filterRestriction==="single"){L=i;if(L){P.setVisible(true);y.setText(o.getResourceBundle().getText("VIS_VALUEHELP_DROPDOWN_SELECTED_COUNT",[n,+Boolean(L)]))}p.setEnabled(Boolean(L))}}.bind(this));m.addStyleClass("sapSmartTemplatesAnalyticalListPageSelectedLinkDialog");m.setBeginButton(c);m.setEndButton(f);m.openBy(e)};sap.suite.ui.generic.template.AnalyticalListPage.controller.DropDownController.createPopoverWithList=function(e,t,i,l,n,r,s,a,d,u){if(this._oPopoverDialog&&this._oPopoverDialog.isOpen){this._oPopoverDialog.close()}if(r){var m=function(e){if(e.getParameter("clearButtonPressed")){return}var t=this.fnApplyFilterFromSearchField(s,e.getSource().getValue());var l=r.getBinding("items");F=false;a.setPressed(false);a.setTooltip(i.getResourceBundle().getText("VIS_VALUEHELP_DROPDOWN_VIEW_SELECTED"));l.filter(t)}.bind(this);this.oSearchField=new g({liveChange:m,search:m,enabled:d});this._oPopoverDialog=new o("",{placement:f.PlacementType.Bottom,verticalScrolling:true,title:n,subHeader:[new p({content:[this.oSearchField,a]})],content:[r]});if(u.isDialogOpen()){this._oPopoverDialog.setModel(t.getModel("_dialogFilter"),"_dialogFilter")}else{this._oPopoverDialog.setModel(t.getModel("_filter"),"_filter")}}this._oPopoverDialog.setInitialFocus(this.oSearchField);this._oPopoverDialog.setContentWidth("320px");return this._oPopoverDialog};sap.suite.ui.generic.template.AnalyticalListPage.controller.DropDownController.createStandardListItem=function(e,t,i,l,o,d,g,m){var c="/"+o.entitySet,D=this,_=D.standardListItemTemplateCreation(t,o,g);y=new a({text:i.getResourceBundle().getText("VIS_VALUEHELP_DROPDOWN_SELECTED_COUNT",[l,typeof t.getDimensionFilter()==="object"&&t.getDimensionFilter()!==null?t.getDimensionFilter().items.length:+Boolean(t.getDimensionFilter())])});P=new p({content:[y,new r,new u({src:"sap-icon://sys-cancel",tooltip:i.getResourceBundle().getText("VIS_VALUEHELP_DROPDOWN_CLEAR_SELECTION"),decorative:false,press:function(e){P.setVisible(false);b.getParent().getBeginButton().getDomRef().focus();F=false;d.setTooltip(i.getResourceBundle().getText("VIS_VALUEHELP_DROPDOWN_VIEW_SELECTED"));d.setEnabled(false);d.setPressed(false);b.removeSelections(true);L&&L.hasOwnProperty("items")?L.items=[]:L="";y.setText(i.getResourceBundle().getText("VIS_VALUEHELP_DROPDOWN_SELECTED_COUNT",[l,L&&L.hasOwnProperty("items")?L.items.length:+Boolean(L)]));b.getBinding("items").filter(this.fnApplyFilterFromSearchField(m,this.oSearchField.getValue()))}.bind(this)}).addStyleClass("sapSmartTemplatesAnalyticalListPageDropdownDialogCancelButton")],visible:L&&L.hasOwnProperty("items")?Boolean(L.items.length):Boolean(L)});if(t.getSmartFilterId()){var S=E.getElementById(t.getSmartFilterId());if(S&&S.getEntitySet()===o.entitySet){c=t.considerAnalyticBinding(c,S)}}var B=s.getVisualFilterSelectFields(o.measureField,o.dimensionField,o.dimensionFieldDisplay),O=s.IsNavigationProperty(t.getModel(),o.entitySet,o.dimensionFieldDisplay)?o.dimensionFieldDisplay.split("/")[0]:null,v={select:B.join(",")};if(O){h(v,{expand:O})}var T,C;T=t.getDimensionFilterExternal();if(T&&T.aFilters&&T.aFilters.length>0){C=[T]}var b=new n({mode:o.filterRestriction==="single"?f.ListMode.SingleSelectMaster:f.ListMode.MultiSelect,growing:true,growingThreshold:15,showNoData:false,rememberSelections:false,infoToolbar:P,items:{path:c,template:_,filters:C,sorter:D.getSortObject(o),parameters:v}});if(g.isDialogOpen()){_.setModel(t.getModel("_dialogFilter"),"_dialogFilter")}else{_.setModel(t.getModel("_filter"),"_filter")}b.setModel(e);d.attachPress(function(e){if(o.filterRestriction=="multiple"&&L.items.length||L&&L.hasOwnProperty("items")&&!L.items.length&&F){D.updateFilterWithListBindings(b,d,i,o.filterRestriction,o.dimensionField)}else if(o.filterRestriction=="single"&&L!=null||L==null&&F){D.updateFilterWithListBindings(b,d,i,o.filterRestriction,o.dimensionField)}});return b};sap.suite.ui.generic.template.AnalyticalListPage.controller.DropDownController.selectedVisibilityUpdateFormatter=function(e,t){for(var i=0;i<e.items.length;i++){if(e.items[i].key===t){return true}}return false};sap.suite.ui.generic.template.AnalyticalListPage.controller.DropDownController.standardListItemTemplateCreation=function(e,t,i){var n=t.textArrangement,r=[];r.push({path:t.measureField});var o=i.isDialogOpen()?["_dialogFilter>/"+e.getParentProperty(),t.dimensionField]:["_filter>/"+e.getParentProperty(),t.dimensionField];if(t.unitField){r.push({path:t.unitField})}var a=new l({title:{parts:[t.dimensionFieldDisplay,t.dimensionField],formatter:function(e,t){return s.getTextArrangement(e,t,n)}},description:{parts:r,formatter:function(e,t){return sap.suite.ui.generic.template.AnalyticalListPage.control.visualfilterbar.FilterItemMicroChart.prototype._getFormattedNumberWithUoM(e,t)}},selected:{parts:o,formatter:function(e,t){if(F){return true}else{if(typeof L==="object"&&L!==null){for(var i=0;i<L.items.length;i++){if(L.items[i].key===t){return true}}}else{return L!==null&&L===t?true:false}}}}});return a};sap.suite.ui.generic.template.AnalyticalListPage.controller.DropDownController.getSortObject=function(e){if(e.sortOrder&&e.sortOrder.length){return new m(e.sortOrder[0].Field?e.sortOrder[0].Field.String:"",e.sortOrder[0].Descending.Boolean)}};sap.suite.ui.generic.template.AnalyticalListPage.controller.DropDownController.updateFilterWithListBindings=function(e,i,l,n,r){var s=[];F=!F;this.bUpdateToolbarButton=F;if(F){i.setTooltip(l.getResourceBundle().getText("VIS_VALUEHELP_DROPDOWN_VIEW_ALL"));i.setEnabled(true);if(n==="multiple"){for(var o=0;o<L.items.length;o++){var a=new t(r,c.EQ,n==="multiple"?L.items[o].key:L);s.push(a)}}else if(n==="single"){var a=new t(r,c.EQ,L);s.push(a)}e.getBinding("items").filter(s)}else{i.setTooltip(l.getResourceBundle().getText("VIS_VALUEHELP_DROPDOWN_VIEW_SELECTED"));i.setEnabled(L&&L.hasOwnProperty("items")?Boolean(L.items.length):Boolean(L));e.getBinding("items").filter(s)}};sap.suite.ui.generic.template.AnalyticalListPage.controller.DropDownController.fnApplyFilterFromSearchField=function(e,i){var l=[];if(i&&i.length>0){var n=new t(e,c.Contains,i);l.push(n)}return l};return _});
//# sourceMappingURL=DropDownController.js.map