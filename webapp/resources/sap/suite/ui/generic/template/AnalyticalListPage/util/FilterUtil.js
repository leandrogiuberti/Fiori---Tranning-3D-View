sap.ui.define(["sap/ui/comp/odata/MetadataAnalyser","sap/ui/base/Object","sap/suite/ui/generic/template/AnalyticalListPage/util/OperationCode","sap/suite/ui/generic/template/AnalyticalListPage/util/V4Terms","sap/ui/core/format/DateFormat","sap/ui/events/KeyCodes","sap/suite/ui/generic/template/genericUtilities/metadataAnalyser","sap/ui/core/date/UI5Date","sap/base/strings/formatMessage","sap/ui/core/Element"],function(e,t,r,a,i,n,o,l,u,s){"use strict";var f=t.extend("sap.suite.ui.generic.template.AnalyticalListPage.util.FilterUtil");f.createTitle=function(e,t){var r;if(!e){return t}if(t instanceof Date){return e}if(e.indexOf(":")!==-1){e=e.substring(0,e.indexOf(":"))}if(e.indexOf(t)===-1){r=e+" ("+t+")"}else{r=e}return r};f._updateVisualFilterAria=function(e){var t=e.getItems()[1].getItems()[0];var r=t.getParentProperty();var a=t.getModel("i18n").getResourceBundle();var i=a.getText("VIS_FILTER_ITEM_ARIA");if(t.getIsMandatory()){i+=" "+a.getText("VIS_FILTER_MANDATORY_PROPERTY_ARIA",[r])}i+=" "+a.getText("VIS_FILTER_DIALOG_NAVIGATE_ARIA")+" "+a.getText("VIS_FILTER_ACCESS_FIELDS_ARIA");e.getItems()[2].setText(i)};f.getAllMandatoryFilters=function(t,r){var a=new e(t);var i=o.getEntityTypeNameFromEntitySetName(r,t.getMetaModel());var n=a.getFieldsByEntityTypeName(i);var l=[];for(var u in n){var s=n[u];if(s.requiredFilterField){l.push(s.name)}}return l};f.isNullable=function(t,r,a){var i=new e(t);var n=o.getEntityTypeNameFromEntitySetName(r,t.getMetaModel());var l=i.getFieldsByEntityTypeName(n);for(var u in l){var s=l[u];if(s&&s.name===a&&s.type==="Edm.String"){if(s.nullable==="false"){return false}else{return true}}}return false};f.getAllMandatoryFiltersMapping=function(e,t){var r=[],a=[],i=false;for(var n=0;n<e.length;n++){i=true;for(var o=0;o<t.length;o++){if(e[n]===t[o].valueListProperty){r.push(t[o]);i=false;break}}if(i){a.push(e[n])}}var l={aMappedFilterList:r,aMappingMissingFilterList:a};return l};f.checkFilterHasValueFromSelectionVariant=function(e,t){return e.some(function(e){if(e.PropertyName.PropertyPath===t){return true}})};f.checkFilterHasValueFromSmartFilterBar=function(e,t){return e.some(function(e){if(e.getName()===t){return true}})};f.checkFilterHasValueFromSelectionVariantOrSmartFilterBar=function(e,t,r,a){var i=r&&f.checkFilterHasValueFromSelectionVariant(r,e);if(!i){i=f.checkFilterHasValueFromSmartFilterBar(a.getFiltersWithValues(),t)}return i};f.readProperty=function(e,t){var r=0,a=typeof t==="string"?t.split("."):[];while(r<a.length){if(!e){return undefined}e=e[a[r++]]}return e};f.executeFunction=function(e,t,r){var a=0,i,n=typeof t==="string"?t.split("."):[];while(a<n.length){if(!e){return undefined}i=e;e=e[n[a++]]}return typeof e==="function"?e.apply(i,r):undefined};f.createTitleFromCode=function(e){var t=f.readProperty(e,"value1"),a=f.readProperty(e,"value2"),i=f.readProperty(e,"operation"),n;if(!t||!i||!r[i]){return undefined}if(a&&i!=="EQ"){n=t+r[i].code+a}else if(r[i].position==="last"){n=t+r[i].code}else if(r[i].position==="mid"){n=r[i].code+t+r[i].code}else{n=r[i].code+t}if(e.exclude){n="!("+n+")"}return n};f.formatFiltersLink=function(e,t,r){return r?u(t,[r]):e};f.getBooleanValue=function(e,t){if(e&&e.Bool){if(e.Bool.toLowerCase()==="true"){return true}else if(e.Bool.toLowerCase()==="false"){return false}}return t};f.getPrimitiveValue=function(e){var t;if(e){if(e.String){t=e.String}else if(e.Bool){t=f.getBooleanValue(e)}else if(e.EnumMember){t=e.EnumMember.split("/")[1]}else{t=f.getNumberValue(e)}}return t};f.getNumberValue=function(e){if(e){var t=Object.keys(e)[0];return e&&t&&["String","Int","Decimal","Double","Single"].indexOf(t)!==-1?Number(e[t]):undefined}};f.getPathOrPrimitiveValue=function(e){if(e){return e.Path?"{path:'"+e.Path+"'}":f.getPrimitiveValue(e)}else{return""}};f.isFilterDiff=function(e,t){if(Array.isArray(e)!=Array.isArray(t)){return true}if(Array.isArray(e)){return this.isFilterListDiff(e,t)}else{return this.isFilterObjDiff(e,t)}};f.isFilterObjDiff=function(e,t){if(!e||!t){return true}for(var r in e){if(r=="aFilters"){if(this.isFilterListDiff(e.aFilters,t.aFilters)){return true}}else if(e[r]!=t[r]){return true}}return false};f.convertLocalDatetoUTCDate=function(e){var t=new Date(e.valueOf()+e.getTimezoneOffset()*60*1e3);return new Date(t.setHours(0,0,0))};f.getDateInMedium=function(e){return e instanceof Date?i.getDateInstance({style:"medium"}).format(e):undefined};f.getDateTimeInMedium=function(e){return e instanceof Date?i.getDateTimeInstance({style:"medium"}).format(e):undefined};f.isDefaultVariantSelected=function(e){var t=e.oSmartFilterbar.getSmartVariant();return t&&t.getCurrentVariantId()===t.getDefaultVariantKey()};f.isFilterListDiff=function(e,t){if(!e||!t){return true}if(e.length!=t.length){return true}for(var r=0;r<e.length;r++){var a=e[r];var i=t[r];if(this.isFilterObjDiff(a,i)){return true}}return false};f.getTextArrangement=function(e,t,r){var a,i=e?e:t,n=e&&t?e+" ("+t+")":i;if(t!=="__IS_OTHER__"&&t!=="Other"){switch(r){case sap.ui.comp.smartfilterbar.DisplayBehaviour.descriptionAndId:a=n;break;case sap.ui.comp.smartfilterbar.DisplayBehaviour.descriptionOnly:a=e?e:"";break;case sap.ui.comp.smartfilterbar.DisplayBehaviour.idAndDescription:a=e&&t?t+" ("+e+")":i;break;case sap.ui.comp.smartfilterbar.DisplayBehaviour.idOnly:a=t?t:"";break;default:a=n;break}}else{a=e}return a};f.getTooltipForValueHelp=function(e,t,r,a,i){var n="";if(i){if(!a){n=r.getText("DP_WITHOUT_SELECTIONS",[t])}else{n=r.getText("DP_SINGLE_SELECTED",[t,a])}return n}if(!a){n=e?r.getText("VALUE_HELP",[t]):r.getText("DROPDOWN_WITHOUT_SELECTIONS",[t])}else{if(!e){n=r.getText("DROPDOWN_WITH_SELECTIONS",[t,a])}else{n=a===1?r.getText("VH_SINGLE_SELECTED",[t,a]):r.getText("VH_MULTI_SELECTED",[t,a])}}return n};f.getPropertyNameDisplay=function(e,t,r,a,i){var n=a?a.getResourceBundle():undefined,o=e.getMetaModel(),l=o.getODataEntityType(o.getODataEntitySet(t).entityType),u=o.getODataProperty(l,r);if(!u){return r}var s=u["com.sap.vocabularies.Common.v1.Label"]&&u["com.sap.vocabularies.Common.v1.Label"].String?u["com.sap.vocabularies.Common.v1.Label"].String:u["sap:label"];var f=u["com.sap.vocabularies.Common.v1.QuickInfo"]&&u["com.sap.vocabularies.Common.v1.QuickInfo"].String?u["com.sap.vocabularies.Common.v1.QuickInfo"].String:u["sap:quickinfo"];if(i&&f){if(f.match(/{@i18n>.+}/gi)&&n){f=n.getText(f.substring(f.indexOf(">")+1,f.length-1))}return f}if(s){if(s.match(/{@i18n>.+}/gi)&&n){s=n.getText(s.substring(s.indexOf(">")+1,s.length-1))}return s}else{return r}};f.getUnitFieldText=function(e,t,r){var a=e.getMetaModel(),i=a.getODataEntityType(a.getODataEntitySet(t).entityType),n=a.getODataProperty(i,r),o=n["com.sap.vocabularies.Common.v1.Text"]&&n["com.sap.vocabularies.Common.v1.Text"].Path?n["com.sap.vocabularies.Common.v1.Text"].Path:n["sap:text"];return o};f.IsNavigationProperty=function(e,t,r){var a=e.getMetaModel(),i=a.getODataEntityType(a.getODataEntitySet(t).entityType);var n=i["navigationProperty"];var o=false;if(r.indexOf("/")!==-1){for(var l=0;l<n.length;l++){if(n[l].name===r.split("/")[0]){o=true;break}}}return o};f.getKeysForNavigationEntitySet=function(e,t,r){if(r){var a=e.getODataEntitySet(t),i=e.getODataEntityType(a.entityType),n=e.getODataAssociationEnd(i,r),o=e.getODataEntityType(n.type),l=this.readProperty(o,"key.propertyRef");if(l&&l.length>1){return l||null}else{return null}}else{return null}};f.isPropertyNonFilterable=function(e,t){if(!e||!t){return false}var r=e[a.FilterRestrictions];var i=r&&r.NonFilterableProperties;if(i){for(var n=0;n<i.length;n++){if(i[n].PropertyPath===t){return true}}}return false};f.getVisualFilterSelectFields=function(e,t,r,a,i,n,o){var l=[e,t];if(t!=r){if(l.indexOf(r)===-1){l.push(r)}}if(a){if(l.indexOf(a)===-1){l.push(a);if(o&&l.indexOf(o)===-1){l.push(o)}}}if(i&&Array.isArray(i)){i.forEach(function(e){if(l.indexOf(e)===-1){l.push(e)}})}if(n){n.forEach(function(e){if(l.indexOf(e.name)===-1){l.push(e.name)}})}return l};f.getFilterDialogMode=function(e){return e.getProperty("/alp/filterDialogMode")};f.getFilterMode=function(e){return e.getProperty("/alp/filterMode")};f.isVisualFilterLazyLoaded=function(e){if(!e.getLazyLoadVisualFilter()){return false}var t=this.getFilterDialogMode(e.getModel("_templPriv"));if(t==="compact"){return true}else if(t==="visual"){return false}var r=this.getFilterMode(e.getModel("_templPriv"));if(r==="compact"){return true}return false};f.formatStringDate=function(e,t,r){if(e!==""){if(t==="Line"){var a=i.getDateInstance({format:"MMMdd"});var n=i.getDateInstance({format:"YYYY"});var o=e&&a.parse(e);var l=e&&n.parse(e);if(r){return n.format(l)}else{return a.format(o)}}else{var u=i.getDateInstance({pattern:"yyyyMMdd"});var s=e&&u.parse(e);return f.getDateInMedium(s)}}return e};f.formatStringDateYearMonth=function(e,t,r){if(!e){return e}var a=e;var n="-";var o=4;var u=[a.slice(0,o),n,a.slice(o)].join("");var s=l.getInstance(u);if(t==="Line"){var f=i.getDateTimeInstance({format:"Y",UTC:true});var c=i.getDateTimeInstance({format:"MMM",UTC:true});if(r){return f.format(s)}else{return c.format(s)}}else{var g=i.getDateTimeInstance({format:"YYYYMMM",UTC:true});return g.format(s)}};f.formatStringDateYearQuarter=function(e,t,r){if(!e){return e}var a=parseInt(e.substr(0,4),10),n=e.substr(4),o=parseInt(n,10)*3-2,u=o-1,s=l.getInstance(Date.UTC(a,u));if(t==="Line"){var f=i.getDateTimeInstance({format:"QQQ",UTC:true});if(r){return a}else{return f.format(s)}}else{var f=i.getDateTimeInstance({format:"YYYYQ",UTC:true});return f.format(s)}};f.formatStringDateYearWeek=function(e,t,r){if(!e){return e}var a=parseInt(e.substr(0,4),10),n=e.substr(4),o=1+(parseInt(n,10)-1)*7,u=l.getInstance(Date.UTC(a,0,o));var s=i.getDateTimeInstance({format:"Y",UTC:true}),f=i.getDateTimeInstance({format:"www",UTC:true});if(t==="Line"){if(r){return s.format(u)}else{return f.format(u)}}else{var c=f.format(u).concat(" ",s.format(u));return c}};f.formatStringFiscalYearPeriod=function(e,t,r){if(e!==""){var a,i,n=1,o=1e3,l=1e4,u=parseInt(e,10);if(u<l){a=u;i=n}else{a=Math.floor(u/o);i=u%o}if(t==="Line"){if(r){return a.toString()}else{return i.toString()}}else{var s=i.toString().concat(" ",a.toString());return s}}return e};f.getResolvedDimensionValue=function(e){return e===null||e===""?null:e.toString()};f.isPropertyHidden=function(e){var t=false;if(e){var r=e["com.sap.vocabularies.UI.v1.Hidden"];t=r?r.Bool==="true":false}return t};f.isInteger=function(e){return e.toUpperCase().indexOf("EDM.INT")!=-1?true:false};f.onKeyUpVisualFilter=function(e){if(e.keyCode===n.F4){var t=s.getElementById(e.target.id),r,a;if(t){var i=t.getMetadata().getElementName();switch(i){case"sap.m.Button":if(this.isF4Enabled){r=t}break;case"sap.m.HeaderContainerItemContainer":var o=t.getItem();if(o){a=o.getId().replace("FilterItemContainer","ValueHelpButton");r=this.getF4ButtonId(a)}break;case"sap.m.CustomListItem":a=t.getId().replace("FilterItemContainer","ValueHelpButton");r=this.getF4ButtonId(a);break;default:break}}else{if(e.target.id.length>0){a=e.target.id.replace("FilterItemMicroChart","ValueHelpButton")}else{a=e.target.parentElement.id.replace("FilterItemMicroChart","ValueHelpButton")}a=a.slice(0,a.indexOf("-innerChart"));r=this.getF4ButtonId(a)}if(r&&this.isF4Enabled(r)){r.firePress()}}};f.onKeyDownVisualFilter=function(e,t){if(t.keyCode===n.ENTER){if(t.ctrlKey||t.metaKey){e.search();t.stopPropagation()}}};f.getF4ButtonId=function(e){return s.getElementById(e)};f.isF4Enabled=function(e){if(e.data("isF4Enabled")){if(e.getVisible()&&e.getEnabled()){return true}}return false};f.isAlreadyInParameter=function(e,t){return e&&e.some(function(e){return e.localDataProperty===t})};f.checkManditoryFieldsFilled=function(e){if(e){var t=e.determineMandatoryFilterItems(),r=e.getFiltersWithValues(),a=0;var i={aMandatoryFilter:[],bIsMandatoryFilter:true};if(t.length){if(!r.length||r.length<t.length){i.bIsMandatoryFilter=false}if(!e.validateMandatoryFields()){for(var n=0;n<t.length;n++){for(var o=0;o<r.length;o++){if(r[o].getName()===t[n].getName()){a++}else if(r[o].getMandatory()){i.aMandatoryFilter.push(t[n].getLabel())}}}i.bIsMandatoryFilter=a===t.length;if(t.length===1){i.aMandatoryFilter.push(t[0].getLabel())}}}if(i.bIsMandatoryFilter){var l=e.verifySearchAllowed.apply(e,arguments);if(l.hasOwnProperty("error")||l.hasOwnProperty("mandatory")){i.bIsMandatoryFilter=false}}}return i};f.getParameter=function(e){var t="$Parameter.";if(e.indexOf(t)>-1){e=e.substring(t.length)}return e};return f},true);
//# sourceMappingURL=FilterUtil.js.map