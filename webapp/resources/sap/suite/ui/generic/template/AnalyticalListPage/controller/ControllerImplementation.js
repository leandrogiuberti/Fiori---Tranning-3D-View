sap.ui.define(["sap/fe/navigation/SelectionVariant","sap/suite/ui/generic/template/AnalyticalListPage/extensionAPI/ExtensionAPI","sap/suite/ui/generic/template/AnalyticalListPage/controller/FilterBarController","sap/suite/ui/generic/template/listTemplates/controller/ToolbarController","sap/suite/ui/generic/template/AnalyticalListPage/controller/VisualFilterBarController","sap/suite/ui/generic/template/AnalyticalListPage/controller/VisualFilterDialogController","sap/ui/table/AnalyticalTable","sap/ui/model/odata/AnnotationHelper","sap/ui/model/analytics/odata4analytics","sap/suite/ui/generic/template/AnalyticalListPage/controller/ContentAreaController","sap/suite/ui/generic/template/listTemplates/controller/IappStateHandler","sap/ui/Device","sap/m/SegmentedButtonItem","sap/suite/ui/generic/template/AnalyticalListPage/util/AnnotationHelper","sap/suite/ui/generic/template/genericUtilities/controlHelper","sap/suite/ui/generic/template/genericUtilities/FeLogger","sap/base/util/ObjectPath","sap/suite/ui/generic/template/lib/ShareUtils","sap/base/util/merge","sap/base/util/deepExtend","sap/suite/ui/generic/template/listTemplates/listUtils","sap/suite/ui/generic/template/listTemplates/controller/MultipleViewsHandler","sap/suite/ui/generic/template/js/StableIdHelper","sap/suite/ui/generic/template/listTemplates/controller/MessageStripHelper","sap/ui/model/json/JSONModel","sap/ui/comp/personalization/Util","sap/suite/ui/generic/template/lib/insights/InsightsHandler","sap/suite/ui/generic/template/genericUtilities/metadataAnalyser","sap/suite/ui/generic/template/genericUtilities/filterHelper","sap/suite/ui/generic/template/js/AnnotationHelperHiddenTermSupport","sap/suite/ui/generic/template/AnalyticalListPage/controller/CtxMenuHandler"],function(e,t,a,r,n,i,o,l,s,d,u,c,g,p,f,m,v,C,S,h,F,b,y,P,I,T,H,A,E,B,M){"use strict";var D=new m("AnalyticalListPage.controller.ControllerImplementation");var V=D.getLogger();var w=D.Level;var _="chart",U="visual",R="compact",O=900;return{getMethods:function(m,D,L){var x={};x.oRefreshTimer=null;x.nRefreshInterval=0;x.bVisualFilterInitialised=false;x._bIsStartingUp=true;var K=false;var N=new M(L,D,x);function k(e){x.oRefreshTimer=setTimeout(function(){var e=L.getOwnerComponent();var t=e.getModel("_templPriv");if(!t.getProperty("/alp/filterChanged")){m.refreshBinding()}},e)}function j(e){if(x.nRefreshInterval!==0){if(x.oRefreshTimer!==null){clearTimeout(x.oRefreshTimer)}if(!e){k(x.nRefreshInterval)}}}function z(){var e=L.getOwnerComponent();var t=e.getModel("_templPriv");t.setProperty("/listReport/isLeaf",e.getIsLeaf())}function q(e,t){var a=e&&e.property;return a.filter(function(e){return typeof e[t]!=="undefined"})}function W(t){var a=t.getModel(),r=a&&a.getMetaModel(),n=r&&r.getODataEntityType(A.getEntityTypeNameFromEntitySetName(t.getEntitySet(),r)),i,o=r&&r.getODataEntityType(A.getEntityTypeNameFromEntitySetName(t.getEntitySet(),r),true),d=p.createSVAnnotation(n,r,x.oController.getOwnerComponent().getQualifier());if(x.oController.getOwnerComponent().getFilterDefaultsFromSelectionVariant()&&d){i=F.createSVObject(S({},d),t)}else{if(x.oController.getOwnerComponent().getFilterDefaultsFromSelectionVariant()&&!d){V.warning("No SelectionVariant found in the annotation : No default values filled in FilterBar")}var u=n&&q(n,"com.sap.vocabularies.Common.v1.FilterDefaultValue"),c,g,f,m,v,C=[];try{c=new s.Model(new s.Model.ReferenceByModel(a));v=c&&c.findQueryResultByName(t.getEntitySet());g=v&&v.getParameterization();f=g&&r.getODataEntitySet(g.getEntitySet().getQName());m=f&&r.getODataEntityType(f.entityType);C=m?q(m,"defaultValue"):[]}catch(e){V.error(e)}if(u.length>0||C.length>0){i=new e;u.forEach(function(e){var t=r.createBindingContext(o+"/property/[${path:'name'}==='"+e.name+"']/com.sap.vocabularies.Common.v1.FilterDefaultValue");i.addSelectOption(e.name,"I","EQ",l.format(t))});C.forEach(function(e){i.addParameter(e.name,e.defaultValue)})}}return i}function G(e){var t=e.getSource();t.suspendSetFilterData();var a=W(t);if(a){x.oIappStateHandler.fnSetFiltersUsingUIState(a.toJSONObject(),{},true,false)}x.oIappStateHandler.onSmartFilterBarInitialise();L.onInitSmartFilterBarExtension(e);L.templateBaseExtension.onInitSmartFilterBar(e)}function J(){var e=x.oController.getOwnerComponent();if(x.hideVisualFilter||e.getDefaultFilterMode()=="visual"&&e.getModel().mMetadataUrlParams&&e.getModel().mMetadataUrlParams["sap-value-list"]==="none"){if(x.alr_visualFilterBar&&!x.alr_visualFilterBar.getAssociateValueListsCalled()){x.alr_visualFilterBar.setAssociateValueListsCalled(true)}x.oSmartFilterbar.associateValueLists()}var t=x.oIappStateHandler.onSmartFilterBarInitialized();t.then(function(){x._bIsStartingUp=false;if(x.bVisualFilterInitialised){x.oIappStateHandler.fnUpdateVisualFilterBar()}if(x.sNavType!==sap.fe.navigation.NavType.iAppState){x.oIappStateHandler.fnStoreCurrentAppStateAndAdjustURL()}},function(e){if(e instanceof Error){e.showMessageBox()}x.oIappStateHandler.fnOnError();x._bIsStartingUp=false}).finally(function(){if(x.oSmartFilterableKPI){var e=x.oSmartFilterableKPI.getContent();e.forEach(function(e){if(e.getSmartFilterId){e._bStopDataLoad=false;e._updateKpiList(true)}})}})}function Q(e){var t=e.getSource(),a=e.getParameters().limitReached,r=t.getSelectedIndices(),n,i;if(r.length>0){if(a){n="Your last selection was limited to the maximum of "+t.getLimit()+" items.";D.oServices.oApplication.showMessageToast(n)}}i=t.getParent();D.oCommonUtils.setEnabledToolbarButtons(i)}function X(e){var t=e.getParameters();var a=e.getSource();D.oCommonEventHandlers.onSemanticObjectLinkNavigationPressed(a,t)}function $(e){var t,a;t=e.getParameters();a=e.getSource();D.oCommonEventHandlers.onSemanticObjectLinkNavigationTargetObtained(a.getEntitySet(),a.getFieldSemanticObjectMap(),t,x)}function Y(e){var t=x.oSmartFilterbar;var a=[];if(e.fetchVariant()&&e.fetchVariant().filter&&e.fetchVariant().filter.filterItems){a=e.fetchVariant().filter.filterItems}var r={search:!!t.getBasicSearchValue(),filter:!!(a.length||t.retrieveFiltersWithValues().length)};return r}function Z(e){var t=e.getId();var a=Y(e);var r="";if(a.search||a.filter){r=D.oCommonUtils.getContextText("NOITEMS_SMARTCHART_WITH_FILTER",t)}else{r=D.oCommonUtils.getContextText("NOITEMS_SMARTCHART",t)}e.getChartAsync().then(function(e){e.setCustomMessages({NO_DATA:r})})}function ee(e){var t=function(){var e=D.oServices.oPresentationControlHandlerFactory.getPresentationControlHandler(x.oSmartChart);var t=e.getModel().getMetaModel();var a=t.getODataEntitySet(e.getEntitySet()).entityType;var r=x.oSmartTable.getTable();var n=r.getBinding("rows")||r.getBinding("items");var i=n?n.getDownloadUrl():"";var o=n?n.aApplicationFilter||n.aApplicationFilters:[];if(!o.length){return Promise.resolve({sServiceUrl:i})}var l=x.oSmartFilterbar.getFilterData();var s=E.getFilterParams(t,a,o,l);if(s){i=D.oCommonUtils.fnReplaceFiltersWithGetDownloadUrl(i,s);return Promise.resolve({sServiceUrl:i})}else{return Promise.resolve({sServiceUrl:""})}};var a={sharePageToPressed:function(e){var t=D.oServices.oApplication.getBusyHelper();if(t.isBusy()){return}var a=D.oServices.oApplication.getAppTitle();var r=C.getCurrentUrl().then(function(t){switch(e){case"Email":a=D.oCommonUtils.getText("EMAIL_HEADER",[a]);sap.m.URLHelper.triggerEmail(null,a,t);break;default:break}});t.setBusy(r)},shareJamPressed:function(){C.openJamShareDialog(D.oServices.oApplication.getAppTitle())},shareTilePressed:function(){C.fireBookMarkPress()},getServiceUrl:function(){return t().then(function(e){if(e.sServiceUrl){e.sServiceUrl=e.sServiceUrl?e.sServiceUrl+"&$top=0&$inlinecount=allpages":""}var t={serviceUrl:e.sServiceUrl};L.onSaveAsTileExtension(t);return t.serviceUrl})},getModelData:function(){var e=v.get("sap.ushell.Container.getUser");var t=L.getOwnerComponent().getAppComponent();var r=t.getManifestEntry("sap.ui");var n=t.getManifestEntry("sap.app");return a.getServiceUrl().then(function(t){return C.getCurrentUrl().then(function(a){return{serviceUrl:t,icon:r&&r.icons?r.icons.icon:"",shellTitle:n?n.title:"",isShareInJamActive:!!e&&e().isJamActive(),customUrl:C.getCustomUrl(),currentUrl:a}})})}};C.openSharePopup(D.oCommonUtils,e,a)}return{onInit:function(){var e=L.getOwnerComponent();V.setLevel(w.WARNING,"ALPSmartFilterBar");var t=e.getModel("_templPriv");t.setProperty("/alp",{filterMode:e.getHideVisualFilter()?R:e.getDefaultFilterMode(),contentView:e.getDefaultContentView(),autoHide:e.getAutoHide(),visibility:{hybridView:c.system.phone||c.system.tablet&&!c.system.desktop?false:true},filterChanged:false});x.hideVisualFilter=e.getHideVisualFilter();x.hideVisualFilter=x.hideVisualFilter===undefined||x.hideVisualFilter!==true?false:true;x.quickVariantSelectionX=e.getQuickVariantSelectionX();x.oSmartFilterbar=L.byId("template::SmartFilterBar");x.oSmartTable=L.byId("table");x.oSmartFilterableKPI=L.byId("template::KPITagContainer::filterableKPIs");x.oPage=L.byId("template::Page");x.oSmartChart=L.byId("chart");var i=new b(x,L,D);x.oMultipleViewsHandler=i;x.oMessageStripHelper=new P(D.oServices.oPresentationControlHandlerFactory.getPresentationControlHandler(x.oSmartTable),i,L,D,"alp");x.alr_compactFilterContainer=L.byId("template::CompactFilterContainer");x.alr_visualFilterContainer=L.byId("template::VisualFilterContainer");x.alr_filterContainer=L.byId("template::FilterContainer");x.alr_visualFilterBar=L.byId("template::VisualFilterBar");var l="";if(x.quickVariantSelectionX){l=i.getSelectedKey()}var s=y.getStableId({type:"ALPTable",subType:"ColumnListItem",sQuickVariantKey:l});x.alp_ColumnListItem=L.byId(s);if(x.alr_visualFilterBar){var g=e.getFilterSettings();if(g&&Object.keys(g).length>0){x.alr_visualFilterBar.setFilterSettings(g)}x.alr_visualFilterBar.setSmartFilterId(x.oSmartFilterbar.getId());x.alr_visualFilterBar.attachOnFilterItemAdded(function(e){var t=e.getParameters();t.attachBeforeRebindVisualFilter(function(e){var t=e.getParameters();var a=t.sEntityType;var r=t.sDimension;var n=t.sMeasure;var i=t.oContext;var o=x.oController;o.onBeforeRebindVisualFilterExtension(a,r,n,i)})})}x.oKpiTagContainer=L.byId("template::KPITagContainer::globalKPIs");x.oFilterableKpiTagContainer=L.byId("template::KPITagContainer::filterableKPIs");if(x.oKpiTagContainer||x.oFilterableKpiTagContainer){sap.ui.require(["sap/suite/ui/generic/template/AnalyticalListPage/controller/KpiTagController"],function(e){e.init(x)})}x.oContentArea=new d;x.oTemplateUtils=D;x.toolbarController=new r;x.oController=L;x.filterBarController=new a;x.filterBarController.init(x);x.oContentArea.createAndSetCustomModel(x);x.oInsightsHandler=new H(x,L,D);x.oMultipleViewsHandler.getInitializationPromise().then(function(){x.oContentArea.setState(x)});var p=D.oServices.oInsightsFECardProvider&&D.oServices.oInsightsFECardProvider.getCardProviderInsightsInstance();if(p&&!D.oCommonUtils.isMultiViewMultiEntity()){D.oServices.oInsightsFECardProvider.fnRegisterComponentForProvider(x.oInsightsHandler,L.getView().getId());t.bindProperty("/alp/filterChanged").attachChange(function(e){if(!e.getSource().getValue()){var t=D.oServices.oPresentationControlHandlerFactory.getPresentationControlHandler(x.oSmartChart);x.oInsightsHandler.getCardsToShare("Analytical",t).then(function(e){p.onViewUpdate(true,e)})}else{p.onViewUpdate(true,[])}})}if(!x.hideVisualFilter){x.visualFilterBarContainer=new n;x.visualFilterBarContainer.init(x)}if(x.alr_visualFilterBar){x.alr_visualFilterBar.addEventDelegate({onAfterRendering:function(){if(x.oSmartFilterbar.isInitialised()){x.oSmartFilterbar.setFilterData({_CUSTOM:x.oIappStateHandler.getFilterState()})}}})}x.oIappStateHandler=new u(x,L,D);z();L.byId("template::FilterText").attachBrowserEvent("click",function(){L.byId("template::Page").setHeaderExpanded(true)});t.setProperty("/listReport/isHeaderExpanded",true);t.setProperty("/generic/bDataAreShownInChart",false);if(x.oSmartTable){var v=x.oSmartTable.getTable()}var C="sapUiSizeCozy",S="sapUiSizeCompact",F="sapUiSizeCondensed";if(f.isUiTable(v)||v instanceof o){var I=L.getView();var T=document.body;if(T.classList.contains(C)||I.hasStyleClass(C)){x.oSmartTable.addStyleClass(C)}else if(T.classList.contains(S)||I.hasStyleClass(S)){var A=e.getCondensedTableLayout();if(A===false){x.oSmartTable.addStyleClass(S)}else{x.oSmartTable.addStyleClass(F)}}}if(x.oSmartFilterableKPI){x.oSmartFilterableKPI.setModel(e.getModel("_templPriv"),"_templPriv");var E=x.oSmartFilterableKPI.getContent(),B=x.oController;E.forEach(function(e){if(e.getSmartFilterId){e.attachBeforeRebindFilterableKPI(function(e){var t=e.getParameters(),a=t.selectionVariant,r=t.entityType,n=e.getSource().getId();B.onBeforeRebindFilterableKPIExtension(a,r,n)},B)}})}m.getUrlParameterInfo=function(){return x.oIappStateHandler.getUrlParameterInfo()};m.onComponentActivate=function(){};m.refreshBinding=function(){if(x.alr_visualFilterBar&&x.alr_visualFilterBar.updateVisualFilterBindings){x.alr_visualFilterBar.updateVisualFilterBindings()}if(x.oSmartChart&&x.oSmartChart.rebindChart){x.oSmartChart.rebindChart()}if(x.oSmartTable){D.oServices.oPresentationControlHandlerFactory.getPresentationControlHandler(x.oSmartTable).refresh()}if(x.oKpiTagContainer){var e=x.oKpiTagContainer.mAggregations.content;for(var t in e){if(e[t]._createGlobalKpi){e[t]._createGlobalKpi()}}}if(x.oFilterableKpiTagContainer){var e=x.oFilterableKpiTagContainer.mAggregations.content;for(var t in e){if(e[t]._createFilterableKpi){e[t]._createFilterableKpi()}}}j()};m.onSuspend=function(){j(true)};m.onRestore=function(){if(x.nRefreshInterval){k(x.nRefreshInterval)}};if(x.alr_visualFilterBar){x.alr_visualFilterBar.attachInitialized(function(e){x.bVisualFilterInitialised=true;if(!x._bIsStartingUp){x.oIappStateHandler.fnUpdateVisualFilterBar(true)}})}x.oSmartFilterbar.attachFilterChange(function(t){var a=e.getModel("_templPriv");x.oIappStateHandler.fnCheckMandatory();var r=x.oSmartFilterbar.isDialogOpen();var n=t.getSource(),i;i=h({},n.getFilterData(true));if(r&&x.visualFilterDialogContainer){var o=x.visualFilterDialogContainer.oVerticalBox.getModel("_dialogFilter");o.setData(i)}else{var l=x.oController.getOwnerComponent().getModel("_filter");l.setData(i)}if(t.getParameters().filterItem){if(!x.hideVisualFilter){x.filterBarController.changeVisibility(t)}a.setProperty("/alp/_ignoreChartSelections",false)}x.filterBarController._updateFilterLink();if(!x.oSmartFilterbar.isLiveMode()&&!x.oSmartFilterbar.isDialogOpen()){a.setProperty("/alp/filterChanged",true)}});var I=L.getView();var T=document.body;var M,_;if(T.classList.contains(C)||I.hasStyleClass(C)){M=true}if(M&&e.getTableType()!=="ResponsiveTable"){var U=e.getModel("_templPriv");if(c.resize.height<=O){_=U.getProperty("/alp/contentView");U.setProperty("/alp/enableHybridMode",false);U.setProperty("/alp/contentView",_==="charttable"?"chart":_)}x.resizeHandler=function(e){var t=e.height;if(t<=O){_=U.getProperty("/alp/contentView");U.setProperty("/alp/enableHybridMode",false);U.setProperty("/alp/contentView",_==="charttable"?"chart":_)}else{U.setProperty("/alp/enableHybridMode",true)}};c.resize.attachHandler(x.resizeHandler)}if(e.getRefreshIntervalInMinutes()){x.nRefreshInterval=e.getRefreshIntervalInMinutes();x.nRefreshInterval=(x.nRefreshInterval<1?1:x.nRefreshInterval)*6e4}var K=L.byId(y.getStableId({type:"ALPAction",subType:"Share"})+"-internalBtn");if(K){K.attachPress(function(){ee(K)})}},attachRefreshInterval:k,clearingRefreshTimerInterval:j,onExit:function(){if(x.resizeHandler){c.resize.detachHandler(x.resizeHandler)}if(x.oRefreshTimer!==null){clearTimeout(x.oRefreshTimer)}},handlers:{onBack:function(){D.oServices.oNavigationController.navigateBack()},onSmartTableInit:function(e){var t=e.getSource(),a=t.getToolbar(),r=a.getContent(),n;var i=B.getHiddenColumnInfo(t);if(i&&i.staticHiddenColumns&&i.staticHiddenColumns.length>0){t.deactivateColumns(i.staticHiddenColumns)}t.setHeight("100%");D.oCommonUtils.checkToolbarIntentsSupported(t);if(x._pendingTableToolbarInit){if(!x.oSmartFilterableKPI&&!x.oMultipleViewsHandler.getMode()){a.insertContent(x.alr_viewSwitchButtonOnTable,r.length)}}if(x._pendingTableToolbarInit){for(var o=0;o<r.length;o++){if(r[o].mProperties.text==="Settings"){n=o}}a.insertContent(x._autoHideToggleBtn,n)}delete x._pendingTableToolbarInit;t.attachShowOverlay(function(e){t.getToolbar().setEnabled(!e.getParameter("overlay").show)});var l=new I({highlightMode:"rebindTable"});t.setModel(l,"_tableHighlight");D.oServices.oPresentationControlHandlerFactory.getPresentationControlHandler(t).addCellSelector()},onBeforeRebindTable:function(e){var t=e.getSource();var a=e.getParameter("bindingParams");x.oMessageStripHelper.onBeforeRebindControl(e);if(x.chartController&&x.chartController.oChart){var r=x.chartController.oChart,n=x.chartController._chartInfo;n.drillStack=x.chartController.oChart.getDrillStack();var i=n.drillStack&&n.drillStack.length>0?n.drillStack[n.drillStack.length-1]:undefined}var o=L.getOwnerComponent().getModel("_templPriv");var l=o.getProperty("/alp/contentView");if(l===_){a.preventTableBind=true;K=true}var s=o.getProperty("/alp/_ignoreChartSelections");if(x.detailController.isFilter()&&x.oSmartChart&&!s){x.detailController._applyChartSelectionOnTableAsFilter(e,r)}if(x.detailController.isFilter()&&i&&i.filter){a.filters.push(i.filter)}var d=[];var u=t.getTable().getColumns();for(var c=0;c<u.length;c++){var g=u[c];if(g.getGrouped&&g.getGrouped()){d.push(g.getLeadingProperty?g.getLeadingProperty():T.getColumnKey(g))}}x.detailController._updateExpandLevelInfo(d,a);if(L.getOwnerComponent().getModel().getDefaultCountMode()==="None"&&t._isAnalyticalTable){a.parameters.provideTotalResultSize=false;t.setShowRowCount(false)}L.onBeforeRebindTableExtension(e);x.oMultipleViewsHandler.aTableFilters=h({},a.filters);var p=a.events.refresh||Function.prototype;a.events.refresh=function(e){x.oMultipleViewsHandler.onDataRequested();p.call(this,e)};var f=a.events.dataRequested||Function.prototype;a.events.dataRequested=function(e){var a=this;x.detailController.onSmartTableDataRequested(t).then(function(){f.call(a,e)})};var m=a.events.dataReceived||Function.prototype;a.events.dataReceived=function(e){x.oContentArea.enableToolbar();D.oCommonEventHandlers.onDataReceived(t);var a=B.getHiddenColumnInfo(t);D.oCommonEventHandlers.hideTableCells(t,a);D.oComponentUtils.hidePlaceholder();m.call(this,e)};D.oCommonEventHandlers.onBeforeRebindTable(e,{setBindingPath:t.setTableBindingPath.bind(t),ensureExtensionFields:L.templateBaseExtension.ensureFieldsForSelect,addExtensionFilters:L.templateBaseExtension.addFilters,resolveParamaterizedEntitySet:x.oMultipleViewsHandler.resolveParameterizedEntitySet,isMandatoryFiltersRequired:false,isFieldControlRequired:false,isPopinWithoutHeader:false,isDataFieldForActionRequired:false,isFieldControlsPathRequired:false});var v=a.filters.slice(0);x.oMultipleViewsHandler.onRebindContentControl(a,v);t.getModel("_tableHighlight")&&t.getModel("_tableHighlight").setProperty("/highlightMode","rebindTable");x.detailController._applyCriticalityInfo(e,t);F.handleErrorsOnTableOrChart(D,e,x)},onSelectionDetailsActionPress:function(e){x.oMultipleViewsHandler.onDetailsActionPress(e)},addEntry:function(e){var t=e.getSource();D.oCommonEventHandlers.addEntry(t,false,x.oSmartFilterbar)},deleteEntries:function(e){D.oCommonEventHandlers.deleteEntries(e)},onSelectionChange:function(e){var t=e.getSource(),a=t.getModel(),r=t.getModel("_templPriv");var n=a.getMetaModel(),i=n.getODataEntitySet(this.getOwnerComponent().getEntitySet()),o=i["Org.OData.Capabilities.V1.DeleteRestrictions"];var l=o&&o.Deletable&&o.Deletable.Path?o.Deletable.Path:"";var s=false;var d=true;var u=l&&l!=="";var c=D.oServices.oPresentationControlHandlerFactory.getPresentationControlHandler(D.oCommonUtils.getOwnerPresentationControl(t)).getSelectedContexts();if(c.length>0){for(var g=0;g<c.length;g++){var p=a.getObject(c[g].getPath());if(!(p.IsActiveEntity&&p.HasDraftEntity&&p.DraftAdministrativeData&&p.DraftAdministrativeData.InProcessByUser)){d=false}if(u){if(a.getProperty(l,c[g])){u=false}}if(!d&&!u){s=true;break}}}r.setProperty("/listReport/deleteEnabled",s)},onMultiSelectionChange:Q,onChange:function(e){D.oCommonEventHandlers.onChange(e)},onContactDetails:function(e){D.oCommonEventHandlers.onContactDetails(e)},onSmartFilterBarInitialise:G,onSmartFilterBarInitialized:J,onEditStateFilterChanged:function(e){e.getSource().fireChange()},onFilterPress:function(e){x.filterBarController.showDialog.call(x.filterBarController)},onClearPress:function(e){x.filterBarController.clearFilters();L.onClearFilterExtension(e)},onGoPress:function(e){x.filterBarController.fnCheckMandatory();var t=x.oSmartFilterbar.isDialogOpen();if(!t){x.filterBarController.onGoFilter()}},onBeforeSFBVariantSave:function(){if(x.oSmartFilterbar.isDialogOpen()&&!x.hideVisualFilter){x.visualFilterDialogContainer._updateFilterBarFromDialog.call(x.visualFilterDialogContainer)}var e=x.oIappStateHandler.getCurrentAppState();if(!this.getOwnerComponent().getProperty("smartVariantManagement")){delete e.customData["sap.suite.ui.generic.template.genericData"].contentView}var t=x.oSmartFilterbar.getFilterData(true);var a,r=x.oSmartFilterbar.getBasicSearchControl();if(r&&r.getValue){a=r.getValue()}t._CUSTOM=e.customData;t._CUSTOM["sap.suite.ui.generic.template.genericData"].variantDirty=false;x.oSmartFilterbar.setFilterData(t,true);if(a){x.oSmartFilterbar.getBasicSearchControl().setValue(a)}x.oSmartFilterbar.fireFilterChange()},onAfterSFBVariantLoad:function(e){if(!x.oSmartFilterbar.isDialogOpen()){x.filterBarController._afterSFBVariantLoad();if(x.oSmartFilterableKPI&&!x.oSmartFilterbar.isLiveMode()){var t=x.oSmartFilterableKPI.getContent();t.forEach(function(t){if(t.getSmartFilterId){if(e.getParameter("executeOnSelect")){t.bSearchTriggred=true}}})}}},onBeforeRebindChart:function(e){var t=e.getSource();Z(t);var a=e.getParameters().bindingParams;x.oMultipleViewsHandler.aTableFilters=h({},a.filters);var r=a.filters.slice(0);var n={setBindingPath:t.setChartBindingPath.bind(t),ensureExtensionFields:Function.prototype,addExtensionFilters:L.templateBaseExtension.addFilters,resolveParamaterizedEntitySet:x.oMultipleViewsHandler.resolveParameterizedEntitySet,isFieldControlRequired:false,isMandatoryFiltersRequired:true};L.onBeforeRebindChartExtension(e);var i=a.events.dataReceived||Function.prototype;a.events.dataReceived=function(e){if(!t.getToolbar().getEnabled()){x.oContentArea.enableToolbar()}D.oComponentUtils.hidePlaceholder();i.call(this,e)};D.oCommonUtils.onBeforeRebindTableOrChart(e,n,x.oSmartFilterbar);x.oMultipleViewsHandler.onRebindContentControl(a,r);F.handleErrorsOnTableOrChart(D,e,x)},onListNavigate:function(e){D.oCommonEventHandlers.onListNavigate(e,x)},onCallActionFromToolBar:function(e){var t=D.oCommonUtils.getParentTable;D.oCommonUtils.getParentTable=function(){return x.oSmartTable};D.oCommonEventHandlers.onCallActionFromToolBar(e,x);D.oCommonUtils.getParentTable=t;t=null},onCallActionFromList:function(e){},onDataFieldForIntentBasedNavigation:function(e){D.oCommonEventHandlers.onDataFieldForIntentBasedNavigation(e,x)},onDataFieldWithEmail:function(e){D.oCommonEventHandlers.onDataFieldWithEmail(e)},onDataFieldWithIntentBasedNavigation:function(e){D.oCommonEventHandlers.onDataFieldWithIntentBasedNavigation(e,x)},onBeforeSemanticObjectLinkPopoverOpens:function(e){var t=e.getSource();var a=x.oSmartFilterbar.getUiState({allFilters:false}).getSelectionVariant();if(x.oSmartFilterbar.getEntitySet()!==t.getEntitySet()){a.FilterContextUrl=D.oServices.oApplication.getNavigationHandler().constructContextUrl(t.getEntitySet(),t.getModel())}var r=JSON.stringify(a);D.oCommonUtils.semanticObjectLinkNavigation(e,r,L)},onAssignedFiltersChanged:function(e){if(e&&e.getSource()){if(x&&x.oSmartFilterbar&&x.filterBarController){L.byId("template::FilterText").setText(x.oSmartFilterbar.retrieveFiltersWithValuesAsText())}}},onToggleFiltersPressed:function(){var e=L.getOwnerComponent();var t=e.getModel("_templPriv");t.setProperty("/listReport/isHeaderExpanded",t.getProperty("/listReport/isHeaderExpanded")===true?false:true)},onSearchButtonPressed:function(){if(c.system.phone&&x.oPage.getHeaderExpanded()){x.oPage.setHeaderExpanded(false)}var e=L.getOwnerComponent().getModel();x.oController.getOwnerComponent().getModel("_templPriv").setProperty("/alp/filterChanged",false);x.oController.getOwnerComponent().getModel("_templPriv").setProperty("/generic/bDataAreShownInChart",true);e.attachEventOnce("requestSent",function(){if(!x._bIsStartingUp){x.oIappStateHandler.fnStoreCurrentAppStateAndAdjustURL()}else{x.oIappStateHandler.fnResolveStartUpPromise()}});x.oController.getOwnerComponent().getModel("_templPriv").setProperty("/alp/_ignoreChartSelections",true);if(x.oSmartTable){D.oCommonUtils.refreshModel(x.oSmartTable.getEntitySet())}else{D.oCommonUtils.refreshModel(x.oSmartChart.getEntitySet())}j()},onSemanticObjectLinkNavigationPressed:X,onSemanticObjectLinkNavigationTargetObtained:$,onAfterTableVariantSave:function(){x.oIappStateHandler.fnStoreCurrentAppStateAndAdjustURL()},onAfterApplyTableVariant:function(){setTimeout(function(){x.oIappStateHandler.fnStoreCurrentAppStateAndAdjustURL()},0)},onAfterChartVariantSave:function(e){x.oIappStateHandler.fnStoreCurrentAppStateAndAdjustURL();D.oCommonUtils.setEnabledToolbarButtons(e.getSource())},onAfterApplyChartVariant:function(){setTimeout(function(){x.oIappStateHandler.fnStoreCurrentAppStateAndAdjustURL()},0)},onFilterModeSegmentedButtonChange:function(e){x.filterBarController.handleFilterSwitch();x.oController._templateEventHandlers.onSegmentButtonPressed();x.filterBarController.fnCheckMandatory()},onContentViewSegmentButtonPressed:function(e){var t=e.getSource().getSelectedKey();if((t==="table"||t==="charttable")&&K){x.oSmartTable.rebindTable();K=false}if(!x.oSmartFilterableKPI&&!x.oController.getOwnerComponent().getContentTitle()){var a=x.oController.getView(),r;if(t==="customview1"){r="template::contentViewExtensionToolbar"}else if(t==="customview2"){r="template::contentViewExtension2Toolbar"}else if(t==="chart"||t==="charttable"){r=a.byId("template::masterViewExtensionToolbar")?"template::masterViewExtensionToolbar":"template::ChartToolbar"}else if(t==="table"){r="template::TableToolbar"}x.oController._templateEventHandlers.setFocusOnContentViewSegmentedButtonItem(a,r)}x.oController._templateEventHandlers.onSegmentButtonPressed(!x.oController.getOwnerComponent().getProperty("smartVariantManagement"))},setFocusOnContentViewSegmentedButtonItem:function(e,t){var a=e.byId(t);if(a){var r=a.getContent().length,n=a.getContent()[r-1];if(n){n.addEventDelegate({onAfterRendering:function(e){e.srcControl.focus()}})}}},onSegmentButtonPressed:function(e){if(!e){x.oController.byId("template::PageVariant").currentVariantSetModified(true);x.oSmartFilterbar.setFilterData({_CUSTOM:x.oIappStateHandler.getFilterState()})}x.oIappStateHandler.fnStoreCurrentAppStateAndAdjustURL()},onShareListReportActionButtonPress:function(e){D.oCommonUtils.executeIfControlReady(ee,y.getStableId({type:"ALPAction",subType:"Share"})+"-internalBtn")},onDeterminingDataFieldForAction:function(e){var t=x.oController.getOwnerComponent().getModel("_templPriv");var a=t.getProperty("/alp/contentView");var r=D.oServices.oPresentationControlHandlerFactory.getPresentationControlHandler(a===_?x.oSmartChart:x.oSmartTable);D.oCommonEventHandlers.onDeterminingDataFieldForAction(e,r)},onDeterminingDataFieldForIntentBasedNavigation:function(e){var t=e.getSource();var a=x.oController.getOwnerComponent().getModel("_templPriv");var r=a.getProperty("/alp/contentView");var n=D.oServices.oPresentationControlHandlerFactory.getPresentationControlHandler(r===_?x.oSmartChart:x.oSmartTable).getSelectedContexts();D.oCommonEventHandlers.onDeterminingDataFieldForIntentBasedNavigation(t,n,x.oSmartFilterbar)},onInlineDataFieldForAction:function(e){D.oCommonEventHandlers.onInlineDataFieldForAction(e)},onInlineDataFieldForIntentBasedNavigation:function(e){D.oCommonEventHandlers.onInlineDataFieldForIntentBasedNavigation(e.getSource(),x)},onAutoHideToggle:function(){x.oSmartTable.getModel("_tableHighlight").setProperty("/highlightMode","eyeModeSwitch");x.chartController&&x.chartController._updateTable();x.oIappStateHandler.fnStoreCurrentAppStateAndAdjustURL()},onFullScreenToggled:function(e){var t=e.getParameter("fullScreen");var a=e.getSource().getModel("_templPriv");a.setProperty("/alp/fullScreen",t)},onDialogClosed:function(e){x.visualFilterDialogContainer._closeDialog.call(x.visualFilterDialogContainer,e)},onDialogOpened:function(e){if(!x.visualFilterDialogContainer){x.visualFilterDialogContainer=new i;x.visualFilterDialogContainer.init(x)}var t=x.oController.getView().getModel("_templPriv"),a=U,r={},n;n=t.getProperty("/alp/searchable");if(!n){if(x.alr_visualFilterBar&&!x.alr_visualFilterBar.getAssociateValueListsCalled()){x.alr_visualFilterBar.setAssociateValueListsCalled(true);x.oSmartFilterbar.associateValueLists()}}r.item=new g({icon:"sap-icon://filter-analytics",tooltip:"{i18n>FILTER_VISUAL}",key:a,enabled:"{_templPriv>/alp/searchable}"});r.selectionChange=function(e){x.visualFilterDialogContainer._toggle.call(x.visualFilterDialogContainer,e)};r.content=x.visualFilterDialogContainer._createForm();r.search=function(e){x.visualFilterDialogContainer._triggerSearchInFilterDialog.call(x.visualFilterDialogContainer,e)};r.filterSelect=function(e){x.visualFilterDialogContainer._triggerDropdownSearch.call(x.visualFilterDialogContainer,e)};x.oSmartFilterbar.addAdaptFilterDialogCustomContent(r)},onDialogClear:function(e){L.onClearFilterExtension(e)},onRestore:function(e){x.visualFilterDialogContainer._restoreDialog.call(x.visualFilterDialogContainer)},onDialogCancel:function(e){x.visualFilterDialogContainer._cancelDialog.call(x.visualFilterDialogContainer)},onRowSelectionChange:function(e){var t=e.getSource();D.oCommonUtils.setEnabledToolbarButtons(t)},dataStateFilter:function(e,t){return x.oMessageStripHelper.dataStateFilter(e,t)},dataStateClose:function(){x.oMessageStripHelper.onClose()},onAddCardsToRepository:function(e){var t=D.oServices.oPresentationControlHandlerFactory.getPresentationControlHandler(x.oSmartChart);t.getInitializationPromise().then(function(){x.oInsightsHandler.prepareAndShowCard(e,{cardType:"Analytical"},t)})},onBeforeExport:function(e){D.oCommonEventHandlers.onBeforeExport(e)},beforeOpenContextMenu:function(e,t){N.beforeOpenContextMenu(e,t)},onContextMenu:function(e,t){N.onContextMenu(e,t)}},formatters:{formatItemTextForMultipleView:function(e){return x.oMultipleViewsHandler?x.oMultipleViewsHandler.formatItemTextForMultipleView(e):""},formatMessageStrip:function(e,t){return x.oMultipleViewsHandler?x.oMultipleViewsHandler.formatMessageStrip(e,t):""}},extensionAPI:new t(D,L,x)}}}});
//# sourceMappingURL=ControllerImplementation.js.map