sap.ui.define(["sap/ui/model/FilterOperator","sap/ui/core/format/DateFormat","sap/base/security/encodeURL","sap/m/DynamicDateUtil","sap/suite/ui/generic/template/genericUtilities/metadataAnalyser","sap/base/i18n/date/CalendarType","sap/suite/ui/generic/template/genericUtilities/testableHelper","sap/ui/model/Filter"],function(e,t,a,r,n,i,s,o){"use strict";const l={[e.EQ]:e.NE,[e.GE]:e.LT,[e.LT]:e.GE,[e.LE]:e.GT,[e.GT]:e.LE,[e.BT]:e.NB,[e.Contains]:e.NotContains,[e.StartsWith]:e.NotStartsWith,[e.EndsWith]:e.NotEndsWith};function u(e,t,a){var r=Object.create(null);var n=[];e.some(function(e){if(!e.sPath){var i=e.aFilters&&u(e.aFilters,t,e.bAnd);if(i){n.push(i)}else if(!a){n=[];r=Object.create(null);return true}return false}var s=r[e.sPath];if(s){s.push(e)}else{r[e.sPath]=[e]}});var i=a?"and":"or";for(var s in r){var o=r[s];n.push(t(s,o,o.length>1?i:""))}if(n.length===0){return null}if(n.length===1){return n[0]}var l=n.map(function(e){var t=e.logicalOperator&&e.logicalOperator!==i;return t?"("+e.stringRep+")":e.stringRep}).join("%20"+i+"%20");return{stringRep:l,logicalOperator:i}}function c(e,t){var a=u(e,t,true);return a?a.stringRep:""}function d(t,a){var r=t.conditionTypeInfo.data.operation;var n=t.conditionTypeInfo.data.value1;var i=t.conditionTypeInfo.data.value2;if(["TODAY","TOMORROW","YESTERDAY"].includes(r)&&a!=="Edm.DateTimeOffset"){return{oValue1:"{"+a+"%%DynamicDate."+r+"%%}",oValue2:null,operator:e.EQ}}else{var s=[r,n,i].filter(function(e){return e!==undefined&&e!==null}).join(".");return{oValue1:"{"+a+"%%DynamicDate."+s+".start%%}",oValue2:"{"+a+"%%DynamicDate."+s+".end%%}",operator:e.BT}}}function f(e,a,r){var n,s;r=r===undefined||r;if(e===null||e===undefined){return"null"}switch(a){case"Edm.String":e=r?e:e.toUpperCase();s="'"+String(e).replace(/'/g,"''")+"'";break;case"Edm.Time":if(typeof e==="object"){s=t.getTimeInstance({pattern:"'time''PT'HH'H'mm'M'ss'S'''",calendarType:i.Gregorian}).format(new Date(e.ms),true)}else{s="time'"+e+"'"}break;case"Edm.DateTime":n=e instanceof Date?e:new Date(e);if(n.getMilliseconds()>0){s=t.getDateInstance({pattern:"'datetime'''yyyy-MM-dd'T'HH:mm:ss.SSS''",calendarType:i.Gregorian}).format(n,true)}else{s=t.getDateInstance({pattern:"'datetime'''yyyy-MM-dd'T'HH:mm:ss''",calendarType:i.Gregorian}).format(n,true)}break;case"Edm.DateTimeOffset":n=e instanceof Date?e:new Date(e);s=t.getDateInstance({pattern:"'datetimeoffset'''yyyy-MM-dd'T'HH:mm:ss'Z'''",calendarType:i.Gregorian}).format(n,true);break;case"Edm.Guid":s="guid'"+e+"'";break;case"Edm.Decimal":s=e+"m";break;case"Edm.Int64":s=e+"l";break;case"Edm.Double":s=e+"d";break;case"Edm.Float":case"Edm.Single":s=e+"f";break;case"Edm.Binary":s="binary'"+e+"'";break;default:s=String(e);break}return s}function p(e,t,i,s){var o,l,u,c=n.getPropertyMetadata(e.oMetaModel,e.sEntityTypeName,t);var p=t.replaceAll("/",".");if((c.type==="Edm.DateTime"||c.type==="Edm.DateTimeOffset")&&!e.oFilterData[p]){e.bIsStatic=true;return{stringRep:"",logicalOperator:s}}var m=i.map(function(n){var i=true;var s=["DATE","DATERANGE","DATETIMERANGE","FROM","TO"];if(n.bCaseSensitive===undefined){i=true}if((c.type==="Edm.DateTime"||c.type==="Edm.DateTimeOffset")&&e.oFilterData[p].conditionTypeInfo&&!s.includes(e.oFilterData[p].conditionTypeInfo.data.operation)){if(!r.getAllOptionKeys().includes(e.oFilterData[p].conditionTypeInfo.data.operation)){e.bIsStatic=true;return}var m=d(e.oFilterData[p],c.type);o=m.oValue1;l=m.oValue2;u=m.operator}else{o=n.oValue1!=null?f(n.oValue1,c.type,i):null;l=n.oValue2!=null?f(n.oValue2,c.type,i):null;u=n.sOperator;if(o){o=a(String(o))}if(l){l=a(String(l))}}switch(u){case"EQ":case"NE":case"GT":case"GE":case"LT":case"LE":return t+"%20"+u.toLowerCase()+"%20"+o;case"BT":return"("+t+"%20ge%20"+o+"%20and%20"+t+"%20le%20"+l+")";case"NB":return"not%20("+t+"%20ge%20"+o+"%20and%20"+t+"%20le%20"+l+")";case"Contains":return"substringof("+o+","+t+")";case"NotContains":return"not%20substringof("+o+","+t+")";case"StartsWith":return"startswith("+t+","+o+")";case"NotStartsWith":return"not%20startswith("+t+","+o+")";case"EndsWith":return"endswith("+t+","+o+")";case"NotEndsWith":return"not%20endswith("+t+","+o+")";default:return""}}).join("%20"+s+"%20");return{stringRep:m,logicalOperator:s}}function m(e){var t=[];var a=[];e.forEach(e=>{if(e.aFilters){a.push(e)}else{t.push(e)}});if(t&&t.length){var r=t.reduce((e,t)=>{var a=t.sPath;if(!e[a]){e[a]=[]}e[a].push(t);return e},{});var n=Object.keys(r).map(e=>new o({filters:r[e],and:false}));t=new o({filters:n,and:true});a.push(t);return a}return e}function g(e,t,a,r){var n={oMetaModel:e,sEntityTypeName:t,oFilterData:r,bIsStatic:false};a=m(a);var i="$filter="+c(a,p.bind(null,n));i=n.bIsStatic?"":i;return i}function y(e){return l[e]||e}s.testableStatic(p,"filterHelper_getFilterInfoForPropertyFilters");s.testableStatic(c,"filterHelper_getFilterString");s.testableStatic(m,"filterHelper_fnNormaliseControlFilters");return{getFilterParams:g,fnNormaliseControlFilters:m,negateOperation:y}});
//# sourceMappingURL=filterHelper.js.map