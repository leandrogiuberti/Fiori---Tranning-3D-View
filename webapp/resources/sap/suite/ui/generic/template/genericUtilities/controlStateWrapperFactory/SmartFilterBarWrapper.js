sap.ui.define(["sap/ui/model/FilterOperator"],function(t){"use strict";var e="sap.suite.ui.generic.template.customData",a="sap.suite.ui.generic.template.extensionData",r="sap.suite.ui.generic.template.genericData";function i(i,n,s){var o=false;var u=[];var l=[];var c,g,f;var p=new Promise(function(t){g=t});function m(){if(typeof i!=="string"){C(i)}p.then(function(){c.getInitializedPromise().then(function(){u=c.getAllFilterItems(true)})})}function d(t){c.attachBeforeVariantFetch(function(){var e=Object.create(null);e[r]=t.getManagedControlStates();e[r].customFilters=s.oCustomFiltersWrapper.getState();c.setCustomFilterData(e)});c.attachAfterVariantLoad(function(i){var n=c.getCustomFilterData();var o=n[r].customFilters||{editState:n[r].editStateFilter,appExtension:n[e],adaptationExtensions:n[a]};s.oCustomFiltersWrapper.setState(o);t.setManagedControlStates(n[r]);t.setHeaderState(!i.getParameter("executeOnSelect"));l=S()})}function S(){const e=c.getModel().getMetaModel(),a=c.getEntitySet(),r=e.getODataEntitySet(a),i=e.getODataEntityType(r.entityType),n=i["navigationProperty"];const s=c.getVariantManagement().getCurrentVariantId(),o=c.getVariantManagement().getAllVariants().find(function(t){return t.getId()===s});if(!o||!o.getContent()||!o.getContent().searchListReportVariant||!o.getContent().searchListReportVariant.filterBarVariant||!n||!n.length){return[]}const u=c.getNavigationProperties()?c.getNavigationProperties().split(",").reduce(function(t,e){t[e]=true;return t},{}):{},l=n.reduce(function(t,e){t[e.name]=true;return t},{}),g=JSON.parse(o.getContent().searchListReportVariant.filterBarVariant),f=[];delete g["_CUSTOM"];for(const e in g){const a=e.split(".")[0];if(!l[a]||u[a]){continue}if(g[e].items&&g[e].items.length){f.push(g[e].items.map(function(a){return{exclude:false,field:e,operation:t.EQ,value1:a.key}}));continue}if(g[e].ranges&&g[e].ranges.length){f.push(g[e].ranges.map(function(t){return{exclude:t.exclude,field:t.keyField,operation:t.operation,value1:t.value1,value2:t.value2}}))}}return f}function F(){if(!c){return f}var t=c.getUiState();var e=t.getSelectionVariant().SelectOptions;e=e&&e.filter(function(t){return t.PropertyName!==r});return{selectOptions:e,parameters:t.getSelectionVariant().Parameters,semanticDates:t.getSemanticDates(),addedFilterItems:c.getAllFilterItems(true).filter(function(t){return t.getGroupName()!==sap.ui.comp.filterbar.FilterBar.INTERNAL_GROUP&&t.getVisibleInFilterBar()}).map(function(t){return t.getName()}),removedFilterItems:u.filter(function(t){return!t.getVisibleInFilterBar()}).map(function(t){return t.getName()}),customFilters:s.oCustomFiltersWrapper.getState()}}function V(t){if(JSON.stringify(t)===JSON.stringify(F())){return}o=true;f=t;p.then(function(){var t=c.getUiState(),e=c.getSmartVariant(),a=e.currentVariantGetModified();t.getSelectionVariant().SelectOptions=f&&f.selectOptions;t.getSelectionVariant().Parameters=f&&f.parameters;t.setSemanticDates(f&&f.semanticDates);c.setUiState(t,{replace:true,strictMode:true});s.oCustomFiltersWrapper.setState(f&&f.customFilters);c.getAllFilterItems().forEach(function(t){if(f&&f.addedFilterItems&&f.addedFilterItems.includes(t.getName())){t.setVisibleInFilterBar()}if(f&&f.removedFilterItems&&f.removedFilterItems.includes(t.getName())){t.setVisibleInFilterBar(false)}});e.currentVariantSetModified(a)});c.refreshFiltersCount();o=false}function h(t){function e(){if(!o){t()}}p.then(function(){c.attachFilterChange(function(){if(!c.isDialogOpen()){e()}});c.attachFiltersDialogClosed(e);s.oCustomFiltersWrapper.attachStateChanged(e)});c.attachFiltersDialogClosed(e);s.oCustomFiltersWrapper.attachStateChanged(function(){e();if(!o){c.getSmartVariant()&&c.getSmartVariant().currentVariantSetModified(true)}})}function C(t){c=t;g(c)}function v(){return l}m();return{getState:F,setState:V,setControl:C,attachStateChanged:h,setSVMWrapperCallbacks:d,bVMConnection:c.getSmartVariant(),suppressSelection:c.setSuppressSelection.bind(c),getMissingNavProperties:v}}return i});
//# sourceMappingURL=SmartFilterBarWrapper.js.map