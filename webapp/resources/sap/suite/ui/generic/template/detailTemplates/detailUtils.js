sap.ui.define(["sap/suite/ui/generic/template/genericUtilities/FeLogger","sap/ui/core/UIComponent","sap/ui/core/routing/HashChanger","sap/ui/model/Filter","sap/ui/model/FilterOperator","sap/suite/ui/generic/template/genericUtilities/controlHelper","sap/suite/ui/generic/template/extensionAPI/NavigationController","sap/suite/ui/generic/template/lib/MessageButtonHelper","sap/suite/ui/generic/template/genericUtilities/testableHelper","sap/suite/ui/generic/template/detailTemplates/DiscardEditHandler","sap/suite/ui/generic/template/detailTemplates/PaginatorButtonsHelper","sap/suite/ui/generic/template/ObjectPage/extensionAPI/DraftTransactionController","sap/suite/ui/generic/template/ObjectPage/extensionAPI/NonDraftTransactionController","sap/ui/core/message/MessageType","sap/m/DraftIndicator"],function(e,t,n,o,a,i,r,s,l,u,c,p,g,d){"use strict";var f=new e("detailTemplates.detailUtils").getLogger();var v=sap.m.DraftIndicatorState;var m=new o({path:"persistent",operator:a.EQ,value1:false});function C(e,t,n){function o(){var e=t.getTemplatePrivateModel();e.setProperty("/objectPage",{displayMode:0,headerInfo:{objectTitle:"",objectSubtitle:""},messageStripInfo:{messageText:"",messageType:d.None},cancelEnabled:true})}function a(o,a){if(!t.isDraftEnabled()){var i=e.getModel("ui");var r=t.getTemplatePrivateModel();var s=i.getProperty("/createMode");r.setProperty("/objectPage/displayMode",s?4:1)}(n.onComponentActivate||Function.prototype)(o,a)}function i(t){var o=e.getModel("_templPrivGlobal");o.setProperty("/generic/draftIndicatorState",v.Clear);(n.applyHeaderContextToSmartTablesDynamicColumnHide||Function.prototype)(t)}function r(){n.navigateUp()}function s(e){return n.getMessageFilters(e)}function l(e){return n.getScrollFunction&&n.getScrollFunction(e)}function u(){return{callAlways:true}}return{init:o,onActivate:a,getTitle:t.getTitle,updateBindingContext:i,navigateUp:r,getMessageFilters:s,getScrollFunction:l,getStatePreserverSettings:u}}function b(e,o,a){var d;var v;function C(){var e=t.getRouterFor(a);return e?e.getHashChanger():n.getInstance()}function b(e){var t=!o.oComponentUtils.isDraftEnabled();if(t||!e){var n=a.getView().getModel("ui");n.setProperty("/editable",e)}}function P(){o.oServices.oApplication.onBackButtonPressed()}function y(){var t=o.oServices.oApplication.getLinksToUpperLayers();var n=o.oComponentUtils.getViewLevel();var a;if(o.oComponentUtils.isDraftEnabled()){var i=o.oComponentUtils.getTemplatePrivateModel();a=i.getProperty("/objectPage/displayMode")}else{a=1}e.navigateUp=t[n-1].navigate.bind(null,a,false);var r=e.aBreadCrumbs;var s=r?r.length:0;for(var l=0;l<s;l++){var u=r[l];var c=t[l+1];c.adaptBreadCrumbLink(u);var p={id:u.getId(),navigate:c.navigate.bind(null,a,true)};o.oInfoObjectHandler.initializeLinkInfoObject(p)}}function T(){e.navigateUp()}function B(e){var t=o.oServices.oApplication.getBusyHelper();var n=a.getView().getModel("ui");var i=o.oServices.oApplicationController.synchronizeDraftAsync().then(function(){T()},function(){t.getUnbusy().then(function(e){o.oCommonUtils.processDataLossTechnicalErrorConfirmation(function(){T();n.setProperty("/enabled",true)},Function.prototype,d.state,"LeavePage")})});t.setBusy(i)}function S(e){var t=e.getSource();var n=o.oComponentUtils.getCRUDActionHandler();n.handleCRUDScenario(2,B.bind(null,t))}var M;function U(t,n){M=M||new u(a,o,e,d.state);return M.discardEdit(t,n)}function H(){var e=o.oServices.oApplication.getBusyHelper();if(e.isBusy()){return}d.state.messageButtonHelper.toggleMessagePopover()}function I(e){return d.state.messageButtonHelper&&d.state.messageButtonHelper.getMessageFilters(e)}function F(){var e;return function(){e=e||new r(o,a,d.state);return e}}function A(){var e;return function(){if(!e){var t=o.oComponentUtils.isDraftEnabled()?p:g;e=new t(o,a,d.state)}return e}}function j(e){v.handleShowNextObject(e)}function w(){v.switchToNextObject()}function x(e){v.handleShowPrevObject(e)}var C=l.testable(C,"getHashChangerInstance");var y=l.testable(y,"adaptLinksToUpperLevels");d={onInit:function(t,n){if(!t||t.footerBar){var r=o.oComponentUtils.isODataBased();d.state.messageButtonHelper=new s(o,n||{controller:a},r);if(!o.oComponentUtils.isDraftEnabled()){var l=a.getOwnerComponent().getModel("ui");var u=l.bindProperty("/editable");var p=sap.ui.getCore().getMessageManager();var g=p.getMessageModel();u.attachChange(function(){if(!u.getValue()){var e=d.state.messageButtonHelper.getContextFilter(false);var t=g.bindList("/",null,null,[e,m]);var n=t.getContexts();var o=n.map(function(e){return e.getObject()});p.removeMessages(o)}})}o.oServices.oTemplateCapabilities.oMessageButtonHelper=d.state.messageButtonHelper;d.state.onCancel=U}if(!t||t.paginatorButtons){v=new c(d,a,o,e)}e.getScrollFunction=function(t){var n=o.oCommonUtils.getPositionableControlId(t,true);if(n){return function(){(e.prepareForControlNavigation||Function.prototype)(n);i.focusControl(n)}}};o.oServices.oTemplateCapabilities.fnConstructTitleAdditionalInfo=h},handlers:{handleShowNextObject:j,handleShowPrevObject:x,onShowMessages:H,applyAndUp:S,onSave:function(){f.error("Save for this floorplan not implemented yet")},onBack:P},extensionAPI:{getNavigationControllerFunction:F,getTransactionControllerFunction:A},fclInfo:{isContainedInFCL:false},state:{},onComponentActivate:function(e,t){if(d.state.messageButtonHelper){d.state.messageButtonHelper.adaptToContext(e)}y();if(v){v.computeAndSetVisibleParamsForNavigationBtns()}},utils:{switchToNextObject:w}};e.navigateUp=T;e.setEditable=b;e.getMessageFilters=I;var D=o.oComponentUtils.getFclProxy();if(D.oActionButtonHandlers){d.handlers.fclActionButtonHandlers=D.oActionButtonHandlers;d.fclInfo.isContainedInFCL=true}return d}function h(e,t,n){let o,a,i;let r=t.componentRegistry[n.treeNode.componentId];let s=r.utils.getTemplatePrivateModel();o=s.getProperty("/objectPage/headerInfo/objectTitle");a=s.getProperty("/objectPage/headerInfo/objectSubtitle");let l=t.mRoutingTree[n.treeNode.parentRoute];let u=[];let c=" - ";while(l.level>0){u.push(l.text||l.headerTitle);l=t.mRoutingTree[l.parentRoute]}let p=u.join(" - ");a=a?"("+a+")":"";if(o&&!a){o+=c}if(a){a+=c}if(p&&e){p+=c}i=`${o} ${a} ${p} ${e}`;return{headerText:i}}return{getComponentBase:C,getControllerBase:b,fnConstructTitleAdditionalInfo:h}});
//# sourceMappingURL=detailUtils.js.map