sap.ui.define(["sap/base/util/deepExtend","sap/base/util/merge","sap/suite/ui/generic/template/designtime/controls/SmartTable.designtime","sap/suite/ui/generic/template/designtime/controls/DynamicPage.designtime","sap/suite/ui/generic/template/designtime/controls/SmartFilterBar.designtime","sap/suite/ui/generic/template/designtime/controls/ObjectPageLayout.designtime","sap/ui/core/Element"],function(e,t,r,i,n,a,s){"use strict";var o={};var g=[];var c;function u(){var e=[];function t(t){if(o[t.getId()]){return}var r={};o[t.getId()]=r;r.designTimePromise=t.getMetadata().loadDesignTime(t);e.push(r.designTimePromise);r.designTimePromise.then(function(e){r.designTime=e})}function r(e){return!e||!e.id||o[e.id]?e:e.parentNode&&r(e.parentNode)}document.querySelectorAll(".sapUiXMLView").forEach(function(e){var i=s.getElementById(e.id);if(!i||!(i instanceof sap.ui.core.mvc.XMLView)||!(i.getController()instanceof sap.suite.ui.generic.template.lib.TemplateViewController)){return}g.push(i);i.findAggregatedObjects(true).forEach(t);var n=function(e){e.forEach(function(e){if(e.type==="childList"&&e.addedNodes.length>0){e.addedNodes.forEach(function(e){var i=r(e);var n=i&&s.getElementById(i.id);if(n){n.findAggregatedObjects(true).forEach(t)}})}})};if(!c){c=c||new MutationObserver(n);var a={childList:true,subtree:true};c.observe(e,a)}});return Promise.all(e)}function l(){c&&c.disconnect()}function d(e){var t=[e];while(!(e instanceof sap.ui.core.mvc.XMLView)){e=e.getParent();if(!e){return}t.push(e)}if(!(e.getController()instanceof sap.suite.ui.generic.template.lib.TemplateViewController)){return}return t}function f(e,t){return t===e||t.findAggregatedObjects&&t.findAggregatedObjects(true).includes(e)}function m(e,t){var r=Object.keys(o[e.sAncestorId].designTime.aggregations);return r.find(function(r){var i=e.oAncestor.getMetadata().getAggregation(r);var n=i&&i.get(e.oAncestor)||e.oAncestor.getAggregation(r);if(Array.isArray(n)){return n.find(f.bind(null,t))}else{return n&&f(t,n)}})}function p(r){if(r instanceof sap.ui.core.mvc.XMLView){return}var i=o[r.getId()];if(!i||i.designTimePromise&&!i.designTime){return}var n=e({},i.designTime);var a=d(r);if(!a){return}a.shift();a.pop();var s=a.map(function(e){return{oAncestor:e,sAncestorId:e.getId()}});s=s.filter(function(e){return o[e.sAncestorId]&&o[e.sAncestorId].designTime&&o[e.sAncestorId].designTime.aggregations});s.forEach(function(e){e.sAggregation=m(e,r)});i.pedigree=s.filter(function(e){return o[e.sAncestorId]&&o[e.sAncestorId].designTime.aggregations&&o[e.sAncestorId].designTime.aggregations[e.sAggregation]&&o[e.sAncestorId].designTime.aggregations[e.sAggregation].propagateMetadata});n=i.pedigree.reduce(function(e,i){return t(e,o[i.sAncestorId].designTime.aggregations[i.sAggregation].propagateMetadata(r,i.oAncestor))},n);return n}function A(e,t){var r=p(e);if(!r){return}var i=Object.create(null);if(r.actions&&typeof r.actions==="object"){i.actions=Object.create(null);for(var n in r.actions){i.actions[n]=t&&t.actions&&t.actions.includes(n)?r.actions[n]:null}}else{i.actions=r.actions}i.aggregations=Object.create(null);for(var a in r.aggregations){i.aggregations[a]={actions:Object.create(null)};for(var n in r.aggregations[a].actions){i.aggregations[a].actions[n]=t&&t.aggregations&&t.aggregations[a]&&t.aggregations[a].actions&&t.aggregations[a].actions.includes(n)?r.aggregations[a].actions[n]:null}}i.properties=Object.create(null);for(var s in e.getMetadata().getAllProperties()){i.properties[s]={ignore:!t||!t.properties||!t.properties.includes(s)||r.properties&&r.properties[s]&&r.properties[s].ignore}}return i}function b(e){return u().then(function(){var s={aggregations:{content:{propagateMetadata:function(s){if(!s.getMetadata().getElementName){return null}var o=s.getMetadata().getElementName();var g=A(s,e[o]);var c={};switch(o){case"sap.uxap.ObjectPageLayout":c=a.getDesigntime(s);break;case"sap.ui.comp.smartfilterbar.SmartFilterBar":case"sap.suite.ui.generic.template.AnalyticalListPage.control.SmartFilterBarExt":case"sap.suite.ui.generic.template.AnalyticalListPage.control.visualfilterbar.SmartVisualFilterBar":c=n.getDesigntime(s);break;case"sap.ui.comp.smarttable.SmartTable":case"sap.ui.table.Table":case"sap.m.Table":case"sap.ui.table.AnalyticalTable":c=r.getDesigntime(s);break;case"sap.f.DynamicPage":c=i.getDesigntime(s);break;default:break}return t(g,c)}}}};return g.reduce(function(r,i){return t(A(i,e[i.getMetadata().getElementName()]),r)},s)})}function v(e){return e.reduce(function(e,t){if(!t){return e}if(!e){return t}if(Array.isArray(t)!==Array.isArray(e)){return true}if(Array.isArray(e)){return e.concat(t)}else{for(var r in t){e[r]=v([e[r],t[r]])}return e}})}return{getMergedAllowList:v,getViewDesignTime:b,stopMutationObserver:l}});
//# sourceMappingURL=designtimeHelper.js.map