<core:FragmentDefinition xmlns="sap.m" xmlns:core="sap.ui.core" xmlns:table="sap.ui.table" xmlns:smartField="sap.ui.comp.smartfield" xmlns:smartMultiInput="sap.ui.comp.smartmultiinput" xmlns:fe="sap.suite.ui.generic.template.genericUtilities"
	xmlns:customData="http://schemas.sap.com/sapui5/extension/sap.ui.core.CustomData/1"
	xmlns:template="http://schemas.sap.com/sapui5/extension/sap.ui.core.template/1"
	template:require="{AH: 'sap/suite/ui/generic/template/js/AnnotationHelper', AHModel: 'sap/ui/model/odata/AnnotationHelper', StableIdHelper: 'sap/suite/ui/generic/template/js/StableIdHelper'}">

    <template:repeat list="{collection>}" var="dataField">
		<template:if test="{= (${dataField>RecordType} === 'com.sap.vocabularies.UI.v1.DataField')}">
			<template:with path="dataField>Value" helper="AHModel.resolvePath" var="dataFieldValue">
				<template:if test="{parts: [{path: 'listEntitySet>'}, {path: 'dataField>'}], formatter: 'AH.checkMultiplicityForDataFieldAssociation'}">
					<table:Column id="{:= ${parameter>/stableId}.getStableId({type: 'TableColumn', subType: 'DataField', sSmartTableId: ${smartControlId>id}, sProperty: ${dataField>Value/Path}})}"
							width="{parts: [{path: 'dataFieldValue>'}, {path: 'dataField>'}, {path: 'listEntitySet>'}, {value: ''}, {value: ''}, {path: 'tableSettings>calculateWidthIncludingColumnHeader'}], formatter: 'AH.getDefaultWidthForTableColumn'}">
						<table:customData>
							<core:CustomData key="p13nData" value="{parts: [{path: 'listEntitySet>'}, {path: 'dataFieldValue>'}, {path: 'dataField>'}, {path: 'tableSettings>calculateWidthIncludingColumnHeader'}], formatter: 'AH.createP13N'}" />
						</table:customData>
						<template:if test="{dataField>Label}">
							<template:then>
								<Text text="{path: 'dataField>Label', formatter: 'AHModel.format'}" />
							</template:then>
							<template:else>
								<Text text="{path: 'dataFieldValue>com.sap.vocabularies.Common.v1.Label', formatter: 'AHModel.format'}"/>
							</template:else>
						</template:if>	
						<table:template>
							<smartMultiInput:SmartMultiInput visible="true" editable="{tableobserver>/editable}"
								enableODataSelect="true"
								clientSideMandatoryCheck="false"
								tokenUpdate="._templateEventHandlers.submitChangesForSmartMultiInput"
								selectionFinish="._templateEventHandlers.submitChangesForSmartMultiInput"
								value="{path:'dataField>Value',formatter:'AHModel.simplePath'}"
								modeToggled="._templateEventHandlers.onSmartFieldModeToggled($event, '{listEntitySet>name}')"
								textLabel="{path: 'dataField>', formatter: 'AH.getDataFieldLabel'}"
								fetchValueListReadOnly="false"/>
						</table:template>
					</table:Column>
				</template:if>
			</template:with>
		</template:if>		
		<template:if test="{= (${dataField>RecordType} === 'com.sap.vocabularies.UI.v1.DataFieldForAction' || ${dataField>RecordType} === 'com.sap.vocabularies.UI.v1.DataFieldForIntentBasedNavigation') &amp;&amp; ${dataField>Inline/Bool} === 'true'}">
			<template:with path="parameter>/" helper="StableIdHelper.preparePathForStableId" var="columnId">
				<template:if test="{= ${dataField>RecordType} === 'com.sap.vocabularies.UI.v1.DataFieldForAction' }">
					<template:then>
						<template:if test="{= ${columnId>}.buildStableId({type: 'TableColumn', subType: 'DataFieldForAction', sSmartTableId: ${smartControlId>id}, sAction: ${dataField>Action/String}})}" />
					</template:then>
					<template:else>
						<template:if test="{= ${columnId>}.buildStableId({type: 'TableColumn', subType: 'DataFieldForIntentBasedNavigation', sSmartTableId: ${smartControlId>id}, sSemanticObject: ${dataField>SemanticObject/String}, sAction: ${dataField>Action/String}})}" />
					</template:else>
				</template:if>
				<template:with path="dataField>Value" helper="AHModel.resolvePath" var="dataFieldValue">
					<table:Column 
							id="{columnId>id}"
							sortProperty="{parts: [{path: 'dataField>'}, {path: 'listEntitySet>'}], formatter: 'AH.getSortProperty'}" 
							filterProperty="{parts: [{path: 'dataField>'}, {path: 'listEntitySet>'}], formatter: 'AH.getFilterProperty'}"
							showFilterMenuEntry="{= (${parameter>/settings/smartVariantManagement} &amp;&amp; !${parameter>/settings/enableTableFilterInPageVariant} &amp;&amp; !${parameter>/settings/isWorklist}) ? 'false' : 'true'}"
							customData:p13nData="{parts: [{path: 'dataField>'}, {path: 'tableSettings>calculateWidthIncludingColumnHeader'}], formatter: 'AH.createP13NColumnForAction'}"
							width="{parts: [{path: 'dataFieldValue>'}, {path: 'dataField>'}, {path: 'listEntitySet>'}, {value: ''}, {path: 'appSettings>/enableAutoColumnWidthForSmartTable'}, {path: 'tableSettings>calculateWidthIncludingColumnHeader'}], formatter: 'AH.getDefaultWidthForTableColumn'}"
							hAlign="Center">
						<template:if test="{dataField>Label}">
							<template:then>
								<core:InvisibleText text="{path: 'dataField>Label', formatter: 'AHModel.format'}" />
							</template:then>
							<template:else>
								<core:InvisibleText text="{path: 'dataFieldValue>com.sap.vocabularies.Common.v1.Label', formatter: 'AHModel.format'}" />
							</template:else>
						</template:if>
						<table:template>
							<core:Fragment fragmentName="sap.suite.ui.generic.template.fragments.InlineButton" type="XML" />
						</table:template>
					</table:Column>
				</template:with>
			</template:with>
	 	</template:if>
		<!-- Implementation DataFieldWithIntentBasedNavigation: Begin -->
		<template:if test="{= (${dataField>RecordType} === 'com.sap.vocabularies.UI.v1.DataFieldWithIntentBasedNavigation')}">
			<template:then>
				<template:with path="dataField>Value" helper="AHModel.resolvePath" var="dataFieldValue">
					<table:Column 
						id="{:= ${parameter>/stableId}.getStableId({type: 'TableColumn', subType: 'DataFieldWithIntentBasedNavigation', sSmartTableId: ${smartControlId>id}, sProperty: ${dataField>Value/Path}, sSemanticObject: ${dataField>SemanticObject/String}, sAction: ${dataField>Action/String}})}"
						sortProperty="{parts: [{path: 'dataField>'}, {path: 'listEntitySet>'}], formatter: 'AH.getSortProperty'}" 
						filterProperty="{parts: [{path: 'dataField>'}, {path: 'listEntitySet>'}], formatter: 'AH.getFilterProperty'}"
						showFilterMenuEntry="{= (${parameter>/settings/smartVariantManagement} &amp;&amp; !${parameter>/settings/enableTableFilterInPageVariant} &amp;&amp; !${parameter>/settings/isWorklist}) ? 'false' : 'true'}"
						width="{parts: [{path: 'dataFieldValue>'}, {path: 'dataField>'}, {path: 'listEntitySet>'}, {value: ''}, {value: ''}, {path: 'tableSettings>calculateWidthIncludingColumnHeader'}], formatter: 'AH.getDefaultWidthForTableColumn'}"
						customData:p13nData="{parts: [{path: 'dataField>'}, {path: 'tableSettings>calculateWidthIncludingColumnHeader'}], formatter: 'AH.createP13NColumnForAction'}">
						<Text
							text="{parts: [{path: 'dataField>'}, {path: 'listEntitySet>'}], formatter: 'AH.getLabelForDFwithIBN'}" />
						<table:template>
							<fe:Link
								text="{parts: [{path: 'dataField>'}, {path: 'listEntitySet>'}], formatter: 'AH.getLinkTextForDFwithIBN'}"
								press="._templateEventHandlers.onDataFieldWithIntentBasedNavigation"
								accessibleRole="Button"
								wrapping="false">
								<fe:customData>
									<core:CustomData key="SemanticObject" value="{path: 'dataField>SemanticObject', formatter: 'AHModel.format'}" />
									<core:CustomData key="Action" value="{path: 'dataField>Action', formatter: 'AHModel.format'}" />
								</fe:customData>
							</fe:Link>
						</table:template>
					</table:Column>
				</template:with>
			</template:then>
		</template:if>
		<!-- Implementation DataFieldWithIntentBasedNavigation: End -->
		<!--Not required in ALP -->
		<template:if test="{parameter>/templateSpecific/isSelflinkRequired}">
			<!-- ObjectPage Self-Linking -->
			<template:if test="{= ${dataField>RecordType} === 'com.sap.vocabularies.UI.v1.DataFieldWithNavigationPath' }">
				<template:then>
					<template:with path="dataField>Value" helper="AHModel.resolvePath" var="dataFieldValue">
						<table:Column 
							id="{:= ${parameter>/stableId}.getStableId({type: 'TableColumn', subType: 'DataFieldWithNavigationPath', sSmartTableId: ${smartControlId>id}, sProperty: ${dataField>Value/Path}, sTarget: ${dataField>Target/NavigationPropertyPath}})}"
							sortProperty="{parts: [{path: 'dataField>'}, {path: 'listEntitySet>'}], formatter: 'AH.getSortProperty'}" 
							filterProperty="{parts: [{path: 'dataField>'}, {path: 'listEntitySet>'}], formatter: 'AH.getFilterProperty'}"
							showFilterMenuEntry="{= (${parameter>/settings/smartVariantManagement} &amp;&amp; !${parameter>/settings/enableTableFilterInPageVariant} &amp;&amp; !${parameter>/settings/isWorklist}) ? 'false' : 'true'}"
							width="{parts: [{path: 'dataFieldValue>'}, {path: 'dataField>'}, {path: 'listEntitySet>'}, {value: ''}, {value: ''}, {path: 'tableSettings>calculateWidthIncludingColumnHeader'}], formatter: 'AH.getDefaultWidthForTableColumn'}"
							customData:p13nData="{parts: [{path: 'dataField>'}, {path: 'tableSettings>calculateWidthIncludingColumnHeader'}], formatter: 'AH.createP13NColumnForAction'}">
							<Text
								text="{parts: [{path: 'dataField>'}, {path: 'listEntitySet>'}], formatter: 'AH.getLabelForDFwithIBN'}" />
							<table:template>
								<smartField:SmartField
									value="{path: 'dataField>Value', formatter: 'AH.getDataFieldValueSimplePath'}"
									editable="{ui>/editable}" linkPress="._templateEventHandlers.onDataFieldWithNavigationPath">
									<smartField:customData>
										<core:CustomData key="Target" value="{dataField>Target/NavigationPropertyPath}" />
									</smartField:customData>
									<smartField:configuration>
										<smartField:Configuration
											displayBehaviour="{parts: [{path: 'dataField>'}, {path: 'listEntitySet>'}], formatter: 'AH.getTextArrangementForSmartControl'}" />
									</smartField:configuration>
								</smartField:SmartField>
							</table:template>
						</table:Column>
					</template:with>
				</template:then>
			</template:if>
		</template:if>
		<template:if test="{= ${dataField>RecordType} === 'com.sap.vocabularies.UI.v1.DataFieldForAnnotation'}">
			<template:then>
				<template:with path="dataField>Target" helper="AHModel.resolvePath" var="dataFieldTarget">
					<!--	Implementation ContactPopUpOver:Begins	 -->
					<template:if test="{= ${dataField>Target/AnnotationPath}.indexOf('com.sap.vocabularies.Communication.v1.Contact') >= 0}">
						<template:then>
							<table:Column
									id="{:= ${parameter>/stableId}.getStableId({type: 'TableColumn', subType: 'DataFieldForAnnotation', sSmartTableId: ${smartControlId>id}, sTarget: ${dataField>Target/AnnotationPath}})}"
									sortProperty="{parts: [{path: 'dataField>'}, {path: 'listEntitySet>'}, {path: 'dataFieldTarget>'}, {path: 'dataField>Target/AnnotationPath'}], formatter: 'AH.getSortProperty'}"
									filterProperty="{parts: [{path: 'dataField>'}, {path: 'listEntitySet>'}, {path: 'dataFieldTarget>'}, {path: 'dataField>Target/AnnotationPath'}], formatter: 'AH.getFilterProperty'}"
									showFilterMenuEntry="{= (${parameter>/settings/smartVariantManagement} &amp;&amp; !${parameter>/settings/enableTableFilterInPageVariant} &amp;&amp; !${parameter>/settings/isWorklist}) ? 'false' : 'true'}"
									width="{parts: [{path: 'dataFieldTarget>'}, {path: 'dataField>'}, {path: 'listEntitySet>'}, {path: 'dataField>Target/AnnotationPath'}, {value: ''}, {path: 'tableSettings>calculateWidthIncludingColumnHeader'}], formatter: 'AH.getDefaultWidthForTableColumn'}"
									customData:p13nData="{parts: [{path: 'listEntitySet>'}, {path: 'dataField>'}, {path: 'dataFieldTarget>'}, {path: 'dataField>Target/AnnotationPath'}, {path: 'tableSettings>calculateWidthIncludingColumnHeader'}], formatter: 'AH.createP13NColumnForContactPopUp'}">
								<template:if test="{dataField>Label}">
									<template:then>
										<Text
											text="{path: 'dataField>Label', formatter: 'AHModel.format'}"/>
									</template:then>
								</template:if>
								<table:template>
									<template:if test="{= ${dataField>Target/AnnotationPath}.indexOf('com.sap.vocabularies.Communication.v1.Contact') >= 0}">
										<template:with path="dataField>Target" helper="AHModel.resolvePath" var="contact">
												<VBox>
													<fe:Link binding="{= ${ path: 'dataField>Target/AnnotationPath'}.indexOf('/') > -1 ? '{' + ${path: 'dataField>Target/AnnotationPath'}.slice(0, ${ path: 'dataField>Target/AnnotationPath'}.indexOf('/')) + '}' : null}"
															text="{path: 'contact>fn', formatter: 'AHModel.format'}"
															press="._templateEventHandlers.onContactDetails">
														<fe:customData>
															<core:CustomData key="Location" value="SmartTable"/>
															<core:CustomData key="contactDetails" value="{= ${path: 'contact>', formatter: 'AH.getCustomDataForContactPopup'}}"/>
														</fe:customData>
													</fe:Link>
												</VBox>
											</template:with>
									</template:if>
								</table:template>
							</table:Column>
						</template:then>
					</template:if>
					<!--	Implementation ContactPopUpOver:Ends	 -->
					<!-- Not Supported in ALP -->
					<template:if test="{= ${parameter>/templateSpecific/isIndicatorRequired}}">
						<!--	Implementation Progress and Rating Indicator:Begins	 -->
						<template:if test="{= ${dataFieldTarget>Visualization}}">
							<template:then>
								<template:with path="dataField>Value" helper="AHModel.resolvePath" var="dataFieldValue"> <!-- only needed to pass to p13n to be able to switch to old implementation (DataFieldForAnnotation does not contain Value) -->
									<template:with path="dataFieldTarget>Value" helper="AHModel.resolvePath" var="dataFieldTargetValue">
										<table:Column
												id="{:= ${parameter>/stableId}.getStableId({type: 'TableColumn', subType: 'DataFieldForAnnotation', sSmartTableId: ${smartControlId>id}, sTarget: ${dataField>Target/AnnotationPath}})}"
												sortProperty="{parts: [{path: 'dataField>'}, {path: 'listEntitySet>'}, {path: 'dataFieldTarget>'}, {path: 'dataField>Target/AnnotationPath'}], formatter: 'AH.getSortProperty'}"
												filterProperty="{parts: [{path: 'dataField>'}, {path: 'listEntitySet>'}, {path: 'dataFieldTarget>'}, {path: 'dataField>Target/AnnotationPath'}], formatter: 'AH.getFilterProperty'}"
												showFilterMenuEntry="{= (${parameter>/settings/smartVariantManagement} &amp;&amp; !${parameter>/settings/enableTableFilterInPageVariant} &amp;&amp; !${parameter>/settings/isWorklist}) ? 'false' : 'true'}"
												width="{parts: [{path: 'dataFieldTarget>'}, {path: 'dataField>'}, {path: 'listEntitySet>'}, {path: 'dataField>Target/AnnotationPath'}, {value: ''}, {path: 'tableSettings>calculateWidthIncludingColumnHeader'}], formatter: 'AH.getDefaultWidthForTableColumn'}"
												customData:p13nData="{parts: [{path: 'listEntitySet>'}, {path: 'dataField>'}, {path: 'dataFieldTarget>'}, {path: 'dataFieldTargetValue>'}, {path: 'dataField>Target/AnnotationPath'}, {path: 'tableSettings>calculateWidthIncludingColumnHeader'}], formatter: 'AH.createP13NColumnForIndicator'}" >
											<template:if test="{dataField>Label}">
												<template:then>
													<Text
															text="{path: 'dataField>Label', formatter: 'AHModel.format'}"
															visible="true" />
												</template:then>
												<template:elseif test="{dataFieldTarget>Title}">
													<Text
															text="{path: 'dataFieldTarget>Title', formatter: 'AHModel.format'}" />
												</template:elseif>
												<template:elseif
														test="{dataFieldTargetValue>com.sap.vocabularies.Common.v1.Label}">
													<Text
															text="{path: 'dataFieldTargetValue>com.sap.vocabularies.Common.v1.Label', formatter: 'AHModel.format'}" />
												</template:elseif>
											</template:if>
											<table:template>
												<!--	Rating Indicator generation	 -->
												<template:if test="{= ${dataFieldTarget>Visualization/EnumMember} === 'com.sap.vocabularies.UI.v1.VisualizationType/Rating'}">
													<template:then>
														<template:with path="dataFieldTarget>Value" helper="AHModel.resolvePath" var="value">
															<!--Due to SideEffect issues the RatingIndicator is not	editable -->
															<RatingIndicator enabled="true" editable="false" maxValue="{path: 'dataFieldTarget>TargetValue', formatter: 'AHModel.format'}"
																binding="{= ${ path: 'dataField>Target/AnnotationPath'}.indexOf('/') > -1 ? '{' + ${path: 'dataField>Target/AnnotationPath'}.slice(0, ${ path: 'dataField>Target/AnnotationPath'}.indexOf('/')) + '}' : null}"
																value="{path: 'dataFieldTarget>Value', formatter: 'AHModel.format'}" />
														</template:with>
													</template:then>
													<!--	Progress Indicator generation	 -->
													<template:elseif test="{= ${dataFieldTarget>Visualization/EnumMember} === 'com.sap.vocabularies.UI.v1.VisualizationType/Progress'}">
														<template:with path="dataFieldTarget>Value" helper="AHModel.resolvePath" var="value">
																<!-- The formatter 'RuntimeFormatters.formatDisplayValueForProgressIndicator' is used by 'AH.buildExpressionForProgressIndicatorDisplayValue' -->
																<ProgressIndicator
																		core:require="{RuntimeFormatters: 'sap/suite/ui/generic/template/js/RuntimeFormatters'}"
																		binding="{= ${ path: 'dataField>Target/AnnotationPath'}.indexOf('/') > -1 ? '{' + ${path: 'dataField>Target/AnnotationPath'}.slice(0, ${ path: 'dataField>Target/AnnotationPath'}.indexOf('/')) + '}' : null}"
																		percentValue="{ parts: [{path:'dataFieldTarget>'}, {path:'value>'}], formatter: 'AH.buildExpressionForProgressIndicatorPercentValue' }"
																		displayValue="{ parts: [{path:'dataFieldTarget>'}, {path:'value>Org.OData.Measures.V1.Unit'}], formatter: 'AH.buildExpressionForProgressIndicatorDisplayValue'}"
																		state="{path:'dataFieldTarget>', formatter: 'AH.buildExpressionForProgressIndicatorCriticality'}">
																	<customData>
																		<core:CustomData key="Target" value="{= ${path: 'dataFieldTarget>TargetValue', formatter: 'AHModel.format'} }" />
																		<core:CustomData key="UoM" value="{= ${path: 'value>Org.OData.Measures.V1.Unit', formatter: 'AHModel.format'} }" />
																	</customData>
																</ProgressIndicator>
														</template:with>
													</template:elseif>
												</template:if>
											</table:template>
										</table:Column>
									</template:with>
								</template:with>
							</template:then>
						</template:if>
						<!--	Implementation Progress and Rating Indicator:Ends	 -->
					</template:if>
				</template:with>
			</template:then>
		</template:if>
	</template:repeat>
	<template:if test="{= ${parameter>/isDraftEnabled} &amp;&amp; ${targetColumn>}}">
		<table:Column
			id="{:= ${parameter>/stableId}.getStableId({type: 'TableColumn', subType: 'DraftObject',  sSmartTableId: ${smartControlId>id}})}"
			customData:p13nData="{parts: [{path: 'tableAnnotationPath>'}], formatter: 'AH.createP13NForDraftObject'}">
			<core:InvisibleText text="{i18n>EDITING_STATUS}"/>
			<table:template>
				<core:Fragment fragmentName="sap.suite.ui.generic.template.ListReport.view.fragments.DraftInfoBoxForUITable" type="XML"/>
			</table:template>
		</table:Column>
	</template:if>
</core:FragmentDefinition>
