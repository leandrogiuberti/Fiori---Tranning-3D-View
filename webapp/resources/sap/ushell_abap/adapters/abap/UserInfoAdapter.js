// Copyright (c) 2009-2025 SAP SE, All Rights Reserved
sap.ui.define(["sap/ushell_abap/pbServices/ui2/ODataWrapper","sap/ui/thirdparty/datajs","sap/ui/thirdparty/jquery","sap/ui/VersionInfo","sap/base/Log","sap/ushell/resources","sap/base/i18n/date/CalendarWeekNumbering","sap/ushell/utils/LaunchpadError"],(e,t,jQuery,r,a,s,n,i)=>{"use strict";let o;const p="default";return function(){this._updateODataObjectBasedOnDatatype=function(e,t){if(typeof e==="string"){t.value=e.toString();t.dataType="Edm.String"}if(typeof e==="boolean"){t.value=e.toString();t.dataType="Edm.Boolean"}return t};this._getThemeList=async function(){let e="/sap/bc/rest/themes";const t=window["sap-ushell-config"]?.startupConfig?.client;if(t){e+=`/~client-${t}`}const a=`${e}/themeroot/v1`;e+="/themelist/v1";const s=await r.load();const n=s.version;if(n){e+=`/~v=UI5:${n}`}e+="?filter-types=STANDARD,SET";const i=await fetch(e);if(!i.ok){throw new Error(`List API failed with status: ${i.status}`)}const o=await i.json();const p=[];const u=[];o.forEach(e=>{if(e?.type==="STANDARD"){e.name=e.label;p.push(e)}else if(e?.type==="SET"){u.push(e)}});return{themes:p,sets:u,themeRoot:a}};this.getThemeList=function(){const e=new jQuery.Deferred;this._getThemeList().then(t=>{e.resolve({options:t.themes,sets:t.sets,themeRoot:t.themeRoot})}).catch(r=>{a.error(r.message,r,"sap.ushell_abap.adapters.abap.UserInfoAdapter");t.read({requestUri:"/sap/opu/odata/UI2/INTEROP/Themes"},t=>{e.resolve({options:t?.results||[]})},t=>{a.error(t.message,null,"sap.ushell_abap.adapters.abap.UserInfoAdapter");const r=new i(`Failed to fetch data: ${t.message}`,{dataJsError:t});e.reject(r)})});return e.promise()};this.getCalendarWeekNumberingList=function(){return[{value:n.Default,title:s.i18n.getText("DefaultWeekNumberingTitle"),description:s.i18n.getText("DefaultWeekNumberingText")},{value:n.ISO_8601,title:s.i18n.getText("ISO_8601WeekNumberingTitle"),description:s.i18n.getText("ISO_8601WeekNumberingText")},{value:n.MiddleEastern,title:s.i18n.getText("MiddleEasternWeekNumberingTitle"),description:s.i18n.getText("MiddleEasternWeekNumberingText")},{value:n.WesternTraditional,title:s.i18n.getText("WesternTraditionalWeekNumberingTitle"),description:s.i18n.getText("WesternTraditionalWeekNumberingText")}]};this.getLanguageList=function(){const e=new jQuery.Deferred;const r=encodeURI("/sap/opu/odata/UI2/INTEROP/UserProfilePropertyValues?$filter=id eq 'PREFERRED_LOGON_LANGUAGE'");t.read({requestUri:r},t=>{let r=[{text:s.i18n.getText("userSettings.browserLanguage"),key:p}];const a=t.results.map(e=>({text:e.description,key:e.value})).sort((e,t)=>e.text.localeCompare(t.text));r=r.concat(a);e.resolve(r)},t=>{a.error(t.message,null,"sap.ushell_abap.adapters.abap.UserInfoAdapter");const r=new i(`Failed to fetch data: ${t.message}`,{dataJsError:t});e.reject(r)});return e.promise()};this.getUserProfilePropertyValueLists=function(){const e=new jQuery.Deferred;let t;const r={};const s=["NUMBER_FORMAT","TIME_ZONE","TIME_FORMAT","DATE_FORMAT","CALENDAR_WEEK_NUMBERING"];const n=this._createWrapper("/sap/opu/odata/UI2/INTEROP/");n.openBatchQueue();let i;for(let e=0;e<s.length;e++){i=s[e];t=encodeURI(`UserProfilePropertyValues?$filter=id eq '${i}'&$select=description,value`);n.read(t,function(e){r[this]=e.results}.bind(i),e=>{a.error(e,null,"sap.ushell_abap.adapters.abap.UserInfoAdapter")})}n.submitBatchQueue(()=>{e.resolve(r)},t=>{a.error(t,null,"sap.ushell_abap.adapters.abap.UserInfoAdapter");e.reject(new Error(t))});return e.promise()};this._createWrapper=function(t){return e.createODataWrapper(t,false,e=>{})};this.updateUserPreferences=function(e){a.debug("[000] updateUserPreferences","UserInfoAdapter");const t=this;let r;let s;let n;const i=new jQuery.Deferred;function u(){s-=1;if(s===0){i.resolve()}}function l(e,t){i.reject(new Error(e),t)}a.debug("[000] updateUserPreferences: _createWrapper","UserInfoAdapter");o=this._createWrapper("/sap/opu/odata/UI2/INTEROP/");a.debug("[000] updateUserPreferences: oDataWrapper.openBatchQueue","UserInfoAdapter");o.openBatchQueue();const d=e.getChangedProperties()||[];a.debug("[000] updateUserPreferences: getChangedProperties","UserInfoAdapter");s=d.length;d.forEach(e=>{let s=e.name;let i=e.newValue;if(s.toUpperCase()==="LANGUAGE"){s="PREFERRED_LOGON_LANGUAGE";i=i===p?undefined:i}r=`UserProfileProperties(${[`id='${s}'`,"shellType='FLP')"].join(",")}`;n={id:s,shellType:"FLP",value:i};t._updateODataObjectBasedOnDatatype(i,n);a.debug("[000] updateUserPreferences: oDataWrapper: put","UserInfoAdapter");o.put(r,n,u,l)});a.debug("[000] updateUserPreferences: submitBatchQueue","UserInfoAdapter");o.submitBatchQueue(()=>{if(s===0){i.resolve()}},l);return i.promise()}}});
//# sourceMappingURL=UserInfoAdapter.js.map