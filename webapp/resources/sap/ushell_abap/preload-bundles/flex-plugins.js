//@ui5-bundle sap/ushell_abap/preload-bundles/flex-plugins.js
/* !
 * Copyright (c) 2009-2025 SAP SE, All Rights Reserved
 */
sap.ui.predefine("sap/ushell/appRuntime/ui5/plugins/baseRta/AppLifeCycleUtils", [],()=>{"use strict";const e={getAppLifeCycleService:function(){const t=e.getContainer();return t.getServiceAsync("AppLifeCycle").catch(e=>{const t=`Error getting AppLifeCycle service from ushell container: ${e}`;throw new Error(t)})},getContainer:function(){const e=sap.ui.require("sap/ushell/Container");if(!e){throw new Error("Illegal state: shell container not available; this component must be executed in a unified shell runtime context.")}return e},getCurrentRunningApplication:function(){return e.getAppLifeCycleService().then(e=>e.getCurrentApplication())}};return e});
/* !
 * Copyright (c) 2009-2025 SAP SE, All Rights Reserved
 */
sap.ui.predefine("sap/ushell/appRuntime/ui5/plugins/baseRta/BaseRTAPluginStatus", [],()=>{"use strict";return{STATUS_STARTING:"starting",STATUS_STARTED:"started",STATUS_STOPPING:"stopping",STATUS_STOPPED:"stopped"}},true);
/* !
 * Copyright (c) 2009-2025 SAP SE, All Rights Reserved
 */
sap.ui.predefine("sap/ushell/appRuntime/ui5/plugins/baseRta/CheckConditions", ["sap/ui/core/Lib","sap/ui/Device","sap/ushell/appRuntime/ui5/plugins/baseRta/AppLifeCycleUtils"],(e,t,n)=>{"use strict";const i={_getAppDescriptor:function(e){if(e&&e.getMetadata){const t=e.getMetadata();if(t&&t.getManifest){return t.getManifest()}}return{}},checkRestartRTA:function(e){const t=new URLSearchParams(window.location.search);const n=t.get("sap-ui-layer");e=n||e;return!!window.sessionStorage.getItem(`sap.ui.rta.restart.${e}`)},checkRtaPrerequisites:async function(){await e.load("sap/ui/fl");const{promise:t,resolve:n,reject:i}=Promise.withResolvers();sap.ui.require(["sap/ui/fl/initial/api/InitialFlexAPI"],(...e)=>{n(e)},i);const[s]=await t;const a=await Promise.all([this.checkUI5App(),s.isKeyUser(),this.checkDesktopDevice()]);return a.every(e=>e)},checkUI5App:async function(){const e=await n.getCurrentRunningApplication();if(e){const t=e.applicationType==="UI5";if(t&&e.componentInstance&&e.componentInstance.getManifestEntry){const t=e.componentInstance.getManifestEntry("sap.app").type==="application";const n=e.componentInstance.getManifestEntry("sap.ui5")?.flexEnabled===false;return t&&!n}}return false},checkDesktopDevice:function(){return t.system.desktop}};return i},true);
/* !
 * Copyright (c) 2009-2025 SAP SE, All Rights Reserved
 */
sap.ui.predefine("sap/ushell/appRuntime/ui5/plugins/baseRta/Renderer", ["sap/base/Log","sap/ushell/appRuntime/ui5/plugins/baseRta/AppLifeCycleUtils"],(e,n)=>{"use strict";const t={createActionButton:async function(t,i,o){const s=n.getContainer();const c=await s.getServiceAsync("FrameBoundExtension");try{const e=await c.createUserAction({id:t.mConfig.id,text:t.mConfig.i18n.getText(t.mConfig.text),icon:t.mConfig.icon,press:i},{controlType:"sap.ushell.ui.launchpad.ActionItem"});if(o){e.showForAllApps();e.showOnHome()}else{e.hideForAllApps();e.hideOnHome()}return e}catch(n){e.error(n,undefined,t.mConfig.sComponentName)}},exit:function(){}};return t},true);
/* !
 * Copyright (c) 2009-2025 SAP SE, All Rights Reserved
 */
sap.ui.predefine("sap/ushell/appRuntime/ui5/plugins/baseRta/Trigger", ["sap/ui/thirdparty/hasher","sap/ui/core/BusyIndicator","sap/ui/core/EventBus","sap/ui/core/Lib","sap/ushell/appRuntime/ui5/plugins/baseRta/BaseRTAPluginStatus","sap/ushell/appRuntime/ui5/plugins/baseRta/AppLifeCycleUtils"],(t,i,s,e,o,n)=>{"use strict";const r=o.STATUS_STARTING;const a=o.STATUS_STARTED;const h=o.STATUS_STOPPING;const p=o.STATUS_STOPPED;function u(t){this.mConfig=t;this.sStatus=o.STATUS_STOPPED;this.oStartingPromise=null;this.oStoppingPromise=null;const i=n.getContainer();i.registerDirtyStateProvider(this._dirtyStateProvider.bind(this));this.oInitPromise=i.getServiceAsync("URLParsing").then(t=>{this.oURLParsingService=t}).catch(t=>{throw new Error(`Error during retrieval of URLParsing ushell service: ${t}`)})}function l(){return new Promise((t,i)=>{sap.ui.require(["sap/ui/rta/api/startAdaptation"],t,i)})}function c(){return n.getCurrentRunningApplication().then(t=>t.componentInstance)}u.prototype.getInitPromise=function(){return this.oInitPromise};u.prototype._onRtaFailed=function(t){i.hide();this._oRTA=t.getSource();this.mConfig.onErrorHandler()};u.prototype._startRta=function(){this.sStatus=r;s.getInstance().subscribe("sap.ushell.renderers.fiori2.Renderer","appClosed",this._onAppClosed,this);s.getInstance().subscribe("sap.ushell","appKeepAliveDeactivate",this._onAppClosed,this);i.show(0);let o;return c().then(t=>{o=t;return e.load({name:"sap.ui.rta"})}).then(l.bind(this)).then(i=>{this.sOldHash=t.getHash();const s={rootControl:o,flexSettings:{layer:this.mConfig.layer,developerMode:this.mConfig.developerMode}};return i(s,this.mConfig.loadPlugins,this.mConfig.onStartHandler,this._onRtaFailed.bind(this),this.mConfig.onStopHandler)}).then(t=>{i.hide();this._oRTA=t;this.sStatus=a}).catch(t=>{i.hide();if(t.reason==="flexEnabled"){this.handleFlexDisabledOnStart()}this.sStatus=p})};u.prototype._stopRta=function(){this.sStatus=h;return this._oRTA.stop.apply(this._oRTA,arguments).then(()=>{this.exitRta()})};u.prototype.triggerStartRta=function(){const t=this.sStatus;switch(t){case r:break;case a:this.oStartingPromise=Promise.resolve();break;case h:this.oStartingPromise=this.oStoppingPromise.then(()=>this._startRta());break;case p:this.oStartingPromise=this._startRta();break;default:}if(t!==r){this.oStartingPromise.then(()=>{this.oStartingPromise=null})}return this.oStartingPromise};u.prototype.triggerStopRta=function(){const t=this.sStatus;switch(t){case r:this.oStoppingPromise=this.oStartingPromise.then(function(){return this._stopRta.apply(this,arguments)}.bind(this));break;case a:this.oStoppingPromise=this._stopRta.apply(this,arguments);break;case h:break;case p:this.oStoppingPromise=Promise.resolve();break;default:}if(t!==h){this.oStoppingPromise.then(()=>{this.oStoppingPromise=null})}return this.oStoppingPromise};u.prototype.handleFlexDisabledOnStart=function(){sap.ui.require(["sap/ui/rta/util/showMessageBox","sap/m/MessageBox"],(t,i)=>{t(this.mConfig.i18n.getText("MSG_FLEX_DISABLED"),{icon:i.Icon.INFORMATION,title:this.mConfig.i18n.getText("HEADER_FLEX_DISABLED"),actions:[i.Action.OK],initialFocus:null,isCustomAction:false})})};u.prototype._dirtyStateProvider=function(){if(this._oRTA&&this.sStatus===a){const i=t.getHash();const s=this.oURLParsingService.parseShellHash(i);const e=this.oURLParsingService.parseShellHash(this.sOldHash);this.sOldHash=i;if(s.semanticObject===e.semanticObject&&s.action===e.action&&s.appSpecificRoute!==e.appSpecificRoute){return false}return this._oRTA.canSave()}return false};u.prototype.exitRta=function(){if(this._oRTA){this._oRTA.destroy();this.sStatus=p;this.oStartingPromise=null;this.oStoppingPromise=null;this._oRTA=null}s.getInstance().unsubscribe("sap.ushell.renderers.fiori2.Renderer","appClosed",this._onAppClosed,this);s.getInstance().unsubscribe("sap.ushell","appKeepAliveDeactivate",this._onAppClosed,this)};u.prototype._onAppClosed=function(){this.triggerStopRta(true,true)};return u},true);
// Copyright (c) 2009-2025 SAP SE, All Rights Reserved
sap.ui.predefine("sap/ushell/plugins/BaseRTAPlugin", ["sap/ui/core/Component","sap/ushell/appRuntime/ui5/plugins/baseRta/AppLifeCycleUtils","sap/ushell/appRuntime/ui5/plugins/baseRta/CheckConditions","sap/ushell/appRuntime/ui5/plugins/baseRta/Trigger"],(t,i,e,n)=>{"use strict";const o=t.extend("sap.ushell.plugins.BaseRTAPlugin",{sType:null,init:function(t){this.mConfig=t;this.mConfig.i18n=this.getModel("i18n").getResourceBundle();this.mConfig.loadPlugins=this._loadPlugins.bind(this);this.mConfig.onStartHandler=this._onStartHandler.bind(this);this.mConfig.onErrorHandler=this._onErrorHandler.bind(this);this.mConfig.onStopHandler=this._onStopHandler.bind(this);this.oTrigger=new n(this.mConfig);this._oPluginPromise=(async()=>{await this.oTrigger.getInitPromise();if(this.mConfig.checkRestartRTA&&e.checkRestartRTA(this.mConfig.layer)){await this.oTrigger.triggerStartRta(this)}const t=await i.getAppLifeCycleService();await t.attachAppLoaded(this._onAppLoaded,this)})()},getPluginPromise:function(){return this._oPluginPromise},exit:function(){this._oPluginPromise=this._oPluginPromise.then(i.getAppLifeCycleService).then(t=>{t.detachAppLoaded(this._onAppLoaded,this);if(this._onRendererCreated){const t=i.getContainer();t.detachRendererCreatedEvent(this._onRendererCreated,this)}})},_onAppLoaded:async function(){if(await e.checkRtaPrerequisites()){if(e.checkRestartRTA(this.mConfig.layer)){this.oTrigger.triggerStartRta(this)}this._setButtonVisibility(true)}else{this._setButtonVisibility(false)}},_onAdapt:function(){return this.oTrigger.triggerStartRta(this)},_setButtonVisibility:function(t){if(!this.oActionButton){return}if(t){this.oActionButton.showForAllApps();this.oActionButton.showOnHome()}else{this.oActionButton.hideForAllApps();this.oActionButton.hideOnHome()}},_exitAdaptation:function(){if(this._switchToDefaultMode){this._switchToDefaultMode()}this.oTrigger.exitRta()},_onStartHandler:function(){},_onErrorHandler:function(){this._exitAdaptation()},_onStopHandler:function(){this._exitAdaptation()},_loadPlugins:function(){return Promise.resolve()}});return o},true);
//# sourceMappingURL=flex-plugins.js.map
