// Copyright (c) 2009-2025 SAP SE, All Rights Reserved
sap.ui.define(["sap/ushell_abap/pbServices/ui2/Chip","sap/ushell_abap/pbServices/ui2/Error","sap/ushell_abap/pbServices/ui2/Catalog","sap/ushell_abap/pbServices/ui2/ChipDefinition","sap/ushell_abap/pbServices/ui2/PageBuildingService","sap/ushell_abap/pbServices/ui2/ChipInstance","sap/ushell_abap/pbServices/ui2/Page","sap/ushell_abap/pbServices/ui2/PageSet","sap/ushell_abap/pbServices/ui2/Utils","sap/base/Log","sap/base/util/LoaderExtensions"],(e,t,a,i,n,l,s,r,o,c,u)=>{"use strict";function p(n){const p={};const h={};const g={};const d=this;const f=new o.Map;if(!n){throw new t("Missing page building service","Factory")}c.debug(`Created: ${this}`,null,"Factory");this.addRemoteCatalogService=function(e,a){if(!e){throw new t("Invalid base URL","sap.ushell_abap.pbServices.ui2.Factory")}if(typeof a.readChips!=="function"){throw new t("Invalid remote catalog service","sap.ushell_abap.pbServices.ui2.Factory")}e=e.replace(/\/$/,"");if(f.containsKey(e)){throw new t(`Base URL '${e}' already registered`,"sap.ushell_abap.pbServices.ui2.Factory")}f.put(e,a)};this.createCatalog=function(e,t,i){const n=this;let l;const s=typeof e==="object"?e.id:e;function r(){let e;i=i||n.getPageBuildingService().getDefaultErrorHandler();if(i){e=Array.prototype.slice.call(arguments);e.splice(1,0,l);i.apply(null,e)}}function c(){r.apply(null,l.getCachedRemoteFailureArguments())}if(Object.prototype.hasOwnProperty.call(h,s)){l=h[s].catalog;if(typeof e==="object"&&l.getCatalogData()===undefined){a.call(l,this,e)}}else{l=new a(this,e);h[s]={catalog:l,chips:{}}}if(t){if(l.isStub()){l.load(t.bind(null,l),r)}else if(l.getCachedRemoteFailureArguments()!==undefined){o.callHandler(c,c,true)}else{o.callHandler(t.bind(null,l),r,true)}}return l};this.createChip=function(t,a,i){const n=t.remoteCatalogId;const l=t.id;let s;let r;if(n){this.createCatalog(n);s=h[n].chips}else{s=p}if(Object.prototype.hasOwnProperty.call(s,l)){r=s[l];r.update(t)}else{r=new e(t,this);s[l]=r}if(a){if(r.isStub()){r.load(a.bind(null,r),i)}else{i=i||this.getPageBuildingService().getDefaultErrorHandler();o.callHandler(a.bind(null,r),i,true)}}return r};this.createChipDefinition=function(e,a,n){let l;let s;function r(e,t,a,n){o.callHandler(t.bind(null,new i(e)),a,n)}function c(t){let a;let n;const l=new i(t);g[e]=l;for(a=0,n=s.length;a<n;a+=2){r(l,s[a],s[a+1],false)}}function p(t){let a;let i;let n;if(typeof t==="string"){n=t}else{n=t.message}g[e]=n;for(a=0,i=s.length;a<i;a+=2){s[a+1](n)}}if(!e){throw new t("Missing URL","Factory")}if(typeof a!=="function"){throw new t("Missing success handler","Factory")}n=n||this.getPageBuildingService().getDefaultErrorHandler();e=o.addCacheBusterTokenUsingUshellConfig(e);if(Object.prototype.hasOwnProperty.call(g,e)){l=s=g[e];if(o.isArray(s)){s.push(a,n)}else if(l instanceof i){r(l,a,n,true)}else{o.callHandler(n.bind(null,l),null,true)}return}s=[a,n];g[e]=s;u.loadResource({dataType:"xml",url:e,async:true}).then(c).catch(p)};this.createChipInstance=function(e,t,a,i){e.Chip=e.Chip||{$proxy:true};e.Chip.id=e.Chip.id||e.chipId;e.Chip.remoteCatalogId=e.Chip.remoteCatalogId||e.remoteCatalogId;if(e.RemoteCatalog&&e.RemoteCatalog.id){this.createCatalog(e.RemoteCatalog)}const n=this.createChip(e.Chip);const s=new l(this,e,n,i);if(t){s.load(t.bind(null,s),a)}return s};this.createNewCatalog=function(e,t,a){this.getPageBuildingService().createCatalog(e,e=>{const i=d.createCatalog(e);i.load(t.bind(null,i),(e,t)=>{a(e,i,t)})},(e,t)=>{a(e,undefined,t)})};this.createNewPageBasedCatalog=function(e,t,a,i){this.getPageBuildingService().createPageBasedCatalog(e,t,e=>{d.createCatalog(e,a,i)},i)};this.createPage=function(e,t,a,i){const n=new s(this,e);if(t){n.load(t.bind(null,n),a,i)}return n};this.createPageSet=function(e,t,a){const i=new r(this,e);if(t){i.load(t.bind(null,i),a)}return i};this.forgetCatalog=function(e){delete h[e.getId()]};this.getPageBuildingService=function(){return n};this.getRemoteCatalogService=function(e){const t=e.type==="H"?"/sap/hba/apps/kpi/s/odata/hana_chip_catalog.xsodata":e.baseUrl;return t?f.get(t.replace(/\/$/,"")):undefined};this.toString=function(e){const t=["Factory({oPbs:",n.toString(e)];if(e){t.push(",mChips:",JSON.stringify(p))}t.push("})");return t.join("")}}p.createFactory=function(e,t,a,i){return new p(n.createPageBuildingService(e,t,a,i))};return p});
//# sourceMappingURL=Factory.js.map