// Copyright (c) 2009-2025 SAP SE, All Rights Reserved
this.sap=this.sap||{};sap.ui.define(["sap/ushell_abap/pbServices/ui2/Bag","sap/ushell_abap/pbServices/ui2/AllCatalogs","sap/ushell_abap/pbServices/ui2/Utils","sap/ushell_abap/pbServices/ui2/Error","sap/base/Log","sap/ui/thirdparty/jquery"],(e,t,i,n,a,jQuery)=>{"use strict";function s(s,g){let o;let r;let u;let l;let c;let d=[];let f=true;let h=true;const p=this;function P(){if(h){throw new n(`${p}: page is just a stub`,"Page")}}function I(t){let i;const n=!!(t.Bags&&t.Bags.results);const a=n?t.Bags.results:[];const g=t.PageChipInstances&&t.PageChipInstances.results||[];const o=a.length;const r=g.length;f=!n;delete t.Bags;delete t.Catalog;delete t.PageChipInstances;u=t;h=false;for(i=0;i<o;i+=1){l.put(a[i].id,new e(s,a[i]))}for(i=0;i<r;i+=1){d[i]=s.createChipInstance(g[i],null,null,p)}}function C(e,t){s.getPageBuildingService().updatePage(u,t=>{p.updateScope();if(e){e()}},t)}this.addChipInstance=function(e,t,i,n){const a=s.getPageBuildingService();let g;let o;function r(e){const a=s.createChipInstance(e,n?null:t,i,p);d.push(a);p.updateScope();if(n){t(a)}}P();if(e.getChip){o=e;g=o.getChip()}else{g=e}if(g.getRemoteCatalog()){a.createPageChipInstanceFromRawData({pageId:u.id,chipId:g.getId(),configuration:o&&o.getConfiguration()||"",title:o&&o.getTitle(),remoteCatalogId:g.getRemoteCatalog().getId()},r,i)}else{a.createPageChipInstance(u.id,null,g.getId(),o&&o.getTitle(),o&&o.getConfiguration()||"","",r,i)}};this.addChipInstanceReference=function(e,t,i){const n=s.getPageBuildingService();function a(n){const a=s.createChipInstance(n,e.isStub()?null:t,i,p);d.push(a);if(e.isStub()){t(a)}}P();n.clonePageChipInstance(e.getPage().getId(),e.getId(),this.getId(),a,i)};this.exit=function(){let e;let t;a.debug(`Exiting: ${this}`,null,"Page");for(e=0,t=d.length;e<t;e+=1){d[e].exit()}u=null;l=new i.Map;c=null;d=[];h=true;a.debug(`Exited: ${this}`,null,"Page")};this.getAllCatalogs=function(){if(!r){r=new t(s,o)}return r};this.getBagIds=function(){if(f){throw new n(`${p}: page is just a stub, load bags on demand`,"Page")}return l.keys()};this.getBag=function(t){if(f){throw new n(`${p}: page is just a stub, load bags on demand`,"Page")}if(!t){throw new n("Missing bag ID","Page")}if(l.containsKey(t)){return l.get(t)}const i=new e(s,{pageId:this.getId(),id:t,$tmp:true});l.put(t,i);return i};this.loadBag=function(t){let i;if(!t){throw new n("Missing bag ID","Page")}if(l.containsKey(t)){i=l.get(t)}else{i=new jQuery.Deferred;l.put(t,i);s.getPageBuildingService().readBag(o,t,t=>{i.resolve(new e(s,t))},()=>{i.resolve(new e(s,{pageId:o,id:t,$tmp:true}))})}return i.promise()};this.getCatalog=function(){P();if(!c&&u.catalogId){c=s.createCatalog(u.catalogId)}return c};this.getChipInstances=function(){P();return d.slice()};this.getId=function(){return o};this.getLayout=function(){P();return u.layout};this.setLayout=function(e,t,n){P();if(u.layout===e){if(t){n=n||s.getPageBuildingService().getDefaultErrorHandler();i.callHandler(t,n,true)}return}u.layout=e;C(t,n)};this.getOriginalLanguage=function(){P();return u.originalLanguage};this.getScope=function(){P();return u.scope};this.getTitle=function(){P();return u.title};this.setTitle=function(e,t,n){P();if(u.title===e){if(t){n=n||s.getPageBuildingService().getDefaultErrorHandler();i.callHandler(t,n,true)}return}u.title=e;C(t,n)};this.isCatalogPage=function(){P();return u.isCatalogPage==="X"};this.isPersonalizationLocked=function(){P();return u.isPersLocked==="X"};this.setPersonalizationLocked=function(e,t,a){P();if(s.getPageBuildingService().isPersonalization()){throw new n("Personalization locking cannot be changed at personalization scope","Page")}if(u.isPersLocked==="X"&&e||u.isPersLocked!=="X"&&!e){if(t){a=a||s.getPageBuildingService().getDefaultErrorHandler();i.callHandler(t,a,true)}return}u.isPersLocked=e?"X":" ";C(t,a)};this.isOutdated=function(){P();return u.outdated==="X"};this.isReadOnly=function(){P();return u.isReadOnly==="X"};this.isPersonalized=function(){P();return u.scope==="PERSONALIZATION"};this.isStub=function(){return h};this.load=function(e,t,i){let g;if(!h){throw new n("Page is not a stub anymore","Page")}function r(){if(g===0){a.debug(`Initialized: ${p}`,null,"Page");e()}}function u(){g-=1;r()}s.getPageBuildingService().readPage(o,e=>{let n;const s=e.PageChipInstances&&e.PageChipInstances.results||[];const o=s.length;a.debug(`Loaded: ${p}`,null,"Page");I(e);g=i?0:o;if(!i){for(n=0;n<o;n+=1){d[n].load(u,t)}}r()},t)};this.remove=function(e,t){this.exit();s.getPageBuildingService().deletePage(o,e,t)};this.removeChipInstance=function(e,t,i){const n=d.indexOf(e);P();if(n>=0){d.splice(n,1);e.remove(function(){p.updateScope();if(t){t.apply(this,arguments)}},function(){d.splice(n,0,e);i=i||s.getPageBuildingService().getDefaultErrorHandler();i.apply(this,arguments)});return true}return false};this.toString=function(e){const t=['Page({sId:"',o,'",bIsStub:',h,",bIsLoadingBagsOnDemand:",f];if(e){t.push(",oAlterEgo:",JSON.stringify(u),",oCatalog:",c?c.toString(e):c,",oFactory:",s.toString(e),",aChipInstances:",JSON.stringify(d))}t.push("})");return t.join("")};this.updateScope=function(){if(s.getPageBuildingService().isPersonalization()){u.scope="PERSONALIZATION"}};if(typeof g==="object"){o=g.id;I(g)}else if(typeof g==="string"){o=g}if(!o){throw new n("Missing ID","Page")}l=new i.Map;a.debug(`Created: ${this}`,null,"Page")}return s});
//# sourceMappingURL=Page.js.map