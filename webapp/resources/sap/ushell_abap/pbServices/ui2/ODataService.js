// Copyright (c) 2009-2025 SAP SE, All Rights Reserved
sap.ui.define(["sap/ushell_abap/pbServices/ui2/Utils","sap/ushell_abap/pbServices/ui2/Error"],(e,t)=>{"use strict";let n=new e.Map;function r(e,r){if(!e){throw new t("Missing OData wrapper","ODataService")}const s=e.getBaseUrl();this.getCsrfToken=function(){if(n.get(s)&&n.get(s).token){return n.get(s).token}return""};this.getDefaultErrorHandler=function(){return r};this.openBatchQueue=function(){e.openBatchQueue()};this.refreshCsrfToken=function(i,o){if(typeof i!=="function"){throw new t("Success callback is not a function","ODataService")}o=o||r;const a=n.get(s);if(!a.fetchingInProgress){a.token=undefined;a.fetchingInProgress=true;e.read("",()=>{if(!n.get(s)||!n.get(s).token){o("No CSRF token delivered");a.errorHandlers.forEach(e=>{e("No CSRF token delivered")})}else{i();a.successHandlers.forEach(e=>{e()})}a.successHandlers=[];a.errorHandlers=[];a.fetchingInProgress=false},function(){a.fetchingInProgress=false;o.apply(null,arguments)})}else{a.successHandlers.push(i);a.errorHandlers.push(o)}};this.setCsrfToken=function(e){if(e&&typeof e!=="string"){throw new t(`Invalid CSRF token: ${e}`,"ODataService")}const r=n.get(s);r.token=e};this.setDefaultErrorHandler=function(e){if(e&&typeof e!=="function"){throw new t("Error callback is not a function","ODataService")}r=e||function(){}};this.submitBatchQueue=function(){e.submitBatchQueue.apply(e,arguments)};this.toString=function(t){const n=["ODataService({"];if(t){n.push('csrfToken:"',this.getCsrfToken(),'"');n.push(",oODataWrapper:",e.toString(true))}n.push("})");return n.join("")};if(!n.get(s)){n.put(s,{fetchingInProgress:false,successHandlers:[],errorHandlers:[]})}this.setDefaultErrorHandler(r)}r.resetSharedCsrfTokens=function(){n=new e.Map};return r});
//# sourceMappingURL=ODataService.js.map