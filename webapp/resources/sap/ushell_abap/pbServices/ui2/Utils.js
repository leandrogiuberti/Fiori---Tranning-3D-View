// Copyright (c) 2009-2025 SAP SE, All Rights Reserved
sap.ui.define(["sap/ui/thirdparty/URI","sap/base/Log","sap/ushell_abap/pbServices/ui2/Error","sap/ui/Device"],(e,t,n,r)=>{"use strict";function s(){}let o;s.absoluteUrl=function(e,t){t=t||window.location.href;if(t.indexOf("://")<0&&t.charAt(0)!=="/"){throw new n(`Illegal base URL: ${t}`)}if(!e||e.indexOf("://")>=0||e.charAt(0)==="/"){return s.addCacheBusterTokenUsingUshellConfig(e)}if(t.search(/^([^:]*:)?\/\/[^/]+$/)<0){t=t.replace(/\/[^/]*$/,"")}return s.addCacheBusterTokenUsingUshellConfig(`${t}/${e}`)};s.callHandler=function(e,n,r){if(r){setTimeout(()=>{s.callHandler(e,n,false)},0);return}try{e()}catch(e){const r=e.message||e.toString();t.error(`Call to success handler failed: ${r}`,e);if(n){n(r)}}};s.get=function(e,r,i,a,u,l){if(typeof i!=="function"){throw new n("Missing success handler")}if(typeof a!=="function"){throw new n("Missing error handler")}if(r&&l){throw new n("Caching of XML responses not supported")}if(typeof s.addCacheBusterTokenUsingUshellConfig==="function"){e=s.addCacheBusterTokenUsingUshellConfig(e)}u=u||new XMLHttpRequest;u.onreadystatechange=function(){let n;let u;if(this.readyState!==4){return}if(this.status!==200){t.error(`Error ${this.status} in response for URL ${e}`,null);a(`${e}: ${this.status} ${this.statusText}`,this.responseText);return}t.debug(`Received response for URL ${e}`,null);if(r){u=this.responseXML;if(u===null||!u.documentElement){a(`${e}: no valid XML`);return}n=u}else{n=this.responseText;if(l){o.put(e,n)}}s.callHandler(i.bind(null,n),a)};if(!r&&o.containsKey(e)){t.debug(`Return cached response for URL ${e}`,null);s.callHandler(i.bind(null,o.get(e)),a)}else{try{if(u.readyState<XMLHttpRequest.OPENED){u.open("GET",e,true)}else{t.debug(`XHR Request was already opened for ${e}`,null)}u.send();t.debug(`Sent request to URL ${e}`,null)}catch(n){t.error(`Error '${n.message||n}' in request to URL ${e}`,null);throw n}}};s.addCacheBusterToken=function(e,t,n,r){if(t.test(e)){e=e.replace(t,n);e=e.replace(/\[CacheBusterToken\]/g,r)}return e};s.removeCBAndNormalizeUrl=function(t){let n;let r;let s;function o(t){const n=new e(t);const r=n.path();if(n.is("absolute")){return false}if(r&&r.charAt(0)==="/"){return false}return true}if(typeof t!=="string"||t===""||o(t)){return t}const i=t.match(/(.*)(\/~[\w-]+~[A-Z0-9]?)(.*)/);if(i){n=i[1];r=i[2];s=i[3]}function a(t){return new e(t).normalizePathname().toString()}function u(t){const n=new e(t).segment();let r;let s=0;for(r=0;r<n.length&&s>=0;r+=1){if(n[r]===".."){s=s-1}else{s=s+1}}return s<0}if(r){if(s&&u(s)){t=n+s}}return a(t)};s.addCacheBusterTokenUsingUshellConfig=function(e){const t=window["sap-ushell-config"]&&window["sap-ushell-config"].cacheBusting;const n=t&&t.patterns;let r=e;let o=[];const i=[];o=s.getParameterMap();const a=o["sap-ushell-nocb"]&&o["sap-ushell-nocb"][0];if((a==="true"||a==="X")&&typeof e==="string"){e=e.replace(/\/~[\w-]+~[A-Z0-9]?/,"");return e}if(!t||typeof e!=="string"||e===""||/[/=]~[\w-]+~[A-Z0-9]?[/#?&]/.test(e)||/[/=]~[\w-]+~[A-Z0-9]?$/.test(e)){return e}if(t&&t.urls){if(e.charAt(e.length-1)==="/"){e=e.substr(0,e.length-1)}if(t.urls.hasOwnProperty(e)){return`${e}/${t.urls[e].cacheBusterToken}`}if(t.urls.hasOwnProperty(`${e}/`)){return`${e}/${t.urls[`${e}/`].cacheBusterToken}`}}if(!n){return e}Object.keys(n).forEach(e=>{if(n.hasOwnProperty(e)){const t=n[e];t.pattern=new RegExp(e);i.push(t)}});i.sort((e,t)=>e.order-t.order);i.every(n=>{if(n.pattern.test(e)){if(!n.cacheBusterToken){n.cacheBusterToken=t.cacheBusterToken}r=s.addCacheBusterToken(e,n.pattern,n.replacement,n.cacheBusterToken);return false}return true});return r};s.clearCache=function(){o=new s.Map};s.getFormFactor=function(){if(r.system.desktop){return r.system.SYSTEMTYPE.DESKTOP}if(r.system.tablet){return r.system.SYSTEMTYPE.TABLET}if(r.system.phone){return r.system.SYSTEMTYPE.PHONE}};s.getParameterMap=function(e){let t;let r;const s={};let o;let i;let a;const u=arguments.length>0?e:window.location.search;if(u&&u.charAt(0)!=="?"){throw new n(`Illegal search string ${u}`)}if(!u||u==="?"){return{}}const l=u.substring(1).replace(/\+/g," ").split(/[&;]/);const c=l.length<500?l.length:500;for(t=0,r=c;t<r;t+=1){o=l[t];i="";a=o.indexOf("=");if(a>=0){i=o.slice(a+1);i=decodeURIComponent(i);o=o.slice(0,a)}o=decodeURIComponent(o);if(!Object.prototype.hasOwnProperty.call(s,o)){s[o]=[]}s[o].push(i)}return s};s.getParameterValue=function(e,t){let r;if(typeof t!=="string"){throw new n("Missing parameter name")}e=e.split("#")[0];const o=e.indexOf("?");if(o>=0){r=s.getParameterMap(e.slice(o));if(r[t]){return r[t][0]}}return""};s.isArray=function(e){return Object.prototype.toString.apply(e)==="[object Array]"};s.isString=function e(t){return/String/.test(Object.prototype.toString.call(t))};s.parseXml=function(e){if(!e||typeof e!=="string"){return null}const t=(new DOMParser).parseFromString(e,"text/xml");if(t.getElementsByTagName("parsererror").length){throw new n(`Invalid XML: ${e}`)}return t};s.Map=function(){this.entries={}};s.Map.prototype.put=function(e,t){const n=this.get(e);this.entries[e]=t;return n};s.Map.prototype.containsKey=function(e){if(typeof e!=="string"){throw new n(`Not a string key: ${e}`)}return Object.prototype.hasOwnProperty.call(this.entries,e)};s.Map.prototype.get=function(e){if(this.containsKey(e)){return this.entries[e]}return undefined};s.Map.prototype.keys=function(){return Object.keys(this.entries)};s.Map.prototype.remove=function(e){delete this.entries[e]};s.Map.prototype.toString=function(){const e=["Map("];e.push(JSON.stringify(this.entries));e.push(")");return e.join("")};s.clearCache();return s});
//# sourceMappingURL=Utils.js.map