// Copyright (c) 2009-2025 SAP SE, All Rights Reserved
this.sap=this.sap||{};sap.ui.define(["sap/ushell_abap/pbServices/ui2/Bag","sap/ushell_abap/pbServices/ui2/Utils","sap/ushell_abap/pbServices/ui2/Error","sap/base/Log"],(e,t,n,i)=>{"use strict";function r(r,a,s,u){let c;let o;let l;let f;let g;let h;const p=new t.Map;let d=false;let I=[];const C=this;const y=Object.assign({},a);function S(){a.referenceChipInstanceId="";a.referencePageId=""}function P(){S();if(u){u.updateScope()}}function b(){if(!c){throw new n(`${C}: CHIP instance is just a stub`,"ChipInstance")}}function m(e,n){if(!c){c=s.createApi(C,p)}i.debug(`Initialized: ${C}`,null,"ChipInstance");t.callHandler(e,n)}function w(t){let n;const i=s.getBagIds();let u;for(n=0;n<t.length;n+=1){o.put(t[n].id,new e(r,t[n],s.getBag(t[n].id),P))}for(n=0;n<i.length;n+=1){u={pageId:a.pageId,instanceId:a.instanceId,id:i[n],$tmp:true};if(!o.containsKey(u.id)){o.put(u.id,new e(r,u,s.getBag(u.id),P))}}}function B(){if(s.isStub()){throw new n(`${this}: initializeConfiguration expects that the CHIP is no stub anymore`,"ChipInstance",false)}if(!l){l={};s.updateConfiguration(l,a.configuration)}}this.persist=function(e,t){r.getPageBuildingService().updatePageChipInstance(a,()=>{S();if(u){u.updateScope()}if(e){e()}},t)};this.attachFullscreen=function(e){if(typeof e!=="function"){throw new n(`${this}: fullscreen event handler is not a function`,"ChipInstance")}I.push(e)};this.attachRefresh=function(e){if(e&&typeof e!=="function"){throw new n(`${this}: refresh event handler is not a function`,"ChipInstance")}f=e};this.attachTitleChange=function(e){h=e};this.detachAll=function(){I=[];f=null};this.exit=function(){i.debug(`Exit: ${C}`,null,"ChipInstance");c=null;o=new t.Map;l=null;g=null;h=null};this.getApi=function(){return c};this.getBagIds=function(){return o.keys()};this.getBag=function(t){let i;if(!t){throw new n("Missing bag ID","ChipInstance")}i=o.get(t);if(i){return i}i=new e(r,{pageId:a.pageId,instanceId:a.instanceId,id:t,$tmp:true},null,P);o.put(t,i);return i};this.getChip=function(){return s};this.getConfiguration=function(){return a.configuration};this.getConfigurationParameter=function(e){B();if(Object.prototype.hasOwnProperty.call(l,e)){return l[e]}return s.getConfigurationParameter(e)};this.getContract=function(e){b();return p.get(e)};this.getFullscreen=function(){return d};this.getId=function(){return a.instanceId};this.getImplementationAsSapui5=function(){i.error("Deprecated API call of 'ChipInstance.getImplementationAsSapui5'. Please use 'getImplementationAsSapui5Async' instead",null,"sap.ushell_abap.pbServices.ui2.ChipInstance");b();return s.getImplementationAsSapui5(c)};this.getImplementationAsSapui5Async=async function(){b();return s.getImplementationAsSapui5Async(c)};this.getLayoutData=function(){return a.layoutData};this.getPage=function(){return u};this.getTitle=function(){return g||a.title||s.getTitle()};this.getUpdated=function(e){function t(){i.error("Parse Error: CHIP instance's updated property has unexpected format",`value of updated property: '${a.updated}'`,"ChipInstance")}let n;let r;if(a.updated&&!e){n=/\((\d*)\)/.exec(a.updated);if(!n){t();return undefined}r=new Date(parseInt(n[1],10));if(isNaN(r.getTime())){t();return undefined}return r}return a.updated};this.isOutdated=function(){return a.outdated==="X"};this.isReadOnly=function(){b();return a.isReadOnly==="X"};this.isReference=function(){return!!a.referenceChipInstanceId||!!a.referencePageId};this.isBrokenReference=function(){return a.referenceChipInstanceId==="O"||a.referencePageId==="O"};this.getOriginalId=function(){return a.referenceChipInstanceId===""||a.referenceChipInstanceId==="O"?undefined:a.referenceChipInstanceId};this.getOriginalPageId=function(){return a.referencePageId===""||a.referencePageId==="O"?undefined:a.referencePageId};this.isStub=function(){return!c};this.load=function(e,n){n=n||r.getPageBuildingService().getDefaultErrorHandler();const i=m.bind(null,e,n);if(s.isStub()){s.load(i,n)}else{t.callHandler(i,n,true)}};this.remove=function(e,t){if(u&&u.removeChipInstance(C,e,t)){return}this.exit();r.getPageBuildingService().deletePageChipInstance(a.pageId,a.instanceId,e,t)};this.refresh=function(){if(f){try{f();return true}catch(e){i.error(`${C.getId()}: call to refresh handler failed:`,e,"ChipInstance");return false}}return false};this.setFullscreen=function(e){let t;let n;if(d!==e){d=e;for(t=0,n=I.length;t<n;t+=1){I[t]()}}};this.setLayoutData=function(e,n,i){if(a.layoutData===e){if(n){i=i||r.getPageBuildingService().getDefaultErrorHandler();t.callHandler(n,i,true)}return}a.layoutData=e;this.persist(n,i)};this.setTitle=function(e,n,i,s){let u;s=s||r.getPageBuildingService().getDefaultErrorHandler();if(g!==e){g=e;if(h){t.callHandler(h.bind(null,this),s,!n)}}if(n&&a.title!==g){u=a.title;a.title=g;g=undefined;this.persist(i,function(){a.title=u;g=undefined;s.apply(null,arguments)})}else if(i){t.callHandler(i,s,true)}};this.toString=function(e){const t=["ChipInstance({oChip:",s.toString(e),",bFullscreen:",d];if(e){t.push(",oAlterEgo:",JSON.stringify(a),",oApi:",JSON.stringify(c),",oBags:",o.toString(),",oConfiguration:",JSON.stringify(l),",oFactory:",r.toString(e),",aFullscreenHandlers.length:",I.length,',sTitle:"',g,'"')}t.push("})");return t.join("")};this.updateConfiguration=function(e,t,n){B();s.updateConfiguration(l,e);a.configuration=JSON.stringify(l);this.persist(t,n)};this._getConstructorData=function(){return{factory:r,alterEgo:y,chip:s,page:u}};this._getBags=function(){return o};this._setBags=function(e){o=e};o=new t.Map;w(a.ChipInstanceBags&&a.ChipInstanceBags.results||[]);delete a.Chip;i.debug(`Created: ${this}`,null,"ChipInstance")}r.prototype.clone=function(){const e=this._getConstructorData();const t=new r(e.factory,e.alterEgo,e.chip,e.page);return new Promise((e,n)=>{t.load(e,n)}).then(()=>{t._setBags(this._getBags());return t})};return r});
//# sourceMappingURL=ChipInstance.js.map