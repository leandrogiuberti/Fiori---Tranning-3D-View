// Copyright (c) 2009-2025 SAP SE, All Rights Reserved
sap.ui.define(["sap/ui/core/EventBus","sap/ushell_abap/pbServices/ui2/Error","sap/ushell_abap/pbServices/ui2/Utils","sap/base/Log","sap/ui/thirdparty/jquery"],(e,t,i,n,jQuery)=>{"use strict";function a(a,r){let s;let o;let l=[];let u;let d=true;let g;let f;let c;let h=[];const p=this;function C(){if(d){throw new t(`${p}: page is just a stub`,"Page")}}function S(){if(!s){throw new t(`${p}: catalog is just an ID`,"Catalog")}}this.exit=function(){const e=p.toString();if(o){o.exit()}s=undefined;r=undefined;l=[];d=true;u=undefined;c=undefined;h=[];Object.keys(p).forEach(e=>{if(!/getCatalogData|getId|isStub|toString/.test(e)){delete p[e]}});a.forgetCatalog(p);n.debug(`Exited: ${e}`,null,"Catalog")};this.getRemoteBaseUrl=function(){return p.addSystemToServiceUrl(s.type==="H"?"/sap/hba/apps/kpi/s/odata/hana_chip_catalog.xsodata/":s.baseUrl)};this.getRemoteCatalogService=function(){return a.getRemoteCatalogService(s)||{readChips:function(e,t,a,r,o){n.error(`Catalog '${s.id}', type '${s.type}' not supported`,null,"Catalog");i.callHandler(r.bind(null,{results:[]}),undefined,true)}}};function m(){let e;let t;let i;n.debug(`Loaded: ${p}`,null,"Catalog");if(s.Chips){i=s.Chips.results||s.Chips;delete s.Chips;l=[];for(e=0,t=i.length;e<t;e+=1){l[e]=a.createChip(i[e])}d=false;n.debug(`Initialized: ${p}`,null,"Catalog")}delete s.CatalogPage}this.read=function(e,t,n){let r;function o(e){s=e;m();r.resolve()}function l(e){s.Chips=e;m();r.resolve()}function d(e){e.results.forEach(e=>{e.remoteCatalogId=f});l(e)}function c(){m();g=arguments;r.reject.apply(this,arguments)}function h(t){let i;if(t.remoteId){s=t;try{i=p.getRemoteBaseUrl()}catch(e){c(e.toString());return}p.getRemoteCatalogService().readChips(i,s.remoteId,undefined,d,c)}else if(s&&e){l(t.Chips)}else{o(t)}}if(!u||u.state()!=="pending"){r=new jQuery.Deferred;u=r.promise();if(!s||e&&!s.remoteId){a.getPageBuildingService().readCatalog(f,h,r.reject.bind(r))}else{h.bind(this)(s)}}n=n||a.getPageBuildingService().getDefaultErrorHandler();u.done(i.callHandler.bind(null,t,n));u.fail(n)};this.addSystemToServiceUrl=function(i,n){if(i.indexOf("/")!==0||i.indexOf("//")===0){throw new t(`addSystemToServiceUrl: Invalid URL: ${i}`,"Catalog")}n=n||this.getSystemAlias();if(/^[^?]*(;o=([\/;?]|$))/.test(i)){i=i.replace(/;o=([\/;?]|$)/,(n?";o="+n:"")+"$1")}else if(!/^[^?]*;o=/.test(i)&&n){i=i.replace(/(\/[^?]*?)(\/$|$|(\/?\?.*))/,`$1;o=${n}$2`)}e.getInstance().publish("sap.ushell.Container","addRemoteSystemForServiceUrl",i);return i};this.clone=function(e,t,i,n){let r;function o(e,t){return n(e,undefined,t)}if(s&&s.type==="REMOTE"){r=this.getCatalogData();delete r.id;r.domainId=e;if(t!==undefined){r.title=t}a.createNewCatalog(r,i,n)}else{a.getPageBuildingService().cloneCatalog(this.getId(),e,t,e=>{a.createCatalog(e.id,i,o)},o)}};this.getCatalogData=function(){if(!s){return undefined}const e=JSON.parse(JSON.stringify(s));delete e.__metadata;return e};this.getCatalogPage=function(){S();if(s.type!=="P"&&s.type!=="CATALOG_PAGE"){return undefined}if(!o){o=a.createPage(f)}return o};this.getChips=function(){if(d){throw new t(`${p}: catalog is just a stub`,"Catalog")}return l.slice()};this.getDomainId=function(){return s&&s.domainId};this.getId=function(){return f};this.getSystemAlias=function(){return s&&s.systemAlias||undefined};this.getTitle=function(){S();return s.title};this.getType=function(){S();return s&&s.type};this.isOutdated=function(){S();return o&&!o.isStub()&&o.isOutdated()||s.outdated==="X"};this.isReadOnly=function(){C();return s.isReadOnly==="X"};this.isStub=function(){return d};this.getCachedRemoteFailureArguments=function(){return g};this.load=function(e,i){if(!d){throw new t("Catalog is not a stub anymore","Catalog")}this.read(false,e,i)};this.readChips=function(e,t,n){function r(e){e.results.forEach(e=>{a.createChip(e)});i.callHandler(t,n)}function o(e){e.results.forEach(e=>{e.remoteCatalogId=f});r(e)}function l(t){s=t;if(s.remoteId){this.getRemoteCatalogService().readChips(this.getRemoteBaseUrl(),s.remoteId,e,o,n)}else{a.getPageBuildingService().readCatalogChips(f,e,r,n)}}if(!s){a.getPageBuildingService().readCatalog(f,l.bind(this),n,true)}else{l.bind(this)(s)}};this.readRegisteredChips=function(e,t){function n(){const e=new jQuery.Deferred;const t=h;h=[];if(t.length){p.readChips(t,e.resolve.bind(e),e.reject.bind(e))}else{e.resolve()}return e.promise()}if(!c||c.state()!=="pending"){c=n()}t=t||a.getPageBuildingService().getDefaultErrorHandler();c.fail(t).done(i.callHandler.bind(null,e,t))};this.refresh=function(e,t){this.read(true,e,t)};this.registerChip=function(e){if(c&&c.state()==="pending"){throw new t("Invalid state: registerChip while readRegisteredChips pending","Catalog")}h.push(e.getId())};this.remove=function(e,i){S();if(u&&u.state()==="pending"){throw new t(`Catalog is being refreshed: ${this}`,"Catalog")}n.debug(`Removing: ${this}`,null,"Catalog");a.getPageBuildingService().deleteCatalog(s,()=>{this.exit();e()},i)};this.toString=function(e){const t=['Catalog({sId:"',f,'"',",bIsStub:",d];if(e){t.push(",oAlterEgo:",JSON.stringify(s),",oFactory:",a.toString(e),",aChips:",JSON.stringify(l))}t.push("})");return t.join("")};this.update=function(e,i,n){S();if(Object.hasOwnProperty.call(e,"__metadata")){throw new t("Unsupported __metadata update","Catalog")}const r=JSON.parse(JSON.stringify(s));Object.keys(e).forEach(t=>{r[t]=e[t]});d=true;g=undefined;a.getPageBuildingService().updateCatalog(r,()=>{s=r;this.read(true,i,n)},function(){d=false;n=n||a.getPageBuildingService().getDefaultErrorHandler();n.apply(null,arguments)})};if(typeof r==="object"){f=r.id;if(r.remoteId){delete r.Chips}s=r;m()}else if(typeof r==="string"){f=r}if(!f){throw new t("Missing ID","Catalog")}n.debug(`Created: ${this}`,null,"Catalog")}return a});
//# sourceMappingURL=Catalog.js.map