// Copyright (c) 2009-2025 SAP SE, All Rights Reserved
sap.ui.define(["sap/ushell_abap/pbServices/ui2/Utils","sap/ushell_abap/pbServices/ui2/ODataService","sap/ushell_abap/pbServices/ui2/ODataWrapper","sap/ushell_abap/pbServices/ui2/Error"],(e,t,n,i)=>{"use strict";function a(n,s,r,o){let c;const g=this;function d(e){return e.replace(/'/g,"''").replace(/&/g,"%26")}function l(e,t,n){let i;if(typeof e==="string"){i=e}else{if(e.instanceId){return`ChipInstanceBags(pageId='${encodeURIComponent(e.pageId)}',instanceId='${encodeURIComponent(e.instanceId)}',id='${encodeURIComponent(t)}')${n?"?$expand=ChipInstanceProperties":""}`}i=e.id}return`Bags(pageId='${encodeURIComponent(i)}',id='${encodeURIComponent(t)}')${n?"?$expand=Properties":""}`}a.extractBatchResponseEntry=function(e){if(e.statusCode==="201"){return e.data}if(e.statusCode==="204"){return undefined}return e.message||""};this.batch=function(t,n,i,s){let r=[];function o(e){let t;const n=[];for(t=0;t<e.length;t+=1){n[t]=a.extractBatchResponseEntry(e[t])}return n}i=i||function(){};s=s||g.getDefaultErrorHandler();c.check(i,s);t=t||[];n=n||[];if(t.length>0){r.push({__changeRequests:t})}r=r.concat(n);if(r.length===0){e.callHandler(i.bind(null,[],[]),s,true);return}c.batch({__batchRequests:r},n=>{const a=n.__batchResponses;const g=a[0].__changeResponses;if(a[0].response&&a[0].message){c.onError("POST",`${c.getBaseUrl()}$batch`,s,undefined,n.__batchResponses[0]);return}if(g&&g.length!==t.length||a.length!==r.length){s("Number of requests differs from number of responses in $batch");return}if(g){e.callHandler(i.bind(null,o(g),o(a.slice(1))),s,false)}else{e.callHandler(i.bind(null,[],o(a)),s,false)}},s)};this.isPersonalization=function(){return!!r};this.readMetadata=function(t,n,i){const a=`${c.getBaseUrl()}$metadata${i?`?${Date.now()}`:""}`;n=n||this.getDefaultErrorHandler();c.check(t,n);OData.read(a,i=>{e.callHandler(t.bind(null,i),n)},c.onError.bind(c,"GET",a,n,undefined),OData.metadataHandler)};this.deleteBag=function(e,t,n,a){if(!e){throw new i("Missing parent ID or object","PageBuildingService")}if(!t){throw new i("Missing bag ID","PageBuildingService")}c.del(l(e,t,false),n,a)};this.readBag=function(e,t,n,a){if(!e){throw new i("Missing parent ID or object","PageBuildingService")}if(!t){throw new i("Missing bag ID","PageBuildingService")}c.read(l(e,t,true),n,a)};this.readAllCatalogs=function(e,t,n,i,a,s){let r="id";s=s===undefined?true:s;if(a&&typeof a==="string"){r=a}let o=`Pages('${encodeURIComponent(e)}')/allCatalogs?$expand=Chips/ChipBags/ChipProperties&`+`$orderby=${r}`;if(i&&typeof i==="string"){o=`${o}&$filter=${encodeURIComponent(i)}`}if(this.readAllCatalogs.cacheBusterTokens&&this.readAllCatalogs.cacheBusterTokens.get(e)){o+=`&sap-cache-id=${this.readAllCatalogs.cacheBusterTokens.get(e)}`}c.read(o,t,n,s)};this.readCatalogs=function(e,t,n){let i="Catalogs?$orderby=id";if(n&&typeof n==="string"){i=`${i}&$filter=${encodeURIComponent(n)}`}c.read(i,e,t)};this.readAllCatalogsForUser=function(e,t,n){const i=e?`?$filter=${encodeURIComponent(e)}`:"";c.read(`Pages('unused')/allCatalogs${i}`,t,n)};this.getReferencingCatalogIds=function(e,t,n){if(typeof t!=="function"){t=n;n=arguments[3]}function a(n){const i=[];const a=n.results||[];a.forEach(t=>{if(t.referenceChipId===e){if(i.indexOf(t.catalogId)===-1){i.push(t.catalogId)}}});t(i)}if(typeof e!=="string"){throw new i("sReferencedChipId must be a string","PageBuildingService")}if(typeof t!=="function"){throw new i("fnSuccess is mandatory","PageBuildingService")}c.read(`Chips?$filter=${encodeURIComponent(`referenceChipId eq '${d(e)}'`)}`,a,function(e){new i(e,"PageBuildingService");n.apply(null,arguments)})};this.createPageBasedCatalog=function(e,t,n,a){if(!e){throw new i("Missing domain ID","PageBuildingService")}c.create("Catalogs",{domainId:e,title:t,type:"CATALOG_PAGE"},n,a)};this.createCatalog=function(e,t,n){c.create("Catalogs",e,t,n)};this.deleteCatalog=function(e,t,n){c.del(e,t,n)};this.cloneCatalog=function(e,t,n,a,s){if(!e){throw new i("Missing source catalog ID","PageBuildingService")}if(!t){throw new i("Missing new domain ID","PageBuildingService")}if(t.indexOf(":")>=0){throw new i(`Illegal domain ID: ${t}`,"PageBuildingService")}c.create(`CloneCatalog?sourceId='${encodeURIComponent(e)}'&targetId='${encodeURIComponent(t)}${n!==undefined?`'&title='${encodeURIComponent(n)}'`:"'"}`,{},a,s)};this.clonePageChipInstance=function(e,t,n,a,s){if(!e){throw new i("Missing source page ID","PageBuildingService")}if(!t){throw new i("Missing source CHIP instance ID","PageBuildingService")}if(!n){throw new i("Missing target page ID","PageBuildingService")}c.create(`ClonePageChipInstance?sourcePageId='${encodeURIComponent(e)}'&sourceChipInstanceId='${encodeURIComponent(t)}'&targetPageId='${encodeURIComponent(n)}'`,{},e=>{c.read(`PageChipInstances(pageId='${encodeURIComponent(e.pageId)}',instanceId='${encodeURIComponent(e.instanceId)}')`+"?$expand=ChipInstanceBags/ChipInstanceProperties",a,s)},s)};this.readCatalog=function(e,t,n,a,s){let r;if(!e){throw new i("Missing catalog ID","PageBuildingService")}r=`Catalogs('${encodeURIComponent(e)}')`;if(!a){r+="?$expand=Chips";if(!s){r+="/ChipBags/ChipProperties"}}c.read(r,t,n)};this.updateCatalog=function(e,t,n){c.update(e,t,n)};this.readCatalogChips=function(e,t,n,a){let s="";let r="?$filter=";if(!e){throw new i("Missing catalog ID","PageBuildingService")}const o=`Catalogs('${encodeURIComponent(e)}')/Chips`;if(t){if(!t.length){throw new i("No CHIP IDs given","PageBuildingService")}t.forEach(e=>{s=`${s+r}id%20eq%20'${encodeURIComponent(e)}'`;r="%20or%20"});if(c.getBaseUrl().length+o.length+s.length>2e3){s=""}}c.read(o+s,n,a)};this.createPage=function(e,t,n,a,s,r){if(!e){throw new i("Missing page ID","PageBuildingService")}c.create("Pages",{id:e,catalogId:t,layout:n,title:a},s,r)};this.readPages=function(e,t,n){let i="Pages?";if(!n){i+="$expand=Catalog&"}c.read(`${i}$orderby=id`,e,t)};this.readPage=function(e,t,n,a){let s=`Pages('${encodeURIComponent(e)}')`;if(!e){throw new i("Missing page ID","PageBuildingService")}if(a===undefined){s+="?$expand=Bags/Properties,PageChipInstances/Chip/ChipBags/ChipProperties,"+"PageChipInstances/RemoteCatalog,"+"PageChipInstances/ChipInstanceBags/ChipInstanceProperties"}else if(a!==""){s+=`?$expand=${a}`}c.read(s,t,n)};this.readPageSet=function(e,t,n,a){let s;const r=this;let o;a=a===undefined?true:a;if(!e){throw new i("Missing page set ID","PageBuildingService")}s=`PageSets('${encodeURIComponent(e)}')?$expand=`+"Pages/PageChipInstances/Chip/ChipBags/ChipProperties,"+"Pages/PageChipInstances/RemoteCatalog,"+"Pages/PageChipInstances/ChipInstanceBags/ChipInstanceProperties,"+"AssignedPages,"+"DefaultPage";if(this.readPageSet.cacheBusterTokens&&this.readPageSet.cacheBusterTokens.get(e)){s+=`&sap-cache-id=${this.readPageSet.cacheBusterTokens.get(e)}`}if(this.readPageSet.appendedParameters){o=Object.keys(this.readPageSet.appendedParameters);if(o.length>0){o.sort();o.forEach(e=>{s+=`&${encodeURIComponent(e)}=${encodeURIComponent(r.readPageSet.appendedParameters[e])}`})}}c.read(s,t,n,a)};this.updatePageSet=function(e,t,n){c.update(e,t,n)};this.createPageInPageSet=function(e,t,n,a,s){if(!e){throw new i("Missing page set ID","PageBuildingService")}c.create(`PageSets('${encodeURIComponent(e)}')/Pages`,{catalogId:n||"",layout:"",title:t||""},a,s)};this.updatePage=function(e,t,n){c.update(e,t,n)};this.deletePage=function(e,t,n){if(!e){throw new i("Missing page ID","PageBuildingService")}c.del(`Pages('${encodeURIComponent(e)}')`,t,n)};this.createPageChipInstance=function(e,t,n,i,a,s,r,o){this.createPageChipInstanceFromRawData({pageId:e,instanceId:t,chipId:n,title:i,configuration:a,layoutData:s},r,o)};this.createPageChipInstanceFromRawData=function(e,t,n){if(typeof e!=="object"){throw new i("Invalid raw data","PageBuildingService")}if(!e.pageId){throw new i("Missing page ID","PageBuildingService")}if(!e.chipId){throw new i("Missing CHIP ID","PageBuildingService")}e.instanceId=e.instanceId||"";e.title=e.title||"";e.configuration=e.configuration||"";e.layoutData=e.layoutData||"";c.create("PageChipInstances",e,t,n)};this.updatePageChipInstance=function(e,t,n){c.update(e,t,n)};this.deletePageChipInstance=function(e,t,n,a){if(!e){throw new i("Missing page ID","PageBuildingService")}if(!t){throw new i("Missing instance ID","PageBuildingService")}c.del(`PageChipInstances(pageId='${encodeURIComponent(e)}',instanceId='${encodeURIComponent(t)}')`,n,a)};this.updateBagProperties=function(e,t,n,a,s,r,o){const g=[];const d=[];let l;let p;let h;let u;const f="__metadata";function I(e){const t={__metadata:{type:e[f].type,uri:e[f].uri}};let n;for(n in e){if(Object.prototype.hasOwnProperty.call(e,n)&&n!==f&&n.indexOf("$")!==0&&typeof e[n]!=="object"){t[n]=e[n]}}return t}if(!e){throw new i("Missing parent object","PageBuildingService")}if(!t){throw new i("Missing bag ID","PageBuildingService")}if(typeof s==="function"){this.updateBagProperties(e,t,n,a,[],s,r);return}n=n||[];a=a||[];s=s||[];if(n.length===0&&a.length===0&&s.length===0){throw new i("No properties to update, create or reset","PageBuildingService")}for(l=0;l<n.length;l+=1){h=n[l];u=h[f].uri;p=u.indexOf(c.getBaseUrl());if(p>=0){u=u.slice(p+c.getBaseUrl().length)}g.push({requestUri:u,method:"PUT",data:I(h)})}u=e.instanceId?"ChipInstanceProperties":"Properties";for(l=0;l<a.length;l+=1){h=a[l];if(!h.name){throw new i("Missing property name","PageBuildingService")}if(e.instanceId){h.instanceId=e.instanceId;h.pageId=e.pageId}else{h.pageId=e.id}h.bagId=t;g.push({requestUri:u,method:"POST",data:h})}for(l=0;l<s.length;l+=1){h=s[l];u=h[f].uri;p=u.indexOf(c.getBaseUrl());if(p>=0){u=u.slice(p+c.getBaseUrl().length)}g.push({requestUri:u,method:"DELETE"});d.push({requestUri:u,method:"GET"})}this.batch(g,d,(e,t)=>{const i=e.slice(a.length+n.length);let s;for(s=0;s<i.length;s+=1){if(i[s]===undefined){if(typeof t[s]==="object"){i[s]=t[s]}}}if(r){r(e.slice(0,n.length),e.slice(n.length,a.length+n.length),i)}},o)};this.createProperty=function(e,t,n,a,s,r,o){if(!e){throw new i("Missing parent ID or object","PageBuildingService")}if(!t){throw new i("Missing bag ID","PageBuildingService")}if(!n){throw new i("Missing property name","PageBuildingService")}if(typeof s==="function"){this.createProperty(e,t,n,a,undefined,s,r);return}const g={bagId:t,name:n,pageId:e,translatable:s,value:a};if(typeof e!=="string"){if(e.instanceId){g.instanceId=e.instanceId;g.pageId=e.pageId}else{g.pageId=e.id}}c.create(g.instanceId?"ChipInstanceProperties":"Properties",g,r,o)};this.updateProperty=function(e,t,n){c.update(e,t,n)};this.deleteProperty=function(e,t,n){c.del(e,t,n)};this.readChip=function(e,t,n){if(!e){throw new i("Missing CHIP ID","PageBuildingService")}let a=`Chips('${encodeURIComponent(e)}')?$expand=ChipBags/ChipProperties`;if(o!==undefined){a=`${a}&sap-cache-id=${o}`}c.read(a,t,n)};if(typeof n==="string"){c=a._createODataWrapper(n,this)}else{c=n}this.readAllCatalogs.cacheBusterTokens=new e.Map;this.readPageSet.cacheBusterTokens=new e.Map;if(!c.isStickySessionEnabled()&&!r){c.enableStickySession()}t.call(this,c,s)}a._createODataWrapper=function(e,t){return new n(e,t,true)};a.createPageBuildingService=function(e,t,n,i){return new a(e,t,n,i)};return a});
//# sourceMappingURL=PageBuildingService.js.map