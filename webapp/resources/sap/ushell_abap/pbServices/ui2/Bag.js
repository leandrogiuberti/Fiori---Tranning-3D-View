// Copyright (c) 2009-2025 SAP SE, All Rights Reserved
sap.ui.define(["sap/ushell_abap/pbServices/ui2/Utils","sap/ushell_abap/pbServices/ui2/Error","sap/base/Log"],(e,t,n)=>{"use strict";function r(r,a,s,i){let u;let l=false;let o=false;const p=this;function c(){if(l){throw new t("The previous reset operation is not finished yet","Bag")}}function f(){if(o){throw new t("The previous save operation is not finished yet","Bag")}}function h(t,n){const r=t.Properties&&t.Properties.results||t.ChipInstanceProperties&&t.ChipInstanceProperties.results||t.ChipProperties&&t.ChipProperties.results||[];u=u||new e.Map;r.forEach(e=>{const t=e.name;let r;if(!n||n.containsKey(t)){r=u.put(t,e);e.$currentValue=r?r.$currentValue:e.value}});delete t.ChipInstanceProperties;delete t.ChipProperties;delete t.Properties}function g(t,n){if(t.length===0){u.keys().forEach(e=>{if(n===(u.get(e).translatable==="X")){t.push(e)}});return t}const r=new e.Map;t.forEach(e=>{r.put(e)});u.keys().forEach(e=>{if(n===(u.get(e).translatable==="X")){r.put(e)}});return r.keys()}function d(){if(a.instanceId){return{pageId:a.pageId,instanceId:a.instanceId}}return{id:a.pageId}}function b(e,n,r){let a;if(!e){throw new t("Property name must not be empty","sap.ushell_abap.pbServices.ui2.Bag")}if(typeof e!=="string"){throw new t("Property name must be a string","sap.ushell_abap.pbServices.ui2.Bag")}a=u.get(e);if(a&&a.translatable==="X"!==r){throw new t(`'${e}' already exists as a ${r?"non-translatable":"translatable text"} property`,"sap.ushell_abap.pbServices.ui2.Bag")}if(typeof n!=="string"){throw new t("Property value must be a string","sap.ushell_abap.pbServices.ui2.Bag")}c();if(!a){a={name:e,translatable:r?"X":" "};u.put(e,a)}a.$currentValue=n;return p}this.getId=function(){return a.id};this.getOwnPropertyNames=function(){return g([],false)};this.getOwnTextNames=function(){return g([],true)};this.getProperty=function(e,n){const r=u.get(e);if(r&&r.translatable==="X"){throw new t(`'${e}' is a translatable text property`,"sap.ushell_abap.pbServices.ui2.Bag")}if(r){return r.$currentValue}if(s){return s.getProperty(e,n)}return n};this.getPropertyNames=function(){const e=s?s.getPropertyNames():[];return g(e,false)};this.getText=function(e){const n=u.get(e);if(n&&n.translatable!=="X"){throw new t(`'${e}' is a non-translatable property`,"sap.ushell_abap.pbServices.ui2.Bag")}if(n){return n.$currentValue}if(s){return s.getText(e)}return e};this.getTextNames=function(){const e=s?s.getTextNames():[];return g(e,true)};this.reset=function(n,s){const o=d();const g=r.getPageBuildingService();function b(e){l=false;a=e;u=undefined;h(a);if(i){i(p)}n()}if(typeof n!=="function"){throw new t("Missing success handler","sap.ushell_abap.pbServices.ui2.Bag")}f();c();l=true;s=s||g.getDefaultErrorHandler();if(a.$tmp){e.callHandler(b.bind(null,a),s,true);return}g.deleteBag(o,a.id,()=>{a.$tmp=true;g.readBag(o,a.id,b,b.bind(null,a))},function(){l=false;s.apply(null,arguments)})};this.resetProperty=function(e){const t=u.get(e);if(t){t.$currentValue=undefined;if(!Object.prototype.hasOwnProperty.call(t,"value")){u.remove(e)}}return this};this.save=function(n,s){let l=0;const g=new e.Map;const b={};const y={};const w=d();const v=r.getPageBuildingService();if(typeof n!=="function"){throw new t("Missing success handler","sap.ushell_abap.pbServices.ui2.Bag")}if(typeof s!=="function"){throw new t("Missing error handler","sap.ushell_abap.pbServices.ui2.Bag")}f();c();v.openBatchQueue();u.keys().forEach(e=>{let t;const n=u.get(e);function r(t,n){b[e]=t;y[e]=n}if(n.$currentValue!==n.value){l+=1;if(Object.prototype.hasOwnProperty.call(n,"value")){if(n.$currentValue===undefined){g.put(e);v.deleteProperty(n,()=>{if(n.$currentValue===undefined){u.remove(e)}else{delete n.value}},r)}else{t=JSON.parse(JSON.stringify(n));t.value=n.$currentValue;v.updateProperty(t,()=>{n.value=t.value},r)}}else{v.createProperty(w,a.id,e,n.$currentValue,n.translatable,t=>{t.$currentValue=n.$currentValue;u.put(e,t)},r)}}});if(g.keys().length){v.readBag(w,a.id,e=>{h(e,g)})}o=true;v.submitBatchQueue(()=>{o=false;if(i&&l>Object.keys(b).length){i(p)}if(Object.keys(b).length>0){s(b,y)}else{a.$tmp=false;n()}})};this.setProperty=function(e,t){return b(e,t,false)};this.setText=function(e,t){return b(e,t,true)};this.toString=function(e){const t=['Bag({id:"',a.id,'",pageId:"',a.pageId];if(a.instanceId){t.push('",instanceId:"',a.instanceId)}t.push('"');if(e){t.push(",oAlterEgo:",JSON.stringify(a));t.push(",oPropertiesByName:",u.toString());t.push(",bResetting:",l);t.push(",bSaving:",o)}t.push("})");return t.join("")};this.update=function(e){if(!e||a.id!==e.id){throw new t("Bag data belongs to another bag","sap.ushell_abap.pbServices.ui2.Bag")}u=undefined;h(e)};this._getChangeHandler=function(){return i};this._getRawBagData=function(){return a};this._getParentBag=function(){return s};h(a);n.debug(`Created: ${this}`,null,"sap.ushell_abap.pbServices.ui2.Bag")}return r});
//# sourceMappingURL=Bag.js.map