// Copyright (c) 2009-2025 SAP SE, All Rights Reserved
sap.ui.define(["sap/ushell_abap/bootstrap/evo/abap.xhrlogon.LibLoader","./abap.bootstrap.utils","./abap.request.startup","./abap.request.pageset","./abap.xhrlogon.handler","./abap.theme.handler","sap/ushell/EventHub","sap/ui/performance/trace/initTraces","sap/base/util/ObjectPath","sap/base/Log","sap/ushell_abap/pbServices/ui2/Utils","sap/ushell/bootstrap/common/common.util","./SAPCompanionConditionSetter","sap/ushell/utils/UrlParsing"],(e,t,a,n,i,s,r,o,l,c,u,p,g,f)=>{"use strict";const m={};const h=new RegExp("^(#)?([A-Za-z0-9_]+)-([A-Za-z0-9_]+)");let d;let b;function v(e){function t(e){if(!e){return false}return e.indexOf("Shell-home")===0||e.indexOf("Launchpad-openFLPPage")===0||e.indexOf("Shell-appfinder")===0||e.indexOf("Shell-catalog")===0||e.indexOf("shell-catalog")===0||e.indexOf("Action-search")===0}function a(){return window["sap-ushell_abap-bootstrap-abap-noInitialTarget"]!==undefined}const n=e.match(h);const i=n&&n[2];const s=n&&n[3];const r=e&&!t(e)&&!a()&&i&&s;return r}function P(){const e=t.getLocationHref();const a=e.indexOf("#");if(a<0){return""}const n=decodeURI(e.slice(a+1));return n}function S(){const e=P();const t=e.indexOf("&/");return t<0?e:e.slice(0,t)}function C(){return sap.ui.require("sap/ushell/Container")}function y(e){const t=e.match(h);return t?{semanticObject:t[2],action:t[3]}:undefined}function F(e){if(!e||e==="#"){return true}return e.indexOf("Shell-home")===0||e.indexOf("Launchpad-openFLPPage")===0||e.indexOf("Shell-appfinder")===0||e.indexOf("Shell-catalog")===0||e.indexOf("shell-catalog")===0}function A(e){if(e===undefined){return undefined}try{return JSON.parse(JSON.stringify(e))}catch(e){c.error("Could not clone object",e,"sap.ushell_abap.bootstrap");return undefined}}function w(e){return e.indexOf("sap_")===0}function T(e,t){c.debug("setSapui5Settings()",JSON.stringify(e),"sap.ushell_abap.bootstrap.abap");const a=sap.ui.require("sap/base/i18n/Formatting");const n=sap.ui.require("sap/base/i18n/Localization");if(e.language){n.setLanguage(e.language,e.ABAPLanguage)}if(e.legacyDateFormat){a.setABAPDateFormat(e.legacyDateFormat)}if(e.legacyDateCalendarCustomizing){a.setCustomIslamicCalendarData(e.legacyDateCalendarCustomizing)}if(e.legacyNumberFormat){a.setABAPNumberFormat(e.legacyNumberFormat)}if(e.legacyTimeFormat){a.setABAPTimeFormat(e.legacyTimeFormat)}if(typeof t==="object"){a.addCustomCurrencies(t)}if(e.useTimeZoneIana&&e.timeZoneIana!==""){n.setTimezone(e.timeZoneIana)}}function _(e){(l.get("sap-ushell-config.services.Container.adapter.config")||l.create("sap-ushell-config.services.Container.adapter.config")).bootTheme=A(e)}function x(e){if(!e){c.error("extractSystemThemeRoot: mandatory parameter oStartupServiceResult not supplied")}if(e.themeRoot){return e.themeRoot}if(e.client){c.warning("Theme root was not contained in startup service result. A fallback to /sap/public/bc/themes/~client-<client number> is used",null,"sap.ushell_abap.bootstrap");return`/sap/public/bc/themes/~client-${e.client}`}c.error("extractSystemThemeRoot: Could not determine system theme root")}function L(e){let t;let a;if(e&&e.userProfile&&e.userProfile.filter){t=e.userProfile.filter(e=>e.id==="THEME");a=t.length?t[0]:{};if(a.value){return a.value}}if(e&&e.theme){return e.theme}return""}function I(e,t){if(e&&w(e)){return""}return t}function R(e,t){const a=L(e);return{theme:a,root:I(a,t)}}function O(e){let a;const n=t.getUrlParameterValue("sap-theme")||t.getUrlParameterValue("sap-ui-theme");if(n){if(n.indexOf("@")>0){a=n.split("@",2);return{theme:a[0],root:a[1]}}return{theme:n,root:I(n,e)}}return undefined}function H(){const e=u.getParameterMap();return e["sap-theme"]?.[0]||e["sap-ui-theme"]?.[0]}function D(e){const t=e;const a=e.indexOf("@");if(a>=0){const e=t.slice(a+1);return s.isThemeRootSafe(e)}return true}function M(e,t){let a;const n={};let i;const s=H();if(s&&D(s)){a=O(t);i=a;c.debug(`theme: URL theme = "${i.theme}"  theme root = "${i.root}"`,null,"sap.ushell_abap.bootstrap")}else if(e){i=e;c.debug(`theme: startup service theme = "${i.theme}"  theme root = "${i.root}"`,null,"sap.ushell_abap.bootstrap");if(s){const e=i.theme;sap.ui.require("sap/ui/core/Core").ready(()=>sap.ui.require("sap/ui/core/Theming").setTheme(e))}}else{n.theme=l.get("sap-ui-config.theme");if(n.theme){n.root=l.get(`sap-ui-config.themeRoots.${n.theme}`||"");if(!n.root){n.root=I(n.theme,t)}i={theme:n.theme,root:n.root};c.debug(`theme: html file theme = "${i.theme}"  theme root = "${i.root}"`,null,"sap.ushell_abap.bootstrap")}else{i={theme:"",root:""};c.error("Could not determine theme",null,"sap.ushell_abap.bootstrap")}}_(i);return i}function q(e){const a=u.getParameterMap();const n=t.getUrlParameterValue("sap-locale",a);const i={services:{}};const s=l.get("sap-ushell-config.services.SupportTicket.config.enabled");if(s!==false){i.services.SupportTicket={config:{enabled:e.isEmbReportingActive===true}}}i.services.ClientSideTargetResolution={adapter:{config:{services:{targetMappings:e?.services?.targetMappings}}}};i.services.LaunchPage={adapter:{config:{services:{targetMappings:e?.services?.targetMappings,launchPage:e?.services?.pbFioriHome}}}};i.services.VisualizationDataProvider={adapter:{module:"sap.ushell_abap.adapters.abap.FlpLaunchPageAdapter",config:{services:{targetMappings:e?.services?.targetMappings,launchPage:e?.services?.pbFioriHome}}}};i.services.PageBuilding={adapter:{config:{services:{pageBuilding:e?.services?.pbFioriHome}}}};i.services.Personalization={adapter:{config:{services:{personalization:e?.services?.personalization}}}};let r={};if(!n){r={language:e.languageBcp47||e.language,ABAPLanguage:e.language,legacyDateFormat:e.dateFormat,legacyDateCalendarCustomizing:e.tislcal,legacyNumberFormat:e.numberFormat===""?" ":e.numberFormat,legacyTimeFormat:e.timeFormat}}let o=l.get("sap-ushell-config.ui5.timeZoneFromServerInUI5");if(o===undefined){o=false;l.set("startupConfig.timeZoneFromServerInUI5",o,i);l.set("ushell.ui5.timeZoneFromServerInUI5",o)}let c=l.get("sap-ushell-config.startupConfig.timeZone");if(c===undefined){c="";l.set("startupConfig.timeZone",c,i)}r.useTimeZoneIana=o;r.timeZoneIana=c;const g=p.getV2ServiceMigrationConfig(i);p.mergeConfig(window["sap-ushell-config"],g,true);p.mergeConfig(window["sap-ushell-config"],i,true);M(b,d);T(r,e.currencyFormats)}function z(e){const t=m._getShellHash();const n=P();const i=y(t);const s=[i];const r={};const o={};let c;const u=l.get("sap-ushell-config.services.AppState.config")||l.create("sap-ushell-config.services.AppState.config");const p=l.get("sap-ushell-config.services.ClientSideTargetResolution.adapter.config")||l.create("sap-ushell-config.services.ClientSideTargetResolution.adapter.config");function g(e,t){const a=t.match(e);let n=[];if(!a){return}n=a[2].toString().split("=");o[n[0]]=n[1]}function f(e,t,a,n,i){if(t&&t[i]&&a&&a[n]){e[a[n]]=t[i]}}if(v(t)){g(/(\?|&)(sap-xapp-state=[A-Z0-9]+)/,t);g(/(\?|&)(sap-intent-param=[A-Z0-9]+)/,t);g(/(\?|&)(sap-system=[A-Z0-9]+)/,t);g(/(\?|&|[/])(sap-iapp-state=[A-Z0-9]+)/,n);c=a.requestDirectStart(e,i,o);u.initialAppStatesPromise=c.then(e=>{f(r,e,o,"sap-intent-param","iparState");f(r,e,o,"sap-iapp-state","iappState");f(r,e,o,"sap-xapp-state","xappState");u.initialAppStates=r;return Promise.resolve(r)});p.initialSegmentPromise=c.then(e=>{if(e.targetMappings){return Promise.resolve([s,e.targetMappings,e.systemAliases,e.urlTemplates])}return Promise.resolve(null)})}else{u.initialAppStatesPromise=Promise.resolve({});p.initialSegmentPromise=Promise.resolve(null)}}function Z(){const e=new Promise((e,t)=>{let a;function n(){c.info("Direct application start: resolving component waitFor promise after shell renderer created event fired.");e();C().detachRendererCreatedEvent(n)}r.once("ShellNavigationInitialized").do(()=>{a=C().getRendererInternal();if(a){c.info("Direct application start: resolving component waitFor promise immediately (shell renderer already created).");e()}else{C().attachRendererCreatedEvent(n)}})});return e}function N(){g.run().catch(()=>{c.info("SAPCompanion conditions could not be set.")});const t=m._getShellHash();if(F(t)&&window["sap-ushell-config"].ushell&&window["sap-ushell-config"].ushell.spaces&&window["sap-ushell-config"].ushell.spaces.enabled){m._loadPage(t)}e.getLib().then(e=>{const t=e.FrameLogonManager.getInstance();C().oFrameLogonManager=t});if(v(t)){let e;let t;window["sap-ushell-async-libs-promise-directstart"]=new Promise((a,n)=>{e=a;t=n});window["sap-ushell-async-libs-promise-directstart"].catch(e=>{});C().getServiceAsync("NavTargetResolutionInternal").then(a=>{const n=`#${m._getShellHash()}`;a.resolveHashFragment(n).done(a=>{sap.ui.require(["sap/ushell/services/AppConfiguration"],i=>{i.setCurrentApplication(a);if(a&&a.ui5ComponentName){const i=f.getBasicHash(n);a.ui5ComponentId=`application-${i}-component`;C().getServiceAsync("Ui5ComponentLoader").then(i=>{i.createComponent(a,y(n),Z(),"Application").then(t=>{e({resolvedHashFragment:t,dependenciesLoaded:true})}).catch(e=>{t(e)})})}else{e({resolvedHashFragment:a,dependenciesLoaded:false})}})}).fail(e=>{t(e)})})}}function B(e){if(e&&e.indexOf("Shell-appfinder")===0){return}C().getServiceAsync("PersonalizationV2").then(async e=>{const t={container:"sap.ushell.cdm3-1.personalization",item:"data"};const a={validity:"Infinity",keyCategory:e.KeyCategory.GENERATED_KEY,writeFrequency:e.WriteFrequency.HIGH,clientStorageAllowed:false};const n=await e.getPersonalizer(t,a);return n.getPersData()});sap.ui.require(["sap/ushell/components/pages/controller/PagesAndSpaceId","sap/ushell/resources"],async(t,a)=>{await a.awaitResourceBundle();const n=t.getPageAndSpaceId(e);const i=C().getServiceAsync("PagePersistence");Promise.all([n,i]).then(e=>{const t=e[0];const a=e[1];a.getPage(t.pageId)}).catch(e=>{c.error("getPage failed",e)})})}function E(e){i.initXhrLogon(window["sap-ushell-config"]);o();a.requestStartupConfig().catch(e=>{c.error("start_up request failed:",e,"sap.ushell_abap.bootstrap");return{}}).then(e=>{const t=m._getShellHash();(l.get("sap-ushell-config.services.Container.adapter")||l.create("sap-ushell-config.services.Container.adapter")).config=e;const i=l.get("sap-ushell-config.services.LaunchPage.adapter.config")||l.create("sap-ushell-config.services.LaunchPage.adapter.config");const s=l.get("sap-ushell-config.services.ClientSideTargetResolution.adapter.config")||l.create("sap-ushell-config.services.ClientSideTargetResolution.adapter.config");if(l.get("sap-ushell-config.ushell.spaces.enabled")){l.set("sap-ushell-config.services.VisualizationDataProvider.adapter.config",i);l.set("sap-ushell-config.services.NavigationDataProvider.adapter.config",s)}z(e);d=x(e);b=R(e,d);if(!H()&&b){c.debug("theme: load theme from startup service via window",null,"sap.ushell_abap.bootstrap")}if(F(t)&&!l.get("sap-ushell-config.ushell.spaces.enabled")){n.requestPageSet(e)}const r=a.requestFullTM(e);s.navTargetDataPromise=r;i.compactTMPromise=r;l.set("sap-ushell-config.services.FlpLaunchPage.adapter.config.compactTMPromise",r);return Promise.resolve(e)}).then(t=>{q(t);e()})}m.start=E;m.afterBootstrap=N;m._getShellHash=S;m._getFullShellHash=P;m._createWaitForRendererCreatedPromise=Z;m._loadPage=B;return m});
//# sourceMappingURL=boottask.js.map