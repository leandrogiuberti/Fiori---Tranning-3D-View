{"version":3,"names":["NavType","NavLibrary","VariantManagementType","CoreLibrary","VariantManagement","TemplateContentView","ViewStateOverride","adaptApplyStateNavParams","oNavParameter","applyVariantFromURLParams","applyInitialStateOnly","onBeforeStateApplied","aPromises","navigationType","oView","getView","oController","getController","oFilterBar","_getFilterBarControl","aTables","_getControls","setSuspendSelection","push","waitForInitialization","hybrid","_clearFilterConditions","forEach","oTable","initialized","adaptBindingRefreshControls","aControls","base","aViewControls","aControlsToRefresh","KeepAliveHelper","getControlsForRefresh","Array","prototype","apply","adaptStateControls","aStateControls","oFilterBarVM","_getFilterBarVM","_isMultiMode","_getMultiModeControl","_hasMultiVisualizations","_getSegmentedButton","Chart","Table","byId","retrieveAdditionalStates","mAdditionalStates","sAlpContentView","getBindingContext","getProperty","alpContentView","applyAdditionalStates","oAdditionalStates","oInternalModelContext","Device","system","desktop","Hybrid","getModel","setProperty","getPath","view","variantManagement","viewData","getViewData","Page","Control","_getFilterBarVariantControl","None","_fnClearStateBeforexAppNav","StateUtil","retrieveExternalState","then","oExternalState","oCondition","filter","field","condition","catch","oError","Log","error","aItems","oClearConditions","applyExternalState","items"],"sourceRoot":".","sources":["ViewState.ts"],"sourcesContent":["import Log from \"sap/base/Log\";\nimport type ViewState from \"sap/fe/core/controllerextensions/ViewState\";\nimport type { NavigationParameter } from \"sap/fe/core/controllerextensions/ViewState\";\nimport KeepAliveHelper from \"sap/fe/core/helpers/KeepAliveHelper\";\nimport type { InternalModelContext } from \"sap/fe/core/helpers/ModelHelper\";\nimport CoreLibrary from \"sap/fe/core/library\";\nimport type { PropertyInfo } from \"sap/fe/macros/DelegateUtil\";\nimport NavLibrary from \"sap/fe/navigation/library\";\nimport type { default as ListReportController } from \"sap/fe/templates/ListReport/ListReportController.controller\";\nimport Device from \"sap/ui/Device\";\nimport type Control from \"sap/ui/core/Control\";\nimport type UI5Element from \"sap/ui/core/Element\";\nimport type View from \"sap/ui/core/mvc/View\";\nimport type VariantManagement from \"sap/ui/fl/variants/VariantManagement\";\nimport type FilterBar from \"sap/ui/mdc/FilterBar\";\nimport type Table from \"sap/ui/mdc/Table\";\nimport StateUtil from \"sap/ui/mdc/p13n/StateUtil\";\n\ntype LRViewData = {\n\tcontrolConfiguration?: Record<string, Record<string, unknown>>;\n\tentitySet?: string;\n\tcontextPath?: string;\n\tvariantManagement?: boolean;\n};\n\nconst NavType = NavLibrary.NavType,\n\tVariantManagementType = CoreLibrary.VariantManagement,\n\tTemplateContentView = CoreLibrary.TemplateContentView;\n\n// eslint-disable-next-line @typescript-eslint/ban-ts-comment\n// @ts-ignore\nconst ViewStateOverride = {\n\tadaptApplyStateNavParams: function (oNavParameter: NavigationParameter): void {\n\t\t// Set applyVariantFromURLParams to true for ListReport\n\t\toNavParameter.applyVariantFromURLParams = true;\n\t},\n\tapplyInitialStateOnly: function (): boolean {\n\t\treturn true;\n\t},\n\tonBeforeStateApplied: function (\n\t\tthis: ViewState & typeof ViewStateOverride,\n\t\taPromises: Promise<unknown>[],\n\t\tnavigationType?: string\n\t): void {\n\t\tconst oView = this.getView(),\n\t\t\toController = oView.getController() as ListReportController,\n\t\t\toFilterBar = oController._getFilterBarControl(),\n\t\t\taTables = oController._getControls(\"table\") as Table[];\n\t\tif (oFilterBar) {\n\t\t\toFilterBar.setSuspendSelection(true);\n\t\t\taPromises.push(oFilterBar.waitForInitialization());\n\t\t\t//This is required to remove any existing or default filter conditions before restoring the filter bar state in hybrid navigation mode.\n\t\t\tif (navigationType === NavType.hybrid) {\n\t\t\t\tthis._clearFilterConditions(oFilterBar);\n\t\t\t}\n\t\t}\n\t\taTables.forEach(function (oTable: Table): void {\n\t\t\taPromises.push((oTable as unknown as { initialized: () => Promise<unknown> }).initialized());\n\t\t});\n\t},\n\tadaptBindingRefreshControls: function (this: ViewState, aControls: Control[]): void {\n\t\tconst oView = this.base.getView(),\n\t\t\toController = oView.getController() as ListReportController,\n\t\t\taViewControls = oController._getControls(),\n\t\t\taControlsToRefresh = KeepAliveHelper.getControlsForRefresh(oView, aViewControls);\n\n\t\tArray.prototype.push.apply(aControls, aControlsToRefresh);\n\t},\n\tadaptStateControls: function (this: ViewState & typeof ViewStateOverride, aStateControls: UI5Element[]): void {\n\t\tconst oView = this.base.getView(),\n\t\t\toController = oView.getController() as ListReportController;\n\t\tconst oFilterBarVM = this._getFilterBarVM(oView);\n\t\tif (oFilterBarVM) {\n\t\t\taStateControls.push(oFilterBarVM);\n\t\t}\n\t\tif (oController._isMultiMode()) {\n\t\t\taStateControls.push(oController._getMultiModeControl());\n\t\t}\n\t\tif (oController._hasMultiVisualizations()) {\n\t\t\taStateControls.push(oController._getSegmentedButton(TemplateContentView.Chart)!);\n\t\t\taStateControls.push(oController._getSegmentedButton(TemplateContentView.Table)!);\n\t\t}\n\t\taStateControls.push(oView.byId(\"fe::ListReport\")!);\n\t},\n\tretrieveAdditionalStates: function (\n\t\tthis: ViewState & typeof ViewStateOverride,\n\t\tmAdditionalStates: { dataLoaded: boolean; alpContentView: string }\n\t): void {\n\t\tconst oView = this.getView(),\n\t\t\toController = oView.getController() as ListReportController;\n\n\t\tif (oController._hasMultiVisualizations()) {\n\t\t\tconst sAlpContentView = oView.getBindingContext(\"internal\")!.getProperty(\"alpContentView\");\n\t\t\tmAdditionalStates.alpContentView = sAlpContentView;\n\t\t}\n\t},\n\tapplyAdditionalStates: function (\n\t\tthis: ViewState & typeof ViewStateOverride,\n\t\toAdditionalStates?: { dataLoaded: boolean; alpContentView?: string }\n\t): void {\n\t\tconst oView = this.getView(),\n\t\t\toController = oView.getController() as ListReportController;\n\n\t\tif (oAdditionalStates) {\n\t\t\tif (oController._hasMultiVisualizations()) {\n\t\t\t\tconst oInternalModelContext = oView.getBindingContext(\"internal\") as InternalModelContext;\n\t\t\t\tif (!Device.system.desktop && oAdditionalStates.alpContentView == TemplateContentView.Hybrid) {\n\t\t\t\t\toAdditionalStates.alpContentView = TemplateContentView.Chart;\n\t\t\t\t}\n\t\t\t\toInternalModelContext\n\t\t\t\t\t.getModel()\n\t\t\t\t\t.setProperty(`${oInternalModelContext.getPath()}/alpContentView`, oAdditionalStates.alpContentView);\n\t\t\t}\n\t\t}\n\t},\n\t/************************************* private helper *****************************************/\n\n\t/**\n\t * Variant management used by filter bar.\n\t * @param view View of the LR filter bar\n\t * @returns VariantManagement if used\n\t */\n\t_getFilterBarVM: (view: View): VariantManagement | undefined => {\n\t\tlet variantManagement;\n\t\tconst viewData = view.getViewData() as LRViewData;\n\t\tswitch (viewData.variantManagement) {\n\t\t\tcase VariantManagementType.Page:\n\t\t\t\tvariantManagement = view.byId(\"fe::PageVariantManagement\");\n\t\t\t\tbreak;\n\t\t\tcase VariantManagementType.Control:\n\t\t\t\tvariantManagement = (view.getController() as ListReportController)._getFilterBarVariantControl();\n\t\t\t\tbreak;\n\t\t\tcase VariantManagementType.None:\n\t\t\tdefault:\n\t\t\t\tbreak;\n\t\t}\n\t\treturn variantManagement as VariantManagement | undefined;\n\t},\n\n\t/*\n\t * Sets filtered: false flag to every field so that it can be cleared out\n\t *\n\t * @param oFilterBar filterbar control is used to display filter properties in a user-friendly manner to populate values for a query\n\t * @returns promise which will be resolved to object\n\t * @private\n\t */\n\t_fnClearStateBeforexAppNav: async function (oFilterBar: FilterBar): Promise<unknown> {\n\t\treturn StateUtil.retrieveExternalState(oFilterBar)\n\t\t\t.then((oExternalState: { filter: Record<string, Record<string, boolean>[]> }) => {\n\t\t\t\tconst oCondition = oExternalState.filter;\n\t\t\t\tfor (const field in oCondition) {\n\t\t\t\t\tif (field !== \"$editState\" && field !== \"$search\" && oCondition[field]) {\n\t\t\t\t\t\toCondition[field].forEach((condition: Record<string, boolean>) => {\n\t\t\t\t\t\t\tcondition[\"filtered\"] = false;\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\treturn oCondition;\n\t\t\t})\n\t\t\t.catch(function (oError: unknown): void {\n\t\t\t\tLog.error(\"Error while retrieving the external state\", oError as string);\n\t\t\t});\n\t},\n\n\t_clearFilterConditions: async function (oFilterBar: FilterBar): Promise<unknown> {\n\t\tconst aItems: PropertyInfo[] = [];\n\t\treturn oFilterBar.waitForInitialization().then(async () => {\n\t\t\tconst oClearConditions = await this._fnClearStateBeforexAppNav(oFilterBar);\n\t\t\treturn StateUtil.applyExternalState(oFilterBar, {\n\t\t\t\tfilter: oClearConditions,\n\t\t\t\titems: aItems\n\t\t\t});\n\t\t});\n\t}\n};\n\nexport default ViewStateOverride;\n"],"mappings":"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","ignoreList":[],"file":"ViewState-dbg.js"}