/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)
 *      (c) Copyright 2009-2025 SAP SE. All rights reserved
 */
sap.ui.define(["sap/base/Log","sap/fe/base/ClassSupport","sap/fe/core/CommonUtils","sap/fe/core/converters/MetaModelConverter","sap/fe/core/helpers/MessageStrip","sap/fe/core/helpers/ResourceModelHelper","sap/ui/core/Control","sap/ui/core/Element","sap/ui/model/json/JSONModel"],function(e,t,n,r,i,o,s,l,a){"use strict";var u,c,f,d,h,g,p,b,C,y,m,I,T,_,v,F,w,S,A;function O(e){return new Promise((t,n)=>{sap.ui.require([e],n=>{if(!(n&&n.__esModule)){n=n===null||!(typeof n==="object"&&e.endsWith("/library"))?{default:n}:n;Object.defineProperty(n,"__esModule",{value:true})}t(n)},e=>{n(e)})})}var z=o.getResourceModel;var M=t.property;var P=t.event;var E=t.defineUI5Class;var V=t.association;var R=t.aggregation;function K(e,t,n,r){n&&Object.defineProperty(e,t,{enumerable:n.enumerable,configurable:n.configurable,writable:n.writable,value:n.initializer?n.initializer.call(r):void 0})}function B(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e,D(e,t)}function D(e,t){return D=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},D(e,t)}function L(e,t,n,r,i){var o={};return Object.keys(r).forEach(function(e){o[e]=r[e]}),o.enumerable=!!o.enumerable,o.configurable=!!o.configurable,("value"in o||o.initializer)&&(o.writable=!0),o=n.slice().reverse().reduce(function(n,r){return r(e,t,n)||n},o),i&&void 0!==o.initializer&&(o.value=o.initializer?o.initializer.call(i):void 0,o.initializer=void 0),void 0===o.initializer?(Object.defineProperty(e,t,o),null):o}function N(e,t){throw Error("Decorating class property failed. Please ensure that transform-class-properties is enabled and runs after the decorators transform.")}var j=function(e){e["Suspend"]="suspendBinding";e["Resume"]="resumeBinding";return e}(j||{});let U=(u=E("sap.fe.templates.ListReport.controls.MultipleModeControl"),c=M({type:"boolean"}),f=M({type:"boolean",defaultValue:false}),d=M({type:"boolean",defaultValue:false}),h=M({type:"boolean",defaultValue:false}),g=R({type:"sap.m.IconTabBar",multiple:false,isDefault:true}),p=V({type:"sap.ui.core.Control",multiple:true}),b=V({type:"sap.fe.macros.controls.FilterBar",multiple:false}),C=P(),u(y=(m=function(t){function o(e,n){var r;r=t.call(this,e,n)||this;K(r,"showCounts",I,r);K(r,"setVisibleOverridden",T,r);K(r,"freezeContent",_,r);K(r,"countsOutDated",v,r);K(r,"content",F,r);K(r,"innerControls",w,r);K(r,"filterControl",S,r);K(r,"select",A,r);return r}B(o,t);var s=o.prototype;s.onBeforeRendering=function e(){this.getTabsModel();const t=this._getFilterControl();if(!t){this.setCountsOutDated(true)}const n=t?.getParent();this.getAllInnerControls().forEach(e=>{if(this.showCounts){e.attachEvent("internalDataRequested",this.internalRefreshTabsCount.bind(this))}e.suspendBinding?.()});if(n){n.attachEvent("internalSearch",this._onSearch.bind(this));n.attachEvent("internalFilterChanged",this._onFilterChanged.bind(this))}};s.onAfterRendering=function e(){this.getSelectedInnerControl()?.resumeBinding?.(!this.getProperty("freezeContent"));if(this.showCounts&&!this.setVisibleOverridden){this.setProperty("setVisibleOverridden",true);this.getAllInnerControls().forEach(e=>{const t=this._getTabFromInnerControl(e);if(!t)return;const n=t.setVisible;t.setVisible=r=>{if(t.getVisible()===false&&r){this.refreshTabCount(e)}return n.bind(t)(r)}})}};o.render=function e(t,n){t.renderControl(n.content)};s.getTabsModel=function e(){const t="tabsInternal";const n=this.content;if(!n){return undefined}let r=n.getModel(t);if(!r){r=new a({});n.setModel(r,t)}return r};s.getSelectedInnerControl=function e(){const t=this.content?.getItems().find(e=>e.getKey()===this.content.getSelectedKey());return t?this.getAllInnerControls().find(e=>this._getTabFromInnerControl(e)===t):undefined};o.handleTabChange=function e(t){const n=t.getSource();const r=n.getParent();const i=t.getParameters();r._setInnerBinding(true);const s=i?.previousKey;const l=i?.selectedKey;let a;if(l&&s!==l){const e=r._getFilterControl();if(e&&!r.getProperty("freezeContent")){if(!r.getSelectedInnerControl()){r._refreshCustomView(e.getFilterConditions(),"tabChanged")}}a=o.handlePersonalizationUpdate(l,s,n)}r._getViewController()?.getExtensionAPI()?.updateAppState();r.fireEvent("select",{iconTabBar:n,selectedKey:l,previousKey:s});return a};o.handlePersonalizationUpdate=async function t(n,r,i){try{const e=(await O("sap/ui/fl/write/api/ControlPersonalizationWriteAPI")).default;e.add({changes:[{changeSpecificData:{changeType:"selectIconTabBarFilter",content:{selectedKey:n,previousSelectedKey:r}},selectorElement:i}]})}catch(t){e.error("Something went wrong while updating the personalization state of the MultipleModeControl",t)}};s.refreshSelectedInnerControlContent=function e(){if(this.getSelectedInnerControl()){this.getSelectedInnerControl()?.invalidateContent?.();this.getSelectedInnerControl()?.resumeBinding?.(true)}else{this._refreshCustomView(undefined,"forcedRefresh")}};s.invalidateContent=function e(t){this.setCountsOutDated(true);this.getAllInnerControls().forEach(e=>{if(t){const n=this._getTabFromInnerControl(e);for(const r of t){if(n&&(n.getKey()===`fe::table::${r}::LineItem`||n.getKey()===`fe::CustomTab::${r}`)){e.invalidateContent?.()}}}else{e.invalidateContent?.()}})};s.setCountsOutDated=function e(){let t=arguments.length>0&&arguments[0]!==undefined?arguments[0]:true;this.setProperty("countsOutDated",t);if(t&&!this.getSelectedInnerControl()){this.internalRefreshTabsCount()}};s.setFreezeContent=function e(t){this.setProperty("freezeContent",t);this._setInnerBinding()};s._updateMultiTabNotApplicableFields=function e(){const t=this.getTabsModel();const r=this._getFilterControl();if(t&&r){const e={};const i=n.getTargetView(this);const o=i.getViewData();if(!o.useHiddenFilterBar){this.getAllInnerControls().forEach(t=>{const n=this._getTabFromInnerControl(t);if(n){const i=n.getKey();const o=t.refreshNotApplicableFields?.(r)||[];e[i]={notApplicable:{fields:o,title:this._setTabMessageStrip({entityTypePath:r.data("entityType"),ignoredFields:o,title:n.getText()})}};if(t&&t.isA("sap.fe.macros.Chart")){e[i]=this.checkNonFilterableEntitySet(t,i,e)}}});t.setData(e)}}};s.checkNonFilterableEntitySet=function e(t,n,i){const o=z(t);const s=t?.getContent?t.getContent():undefined;const l=s&&r.getInvolvedDataModelObjects(s.getModel().getMetaModel().getContext(`${s.data("targetCollectionPath")}`))?.targetObject?.annotations?.Capabilities?.FilterRestrictions?.Filterable;if(l!==undefined&&!l){if(i[n].notApplicable.fields.includes("$search")){i[n].notApplicable.title+=" "+o.getText("C_LR_MULTIVIZ_CHART_MULTI_NON_FILTERABLE")}else{i[n].notApplicable.fields=["nonFilterable"];i[n].notApplicable.title=o.getText("C_LR_MULTIVIZ_CHART_MULTI_NON_FILTERABLE")}}return i[n]};s.getAllInnerControls=function e(){let t=arguments.length>0&&arguments[0]!==undefined?arguments[0]:false;return this.innerControls.reduce((e,n)=>{const r=l.getElementById(n);if(r){e.push(r)}return e.filter(e=>!t||this._getTabFromInnerControl(e)?.getVisible())},[])||[]};s._getFilterControl=function e(){return l.getElementById(this.filterControl)};s._getTabFromInnerControl=function e(t){let n=t;if(n&&!n.isA("sap.m.IconTabFilter")&&n.getParent){n=t.getParent()}return n&&n.isA("sap.m.IconTabFilter")?n:undefined};s._getViewController=function e(){const t=n.getTargetView(this);return t&&t.getController()};s._refreshCustomView=function e(t,n){this._getViewController()?.onViewNeedsRefresh?.({filterConditions:t,currentTabId:this.content.getSelectedKey(),refreshCause:n})};s.refreshTabCount=function t(n){const r=this._getTabFromInnerControl(n);if(!r){return}if(n?.getCounts){r.setCount("...");n.getCounts().then(e=>r.setCount(e||"0")).catch(function(t){e.error(`Error while requesting Counts for Control: ${t}`)})}};s.internalRefreshTabsCount=function e(t){const n=t?.getSource();const r=n?this._getTabFromInnerControl(n)?.getKey():this.content?.getSelectedKey();if(typeof r==="string"){if(r===""){const e=this.content?.getItems().map(e=>e.getKey().split("::")[2])??[];this.refreshTabsCount(e)}else{this.refreshTabsCount([r.split("::")[2]])}}};s.refreshTabsCount=function e(t){if(!t){this.setCountsOutDated(true)}this.getAllInnerControls(true).forEach(e=>{const n=this._getTabFromInnerControl(e);if(this.countsOutDated||t&&n&&t.includes(n.getKey().split("::")[2])){this.refreshTabCount(e)}});this.setCountsOutDated(false)};s.setTabContentToBeRefreshedOnNextOpening=function e(t){const n=this?.content.getSelectedKey();const r=[];const i=t?t.includes(n?.split("::")[2]):true;if(t){for(const e of t){if(n!==`fe::table::${e}::LineItem`&&n!==`fe::CustomTab::${e}`){r.push(e)}}}else{this?.getAllInnerControls().forEach(e=>{const t=this?._getTabFromInnerControl(e);if(t&&t.getKey()!==n){r.push(t.getKey().split("::")[2])}})}this?.invalidateContent(r);if(i){this?.refreshSelectedInnerControlContent()}};s._setInnerBinding=function e(){let t=arguments.length>0&&arguments[0]!==undefined?arguments[0]:false;if(this.content){this.getAllInnerControls().forEach(e=>{const n=this._getTabFromInnerControl(e);const r=n?.getKey()===this.content.getSelectedKey();const i=r&&!this.getProperty("freezeContent")?j.Resume:j.Suspend;e[i]?.(i===j.Resume?t&&r:undefined)})}};s._setTabMessageStrip=function e(t){let n="";const r=t.ignoredFields;const o=this._getFilterControl();if(o&&Array.isArray(r)&&r.length>0&&t.title){const e=i.getLabels(r,t.entityTypePath,o,z(o));n=i.getText(e,o,t.title);return n}};s._onSearch=function e(t){this.setCountsOutDated(true);this.setFreezeContent(false);if(this.getSelectedInnerControl()){this._updateMultiTabNotApplicableFields()}else{this._refreshCustomView(t.getParameter("conditions"),"search")}};s._onFilterChanged=function e(t){if(t.getParameter("conditionsBased")){this.setFreezeContent(true)}};return o}(s),I=L(m.prototype,"showCounts",[c],{configurable:true,enumerable:true,writable:true,initializer:null}),T=L(m.prototype,"setVisibleOverridden",[f],{configurable:true,enumerable:true,writable:true,initializer:null}),_=L(m.prototype,"freezeContent",[d],{configurable:true,enumerable:true,writable:true,initializer:null}),v=L(m.prototype,"countsOutDated",[h],{configurable:true,enumerable:true,writable:true,initializer:null}),F=L(m.prototype,"content",[g],{configurable:true,enumerable:true,writable:true,initializer:null}),w=L(m.prototype,"innerControls",[p],{configurable:true,enumerable:true,writable:true,initializer:null}),S=L(m.prototype,"filterControl",[b],{configurable:true,enumerable:true,writable:true,initializer:null}),A=L(m.prototype,"select",[C],{configurable:true,enumerable:true,writable:true,initializer:null}),m))||y);return U},false);
//# sourceMappingURL=MultipleModeControl.js.map