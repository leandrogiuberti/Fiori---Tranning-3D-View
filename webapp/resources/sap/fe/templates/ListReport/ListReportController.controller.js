/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)
 *      (c) Copyright 2009-2025 SAP SE. All rights reserved
 */
sap.ui.define(["sap/base/Log","sap/base/util/ObjectPath","sap/fe/base/ClassSupport","sap/fe/core/CommonUtils","sap/fe/core/PageController","sap/fe/core/controllerextensions/IntentBasedNavigation","sap/fe/core/controllerextensions/InternalIntentBasedNavigation","sap/fe/core/controllerextensions/InternalRouting","sap/fe/core/controllerextensions/KPIManagement","sap/fe/core/controllerextensions/Placeholder","sap/fe/core/controllerextensions/Share","sap/fe/core/controllerextensions/SideEffects","sap/fe/core/controllerextensions/ViewState","sap/fe/core/helpers/EditState","sap/fe/core/helpers/MessageStrip","sap/fe/core/helpers/ResourceModelHelper","sap/fe/core/helpers/StableIdHelper","sap/fe/core/library","sap/fe/macros/chart/ChartUtils","sap/fe/macros/filter/FilterUtils","sap/fe/navigation/SelectionVariant","sap/fe/templates/ListReport/ExtensionAPI","sap/fe/templates/ListReport/overrides/SideEffects","sap/fe/templates/TableScroller","sap/ui/Device","sap/ui/core/Element","sap/ui/core/InvisibleMessage","sap/ui/core/library","sap/ui/core/mvc/OverrideExecution","sap/ui/mdc/p13n/StateUtil","sap/ui/thirdparty/hasher","./ListReportTemplating","./overrides/IntentBasedNavigation","./overrides/Share","./overrides/ViewState"],function(e,t,i,n,r,o,a,s,l,g,c,u,d,h,p,f,y,b,C,_,P,m,w,B,I,F,V,v,S,A,E,M,T,x,R){"use strict";var D,L,O,H,k,z,N,j,K,U,$,q,J,W,G,Q,X,Y,Z,ee,te,ie,ne,re,oe,ae,se,le,ge;var ce=v.InvisibleMessageMode;var ue=y.generate;var de=f.getResourceModel;var he=i.usingExtension;var pe=i.publicExtension;var fe=i.privateExtension;var ye=i.finalExtension;var be=i.extensible;var Ce=i.defineUI5Class;function _e(e,t,i,n){i&&Object.defineProperty(e,t,{enumerable:i.enumerable,configurable:i.configurable,writable:i.writable,value:i.initializer?i.initializer.call(n):void 0})}function Pe(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e,me(e,t)}function me(e,t){return me=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},me(e,t)}function we(e,t,i,n,r){var o={};return Object.keys(n).forEach(function(e){o[e]=n[e]}),o.enumerable=!!o.enumerable,o.configurable=!!o.configurable,("value"in o||o.initializer)&&(o.writable=!0),o=i.slice().reverse().reduce(function(i,n){return n(e,t,i)||i},o),r&&void 0!==o.initializer&&(o.value=o.initializer?o.initializer.call(r):void 0,o.initializer=void 0),void 0===o.initializer?(Object.defineProperty(e,t,o),null):o}function Be(e,t){throw Error("Decorating class property failed. Please ensure that transform-class-properties is enabled and runs after the decorators transform.")}const Ie=b.TemplateContentView,Fe=b.InitialLoadMode;let Ve=(D=Ce("sap.fe.templates.ListReport.ListReportController"),L=he(s.override({onAfterBinding:function(){this.getView().getController()._onAfterBinding()}})),O=he(a.override({getEntitySet:function(){return this.base.getCurrentEntitySet()}})),H=he(u.override(w)),k=he(o.override(T)),z=he(c.override(x)),N=he(d.override(R)),j=he(l),K=he(g),U=pe(),$=ye(),q=fe(),J=be("After"),W=pe(),G=be(S.After),Q=pe(),X=be(S.After),Y=pe(),Z=be(S.After),D(ee=(te=function(i){function o(){var t;for(var n=arguments.length,r=new Array(n),o=0;o<n;o++){r[o]=arguments[o]}t=i.call(this,...r)||this;_e(t,"_routing",ie,t);_e(t,"_intentBasedNavigation",ne,t);_e(t,"_sideEffects",re,t);_e(t,"intentBasedNavigation",oe,t);_e(t,"share",ae,t);_e(t,"viewState",se,t);_e(t,"kpiManagement",le,t);_e(t,"placeholder",ge,t);t.formatters={setALPControlMessageStrip(e,t,i){let n="";t=t==="true"||t===true;const r=this._getFilterBarControl();if(r&&Array.isArray(e)&&e.length>0&&t){const o=p.getLabels(e,r.data("entityType"),r,de(r));const a=!i?.enableSearch;n=t?p.getALPText(o,r,a):p.getText(o,r,"");return n}}};t.handlers={onInlineEditSave(){this.inlineEditFlow.inlineEditSave()},onFilterSearch(){const e=this._getFilterBarControl().getParent();e.triggerSearch()},onFiltersChanged(e){const t=this._getFilterBarControl();if(t){const i=this.getView().getBindingContext("internal");this.onPendingFilters();if(i&&e.getParameter("conditionsBased")){i.setProperty("hasPendingFilters",true)}if(i){this._storeFilterBarSelectionVariant(t,i)}}},onVariantSelected(e){const t=e.getParameters();const i=t.originalSource;const n=e.getParameter("key");const r=this._getMultiModeControl();if(r&&!i?.getParent()?.isA("sap.ui.mdc.ActionToolbar")){r?.invalidateContent();r?.setFreezeContent(true)}setTimeout(()=>{const e=this._getFilterBarControl();const t=this._getDynamicListReportControl();const o=e?.getFilterItems().find(function(e){return e.getRequired()&&e.getConditions().length===0});if(o){t.setHeaderExpanded(true)}if(this._shouldAutoTriggerSearch(i)){const e=this._getFilterBarControl().getParent();e.triggerSearch()}else if(!this._getApplyAutomaticallyOnVariant(i,n)){r?.setFreezeContent(false);this.getExtensionAPI().updateAppState();t.setHeaderExpanded(true)}},0)},onVariantSaved(){setTimeout(()=>{this.getExtensionAPI().updateAppState()},1e3)},onSearch(){const t=this._getFilterBarControl();const i=this.getView().getBindingContext("internal");const n=this.getChartControl();const r=_.getEditStateIsHideDraft(t.getConditions());i.setProperty("hasPendingFilters",false);i.setProperty("hideDraftInfo",r);const o=this._getDynamicListReportControl();if(!this._getMultiModeControl()){this._updateALPNotApplicableFields(i,t)}if(n){n.getBindingContext("internal").setProperty("",{});const e=n.getBindingContext("pageInternal");const t=e.getProperty(`${e.getPath()}/alpContentView`);if(t===Ie.Chart){this.hasPendingChartChanges=true}if(t===Ie.Table){this.hasPendingTableChanges=true}}if(!I.system.desktop&&i.getProperty("searchTriggeredByInitialLoad")===true){if(o.getHeaderExpanded()!==false){o.setHeaderExpanded(false)}i.setProperty("searchTriggeredByInitialLoad",false)}A.retrieveExternalState(t).then(e=>{this.filterBarConditions=e.filter;return}).catch(function(t){e.error("Error while retrieving the external state",t)});if(I.system.phone){const e=this._getDynamicListReportControl();if(!this._isInitLoadEnabled()){e.setHeaderExpanded(true)}else{e.setHeaderExpanded(false);this.setFilterToggleVisibility(false)}}},async onChevronPressNavigateOutBound(e,t,i,n){return e._intentBasedNavigation.onChevronPressNavigateOutBound(e,t,i,n)},onChartSelectionChanged(e){const t=e.getSource().getContent(),i=this._getTable(),n=e.getParameter("data"),r=this.getView().getBindingContext("internal");if(n){C.setChartFilters(t)}const o=r.getProperty(`${r.getPath()}/alpContentView`);if(o===Ie.Chart){this.hasPendingChartChanges=true}else if(i){i.rebind();this.hasPendingChartChanges=false}},onSegmentedButtonPressed(e){const t=e.getParameters().selectedKey||e.getParameters().key;const i=this.getView().getBindingContext("internal");i.setProperty("alpContentView",t);const n=this.getChartControl();const r=this._getTable();switch(t){case Ie.Table:if(r){this._updateTable(r)}break;case Ie.Chart:if(n){this._updateChart(n)}break;case Ie.Hybrid:if(r){this._updateTable(r)}if(n){this._updateChart(n)}break;default:break}this.getExtensionAPI().updateAppState();this.focusHandlingForSegmentedButton(t)},onDynamicPageTitleStateChanged(e){const t=this._getFilterBarControl();if(t){this.setFilterToggleVisibility(!!e.getParameter("isExpanded"));if(e.getParameter("isExpanded")===false){V.getInstance().announce(t.getAssignedFiltersText().filtersText,ce.Assertive)}}}};return t}Pe(o,i);var a=o.prototype;a.getExtensionAPI=function e(){if(!this.extensionAPI){this.extensionAPI=new m(this)}return this.extensionAPI};a.onInit=function e(){r.prototype.onInit.apply(this);const t=this.getView().getBindingContext("internal");const i=this._getFilterBarControl();if(i){this._storeFilterBarSelectionVariant(i,t)}t.setProperty("hasPendingFilters",true);t.setProperty("hideDraftInfo",false);t.setProperty("uom",{});t.setProperty("scalefactor",{});t.setProperty("scalefactorNumber",{});t.setProperty("currency",{});t.setProperty("isInsightsSupported",false);if(this._hasMultiVisualizations()){let e=this._getDefaultPath();if(!I.system.desktop&&e===Ie.Hybrid){e=Ie.Chart}t.setProperty("alpContentView",e)}this.filterBarConditions={};this.getAppComponent().getRouterProxy().waitForRouteMatchBeforeNavigation();this._setInitLoad();const n=this.getView();const o=n.getModel("ui");const a=`/${n.getId()}`;o.setProperty(a,{isEditable:false});n.bindElement({path:a,model:"ui"})};a.onBeforeRendering=function e(){r.prototype.onBeforeRendering.apply(this);const t=this._getDynamicListReportControl();const i=t?.getTitle();const n=i.getBreadcrumbs();if(n){n.setBreadcrumbLinks("")}};a.onExit=function e(){delete this.filterBarConditions;if(this.extensionAPI){this.extensionAPI.destroy()}delete this.extensionAPI};a._onAfterBinding=function t(){const i=this._getControls("table");let r=true;if(h.isEditStateDirty()){this._getMultiModeControl()?.invalidateContent();const t=this._getTable();const o=t?.getRowBinding();if(o){r=false;const a=t?.getParent();n.getAppComponent(this.getView()).getRoutingService().waitForBindingCleanup().then(async()=>{await n.getAppComponent(this.getView()).isAppComponentBusy();o.attachEventOnce("dataReceived",()=>{this._updateTableActions(i)});if(a.getTableDefinition().control.type==="TreeTable"){this.getModel().resetChanges()}a.refresh();return}).catch(t=>{e.warning("Error while waiting refreshing ListReport table",t)})}h.setEditStateProcessed()}if(r){this._updateTableActions(i)}const o=this.getView().getBindingContext("internal");if(!o.getProperty("initialVariantApplied")){const e=this.getView().getId();this.pageReady.waitFor(this._applyAppState(e));o.setProperty("initialVariantApplied",true)}const a=n.getAppComponent(this.getView()).getEnvironmentCapabilities();a.isInsightsEnabled().then(e=>{o.setProperty("isInsightsSupported",e);return}).catch(t=>{e.error("Error while checking if insights are enabled",t)})};a.onPageReady=async function e(t){if(t.forceFocus){this._setInitialFocus()}await this.getAppComponent().getShellServices().setBackNavigation(undefined)};a.onViewNeedsRefresh=function e(t){};a.onPendingFilters=function e(){};a.getCurrentEntitySet=function e(){return this._getTable()?.data("targetCollectionPath").slice(1)};a.onAfterClear=function e(){};a._updateTableActions=function e(t){let i=[];t.forEach(function(e){i=n.getIBNActions(e,i)});n.updateDataFieldForIBNButtonsVisibility(i,this.getView());n.updateMenuButtonVisiblity(i)};a._scrollTablesToRow=function e(t){this._getControls("table").forEach(function(e){B.scrollTableToRow(e,t)})};a._focusSilent=function e(t){const i=t.getFocusInfo();i.targetInfo={silent:true};t.focus(i)};a._setInitialFocus=function t(){const i=this._getDynamicListReportControl(),n=i.getHeaderExpanded(),r=this._getFilterBarControl();if(r&&!this._isFilterBarHiddenUsed()){if(!r.getShowMessages()){r.setShowMessages(true)}if(n){const e=r.getFilterItems().find(function(e){return e.getRequired()&&e.getConditions().length===0});if(e){if(e.isA("sap.ui.mdc.FilterField")){this._focusSilent(e)}else{e.focus()}}else if(this._isInitLoadEnabled()&&r.getFilterItems().length>0){const e=r.getFilterItems()[0];if(e.isA("sap.ui.mdc.FilterField")){this._focusSilent(e)}else{e.focus()}}else{this.getView().byId(`${this._getFilterBarControlId()}-btnSearch`)?.focus()}}else if(this._isInitLoadEnabled()){this._getTable()?.focusRow(0).catch(function(t){e.error("Error while setting initial focus on the table ",t)})}}else{this._getTable()?.focusRow(0).catch(function(t){e.error("Error while setting initial focus on the table ",t)})}};a._getPageTitleInformation=async function e(){const t=this.getAppComponent().getManifestEntry("sap.app");return Promise.resolve({title:t.title,subtitle:t.subTitle||"",intent:"",icon:""})};a._getFilterBarControl=function e(){return this.getView().byId(this._getFilterBarControlId())};a._getDynamicListReportControl=function e(){return this.getView().byId(this._getDynamicListReportControlId())};a._getAdaptationFilterBarControl=function e(){const t=this._getFilterBarControl().getInbuiltFilter?.();return t?.getParent()?t:undefined};a._applyAppState=async function e(t){await this.getAppComponent().getAppStateHandler().applyAppState(t,this.getView());const i=this._getFilterBarControl();if(i){i.enableRequests(true)}else if(this._isFilterBarHidden()){const e=this.getView().getBindingContext("internal");e.setProperty("hasPendingFilters",false);if(this._isMultiMode()){this._getMultiModeControl().setCountsOutDated(true)}}};a._getSegmentedButton=function e(t){const i=(t==="Chart"?this.getChartControl():this._getTable())?.data("segmentedButtonId");return this.getView().byId(i)};a._getControlFromPageModelProperty=function e(t){const i=this._getPageModel()?.getProperty(t);return i?this.getView().byId(i):undefined};a._getDynamicListReportControlId=function e(){return this._getPageModel()?.getProperty("/dynamicListReportId")||""};a._getFilterBarControlId=function e(){return this._getPageModel()?.getProperty("/filterBarId")||""};a.getChartControl=function e(){return this._getControlFromPageModelProperty("/singleChartId")};a._getVisualFilterBarControl=function e(){const t=y.generate(["visualFilter",this._getFilterBarControlId()]);return t?this.getView().byId(t):undefined};a._getFilterBarVariantControl=function e(){return this._getControlFromPageModelProperty("/variantManagement/id")};a._getMultiModeControl=function e(){return this.getView().byId("fe::TabMultipleMode::Control")};a._getIconTabBar=function e(){return this.getView().byId("fe::TabMultipleMode")};a._getTable=function e(){if(this._isMultiMode()){const e=this._getMultiModeControl()?.getSelectedInnerControl()?.content;return e?.isA("sap.ui.mdc.Table")?e:undefined}else{return this._getControlFromPageModelProperty("/singleTableId")}};a._getControls=function e(t){if(this._isMultiMode()){const e=[];const i=this._getMultiModeControl().content;i.getItems().forEach(i=>{const n=this.getView().byId(i.getKey());if(n&&t){if(i.getKey().includes(`fe::${t}`)){e.push(n)}}else if(n!==undefined&&n!==null){e.push(n)}});return e}else if(t==="Chart"){const e=this.getChartControl();return e?[e]:[]}else{const e=this._getTable();return e?[e]:[]}};a._getDefaultPath=function e(){const t=M.getDefaultPath(this._getPageModel()?.getProperty("/views")||[]);switch(t){case"primary":return Ie.Chart;case"secondary":return Ie.Table;case"both":default:return Ie.Hybrid}};a._isMultiMode=function e(){return!!this._getPageModel()?.getProperty("/multiViewsControl")};a._isInitLoadEnabled=function e(){const t=this.getView().getViewData().initialLoad;return t===Fe.Enabled};a._hasMultiVisualizations=function e(){return this._getPageModel()?.getProperty("/hasMultiVisualizations")};a._disableInitLoad=function e(){const t=this._getFilterBarControl();if(t){t.enableRequests(false)}};a._applyAutomaticallyOnStandardVariant=function e(){return false};a._setInitLoad=function e(){if(!this._isInitLoadEnabled()){this._disableInitLoad()}const t=M.getVariantBackReference(this.getView().getViewData(),this._getPageModel()?.getData());const i=t&&this.getView().byId(t);if(i){i?.registerApplyAutomaticallyOnStandardVariant?.(this._applyAutomaticallyOnStandardVariant.bind(this))}};a._setShareModel=function e(){const i=t.get("sap.ushell.Container.getUser");const n={bookmarkTitle:document.title,bookmarkCustomUrl:function(){const e=E.getHash();return e?`#${e}`:window.location.href},isShareInJamActive:!!i&&i().isJamActive()};const r=this.getOwnerComponent().getModel("_templPriv");r.setProperty("/listReport/share",n)};a._updateALPNotApplicableFields=function e(t,i){const n={};const r={},o=this._getControls("table"),a=this._getControls("Chart");if(!o.length||!a.length){return}a.forEach(function(e){const t=e.data("targetCollectionPath"),o=t.slice(1),a=`${o}Chart`;if(!n[a]){n[a]=_.getNotApplicableFilters(i,e)}r[a]=n[a]});t.setProperty("controls/ignoredFields",r)};a._isFilterBarHidden=function e(){return this.getView().getViewData().hideFilterBar||false};a._isFilterBarHiddenUsed=function e(){return this.getView().getViewData().useHiddenFilterBar||false};a._getApplyAutomaticallyOnVariant=function e(t,i){if(!t||!i){return false}const n=t.getVariants();const r=n.find(function(e){return e&&e.getKey()===i});return r&&r.getProperty("executeOnSelect")||false};a._shouldAutoTriggerSearch=function e(t){if(this.getView().getViewData().initialLoad===Fe.Auto&&(!t||t.getStandardVariantKey()===t.getCurrentVariantKey())){const e=this._getFilterBarControl();if(e){const i=e.getConditions();for(const e in i){if(t&&!e.startsWith("$")&&Array.isArray(i[e])&&i[e].length){const e=t.getVariants().find(e=>e.getKey()===t.getCurrentVariantKey());return e&&e.getExecuteOnSelect()}}}}return false};a._updateTable=function e(t){if(!t.isTableBound()||this.hasPendingChartChanges){t.rebind();this.hasPendingChartChanges=false}};a._updateChart=function e(t){const i=t.getControlDelegate()._getChart(t);if(!(i&&i.isBound("data"))||this.hasPendingTableChanges){t.getControlDelegate().rebind(t,i.getBindingInfo("data"));this.hasPendingTableChanges=false}};a.setFilterToggleVisibility=function e(t){const i=this._getFilterBarControl();i?.getSegmentedButton()?.setVisible(t)};a.focusHandlingForSegmentedButton=function e(t){const i=this.getChartControl();const n=this._getTable();let r;switch(t){case Ie.Table:r=ue([n?.getId(),"SegmentedButton","TemplateContentView"]);this.addFocusDelegate(r);break;case Ie.Chart:case Ie.Hybrid:r=ue([i?.getId(),"SegmentedButton","TemplateContentView"]);this.addFocusDelegate(r);break;default:break}};a.addFocusDelegate=function e(t){const i=F.getElementById(t);if(i){const e={onAfterRendering:()=>{i.focus();i.removeEventDelegate(e)}};i.addEventDelegate(e)}};a._storeFilterBarSelectionVariant=async function t(i,n){try{const e=i.getParent();const t=await e.getSelectionVariant();n.setProperty("filterBarSelectionVariant",t)}catch(t){const i=t instanceof Error?t.message:String(t);e.error(`FE : Error fetching selection variant on filter change: ${i}`)}};a.getFilterBarSelectionVariant=function e(){const t=this.getView().getBindingContext("internal");return t?.getProperty("filterBarSelectionVariant")||new P};return o}(r),ie=we(te.prototype,"_routing",[L],{configurable:true,enumerable:true,writable:true,initializer:null}),ne=we(te.prototype,"_intentBasedNavigation",[O],{configurable:true,enumerable:true,writable:true,initializer:null}),re=we(te.prototype,"_sideEffects",[H],{configurable:true,enumerable:true,writable:true,initializer:null}),oe=we(te.prototype,"intentBasedNavigation",[k],{configurable:true,enumerable:true,writable:true,initializer:null}),ae=we(te.prototype,"share",[z],{configurable:true,enumerable:true,writable:true,initializer:null}),se=we(te.prototype,"viewState",[N],{configurable:true,enumerable:true,writable:true,initializer:null}),le=we(te.prototype,"kpiManagement",[j],{configurable:true,enumerable:true,writable:true,initializer:null}),ge=we(te.prototype,"placeholder",[K],{configurable:true,enumerable:true,writable:true,initializer:null}),we(te.prototype,"getExtensionAPI",[U,$],Object.getOwnPropertyDescriptor(te.prototype,"getExtensionAPI"),te.prototype),we(te.prototype,"onPageReady",[q,J],Object.getOwnPropertyDescriptor(te.prototype,"onPageReady"),te.prototype),we(te.prototype,"onViewNeedsRefresh",[W,G],Object.getOwnPropertyDescriptor(te.prototype,"onViewNeedsRefresh"),te.prototype),we(te.prototype,"onPendingFilters",[Q,X],Object.getOwnPropertyDescriptor(te.prototype,"onPendingFilters"),te.prototype),we(te.prototype,"onAfterClear",[Y,Z],Object.getOwnPropertyDescriptor(te.prototype,"onAfterClear"),te.prototype),te))||ee);return Ve},false);
//# sourceMappingURL=ListReportController.controller.js.map