/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)
 *      (c) Copyright 2009-2025 SAP SE. All rights reserved
 */
sap.ui.define(["sap/base/Log","sap/base/util/merge","sap/fe/base/ClassSupport","sap/fe/core/ActionRuntime","sap/fe/core/CommonUtils","sap/fe/core/PageController","sap/fe/core/controllerextensions/BusyLocker","sap/fe/core/controllerextensions/IntentBasedNavigation","sap/fe/core/controllerextensions/InternalIntentBasedNavigation","sap/fe/core/controllerextensions/InternalRouting","sap/fe/core/controllerextensions/MessageHandler","sap/fe/core/controllerextensions/PageReady","sap/fe/core/controllerextensions/Paginator","sap/fe/core/controllerextensions/Placeholder","sap/fe/core/controllerextensions/Share","sap/fe/core/controllerextensions/ViewState","sap/fe/core/controllerextensions/cards/CollaborationManager","sap/fe/core/controllerextensions/editFlow/draft","sap/fe/core/controllerextensions/editFlow/editFlowConstants","sap/fe/core/controllerextensions/routing/NavigationReason","sap/fe/core/controls/Recommendations/ConfirmRecommendationDialog","sap/fe/core/helpers/ModelHelper","sap/fe/core/helpers/ResourceModelHelper","sap/fe/core/library","sap/fe/macros/CommonHelper","sap/fe/macros/table/TableHelper","sap/fe/macros/table/Utils","sap/fe/navigation/SelectionVariant","sap/fe/templates/ObjectPage/ExtensionAPI","sap/fe/templates/ObjectPage/components/CollaborationDiscardDialog","sap/fe/templates/TableScroller","sap/m/InstanceManager","sap/m/MessageBox","sap/ui/Device","sap/ui/core/Element","sap/ui/core/Lib","sap/ui/core/Messaging","sap/ui/core/message/Message","sap/ui/core/message/MessageType","sap/ui/core/mvc/OverrideExecution","./overrides/CollaborationManager","./overrides/IntentBasedNavigation","./overrides/InternalRouting","./overrides/MessageHandler","./overrides/Paginator","./overrides/Share","./overrides/ViewState"],function(e,t,n,i,o,s,a,r,c,l,g,u,d,f,h,p,b,m,C,y,S,P,w,v,A,B,E,x,M,I,V,_,D,F,O,T,k,R,j,N,L,H,z,$,U,G,q){"use strict";var K,Q,J,W,X,Y,Z,ee,te,ne,ie,oe,se,ae,re,ce,le,ge,ue,de,fe,he,pe,be,me,Ce,ye;var Se=w.getResourceModel;var Pe=S.RecommendationDialogDecision;var we=n.usingExtension;var ve=n.publicExtension;var Ae=n.finalExtension;var Be=n.extensible;var Ee=n.defineUI5Class;function xe(e,t,n,i){n&&Object.defineProperty(e,t,{enumerable:n.enumerable,configurable:n.configurable,writable:n.writable,value:n.initializer?n.initializer.call(i):void 0})}function Me(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e,Ie(e,t)}function Ie(e,t){return Ie=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},Ie(e,t)}function Ve(e,t,n,i,o){var s={};return Object.keys(i).forEach(function(e){s[e]=i[e]}),s.enumerable=!!s.enumerable,s.configurable=!!s.configurable,("value"in s||s.initializer)&&(s.writable=!0),s=n.slice().reverse().reduce(function(n,i){return i(e,t,n)||n},s),o&&void 0!==s.initializer&&(s.value=s.initializer?s.initializer.call(o):void 0,s.initializer=void 0),void 0===s.initializer?(Object.defineProperty(e,t,s),null):s}function _e(e,t){throw Error("Decorating class property failed. Please ensure that transform-class-properties is enabled and runs after the decorators transform.")}const De=v.ProgrammingModel;let Fe=(K=Ee("sap.fe.templates.ObjectPage.ObjectPageController"),Q=we(f),J=we(h.override(G)),W=we(l.override(z)),X=we(d.override(U)),Y=we(g.override($)),Z=we(r.override(H)),ee=we(b.override(L)),te=we(c.override({getNavigationMode:function(){const e=this.getView().getController().getStickyEditMode&&this.getView().getController().getStickyEditMode();return e?"explace":undefined}})),ne=we(p.override(q)),ie=we(u.override({isContextExpected:function(){return true}})),oe=ve(),se=Ae(),ae=ve(),re=Be(N.After),K(ce=(le=function(n){function r(){var t;for(var i=arguments.length,s=new Array(i),a=0;a<i;a++){s[a]=arguments[a]}t=n.call(this,...s)||this;xe(t,"placeholder",ge,t);xe(t,"share",ue,t);xe(t,"_routing",de,t);xe(t,"paginator",fe,t);xe(t,"messageHandler",he,t);xe(t,"intentBasedNavigation",pe,t);xe(t,"collaborationManager",be,t);xe(t,"_intentBasedNavigation",me,t);xe(t,"viewState",Ce,t);xe(t,"pageReady",ye,t);t.clearTitleHierarchyCacheSetUp=false;t.mergePatchDraft=false;t.handlers={onPrimaryAction(e,t,n,i,s,a){const r=e.getView().getViewData().viewLevel;if(a.positiveActionVisible){if(a.positiveActionEnabled){e.handlers.onCallAction(t,i,s)}}else if(a.editActionVisible){if(a.editActionEnabled){e._editDocument()}}else if(r===1&&o.getIsEditable(t)){e._saveDocument()}else if(o.getIsEditable(t)){e._applyDocument(n)}},async onTableContextChange(t){const n=t.getSource();const i=n.content;const o=this.editFlow.getCurrentActionPromise();const s=this._getTableBinding(i)?.getCurrentContexts();if(o&&s?.length){try{const e=await o;if(e?.controlId===i.getId()){const t=e.oData;const n=e.keys;const o=s.findIndex(e=>{const i=e.getObject();return n.every(e=>i[e]===t[e])});if(o!==-1){const e=_.getOpenDialogs().find(e=>e.data("FullScreenDialog")!==true);if(e){e.attachEventOnce("afterClose",()=>{i.focusRow(o,true)})}else{i.focusRow(o,true)}this.editFlow.deleteCurrentActionPromise()}}}catch(t){e.error(`An error occurs while scrolling to the newly created Item: ${t}`)}}this.messageButton.fireModelContextChange()},async onCallAction(e,t,n){const i=e.getController();await i.editFlow.syncTask();return i.editFlow.invokeAction(t,n).then(i._showMessagePopover.bind(i,undefined)).catch(i._showMessagePopover.bind(i))},onDataPointTitlePressed(e,t,n,i,s){n=typeof n==="string"?JSON.parse(n):n;const a=n[i],r=t.getBindingContext(),c=r.getModel().getMetaModel().getMetaPath(r.getPath());let l=o.getSemanticObjectMapping(a),g=e._getChartContextData(r,s),u;g=g.map(function(e){return{data:e,metaPath:c+(s?`/${s}`:"")}});if(a&&a.parameters){const t=a.parameters&&e._intentBasedNavigation.getOutboundParams(a.parameters);if(Object.keys(t).length>0){u=t}}if(l.length===0){const n=t.getCustomData().find(e=>e.getKey()==="ValuePropertyPath");if(n){l=e._getImplicitSemanticObjectMappingForDataPoints(n.getValue(),a.semanticObject)}}if(a&&a.semanticObject&&a.action){e._intentBasedNavigation.navigate(a.semanticObject,a.action,{navigationContexts:g,semanticObjectMapping:l,additionalNavigationParameters:u})}},async onChevronPressNavigateOutBound(e,t,n,i){return e._intentBasedNavigation.onChevronPressNavigateOutBound(e,t,n,i)},onNavigateChange(e){this.getExtensionAPI().updateAppState();this.bSectionNavigated=true;const t=this.getView().getBindingContext("internal");if(o.getIsEditable(this.getView())&&this.getView().getViewData().sectionLayout==="Tabs"&&t.getProperty("errorNavigationSectionFlag")===false){const t=e.getParameter("subSection");this._updateFocusInEditMode([t])}},onVariantSelected:function(){this.getExtensionAPI().updateAppState()},onVariantSaved:function(){setTimeout(()=>{this.getExtensionAPI().updateAppState()},2e3)},navigateToSubSection:function(t,n){const i=typeof n==="string"?JSON.parse(n):n;const o=t.getView().byId("fe::ObjectPage");let s;let a;if(i.sectionId){s=t.getView().byId(i.sectionId);a=i.subSectionId?t.getView().byId(i.subSectionId):s&&s.getSubSections()&&s.getSubSections()[0]}else if(i.subSectionId){a=t.getView().byId(i.subSectionId);s=a&&a.getParent()}if(!s||!a||!s.getVisible()||!a.getVisible()){const n=Se(t).getText("C_ROUTING_NAVIGATION_DISABLED_TITLE",undefined,t.getView().getViewData().entitySet);e.error(n);D.error(n)}else{o.setSelectedSection(a.getId());o.fireNavigate({section:s,subSection:a})}},closeCollaborationStrip:function(){this.getView().getModel("ui").setProperty("/showCollaborationStrip",false)},closeOPMessageStrip:function(){const e=this.getView();const t=o.getIsEditable(e);const n=e.getModel("internal");const i=n.bindContext(this.getExtensionAPI()._getMessageStripBindingContextPath()).getBoundContext();if(!t&&i.getProperty("OPBackendMessageVisible")===true){const e=k.getMessageModel().getData().filter(e=>e.getTargets()[0]===this.getView().getBindingContext()?.getPath()&&e.getPersistent()===true);if(e.length===1){k.removeMessages(e)}}i.setProperty("OPBackendMessageVisible",false);this.getExtensionAPI().hideMessage()}};return t}Me(r,n);var c=r.prototype;c.getExtensionAPI=function e(t){if(t){this.mCustomSectionExtensionAPIs=this.mCustomSectionExtensionAPIs||{};if(!this.mCustomSectionExtensionAPIs[t]){this.mCustomSectionExtensionAPIs[t]=new M(this,t)}return this.mCustomSectionExtensionAPIs[t]}else{if(!this.extensionAPI){this.extensionAPI=new M(this)}return this.extensionAPI}};c.onInit=function e(){n.prototype.onInit.call(this);const t=this._getObjectPageLayoutControl();const i=this.getView().getBindingContext("internal");i?.setProperty("externalNavigationContext",{page:true});i?.setProperty("relatedApps",{visibility:false,items:null});i?.setProperty("batchGroups",this._getBatchGroupsForView());i?.setProperty("errorNavigationSectionFlag",false);if(t.getEnableLazyLoading()){t.attachEvent("subSectionEnteredViewPort",this._handleSubSectionEnteredViewPort.bind(this))}this.messageButton=this.getView().byId("fe::FooterBar::MessageButton");this.messageBinding=k.getMessageModel().bindList("/");this.messageBinding?.attachChange(this._fnShowOPMessage,this);i?.setProperty("rootEditEnabled",true);i?.setProperty("rootEditVisible",true)};c.onExit=function e(){if(this.mCustomSectionExtensionAPIs){for(const e of Object.keys(this.mCustomSectionExtensionAPIs)){if(this.mCustomSectionExtensionAPIs[e]){this.mCustomSectionExtensionAPIs[e].destroy()}}delete this.mCustomSectionExtensionAPIs}if(this.extensionAPI){this.extensionAPI.destroy()}delete this.extensionAPI;const t=this.messageButton?this.messageButton.oMessagePopover:null;if(t&&t.isOpen()){t.close()}const n=this.getView().getBindingContext();if(n&&n.isKeepAlive()){n.setKeepAlive(false)}this.collaborativeDraft.disconnect();this.messageBinding?.detachChange(this._fnShowOPMessage,this)};c._fnShowOPMessage=function e(){if(this.getAppComponent().isSuspended()){return}const t=this.getExtensionAPI();const n=this.getView();const i=k?.getMessageModel().getData().filter(e=>e.getTargets()[0]===n.getBindingContext()?.getPath());if(t){t._showMessages(i,"Backend")}};c._getTableBinding=function e(t){return t&&t.getRowBinding()};c.checkSectionsForNonResponsiveTable=function e(t){const n=(e,t)=>{const i=[...t.getBlocks(),...t.getMoreBlocks()];if(i.length===1){const e=this.searchTableInBlock(i[0]);if(!e){return}const o=e.isA("sap.ui.mdc.Table")&&e.getType();const s=e.getParent()?.isA("sap.fe.macros.table.TableAPI")?e.getParent():undefined;if(o&&(o?.isA("sap.ui.mdc.table.GridTableType")||o?.isA("sap.ui.mdc.table.TreeTableType"))&&s?.getTableDefinition().control.rowCountMode==="Auto"){t.addStyleClass("sapUxAPObjectPageSubSectionFitContainer");t.detachEvent("modelContextChange",n,this)}}};for(let e=t.length-1;e>=0;e--){if(t[e].getVisible()){const i=t[e];i.attachEvent("modelContextChange",i,n,this);break}}};c.searchTableInBlock=function e(t){const n=t.content;let i;if(t.isA("sap.fe.templates.ObjectPage.controls.SubSectionBlock")){if(n.isA("sap.m.Panel")&&n.data("FullScreenTablePlaceHolder")){i=n.data("tableAPIreference")}else if(n.isA("sap.fe.macros.table.TableAPI")){i=n}if(i){return i.content}}return undefined};c.onBeforeRendering=function e(){s.prototype.onBeforeRendering.apply(this);if(this.oView.getViewData()?.retrieveTextFromValueList&&A.getMetaModel()===undefined){A.setMetaModel(this.getAppComponent().getMetaModel())}};c.onAfterRendering=function e(){let t;if(this._getObjectPageLayoutControl().getUseIconTabBar()){const e=this._getObjectPageLayoutControl().getSections();for(const n of e){t=n.getSubSections();this.checkSectionsForNonResponsiveTable(t)}}else{t=this._getAllSubSections();this.checkSectionsForNonResponsiveTable(t)}};c._onBeforeBinding=function e(t){let n=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};const i=this._findTables(),o=this._getObjectPageLayoutControl(),s=this.getView().getBindingContext("internal"),a=this.getView().getModel("internal"),r=s.getProperty("batchGroups");let c;r.push("$auto");if(n.reason!==y.EditFlowAction){this._closeSideContent()}const l=o.getBindingContext();if(l&&l.hasPendingChanges()&&!r.some(l.getModel().hasPendingChanges.bind(l.getModel()))){l.getBinding().resetChanges()}for(const e of i){c=e.getCreationRow();if(c){c.setBindingContext(null)}}const g=function(){if(!o.isFirstRendering?.()&&!n.bPersistOPScroll){o.setSelectedSection(null)}};o.attachEventOnce("modelContextChange",g);const u={onAfterRendering:()=>{if(this.getView().getViewData()?.editableHeaderContent){g()}o.removeEventDelegate(u)}};o.addEventDelegate(u);this._initializePagination(t,a,n?.listBinding);if(o.getEnableLazyLoading()){this._disableBlocksBindings(o)}if(this.placeholder.isPlaceholderEnabled()&&n.showPlaceholder){const e=this.getView();const t=e.getParent().oContainer.getParent();if(t){this.placeholder.enableAnimation();t.showPlaceholder({})}}};c.getFirstEditableInput=function e(){const t=this._getObjectPageLayoutControl()._getFirstEditableInput();return t?O.closestTo(t):undefined};c.getFirstClickableElement=function e(t){let n;const i=t.getHeaderTitle()&&t.getHeaderTitle().getActions();if(i?.length){n=i.find(function(e){if(e.isA("sap.fe.macros.ai.SummarizationButton")){return e.getContent()?.getVisible()??false}else if(e.isA("sap.fe.macros.Share")||e.isA("sap.fe.macros.ai.EasyFillButton")||e.isA("sap.fe.templates.ObjectPage.components.CollaborationDraft")){return e.getVisible()}else if(!e.isA("sap.ui.core.InvisibleText")&&!e.isA("sap.m.ToolbarSpacer")){return e.getVisible()&&e.getEnabled()}})}return n};c._disableBlocksBindings=function e(t){const n=t.getSections();const i=t.getUseIconTabBar();let s=3;const a=o.getIsEditable(this.getView());const r=this.getView().getViewData().editableHeaderContent;for(let e=0;e<n.length;e++){const t=n[e];const o=t.getSubSections();for(let t=0;t<o.length;t++,s--){if(s<1||i&&(e>1||e===1&&!r&&!a)){const e=o[t];if(e.data().isVisibilityDynamic!=="true"){e.setBindingContext(undefined);const t=e.getBlocks();t.forEach(e=>e.setBindingContext(null));e.getMoreBlocks().forEach(e=>e.setBindingContext(null));e.getActions().forEach(e=>e.setBindingContext(null))}}}}};c._getFirstEmptyMandatoryFieldFromSubSection=function e(t){if(t.length===0)return undefined;for(const e of t){const t=e.getBlocks();if(t){for(const e of t){if(e.getBindingContext?.()){let t;if(e.isA("sap.ui.layout.form.Form")){t=e.getFormContainers()}else if(e.getContent&&e.getContent()?.isA("sap.ui.layout.form.Form")){t=e.getContent().getFormContainers()}else if(e?.getContent?.()?.isA("sap.fe.macros.form.FormAPI")){t=e.getContent().getContent().getFormContainers()}if(t){for(const e of t){const t=e.getFormElements();if(t){for(const e of t){const t=e.getFields();const n=this.getFirstEmptyRequiredField(t);if(n)return n}}}}}}}}return undefined};c.getFirstEmptyRequiredField=function t(n){if(!n||n.length===0)return;if(!n[0].getRequired?.())return;let i=false;try{if(n[0].isA("sap.fe.macros.MultiValueField")){const e=n[0].getMultiValueField().getItems();i=e.length===0}else{const e=n[0].getValue();i=!e}}catch(t){e.debug(`Error when checking field properties: ${t}`)}return i?n[0]:undefined};c._updateFocusInEditMode=function e(t){setTimeout(function(){const e=this._getObjectPageLayoutControl();const n=this._getFirstEmptyMandatoryFieldFromSubSection(t);let i;if(n){if(n.isA("sap.fe.macros.MultiValueField")){i=n.getMultiValueField()}else{i=n.content.getContentEdit()[0]}}else{i=this.getFirstEditableInput()??this.getFirstClickableElement(e)}if(i){const e=i.getFocusInfo();e.targetInfo={silent:true};if(i.isA("sap.ui.mdc.field.FieldInput")){i=i.getParent()}i.focus(e)}}.bind(this),0)};c._handleSubSectionEnteredViewPort=function e(t){const n=t.getParameter("subSection");const i=n.getBlocks();i.forEach(e=>e.setBindingContext(undefined));n.getMoreBlocks().forEach(e=>e.setBindingContext(undefined));n.getActions().forEach(e=>e.setBindingContext(undefined))};c._onBackNavigationInDraft=function t(n){this.messageHandler.removeTransitionMessages();const i=()=>{const e=document.URL;history.back();setTimeout(()=>{if(document.URL===e){this._routing.navigateBackFromContext(n)}},500)};if(this.getAppComponent().getRouterProxy().checkIfBackHasSameContext()){history.back()}else if(!this.getView().getBindingContext()){this.getAppComponent().getShellServices().setBackNavigation(undefined).then(i).catch(t=>{e.warning("Error while setting back navigation",t)})}else{const e=this.getAppComponent()?.getEnvironmentCapabilities()?.getCapabilities()?.HiddenDraft?.enabled;m.processDataLossOrDraftDiscardConfirmation(i,Function.prototype,n,this,true,m.NavigationType.BackNavigation,undefined,e?true:undefined)}};c._onAfterBinding=function t(n,s){const a=this.getView();const r=a?.getViewData()?.viewLevel;const c=this._getObjectPageLayoutControl();const l=this._findTables();this._sideEffects.clearFieldGroupsValidity();const g=c.getBindingContext();let u=[];c.getSections().forEach(function(e){e.getSubSections().forEach(function(e){u=o.getIBNActions(e,u)})});l.forEach(function(e){const t=e.getBindingContext("internal");if(t){t.setProperty("creationRowFieldValidity",{});t.setProperty("creationRowCustomValidity",{});u=o.getIBNActions(e,u);const n=e.getRowBinding();if(n){if(P.isStickySessionSupported(n.getModel().getMetaModel())){n.removeCachesAndMessages("")}}const s=e.getParent();const a=s?JSON.parse(s.tableDefinition.operationAvailableMap):{};i.setActionEnablement(t,a,[],"table");e.clearSelection()}});const d=c.getHeaderTitle();let f=[];f=o.getIBNActions(d,f);u=u.concat(f);o.updateDataFieldForIBNButtonsVisibility(u,this.getView());let h,p=Promise.resolve();const b=t=>{const n=this._getTableBinding(t),i=function(){B.enableFastCreationRow(t.getCreationRow(),n.getPath(),n.getContext(),h,p)};if(!n){e.error(`Expected binding missing for table: ${t.getId()}`);return}if(n.getContext()){i()}else{const e=function(){if(n.getContext()){i();n.detachChange(e)}};n.attachChange(e)}};if(g){h=g.getModel();p=this.editFlow.computeModelsForEditMode(g);this._updateRelatedApps();const t=g.getBinding&&g.getBinding()||g;if(this.currentBinding!==t){t.attachEvent("patchSent",{},this.editFlow.handlePatchSent,this);this.currentBinding=t}l.forEach(function(t){E.whenBound(t).then(b).catch(function(t){e.error("Error while waiting for the table to be bound",t)})});c._triggerVisibleSubSectionsEvents();i.updateEditButtonVisibilityAndEnablement(this.getView())}if(r&&r===1){p?.then(()=>{this.recommendations.clearRecommendations();return})}this._updateAvailableCards([]);this.displayCollaborationMessage(s?.redirectedToNonDraft);this._setOPMessageStripInternalContext();const m=this.getAppComponent().getAppStateHandler().applyAppState(a.getId(),a);this.pageReady.waitFor(m)};c._updateAvailableCards=async function e(t){await this.collaborationManager.collectAvailableCards(t);if(t.length>0){const e=this.collaborationManager.updateCards(t);const n=this.getAppComponent().getId();this.getAppComponent().getCollaborationManagerService().addCardsToCollaborationManager(e,n,this.getView().getId());this.getAppComponent().getCollaborationManagerService().shareAvailableCards()}};c._setOPMessageStripInternalContext=function e(){const t=this.getView();const n=this._getObjectPageLayoutControl();const i=t.getBindingContext("internal");i?.setProperty("MessageStrip",{...i?.getProperty("MessageStrip")});if(i){n.getHeaderTitle()?.findElements(true,e=>e.isA("sap.m.MessageStrip")).forEach(e=>{e.setBindingContext(i.getModel().bindContext(this.getExtensionAPI()._getMessageStripBindingContextPath()).getBoundContext(),"internal")});this._fnShowOPMessage()}};c.displayCollaborationMessage=function e(t){const n=T.getResourceBundleFor("sap.fe.core");if(this.collaborationMessage){k.removeMessages([this.collaborationMessage]);delete this.collaborationMessage}if(t){this.collaborationMessage=new R({message:n.getText("REROUTED_NAVIGATION_TO_SAVED_VERSION",[t]),type:j.Information,target:this.getView()?.getBindingContext()?.getPath()});k.addMessages([this.collaborationMessage])}};c.onPageReady=async function e(t){const n=()=>{const e=this._getObjectPageLayoutControl();const t=!o.getIsEditable(this.getView());if(t){const t=this.getFirstClickableElement(e);if(t){t.focus()}}else{const t=O.getElementById(e.getSelectedSection());if(t){this._updateFocusInEditMode(t.getSubSections())}}};const i=this.getView().getBindingContext();this.getView().getModel("internal").setProperty("/currentCtxt",i);const s=this.getView();const a=s.getBindingContext("internal");const r=s.getBindingContext();if(r){const e=P.isStickySessionSupported(r.getModel().getMetaModel());if(!e){const e=o.getAppComponent(s);await e.getShellServices().setBackNavigation(()=>this._onBackNavigationInDraft(r))}}const c=o.getIsEditable(this.getView());if(c&&r){await this.recommendations.fetchAndApplyRecommendations([{context:r}])}if(t?.forceFocus){n()}a.setProperty("errorNavigationSectionFlag",false);this._checkDataPointTitleForExternalNavigation();if(!this.mergePatchDraft&&!F.support.touch){const e=s.byId("fe::FooterBar::StandardAction::Save");const t=()=>{if(this.autoQueueLock?.isLocked()){this.autoQueueLock.unlock()}e.detachBrowserEvent("mouseup",t);e.detachBrowserEvent("blur",t)};e?.attachBrowserEvent("mousedown",()=>{if(!this.autoQueueLock?.isLocked()){this.autoQueueLock=this.getView().getModel().lock("$auto");e.attachBrowserEvent("mouseup",t);e.attachBrowserEvent("blur",t)}});this.mergePatchDraft=true}};c.getStickyEditMode=function e(){const t=this.getView().getBindingContext&&this.getView().getBindingContext();let n=false;if(t){const e=P.isStickySessionSupported(t.getModel().getMetaModel());if(e){n=o.getIsEditable(this.getView())}}return n};c._getObjectPageLayoutControl=function e(){return this.byId("fe::ObjectPage")};c._getPageTitleInformation=async function e(){const t=this._getObjectPageLayoutControl();const n=t.getCustomData().find(function(e){return e.getKey()==="ObjectPageSubtitle"});const i=t.getCustomData().find(function(e){return e.getKey()==="ObjectPageDescription"});const o=e=>Array.from(new Set((e?.parts||[]).filter(e=>!e.model).map(e=>e.path||"").filter(Boolean)));const s=o(n?.getBindingInfo("value"));const a=o(i?.getBindingInfo("value"));const r=[...s,...a];const c=this.getAppComponent();const l=c.getRootViewController();const g=()=>{l.clearTitleHierarchyCache(t.getBindingContext()?.getPath())};if(n&&!this.clearTitleHierarchyCacheSetUp){n.getBinding("value")?.attachChange(g,this);this.clearTitleHierarchyCacheSetUp=true}const u=t.getBindingContext();const d=()=>({title:t.data("ObjectPageTitle")??"",subtitle:n?.getValue()??"",intent:"",icon:"",description:i?.getValue()??""});if(!u||r.length===0){return Promise.resolve(d())}await Promise.all(r.map(async e=>u.requestObject(e).catch(()=>undefined)));return d()};c._executeTabShortCut=function e(t){const n=this._getObjectPageLayoutControl(),i=n.getSections(),o=i.length-1,s=t.getSource().getCommand();let a,r=n.indexOfSection(this.byId(n.getSelectedSection()));if(r!==-1&&o>0){if(s==="NextTab"){if(r<=o-1){a=i[++r]}}else if(r!==0){a=i[--r]}if(a){n.setSelectedSection(a);a.focus()}}};c._getFooterVisibility=function e(){const t=this.getView().getBindingContext("internal");const n=this.getView().getId();t.setProperty("messageFooterContainsErrors",false);const i=this.getAppComponent().getEnvironmentCapabilities().getCapabilities().HiddenDraft?.enabled;k.getMessageModel().getData().forEach(function(e){const o=e.validation&&e.getType()==="Error";const s=i?o:o&&e.getTargets().some(e=>e.includes(n));if(s){t.setProperty("messageFooterContainsErrors",true)}})};c._showMessagePopover=function t(n,i){if(n){e.error(n)}const s=o.getIsEditable(this.getView());const a=this.getAppComponent().getRootViewController();const r=a.isFclEnabled()?a.getRightmostView():this.getAppComponent().getRootContainer().getCurrentPage();if(s&&!r.isA("sap.m.MessagePage")){const e=this.messageButton,t=e.oMessagePopover,n=t.getBinding("items");if(n.getLength()>0&&!t.isOpen()){e.setVisible(true);setTimeout(function(){t.openBy(e)},0)}}return i};c._editDocument=async function e(){const t=this.getView().getBindingContext();const n=this.getView().getModel("ui");a.lock(n);return this.editFlow.editDocument.apply(this.editFlow,[t]).finally(function(){a.unlock(n)})};c._getImplicitSemanticObjectMappingForDataPoints=function e(t,n){return[{LocalProperty:{$PropertyPath:t},SemanticObjectProperty:n}]};c._validateDocument=async function e(){const t=O.getActiveElement();const n=t?.getBindingContext();if(!t||!n){return undefined}let i=false;if(n.isTransient()){if(n.hasPendingChanges()){await n.created()}else{i=true}}this.messageHandler.holdMessagesForControl(t);const o=await this.executeGlobalValidation(n,i);this.messageHandler.showMessages({control:t});return o};c.executeGlobalValidation=async function e(t){let n=arguments.length>1&&arguments[1]!==undefined?arguments[1]:false;const i=this.getAppComponent();this.messageHandler.removeTransitionMessages();if(!n){const e=i.getSideEffectsService();const n=e.getEntityTypeFromContext(t);const o=n?e.getGlobalODataEntitySideEffects(n):[];if(o.length){await this.editFlow.syncTask();return Promise.all(o.map(async e=>this._sideEffects.requestSideEffects(e,t)))}}const s=await o.createRootContext(De.Draft,this.getView(),i);if(s){await this.editFlow.syncTask();return m.executeDraftValidation(s,i,this.collaborativeDraft.isConnected())}};c._saveDocument=async function t(n){const i=this.getView().getBindingContext();const o=this.getView().getModel("ui"),s=[];let r=false;a.lock(o);try{if(this.collaborativeDraft.isCollaborationEnabled()){try{const e=await new I(this.getView(),true).getUserAction();if(e==="cancel"){return}if(e==="keepDraft"){this.collaborativeDraft.disconnect();await this._routing.navigateBackFromContext(i);return}}catch(t){e.error(`Something went wrong with collaboration discard: ${t}`)}}await this.editFlow.syncTask();this._findTables().forEach(e=>{const t=e.getCreationRow();const n=this._getTableBinding(e);const i=Object.keys(t?.getBindingContext()?.getObject()||{});if(i.filter(e=>!e.startsWith("@$ui5.")).length){r=true;s.push(this.editFlow.createDocument(n,{creationMode:e.data("creationMode"),creationRow:t,createAtEnd:e.data("createAtEnd")==="true",skipSideEffects:true}).then(()=>n))}});const t=n;const o=t&&typeof t=="object"&&t.getSource().getCommand()==="Save";const a=await Promise.all(s);try{await this.editFlow.saveDocument(i,{bExecuteSideEffectsOnError:r,bindings:a,mergePatchDraft:this.mergePatchDraft,skipBindingToView:n,isStandardSave:o})}catch(e){if(e!==Pe.Continue){this._showMessagePopover(e)}throw e}}finally{if(a.isLocked(o)){a.unlock(o)}}};c._cancelDocument=async function t(n){const i=this.getView()?.getBindingContext();const o=this.getView().byId(n.cancelButton);const s=O.getActiveElement()?.getId();let a=false;if(this.collaborativeDraft.isCollaborationEnabled()){try{const e=await new I(this.getView(),false).getUserAction();if(e==="cancel"){return}if(e==="keepDraft"){this.collaborativeDraft.disconnect();await this._routing.navigateBackFromContext(i);return}if(e==="discardConfirmed"){a=true}}catch(t){e.error("Cannot get collaborative users")}}const r=!!this.getView().getModel("ui").getProperty(C.DocumentModified)||!this.getStickyEditMode()&&i.getProperty("HasActiveEntity")===false;const c=e=>{if(s!==undefined){O.getElementById(s)?.focus()}return e};if(this.getAppComponent()?.getEnvironmentCapabilities()?.getCapabilities()?.HiddenDraft?.enabled&&r){return m.processDataLossOrDraftDiscardConfirmation(c,Function.prototype,i,this,false,m.NavigationType.BackNavigation,true)}return this.editFlow.cancelDocument(i,{control:o,skipDiscardPopover:a}).then(e=>c(e))};c._applyDocument=async function e(t){return this.editFlow.applyDocument(t).catch(()=>{this._showMessagePopover();return})};c._updateRelatedApps=function e(){const t=this._getObjectPageLayoutControl();const n=t.data("showRelatedApps");if(n==="true"||n===true){const e=o.getAppComponent(this.getView());o.updateRelatedAppsDetails(t,e)}};c._findControlInSubSection=function e(t,n,i,o){for(const e of t){let t=e.getContent instanceof Function?e.getContent():undefined;if(o){if(t?.getAggregation("items")){const e=t.getAggregation("items");e.forEach(function(e){if(e.isA("sap.fe.macros.Chart")){const t=e.getChartControl();i.push(t)}})}}else{if(t&&t.isA&&t.isA("sap.ui.layout.DynamicSideContent")){const e=t.getMainContent instanceof Function?t.getMainContent():undefined;if(e&&e.length>0){t=e[0]}}if(t&&t.isA&&t.isA("sap.m.Panel")&&t.data("FullScreenTablePlaceHolder")){t=t.data("tableAPIreference")}if(t&&t.isA&&t.isA("sap.fe.macros.table.TableAPI")){const e=t.getContent instanceof Function?t.getContent():undefined;if(e&&e.isA&&e.isA("sap.ui.mdc.Table")){i.push(e)}}}}};c._getAllSubSections=function e(){const t=this._getObjectPageLayoutControl();let n=[];t.getSections().forEach(function(e){n=n.concat(e.getSubSections())});return n};c._getAllBlocks=function e(){let t=[];this._getAllSubSections().forEach(function(e){t=t.concat(e.getBlocks())});return t};c._findTables=function e(){const t=this._getAllSubSections();const n=[];for(let e=0;e<t.length;e++){this._findControlInSubSection(t[e].getBlocks(),t[e],n);this._findControlInSubSection(t[e].getMoreBlocks(),t[e],n)}return n};c._findCharts=function e(){const t=this._getAllSubSections();const n=[];for(let e=0;e<t.length;e++){this._findControlInSubSection(t[e].getBlocks(),t[e],n,true);this._findControlInSubSection(t[e].getMoreBlocks(),t[e],n,true)}return n};c._closeSideContent=function e(){this._getAllBlocks().forEach(function(e){const t=e.getContent instanceof Function&&e.getContent();if(t&&t.isA&&t.isA("sap.ui.layout.DynamicSideContent")){if(t.setShowSideContent instanceof Function){t.setShowSideContent(false,false)}}})};c._getChartContextData=function e(t,n){const i=t.getObject();let o=[i];if(t&&n){if(i[n]){o=i[n];delete i[n];o.push(i)}}return o};c._scrollTablesToRow=function e(t){if(this._findTables&&this._findTables().length>0){const e=this._findTables();for(const n of e){V.scrollTableToRow(n,t)}}};c._mergeMultipleContexts=function e(t,n,i){let s=[],a=[],r,c,l;const g=t.getPath();const u=t&&t.getModel()&&t.getModel().getMetaModel();const d=u&&u.getMetaPath(g).replace(/^\/*/,"");if(n&&n.length){r=n[0];l=r.getPath();c=u&&u.getMetaPath(l).replace(/^\/*/,"");n.forEach(e=>{if(i){const t=this._getChartContextData(e,i);if(t){s=t.map(function(e){return{contextData:e,entitySet:`${d}/${i}`}})}}else{s.push({contextData:e.getObject(),entitySet:c})}})}a.push({contextData:t.getObject(),entitySet:d});a=this._intentBasedNavigation.removeSensitiveData(a,d);const f=o.addPageContextToSelectionVariant(new x,a,this.getView());s=this._intentBasedNavigation.removeSensitiveData(s,d);return{selectionVariant:f,attributes:s}};c._getBatchGroupsForView=function e(){const t=this.getView().getViewData(),n=t.controlConfiguration,i=n&&Object.keys(n),o=["$auto.Heroes","$auto.Decoration","$auto.Workers"];if(i&&i.length>0){i.forEach(function(e){const t=n[e];if(t.requestGroupId==="LongRunners"){o.push("$auto.LongRunners")}})}return o};c._initializePagination=function e(t,n,i){const o=this.getView().getViewData().viewLevel;if(o>1){const e=n.getProperty("/paginatorCurrentContext");if(e){const t=e.getBinding();this.paginator.initialize(t,e);n.setProperty("/paginatorCurrentContext",null)}else if(i){this.paginator.initialize(i,t)}}};c._checkDataPointTitleForExternalNavigation=function n(){const i=this.getView();const s=i.getBindingContext("internal");const a=o.getHeaderFacetItemConfigForExternalNavigation(i.getViewData(),this.getAppComponent().getRoutingService().getOutbounds());const r=this.getAppComponent().getShellServices();const c=i&&i.getBindingContext();s.setProperty("isHeaderDPLinkVisible",{});if(c){c.requestObject().then(function(e){return u(a,e)}).catch(function(t){e.error("Cannot retrieve the links from the shell service",t)})}function l(t){e.error(t)}function g(e,t){const n=e;if(t&&t.length===1&&t[0].supported){s.setProperty(`isHeaderDPLinkVisible/${n}`,true)}}function u(e,n){for(const o in e){const s=e[o];const a={};const c=i.byId(o);if(!c){continue}const u=c.getBindingContext();const d=u&&u.getObject();let f=t({},n,d);if(s.semanticObjectMapping){const e=s.semanticObjectMapping;for(const n in e){const i=e[n];const o=i["LocalProperty"]["$PropertyPath"];const s=i["SemanticObjectProperty"];if(o!==s){if(f.hasOwnProperty(o)){const e={};e[s]=f[o];f=t({},f,e);delete f[o]}}}}if(f){for(const e in f){if(!e.startsWith("_")&&!e.includes("odata.context")){a[e]=f[e]}}}r.isNavigationSupported([{target:{semanticObject:s.semanticObject,action:s.action},params:a}]).then(e=>g(o,e)).catch(l)}}};return r}(s),ge=Ve(le.prototype,"placeholder",[Q],{configurable:true,enumerable:true,writable:true,initializer:null}),ue=Ve(le.prototype,"share",[J],{configurable:true,enumerable:true,writable:true,initializer:null}),de=Ve(le.prototype,"_routing",[W],{configurable:true,enumerable:true,writable:true,initializer:null}),fe=Ve(le.prototype,"paginator",[X],{configurable:true,enumerable:true,writable:true,initializer:null}),he=Ve(le.prototype,"messageHandler",[Y],{configurable:true,enumerable:true,writable:true,initializer:null}),pe=Ve(le.prototype,"intentBasedNavigation",[Z],{configurable:true,enumerable:true,writable:true,initializer:null}),be=Ve(le.prototype,"collaborationManager",[ee],{configurable:true,enumerable:true,writable:true,initializer:null}),me=Ve(le.prototype,"_intentBasedNavigation",[te],{configurable:true,enumerable:true,writable:true,initializer:null}),Ce=Ve(le.prototype,"viewState",[ne],{configurable:true,enumerable:true,writable:true,initializer:null}),ye=Ve(le.prototype,"pageReady",[ie],{configurable:true,enumerable:true,writable:true,initializer:null}),Ve(le.prototype,"getExtensionAPI",[oe,se],Object.getOwnPropertyDescriptor(le.prototype,"getExtensionAPI"),le.prototype),Ve(le.prototype,"onPageReady",[ae,re],Object.getOwnPropertyDescriptor(le.prototype,"onPageReady"),le.prototype),le))||ce);return Fe},false);
//# sourceMappingURL=ObjectPageController.controller.js.map