/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)
 *      (c) Copyright 2009-2025 SAP SE. All rights reserved
 */
sap.ui.define(["sap/base/Log","sap/fe/core/converters/helpers/ConfigurableObject","sap/fe/core/helpers/StableIdHelper","sap/fe/core/templating/ActionHelper","sap/fe/core/templating/FieldControlHelper","sap/fe/core/templating/PropertyHelper","sap/fe/core/templating/UIFormatters","sap/fe/templates/ObjectPage/card/BaseCardContentProvider"],function(t,e,n,i,r,o,s,a){"use strict";var c={};var u=s.isVisible;var d=s.getActionEnabledExpression;var l=o.isMultiLineText;var p=r.isActionParameterRequiredExpression;var f=i.getIsActionCriticalExpression;var g=n.getStableIdPartFromDataField;var A=e.insertCustomElements;var h=e.Placement;var y=e.OverrideType;function C(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function v(t,e){t.prototype=Object.create(e.prototype),t.prototype.constructor=t,m(t,e)}function m(t,e){return m=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},m(t,e)}let b=function(t){t["Default"]="default";t["Positive"]="positive";t["Destructive"]="destructive";return t}({});c.ACStyle=b;let E=function(t){t["Execute"]="Action.Execute";t["ShowCard"]="Action.ShowCard";return t}({});c.ACAction=E;let I=function(t){t["Text"]="Input.Text";t["ChoiceSet"]="Input.ChoiceSet";t["Date"]="Input.Date";return t}({});c.ACInput=I;const x="OK";let P=function(e){function n(n,i){var r;r=e.call(this,n,i)||this;r.actions=[];try{const e=r.getCardConfigurationByKey("contextInfo");const{contextPath:n}=e;const i=r.getEntityType();if(!i){t.error(`FE : V4 : Adaptive Card header actions : no EntityType found at context path: ${n}`);return r||C(r)}const o=r.getAnnotatedHeaderActions(i);if(o.length>0){const t=r.getConfiguredActions(o);r.actions=t.reduce(r.getActionInAdaptiveCardFormat.bind(r),[])}}catch(e){const n=e instanceof Error?e.message:String(e);t.error("Error while creating the card defintion",n)}return r||C(r)}c=n;v(n,e);var i=n.prototype;i.getCardActions=function t(){return this.actions};i.getAdaptiveCardActionType=function t(e){const{isBound:n,isFunction:i,parameters:r}=e;if(i){return}const o=r.length>(n?1:0);return o?E.ShowCard:E.Execute};i.getActionCardBodyWithParameterFields=function t(e){const{isBound:n}=e;return e.parameters.reduce((t,i,r)=>{if(n&&r===0){return t}let o;const s=i.annotations.Common?.Label;if(i.type==="Edm.Date"||i.type==="Edm.DateTimeOffset"||i.type==="Edm.DateTime"){o={type:I.Date,id:i.name,label:s?.toString()??i.name,isRequired:this.getRequired(i,e)??undefined};t.push(o)}else{o={type:I.Text,id:i.name,label:s?.toString()??i.name,isRequired:this.getRequired(i,e)??undefined,isMultiline:l(i)??undefined};t.push(o)}return t},[])};i.getActionWithParameters=function t(e,n){const i=this.getActionCardBodyWithParameterFields(e);const{verb:r,title:o,style:s,data:a}=n;const c={type:E.Execute,verb:r,data:a,title:x,style:b.Positive};return{type:E.ShowCard,title:o,style:s,card:{type:"AdaptiveCard",body:i,actions:[c]}}};i.getAction=function t(e){const{ActionTarget:n}=e;const i=this.getActionDetails(e);if(!n||!i){return undefined}const r=this.getAdaptiveCardActionType(n);let o;if(r===E.Execute){o={type:r,...i}}else if(r===E.ShowCard){o=this.getActionWithParameters(n,i)}return o};i.getActionData=function t(e){const{isBound:n}=e;const i=this.getCardConfigurationByKey("contextInfo");const{bindingContextPath:r}=i;const o=r.startsWith("/")?r.substring(1):r;const s=this.getCardConfigurationByKey("serviceURI");const a=`${s}${o}`;return{contextURL:a,serviceURI:n?undefined:s,isConfirmationRequired:this.getIsCriticalForAdaptiveCardAction(e)??undefined}};i.getActionDetails=function t(e){const{ActionTarget:n}=e;if(!n){return}const i=n.isBound?e.Action.toString():n.name,r=i.replace(/\((.*)\)$/,""),o=e.Label?.toString()??n.name,s=this.getActionStyle(e),a=this.getActionData(n);return{verb:r,title:o,style:s,data:a}};i.getActionInAdaptiveCardFormat=function t(e,n){if(e.length>1){return e}const{action:i,title:r}=n;const{ActionTarget:o}=i;if(!o){return e}const s=n.isVisible??this.getVisibleForAdaptiveCardAction(i)??undefined;const a=this.getEnabledForAdaptiveCardAction(o)??undefined;let c;if(typeof s==="boolean"&&s===false){return e}else if(typeof s==="string"&&s&&/^\$\{.*\}/i.test(s)){c=s}else if(s==="true"){c=undefined}else if(s==="false"){return e}if(a==="false"||this.isStaticAction(o)||this.isCopyAction(i)){return e}const u=this.getAction(i);if(u){const t={isEnabled:a,$when:c,title:r??u.title};e.push({...u,...t})}return e};i.getAnnotatedHeaderActions=function t(e){const n=e.annotations.UI?.Identification;return n?n.filter(t=>t.$Type==="com.sap.vocabularies.UI.v1.DataFieldForAction"&&!t.Determining):[]};i.getConfiguredActions=function t(e){const n=this.getCardConfigurationByKey("actions");const i=e.map(t=>({key:t&&g(t),action:t}));if(!n||Object.keys(n).length===0){return i}const r=Object.keys(n);const o=r.reduce((t,e)=>{const r=i.find(t=>t.key===e);if(r){t[e]={key:e,action:r.action,position:{placement:h.After},...n[e]}}return t},{});const s={title:y.overwrite,position:y.overwrite,isVisible:y.overwrite};return A(i,o,s)};i.getVisibleForAdaptiveCardAction=function t(e){const n=u(e);return this.updatePathsAndGetCompiledExpression(n)};i.getActionStyle=function t(e){let n=b.Default;const i=e.Criticality;if(i&&typeof i==="string"){switch(i){case"UI.CriticalityType/Positive":n=b.Positive;break;case"UI.CriticalityType/Negative":n=b.Destructive;break;default:n=b.Default}}return n};i.getIsCriticalForAdaptiveCardAction=function t(e){const n=f(e,this.convertedTypes);return this.updatePathsAndGetCompiledExpression(n)};i.getEnabledForAdaptiveCardAction=function t(e){const n=d(e,this.convertedTypes);return this.updatePathsAndGetCompiledExpression(n)};i.isStaticAction=function t(e){const{isBound:n,parameters:i}=e;return n&&i[0]&&i[0].isCollection};i.isCopyAction=function t(e){return e.annotations?.UI?.IsCopyAction?.valueOf()===true};i.getRequired=function t(e,n){const i=p(e,n,this.convertedTypes);return this.updatePathsAndGetCompiledExpression(i)};return n}(a);c=P;return c},false);
//# sourceMappingURL=HeaderActions.js.map