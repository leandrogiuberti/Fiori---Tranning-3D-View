/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)
 *      (c) Copyright 2009-2025 SAP SE. All rights reserved
 */
sap.ui.define(["sap/base/Log","sap/fe/base/BindingToolkit","sap/fe/core/converters/helpers/ConfigurableObject","sap/fe/core/converters/helpers/DataFieldHelper","sap/fe/core/helpers/AdaptiveCardExpressionCompiler","sap/fe/core/helpers/MetaPath","sap/fe/core/helpers/StableIdHelper","sap/fe/core/helpers/TypeGuards","sap/fe/core/templating/CriticalityFormatters","sap/fe/core/templating/DataFieldFormatters","sap/fe/core/templating/UIFormatters","sap/fe/templates/ObjectPage/card/AdaptiveCardContent","sap/fe/templates/ObjectPage/card/BaseCardContentProvider"],function(e,t,a,n,o,i,s,r,c,l,u,p,g){"use strict";var h={};var f=p.getTextBlock;var d=p.getColumnSet;var m=p.getColumn;var v=u.isVisible;var F=l.generateVisibleExpression;var b=c.getCriticalityExpressionForCards;var C=r.isPathAnnotationExpression;var P=r.isNavigationProperty;var y=r.isAnnotationOfType;var x=s.getStableIdPartFromDataField;var T=s.generate;var E=o.compileToAdaptiveExpression;var O=n.isReferencePropertyStaticallyHidden;var D=n.isPotentiallySensitive;var V=a.insertCustomElements;var j=a.Placement;var M=a.OverrideType;var I=t.getExpressionFromAnnotation;var A=t.equal;var U=t.constant;function w(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function S(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e,k(e,t)}function k(e,t){return k=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},k(e,t)}const $=3;let B=function(t){function a(a,n){var o;o=t.call(this,a,n)||this;o.cardElements=[];let s=[];const{contextPath:r}=o.getCardConfigurationByKey("contextInfo");try{const e=new i(a,`${r}@${"com.sap.vocabularies.UI.v1.HeaderFacets"}`,r);const t=o.getCustomConfigHeaderFacets(e);s=o.createHeaderForms(e,t)}catch(t){e.error(`FE : V4 : Adaptive Card header facets : no EntityType found at context path: ${r}`)}o.cardElements=s;return o||w(o)}h=a;S(a,t);var n=a.prototype;n.getHeaderContent=function e(){return this.cardElements};n.getFieldGroupProperties=function e(t,a,n){let o,i,s,r=n?.labelText,c,l;switch(a?.$Type){case"com.sap.vocabularies.UI.v1.DataField":case"com.sap.vocabularies.UI.v1.DataFieldWithUrl":case"com.sap.vocabularies.UI.v1.DataFieldWithNavigationPath":if(C(a.Value)){o=t.getMetaPathForObject(a.Value);c=this.getNavigationPathForExpression(t);s=o?.getTarget()?.annotations?.Common?.Text;i=s&&t.getMetaPathForObject(s)}else{o=a.Value}r=r??a.Label??a.Value?.$target?.annotations?.Common?.Label.valueOf()??"";l=this.getCriticalityForDataPoints(a);break;case"com.sap.vocabularies.UI.v1.DataFieldForAnnotation":r=r??a.Label??a?.Value?.$target?.annotations?.Common?.Label.valueOf()??"";const e=t.getMetaPathForObject(a.Target);const n=e?.getTarget();c=this.getNavigationPathForExpression(e);if(y(n,"com.sap.vocabularies.UI.v1.DataPointType")){if(C(n.Value)){o=e?.getMetaPathForObject(n?.Value);s=o?.getTarget()?.annotations?.Common?.Text;i=s&&t.getMetaPathForObject(s)}else{o=n.Value}l=this.getCriticalityForDataPoints(n)}else if(y(n,"com.sap.vocabularies.Communication.v1.ContactType")){const a=n.fn;if(C(a)){o=e?.getMetaPathForObject(a);s=o?.getTarget()?.annotations?.Common?.Text;i=s&&t.getMetaPathForObject(s)}}break;default:break}return{property:o,label:r,navigationPath:c,textProperty:i,color:l}};n.getVisibleDataFields=function e(t){return t.reduce((e,t)=>{if(!O(t)&&!D(t)){e.push(t)}return e},[])};n.getColumnForDataField=function e(t,a,n){const o=[];const i=[];if(!t){i.push(m())}else{const e=this.getVisibleForDataField(t);const{property:s,label:r,color:c,uom:l,textProperty:u}=a||{};if(s){if(r){if(n===true){o.push(f({size:"Small",weight:"Bolder",text:r,maxLines:2,wrap:true,spacing:"Medium",visible:e}))}else{o.push(f({size:"Small",text:`${r}:`,maxLines:1,isSubtle:true}))}}const t=this.getValueBinding(s,u);const a=l??u;const p=this.getTextBlockVisiblityForDateField(s,typeof a!=="string"?a:undefined);o.push(f({size:"Small",$when:E(p),text:l?`${t} ${l}`:t,maxLines:2,color:c}));o.push(f({size:"Small",$when:E(A(p,U(false))),text:"\\-"}));i.push(m({items:o,visible:e??undefined}))}}return i};n.getFieldGroupContent=function e(t,a,n,o){const i=t.getTarget();const s=$;const r=[];if(a){const e=f({size:"Small",weight:"Bolder",text:a,maxLines:2,spacing:"Medium",wrap:true,visible:n??undefined});r.push(e)}const c=this.getVisibleDataFields(i?.Data);const l=Math.ceil(c.length/s);for(let e=1;e<=l;e++){const a=e*s;const i=a-s;const l=d([],n??undefined);for(let e=i;e<a;e++){const a=c[e];const n=a&&x(a);const i=n?o?.[n]:undefined;const s=this.getFieldGroupProperties(t,a,i);const r=a&&t.getMetaPathForObject(a);const u=this.getColumnForDataField(r,s);if(u){l.columns.push(...u)}}if(l){r.push(l)}}return r};n.getCriticalityForDataPoints=function e(t){let a;const n=t.Criticality;if(n){const e=I(n);a=b(e,false)}else{a=U("default")}return this.updatePathsAndGetCompiledExpression(a)};n.getUomPathBinding=function e(t,a){const n=a?.annotations.Measures?.ISOCurrency||a?.annotations.Measures?.Unit;if(!n){return}else if(C(n)){const e=t.getMetaPathForObject(n);const a=e?.getTarget();return a&&this.targetIsProperty(e)?this.getValueBinding(e):undefined}};n.getDataPointProperties=function e(t,a){const n=t.getMetaPathForObject(a?.Value);const o=this.getUomPathBinding(t,t.getMetaPathForObject(a?.Value)?.getTarget());const i=n?.getTarget()?.annotations?.Common?.Text;const s=i&&t.getMetaPathForObject(i);const r=this.getCriticalityForDataPoints(a);const c=this.getNavigationPathForExpression(t);return{property:n,color:r,uom:o,navigationPath:c,textProperty:s}};n.getDataPointContent=function e(t,a){const n=[];const o=t.getTarget();if(o?.Visualization!=="UI.VisualizationType/Rating"&&o?.Visualization!=="UI.VisualizationType/Progress"){const e=this.getDataPointProperties(t,o);e.label=a;const i=this.getColumnForDataField(t,e,true);if(i){n.push(...i)}}return n};n.getCustomHeaderFacetConfigElements=function e(t,a){const n=Object.keys(t);return n.reduce((e,n)=>{const o=a.find(e=>e.key===n);if(o){e[n]={key:n,headerFacet:o.headerFacet,position:{placement:j.After},...t[n]}}return e},{})};n.getCustomConfigHeaderFacets=function e(t){const a=this.getReferenceFacetFromAnnotations(t.getTarget());let n=a.map(function(e){return{key:T([e.Target.value]),headerFacet:e}});const o=this.getCardConfigurationByKey("headerFacets");if(o&&Object.keys(o).length>0){const e=this.getCustomHeaderFacetConfigElements(o,n);const t={isVisible:M.overwrite,title:M.overwrite,position:M.overwrite,formElementsConfig:M.overwrite};n=V(n,e,t)}return n};n.createHeaderForms=function e(t,a){let n=false;return a.reduce(function(e,a,o,i){const s=a.headerFacet;if(s.$Type==="com.sap.vocabularies.UI.v1.ReferenceFacet"&&s.annotations?.UI?.Hidden?.valueOf()!==true){const o=t.getMetaPathForObject(s.Target);const i=o?.getTarget();const r=this.getNavigationPathForExpression(o);const c=a.isVisible??this.getVisibleForReferenceFacet(s,r);const l=a.title??s.Label?.toString();const u=a.formElementsConfig;switch(i?.term){case"com.sap.vocabularies.UI.v1.FieldGroup":if(n===true){this.addEmptyColumns(e[e.length-1]);n=false}e.push(...this.getFieldGroupContent(o,l,c,u));break;case"com.sap.vocabularies.UI.v1.DataPoint":if(!D(i)){const t=this.getDataPointContent(o,a.title??l);const i=d([],c??undefined);if(n&&e[e.length-1].columns.length!==$){e[e.length-1].columns.push(...t)}else{i.columns.push(...t);e.push(i)}n=true}break;case"com.sap.vocabularies.Communication.v1.Address":if(n){this.addEmptyColumns(e[e.length-1]);n=false}e.push(...this.getAddressContent(o,a.title??l,c));break;default:break}}if(o===i.length-1&&n){this.addEmptyColumns(e[e.length-1])}return e}.bind(this),[])};n.addEmptyColumns=function e(t){const a=t.columns.length;if(a<$&&a>1){const e=$-a;for(let a=0;a<e;a++){t.columns.push(...this.getColumnForDataField())}}};n.getAddressContent=function e(t,a,n){const o=[];const i=t.getTarget();if(a){o.push(f({size:"Small",weight:"Bolder",text:a,maxLines:2,wrap:true,spacing:"Medium",visible:n}))}const s=d([],n??undefined);const r=[];const c=[];if(i?.label){r.push(f({size:"Small",text:`${i?.label}`,maxLines:2}));c.push(m({items:r,visible:n??undefined}))}if(c.length>0){s.columns.push(...c)}o.push(s);return o};n.getReferenceFacetFromAnnotations=function e(t){return t?t.filter(e=>e.$Type==="com.sap.vocabularies.UI.v1.ReferenceFacet"):[]};n.getVisibleForReferenceFacet=function e(t,a){const n=v(t);return this.updatePathsAndGetCompiledExpression(n,a)};n.getVisibleForDataField=function e(t,a){const n=F(t.getDataModelObjectPath());return this.updatePathsAndGetCompiledExpression(n,a)};n.getNavigationPathForExpression=function e(t){const a=t.getNavigationProperties();const n=[];if(a.length>0){a.forEach(function(e){if(P(e)){n.push(e.name)}})}return n?.toString()?.replaceAll(",","/")};return a}(g);h=B;return h},false);
//# sourceMappingURL=HeaderContent.js.map