{"version":3,"file":"ExtendPageDefinition.js","names":["extendObjectPageDefinition","pageDefinition","converterContext","convertedPageDefinition","primaryAction","getPrimaryAction","header","actions","footerActions","designtime","getDesigntime","_exports","headerActions","primaryActionExpression","aActions","getBindingExp","sExpression","includes","replace","slice","aSemanticPositiveActions","filter","oAction","annotationPath","targetObject","getConverterContextFor","getDataModelObjectPath","targetCriticality","getExpressionFromAnnotation","Criticality","isConstant","value","oEntitySet","getEntitySet","length","getPressExpressionForPrimaryAction","undefined","name","visible","enabled","getEditCommandExecutionVisible","getEditCommandExecutionEnabled"],"sources":["./ExtendPageDefinition.ts"],"sourcesContent":["import type { DataFieldForAction } from \"@sap-ux/vocabularies-types/vocabularies/UI\";\nimport { CriticalityType } from \"@sap-ux/vocabularies-types/vocabularies/UI\";\nimport type { CompiledBindingToolkitExpression } from \"sap/fe/base/BindingToolkit\";\nimport { getExpressionFromAnnotation, isConstant } from \"sap/fe/base/BindingToolkit\";\nimport type ConverterContext from \"sap/fe/core/converters/ConverterContext\";\nimport type { PageContextPathTarget } from \"sap/fe/core/converters/TemplateConverter\";\nimport type { BaseAction } from \"sap/fe/core/converters/controls/Common/Action\";\nimport type { ObjectPageDefinition } from \"sap/fe/core/converters/templates/ObjectPageConverter\";\nimport {\n\tgetEditCommandExecutionEnabled,\n\tgetEditCommandExecutionVisible,\n\tgetPressExpressionForPrimaryAction\n} from \"sap/fe/templates/ObjectPage/ObjectPageTemplating\";\n\nexport type FinalPageDefinition = ObjectPageDefinition & {\n\tprimaryAction: string;\n\tdesigntime: string | undefined;\n};\n\nexport const extendObjectPageDefinition = function (\n\tpageDefinition: ObjectPageDefinition,\n\tconverterContext: ConverterContext<PageContextPathTarget>\n): FinalPageDefinition {\n\tconst convertedPageDefinition = pageDefinition as FinalPageDefinition;\n\tconvertedPageDefinition.primaryAction = getPrimaryAction(converterContext, pageDefinition.header.actions, pageDefinition.footerActions);\n\tconvertedPageDefinition.designtime = getDesigntime();\n\treturn convertedPageDefinition;\n};\n\n/**\n * Method to get the expression for the execute event of the forward action.\n * Generates primaryActionExpression to be executed on the keyboard shortcut Ctrl+Enter with the\n * forward flow (priority is the semantic positive action OR if that's not there, then the primary action).\n * @param converterContext The converter context\n * @param headerActions An array containing all the actions for this ObjectPage header\n * @param footerActions An array containing all the actions for this ObjectPage footer\n * @returns  Binding expression or function string\n */\nexport const getPrimaryAction = function (\n\tconverterContext: ConverterContext<PageContextPathTarget>,\n\theaderActions: BaseAction[],\n\tfooterActions: BaseAction[]\n): string {\n\tlet primaryActionExpression = \"\";\n\tconst aActions = [...headerActions, ...footerActions];\n\n\tconst getBindingExp = function (sExpression: CompiledBindingToolkitExpression | string): string | undefined {\n\t\tif (sExpression && sExpression.includes(\"{=\")) {\n\t\t\treturn sExpression.replace(\"{=\", \"(\").slice(0, -1) + \")\";\n\t\t}\n\t\treturn sExpression;\n\t};\n\tconst aSemanticPositiveActions = aActions.filter((oAction) => {\n\t\tif (oAction?.annotationPath) {\n\t\t\tconst targetObject = converterContext\n\t\t\t\t.getConverterContextFor<DataFieldForAction>(oAction?.annotationPath)\n\t\t\t\t.getDataModelObjectPath().targetObject;\n\t\t\tconst targetCriticality = getExpressionFromAnnotation(targetObject?.Criticality);\n\t\t\tif (isConstant(targetCriticality) && targetCriticality.value === CriticalityType.Positive) {\n\t\t\t\treturn true;\n\t\t\t}\n\t\t}\n\t});\n\tconst oEntitySet = converterContext.getEntitySet();\n\tif (aSemanticPositiveActions.length > 0) {\n\t\tprimaryActionExpression = getPressExpressionForPrimaryAction(\n\t\t\taSemanticPositiveActions[0].annotationPath\n\t\t\t\t? converterContext\n\t\t\t\t\t\t.getConverterContextFor<DataFieldForAction>(aSemanticPositiveActions[0].annotationPath)\n\t\t\t\t\t\t.getDataModelObjectPath().targetObject\n\t\t\t\t: undefined,\n\t\t\toEntitySet?.name,\n\t\t\taSemanticPositiveActions[0],\n\t\t\tgetBindingExp(aSemanticPositiveActions[0].visible ?? \"true\"),\n\t\t\tgetBindingExp(aSemanticPositiveActions[0].enabled ?? \"true\"),\n\t\t\tgetBindingExp(getEditCommandExecutionVisible(headerActions)),\n\t\t\tgetBindingExp(getEditCommandExecutionEnabled(headerActions))\n\t\t);\n\t} else {\n\t\tprimaryActionExpression = getPressExpressionForPrimaryAction(\n\t\t\tundefined,\n\t\t\toEntitySet?.name,\n\t\t\tnull,\n\t\t\t\"false\",\n\t\t\t\"false\",\n\t\t\tgetBindingExp(getEditCommandExecutionVisible(headerActions)),\n\t\t\tgetBindingExp(getEditCommandExecutionEnabled(headerActions))\n\t\t);\n\t}\n\treturn primaryActionExpression;\n};\n\nexport function getDesigntime(): string | undefined {\n\treturn \"sap/fe/templates/ObjectPage/designtime/ObjectPage.designtime\";\n}\n"],"mappings":";;;;oTAmBO,MAAMA,EAA6B,SACzCC,EACAC,GAEA,MAAMC,EAA0BF,EAChCE,EAAwBC,cAAgBC,EAAiBH,EAAkBD,EAAeK,OAAOC,QAASN,EAAeO,eACzHL,EAAwBM,WAAaC,IACrC,OAAOP,CACR,EAEAQ,EAAAX,6BASO,MAAMK,EAAmB,SAC/BH,EACAU,EACAJ,GAEA,IAAIK,EAA0B,GAC9B,MAAMC,EAAW,IAAIF,KAAkBJ,GAEvC,MAAMO,EAAgB,SAAUC,GAC/B,GAAIA,GAAeA,EAAYC,SAAS,MAAO,CAC9C,OAAOD,EAAYE,QAAQ,KAAM,KAAKC,MAAM,GAAI,GAAK,GACtD,CACA,OAAOH,CACR,EACA,MAAMI,EAA2BN,EAASO,OAAQC,IACjD,GAAIA,GAASC,eAAgB,CAC5B,MAAMC,EAAetB,EACnBuB,uBAA2CH,GAASC,gBACpDG,yBAAyBF,aAC3B,MAAMG,EAAoBC,EAA4BJ,GAAcK,aACpE,GAAIC,EAAWH,IAAsBA,EAAkBI,QAAK,8BAA+B,CAC1F,OAAO,IACR,CACD,IAED,MAAMC,EAAa9B,EAAiB+B,eACpC,GAAIb,EAAyBc,OAAS,EAAG,CACxCrB,EAA0BsB,EACzBf,EAAyB,GAAGG,eACzBrB,EACCuB,uBAA2CL,EAAyB,GAAGG,gBACvEG,yBAAyBF,aAC1BY,UACHJ,GAAYK,KACZjB,EAAyB,GACzBL,EAAcK,EAAyB,GAAGkB,SAAW,QACrDvB,EAAcK,EAAyB,GAAGmB,SAAW,QACrDxB,EAAcyB,EAA+B5B,IAC7CG,EAAc0B,EAA+B7B,IAE/C,KAAO,CACNC,EAA0BsB,EACzBC,UACAJ,GAAYK,KACZ,KACA,QACA,QACAtB,EAAcyB,EAA+B5B,IAC7CG,EAAc0B,EAA+B7B,IAE/C,CACA,OAAOC,CACR,EAAEF,EAAAN,mBAEK,SAASK,IACf,MAAO,8DACR,CAACC,EAAAD,gBAAA,OAAAC,CAAA","ignoreList":[]}