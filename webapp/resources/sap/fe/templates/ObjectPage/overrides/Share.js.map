{"version":3,"file":"Share.js","names":["FACET_IDENTIFIER","ADAPTIVECARD","bGlobalIsStickySupported","createFilterToFetchActiveContext","mKeyValues","bIsActiveEntityDefined","aKeys","Object","keys","aFilters","filter","sKey","sValue","undefined","map","Filter","FilterOperator","EQ","oActiveFilter","filters","and","push","async","getActiveContextPath","oController","sPageEntityName","oFilter","oListBinding","getView","getBindingContext","getModel","bindList","$$groupId","requestContexts","then","oContexts","length","getPath","getActiveContextInstances","oContext","oEntitySet","aActiveContextpromises","aPages","sMetaPath","getMetaModel","getMetaPath","indexOf","substring","aMetaPathArray","split","sCurrentHashNoParams","HashChanger","getInstance","getHash","aCurrentHashArray","oPageMap","aPageHashArray","forEach","sPageHash","aKeyValues","sPageHashName","ModelHelper","isDraftSupported","sKeyAssignment","aParts","sKeyValue","includes","oMetaModel","aTechnicalKeys","getObject","join","lastIndexOf","decodeURIComponent","oPageEntitySet","sNavigationPath","oPageInfo","sPageEntitySetName","$NavigationPropertyBinding","pageEntityName","getActiveContextPaths","sRootEntityName","oPageContext","Promise","all","aData","aActiveContextPaths","i","sActiveContextPath","sNavigatioProperty","sEntitySetName","values","replace","catch","oError","Log","info","resolve","fetchActiveContextPaths","oPromise","aSemanticKeys","oModel","isStickySessionSupported","SemanticKeyHelper","getSemanticKeys","oViewData","getViewData","viewLevel","getShareUrl","bIsEditable","bIsStickySupported","sShareUrl","sHash","sBasePath","hrefForAppSpecificHash","window","location","hash","origin","pathname","search","getShareEmailUrl","oUShellContainer","sap","ui","require","getFLPUrlAsync","sFLPUrl","sError","error","document","URL","getJamUrl","bIsEditMode","sJamUrl","ushellContainer","runningInIframe","getFLPUrl","sUrl","getQueryUrlForCardDefinition","context","pathsToQuery","DUMMY_GROUP_ID","model","requestor","oRequestor","selectOptions","path","requestSideEffects","requests","mBatchQueue","splice","longUrl","reduce","url","req","$owner","mergedReq","mergeGetRequests","absoluteServiceURL","getAbsoluteURL","getServiceUrl","getActionControls","opLayout","headerTitle","getHeaderTitle","headerActionsInUI","getActions","controls","actionInUI","isA","menu","getMenu","menuItems","getItems","serviceURL","regex","RegExp","test","ShareExtensionOverride","adaptShareMetadata","oShareMetadata","this","base","CommonUtils","getIsEditable","manifest","getAppComponent","getManifest","appId","id","appTitle","title","getController","oPageTitleInfo","_getPageTitleInformation","oData","sTitle","sObjectSubtitle","subtitle","toString","tile","email","jam","shareInfoModel","teamsUrl","getTeamsUrl","setProperty","getCardDefinition","cardDefinition","view","bindingContext","metaModel","opController","appComponent","getCollaborationManagerService","getDesignTimeCard","serviceURI","conveterdTypes","convertTypes","bindingContextPath","webUrl","contextPath","shellServiceHelper","getShellServices","contextInfo","cardConfig","headerFacets","getHeaderFacetsConfig","actions","getActionsConfig","objectTitle","getTitle","appUrl","getProperty","cardGenerator","AdaptiveCardGenerator","getPathsToQuery","queryUrl","controller","manifestActionsConfig","content","header","_getObjectPageLayoutControl","actionControlsInUI","actionConfig","config","actionControl","configKey","data","getText","isVisible","getActionVisibilityViaManifest","actionKey","startsWith","actionVisible","visible","enabled","dynamicHeaderControls","getHeaderContent","headerItems","cummulativeConfigs","currentFacet","facetIdentifer","formElementsConfig","_getFacetLabelsInfo","currentItem","isBound","getVisible","position","placement","Placement","After","anchor","pop","facetControl","labelCtrls","getFormLabels","allConfigs","label","labelIdentifier","labelText","endsWith"],"sources":["./Share.ts"],"sourcesContent":["import Log from \"sap/base/Log\";\nimport CommonUtils from \"sap/fe/core/CommonUtils\";\nimport type PageController from \"sap/fe/core/PageController\";\nimport type Share from \"sap/fe/core/controllerextensions/Share\";\nimport type { ShareMetadata } from \"sap/fe/core/controllerextensions/Share\";\nimport { type ManifestAction } from \"sap/fe/core/converters/ManifestSettings\";\nimport { convertTypes } from \"sap/fe/core/converters/MetaModelConverter\";\nimport { Placement } from \"sap/fe/core/converters/helpers/ConfigurableObject\";\nimport ModelHelper from \"sap/fe/core/helpers/ModelHelper\";\nimport SemanticKeyHelper from \"sap/fe/core/helpers/SemanticKeyHelper\";\nimport { type WrappedCard } from \"sap/fe/core/services/CollaborationManagerServiceFactory\";\nimport type ObjectPageController from \"sap/fe/templates/ObjectPage/ObjectPageController.controller\";\nimport AdaptiveCardGenerator from \"sap/fe/templates/ObjectPage/card/Generator\";\nimport type { CustomActionConfigs } from \"sap/fe/templates/ObjectPage/card/actions/HeaderActions\";\nimport type {\n\tCustomFormElementsConfig,\n\tCustomHeaderFacetConfigs,\n\tHeaderFacetConfig\n} from \"sap/fe/templates/ObjectPage/card/facets/HeaderContent\";\nimport type StashableHBox from \"sap/fe/templates/ObjectPage/controls/StashableHBox\";\nimport type Button from \"sap/m/Button\";\nimport type HBox from \"sap/m/HBox\";\nimport type Label from \"sap/m/Label\";\nimport type MenuButton from \"sap/m/MenuButton\";\nimport type MenuItem from \"sap/m/MenuItem\";\nimport type Control from \"sap/ui/core/Control\";\nimport HashChanger from \"sap/ui/core/routing/HashChanger\";\nimport Filter from \"sap/ui/model/Filter\";\nimport FilterOperator from \"sap/ui/model/FilterOperator\";\nimport type JSONModel from \"sap/ui/model/json/JSONModel\";\nimport type Context from \"sap/ui/model/odata/v4/Context\";\nimport type ODataModel from \"sap/ui/model/odata/v4/ODataModel\";\nimport type ObjectPageDynamicHeaderTitle from \"sap/uxap/ObjectPageDynamicHeaderTitle\";\nimport type ObjectPageLayout from \"sap/uxap/ObjectPageLayout\";\nimport type { IAdaptiveCard } from \"types/adaptiveCard_types\";\nimport type { MetaModelEntitySet } from \"../../../../../../../../types/metamodel_types\";\n\nconst FACET_IDENTIFIER = \"facetIdentifier\";\nconst ADAPTIVECARD = \"adaptive\";\nlet bGlobalIsStickySupported: boolean;\n\nfunction createFilterToFetchActiveContext(mKeyValues: Record<string, unknown>, bIsActiveEntityDefined: boolean): Filter {\n\tconst aKeys = Object.keys(mKeyValues);\n\n\tconst aFilters = aKeys\n\t\t.filter(function (sKey: string) {\n\t\t\tconst sValue = mKeyValues[sKey];\n\t\t\treturn sValue !== undefined;\n\t\t})\n\t\t.map(function (sKey: string) {\n\t\t\tconst sValue = mKeyValues[sKey];\n\t\t\treturn new Filter(sKey, FilterOperator.EQ, sValue);\n\t\t});\n\n\tif (bIsActiveEntityDefined) {\n\t\tconst oActiveFilter = new Filter({\n\t\t\tfilters: [new Filter(\"SiblingEntity/IsActiveEntity\", FilterOperator.EQ, true)],\n\t\t\tand: false\n\t\t});\n\n\t\taFilters.push(oActiveFilter);\n\t}\n\n\treturn new Filter(aFilters, true);\n}\nasync function getActiveContextPath(oController: PageController, sPageEntityName: string, oFilter: Filter): Promise<string> {\n\tconst oListBinding = oController\n\t\t.getView()\n\t\t.getBindingContext()\n\t\t.getModel()\n\t\t.bindList(`/${sPageEntityName}`, undefined, undefined, oFilter, { $$groupId: \"$auto.Heroes\" });\n\treturn oListBinding.requestContexts(0, 2).then(function (oContexts) {\n\t\tif (oContexts && oContexts.length) {\n\t\t\treturn oContexts[0].getPath();\n\t\t}\n\t\treturn \"\";\n\t});\n}\ntype PageInfo = { pageEntityName?: string; mKeyValues?: Record<string, unknown>; bIsActiveEntityDefined?: boolean };\nfunction getActiveContextInstances(oContext: Context, oController: PageController, oEntitySet: MetaModelEntitySet): Promise<string>[] {\n\tconst aActiveContextpromises: Promise<string>[] = [];\n\tconst aPages: PageInfo[] = [];\n\tlet sMetaPath = oContext.getModel().getMetaModel().getMetaPath(oContext.getPath());\n\tif (sMetaPath.indexOf(\"/\") === 0) {\n\t\tsMetaPath = sMetaPath.substring(1);\n\t}\n\tconst aMetaPathArray = sMetaPath.split(\"/\");\n\tconst sCurrentHashNoParams = HashChanger.getInstance().getHash().split(\"?\")[0];\n\tconst aCurrentHashArray = sCurrentHashNoParams.split(\"/\");\n\n\t// oPageMap - creating an object that contains map of metapath name and it's technical details\n\t// which is required to create a filter to fetch the relavant/correct active context\n\t// Example: {SalesOrderManage:{technicalID:technicalIDValue}, _Item:{technicalID:technicalIDValue}} etc.,\n\tconst oPageMap: Record<string, PageInfo> = {};\n\tconst aPageHashArray: string[] = [];\n\taCurrentHashArray.forEach(function (sPageHash: string) {\n\t\tconst aKeyValues = sPageHash.substring(sPageHash.indexOf(\"(\") + 1, sPageHash.length - 1).split(\",\");\n\t\tconst mKeyValues: Record<string, unknown> = {};\n\t\tconst sPageHashName = sPageHash.split(\"(\")[0];\n\t\toPageMap[sPageHashName] = {};\n\t\taPageHashArray.push(sPageHashName);\n\t\toPageMap[sPageHashName][\"bIsActiveEntityDefined\"] = ModelHelper.isDraftSupported(\n\t\t\toContext.getModel().getMetaModel(),\n\t\t\toContext.getPath()\n\t\t)\n\t\t\t? true\n\t\t\t: false;\n\t\tfor (const sKeyAssignment of aKeyValues) {\n\t\t\tconst aParts = sKeyAssignment.split(\"=\");\n\t\t\tlet sKeyValue = aParts[1];\n\t\t\tlet sKey = aParts[0];\n\t\t\t// In case if only one technical key is defined then the url just contains the technicalIDValue but not the technicalID\n\t\t\t// Example: SalesOrderManage(ID=11111129-aaaa-bbbb-cccc-ddddeeeeffff,IsActiveEntity=false)/_Item(11111129-aaaa-bbbb-cccc-ddddeeeeffff)\n\t\t\t// In above example SalesOrderItem has only one technical key defined, hence technicalID info is not present in the url\n\t\t\t// Hence in such cases we get technical key and use them to fetch active context\n\t\t\tif (!sKeyAssignment.includes(\"=\")) {\n\t\t\t\tconst oMetaModel = oContext.getModel().getMetaModel();\n\t\t\t\tconst aTechnicalKeys = oMetaModel.getObject(`/${aPageHashArray.join(\"/\")}/$Type/$Key`);\n\t\t\t\tsKeyValue = aParts[0];\n\t\t\t\tsKey = aTechnicalKeys[0];\n\t\t\t\toPageMap[sPageHash.split(\"(\")[0]][\"bIsActiveEntityDefined\"] = false;\n\t\t\t}\n\n\t\t\tif (sKey !== \"IsActiveEntity\") {\n\t\t\t\tif (sKeyValue.indexOf(\"'\") === 0 && sKeyValue.lastIndexOf(\"'\") === sKeyValue.length - 1) {\n\t\t\t\t\t// Remove the quotes from the value and decode special chars\n\t\t\t\t\tsKeyValue = decodeURIComponent(sKeyValue.substring(1, sKeyValue.length - 1));\n\t\t\t\t}\n\t\t\t\tmKeyValues[sKey] = sKeyValue;\n\t\t\t}\n\t\t}\n\t\toPageMap[sPageHashName].mKeyValues = mKeyValues;\n\t});\n\n\tlet oPageEntitySet = oEntitySet;\n\taMetaPathArray.forEach(function (sNavigationPath: string) {\n\t\tconst oPageInfo: PageInfo = {};\n\t\tconst sPageEntitySetName = oPageEntitySet.$NavigationPropertyBinding && oPageEntitySet.$NavigationPropertyBinding[sNavigationPath];\n\t\tif (sPageEntitySetName) {\n\t\t\toPageInfo.pageEntityName = oPageEntitySet.$NavigationPropertyBinding[sNavigationPath];\n\t\t\toPageEntitySet = oContext.getModel().getMetaModel().getObject(`/${sPageEntitySetName}`) || oEntitySet;\n\t\t} else {\n\t\t\toPageInfo.pageEntityName = sNavigationPath;\n\t\t}\n\t\toPageInfo.mKeyValues = oPageMap[sNavigationPath]?.mKeyValues;\n\t\toPageInfo.bIsActiveEntityDefined = oPageMap[sNavigationPath]?.bIsActiveEntityDefined;\n\t\taPages.push(oPageInfo);\n\t});\n\n\taPages.forEach(function (oPageInfo: PageInfo) {\n\t\tconst oFilter = createFilterToFetchActiveContext(oPageInfo.mKeyValues!, !!oPageInfo.bIsActiveEntityDefined);\n\t\taActiveContextpromises.push(getActiveContextPath(oController, oPageInfo.pageEntityName!, oFilter));\n\t});\n\n\treturn aActiveContextpromises;\n}\n\n/**\n * Method to fetch active context path's.\n * @param oContext The Page Context\n * @param oController\n * @returns Promise which is resolved once the active context's are fetched\n */\nasync function getActiveContextPaths(oContext: Context, oController: PageController): Promise<string[]> {\n\tconst sCurrentHashNoParams = HashChanger.getInstance().getHash().split(\"?\")[0];\n\tlet sRootEntityName = sCurrentHashNoParams && sCurrentHashNoParams.substring(0, sCurrentHashNoParams.indexOf(\"(\"));\n\tif (sRootEntityName.indexOf(\"/\") === 0) {\n\t\tsRootEntityName = sRootEntityName.substring(1);\n\t}\n\tconst oEntitySet = oContext.getModel().getMetaModel().getObject(`/${sRootEntityName}`);\n\tconst oPageContext = oContext;\n\tconst aActiveContextpromises = getActiveContextInstances(oContext, oController, oEntitySet);\n\tif (aActiveContextpromises.length > 0) {\n\t\treturn Promise.all(aActiveContextpromises)\n\t\t\t.then(function (aData: string[]) {\n\t\t\t\tconst aActiveContextPaths: string[] = [];\n\t\t\t\tlet oPageEntitySet = oEntitySet;\n\t\t\t\tif (aData[0]?.indexOf(\"/\") === 0) {\n\t\t\t\t\taActiveContextPaths.push(aData[0].substring(1));\n\t\t\t\t} else {\n\t\t\t\t\taActiveContextPaths.push(aData[0]);\n\t\t\t\t}\n\t\t\t\t// In the active context paths identify and replace the entitySet Name with corresponding navigation property name\n\t\t\t\t// Required to form the url pointing to active context\n\t\t\t\t// Example : SalesOrderItem --> _Item, MaterialDetails --> _MaterialDetails etc.,\n\t\t\t\tfor (let i = 1; i < aData.length; i++) {\n\t\t\t\t\tlet sActiveContextPath = aData[i];\n\t\t\t\t\tlet sNavigatioProperty = \"\";\n\t\t\t\t\tlet sEntitySetName = sActiveContextPath && sActiveContextPath.substring(0, sActiveContextPath.indexOf(\"(\"));\n\t\t\t\t\tif (sEntitySetName?.indexOf(\"/\") === 0) {\n\t\t\t\t\t\tsEntitySetName = sEntitySetName.substring(1);\n\t\t\t\t\t}\n\t\t\t\t\tif (sActiveContextPath?.indexOf(\"/\") === 0) {\n\t\t\t\t\t\tsActiveContextPath = sActiveContextPath.substring(1);\n\t\t\t\t\t}\n\t\t\t\t\tsNavigatioProperty = Object.keys(oPageEntitySet.$NavigationPropertyBinding)[\n\t\t\t\t\t\tObject.values(oPageEntitySet.$NavigationPropertyBinding).indexOf(sEntitySetName)\n\t\t\t\t\t];\n\t\t\t\t\tif (sNavigatioProperty) {\n\t\t\t\t\t\taActiveContextPaths.push(sActiveContextPath?.replace(sEntitySetName, sNavigatioProperty));\n\t\t\t\t\t\toPageEntitySet = oPageContext.getModel().getMetaModel().getObject(`/${sEntitySetName}`) || oEntitySet;\n\t\t\t\t\t} else {\n\t\t\t\t\t\taActiveContextPaths.push(sActiveContextPath);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\treturn aActiveContextPaths;\n\t\t\t})\n\t\t\t.catch(function (oError: unknown) {\n\t\t\t\tLog.info(\"Failed to retrieve one or more active context path's\", oError as string);\n\t\t\t\treturn [];\n\t\t\t});\n\t} else {\n\t\treturn Promise.resolve([]);\n\t}\n}\nasync function fetchActiveContextPaths(oContext: Context, oController: PageController): Promise<string[]> {\n\tlet oPromise, aSemanticKeys;\n\tconst sCurrentHashNoParams = HashChanger.getInstance().getHash().split(\"?\")[0];\n\tif (oContext) {\n\t\tconst oModel = oContext.getModel();\n\t\tconst oMetaModel = oModel.getMetaModel();\n\t\tbGlobalIsStickySupported = ModelHelper.isStickySessionSupported(oMetaModel);\n\t\tlet sRootEntityName = sCurrentHashNoParams && sCurrentHashNoParams.substring(0, sCurrentHashNoParams.indexOf(\"(\"));\n\t\tif (sRootEntityName.indexOf(\"/\") === 0) {\n\t\t\tsRootEntityName = sRootEntityName.substring(1);\n\t\t}\n\t\taSemanticKeys = SemanticKeyHelper.getSemanticKeys(oMetaModel, sRootEntityName);\n\t}\n\t// Fetch active context details incase of below scenario's(where page is not sticky supported(we do not have draft instance))\n\t// 1. In case of draft enabled Object page where semantic key based URL is not possible(like semantic keys are not modeled in the entity set)\n\t// 2. In case of draft enabled Sub Object Pages (where semantic bookmarking is not supported)\n\tconst oViewData = oController.getView().getViewData();\n\tif (oContext && !bGlobalIsStickySupported && ((oViewData.viewLevel === 1 && !aSemanticKeys) || oViewData.viewLevel >= 2)) {\n\t\toPromise = getActiveContextPaths(oContext, oController);\n\t\treturn oPromise;\n\t} else {\n\t\treturn Promise.resolve([]);\n\t}\n}\n\n// /**\n//  * Get share URL.\n//  * @param bIsEditable\n//  * @param bIsStickySupported\n//  * @param aActiveContextPaths\n//  * @returns {string} The share URL\n//  * @protected\n//  * @static\n//  */\nfunction getShareUrl(bIsEditable: boolean, bIsStickySupported: boolean, aActiveContextPaths: string[]): string {\n\tlet sShareUrl;\n\tconst sHash = HashChanger.getInstance().getHash();\n\tconst sBasePath = HashChanger.getInstance().hrefForAppSpecificHash ? HashChanger.getInstance().hrefForAppSpecificHash!(\"\") : \"\";\n\tif (bIsEditable && !bIsStickySupported && aActiveContextPaths) {\n\t\tsShareUrl = sBasePath + aActiveContextPaths.join(\"/\");\n\t} else {\n\t\tsShareUrl = sHash ? sBasePath + sHash : window.location.hash;\n\t}\n\treturn window.location.origin + window.location.pathname + window.location.search + sShareUrl;\n}\nasync function getShareEmailUrl(): Promise<string> {\n\tconst oUShellContainer = sap.ui.require(\"sap/ushell/Container\");\n\tif (oUShellContainer) {\n\t\treturn oUShellContainer\n\t\t\t.getFLPUrlAsync(true)\n\t\t\t.then(function (sFLPUrl: string) {\n\t\t\t\treturn sFLPUrl;\n\t\t\t})\n\t\t\t.catch(function (sError: unknown) {\n\t\t\t\tLog.error(\"Could not retrieve cFLP URL for the sharing dialog (dialog will not be opened)\", sError as string);\n\t\t\t});\n\t} else {\n\t\treturn Promise.resolve(document.URL);\n\t}\n}\n\nfunction getJamUrl(bIsEditMode: boolean, bIsStickySupported: boolean, aActiveContextPaths: string[]): Promise<string> | undefined {\n\tlet sJamUrl: string;\n\tconst sHash = HashChanger.getInstance().getHash();\n\tconst sBasePath = HashChanger.getInstance().hrefForAppSpecificHash ? HashChanger.getInstance().hrefForAppSpecificHash!(\"\") : \"\";\n\tif (bIsEditMode && !bIsStickySupported && aActiveContextPaths) {\n\t\tsJamUrl = sBasePath + aActiveContextPaths.join(\"/\");\n\t} else {\n\t\tsJamUrl = sHash ? sBasePath + sHash : window.location.hash;\n\t}\n\t// in case we are in cFLP scenario, the application is running\n\t// inside an iframe, and there for we need to get the cFLP URL\n\t// and not 'document.URL' that represents the iframe URL\n\tconst ushellContainer = sap.ui.require(\"sap/ushell/Container\");\n\tif (ushellContainer && ushellContainer.runningInIframe && ushellContainer.runningInIframe()) {\n\t\tushellContainer\n\t\t\t.getFLPUrl(true)\n\t\t\t.then(function (sUrl: string) {\n\t\t\t\treturn sUrl.substring(0, sUrl.indexOf(\"#\")) + sJamUrl;\n\t\t\t})\n\t\t\t.catch(function (sError: unknown) {\n\t\t\t\tLog.error(\"Could not retrieve cFLP URL for the sharing dialog (dialog will not be opened)\", sError as string);\n\t\t\t});\n\t} else {\n\t\treturn Promise.resolve(window.location.origin + window.location.pathname + sJamUrl);\n\t}\n}\n\n/**\n * Get query url formed by context and paths to request.\n * @param context Binding context of the view\n * @param pathsToQuery Paths to request. Add to $select and $expand query of the data URL.\n * @returns Query URL for data to be shown in the card.\n */\nfunction getQueryUrlForCardDefinition(context: Context, pathsToQuery: string[]): string | undefined {\n\t// NOTE: Below approach uses private implementations from UI5 V4 model and requestor.\n\t// This would need to change once we get a public API to support this requirement from UI5 V4 model (JIRA: FIORITECHP1-28756).\n\tconst DUMMY_GROUP_ID = \"_fe_ms_teams\";\n\tconst model = context.getModel();\n\tconst requestor = context.getModel().oRequestor;\n\tconst selectOptions = pathsToQuery.map((path) => path.replace(\".\", \"/\"));\n\tcontext.requestSideEffects(selectOptions, DUMMY_GROUP_ID);\n\t// For this scenario, 1st request in the batch is always empty according to model.\n\tconst requests = requestor.mBatchQueue?.[DUMMY_GROUP_ID]?.splice(1);\n\n\t// Batch queue contains separate requests from control bindings with different groupIds.\n\t// We need to merge the all the requests as we need a single data url.\n\tif (requests && requests.length > 0) {\n\t\t// Url for request can be different based on $select/$expand parameters.\n\t\tconst longUrl = requests.reduce((url, req) => (req.url.length > url.length ? req.url : url), \"\");\n\t\trequests.forEach((req) => {\n\t\t\tdelete req.$owner;\n\t\t\treq.url = longUrl;\n\t\t});\n\t\tconst mergedReq = requestor.mergeGetRequests(requests)[0];\n\t\tconst absoluteServiceURL = getAbsoluteURL(model.getServiceUrl());\n\t\tdelete requestor.mBatchQueue[DUMMY_GROUP_ID];\n\t\treturn `${absoluteServiceURL}${mergedReq.url}`;\n\t}\n}\n\n/**\n * Get action controls from object page layout.\n * @param opLayout ObjectPageLayout control.\n * @returns Action buttons and menu items present in OP header.\n */\nfunction getActionControls(opLayout: ObjectPageLayout): (Button | MenuItem)[] {\n\tconst headerTitle = opLayout.getHeaderTitle() as ObjectPageDynamicHeaderTitle;\n\tconst headerActionsInUI = headerTitle.getActions();\n\treturn headerActionsInUI.reduce(\n\t\t(controls, actionInUI): (Button | MenuItem)[] => {\n\t\t\tif (actionInUI?.isA?.<Button>(\"sap.m.Button\")) {\n\t\t\t\tcontrols.push(actionInUI);\n\t\t\t} else if (actionInUI?.isA?.<MenuButton>(\"sap.m.MenuButton\")) {\n\t\t\t\tconst menu = actionInUI.getMenu();\n\t\t\t\tconst menuItems = menu.getItems();\n\t\t\t\tcontrols = [...controls, ...menuItems];\n\t\t\t}\n\t\t\treturn controls;\n\t\t},\n\t\t[] as (Button | MenuItem)[]\n\t);\n}\n\n/**\n * Get absolute service url.\n * @param serviceURL Service URL\n * @returns Absolute service URL.\n */\nfunction getAbsoluteURL(serviceURL: string): string {\n\tconst regex = new RegExp(\"^(?:[a-z]+:)?//\", \"i\");\n\tif (regex.test(serviceURL)) {\n\t\treturn serviceURL;\n\t}\n\treturn `${window.location.origin}${serviceURL}`;\n}\n\nconst ShareExtensionOverride = {\n\tadaptShareMetadata: async function (this: Share, oShareMetadata: ShareMetadata): Promise<unknown> {\n\t\tconst oContext = this.base.getView().getBindingContext();\n\t\tconst bIsEditable = CommonUtils.getIsEditable(this.base.getView());\n\n\t\ttry {\n\t\t\tconst manifest = this.base.getAppComponent().getManifest();\n\t\t\tconst appId = manifest?.[\"sap.app\"]?.id;\n\t\t\tconst appTitle = manifest?.[\"sap.app\"]?.title;\n\t\t\tconst aActiveContextPaths = await fetchActiveContextPaths(oContext, this.base.getView().getController());\n\t\t\tconst oPageTitleInfo = await (this.base.getView().getController() as ObjectPageController)._getPageTitleInformation();\n\t\t\tconst oData = await Promise.all([\n\t\t\t\tgetJamUrl(bIsEditable, bGlobalIsStickySupported, aActiveContextPaths),\n\t\t\t\tgetShareUrl(bIsEditable, bGlobalIsStickySupported, aActiveContextPaths),\n\t\t\t\tgetShareEmailUrl()\n\t\t\t]);\n\n\t\t\tlet sTitle = oPageTitleInfo.title;\n\t\t\tconst sObjectSubtitle = oPageTitleInfo.subtitle ? oPageTitleInfo.subtitle.toString() : \"\";\n\t\t\tif (sObjectSubtitle) {\n\t\t\t\tsTitle = `${sTitle} - ${sObjectSubtitle}`;\n\t\t\t}\n\t\t\toShareMetadata.tile = {\n\t\t\t\ttitle: oPageTitleInfo.title,\n\t\t\t\tsubtitle: sObjectSubtitle\n\t\t\t};\n\t\t\toShareMetadata.email.title = sTitle;\n\t\t\toShareMetadata.title = sTitle;\n\t\t\toShareMetadata.jam.url = oData[0];\n\t\t\toShareMetadata.url = oData[1];\n\t\t\toShareMetadata.email.url = oData[2];\n\t\t\t// MS Teams collaboration does not want to allow further changes to the URL\n\t\t\t// so update colloborationInfo model at LR override to ignore further extension changes at multiple levels\n\t\t\tconst shareInfoModel = this.base?.getView()?.getModel(\"shareInfo\") as JSONModel | undefined;\n\t\t\tconst teamsUrl = await this.getTeamsUrl(oShareMetadata.url);\n\t\t\tif (shareInfoModel) {\n\t\t\t\tshareInfoModel.setProperty(\"/collaborationInfo/url\", teamsUrl);\n\t\t\t\tshareInfoModel.setProperty(\"/collaborationInfo/appTitle\", appTitle);\n\t\t\t\tshareInfoModel.setProperty(\"/collaborationInfo/subTitle\", sObjectSubtitle);\n\t\t\t\tshareInfoModel.setProperty(\"/collaborationInfo/appId\", appId);\n\t\t\t}\n\t\t} catch (error: unknown) {\n\t\t\tLog.error(error as string);\n\t\t}\n\n\t\treturn oShareMetadata;\n\t},\n\n\t/**\n\t * Get adaptive card definition for object page to  share via MS teams collaboration.\n\t * @returns Adaptive card definition.\n\t */\n\tgetCardDefinition: async function (this: Share): Promise<IAdaptiveCard | undefined | WrappedCard> {\n\t\tlet cardDefinition: IAdaptiveCard | undefined | WrappedCard;\n\t\tconst view = this.base.getView();\n\t\tconst bindingContext = this.base.getView().getBindingContext();\n\t\tconst model = bindingContext?.getModel() as ODataModel | undefined;\n\t\tconst metaModel = model?.getMetaModel();\n\t\tconst opController = view.getController() as ObjectPageController;\n\t\tconst appComponent = opController.getAppComponent();\n\t\tcardDefinition = (await appComponent.getCollaborationManagerService().getDesignTimeCard(ADAPTIVECARD)) as WrappedCard;\n\t\tif (!cardDefinition && model && metaModel && bindingContext) {\n\t\t\tconst serviceURI = getAbsoluteURL(model.getServiceUrl());\n\t\t\tconst conveterdTypes = convertTypes(metaModel);\n\t\t\tconst bindingContextPath = bindingContext.getPath();\n\t\t\tconst webUrl = `${serviceURI}${bindingContextPath.substring(1)}`;\n\t\t\tconst contextPath = `${metaModel.getMetaPath(bindingContext.getPath())}/`;\n\t\t\tconst shellServiceHelper = opController.getAppComponent().getShellServices();\n\t\t\tconst contextInfo = {\n\t\t\t\tcontextPath,\n\t\t\t\tbindingContextPath\n\t\t\t};\n\n\t\t\t// pass facet as part of cardConfig\n\t\t\tconst cardConfig = {\n\t\t\t\theaderFacets: ShareExtensionOverride.getHeaderFacetsConfig(opController),\n\t\t\t\tactions: ShareExtensionOverride.getActionsConfig(opController),\n\t\t\t\twebUrl,\n\t\t\t\tserviceURI,\n\t\t\t\tobjectTitle: await shellServiceHelper.getTitle(),\n\t\t\t\tappUrl: this.base.getView().getModel(\"shareInfo\")?.getProperty(\"/collaborationInfo/url\"),\n\t\t\t\tcontextInfo\n\t\t\t};\n\t\t\tconst cardGenerator = new AdaptiveCardGenerator(conveterdTypes, cardConfig);\n\t\t\tconst pathsToQuery = cardGenerator.getPathsToQuery();\n\t\t\t// TODO:\n\t\t\t// 'getQueryUrlForCardDefinition' uses a private implementation from V4 model to create query url.\n\t\t\t// This workaround was discussed with V4 model for temporary use.\n\t\t\t// We would need to revert this once we have an API or better approach from V4 model.(JIRA: FIORITECHP1-28756)\n\t\t\tconst queryUrl = getQueryUrlForCardDefinition(bindingContext, pathsToQuery);\n\t\t\tcardDefinition = cardGenerator.getCardDefinition(queryUrl);\n\t\t} else if (!cardDefinition) {\n\t\t\tLog.error(\"FE V4 : Share Object Page controller extension : Card was not created\");\n\t\t}\n\t\treturn cardDefinition;\n\t},\n\n\t/**\n\t * Get action configs for card creation.\n\t * @param controller View controller.\n\t * @returns Action configs\n\t */\n\tgetActionsConfig: function (controller: ObjectPageController): CustomActionConfigs {\n\t\t// fetch the information about UI from object page layout\n\t\tconst manifestActionsConfig = controller.getView().getViewData().content?.header?.actions || {};\n\t\tconst opLayout = controller._getObjectPageLayoutControl();\n\t\tconst actionControlsInUI = getActionControls(opLayout);\n\t\tconst actionConfig = actionControlsInUI.reduce((config, actionControl) => {\n\t\t\tconst configKey = actionControl.data(\"annotatedActionIdentifier\");\n\t\t\tif (configKey) {\n\t\t\t\tconfig[configKey] = {\n\t\t\t\t\ttitle: actionControl.getText()\n\t\t\t\t};\n\t\t\t\tif (manifestActionsConfig[configKey]) {\n\t\t\t\t\tconfig[configKey].isVisible = this.getActionVisibilityViaManifest(manifestActionsConfig[configKey]);\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn config;\n\t\t}, {} as CustomActionConfigs);\n\t\tObject.keys(manifestActionsConfig).forEach((actionKey: string) => {\n\t\t\tif (actionKey.startsWith(\"DataFieldForAction\") && !actionConfig[actionKey]) {\n\t\t\t\tconst actionVisible = this.getActionVisibilityViaManifest(manifestActionsConfig[actionKey]);\n\t\t\t\tif (actionVisible !== undefined) {\n\t\t\t\t\tactionConfig[actionKey] = {\n\t\t\t\t\t\tisVisible: actionVisible\n\t\t\t\t\t};\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t\treturn actionConfig;\n\t},\n\n\t/**\n\t * Returns action visiblity based on manifest configuration.\n\t * If the action has have dynamic visibility or enablement from manifest, it is not visible in the card.\n\t * @param manifestActionsConfig Manifest Action config\n\t * @returns Boolean value to indicate visibility of action\n\t */\n\tgetActionVisibilityViaManifest: function (manifestActionsConfig: ManifestAction): boolean | undefined {\n\t\tlet actionVisible = typeof manifestActionsConfig.visible === \"boolean\" ? manifestActionsConfig.visible : undefined;\n\t\tif (typeof manifestActionsConfig.visible === \"string\") {\n\t\t\tactionVisible = manifestActionsConfig.visible === \"true\" ? true : false;\n\t\t}\n\n\t\t// Enable is dynamic or statically false.\n\t\tif (actionVisible !== false) {\n\t\t\tif (\n\t\t\t\tmanifestActionsConfig.enabled === false ||\n\t\t\t\t(typeof manifestActionsConfig.enabled === \"string\" && manifestActionsConfig.enabled !== \"true\")\n\t\t\t) {\n\t\t\t\tactionVisible = false;\n\t\t\t}\n\t\t}\n\t\treturn actionVisible;\n\t},\n\n\t/**\n\t * Get header facets with title, position and visibility.\n\t * @param controller Object page controller\n\t * @returns Object of facets\n\t */\n\tgetHeaderFacetsConfig: function (controller: ObjectPageController): CustomHeaderFacetConfigs {\n\t\t// fetch the information about UI from object page layout\n\t\tconst dynamicHeaderControls = (controller._getObjectPageLayoutControl().getHeaderContent()[0] as HBox)?.getItems();\n\t\t// get visibility, title and manually calculate position from UI changes\n\n\t\tconst headerItems: CustomHeaderFacetConfigs = dynamicHeaderControls?.reduce(\n\t\t\t(cummulativeConfigs: CustomHeaderFacetConfigs, currentFacet: Control | StashableHBox) => {\n\t\t\t\tconst facetIdentifer: string | null = currentFacet.data(FACET_IDENTIFIER);\n\t\t\t\tif (facetIdentifer && currentFacet.isA<StashableHBox>(\"sap.fe.templates.ObjectPage.controls.StashableHBox\")) {\n\t\t\t\t\t// Direct StashableHBox is an equivalent of ReferenceFacet.\n\t\t\t\t\tconst formElementsConfig = ShareExtensionOverride._getFacetLabelsInfo(currentFacet);\n\t\t\t\t\tconst currentItem: HeaderFacetConfig = {\n\t\t\t\t\t\t// In case of key user changes from FLP, the visible property is not bound(modifier unbinds the control property).\n\n\t\t\t\t\t\t// If there is a binding then it can come from annotations or manifest.\n\t\t\t\t\t\t// We don't support manifest overrides for visible yet for header content in cards.\n\t\t\t\t\t\t// So, if there is a binding we fall back to annotations(default behaviour of Adaptive Card Generator).\n\n\t\t\t\t\t\t// If there is no binding, it might mean that there might be key user change or visible by default.\n\t\t\t\t\t\tisVisible: currentFacet.isBound(\"visible\") ? undefined : currentFacet.getVisible(),\n\t\t\t\t\t\ttitle: currentFacet.getTitle(),\n\t\t\t\t\t\tposition: {\n\t\t\t\t\t\t\tplacement: Placement.After,\n\t\t\t\t\t\t\tanchor: Object.keys(cummulativeConfigs).pop() || \"\"\n\t\t\t\t\t\t},\n\t\t\t\t\t\tformElementsConfig\n\t\t\t\t\t};\n\t\t\t\t\tcummulativeConfigs[facetIdentifer] = currentItem;\n\t\t\t\t\treturn cummulativeConfigs;\n\t\t\t\t}\n\t\t\t\treturn cummulativeConfigs;\n\t\t\t},\n\t\t\t{}\n\t\t);\n\t\treturn headerItems;\n\t},\n\n\t/**\n\t * Get form elements label configurations from facet.\n\t * @param facetControl StashableHBox control that represents the reference facet.\n\t * @returns Form elements' label text configurations\n\t */\n\t_getFacetLabelsInfo(facetControl: StashableHBox): CustomFormElementsConfig {\n\t\tconst labelCtrls = facetControl.getFormLabels();\n\n\t\treturn labelCtrls.reduce((allConfigs: CustomFormElementsConfig, label: Label) => {\n\t\t\tconst labelIdentifier = label.data(\"labelIdentifier\");\n\t\t\tconst labelText = label.getText();\n\t\t\tif (labelIdentifier) {\n\t\t\t\tallConfigs[labelIdentifier] = {\n\t\t\t\t\tlabelText: labelText.endsWith(\":\") ? labelText.substring(0, labelText.length - 1) : labelText\n\t\t\t\t};\n\t\t\t}\n\t\t\treturn allConfigs;\n\t\t}, {} as CustomFormElementsConfig);\n\t}\n};\n\nexport default ShareExtensionOverride;\n"],"mappings":"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","ignoreList":[]}