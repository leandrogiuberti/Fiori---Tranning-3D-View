{"version":3,"file":"DraftToggle.js","names":["DraftToggle","_dec","defineUI5Class","_dec2","implementInterface","_dec3","property","type","_dec4","_dec5","_dec6","defineReference","_dec7","_class","_class2","_BuildingBlock","props","others","_this","call","this","_initializerDefineProperty","_descriptor","_descriptor2","SWITCH_TO_DRAFT_KEY","SWITCH_TO_ACTIVE_KEY","_descriptor3","_descriptor4","_descriptor5","_descriptor6","initialSelectedKey","_hiddenDraft","handleSelectedItemChange","event","selectedItemKey","getParameter","getProperty","_containingView","getController","editFlow","toggleDraftActive","getBindingContext","popover","close","destroy","openSwitchActivePopover","sourceControl","getSource","containingView","CommonUtils","getTargetView","context","isActiveEntity","getObject","IsActiveEntity","createPopover","addDependent","openBy","attachEventOnce","switchToDraftRef","current","focus","switchToActiveRef","attachModelContextChange","handleVisibility","self","content","getBinding","attachEvent","localEvent","visible","getExternalValue","detachModelContextChange","_exports","_inheritsLoose","_proto","prototype","onMetadataAvailable","controller","_getOwner","getRootController","getAppComponent","getEnvironmentCapabilities","getCapabilities","HiddenDraft","enabled","createContent","getEnabled","getOverflowToolbarConfig","canOverflow","_jsx","ResponsivePopover","showHeader","contentWidth","verticalScrolling","class","placement","children","_jsxs","SelectList","selectedKey","itemPress","Item","text","ref","contextPathToUse","preprocessorContext","fullContextPath","odataMetaModel","getMetaModel","createBindingContext","contextPath","entityset","MetaModelConverter","convertMetaModelContext","textValue","ifElse","and","not","UI","IsEditable","IsCreateMode","Entity","HasDraft","pathInModel","getSwitchDraftAndActiveVisibility","invisibleText","InvisibleText","id","createId","toStatic","draftToggle","Button","icon","iconFirst","press","ariaDescribedBy","undefined","getView","CommandExecution","command","execute","getSwitchToActiveVisibility","getSwitchToDraftVisibility","BuildingBlock","_applyDecoratedDescriptor","configurable","enumerable","writable","initializer"],"sources":["./DraftToggle.tsx"],"sourcesContent":["import type { EntitySet } from \"@sap-ux/vocabularies-types\";\nimport type { BindingToolkitExpression } from \"sap/fe/base/BindingToolkit\";\nimport { and, ifElse, not, pathInModel } from \"sap/fe/base/BindingToolkit\";\nimport type { PropertiesOf } from \"sap/fe/base/ClassSupport\";\nimport { defineReference, defineUI5Class, implementInterface, property } from \"sap/fe/base/ClassSupport\";\nimport type { Ref } from \"sap/fe/base/jsx-runtime/jsx\";\nimport CommonUtils from \"sap/fe/core/CommonUtils\";\nimport type PageController from \"sap/fe/core/PageController\";\nimport BuildingBlock from \"sap/fe/core/buildingBlocks/BuildingBlock\";\nimport CommandExecution from \"sap/fe/core/controls/CommandExecution\";\nimport type { HiddenDraft } from \"sap/fe/core/converters/ManifestSettings\";\nimport * as MetaModelConverter from \"sap/fe/core/converters/MetaModelConverter\";\nimport { Entity, UI } from \"sap/fe/core/helpers/BindingHelper\";\nimport {\n\tgetSwitchDraftAndActiveVisibility,\n\tgetSwitchToActiveVisibility,\n\tgetSwitchToDraftVisibility\n} from \"sap/fe/templates/ObjectPage/ObjectPageTemplating\";\nimport Button from \"sap/m/Button\";\nimport ResponsivePopover from \"sap/m/ResponsivePopover\";\nimport type { SelectList$ItemPressEvent } from \"sap/m/SelectList\";\nimport SelectList from \"sap/m/SelectList\";\nimport type Event from \"sap/ui/base/Event\";\nimport type { $ControlSettings } from \"sap/ui/core/Control\";\nimport InvisibleText from \"sap/ui/core/InvisibleText\";\nimport Item from \"sap/ui/core/Item\";\nimport type View from \"sap/ui/core/mvc/View\";\nimport type PropertyBinding from \"sap/ui/model/PropertyBinding\";\nimport type Context from \"sap/ui/model/odata/v4/Context\";\nimport type ObjectPageController from \"../ObjectPageController.controller\";\n\n@defineUI5Class(\"sap.fe.macros.DraftToggle\")\nexport default class DraftToggle extends BuildingBlock<Button> {\n\t@implementInterface(\"sap.m.IOverflowToolbarContent\")\n\t__implements__sap_m_IOverflowToolbarContent = true;\n\n\t@property({ type: \"boolean\" })\n\tpublic visible!: boolean;\n\n\tprivate _containingView!: View;\n\n\tprivate popover?: ResponsivePopover;\n\n\tprivate readonly SWITCH_TO_DRAFT_KEY = \"switchToDraft\";\n\n\tprivate readonly SWITCH_TO_ACTIVE_KEY = \"switchToActive\";\n\n\t@property({ type: \"string\" })\n\tpublic id?: string;\n\n\t@property({ type: \"string\" })\n\tpublic contextPath?: string;\n\n\t@defineReference()\n\tpublic switchToActiveRef!: Ref<Item>;\n\n\t@defineReference()\n\tpublic switchToDraftRef!: Ref<Item>;\n\n\tprivate initialSelectedKey: string = this.SWITCH_TO_ACTIVE_KEY;\n\n\tprivate _hiddenDraft = false;\n\n\tconstructor(props: $ControlSettings & PropertiesOf<DraftToggle>, others?: $ControlSettings) {\n\t\tsuper(props, others);\n\t\tthis.attachModelContextChange(function handleVisibility(event: Event) {\n\t\t\t// Forced to double cast to avoid typing errors.\n\t\t\tconst self = event.getSource() as unknown as DraftToggle;\n\t\t\tif (self.content?.getBinding(\"visible\")) {\n\t\t\t\tself.content?.getBinding(\"visible\")?.attachEvent(\"change\", (localEvent: Event<{}, PropertyBinding>) => {\n\t\t\t\t\tself.visible = localEvent.getSource().getExternalValue();\n\t\t\t\t});\n\t\t\t\tself.detachModelContextChange(handleVisibility, self);\n\t\t\t}\n\t\t}, this);\n\t}\n\n\t/**\n\t * Handler for the onMetadataAvailable event.\n\t */\n\tonMetadataAvailable(): void {\n\t\tconst controller = this._getOwner()?.getRootController() as ObjectPageController;\n\t\tthis._hiddenDraft = (controller.getAppComponent().getEnvironmentCapabilities().getCapabilities().HiddenDraft as HiddenDraft)\n\t\t\t?.enabled;\n\t\tif (!this.content && !this._hiddenDraft) {\n\t\t\tthis.content = this.createContent();\n\t\t}\n\t}\n\n\tgetEnabled(): boolean {\n\t\treturn this.content?.getProperty(\"enabled\") ?? true;\n\t}\n\n\tgetOverflowToolbarConfig(): object {\n\t\treturn {\n\t\t\tcanOverflow: true\n\t\t};\n\t}\n\n\thandleSelectedItemChange = (event: SelectList$ItemPressEvent): void => {\n\t\tconst selectedItemKey = event.getParameter(\"item\")?.getProperty(\"key\");\n\t\tif (selectedItemKey !== this.initialSelectedKey) {\n\t\t\t(this._containingView.getController() as PageController).editFlow.toggleDraftActive(\n\t\t\t\tthis._containingView.getBindingContext() as Context\n\t\t\t);\n\t\t}\n\t\tif (this.popover) {\n\t\t\tthis.popover.close();\n\t\t\tthis.popover.destroy();\n\t\t\tdelete this.popover;\n\t\t}\n\t};\n\n\topenSwitchActivePopover = (event: Event<{}, Button>): ResponsivePopover => {\n\t\tconst sourceControl = event.getSource();\n\t\tconst containingView = CommonUtils.getTargetView(sourceControl);\n\n\t\tconst context: Context = containingView.getBindingContext();\n\t\tconst isActiveEntity = context.getObject().IsActiveEntity;\n\t\tthis.initialSelectedKey = isActiveEntity ? this.SWITCH_TO_ACTIVE_KEY : this.SWITCH_TO_DRAFT_KEY;\n\t\tthis.popover = this.createPopover();\n\n\t\tthis._containingView = containingView;\n\t\tcontainingView.addDependent(this.popover);\n\t\tthis.popover.openBy(sourceControl);\n\t\tthis.popover.attachEventOnce(\"afterOpen\", () => {\n\t\t\tif (isActiveEntity) {\n\t\t\t\tthis.switchToDraftRef.current?.focus();\n\t\t\t} else {\n\t\t\t\tthis.switchToActiveRef.current?.focus();\n\t\t\t}\n\t\t});\n\t\treturn this.popover;\n\t};\n\n\tcreatePopover(): ResponsivePopover {\n\t\treturn (\n\t\t\t<ResponsivePopover\n\t\t\t\tshowHeader={false}\n\t\t\t\tcontentWidth={\"15.625rem\"}\n\t\t\t\tverticalScrolling={false}\n\t\t\t\tclass={\"sapUiNoContentPadding\"}\n\t\t\t\tplacement={\"Bottom\"}\n\t\t\t>\n\t\t\t\t<SelectList selectedKey={this.initialSelectedKey} itemPress={this.handleSelectedItemChange}>\n\t\t\t\t\t<Item\n\t\t\t\t\t\ttext={\"{sap.fe.i18n>C_COMMON_OBJECT_PAGE_DISPLAY_DRAFT_MIT}\"}\n\t\t\t\t\t\tkey={this.SWITCH_TO_DRAFT_KEY}\n\t\t\t\t\t\tref={this.switchToDraftRef}\n\t\t\t\t\t/>\n\t\t\t\t\t<Item\n\t\t\t\t\t\ttext={\"{sap.fe.i18n>C_COMMON_OBJECT_PAGE_DISPLAY_SAVED_VERSION_MIT}\"}\n\t\t\t\t\t\tkey={this.SWITCH_TO_ACTIVE_KEY}\n\t\t\t\t\t\tref={this.switchToActiveRef}\n\t\t\t\t\t/>\n\t\t\t\t</SelectList>\n\t\t\t</ResponsivePopover>\n\t\t);\n\t}\n\n\tcreateContent(): Button {\n\t\tconst contextPathToUse = this._getOwner()?.preprocessorContext?.fullContextPath;\n\t\tconst odataMetaModel = this._getOwner()?.getMetaModel();\n\t\tconst context = odataMetaModel?.createBindingContext(this.contextPath ?? contextPathToUse!);\n\t\tconst entityset = MetaModelConverter.convertMetaModelContext(context!) as EntitySet;\n\t\tconst textValue = ifElse(\n\t\t\tand(not(UI.IsEditable), not(UI.IsCreateMode), Entity.HasDraft),\n\t\t\tpathInModel(\"C_COMMON_OBJECT_PAGE_SAVED_VERSION_BUT\", \"sap.fe.i18n\"),\n\t\t\tpathInModel(\"C_COMMON_OBJECT_PAGE_DRAFT_BUT\", \"sap.fe.i18n\")\n\t\t);\n\t\tconst visible = getSwitchDraftAndActiveVisibility(entityset);\n\t\tconst controller = this._getOwner()?.getRootController() as ObjectPageController;\n\t\tconst invisibleText = (\n\t\t\t<InvisibleText\n\t\t\t\ttext=\"{sap.fe.i18n>T_HEADER_DATAPOINT_TITLE_DRAFT_SWITCHER_ARIA_BUTTON}\"\n\t\t\t\tid={this.createId(\"AriaTextDraftSwitcher\")}\n\t\t\t/>\n\t\t);\n\t\tinvisibleText.toStatic();\n\t\tconst draftToggle = (\n\t\t\t<Button\n\t\t\t\tid={this.createId(\"_dt\")}\n\t\t\t\tdt:designtime=\"not-adaptable\"\n\t\t\t\ttext={textValue}\n\t\t\t\tvisible={visible}\n\t\t\t\ticon=\"sap-icon://navigation-down-arrow\"\n\t\t\t\ticonFirst={false}\n\t\t\t\ttype=\"Transparent\"\n\t\t\t\tpress={(event: Event<{}, Button>): ResponsivePopover => this.openSwitchActivePopover(event)}\n\t\t\t\tariaDescribedBy={this.createId(\"AriaTextDraftSwitcher\") ? [this.createId(\"AriaTextDraftSwitcher\")!] : undefined}\n\t\t\t/>\n\t\t);\n\t\tdraftToggle.addDependent(invisibleText);\n\t\tcontroller.getView().addDependent(\n\t\t\t<CommandExecution\n\t\t\t\tcommand=\"SwitchToActiveObject\"\n\t\t\t\texecute={(): void => {\n\t\t\t\t\tcontroller.editFlow.toggleDraftActive(controller.getView().getBindingContext());\n\t\t\t\t}}\n\t\t\t\tvisible={getSwitchToActiveVisibility(entityset) as unknown as BindingToolkitExpression<boolean>}\n\t\t\t/>\n\t\t);\n\t\tcontroller.getView().addDependent(\n\t\t\t<CommandExecution\n\t\t\t\tcommand=\"SwitchToDraftObject\"\n\t\t\t\texecute={(): void => {\n\t\t\t\t\tcontroller.editFlow.toggleDraftActive(controller.getView().getBindingContext());\n\t\t\t\t}}\n\t\t\t\tvisible={getSwitchToDraftVisibility(entityset) as unknown as BindingToolkitExpression<boolean>}\n\t\t\t/>\n\t\t);\n\t\treturn draftToggle;\n\t}\n}\n"],"mappings":"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","ignoreList":[]}