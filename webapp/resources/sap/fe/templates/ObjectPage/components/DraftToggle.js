/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)
 *      (c) Copyright 2009-2025 SAP SE. All rights reserved
 */
sap.ui.define(["sap/fe/base/BindingToolkit","sap/fe/base/ClassSupport","sap/fe/core/CommonUtils","sap/fe/core/buildingBlocks/BuildingBlock","sap/fe/core/controls/CommandExecution","sap/fe/core/converters/MetaModelConverter","sap/fe/core/helpers/BindingHelper","sap/fe/templates/ObjectPage/ObjectPageTemplating","sap/m/Button","sap/m/ResponsivePopover","sap/m/SelectList","sap/ui/core/InvisibleText","sap/ui/core/Item","sap/fe/base/jsx-runtime/jsx","sap/fe/base/jsx-runtime/jsxs"],function(e,t,i,n,r,o,a,c,l,s,p,f,u,d,g){"use strict";var v,_,b,h,T,C,w,m,O,A,E,I,D,y,S;var x={};var P=c.getSwitchToDraftVisibility;var B=c.getSwitchToActiveVisibility;var R=c.getSwitchDraftAndActiveVisibility;var M=a.UI;var V=a.Entity;var j=t.property;var z=t.implementInterface;var H=t.defineUI5Class;var K=t.defineReference;var F=e.pathInModel;var N=e.not;var W=e.ifElse;var Y=e.and;function U(e,t,i,n){i&&Object.defineProperty(e,t,{enumerable:i.enumerable,configurable:i.configurable,writable:i.writable,value:i.initializer?i.initializer.call(n):void 0})}function k(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e,G(e,t)}function G(e,t){return G=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},G(e,t)}function J(e,t,i,n,r){var o={};return Object.keys(n).forEach(function(e){o[e]=n[e]}),o.enumerable=!!o.enumerable,o.configurable=!!o.configurable,("value"in o||o.initializer)&&(o.writable=!0),o=i.slice().reverse().reduce(function(i,n){return n(e,t,i)||i},o),r&&void 0!==o.initializer&&(o.value=o.initializer?o.initializer.call(r):void 0,o.initializer=void 0),void 0===o.initializer?(Object.defineProperty(e,t,o),null):o}function L(e,t){throw Error("Decorating class property failed. Please ensure that transform-class-properties is enabled and runs after the decorators transform.")}let q=(v=H("sap.fe.macros.DraftToggle"),_=z("sap.m.IOverflowToolbarContent"),b=j({type:"boolean"}),h=j({type:"string"}),T=j({type:"string"}),C=K(),w=K(),v(m=(O=function(e){function t(t,n){var r;r=e.call(this,t,n)||this;U(r,"__implements__sap_m_IOverflowToolbarContent",A,r);U(r,"visible",E,r);r.SWITCH_TO_DRAFT_KEY="switchToDraft";r.SWITCH_TO_ACTIVE_KEY="switchToActive";U(r,"id",I,r);U(r,"contextPath",D,r);U(r,"switchToActiveRef",y,r);U(r,"switchToDraftRef",S,r);r.initialSelectedKey=r.SWITCH_TO_ACTIVE_KEY;r._hiddenDraft=false;r.handleSelectedItemChange=e=>{const t=e.getParameter("item")?.getProperty("key");if(t!==r.initialSelectedKey){r._containingView.getController().editFlow.toggleDraftActive(r._containingView.getBindingContext())}if(r.popover){r.popover.close();r.popover.destroy();delete r.popover}};r.openSwitchActivePopover=e=>{const t=e.getSource();const n=i.getTargetView(t);const o=n.getBindingContext();const a=o.getObject().IsActiveEntity;r.initialSelectedKey=a?r.SWITCH_TO_ACTIVE_KEY:r.SWITCH_TO_DRAFT_KEY;r.popover=r.createPopover();r._containingView=n;n.addDependent(r.popover);r.popover.openBy(t);r.popover.attachEventOnce("afterOpen",()=>{if(a){r.switchToDraftRef.current?.focus()}else{r.switchToActiveRef.current?.focus()}});return r.popover};r.attachModelContextChange(function e(t){const i=t.getSource();if(i.content?.getBinding("visible")){i.content?.getBinding("visible")?.attachEvent("change",e=>{i.visible=e.getSource().getExternalValue()});i.detachModelContextChange(e,i)}},r);return r}x=t;k(t,e);var n=t.prototype;n.onMetadataAvailable=function e(){const t=this._getOwner()?.getRootController();this._hiddenDraft=t.getAppComponent().getEnvironmentCapabilities().getCapabilities().HiddenDraft?.enabled;if(!this.content&&!this._hiddenDraft){this.content=this.createContent()}};n.getEnabled=function e(){return this.content?.getProperty("enabled")??true};n.getOverflowToolbarConfig=function e(){return{canOverflow:true}};n.createPopover=function e(){return d(s,{showHeader:false,contentWidth:"15.625rem",verticalScrolling:false,class:"sapUiNoContentPadding",placement:"Bottom",children:g(p,{selectedKey:this.initialSelectedKey,itemPress:this.handleSelectedItemChange,children:[d(u,{text:"{sap.fe.i18n>C_COMMON_OBJECT_PAGE_DISPLAY_DRAFT_MIT}",ref:this.switchToDraftRef},this.SWITCH_TO_DRAFT_KEY),d(u,{text:"{sap.fe.i18n>C_COMMON_OBJECT_PAGE_DISPLAY_SAVED_VERSION_MIT}",ref:this.switchToActiveRef},this.SWITCH_TO_ACTIVE_KEY)]})})};n.createContent=function e(){const t=this._getOwner()?.preprocessorContext?.fullContextPath;const i=this._getOwner()?.getMetaModel();const n=i?.createBindingContext(this.contextPath??t);const a=o.convertMetaModelContext(n);const c=W(Y(N(M.IsEditable),N(M.IsCreateMode),V.HasDraft),F("C_COMMON_OBJECT_PAGE_SAVED_VERSION_BUT","sap.fe.i18n"),F("C_COMMON_OBJECT_PAGE_DRAFT_BUT","sap.fe.i18n"));const s=R(a);const p=this._getOwner()?.getRootController();const u=d(f,{text:"{sap.fe.i18n>T_HEADER_DATAPOINT_TITLE_DRAFT_SWITCHER_ARIA_BUTTON}",id:this.createId("AriaTextDraftSwitcher")});u.toStatic();const g=d(l,{id:this.createId("_dt"),"dt:designtime":"not-adaptable",text:c,visible:s,icon:"sap-icon://navigation-down-arrow",iconFirst:false,type:"Transparent",press:e=>this.openSwitchActivePopover(e),ariaDescribedBy:this.createId("AriaTextDraftSwitcher")?[this.createId("AriaTextDraftSwitcher")]:undefined});g.addDependent(u);p.getView().addDependent(d(r,{command:"SwitchToActiveObject",execute:()=>{p.editFlow.toggleDraftActive(p.getView().getBindingContext())},visible:B(a)}));p.getView().addDependent(d(r,{command:"SwitchToDraftObject",execute:()=>{p.editFlow.toggleDraftActive(p.getView().getBindingContext())},visible:P(a)}));return g};return t}(n),A=J(O.prototype,"__implements__sap_m_IOverflowToolbarContent",[_],{configurable:true,enumerable:true,writable:true,initializer:function(){return true}}),E=J(O.prototype,"visible",[b],{configurable:true,enumerable:true,writable:true,initializer:null}),I=J(O.prototype,"id",[h],{configurable:true,enumerable:true,writable:true,initializer:null}),D=J(O.prototype,"contextPath",[T],{configurable:true,enumerable:true,writable:true,initializer:null}),y=J(O.prototype,"switchToActiveRef",[C],{configurable:true,enumerable:true,writable:true,initializer:null}),S=J(O.prototype,"switchToDraftRef",[w],{configurable:true,enumerable:true,writable:true,initializer:null}),O))||m);x=q;return x},false);
//# sourceMappingURL=DraftToggle.js.map