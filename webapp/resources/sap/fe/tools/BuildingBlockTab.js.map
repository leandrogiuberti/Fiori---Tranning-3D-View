{"version":3,"file":"BuildingBlockTab.js","names":["buildingBlockIconTabFilter","addBuildingBlockTab","inspector","_jsx","IconTabFilter","text","children","items","Text","insertAggregation","_exports","addBBInfo","ui5Control","bb","getBuildingBlock","addBuildingBlockInfo","addDefinition","async","iconTabFilterContent","formattedXML","serializeControlAsFormattedXML","CodeEditor","syntaxHints","type","setHeight","window","innerHeight","setValue","addContentToIconTabFilter","bbInstance","getParent","isA","metaPath","contextPath","involvedObject","getDataModelObjectForMetaPath","getDefinitionNavigator","parent","formFields","$parent","push","label","visualization","Button","press","definition","key","involvedObjectElement","targetType","_type","Array","isArray","length","toString","undefined","value","simpleForm","SimpleForm","element","addContent","Label","VBox","content","index","iconTabFilter","getItems","removeContent","getContent"],"sources":["./BuildingBlockTab.tsx"],"sourcesContent":["import type BuildingBlock from \"sap/fe/core/buildingBlocks/BuildingBlock\";\nimport Button from \"sap/m/Button\";\nimport type IconTabBar from \"sap/m/IconTabBar\";\nimport IconTabFilter from \"sap/m/IconTabFilter\";\nimport Label from \"sap/m/Label\";\nimport Text from \"sap/m/Text\";\nimport VBox from \"sap/m/VBox\";\nimport type ManagedObject from \"sap/ui/base/ManagedObject\";\nimport CodeEditor from \"sap/ui/codeeditor/CodeEditor\";\nimport type Control from \"sap/ui/core/Control\";\nimport type UI5Element from \"sap/ui/core/Element\";\nimport SimpleForm from \"sap/ui/layout/form/SimpleForm\";\nimport { serializeControlAsFormattedXML } from \"./XMLSerializer\";\n\ntype AnnotationBuildingBlock = BuildingBlock & { metaPath: string; contextPath: string };\ntype DefinitionForm = { label: string; visualization: Text | Button };\nlet buildingBlockIconTabFilter: IconTabFilter;\n\nexport function addBuildingBlockTab(inspector: IconTabBar): void {\n\tbuildingBlockIconTabFilter = (\n\t\t<IconTabFilter key=\"buildingBlock\" text={\"Building Block\"}>\n\t\t\t{{\n\t\t\t\titems: [\n\t\t\t\t\t<IconTabFilter key=\"controlTree\" text=\"Control Tree\">\n\t\t\t\t\t\t<Text text=\"Start inspecting by hovering over items\" />\n\t\t\t\t\t</IconTabFilter>,\n\t\t\t\t\t<IconTabFilter key=\"definition\" text=\"Definition\"></IconTabFilter>\n\t\t\t\t]\n\t\t\t}}\n\t\t</IconTabFilter>\n\t);\n\tinspector.insertAggregation(\"items\", buildingBlockIconTabFilter, 1);\n}\n\nexport function addBBInfo(ui5Control: UI5Element): void {\n\tconst bb = getBuildingBlock(ui5Control);\n\taddBuildingBlockInfo(bb);\n\taddDefinition(bb);\n}\n\nexport async function addBuildingBlockInfo(bb: AnnotationBuildingBlock): Promise<void> {\n\tlet iconTabFilterContent;\n\tif (!bb) {\n\t\ticonTabFilterContent = <Text text=\"No associated Builing Block\" />;\n\t} else {\n\t\tconst formattedXML = await serializeControlAsFormattedXML(bb);\n\t\ticonTabFilterContent = <CodeEditor syntaxHints={false} type=\"XML\" />;\n\t\ticonTabFilterContent.setHeight(window.innerHeight - 120 + \"px\");\n\t\ticonTabFilterContent.setValue(formattedXML);\n\t}\n\taddContentToIconTabFilter(\"controlTree\", iconTabFilterContent);\n}\n\nconst getBuildingBlock = function (ui5Control: ManagedObject | null): AnnotationBuildingBlock {\n\tlet bbInstance;\n\twhile (ui5Control) {\n\t\tui5Control = ui5Control.getParent();\n\t\tif (!ui5Control) {\n\t\t\tbreak;\n\t\t}\n\n\t\tif (ui5Control.isA(\"sap.fe.core.buildingBlocks.BuildingBlock\")) {\n\t\t\tbbInstance = ui5Control;\n\t\t\tbreak;\n\t\t}\n\t}\n\treturn bbInstance as AnnotationBuildingBlock;\n};\n\nexport function addDefinition(bb: AnnotationBuildingBlock): void {\n\tlet iconTabFilterContent;\n\tif (bb && bb.metaPath && bb.contextPath) {\n\t\tconst involvedObject = bb.getDataModelObjectForMetaPath(bb.metaPath, bb.contextPath);\n\t\ticonTabFilterContent = getDefinitionNavigator(involvedObject as Record<string, unknown>);\n\t} else if (!bb) {\n\t\ticonTabFilterContent = <Text text=\"No associated Builing Block\" />;\n\t} else {\n\t\ticonTabFilterContent = <Text text=\"No Definition Found\" />;\n\t}\n\taddContentToIconTabFilter(\"definition\", iconTabFilterContent);\n}\n\nexport function getDefinitionNavigator(involvedObject: Record<string, unknown>, parent?: Record<string, unknown>): Control {\n\tconst formFields: DefinitionForm[] = [];\n\tinvolvedObject.$parent = parent;\n\tif (parent) {\n\t\tformFields.push({\n\t\t\tlabel: \"Parent\",\n\t\t\tvisualization: (\n\t\t\t\t<Button\n\t\t\t\t\ttext={\"Go Up\"}\n\t\t\t\t\ttype=\"Transparent\"\n\t\t\t\t\tpress={(): void => {\n\t\t\t\t\t\tconst definition = getDefinitionNavigator(parent, parent.$parent as Record<string, unknown>);\n\t\t\t\t\t\taddContentToIconTabFilter(\"definition\", definition);\n\t\t\t\t\t}}\n\t\t\t\t/>\n\t\t\t)\n\t\t});\n\t}\n\tfor (const key in involvedObject) {\n\t\tif (key === \"$parent\") {\n\t\t\tcontinue; // Skip the $parent property\n\t\t}\n\t\tlet visualization;\n\t\tconst involvedObjectElement = involvedObject[key];\n\t\tif (typeof involvedObjectElement === \"object\") {\n\t\t\tlet targetType = (involvedObjectElement as { _type?: string })._type;\n\t\t\tif (Array.isArray(involvedObjectElement) && involvedObjectElement.length > 0) {\n\t\t\t\ttargetType = (involvedObjectElement[0] as { _type?: string })._type + \" Array\";\n\t\t\t} else if (!targetType) {\n\t\t\t\ttargetType = \"Object\";\n\t\t\t}\n\t\t\tvisualization = (\n\t\t\t\t<Button\n\t\t\t\t\ttext={\"Type \" + targetType + \" > Drill Down\"}\n\t\t\t\t\ttype=\"Transparent\"\n\t\t\t\t\tpress={(): void => {\n\t\t\t\t\t\tconst definition = getDefinitionNavigator(involvedObjectElement as Record<string, unknown>, involvedObject);\n\t\t\t\t\t\taddContentToIconTabFilter(\"definition\", definition);\n\t\t\t\t\t}}\n\t\t\t\t/>\n\t\t\t);\n\t\t} else if (\n\t\t\ttypeof involvedObjectElement === \"string\" ||\n\t\t\ttypeof involvedObjectElement === \"number\" ||\n\t\t\ttypeof involvedObjectElement === \"boolean\"\n\t\t) {\n\t\t\tvisualization = <Text text={involvedObjectElement.toString()} />;\n\t\t} else if (involvedObjectElement === undefined || involvedObjectElement === null) {\n\t\t\tvisualization = <Text text=\"undefined\" />;\n\t\t} else if (typeof involvedObjectElement === \"function\") {\n\t\t\t<Button\n\t\t\t\ttext={key}\n\t\t\t\ttype=\"Transparent\"\n\t\t\t\tpress={(): void => {\n\t\t\t\t\tconst value = involvedObjectElement();\n\t\t\t\t\tconst definition = getDefinitionNavigator({ value: value });\n\t\t\t\t\taddContentToIconTabFilter(\"definition\", definition);\n\t\t\t\t}}\n\t\t\t/>;\n\t\t\t// TODO: we can probably do better over here\n\t\t\tcontinue;\n\t\t}\n\t\tformFields.push({\n\t\t\tlabel: key,\n\t\t\tvisualization\n\t\t});\n\t}\n\n\tconst simpleForm = <SimpleForm />;\n\tif (formFields.length > 0) {\n\t\tfor (const element of formFields) {\n\t\t\tsimpleForm.addContent(<Label text={element.label} />);\n\t\t\tsimpleForm.addContent(element.visualization);\n\t\t}\n\t}\n\n\treturn <VBox>{simpleForm}</VBox>;\n}\n\nfunction addContentToIconTabFilter(key: string, content: Control): void {\n\tlet index = 0;\n\tswitch (key) {\n\t\tcase \"controlTree\":\n\t\t\tindex = 0;\n\t\t\tbreak;\n\t\tcase \"definition\":\n\t\t\tindex = 1;\n\t\t\tbreak;\n\t\tdefault:\n\t\t\tbreak;\n\t}\n\tconst iconTabFilter = buildingBlockIconTabFilter.getItems()[index] as IconTabFilter;\n\ticonTabFilter.removeContent(iconTabFilter.getContent()[0]);\n\ticonTabFilter.addContent(content);\n}\n"],"mappings":"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","ignoreList":[]}