/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)
 *      (c) Copyright 2009-2025 SAP SE. All rights reserved
 */
sap.ui.define(["sap/fe/tools/BatchParser","sap/ui/model/odata/v4/ODataContextBinding","sap/ui/model/odata/v4/ODataListBinding","sap/ui/model/odata/v4/ODataPropertyBinding","sap/ui/base/ManagedObject","sap/ui/model/ManagedObjectBindingSupport","sap/ui/model/odata/v4/lib/_Requestor"],function(e,t,n,r,s,a,o){"use strict";var i={};var c=e.parseBatch;var p=e.BatchContent;function d(e){const i=r.prototype.createAndSetCache;const c=n.prototype.createAndSetCache;const p=t.prototype.createAndSetCache;const d=o.prototype.request;o.prototype.request=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++){t[n]=arguments[n]}if(!t[1].includes("sap-valid-feTrace")){const e=t[2].oOwner.oCache?.__feCacheId;if(e){if(t[1].includes("?")){t[1]+=`&sap-valid-feTrace=${e}`}else{t[1]+=`?sap-valid-feTrace=${e}`}}}return d.apply(this,t)};let f=0;const h={};n.prototype.createAndSetCache=function(){const e=this;for(var t=arguments.length,n=new Array(t),r=0;r<t;r++){n[r]=arguments[r]}const s=c.apply(this,n);s.__feBinding=e;if(!this.mParameters["sap-valid-feTrace"]){s.__feCacheId=f++;this.mParameters["sap-valid-feTrace"]=f++}else{s.__feCacheId=this.mParameters["sap-valid-feTrace"]}h[s.__feCacheId]=s;return s};const u=t.prototype.applyParameters;t.prototype.applyParameters=function(e){if(!e["sap-valid-feTrace"]){e["sap-valid-feTrace"]=f++}u.apply(this,[e])};t.prototype.createAndSetCache=function(){const e=this;for(var t=arguments.length,n=new Array(t),r=0;r<t;r++){n[r]=arguments[r]}const s=p.apply(this,n);s.__feBinding=e;s.__feCacheId=this.mParameters["sap-valid-feTrace"];h[s.__feCacheId]=s;return s};r.prototype.createAndSetCache=function(){const e=this;for(var t=arguments.length,n=new Array(t),r=0;r<t;r++){n[r]=arguments[r]}const s=i.apply(this,n);s.__feBinding=e;if(this.getRootBinding()===this){return s}if(!this.getRootBinding().mParameters?.["sap-valid-feTrace"]){s.__feCacheId=f++;this.getRootBinding().changeParameters({"sap-valid-feTrace":s.__feCacheId})}else{s.__feCacheId=this.getRootBinding().mParameters["sap-valid-feTrace"]}h[s.__feCacheId]=s;return s};const l=function(e){return function(){for(var t=arguments.length,n=new Array(t),r=0;r<t;r++){n[r]=arguments[r]}const s=e.apply(this,n);Object.keys(this.mBindingInfos).forEach(e=>{if(this.mBindingInfos[e].binding){this.mBindingInfos[e].binding.__feSource=this;this.mBindingInfos[e].binding.__feForProp=e;if(!this.mBindingInfos[e].binding.hasOwnProperty("closestDomRef")){Object.defineProperty(this.mBindingInfos[e].binding,"closestDomRef",{get:function(){let e=this.__feSource;while(e&&e.getDomRef&&!e.getDomRef()){e=e.getParent()}return e?.getDomRef&&e.getDomRef()}})}if(this.mBindingInfos[e].binding.aBindings){this.mBindingInfos[e].binding.aBindings.forEach(t=>{t.__feSource=this;t.__feInComposite=true;t.__feForProp=e;t.__feComposite=this.mBindingInfos[e].binding;if(!t.hasOwnProperty("closestDomRef")){Object.defineProperty(t,"closestDomRef",{get:function(){let e=this.__feSource;while(e&&e.getDomRef&&!e.getDomRef()){e=e.getParent()}return e?.getDomRef&&e.getDomRef()}})}})}}});return s}};const g=a.updateBindings;const y=s.prototype.updateBindings;a.updateBindings=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++){t[n]=arguments[n]}return l(g).apply(this,t)};s.prototype.updateBindings=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++){t[n]=arguments[n]}return l(y).apply(this,t)};e.createdCaches=h}function f(e){d(e);const t=XMLHttpRequest;window.XMLHttpRequest=function(){const n=new t;const r=n.open;const s=n.send;const a=n.setRequestHeader;n.open=function(){this.request??={};for(var e=arguments.length,t=new Array(e),n=0;n<e;n++){t[n]=arguments[n]}this.request.url=t[1];r.apply(this,t)};n.send=function(){this.request??={};for(var e=arguments.length,t=new Array(e),n=0;n<e;n++){t[n]=arguments[n]}this.request.body=t[0];s.apply(this,t)};n.setRequestHeader=function(){this.request??={};this.request.header??={};for(var e=arguments.length,t=new Array(e),n=0;n<e;n++){t[n]=arguments[n]}this.request.header[t[0].toLowerCase()]=t[1];a.apply(this,t)};n.addEventListener("load",function(t){if(t.target.responseURL.includes("$batch")){const n=this.request.body;const r=this.request.header["content-type"].split("boundary=")[1];const s=c(new p(n),r);const a=t.target.getResponseHeader("content-type").split("boundary=")[1];const o=t.target.responseText;const i=c(new p(o),a);i.parts.forEach((t,n)=>{const r=s.parts[n];const a=e.supportModel.getProperty("/data");const o=new URL(`http://example.com/${r.url}`);const i=new URLSearchParams(o.search);const c=i.get("sap-valid-feTrace");const p={};o.searchParams.forEach((e,t)=>{p[t]=e});a.push({urlBase:r.url.split("?")[0],request:r,responseBody:JSON.stringify(t.body,null,4),responseBodyObj:t.body,parameters:JSON.stringify(p,null,4),trace:c});e.supportModel.setProperty("/data",a);e.supportModel.refresh()})}});return n}}i.addODataTrace=f;return i},false);
//# sourceMappingURL=ODataTracer.js.map