/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)
 *      (c) Copyright 2009-2025 SAP SE. All rights reserved
 */
sap.ui.define(["sap/base/Log","sap/fe/base/BindingToolkit","sap/fe/base/ClassSupport","sap/fe/core/CommonUtils","sap/fe/core/controls/CommandExecution","sap/fe/core/helpers/BindingHelper","sap/m/Menu","sap/m/MenuItem","sap/ui/core/CustomData","sap/ui/performance/trace/FESRHelper","sap/fe/core/buildingBlocks/BuildingBlock","sap/fe/core/converters/controls/Common/Action","sap/fe/core/helpers/FPMHelper","sap/fe/core/helpers/ResourceModelHelper","sap/fe/macros/share/ShareOptions","sap/m/OverflowToolbarLayoutData","sap/m/OverflowToolbarMenuButton","sap/m/library","sap/ui/base/BindingInfo","./share/MsTeamsOptions","./share/ShareAPI","sap/fe/base/jsx-runtime/jsx"],function(e,t,n,r,i,a,s,o,l,u,c,p,h,f,m,d,_,b,g,M,O,A){"use strict";var S,T,C,I,E,y,w,v,R,x,P,B,L,V,N,D,k,z,H,F,j,J,U,G,X,$,W,q,K,Q,Y,Z,ee,te,ne,re,ie,ae,se,oe,le,ue,ce;function pe(e){return new Promise((t,n)=>{sap.ui.require([e],n=>{if(!(n&&n.__esModule)){n=n===null||!(typeof n==="object"&&e.endsWith("/library"))?{default:n}:n;Object.defineProperty(n,"__esModule",{value:true})}t(n)},e=>{n(e)})})}var he={};var fe=b.OverflowToolbarPriority;var me=f.getResourceModel;var de=p.PRINT_ICON;var _e=p.EXPORT_TO_SPREADSHEET_ICON;var be=p.EXPORT_TO_PDF_ICON;var ge=p.EXPORT_TO_CSV_ICON;var Me=a.UI;var Oe=n.property;var Ae=n.implementInterface;var Se=n.defineUI5Class;var Te=n.defineReference;var Ce=n.aggregation;var Ie=t.resolveBindingString;var Ee=t.or;var ye=t.not;var we=t.isConstant;var ve=t.constant;var Re=t.compileExpression;var xe=t.and;function Pe(e,t,n,r){n&&Object.defineProperty(e,t,{enumerable:n.enumerable,configurable:n.configurable,writable:n.writable,value:n.initializer?n.initializer.call(r):void 0})}function Be(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e,Le(e,t)}function Le(e,t){return Le=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},Le(e,t)}function Ve(e,t,n,r,i){var a={};return Object.keys(r).forEach(function(e){a[e]=r[e]}),a.enumerable=!!a.enumerable,a.configurable=!!a.configurable,("value"in a||a.initializer)&&(a.writable=!0),a=n.slice().reverse().reduce(function(n,r){return r(e,t,n)||n},a),i&&void 0!==a.initializer&&(a.value=a.initializer?a.initializer.call(i):void 0,a.initializer=void 0),void 0===a.initializer?(Object.defineProperty(e,t,a),null):a}function Ne(e,t){throw Error("Decorating class property failed. Please ensure that transform-class-properties is enabled and runs after the decorators transform.")}const De={COLLABORATION_MSTEAMS_CARD:"COLLABORATION_MSTEAMS_CARD",COLLABORATION_MSTEAMS_TAB:"COLLABORATION_MSTEAMS_TAB",COLLABORATION_MSTEAMS_CHAT:"COLLABORATION_MSTEAMS_CHAT"};const ke={...De,...{SEND_EMAIL:"SEND_EMAIL",SHARE_JAM:"SHARE_JAM",SAVE_AS_TILE:"SAVE_AS_TILE",MS_TEAMS_GROUP:"MS_TEAMS_GROUP",SHARE_COLLABORATION_MANAGER:"SHARE_COLLABORATION_MANAGER"}};let ze=(S=Se("sap.fe.macros.Share"),T=Oe({type:"string"}),C=Ae("sap.m.IOverflowToolbarContent"),I=Ce({type:"sap.fe.macros.share.ShareOptions",defaultClass:m,isDefault:true}),E=Oe({type:"string",defaultValue:fe.High}),y=Ce({type:"sap.fe.macros.share.MsTeamsOptions",defaultClass:M}),w=Te(),v=Te(),R=Te(),x=Te(),P=Te(),B=Te(),L=Te(),V=Te(),N=Te(),D=Te(),k=Te(),z=Te(),H=Te(),F=Te(),j=Te(),S(J=(U=function(t){function n(e,n){var r;let i;if(typeof e!=="string"){n=e;i=n.id}else{i=e}n??={};n.shareAPIId=i;n.id=undefined;r=t.call(this,undefined,n)||this;Pe(r,"shareAPIId",G,r);Pe(r,"__implements__sap_m_IOverflowToolbarContent",X,r);Pe(r,"shareOptions",$,r);Pe(r,"priority",W,r);Pe(r,"msTeamsOptions",q,r);Pe(r,"menuButton",K,r);Pe(r,"cmdExecution",Q,r);Pe(r,"menu",Y,r);Pe(r,"saveAsTileMenuItem",Z,r);Pe(r,"shareAsCollaborationManager",ee,r);Pe(r,"shareViaJAMMenuItem",te,r);Pe(r,"sendEmailMenuItem",ne,r);Pe(r,"shareAsCardMenuItem",re,r);Pe(r,"shareViaChatMenuItem",ie,r);Pe(r,"shareAsTabMenuItem",ae,r);Pe(r,"msTeamsGroupMenuItem",se,r);Pe(r,"printMenuItem",oe,r);Pe(r,"exportToSpreadsheetMenuItem",le,r);Pe(r,"exportToPDFMenuItem",ue,r);Pe(r,"exportToCSVMenuItem",ce,r);return r}he=n;Be(n,t);var a=n.prototype;a.onMetadataAvailable=function e(n){t.prototype.onMetadataAvailable.call(this,n);this.content=this.createContent(n.getAppComponent())};a._initializeMenuItems=async function e(t,n){let r=false;if(n.getEnvironmentCapabilities().getCapabilities().Collaboration){const{default:e}=await pe("sap/suite/ui/commons/collaboration/CollaborationHelper");r=await e.isTeamsModeActive()}if(r){this.menuButton.current?.unbindProperty("visible",true);this.menuButton.current?.setVisible(false);return}const i=t.getController();const a=n.getShellServices();const s=await a.waitForPluginsLoad();if(!s){const e=this.menuButton.current?.getAggregation("_control");e?.attachEventOnce("press",{},()=>this._initializeMenuItems,this)}this._blockInternalConfig=this._getShareBlockConfig(t);await this._addMenuItems(i,a,t);this.setShareOptionsVisibility()};a._addMenuItems=async function e(t,n,r){this._addSendEmailOption(t);await this._addShellBasedMenuItems(t,n);this._addPrintOptions(t,r);this._addExportExcelOptions(t,r);this._addExportCSVOptions(t,r);this._addExportPDFOptions(t,r)};a._callManifestActionsEvents=function t(n,r,i){const a=r.getViewData();const s=a?.share?.[i];const o=s?.press?.substring(0,s?.press?.lastIndexOf(".")).replace(/\./gi,"/");const l=s?.press?.substring(s?.press?.lastIndexOf(".")+1,s?.press?.length);if(o&&l){h.loadModuleAndCallMethod(o,l,r,n)}else{e.error("Failed to call event handler, Module and/or Method is not set properly")}};a._addPrintOptions=function e(t,n){const r=n.getViewData();if(r?.share?.hasOwnProperty("print")===true&&r?.share?.print?.hasOwnProperty("press")===true){this?.menu?.current?.addItem(A(o,{ref:this.printMenuItem,text:this.getTranslatedText("T_SHARE_CONTROL_PRINT"),icon:de,press:()=>{this._callManifestActionsEvents(t,n,"print")}}))}};a._addExportExcelOptions=function e(t,n){const r=n.getViewData();if(r?.share?.hasOwnProperty("exportToSpreadsheet")===true&&r?.share?.print?.hasOwnProperty("press")===true){this?.menu?.current?.addItem(A(o,{ref:this.exportToSpreadsheetMenuItem,text:this.getTranslatedText("T_SHARE_CONTROL_EXPORT_AS_EXCEL"),icon:_e,press:()=>{this._callManifestActionsEvents(t,n,"exportToSpreadsheet")}}))}};a._addExportCSVOptions=function e(t,n){const r=n.getViewData();if(r?.share?.hasOwnProperty("exportToCSV")===true&&r?.share?.print?.hasOwnProperty("press")===true){this?.menu?.current?.addItem(A(o,{ref:this.exportToCSVMenuItem,text:this.getTranslatedText("T_SHARE_CONTROL_EXPORT_AS_CSV"),icon:ge,press:()=>{this._callManifestActionsEvents(t,n,"exportToCSV")}}))}};a._addExportPDFOptions=function e(t,n){const r=n.getViewData();if(r?.share?.hasOwnProperty("exportToPDF")===true&&r?.share?.print?.hasOwnProperty("press")===true){this?.menu?.current?.addItem(A(o,{ref:this.exportToPDFMenuItem,text:this.getTranslatedText("T_SHARE_CONTROL_EXPORT_AS_PDF"),icon:be,press:()=>{this._callManifestActionsEvents(t,n,"exportToPDF")}}))}};a._addSendEmailOption=function e(t){if(this.shareOptions?.showSendEmail??true){this?.menu?.current?.addItem(A(o,{ref:this.sendEmailMenuItem,text:this.getTranslatedText("T_SEMANTIC_CONTROL_SEND_EMAIL"),icon:"sap-icon://email",press:async()=>t.share._triggerEmail()}))}};a._addShellBasedMenuItems=async function e(t,n){const r=n.hasUShell();if(r){this._addShareViaJAMOption(t,n);await this._addMSTeamsOptions(t);await this._addCollaborationManagerOption(t);await this._addSaveAsTileOption(t)}};a._addCollaborationManagerOption=async function t(n){try{const e=n.getAppComponent().getCollaborativeToolsService();const t=await e.getCollaborationManagerOption();if(t&&(this.shareOptions?.showCollaborationManager??false)){const e=A(o,{ref:this.shareAsCollaborationManager,text:t.text,icon:t.icon,press:async e=>this._collaborationManagerButtonPress(t.press,e)});u.setSemanticStepname(e,"press",t.fesrStepName);this?.menu?.current?.addItem(e)}}catch(t){const n=t instanceof Error?t.message:String(t);e.error(`FE : Adding Collaboration Manager Option : ${n}`)}};a._collaborationManagerButtonPress=async function e(t,n){const i=n.getSource();const a=r.getTargetView(i);const s=a.getController();await s.share._adaptShareMetadata();const o=a.getModel("shareInfo");if(o){const e=o.getData();const{collaborationInfo:n}=e;t(n.appTitle,n.url)}};a._addShareViaJAMOption=function e(t,n){const r=!!n.isJamActive?.();if(r){this?.menu?.current?.addItem(A(o,{ref:this.shareViaJAMMenuItem,text:this.getTranslatedText("T_COMMON_SAPFE_SHARE_JAM"),icon:"sap-icon://share-2",press:async()=>t.share._triggerShareToJam()}))}};a._addMSTeamsOptions=async function t(n){try{if(this._blockInternalConfig?.showMsTeamsOptions===false){return}const e=n.getAppComponent().getCollaborativeToolsService();const t=await e.getTeamsCollabOptionsViaShare({isShareAsCardEnabled:this._getIsShareAsCardEnabled()});if(!t){return}for(const e of t){const t=this._getMsTeamsMenuItemSettings(e);const n=t.items;const r=Array.isArray(n)&&n.length?ke.MS_TEAMS_GROUP:e.key;this._addMsTeamsMenuItem(t,r,e.fesrStepName)}}catch(t){const n=t instanceof Error?t.message:String(t);e.error(`FE : Buildingblock : Share : adding MS teams options : ${n}`)}};a._addSaveAsTileOption=async function t(n){try{const{default:e}=await pe("sap/ushell/ui/footerbar/AddBookmarkButton");const t=new e;if(t.getEnabled()){this?.menu?.current?.addItem(A(o,{ref:this.saveAsTileMenuItem,text:t.getText(),icon:t.getIcon(),press:async()=>n.share._saveAsTile(this.saveAsTileMenuItem.current),children:{dependents:[t]}}))}else{t.destroy()}}catch(t){const n=t instanceof Error?t.message:String(t);e.error(`FE : Buildingblock : Share : adding Save as tile option : ${n}`)}};a._getIsShareAsCardEnabled=function t(){const n=this.msTeamsOptions?.enableCard??false;if(typeof n==="boolean"){return n}else if(typeof n==="string"){try{return n==="true"||Boolean(g.parse(n))}catch(t){e.error(t)}}return true};a._getMsTeamsMenuItemSettings=function e(t){const n=this._getMsTeamsSubOptions(t?.subOptions);const r={text:t.text,icon:t.icon,items:n};if(n.length===0){r.press=async e=>this.collaborationMenuItemPress(e);r["customData"]=new l({key:"collaborationData",value:t})}return r};a._addMsTeamsMenuItem=function e(t,n,r){const i=A(o,{ref:this._getMenuItemReference(n),text:t.text,icon:t.icon,customData:t.customData,items:t.items});if(t.press){i.attachPress(t.press);if(r){u.setSemanticStepname(i,"press",r)}}this?.menu?.current?.addItem(i)};a._getMsTeamsSubOptions=function e(t){if(!Array.isArray(t)){return[]}return t.reduce((e,t)=>{const n=A(o,{ref:this._getMenuItemReference(t.key),text:t.text,icon:t.icon,press:async e=>this.collaborationMenuItemPress(e),customData:new l({key:"collaborationData",value:t})});if(t.fesrStepName){u.setSemanticStepname(n,"press",t.fesrStepName)}return[...e,n]},[])};a.collaborationMenuItemPress=async function t(n){const i=n.getSource();const a=r.getTargetView(i);const s=a.getController();await s.share._adaptShareMetadata();const o=a.getModel("shareInfo");if(o){const t=o.getData();const{collaborationInfo:n}=t;const r=i.data("collaborationData");const a=s.getAppComponent().getCollaborativeToolsService();const l=(await a.getCollaborationServices()).oTeamsHelperService;if(r["key"]===De.COLLABORATION_MSTEAMS_CARD){const t=l.isFeatureFlagEnabled();const r=t?await s.share.getCardDefinition():undefined;let i;if(r){const e=s.getAppComponent().getShellServices();const{semanticObject:t,action:n}=e.parseShellHash(document.location.hash);i=`${t}_${n}`}else{const n=!t?"Feature flag disabled in collaboration teams helper":"Card definition was not created";e.info(`FE V4 : Share block : share as Card : ${n}`)}n["cardManifest"]=r;n["cardId"]=i}l.share(r,n)}};a.setShareOptionsVisibility=function e(){const t=Object.keys(ke);const n=t.reduce((e,t)=>{const n=this._getShareOptionVisibilityExpression(t);this._setShareOptionVisibility(t,n);return[...e,n]},[]);const r=Ee(...n);if(this.menuButton.current&&this.cmdExecution.current){this._bindUIVisibility(this.menuButton.current,r);this._bindUIVisibility(this.cmdExecution.current,r)}};a._getMenuItemReference=function e(t){let n;switch(t){case ke.COLLABORATION_MSTEAMS_CARD:n=this.shareAsCardMenuItem;break;case ke.COLLABORATION_MSTEAMS_CHAT:n=this.shareViaChatMenuItem;break;case ke.COLLABORATION_MSTEAMS_TAB:n=this.shareAsTabMenuItem;break;case ke.SEND_EMAIL:n=this.sendEmailMenuItem;break;case ke.SHARE_JAM:n=this.shareViaJAMMenuItem;break;case ke.SAVE_AS_TILE:n=this.saveAsTileMenuItem;break;case ke.MS_TEAMS_GROUP:n=this.msTeamsGroupMenuItem;break;case ke.SHARE_COLLABORATION_MANAGER:n=this.shareAsCollaborationManager;break;default:break}return n};a._getShareOptionVisibilityExpression=function e(t){const n=this._getMenuItemReference(t);if(!n?.current){return ve(false)}let r;switch(t){case ke.COLLABORATION_MSTEAMS_CARD:case ke.COLLABORATION_MSTEAMS_CHAT:case ke.COLLABORATION_MSTEAMS_TAB:r=this._getMSTeamsShareOptionVisibility(t);break;case ke.SHARE_COLLABORATION_MANAGER:r=this._getCollaborationOptionExpression();break;case ke.SEND_EMAIL:{const e=Ie(this.shareOptions?.showSendEmail??true,"boolean");const t=Ie(this._blockInternalConfig.showSendEmail??true,"boolean");if(we(t)&&t.value===false){r=ve(false)}else if(we(t)&&t.value===true){r=this.shareOptions?.showSendEmail??true}else{r=xe(e,t)}break}case ke.SHARE_JAM:case ke.SAVE_AS_TILE:{r=ve(true);break}case ke.MS_TEAMS_GROUP:{const e=this._getShowMsTeamsOptionsExpression();const t=Object.keys(De);const n=t.reduce((e,t)=>{const n=this._getMSTeamsShareOptionVisibility(t);return[...e,n]},[]);r=xe(e,Ee(...n));break}default:r=ve(false)}return r};a._getCollaborationOptionExpression=function e(){const t=this.shareOptions?.showCollaborationManager??false;const n=Ie(t,"boolean");const r=this._blockInternalConfig.showCollaborationManager??true;const i=Ie(r,"boolean");return xe(n,i)};a._getShowMsTeamsOptionsExpression=function e(){const t=this._blockInternalConfig.showMsTeamsOptions??true;return Ie(t,"boolean")};a._getShareAsCardVisibility=function e(){let t;const n=this._getMenuItemReference(ke.COLLABORATION_MSTEAMS_CARD);if(n?.current){const e=this._getShowMsTeamsOptionsExpression();const n=this.msTeamsOptions?.enableCard??true;const r=Ie(n,"boolean");const i=this._blockInternalConfig.enableCard??true;const a=Ie(i,"boolean");const s=xe(r,a);t=xe(ye(Me.IsEditable),e,s)}else{t=ve(false)}return t};a._getMSTeamsShareOptionVisibility=function e(t){if(t===ke.COLLABORATION_MSTEAMS_CARD){return this._getShareAsCardVisibility()}const n=this._getMenuItemReference(t);return n?.current?this._getShowMsTeamsOptionsExpression():ve(false)};a._setShareOptionVisibility=function e(t,n){const r=this._getMenuItemReference(t);if(r?.current){this._bindUIVisibility(r.current,n)}};a._bindUIVisibility=function t(n,r){const i=Re(r);if(i&&i.startsWith("{")&&i?.endsWith("}")){try{const e=g.parse(i);n.bindProperty("visible",e)}catch(t){e.error(t)}}else if(i==="false"){n.unbindProperty("visible",true);n.setVisible(false)}};a._getShareBlockConfig=function e(t){const n=t.getViewData();const r=n?.share;const i=t.getController();const a=i.getAppComponent().getManifestEntry("sap.fe")?.app?.share;const s=this._getOptionBlockConfig(a?.showSendEmail,r?.showSendEmail);const o=this._getOptionBlockConfig(a?.showCollaborationManager,r?.showCollaborationManager);const l=this._getOptionBlockConfig(a?.teams?.showMsTeamsOptions,r?.teams?.showMsTeamsOptions);const u=this._getOptionBlockConfig(a?.teams?.asCard,r?.teams?.asCard);return{showSendEmail:s,showMsTeamsOptions:l,enableCard:u,showCollaborationManager:o}};a._getOptionBlockConfig=function e(t,n){const r=typeof t==="string"?Ie(t):ve(t??true);const i=typeof n==="string"?Ie(n):ve(n??true);return Re(xe(r,i))};a.createContent=function t(n){const r=A(O,{id:this.shareAPIId,children:A(_,{text:"{sap.fe.i18n>M_COMMON_SAPFE_ACTION_SHARE}",ref:this.menuButton,icon:"sap-icon://action",tooltip:"{sap.fe.i18n>M_COMMON_SAPFE_ACTION_SHARE} (Ctrl+Shift+S)",children:A(s,{ref:this.menu})})});this.getPageController().getView().addDependent(A(i,{ref:this.cmdExecution,command:"Share",execute:()=>{this.menuButton.current?.getMenu().openBy(this.menuButton.current,true)}}));this.isInitialized=this._initializeMenuItems(this.getPageController().getView(),n).catch(t=>{e.error(t)});this.setLayoutData(new d({priority:this.priority}));return r};a.getOverflowToolbarConfig=function e(){return{canOverflow:true,onBeforeEnterOverflow:function(e){(e?.getContent()?.getContent()).getText=function(){const t=me(e);return t.getText("M_COMMON_SAPFE_ACTION_SHARE")}},onAfterExitOverflow:function(e){(e?.getContent()?.getContent()).getText=function(){return""}},priority:this.priority}};return n}(c),G=Ve(U.prototype,"shareAPIId",[T],{configurable:true,enumerable:true,writable:true,initializer:null}),X=Ve(U.prototype,"__implements__sap_m_IOverflowToolbarContent",[C],{configurable:true,enumerable:true,writable:true,initializer:function(){return true}}),$=Ve(U.prototype,"shareOptions",[I],{configurable:true,enumerable:true,writable:true,initializer:null}),W=Ve(U.prototype,"priority",[E],{configurable:true,enumerable:true,writable:true,initializer:null}),q=Ve(U.prototype,"msTeamsOptions",[y],{configurable:true,enumerable:true,writable:true,initializer:null}),K=Ve(U.prototype,"menuButton",[w],{configurable:true,enumerable:true,writable:true,initializer:null}),Q=Ve(U.prototype,"cmdExecution",[v],{configurable:true,enumerable:true,writable:true,initializer:null}),Y=Ve(U.prototype,"menu",[R],{configurable:true,enumerable:true,writable:true,initializer:null}),Z=Ve(U.prototype,"saveAsTileMenuItem",[x],{configurable:true,enumerable:true,writable:true,initializer:null}),ee=Ve(U.prototype,"shareAsCollaborationManager",[P],{configurable:true,enumerable:true,writable:true,initializer:null}),te=Ve(U.prototype,"shareViaJAMMenuItem",[B],{configurable:true,enumerable:true,writable:true,initializer:null}),ne=Ve(U.prototype,"sendEmailMenuItem",[L],{configurable:true,enumerable:true,writable:true,initializer:null}),re=Ve(U.prototype,"shareAsCardMenuItem",[V],{configurable:true,enumerable:true,writable:true,initializer:null}),ie=Ve(U.prototype,"shareViaChatMenuItem",[N],{configurable:true,enumerable:true,writable:true,initializer:null}),ae=Ve(U.prototype,"shareAsTabMenuItem",[D],{configurable:true,enumerable:true,writable:true,initializer:null}),se=Ve(U.prototype,"msTeamsGroupMenuItem",[k],{configurable:true,enumerable:true,writable:true,initializer:null}),oe=Ve(U.prototype,"printMenuItem",[z],{configurable:true,enumerable:true,writable:true,initializer:null}),le=Ve(U.prototype,"exportToSpreadsheetMenuItem",[H],{configurable:true,enumerable:true,writable:true,initializer:null}),ue=Ve(U.prototype,"exportToPDFMenuItem",[F],{configurable:true,enumerable:true,writable:true,initializer:null}),ce=Ve(U.prototype,"exportToCSVMenuItem",[j],{configurable:true,enumerable:true,writable:true,initializer:null}),U))||J);he=ze;return he},false);
//# sourceMappingURL=Share.js.map