{"version":3,"file":"ValueHelpDelegate.js","names":["FeCoreControlsFilterBar","AnnotationIsDigitSequence","Object","assign","ValueHelpDelegate","apiVersion","updateBindingDonePromises","WeakMap","isSearchSupported","valueHelp","content","_listBinding","data","updateBindingInfo","bindingInfo","search","getFilterValue","normalizedSearch","CommonUtils","normalizeSearchTerm","parameters","$search","undefined","_getValueHelpHistoryService","control","appComponent","getAppComponent","getTargetView","getValueHelpHistoryService","checkConditionsEqual","oldCondition","newCondition","operator","values1","values","values2","length","sortedValues1","sort","firstValue","secondValue","String","localeCompare","sortedValues2","every","value","index","_getHistoryData","async","payload","history","enabled","isPotentiallySensitive","valueListHistoryService","this","fieldData","getFieldData","propertyPath","valueHelpQualifier","err","Log","error","Error","message","_setHistoryData","conditions","valueListProperty","_getValueListPropertyFromPayloadQualifier","condition","isUnitValueHelp","validated","ConditionValidated","Validated","conditionPayloadMap","_getConditionPayloadList","push","convertConditionPayloadToNestedObject","setFieldData","conditionPayload","nestedObject","key","ObjectPath","set","split","_isEmptyDigitSequence","isDigitSequence","isEmptyDigitSequence","char","updateBinding","listBinding","isA","getPayload","isTypeahead","updateBindingDonePromiseResolve","newPromise","Promise","resolve","existingUpdateBindingDonePromise","get","then","field","getControl","isFilterFieldOrMultiValuedField","fieldValue","getValue","additionalValues","getModel","getMetaModel","getObject","hasPendingUserInput","getRelevantRecommendations","groupKey","AdditionalValueGroupKey","recommendation","table","getTable","sortersCustomData","getCustomData","filter","getKey","sorters","_updateBindingWithTransientContexts","_updateBinding","executeFilter","requestedItems","getContexts","checkListBindingPending","_valueHelp","isPending","has","isSuspended","contexts","requestContexts","canceled","getTypeMap","TypeMap","retrieveContent","container","contentId","ValueListHelper","showValueList","valueHelpQualifiers","keys","conditionPayloadList","params","qualifiers","vhParameters","vhKeys","propertyKeyPath","valueHelpKeyPath","filteredKeys","helpPaths","forEach","param","helpPath","includes","_onConditionPropagationToFilterBar","outParameters","filterBar","listReportFilterBar","state","StateUtil","retrieveExternalState","stateItems","items","filterBarProperties","FilterUtils","getFilterPropertyInfo","metaModel","outParameter","filterBarProperty","_findFilterBarPropertyByAnnotationPath","find","item","name","conditionPath","filtered","Condition","createCondition","conditionAlreadyExists","testCondition","applyExternalState","contextPath","filterTarget","source","pop","lastIndex","lastIndexOf","filterTargetPath","substring","annotationPath","getReducedPath","_onConditionPropagationToBindingContext","context","outValues","warning","_onConditionPropagationUpdateProperty","convertedMetadata","convertTypes","rootPath","getMetaContext","getPath","contextCanRequestSideEffects","isTransient","isInactive","outParameterSources","_updatePropertyViaOutParameter","view","collaborativeDraft","getController","isConnected","binding","getBinding","getBindingContext","attachEventOnce","send","action","Activity","Change","map","targetProperty","resolvePath","target","fieldControl","annotations","Common","FieldControl","dynamicReadOnly","isPathAnnotationExpression","getProperty","path","sideEffectPath","requestSideEffects","currentVal","newVal","setProperty","textPath","Text","getFilterConditions","config","getInitialFilterConditions","onConditionPropagation","reason","_config","isDefineConditionValueHelp","qualifier","getOutParameters","fieldParent","getParent","getConditions","isValueListWithFixedValues","propertyName","payloadKeys","payloadKey","conditionValuekeys","conditionValuekey","valueKey","keyValue","_createInitialFilterCondition","initialValueIsSignificant","_getInitialFilterConditionsFromBinding","inConditions","inParameters","bindingContext","getMetaPath","propertiesToRequest","inParameter","metaDataError","navigationPropertyPath","navigationProperty","replace","$Partner","$kind","_buildPropertiesToRequest","contextUnderCreation","getUpdateGroupId","startsWith","errorMessagesInContext","getMessages","getType","MessageType","created","requestProperty","i","metaModelContext","createBindingContext","relativePathParts","slice","part","partner","localDataPath","localDataParts","matchCount","findIndex","concat","join","_getInitialFilterConditionsFromFilterBar","sourceField","_getConditionsFromInParameter","_partitionInParameters","inParameterMap","constant","constantValue","indexOf","_tableAfterRenderDelegate","onAfterRendering","event","srcControl","tableCellsDomRefs","$","mdcMTable","highlightDOMElements","popoverTable","removeEventDelegate","addEventDelegate","getInParameters","isObjectPage","createConditionPayload","_values","entry","isMultiValueField","externalIdPath","vhKeyProperty","vhKeyValue","vhProperties","vhKey","modifySelectionBehaviour","change","oldConditions","isQuickSelectActive","findConditionsForContext","keyPath","getKeyPath","findCondition","conditionSelectedRow","useMultiValueField","contextKeys","selectedCondition","_updateBindingAttributes","recommendationValuesContextData","recentValuesContextData","othersValuesContextData","_getRelevantAdditionalValueContextData","hasRelevantData","resetChanges","debug","additionalValueHelper","createTransientContextsForAdditionalValueContextData","rootBinding","getRootBinding","suspend","sortAndFilterListBinding","changeParameters","resumeValueListBindingAndResetChanges","requestForAdditionalValueContextData","valueHelpKeys","getRelevantRecommendationValuesContextData","getRelevantRecentValuesContextData","replaceAll","getRelevantOthersValuesContextData","filters","FilterType","Application","sorter","resume","_checkIfAdditionalValuesExists","checkRecommendations","arguments","recommendationValues","recentValues","contentModel","localAnnotationModel","getLocalAnnotationModel","bindingContextPath","fieldPath","inputValues","typeAheadForFilterableContent","showIt","typeAheadContent","getContent","filterValue","fieldTextValue","getAdditionalValue","conditionForRequestShowContainer","parentControl","fieldId","getId","isVisualFilter","valueHelpTable","getParentDialog","innerContent","getDomRef","getElementsByTagName","id","getInitialFocus","checkHistoryEnabled","requestShowContainer","requestShowContainerReason","RequestShowContainerReason","Tab","Tap","Typing","Filter","ValueHelpRequest"],"sources":["./ValueHelpDelegate.ts"],"sourcesContent":["import type { ConvertedMetadata, Property } from \"@sap-ux/vocabularies-types\";\nimport Log from \"sap/base/Log\";\nimport ObjectPath from \"sap/base/util/ObjectPath\";\nimport CommonUtils from \"sap/fe/core/CommonUtils\";\nimport { Activity } from \"sap/fe/core/controllerextensions/collaboration/CollaborationCommon\";\nimport { convertTypes } from \"sap/fe/core/converters/MetaModelConverter\";\nimport type { PropertyInfo } from \"sap/fe/core/converters/controls/ListReport/FilterBar\";\nimport { isPathAnnotationExpression } from \"sap/fe/core/helpers/TypeGuards\";\nimport type { FieldDataType, ValueHelpHistoryService } from \"sap/fe/core/services/ValueHelpHistoryServiceFactory\";\nimport type { IFilterControl } from \"sap/fe/macros/filter/FilterUtils\";\nimport FilterUtils from \"sap/fe/macros/filter/FilterUtils\";\nimport type { InOutParameter, SorterType, ValueHelpPayload } from \"sap/fe/macros/internal/valuehelp/ValueListHelper\";\nimport ValueListHelper from \"sap/fe/macros/internal/valuehelp/ValueListHelper\";\nimport type Dialog from \"sap/m/Dialog\";\nimport type Table from \"sap/m/Table\";\nimport highlightDOMElements from \"sap/m/inputUtils/highlightDOMElements\";\nimport type { BaseAggregationBindingInfo } from \"sap/ui/base/ManagedObject\";\nimport type Control from \"sap/ui/core/Control\";\nimport type UI5Element from \"sap/ui/core/Element\";\nimport type Message from \"sap/ui/core/message/Message\";\nimport MessageType from \"sap/ui/core/message/MessageType\";\nimport type { default as Field } from \"sap/ui/mdc/Field\";\nimport type FilterBar from \"sap/ui/mdc/FilterBar\";\nimport type FilterField from \"sap/ui/mdc/FilterField\";\nimport type MultiValueField from \"sap/ui/mdc/MultiValueField\";\nimport type ValueHelp from \"sap/ui/mdc/ValueHelp\";\nimport ValueHelpDelegate from \"sap/ui/mdc/ValueHelpDelegate\";\nimport type { ConditionObject } from \"sap/ui/mdc/condition/Condition\";\nimport Condition from \"sap/ui/mdc/condition/Condition\";\nimport ConditionValidated from \"sap/ui/mdc/enums/ConditionValidated\";\nimport RequestShowContainerReason from \"sap/ui/mdc/enums/RequestShowContainerReason\";\nimport type FieldBase from \"sap/ui/mdc/field/FieldBase\";\nimport type FilterBarBase from \"sap/ui/mdc/filterbar/FilterBarBase\";\nimport TypeMap from \"sap/ui/mdc/odata/v4/TypeMap\";\nimport StateUtil from \"sap/ui/mdc/p13n/StateUtil\";\nimport type MDCPopover from \"sap/ui/mdc/valuehelp/Popover\";\nimport type Container from \"sap/ui/mdc/valuehelp/base/Container\";\nimport type Content from \"sap/ui/mdc/valuehelp/base/Content\";\nimport type FilterableListContent from \"sap/ui/mdc/valuehelp/base/FilterableListContent\";\nimport type ValueHelpDialog from \"sap/ui/mdc/valuehelp/base/ValueHelpDialog\";\nimport type MTable from \"sap/ui/mdc/valuehelp/content/MTable\";\nimport FilterType from \"sap/ui/model/FilterType\";\nimport type JSONModel from \"sap/ui/model/json/JSONModel\";\nimport type ODataV4Context from \"sap/ui/model/odata/v4/Context\";\nimport type ODataListBinding from \"sap/ui/model/odata/v4/ODataListBinding\";\nimport type ODataMetaModel from \"sap/ui/model/odata/v4/ODataMetaModel\";\nimport type ODataModel from \"sap/ui/model/odata/v4/ODataModel\";\nimport type { Value } from \"../field/FieldBaseDelegate\";\nimport type { AdditionalValueType, BindingInfoParameters } from \"../internal/valuehelp/AdditionalValueHelper\";\nimport { AdditionalValueGroupKey, additionalValueHelper } from \"../internal/valuehelp/AdditionalValueHelper\";\n\nconst FeCoreControlsFilterBar = \"sap.fe.macros.controls.FilterBar\";\nconst AnnotationIsDigitSequence = \"@com.sap.vocabularies.Common.v1.IsDigitSequence\";\n\nexport type ConditionObjectMap = Record<string, ConditionObject[]>;\n\nexport type ExternalStateType = {\n\titems: { name: string }[];\n\tfilter: ConditionObjectMap;\n};\n\ntype SelectionChange = {\n\tconditions: object[];\n\ttype: string;\n};\n\nexport type ConditionPayloadType = Record<string, string | boolean | null>;\n\nexport type ConditionPayloadMap = Record<string, ConditionPayloadType[]>;\n\ntype MDCConfigType = {\n\tvalue: unknown;\n\tparsedValue: unknown;\n\tcontext: object;\n\tcontrol: Control; // Instance of the calling control\n\tbindingContext: ODataV4Context;\n\tcheckKey: boolean;\n\tcheckDescription: boolean;\n};\n\nexport default Object.assign({}, ValueHelpDelegate, {\n\tapiVersion: 2,\n\tupdateBindingDonePromises: new WeakMap<object, Promise<void>>(),\n\n\t/**\n\t * Checks if a <code>ListBinding</code> supports $Search.\n\t * @param valueHelp The <code>ValueHelp</code> instance\n\t * @param content Content element\n\t * @param _listBinding\n\t * @returns True if $search is supported\n\t */\n\tisSearchSupported: function (valueHelp: ValueHelp, content: FilterableListContent, _listBinding: ODataListBinding) {\n\t\treturn !!content.data(\"searchSupported\");\n\t},\n\n\t/*\n\t * Adjustable filtering for list-based contents.\n\t *\n\t * @param valueHelp The <code>ValueHelp</code> instance\n\t * @param content ValueHelp content requesting conditions configuration\n\t * @param bindingInfo The binding info object to be used to bind the list to the model\n\t */\n\tupdateBindingInfo: function (valueHelp: ValueHelp, content: FilterableListContent, bindingInfo: BaseAggregationBindingInfo) {\n\t\tValueHelpDelegate.updateBindingInfo(valueHelp, content, bindingInfo);\n\n\t\tif (content.data(\"searchSupported\")) {\n\t\t\tconst search = content.getFilterValue();\n\t\t\tconst normalizedSearch = CommonUtils.normalizeSearchTerm(search); // adjustSearch\n\n\t\t\tif (bindingInfo.parameters) {\n\t\t\t\t(bindingInfo.parameters as Record<string, unknown>).$search = normalizedSearch || undefined;\n\t\t\t}\n\t\t}\n\t},\n\n\t/**\n\t * Get the value help history service from the app component.\n\t * @param control Control to find the app component\n\t * @returns ValueHelpHistoryService\n\t */\n\t_getValueHelpHistoryService(control: Control): ValueHelpHistoryService {\n\t\t// For some reason we cannot use CommonUtils.getAppComponent(control) here but need to get the View first.\n\t\tconst appComponent = CommonUtils.getAppComponent(CommonUtils.getTargetView(control));\n\t\treturn appComponent.getValueHelpHistoryService();\n\t},\n\n\t/**\n\t * Compares two condition objects for equality based on operator and values.\n\t * @param oldCondition First condition to compare\n\t * @param newCondition Second condition to compare\n\t * @returns True if conditions are equal, false otherwise\n\t */\n\tcheckConditionsEqual(oldCondition: ConditionObject, newCondition: ConditionObject): boolean {\n\t\t// Compare operators\n\t\tif (oldCondition.operator !== newCondition.operator) {\n\t\t\treturn false;\n\t\t}\n\n\t\t// Compare values arrays\n\t\tconst values1 = oldCondition.values ?? [];\n\t\tconst values2 = newCondition.values ?? [];\n\n\t\tif (values1.length !== values2.length) {\n\t\t\treturn false;\n\t\t}\n\n\t\t// Sort values for comparison to handle order differences\n\t\tconst sortedValues1 = [...values1].sort((firstValue, secondValue) => String(firstValue).localeCompare(String(secondValue)));\n\t\tconst sortedValues2 = [...values2].sort((firstValue, secondValue) => String(firstValue).localeCompare(String(secondValue)));\n\n\t\treturn sortedValues1.every((value, index) => value === sortedValues2[index]);\n\t},\n\n\t/**\n\t * Get the history data for the value list property from the history service.\n\t * No history data is fetched for fields annotated with IsPotentiallySensitive.\n\t * @param payload Payload for ValueHelp\n\t * @param control Control to find the app component, e.g. the field\n\t * @returns Promise which is resolved to a list of field data for the value list property\n\t */\n\t_getHistoryData: async function (payload: ValueHelpPayload, control: Control): Promise<FieldDataType[]> {\n\t\tif (payload.history?.enabled && payload.isPotentiallySensitive !== true) {\n\t\t\tconst valueListHistoryService = this._getValueHelpHistoryService(control);\n\t\t\ttry {\n\t\t\t\tconst fieldData = await valueListHistoryService.getFieldData(payload.propertyPath + \"/\" + payload.valueHelpQualifier);\n\t\t\t\tpayload.history.data = fieldData;\n\t\t\t\treturn fieldData;\n\t\t\t} catch (err) {\n\t\t\t\tLog.error(err instanceof Error ? err.message : String(err));\n\t\t\t}\n\t\t}\n\t\treturn [];\n\t},\n\n\t/**\n\t * Set the history data for the value list property in the history service.\n\t * No history data is stored for fields annotated with IsPotentiallySensitive.\n\t * @param payload Payload for ValueHelp\n\t * @param conditions The condition object to get the selected data from\n\t * @param control Control to find the app component, e.g. the field\n\t * @returns Promise which is resolved when the data is set in the history service\n\t */\n\t_setHistoryData: async function (payload: ValueHelpPayload, conditions: ConditionObject[], control: Control): Promise<void> {\n\t\tif (payload.history?.enabled && payload.isPotentiallySensitive !== true && conditions.length) {\n\t\t\tconst valueListProperty = this._getValueListPropertyFromPayloadQualifier(payload);\n\t\t\tif (valueListProperty) {\n\t\t\t\tconst data: FieldDataType[] = [];\n\n\t\t\t\tfor (const condition of conditions) {\n\t\t\t\t\tif (payload.isUnitValueHelp || condition.validated === ConditionValidated.Validated) {\n\t\t\t\t\t\tconst conditionPayloadMap = this._getConditionPayloadList(condition)?.[0];\n\t\t\t\t\t\tif (conditionPayloadMap) {\n\t\t\t\t\t\t\tdata.push(this.convertConditionPayloadToNestedObject(conditionPayloadMap));\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tif (data.length) {\n\t\t\t\t\tconst valueListHistoryService = this._getValueHelpHistoryService(control);\n\n\t\t\t\t\ttry {\n\t\t\t\t\t\tawait valueListHistoryService.setFieldData(payload.propertyPath + \"/\" + payload.valueHelpQualifier, data);\n\t\t\t\t\t} catch (err) {\n\t\t\t\t\t\tLog.error(err instanceof Error ? err.message : String(err));\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t},\n\n\t/**\n\t * Converting the condition payload to a nested object.\n\t * @param conditionPayload The condition payload object to be converted\n\t * @returns The converted nested object\n\t */\n\tconvertConditionPayloadToNestedObject: function (conditionPayload: ConditionPayloadType): ConditionPayloadType {\n\t\tconst nestedObject: ConditionPayloadType = {};\n\t\tfor (const key in conditionPayload) {\n\t\t\tObjectPath.set(key.split(\"/\"), conditionPayload[key], nestedObject);\n\t\t}\n\t\treturn nestedObject;\n\t},\n\n\t/**\n\t * Check if value is digit sequence with no value.\n\t * @param value The value to check\n\t * @param isDigitSequence Indicates if the value is expected to be a digit sequence\n\t * @returns True if the value is an empty digit sequence, false otherwise\n\t */\n\t_isEmptyDigitSequence: function (value: Value, isDigitSequence: boolean): boolean {\n\t\tlet isEmptyDigitSequence = false;\n\t\tif (isDigitSequence) {\n\t\t\tisEmptyDigitSequence =\n\t\t\t\ttypeof value === \"string\"\n\t\t\t\t\t? value.split(\"\").every((char) => char === \"0\") ?? value === \"\"\n\t\t\t\t\t: value === null || value === undefined || value === 0;\n\t\t}\n\t\treturn isEmptyDigitSequence;\n\t},\n\n\t/**\n\t * Checks if field is recommendation relevant and calls either _updateBinding or _updateBindingForRecommendations.\n\t * @param valueHelp The <code>ValueHelp</code> instance\n\t * @param listBinding List binding\n\t * @param bindingInfo The binding info object to be used to bind the list to the model\n\t * @param content Filterable List Content\n\t */\n\tupdateBinding: async function (\n\t\tvalueHelp: ValueHelp,\n\t\tlistBinding: ODataListBinding,\n\t\tbindingInfo: BaseAggregationBindingInfo,\n\t\tcontent: MTable\n\t): Promise<void> {\n\t\t// listBinding should be of type ODataListBinding\n\t\tif (!listBinding.isA(\"sap.ui.model.odata.v4.ODataListBinding\")) {\n\t\t\treturn;\n\t\t}\n\n\t\t//We fetch the valuelist property from the payload to make sure we pass the right property while making a call on valuelist entity set\n\t\tconst payload = valueHelp.getPayload() as ValueHelpPayload;\n\t\tif (content.isTypeahead()) {\n\t\t\tlet updateBindingDonePromiseResolve: (() => void) | undefined;\n\n\t\t\t// create a promise to make sure checkListBindingPending is only completed once this promise is resolved\n\t\t\tconst newPromise = new Promise<void>(function (resolve) {\n\t\t\t\tupdateBindingDonePromiseResolve = resolve;\n\t\t\t});\n\n\t\t\tconst existingUpdateBindingDonePromise = this.updateBindingDonePromises.get(listBinding);\n\t\t\t//build a promise chain if necessary\n\t\t\tthis.updateBindingDonePromises.set(\n\t\t\t\tlistBinding,\n\t\t\t\texistingUpdateBindingDonePromise ? existingUpdateBindingDonePromise.then(async () => newPromise) : newPromise\n\t\t\t);\n\n\t\t\tconst valueListProperty = this._getValueListPropertyFromPayloadQualifier(payload);\n\t\t\tconst field = content.getControl() as FilterField | MultiValueField | Field;\n\t\t\tconst isFilterFieldOrMultiValuedField =\n\t\t\t\tfield.isA<FilterField>(\"sap.ui.mdc.FilterField\") || field.isA<MultiValueField>(\"sap.ui.mdc.MultiValueField\");\n\t\t\tconst fieldValue = !isFilterFieldOrMultiValuedField && field.getValue();\n\t\t\tconst additionalValues: AdditionalValueType[] = [];\n\n\t\t\t// We need to show recommendations only when the field has empty value or when user is typing a value. Other times we should not show recommendations.\n\t\t\t// Check if the field has any pending user input and if it is then we show recommendations if any.\n\t\t\tconst isDigitSequence =\n\t\t\t\t(field.getModel() as ODataModel).getMetaModel().getObject(`${payload.propertyPath}${AnnotationIsDigitSequence}`) ?? false;\n\t\t\tif (!fieldValue || field.hasPendingUserInput() || this._isEmptyDigitSequence(fieldValue, isDigitSequence)) {\n\t\t\t\t//get the recommendation data from the internal model\n\t\t\t\tconst values = this.getRelevantRecommendations(content, payload);\n\n\t\t\t\t//if there are relevant recommendations then create additional value structure and call _updateBindingForRecommendations\n\t\t\t\tif (values.length) {\n\t\t\t\t\tadditionalValues.push({ propertyPath: valueListProperty, values, groupKey: AdditionalValueGroupKey.recommendation });\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tconst table = content.getTable();\n\t\t\tconst sortersCustomData = table.getCustomData().filter((data) => data.getKey() === \"sorters\");\n\t\t\tlet sorters: SorterType[] = [];\n\t\t\tif (sortersCustomData.length) sorters = sortersCustomData[0].getValue().sorters;\n\n\t\t\tawait this._updateBindingWithTransientContexts(\n\t\t\t\tpayload,\n\t\t\t\tlistBinding,\n\t\t\t\tbindingInfo,\n\t\t\t\tadditionalValues,\n\t\t\t\tvalueListProperty,\n\t\t\t\tfield,\n\t\t\t\tsorters,\n\t\t\t\ttable\n\t\t\t);\n\t\t\tif (updateBindingDonePromiseResolve) {\n\t\t\t\t//resolve the promise as everything is completed\n\t\t\t\tupdateBindingDonePromiseResolve();\n\t\t\t}\n\t\t} else {\n\t\t\t//call _updateBinding if there are no relevant recommendations\n\t\t\tthis._updateBinding(listBinding, bindingInfo);\n\t\t}\n\t},\n\t/**\n\t * Executes a filter in a <code>ListBinding</code>.\n\t * @param valueHelp The <code>ValueHelp</code> instance\n\t * @param listBinding List binding\n\t * @param requestedItems Number of requested items\n\t * @returns Promise that is resolved if search is executed\n\t */\n\texecuteFilter: async function (valueHelp: ValueHelp, listBinding: ODataListBinding, requestedItems: number) {\n\t\tlistBinding.getContexts(0, requestedItems);\n\n\t\tawait this.checkListBindingPending(valueHelp, listBinding, requestedItems);\n\t\treturn listBinding;\n\t},\n\n\t/**\n\t * Checks if the <code>ListBinding</code> is waiting for an update.\n\t * As long as the context has not been set for <code>ListBinding</code>,\n\t * <code>ValueHelp</code> needs to wait.\n\t * @param _valueHelp The <code>ValueHelp</code> instance\n\t * @param listBinding ListBinding to check\n\t * @param requestedItems Number of requested items\n\t * @returns Promise that is resolved once ListBinding has been updated\n\t */\n\tcheckListBindingPending: async function (_valueHelp: ValueHelp, listBinding: ODataListBinding | undefined, requestedItems: number) {\n\t\tlet isPending = false;\n\t\tif (listBinding && this.updateBindingDonePromises.has(listBinding)) {\n\t\t\tawait this.updateBindingDonePromises.get(listBinding);\n\t\t}\n\t\tif (listBinding && !listBinding.isSuspended()) {\n\t\t\ttry {\n\t\t\t\tconst contexts = await listBinding.requestContexts(0, requestedItems);\n\t\t\t\tisPending = contexts.length === 0;\n\t\t\t} catch (error: unknown) {\n\t\t\t\tif (error && (error as { canceled?: boolean })?.canceled) {\n\t\t\t\t\treturn isPending;\n\t\t\t\t}\n\t\t\t\tthrow error;\n\t\t\t}\n\t\t}\n\t\treturn isPending;\n\t},\n\n\tgetTypeMap: function (_valueHelp: ValueHelp) {\n\t\treturn TypeMap;\n\t},\n\n\t/**\n\t * Requests the content of the value help.\n\t *\n\t * This function is called when the value help is opened or a key or description is requested.\n\t *\n\t * So, depending on the value help content used, all content controls and data need to be assigned.\n\t * Once they are assigned and the data is set, the returned <code>Promise</code> needs to be resolved.\n\t * Only then does the value help continue opening or reading data.\n\t * @param valueHelp The <code>ValueHelp</code> instance\n\t * @param container Container instance\n\t * @param contentId Id of the content shown after this call to retrieveContent\n\t * @returns Promise that is resolved if all content is available\n\t */\n\tretrieveContent: async function (valueHelp: ValueHelp, container: Container, contentId: string) {\n\t\tconst payload = valueHelp.getPayload() as ValueHelpPayload;\n\t\treturn ValueListHelper.showValueList(payload, container, contentId);\n\t},\n\n\t_getConditionPayloadList: function (condition: ConditionObject) {\n\t\tconst conditionPayloadMap = (condition.payload || {}) as ConditionPayloadMap,\n\t\t\tvalueHelpQualifiers = Object.keys(conditionPayloadMap),\n\t\t\tconditionPayloadList = valueHelpQualifiers.length ? conditionPayloadMap[valueHelpQualifiers[0]] : [];\n\n\t\treturn conditionPayloadList;\n\t},\n\t/**\n\t * Returns ValueListProperty from Payload based on data from payload keys and parameters.\n\t * @param payload Payload for delegate\n\t * @returns ValueListProperty\n\t */\n\t_getValueListPropertyFromPayloadQualifier: function (payload: ValueHelpPayload) {\n\t\tconst params = payload.qualifiers[payload.valueHelpQualifier]?.vhParameters || [];\n\t\tconst keys = payload.qualifiers[payload.valueHelpQualifier]?.vhKeys || [];\n\t\tconst propertyKeyPath = payload.valueHelpKeyPath;\n\t\tlet filteredKeys: string[] = [...keys];\n\t\tconst helpPaths: string[] = [];\n\t\tif (params.length > 0) {\n\t\t\t//create helpPaths array which will only consist of params helppath\n\t\t\tparams.forEach(function (param: InOutParameter) {\n\t\t\t\thelpPaths.push(param.helpPath);\n\t\t\t});\n\t\t\t//filter the keys based on helpPaths. If key is not present in helpPath then it is valuelistproperty\n\t\t\tfilteredKeys = keys.filter((key: string) => {\n\t\t\t\treturn !helpPaths.includes(key);\n\t\t\t});\n\t\t}\n\n\t\t// from filteredKeys return the key that matches the property name\n\t\treturn propertyKeyPath && filteredKeys.includes(propertyKeyPath) ? propertyKeyPath : \"\";\n\t},\n\n\t_onConditionPropagationToFilterBar: async function (\n\t\tconditions: ConditionObject[],\n\t\toutParameters: InOutParameter[],\n\t\tfilterBar: FilterBar,\n\t\tpayload: ValueHelpPayload,\n\t\tlistReportFilterBar: FilterBar\n\t) {\n\t\ttry {\n\t\t\tconst state: ExternalStateType = await StateUtil.retrieveExternalState(listReportFilterBar);\n\t\t\tconst stateItems = state.items; // Visible FilterItems in the LR-FilterBar\n\t\t\tconst filterBarProperties = FilterUtils.getFilterPropertyInfo(filterBar as unknown as IFilterControl);\n\t\t\tconst metaModel = filterBar.getModel()?.getMetaModel() as ODataMetaModel;\n\t\t\t// Propagate OUT parameter only if the filter field is visible in the LR filterbar\n\t\t\t// LR FilterBar or LR AdaptFilter\n\t\t\tfor (const outParameter of outParameters) {\n\t\t\t\tconst filterBarProperty = this._findFilterBarPropertyByAnnotationPath(\n\t\t\t\t\toutParameter,\n\t\t\t\t\tpayload.propertyPath,\n\t\t\t\t\tmetaModel,\n\t\t\t\t\tfilterBarProperties\n\t\t\t\t);\n\t\t\t\tif (filterBarProperty && stateItems?.find((item) => item.name === filterBarProperty.name)) {\n\t\t\t\t\t/* Reset the conditions before create new conditions otherwise it gets not updated */\n\t\t\t\t\tconst conditionPath = filterBarProperty.conditionPath as string;\n\t\t\t\t\tstate.filter[conditionPath]?.forEach((condition) => {\n\t\t\t\t\t\tcondition.filtered = false;\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t}\n\t\t\t// Propagate OUT parameter for each conditions\n\t\t\tfor (const condition of conditions) {\n\t\t\t\tconst conditionPayloadList = this._getConditionPayloadList(condition);\n\t\t\t\tfor (const outParameter of outParameters) {\n\t\t\t\t\tconst filterBarProperty = this._findFilterBarPropertyByAnnotationPath(\n\t\t\t\t\t\toutParameter,\n\t\t\t\t\t\tpayload.propertyPath,\n\t\t\t\t\t\tmetaModel,\n\t\t\t\t\t\tfilterBarProperties\n\t\t\t\t\t);\n\t\t\t\t\t// Propagate OUT parameter only if the filter field is visible in the LR filterbar\n\t\t\t\t\t// LR FilterBar or LR AdaptFilter\n\t\t\t\t\tif (filterBarProperty && stateItems?.find((item) => item.name === filterBarProperty.name)) {\n\t\t\t\t\t\tfor (const conditionPayload of conditionPayloadList) {\n\t\t\t\t\t\t\tconst newCondition = Condition.createCondition(\n\t\t\t\t\t\t\t\t\"EQ\",\n\t\t\t\t\t\t\t\t[conditionPayload[outParameter.helpPath]],\n\t\t\t\t\t\t\t\tnull,\n\t\t\t\t\t\t\t\tnull,\n\t\t\t\t\t\t\t\tConditionValidated.Validated\n\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\tconst conditionPath = filterBarProperty.conditionPath as string;\n\t\t\t\t\t\t\tconst conditionAlreadyExists = state.filter[conditionPath]?.find((testCondition) => {\n\t\t\t\t\t\t\t\tdelete testCondition.filtered;\n\t\t\t\t\t\t\t\tif (this.checkConditionsEqual(testCondition, newCondition)) {\n\t\t\t\t\t\t\t\t\treturn true;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t// reset filtered to false\n\t\t\t\t\t\t\t\ttestCondition.filtered = false;\n\t\t\t\t\t\t\t\treturn false;\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\tif (!conditionAlreadyExists) {\n\t\t\t\t\t\t\t\tstate.filter[conditionPath] ||= [];\n\t\t\t\t\t\t\t\tstate.filter[conditionPath].push(newCondition);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\t// Apply to the parent of the FilterField\n\t\t\tStateUtil.applyExternalState(filterBar, state);\n\t\t} catch (err) {\n\t\t\tconst message = err instanceof Error ? err.message : String(err);\n\t\t\tLog.error(`ValueHelpDelegate: ${message}`);\n\t\t}\n\t},\n\n\t_findFilterBarPropertyByAnnotationPath: function (\n\t\toutParameter: InOutParameter,\n\t\tpropertyPath: string,\n\t\tmetaModel: ODataMetaModel,\n\t\tfilterBarProperties: PropertyInfo[]\n\t) {\n\t\tconst contextPath = `/${propertyPath.split(\"/\")[1]}`;\n\t\tconst filterTarget = outParameter.source.split(\"conditions/\").pop() || \"\";\n\t\tconst lastIndex = propertyPath.lastIndexOf(\"/\");\n\t\tconst filterTargetPath = lastIndex > 0 ? `${propertyPath.substring(0, lastIndex)}/${filterTarget}` : filterTarget;\n\t\tconst annotationPath = metaModel?.getReducedPath(filterTargetPath, contextPath);\n\t\treturn filterBarProperties.find((item) => item.annotationPath === annotationPath);\n\t},\n\n\t_onConditionPropagationToBindingContext: function (\n\t\tconditions: ConditionObject[],\n\t\toutParameters: InOutParameter[],\n\t\tcontext: ODataV4Context,\n\t\tvalueHelp: ValueHelp\n\t) {\n\t\tconst metaModel = context.getModel().getMetaModel();\n\n\t\tfor (const condition of conditions) {\n\t\t\tconst conditionPayloadList = this._getConditionPayloadList(condition),\n\t\t\t\toutValues = conditionPayloadList.length === 1 ? conditionPayloadList[0] : undefined;\n\n\t\t\tif (conditionPayloadList.length > 1) {\n\t\t\t\tLog.warning(\"ValueHelpDelegate: ParameterOut in multi-value-field not supported\");\n\t\t\t}\n\t\t\tif (outValues) {\n\t\t\t\tthis._onConditionPropagationUpdateProperty(metaModel, outValues, outParameters, context, valueHelp);\n\t\t\t}\n\t\t}\n\t},\n\n\t_onConditionPropagationUpdateProperty: function (\n\t\tmetaModel: ODataMetaModel,\n\t\toutValues: ConditionPayloadType,\n\t\toutParameters: InOutParameter[],\n\t\tcontext: ODataV4Context,\n\t\tvalueHelp: ValueHelp\n\t) {\n\t\tconst convertedMetadata = convertTypes(metaModel);\n\t\tconst rootPath = metaModel.getMetaContext(context.getPath()).getPath();\n\t\tconst contextCanRequestSideEffects = context.isTransient() !== true && !context.isInactive();\n\t\tconst outParameterSources: string[] = [];\n\t\tfor (const outParameter of outParameters) {\n\t\t\t/* Updated property via out-parameter if value changed */\n\t\t\tthis._updatePropertyViaOutParameter(\n\t\t\t\tconvertedMetadata,\n\t\t\t\trootPath,\n\t\t\t\toutValues,\n\t\t\t\toutParameter,\n\t\t\t\tcontext,\n\t\t\t\tcontextCanRequestSideEffects\n\t\t\t);\n\t\t\toutParameterSources.push(outParameter.source);\n\t\t}\n\t\tconst view = CommonUtils.getTargetView(valueHelp);\n\t\tconst collaborativeDraft = view.getController().collaborativeDraft;\n\t\tif (collaborativeDraft.isConnected() && outParameterSources.length > 0) {\n\t\t\t// we determine the binding that sends the request\n\t\t\tlet binding;\n\t\t\tif (context.getBinding().isA(\"sap.ui.model.odata.v4.ODataListBinding\")) {\n\t\t\t\tbinding = context.getBinding();\n\t\t\t} else {\n\t\t\t\tbinding = view.getBindingContext().getBinding();\n\t\t\t}\n\t\t\t/* The out values have been changed --> wait until the request is sent to the server before sending a notification to the other collaborators\n\t\t\t\t\t\t\t We attach the event on the right binding */\n\t\t\tbinding.attachEventOnce(\"patchCompleted\", () => {\n\t\t\t\tcollaborativeDraft.send({\n\t\t\t\t\taction: Activity.Change,\n\t\t\t\t\tcontent: outParameterSources.map((source) => context.getPath() + \"/\" + source)\n\t\t\t\t});\n\t\t\t});\n\t\t}\n\t},\n\n\t_updatePropertyViaOutParameter: function (\n\t\tconvertedMetadata: ConvertedMetadata,\n\t\trootPath: string,\n\t\toutValues: ConditionPayloadType,\n\t\toutParameter: InOutParameter,\n\t\tcontext: ODataV4Context,\n\t\tcontextCanRequestSideEffects: boolean\n\t) {\n\t\t/* Updated property via out-parameter if value changed */\n\t\tconst propertyPath = `${rootPath}/${outParameter.source}`;\n\t\tconst targetProperty = convertedMetadata.resolvePath<Property>(propertyPath).target;\n\t\tconst fieldControl = targetProperty?.annotations?.Common?.FieldControl;\n\t\tconst dynamicReadOnly = isPathAnnotationExpression(fieldControl) ? context.getProperty(fieldControl.path) === 1 : false;\n\t\tif (dynamicReadOnly && contextCanRequestSideEffects) {\n\t\t\t/* Non-Transient and active context */\n\t\t\tconst lastIndex = outParameter.source.lastIndexOf(\"/\");\n\t\t\tconst sideEffectPath = lastIndex > 0 ? outParameter.source.substring(0, lastIndex) : outParameter.source;\n\t\t\t/* We send [<propertyName>] in case of a property path without any navigation involved */\n\t\t\t/* In case of a path involving navigations, we send [<navigationPath>] ending with a navigation property and not with a property */\n\t\t\tcontext.requestSideEffects([sideEffectPath]);\n\t\t} else {\n\t\t\t/* The fast creation row (transient context) can´t have instant specific (dynamic) read-only fields, therefore we don´t need to handle/consider this case specifically */\n\t\t\t/* Additional infos: */\n\t\t\t/* The fast creation row is only used by SD */\n\t\t\t/* The group ID (third argument of setProperty described api documentation of the Context) is used for the PATCH request, if not specified, the update group ID for the context's binding is used, 'null' to prevent the PATCH request */\n\t\t\t/* The Transient context cannot request SideEffects and  cannot patch via group 'null' */\n\t\t\tconst currentVal = context.getProperty(outParameter.source);\n\t\t\tconst newVal = outValues[outParameter.helpPath];\n\t\t\tif (currentVal !== newVal) {\n\t\t\t\tcontext.setProperty(outParameter.source, null);\n\t\t\t\tcontext.setProperty(outParameter.source, outValues[outParameter.helpPath]);\n\t\t\t}\n\t\t}\n\t\t/* If the key gets updated via out-parameter, then the description needs also retrieved with requestSideEffects */\n\t\tconst textPath = isPathAnnotationExpression(targetProperty?.annotations?.Common?.Text)\n\t\t\t? targetProperty?.annotations?.Common?.Text.path\n\t\t\t: undefined;\n\t\tif (textPath !== undefined && contextCanRequestSideEffects) {\n\t\t\tconst lastIndex = textPath.lastIndexOf(\"/\");\n\t\t\tconst sideEffectPath = lastIndex > 0 ? textPath.substring(0, lastIndex) : textPath;\n\t\t\t/* The sideEffectPath can be [<propertyName>] or [<navigationPath>] */\n\t\t\tcontext.requestSideEffects([sideEffectPath]);\n\t\t}\n\t},\n\n\t/**\n\t * Provides a map of conditions for the following situations:\n\t * Initial set of conditions applied every time value help content is shown for the first time since opening its container.\n\t * Detailed set of conditions in getItemForValue scenarios that allow you to find a specific value help item (indicated by config availability).\n\t * @param valueHelp The ValueHelp control instance\n\t * @param content ValueHelp content instance\n\t * @param config Configuration object\n\t * @returns Returns a promise resolving to a map of conditions\n\t */\n\tgetFilterConditions: function (valueHelp: ValueHelp, content: Content, config?: MDCConfigType) {\n\t\tif (this.getInitialFilterConditions) {\n\t\t\treturn this.getInitialFilterConditions(valueHelp, content, (config && config.control) || (content && content.getControl()));\n\t\t}\n\t\treturn {};\n\t},\n\n\t/**\n\t * Callback invoked every time a {@link sap.ui.mdc.ValueHelp ValueHelp} fires a select event or the value of the corresponding field changes\n\t * This callback may be used to update external fields.\n\t * @param valueHelp ValueHelp control instance receiving the <code>controlChange</code>\n\t * @param reason Reason why the method was invoked\n\t * @param _config Current configuration provided by the calling control\n\t * @since 1.101.0\n\t */\n\tonConditionPropagation: async function (valueHelp: ValueHelp, reason: string, _config: unknown) {\n\t\tconst payload = valueHelp.getPayload() as ValueHelpPayload;\n\t\tif (reason !== \"ControlChange\" || payload.isDefineConditionValueHelp) {\n\t\t\t// handle only ControlChange reason\n\t\t\t// also don't handle for define condition value help as propagating conditions on the value help\n\t\t\t// to define conditions does not make sense but would only confuse users by allowing recursive use\n\t\t\t// of the condition value help\n\t\t\treturn;\n\t\t}\n\t\tconst qualifier = payload.qualifiers[payload.valueHelpQualifier];\n\t\tconst outParameters = qualifier?.vhParameters !== undefined ? ValueListHelper.getOutParameters(qualifier.vhParameters) : [],\n\t\t\tfield = valueHelp.getControl() as FieldBase,\n\t\t\tfieldParent = field.getParent() as FilterBarBase | Control;\n\n\t\tlet conditions = field.getConditions() as ConditionObject[];\n\t\tif (!payload.isValueListWithFixedValues) {\n\t\t\tthis._setHistoryData(payload, conditions, field);\n\t\t}\n\t\tconditions = conditions.filter(function (condition) {\n\t\t\tconst conditionPayloadMap = (condition.payload || {}) as ConditionPayloadMap;\n\t\t\treturn conditionPayloadMap[payload.valueHelpQualifier];\n\t\t});\n\n\t\tconst listReportFilterBar = field.getParent() as FilterBarBase | Control; // Control e.g. FormContainer\n\t\tif (listReportFilterBar.isA(FeCoreControlsFilterBar) && outParameters.length && conditions.length) {\n\t\t\t// Propagate the value only if the FilterField is part of the LR-FilterBar also inside in Adapt Filters dialog\n\t\t\tawait this._onConditionPropagationToFilterBar(\n\t\t\t\tconditions,\n\t\t\t\toutParameters,\n\t\t\t\tfieldParent as FilterBar,\n\t\t\t\tpayload,\n\t\t\t\tlistReportFilterBar as FilterBar\n\t\t\t);\n\t\t\t// LR Settings Dialog or OP Settings Dialog shall not propagate value to the dialog filterfields or context\n\t\t} else {\n\t\t\t// Object Page\n\t\t\t/* To avoid timing issue we use the BindingContext of the control instead of the ValueHelp (BCP 2380057227) */\n\t\t\tconst context = field.getBindingContext() as ODataV4Context | undefined;\n\t\t\tif (context) {\n\t\t\t\tconst metaModel = (field.getModel() as ODataMetaModel).getMetaModel();\n\t\t\t\tconst propertyName = metaModel?.getObject(`${payload.propertyPath}@sapui.name`);\n\t\t\t\tconst condition = conditions.length > 0 ? conditions[0] : ({} as ConditionObject);\n\t\t\t\tconst payloadKeys = condition?.payload ? Object.keys(condition.payload) : [];\n\t\t\t\tpayloadKeys.forEach((payloadKey) => {\n\t\t\t\t\tconst conditionPayloadMap = condition.payload as ConditionPayloadMap | undefined;\n\t\t\t\t\tconst conditionPayload = conditionPayloadMap?.[payloadKey]?.[0] || {};\n\t\t\t\t\tconst conditionValuekeys = Object.keys(conditionPayload);\n\t\t\t\t\tconst conditionValuekey = conditionValuekeys.find((valueKey) => valueKey.includes(\"@$ui5.fe.@Common/ExternalID\"));\n\t\t\t\t\tif (conditionValuekey) {\n\t\t\t\t\t\tconst keyValue = conditionPayload[conditionValuekey];\n\t\t\t\t\t\tcontext.setProperty(propertyName, keyValue);\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t\tthis._onConditionPropagationToBindingContext(conditions, outParameters, context, valueHelp);\n\t\t\t}\n\t\t}\n\t},\n\n\t/**\n\t * Creates an initial filter condition based on the provided value and flag indicating if the initial value is significant.\n\t * @param value The value for the filter condition.\n\t * @param initialValueIsSignificant Flag indicating if the initial value is significant.\n\t * @returns The filter condition.\n\t */\n\t_createInitialFilterCondition: function (value: Value, initialValueIsSignificant: boolean) {\n\t\tlet condition: ConditionObject | undefined;\n\n\t\tif (value === undefined) {\n\t\t\tLog.error(\"ValueHelpDelegate: value of the property could not be requested\");\n\t\t} else if ((value === \"\" || value === null) && initialValueIsSignificant) {\n\t\t\tcondition = Condition.createCondition(\"Empty\", [], null, null, ConditionValidated.Validated);\n\t\t} else if (value !== undefined && value !== \"\" && value !== null) {\n\t\t\tcondition = Condition.createCondition(\"EQ\", [value], null, null, ConditionValidated.Validated);\n\t\t}\n\t\treturn condition;\n\t},\n\n\t_getInitialFilterConditionsFromBinding: async function (\n\t\tinConditions: ConditionObjectMap,\n\t\tcontrol: Control,\n\t\tinParameters: InOutParameter[],\n\t\tpayload: ValueHelpPayload\n\t) {\n\t\tconst bindingContext = control.getBindingContext() as ODataV4Context | undefined;\n\t\tif (!bindingContext) {\n\t\t\tLog.error(\"ValueHelpDelegate: No BindingContext\");\n\t\t\treturn inConditions;\n\t\t}\n\t\tconst metaModel = control.getModel()?.getMetaModel() as ODataMetaModel;\n\t\tconst rootPath = metaModel.getMetaPath(bindingContext.getPath());\n\t\tlet propertiesToRequest = inParameters.map((inParameter) => inParameter.source);\n\t\t/* In case of action parameter dialog, which can be identified by the path \"$Parameter\", the binding context is always relative to the in-parameters. */\n\t\t/* We need to request the in-parameter values relative to the binding context.\nIn some cases (e.g. multi value field), the binding context does not point to the\nVH annotation target, thus we identify the needed navigation relation by\nreducing the payload.propertyPath by the path derived from binding context.\nThis cannot happen in case of action parameter dialog, which can be identified by the path \"$Parameter\".\n*/\n\n\t\t// Check whether the filter property with navigation path exists, otherwise the metadata are not well defined\n\t\tlet metaDataError = false;\n\t\tconst propertyName = payload.propertyPath.split(\"/\").pop();\n\t\tlet navigationPropertyPath;\n\t\tlet navigationProperty;\n\n\t\t//For a VH on an action dialog parameter the following code would fill navigationPropertyPath\n\t\t//with the action even though no navigation property exists -> leave navigationPropertyPath empty\n\t\tif (bindingContext.getBinding().getPath() !== \"$Parameter\") {\n\t\t\tnavigationPropertyPath = payload.propertyPath.replace(`/${propertyName}`, \"\");\n\t\t\tnavigationProperty = metaModel.getObject(navigationPropertyPath);\n\t\t}\n\n\t\tif (control.isA(\"sap.ui.mdc.MultiValueField\") && navigationProperty && navigationProperty.$Partner === undefined) {\n\t\t\t//Case mdc.MultiValueField: the $Partner (association to one) is a precondition to request the filter value\n\t\t\t//Exception: When the MultiValueField is an action parameter then the context of the action is used to fill the in parameter and\n\t\t\t//no $Partner association is needed. For such cases navigationPropertyPath is no filled\n\t\t\tLog.error(\n\t\t\t\t`ValueHelpDelegate: Because of missing partner definition, the filter value for ValueListParameterIn property can not requested.`\n\t\t\t);\n\t\t\tmetaDataError = true;\n\t\t} else if (navigationProperty && navigationProperty.$kind === \"NavigationProperty\" && navigationProperty.$Partner !== undefined) {\n\t\t\tpropertiesToRequest = this._buildPropertiesToRequest(propertiesToRequest, rootPath, metaModel, payload.propertyPath);\n\t\t}\n\t\tif (!metaDataError) {\n\t\t\t// UpdateGroupId is $auto is used in case of creation row.\n\t\t\t// UpdateGroupId is submitLater in case of create dialog.\n\t\t\t// We need to consider the case of isInactive context, which is not yet created.\n\t\t\tconst contextUnderCreation =\n\t\t\t\tbindingContext.isTransient() === true &&\n\t\t\t\t!bindingContext.isInactive() &&\n\t\t\t\tbindingContext.getUpdateGroupId()?.startsWith(\"$auto\");\n\t\t\tlet errorMessagesInContext = [];\n\t\t\terrorMessagesInContext = (bindingContext.getMessages() ?? []).filter((message: Message) => {\n\t\t\t\treturn message.getType() === MessageType.Error;\n\t\t\t});\n\t\t\t// We await creation if it is still in process.\n\t\t\tif (contextUnderCreation && !errorMessagesInContext?.length) {\n\t\t\t\tawait bindingContext?.created();\n\t\t\t}\n\t\t\t// According to odata v4 api documentation for requestProperty: Property values that are not cached yet are requested from the back end\n\t\t\tconst values = await bindingContext.requestProperty(propertiesToRequest);\n\n\t\t\tfor (let i = 0; i < inParameters.length; i++) {\n\t\t\t\tconst inParameter = inParameters[i];\n\t\t\t\tconst condition = this._createInitialFilterCondition(values[i], inParameter.initialValueIsSignificant);\n\n\t\t\t\tif (condition) {\n\t\t\t\t\tinConditions[inParameter.helpPath] = [condition];\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\treturn inConditions;\n\t},\n\n\t_buildPropertiesToRequest: function (propertiesToRequest: string[], rootPath: string, metaModel: ODataMetaModel, propertyPath: string) {\n\t\t/*\n\t\t\t\tThe inParameters are defined according to the value help definition, i.e. their source is a path relative to the annotation target (or more precisely the EntitySet the annotation target belongs to). The annotation target is the property the value help is defined for.\n\t\t\t\tTo request the values for the inParameters from the bindingContext (the control is bound to), we need to translate this to a path relative to the bindingContext. This differs, if the field is not defined for a direct property, but with a path containing one or more navigation properties (esp. necessary to define multi value fields).\n\t\t\t\tTo make this translation possible, the payload provides the propertyPath, which is an absolute metaPath to the property (i.e. including the corresponding metaPath for the binding context and the additional path the property is bound to).\n\n\t\t\t\tSo far, this means we have to remove the corresponding metaPath of the bindingContext from the left side, and the last segment (the property itself) from the the right side of the propertyPath provided in the payload, to get a metaPath from the binding context to the annotation target.\n\t\t\t\tIf this metaPath contains 1:n-navigations (which cannot be translated back to a path, as this would mean to add corresponding keys, which are not known), the source path in the inParameter definition of the value needs to point back using the corresponding partner navigation(s) to avoid ambiguous definition of how to get its value.\n\t\t\t\tThus, we can and need to match and reduce the parts of this relative metaPath from the right side against the corresponding parts of the inParameters source definition from the left side by checking whether they are corresponding partner navigations. When we are done (no more parts in reduced relative metaPath, no more parts in reduced inParameter source path, or most right part in reduced relative metaPath is not the partner of most left part in reduced inParameter source), neither reduced relative metaPath nor reduced inParameter source path may contain any 1:n-navigation properties.\n\t\t\t\tIf this condition is fulfilled, we can combine the and request from the given binding context. If not, the value help definition does not allow to retrieve the inParameters value in an unambiguous way, i.t. the value help is not defined correctly.\n\t\t\t\t*/\n\t\t// common for all inParameters\n\t\tlet metaModelContext = metaModel.createBindingContext(rootPath) as ODataV4Context;\n\t\tconst relativePathParts = propertyPath\n\t\t\t.slice(rootPath.length) // remove root path\n\t\t\t.split(\"/\") // transform to array\n\t\t\t.slice(1, -1) // remove first (empty, as rootPath provided without ending \"/\"), and last (property the VH is attached to) part\n\t\t\t.map((part) => {\n\t\t\t\t// determine navigation property name and corresponding partner for each navigation step\n\t\t\t\tmetaModelContext = metaModel.createBindingContext(part, metaModelContext) as ODataV4Context;\n\t\t\t\treturn {\n\t\t\t\t\tpart: part,\n\t\t\t\t\tpartner: metaModelContext.getObject().$Partner\n\t\t\t\t};\n\t\t\t});\n\t\t// actual reduction per inParameter\n\t\treturn propertiesToRequest.map((localDataPath) => {\n\t\t\tconst localDataParts = localDataPath.split(\"/\");\n\t\t\tconst matchCount = localDataParts.findIndex(\n\t\t\t\t(\n\t\t\t\t\tpart,\n\t\t\t\t\tindex // find first non-matching index\n\t\t\t\t) => relativePathParts[-index]?.partner !== part\n\t\t\t); // relativePathParts to match from the end (=> \"-index\") to localDataParts from the beginning\n\t\t\t// last part of localData is a property name, thus it cannot match. Otherwise matchCount could be -1 if everything matches\n\t\t\t// (if we want to additionally secure against this situation, the most appropriate would be to set matchCount = localDataParts.length – 1)\n\t\t\treturn relativePathParts\n\t\t\t\t.slice(0, -matchCount) // remove all matched parts (from the end)\n\t\t\t\t.map((part) => part.part)\n\t\t\t\t.concat(localDataParts.slice(matchCount)) // remove the matched parts from localData (from the beginning)\n\t\t\t\t.join(\"/\"); // transfer back to string (but only once at the end ;) )\n\t\t});\n\t},\n\n\t_getInitialFilterConditionsFromFilterBar: async function (\n\t\tinConditions: ConditionObjectMap,\n\t\tcontrol: Control,\n\t\tinParameters: InOutParameter[],\n\t\tpayload: ValueHelpPayload\n\t) {\n\t\tconst filterBar = control.getParent() as FilterBarBase;\n\t\tconst filterBarProperties = FilterUtils.getFilterPropertyInfo(filterBar as unknown as IFilterControl);\n\t\tconst state: ExternalStateType = await StateUtil.retrieveExternalState(filterBar);\n\t\tconst metaModel = (filterBar.getModel() as ODataModel).getMetaModel();\n\t\tfor (const inParameter of inParameters) {\n\t\t\tconst filterBarProperty = this._findFilterBarPropertyByAnnotationPath(\n\t\t\t\tinParameter,\n\t\t\t\tpayload.propertyPath,\n\t\t\t\tmetaModel,\n\t\t\t\tfilterBarProperties\n\t\t\t);\n\t\t\tconst sourceField = filterBarProperty ? filterBarProperty.conditionPath : inParameter.source.split(\"conditions/\").pop();\n\n\t\t\tconst conditions = this._getConditionsFromInParameter(sourceField as string, state);\n\t\t\tif (conditions) {\n\t\t\t\tinConditions[inParameter.helpPath] = conditions;\n\t\t\t}\n\t\t}\n\t\treturn inConditions;\n\t},\n\n\t/**\n\t * Returns the filter conditions.\n\t * Regarding a navigation path in the InOut parameters and disregarding prefixes in the navigation path like e.g. '$filters>/conditions/' or 'owner'.\n\t * @param sourceField InParameter property of the filter field value help\n\t * @param state The external filter state\n\t * @returns The filter conditions\n\t * @since 1.114.0\n\t */\n\t_getConditionsFromInParameter: function (sourceField: string, state: ExternalStateType) {\n\t\tconst key = Object.keys(state.filter).find((key) => key === sourceField); // condition path of the filter field\n\t\treturn key && state.filter[key];\n\t},\n\n\t_partitionInParameters: function (inParameters: InOutParameter[]) {\n\t\tconst inParameterMap: Record<string, InOutParameter[]> = {\n\t\t\tconstant: [],\n\t\t\tbinding: [],\n\t\t\tfilter: []\n\t\t};\n\n\t\tfor (const inParameter of inParameters) {\n\t\t\tif (inParameter.constantValue !== undefined) {\n\t\t\t\tinParameterMap.constant.push(inParameter);\n\t\t\t} else if (inParameter.source.indexOf(\"$filter\") === 0) {\n\t\t\t\tinParameterMap.filter.push(inParameter);\n\t\t\t} else {\n\t\t\t\tinParameterMap.binding.push(inParameter);\n\t\t\t}\n\t\t}\n\t\treturn inParameterMap;\n\t},\n\n\t_tableAfterRenderDelegate: {\n\t\tonAfterRendering: function (event: jQuery.Event & { srcControl: Control }) {\n\t\t\tconst table = event.srcControl, // m.Table\n\t\t\t\ttableCellsDomRefs = table.$().find(\"tbody .sapMText\"),\n\t\t\t\tmdcMTable = table.getParent() as MTable;\n\n\t\t\thighlightDOMElements(tableCellsDomRefs, mdcMTable.getFilterValue(), true);\n\t\t}\n\t},\n\n\t/**\n\t * Provides an initial condition configuration everytime a value help content is shown.\n\t * @param valueHelp The <code>ValueHelp</code> instance\n\t * @param content ValueHelp content requesting conditions configuration\n\t * @param control Instance of the calling control\n\t * @returns Returns a map of conditions suitable for a sap.ui.mdc.FilterBar control\n\t * @since 1.101.0\n\t */\n\tgetInitialFilterConditions: async function (valueHelp: ValueHelp, content: Content, control: Control | undefined) {\n\t\t// highlight text in ValueHelp popover\n\t\tif (content?.isA<MTable>(\"sap.ui.mdc.valuehelp.content.MTable\")) {\n\t\t\tconst popoverTable = content.getTable();\n\t\t\tpopoverTable?.removeEventDelegate(this._tableAfterRenderDelegate);\n\t\t\tpopoverTable?.addEventDelegate(this._tableAfterRenderDelegate, this);\n\t\t}\n\n\t\tconst payload = valueHelp.getPayload() as ValueHelpPayload;\n\t\tconst inConditions: ConditionObjectMap = {};\n\n\t\tif (!control) {\n\t\t\tLog.error(\"ValueHelpDelegate: Control undefined\");\n\t\t\treturn inConditions;\n\t\t}\n\n\t\tconst qualifier = payload.qualifiers[payload.valueHelpQualifier];\n\t\tconst inParameters = qualifier?.vhParameters !== undefined ? ValueListHelper.getInParameters(qualifier.vhParameters) : [];\n\t\tconst inParameterMap = this._partitionInParameters(inParameters);\n\t\tconst isObjectPage = control.getBindingContext();\n\n\t\tfor (const inParameter of inParameterMap.constant) {\n\t\t\tconst condition = this._createInitialFilterCondition(\n\t\t\t\tinParameter.constantValue,\n\t\t\t\tisObjectPage ? inParameter.initialValueIsSignificant : false // no filter with \"empty\" on ListReport\n\t\t\t);\n\t\t\tif (condition) {\n\t\t\t\tinConditions[inParameter.helpPath] = [condition];\n\t\t\t}\n\t\t}\n\n\t\tif (inParameterMap.binding.length) {\n\t\t\tawait this._getInitialFilterConditionsFromBinding(inConditions, control, inParameterMap.binding, payload);\n\t\t}\n\n\t\tif (inParameterMap.filter.length) {\n\t\t\tawait this._getInitialFilterConditionsFromFilterBar(inConditions, control, inParameterMap.filter, payload);\n\t\t}\n\t\treturn inConditions;\n\t},\n\n\t/**\n\t * Provides the possibility to convey custom data in conditions.\n\t * This enables an application to enhance conditions with data relevant for combined key or outparameter scenarios.\n\t * @param valueHelp The <code>ValueHelp</code> instance\n\t * @param content ValueHelp content instance\n\t * @param _values Description pair for the condition which is to be created\n\t * @param context Optional additional context\n\t * @returns Optionally returns a serializable object to be stored in the condition payload field\n\t * @since 1.101.0\n\t */\n\tcreateConditionPayload: function (\n\t\tvalueHelp: ValueHelp,\n\t\tcontent: Content,\n\t\t_values: unknown[],\n\t\tcontext: ODataV4Context\n\t): ConditionPayloadMap | undefined {\n\t\tconst payload = valueHelp.getPayload() as ValueHelpPayload;\n\t\tconst qualifier = payload.qualifiers[payload.valueHelpQualifier],\n\t\t\tentry: ConditionPayloadType = {},\n\t\t\tconditionPayload: ConditionPayloadMap = {};\n\t\tconst control = content.getControl();\n\t\tconst isMultiValueField = control?.isA(\"sap.ui.mdc.MultiValueField\");\n\n\t\t/* EXTERNALID: we add the value of the FilterField to the conditionPayload */\n\t\tif (payload.externalIdPath && payload.valueHelpKeyPath) {\n\t\t\tconst vhKeyProperty = payload.valueHelpKeyPath;\n\t\t\tconst vhKeyValue = qualifier.vhKeys && context.getObject(qualifier.vhKeys[0] || vhKeyProperty);\n\t\t\tentry[payload.propertyPath + \"@$ui5.fe.@Common/ExternalID\"] = vhKeyValue;\n\t\t\tconditionPayload[payload.valueHelpQualifier] = [entry];\n\t\t} else if (!qualifier.vhProperties || isMultiValueField) {\n\t\t\treturn undefined;\n\t\t}\n\t\tqualifier.vhProperties?.forEach(function (vhKey) {\n\t\t\tconst value = context.getObject(vhKey);\n\t\t\tif (value != null) {\n\t\t\t\tentry[vhKey] = value?.length === 0 ? \"\" : value;\n\t\t\t} else {\n\t\t\t\tentry[vhKey] = null; // null value is also valid\n\t\t\t}\n\t\t});\n\t\tif (Object.keys(entry).length) {\n\t\t\t/* vh qualifier as key for relevant condition */\n\t\t\tconditionPayload[payload.valueHelpQualifier] = [entry];\n\t\t}\n\t\treturn conditionPayload;\n\t},\n\n\tmodifySelectionBehaviour: function (valueHelp: ValueHelp, content: MTable, change: SelectionChange): SelectionChange {\n\t\tconst conditions = change.conditions;\n\t\tconst oldConditions = content.getConditions();\n\t\t// Prevent de-select in dialog scenarios\n\t\tif ((content?.getParent() as unknown as ValueHelpDialog)?.isQuickSelectActive?.() && !conditions.length && oldConditions.length) {\n\t\t\tchange.conditions = oldConditions;\n\t\t}\n\t\treturn change;\n\t},\n\n\t/**\n\t * Provides the possibility to customize selections in 'Select from list' scenarios.\n\t * By default, only condition keys are considered. This may be extended with payload dependent filters.\n\t * @param valueHelp The <code>ValueHelp</code> instance\n\t * @param content ValueHelp content instance\n\t * @param context Context of the selected item\n\t * @param conditions Current conditions\n\t * @returns Conditions or []\n\t */\n\tfindConditionsForContext: function (\n\t\tvalueHelp: ValueHelp,\n\t\tcontent: FilterableListContent,\n\t\tcontext: ODataV4Context,\n\t\tconditions: ConditionObject[]\n\t) {\n\t\tconst payload = valueHelp.getPayload() as ValueHelpPayload;\n\t\t/* Do not consider \"NotValidated\" conditions */\n\t\tconditions = conditions.filter((condition) => condition.validated === ConditionValidated.Validated);\n\n\t\tconst vhKeys = payload.qualifiers[payload.valueHelpQualifier]?.vhKeys || [];\n\t\tconst keyPath = content.getKeyPath();\n\t\tconst valueHelpQualifier = payload.valueHelpQualifier || \"\";\n\t\tconst findCondition = (conditionPayloadMap: ConditionPayloadMap, value: string | boolean | null): boolean => {\n\t\t\tconst conditionSelectedRow = conditionPayloadMap?.[valueHelpQualifier]?.[0] || {};\n\t\t\tif (vhKeys.length === 1 || payload?.useMultiValueField || !conditionPayloadMap) {\n\t\t\t\treturn context?.getObject(keyPath) === value;\n\t\t\t} else {\n\t\t\t\tconst contextKeys = Object.keys(context.getObject());\n\t\t\t\treturn vhKeys.every(function (vhKey) {\n\t\t\t\t\treturn !contextKeys.includes(vhKey) || context?.getObject(vhKey) === conditionSelectedRow[vhKey];\n\t\t\t\t});\n\t\t\t}\n\t\t};\n\t\tconst selectedCondition = conditions.find(function (condition) {\n\t\t\tconst conditionPayloadMap = condition.payload as ConditionPayloadMap;\n\t\t\tif (context?.getObject(keyPath) === conditionPayloadMap?.[valueHelpQualifier]?.[0]?.[keyPath]) {\n\t\t\t\treturn findCondition(conditionPayloadMap, conditionPayloadMap?.[valueHelpQualifier]?.[0]?.[keyPath]);\n\t\t\t} else if (context?.getObject(keyPath) === condition?.values[0]) {\n\t\t\t\treturn findCondition(conditionPayloadMap, condition?.values[0]);\n\t\t\t}\n\t\t});\n\n\t\treturn selectedCondition ? [selectedCondition] : [];\n\t},\n\n\t/**\n\t * Creates contexts for additional values and resumes the list binding.\n\t * @param payload Payload for delegate\n\t * @param listBinding List binding\n\t * @param bindingInfo The binding info object to be used to bind the list to the model\n\t * @param additionalValues Array of AdditionalValues\n\t * @param valueListProperty ValueListProperty of the payload\n\t * @param field Control connected to value help\n\t * @param sorters Sorters of the value help list binding\n\t */\n\t_updateBindingWithTransientContexts: async function (\n\t\tpayload: ValueHelpPayload,\n\t\tlistBinding: ODataListBinding,\n\t\tbindingInfo: BaseAggregationBindingInfo,\n\t\tadditionalValues: AdditionalValueType[],\n\t\tvalueListProperty: string,\n\t\tfield: FilterField | MultiValueField | Field,\n\t\tsorters: SorterType[],\n\t\ttable: Table\n\t) {\n\t\ttry {\n\t\t\tawait this._updateBindingAttributes(listBinding, bindingInfo, sorters);\n\n\t\t\tconst { recommendationValuesContextData, recentValuesContextData, othersValuesContextData } =\n\t\t\t\tawait this._getRelevantAdditionalValueContextData(\n\t\t\t\t\tadditionalValues,\n\t\t\t\t\tlistBinding,\n\t\t\t\t\tbindingInfo,\n\t\t\t\t\tpayload,\n\t\t\t\t\tvalueListProperty,\n\t\t\t\t\tfield,\n\t\t\t\t\tsorters,\n\t\t\t\t\ttable\n\t\t\t\t);\n\n\t\t\t// no grouping should be shown in the suggestion list if the search result only contains values from the 'Others' group\n\t\t\tif (recommendationValuesContextData.length === 0 && recentValuesContextData.length === 0) {\n\t\t\t\tlistBinding.sort();\n\t\t\t}\n\n\t\t\tif (payload?.history?.enabled) {\n\t\t\t\tpayload.history.hasRelevantData = recentValuesContextData.length !== 0;\n\t\t\t}\n\t\t\ttry {\n\t\t\t\t// Now we make sure to reset the listbinding, before the transient contexts are created\n\t\t\t\tawait listBinding.resetChanges();\n\t\t\t} catch (error: unknown) {\n\t\t\t\tLog.debug(`Error while clearing the list binding: ${error}`);\n\t\t\t}\n\t\t\t// add transient context to list binding after backend query is done\n\t\t\tadditionalValueHelper.createTransientContextsForAdditionalValueContextData(\n\t\t\t\trecommendationValuesContextData,\n\t\t\t\trecentValuesContextData,\n\t\t\t\tothersValuesContextData,\n\t\t\t\tlistBinding\n\t\t\t);\n\t\t} catch (error: unknown) {\n\t\t\t//Do nothing as we know that reset changes would throw an error in console and this will pile up a lot of console errors\n\t\t}\n\t},\n\t/**\n\t * Method to change the attributes of the value help, such as sort, filter, parameters etc.\n\t * @param listBinding List binding\n\t * @param bindingInfo The binding info object to be used to bind the list to the model\n\t * @param sorters Sorters of the value help list binding\n\t */\n\t_updateBindingAttributes: async function (\n\t\tlistBinding: ODataListBinding,\n\t\tbindingInfo: BaseAggregationBindingInfo,\n\t\tsorters: SorterType[]\n\t): Promise<void> {\n\t\tconst rootBinding = listBinding.getRootBinding() || listBinding;\n\t\tif (!rootBinding.isSuspended()) {\n\t\t\trootBinding.suspend();\n\t\t}\n\t\t//sort and filter value help binding to make sure we render others group\n\t\tadditionalValueHelper.sortAndFilterListBinding(listBinding, sorters);\n\t\tif (bindingInfo.parameters) {\n\t\t\tlistBinding.changeParameters(bindingInfo.parameters);\n\t\t}\n\t\t//resume the list binding and then reset the changes\n\t\tawait additionalValueHelper.resumeValueListBindingAndResetChanges(listBinding);\n\t},\n\t/**\n\t * Method used to determine the final list of all types of additional value context data (recommendation, recently used and others) to be used.\n\t * @param additionalValues Array of AdditionalValues\n\t * @param listBinding List binding\n\t * @param bindingInfo The binding info object to be used to bind the list to the model\n\t * @param payload Payload for delegate\n\t * @param valueListProperty ValueListProperty of the payload\n\t * @param field Control connected to value help\n\t * @param sorters Sorters of the value help list binding\n\t * @returns Object which contains recommendations, recently used, and others context data.\n\t */\n\t_getRelevantAdditionalValueContextData: async function (\n\t\tadditionalValues: AdditionalValueType[],\n\t\tlistBinding: ODataListBinding,\n\t\tbindingInfo: BaseAggregationBindingInfo,\n\t\tpayload: ValueHelpPayload,\n\t\tvalueListProperty: string,\n\t\tfield: FilterField | MultiValueField | Field,\n\t\tsorters: SorterType[],\n\t\ttable: Table\n\t): Promise<{\n\t\trecommendationValuesContextData: FieldDataType[];\n\t\trecentValuesContextData: FieldDataType[];\n\t\tothersValuesContextData: FieldDataType[];\n\t}> {\n\t\tlet { recommendationValuesContextData, othersValuesContextData } = await additionalValueHelper.requestForAdditionalValueContextData(\n\t\t\tadditionalValues,\n\t\t\tlistBinding,\n\t\t\tbindingInfo,\n\t\t\tpayload,\n\t\t\tsorters,\n\t\t\ttable\n\t\t);\n\n\t\t// apply search and filters to additional values context data\n\t\tconst valueHelpKeys = payload.qualifiers[payload.valueHelpQualifier].vhKeys || [];\n\t\trecommendationValuesContextData = additionalValueHelper.getRelevantRecommendationValuesContextData(\n\t\t\trecommendationValuesContextData,\n\t\t\tadditionalValues[0]?.values,\n\t\t\tvalueListProperty\n\t\t);\n\n\t\tlet recentValuesContextData: FieldDataType[] = [];\n\t\tif (!payload.isValueListWithFixedValues) {\n\t\t\t// no history for values lists with fixed values (they are usually short)\n\t\t\trecentValuesContextData = await this._getHistoryData(payload, field);\n\t\t\trecentValuesContextData = additionalValueHelper.getRelevantRecentValuesContextData(\n\t\t\t\tothersValuesContextData,\n\t\t\t\trecentValuesContextData,\n\t\t\t\tvalueHelpKeys,\n\t\t\t\t(bindingInfo.parameters as BindingInfoParameters).$search?.replaceAll('\"', \"\"),\n\t\t\t\tbindingInfo\n\t\t\t);\n\t\t}\n\n\t\tothersValuesContextData = additionalValueHelper.getRelevantOthersValuesContextData(\n\t\t\trecommendationValuesContextData,\n\t\t\trecentValuesContextData,\n\t\t\tothersValuesContextData,\n\t\t\tvalueHelpKeys\n\t\t);\n\n\t\treturn {\n\t\t\trecommendationValuesContextData,\n\t\t\trecentValuesContextData,\n\t\t\tothersValuesContextData\n\t\t};\n\t},\n\t/**\n\t * Executes a filter in a <code>ListBinding</code> and resumes it, if suspended.\n\t * @param listBinding List binding\n\t * @param bindingInfo The binding info object to be used to bind the list to the model\n\t */\n\t_updateBinding: function (listBinding: ODataListBinding, bindingInfo: BaseAggregationBindingInfo) {\n\t\tconst rootBinding = listBinding.getRootBinding() || listBinding;\n\t\tif (!rootBinding.isSuspended()) {\n\t\t\trootBinding.suspend();\n\t\t}\n\t\tif (bindingInfo.parameters) {\n\t\t\tlistBinding.changeParameters(bindingInfo.parameters);\n\t\t}\n\t\tlistBinding.filter(bindingInfo.filters, FilterType.Application);\n\t\tlistBinding.sort(bindingInfo.sorter);\n\n\t\tif (rootBinding.isSuspended()) {\n\t\t\trootBinding.resume();\n\t\t\trootBinding.resetChanges();\n\t\t}\n\t},\n\t/**\n\t * Returns an boolean value if additionalvalues exists which will contain different groups like recommendations.\n\t * @param content Filterable List Content\n\t * @param payload Payload for delegate\n\t * @param checkRecommendations Defines if we shall check for recommendations\n\t * @returns Boolean value\n\t */\n\t_checkIfAdditionalValuesExists: async function (content: MTable, payload: ValueHelpPayload, checkRecommendations = true) {\n\t\t// For define conditions valuehelp recommendations are not supported because \"internal\" model is not available.\n\t\tif (payload.isDefineConditionValueHelp) {\n\t\t\treturn false;\n\t\t}\n\n\t\tconst recommendationValues = checkRecommendations ? this.getRelevantRecommendations(content, payload) : [];\n\t\tif (recommendationValues?.length > 0) {\n\t\t\t//if there are relevant recommendations then return true\n\t\t\treturn true;\n\t\t}\n\n\t\tif (payload.history?.enabled) {\n\t\t\t// now check for recent values\n\t\t\tif (payload.history.hasRelevantData !== undefined) {\n\t\t\t\treturn payload.history.hasRelevantData;\n\t\t\t}\n\t\t\tconst recentValues = await this._getHistoryData(payload, content.getControl());\n\t\t\tif (recentValues.length) {\n\t\t\t\t//if there are recently entered values return true\n\t\t\t\treturn true;\n\t\t\t}\n\t\t}\n\t\treturn false;\n\t},\n\n\t/**\n\t * Returns the relevant recommendations.\n\t * @param content Filterable List Content\n\t * @param payload Payload for delegate\n\t * @returns Relevant recommendations\n\t */\n\tgetRelevantRecommendations(content: MTable, payload: ValueHelpPayload): (string | number)[] {\n\t\tlet values: (string | number)[] = [];\n\t\tconst isFilterFieldOrMultiValuedField =\n\t\t\tcontent.getControl().isA(\"sap.ui.mdc.FilterField\") || content.getControl().isA(\"sap.ui.mdc.MultiValueField\");\n\n\t\tif (!isFilterFieldOrMultiValuedField) {\n\t\t\tconst contentModel = content.getModel() as ODataModel & { getLocalAnnotationModel: Function };\n\t\t\tconst localAnnotationModel = contentModel.getLocalAnnotationModel && contentModel.getLocalAnnotationModel();\n\t\t\tif (localAnnotationModel) {\n\t\t\t\tconst bindingContextPath = content.getControl().getBindingContext()?.getPath();\n\t\t\t\tconst fieldPath = content.getControl().getBinding(\"value\")?.getPath();\n\t\t\t\tvalues = localAnnotationModel.getObject(`${bindingContextPath}/${fieldPath}@$ui5.fe.recommendations.typeAheadValues`) ?? [];\n\t\t\t}\n\t\t\tif (!values.length) {\n\t\t\t\tconst inputValues = (content.getModel(\"internal\") as JSONModel).getProperty(\"/recommendationsData\") || {};\n\t\t\t\tconst bindingContext = content.getBindingContext() as ODataV4Context;\n\t\t\t\tvalues =\n\t\t\t\t\tadditionalValueHelper.getRelevantRecommendations(\n\t\t\t\t\t\tinputValues,\n\t\t\t\t\t\tbindingContext,\n\t\t\t\t\t\tpayload.propertyPath,\n\t\t\t\t\t\tcontent.getControl().getBinding(\"value\")?.getPath()\n\t\t\t\t\t) || [];\n\t\t\t}\n\t\t}\n\t\treturn values;\n\t},\n\n\t/**\n\t * Returns a boolean value which will tell whether typeahead should be opened or not.\n\t * @param valueHelp The <code>ValueHelp</code> instance\n\t * @param content Filterable List Content\n\t * @returns Boolean value whether to show typeahead or not\n\t */\n\ttypeAheadForFilterableContent: async function (valueHelp: ValueHelp, content: MDCPopover) {\n\t\tlet showIt = true;\n\t\tconst typeAheadContent = content?.getContent()[0] as MTable;\n\t\tconst filterValue = valueHelp?.getFilterValue();\n\t\tconst field = typeAheadContent.getControl() as FilterField | MultiValueField | Field;\n\t\tconst payload = valueHelp.getPayload() as ValueHelpPayload;\n\n\t\tif (field.isA<FilterField>(\"sap.ui.mdc.FilterField\") || field.isA<MultiValueField>(\"sap.ui.mdc.MultiValueField\")) {\n\t\t\tif (!filterValue) {\n\t\t\t\t// according to the current recommendation UX we don't check for recommendations but recently entered values only\n\t\t\t\tshowIt = await this._checkIfAdditionalValuesExists(typeAheadContent, payload, false);\n\t\t\t}\n\t\t} else {\n\t\t\tconst fieldValue = field.getValue();\n\t\t\tconst fieldTextValue = field.getAdditionalValue();\n\t\t\tif (fieldValue || fieldTextValue) {\n\t\t\t\t// valuehelp had some value, but user cleared the value\n\t\t\t\t// in such case we get input value as '' and we will return false\n\t\t\t\t//Note: In SDs usecase we wanted to open the typeAhead if there are recommendations and value is blank, they should pass us a flag so that we can handle this accordingly\n\t\t\t\tconst isDigitSequence =\n\t\t\t\t\t(field.getModel() as ODataModel).getMetaModel().getObject(`${payload.propertyPath}${AnnotationIsDigitSequence}`) ??\n\t\t\t\t\tfalse;\n\t\t\t\tif (field.hasPendingUserInput() || this._isEmptyDigitSequence(fieldValue, isDigitSequence)) {\n\t\t\t\t\tshowIt = filterValue !== \"\" || (await this._checkIfAdditionalValuesExists(typeAheadContent, payload));\n\t\t\t\t} else {\n\t\t\t\t\t// check recently used only\n\t\t\t\t\tshowIt = await this._checkIfAdditionalValuesExists(typeAheadContent, payload, false);\n\t\t\t\t}\n\t\t\t} else if (!filterValue) {\n\t\t\t\tshowIt = await this._checkIfAdditionalValuesExists(typeAheadContent, payload);\n\t\t\t\t// else: the user types, we shall always show the other values\n\t\t\t}\n\t\t}\n\t\treturn showIt;\n\t},\n\n\tconditionForRequestShowContainer: async function (valueHelp: ValueHelp, content: MDCPopover) {\n\t\ttry {\n\t\t\tconst parentControl = valueHelp.getControl();\n\t\t\tif (parentControl && parentControl?.isA<FilterField>(\"sap.ui.mdc.FilterField\")) {\n\t\t\t\tconst fieldId = parentControl.getContent()?.getId();\n\t\t\t\tconst isVisualFilter = fieldId ? fieldId.includes(\"VisualFilter\") : false;\n\t\t\t\t//Visual Filter containing valueHelp should not open on focus for recently selected values o r recommendations\n\t\t\t\tif (isVisualFilter) {\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tconst valueHelpTable = content?.getContent()[0] as MTable;\n\t\t\tlet control: UI5Element | Dialog | undefined;\n\t\t\tconst getParentDialog = function (innerContent: UI5Element): Dialog | undefined {\n\t\t\t\tcontrol = innerContent?.getParent() as UI5Element;\n\t\t\t\tif (control && control.isA<Dialog>(\"sap.m.Dialog\")) {\n\t\t\t\t\treturn control;\n\t\t\t\t} else if (control === undefined || control === null) {\n\t\t\t\t\treturn undefined;\n\t\t\t\t}\n\t\t\t\treturn getParentDialog(control);\n\t\t\t};\n\t\t\tcontrol = getParentDialog(content);\n\t\t\tif (\n\t\t\t\tcontrol &&\n\t\t\t\tcontrol.data(\"fe_InitialTypeAheadFocusDone\") === null &&\n\t\t\t\tcontent.getControl().getDomRef()?.getElementsByTagName(\"input\")[0].id === (control as Dialog).getInitialFocus()\n\t\t\t) {\n\t\t\t\tcontrol.data(\"fe_InitialTypeAheadFocusDone\", true);\n\t\t\t\treturn false;\n\t\t\t} else {\n\t\t\t\tconst payload = valueHelp.getPayload() as ValueHelpPayload;\n\t\t\t\tpayload.history = payload.history || {};\n\t\t\t\tpayload.history.hasRelevantData = undefined; // needs to be initialize\n\t\t\t\tpayload.history.enabled = payload.history.enabled ?? ValueListHelper.checkHistoryEnabled(valueHelp, payload);\n\t\t\t\treturn await this._checkIfAdditionalValuesExists(valueHelpTable, payload);\n\t\t\t}\n\t\t} catch (error: unknown) {\n\t\t\tLog.error(error as string);\n\t\t}\n\t},\n\n\t/**\n\t * Returns an boolean value determining if requestShowContainer shall open the popover or not.\n\t * @param valueHelp The <code>ValueHelp</code> instance\n\t * @param container Filterable List Content\n\t * @param requestShowContainerReason Enum defining the reason for possible trigger\n\t * @returns Boolean value\n\t */\n\trequestShowContainer: async function (valueHelp: ValueHelp, container: MDCPopover, requestShowContainerReason: string) {\n\t\t// Ensure the value help popover opens for typing, filter, tap events and tab navigation\n\t\tif ([RequestShowContainerReason.Tab, RequestShowContainerReason.Tap].includes(requestShowContainerReason)) {\n\t\t\treturn this.conditionForRequestShowContainer(valueHelp, container);\n\t\t} else if ([RequestShowContainerReason.Typing, RequestShowContainerReason.Filter].includes(requestShowContainerReason)) {\n\t\t\treturn this.typeAheadForFilterableContent(valueHelp, container);\n\t\t}\n\t\treturn RequestShowContainerReason.ValueHelpRequest === requestShowContainerReason;\n\t}\n});\n"],"mappings":"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","ignoreList":[]}