/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)
 *      (c) Copyright 2009-2025 SAP SE. All rights reserved
 */
sap.ui.define(["sap/base/Log","sap/base/util/ObjectPath","sap/fe/macros/CommonHelper","sap/fe/macros/controls/filterbar/utils/VisualFilterUtils","sap/fe/macros/filter/FilterUtils","sap/fe/macros/filterBar/FilterHelper","sap/ui/core/Lib","sap/ui/mdc/condition/Condition","sap/ui/mdc/odata/v4/TypeMap","sap/ui/mdc/util/FilterUtil","sap/ui/model/Filter","sap/ui/model/FilterOperator"],function(e,t,r,n,i,s,o,a,l,f,c,g){"use strict";var u=s.getFiltersConditionsFromSelectionVariant;const d={selectionChanged(t){const r=t.getSource();const i=r.data("outParameter");const s=r.data("valuelistProperty");const o=r.data("dimension");const l=r.data("dimensionText");const f=r.data("multipleSelectionAllowed");const c=r.data("dimensionType");const g=t.getParameter("bar")||t.getParameter("point")||t.getParameter("segment");const u=t.getParameter("selected");const d=r.getModel("$field");let p=d.getProperty("/conditions");if(!i||s!==o){e.error("VisualFilter: Cannot sync values with regular filter as out parameter is not configured properly!")}else{let t=g?.getBindingContext()?.getObject(s);if(t){let e=g?.getBindingContext()?.getObject(l);if(typeof e!=="string"&&!(e instanceof String)){e=undefined}if(u){if(f===false){p=[]}if(c==="Edm.DateTimeOffset"){t=n._parseDateTime(t)}const r=a.createItemCondition(t,e||undefined,{},{});p.push(r)}else{p=p.filter(function(e){if(c==="Edm.DateTimeOffset"){return e.operator!=="EQ"||Date.parse(e.values[0])!==Date.parse(t)}return e.operator!=="EQ"||e.values[0]!==t})}d.setProperty("/conditions",p)}else{e.error("VisualFilter: No vaue found for the outParameter")}}},getAggregationSelected(e){let t=[];if(!this.getBindingContext()){return}for(let r=0;r<=e.length-1;r++){const n=e[r];if(n.operator==="EQ"){t.push(n.values[0])}}const r=this.getParent();const i=r.data("dimension");const s=r.data("dimensionType");let o=this.getBindingContext()?.getObject(i);if(s==="Edm.DateTimeOffset"){o=n._parseDateTime(o)}if(r.data("multipleSelectionAllowed")===false&&t.length>1){t=[t[0]]}return t.includes(o)},getParentVisualFilterControlBB(e){while(e&&!e.isA("sap.fe.macros.visualfilters.VisualFilter")){e=e.getParent()}return e},getFiltersFromConditions(){for(var t=arguments.length,s=new Array(t),a=0;a<t;a++){s[a]=arguments[a]}const p=this.getParent();const m=p.getParent()?.getParent()?.getParent()?.getParent()?.getParent();const h=p.data("inParameters").customData;const P=p.data("draftSupported")===true;const y=i.getFilterPropertyInfo(m);const E={};const F=[];let T;let C=[];const v=p.data("parameters");const _=p.data("selectionVariantAnnotation");const L=p.getBinding("bars")||p.getBinding("points")||p.getBinding("segments");const b=L.getPath();const V=p.getModel().getMetaModel();const S=L.getPath();const I=u(S,V,_,n.getCustomConditions.bind(n));for(const e in y){y[e].typeConfig=l.getTypeConfig(y[e].dataType,{},{})}const M=n.convertFilterCondions(I);Object.keys(M).forEach(function(e){E[e]=M[e];const t=h.find(function(t){return t.valueListProperty===e});const r=t?t.localDataProperty:e;if(!v||v&&!v.includes(e)){for(const t in y){const i=y[t];if(r===i.name){if(i?.typeConfig?.baseType==="DateTime"){if(E[e]){E[e].forEach(function(e){e.values[0]=n._formatDateTime(e.values[0])})}}F.push({name:e,typeConfig:i.typeConfig})}}}});h.forEach(function(e,t){if(s[t].length>0){E[e.valueListProperty]=s[t];if(!v||v&&!v.includes(e.valueListProperty)){for(const t in y){const r=y[t];if(r.name===e.localDataProperty){if(r?.typeConfig?.baseType==="DateTime"){if(E[e.valueListProperty]){E[e.valueListProperty].forEach(function(e){e.values[0]=n._formatDateTime(e.values[0])})}}F.push({name:e.valueListProperty,typeConfig:r.typeConfig})}}}}});const D=p.getBindingContext("internal");const O=p.data("infoPath");let R;const A=o.getResourceBundleFor("sap.fe.macros");const B=r.parseCustomData(p.data("requiredProperties"));if(B.length){const e=Object.keys(E)||[];const t=[];B.forEach(function(r){if(!e.includes(r)){t.push(r)}});if(!t.length){R=D.getProperty(`${O}/showError`);D.setProperty(O,{errorMessageTitle:"",errorMessage:"",showError:false})}else if(t.length>1){D.setProperty(O,{errorMessageTitle:A.getText("M_VISUAL_FILTERS_ERROR_MESSAGE_TITLE"),errorMessage:A.getText("M_VISUAL_FILTERS_PROVIDE_FILTER_VAL_MULTIPLEVF"),showError:true});return}else{const e=V.getObject(`${S}/${t[0]}@com.sap.vocabularies.Common.v1.Label`)||t[0];D.setProperty(O,{errorMessageTitle:A.getText("M_VISUAL_FILTERS_ERROR_MESSAGE_TITLE"),errorMessage:A.getText("M_VISUAL_FILTERS_PROVIDE_FILTER_VAL_SINGLEVF",[e]),showError:true});return}}else{R=D.getProperty(`${O}/showError`);D.setProperty(O,{errorMessageTitle:"",errorMessage:"",showError:false})}const w=m.data("entityType").split("/")[1];const x=b.split("/")[1].split("(")[0];if(v&&v.length&&w===x){const e=R?i.getBindingPathForParameters(m,E,y,v):undefined;if(e){L.sPath=e}}if(v&&v.length){v.forEach(function(e){if(E[e]){delete E[e]}})}if(Object.keys(E).length>0&&F.length){try{T=f.getFilterInfo(m,E,F,[]).filters}catch(t){e.debug("VisualFilter: Error while getting filters from MDCFilterUtil")}if(T){if(!T.getFilters()){C.push(T)}else if(T.getFilters()){C=T.getFilters()}}}if(P){C.push(new c("IsActiveEntity",g.EQ,true))}if(C&&C.length>0){L?.filter(C)}else if(!Object.keys(E).length){L?.filter()}if(R){const e=d.getParentVisualFilterControlBB(p);e?._setInternalUpdatePending(false)}return C},getFilterCounts(e){if(this.data("multipleSelectionAllowed")===false&&e.length>0){return`(1)`}if(e.length>0){return`(${e.length})`}else{return undefined}},scaleVisualFilterValue(e,t,r,i,s){if(t){return n.getFormattedNumber(s,t,r)}else if(i){return n.getFormattedNumber(s,undefined,undefined,i)}else if(r>0){r=r>2?2:r;return n.getFormattedNumber(s,undefined,r)}else{return e}},fireValueHelp(e){e.getSource().getParent()?.getParent()?.getParent()?.getParent()?.fireEvent("valueHelpRequest")}};t.set("sap.fe.macros.visualfilters.VisualFilterRuntime",d);return d},false);
//# sourceMappingURL=VisualFilterRuntime.js.map