/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)
 *      (c) Copyright 2009-2025 SAP SE. All rights reserved
 */
sap.ui.define(["sap/base/Log","sap/base/util/merge","sap/fe/base/BindingToolkit","sap/fe/base/ClassSupport","sap/fe/core/buildingBlocks/BuildingBlock","sap/fe/core/converters/ConverterContext","sap/fe/core/converters/ManifestWrapper","sap/fe/core/converters/controls/Common/DataVisualization","sap/fe/core/converters/helpers/Aggregation","sap/fe/core/helpers/ModelHelper","sap/fe/core/helpers/StableIdHelper","sap/m/Button","sap/m/Label","sap/m/OverflowToolbar","sap/m/OverflowToolbarLayoutData","sap/m/Title","sap/m/ToolbarSpacer","sap/m/VBox","sap/m/library","sap/ui/core/CustomData","../controls/filterbar/VisualFilter","./InteractiveChartHelper","./VisualFilterRuntime","./fragments/InteractiveCharts","sap/fe/base/jsx-runtime/jsx","sap/fe/base/jsx-runtime/Fragment","sap/fe/base/jsx-runtime/jsxs"],function(e,t,i,r,n,a,o,s,l,u,c,h,g,p,f,d,b,m,y,A,P,T,w,C,M,v,I){"use strict";var _,V,S,U,E,D,z,H,O,x,B,F,L,R,j,q,N,$,k,W,Y,G,J,K,Q,X,Z,ee,te,ie,re,ne,ae,oe,se,le,ue,ce,he,ge,pe,fe,de,be,me,ye,Ae,Pe,Te,we,Ce,Me,ve,Ie,_e,Ve,Se,Ue,Ee,De,ze,He,Oe;var xe={};var Be=C.getVisualFilterChart;var Fe=y.OverflowToolbarPriority;var Le=c.generate;var Re=l.AggregationHelper;var je=s.getDefaultSelectionVariant;var qe=r.property;var Ne=r.implementInterface;var $e=r.event;var ke=r.defineUI5Class;var We=i.resolveBindingString;var Ye=i.ifElse;var Ge=i.compileExpression;function Je(e,t,i,r){i&&Object.defineProperty(e,t,{enumerable:i.enumerable,configurable:i.configurable,writable:i.writable,value:i.initializer?i.initializer.call(r):void 0})}function Ke(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e,Qe(e,t)}function Qe(e,t){return Qe=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},Qe(e,t)}function Xe(e,t,i,r,n){var a={};return Object.keys(r).forEach(function(e){a[e]=r[e]}),a.enumerable=!!a.enumerable,a.configurable=!!a.configurable,("value"in a||a.initializer)&&(a.writable=!0),a=i.slice().reverse().reduce(function(i,r){return r(e,t,i)||i},a),n&&void 0!==a.initializer&&(a.value=a.initializer?a.initializer.call(n):void 0,a.initializer=void 0),void 0===a.initializer?(Object.defineProperty(e,t,a),null):a}function Ze(e,t){throw Error("Decorating class property failed. Please ensure that transform-class-properties is enabled and runs after the decorators transform.")}let et=(_=ke("sap.fe.macros.visualfilters.VisualFilter"),V=Ne("sap.ui.core.IFormContent"),S=qe({type:"boolean"}),U=qe({type:"string"}),E=$e(),D=qe({type:"string",required:true}),z=qe({type:"string"}),H=qe({type:"string",required:true}),O=qe({type:"string",required:true}),x=qe({type:"string"}),B=qe({type:"string"}),F=qe({type:"string"}),L=qe({type:"array"}),R=qe({type:"boolean"}),j=qe({type:"boolean"}),q=qe({type:"boolean"}),N=qe({type:"boolean"}),$=qe({type:"array"}),k=qe({type:"string"}),W=qe({type:"boolean"}),Y=qe({type:"string"}),G=qe({type:"boolean"}),J=qe({type:"boolean"}),K=qe({type:"boolean"}),Q=qe({type:"string"}),X=qe({type:"string"}),Z=qe({type:"string"}),ee=qe({type:"string"}),te=qe({type:"boolean"}),ie=qe({type:"boolean"}),re=qe({type:"boolean"}),_(ne=(ae=function(i){function r(e,t){var r;r=i.call(this,e,t)||this;Je(r,"__implements__sap_ui_core_IFormContent",oe,r);Je(r,"showValueHelp",se,r);Je(r,"valueHelpIconSrc",le,r);Je(r,"valueHelpRequest",ue,r);Je(r,"id",ce,r);Je(r,"title",he,r);Je(r,"contextPath",ge,r);Je(r,"metaPath",pe,r);Je(r,"outParameter",fe,r);Je(r,"valuelistProperty",de,r);Je(r,"selectionVariantAnnotation",be,r);Je(r,"inParameters",me,r);Je(r,"multipleSelectionAllowed",ye,r);Je(r,"required",Ae,r);Je(r,"showOverlayInitially",Pe,r);Je(r,"renderLineChart",Te,r);Je(r,"requiredProperties",we,r);Je(r,"filterBarEntityType",Ce,r);Je(r,"showError",Me,r);Je(r,"chartMeasure",ve,r);Je(r,"UoMHasCustomAggregate",Ie,r);Je(r,"showValueHelpButton",_e,r);Je(r,"customAggregate",Ve,r);Je(r,"groupId",Se,r);Je(r,"errorMessageTitle",Ue,r);Je(r,"errorMessage",Ee,r);Je(r,"_contentId",De,r);Je(r,"draftSupported",ze,r);Je(r,"isValueListWithFixedValues",He,r);Je(r,"enableChartBinding",Oe,r);r.inParamConditionUpdatePending=false;r.renderingUpdatePending=true;return r}xe=r;Ke(r,i);var n=r.prototype;n.onMetadataAvailable=function i(r){this.groupId="$auto.visualFilters";this.path=this.metaPath;const n=this._getOwner();this.contextPath=this.contextPath??n?.preprocessorContext?.fullContextPath;const s=this.getDataModelObjectForMetaPath(this.metaPath,this.contextPath);if(this.contextPath){this._resolvedContextPath=this.contextPath.endsWith("/")?this.contextPath:this.contextPath+"/"}const l=this.getMetaModel();const c=this.getAppComponent()?.getDiagnostics()??{};const h=this._getOwner()?.getRootController()?.getView().getViewData()??this._getOwner()?.getViewData();const g=a.createConverterContextForMacro(s?.startingEntitySet?.name,l,c,t,s?.contextLocation,new o(h,this.getAppComponent()));const p=new Re(g.getEntityType(),g);const f=p.getCustomAggregateDefinitions();const d=s?.targetObject;let b;const m=d&&d.Visualizations;this.getChartAnnotation(m,g);let y=[],A=[];if(this.chartAnnotation?.Measures?.length){A=f.filter(e=>e.qualifier===this.chartAnnotation?.Measures[0].value);b=A.length>0?A[0].qualifier:this.chartAnnotation.Measures[0].value;y=p.getAggregatedProperties()[0]}if(y&&y.length>0&&!this.chartAnnotation?.DynamicMeasures&&A.length===0&&this.chartAnnotation?.Measures&&this.chartAnnotation?.Measures.length>0){e.warning("The transformational aggregate measures are configured as Chart.Measures but should be configured as Chart.DynamicMeasures instead. Please check the SAP Help documentation and correct the configuration accordingly.")}if(this.chartAnnotation?.DynamicMeasures){if(A.length===0){b=g.getConverterContextFor(g.getAbsoluteAnnotationPath(this.chartAnnotation.DynamicMeasures[0].value)).getDataModelObjectPath().targetObject?.Name.toString();y=p.getAggregatedProperty()}else{e.warning("The dynamic measures have been ignored as visual filters can deal with only 1 measure and the first (custom aggregate) measure defined under Chart.Measures is considered.")}}if(f.some(function(e){return e.qualifier===b})){this.customAggregate=true}const P=je(g.getEntityType());this.checkSelectionVariant(P);const w=this.getAggregateProperties(y,b);if(w){this.aggregateProperties=w}const C=m&&this.chartAnnotation?.Measures&&this.chartAnnotation?.Measures[0]?.$target?.annotations;const M=w?.AggregatableProperty?.$target?.annotations;this.checkIfUOMHasCustomAggregate(f,C,M);const v=C?.UI?.Hidden;const I=v?.valueOf();const _=this.chartAnnotation?.ChartType;this.chartType=_;this.showValueHelpButton=this.getshowValueHelpButton(_,I);this.draftSupported=u.isDraftSupported(l,this.contextPath);this.errorMessage=this.getErrorMessage(I,b);this.chartMeasure=b;this.measureDimensionTitle=T.getMeasureDimensionTitle(this.chartAnnotation,this.customAggregate,this.aggregateProperties);const V=this.getDataModelObjectForMetaPath(this.contextPath);this.toolTip=T.getToolTip(this.chartAnnotation,V,this.path,this.customAggregate,this.aggregateProperties,this.renderLineChart);this.UoMVisibility=T.getUoMVisiblity(this.chartAnnotation,this.showError);this.scaleUoMTitle=T.getScaleUoMTitle(this.chartAnnotation,V,this.path,this.customAggregate,this.aggregateProperties);this.collection=V;this.sortOrder=d?.SortOrder;this.filterCountBinding=T.getfilterCountBinding(this.chartAnnotation);const S=this.getPageController()?.getView().getId();if(this._contentId){this._contentId=`${S}--${this._contentId}`}else if(this.id){this._contentId=`${this.id}-content`}this.selectionVariant=this.selectionVariantAnnotation?this.getDataModelObjectForMetaPath(this.selectionVariantAnnotation)?.targetObject:undefined;this.content=this.createContent()};n.checkIfUOMHasCustomAggregate=function e(t,i,r){const n=i?.Measures;const a=r?.Measures;const o=this.getUoM(n,a);if(o&&t.some(function(e){return e.qualifier===o})){this.UoMHasCustomAggregate=true}else{this.UoMHasCustomAggregate=false}};n.getChartAnnotation=function e(t,i){if(t){for(let e of t){const t=e&&e.value;this.chartAnnotation=i.getEntityTypeAnnotation(t)&&i.getEntityTypeAnnotation(t).annotation}}};n.setShowValueHelp=function e(t){if(this.content?.isA("sap.fe.macros.controls.filterbar.VisualFilter")){if(this.content?.getItems().length>0){const e=this.getVisualFilterControl();e?.getContent().some(function(e){if(e.isA("sap.m.Button")){e.setVisible(t)}});this.setProperty("showValueHelp",t)}}};n.setValueHelpIconSrc=function e(t){if(this.content?.isA("sap.fe.macros.controls.filterbar.VisualFilter")){if(this.content?.getItems().length>0){const e=this.getVisualFilterControl();e?.getContent().some(function(e){if(e.isA("sap.m.Button")){e.setIcon(t)}});this.setProperty("valueHelpIconSrc",t)}}};n.getVisualFilterControl=function e(){if(this.content?.isA("sap.fe.macros.controls.filterbar.VisualFilter")){return(this.content?.getItems()[0]).getItems()[0]}};n.getErrorMessage=function e(t,i){let r;if(this.chartAnnotation){if(this.chartAnnotation.ChartType==="UI.ChartType/Line"||this.chartAnnotation.ChartType==="UI.ChartType/Bar"){r=true}else{r=false}}if(typeof t==="boolean"&&t||!r||this.renderLineChart===false){this.showError=true;this.errorMessageTitle=t||!r?this.getTranslatedText("M_VISUAL_FILTERS_ERROR_MESSAGE_TITLE"):this.getTranslatedText("M_VISUAL_FILTER_LINE_CHART_INVALID_DATATYPE");if(t){return this.getTranslatedText("M_VISUAL_FILTER_HIDDEN_MEASURE",[i])}else if(!r){return this.getTranslatedText("M_VISUAL_FILTER_UNSUPPORTED_CHART_TYPE")}else{return this.getTranslatedText("M_VISUAL_FILTER_LINE_CHART_UNSUPPORTED_DIMENSION")}}};n.getshowValueHelpButton=function e(t,i){const r=this.chartAnnotation?.Dimensions[0]&&this.chartAnnotation?.Dimensions[0].$target&&this.chartAnnotation.Dimensions[0].$target.type;if(r==="Edm.Date"||r==="Edm.Time"||r==="Edm.DateTimeOffset"){return false}else if(typeof i==="boolean"&&i){return false}else if(!(t==="UI.ChartType/Bar"||t==="UI.ChartType/Line")){return false}else if(this.renderLineChart===false&&t==="UI.ChartType/Line"){return false}else if(this.isValueListWithFixedValues===true){return false}else{return true}};n.checkSelectionVariant=function t(i){let r;if(this.selectionVariantAnnotation){r=this.getDataModelObjectForMetaPath(this.selectionVariantAnnotation)?.targetObject}if(!r&&i){r=i}if(r&&r.SelectOptions&&!this.multipleSelectionAllowed){for(const t of r.SelectOptions){if(t.PropertyName?.value===this.chartAnnotation?.Dimensions[0].value){if(t.Ranges.length>1){e.error("Multiple SelectOptions for FilterField having SingleValue Allowed Expression")}}}}};n.getAggregateProperties=function e(t,i){let r;if(!t){return}t.some(function(e){if(e.Name===i){r=e;return true}});return r};n.getUoM=function e(t,i){let r=t?.ISOCurrency;let n=t?.Unit;if(!r&&!n&&i){r=i.ISOCurrency;n=i.Unit}return r?.path||n?.path};n.getRequired=function e(){if(this.required){return M(g,{text:"",width:"0.5rem",required:"true",children:{layoutData:M(f,{priority:Fe.NeverOverflow})}})}else{return""}};n.getTitle=function e(){return M(d,{id:Le([this._contentId,"MeasureDimensionTitle"]),text:this.measureDimensionTitle,tooltip:this.toolTip,titleStyle:"H6",level:"H3",class:"sapUiTinyMarginEnd sapUiNoMarginBegin"})};n.getUoMTitle=function e(t){if(this.UoMVisibility){return M(d,{id:Le([this._contentId,"ScaleUoMTitle"]),visible:t,text:this.scaleUoMTitle,titleStyle:"H6",level:"H3",width:this.scaleUoMTitle?Ge(Ye(We(this.scaleUoMTitle),"4.15rem",undefined)):undefined})}else{return""}};n.getToolBarSpacer=function e(){if(this.showValueHelpButton){return M(b,{})}else{return""}};n.getValueHelp=function e(t){if(this.showValueHelpButton){return M(h,{id:Le([this._contentId,"VisualFilterValueHelpButton"]),type:"Transparent",ariaHasPopup:"Dialog",text:this.filterCountBinding,enabled:t,press:e=>{w.fireValueHelp(e)},children:{layoutData:M(f,{priority:Fe.NeverOverflow}),customData:M(A,{value:this.multipleSelectionAllowed},"multipleSelectionAllowed")}})}else{return""}};n.getToolbar=function e(t){return M(p,{style:"Clear",children:{content:I(v,{children:[this.getRequired(),this.getTitle(),this.getUoMTitle(t),this.getToolBarSpacer(),this.getValueHelp(t)]})}})};n._handleInParamsChartBindingEnablement=function e(t){const i=this.getProperty("inParameters").customData;const r=i.map(e=>e.localDataProperty);const n=t.some(e=>r.includes(e));if(n){this._setInternalUpdatePending(true)}};n.setEnableChartBinding=function e(t){let i=arguments.length>1&&arguments[1]!==undefined?arguments[1]:[];if(t&&i.length>0){this._handleInParamsChartBindingEnablement(i)}const r=this.inParamConditionUpdatePending||this.renderingUpdatePending;const n=t&&!r;const a=this.content?.getChartBinding();if(a){if(n&&a.isSuspended()){a.resume()}else if(!n&&!a.isSuspended()){a.suspend()}}this.setProperty("enableChartBinding",t,true)};n._setInternalUpdatePending=function e(){let t=arguments.length>0&&arguments[0]!==undefined?arguments[0]:this.inParamConditionUpdatePending;let i=arguments.length>1&&arguments[1]!==undefined?arguments[1]:this.renderingUpdatePending;const r=this.enableChartBinding;const n=this.content?.getChartBinding();const a=t||i;if(!a&&r&&n&&n.isSuspended()){n.resume()}else if(a&&n&&!n.isSuspended()){n.suspend()}this.inParamConditionUpdatePending=t;this.renderingUpdatePending=i};n.createContent=function e(){const t=Le([this.path]);const i="{= !${internal>"+t+"/showError}}";const r=document.body.classList.contains("sapUiSizeCozy");const n=r?"13rem":"100%";const a=r?"100%":"7.5rem";const o=r?"17rem":"20.5rem";const s=r?"":"sapUiTinyMarginBeginEnd";const l=this._contentId?Le([this._contentId]):undefined;return M(P,{id:l,height:n,width:o,class:s,children:{customData:M(A,{value:Le([this.path])},"infoPath"),items:I(v,{children:[M(m,{height:"2rem",class:"sapUiTinyMarginTopBottom",children:this.getToolbar(i)}),M(m,{height:a,width:"100%",children:Be(this)})]})}})};return r}(n),oe=Xe(ae.prototype,"__implements__sap_ui_core_IFormContent",[V],{configurable:true,enumerable:true,writable:true,initializer:function(){return true}}),se=Xe(ae.prototype,"showValueHelp",[S],{configurable:true,enumerable:true,writable:true,initializer:null}),le=Xe(ae.prototype,"valueHelpIconSrc",[U],{configurable:true,enumerable:true,writable:true,initializer:null}),ue=Xe(ae.prototype,"valueHelpRequest",[E],{configurable:true,enumerable:true,writable:true,initializer:null}),ce=Xe(ae.prototype,"id",[D],{configurable:true,enumerable:true,writable:true,initializer:null}),he=Xe(ae.prototype,"title",[z],{configurable:true,enumerable:true,writable:true,initializer:function(){return""}}),ge=Xe(ae.prototype,"contextPath",[H],{configurable:true,enumerable:true,writable:true,initializer:null}),pe=Xe(ae.prototype,"metaPath",[O],{configurable:true,enumerable:true,writable:true,initializer:null}),fe=Xe(ae.prototype,"outParameter",[x],{configurable:true,enumerable:true,writable:true,initializer:null}),de=Xe(ae.prototype,"valuelistProperty",[B],{configurable:true,enumerable:true,writable:true,initializer:null}),be=Xe(ae.prototype,"selectionVariantAnnotation",[F],{configurable:true,enumerable:true,writable:true,initializer:null}),me=Xe(ae.prototype,"inParameters",[L],{configurable:true,enumerable:true,writable:true,initializer:null}),ye=Xe(ae.prototype,"multipleSelectionAllowed",[R],{configurable:true,enumerable:true,writable:true,initializer:null}),Ae=Xe(ae.prototype,"required",[j],{configurable:true,enumerable:true,writable:true,initializer:null}),Pe=Xe(ae.prototype,"showOverlayInitially",[q],{configurable:true,enumerable:true,writable:true,initializer:null}),Te=Xe(ae.prototype,"renderLineChart",[N],{configurable:true,enumerable:true,writable:true,initializer:null}),we=Xe(ae.prototype,"requiredProperties",[$],{configurable:true,enumerable:true,writable:true,initializer:null}),Ce=Xe(ae.prototype,"filterBarEntityType",[k],{configurable:true,enumerable:true,writable:true,initializer:null}),Me=Xe(ae.prototype,"showError",[W],{configurable:true,enumerable:true,writable:true,initializer:null}),ve=Xe(ae.prototype,"chartMeasure",[Y],{configurable:true,enumerable:true,writable:true,initializer:null}),Ie=Xe(ae.prototype,"UoMHasCustomAggregate",[G],{configurable:true,enumerable:true,writable:true,initializer:null}),_e=Xe(ae.prototype,"showValueHelpButton",[J],{configurable:true,enumerable:true,writable:true,initializer:null}),Ve=Xe(ae.prototype,"customAggregate",[K],{configurable:true,enumerable:true,writable:true,initializer:function(){return false}}),Se=Xe(ae.prototype,"groupId",[Q],{configurable:true,enumerable:true,writable:true,initializer:function(){return"$auto.visualFilters"}}),Ue=Xe(ae.prototype,"errorMessageTitle",[X],{configurable:true,enumerable:true,writable:true,initializer:null}),Ee=Xe(ae.prototype,"errorMessage",[Z],{configurable:true,enumerable:true,writable:true,initializer:null}),De=Xe(ae.prototype,"_contentId",[ee],{configurable:true,enumerable:true,writable:true,initializer:null}),ze=Xe(ae.prototype,"draftSupported",[te],{configurable:true,enumerable:true,writable:true,initializer:null}),He=Xe(ae.prototype,"isValueListWithFixedValues",[ie],{configurable:true,enumerable:true,writable:true,initializer:null}),Oe=Xe(ae.prototype,"enableChartBinding",[re],{configurable:true,enumerable:true,writable:true,initializer:function(){return true}}),ae))||ne);xe=et;return xe},false);
//# sourceMappingURL=VisualFilter.js.map