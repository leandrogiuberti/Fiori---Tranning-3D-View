{"version":3,"file":"InteractiveChartHelper.js","names":["InteractiveChartHelper","getChartDisplayedValue","value","valueFormat","metaPath","infoPath","generate","ScaleFactor","valueOf","NumberOfFractionalDigits","getChartValue","_getCollectionName","collection","contextPath","parameters","collectionObject","targetObject","isNavigationProperty","name","isEntitySet","_getBindingPathForParameters","filterConditions","metaModel","collectionName","entitySetPath","params","convertedFilterConditions","VisualFilterUtils","convertFilterCondions","parameterProperties","CommonUtils","getParameterInfo","i","parameter","property","entityPath","split","propertyContext","createBindingContext","typeConfig","TypeMap","getTypeConfig","$Type","JSTokenizer","parseJS","formatOptions","context","constraints","condition","conditionInternal","undefined","internalParameterCondition","ConditionConverter","toType","edmType","encodeURIComponent","ODataUtils","formatLiteral","values","push","parameterEntitySet","slice","lastIndexOf","targetNavigation","substring","toString","_getUOMAggregationExpression","customAggregate","UoMHasCustomAggregate","UOM","aggregation","aggregationExpression","UOMExpression","path","isPathAnnotationExpression","unit","AggregatableProperty","AggregationMethod","with","getAggregationBinding","chartAnnotations","textAssociation","dimensionType","sortOrder","selectionVariant","filterBarEntityType","draftSupported","chartMeasure","selectionVariantAnnotation","entityType","dimension","Dimensions","filters","this","getUoM","Filter","operator","value1","value2","getFiltersConditionsFromSelectionVariant","getCustomConditions","bind","conditions","forEach","isParameter","length","bindingPath","UOMAggregationExpression","textAssociationExpression","additionally","finalparameters","getSortOrder","$$aggregation","aggregate","group","templateShareable","suspended","getMaxItems","_getOrderExpressionFromMeasure","sortPropertyName","DynamicProperty","$target","Name","Property","$orderby","Descending","ChartType","startIndex","getColorBinding","dataPoint","valueCriticality","annotations","UI","ValueCriticality","Criticality","buildExpressionForCriticalityColorMicroChart","CriticalityCalculation","oDirection","ImprovementDirection","oDataPointValue","Value","oDeviationRangeLowValue","DeviationRangeLowValue","oToleranceRangeLowValue","ToleranceRangeLowValue","oAcceptanceRangeLowValue","AcceptanceRangeLowValue","oAcceptanceRangeHighValue","AcceptanceRangeHighValue","oToleranceRangeHighValue","ToleranceRangeHighValue","oDeviationRangeHighValue","DeviationRangeHighValue","CommonHelper","getCriticalityCalculationBinding","getValueCriticality","result","valueCriticalityType","_getCriticalityFromEnum","join","criticality","valueColor","mLibrary","ValueColor","indicator","Error","Good","Critical","Neutral","getScaleUoMTitle","chartAnnotation","seperator","toolTip","scaleFactor","MeasureAttributes","DataPoint","ValueFormat","fixedInteger","NumberFormat","getIntegerInstance","style","showScale","shortRefNumber","scale","getScale","UOMExp","pathInModel","constant","scaleExp","compileExpression","formatResult","visualFilterFormatter","formatScaleAndUOM","getMeasureDimensionTitle","measureLabel","measurePath","Measures","DynamicMeasures","dimensionPath","dimensionLabel","Common","Label","Library","getResourceBundleFor","getText","getToolTip","renderLineChart","chartType","measureDimensionToolTip","escapeSingleQuotes","scaleUOMTooltip","_getUOM","UOMObjectPath","customData","aggregatablePropertyPath","UOMObject","$Path","entityProperties","isSingleton","targetType","propertyAnnotations","find","measure","ISOCurrency","Unit","getScaleFactor","getUoMVisiblity","showError","getInParameterFiltersBinding","inParameters","parts","paths","inParameter","localDataProperty","getfilterCountBinding","getInteractiveChartProperties","visualFilter","interactiveChartProperties","id","showErrorExpression","errorMessageExpression","errorMessageTitleExpression","dataPointAnnotation","getParameters","getMetaModel","dimensionText","Text","aggregationBinding","type","aggregateProperties","scalefactor","uom","parseCustomData","inParameterFilters","stringifiedParameters","dimensionContext","fullyQualifiedName","dimensionObject","getDataModelObjectForMetaPath","getPath","chartLabel","getTextBinding","displayedValue","color"],"sources":["./InteractiveChartHelper.ts"],"sourcesContent":["import type { PathAnnotationExpression, Property, PropertyAnnotationValue, PropertyPath } from \"@sap-ux/vocabularies-types\";\nimport type { AggregatedProperty, AggregatedPropertyType } from \"@sap-ux/vocabularies-types/vocabularies/Analytics\";\nimport type { Label, SortOrderType } from \"@sap-ux/vocabularies-types/vocabularies/Common\";\nimport type {\n\tChart,\n\tDataPoint,\n\tNumberFormat as NumberFormatType,\n\tSelectionVariant,\n\tValueCriticalityType\n} from \"@sap-ux/vocabularies-types/vocabularies/UI\";\nimport JSTokenizer from \"sap/base/util/JSTokenizer\";\nimport {\n\tcompileExpression,\n\tconstant,\n\tformatResult,\n\tpathInModel,\n\ttype BindingToolkitExpression,\n\ttype CompiledBindingToolkitExpression\n} from \"sap/fe/base/BindingToolkit\";\nimport CommonUtils from \"sap/fe/core/CommonUtils\";\nimport type { PageContextPathTarget } from \"sap/fe/core/converters/TemplateConverter\";\nimport type { ParameterType } from \"sap/fe/core/converters/controls/ListReport/VisualFilters\";\nimport { generate } from \"sap/fe/core/helpers/StableIdHelper\";\nimport { isEntitySet, isNavigationProperty, isPathAnnotationExpression, isSingleton } from \"sap/fe/core/helpers/TypeGuards\";\nimport { buildExpressionForCriticalityColorMicroChart } from \"sap/fe/core/templating/CriticalityFormatters\";\nimport type { DataModelObjectPath } from \"sap/fe/core/templating/DataModelPathHelper\";\nimport CommonHelper from \"sap/fe/macros/CommonHelper\";\nimport VisualFilterUtils from \"sap/fe/macros/controls/filterbar/utils/VisualFilterUtils\";\nimport { constraints, formatOptions } from \"sap/fe/macros/filter/FilterFieldHelper\";\nimport type { FilterConditions } from \"sap/fe/macros/filterBar/FilterHelper\";\nimport { getFiltersConditionsFromSelectionVariant } from \"sap/fe/macros/filterBar/FilterHelper\";\nimport type { ValueColor } from \"sap/m/library\";\nimport mLibrary from \"sap/m/library\";\nimport Library from \"sap/ui/core/Lib\";\nimport NumberFormat from \"sap/ui/core/format/NumberFormat\";\nimport ConditionConverter from \"sap/ui/mdc/condition/ConditionConverter\";\nimport TypeMap from \"sap/ui/mdc/odata/v4/TypeMap\";\nimport Filter from \"sap/ui/model/Filter\";\nimport type FilterOperator from \"sap/ui/model/FilterOperator\";\nimport type ODataMetaModel from \"sap/ui/model/odata/v4/ODataMetaModel\";\nimport ODataUtils from \"sap/ui/model/odata/v4/ODataUtils\";\nimport { getTextBinding } from \"../field/FieldTemplating\";\nimport visualFilterFormatter from \"../formatters/VisualFilterFormatter\";\nimport type VisualFilter from \"./VisualFilter\";\n\ntype MeasureType = {\n\tvalue?: string;\n\tISOCurrency?: PathAnnotationExpression<string>;\n\tUnit?: PathAnnotationExpression<string>;\n};\nexport type InteractiveChartType = {\n\tchartLabel?: BindingToolkitExpression<string> | CompiledBindingToolkitExpression;\n\taggregationBinding?: aggregationBinding;\n\terrorMessageTitleExpression?: string;\n\terrorMessageExpression?: string;\n\tshowErrorExpression?: string;\n\tinParameters?: ParameterType[];\n\tdisplayedValue?: string;\n\tmeasure?: string;\n\tstringifiedParameters?: string[];\n\tinParameterFilters?: string;\n\tcolor?: string;\n\tuom?: string | PropertyAnnotationValue<unknown> | Record<string, unknown>;\n\tscalefactor?: number | object;\n\tselectionVariant?: SelectionVariant;\n};\n\ntype aggregationBinding = {\n\tpath: string;\n\ttemplateShareable: boolean;\n\tsuspended: boolean;\n\tfilters: Filter[];\n\tparameters: {\n\t\t$$aggregation: {\n\t\t\taggregate: { [x: string]: {} | { unit: string } | { name: string; with: string } | undefined };\n\t\t\tgroup: { [x: string]: { additionally: string[] } | { additionally: undefined } };\n\t\t};\n\t\t$orderby: string | undefined;\n\t};\n};\n\nconst InteractiveChartHelper = {\n\tgetChartDisplayedValue: function (value: string, valueFormat?: NumberFormatType, metaPath?: string): string {\n\t\tconst infoPath = generate([metaPath]);\n\t\treturn (\n\t\t\t\"{parts:[{path:'\" +\n\t\t\tvalue +\n\t\t\t\"',type:'sap.ui.model.odata.type.Decimal', constraints:{'nullable':false}}\" +\n\t\t\t(valueFormat && valueFormat.ScaleFactor\n\t\t\t\t? \",{value:'\" + valueFormat.ScaleFactor.valueOf() + \"'}\"\n\t\t\t\t: \",{path:'internal>scalefactorNumber/\" + infoPath + \"'}\") +\n\t\t\t(valueFormat && valueFormat.NumberOfFractionalDigits\n\t\t\t\t? \",{value:'\" + valueFormat.NumberOfFractionalDigits + \"'}\"\n\t\t\t\t: \",{value:'0'}\") +\n\t\t\t\",{path:'internal>currency/\" +\n\t\t\tinfoPath +\n\t\t\t\"'}\" +\n\t\t\t\",{path:'\" +\n\t\t\tvalue +\n\t\t\t\"',type:'sap.ui.model.odata.type.String', constraints:{'nullable':false}}\" +\n\t\t\t\"], formatter:'sap.fe.macros.visualfilters.VisualFilterRuntime.scaleVisualFilterValue'}\"\n\t\t); //+ sType.split('#').length ? sType.split('#')[1] : 'Decimal' + \"}\";\n\t},\n\tgetChartValue: function (value: string): string {\n\t\treturn \"{path:'\" + value + \"',type:'sap.ui.model.odata.type.Decimal', constraints:{'nullable':false}}\";\n\t},\n\t_getCollectionName: function (\n\t\tcollection: DataModelObjectPath<PageContextPathTarget> | undefined,\n\t\tcontextPath: string,\n\t\tparameters?: Array<string>\n\t): string {\n\t\tconst collectionObject = collection?.targetObject;\n\t\tif (isNavigationProperty(collectionObject)) {\n\t\t\treturn parameters ? contextPath : collectionObject.name;\n\t\t} else if (isEntitySet(collectionObject)) {\n\t\t\treturn \"/\" + collectionObject.name;\n\t\t} else {\n\t\t\treturn collectionObject!.name;\n\t\t}\n\t},\n\t_getBindingPathForParameters: function (\n\t\tfilterConditions: Record<string, FilterConditions[]>,\n\t\tmetaModel: ODataMetaModel | undefined,\n\t\tcollectionName: string,\n\t\tparameters: Array<string>,\n\t\tentitySetPath: string\n\t): string {\n\t\tconst params = [];\n\t\tconst convertedFilterConditions = VisualFilterUtils.convertFilterCondions(filterConditions);\n\t\tconst parameterProperties = CommonUtils.getParameterInfo(\n\t\t\tmetaModel as unknown as ODataMetaModel,\n\t\t\tcollectionName\n\t\t).parameterProperties;\n\t\tif (parameterProperties) {\n\t\t\tfor (const i in parameters) {\n\t\t\t\tconst parameter = parameters[i];\n\t\t\t\tconst property = parameterProperties[parameter];\n\t\t\t\tconst entityPath = entitySetPath.split(\"/\")[1];\n\t\t\t\tconst propertyContext = metaModel?.createBindingContext(`/${entityPath}/${parameter}`);\n\t\t\t\tlet typeConfig;\n\t\t\t\tif (propertyContext) {\n\t\t\t\t\ttypeConfig = TypeMap.getTypeConfig(\n\t\t\t\t\t\tproperty.$Type,\n\t\t\t\t\t\tJSTokenizer.parseJS(formatOptions(property, { context: propertyContext }) || \"{}\"),\n\t\t\t\t\t\tJSTokenizer.parseJS(constraints(property, { context: propertyContext }) || \"{}\")\n\t\t\t\t\t);\n\t\t\t\t}\n\t\t\t\tconst condition = convertedFilterConditions[parameter];\n\t\t\t\tconst conditionInternal = condition ? condition[0] : undefined;\n\t\t\t\tif (conditionInternal) {\n\t\t\t\t\tconst internalParameterCondition = ConditionConverter.toType(conditionInternal, typeConfig, TypeMap);\n\t\t\t\t\tconst edmType = property.$Type;\n\t\t\t\t\tlet value = encodeURIComponent(ODataUtils.formatLiteral(internalParameterCondition.values[0], edmType));\n\t\t\t\t\tparams.push(`${parameter}=${value}`);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tconst parameterEntitySet = collectionName.slice(0, collectionName.lastIndexOf(\"/\"));\n\t\tconst targetNavigation = collectionName.substring(collectionName.lastIndexOf(\"/\") + 1);\n\t\t// create parameter context\n\t\treturn `${parameterEntitySet}(${params.toString()})/${targetNavigation}`;\n\t},\n\t_getUOMAggregationExpression: function (\n\t\tcustomAggregate?: boolean,\n\t\tUoMHasCustomAggregate?: boolean,\n\t\tUOM?: PropertyAnnotationValue<unknown> | string | Record<string, unknown>,\n\t\taggregation?: AggregatedPropertyType\n\t): {\n\t\taggregationExpression: { unit: string } | {} | { name: string; with: string } | undefined;\n\t\tUOMExpression: { [x: string]: {} } | undefined | string;\n\t} {\n\t\tlet aggregationExpression, UOMExpression;\n\t\tconst path = UOM && isPathAnnotationExpression(UOM) && UOM.path;\n\t\tif (customAggregate) {\n\t\t\t//custom aggregate for a currency or unit of measure corresponding to this aggregatable property\n\t\t\tif (UoMHasCustomAggregate) {\n\t\t\t\taggregationExpression = path ? { unit: path } : {};\n\t\t\t\tUOMExpression = {};\n\t\t\t} else {\n\t\t\t\taggregationExpression = {};\n\t\t\t\tUOMExpression = path ? { [path]: {} } : {};\n\t\t\t}\n\t\t} else if (\n\t\t\taggregation &&\n\t\t\taggregation.AggregatableProperty &&\n\t\t\taggregation.AggregatableProperty.value &&\n\t\t\taggregation.AggregationMethod\n\t\t) {\n\t\t\taggregationExpression = { name: aggregation.AggregatableProperty.value, with: aggregation.AggregationMethod };\n\t\t\tUOMExpression = path ? { [path]: {} } : {};\n\t\t}\n\n\t\treturn {\n\t\t\taggregationExpression: aggregationExpression,\n\t\t\tUOMExpression: UOMExpression\n\t\t};\n\t},\n\tgetAggregationBinding: function (\n\t\tchartAnnotations: Chart,\n\t\tcollection: DataModelObjectPath<PageContextPathTarget> | undefined,\n\t\tcontextPath: string,\n\t\ttextAssociation?: PathAnnotationExpression<string>,\n\t\tdimensionType?: string,\n\t\tsortOrder?: SortOrderType[],\n\t\tselectionVariant?: SelectionVariant,\n\t\tcustomAggregate?: boolean,\n\t\taggregation?: AggregatedPropertyType,\n\t\tUoMHasCustomAggregate?: boolean,\n\t\tparameters?: Array<string>,\n\t\tfilterBarEntityType?: string,\n\t\tdraftSupported?: boolean,\n\t\tchartMeasure?: string,\n\t\tmetaModel?: ODataMetaModel\n\t): aggregationBinding {\n\t\tconst selectionVariantAnnotation = selectionVariant;\n\t\tconst entityType = filterBarEntityType;\n\t\tconst entitySetPath = contextPath;\n\t\tconst dimension = chartAnnotations.Dimensions[0].value;\n\t\tconst filters: Filter[] = [];\n\t\tlet filterConditions;\n\t\tlet collectionName = this._getCollectionName(collection, contextPath, parameters);\n\t\tconst UOM: PropertyAnnotationValue<unknown> | string | undefined | Record<string, unknown> = InteractiveChartHelper.getUoM(\n\t\t\tchartAnnotations,\n\t\t\tcollection,\n\t\t\tundefined,\n\t\t\tcustomAggregate,\n\t\t\taggregation\n\t\t);\n\t\tif (draftSupported) {\n\t\t\tfilters.push(new Filter({ operator: \"EQ\", value1: \"true\", value2: null, path: \"IsActiveEntity\" }));\n\t\t}\n\t\tif (selectionVariantAnnotation) {\n\t\t\tfilterConditions = getFiltersConditionsFromSelectionVariant(\n\t\t\t\tentitySetPath,\n\t\t\t\tmetaModel as unknown as ODataMetaModel,\n\t\t\t\tselectionVariantAnnotation,\n\t\t\t\tVisualFilterUtils.getCustomConditions.bind(VisualFilterUtils)\n\t\t\t);\n\t\t\tfor (const path in filterConditions) {\n\t\t\t\tconst conditions = filterConditions[path];\n\t\t\t\tconditions.forEach(function (condition: FilterConditions) {\n\t\t\t\t\tif (!condition.isParameter) {\n\t\t\t\t\t\tfilters.push(\n\t\t\t\t\t\t\tnew Filter({\n\t\t\t\t\t\t\t\toperator: condition.operator as FilterOperator,\n\t\t\t\t\t\t\t\tvalue1: condition.value1,\n\t\t\t\t\t\t\t\tvalue2: condition.value2,\n\t\t\t\t\t\t\t\tpath: condition.path\n\t\t\t\t\t\t\t})\n\t\t\t\t\t\t);\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\t\tif (entityType !== `${collectionName}/` && parameters && parameters.length && filterConditions) {\n\t\t\tconst bindingPath = this._getBindingPathForParameters(filterConditions, metaModel, collectionName, parameters, entitySetPath);\n\t\t\tcollectionName = bindingPath;\n\t\t}\n\t\tconst UOMAggregationExpression = this._getUOMAggregationExpression(customAggregate, UoMHasCustomAggregate, UOM, aggregation);\n\t\tconst aggregationExpression = UOMAggregationExpression.aggregationExpression;\n\t\tconst UOMExpression = UOMAggregationExpression.UOMExpression;\n\t\tconst textAssociationExpression = textAssociation ? { additionally: [textAssociation.path] } : {};\n\t\tconst finalparameters = {\n\t\t\t...this.getSortOrder(chartAnnotations, dimensionType, sortOrder, chartMeasure),\n\t\t\t$$aggregation: {\n\t\t\t\taggregate: {\n\t\t\t\t\t[chartMeasure as string]: aggregationExpression\n\t\t\t\t},\n\t\t\t\tgroup: {\n\t\t\t\t\t[dimension]: { ...textAssociationExpression },\n\t\t\t\t\t...(UOMExpression as object)\n\t\t\t\t}\n\t\t\t}\n\t\t};\n\t\treturn {\n\t\t\tpath: collectionName,\n\t\t\ttemplateShareable: true,\n\t\t\tsuspended: true,\n\t\t\tfilters: filters,\n\t\t\tparameters: finalparameters,\n\t\t\t...(InteractiveChartHelper.getMaxItems(chartAnnotations) as object)\n\t\t};\n\t},\n\n\t_getOrderExpressionFromMeasure: function (sortOrder?: SortOrderType[], chartMeasure?: string): { $orderby: string } {\n\t\tlet sortPropertyName;\n\t\tif (sortOrder && sortOrder.length) {\n\t\t\tif (sortOrder[0].DynamicProperty) {\n\t\t\t\tsortPropertyName = (sortOrder[0].DynamicProperty.$target as AggregatedProperty)?.Name;\n\t\t\t} else {\n\t\t\t\tsortPropertyName = sortOrder[0].Property?.value;\n\t\t\t}\n\t\t\tif (sortPropertyName === chartMeasure) {\n\t\t\t\treturn { $orderby: chartMeasure + (sortOrder[0].Descending ? \" desc\" : \"\") };\n\t\t\t}\n\t\t\treturn { $orderby: chartMeasure + \" desc\" };\n\t\t}\n\t\treturn { $orderby: chartMeasure + \" desc\" };\n\t},\n\n\tgetSortOrder: function (\n\t\tchartAnnotations: Chart,\n\t\tdimensionType?: string,\n\t\tsortOrder?: SortOrderType[],\n\t\tchartMeasure?: string\n\t): { $orderby: string | undefined } {\n\t\tif (chartAnnotations.ChartType === \"UI.ChartType/Donut\" || chartAnnotations.ChartType === \"UI.ChartType/Bar\") {\n\t\t\treturn this._getOrderExpressionFromMeasure(sortOrder, chartMeasure);\n\t\t} else if (dimensionType === \"Edm.Date\" || dimensionType === \"Edm.Time\" || dimensionType === \"Edm.DateTimeOffset\") {\n\t\t\treturn { $orderby: chartAnnotations.Dimensions[0].value };\n\t\t} else if (\n\t\t\tsortOrder &&\n\t\t\tsortOrder.length &&\n\t\t\t(sortOrder[0].Property?.$target as unknown as PathAnnotationExpression<string>)?.path === chartAnnotations.Dimensions[0].value\n\t\t) {\n\t\t\treturn { $orderby: sortOrder[0].Property?.$target?.name + (sortOrder[0].Descending ? \"desc'\" : \"'\") };\n\t\t} else {\n\t\t\treturn { $orderby: chartAnnotations.Dimensions[0].$target?.name };\n\t\t}\n\t},\n\n\tgetMaxItems: function (chartAnnotations: Chart): string | { startIndex: number; length: number } {\n\t\tif (chartAnnotations.ChartType === \"UI.ChartType/Bar\") {\n\t\t\treturn { startIndex: 0, length: 3 };\n\t\t} else if (chartAnnotations.ChartType === \"UI.ChartType/Line\") {\n\t\t\treturn { startIndex: 0, length: 6 };\n\t\t} else {\n\t\t\treturn \"\";\n\t\t}\n\t},\n\n\tgetColorBinding: function (dataPoint: DataPoint, dimension: PropertyPath): string | undefined {\n\t\tconst valueCriticality = dimension?.$target?.annotations?.UI?.ValueCriticality;\n\t\tif (dataPoint?.Criticality) {\n\t\t\treturn buildExpressionForCriticalityColorMicroChart(dataPoint);\n\t\t} else if (dataPoint?.CriticalityCalculation) {\n\t\t\tconst oDirection = dataPoint.CriticalityCalculation.ImprovementDirection;\n\t\t\tconst oDataPointValue = dataPoint.Value;\n\t\t\tconst oDeviationRangeLowValue = dataPoint.CriticalityCalculation.DeviationRangeLowValue.valueOf();\n\t\t\tconst oToleranceRangeLowValue = dataPoint.CriticalityCalculation.ToleranceRangeLowValue.valueOf();\n\t\t\tconst oAcceptanceRangeLowValue = dataPoint.CriticalityCalculation.AcceptanceRangeLowValue.valueOf();\n\t\t\tconst oAcceptanceRangeHighValue = dataPoint.CriticalityCalculation.AcceptanceRangeHighValue.valueOf();\n\t\t\tconst oToleranceRangeHighValue = dataPoint.CriticalityCalculation.ToleranceRangeHighValue.valueOf();\n\t\t\tconst oDeviationRangeHighValue = dataPoint.CriticalityCalculation.DeviationRangeHighValue.valueOf();\n\t\t\treturn CommonHelper.getCriticalityCalculationBinding(\n\t\t\t\toDirection,\n\t\t\t\toDataPointValue,\n\t\t\t\toDeviationRangeLowValue,\n\t\t\t\toToleranceRangeLowValue,\n\t\t\t\toAcceptanceRangeLowValue,\n\t\t\t\toAcceptanceRangeHighValue,\n\t\t\t\toToleranceRangeHighValue,\n\t\t\t\toDeviationRangeHighValue\n\t\t\t);\n\t\t} else if (valueCriticality && valueCriticality.length) {\n\t\t\treturn InteractiveChartHelper.getValueCriticality(dimension.value, valueCriticality);\n\t\t} else {\n\t\t\treturn undefined;\n\t\t}\n\t},\n\tgetValueCriticality: function (dimension: string, valueCriticality: Array<ValueCriticalityType>): string | undefined {\n\t\tlet result;\n\t\tconst values: string[] = [];\n\t\tif (valueCriticality && valueCriticality.length > 0) {\n\t\t\tvalueCriticality.forEach(function (valueCriticalityType: ValueCriticalityType) {\n\t\t\t\tif (valueCriticalityType.Value && valueCriticalityType.Criticality) {\n\t\t\t\t\tconst value =\n\t\t\t\t\t\t\"${\" +\n\t\t\t\t\t\tdimension +\n\t\t\t\t\t\t\"} === '\" +\n\t\t\t\t\t\tvalueCriticalityType.Value +\n\t\t\t\t\t\t\"' ? '\" +\n\t\t\t\t\t\tInteractiveChartHelper._getCriticalityFromEnum(valueCriticalityType.Criticality) +\n\t\t\t\t\t\t\"'\";\n\t\t\t\t\tvalues.push(value);\n\t\t\t\t}\n\t\t\t});\n\t\t\tresult = values.length > 0 && values.join(\" : \") + \" : undefined\";\n\t\t}\n\t\treturn result ? \"{= \" + result + \" }\" : undefined;\n\t},\n\t/**\n\t * This function returns the criticality indicator from annotations if criticality is EnumMember.\n\t * @param criticality Criticality provided in the annotations\n\t * @returns Return the indicator for criticality\n\t * @private\n\t */\n\t_getCriticalityFromEnum: function (criticality: string): ValueColor {\n\t\tconst valueColor = mLibrary.ValueColor;\n\t\tlet indicator;\n\t\tif (criticality === \"UI.CriticalityType/Negative\") {\n\t\t\tindicator = valueColor.Error;\n\t\t} else if (criticality === \"UI.CriticalityType/Positive\") {\n\t\t\tindicator = valueColor.Good;\n\t\t} else if (criticality === \"UI.CriticalityType/Critical\") {\n\t\t\tindicator = valueColor.Critical;\n\t\t} else {\n\t\t\tindicator = valueColor.Neutral;\n\t\t}\n\t\treturn indicator;\n\t},\n\tgetScaleUoMTitle: function (\n\t\tchartAnnotation?: Chart,\n\t\tcollection?: DataModelObjectPath<PageContextPathTarget>,\n\t\tmetaPath?: string,\n\t\tcustomAggregate?: boolean,\n\t\taggregation?: AggregatedPropertyType,\n\t\tseperator?: string,\n\t\ttoolTip?: boolean\n\t): string {\n\t\tconst scaleFactor = chartAnnotation?.MeasureAttributes\n\t\t\t? chartAnnotation.MeasureAttributes[0]?.DataPoint?.$target?.ValueFormat?.ScaleFactor?.valueOf()\n\t\t\t: undefined;\n\t\tconst infoPath = generate([metaPath]);\n\t\tconst fixedInteger = NumberFormat.getIntegerInstance({\n\t\t\tstyle: \"short\",\n\t\t\tshowScale: false,\n\t\t\tshortRefNumber: scaleFactor as number\n\t\t});\n\t\tlet scale = fixedInteger.getScale();\n\t\tlet UOM = InteractiveChartHelper.getUoM(chartAnnotation, collection, undefined, customAggregate, aggregation);\n\t\tconst UOMExp = isPathAnnotationExpression<string>(UOM)\n\t\t\t? (pathInModel<string>(\"uom/\" + infoPath, \"internal\") as BindingToolkitExpression<string>)\n\t\t\t: constant(UOM as string);\n\t\tconst scaleExp = scale ? constant(scale) : (pathInModel(\"scalefactor/\" + infoPath, \"internal\") as BindingToolkitExpression<string>);\n\t\tif (!seperator) {\n\t\t\tseperator = \"|\";\n\t\t}\n\t\tseperator = \" \" + seperator + \" \";\n\t\treturn compileExpression(formatResult([seperator, UOMExp, scaleExp], visualFilterFormatter.formatScaleAndUOM), toolTip) ?? \"\";\n\t},\n\tgetMeasureDimensionTitle: function (chartAnnotation?: Chart, customAggregate?: boolean, aggregation?: AggregatedPropertyType): string {\n\t\tlet measureLabel;\n\t\tlet measurePath;\n\t\tif (customAggregate) {\n\t\t\tmeasurePath = chartAnnotation?.Measures[0]?.$target?.name;\n\t\t}\n\t\tif (chartAnnotation?.DynamicMeasures && chartAnnotation.DynamicMeasures.length > 0) {\n\t\t\tmeasurePath = (chartAnnotation.DynamicMeasures[0]?.$target as AggregatedPropertyType)?.AggregatableProperty?.value;\n\t\t} else if (!customAggregate && chartAnnotation?.Measures && chartAnnotation?.Measures.length > 0) {\n\t\t\tmeasurePath = chartAnnotation.Measures[0]?.$target?.name;\n\t\t}\n\t\tconst dimensionPath = chartAnnotation?.Dimensions[0]?.value as unknown as Label;\n\t\tlet dimensionLabel = chartAnnotation?.Dimensions[0]?.$target?.annotations?.Common?.Label;\n\t\tif (!customAggregate && aggregation) {\n\t\t\t// check if the label is part of aggregated properties (Transformation aggregates)\n\t\t\tmeasureLabel = aggregation.annotations && aggregation.annotations.Common && aggregation.annotations.Common.Label;\n\t\t\tif (measureLabel === undefined) {\n\t\t\t\tmeasureLabel = chartAnnotation?.Measures?.[0]?.$target?.annotations?.Common?.Label;\n\t\t\t}\n\t\t} else {\n\t\t\tmeasureLabel = chartAnnotation?.Measures?.[0]?.$target?.annotations?.Common?.Label;\n\t\t}\n\t\tif (measureLabel === undefined) {\n\t\t\tmeasureLabel = measurePath;\n\t\t}\n\t\tif (dimensionLabel === undefined) {\n\t\t\tdimensionLabel = dimensionPath;\n\t\t}\n\t\treturn Library.getResourceBundleFor(\"sap.fe.macros\")!.getText(\"M_INTERACTIVE_CHART_HELPER_VISUALFILTER_MEASURE_DIMENSION_TITLE\", [\n\t\t\tmeasureLabel,\n\t\t\tdimensionLabel\n\t\t]);\n\t},\n\n\tgetToolTip: function (\n\t\tchartAnnotation?: Chart,\n\t\tcollection?: DataModelObjectPath<PageContextPathTarget>,\n\t\tmetaPath?: string,\n\t\tcustomAggregate?: boolean,\n\t\taggregation?: AggregatedPropertyType,\n\t\trenderLineChart?: boolean | string\n\t): string {\n\t\tconst chartType = chartAnnotation && chartAnnotation[\"ChartType\"];\n\t\tlet measureDimensionToolTip = InteractiveChartHelper.getMeasureDimensionTitle(chartAnnotation, customAggregate, aggregation);\n\t\tmeasureDimensionToolTip = CommonHelper.escapeSingleQuotes(measureDimensionToolTip);\n\t\tif (renderLineChart === false && chartType === \"UI.ChartType/Line\") {\n\t\t\treturn `{= '${measureDimensionToolTip}'}`;\n\t\t}\n\n\t\tconst seperator = Library.getResourceBundleFor(\"sap.fe.macros\")?.getText(\n\t\t\t\"M_INTERACTIVE_CHART_HELPER_VISUALFILTER_TOOLTIP_SEPERATOR\"\n\t\t);\n\t\tconst infoPath = generate([metaPath]);\n\t\tconst scaleUOMTooltip = InteractiveChartHelper.getScaleUoMTitle(\n\t\t\tchartAnnotation,\n\t\t\tcollection,\n\t\t\tinfoPath,\n\t\t\tcustomAggregate,\n\t\t\taggregation,\n\t\t\tseperator,\n\t\t\ttrue\n\t\t);\n\t\treturn \"{= '\" + measureDimensionToolTip + (scaleUOMTooltip ? \"' + \" + scaleUOMTooltip : \"'\") + \"}\";\n\t},\n\t_getUOM: function (\n\t\tUOMObjectPath?: PropertyAnnotationValue<unknown>,\n\t\tUOM?: \"ISOCurrency\" | \"Unit\",\n\t\tcollection?: DataModelObjectPath<PageContextPathTarget>,\n\t\tcustomData?: boolean,\n\t\taggregatablePropertyPath?: string\n\t): string | PathAnnotationExpression<unknown> | Record<string, unknown> | undefined {\n\t\tconst UOMObject: Record<string, unknown> = {};\n\t\tconst collectionObject = collection?.targetObject;\n\t\tif (UOMObjectPath && UOM && isPathAnnotationExpression(UOMObjectPath)) {\n\t\t\t// check if the UOM is part of Measure annotations(Custom aggregates)\n\t\t\tUOMObject[UOM] = { $Path: UOMObjectPath.path };\n\t\t\treturn customData && UOMObjectPath.path ? UOMObject : UOMObjectPath;\n\t\t} else if (aggregatablePropertyPath) {\n\t\t\t// check if the UOM is part of base property annotations(Transformation aggregates)\n\t\t\tconst entityProperties =\n\t\t\t\tisEntitySet(collectionObject) || isSingleton(collectionObject)\n\t\t\t\t\t? collectionObject.entityType.entityProperties\n\t\t\t\t\t: collectionObject?.targetType?.entityProperties;\n\t\t\tconst propertyAnnotations = entityProperties?.find((property: Property) => property.name == aggregatablePropertyPath);\n\t\t\tif (propertyAnnotations?.annotations?.Measures && UOM) {\n\t\t\t\tUOMObjectPath = propertyAnnotations?.annotations?.Measures[UOM] as PathAnnotationExpression<unknown>;\n\t\t\t\tUOMObject[UOM] = { $Path: UOMObjectPath?.path };\n\t\t\t}\n\t\t\treturn UOMObjectPath && customData && isPathAnnotationExpression(UOMObjectPath) && UOMObjectPath.path\n\t\t\t\t? UOMObject\n\t\t\t\t: UOMObjectPath;\n\t\t}\n\t},\n\tgetUoM: function (\n\t\tchartAnnotation?: Chart,\n\t\tcollection?: DataModelObjectPath<PageContextPathTarget>,\n\t\tcustomData?: boolean,\n\t\tcustomAggregate?: boolean,\n\t\taggregation?: AggregatedPropertyType\n\t): string | PropertyAnnotationValue<unknown> | Record<string, unknown> | undefined {\n\t\tlet measure: MeasureType = {};\n\t\tif (customAggregate) {\n\t\t\tmeasure = chartAnnotation?.Measures[0] as MeasureType;\n\t\t}\n\t\tif (chartAnnotation?.DynamicMeasures && chartAnnotation.DynamicMeasures.length > 0) {\n\t\t\tmeasure = (chartAnnotation.DynamicMeasures[0]?.$target as AggregatedPropertyType)?.AggregatableProperty?.$target?.annotations\n\t\t\t\t?.Measures as MeasureType;\n\t\t} else if (!customAggregate && chartAnnotation?.Measures && chartAnnotation.Measures.length > 0) {\n\t\t\tmeasure = chartAnnotation.Measures[0];\n\t\t}\n\t\tconst ISOCurrency = measure?.ISOCurrency;\n\t\tconst unit = measure?.Unit;\n\t\tlet aggregatablePropertyPath: string | undefined;\n\t\tif (!customAggregate && aggregation) {\n\t\t\taggregatablePropertyPath = aggregation.AggregatableProperty && aggregation.AggregatableProperty.value;\n\t\t} else {\n\t\t\taggregatablePropertyPath = measure?.value;\n\t\t}\n\t\treturn (\n\t\t\tthis._getUOM(ISOCurrency, \"ISOCurrency\", collection, customData, aggregatablePropertyPath) ||\n\t\t\tthis._getUOM(unit, \"Unit\", collection, customData, aggregatablePropertyPath)\n\t\t);\n\t},\n\tgetScaleFactor: function (valueFormat?: NumberFormatType): number | undefined {\n\t\tif (valueFormat && valueFormat.ScaleFactor) {\n\t\t\treturn valueFormat.ScaleFactor.valueOf();\n\t\t}\n\t\treturn undefined;\n\t},\n\tgetUoMVisiblity: function (chartAnnotation?: Chart, showError?: boolean): boolean {\n\t\tconst chartType = chartAnnotation && chartAnnotation[\"ChartType\"];\n\t\tif (showError) {\n\t\t\treturn false;\n\t\t} else if (!(chartType === \"UI.ChartType/Bar\" || chartType === \"UI.ChartType/Line\")) {\n\t\t\treturn false;\n\t\t} else {\n\t\t\treturn true;\n\t\t}\n\t},\n\tgetInParameterFiltersBinding: function (inParameters: Array<ParameterType>): string | undefined {\n\t\tif (inParameters.length > 0) {\n\t\t\tconst parts: string[] = [];\n\t\t\tlet paths = \"\";\n\t\t\tinParameters.forEach(function (inParameter: ParameterType) {\n\t\t\t\tif (inParameter.localDataProperty) {\n\t\t\t\t\tparts.push(`{path:'$filters>/conditions/${inParameter.localDataProperty}'}`);\n\t\t\t\t}\n\t\t\t});\n\t\t\tif (parts.length > 0) {\n\t\t\t\tpaths = parts.join();\n\t\t\t\treturn `{parts:[${paths}], formatter:'sap.fe.macros.visualfilters.VisualFilterRuntime.getFiltersFromConditions'}`;\n\t\t\t} else {\n\t\t\t\treturn undefined;\n\t\t\t}\n\t\t} else {\n\t\t\treturn undefined;\n\t\t}\n\t},\n\n\tgetfilterCountBinding: function (chartAnnotation?: Chart): string {\n\t\tconst dimension = chartAnnotation?.Dimensions[0]?.$target?.name;\n\t\treturn (\n\t\t\t\"{path:'$filters>/conditions/\" + dimension + \"', formatter:'sap.fe.macros.visualfilters.VisualFilterRuntime.getFilterCounts'}\"\n\t\t);\n\t},\n\n\tgetInteractiveChartProperties: function (visualFilter: VisualFilter): InteractiveChartType {\n\t\tconst chartAnnotation = visualFilter.chartAnnotation;\n\t\tconst interactiveChartProperties: InteractiveChartType = {};\n\t\tif (visualFilter.chartMeasure && chartAnnotation?.Dimensions && chartAnnotation.Dimensions[0]) {\n\t\t\tconst id = generate([visualFilter.metaPath]);\n\t\t\tinteractiveChartProperties.showErrorExpression = \"{= ${internal>\" + id + \"/showError}}\";\n\t\t\tinteractiveChartProperties.errorMessageExpression = \"{= ${internal>\" + id + \"/errorMessage}}\";\n\t\t\tinteractiveChartProperties.errorMessageTitleExpression = \"{= ${internal>\" + id + \"/errorMessageTitle}}\";\n\t\t\tlet dataPointAnnotation;\n\t\t\tif (chartAnnotation?.MeasureAttributes && chartAnnotation?.MeasureAttributes[0]) {\n\t\t\t\tdataPointAnnotation = chartAnnotation?.MeasureAttributes[0]?.DataPoint\n\t\t\t\t\t? chartAnnotation?.MeasureAttributes[0].DataPoint.$target\n\t\t\t\t\t: chartAnnotation?.MeasureAttributes[0];\n\t\t\t}\n\t\t\tconst dimension = chartAnnotation?.Dimensions[0];\n\t\t\tconst parameters = CommonHelper.getParameters(visualFilter.contextPath, visualFilter.getMetaModel());\n\t\t\tconst dimensionText = dimension?.$target?.annotations?.Common?.Text as unknown as PathAnnotationExpression<string>;\n\t\t\tinteractiveChartProperties.aggregationBinding = InteractiveChartHelper.getAggregationBinding(\n\t\t\t\tchartAnnotation,\n\t\t\t\tvisualFilter.collection,\n\t\t\t\tvisualFilter.contextPath,\n\t\t\t\tdimensionText,\n\t\t\t\tdimension.$target?.type,\n\t\t\t\tvisualFilter?.sortOrder,\n\t\t\t\tvisualFilter.selectionVariant,\n\t\t\t\tvisualFilter.customAggregate,\n\t\t\t\tvisualFilter.aggregateProperties,\n\t\t\t\tvisualFilter.UoMHasCustomAggregate,\n\t\t\t\tparameters,\n\t\t\t\tvisualFilter.filterBarEntityType,\n\t\t\t\tvisualFilter.draftSupported,\n\t\t\t\tvisualFilter.chartMeasure,\n\t\t\t\tvisualFilter.getMetaModel()\n\t\t\t);\n\t\t\tinteractiveChartProperties.scalefactor = InteractiveChartHelper.getScaleFactor((dataPointAnnotation as DataPoint)?.ValueFormat);\n\t\t\tinteractiveChartProperties.uom = InteractiveChartHelper.getUoM(\n\t\t\t\tchartAnnotation,\n\t\t\t\tvisualFilter.collection,\n\t\t\t\ttrue,\n\t\t\t\tvisualFilter.customAggregate,\n\t\t\t\tvisualFilter.aggregateProperties\n\t\t\t);\n\t\t\tinteractiveChartProperties.inParameters = visualFilter.inParameters;\n\t\t\tconst inParameters = CommonHelper.parseCustomData(visualFilter.inParameters as unknown as string);\n\t\t\tinteractiveChartProperties.inParameterFilters = visualFilter.inParameters\n\t\t\t\t? InteractiveChartHelper.getInParameterFiltersBinding(inParameters as Array<ParameterType>)\n\t\t\t\t: undefined;\n\t\t\tinteractiveChartProperties.selectionVariant = visualFilter.selectionVariant ? visualFilter.selectionVariant : undefined;\n\t\t\tinteractiveChartProperties.stringifiedParameters = parameters;\n\t\t\tconst dimensionContext = visualFilter\n\t\t\t\t.getMetaModel()\n\t\t\t\t?.createBindingContext(visualFilter.contextPath + \"/@\" + dimension.fullyQualifiedName.split(\"@\")[1]);\n\t\t\tif (dimensionContext) {\n\t\t\t\tconst dimensionObject = visualFilter.getDataModelObjectForMetaPath<Property>(\n\t\t\t\t\tdimensionContext.getPath(),\n\t\t\t\t\tvisualFilter.contextPath\n\t\t\t\t);\n\t\t\t\tinteractiveChartProperties.chartLabel = getTextBinding(dimensionObject as DataModelObjectPath<Property>, {});\n\t\t\t}\n\t\t\tinteractiveChartProperties.measure = InteractiveChartHelper.getChartValue(visualFilter.chartMeasure);\n\t\t\tinteractiveChartProperties.displayedValue = InteractiveChartHelper.getChartDisplayedValue(\n\t\t\t\tvisualFilter.chartMeasure,\n\t\t\t\t(dataPointAnnotation as DataPoint)?.ValueFormat,\n\t\t\t\tvisualFilter.metaPath\n\t\t\t);\n\t\t\tinteractiveChartProperties.color = InteractiveChartHelper.getColorBinding(dataPointAnnotation as DataPoint, dimension);\n\t\t}\n\t\treturn interactiveChartProperties;\n\t}\n};\n\nexport default InteractiveChartHelper;\n"],"mappings":"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","ignoreList":[]}