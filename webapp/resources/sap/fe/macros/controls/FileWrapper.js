/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)
 *      (c) Copyright 2009-2025 SAP SE. All rights reserved
 */
sap.ui.define(["sap/fe/base/ClassSupport","sap/fe/core/CommonUtils","sap/fe/core/converters/MetaModelConverter","sap/fe/core/helpers/ResourceModelHelper","sap/fe/core/templating/UIFormatters","sap/m/BusyDialog","./FieldWrapper"],function(e,t,i,r,a,n,l){"use strict";var o,s,u,c,p,f,d,g,y,h,b,v,m,C,w,_,P,E,x,z,B,I,U;var S=r.getResourceModel;var A=e.property;var M=e.defineUI5Class;var T=e.aggregation;function D(e,t,i,r){i&&Object.defineProperty(e,t,{enumerable:i.enumerable,configurable:i.configurable,writable:i.writable,value:i.initializer?i.initializer.call(r):void 0})}function O(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e,j(e,t)}function j(e,t){return j=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},j(e,t)}function L(e,t,i,r,a){var n={};return Object.keys(r).forEach(function(e){n[e]=r[e]}),n.enumerable=!!n.enumerable,n.configurable=!!n.configurable,("value"in n||n.initializer)&&(n.writable=!0),n=i.slice().reverse().reduce(function(i,r){return r(e,t,i)||i},n),a&&void 0!==n.initializer&&(n.value=n.initializer?n.initializer.call(a):void 0,n.initializer=void 0),void 0===n.initializer?(Object.defineProperty(e,t,n),null):n}function R(e,t){throw Error("Decorating class property failed. Please ensure that transform-class-properties is enabled and runs after the decorators transform.")}let k=(o=M("sap.fe.macros.controls.FileWrapper"),s=A({type:"sap.ui.core.URI"}),u=A({type:"string"}),c=A({type:"string"}),p=A({type:"string"}),f=T({type:"sap.m.Avatar",multiple:false}),d=T({type:"sap.ui.core.Icon",multiple:false}),g=T({type:"sap.m.Link",multiple:false}),y=T({type:"sap.m.Text",multiple:false}),h=T({type:"sap.ui.unified.FileUploader",multiple:false}),b=T({type:"sap.m.Button",multiple:false}),o(v=(m=function(e){function r(t,i){var r;r=e.call(this,t,i)||this;D(r,"uploadUrl",C,r);D(r,"propertyPath",w,r);D(r,"filename",_,r);D(r,"mediaType",P,r);D(r,"avatar",E,r);D(r,"icon",x,r);D(r,"link",z,r);D(r,"text",B,r);D(r,"fileUploader",I,r);D(r,"deleteButton",U,r);r._busy=false;r.avatarCacheBustingInitialized=false;return r}O(r,e);var o=r.prototype;o.enhanceAccessibilityState=function e(t,i){return i};o.onBeforeRendering=function e(){this._setAriaLabelledBy();this._setAriaRequired();this._addSideEffects();this._refreshAvatar()};o._setAriaLabelledBy=function e(){if(this.link){const e=this.getParent();const t={labelledby:undefined};if(e&&e.enhanceAccessibilityState){e.enhanceAccessibilityState(this.link,t)}if(t.labelledby){this.addAriaLabelledBy(t.labelledby)}}};o.getIdForLabel=function e(){const t=this.link||this.text||this.avatar;return t.getIdForLabel()};o._refreshAvatar=function e(){const i=t.getTargetView(this);const r=i.getController().collaborativeDraft;if(r.isCollaborationEnabled()){const e=this.avatar?.getBindingInfo("src").binding;if(e&&!this.avatarCacheBustingInitialized){e.attachEvent("change",()=>{this.avatar?.refreshAvatarCacheBusting()});this.avatarCacheBustingInitialized=true}}};o._setAriaRequired=function e(){const r=t.getTargetView(this),n=r.getViewData().fullContextPath,l=r.getModel().getMetaModel(),o=l.getContext(n),s=l.createBindingContext(this.propertyPath,o),u=i.getInvolvedDataModelObjects(s,o);const c=u.targetObject;this.requiredExpression=a.getRequiredExpression(c,undefined,false,false,{},u)};o._addSideEffects=function e(){const r=[],a=t.getTargetView(this),n=a.getViewData().fullContextPath,l=a.getModel().getMetaModel(),o=l.getMetaPath(n),s=l.getContext(n),u=i.getInvolvedDataModelObjects(s),c=this.data("sourcePath"),p=c.replace(`${o}`,""),f=p.replace(this.propertyPath,"");r.push({$NavigationPropertyPath:p});if(this.filename){r.push({$NavigationPropertyPath:f+this.filename})}if(this.mediaType){r.push({$NavigationPropertyPath:f+this.mediaType})}this._getSideEffectController()?.addControlSideEffects(u.targetEntityType.fullyQualifiedName,{sourceProperties:[p],targetEntities:r,sourceControlId:this.getId()})};o._getSideEffectController=function e(){const t=this._getViewController();return t?t._sideEffects:undefined};o._getViewController=function e(){const i=t.getTargetView(this);return i&&i.getController()};o.getUploadUrl=function e(){const t=this.getBindingContext();return t&&this.uploadUrl?this.uploadUrl.replace(t.getPath(),t.getCanonicalPath()):""};o.setUIBusy=function e(t){const i=this;this._busy=t;if(t){if(!this.busyDialog){this.busyDialog=new n({text:S(this).getText("M_FILEWRAPPER_BUSY_DIALOG_TITLE"),showCancelButton:false})}setTimeout(function(){if(i._busy){i.busyDialog?.open()}},1e3)}else{this.busyDialog?.close(false)}};o.getUIBusy=function e(){return this._busy};r.render=function e(i,r){let a,n;if(r.avatar){a="100%";n="3rem"}else{a=t.getIsEditable(r)?"calc(100% - 5rem)":"100%";n="4.5rem"}i.openStart("div",r);i.style("width",r.width);i.openEnd();i.openStart("div");i.style("display","flex");i.style("box-sizing","border-box");i.style("justify-content","space-between");i.style("align-items","center");i.style("flex-wrap","wrap");i.style("align-content","stretch");i.style("width","100%");i.openEnd();i.openStart("div");i.style("display","flex");i.style("align-items","center");i.style("max-width",a);i.style("min-width",n);i.openEnd();if(r.avatar){i.renderControl(r.avatar)}else{i.renderControl(r.icon);i.renderControl(r.link);i.renderControl(r.text)}i.close("div");i.openStart("div");i.style("display","flex");i.style("align-items","center");i.openEnd();i.renderControl(r.fileUploader);i.renderControl(r.deleteButton);i.close("div");i.close("div");i.close("div")};o.destroy=function e(t){const i=this._getSideEffectController();if(i){i.removeControlSideEffects(this)}delete this.busyDialog;l.prototype.destroy.apply(this,[t])};return r}(l),C=L(m.prototype,"uploadUrl",[s],{configurable:true,enumerable:true,writable:true,initializer:null}),w=L(m.prototype,"propertyPath",[u],{configurable:true,enumerable:true,writable:true,initializer:null}),_=L(m.prototype,"filename",[c],{configurable:true,enumerable:true,writable:true,initializer:null}),P=L(m.prototype,"mediaType",[p],{configurable:true,enumerable:true,writable:true,initializer:null}),E=L(m.prototype,"avatar",[f],{configurable:true,enumerable:true,writable:true,initializer:null}),x=L(m.prototype,"icon",[d],{configurable:true,enumerable:true,writable:true,initializer:null}),z=L(m.prototype,"link",[g],{configurable:true,enumerable:true,writable:true,initializer:null}),B=L(m.prototype,"text",[y],{configurable:true,enumerable:true,writable:true,initializer:null}),I=L(m.prototype,"fileUploader",[h],{configurable:true,enumerable:true,writable:true,initializer:null}),U=L(m.prototype,"deleteButton",[b],{configurable:true,enumerable:true,writable:true,initializer:null}),m))||v);return k},false);
//# sourceMappingURL=FileWrapper.js.map