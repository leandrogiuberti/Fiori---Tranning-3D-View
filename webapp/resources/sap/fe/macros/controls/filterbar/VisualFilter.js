/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)
 *      (c) Copyright 2009-2025 SAP SE. All rights reserved
 */
sap.ui.define(["sap/fe/base/ClassSupport","sap/fe/core/CommonUtils","sap/fe/macros/CommonHelper","sap/fe/macros/controls/filterbar/utils/VisualFilterUtils","sap/fe/macros/filter/FilterUtils","sap/fe/macros/filterBar/FilterHelper","sap/m/VBox","sap/ui/core/Lib","../../visualfilters/VisualFilterRuntime"],function(t,e,r,n,i,a,o,s,c){"use strict";var l,u,f,g,d;var p=a.getFiltersConditionsFromSelectionVariant;var h=t.implementInterface;var _=t.defineUI5Class;function m(t,e,r,n){r&&Object.defineProperty(t,e,{enumerable:r.enumerable,configurable:r.configurable,writable:r.writable,value:r.initializer?r.initializer.call(n):void 0})}function I(t,e){t.prototype=Object.create(e.prototype),t.prototype.constructor=t,P(t,e)}function P(t,e){return P=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},P(t,e)}function E(t,e,r,n,i){var a={};return Object.keys(n).forEach(function(t){a[t]=n[t]}),a.enumerable=!!a.enumerable,a.configurable=!!a.configurable,("value"in a||a.initializer)&&(a.writable=!0),a=r.slice().reverse().reduce(function(r,n){return n(t,e,r)||r},a),i&&void 0!==a.initializer&&(a.value=a.initializer?a.initializer.call(i):void 0,a.initializer=void 0),void 0===a.initializer?(Object.defineProperty(t,e,a),null):a}function v(t,e){throw Error("Decorating class property failed. Please ensure that transform-class-properties is enabled and runs after the decorators transform.")}let C=(l=_("sap.fe.macros.controls.filterbar.VisualFilter"),u=h("sap.ui.core.IFormContent"),l(f=(g=function(t){function a(){var e;for(var r=arguments.length,n=new Array(r),i=0;i<r;i++){n[i]=arguments[i]}e=t.call(this,...n)||this;m(e,"__implements__sap_ui_core_IFormContent",d,e);return e}I(a,t);var o=a.prototype;o.getChartBinding=function t(){const e=this.getInteractiveChart();const r=e?.getBinding("segments")||e?.getBinding("bars")||e?.getBinding("points");if(!this._oChartBinding||this._oChartBinding!==r){if(this._oChartBinding){this.detachDataReceivedHandler(this._oChartBinding)}this.attachDataRecivedHandler(r);this._oChartBinding=r}return this._oChartBinding};o.onAfterRendering=function t(){let e;const a=this.getInteractiveChart();const o=this.data("infoPath");const l=this.getChartBinding();const u=a.getBindingContext("internal");const f=s.getResourceBundleFor("sap.fe.macros");const g=a.data("showOverlayInitially");const d=a.data("selectionVariantAnnotation")?a.data("selectionVariantAnnotation"):{SelectOptions:[]};const h=a.data("requiredProperties")?r.parseCustomData(a.data("requiredProperties")):[];const _=a.getModel().getMetaModel();const m=l?l.getPath():"";let I=this.getParent()?.getParent()?.getParent();if(I.getMetadata().getElementName()==="sap.ui.mdc.filterbar.p13n.AdaptationFilterBar"){I=I.getParent()?.getParent()?.getParent()}let P={};let E=[];let v;if(I.isA("sap.fe.macros.controls.FilterBar")){P=I.getConditions();E=i.getFilterPropertyInfo(I);v=I.data("entityType").split("/")[1]}const C=a.data("parameters")?a.data("parameters"):[];const b=p(m,_,d,n.getCustomConditions.bind(n));const y=n.convertFilterCondions(b);const R={};Object.keys(P).forEach(function(t){if(P[t].length){R[t]=P[t]}});Object.keys(y).forEach(function(t){if(!R[t]){R[t]=y[t]}});if(g===true){if(!Object.keys(d).length){if(h.length>1){u.setProperty(o,{showError:true,errorMessageTitle:f.getText("M_VISUAL_FILTERS_ERROR_MESSAGE_TITLE"),errorMessage:f.getText("M_VISUAL_FILTERS_PROVIDE_FILTER_VAL_MULTIPLEVF")})}else{e=_.getObject(`${m}/${h[0]}@com.sap.vocabularies.Common.v1.Label`)||h[0];u.setProperty(o,{showError:true,errorMessageTitle:f.getText("M_VISUAL_FILTERS_ERROR_MESSAGE_TITLE"),errorMessage:f.getText("M_VISUAL_FILTERS_PROVIDE_FILTER_VAL_SINGLEVF",e)})}}else{const t=[];const e=[];if(d.SelectOptions){d.SelectOptions.forEach(function(e){t.push(e.PropertyName.$PropertyPath)})}if(d.Parameters){d.Parameters.forEach(function(e){t.push(e.PropertyName.$PropertyPath)})}h.forEach(function(r){if(!t.includes(r)){e.push(r)}});const r=n.getErrorInfoForNoInitialOverlay(e,f,m,_);u.setProperty(o,r)}}const T=u.getProperty(o)&&u.getProperty(o).showError;const F=m!==""?m.split("/")[1].split("(")[0]:"";if(C&&C.length&&v===F){const t=i.getBindingPathForParameters(I,R,E,C);if(t){l.sPath=t}}if(l&&l.isSuspended()&&!T){const t=c.getParentVisualFilterControlBB(this);t?._setInternalUpdatePending(undefined,false)}};o.attachDataRecivedHandler=function t(e){if(e){e.attachEvent("dataReceived",{},this.onInternalDataReceived,this);this._oChartBinding=e}};o.detachDataReceivedHandler=function t(e){if(e){e.detachEvent("dataReceived",this.onInternalDataReceived,this);this._oChartBinding=undefined}};o.getInteractiveChart=function t(){return this.getItems()[1].getItems()[0]};o.onInternalDataReceived=function t(r){const i=this.getId();const a=e.getTargetView(this);const o=this.getInteractiveChart();const c=this.data("infoPath");const l=o.getBindingContext("internal");const u=s.getResourceBundleFor("sap.fe.macros");const f=o.data("uom");n.updateChartScaleFactorTitle(o,a,i,c);if(r.getParameter("error")){const t=u.getText("M_VISUAL_FILTERS_ERROR_MESSAGE_TITLE");const e=u.getText("M_VISUAL_FILTERS_ERROR_DATA_TEXT");n.applyErrorMessageAndTitle(t,e,c,a)}else if(r.getParameter("data")){const t=r.getSource().getCurrentContexts();if(t&&t.length===0){n.setNoDataMessage(c,u,a)}else{l.setProperty(c,{})}n.setMultiUOMMessage(t,o,c,u,a)}if(f&&(f["ISOCurrency"]&&f["ISOCurrency"].$Path||f["Unit"]&&f["Unit"].$Path)){const t=r.getSource().getContexts();const e=t&&t[0].getObject();n.applyUOMToTitle(o,e,a,c)}};return a}(o),d=E(g.prototype,"__implements__sap_ui_core_IFormContent",[u],{configurable:true,enumerable:true,writable:true,initializer:function(){return true}}),g))||f);return C},false);
//# sourceMappingURL=VisualFilter.js.map