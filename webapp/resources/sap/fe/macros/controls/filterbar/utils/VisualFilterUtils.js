/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)
 *      (c) Copyright 2009-2025 SAP SE. All rights reserved
 */
sap.ui.define(["sap/base/Log","sap/fe/macros/filterBar/FilterHelper","sap/ui/core/format/NumberFormat","sap/ui/mdc/condition/Condition","sap/ui/model/odata/type/DateTimeOffset"],function(e,t,r,n,o){"use strict";var a=t.getTypeCompliantValue;var s=t.getRangeProperty;const i={applyMedianScaleToChartData:function(e,t,r,n){const o=[];const a=e.data("measure");const s=t.getBindingContext("internal");const i=e.getPoints&&e.getPoints()||e.getBars&&e.getBars()||e.getSegments&&e.getSegments();for(const e of i){o.push(e.getBindingContext().getObject())}const l=this._getMedianScaleFactor(o,a);if(l&&l.iShortRefNumber&&l.scale){s.setProperty(`scalefactor/${n}`,l.scale);s.setProperty(`scalefactorNumber/${n}`,l.iShortRefNumber)}else{s.setProperty(`scalefactor/${n}`,"");s.setProperty(`scalefactorNumber/${n}`,"");const e=t.byId(`${r}::ScaleUoMTitle`);const o=t.byId(`${r}::MeasureDimensionTitle`);const a=e.getText();if(a===" | "){e.setText("");o.setTooltip(o.getText())}}},_getMedianScaleFactor:function(e,t){let n;let o;e.sort(function(e,r){if(Number(e[t])<Number(r[t])){return-1}if(Number(e[t])>Number(r[t])){return 1}return 0});if(e.length>0){const r=e.length/2,a=r%1===0?(parseFloat(e[r-1][t])+parseFloat(e[r][t]))/2:parseFloat(e[Math.floor(r)][t]),s=a;for(n=0;n<14;n++){o=Math.pow(10,n);if(Math.round(Math.abs(s)/o)<10){break}}}const a=r.getIntegerInstance({style:"short",showScale:false,shortRefNumber:o});for(n=0;n<e.length;n++){const r=e[n],s=a.format(r[t]),i=s.split(".");if(!i[1]&&parseInt(i[0],10)===0||i[1]&&parseInt(i[0],10)===0&&i[1].indexOf("0")===0||Number(s)/1e3>=1e3){o=undefined;break}}return{iShortRefNumber:o,scale:o?a.getScale():""}},getFormattedNumber:function(e,t,n,o){let a;const s=typeof e==="string"?Number(e.replace(/,/g,"")):e;if(o){const e=r.getCurrencyInstance({showMeasure:false});return e.format(s,o)}else if(t){a=r.getFloatInstance({style:"short",showScale:false,shortRefNumber:t,shortDecimals:n});return a.format(s)}else{a=r.getFloatInstance({decimals:n});return a.format(s)}},applyUOMToTitle:function(e,t,r,n){const o=e.data("uom");let a;let s;if(o&&o["ISOCurrency"]){a=o["ISOCurrency"];s=a.$Path?t[a.$Path]:a}else if(o&&o["Unit"]){a=o["Unit"]}if(a){const e=a.$Path?t[a.$Path]:a;const o=r.getBindingContext("internal");o.setProperty(`uom/${n}`,e);if(s){o.setProperty(`currency/${n}`,e)}}},updateChartScaleFactorTitle:function(e,t,n,o){if(!e.data("scalefactor")){this.applyMedianScaleToChartData(e,t,n,o)}else{const n=r.getIntegerInstance({style:"short",showScale:false,shortRefNumber:e.data("scalefactor")});const a=t.getBindingContext("internal");const s=n.getScale()?n.getScale():"";a.setProperty(`scalefactor/${o}`,s)}},applyErrorMessageAndTitle:function(e,t,r,n){const o=n.getBindingContext("internal");o.setProperty(r,{});o.setProperty(r,{errorMessageTitle:e,errorMessage:t,showError:true})},checkMulitUnit:function(e,t){const r=[];if(e&&t){for(const n of e){const e=n&&n.getObject();r.push(e[t])}}return!!r.reduce(function(e,t){return e===t?e:NaN})},setMultiUOMMessage:function(t,r,n,o,a){const s=r.data("uom");const i=s&&s["ISOCurrency"]&&s["ISOCurrency"].$Path;const l=s&&s["Unit"]&&s["Unit"].$Path;const c=i||l;let u,f;if(c){if(!this.checkMulitUnit(t,c)){if(i){u=o.getText("M_VISUAL_FILTERS_ERROR_MESSAGE_TITLE");f=o.getText("M_VISUAL_FILTERS_MULTIPLE_CURRENCY",c);this.applyErrorMessageAndTitle(u,f,n,a);e.warning(`Filter is set for multiple Currency for${c}`)}else if(l){u=o.getText("M_VISUAL_FILTERS_ERROR_MESSAGE_TITLE");f=o.getText("M_VISUAL_FILTERS_MULTIPLE_UNIT",c);this.applyErrorMessageAndTitle(u,f,n,a);e.warning(`Filter is set for multiple UOMs for${c}`)}}}},setNoDataMessage:function(e,t,r){const n=t.getText("M_VISUAL_FILTERS_ERROR_MESSAGE_TITLE");const o=t.getText("M_VISUAL_FILTER_NO_DATA_TEXT");this.applyErrorMessageAndTitle(n,o,e,r)},convertFilterCondions:function(e){const t={};Object.keys(e).forEach(function(r){const o=[];const a=e[r];for(const e of a){const t=e.value2?[e.value1,e.value2]:[e.value1];o.push(n.createCondition(e.operator,t,null,null,"Validated"))}if(o.length){t[r]=o}});return t},getCustomConditions:function(e,t,r){let n,o;if(t.$Type==="Edm.DateTimeOffset"){n=this._parseDateTime(a(this._formatDateTime(e.Low),t.$Type,e.Option));o=e.High?this._parseDateTime(a(this._formatDateTime(e.High),t.$Type,e.Option)):null}else{n=e.Low;o=e.High?e.High:null}return{operator:e.Option?s(e.Option.$EnumMember||e.Option):null,value1:n,value2:o,path:r}},_parseDateTime:function(e){return this._getDateTimeTypeInstance().parseValue(e,"string")},_formatDateTime:function(e){return this._getDateTimeTypeInstance().formatValue(e,"string")},_getDateTimeTypeInstance:function(){return new o({pattern:"yyyy-MM-ddTHH:mm:ssZ",calendarType:"Gregorian"},{V4:true})},getErrorInfoForNoInitialOverlay:function(e,t,r,n){let o;if(e.length>1){o={showError:true,errorMessageTitle:t.getText("M_VISUAL_FILTERS_ERROR_MESSAGE_TITLE"),errorMessage:t.getText("M_VISUAL_FILTERS_PROVIDE_FILTER_VAL_MULTIPLEVF")}}else if(e.length===1){const a=n.getObject(`${r}/${e[0]}@com.sap.vocabularies.Common.v1.Label`)||e[0];o={showError:true,errorMessageTitle:t.getText("M_VISUAL_FILTERS_ERROR_MESSAGE_TITLE"),errorMessage:t.getText("M_VISUAL_FILTERS_PROVIDE_FILTER_VAL_SINGLEVF",[a])}}return o},enableChartBinding(t,r,n){const o=n?.filter?Object.keys(n.filter):[];for(const n in t){const a=t[n];if(a&&a.isA("sap.fe.macros.visualfilters.VisualFilter")){a.setEnableChartBinding(r,o)}else{e.error(`Control with id ${n} is not a VisualFilter`)}}}};return i},false);
//# sourceMappingURL=VisualFilterUtils.js.map