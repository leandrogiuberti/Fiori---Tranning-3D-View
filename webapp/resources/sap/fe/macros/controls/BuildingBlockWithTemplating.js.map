{"version":3,"file":"BuildingBlockWithTemplating.js","names":["BuildingBlockWithTemplating","_dec","defineUI5Class","_class","_BuildingBlock","apply","this","arguments","_exports","_inheritsLoose","_proto","prototype","onMetadataAvailable","content","_createContent","owner","_getOwner","isA","contentCreated","createContent","createProxyMethods","methods","_this","method","_len","length","args","Array","_key","setProperty","propertyKey","propertyValue","bSuppressInvalidate","_applyingSettings","undefined","Object","keys","getMetadata","getProperties","includes","call","setAggregation","aggregationObject","getAggregations","removeAggregation","aggregationName","object","suppressInvalidate","removed","addAggregation","insertAggregation","index","async","preprocessorContext","getPreprocessorContext","models","bindingContexts","metadata","bbMetadata","buildingBlockMetadata","namespace","publicNamespace","name","fqnName","getName","replaceAll","xmlProperties","xmlAggregations","allAggregations","aggregations","propertiesKey","properties","propertyValueObject","hasOwnProperty","getModel","model","getObject","path","type","push","xml","xmlAggregation","serialize","isContext","getPath","aggregationKey","_aggregationValue","isArray","aggregationChildren","aggregationChild","join","fragment","XMLPreprocessor","process","parseXMLString","firstElementChild","destroy","runAsOwner","Fragment","load","definition","controller","getRootController","BuildingBlock"],"sources":["./BuildingBlockWithTemplating.ts"],"sourcesContent":["import type { EnhanceWithUI5, UI5ControlMetadataDefinition } from \"sap/fe/base/ClassSupport\";\nimport { defineUI5Class } from \"sap/fe/base/ClassSupport\";\nimport type TemplateComponent from \"sap/fe/core/TemplateComponent\";\nimport BuildingBlock from \"sap/fe/core/buildingBlocks/BuildingBlock\";\nimport type { BuildingBlockMetadata } from \"sap/fe/core/buildingBlocks/templating/BuildingBlockSupport\";\nimport { parseXMLString, xml } from \"sap/fe/core/buildingBlocks/templating/BuildingBlockTemplateProcessor\";\nimport { isContext } from \"sap/fe/core/helpers/TypeGuards\";\nimport type BuildingBlockObjectProperty from \"sap/fe/macros/controls/BuildingBlockObjectProperty\";\nimport type ManagedObject from \"sap/ui/base/ManagedObject\";\nimport type { PropertyBindingInfo } from \"sap/ui/base/ManagedObject\";\nimport type BaseObject from \"sap/ui/base/Object\";\nimport type Control from \"sap/ui/core/Control\";\nimport type UI5Element from \"sap/ui/core/Element\";\nimport Fragment from \"sap/ui/core/Fragment\";\nimport XMLPreprocessor from \"sap/ui/core/util/XMLPreprocessor\";\n\n/**\n * Using this class you can define a building block that will manage and render a templating based building block.\n * On change of the main properties you will be able to recreate the content.\n * @public\n * @ui5-experimental-since\n * @deprecated\n * @deprecatedsince 1.140\n */\n@defineUI5Class(\"sap.fe.macros.controls.BuildingBlockWithTemplating\")\nexport default class BuildingBlockWithTemplating extends BuildingBlock<Control> {\n\tpublic contentCreated?: Promise<void>;\n\n\tprivate metadata!: UI5ControlMetadataDefinition;\n\n\tonMetadataAvailable(): void {\n\t\tif (!this.content) {\n\t\t\tthis._createContent();\n\t\t}\n\t}\n\n\t_createContent(): void {\n\t\tconst owner = this._getOwner();\n\t\tif (owner?.isA<TemplateComponent>(\"sap.fe.core.TemplateComponent\")) {\n\t\t\tthis.contentCreated = this.createContent(owner as EnhanceWithUI5<TemplateComponent>);\n\t\t}\n\t}\n\n\t/**\n\t * Create proxy methods to forward calls to the content for the given methods.\n\t * @param methods The method to proxy\n\t */\n\tcreateProxyMethods(methods: string[]): void {\n\t\tfor (const method of methods) {\n\t\t\t(this as unknown as Record<string, Function>)[method] = (...args: unknown[]): unknown => {\n\t\t\t\treturn (this.content as unknown as Record<string, Function>)?.[method]?.(...args);\n\t\t\t};\n\t\t}\n\t}\n\n\tsetProperty(propertyKey: string, propertyValue: string, bSuppressInvalidate?: boolean): this {\n\t\tif (\n\t\t\t!this._applyingSettings &&\n\t\t\tpropertyValue !== undefined &&\n\t\t\tObject.keys(this.getMetadata().getProperties()).includes(propertyKey)\n\t\t) {\n\t\t\tsuper.setProperty(propertyKey, propertyValue, true);\n\t\t\tthis._createContent();\n\t\t} else {\n\t\t\tsuper.setProperty(propertyKey, propertyValue, bSuppressInvalidate);\n\t\t}\n\t\treturn this;\n\t}\n\n\tsetAggregation(propertyKey: string, aggregationObject: ManagedObject, bSuppressInvalidate?: boolean): this {\n\t\tif (!this._applyingSettings && Object.keys(this.getMetadata().getAggregations()).includes(propertyKey)) {\n\t\t\tsuper.setAggregation(propertyKey, aggregationObject, true);\n\t\t\tthis._createContent();\n\t\t} else {\n\t\t\tsuper.setAggregation(propertyKey, aggregationObject, bSuppressInvalidate);\n\t\t}\n\t\treturn this;\n\t}\n\n\tremoveAggregation(\n\t\taggregationName: string,\n\t\tobject: ManagedObject | number | string,\n\t\tsuppressInvalidate?: boolean\n\t): ManagedObject | null {\n\t\tlet removed: ManagedObject | null;\n\t\tif (\n\t\t\t!this._applyingSettings &&\n\t\t\tobject !== undefined &&\n\t\t\tObject.keys(this.getMetadata().getAggregations()).includes(aggregationName)\n\t\t) {\n\t\t\tremoved = super.removeAggregation(aggregationName, object, suppressInvalidate);\n\t\t\tthis._createContent();\n\t\t} else {\n\t\t\tremoved = super.removeAggregation(aggregationName, object, suppressInvalidate);\n\t\t}\n\t\treturn removed;\n\t}\n\n\taddAggregation(aggregationName: string, object: ManagedObject, suppressInvalidate?: boolean): this {\n\t\tif (!this._applyingSettings && Object.keys(this.getMetadata().getAggregations()).includes(aggregationName)) {\n\t\t\tsuper.addAggregation(aggregationName, object, suppressInvalidate);\n\t\t\tthis._createContent();\n\t\t} else {\n\t\t\tsuper.addAggregation(aggregationName, object, suppressInvalidate);\n\t\t}\n\t\treturn this;\n\t}\n\n\tinsertAggregation(aggregationName: string, object: ManagedObject, index: number, suppressInvalidate?: boolean): this {\n\t\tif (!this._applyingSettings && Object.keys(this.getMetadata().getAggregations()).includes(aggregationName)) {\n\t\t\tsuper.insertAggregation(aggregationName, object, index, suppressInvalidate);\n\t\t\tthis._createContent();\n\t\t} else {\n\t\t\tsuper.insertAggregation(aggregationName, object, index, suppressInvalidate);\n\t\t}\n\t\treturn this;\n\t}\n\n\tasync createContent(owner: EnhanceWithUI5<TemplateComponent>): Promise<void> {\n\t\tif (this.contentCreated) {\n\t\t\tawait this.contentCreated;\n\t\t}\n\t\t// Only special building block will implement this\n\t\tconst preprocessorContext = owner.getPreprocessorContext() ?? {\n\t\t\tmodels: {},\n\t\t\tbindingContexts: {}\n\t\t};\n\n\t\tconst metadata = this.getMetadata();\n\t\tconst bbMetadata = this.metadata.buildingBlockMetadata as BuildingBlockMetadata | undefined;\n\t\tif (bbMetadata) {\n\t\t\tconst namespace = bbMetadata.publicNamespace ?? bbMetadata.namespace;\n\t\t\tconst name = bbMetadata.name;\n\t\t\tconst fqnName = `${metadata.getName()}`.replaceAll(\".\", \"/\");\n\t\t\tconst xmlProperties: string[] = [];\n\t\t\tconst xmlAggregations: string[] = [];\n\t\t\tconst allAggregations = bbMetadata.aggregations;\n\n\t\t\tfor (const propertiesKey in bbMetadata.properties) {\n\t\t\t\tlet propertyValue = this[propertiesKey as keyof this] as unknown;\n\t\t\t\tlet propertyValueObject = propertyValue as BaseObject;\n\t\t\t\tif (propertyValueObject?.hasOwnProperty?.(\"path\") && propertyValueObject?.hasOwnProperty?.(\"model\")) {\n\t\t\t\t\tpropertyValueObject = this.getModel((propertyValueObject as PropertyBindingInfo).model)?.getObject(\n\t\t\t\t\t\t(propertyValueObject as PropertyBindingInfo).path\n\t\t\t\t\t);\n\t\t\t\t}\n\t\t\t\tif (bbMetadata.properties[propertiesKey].type === \"function\") {\n\t\t\t\t\txmlProperties.push(xml`${propertiesKey}=\"THIS._fireEvent($event, $controller, '${propertiesKey}')\"`);\n\t\t\t\t} else if (\n\t\t\t\t\tpropertyValueObject?.isA &&\n\t\t\t\t\tpropertyValueObject.isA<BuildingBlockObjectProperty>(\"sap.fe.macros.controls.BuildingBlockObjectProperty\")\n\t\t\t\t) {\n\t\t\t\t\tconst xmlAggregation = propertyValueObject.serialize(`feBB:${propertiesKey}`);\n\t\t\t\t\txmlAggregations.push(xmlAggregation);\n\t\t\t\t} else if (bbMetadata.properties[propertiesKey].type === \"array\") {\n\t\t\t\t\tallAggregations[propertiesKey] = bbMetadata.properties[propertiesKey];\n\t\t\t\t} else if (\n\t\t\t\t\tpropertyValue !== undefined &&\n\t\t\t\t\tpropertyValue !== null &&\n\t\t\t\t\t(typeof propertyValue !== \"object\" || Object.keys(propertyValue).length > 0)\n\t\t\t\t) {\n\t\t\t\t\tif (isContext(propertyValue)) {\n\t\t\t\t\t\tpropertyValue = propertyValue.getPath();\n\t\t\t\t\t} else if (propertiesKey === \"id\") {\n\t\t\t\t\t\txmlProperties.push(xml`${propertiesKey}=\"${propertyValue}-block\"`);\n\t\t\t\t\t} else {\n\t\t\t\t\t\txmlProperties.push(xml`${propertiesKey}=\"${propertyValue}\"`);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\tfor (const aggregationKey in allAggregations) {\n\t\t\t\tconst _aggregationValue = this[aggregationKey as keyof this] as unknown as UI5Element | UI5Element[] | null;\n\t\t\t\tif (_aggregationValue && (!Array.isArray(_aggregationValue) || _aggregationValue?.length > 0)) {\n\t\t\t\t\tconst aggregationChildren: string[] = [];\n\t\t\t\t\tif (Array.isArray(_aggregationValue)) {\n\t\t\t\t\t\tfor (const aggregationChild of _aggregationValue) {\n\t\t\t\t\t\t\tif (aggregationChild.isA<BuildingBlockObjectProperty>(\"sap.fe.macros.controls.BuildingBlockObjectProperty\"))\n\t\t\t\t\t\t\t\taggregationChildren.push(aggregationChild.serialize());\n\t\t\t\t\t\t}\n\t\t\t\t\t} else if (_aggregationValue.isA<BuildingBlockObjectProperty>(\"sap.fe.macros.controls.BuildingBlockObjectProperty\")) {\n\t\t\t\t\t\taggregationChildren.push(_aggregationValue.serialize());\n\t\t\t\t\t}\n\t\t\t\t\tconst xmlAggregation = `<feBB:${aggregationKey}>${aggregationChildren.join(\"\\n\")}</feBB:${aggregationKey}>`;\n\n\t\t\t\t\txmlAggregations.push(xmlAggregation);\n\t\t\t\t}\n\t\t\t}\n\t\t\tconst fragment = await XMLPreprocessor.process(\n\t\t\t\tparseXMLString(\n\t\t\t\t\txml`<root><feBB:${name}\n\t\t\txmlns:core=\"sap.ui.core\"\n\t\t\txmlns:feBB=\"${namespace}\"\n\t\t\t${xmlProperties.length > 0 ? xmlProperties : \"\"}\n\t\t\tcore:require=\"{THIS: '${fqnName}'}\"\n\t\t\t>${xmlAggregations.length > 0 ? xmlAggregations : \"\"}</feBB:${name}></root>`,\n\t\t\t\t\ttrue\n\t\t\t\t)[0],\n\t\t\t\t{ models: {} },\n\t\t\t\tpreprocessorContext\n\t\t\t);\n\t\t\tif (fragment.firstElementChild) {\n\t\t\t\tthis.content?.destroy();\n\t\t\t\tthis.content = await owner.runAsOwner(async () => {\n\t\t\t\t\treturn Fragment.load({\n\t\t\t\t\t\tdefinition: fragment.firstElementChild as Element,\n\t\t\t\t\t\tcontroller: owner.getRootController()\n\t\t\t\t\t}) as Promise<Control>;\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\t}\n}\n"],"mappings":"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","ignoreList":[]}