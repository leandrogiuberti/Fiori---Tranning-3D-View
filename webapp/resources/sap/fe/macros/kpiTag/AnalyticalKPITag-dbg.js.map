{"version":3,"names":["AnalyticalKPITag","_dec","defineUI5Class","_dec2","property","type","required","_dec3","_dec4","_dec5","_class","_class2","_BuildingBlock","properties","others","_this","call","_initializerDefineProperty","_descriptor","_descriptor2","_descriptor3","_descriptor4","_exports","_inheritsLoose","_proto","prototype","onMetadataAvailable","content","createContent","getKpiPropertyExpression","view","propertyName","pathInModel","getLocalId","id","kpiModelName","getBindingExpressions","owner","_getOwner","metaModel","preprocessorContext","models","context","getContext","metaPath","kpiTitle","getProperty","text","undefined","tooltip","titleExpression","resolveBindingString","formatResult","kpiFormatters","labelFormat","String","hasUnit","tooltipFormat","controller","getRootController","getView","kpiTag","_jsx","KPITag","createId","status","press","event","kpiManagement","onKPIPressed","getSource","number","unit","BuildingBlock","_applyDecoratedDescriptor","configurable","enumerable","writable","initializer"],"sourceRoot":".","sources":["AnalyticalKPITag.tsx"],"sourcesContent":["import type { BindingToolkitExpression } from \"sap/fe/base/BindingToolkit\";\nimport { formatResult, pathInModel, resolveBindingString } from \"sap/fe/base/BindingToolkit\";\nimport type { PropertiesOf } from \"sap/fe/base/ClassSupport\";\nimport { defineUI5Class, property } from \"sap/fe/base/ClassSupport\";\nimport BuildingBlock from \"sap/fe/core/buildingBlocks/BuildingBlock\";\nimport kpiFormatters from \"sap/fe/core/formatters/KPIFormatter\";\nimport type ListReportController from \"sap/fe/templates/ListReport/ListReportController.controller\";\nimport type Event from \"sap/ui/base/Event\";\nimport type { PropertyBindingInfo } from \"sap/ui/base/ManagedObject\";\nimport type { $ControlSettings } from \"sap/ui/core/Control\";\nimport type View from \"sap/ui/core/mvc/View\";\nimport type MetaDataModel from \"sap/ui/model/odata/v4/ODataModel\";\nimport KPITag from \"../KPITag\";\n\n/**\n * A building block used to display a KPI in the Analytical List Page\n *\n */\n@defineUI5Class(\"sap.fe.macros.kpiTag.AnalyticalKPITag\")\nexport default class AnalyticalKPITag extends BuildingBlock<KPITag> {\n\t/**\n\t * The ID of the KPI\n\t */\n\t@property({ type: \"string\", required: true })\n\tpublic id!: string;\n\n\t/**\n\t * Path to the DataPoint annotation of the KPI\n\t */\n\t@property({ type: \"string\", required: true })\n\tpublic metaPath!: string;\n\n\t/**\n\t * The name of the runtime model from where we fetch the KPI properties\n\t */\n\t@property({ type: \"string\", required: true })\n\tpublic kpiModelName!: string;\n\n\t/**\n\t * Set it to `true` if the KPI value has an associated currency or unit of measure\n\t */\n\t@property({ type: \"boolean\", required: false })\n\tpublic hasUnit?: boolean;\n\n\tconstructor(properties: $ControlSettings & PropertiesOf<AnalyticalKPITag>, others?: $ControlSettings) {\n\t\tsuper(properties, others);\n\t}\n\n\t/**\n\t * Handler for the onMetadataAvailable event.\n\t */\n\tonMetadataAvailable(): void {\n\t\tif (!this.content) {\n\t\t\tthis.content = this.createContent();\n\t\t}\n\t}\n\n\t/**\n\t * Creates a binding expression for a specific property in the KPI model.\n\t * @param view\n\t * @param propertyName This is the name of the property that finds the KPI data in the associated KPI model.\n\t * @returns A binding expression\n\t */\n\tgetKpiPropertyExpression(view: View, propertyName: string): BindingToolkitExpression<string> {\n\t\treturn pathInModel(`/${view.getLocalId(this.id) ?? this.id}/manifest/sap.card/data/json/${propertyName}`, this.kpiModelName);\n\t}\n\n\t/**\n\t * Creates binding expressions for the KPITag's text and tooltip.\n\t * @param view\n\t * @returns Object containing the binding expressions for the text and the tooltip\n\t */\n\tgetBindingExpressions(view: View): { text?: PropertyBindingInfo; tooltip?: PropertyBindingInfo } {\n\t\tconst owner = this._getOwner();\n\t\tconst metaModel = owner?.preprocessorContext?.models.metaModel as MetaDataModel;\n\t\tconst context = metaModel.getContext(this.metaPath);\n\t\tconst kpiTitle = context.getProperty(\"Title\");\n\n\t\tif (!kpiTitle) {\n\t\t\treturn { text: undefined, tooltip: undefined };\n\t\t}\n\n\t\tconst titleExpression = resolveBindingString<string>(kpiTitle);\n\t\treturn {\n\t\t\ttext: formatResult([titleExpression], kpiFormatters.labelFormat) as PropertyBindingInfo,\n\t\t\ttooltip: formatResult(\n\t\t\t\t[\n\t\t\t\t\ttitleExpression,\n\t\t\t\t\tthis.getKpiPropertyExpression(view, \"mainValueUnscaled\"),\n\t\t\t\t\tthis.getKpiPropertyExpression(view, \"mainUnit\"),\n\t\t\t\t\tthis.getKpiPropertyExpression(view, \"mainCriticality\"),\n\t\t\t\t\tString(this.hasUnit)\n\t\t\t\t],\n\t\t\t\tkpiFormatters.tooltipFormat\n\t\t\t) as PropertyBindingInfo\n\t\t};\n\t}\n\n\tcreateContent(): KPITag {\n\t\tconst owner = this._getOwner();\n\t\tconst controller = owner?.getRootController() as ListReportController;\n\t\tconst view = controller?.getView() as View;\n\t\tconst { text, tooltip } = this.getBindingExpressions(view);\n\t\tconst kpiTag: KPITag = (\n\t\t\t<KPITag\n\t\t\t\tid={this.createId(\"_akt\")}\n\t\t\t\ttext={text}\n\t\t\t\tstatus={this.getKpiPropertyExpression(view, \"mainCriticality\") as PropertyBindingInfo}\n\t\t\t\ttooltip={tooltip}\n\t\t\t\tpress={async (event: Event): Promise<void> =>\n\t\t\t\t\tcontroller.kpiManagement.onKPIPressed(event.getSource(), view.getLocalId(this.id) ?? this.id)\n\t\t\t\t}\n\t\t\t\tnumber={this.getKpiPropertyExpression(view, \"mainValue\") as PropertyBindingInfo}\n\t\t\t\tunit={this.getKpiPropertyExpression(view, \"mainUnit\") as PropertyBindingInfo}\n\t\t\t/>\n\t\t);\n\t\treturn kpiTag;\n\t}\n}\n"],"mappings":"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","ignoreList":[],"file":"AnalyticalKPITag-dbg.js"}