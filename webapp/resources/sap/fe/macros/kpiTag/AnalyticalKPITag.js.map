{"version":3,"file":"AnalyticalKPITag.js","names":["AnalyticalKPITag","_dec","defineUI5Class","_dec2","property","type","required","_dec3","_dec4","_dec5","_class","_class2","_BuildingBlock","properties","others","_this","call","this","_initializerDefineProperty","_descriptor","_descriptor2","_descriptor3","_descriptor4","_exports","_inheritsLoose","_proto","prototype","onMetadataAvailable","content","createContent","getKpiPropertyExpression","view","propertyName","pathInModel","getLocalId","id","kpiModelName","getBindingExpressions","owner","_getOwner","metaModel","preprocessorContext","models","context","getContext","metaPath","kpiTitle","getProperty","text","undefined","tooltip","titleExpression","resolveBindingString","formatResult","kpiFormatters","labelFormat","String","hasUnit","tooltipFormat","controller","getRootController","getView","kpiTag","_jsx","KPITag","createId","status","press","async","kpiManagement","onKPIPressed","event","getSource","number","unit","BuildingBlock","_applyDecoratedDescriptor","configurable","enumerable","writable","initializer"],"sources":["./AnalyticalKPITag.tsx"],"sourcesContent":["import type { BindingToolkitExpression } from \"sap/fe/base/BindingToolkit\";\nimport { formatResult, pathInModel, resolveBindingString } from \"sap/fe/base/BindingToolkit\";\nimport type { PropertiesOf } from \"sap/fe/base/ClassSupport\";\nimport { defineUI5Class, property } from \"sap/fe/base/ClassSupport\";\nimport BuildingBlock from \"sap/fe/core/buildingBlocks/BuildingBlock\";\nimport kpiFormatters from \"sap/fe/core/formatters/KPIFormatter\";\nimport type ListReportController from \"sap/fe/templates/ListReport/ListReportController.controller\";\nimport type Event from \"sap/ui/base/Event\";\nimport type { PropertyBindingInfo } from \"sap/ui/base/ManagedObject\";\nimport type { $ControlSettings } from \"sap/ui/core/Control\";\nimport type View from \"sap/ui/core/mvc/View\";\nimport type MetaDataModel from \"sap/ui/model/odata/v4/ODataModel\";\nimport KPITag from \"../KPITag\";\n\n/**\n * A building block used to display a KPI in the Analytical List Page\n *\n */\n@defineUI5Class(\"sap.fe.macros.kpiTag.AnalyticalKPITag\")\nexport default class AnalyticalKPITag extends BuildingBlock<KPITag> {\n\t/**\n\t * The ID of the KPI\n\t */\n\t@property({ type: \"string\", required: true })\n\tpublic id!: string;\n\n\t/**\n\t * Path to the DataPoint annotation of the KPI\n\t */\n\t@property({ type: \"string\", required: true })\n\tpublic metaPath!: string;\n\n\t/**\n\t * The name of the runtime model from where we fetch the KPI properties\n\t */\n\t@property({ type: \"string\", required: true })\n\tpublic kpiModelName!: string;\n\n\t/**\n\t * Set it to `true` if the KPI value has an associated currency or unit of measure\n\t */\n\t@property({ type: \"boolean\", required: false })\n\tpublic hasUnit?: boolean;\n\n\tconstructor(properties: $ControlSettings & PropertiesOf<AnalyticalKPITag>, others?: $ControlSettings) {\n\t\tsuper(properties, others);\n\t}\n\n\t/**\n\t * Handler for the onMetadataAvailable event.\n\t */\n\tonMetadataAvailable(): void {\n\t\tif (!this.content) {\n\t\t\tthis.content = this.createContent();\n\t\t}\n\t}\n\n\t/**\n\t * Creates a binding expression for a specific property in the KPI model.\n\t * @param view\n\t * @param propertyName This is the name of the property that finds the KPI data in the associated KPI model.\n\t * @returns A binding expression\n\t */\n\tgetKpiPropertyExpression(view: View, propertyName: string): BindingToolkitExpression<string> {\n\t\treturn pathInModel(`/${view.getLocalId(this.id) ?? this.id}/manifest/sap.card/data/json/${propertyName}`, this.kpiModelName);\n\t}\n\n\t/**\n\t * Creates binding expressions for the KPITag's text and tooltip.\n\t * @param view\n\t * @returns Object containing the binding expressions for the text and the tooltip\n\t */\n\tgetBindingExpressions(view: View): { text?: PropertyBindingInfo; tooltip?: PropertyBindingInfo } {\n\t\tconst owner = this._getOwner();\n\t\tconst metaModel = owner?.preprocessorContext?.models.metaModel as MetaDataModel;\n\t\tconst context = metaModel.getContext(this.metaPath);\n\t\tconst kpiTitle = context.getProperty(\"Title\");\n\n\t\tif (!kpiTitle) {\n\t\t\treturn { text: undefined, tooltip: undefined };\n\t\t}\n\n\t\tconst titleExpression = resolveBindingString<string>(kpiTitle);\n\t\treturn {\n\t\t\ttext: formatResult([titleExpression], kpiFormatters.labelFormat) as PropertyBindingInfo,\n\t\t\ttooltip: formatResult(\n\t\t\t\t[\n\t\t\t\t\ttitleExpression,\n\t\t\t\t\tthis.getKpiPropertyExpression(view, \"mainValueUnscaled\"),\n\t\t\t\t\tthis.getKpiPropertyExpression(view, \"mainUnit\"),\n\t\t\t\t\tthis.getKpiPropertyExpression(view, \"mainCriticality\"),\n\t\t\t\t\tString(this.hasUnit)\n\t\t\t\t],\n\t\t\t\tkpiFormatters.tooltipFormat\n\t\t\t) as PropertyBindingInfo\n\t\t};\n\t}\n\n\tcreateContent(): KPITag {\n\t\tconst owner = this._getOwner();\n\t\tconst controller = owner?.getRootController() as ListReportController;\n\t\tconst view = controller?.getView() as View;\n\t\tconst { text, tooltip } = this.getBindingExpressions(view);\n\t\tconst kpiTag: KPITag = (\n\t\t\t<KPITag\n\t\t\t\tid={this.createId(\"_akt\")}\n\t\t\t\ttext={text}\n\t\t\t\tstatus={this.getKpiPropertyExpression(view, \"mainCriticality\") as PropertyBindingInfo}\n\t\t\t\ttooltip={tooltip}\n\t\t\t\tpress={async (event: Event): Promise<void> =>\n\t\t\t\t\tcontroller.kpiManagement.onKPIPressed(event.getSource(), view.getLocalId(this.id) ?? this.id)\n\t\t\t\t}\n\t\t\t\tnumber={this.getKpiPropertyExpression(view, \"mainValue\") as PropertyBindingInfo}\n\t\t\t\tunit={this.getKpiPropertyExpression(view, \"mainUnit\") as PropertyBindingInfo}\n\t\t\t/>\n\t\t);\n\t\treturn kpiTag;\n\t}\n}\n"],"mappings":"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","ignoreList":[]}