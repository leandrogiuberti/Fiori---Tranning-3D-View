/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)
 *      (c) Copyright 2009-2025 SAP SE. All rights reserved
 */
sap.ui.define(["sap/base/Log","sap/fe/base/ClassSupport","sap/m/FlexBox","sap/m/Label","sap/m/library","sap/ui/core/Control","sap/ui/core/format/NumberFormat","sap/ui/model/odata/v4/ODataListBinding","sap/ui/model/odata/v4/ODataMetaModel","sap/ui/model/type/Date"],function(e,t,i,r,a,n,o,l,s,u){"use strict";var c,f,g,h,p,m,d,b,y,C,P,L,v,A,_,w,M,T,V,z,O,x,B,D,N,R,I,E,S,F,$,j,q;var U=t.property;var k=t.event;var Y=t.defineUI5Class;var G=t.aggregation;function X(e,t,i,r){i&&Object.defineProperty(e,t,{enumerable:i.enumerable,configurable:i.configurable,writable:i.writable,value:i.initializer?i.initializer.call(r):void 0})}function H(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e,Q(e,t)}function Q(e,t){return Q=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},Q(e,t)}function J(e,t,i,r,a){var n={};return Object.keys(r).forEach(function(e){n[e]=r[e]}),n.enumerable=!!n.enumerable,n.configurable=!!n.configurable,("value"in n||n.initializer)&&(n.writable=!0),n=i.slice().reverse().reduce(function(i,r){return r(e,t,i)||i},n),a&&void 0!==n.initializer&&(n.value=n.initializer?n.initializer.call(a):void 0,n.initializer=void 0),void 0===n.initializer?(Object.defineProperty(e,t,n),null):n}function K(e,t){throw Error("Decorating class property failed. Please ensure that transform-class-properties is enabled and runs after the decorators transform.")}const W=a.ValueColor;let Z=(c=Y("sap.fe.macros.microchart.MicroChartContainer"),f=U({type:"boolean",defaultValue:false}),g=U({type:"string",defaultValue:undefined}),h=U({type:"string[]",defaultValue:[]}),p=U({type:"string",defaultValue:undefined}),m=U({type:"string[]",defaultValue:[]}),d=U({type:"int",defaultValue:undefined}),b=U({type:"int",defaultValue:1}),y=U({type:"int",defaultValue:undefined}),C=U({type:"string",defaultValue:""}),P=U({type:"string",defaultValue:""}),L=U({type:"string",defaultValue:""}),v=k(),A=G({type:"sap.ui.core.Control",multiple:false,isDefault:true}),_=G({type:"sap.m.Label",multiple:false}),w=G({type:"sap.ui.core.Control",multiple:true}),c(M=(T=function(t){function a(e,i){var r;r=t.call(this,e,i)||this;X(r,"showOnlyChart",V,r);X(r,"uomPath",z,r);X(r,"measures",O,r);X(r,"dimension",x,r);X(r,"dataPointQualifiers",B,r);X(r,"measurePrecision",D,r);X(r,"measureScale",N,r);X(r,"dimensionPrecision",R,r);X(r,"chartTitle",I,r);X(r,"chartDescription",E,r);X(r,"calendarPattern",S,r);X(r,"onTitlePressed",F,r);X(r,"microChart",$,r);X(r,"_uomLabel",j,r);X(r,"microChartTitle",q,r);return r}H(a,t);a.render=function e(t,a){t.openStart("div",a);t.openEnd();if(!a.showOnlyChart){const e=a.microChartTitle;if(e){e.forEach(function(e){t.openStart("div");t.openEnd();t.renderControl(e);t.close("div")})}t.openStart("div");t.openEnd();const i=new r({text:a.chartDescription});t.renderControl(i);t.close("div")}const n=a.microChart;if(n){n.addStyleClass("sapUiTinyMarginTopBottom");t.renderControl(n);if(!a.showOnlyChart&&a.uomPath){const e=a._checkIfChartRequiresRuntimeLabels()?undefined:{text:{path:a.uomPath}},n=new r(e),o=new i({alignItems:"Start",justifyContent:"End",items:[n]});t.renderControl(o);a.setAggregation("_uomLabel",n)}}t.close("div")};var n=a.prototype;n.onBeforeRendering=function e(){const t=this._getListBindingForRuntimeLabels();if(t){t.detachEvent("change",this._setRuntimeChartLabelsAndUnitOfMeasure,this);this._olistBinding=undefined}};n.onAfterRendering=function e(){const t=this._getListBindingForRuntimeLabels();if(!this._checkIfChartRequiresRuntimeLabels()){return}if(t){t.attachEvent("change",undefined,this._setRuntimeChartLabelsAndUnitOfMeasure,this);this._olistBinding=t}};n.setShowOnlyChart=function e(t){if(!t&&this._olistBinding){this._setChartLabels()}this.setProperty("showOnlyChart",t,false)};n._checkIfChartRequiresRuntimeLabels=function e(){const t=this.microChart;if(t){return Boolean(t.isA("sap.suite.ui.microchart.AreaMicroChart")||t.isA("sap.suite.ui.microchart.ColumnMicroChart")||t.isA("sap.suite.ui.microchart.LineMicroChart")||t.isA("sap.suite.ui.microchart.ComparisonMicroChart"))}return false};n._checkForChartLabelAggregations=function e(){const t=this.microChart;if(t){return Boolean(t.isA("sap.suite.ui.microchart.AreaMicroChart")&&t.getAggregation("firstYLabel")&&t.getAggregation("lastYLabel")&&t.getAggregation("firstXLabel")&&t.getAggregation("lastXLabel")||t.isA("sap.suite.ui.microchart.ColumnMicroChart")&&t.getAggregation("leftTopLabel")&&t.getAggregation("rightTopLabel")&&t.getAggregation("leftBottomLabel")&&t.getAggregation("rightBottomLabel")||t.isA("sap.suite.ui.microchart.LineMicroChart"))}return false};n._getListBindingForRuntimeLabels=function e(){const t=this.microChart;let i;if(t){if(t.isA("sap.suite.ui.microchart.AreaMicroChart")){const e=t.getChart();i=e&&e.getBinding("points")}else if(t.isA("sap.suite.ui.microchart.ColumnMicroChart")){i=t.getBinding("columns")}else if(t.isA("sap.suite.ui.microchart.LineMicroChart")){const e=t.getLines();i=e&&e.length&&e[0].getBinding("points")}else if(t.isA("sap.suite.ui.microchart.ComparisonMicroChart")){i=t.getBinding("data")}}return i instanceof l?i:false};n._setRuntimeChartLabelsAndUnitOfMeasure=async function e(){const t=this._olistBinding,i=t?.getContexts(),r=this.measures,a=this.dimension,n=this.uomPath,o=this.microChart,l=this._uomLabel;if(l&&n&&i&&i.length&&!this.showOnlyChart){const e=await i[0].requestProperty(n);l.setText(e)}else if(l){l.setText("")}if(!this._checkForChartLabelAggregations()){return}if(!i||!i.length){this._setChartLabels();return}const s=i[0],u=i[i.length-1],c=[],f=o?.isA("sap.suite.ui.microchart.LineMicroChart"),g=await s.requestProperty(a),h=await u.requestProperty(a);let p,m,d={value:Infinity},b={value:-Infinity},y={value:Infinity},C={value:-Infinity};d=g==undefined?d:{context:s,value:g};b=h==undefined?b:{context:u,value:h};if(r?.length){for(let e=0;e<r.length;e++){const t=r[e];p=await s.requestProperty(t);m=await u.requestProperty(t);C=m>C.value?{context:u,value:m,index:f?e:0}:C;y=p<y.value?{context:s,value:p,index:f?e:0}:y;if(f){c.push(this._getCriticalityFromPoint({context:u,value:m,index:e}))}}}this._setChartLabels(y.value,C.value,d.value,b.value);if(f){const e=await Promise.all(c);if(e?.length){const t=o.getLines();t.forEach(function(t,i){t.setColor(e[i])})}}else{await this._setChartLabelsColors(C,y)}};n._setChartLabelsColors=async function e(t,i){const r=this.microChart;const a=await Promise.all([this._getCriticalityFromPoint(i),this._getCriticalityFromPoint(t)]);if(r?.isA("sap.suite.ui.microchart.AreaMicroChart")){r.getAggregation("firstYLabel").setProperty("color",a[0],true);r.getAggregation("lastYLabel").setProperty("color",a[1],true)}else if(r?.isA("sap.suite.ui.microchart.ColumnMicroChart")){r.getAggregation("leftTopLabel").setProperty("color",a[0],true);r.getAggregation("rightTopLabel").setProperty("color",a[1],true)}};n._setChartLabels=function e(t,i,r,a){const n=this.microChart;t=this._formatDateAndNumberValue(t,this.measurePrecision,this.measureScale);i=this._formatDateAndNumberValue(i,this.measurePrecision,this.measureScale);r=this._formatDateAndNumberValue(r,this.dimensionPrecision,undefined,this.calendarPattern);a=this._formatDateAndNumberValue(a,this.dimensionPrecision,undefined,this.calendarPattern);if(n?.isA("sap.suite.ui.microchart.AreaMicroChart")){n.getAggregation("firstYLabel").setProperty("label",t,false);n.getAggregation("lastYLabel").setProperty("label",i,false);n.getAggregation("firstXLabel").setProperty("label",r,false);n.getAggregation("lastXLabel").setProperty("label",a,false)}else if(n?.isA("sap.suite.ui.microchart.ColumnMicroChart")){n.getAggregation("leftTopLabel").setProperty("label",t,false);n.getAggregation("rightTopLabel").setProperty("label",i,false);n.getAggregation("leftBottomLabel").setProperty("label",r,false);n.getAggregation("rightBottomLabel").setProperty("label",a,false)}else if(n?.isA("sap.suite.ui.microchart.LineMicroChart")){n.setProperty("leftTopLabel",t,false);n.setProperty("rightTopLabel",i,false);n.setProperty("leftBottomLabel",r,false);n.setProperty("rightBottomLabel",a,false)}};n._getCriticalityFromPoint=async function e(t){if(t?.context){const e=this.getModel()&&this.getModel().getMetaModel(),i=this.dataPointQualifiers,r=e instanceof s&&t.context.getPath()&&e.getMetaPath(t.context.getPath());if(e&&typeof r==="string"){const a=await e.requestObject(`${r}/@${"com.sap.vocabularies.UI.v1.DataPoint"}${t.index!==undefined&&i[t.index]?`#${i[t.index]}`:""}`);if(a){let e=W.Neutral;const i=t.context;if(a.Criticality){e=this._criticality(a.Criticality,i)}else if(a.CriticalityCalculation){const r=a.CriticalityCalculation;const n=function(e){let t;if(e?.$Path){t=i.getObject(e.$Path)}else if(e?.hasOwnProperty("$Decimal")){t=e.$Decimal}return t};e=this._criticalityCalculation(r.ImprovementDirection.$EnumMember,t.value,n(r.DeviationRangeLowValue),n(r.ToleranceRangeLowValue),n(r.AcceptanceRangeLowValue),n(r.AcceptanceRangeHighValue),n(r.ToleranceRangeHighValue),n(r.DeviationRangeHighValue))}return e}}}return Promise.resolve(W.Neutral)};n._criticality=function t(i,r){let a,n;if(i.$Path){a=r.getObject(i.$Path);if(a==="Negative"||a.toString()==="1"){n=W.Error}else if(a==="Critical"||a.toString()==="2"){n=W.Critical}else if(a==="Positive"||a.toString()==="3"){n=W.Good}}else if(i.$EnumMember){a=i.$EnumMember;if(a.includes("com.sap.vocabularies.UI.v1.CriticalityType/Negative")){n=W.Error}else if(a.includes("com.sap.vocabularies.UI.v1.CriticalityType/Positive")){n=W.Good}else if(a.includes("com.sap.vocabularies.UI.v1.CriticalityType/Critical")){n=W.Critical}}if(n===undefined){e.warning("Case not supported, returning the default Value Neutral");return W.Neutral}return n};n._criticalityCalculation=function t(i,r,a,n,o,l,s,u){let c;a=a==undefined?-Infinity:a;n=n==undefined?a:n;o=o==undefined?n:o;u=u==undefined?Infinity:u;s=s==undefined?u:s;l=l==undefined?s:l;if(i.includes("Minimize")){if(r<=l){c=W.Good}else if(r<=s){c=W.Neutral}else if(r<=u){c=W.Critical}else{c=W.Error}}else if(i.includes("Maximize")){if(r>=o){c=W.Good}else if(r>=n){c=W.Neutral}else if(r>=a){c=W.Critical}else{c=W.Error}}else if(i.includes("Target")){if(r<=l&&r>=o){c=W.Good}else if(r>=n&&r<o||r>l&&r<=s){c=W.Neutral}else if(r>=a&&r<n||r>s&&r<=u){c=W.Critical}else{c=W.Error}}if(c===undefined){e.warning("Case not supported, returning the default Value Neutral");return W.Neutral}return c};n._formatDateAndNumberValue=function e(t,i,r,a){if(a){return this._getSemanticsValueFormatter(a).formatValue(t,"string")}else if(!isNaN(t)){return this._getLabelNumberFormatter(i,r).format(t)}return t};n._getSemanticsValueFormatter=function e(t){if(!this._oDateType){this._oDateType=new u({style:"short",source:{pattern:t}})}return this._oDateType};n._getLabelNumberFormatter=function e(t,i){return o.getFloatInstance({style:"short",showScale:true,precision:typeof t==="number"&&t||0,decimals:typeof i==="number"&&i||0})};n.getAccessibilityInfo=function e(){return this.microChart?.getAccessibilityInfo()};return a}(n),V=J(T.prototype,"showOnlyChart",[f],{configurable:true,enumerable:true,writable:true,initializer:null}),z=J(T.prototype,"uomPath",[g],{configurable:true,enumerable:true,writable:true,initializer:null}),O=J(T.prototype,"measures",[h],{configurable:true,enumerable:true,writable:true,initializer:null}),x=J(T.prototype,"dimension",[p],{configurable:true,enumerable:true,writable:true,initializer:null}),B=J(T.prototype,"dataPointQualifiers",[m],{configurable:true,enumerable:true,writable:true,initializer:null}),D=J(T.prototype,"measurePrecision",[d],{configurable:true,enumerable:true,writable:true,initializer:null}),N=J(T.prototype,"measureScale",[b],{configurable:true,enumerable:true,writable:true,initializer:null}),R=J(T.prototype,"dimensionPrecision",[y],{configurable:true,enumerable:true,writable:true,initializer:null}),I=J(T.prototype,"chartTitle",[C],{configurable:true,enumerable:true,writable:true,initializer:null}),E=J(T.prototype,"chartDescription",[P],{configurable:true,enumerable:true,writable:true,initializer:null}),S=J(T.prototype,"calendarPattern",[L],{configurable:true,enumerable:true,writable:true,initializer:null}),F=J(T.prototype,"onTitlePressed",[v],{configurable:true,enumerable:true,writable:true,initializer:null}),$=J(T.prototype,"microChart",[A],{configurable:true,enumerable:true,writable:true,initializer:null}),j=J(T.prototype,"_uomLabel",[_],{configurable:true,enumerable:true,writable:true,initializer:null}),q=J(T.prototype,"microChartTitle",[w],{configurable:true,enumerable:true,writable:true,initializer:null}),T))||M);return Z},false);
//# sourceMappingURL=MicroChartContainer.js.map