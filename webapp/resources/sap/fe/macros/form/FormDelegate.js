/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)
 *      (c) Copyright 2009-2025 SAP SE. All rights reserved
 */
sap.ui.define(["sap/fe/macros/CommonHelper","sap/fe/macros/DelegateUtil","sap/ui/model/ListBinding","sap/ui/model/json/JSONModel"],function(e,t,o,a){"use strict";const n={createLayout:async function(o){const n=o.modifier,i=o.appComponent?.getMetaModel(),r=o.element;if(n.targets==="xmlTree"){const e=o.view?.getElementsByTagNameNS("sap.fe.macros","Field");if(e){for(const t of Array.from(e)){if(t.getAttribute("_flexId")===o.fieldSelector?.id){return Promise.reject(new Error("FormDelegate.createLayout: field already exists"))}}}}else if(n.targets==="jsControlTree"){if(o.fieldSelector?.id&&o.view&&o.view.byId(o.fieldSelector?.id)){return Promise.reject(new Error("FormDelegate.createLayout: field already exists"))}}const s=await t.getCustomDataWithModifier(r,"metaPath",n)??"";const c=o.parentSelector?o.modifier.bySelector(o.parentSelector,o.appComponent,o.view):undefined;const l=c?await t.getCustomDataWithModifier(c,"navigationPath",n):"";let d=s.substring(0,s.indexOf("@"));d=l?`${d}${l}/`:d;const m=i?.getMetaContext(d.substring(0,d.length-1));const f=i?.createBindingContext(`${d}${o.bindingPath}`);async function u(s,c,l){const d=await t.getCustomDataWithModifier(r,"onChange",n);const u=await t.getCustomDataWithModifier(r,"displayMode",n);const p=new a({_flexId:o.fieldSelector?.id,onChange:e.removeEscapeCharacters(d),displayMode:e.removeEscapeCharacters(u),navigationPath:l});const g={bindingContexts:{entitySet:m,dataField:f,this:p.createBindingContext("/")},models:{this:p,entitySet:i,metaModel:i,dataField:i},appComponent:o.appComponent};return t.templateControlFragment(s,g,{view:c},n)}const p=await u("sap.fe.macros.form.FormElementFlexibility",o.view,l);return{control:p}},getPropertyInfo:async function(e){function t(e){if(e&&e.$Type){if(e.$Type.toLowerCase().indexOf("edm")!==0){return true}}return false}function a(e,t){return t.some(function(t){return e.startsWith(t)})}function n(e,n,i,r,s,c,l){const d={name:e,bindingPath:e,entityType:r};const m=i["@com.sap.vocabularies.UI.v1.DataFieldDefault"];const f=m&&m.Label||i["@com.sap.vocabularies.Common.v1.Label"];d.label=f||"[LABEL_MISSING: "+e+"]";const u=i["@com.sap.vocabularies.UI.v1.Hidden"];d.hideFromReveal=u;if(u&&u.$Path){d.hideFromReveal=s.getBindingContext()?.getProperty(u.$Path)}if(!d.hideFromReveal){d.hideFromReveal=i["@com.sap.vocabularies.UI.v1.AdaptationHidden"]}let p;if(!d.hideFromReveal){p=i["@com.sap.vocabularies.Common.v1.FieldControl"];if(p){d.hideFromReveal=p.$EnumMember==="com.sap.vocabularies.Common.v1.FieldControlType/Hidden"}}p=i["@com.sap.vocabularies.Common.v1.FieldControl"];const g=p&&p.$Path;if(g&&!d.hideFromReveal){const e=s.getBinding(c)instanceof o;if(!e){const e=s.getBindingContext()?.getProperty(g);d.hideFromReveal=e===0}}if(m&&(m.$Type==="com.sap.vocabularies.UI.v1.DataFieldForAction"||m.$Type==="com.sap.vocabularies.UI.v1.DataFieldForIntentBasedNavigation"||m.$Type==="com.sap.vocabularies.UI.v1.DataFieldWithAction"||m.$Type==="com.sap.vocabularies.UI.v1.DataFieldWithIntentBasedNavigation")){d.unsupported=true}if(a(e,l)||t(n)){d.unsupported=true}return d}function i(e,t,o,a,i){const r=[];let s="";const c=[];let l;for(s in e){l=e[s];if(l.$kind==="NavigationProperty"){c.push(s)}}for(s in e){l=e[s];if(l.$kind==="Property"){const e=o.getObject("/"+t+"/"+s+"@");const d=n(s,l,e,t,a,i,c);r.push(d)}}return r}function r(e,t){if(t.path){return t.path}const o=e.getBindingContext();if(o){if(e.data("navigationPath")){return o.getPath()+"/"+e.data("navigationPath")}return o.getPath()}}async function s(e,t,o){const a=e.getModel(o.modelName);if(a){if(a.isA("sap.ui.model.odata.v4.ODataModel")){const n=a.getMetaModel();const s=r(e,o);if(s){const o=n.getMetaContext(s);const a=o.getObject();const r=o.getObject(a.$Type);return i(r,a.$Type,n,e,t)}}}return Promise.resolve([])}return Promise.resolve().then(async function(){return s(e.element,e.aggregationName,e.payload)})}};return n},false);
//# sourceMappingURL=FormDelegate.js.map