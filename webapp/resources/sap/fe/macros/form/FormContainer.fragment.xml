<core:FragmentDefinition
	xmlns="sap.m"
	xmlns:f="sap.ui.layout.form"
	xmlns:macro="sap.fe.macros"
	xmlns:macroForm="sap.fe.macros.form"
	xmlns:internalMacro="sap.fe.macros.internal"
	xmlns:core="sap.ui.core"
	xmlns:controls="sap.fe.macros.controls"
	xmlns:dt="sap.ui.dt"
	xmlns:macrodata="http://schemas.sap.com/sapui5/extension/sap.ui.core.CustomData/1"
	xmlns:fpm="sap.fe.macros.fpm"
	xmlns:template="http://schemas.sap.com/sapui5/extension/sap.ui.core.template/1"
	template:require="{
		MODEL: 'sap/ui/model/odata/v4/AnnotationHelper',
		ID: 'sap/fe/core/helpers/StableIdHelper',
		COMMON: 'sap/fe/macros/CommonHelper',
		FORM: 'sap/fe/macros/form/FormHelper',
		UI: 'sap/fe/core/templating/UIFormatters',
		DataField: 'sap/fe/core/templating/DataFieldFormatters',
		FieldTemplating: 'sap/fe/macros/field/FieldTemplating',
		Property: 'sap/fe/core/templating/PropertyFormatters',
		FIELD: 'sap/fe/macros/field/FieldHelper',
		MACRO: 'sap/fe/macros/MacroTemplating'
	}"
>
	<f:FormContainer
		core:require="{FormContainerRuntime: 'sap/fe/macros/form/FormContainerAPI'}"
		dt:designtime="{this>designtimeSettings}"
		id="{= ${this>id} || undefined}"
		visible="{this>visible}"
		macrodata:navigationPath="{this>navigationPath}"
		macrodata:etName="{contextPath>./@sapui.name}"
		macrodata:UiHiddenPresent="{this>hasUiHiddenAnnotation}"
	>
		<template:if test="{this>title}">
			<f:title>
				<core:Title level="{this>titleLevel}" text="{this>title}" />
			</f:title>
		</template:if>

		<template:if test="{actions>}">
			<template:then>
				<f:toolbar>
					<OverflowToolbar
						id="{= ${this>id} ? ID.generate([${this>id}, 'FormActionsToolbar']) : undefined}"
						binding="{= FORM.generateBindingExpression(${this>navigationPath},${contextPath>@@UI.getDataModelObjectPath})}"
					>
						<Title level="{this>titleLevel}" text="{this>title}" />
						<ToolbarSpacer />
						<template:repeat list="{actions>}" var="action">
							<core:Fragment fragmentName="sap.fe.macros.form.FormActionButtons" type="XML" />
						</template:repeat>
					</OverflowToolbar>
				</f:toolbar>
			</template:then>
		</template:if>
		<f:dependents>
			<macroForm:FormContainerAPI formContainerId="{this>id}" showDetails="{internal>showDetails}" />
		</f:dependents>
		<f:formElements>
			<template:with path="dataFieldCollection>" var="formElements">
				<template:if test="{= ${formElements>0/annotationPath}.indexOf('com.sap.vocabularies.UI.v1.DataPoint') > -1 }">
					<template:then>
						<template:with path="formElements>0/annotationPath" var="dataPoint">
							<f:FormElement
								dt:designtime="{= ${dataPoint>Value/$Path@com.sap.vocabularies.UI.v1.AdaptationHidden} ? 'not-adaptable-tree' :  'sap/fe/macros/form/FormElement.designtime' }"
								id="{= ${this>id} ? ID.generate([${this>id}, 'FormElement', ${dataPoint>@@UI.getDataModelObjectPath}]) : undefined}"
								label="{dataPoint>@@FIELD.computeLabelText}"
								visible="{= FieldTemplating.getVisibleExpression(${dataPoint>@@UI.getDataModelObjectPath})}"
								binding="{= FORM.generateBindingExpression(${this>navigationPath},${contextPath>@@UI.getDataModelObjectPath})}"
							>
								<f:fields>
									<macro:Field
										idPrefix="{= ${this>id} ? ID.generate([${this>id}, 'FormElement', ${dataPoint>@@UI.getDataModelObjectPath}]) : '' }"
										vhIdPrefix="{= ${this>id} ? ID.generate([${this>id}, 'FieldValueHelp']) : ''}"
										contextPath="{contextPath>@@COMMON.getMetaPath}"
										metaPath="{dataPoint>@@COMMON.getMetaPath}"
										editMode="{= ${this>displayMode} === 'true' ? 'Display' : undefined}"
										onChange="{this>onChange}"
									>
										<formatOptions textAlignMode="Form" showEmptyIndicator="true" />
									</macro:Field>
								</f:fields>
							</f:FormElement>
						</template:with>
					</template:then>
					<template:elseif
						test="{= ${formElements>0/annotationPath}.indexOf('com.sap.vocabularies.Communication.v1.Contact') > -1 }"
					>
						<template:with path="formElements>0/annotationPath" var="metaPath">
							<f:FormElement
								dt:designtime="{= ${metaPath>./@com.sap.vocabularies.UI.v1.AdaptationHidden} ? 'not-adaptable-tree' :  'sap/fe/macros/form/FormElement.designtime' }"
								binding="{= FORM.generateBindingExpression(${this>navigationPath},${contextPath>@@UI.getDataModelObjectPath})}"
							>
								<f:label>
									<Label
										text="{metaPath>fn/$Path@com.sap.vocabularies.Common.v1.Label}"
										visible="{= FieldTemplating.getVisibleExpression(${dataField>@@UI.getDataModelObjectPath})}"
									>
										<layoutData>
											<f:ColumnElementData cellsLarge="12" />
										</layoutData>
									</Label>
								</f:label>
								<f:fields>
									<macro:Contact
										metaPath="{metaPath>@@COMMON.getMetaPath}"
										contextPath="{contextPath>@@COMMON.getMetaPath}"
										visible="true"
									/>
								</f:fields>
							</f:FormElement>
						</template:with>
					</template:elseif>
					<template:else>
						<template:repeat list="{path: 'formElements>'}" var="dataField">
							<template:if test="{= ${dataField>type} === 'Annotation'}">
								<template:then>
									<template:with path="dataField>annotationPath" var="annotationDataField">
										<template:if test="{annotationDataField>Target@@DataField.isSemanticallyConnectedFields}">
											<template:then>
												<f:FormElement
													dt:designtime="{= ${annotationDataField>Value/$Path@com.sap.vocabularies.UI.v1.AdaptationHidden} ? 'not-adaptable-tree' : 'sap/fe/macros/form/FormElement.designtime' }"
													id="{= ${this>id} ? ID.generate([${this>id}, 'SemanticFormElement', ${annotationDataField>@@UI.getDataModelObjectPath}]) : '' }"
													visible="{= (${dataField>isPartOfPreview}) ? FieldTemplating.visibleExpressionsForConnectedFieldsFormElement(${annotationDataField>@@UI.getDataModelObjectPath}) : '{= ${internal>showDetails} === true}'}"
													binding="{= FORM.generateBindingExpression(${this>navigationPath},${contextPath>@@UI.getDataModelObjectPath})}"
												>
													<f:label>
														<Label
															text="{annotationDataField>@@FIELD.computeLabelText}"
															id="{= ${this>id} ? ID.generate([${this>id}, 'SemanticFormElementLabel', ${annotationDataField>@@UI.getDataModelObjectPath}]) : '' }"
														/>
													</f:label>
													<f:fields>
														<controls:FieldWrapper
															required="{= UI.getRequiredExpressionForConnectedDataField(${annotationDataField>Target@@UI.getDataModelObjectPath}) }"
														>
															<HBox wrap="Wrap">
																<template:repeat
																	list="{annotationDataField>Target/$AnnotationPath/Data}"
																	var="data"
																>
																	<template:with
																		path="data>"
																		helper="COMMON.getDataFromTemplate"
																		var="element"
																	>
																		<core:Fragment
																			fragmentName="sap.fe.macros.internal.field.ConnectedDataField"
																			type="XML"
																		/>
																	</template:with>
																</template:repeat>
															</HBox>
														</controls:FieldWrapper>
													</f:fields>
												</f:FormElement>
											</template:then>
											<template:elseif
												test="{= ${annotationDataField>Value} &amp;&amp; ${annotationDataField>Value/$Path} &amp;&amp; UI.isMultiValueField(${annotationDataField>Value@@Property.getPropertyObjectPath})}"
											>
												<f:FormElement
													xmlns:macros="sap.fe.macros"
													xmlns:multivaluefield="sap.fe.macros.multivaluefield"
													dt:designtime="{= ${annotationDataField>Value/$Path@com.sap.vocabularies.UI.v1.AdaptationHidden} ? 'not-adaptable-tree' :  'sap/fe/macros/form/FormElement.designtime' }"
													id="{= ${this>id} ? ID.generate([${this>id}, 'FormElement', ${annotationDataField>@@UI.getDataModelObjectPath}]) : undefined }"
													label="{annotationDataField>@@FIELD.computeLabelText}"
													visible="{= (${dataField>isPartOfPreview}) ? FieldTemplating.getVisibleExpression(${annotationDataField>@@UI.getDataModelObjectPath}) : '{= ${internal>showDetails} === true}'}"
													binding="{= FORM.generateBindingExpression(${this>navigationPath},${contextPath>@@UI.getDataModelObjectPath})}"
												>
													<f:fields>
														<macros:MultiValueField
															id="{= ${this>id} ? ID.generate([${this>id}, 'FormElement', ${annotationDataField>@@UI.getDataModelObjectPath}, 'MultiValueField']) : undefined }"
															vhIdPrefix="{= ${this>id} ? ID.generate([${this>id}, 'FieldValueHelp']) : '' }"
															contextPath="{= ${contextPath>@@MACRO.getPath} }"
															metaPath="{= ${annotationDataField>@@MACRO.getPath} }"
														>
															<macros:formatOptions>
																<multivaluefield:FormatOptions showEmptyIndicator="true" />
															</macros:formatOptions>
														</macros:MultiValueField>
													</f:fields>
												</f:FormElement>
											</template:elseif>

											<template:elseif test="{annotationDataField>Target@@DataField.isFieldGroup}">
												<f:FormElement
													dt:designtime="{= ${annotationDataField>Value/$Path@com.sap.vocabularies.UI.v1.AdaptationHidden} ? 'not-adaptable-tree' : 'sap/fe/macros/form/FormElement.designtime' }"
													id="{= ${this>id} ? ID.generate([${this>id}, 'FieldGroupFormElement', ${annotationDataField>@@UI.getDataModelObjectPath}]) : '' }"
													visible="{= (${dataField>isPartOfPreview}) ? FieldTemplating.visibleExpressionsForConnectedFieldsFormElement(${annotationDataField>@@UI.getDataModelObjectPath}) : '{= ${internal>showDetails} === true}'}"
													binding="{= FORM.generateBindingExpression(${this>navigationPath},${contextPath>@@UI.getDataModelObjectPath})}"
												>
													<f:label>
														<Label
															text="{annotationDataField>@@FIELD.computeLabelText}"
															id="{= ${this>id} ? ID.generate([${this>id}, 'FieldGroupFormElementLabel', ${annotationDataField>@@UI.getDataModelObjectPath}]) : '' }"
														/>
													</f:label>
													<f:fields>
														<controls:RequiredFlexBox>
															<FlexBox
																direction="{= ${dataField>formatOptions/fieldGroupHorizontalLayout} ? 'Row' : 'Column'}"
																wrap="Wrap"
																columnGap="1rem"
															>
																<items>
																	<template:repeat
																		list="{annotationDataField>Target/$AnnotationPath/Data}"
																		var="element"
																	>
																		<template:if test="{element>@@DataField.isBooleanFieldGroupItem}">
																			<core:Fragment
																				fragmentName="sap.fe.macros.internal.field.CheckBoxGroup"
																				type="XML"
																			/>
																		</template:if>
																	</template:repeat>
																</items>
															</FlexBox>
														</controls:RequiredFlexBox>
													</f:fields>
												</f:FormElement>
											</template:elseif>

											<template:else>
												<f:FormElement
													dt:designtime="{= ${annotationDataField>Value/$Path@com.sap.vocabularies.UI.v1.AdaptationHidden} ? 'not-adaptable-tree' :  'sap/fe/macros/form/FormElement.designtime' }"
													id="{= ${this>id} ? ID.generate([${this>id}, 'FormElement', ${annotationDataField>@@UI.getDataModelObjectPath}]) : undefined }"
													label="{annotationDataField>@@FIELD.computeLabelText}"
													visible="{= (${dataField>isPartOfPreview}) ? FieldTemplating.getVisibleExpression(${annotationDataField>@@UI.getDataModelObjectPath}) : '{= ${internal>showDetails} === true}'}"
													binding="{= FORM.generateBindingExpression(${this>navigationPath},${contextPath>@@UI.getDataModelObjectPath})}"
												>
													<f:fields>
														<macro:Field
															idPrefix="{= ${this>id} ? ID.generate([${this>id}, 'FormElement', ${annotationDataField>@@UI.getDataModelObjectPath}]) : '' }"
															vhIdPrefix="{= ${this>id} ? ID.generate([${this>id}, 'FieldValueHelp']) : '' }"
															contextPath="{contextPath>@@COMMON.getMetaPath}"
															metaPath="{annotationDataField>@@COMMON.getMetaPath}"
															onChange="{this>onChange}"
															readOnly="{dataField>readOnly}"
															semanticObject="{dataField>semanticObject}"
														>
															<formatOptions
																textLinesEdit="{dataField>formatOptions/textLinesEdit}"
																textMaxLines="{dataField>formatOptions/textMaxLines}"
																textMaxLength="{dataField>formatOptions/textMaxLength}"
																textMaxCharactersDisplay="{dataField>formatOptions/textMaxCharactersDisplay}"
																textExpandBehaviorDisplay="{dataField>formatOptions/textExpandBehaviorDisplay}"
																textAlignMode="Form"
																showEmptyIndicator="true"
																fieldEditStyle="{dataField>formatOptions/fieldEditStyle}"
																radioButtonsHorizontalLayout="{dataField>formatOptions/radioButtonsHorizontalLayout}"
																dateTimePattern="{dataField>formatOptions/pattern}"
																useRadioButtonsForBoolean="{dataField>formatOptions/useRadioButtonsForBoolean}"
															/>
														</macro:Field>
													</f:fields>
												</f:FormElement>
											</template:else>
										</template:if>
									</template:with>
								</template:then>
								<template:elseif test="{= ${dataField>type} === 'Default'}">
									<f:FormElement
										dt:designtime="{= ${dataField>Value/$Path@com.sap.vocabularies.UI.v1.AdaptationHidden} ? 'not-adaptable-tree' :  'sap/fe/macros/form/FormElement.designtime' }"
										id="{= ${this>id} ? ID.generate([${this>id}, ${dataField>id}]) : '' }"
										label="{dataField>label}"
										visible="{dataField>visible}"
										binding="{= FORM.generateBindingExpression(${this>navigationPath},${contextPath>@@UI.getDataModelObjectPath})}"
									>
										<f:fields>
											<macroForm:CustomFormElement
												metaPath="{dataField>propertyPath}"
												contextPath="{contextPath>@@COMMON.getMetaPath}"
												formElementKey="{= ID.generate([${this>id}, ${dataField>key}]) }"
											>
												<fpm:CustomFragment
													id="{= ID.generate([${this>id}, ${dataField>key}]) }"
													fragmentName="{dataField>template}"
													contextPath="{entitySet>}"
												/>
											</macroForm:CustomFormElement>
										</f:fields>
									</f:FormElement>
								</template:elseif>
								<template:elseif test="{= ${dataField>type} === 'Slot'}">
									<!-- ui5lint-disable-next-line parsing-error -->
									<slot name="{dataField>key}" />
								</template:elseif>
							</template:if>
						</template:repeat>
					</template:else>
				</template:if>
			</template:with>
		</f:formElements>
	</f:FormContainer>
</core:FragmentDefinition>
