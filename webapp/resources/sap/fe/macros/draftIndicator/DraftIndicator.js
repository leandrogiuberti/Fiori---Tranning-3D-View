/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)
 *      (c) Copyright 2009-2025 SAP SE. All rights reserved
 */
sap.ui.define(["sap/base/strings/formatMessage","sap/fe/base/BindingToolkit","sap/fe/base/ClassSupport","sap/fe/core/CommonUtils","sap/fe/core/buildingBlocks/BuildingBlock","sap/fe/core/helpers/BindingHelper","sap/m/Button","sap/m/ObjectMarker","sap/m/Popover","sap/m/Text","sap/m/VBox","sap/m/library","sap/ui/core/Lib","sap/fe/base/jsx-runtime/jsx","sap/fe/base/jsx-runtime/jsxs"],function(e,t,i,a,r,n,s,o,l,c,d,p,f,u,D){"use strict";var A,b,v,y,h,T,g,_,I,O,m,P,E,B,C,M,x;var U={};var L=p.ObjectMarkerVisibility;var R=p.ObjectMarkerType;var N=n.UI;var F=n.Entity;var w=i.property;var V=i.defineUI5Class;var H=t.pathInModel;var j=t.or;var z=t.not;var k=t.isEmpty;var S=t.ifElse;var G=t.and;function J(e,t,i,a){i&&Object.defineProperty(e,t,{enumerable:i.enumerable,configurable:i.configurable,writable:i.writable,value:i.initializer?i.initializer.call(a):void 0})}function K(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e,X(e,t)}function X(e,t){return X=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},X(e,t)}function W(e,t,i,a,r){var n={};return Object.keys(a).forEach(function(e){n[e]=a[e]}),n.enumerable=!!n.enumerable,n.configurable=!!n.configurable,("value"in n||n.initializer)&&(n.writable=!0),n=i.slice().reverse().reduce(function(i,a){return a(e,t,i)||i},n),r&&void 0!==n.initializer&&(n.value=n.initializer?n.initializer.call(r):void 0,n.initializer=void 0),void 0===n.initializer?(Object.defineProperty(e,t,n),null):n}function Y(e,t){throw Error("Decorating class property failed. Please ensure that transform-class-properties is enabled and runs after the decorators transform.")}let q=(A=V("sap.fe.macros.draftIndicator.DraftIndicator"),b=w({type:"string"}),v=w({type:"string"}),y=w({type:"string",required:true}),h=w({type:"string"}),T=w({type:"boolean"}),g=w({type:"boolean"}),_=w({type:"string",allowedValues:["Inline","Overlay"]}),A(I=(O=function(t){function i(e,i){var a;a=t.call(this,e,i)||this;J(a,"id",m,a);J(a,"draftIndicatorType",P,a);J(a,"contextPath",E,a);J(a,"class",B,a);J(a,"usedInTable",C,a);J(a,"usedInAnalyticalTable",M,a);J(a,"reactiveAreaMode",x,a);return a}U=i;K(i,t);var r=i.prototype;r.setDraftIndicatorType=function e(t){if([L.IconOnly,L.IconAndText].includes(t)){this.setProperty("draftIndicatorType",t)}else{throw new Error(`Allowed value ${t} does not match`)}};r.addAriaLabelledByForDraftIndicator=function e(t){const i=this.content?.getAriaLabelledBy()??[];if(!i.includes(t)){this.content?.addAriaLabelledBy(t)}};r.onMetadataAvailable=function e(){if(!this.content){this.content=this.createContent()}};i.formatDraftOwnerTextInPopover=function e(t,i,a,r,n){const s=f.getResourceBundleFor("sap.fe.macros");if(!s){return""}if(t){const e=r||i||n||a;if(!e){return s.getText("M_FIELD_RUNTIME_DRAFT_POPOVER_UNSAVED_CHANGES_BY_UNKNOWN")}else{return i?s.getText("M_FIELD_RUNTIME_DRAFT_POPOVER_LOCKED_BY_KNOWN",[e]):s.getText("M_FIELD_RUNTIME_DRAFT_POPOVER_UNSAVED_CHANGES_BY_KNOWN",[e])}}else{return s.getText("M_FIELD_RUNTIME_DRAFT_POPOVER_NO_DATA_TEXT")}};r.getDraftAdministrativeDataProperties=function e(){const t=this.getDataModelObjectPath(this.contextPath);const i=t?.targetEntityType.navigationProperties.find(e=>e.name==="DraftAdministrativeData");const a=i?.targetType.entityProperties;return a?.map(e=>e.name)};r.getPopoverTitleBindingExpression=function e(){return S(z(F.IsActive),this.isHiddenDraftEnabled?H("M_DRAFT_POPOVER_ADMIN_UNSAVED_OBJECT","sap.fe.i18n"):H("M_COMMON_DRAFT_OBJECT","sap.fe.i18n"),S(F.HasDraft,S(z(k(H("DraftAdministrativeData/InProcessByUser"))),H("M_COMMON_DRAFT_LOCKED_OBJECT","sap.fe.i18n"),H("M_DRAFT_POPOVER_ADMIN_UNSAVED_OBJECT","sap.fe.i18n")),this.draftIndicatorType===L.IconAndText?" ":H("C_DRAFT_POPOVER_ADMIN_DATA_DRAFTINFO_FLAGGED_OBJECT","sap.fe.i18n")))};r.getDraftOwnerTextBindingExpression=function e(){const t=this.getDraftAdministrativeDataProperties();const a=[{path:"HasDraftEntity",targetType:"any"},{path:"DraftAdministrativeData/InProcessByUser"},{path:"DraftAdministrativeData/LastChangedByUser"}];if(t?.includes("InProcessByUserDescription")){a.push({path:"DraftAdministrativeData/InProcessByUserDescription"})}if(t?.includes("LastChangedByUserDescription")){a.push({path:"DraftAdministrativeData/LastChangedByUserDescription"})}return{parts:a,formatter:i.formatDraftOwnerTextInPopover}};r.createPopover=function t(i){const r=G(z(F.IsActive),k(H("DraftAdministrativeData/LastChangeDateTime")));const n=this.draftIndicatorType===L.IconAndText?H("M_DRAFT_POPOVER_ADMIN_GENERIC_LOCKED_OBJECT_POPOVER_TEXT","sap.fe.i18n"):H("C_DRAFT_POPOVER_ADMIN_DATA_DRAFTINFO_POPOVER_NO_DATA_TEXT","sap.fe.i18n");const o=G(z(F.IsActive),z(k(H("DraftAdministrativeData/LastChangeDateTime"))));const p={parts:[{path:"M_DRAFT_POPOVER_ADMIN_LAST_CHANGE_TEXT",model:"sap.fe.i18n"},{path:"DraftAdministrativeData/LastChangeDateTime"}],formatter:e};const f=G(F.IsActive,z(k(H("DraftAdministrativeData/LastChangeDateTime"))));const A={...p};const b=u(l,{title:this.getPopoverTitleBindingExpression(),showHeader:true,verticalScrolling:false,class:"sapUiContentPadding",placement:"Auto",endButton:u(s,{icon:"sap-icon://decline",press:()=>{this.draftPopover?.close()}}),children:D(d,{class:"sapUiContentPadding",children:[u(d,{visible:r,children:u(c,{text:n})}),u(d,{visible:o,children:u(c,{text:p})}),D(d,{visible:f,children:[u(c,{text:this.getDraftOwnerTextBindingExpression()}),u(c,{class:"sapUiSmallMarginTop",text:A})]})]})});a.getTargetView(i).addDependent(b);return b};r.onObjectMarkerPressed=function e(t){const i=t.getSource();const a=i.getBindingContext();this.draftPopover??=this.createPopover(i);this.draftPopover.setBindingContext(a);this.draftPopover.openBy(i,false)};r.getIconAndTextAdditionalInfoBindingExpression=function e(){const t=this.getDraftAdministrativeDataProperties();const i=[];if(t?.includes("InProcessByUserDescription")){i.push(H("DraftAdministrativeData/InProcessByUserDescription"))}i.push(H("DraftAdministrativeData/InProcessByUser"));if(t?.includes("LastChangedByUserDescription")){i.push(H("DraftAdministrativeData/LastChangedByUserDescription"))}i.push(H("DraftAdministrativeData/LastChangedByUser"));return S(F.HasDraft,j(...i),"")};r.getIconAndTextContent=function e(){this.isHiddenDraftEnabled=this.getAppComponent()?.getEnvironmentCapabilities().getCapabilities().HiddenDraft?.enabled;const t=this.isHiddenDraftEnabled?R.Unsaved:R.Draft;const i=S(z(F.IsActive),t,S(F.HasDraft,S(H("DraftAdministrativeData/InProcessByUser"),R.LockedBy,S(H("DraftAdministrativeData/LastChangedByUser"),R.UnsavedBy,R.Unsaved)),R.Flagged));const a=S(z(F.HasDraft),L.TextOnly,L.IconAndText);return u(o,{type:i,press:this.onObjectMarkerPressed.bind(this),visibility:a,additionalInfo:this.getIconAndTextAdditionalInfoBindingExpression(),ariaLabelledBy:this.ariaLabelledBy?this.ariaLabelledBy:[],class:this.class,reactiveAreaMode:this.reactiveAreaMode})};r.getIconOnlyContent=function e(){const t=S(z(F.IsActive),R.Draft,S(F.HasDraft,S(!!this.usedInAnalyticalTable,R.Locked,S(H("DraftAdministrativeData/InProcessByUser"),R.Locked,R.Unsaved)),R.Flagged));let i;if(this.usedInTable===true){i=j(z(F.IsActive),G(F.IsActive,F.HasDraft))}else{i=G(z(k(F.HasDraft)),z(N.IsEditable),F.HasDraft,z(H("DraftAdministrativeData/DraftIsCreatedByMe")))}return u(o,{type:t,press:!this.usedInAnalyticalTable?this.onObjectMarkerPressed.bind(this):undefined,visibility:L.IconOnly,visible:i,ariaLabelledBy:this.ariaLabelledBy?this.ariaLabelledBy:[],class:this.class,reactiveAreaMode:this.reactiveAreaMode})};r.createContent=function e(){if(this.draftIndicatorType===L.IconAndText){return this.getIconAndTextContent()}else{return this.getIconOnlyContent()}};return i}(r),m=W(O.prototype,"id",[b],{configurable:true,enumerable:true,writable:true,initializer:null}),P=W(O.prototype,"draftIndicatorType",[v],{configurable:true,enumerable:true,writable:true,initializer:function(){return L.IconAndText}}),E=W(O.prototype,"contextPath",[y],{configurable:true,enumerable:true,writable:true,initializer:null}),B=W(O.prototype,"class",[h],{configurable:true,enumerable:true,writable:true,initializer:function(){return""}}),C=W(O.prototype,"usedInTable",[T],{configurable:true,enumerable:true,writable:true,initializer:null}),M=W(O.prototype,"usedInAnalyticalTable",[g],{configurable:true,enumerable:true,writable:true,initializer:null}),x=W(O.prototype,"reactiveAreaMode",[_],{configurable:true,enumerable:true,writable:true,initializer:null}),O))||I);U=q;return U},false);
//# sourceMappingURL=DraftIndicator.js.map