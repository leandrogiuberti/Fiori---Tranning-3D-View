{"version":3,"file":"StateHelper.js","names":["StateHelper","getSelectionVariant","control","controlState","StateUtil","retrieveExternalState","controlObject","filter","parameters","getParent","isA","getParameters","undefined","selectionVariant","StateFiltersToSelectionVariant","getSelectionVariantFromConditions","getPropertyHelper","externalSV","SelectionVariant","selectOptions","_getSelectOptions","property","massAddSelectOption","split","error","id","getId","message","Error","String","Log","convertSelectionVariantToStateFilters","prefillDescriptions","model","propertyInfos","this","_getSupportedFilterFields","length","filterBarInfoForConversion","_getControlInfoForConversion","metaModel","getMetaModel","copyofPropertyInfos","JSON","parse","stringify","updatedPropertyInfos","_updatePropertyInfoToSupportSV","conditions","svToStateFilters","getStateFiltersFromSV","getModel","contextPath","data","useSemanticDateRange","viewDataInstance","viewData","getData","config","controlConfiguration","selectionFieldsConfigs","filterFieldsConfig","filterFields","waitForInitialization","getControlDelegate","fetchFilterProperties","awaitControlDelegate","fetchProperties","clearFilterValues","controlInstance","_clearFilterValuesWithOptions","content","fireEvent","options","state","editStatePath","currentEditStateCondition","editStateDefaultValue","currentEditStateIsDefault","shouldClearEditFilter","DraftEditState","ALL","deepClone","values","Object","keys","clearEditFilter","conditionPath","condition","filtered","applyExternalState","cleanUpAllFilterFieldsInErrorState","forEach","propertyInfo","name","metadataPath","PropertyHelper","hasValueHelp","getProperty","typeConfig","className","path","getPropertyDataModel","targetObject","dataType","setSelectionVariantToMdcControl","arguments","stateToApply","getStateToApply","convertConditionsForChart","diffState","applyStateResult","err","assign","items","propertyObj"],"sources":["./StateHelper.ts"],"sourcesContent":["import Log from \"sap/base/Log\";\nimport deepClone from \"sap/base/util/deepClone\";\nimport type { ViewData } from \"sap/fe/core/services/TemplatedViewServiceFactory\";\nimport * as PropertyHelper from \"sap/fe/core/templating/PropertyHelper\";\nimport DraftEditState from \"sap/fe/macros/filterBar/DraftEditState\";\nimport type FilterBarAPI from \"sap/fe/macros/filterBar/FilterBarAPI\";\nimport type { PropertyInfo } from \"sap/fe/macros/internal/PropertyInfo\";\nimport type { ConversionInfo } from \"sap/fe/macros/mdc/adapter/SelectionVariantToStateFilters\";\nimport svToStateFilters from \"sap/fe/macros/mdc/adapter/SelectionVariantToStateFilters\";\nimport StateFiltersToSelectionVariant from \"sap/fe/macros/mdc/adapter/StateFilterToSelectionVariant\";\nimport type { ExternalStateType } from \"sap/fe/macros/valuehelp/ValueHelpDelegate\";\nimport SelectionVariant from \"sap/fe/navigation/SelectionVariant\";\nimport type CoreControl from \"sap/ui/core/Control\";\nimport type Chart from \"sap/ui/mdc/Chart\";\nimport type Control from \"sap/ui/mdc/Control\";\nimport type FilterBar from \"sap/ui/mdc/FilterBar\";\nimport type Table from \"sap/ui/mdc/Table\";\nimport type { StateToApply, Filter as StateUtilFilter } from \"sap/ui/mdc/p13n/StateUtil\";\nimport StateUtil from \"sap/ui/mdc/p13n/StateUtil\";\nimport type Model from \"sap/ui/model/Model\";\nimport type JSONModel from \"sap/ui/model/json/JSONModel\";\nimport type ODataMetaModel from \"sap/ui/model/odata/v4/ODataMetaModel\";\nimport type ChartType from \"../../Chart\";\nimport type MacroAPI from \"../../MacroAPI\";\n\n/**\n * This is to extend MDC control APIs for filter, table, chart building blocks.\n * @public\n */\n\nconst StateHelper = {\n\t/**\n\t * Gets selection variant from the mdc control.\n\t * @param control The control for which Selection Variant is to be fetched\n\t * @returns A promise which resolves with a {@link sap.fe.navigation.SelectionVariant}\n\t * @public\n\t */\n\tasync getSelectionVariant(control: CoreControl | undefined): Promise<SelectionVariant> {\n\t\ttry {\n\t\t\tconst controlState = await StateUtil.retrieveExternalState(control as Control);\n\t\t\tconst controlObject = controlState.filter as StateUtilFilter;\n\t\t\tlet parameters: string[] | undefined = [];\n\t\t\tif (\n\t\t\t\tcontrol?.getParent()?.isA(\"sap.fe.macros.filterBar.FilterBarAPI\") &&\n\t\t\t\t(control.getParent() as FilterBarAPI).getParameters !== undefined\n\t\t\t) {\n\t\t\t\tparameters = (control.getParent() as FilterBarAPI).getParameters();\n\t\t\t}\n\t\t\tconst selectionVariant = StateFiltersToSelectionVariant.getSelectionVariantFromConditions(\n\t\t\t\tcontrolObject,\n\t\t\t\t(control as Control).getPropertyHelper(),\n\t\t\t\tparameters\n\t\t\t);\n\t\t\tif (control?.isA(\"sap.ui.mdc.Chart\")) {\n\t\t\t\tconst externalSV = new SelectionVariant();\n\t\t\t\tconst selectOptions = selectionVariant._getSelectOptions();\n\t\t\t\tfor (const property in selectOptions) {\n\t\t\t\t\texternalSV.massAddSelectOption(property.split(\"_fe_groupable_\")[1], selectOptions[property]);\n\t\t\t\t}\n\t\t\t\treturn externalSV;\n\t\t\t} else {\n\t\t\t\treturn selectionVariant;\n\t\t\t}\n\t\t} catch (error: unknown) {\n\t\t\tconst id: string | undefined = control?.getId();\n\t\t\tconst message = error instanceof Error ? error.message : String(error);\n\t\t\tLog.error(`Building Block (${id}) - get selection variant failed : ${message}`);\n\t\t\tthrow Error(message);\n\t\t}\n\t},\n\n\t/**\n\t * Convert selection variant to conditions.\n\t * @param control Control can be a table, chart or filter bar\n\t * @param selectionVariant The selection variant to apply to the table or chart or filter bar.\n\t * @param prefillDescriptions If true, we try to find the associated Text value for each property in the selectionVariant (to avoid fetching it from the server)\n\t * @param model The control model\n\t * @returns A promise resolving to conditions\n\t */\n\tasync convertSelectionVariantToStateFilters(\n\t\tcontrol: Control,\n\t\tselectionVariant: SelectionVariant,\n\t\tprefillDescriptions: boolean,\n\t\tmodel?: Model\n\t): Promise<StateUtilFilter> {\n\t\t// Note: This method is private and restricted to usage by sap.fe(ViewState controller extension) for filter bar/ chart / table state scenarios.\n\t\tconst propertyInfos = await this._getSupportedFilterFields(control);\n\n\t\tif (!propertyInfos.length) {\n\t\t\tthrow new Error(\"No valid metadata properties present for filter bar\");\n\t\t}\n\n\t\tconst filterBarInfoForConversion = this._getControlInfoForConversion(control);\n\t\tconst metaModel = model?.getMetaModel() as ODataMetaModel;\n\t\tconst copyofPropertyInfos = JSON.parse(JSON.stringify(propertyInfos));\n\t\tconst updatedPropertyInfos = this._updatePropertyInfoToSupportSV(control, copyofPropertyInfos);\n\t\tconst conditions: StateUtilFilter = svToStateFilters.getStateFiltersFromSV(\n\t\t\tselectionVariant,\n\t\t\tfilterBarInfoForConversion,\n\t\t\tupdatedPropertyInfos ?? copyofPropertyInfos,\n\t\t\tprefillDescriptions,\n\t\t\tmetaModel\n\t\t);\n\n\t\treturn conditions;\n\t},\n\n\t/**\n\t * Get the filter information needed for the conversion of selection variant to conditions.\n\t * @param control This can be a table, chart, or filterbar\n\t * @returns The control information (metaModel, contextPath, use of semantic date range, all filter fields config)\n\t */\n\t_getControlInfoForConversion(control: Control): ConversionInfo {\n\t\tconst metaModel = control.getModel()?.getMetaModel() as ODataMetaModel,\n\t\t\tcontextPath = control.data(\"entityType\") as string;\n\t\tif (control.isA(\"sap.fe.macros.controls.FilterBar\")) {\n\t\t\tconst useSemanticDateRange: boolean =\n\t\t\t\t\tcontrol.data(\"useSemanticDateRange\") === \"true\" || control.data(\"useSemanticDateRange\") === true,\n\t\t\t\tviewDataInstance = control.getModel(\"viewData\") as JSONModel,\n\t\t\t\tviewData = viewDataInstance.getData() as ViewData,\n\t\t\t\tconfig = viewData?.controlConfiguration,\n\t\t\t\tselectionFieldsConfigs = config?.[\"@com.sap.vocabularies.UI.v1.SelectionFields\"],\n\t\t\t\tfilterFieldsConfig = selectionFieldsConfigs?.filterFields;\n\t\t\treturn { metaModel, contextPath, useSemanticDateRange, filterFieldsConfig, selectionFieldsConfigs };\n\t\t} else {\n\t\t\treturn { metaModel, contextPath };\n\t\t}\n\t},\n\n\t/**\n\t * Get supported filter field properties from the table, chart, or filter bar.\n\t * @param control Control can be a table, chart, or filter bar\n\t * @returns Supported filter fields.\n\t */\n\tasync _getSupportedFilterFields(control: Control): Promise<ControlPropertyInfo[]> {\n\t\tif (control.isA(\"sap.ui.mdc.Filterbar\")) {\n\t\t\tawait (control as FilterBar).waitForInitialization();\n\t\t\treturn (control as FilterBar).getControlDelegate().fetchFilterProperties(control);\n\t\t} else if ((control as FilterBar).isA(\"sap.fe.macros.controls.FilterBar\")) {\n\t\t\treturn (control as FilterBar).getControlDelegate().fetchFilterProperties(control);\n\t\t} else {\n\t\t\tawait (control as Table | Chart).awaitControlDelegate();\n\t\t}\n\t\treturn (control as Table | Chart | FilterBar).getControlDelegate().fetchProperties(control);\n\t},\n\n\t/**\n\t * Clears all input values of visible filter fields in the table, chart, or filter bar..\n\t * @param controlInstance This can be a filter bar, chart, or table.\n\t */\n\tasync clearFilterValues(controlInstance: MacroAPI): Promise<void> {\n\t\tawait this._clearFilterValuesWithOptions(controlInstance.content as Control);\n\t\t// Allow app developers to update filters after clearing\n\t\tcontrolInstance.fireEvent(\"afterClear\");\n\t},\n\n\t/**\n\t * Clears all input values of visible filter fields in the table, chart, or filter bar.\n\t * @param control This can be a table, chart, or filter bar\n\t * @param options Options for filtering the filter bar\n\t * @param options.clearEditFilter Whether to clear the edit filter or retain the default value 'All'\n\t */\n\tasync _clearFilterValuesWithOptions(control: Control, options?: { clearEditFilter: boolean }): Promise<void> {\n\t\tif (!control) {\n\t\t\treturn;\n\t\t}\n\t\tconst state: ExternalStateType = await StateUtil.retrieveExternalState(control);\n\t\tlet editStatePath = \"\",\n\t\t\tcurrentEditStateCondition,\n\t\t\teditStateDefaultValue,\n\t\t\tcurrentEditStateIsDefault: boolean | undefined,\n\t\t\tshouldClearEditFilter: undefined | boolean;\n\t\tif (control.isA<FilterBar>(\"sap.ui.mdc.FilterBar\")) {\n\t\t\teditStatePath = \"$editState\";\n\t\t\teditStateDefaultValue = DraftEditState.ALL.id;\n\t\t\tcurrentEditStateCondition = deepClone(state.filter[editStatePath]?.[0]);\n\t\t\tcurrentEditStateIsDefault = currentEditStateCondition?.values[0] === editStateDefaultValue;\n\t\t\tshouldClearEditFilter = options && Object.keys(options).length > 0 && options.clearEditFilter;\n\t\t}\n\n\t\t// Clear all conditions\n\t\tfor (const conditionPath of Object.keys(state.filter)) {\n\t\t\tif (!shouldClearEditFilter && conditionPath === editStatePath && currentEditStateIsDefault) {\n\t\t\t\t// Do not clear edit state condition if it is already \"ALL\"\n\t\t\t\tcontinue;\n\t\t\t}\n\t\t\tfor (const condition of state.filter[conditionPath]) {\n\t\t\t\tcondition.filtered = false;\n\t\t\t}\n\t\t}\n\t\tawait StateUtil.applyExternalState(control, { filter: state.filter });\n\n\t\tif (control.isA<FilterBar>(\"sap.ui.mdc.FilterBar\")) {\n\t\t\t// Set edit state to 'ALL' if it wasn't before\n\t\t\tif (!shouldClearEditFilter && currentEditStateCondition && !currentEditStateIsDefault) {\n\t\t\t\tcurrentEditStateCondition.values = [editStateDefaultValue];\n\t\t\t\tawait StateUtil.applyExternalState(control, { filter: { [editStatePath]: [currentEditStateCondition] } });\n\t\t\t}\n\n\t\t\t//clear filter fields in error state\n\t\t\tcontrol.cleanUpAllFilterFieldsInErrorState();\n\t\t}\n\t},\n\n\t/**\n\t * Method returns the copy of propertyInfo by adding necessary fields so that selection variant can be set to a control like table and chart.\n\t * @param control This could be a table, chart, or filter bar\n\t * @param propertyInfos Array of PropertyInfo of the control\n\t * @returns The deep clone of propertyInfos with some additional fields\n\t */\n\t_updatePropertyInfoToSupportSV(control: Control, propertyInfos: ControlPropertyInfo[]): ControlPropertyInfo[] {\n\t\tif (control.isA(\"sap.ui.mdc.FilterBar\")) {\n\t\t\treturn propertyInfos;\n\t\t}\n\t\tpropertyInfos.forEach((propertyInfo: ControlPropertyInfo) => {\n\t\t\tif ((control as Control).isA(\"sap.ui.mdc.Table\")) {\n\t\t\t\tpropertyInfo[\"conditionPath\"] = propertyInfo.name;\n\t\t\t\tpropertyInfo[\"annotationPath\"] = propertyInfo.metadataPath ? propertyInfo.metadataPath : \"\";\n\t\t\t\tpropertyInfo[\"hasValueHelp\"] = PropertyHelper.hasValueHelp(\n\t\t\t\t\t(control as Table).getPropertyHelper().getProperty(propertyInfo.name)\n\t\t\t\t);\n\t\t\t\tpropertyInfo[\"dataType\"] = propertyInfo?.typeConfig?.className as string;\n\t\t\t} else if ((control as Control).isA(\"sap.ui.mdc.Chart\")) {\n\t\t\t\tif (propertyInfo.path) {\n\t\t\t\t\tpropertyInfo[\"name\"] = propertyInfo.path;\n\t\t\t\t\tpropertyInfo[\"conditionPath\"] = propertyInfo.path;\n\t\t\t\t\tconst property = ((control as Chart).getParent() as ChartType)?.getPropertyDataModel(propertyInfo.path)?.targetObject;\n\t\t\t\t\tpropertyInfo[\"hasValueHelp\"] = property ? PropertyHelper.hasValueHelp(property) : false;\n\t\t\t\t\tpropertyInfo[\"dataType\"] = (propertyInfo?.typeConfig?.className as string) || propertyInfo.dataType;\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t\treturn propertyInfos;\n\t},\n\n\t/**\n\t * Sets selection variant to the table. Note: setSelectionVariant will clear the existing filters and then apply the SelectionVariant values.\n\t * @param controlInstance This could be a table, chart, or filter bar\n\t * @param selectionVariant The selection variant to apply to the respective mdc controls\n\t * @param prefillDescriptions Optional. If true, we will use the associated text property values (if they're available in the selectionVariant) to display the filter value descriptions, instead of loading them from the backend\n\t * @returns A promise for asynchronous handling\n\t * @public\n\t */\n\tasync setSelectionVariantToMdcControl(\n\t\tcontrolInstance: CoreControl | undefined,\n\t\tselectionVariant: SelectionVariant,\n\t\tprefillDescriptions = false\n\t): Promise<{ diffState: ExternalStateType; applyStateResult: unknown } | undefined> {\n\t\ttry {\n\t\t\tconst state: ExternalStateType = await StateUtil.retrieveExternalState(controlInstance as Control);\n\t\t\tif (!state.filter) {\n\t\t\t\tLog.error(`FE : setSelectionVariant API cannot be applied on : ${controlInstance?.getId()}`);\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tconst conditions: StateUtilFilter = await this.convertSelectionVariantToStateFilters(\n\t\t\t\tcontrolInstance as Control,\n\t\t\t\tselectionVariant,\n\t\t\t\tprefillDescriptions,\n\t\t\t\tcontrolInstance?.getModel()\n\t\t\t);\n\n\t\t\t// Clear filter of table before applying selection variant\n\t\t\tawait this.clearFilterValues(controlInstance?.getParent() as MacroAPI);\n\n\t\t\t// State to apply\n\t\t\tconst propertyInfos = await this._getSupportedFilterFields(controlInstance as Control);\n\t\t\tconst stateToApply = svToStateFilters.getStateToApply(propertyInfos, conditions);\n\t\t\tif (controlInstance?.isA(\"sap.ui.mdc.Chart\")) {\n\t\t\t\tthis.convertConditionsForChart(stateToApply);\n\t\t\t}\n\t\t\tconst diffState: ExternalStateType = await StateUtil.diffState(controlInstance as Control, state, stateToApply);\n\t\t\tconst applyStateResult = await StateUtil.applyExternalState(controlInstance as Control, stateToApply);\n\t\t\treturn {\n\t\t\t\tdiffState,\n\t\t\t\tapplyStateResult\n\t\t\t};\n\t\t} catch (err: unknown) {\n\t\t\tconst id: string | undefined = controlInstance?.getId();\n\t\t\tconst message = err instanceof Error ? err.message : String(err);\n\t\t\tLog.error(`FE : BuildingBlock (${id}) - set selection variant failed  : ${message}`);\n\t\t\tthrow Error(message);\n\t\t}\n\t},\n\t/**\n\t * Convert the chart properties to internal properties before applying the conditions.\n\t * @param stateToApply This contains the information regarding filter and conditions\n\t */\n\tconvertConditionsForChart(stateToApply: StateToApply): void {\n\t\t// replace keys of filter object from \"SalesOder\" to internal format \"_fe_groupable_SalesOrder\"\n\t\tfor (const property in stateToApply.filter) {\n\t\t\tdelete Object.assign(stateToApply.filter, { [\"_fe_groupable_\" + property]: stateToApply.filter[property] })[property];\n\t\t}\n\t\t// replace keys of items array from \"SalesOder\" to internal format \"_fe_groupable_SalesOrder\"\n\t\tstateToApply.items.forEach((propertyObj: { name: string }) => {\n\t\t\tpropertyObj.name = \"_fe_groupable_\" + propertyObj.name;\n\t\t});\n\t}\n};\n\nexport type ControlPropertyInfo = PropertyInfo & {\n\tconditionPath: string;\n\tdataType: string;\n\tannotationPath?: string;\n\tmetadataPath?: string;\n\tisParameter?: boolean;\n\thiddenFilter?: boolean;\n\thasValueHelp?: boolean;\n\trequired?: boolean;\n};\n\nexport default StateHelper;\n"],"mappings":"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","ignoreList":[]}