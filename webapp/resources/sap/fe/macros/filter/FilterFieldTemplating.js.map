{"version":3,"file":"FilterFieldTemplating.js","names":["getDisplayProperty","propertyObjectPath","propertyConverted","hasValueHelp","getDisplayMode","_exports","getFilterFieldDisplayFormat","async","propertyInterface","oTextAnnotation","annotations","Common","Text","bHasValueHelp","entityTextArrangement","targetEntityType","UI","TextArrangement","_getDisplayModeFromValueHelp","Interface","context","metaModel","getModel","requestValueListInfo","getPath","then","valueListInfo","firstKey","Object","keys","firstValueListInfo","valueListParameter","Parameters","find","element","LocalDataProperty","$PropertyPath","targetObject","name","valueListProperty","ValueListProperty","MetaModelConverter","getInvolvedDataModelObjects","createBindingContext","CollectionPath"],"sources":["./FilterFieldTemplating.ts"],"sourcesContent":["import type { DataModelObjectPath } from \"sap/fe/core/templating/DataModelPathHelper\";\nimport { hasValueHelp } from \"sap/fe/core/templating/PropertyHelper\";\nimport { getDisplayMode } from \"sap/fe/core/templating/UIFormatters\";\n\nimport type { Property } from \"@sap-ux/vocabularies-types\";\nimport * as MetaModelConverter from \"sap/fe/core/converters/MetaModelConverter\";\nimport type { ComputedAnnotationInterface } from \"sap/fe/core/templating/UIFormatters\";\nimport type Context from \"sap/ui/model/odata/v4/Context\";\nimport type ODataMetaModel from \"sap/ui/model/odata/v4/ODataMetaModel\";\nimport type { ValueListInfo } from \"sap/ui/model/odata/v4/ODataMetaModel\";\n\nexport const getDisplayProperty = function (propertyObjectPath: DataModelObjectPath<Property>, propertyConverted: Property): string {\n\treturn hasValueHelp(propertyConverted) ? getDisplayMode(propertyObjectPath) : \"Value\";\n};\n\nexport const getFilterFieldDisplayFormat = async function (\n\tpropertyObjectPath: DataModelObjectPath<Property>,\n\tpropertyConverted: Property,\n\tpropertyInterface: ComputedAnnotationInterface\n): Promise<string> {\n\tconst oTextAnnotation = propertyConverted?.annotations?.Common?.Text;\n\tif (oTextAnnotation) {\n\t\t// The text annotation should be on the property defined\n\t\treturn getDisplayProperty(propertyObjectPath, propertyConverted);\n\t}\n\tconst bHasValueHelp = hasValueHelp(propertyConverted);\n\tif (bHasValueHelp) {\n\t\t// Exceptional case for missing text annotation on the property (retrieve text from value list)\n\t\t// Consider TextArrangement at EntityType otherwise set default display format 'DescriptionValue'\n\t\tconst entityTextArrangement = propertyObjectPath?.targetEntityType?.annotations?.UI?.TextArrangement;\n\t\treturn entityTextArrangement\n\t\t\t? getDisplayMode(propertyObjectPath)\n\t\t\t: _getDisplayModeFromValueHelp(propertyInterface, propertyObjectPath);\n\t}\n\treturn \"Value\";\n};\n\n/**\n * Method to determine the display mode from the value help.\n * @param Interface The current templating context\n * @param propertyObjectPath The global path to reach the entitySet\n * @returns A promise with the string 'DescriptionValue' or 'Value', depending on whether a text annotation exists for the property in the value help\n * Hint: A text arrangement is consciously ignored. If the text is retrieved from the value help, the text arrangement of the value help property isnÂ´t considered. Instead, the default text arrangement #TextFirst\n * is used.\n */\nexport async function _getDisplayModeFromValueHelp(\n\tInterface: ComputedAnnotationInterface,\n\tpropertyObjectPath: DataModelObjectPath<Property>\n): Promise<string> {\n\tconst context = Interface.context as unknown as Context;\n\tconst metaModel = Interface.context.getModel() as ODataMetaModel;\n\n\treturn metaModel.requestValueListInfo(context.getPath(), true, context).then(function (valueListInfo) {\n\t\tconst firstKey = Object.keys(valueListInfo)[0];\n\t\tconst firstValueListInfo = valueListInfo[firstKey] as ValueListInfo;\n\t\tconst valueListParameter = firstValueListInfo.Parameters?.find((element) => {\n\t\t\treturn element.LocalDataProperty?.$PropertyPath === propertyObjectPath?.targetObject?.name;\n\t\t});\n\t\tconst valueListProperty = valueListParameter?.ValueListProperty;\n\t\tconst propertyConverted = MetaModelConverter.getInvolvedDataModelObjects<Property>(\n\t\t\tmetaModel.createBindingContext(\"/\" + firstValueListInfo.CollectionPath + \"/\" + valueListProperty)!\n\t\t);\n\t\treturn getDisplayMode(propertyConverted);\n\t});\n}\n"],"mappings":";;;;4NAWO,MAAMA,EAAqB,SAAUC,EAAmDC,GAC9F,OAAOC,EAAaD,GAAqBE,EAAeH,GAAsB,OAC/E,EAAEI,EAAAL,qBAEK,MAAMM,EAA8BC,eAC1CN,EACAC,EACAM,GAEA,MAAMC,EAAkBP,GAAmBQ,aAAaC,QAAQC,KAChE,GAAIH,EAAiB,CAEpB,OAAOT,EAAmBC,EAAoBC,EAC/C,CACA,MAAMW,EAAgBV,EAAaD,GACnC,GAAIW,EAAe,CAGlB,MAAMC,EAAwBb,GAAoBc,kBAAkBL,aAAaM,IAAIC,gBACrF,OAAOH,EACJV,EAAeH,GACfiB,EAA6BV,EAAmBP,EACpD,CACA,MAAO,OACR,EAEAI,EAAAC,8BAQOC,eAAeW,EACrBC,EACAlB,GAEA,MAAMmB,EAAUD,EAAUC,QAC1B,MAAMC,EAAYF,EAAUC,QAAQE,WAEpC,OAAOD,EAAUE,qBAAqBH,EAAQI,UAAW,KAAMJ,GAASK,KAAK,SAAUC,GACtF,MAAMC,EAAWC,OAAOC,KAAKH,GAAe,GAC5C,MAAMI,EAAqBJ,EAAcC,GACzC,MAAMI,EAAqBD,EAAmBE,YAAYC,KAAMC,GACxDA,EAAQC,mBAAmBC,gBAAkBnC,GAAoBoC,cAAcC,MAEvF,MAAMC,EAAoBR,GAAoBS,kBAC9C,MAAMtC,EAAoBuC,EAAmBC,4BAC5CrB,EAAUsB,qBAAqB,IAAMb,EAAmBc,eAAiB,IAAML,IAEhF,OAAOnC,EAAeF,EACvB,EACD,CAACG,EAAAa,+BAAA,OAAAb,CAAA","ignoreList":[]}