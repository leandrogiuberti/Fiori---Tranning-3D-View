{"version":3,"file":"ChartRuntime.js","names":["ChartRuntime","fnUpdateChart","oEvent","oInnerChart","getSource","oMdcChart","getParent","sActionsMultiselectDisabled","oActionOperationAvailableMap","aActionsMultiselectDisabled","getCustomData","forEach","oCustomData","getKey","DelegateUtil","customData","getValue","split","oInternalModelContext","getBindingContext","aSelectedContexts","oModelObject","aSelectedDataPoints","ChartUtils","getChartSelectedData","i","length","push","context","setProperty","getModel","getPath","getSelectedDataPoints","count","j","oSelectedContext","oContextData","getObject","key","indexOf","sActionPath","substring","ActionRuntime","setActionEnablement","sAction"],"sources":["./ChartRuntime.ts"],"sourcesContent":["import type Chart from \"sap/chart/Chart\";\nimport ActionRuntime from \"sap/fe/core/ActionRuntime\";\nimport type { InternalModelContext } from \"sap/fe/core/helpers/ModelHelper\";\nimport ChartUtils from \"sap/fe/macros/chart/ChartUtils\";\nimport DelegateUtil from \"sap/fe/macros/DelegateUtil\";\nimport type UI5Event from \"sap/ui/base/Event\";\nimport type Control from \"sap/ui/mdc/Control\";\n\ntype InnerChart = Control & Chart & { getParent: Function; getCustomData: Function };\ntype MDCChart = Control;\ntype ObjectWithCount = object & { count: number };\ninterface BooleanMap {\n\t[key: string]: boolean;\n}\n\n/**\n * Static class used by MDC_Chart during runtime\n * @private\n */\nconst ChartRuntime = {\n\t/**\n\t * Updates the chart after selection or deselection of data points.\n\t * @param oEvent Chart event\n\t */\n\tfnUpdateChart: function (oEvent: UI5Event<{}, InnerChart>): void {\n\t\tconst oInnerChart = oEvent.getSource();\n\t\tconst oMdcChart = oInnerChart.getParent() as MDCChart;\n\t\tlet sActionsMultiselectDisabled,\n\t\t\toActionOperationAvailableMap: Record<string, string> = {},\n\t\t\taActionsMultiselectDisabled: string[] = [];\n\t\t// changing drill stack changes order of custom data, looping through all\n\t\toMdcChart.getCustomData().forEach(function (oCustomData) {\n\t\t\tif (oCustomData.getKey() === \"operationAvailableMap\") {\n\t\t\t\toActionOperationAvailableMap = DelegateUtil.getCustomData<{ customData: Record<string, string> }>(\n\t\t\t\t\toMdcChart,\n\t\t\t\t\t\"operationAvailableMap\"\n\t\t\t\t)!.customData;\n\t\t\t} else if (oCustomData.getKey() === \"multiSelectDisabledActions\") {\n\t\t\t\tsActionsMultiselectDisabled = oCustomData.getValue();\n\t\t\t\taActionsMultiselectDisabled = sActionsMultiselectDisabled ? sActionsMultiselectDisabled.split(\",\") : [];\n\t\t\t}\n\t\t});\n\t\tconst oInternalModelContext = oMdcChart.getBindingContext(\"internal\") as InternalModelContext;\n\n\t\tconst aSelectedContexts = [];\n\t\tlet oModelObject: BooleanMap | undefined;\n\t\tconst aSelectedDataPoints = ChartUtils.getChartSelectedData(oInnerChart);\n\t\tfor (let i = 0; i < aSelectedDataPoints.length; i++) {\n\t\t\taSelectedContexts.push(aSelectedDataPoints[i].context);\n\t\t}\n\t\toInternalModelContext.setProperty(\"selectedContexts\", aSelectedContexts);\n\t\toInternalModelContext\n\t\t\t.getModel()\n\t\t\t.setProperty(\n\t\t\t\t`${oInternalModelContext.getPath()}/numberOfSelectedContexts`,\n\t\t\t\t(oInnerChart.getSelectedDataPoints() as ObjectWithCount).count\n\t\t\t);\n\t\tfor (let j = 0; j < aSelectedContexts.length; j++) {\n\t\t\tconst oSelectedContext = aSelectedContexts[j];\n\t\t\tconst oContextData = oSelectedContext.getObject();\n\t\t\tfor (const key in oContextData) {\n\t\t\t\tif (key.indexOf(\"#\") === 0) {\n\t\t\t\t\tlet sActionPath = key;\n\t\t\t\t\tsActionPath = sActionPath.substring(1, sActionPath.length);\n\t\t\t\t\toModelObject = oInternalModelContext.getObject() as BooleanMap;\n\t\t\t\t\toModelObject[sActionPath] = true;\n\t\t\t\t\toInternalModelContext.setProperty(\"\", oModelObject);\n\t\t\t\t}\n\t\t\t}\n\t\t\toModelObject = oInternalModelContext.getObject() as BooleanMap;\n\t\t}\n\n\t\tActionRuntime.setActionEnablement(oInternalModelContext, oActionOperationAvailableMap, aSelectedContexts, \"chart\");\n\n\t\tif (aSelectedContexts.length > 1) {\n\t\t\taActionsMultiselectDisabled.forEach(function (sAction: string): void {\n\t\t\t\toInternalModelContext.setProperty(sAction, false);\n\t\t\t});\n\t\t}\n\t}\n};\n\nexport default ChartRuntime;\n"],"mappings":";;;;uIAmBA,MAAMA,EAAe,CAKpBC,cAAe,SAAUC,GACxB,MAAMC,EAAcD,EAAOE,YAC3B,MAAMC,EAAYF,EAAYG,YAC9B,IAAIC,EACHC,EAAuD,CAAC,EACxDC,EAAwC,GAEzCJ,EAAUK,gBAAgBC,QAAQ,SAAUC,GAC3C,GAAIA,EAAYC,WAAa,wBAAyB,CACrDL,EAA+BM,EAAaJ,cAC3CL,EACA,yBACEU,UACJ,MAAO,GAAIH,EAAYC,WAAa,6BAA8B,CACjEN,EAA8BK,EAAYI,WAC1CP,EAA8BF,EAA8BA,EAA4BU,MAAM,KAAO,EACtG,CACD,GACA,MAAMC,EAAwBb,EAAUc,kBAAkB,YAE1D,MAAMC,EAAoB,GAC1B,IAAIC,EACJ,MAAMC,EAAsBC,EAAWC,qBAAqBrB,GAC5D,IAAK,IAAIsB,EAAI,EAAGA,EAAIH,EAAoBI,OAAQD,IAAK,CACpDL,EAAkBO,KAAKL,EAAoBG,GAAGG,QAC/C,CACAV,EAAsBW,YAAY,mBAAoBT,GACtDF,EACEY,WACAD,YACA,GAAGX,EAAsBa,qCACxB5B,EAAY6B,wBAA4CC,OAE3D,IAAK,IAAIC,EAAI,EAAGA,EAAId,EAAkBM,OAAQQ,IAAK,CAClD,MAAMC,EAAmBf,EAAkBc,GAC3C,MAAME,EAAeD,EAAiBE,YACtC,IAAK,MAAMC,KAAOF,EAAc,CAC/B,GAAIE,EAAIC,QAAQ,OAAS,EAAG,CAC3B,IAAIC,EAAcF,EAClBE,EAAcA,EAAYC,UAAU,EAAGD,EAAYd,QACnDL,EAAeH,EAAsBmB,YACrChB,EAAamB,GAAe,KAC5BtB,EAAsBW,YAAY,GAAIR,EACvC,CACD,CACAA,EAAeH,EAAsBmB,WACtC,CAEAK,EAAcC,oBAAoBzB,EAAuBV,EAA8BY,EAAmB,SAE1G,GAAIA,EAAkBM,OAAS,EAAG,CACjCjB,EAA4BE,QAAQ,SAAUiC,GAC7C1B,EAAsBW,YAAYe,EAAS,MAC5C,EACD,CACD,GACC,OAEa5C,CAAY","ignoreList":[]}