{"version":3,"names":["ChartRuntime","fnUpdateChart","oEvent","oInnerChart","getSource","oMdcChart","getParent","sActionsMultiselectDisabled","oActionOperationAvailableMap","aActionsMultiselectDisabled","getCustomData","forEach","oCustomData","getKey","DelegateUtil","customData","getValue","split","oInternalModelContext","getBindingContext","aSelectedContexts","oModelObject","aSelectedDataPoints","ChartUtils","getChartSelectedData","i","length","push","context","setProperty","getModel","getPath","getSelectedDataPoints","count","j","oSelectedContext","oContextData","getObject","key","indexOf","sActionPath","substring","ActionRuntime","setActionEnablement","sAction"],"sourceRoot":".","sources":["ChartRuntime.ts"],"sourcesContent":["import type Chart from \"sap/chart/Chart\";\nimport ActionRuntime from \"sap/fe/core/ActionRuntime\";\nimport type { InternalModelContext } from \"sap/fe/core/helpers/ModelHelper\";\nimport ChartUtils from \"sap/fe/macros/chart/ChartUtils\";\nimport DelegateUtil from \"sap/fe/macros/DelegateUtil\";\nimport type UI5Event from \"sap/ui/base/Event\";\nimport type Control from \"sap/ui/mdc/Control\";\n\ntype InnerChart = Control & Chart & { getParent: Function; getCustomData: Function };\ntype MDCChart = Control;\ntype ObjectWithCount = object & { count: number };\ninterface BooleanMap {\n\t[key: string]: boolean;\n}\n\n/**\n * Static class used by MDC_Chart during runtime\n * @private\n */\nconst ChartRuntime = {\n\t/**\n\t * Updates the chart after selection or deselection of data points.\n\t * @param oEvent Chart event\n\t */\n\tfnUpdateChart: function (oEvent: UI5Event<{}, InnerChart>): void {\n\t\tconst oInnerChart = oEvent.getSource();\n\t\tconst oMdcChart = oInnerChart.getParent() as MDCChart;\n\t\tlet sActionsMultiselectDisabled,\n\t\t\toActionOperationAvailableMap: Record<string, string> = {},\n\t\t\taActionsMultiselectDisabled: string[] = [];\n\t\t// changing drill stack changes order of custom data, looping through all\n\t\toMdcChart.getCustomData().forEach(function (oCustomData) {\n\t\t\tif (oCustomData.getKey() === \"operationAvailableMap\") {\n\t\t\t\toActionOperationAvailableMap = DelegateUtil.getCustomData<{ customData: Record<string, string> }>(\n\t\t\t\t\toMdcChart,\n\t\t\t\t\t\"operationAvailableMap\"\n\t\t\t\t)!.customData;\n\t\t\t} else if (oCustomData.getKey() === \"multiSelectDisabledActions\") {\n\t\t\t\tsActionsMultiselectDisabled = oCustomData.getValue();\n\t\t\t\taActionsMultiselectDisabled = sActionsMultiselectDisabled ? sActionsMultiselectDisabled.split(\",\") : [];\n\t\t\t}\n\t\t});\n\t\tconst oInternalModelContext = oMdcChart.getBindingContext(\"internal\") as InternalModelContext;\n\n\t\tconst aSelectedContexts = [];\n\t\tlet oModelObject: BooleanMap | undefined;\n\t\tconst aSelectedDataPoints = ChartUtils.getChartSelectedData(oInnerChart);\n\t\tfor (let i = 0; i < aSelectedDataPoints.length; i++) {\n\t\t\taSelectedContexts.push(aSelectedDataPoints[i].context);\n\t\t}\n\t\toInternalModelContext.setProperty(\"selectedContexts\", aSelectedContexts);\n\t\toInternalModelContext\n\t\t\t.getModel()\n\t\t\t.setProperty(\n\t\t\t\t`${oInternalModelContext.getPath()}/numberOfSelectedContexts`,\n\t\t\t\t(oInnerChart.getSelectedDataPoints() as ObjectWithCount).count\n\t\t\t);\n\t\tfor (let j = 0; j < aSelectedContexts.length; j++) {\n\t\t\tconst oSelectedContext = aSelectedContexts[j];\n\t\t\tconst oContextData = oSelectedContext.getObject();\n\t\t\tfor (const key in oContextData) {\n\t\t\t\tif (key.indexOf(\"#\") === 0) {\n\t\t\t\t\tlet sActionPath = key;\n\t\t\t\t\tsActionPath = sActionPath.substring(1, sActionPath.length);\n\t\t\t\t\toModelObject = oInternalModelContext.getObject() as BooleanMap;\n\t\t\t\t\toModelObject[sActionPath] = true;\n\t\t\t\t\toInternalModelContext.setProperty(\"\", oModelObject);\n\t\t\t\t}\n\t\t\t}\n\t\t\toModelObject = oInternalModelContext.getObject() as BooleanMap;\n\t\t}\n\n\t\tActionRuntime.setActionEnablement(oInternalModelContext, oActionOperationAvailableMap, aSelectedContexts, \"chart\");\n\n\t\tif (aSelectedContexts.length > 1) {\n\t\t\taActionsMultiselectDisabled.forEach(function (sAction: string): void {\n\t\t\t\toInternalModelContext.setProperty(sAction, false);\n\t\t\t});\n\t\t}\n\t}\n};\n\nexport default ChartRuntime;\n"],"mappings":"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","ignoreList":[],"file":"ChartRuntime-dbg.js"}