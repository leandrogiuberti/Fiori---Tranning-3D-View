/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)
 *      (c) Copyright 2009-2025 SAP SE. All rights reserved
 */
sap.ui.define(["sap/base/Log","sap/base/util/deepClone","sap/base/util/merge","sap/base/util/uid","sap/fe/base/BindingToolkit","sap/fe/core/CommonUtils","sap/fe/core/buildingBlocks/templating/BuildingBlockTemplateProcessor","sap/fe/core/controls/CommandExecution","sap/fe/core/converters/ConverterContext","sap/fe/core/converters/ManifestSettings","sap/fe/core/converters/ManifestWrapper","sap/fe/core/converters/MetaModelConverter","sap/fe/core/converters/annotations/DataField","sap/fe/core/converters/controls/Common/Action","sap/fe/core/converters/controls/Common/DataVisualization","sap/fe/core/helpers/FPMHelper","sap/fe/core/helpers/ModelHelper","sap/fe/core/helpers/StableIdHelper","sap/fe/core/helpers/TypeGuards","sap/fe/core/templating/DataModelPathHelper","sap/fe/macros/CommonHelper","sap/m/Button","sap/m/FlexItemData","sap/m/IllustratedMessage","sap/m/IllustratedMessageSize","sap/m/IllustratedMessageType","sap/m/Menu","sap/m/MenuButton","sap/m/MenuItem","sap/m/OverflowToolbarLayoutData","sap/m/SegmentedButton","sap/m/SegmentedButtonItem","sap/ui/Device","sap/ui/core/CustomData","sap/ui/core/Element","sap/ui/core/Popup","sap/ui/fl/variants/VariantManagement","sap/ui/mdc/Chart","sap/ui/mdc/actiontoolbar/ActionToolbarAction","sap/ui/mdc/chart/Item","sap/ui/mdc/p13n/PersistenceProvider","sap/ui/model/json/JSONModel","../internal/helpers/ActionHelper","../internal/helpers/DefaultActionHandler","./ChartHelper","sap/fe/base/jsx-runtime/jsx"],function(e,t,n,a,o,i,r,s,c,l,u,d,p,g,f,h,m,b,v,y,C,A,_,M,P,x,D,T,O,I,S,B,k,V,j,E,$,w,F,N,L,U,H,z,R,G){"use strict";var W={};var K=E.Dock;var q=y.getTargetObjectPath;var J=y.getContextRelativeTargetObjectPath;var X=v.isPathAnnotationExpression;var Y=b.generate;var Q=f.getVisualizationsFromAnnotation;var Z=f.getDataVisualizationConfiguration;var ee=g.isMenuAIOperation;var te=g.aiIcon;var ne=p.isDataModelObjectPathForActionWithDialog;var ae=d.getInvolvedDataModelObjects;var oe=l.TemplateType;var ie=r.escapeXMLAttributeValue;var re=o.resolveBindingString;var se=o.pathInModel;var ce=o.notEqual;const le={"com.sap.vocabularies.UI.v1.ChartMeasureRoleType/Axis1":"axis1","com.sap.vocabularies.UI.v1.ChartMeasureRoleType/Axis2":"axis2","com.sap.vocabularies.UI.v1.ChartMeasureRoleType/Axis3":"axis3","com.sap.vocabularies.UI.v1.ChartMeasureRoleType/Axis4":"axis4"};var ue=function(e){e["Sort"]="Sort";e["Type"]="Type";e["Item"]="Item";e["Filter"]="Filter";return e}(ue||{});function de(e,t,n,a){let o=J(n);let i=[];if(e._metaPathContext?.getObject()?.$Type==="com.sap.vocabularies.UI.v1.PresentationVariantType"){i=e._metaPathContext.getObject().Visualizations}else if(e._metaPathContext?.getObject()?.$Type==="com.sap.vocabularies.UI.v1.SelectionPresentationVariantType"){i=e._metaPathContext.getObject().PresentationVariant?.Visualizations}if(i?.length&&!pe(i,a)){o=""}if(!o){o=`@${"com.sap.vocabularies.UI.v1.Chart"}`}const r=Z(o,t,{isCondensedTableLayoutCompliant:e.useCondensedLayout,isMacroOrMultipleView:true,shouldCreateTemplateChartVisualization:false});return r.visualizations[0]}function pe(e,t){return e.some(e=>t?.includes(e.$AnnotationPath))}function ge(e){return`${e}-content`}function fe(e,t){const n={};const a={};if(e.actions){Object.values(e.actions)?.forEach(e=>{if(e.isA("sap.fe.macros.chart.ActionGroup")){a[e.key]=he(e.key,e.text,null,false,true,{placement:e.placement,anchor:e.anchor},e.actions.map((t,n)=>e.key+"_Menu_"+n));e.actions?.forEach((t,n)=>{const o=e.key.concat("_Menu_",n);a[o]=he(o,t.text,t.press,!!t.requiresSelection,t.enabled===null||t.enabled===undefined?true:t.enabled)})}else if(e.isA("sap.fe.macros.chart.Action")){a[e.key]=he(e.key,e.text,e.press,!!e.requiresSelection,e.enabled===null||e.enabled==undefined?true:e.enabled,{placement:e.placement,anchor:e.anchor})}})}if(t&&e.actions){n[t]={actions:a}}return n}function he(e,t,n,a,o,i,r){const s={key:e,text:t,__noWrap:true,press:n,requiresSelection:a,enabled:o};if(i){s.position=i}if(r){s.menu=r}return s}function me(e){const t=`/${a()}`;const n=new U;n.setProperty(t,e);return n.createBindingContext(t)}function be(t){const n=t.chartDefinition.annotationPath.split("/");const a=n.filter(function(e,t){return n.indexOf(e)==t}).toString().replaceAll(",","/");const o=ae(t._metaModel.createBindingContext(a),t._context).targetObject;let i=[];const r=t._metaPathContext.getPath();const s=o?.Measures?o.Measures:[];const c=o?.DynamicMeasures?o.DynamicMeasures:[];const l=r.replace(/@com.sap.vocabularies.UI.v1.(Chart|PresentationVariant|SelectionPresentationVariant).*/,"");const u=t.chartDefinition.transAgg;const d=t.chartDefinition.customAgg;if(t.chartDefinition.containsAggregatedProperty&&!c&&t.chartDefinition.containsTransAggInMeasures){e.warning("The transformational aggregate measures are configured as Chart.Measures but should be configured as Chart.DynamicMeasures instead. Please check the SAP Help documentation and correct the configuration accordingly.")}const p=s.some(e=>{const t=Ae(d,e);return!!t});if(t.chartDefinition.containsAggregatedProperty&&!c?.length&&!p){throw new Error("Please configure DynamicMeasures for the chart")}if(t.chartDefinition.containsAggregatedProperty&&o){for(const e of c){i=Ce(i,e,l,o,t)}}for(const e of s){const n=e.value;const a=Ae(d,e);const o={};if(a){i=ve(i,o,a,n)}else if(!t.chartDefinition.containsAggregatedProperty&&u[n]){i=ye(i,o,u,n)}_e(t._chart.MeasureAttributes,l,o,t)}const g=new U(i);g.$$valueAsPromise=true;return g.createBindingContext("/")}function ve(t,n,a,o){if(o.includes("/")){e.error(`$expand is not yet supported. Measure: ${o} from an association cannot be used`)}n.key=a.value;n.role="axis1";n.label=a.label;n.propertyPath=a.value;t.push(n);return t}function ye(e,t,n,a){const o=n[a];t.key=o.name;t.role="axis1";t.propertyPath=a;t.aggregationMethod=o.aggregationMethod;t.label=o.label||t.label;e.push(t);return e}function Ce(t,n,a,o,i){const r=n.value||"";const s=ae(i._metaModel.createBindingContext(a+r),i._context).targetObject;if(r.includes("/")){e.error(`$expand is not yet supported. Measure: ${r} from an association cannot be used`)}else if(!s){throw new Error(`Please provide the right AnnotationPath to the Dynamic Measure ${n.value}`)}else if(n.value?.startsWith(`@${"com.sap.vocabularies.Analytics.v1.AggregatedProperty"}`)===null){throw new Error(`Please provide the right AnnotationPath to the Dynamic Measure ${n.value}`)}else{const e={key:s.Name.toString(),role:"axis1"};e.propertyPath=s.AggregatableProperty.value;e.aggregationMethod=s.AggregationMethod.toString();e.label=re(s.annotations?.Common?.Label?.toString()??s.AggregatableProperty.$target?.annotations?.Common?.Label?.toString()??"");_e(o.MeasureAttributes,a,e,i);t.push(e)}return t}function Ae(e,t){if(t.value&&e[t.value]){t.label=e[t.value]?.label;return t}return null}function _e(e,t,n,a){if(e?.length){for(const o of e){Me(o,t,n,a)}}}function Me(e,t,n,a){const o=e.DynamicMeasure?e?.DynamicMeasure?.value:e?.Measure?.value;const i=e.DataPoint?e?.DataPoint?.value:null;const r=e.Role;const s=i?ae(a._metaModel.createBindingContext(t+i),a._context).targetObject:undefined;if(n.key===o){Be(n,r);Se(n,s)}}function Pe(e){const t={};if(e.TargetValue){t.targetValue=e.TargetValue.$Path}if(e.ForecastValue){t.foreCastValue=e.ForecastValue.$Path}let n=null;if(e.Criticality){if(X(e.Criticality)&&e.Criticality.path){n={Calculated:e.Criticality.path}}else{n={Static:e.Criticality.$EnumMember.replace("com.sap.vocabularies.UI.v1.CriticalityType/","")}}}else if(e.CriticalityCalculation){const t={};const a=xe(t,e.CriticalityCalculation);if(a){n={ConstantThresholds:t}}else{n={DynamicThresholds:t}}}if(n){t.criticality=n}return t}function xe(e,t){const n=["AcceptanceRangeLowValue","AcceptanceRangeHighValue","ToleranceRangeLowValue","ToleranceRangeHighValue","DeviationRangeLowValue","DeviationRangeHighValue"];e.ImprovementDirection=t.ImprovementDirection?.$EnumMember.replace("com.sap.vocabularies.UI.v1.ImprovementDirectionType/","");const a={oneSupplied:false,usedMeasures:[]};const o={oneSupplied:false};De(n,a,o,t);Te(n,e,a,o,t);return!a.oneSupplied}function De(e,t,n,a){for(const o of e){t[o]=a[o]?a[o].$Path:undefined;t.oneSupplied=t.oneSupplied||t[o];if(!t.oneSupplied){n[o]=a[o];n.oneSupplied=n.oneSupplied||n[o]}else if(t[o]){t.usedMeasures.push(t[o])}}}function Te(e,t,n,a,o){if(n.oneSupplied){for(const a of e){if(n[a]){t[a]=n[a]}}t.usedMeasures=n.usedMeasures}else{t.AggregationLevels=[];Oe(e,t,a,o)}}function Oe(e,t,n,a){let o={};if(n.oneSupplied){o={VisibleDimensions:null};for(const t of e){if(n[t]){o[t]=n[t]}}t.AggregationLevels?.push(o)}Ie(e,t,a,o)}function Ie(e,t,n,a){if(n.ConstantThresholds&&n.ConstantThresholds.length>0){for(const o of n.ConstantThresholds){const n=o.AggregationLevel?[]:null;if(n&&o.AggregationLevel&&o.AggregationLevel.length>0){for(const e of o.AggregationLevel){n.push(e.$PropertyPath)}}a={VisibleDimensions:n};for(const t of e){const e=o[t];if(e){a[t]=e}}t.AggregationLevels?.push(a)}}}function Se(e,t){if(t&&t.Value.$Path==e.key){e.dataPoint=R.formatJSONToString(Pe(t))||""}}function Be(e,t){if(t!=null){const n=t.$EnumMember;e.role=le[n]}}function ke(e,t){if(e._commandActions.length>0){return e._commandActions.map(n=>Ne(n,t,e))}return""}function Ve(e,t){if(e){if(e==="false"||e===false){t._personalization=undefined}else if(e==="true"||e===true){t._personalization=Object.values(ue).join(",")}else if(je(e)===true){t._personalization=e}else{t._personalization=undefined}}}function je(e){let t=true;const n=e.split(",");const a=Object.values(ue);n.forEach(e=>{if(!a.includes(e)){t=false}});return t}function Ee(e){const t=e.variantManagement?e.variantManagement:e.chartDefinition.variantManagement;return e.personalization===undefined?"None":t}function $e(t){const n=t.personalization;if(n){const e=Ee(t);if(e==="Control"){return G($,{id:Y([t._blockId,"VM"]),for:[t._blockId],showSetAsDefault:true,headerLevel:t.headerLevel,select:e=>{t.fireVariantSelected?.(e)},save:e=>{t.fireVariantSaved?.(e)}})}else if(e==="None"||e==="Page"){return""}}else if(!n){e.warning("Variant Management cannot be enabled when personalization is disabled")}return""}function we(e){if(Ee(e)==="None"){return G(L,{id:Y([e._blockId,"PersistenceProvider"]),for:e._blockId})}}function Fe(e,t,n,a,o){if(t){const i={actionContext:e,onExecuteAction:R.getPressEventForDataFieldForActionButton(o._blockId,t,n||""),onExecuteIBN:C.getPressHandlerForDataFieldForIBN(t,`\${internal>selectedContexts}`,false),onExecuteManifest:C.buildActionWrapper(a,o),chartOperationAvailableMap:n};o._commandActions.push(i)}}function Ne(e,t,n){const a=e.actionContext.getObject();const o=a.annotationPath&&n._metaModel.createBindingContext(a.annotationPath);const i=o&&o.getObject();const r=n._metaModel.createBindingContext(a.annotationPath+"/Action");const c=C.getActionContext(r);const l=C.getPathToBoundActionOverload(r);const u=n._metaModel.createBindingContext(l).getObject();const d=ie(R.getOperationAvailableMap(t.getObject(),{context:t}));const p=a.enabled?a.enabled:R.isDataFieldForActionButtonEnabled(u&&u.$IsBound,i.Action,n._context,d||"",a.enableOnSelect||"");let g;if(a.enabled){g=a.enabled}else if(i.RequiresContext){g="{= %{internal>numberOfSelectedContexts} >= 1}"}let f;switch(a.type){case"ForAction":f=p??a.enabled;break;case"ForNavigation":f=g??a.enabled;break;default:f=a.enabled;break}const h=G(s,{execute:t=>Le(t,a,n._blockId,e.chartOperationAvailableMap,i),enabled:f,visible:ut(o,n)??a.visible,command:a.command});if(a.type=="ForAction"&&(!u||u.IsBound!==true||c[`@${"Org.OData.Core.V1.OperationAvailable"}`]!==false)){return h}else if(a.type=="ForAction"){return""}else{return h}}function Le(e,t,n,a,o){const r=i.getTargetView(e.getSource());const s=r?.getController();switch(t.type){case"ForAction":const i=t.InvocationGrouping&&t.InvocationGrouping.$EnumMember==="com.sap.vocabularies.UI.v1.OperationGroupingType/ChangeSet"?"ChangeSet":"Isolated";const c={contexts:r.getBindingContext("internal")?.getProperty("selectedContexts"),invocationGrouping:i,controlId:n,operationAvailableMap:a,model:r.getModel(),label:o.Label};s.editFlow.invokeAction(o.Action,c);break;case"ForNavigation":const l={navigationContexts:r.getBindingContext("internal")?.getProperty("selectedContexts")};if(o.Mapping){l.semanticObjectMapping=JSON.stringify(o.Mapping)}s._intentBasedNavigation.navigate(o.SemanticObject,o.Action,l);break;default:h.actionWrapper(e,t.handlerModule,t.handlerMethod,{contexts:r.getBindingContext("internal")?.getProperty("selectedContexts")});break}}function Ue(e){if(e._chart){const t=[];const n=[];if(e._chart.Dimensions){R.formatDimensions(e._chartContext).getObject().forEach(n=>{n.id=Y([e.id,"dimension",n.key]);t.push(He({id:n.id,key:n.key,label:n.label,role:n.role},"_fe_groupable_","groupable"))})}if(e.measures){R.formatMeasures(e.measures).forEach(t=>{t.id=Y([e.id,"measure",t.key]);n.push(He({id:t.id,key:t.key,label:t.label,role:t.role},"_fe_aggregatable_","aggregatable"))})}if(t.length&&n.length){return t.concat(n)}}return""}function He(e,t,n){return G(N,{id:e.id,propertyKey:t+e.key,type:n,label:re(e.label,"string"),role:e.role})}function ze(e){const t=Ge(e);if(e.chartDefinition?.onSegmentedButtonPressed){t.push(rt(e))}if(e.chartDefinition.isInsightsEnabled){t.push(Re(e.chartDefinition.isInsightsEnabled,e.chartDefinition.isInsightsVisible,e._blockId,e))}if(t.length>0){return t}return[]}function Re(e,t,n,a){return G(F,{visible:t,children:G(A,{id:Y([n,"StandardAction::Insights"]),text:"{sap.fe.i18n>M_COMMON_INSIGHTS_CARD}",press:()=>{a.onAddCardToInsightsPressed()},enabled:e,children:{layoutData:G(I,{priority:"AlwaysOverflow"})}})})}function Ge(e){const t=We(e.chartActions??[]);const n=H.ensurePrimaryActionNeverOverflows(t);return n.map(t=>{if(t.annotationPath||t.type==="Menu"&&!t.id?.startsWith("CustomAction")){return Xe(t,e._chartContext,false,e)}else if(t.hasOwnProperty("noWrap")){return Ke(t,e._chartContext,e)}})}function We(e){for(const t of e){if(t.menu){t.menu.forEach(t=>{const n=e.map(e=>e.key).indexOf(t.key);if(n!==-1){e.splice(n,1)}})}}return e}function Ke(e,t,n){let a=e.enabled;if((e.requiresSelection??false)&&e.enabled==="true"){a="{= %{internal>numberOfSelectedContexts} >= 1}"}if(e.type==="Default"){return Ze(e,{id:Y([n._blockId,e.id]),unittestid:"DataFieldForActionButtonAction",label:e.text?e.text:"",ariaHasPopup:undefined,press:e.press?e.press:"",enabled:a,visible:e.visible?e.visible:false},false,n)}else if(e.type==="Menu"){return Je({id:Y([n._blockId,e.id]),text:e.text,visible:e.visible,enabled:a,useDefaultActionOnly:z.getUseDefaultActionOnly(e),buttonMode:z.getButtonMode(e),defaultAction:undefined,actions:e,priority:e.priority,group:e.group},t,n)}}function qe(e,t,n){let a;if(e.annotationPath){return Xe(e,t,true,n)}if(e.command){a={"jsx:command":`cmd:${e.command}|press`}}else if(e.noWrap??false){a={press:t=>{const n=e.handlerMethod?.split(".")[1];const a={...i.getTargetView(t.getSource()).getController()};if(a[n])a[n](t)}}}else{a={press:t=>{const n=i.getTargetView(t.getSource()).getBindingContext("internal")?.getProperty("selectedContexts");h.actionWrapper(t,e.handlerModule,e.handlerMethod,{contexts:n})}}}return G(O,{text:e.text,...a,visible:e.visible,enabled:e.enabled})}function Je(e,t,n){const a=(e.actions?.menu).map(e=>qe(e,t,n));const o=ee(e.actions?.menu);return G(F,{children:G(T,{text:e.text,type:"Transparent",id:e.id,visible:e.visible,enabled:e.enabled,useDefaultActionOnly:e.useDefaultActionOnly,buttonMode:e.buttonMode,menuPosition:K.BeginBottom,defaultAction:"props.defaultAction",icon:o?te:undefined,children:{menu:G(D,{children:a}),layoutData:G(I,{priority:e.priority,group:e.group})}})})}function Xe(e,t,n,a){const o=a._metaModel.createBindingContext(e.annotationPath??"");if(e.type==="ForNavigation"){return Ye(e,o,n,a)}else if(e.type==="ForAction"){return Qe(t,e,o,n,a)}else if(e.type==="Menu"){const n=e.menu?.map(e=>Xe(e,t,true,a));return G(F,{children:G(T,{text:e.text,type:"Transparent",id:e.key,visible:e.visible,enabled:e.enabled,menuPosition:K.BeginBottom,icon:e?.isAIOperation===true?te:undefined,children:{menu:G(D,{children:n}),layoutData:G(I,{priority:e.priority,group:e.group})}})})}return undefined}function Ye(e,t,n,a){let o="true";const i=t.getObject();if(e.enabled!==undefined){o=e.enabled}else if(i.RequiresContext){o="{= %{internal>numberOfSelectedContexts} >= 1}"}return Ze(e,{id:undefined,unittestid:"DataFieldForIntentBasedNavigationButtonAction",label:i.Label,ariaHasPopup:undefined,press:C.getPressHandlerForDataFieldForIBN(i,`\${internal>selectedContexts}`,false),enabled:o,visible:ut(t,a)},n,a,i)}function Qe(e,t,n,a,o){const i=o._metaModel.createBindingContext(t.annotationPath+"/Action");const r=o._metaModel.createBindingContext(C.getActionContext(i));const s=r?.getObject();const c=C.getPathToBoundActionOverload(i);const l=o._metaModel.createBindingContext(c).getObject();const u=n.getObject();if(!l||l.$IsBound!==true||s[`@${"Org.OData.Core.V1.OperationAvailable"}`]!==false){const i=it(t,l,u,e,o._context);const r=ae(o._metaModel.createBindingContext(t.annotationPath));const s=ne(r);const c=ie(R.getOperationAvailableMap(e.getObject(),{context:e}))||"";return Ze(t,{id:Y([o._blockId,ae(n)]),unittestid:"DataFieldForActionButtonAction",label:u.Label,ariaHasPopup:s,enabled:i,visible:ut(n,o)},a,o,u,c)}return undefined}function Ze(e,t,n,a,o,r){if(n){const n=e.command?{"jsx:command":`cmd:${e.command}|press`}:{press:t=>{const n=i.getTargetView(t.getSource());const s=n.getController();if(e.type==="ForAction"){const e={contexts:n.getBindingContext("internal")?.getProperty("selectedContexts"),invocationGrouping:o?.InvocationGrouping==="UI.OperationGroupingType/ChangeSet"?"ChangeSet":"Isolated",controlId:a._blockId,operationAvailableMap:r,model:n.getModel(),label:o?.Label};s.editFlow.invokeAction(o?.Action,e)}else if(e.type==="ForNavigation"){const e={navigationContexts:n.getBindingContext("internal")?.getProperty("selectedContexts")};if(o?.Mapping){e.semanticObjectMapping=JSON.stringify(o.Mapping)}s._intentBasedNavigation.navigate(o.SemanticObject,o.Action,e)}}};return G(O,{text:t.label,...n,enabled:t.enabled,visible:t.visible})}else{return et(e,t,a,o,r)}}function et(e,t,n,a,o){return G(F,{children:G(A,{id:t.id,text:t.label,ariaHasPopup:t.ariaHasPopup,...tt(e,a,o,n),enabled:t.enabled,visible:t.visible,icon:e.isAIOperation===true?te:undefined,children:{layoutData:G(I,{priority:e.priority,group:e.group})}})})}function tt(e,t,n,a){let o={press:""};if(e.hasOwnProperty("noWrap")){if(e.command){o={"jsx:command":`cmd:${e.command}|press`}}else if(e.noWrap===true){o=nt(e)}else if(!e.annotationPath){o=at(e)}}else{o=e.command?{"jsx:command":`cmd:${e.command}|press`}:ot(e,t,a,n)}return o}function nt(e){return{press:t=>{const n=e.handlerMethod?.split(".")[1];const a={...i.getTargetView(t.getSource()).getController()};if(a[n])a[n](t)}}}function at(e){return{press:t=>{const n=t.getSource().getBindingContext("internal")?.getProperty("selectedContexts");h.actionWrapper(t,e.handlerModule,e.handlerMethod,{contexts:n})}}}function ot(e,t,n,a){return{press:o=>{const r=i.getTargetView(o.getSource());const s=r.getController();if(e.type==="ForAction"){const e={contexts:r.getBindingContext("internal")?.getProperty("selectedContexts"),invocationGrouping:t?.InvocationGrouping==="UI.OperationGroupingType/ChangeSet"?"ChangeSet":"Isolated",controlId:n?._blockId,operationAvailableMap:a,model:r.getModel(),label:t?.Label};s.editFlow.invokeAction(t?.Action,e)}else if(e.type==="ForNavigation"){const e={navigationContexts:r.getBindingContext("internal")?.getProperty("selectedContexts")};if(t?.Mapping){e.semanticObjectMapping=JSON.stringify(t.Mapping)}s._intentBasedNavigation.navigate(t.SemanticObject,t.Action,e)}}}}function it(e,t,n,a,o){return e.enabled!==undefined?e.enabled:R.isDataFieldForActionButtonEnabled(t&&t.$IsBound,n.Action,o,R.getOperationAvailableMap(a.getObject(),{context:a}),e.enableOnSelect||"")}function rt(e){return G(F,{layoutInformation:{aggregationName:"end",alignment:"End"},children:G(S,{id:Y([e._blockId,"SegmentedButton","TemplateContentView"]),selectionChange:t=>{e.fireSegmentedButtonPressed?.(n(t.getParameters(),{selectedKey:t.getSource().getSelectedKey()}))},visible:ce(se("alpContentView","pageInternal"),"Table"),selectedKey:se("alpContentView","pageInternal"),children:{items:st()}})})}function st(){const e=[];if(C.isDesktop()){e.push(ct("{sap.fe.i18n>M_COMMON_HYBRID_SEGMENTED_BUTTON_ITEM_TOOLTIP}","Hybrid","sap-icon://chart-table-view"))}e.push(ct("{sap.fe.i18n>M_COMMON_CHART_SEGMENTED_BUTTON_ITEM_TOOLTIP}","Chart","sap-icon://bar-chart"));e.push(ct("{sap.fe.i18n>M_COMMON_TABLE_SEGMENTED_BUTTON_ITEM_TOOLTIP}","Table","sap-icon://table-view"));return e}function ct(e,t,n){return G(B,{tooltip:e,icon:n},t)}function lt(t,n){const a=J(t);if(!a){e.error(`Missing metaPath parameter for Chart`);return`@${"com.sap.vocabularies.UI.v1.Chart"}`}if(t.targetObject?.term==="com.sap.vocabularies.UI.v1.Chart"){return a}const o=n.getEntityTypeAnnotation(a);let i=[];switch(t.targetObject?.term){case"com.sap.vocabularies.UI.v1.SelectionPresentationVariant":if(t.targetObject.PresentationVariant){i=Q(t.targetObject,a,o.converterContext,true)}break;case"com.sap.vocabularies.UI.v1.PresentationVariant":i=Q(t.targetObject,a,o.converterContext,true);break;default:break}const r=i.find(e=>e.visualization.term==="com.sap.vocabularies.UI.v1.Chart");if(r){return r.annotationPath}else{e.error(`Bad metaPath parameter for chart: ${t.targetObject?.term}`);return`@${"com.sap.vocabularies.UI.v1.Chart"}`}}function ut(e,t){const n=e.getObject();if(n[`@${"com.sap.vocabularies.UI.v1.Hidden"}`]&&n[`@${"com.sap.vocabularies.UI.v1.Hidden"}`].$Path){const a=t._metaModel.createBindingContext(e.getPath()+`/@${"com.sap.vocabularies.UI.v1.Hidden"}/$Path`,n[`@${"com.sap.vocabularies.UI.v1.Hidden"}`].$Path);return R.getHiddenPathExpressionForTableActionsAndIBN(n[`@${"com.sap.vocabularies.UI.v1.Hidden"}`].$Path,{context:a})}else if(n[`@${"com.sap.vocabularies.UI.v1.Hidden"}`]){return!n[`@${"com.sap.vocabularies.UI.v1.Hidden"}`]}else{return true}}function dt(e,a,o,i,r){let s=Object.assign({},a);delete s.resourceModel;delete s.appComponent;s=t(s);let l={};const d=q(o.contextLocation??o);const p=o.contextLocation?.targetEntitySet?.name??o.targetEntitySet?.name;if(d===a?.contextPath||d===`/${a?.entitySet}`||p===a?.entitySet){l=s.controlConfiguration}s.controlConfiguration=n(l,r||{});return c.createConverterContextForMacro(o.startingEntitySet.name,e._metaModel,i,n,o.contextLocation,new u(s))}function pt(e,t,n,a){const o=dt(e,t,n,a);const i=lt(n,o);const r=fe(e,i);return dt(e,t,n,a,r)}function gt(e){if(e._applyIdToContent){e._blockId=e.id.replace(/::Chart$/,"");e._contentId=e._blockId}else{e._blockId=e.id;e._contentId=ge(e.id)}}function ft(e,t,n,a){const o=e.getMetaPathObject(e.metaPath,e._resolvedContextPath);e._metaModel=e._getOwner()?.preprocessorContext?.models.metaModel;e._metaPathContext=e._metaModel.createBindingContext(o.getPath());e._context=e._metaModel.createBindingContext(e.contextPath??o?.getContextPath());const i=pt(e,t,a,n);const r=i.getManifestWrapper()?.getViewConfiguration();const s=r?.paths?.length>1;const c=i.getManifestWrapper()?.hasMultipleVisualizations()||i.getTemplateType()===oe.AnalyticalListPage;e._chartContext=R.getUiChart(e._metaPathContext);e._chart=e._chartContext.getObject();e._blockActions=[];e._commandActions=[];gt(e);if(e._chart){e.chartDefinition=de(e,i,a,e._chartContext.getPath());const t=e._metaModel.createBindingContext(e.chartDefinition.collection);e.navigationPath=e.chartDefinition.navigationPath;e.autoBindOnInit=e.chartDefinition.autoBindOnInit;e.vizProperties=e.chartDefinition.vizProperties;e.chartActions=e.chartDefinition.actions;e.filter=ht(e);let n;if(e.chartDefinition?.personalization!==undefined){n=e.chartDefinition.personalization}else{switch(e.personalization){case"false":n=undefined;break;case"true":n=Object.values(ue).join(",");break;default:n=e.personalization}}Ve(n,e);e.visible=e.chartDefinition.visible;e.draftSupported=m.isMetaPathDraftSupported(o);e._chartType=R.formatChartType(e._chart.ChartType);const r=R.getOperationAvailableMap(e._chart,{context:e._chartContext});if(Object.keys(e.chartDefinition?.commandActions).length>0){Object.keys(e.chartDefinition?.commandActions).forEach(t=>{const n=e.chartDefinition?.commandActions[t];const a=me(n);const o=n.annotationPath&&e._metaModel.createBindingContext(n.annotationPath);const i=o&&o.getObject();const s=ie(r);Fe(a,i,s,n,e)})}e.measures=be(e);const l=C.createPresentationPathContext(e._metaPathContext);e._sortConditions=R.getSortConditions(e._metaPathContext,e._metaPathContext.getObject(),l.getPath(),e.chartDefinition.applySupported);const u=e._metaModel.createBindingContext(e._chartContext.getPath()+"/Actions",e._chart.Actions);const d=C.getTargetCollectionPath(t);const p=e._metaModel.createBindingContext(d,t);const g=a.convertedTypes.resolvePath(u.getPath())?.target;e._customData={targetCollectionPath:e.chartDefinition.collection,entitySet:typeof p.getObject()==="string"?p.getObject():p.getObject("@sapui.name"),entityType:e.chartDefinition.collection+"/",operationAvailableMap:JSON.parse(r),multiSelectDisabledActions:H.getMultiSelectDisabledActions(g)+"",segmentedButtonId:Y([e._blockId,"SegmentedButton","TemplateContentView"]),customAgg:e.chartDefinition?.customAgg,transAgg:e.chartDefinition?.transAgg,applySupported:e.chartDefinition?.applySupported,vizProperties:JSON.parse(e.vizProperties),draftSupported:e.draftSupported,multiViews:e.chartDefinition?.multiViews||!c&&s,selectionPresentationVariantPath:{data:e.chartDefinition?.selectionPresentationVariantPath},chartDimensionKeyAndRole:e.chartDefinition?.chartDimensionKeyAndRole,chartMeasureKeyAndRole:e.chartDefinition?.chartMeasureKeyAndRole};if(e.chartDefinition.isParameterizedEntitySet){e._customData.entitySet=e.chartDefinition.collection.substring(1)}}else{e.autoBindOnInit=false;e.visible="true";e.navigationPath="";e._customData={targetCollectionPath:"",entitySet:"",entityType:"",operationAvailableMap:"",multiSelectDisabledActions:"",segmentedButtonId:"",customAgg:{},transAgg:{},applySupported:{},vizProperties:{}}}}function ht(e){const t=j.getElementById(e.filterBar);if(e.filterBar&&t?.isA("sap.fe.macros.filterBar.FilterBarAPI")){return ge(e.filterBar)}else if(t?.isA("sap.fe.macros.controls.FilterBar")){return e.filterBar}else if(e.filterBar){return ge(e.filterBar)}}function mt(e){if(e.chartDelegate){e.chartDelegate.payload.selectionMode=e.chartDefinition.selectionMode?.toUpperCase()??e.chartDelegate.payload.selectionMode??"MULTIPLE"}return e.chartDelegate?e.chartDelegate:{name:"sap/fe/macros/chart/ChartDelegate",payload:{chartContextPath:e._customData.targetCollectionPath,parameters:{$$groupId:"$auto.Workers"},selectionMode:e.chartDefinition.selectionMode?.toUpperCase()??e.selectionMode?.toUpperCase()??"MULTIPLE"}}}function bt(e){return[G(V,{value:e._customData.targetCollectionPath},"targetCollectionPath"),G(V,{value:e._customData.entitySet},"entitySet"),G(V,{value:e._customData.entityType},"entityType"),G(V,{value:e._customData.operationAvailableMap},"operationAvailableMap"),G(V,{value:e._customData.multiSelectDisabledActions},"multiSelectDisabledActions"),G(V,{value:e._customData.segmentedButtonId},"segmentedButtonId"),G(V,{value:e._customData.customAgg},"customAgg"),G(V,{value:e._customData.transAgg},"transAgg"),G(V,{value:e._customData.applySupported},"applySupported"),G(V,{value:e._customData.vizProperties},"vizProperties"),G(V,{value:e._customData.draftSupported},"draftSupported"),G(V,{value:e._customData.multiViews},"multiViews"),G(V,{value:e._customData.selectionPresentationVariantPath},"selectionPresentationVariantPath"),G(V,{value:e._customData.chartDimensionKeyAndRole},"chartDimensionKeyAndRole"),G(V,{value:e._customData.chartMeasureKeyAndRole},"chartMeasureKeyAndRole")]}function vt(e){if(e._customData.targetCollectionPath===""){return}return G(M,{illustrationSize:P.Auto,illustrationType:x.BeforeSearch,title:e.getTranslatedText("T_TABLE_AND_CHART_NO_DATA_TITLE_TEXT"),description:e.getTranslatedText("T_TABLE_AND_CHART_NO_DATA_TEXT"),enableDefaultTitleAndDescription:false,enableVerticalResponsiveness:true})}function yt(e,t,n,a){ft(e,t,n,a);e.layoutData=G(_,{growFactor:"1",shrinkFactor:"1"});return G(w,{binding:{internal:"controls/"+e._blockId},id:e._contentId,chartType:e._chartType,sortConditions:e._sortConditions,header:e.chartDefinition.header??e.header??e._chart?.Title?.toString()??"",headerVisible:e.chartDefinition.headerVisible??e.headerVisible,minHeight:k.system.phone?"80vh":"400px",height:"100%",width:"100%",headerLevel:e.headerLevel,headerStyle:e.headerStyle,p13nMode:e._personalization?.split(","),filter:e.filter,noDataText:e._customData.targetCollectionPath===""?e.getTranslatedText("M_CHART_NO_ANNOTATION_SET_TEXT"):e.noDataText,autoBindOnInit:e.autoBindOnInit,delegate:mt(e),visible:e.visible,children:{customData:bt(e),dependents:[ke(e,e._chartContext),we(e)],items:Ue(e),actions:e.chartActions?ze(e):e._blockActions,variant:$e(e),noData:vt(e)}})}W.getMdcChartTemplate=yt;return W},false);
//# sourceMappingURL=MdcChartTemplate.js.map