{"version":3,"names":["MacroAPI","_dec","defineUI5Class","_dec2","implementInterface","_dec3","aggregation","type","multiple","isDefault","_dec4","property","_dec5","_class","_class2","_MacroAPI","_BuildingBlock","mSettings","others","_this","call","_initializerDefineProperty","_descriptor","_descriptor2","_descriptor3","_descriptor4","parentContextToBind","_inheritsLoose","_proto","prototype","applySettings","oScope","eventsKeys","Object","keys","getMetadata","getEvents","eventsKey","undefined","init","getModel","oPageModel","Component","getOwnerComponentFor","setModel","setOrBindProperty","propertyName","value","parsedExpression","BindingInfo","parse","_e","startsWith","bindProperty","getProperty","setProperty","setParentBindingContext","modelName","path","setParent","_len","arguments","length","args","Array","_key","forEach","getParent","bindObject","model","events","change","oBoundContext","getBoundContext","getObject","BuildingBlock","namespace","macroName","fragment","hasValidation","getConverterContext","dataModelObjectPath","contextPath","settings","extraParams","appComponent","originalViewData","models","viewData","getData","assign","resourceModel","deepClone","controlConfiguration","relativePath","getTargetObjectPath","contextLocation","entitySetName","targetEntitySet","name","entitySet","merge","ConverterContext","createConverterContextForMacro","startingEntitySet","metaModel","getDiagnostics","ManifestWrapper","createBindingContext","oData","sContextPath","uid","converterContext","_applyDecoratedDescriptor","configurable","enumerable","writable","initializer"],"sourceRoot":".","sources":["MacroAPI.ts"],"sourcesContent":["import deepClone from \"sap/base/util/deepClone\";\nimport merge from \"sap/base/util/merge\";\nimport uid from \"sap/base/util/uid\";\nimport type { PropertiesOf } from \"sap/fe/base/ClassSupport\";\nimport { aggregation, defineUI5Class, implementInterface, property } from \"sap/fe/base/ClassSupport\";\nimport BuildingBlock from \"sap/fe/core/buildingBlocks/BuildingBlock\";\nimport type { TemplateProcessorSettings } from \"sap/fe/core/buildingBlocks/templating/BuildingBlockTemplateProcessor\";\nimport ConverterContext from \"sap/fe/core/converters/ConverterContext\";\nimport type { BaseManifestSettings } from \"sap/fe/core/converters/ManifestSettings\";\nimport ManifestWrapper from \"sap/fe/core/converters/ManifestWrapper\";\nimport type { InternalModelContext } from \"sap/fe/core/helpers/ModelHelper\";\nimport { getTargetObjectPath, type DataModelObjectPath } from \"sap/fe/core/templating/DataModelPathHelper\";\nimport BindingInfo from \"sap/ui/base/BindingInfo\";\nimport type { $ManagedObjectSettings } from \"sap/ui/base/ManagedObject\";\nimport Component from \"sap/ui/core/Component\";\nimport type Control from \"sap/ui/core/Control\";\nimport type { $ControlSettings } from \"sap/ui/core/Control\";\nimport type { IFormContent } from \"sap/ui/core/library\";\nimport type ClientContextBinding from \"sap/ui/model/ClientContextBinding\";\nimport type Context from \"sap/ui/model/Context\";\n\n/**\n * Base API control for building blocks.\n * @hideconstructor\n * @public\n */\n@defineUI5Class(\"sap.fe.macros.MacroAPI\")\nclass MacroAPI<T extends object = {}> extends BuildingBlock<Control, T> implements IFormContent {\n\t@implementInterface(\"sap.ui.core.IFormContent\")\n\t__implements__sap_ui_core_IFormContent = true;\n\n\tstatic namespace = \"sap.fe.macros\";\n\n\tstatic macroName = \"Macro\";\n\n\tstatic fragment = \"sap.fe.macros.Macro\";\n\n\tstatic hasValidation = true;\n\n\t@aggregation({ type: \"sap.ui.core.Control\", multiple: false, isDefault: true })\n\tcontent!: Control;\n\n\tconstructor(mSettings?: $ControlSettings & PropertiesOf<MacroAPI>, others?: $ControlSettings) {\n\t\tsuper(mSettings, others);\n\t}\n\n\tapplySettings(mSettings: $ManagedObjectSettings, oScope?: object): this {\n\t\t// Cleanup events\n\t\tif (mSettings) {\n\t\t\tconst eventsKeys = Object.keys(this.getMetadata().getEvents());\n\t\t\tfor (const eventsKey of eventsKeys) {\n\t\t\t\tif (mSettings[eventsKey as keyof $ManagedObjectSettings] === undefined) {\n\t\t\t\t\tdelete mSettings[eventsKey as keyof $ManagedObjectSettings];\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\treturn super.applySettings(mSettings, oScope);\n\t}\n\n\tinit(): void {\n\t\tsuper.init();\n\t\tif (!this.getModel(\"_pageModel\")) {\n\t\t\tconst oPageModel = Component.getOwnerComponentFor(this)?.getModel(\"_pageModel\");\n\t\t\tif (oPageModel) {\n\t\t\t\tthis.setModel(oPageModel, \"_pageModel\");\n\t\t\t}\n\t\t}\n\t}\n\n\t/**\n\t * Defines the path of the context used in the current page or block.\n\t * This setting is defined by the framework.\n\t * @public\n\t */\n\t@property({ type: \"string\" })\n\tcontextPath!: string;\n\n\t/**\n\t * Defines the relative path of the property in the metamodel, based on the current contextPath.\n\t * @public\n\t */\n\t@property({ type: \"string\" })\n\tmetaPath!: string;\n\n\t/**\n\t * Set or bind a property.\n\t * @param propertyName The name of the property\n\t * @param value The value of the property\n\t */\n\tsetOrBindProperty(propertyName: string, value: unknown): void {\n\t\tif (value !== undefined) {\n\t\t\tlet parsedExpression;\n\t\t\ttry {\n\t\t\t\tparsedExpression = BindingInfo.parse(value);\n\t\t\t} catch (_e) {\n\t\t\t\t// Just ignore the error\n\t\t\t}\n\t\t\tif (parsedExpression || (typeof value === \"string\" && value.startsWith(\"{\"))) {\n\t\t\t\tthis.bindProperty(propertyName, parsedExpression ?? value);\n\t\t\t} else {\n\t\t\t\tif (this.getMetadata().getProperty(propertyName)?.type === \"boolean\" && typeof value === \"string\") {\n\t\t\t\t\tvalue = value === \"true\";\n\t\t\t\t}\n\t\t\t\tthis.setProperty(propertyName, value);\n\t\t\t}\n\t\t}\n\t}\n\n\t/**\n\t * Retrieve a Converter Context.\n\t * @param dataModelObjectPath\n\t * @param contextPath\n\t * @param settings\n\t * @param extraParams\n\t * @returns A Converter Context\n\t */\n\tstatic getConverterContext = function (\n\t\tdataModelObjectPath: DataModelObjectPath<unknown>,\n\t\tcontextPath: string,\n\t\tsettings: TemplateProcessorSettings,\n\t\textraParams?: Record<string, unknown>\n\t): ConverterContext {\n\t\tconst appComponent = settings.appComponent;\n\t\tconst originalViewData = settings.models.viewData?.getData();\n\t\tlet viewData = Object.assign({}, originalViewData);\n\t\tdelete viewData.resourceModel;\n\t\tdelete viewData.appComponent;\n\t\tviewData = deepClone(viewData);\n\t\tlet controlConfiguration = {};\n\n\t\t// Only merge in page control configuration if the building block is on the same context\n\t\tconst relativePath = getTargetObjectPath(dataModelObjectPath.contextLocation ?? dataModelObjectPath);\n\t\tconst entitySetName = dataModelObjectPath.contextLocation?.targetEntitySet?.name ?? dataModelObjectPath.targetEntitySet?.name;\n\t\tif (\n\t\t\trelativePath === originalViewData?.contextPath ||\n\t\t\trelativePath === `/${originalViewData?.entitySet}` ||\n\t\t\tentitySetName === originalViewData?.entitySet\n\t\t) {\n\t\t\tcontrolConfiguration = viewData.controlConfiguration;\n\t\t}\n\t\tviewData.controlConfiguration = merge(controlConfiguration, extraParams || {});\n\n\t\treturn ConverterContext.createConverterContextForMacro(\n\t\t\tdataModelObjectPath.startingEntitySet.name,\n\t\t\tsettings.models.metaModel,\n\t\t\tappComponent?.getDiagnostics(),\n\t\t\tmerge,\n\t\t\tdataModelObjectPath.contextLocation,\n\t\t\tnew ManifestWrapper(viewData as BaseManifestSettings, appComponent)\n\t\t);\n\t};\n\n\t/**\n\t * Create a Binding Context.\n\t * @param oData\n\t * @param mSettings\n\t * @returns The binding context\n\t */\n\tstatic createBindingContext = function (oData: object, mSettings: TemplateProcessorSettings): Context {\n\t\tconst sContextPath = `/uid--${uid()}`;\n\t\tmSettings.models.converterContext.setProperty(sContextPath, oData);\n\t\treturn mSettings.models.converterContext.createBindingContext(sContextPath)!;\n\t};\n\n\tparentContextToBind: Record<string, string> = {};\n\n\t/**\n\t * Keep track of a binding context that should be assigned to the parent of that control.\n\t * @param modelName The model name that the context will relate to\n\t * @param path The path of the binding context\n\t */\n\tsetParentBindingContext(modelName: string, path: string): void {\n\t\tthis.parentContextToBind[modelName] = path;\n\t}\n\n\tsetParent(...args: unknown[]): void {\n\t\t// eslint-disable-next-line @typescript-eslint/ban-ts-comment\n\t\t// @ts-ignore\n\t\tsuper.setParent(...args);\n\t\tObject.keys(this.parentContextToBind).forEach((modelName) => {\n\t\t\tthis.getParent()!.bindObject({\n\t\t\t\tpath: this.parentContextToBind[modelName],\n\t\t\t\tmodel: modelName,\n\t\t\t\tevents: {\n\t\t\t\t\tchange: function (this: ClientContextBinding) {\n\t\t\t\t\t\tconst oBoundContext = this.getBoundContext() as InternalModelContext;\n\t\t\t\t\t\tif (oBoundContext && !oBoundContext.getObject()) {\n\t\t\t\t\t\t\toBoundContext.setProperty(\"\", {});\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\t\t});\n\t}\n}\n\nexport default MacroAPI;\n"],"mappings":"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","ignoreList":[],"file":"MacroAPI-dbg.js"}