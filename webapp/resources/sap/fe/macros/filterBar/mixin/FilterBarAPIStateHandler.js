/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)
 *      (c) Copyright 2009-2025 SAP SE. All rights reserved
 */
sap.ui.define(["sap/base/Log","sap/fe/core/controllerextensions/viewState/IViewStateContributorMixin","sap/fe/core/library","sap/fe/navigation/library","sap/ui/Device","sap/ui/mdc/p13n/StateUtil"],function(t,e,a,n,i,r){"use strict";var o={};var s=n.NavType;var l=a.InitialLoadMode;function c(t,e){t.prototype=Object.create(e.prototype),t.prototype.constructor=t,p(t,e)}function p(t,e){return p=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},p(t,e)}let f=function(e){function a(){return e.apply(this,arguments)||this}o=a;c(a,e);var n=a.prototype;n.applyLegacyState=async function t(e,a,n,i){const r=this.content;const o=e(r);const s={};if(o){s.innerState={...o,fullState:{...s.innerState?.fullState,...o.fullState},initialState:{...s.innerState?.initialState,...o.initialState}}}if(s&&Object.keys(s).length>0){await this.applyState(s,a,n,i)}};n.applyState=async function e(a,n,i,o){try{if(a&&n){const t=n.navigationType;if(t===s.hybrid&&a.innerState?.fullState!==undefined){const t=await this.convertSelectionVariantToStateFilters(n.selectionVariant,true);const e={...a.innerState?.fullState,filter:{...a.innerState?.fullState.filter,...t}};await this._clearFilterValuesWithOptions(this.content,{clearEditFilter:true});return await r.applyExternalState(this.content,e)}if(i){const t=await r.diffState(this.content,a.innerState?.initialState,a.innerState?.fullState);return await r.applyExternalState(this.content,t)}else if(o){await this._clearFilterValuesWithOptions(this.content,{clearEditFilter:true})}return await r.applyExternalState(this.content,a?.innerState?.fullState??a)}}catch(e){t.error(e)}finally{this._initialStatePromise.resolve()}};n.retrieveState=async function t(){const e={};e.innerState=this.getControlState(await r.retrieveExternalState(this.content));const a=this.content.getPropertyInfoSet();const n=e.innerState?.filter||{};a.filter(function(t){return Object.keys(n).length>0&&t.path&&n[t.path]&&(t.removeFromAppState||n[t.path].length===0)}).forEach(function(t){if(t.path){delete n[t.path]}});return e};n.setInitialState=async function e(){try{const t=await r.retrieveExternalState(this.content);this.initialControlState=t}catch(e){t.error(e)}};n.applyNavigationParameters=async function e(a){return new Promise(async e=>{try{const n=this.getPageController()?.getView();const r=this.getPageController();const o=r.getAppComponent();const c=o.getComponentData();const p=c&&c.startupParameters||{};let f;let u=false;if(a.applyVariantFromURLParams??false){f=await this.handleVariantIdPassedViaURLParams(p)}if(f&&f?.length>0){if(f[0]===true||f[1]===true){u=true}}const h=this.getContent();const{selectionVariant:S,requiresStandardVariant:y=false}=a;if(!h||!S){e()}await this._applySelectionVariant(n,a,u);let g=false;const d=this._getFilterBarVM(n);if(h){if(a.navigationType!==s.initial&&y||!d&&n.getViewData().initialLoad===l.Enabled||r._shouldAutoTriggerSearch(d)){const t=h.getParent();t.triggerSearch()}else{g=this._preventInitialSearch(d)}if(!i.system.desktop){const t=n.getBindingContext("internal");const e=this.isSearchTriggeredByInitialLoad(a.navigationType);t.setProperty("searchTriggeredByInitialLoad",e)}this._enableFilterBar(h,g)}else{t.warning("Did not finish applying navigation parameters - Filter bar not found.")}e()}catch{e();t.warning("Could not apply navigation parameters.")}})};return a}(e);o=f;return o},false);
//# sourceMappingURL=FilterBarAPIStateHandler.js.map