{"version":3,"names":["feBundle","Library","getResourceBundleFor","EDITSTATE","ALL","id","display","getText","UNCHANGED","OWN_DRAFT","LOCKED","UNSAVED_CHANGES","ALL_HIDING_DRAFTS","SAVED_ONLY","MY_DRAFTS","getEditStates","isDraftCollaborative","getEditStatesContext","macroProps","availableEditStates","getProperty","JSONModel","bindContext","getBoundContext","getCurrentUserID","ushellContainer","sap","ui","require","getUser","getId","window","adt","userID","getFilterForEditState","editState","Filter","filters","path","operator","FilterOperator","EQ","value1","and","NE","currentUserID","Any","variable","condition"],"sourceRoot":".","sources":["DraftEditState.ts"],"sourcesContent":["import Library from \"sap/ui/core/Lib\";\nimport type Context from \"sap/ui/model/Context\";\nimport Filter from \"sap/ui/model/Filter\";\nimport FilterOperator from \"sap/ui/model/FilterOperator\";\nimport JSONModel from \"sap/ui/model/json/JSONModel\";\n\nconst feBundle = Library.getResourceBundleFor(\"sap.fe.core\")!;\n/**\n * Enum for edit state of a document in an draft enabled service collection.\n * Allows to simplify filtering on a set of documents as described by the\n * individual state\n * @readonly\n * @enum {string}\n */\nconst EDITSTATE = {\n\t/**\n\t * Active documents that don't have a corresponding draft and all own draft documents\n\t */\n\tALL: {\n\t\tid: \"\",\n\t\tdisplay: feBundle.getText(\"C_DRAFT_EDIT_STATE_DRAFT_ALL_FILTER\")\n\t},\n\t/**\n\t * Active documents that don't have a draft document\n\t */\n\tUNCHANGED: {\n\t\tid: \"UNCHANGED\",\n\t\tdisplay: feBundle.getText(\"C_DRAFT_EDIT_STATE_DRAFT_UNCHANGED_FILTER\")\n\t},\n\t/**\n\t * Own draft documents\n\t */\n\tOWN_DRAFT: {\n\t\tid: \"OWN_DRAFT\",\n\t\tdisplay: feBundle.getText(\"C_DRAFT_EDIT_STATE_DRAFT_OWN_DRAFT_FILTER\")\n\t},\n\t/**\n\t * Active documents that are locked by other users\n\t */\n\tLOCKED: {\n\t\tid: \"LOCKED\",\n\t\tdisplay: feBundle.getText(\"C_DRAFT_EDIT_STATE_DRAFT_LOCKED_FILTER\")\n\t},\n\t/**\n\t * Active documents that have draft documents by other users\n\t *\n\t */\n\tUNSAVED_CHANGES: {\n\t\tid: \"UNSAVED_CHANGES\",\n\t\tdisplay: feBundle.getText(\"C_DRAFT_EDIT_STATE_DRAFT_UNSAVED_CHANGES_FILTER\")\n\t},\n\t/**\n\t * Active documents only\n\t */\n\tALL_HIDING_DRAFTS: {\n\t\tid: \"ALL_HIDING_DRAFTS\",\n\t\tdisplay: feBundle.getText(\"C_DRAFT_EDIT_STATE_DRAFT_ALL_HIDING_DRAFTS_FILTER\")\n\t},\n\t/**\n\t * Active documents only (with collaborative draft)\n\t */\n\tSAVED_ONLY: {\n\t\tid: \"SAVED_ONLY\",\n\t\tdisplay: feBundle.getText(\"C_DRAFT_EDIT_STATE_DRAFT_SAVED_ONLY_FILTER\")\n\t},\n\t/**\n\t * My drafts, i.e. the drafts I have created, have been invited to or have made a change in (with collaborative draft)\n\t */\n\tMY_DRAFTS: {\n\t\tid: \"MY_DRAFTS\",\n\t\tdisplay: feBundle.getText(\"C_DRAFT_EDIT_STATE_DRAFT_MY_DRAFTS_FILTER\")\n\t},\n\n\tgetEditStates: function (isDraftCollaborative: boolean): Record<string, string>[] {\n\t\tif (isDraftCollaborative) {\n\t\t\treturn [this.ALL, this.MY_DRAFTS, this.SAVED_ONLY];\n\t\t} else {\n\t\t\treturn [this.ALL, this.ALL_HIDING_DRAFTS, this.UNCHANGED, this.OWN_DRAFT, this.LOCKED, this.UNSAVED_CHANGES];\n\t\t}\n\t},\n\n\t/**\n\t * Determines the context of the edit state of the document.\n\t * @param macroProps The macro properties\n\t * @returns The bound context.\n\t */\n\tgetEditStatesContext: function (macroProps: Context): Context {\n\t\tlet availableEditStates: Record<string, string>[];\n\t\tif (macroProps.getProperty(\"isDraftCollaborative\")) {\n\t\t\tavailableEditStates = [EDITSTATE.ALL, EDITSTATE.MY_DRAFTS, EDITSTATE.SAVED_ONLY];\n\t\t} else {\n\t\t\tavailableEditStates = [\n\t\t\t\tEDITSTATE.ALL,\n\t\t\t\tEDITSTATE.ALL_HIDING_DRAFTS,\n\t\t\t\tEDITSTATE.UNCHANGED,\n\t\t\t\tEDITSTATE.OWN_DRAFT,\n\t\t\t\tEDITSTATE.LOCKED,\n\t\t\t\tEDITSTATE.UNSAVED_CHANGES\n\t\t\t];\n\t\t}\n\n\t\treturn new JSONModel(availableEditStates).bindContext(\"/\").getBoundContext()!;\n\t},\n\n\t/**\n\t * Determines the current user id.\n\t * @returns The id of the current user.\n\t */\n\tgetCurrentUserID: function (): string | undefined {\n\t\t// in case no shell is available (e.g. in standalone mode), we use the user id from the adt object\n\t\tconst ushellContainer = sap.ui.require(\"sap/ushell/Container\");\n\t\treturn ushellContainer?.getUser()?.getId() ?? window.adt?.userID;\n\t},\n\n\t/**\n\t * Determines the filter of the current edit state of the document.\n\t * @param editState The current editState\n\t * @returns The associated filter.\n\t */\n\tgetFilterForEditState: function (editState: string): Filter {\n\t\tswitch (editState) {\n\t\t\tcase EDITSTATE.UNCHANGED.id:\n\t\t\t\treturn new Filter({\n\t\t\t\t\tfilters: [\n\t\t\t\t\t\tnew Filter({ path: \"IsActiveEntity\", operator: FilterOperator.EQ, value1: true }),\n\t\t\t\t\t\tnew Filter({ path: \"HasDraftEntity\", operator: FilterOperator.EQ, value1: false })\n\t\t\t\t\t],\n\t\t\t\t\tand: true\n\t\t\t\t});\n\t\t\tcase EDITSTATE.OWN_DRAFT.id:\n\t\t\t\treturn new Filter({ path: \"IsActiveEntity\", operator: FilterOperator.EQ, value1: false });\n\t\t\tcase EDITSTATE.LOCKED.id:\n\t\t\t\treturn new Filter({\n\t\t\t\t\tfilters: [\n\t\t\t\t\t\tnew Filter({ path: \"IsActiveEntity\", operator: FilterOperator.EQ, value1: true }),\n\t\t\t\t\t\tnew Filter({\n\t\t\t\t\t\t\tpath: \"SiblingEntity/IsActiveEntity\",\n\t\t\t\t\t\t\toperator: FilterOperator.EQ,\n\t\t\t\t\t\t\tvalue1: null\n\t\t\t\t\t\t}),\n\t\t\t\t\t\tnew Filter({\n\t\t\t\t\t\t\tpath: \"DraftAdministrativeData/InProcessByUser\",\n\t\t\t\t\t\t\toperator: FilterOperator.NE,\n\t\t\t\t\t\t\tvalue1: \"\"\n\t\t\t\t\t\t}),\n\t\t\t\t\t\tnew Filter({\n\t\t\t\t\t\t\tpath: \"DraftAdministrativeData/InProcessByUser\",\n\t\t\t\t\t\t\toperator: FilterOperator.NE,\n\t\t\t\t\t\t\tvalue1: null\n\t\t\t\t\t\t})\n\t\t\t\t\t],\n\t\t\t\t\tand: true\n\t\t\t\t});\n\t\t\tcase EDITSTATE.UNSAVED_CHANGES.id:\n\t\t\t\treturn new Filter({\n\t\t\t\t\tfilters: [\n\t\t\t\t\t\tnew Filter({ path: \"IsActiveEntity\", operator: FilterOperator.EQ, value1: true }),\n\t\t\t\t\t\tnew Filter({\n\t\t\t\t\t\t\tpath: \"SiblingEntity/IsActiveEntity\",\n\t\t\t\t\t\t\toperator: FilterOperator.EQ,\n\t\t\t\t\t\t\tvalue1: null\n\t\t\t\t\t\t}),\n\t\t\t\t\t\tnew Filter({\n\t\t\t\t\t\t\tpath: \"DraftAdministrativeData/InProcessByUser\",\n\t\t\t\t\t\t\toperator: FilterOperator.EQ,\n\t\t\t\t\t\t\tvalue1: \"\"\n\t\t\t\t\t\t})\n\t\t\t\t\t],\n\t\t\t\t\tand: true\n\t\t\t\t});\n\t\t\tcase EDITSTATE.ALL_HIDING_DRAFTS.id:\n\t\t\tcase EDITSTATE.SAVED_ONLY.id:\n\t\t\t\treturn new Filter({ path: \"IsActiveEntity\", operator: FilterOperator.EQ, value1: true });\n\t\t\tcase EDITSTATE.MY_DRAFTS.id:\n\t\t\t\tconst currentUserID = this.getCurrentUserID();\n\t\t\t\treturn currentUserID\n\t\t\t\t\t? new Filter({\n\t\t\t\t\t\t\tfilters: [\n\t\t\t\t\t\t\t\tnew Filter({ path: \"IsActiveEntity\", operator: FilterOperator.EQ, value1: false }),\n\t\t\t\t\t\t\t\tnew Filter({\n\t\t\t\t\t\t\t\t\tpath: \"DraftAdministrativeData/DraftAdministrativeUser\",\n\t\t\t\t\t\t\t\t\toperator: FilterOperator.Any,\n\t\t\t\t\t\t\t\t\tvariable: \"user\",\n\t\t\t\t\t\t\t\t\tcondition: new Filter({\n\t\t\t\t\t\t\t\t\t\tpath: \"user/UserID\",\n\t\t\t\t\t\t\t\t\t\toperator: FilterOperator.EQ,\n\t\t\t\t\t\t\t\t\t\tvalue1: this.getCurrentUserID()\n\t\t\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t],\n\t\t\t\t\t\t\tand: true\n\t\t\t\t\t  })\n\t\t\t\t\t: new Filter({ path: \"IsActiveEntity\", operator: FilterOperator.EQ, value1: false }); // Couldn't find current user (e.g. no shell) --> show all drafts\n\t\t\tdefault:\n\t\t\t\t// ALL\n\t\t\t\treturn new Filter({\n\t\t\t\t\tfilters: [\n\t\t\t\t\t\tnew Filter({ path: \"IsActiveEntity\", operator: FilterOperator.EQ, value1: false }),\n\t\t\t\t\t\tnew Filter({\n\t\t\t\t\t\t\tpath: \"SiblingEntity/IsActiveEntity\",\n\t\t\t\t\t\t\toperator: FilterOperator.EQ,\n\t\t\t\t\t\t\tvalue1: null\n\t\t\t\t\t\t})\n\t\t\t\t\t],\n\t\t\t\t\tand: false\n\t\t\t\t});\n\t\t}\n\t}\n};\n\nexport default EDITSTATE;\n"],"mappings":"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","ignoreList":[],"file":"DraftEditState-dbg.js"}