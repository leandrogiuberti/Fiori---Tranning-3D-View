{"version":3,"file":"FilterBarDelegate.js","names":["ODataFilterBarDelegate","Object","assign","FilterBarDelegate","apiVersion","EDIT_STATE_PROPERTY_NAME","SEARCH_PROPERTY_NAME","VALUE_HELP_TYPE","FETCHED_PROPERTIES_DATA_KEY","async","_templateEditState","sIdPrefix","metaModel","oModifier","oThis","JSONModel","id","isDraftCollaborative","ModelHelper","isCollaborationDraftSupported","oPreprocessorSettings","bindingContexts","this","createBindingContext","models","DelegateUtil","templateControlFragment","undefined","finally","destroy","_templateCustomFilter","oFilterBar","oSelectionFieldInfo","oMetaModel","sEntityTypePath","getCustomDataWithModifier","annotationPath","context","getContext","dataModelPath","getInvolvedDataModelObjects","documentRefText","targetObject","annotations","Common","DocumentationRef","toString","oItemModel","TemplateModel","contextPath","item","oView","CommonUtils","getTargetView","oController","getController","oOptions","controller","view","_getPropertyPath","sConditionPath","FilterUtils","getPropertyPathFromConditionPath","_findSelectionField","aSelectionFields","sFlexName","find","oSelectionField","conditionPath","replaceAll","availability","_generateIdPrefix","sFilterBarId","sControlType","sNavigationPrefix","generate","_templateValueHelp","oSettings","oParameters","idPrefix","sVhIdPrefix","conditionModel","navigationPrefix","filterFieldValueHelp","useSemanticDateRange","bUseSemanticDateRange","metaPath","useMultiValueField","requiresValidation","collaborationEnabled","requestGroupId","jsonModel","mergeObjects","targetPath","FieldHelper","valueHelpPropertyForFilterField","isXML","valueHelpXMLString","jsx","renderAsXML","getValueHelpTemplate","getModel","valueHelpXML","DOMParser","parseFromString","Promise","resolve","firstElementChild","then","aVHElements","sAggregationName","Array","isArray","forEach","elt","insertAggregation","oControl","catch","oError","Log","error","valueHelp","_addXMLCustomFilterField","sPropertyPath","aDependents","getAggregation","i","length","oFilterField","isA","sDataProperty","getPropertyKey","sFilterFieldId","getId","indexOf","_templateFilterField","sInFilterBarId","pageModel","vhIdPrefix","propertyPath","sPropertyName","settings","visualFilter","editMode","label","oVisualFilter","converterContext","_addPropertyInfo","oParentControl","mPropertyBag","sPropertyInfoName","sPropertyInfoKey","KeyHelper","getSelectionFieldKeyFromPath","replace","modifier","delegate","getProperty","aPropertyInfo","hasPropertyInfo","some","prop","key","name","entityTypePath","payload","createConverterContext","appComponent","entityType","getEntityType","filterField","getFilterField","propertyInfo","buildProperyInfo","_updatePropertyInfo","errorMsg","warning","propertyBag","parentControl","propertyInfoForFilterBar","propertyInfoForFilterBarObj","JSON","parse","push","stringify","customDataNode","retrieveCustomDataNode","setAttribute","_propertyInfo","formatPropertyInfo","setProperty","addItem","_addP13nItem","model","getMetaModel","targets","_addFlexItem","removeItem","oFilterFieldProperty","doRemoveItem","filterFieldProperty","data","addCondition","removeCondition","propertyInfoFromCD","clearFilters","oFilterControl","filterBarAPI","getParent","StateHelper","clearFilterValues","fetchModel","oModel","fetchPropertiesForEntity","oEntityType","getObject","includeHidden","oConverterContext","sEntitySetPath","getEntitySetPath","mFilterFields","getConvertedFilterFields","getAppComponent","aFetchedProperties","oFilterFieldInfo","sAnnotationPath","template","oPropertyAnnotations","getConvertedTypes","resolvePath","target","sTargetPropertyPrefix","CommonHelper","getLocationForPropertyPath","sProperty","selectionFields","UI","SelectionFields","filterFacets","FilterFacets","_isFilterAdaptable","isPropertyFilterable","aParameterFields","processedFields","processSelectionFields","processedFieldsKeys","oProps","filter","oProp","includes","oFR","getFilterRestrictionsByPath","mAllowedExpressions","FilterAllowedExpressions","iFilterFieldIndex","oSelField","group","groupLabel","path","tooltip","removeFromAppState","hasValueHelp","oProperty","oPropertyContext","bRemoveFromAppState","oFilterDefaultValueAnnotation","oFilterDefaultValue","getModelType","$Type","defaultFilterConditions","fieldPath","operator","values","filterExpression","getSpecificAllowedExpression","visible","propInfo","getResourceModel","getText","typeConfig","TypeMap","getTypeConfig","dataType","formatOptions","constraints","getLocalizedText","isParameter","setCustomData","getLineItemQualifierFromTable","annotationPaths","getMetaPath","split","Visualizations","visualization","$AnnotationPath","metaPaths","filterFieldInfo","propertyAnnotations","isInFilterFacets","isSelectionField","_isFilterInSelectionFields","filterFacet","fieldGroup","Target","$target","Data","dataField","Value","AdaptationHidden","filterFieldKey","selectionField","value","sFlexPropertyName","oAppComponent","bIsXML","type","sNavigationPath","getNavigationPath","sUseSemanticDateRange","sBindingPath","substring","lastIndexOf","sRetrievedEntityTypePath","sRetrievedUseSemanticDateRange","endsWith","property","filterOutNavPropBinding","join","getPath","sValueHelpType","doesValueHelpExist","bValueHelpExists","localId","_getPageModel","_getCachedProperties","window","Element","getCustomData","_setCachedProperties","_getCachedOrFetchPropertiesForEntity","localGroupLabel","oGroup","sortPropertyInfosByGroupLabel","fetchProperties","filterBar","propertyInfos","fetchFilterProperties","getTypeMap"],"sources":["./FilterBarDelegate.ts"],"sourcesContent":["import type { Property } from \"@sap-ux/vocabularies-types\";\nimport type { PropertyAnnotations_Common } from \"@sap-ux/vocabularies-types/vocabularies/Common_Edm\";\nimport type {\n\tDataFieldAbstractTypes,\n\tDataFieldTypes,\n\tFieldGroupType,\n\tFilterFacets,\n\tReferenceFacet,\n\tSelectionFields\n} from \"@sap-ux/vocabularies-types/vocabularies/UI\";\nimport { UIAnnotationTerms } from \"@sap-ux/vocabularies-types/vocabularies/UI\";\nimport Log from \"sap/base/Log\";\nimport mergeObjects from \"sap/base/util/merge\";\nimport type { EnhanceWithUI5 } from \"sap/fe/base/ClassSupport\";\nimport jsx from \"sap/fe/base/jsx-runtime/jsx\";\nimport type AppComponent from \"sap/fe/core/AppComponent\";\nimport type { BaseTreeModifier, PreprocessorSettings } from \"sap/fe/core/CommonUtils\";\nimport CommonUtils from \"sap/fe/core/CommonUtils\";\nimport TemplateModel from \"sap/fe/core/TemplateModel\";\nimport { getInvolvedDataModelObjects } from \"sap/fe/core/converters/MetaModelConverter\";\nimport type {\n\tPropertyInfo as FEPropertyInfo,\n\tFilterField,\n\tPropertyInfoExternal\n} from \"sap/fe/core/converters/controls/ListReport/FilterBar\";\nimport { processSelectionFields, sortPropertyInfosByGroupLabel } from \"sap/fe/core/converters/controls/ListReport/FilterBar\";\nimport { KeyHelper } from \"sap/fe/core/converters/helpers/Key\";\nimport { isPropertyFilterable } from \"sap/fe/core/helpers/MetaModelFunction\";\nimport ModelHelper from \"sap/fe/core/helpers/ModelHelper\";\nimport { getLocalizedText, getResourceModel } from \"sap/fe/core/helpers/ResourceModelHelper\";\nimport { generate } from \"sap/fe/core/helpers/StableIdHelper\";\nimport { hasValueHelp } from \"sap/fe/core/templating/PropertyFormatters\";\nimport { getModelType } from \"sap/fe/core/type/EDM\";\nimport CommonHelper from \"sap/fe/macros/CommonHelper\";\nimport DelegateUtil from \"sap/fe/macros/DelegateUtil\";\nimport FieldHelper from \"sap/fe/macros/field/FieldHelper\";\nimport type { IFilterControl } from \"sap/fe/macros/filter/FilterUtils\";\nimport FilterUtils from \"sap/fe/macros/filter/FilterUtils\";\nimport type { PropertyInfo } from \"sap/fe/macros/internal/PropertyInfo\";\nimport { getValueHelpTemplate } from \"sap/fe/macros/internal/valuehelp/ValueHelpTemplating\";\nimport type { ControlPropertyInfo } from \"sap/fe/macros/mdc/adapter/StateHelper\";\nimport StateHelper from \"sap/fe/macros/mdc/adapter/StateHelper\";\nimport type TableAPI from \"sap/fe/macros/table/TableAPI\";\nimport type ManagedObject from \"sap/ui/base/ManagedObject\";\nimport type UI5Element from \"sap/ui/core/Element\";\nimport type View from \"sap/ui/core/mvc/View\";\nimport type FilterBar from \"sap/ui/mdc/FilterBar\";\nimport FilterBarDelegate from \"sap/ui/mdc/FilterBarDelegate\";\nimport type MDCFilterField from \"sap/ui/mdc/FilterField\";\nimport type ValueHelp from \"sap/ui/mdc/ValueHelp\";\nimport TypeMap from \"sap/ui/mdc/odata/v4/TypeMap\";\nimport type Context from \"sap/ui/model/Context\";\nimport type Model from \"sap/ui/model/Model\";\nimport JSONModel from \"sap/ui/model/json/JSONModel\";\nimport type ODataMetaModel from \"sap/ui/model/odata/v4/ODataMetaModel\";\nimport type MacroAPI from \"../MacroAPI\";\n\ntype ModifierElement = UI5Element | UI5Element[] | Element | Element[];\ntype NullableModifierElement = void | ModifierElement | null;\nconst ODataFilterBarDelegate = Object.assign({}, FilterBarDelegate) as typeof FilterBarDelegate & {\n\tapiVersion: number;\n\t_isFilterInSelectionFields(selectionFields: SelectionFields, filterFieldInfo: FilterField): boolean;\n\t_findSelectionField(aSelectionFields: FilterField[], sFlexName: string): FilterField | undefined;\n\tclearFilters(oFilterControl: FilterBar): Promise<void>;\n\tgetTypeMap(): typeof TypeMap;\n\tfetchFilterProperties(filterBar: IFilterControl): Promise<ControlPropertyInfo[] | PropertyInfoExternal[]>;\n\tfetchProperties(filterBar: FilterBar): Promise<PropertyInfoExternal[]>;\n\t_isFilterAdaptable(\n\t\tfilterFieldInfo: FilterField,\n\t\tpropertyAnnotations: Property,\n\t\tselectionFields?: SelectionFields,\n\t\tfilterFacets?: FilterFacets\n\t): boolean;\n\tfetchPropertiesForEntity(sEntityTypePath: string, oMetaModel: ODataMetaModel, oFilterControl: IFilterControl): PropertyInfo[];\n\t_templateCustomFilter(\n\t\toFilterBar: IFilterControl,\n\t\tsIdPrefix: string,\n\t\toSelectionFieldInfo: FilterField,\n\t\toMetaModel: ODataMetaModel,\n\t\toModifier: BaseTreeModifier\n\t): Promise<ModifierElement>;\n\t_addP13nItem(sPropertyInfoName: string, oParentControl: FilterBar): Promise<NullableModifierElement>;\n\t_addFlexItem(\n\t\tsFlexPropertyName: string,\n\t\toParentControl: FilterBar,\n\t\toMetaModel: ODataMetaModel,\n\t\toModifier: BaseTreeModifier | undefined,\n\t\toAppComponent?: AppComponent,\n\t\tview?: View\n\t): Promise<NullableModifierElement>;\n\taddItem(\n\t\toParentControl: FilterBar,\n\t\tsPropertyInfoName: string,\n\t\tmPropertyBag?: { modifier: BaseTreeModifier; appComponent: AppComponent }\n\t): Promise<NullableModifierElement>;\n\taddCondition(\n\t\toParentControl: FilterBar,\n\t\tsPropertyInfoName: string,\n\t\tmPropertyBag: { appComponent: AppComponent; modifier: BaseTreeModifier }\n\t): Promise<void | null>;\n\tremoveItem(\n\t\toParentControl: FilterBar,\n\t\toFilterFieldProperty: UI5Element | Element,\n\t\tmPropertyBag: { appComponent: AppComponent; modifier: BaseTreeModifier }\n\t): Promise<boolean | null>;\n\tremoveCondition(\n\t\toParentControl: FilterBar,\n\t\tsPropertyInfoName: string,\n\t\tmPropertyBag: {\n\t\t\tappComponent: AppComponent;\n\t\t\tmodifier: BaseTreeModifier;\n\t\t}\n\t): Promise<void | null>;\n};\nODataFilterBarDelegate.apiVersion = 2;\nconst EDIT_STATE_PROPERTY_NAME = \"$editState\",\n\tSEARCH_PROPERTY_NAME = \"$search\",\n\tVALUE_HELP_TYPE = \"FilterFieldValueHelp\",\n\tFETCHED_PROPERTIES_DATA_KEY = \"sap_fe_FilterBarDelegate_propertyInfoMap\";\n\n// For one single entry in UI.SelectionFields\ntype AnnotationSelectionField = {\n\tvalue: string;\n};\n\nasync function _templateEditState(\n\tsIdPrefix: string,\n\tmetaModel: ODataMetaModel,\n\toModifier: BaseTreeModifier | undefined\n): Promise<ModifierElement> {\n\tconst oThis = new JSONModel({\n\t\t\tid: sIdPrefix,\n\t\t\tisDraftCollaborative: ModelHelper.isCollaborationDraftSupported(metaModel)\n\t\t}),\n\t\toPreprocessorSettings = {\n\t\t\tbindingContexts: {\n\t\t\t\tthis: oThis.createBindingContext(\"/\")\n\t\t\t},\n\t\t\tmodels: {\n\t\t\t\t//\"this.i18n\": ResourceModel.getModel(), TODO: To be checked why this is needed, should not be needed at all\n\t\t\t\tthis: oThis\n\t\t\t}\n\t\t};\n\n\treturn DelegateUtil.templateControlFragment(\n\t\t\"sap.fe.macros.filterBar.DraftEditState\",\n\t\toPreprocessorSettings,\n\t\tundefined,\n\t\toModifier\n\t).finally(function () {\n\t\toThis.destroy();\n\t});\n}\n\nODataFilterBarDelegate._templateCustomFilter = async function (\n\toFilterBar: IFilterControl,\n\tsIdPrefix: string,\n\toSelectionFieldInfo: FilterField,\n\toMetaModel: ODataMetaModel,\n\toModifier: BaseTreeModifier\n): Promise<ModifierElement> {\n\tconst sEntityTypePath = await DelegateUtil.getCustomDataWithModifier<string>(oFilterBar, \"entityType\", oModifier);\n\n\tif (oSelectionFieldInfo.annotationPath !== undefined) {\n\t\t// if property is not defined in the manifest\n\t\ttype PropertyAnnotations_Common_extended = PropertyAnnotations_Common & { DocumentationRef?: string };\n\t\tconst context = oMetaModel.getContext(oSelectionFieldInfo.annotationPath),\n\t\t\tdataModelPath = getInvolvedDataModelObjects<Property>(context),\n\t\t\tdocumentRefText = (\n\t\t\t\tdataModelPath.targetObject?.annotations.Common as PropertyAnnotations_Common_extended\n\t\t\t)?.DocumentationRef?.toString();\n\t\toSelectionFieldInfo.documentRefText = documentRefText;\n\t}\n\n\tconst oThis = new JSONModel({\n\t\t\tid: sIdPrefix\n\t\t}),\n\t\toItemModel = new TemplateModel(oSelectionFieldInfo, oMetaModel),\n\t\toPreprocessorSettings = {\n\t\t\tbindingContexts: {\n\t\t\t\tcontextPath: oMetaModel.createBindingContext(sEntityTypePath!),\n\t\t\t\tthis: oThis.createBindingContext(\"/\"),\n\t\t\t\titem: oItemModel.createBindingContext(\"/\")\n\t\t\t},\n\t\t\tmodels: {\n\t\t\t\tcontextPath: oMetaModel,\n\t\t\t\tthis: oThis,\n\t\t\t\titem: oItemModel\n\t\t\t}\n\t\t},\n\t\toView = CommonUtils.getTargetView(oFilterBar),\n\t\toController = oView ? oView.getController() : undefined,\n\t\toOptions = {\n\t\t\tcontroller: oController ? oController : undefined,\n\t\t\tview: oView\n\t\t};\n\n\treturn DelegateUtil.templateControlFragment(\"sap.fe.macros.filter.CustomFilter\", oPreprocessorSettings, oOptions, oModifier).finally(\n\t\tfunction () {\n\t\t\toThis.destroy();\n\t\t\toItemModel.destroy();\n\t\t}\n\t);\n};\nfunction _getPropertyPath(sConditionPath: string): string {\n\treturn FilterUtils.getPropertyPathFromConditionPath(sConditionPath);\n}\nODataFilterBarDelegate._findSelectionField = function (aSelectionFields: FilterField[], sFlexName: string): FilterField | undefined {\n\treturn aSelectionFields.find(function (oSelectionField: FilterField) {\n\t\treturn (\n\t\t\t(oSelectionField.conditionPath === sFlexName || oSelectionField.conditionPath.replaceAll(/\\*/g, \"\") === sFlexName) &&\n\t\t\toSelectionField.availability !== \"Hidden\"\n\t\t);\n\t});\n};\nfunction _generateIdPrefix(sFilterBarId: string, sControlType: string, sNavigationPrefix?: string): string {\n\treturn sNavigationPrefix ? generate([sFilterBarId, sControlType, sNavigationPrefix]) : generate([sFilterBarId, sControlType]);\n}\nasync function _templateValueHelp(\n\toSettings: {\n\t\tisXML: boolean;\n\t\tbindingContexts: {\n\t\t\tmetaPath: Context;\n\t\t\tcontextPath: Context;\n\t\t};\n\t\tmodels: {\n\t\t\tmetaPath: ODataMetaModel;\n\t\t\tcontextPath: ODataMetaModel;\n\t\t};\n\t},\n\toParameters: {\n\t\tsVhIdPrefix: string;\n\t\tsNavigationPrefix?: string;\n\t\tbUseSemanticDateRange: boolean;\n\t\toModifier?: BaseTreeModifier;\n\t\toControl: UI5Element;\n\t\tview?: View;\n\t}\n): Promise<void> {\n\tconst oThis = {\n\t\tidPrefix: oParameters.sVhIdPrefix,\n\t\tconditionModel: \"$filters\",\n\t\tnavigationPrefix: oParameters.sNavigationPrefix ? `/${oParameters.sNavigationPrefix}` : \"\",\n\t\tfilterFieldValueHelp: true,\n\t\tuseSemanticDateRange: oParameters.bUseSemanticDateRange,\n\t\tmetaPath: oSettings.bindingContexts.metaPath,\n\t\tcontextPath: oSettings.bindingContexts.contextPath,\n\t\tuseMultiValueField: false,\n\t\trequiresValidation: false,\n\t\tcollaborationEnabled: false,\n\t\trequestGroupId: undefined\n\t};\n\tconst jsonModel = new JSONModel(oThis);\n\tconst oPreprocessorSettings = mergeObjects({}, oSettings, {\n\t\tbindingContexts: {\n\t\t\tthis: jsonModel.createBindingContext(\"/\")\n\t\t},\n\t\tmodels: {\n\t\t\tthis: oThis\n\t\t}\n\t}) as PreprocessorSettings;\n\tconst targetPath = FieldHelper.valueHelpPropertyForFilterField(oSettings.bindingContexts.metaPath);\n\n\tif (oSettings.isXML) {\n\t\tlet valueHelpXMLString = jsx.renderAsXML<string | undefined>(\n\t\t\t() =>\n\t\t\t\tgetValueHelpTemplate(oSettings.bindingContexts.metaPath.getModel().createBindingContext(targetPath), oThis) as\n\t\t\t\t\t| string\n\t\t\t\t\t| undefined\n\t\t);\n\t\tif (valueHelpXMLString) {\n\t\t\tif (oSettings.isXML) {\n\t\t\t\tvalueHelpXMLString = `<root>${valueHelpXMLString}</root>`;\n\t\t\t}\n\t\t\tconst valueHelpXML = new DOMParser().parseFromString(valueHelpXMLString, \"text/xml\");\n\t\t\treturn Promise.resolve(\n\t\t\t\tDelegateUtil.templateControlFragment(valueHelpXML.firstElementChild, oPreprocessorSettings, {\n\t\t\t\t\tisXML: oSettings.isXML\n\t\t\t\t})\n\t\t\t)\n\t\t\t\t.then(async function (aVHElements: ModifierElement): Promise<void> {\n\t\t\t\t\tif (aVHElements) {\n\t\t\t\t\t\tconst sAggregationName = \"dependents\";\n\t\t\t\t\t\t//Some filter fields have the PersistenceProvider aggregation besides the FVH :\n\t\t\t\t\t\tif (Array.isArray(aVHElements)) {\n\t\t\t\t\t\t\taVHElements.forEach(function (elt: Element | UI5Element) {\n\t\t\t\t\t\t\t\tif (oParameters.oModifier) {\n\t\t\t\t\t\t\t\t\toParameters.oModifier.insertAggregation(oParameters.oControl, sAggregationName, elt, 0);\n\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\toParameters.oControl.insertAggregation(sAggregationName, elt as UI5Element, 0, false);\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t} else if (oParameters.oModifier) {\n\t\t\t\t\t\t\treturn oParameters.oModifier.insertAggregation(\n\t\t\t\t\t\t\t\toParameters.oControl,\n\t\t\t\t\t\t\t\tsAggregationName,\n\t\t\t\t\t\t\t\taVHElements,\n\t\t\t\t\t\t\t\t0,\n\t\t\t\t\t\t\t\toParameters.view as unknown as Element\n\t\t\t\t\t\t\t);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\toParameters.oControl.insertAggregation(sAggregationName, aVHElements as UI5Element, 0, false);\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\treturn;\n\t\t\t\t})\n\t\t\t\t.catch(function (oError: unknown) {\n\t\t\t\t\tLog.error(\"Error while evaluating DelegateUtil.isValueHelpRequired\", oError as string);\n\t\t\t\t})\n\t\t\t\t.finally(function () {\n\t\t\t\t\tjsonModel.destroy();\n\t\t\t\t});\n\t\t}\n\t} else {\n\t\tconst valueHelp = getValueHelpTemplate(oSettings.bindingContexts.metaPath.getModel().createBindingContext(targetPath), oThis) as\n\t\t\t| ValueHelp\n\t\t\t| undefined;\n\t\tif (valueHelp) {\n\t\t\tconst sAggregationName = \"dependents\";\n\t\t\t//Some filter fields have the PersistenceProvider aggregation besides the FVH :\n\t\t\tif (Array.isArray(valueHelp)) {\n\t\t\t\tvalueHelp.forEach(function (elt: Element | UI5Element) {\n\t\t\t\t\tif (oParameters.oModifier) {\n\t\t\t\t\t\toParameters.oModifier.insertAggregation(oParameters.oControl, sAggregationName, elt, 0);\n\t\t\t\t\t} else {\n\t\t\t\t\t\toParameters.oControl.insertAggregation(sAggregationName, elt as UI5Element, 0, false);\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t} else if (oParameters.oModifier) {\n\t\t\t\toParameters.oModifier.insertAggregation(oParameters.oControl, sAggregationName, valueHelp, 0);\n\t\t\t} else {\n\t\t\t\toParameters.oControl.insertAggregation(sAggregationName, valueHelp, 0, false);\n\t\t\t}\n\t\t}\n\t}\n}\nasync function _addXMLCustomFilterField(\n\toFilterBar: IFilterControl,\n\toModifier: BaseTreeModifier,\n\tsPropertyPath: string\n): Promise<UI5Element | Element | void> {\n\ttry {\n\t\tconst aDependents = await Promise.resolve(oModifier.getAggregation(oFilterBar, \"dependents\"));\n\t\tlet i;\n\t\tif (aDependents && aDependents.length > 1) {\n\t\t\tfor (i = 0; i <= aDependents.length; i++) {\n\t\t\t\tconst oFilterField = aDependents[i];\n\t\t\t\tif (oFilterField && (oFilterField as UI5Element).isA<MDCFilterField>(\"sap.ui.mdc.FilterField\")) {\n\t\t\t\t\tconst sDataProperty = (oFilterField as MDCFilterField).getPropertyKey(),\n\t\t\t\t\t\tsFilterFieldId = (oFilterField as MDCFilterField).getId();\n\t\t\t\t\tif (sPropertyPath === sDataProperty && sFilterFieldId.indexOf(\"CustomFilterField\")) {\n\t\t\t\t\t\treturn oFilterField;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t} catch (oError) {\n\t\tLog.error(\"Filter Cannot be added\", oError as string);\n\t}\n}\n\nasync function _templateFilterField(\n\toSettings: Record<string, unknown>,\n\toParameters: Record<string, unknown>,\n\tsInFilterBarId?: string,\n\tpageModel?: JSONModel\n): Promise<UI5Element | UI5Element[] | Element | Element[]> {\n\tconst oThis = new JSONModel({\n\t\tidPrefix: oParameters.sIdPrefix,\n\t\tvhIdPrefix: oParameters.sVhIdPrefix,\n\t\tpropertyPath: oParameters.sPropertyName,\n\t\tnavigationPrefix: oParameters.sNavigationPrefix ? `/${oParameters.sNavigationPrefix}` : \"\",\n\t\tuseSemanticDateRange: oParameters.bUseSemanticDateRange,\n\t\tsettings: oParameters.oSettings,\n\t\tvisualFilter: oParameters.visualFilter,\n\t\teditMode: `{internal>/${sInFilterBarId}/filterFields/${oParameters.sPropertyName}/editMode}`,\n\t\tlabel: oParameters.label\n\t});\n\ttry {\n\t\tconst oMetaModel = oParameters.oMetaModel as ODataMetaModel;\n\t\tconst oVisualFilter = new TemplateModel(oParameters.visualFilter as object, oMetaModel);\n\t\tconst oPreprocessorSettings = mergeObjects({}, oSettings, {\n\t\t\tbindingContexts: {\n\t\t\t\tthis: oThis.createBindingContext(\"/\"),\n\t\t\t\tvisualFilter: oVisualFilter.createBindingContext(\"/\")\n\t\t\t},\n\t\t\tmodels: {\n\t\t\t\tthis: oThis,\n\t\t\t\tvisualFilter: oVisualFilter,\n\t\t\t\tmetaModel: oMetaModel,\n\t\t\t\tconverterContext: pageModel\n\t\t\t}\n\t\t}) as PreprocessorSettings;\n\n\t\treturn await DelegateUtil.templateControlFragment(\"sap.fe.macros.internal.filterField.FilterFieldTemplate\", oPreprocessorSettings, {\n\t\t\tisXML: !!oSettings.isXML\n\t\t});\n\t} finally {\n\t\toThis.destroy();\n\t}\n}\n\nasync function _addPropertyInfo(\n\toParentControl: FilterBar,\n\tmPropertyBag: { modifier: BaseTreeModifier; appComponent: AppComponent },\n\toMetaModel: ODataMetaModel,\n\tsPropertyInfoName: string\n): Promise<void> {\n\ttry {\n\t\t// key should have the same value as name\n\t\tconst sPropertyInfoKey = KeyHelper.getSelectionFieldKeyFromPath(sPropertyInfoName);\n\t\tsPropertyInfoName = sPropertyInfoName.replace(\"*\", \"\");\n\t\tif (mPropertyBag && !mPropertyBag.modifier) {\n\t\t\tthrow \"FilterBar Delegate method called without modifier.\";\n\t\t}\n\n\t\tconst delegate = await mPropertyBag.modifier.getProperty<FilterBarDelegate>(oParentControl, \"delegate\");\n\t\tconst aPropertyInfo = await mPropertyBag.modifier.getProperty<FEPropertyInfo[]>(oParentControl, \"propertyInfo\");\n\t\t//We do not get propertyInfo in case of table filters\n\t\tif (aPropertyInfo) {\n\t\t\tconst hasPropertyInfo = aPropertyInfo.some(function (prop: FEPropertyInfo) {\n\t\t\t\treturn prop.key === sPropertyInfoKey || prop.name === sPropertyInfoKey;\n\t\t\t});\n\t\t\tif (!hasPropertyInfo) {\n\t\t\t\tconst entityTypePath = delegate.payload.entityTypePath;\n\t\t\t\tconst converterContext = FilterUtils.createConverterContext(\n\t\t\t\t\toParentControl as unknown as IFilterControl,\n\t\t\t\t\tentityTypePath,\n\t\t\t\t\toMetaModel,\n\t\t\t\t\tmPropertyBag.appComponent\n\t\t\t\t);\n\t\t\t\tconst entityType = converterContext.getEntityType();\n\t\t\t\tconst filterField = FilterUtils.getFilterField(sPropertyInfoName, converterContext, entityType);\n\t\t\t\tconst propertyInfo = FilterUtils.buildProperyInfo(filterField!, converterContext);\n\t\t\t\tawait _updatePropertyInfo(\n\t\t\t\t\taPropertyInfo as PropertyInfo[],\n\t\t\t\t\tmPropertyBag,\n\t\t\t\t\tpropertyInfo as unknown as PropertyInfo,\n\t\t\t\t\toParentControl\n\t\t\t\t);\n\t\t\t}\n\t\t}\n\t} catch (errorMsg) {\n\t\tLog.warning(`${oParentControl.getId()} : ${errorMsg}`);\n\t}\n}\n\nasync function _updatePropertyInfo(\n\tpropertyInfo: PropertyInfo[],\n\tpropertyBag: { modifier: BaseTreeModifier; appComponent: AppComponent },\n\tfilterField: PropertyInfo,\n\tparentControl: FilterBar\n): Promise<void> {\n\tlet propertyInfoForFilterBar = await DelegateUtil.getCustomDataWithModifier<string>(\n\t\tparentControl,\n\t\t\"feFilterInfo\",\n\t\tpropertyBag.modifier\n\t);\n\tif (propertyInfoForFilterBar && propertyInfoForFilterBar.length > 0) {\n\t\tconst propertyInfoForFilterBarObj = JSON.parse(propertyInfoForFilterBar) as PropertyInfo[];\n\t\tpropertyInfoForFilterBarObj.push(filterField);\n\t\tpropertyInfoForFilterBar = JSON.stringify(propertyInfoForFilterBarObj);\n\t\tpropertyInfoForFilterBar = propertyInfoForFilterBar.replace(/\\{/g, \"\\\\{\");\n\t\tpropertyInfoForFilterBar = propertyInfoForFilterBar.replace(/\\}/g, \"\\\\}\");\n\t\tconst customDataNode = await DelegateUtil.retrieveCustomDataNode(parentControl, \"feFilterInfo\", propertyBag.modifier);\n\t\tcustomDataNode[0].setAttribute(\"value\", propertyInfoForFilterBar);\n\t\tpropertyBag.modifier.insertAggregation(parentControl, \"customData\", customDataNode[0], 0);\n\t}\n\n\t// Custom data is set to the parent control to store the propertyInfo\n\tpropertyInfo.push(filterField);\n\t//remove unwanted property from the propertyInfo\n\tconst _propertyInfo = FilterUtils.formatPropertyInfo(propertyInfo as FEPropertyInfo[]);\n\t//Update the propertyInfo in the parent control\n\tpropertyBag.modifier.setProperty(parentControl, \"propertyInfo\", _propertyInfo);\n}\n/**\n * Method responsible for creating filter field in standalone mode / in the personalization settings of the filter bar.\n * @param oParentControl Parent control instance to which the filter field is added\n * @param sPropertyInfoName Name of the property being added as the filter field\n * @param mPropertyBag Instance of the property bag from Flex API\n * @param mPropertyBag.appComponent AppComponent\n * @param mPropertyBag.modifier Modifier from Flex API\n * @returns Once resolved, a filter field definition is returned\n */\nODataFilterBarDelegate.addItem = async function (\n\toParentControl: FilterBar,\n\tsPropertyInfoName: string,\n\tmPropertyBag?: { view: View; modifier: BaseTreeModifier; appComponent: AppComponent }\n): Promise<NullableModifierElement> {\n\tif (!mPropertyBag) {\n\t\t// Invoked during runtime.\n\t\treturn ODataFilterBarDelegate._addP13nItem(sPropertyInfoName, oParentControl);\n\t}\n\tconst modifier = mPropertyBag.modifier;\n\tconst model = mPropertyBag && mPropertyBag.appComponent && mPropertyBag.appComponent.getModel();\n\tconst oMetaModel = model && model.getMetaModel();\n\tif (!oMetaModel) {\n\t\treturn Promise.resolve(null);\n\t}\n\tconst isXML = modifier && modifier.targets === \"xmlTree\";\n\tif (isXML) {\n\t\tawait _addPropertyInfo(oParentControl, mPropertyBag, oMetaModel, sPropertyInfoName);\n\t}\n\treturn ODataFilterBarDelegate._addFlexItem(\n\t\tsPropertyInfoName,\n\t\toParentControl,\n\t\toMetaModel,\n\t\tmodifier,\n\t\tmPropertyBag.appComponent,\n\t\tmPropertyBag.view\n\t);\n};\n\n/**\n * Method responsible for removing filter field in standalone / personalization filter bar.\n * @param oParentControl Parent control instance from which the filter field is removed\n * @param oFilterFieldProperty Object of the filter field property being removed as filter field\n * @param mPropertyBag Instance of property bag from Flex API\n * @param mPropertyBag.appComponent AppComponent\n * @param mPropertyBag.modifier Modifier from Flex API\n * @returns The resolved promise\n */\nODataFilterBarDelegate.removeItem = async function (\n\toParentControl: FilterBar,\n\toFilterFieldProperty: UI5Element | Element,\n\tmPropertyBag: { appComponent: AppComponent; modifier: BaseTreeModifier }\n): Promise<boolean | null> {\n\tlet doRemoveItem = true;\n\tconst modifier = mPropertyBag.modifier;\n\tconst isXML = modifier && modifier.targets === \"xmlTree\";\n\tif (isXML) {\n\t\tconst model = mPropertyBag && mPropertyBag.appComponent && mPropertyBag.appComponent.getModel();\n\t\tconst oMetaModel = model && model.getMetaModel();\n\t\tif (!oMetaModel) {\n\t\t\treturn Promise.resolve(null);\n\t\t}\n\t\tconst filterFieldProperty = await mPropertyBag.modifier.getProperty(oFilterFieldProperty, \"propertyKey\");\n\t\tawait _addPropertyInfo(oParentControl, mPropertyBag, oMetaModel, filterFieldProperty as string);\n\t}\n\tif (\n\t\ttypeof oFilterFieldProperty !== \"string\" &&\n\t\t(oFilterFieldProperty as UI5Element).isA &&\n\t\t(oFilterFieldProperty as UI5Element).isA(\"sap.ui.mdc.FilterField\")\n\t) {\n\t\tif ((oFilterFieldProperty as UI5Element).data(\"isSlot\") === \"true\" && mPropertyBag) {\n\t\t\t// Inserting into the modifier creates a change from flex also filter is been removed hence promise is resolved to false\n\t\t\tmodifier.insertAggregation(oParentControl, \"dependents\", oFilterFieldProperty);\n\t\t\tdoRemoveItem = false;\n\t\t}\n\t}\n\treturn Promise.resolve(doRemoveItem);\n};\n\n/**\n * Method responsible for creating filter field condition in standalone / personalization filter bar.\n * @param oParentControl Parent control instance to which the filter field is added\n * @param sPropertyInfoName Name of the property being added as filter field\n * @param mPropertyBag Instance of property bag from Flex API\n * @param mPropertyBag.appComponent AppComponent\n * @param mPropertyBag.modifier Modifier from Flex API\n * @returns The resolved promise\n */\nODataFilterBarDelegate.addCondition = async function (\n\toParentControl: FilterBar,\n\tsPropertyInfoName: string,\n\tmPropertyBag: { appComponent: AppComponent; modifier: BaseTreeModifier }\n): Promise<void | null> {\n\tconst modifier = mPropertyBag.modifier;\n\tconst isXML = modifier && modifier.targets === \"xmlTree\";\n\tif (isXML) {\n\t\tconst model = mPropertyBag && mPropertyBag.appComponent && mPropertyBag.appComponent.getModel();\n\t\tconst oMetaModel = model && model.getMetaModel();\n\t\tif (!oMetaModel) {\n\t\t\treturn Promise.resolve(null);\n\t\t}\n\t\tawait _addPropertyInfo(oParentControl, mPropertyBag, oMetaModel, sPropertyInfoName);\n\t}\n\treturn Promise.resolve();\n};\n\n/**\n * Method responsible for removing filter field in standalone / personalization filter bar.\n * @param oParentControl Parent control instance from which the filter field is removed\n * @param sPropertyInfoName Name of the property being removed as filter field\n * @param mPropertyBag Instance of property bag from Flex API\n * @param mPropertyBag.appComponent AppComponent\n * @param mPropertyBag.modifier Modifier from Flex API\n * @returns The resolved promise\n */\nODataFilterBarDelegate.removeCondition = async function (\n\toParentControl: FilterBar,\n\tsPropertyInfoName: string,\n\tmPropertyBag: {\n\t\tappComponent: AppComponent;\n\t\tmodifier: BaseTreeModifier;\n\t}\n): Promise<void | null> {\n\tconst modifier = mPropertyBag.modifier;\n\tconst isXML = modifier && modifier.targets === \"xmlTree\";\n\tif (isXML) {\n\t\tconst propertyInfoFromCD = await DelegateUtil.getCustomDataWithModifier<string>(\n\t\t\toParentControl,\n\t\t\t\"sap_fe_FilterBarDelegate_propertyInfoMap\",\n\t\t\tmodifier\n\t\t);\n\t\tif (!propertyInfoFromCD) {\n\t\t\tconst model = mPropertyBag && mPropertyBag.appComponent && mPropertyBag.appComponent.getModel();\n\t\t\tconst oMetaModel = model && model.getMetaModel();\n\t\t\tif (!oMetaModel) {\n\t\t\t\treturn Promise.resolve(null);\n\t\t\t}\n\t\t\tawait _addPropertyInfo(oParentControl, mPropertyBag, oMetaModel, sPropertyInfoName);\n\t\t}\n\t}\n\treturn Promise.resolve();\n};\n/**\n * Clears all input values of visible filter fields in the filter bar.\n * @param oFilterControl Instance of the FilterBar control\n * @returns The resolved promise\n */\nODataFilterBarDelegate.clearFilters = async function (oFilterControl: FilterBar): Promise<void> {\n\tconst filterBarAPI = oFilterControl.getParent();\n\treturn StateHelper.clearFilterValues(filterBarAPI as MacroAPI);\n};\n/**\n * Creates the filter field in the table adaptation of the FilterBar.\n * @param sPropertyInfoName The property name of the entity type for which the filter field needs to be created\n * @param oParentControl Instance of the parent control\n * @returns Once resolved, a filter field definition is returned\n */\nODataFilterBarDelegate._addP13nItem = async function (\n\tsPropertyInfoName: string,\n\toParentControl: FilterBar\n): Promise<NullableModifierElement> {\n\treturn DelegateUtil.fetchModel(oParentControl)\n\t\t.then(async function (oModel: Model) {\n\t\t\treturn ODataFilterBarDelegate._addFlexItem(\n\t\t\t\tsPropertyInfoName,\n\t\t\t\toParentControl,\n\t\t\t\toModel.getMetaModel() as ODataMetaModel,\n\t\t\t\tundefined\n\t\t\t);\n\t\t})\n\t\t.catch(function (oError) {\n\t\t\tLog.error(\"Model could not be resolved\", oError as string);\n\t\t\treturn null;\n\t\t});\n};\nODataFilterBarDelegate.fetchPropertiesForEntity = function (\n\tsEntityTypePath: string,\n\toMetaModel: ODataMetaModel,\n\toFilterControl: IFilterControl\n): PropertyInfo[] {\n\tconst oEntityType = oMetaModel.getObject(sEntityTypePath);\n\tconst includeHidden = oFilterControl.isA(\"sap.ui.mdc.valuehelp.FilterBar\") ? true : undefined;\n\tif (!oFilterControl || !oEntityType) {\n\t\treturn [];\n\t}\n\tconst oConverterContext = FilterUtils.createConverterContext(oFilterControl, sEntityTypePath);\n\tconst sEntitySetPath = ModelHelper.getEntitySetPath(sEntityTypePath);\n\n\tconst mFilterFields = FilterUtils.getConvertedFilterFields(\n\t\toFilterControl,\n\t\tsEntityTypePath,\n\t\tincludeHidden,\n\t\toMetaModel,\n\t\tCommonUtils.getAppComponent(oFilterControl)\n\t);\n\tlet aFetchedProperties: FEPropertyInfo[] = [];\n\tmFilterFields.forEach(function (oFilterFieldInfo: FilterField) {\n\t\tconst sAnnotationPath = oFilterFieldInfo.annotationPath;\n\t\tif (sAnnotationPath && !oFilterFieldInfo.template) {\n\t\t\tconst oPropertyAnnotations = oConverterContext.getConvertedTypes().resolvePath<Property>(sAnnotationPath).target;\n\t\t\tconst sTargetPropertyPrefix = CommonHelper.getLocationForPropertyPath(oMetaModel, sAnnotationPath);\n\t\t\tconst sProperty = sAnnotationPath.replace(`${sTargetPropertyPrefix}/`, \"\");\n\t\t\tconst entityType = oConverterContext.getEntityType();\n\t\t\tconst selectionFields = entityType.annotations?.UI?.SelectionFields;\n\t\t\tconst filterFacets = entityType.annotations?.UI?.FilterFacets;\n\t\t\tif (\n\t\t\t\toPropertyAnnotations &&\n\t\t\t\tODataFilterBarDelegate._isFilterAdaptable(oFilterFieldInfo, oPropertyAnnotations, selectionFields, filterFacets) &&\n\t\t\t\tisPropertyFilterable(oMetaModel, sTargetPropertyPrefix, _getPropertyPath(sProperty), true)\n\t\t\t) {\n\t\t\t\taFetchedProperties.push(oFilterFieldInfo as PropertyInfo);\n\t\t\t}\n\t\t} else {\n\t\t\t//Custom Filters\n\t\t\taFetchedProperties.push(oFilterFieldInfo as PropertyInfo);\n\t\t}\n\t});\n\n\tconst aParameterFields: string[] = [];\n\tconst processedFields = processSelectionFields(aFetchedProperties as FilterField[], oConverterContext);\n\tconst processedFieldsKeys: string[] = [];\n\tprocessedFields.forEach(function (oProps: FEPropertyInfo) {\n\t\tif (oProps.key) {\n\t\t\tprocessedFieldsKeys.push(oProps.key);\n\t\t}\n\t});\n\n\taFetchedProperties = aFetchedProperties.filter(function (oProp: FEPropertyInfo) {\n\t\treturn processedFieldsKeys.includes(oProp.key!);\n\t});\n\n\tconst oFR = CommonUtils.getFilterRestrictionsByPath(sEntitySetPath, oMetaModel),\n\t\tmAllowedExpressions = oFR.FilterAllowedExpressions;\n\t//Object.keys(processedFields).forEach(function (sFilterFieldKey: string) {\n\tprocessedFields.forEach(function (oProp, iFilterFieldIndex: number) {\n\t\tconst oSelField = aFetchedProperties[iFilterFieldIndex];\n\t\tif (!oSelField || !oSelField.conditionPath) {\n\t\t\treturn;\n\t\t}\n\t\tconst sPropertyPath = _getPropertyPath(oSelField.conditionPath);\n\t\t//fetchBasic\n\t\toProp = Object.assign(oProp, {\n\t\t\tgroup: oSelField.group,\n\t\t\tgroupLabel: oSelField.groupLabel,\n\t\t\tpath: oSelField.conditionPath,\n\t\t\ttooltip: null,\n\t\t\tremoveFromAppState: false,\n\t\t\thasValueHelp: false\n\t\t});\n\n\t\t//fetchPropInfo\n\t\tif (oSelField.annotationPath) {\n\t\t\tconst sAnnotationPath = oSelField.annotationPath;\n\t\t\tconst oProperty = oMetaModel.getObject(sAnnotationPath),\n\t\t\t\toPropertyAnnotations = oMetaModel.getObject(`${sAnnotationPath}@`),\n\t\t\t\toPropertyContext = oMetaModel.createBindingContext(sAnnotationPath);\n\n\t\t\tconst bRemoveFromAppState =\n\t\t\t\toPropertyAnnotations[\"@com.sap.vocabularies.PersonalData.v1.IsPotentiallySensitive\"] ||\n\t\t\t\toPropertyAnnotations[\"@com.sap.vocabularies.UI.v1.ExcludeFromNavigationContext\"] ||\n\t\t\t\toPropertyAnnotations[\"@com.sap.vocabularies.Analytics.v1.Measure\"];\n\n\t\t\tconst sTargetPropertyPrefix = CommonHelper.getLocationForPropertyPath(oMetaModel, oSelField.annotationPath);\n\t\t\tconst sProperty = sAnnotationPath.replace(`${sTargetPropertyPrefix}/`, \"\");\n\t\t\tlet oFilterDefaultValueAnnotation;\n\t\t\tlet oFilterDefaultValue;\n\t\t\tif (oPropertyContext && isPropertyFilterable(oMetaModel, sTargetPropertyPrefix, _getPropertyPath(sProperty), true)) {\n\t\t\t\toFilterDefaultValueAnnotation = oPropertyAnnotations[\"@com.sap.vocabularies.Common.v1.FilterDefaultValue\"];\n\t\t\t\tif (oFilterDefaultValueAnnotation) {\n\t\t\t\t\toFilterDefaultValue = oFilterDefaultValueAnnotation[`$${getModelType(oProperty.$Type)}`];\n\t\t\t\t}\n\n\t\t\t\toProp = Object.assign(oProp, {\n\t\t\t\t\ttooltip: oPropertyAnnotations[\"@com.sap.vocabularies.Common.v1.QuickInfo\"] || undefined,\n\t\t\t\t\tremoveFromAppState: bRemoveFromAppState,\n\t\t\t\t\thasValueHelp: hasValueHelp(oPropertyContext.getObject(), { context: oPropertyContext }),\n\t\t\t\t\tdefaultFilterConditions: oFilterDefaultValue\n\t\t\t\t\t\t? [\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\tfieldPath: oSelField.conditionPath,\n\t\t\t\t\t\t\t\t\toperator: \"EQ\",\n\t\t\t\t\t\t\t\t\tvalues: [oFilterDefaultValue]\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t  ]\n\t\t\t\t\t\t: undefined\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\n\t\t//base\n\n\t\tif (oProp) {\n\t\t\tif (mAllowedExpressions[sPropertyPath] && mAllowedExpressions[sPropertyPath].length > 0) {\n\t\t\t\toProp.filterExpression = CommonUtils.getSpecificAllowedExpression(mAllowedExpressions[sPropertyPath]);\n\t\t\t} else {\n\t\t\t\toProp.filterExpression = \"auto\";\n\t\t\t}\n\n\t\t\toProp = Object.assign(oProp, {\n\t\t\t\tvisible: oSelField.availability === \"Default\"\n\t\t\t});\n\t\t}\n\n\t\tprocessedFields[iFilterFieldIndex] = oProp;\n\t});\n\tprocessedFields.forEach(function (propInfo: FEPropertyInfo) {\n\t\t// key should have the same value as name\n\t\tpropInfo.key = propInfo.name;\n\t\tif (propInfo.path === \"$editState\") {\n\t\t\tpropInfo.label = getResourceModel(oFilterControl).getText(\"FILTERBAR_EDITING_STATUS\");\n\t\t}\n\t\tpropInfo.typeConfig = TypeMap.getTypeConfig(propInfo.dataType, propInfo.formatOptions, propInfo.constraints);\n\t\tpropInfo.label = getLocalizedText(propInfo.label!, oFilterControl) || \"\";\n\t\tif (propInfo.isParameter) {\n\t\t\taParameterFields.push(propInfo.name);\n\t\t}\n\t});\n\n\taFetchedProperties = processedFields;\n\tDelegateUtil.setCustomData(oFilterControl, \"parameters\", aParameterFields as unknown as string);\n\n\treturn aFetchedProperties as PropertyInfo[];\n};\n\nfunction getLineItemQualifierFromTable(oControl: ManagedObject, oMetaModel: ODataMetaModel): string | undefined {\n\tif (oControl.isA<EnhanceWithUI5<TableAPI>>(\"sap.fe.macros.table.TableAPI\")) {\n\t\tconst annotationPaths = oControl.getMetaPath().split(\"#\")[0].split(\"/\");\n\t\tswitch (annotationPaths[annotationPaths.length - 1]) {\n\t\t\tcase `@${UIAnnotationTerms.SelectionPresentationVariant}`:\n\t\t\tcase `@${UIAnnotationTerms.PresentationVariant}`:\n\t\t\t\treturn oMetaModel\n\t\t\t\t\t.getObject(oControl.getMetaPath())\n\t\t\t\t\t.Visualizations?.find((visualization: { $AnnotationPath: string }) =>\n\t\t\t\t\t\tvisualization.$AnnotationPath.includes(`@${UIAnnotationTerms.LineItem}`)\n\t\t\t\t\t).$AnnotationPath;\n\t\t\tcase `@${UIAnnotationTerms.LineItem}`:\n\t\t\t\tconst metaPaths = oControl.getMetaPath().split(\"/\");\n\t\t\t\treturn metaPaths[metaPaths.length - 1];\n\t\t}\n\t}\n\treturn undefined;\n}\n\nODataFilterBarDelegate._isFilterAdaptable = function (\n\tfilterFieldInfo: FilterField,\n\tpropertyAnnotations: Property,\n\tselectionFields?: SelectionFields,\n\tfilterFacets?: FilterFacets\n): boolean {\n\tlet isInFilterFacets: boolean;\n\tconst isSelectionField = selectionFields ? ODataFilterBarDelegate._isFilterInSelectionFields(selectionFields, filterFieldInfo) : false;\n\tif (filterFacets) {\n\t\tisInFilterFacets = filterFacets.some(function (filterFacet: ReferenceFacet) {\n\t\t\tconst fieldGroup = filterFacet.Target?.$target as FieldGroupType;\n\t\t\treturn fieldGroup?.Data.some(function (dataField: DataFieldAbstractTypes) {\n\t\t\t\t// we expect dataField to be DataFieldTypes (having a Value) inside FieldGroups inside FilterFacets\n\t\t\t\tif ((dataField as DataFieldTypes).Value.path === filterFieldInfo.key) {\n\t\t\t\t\treturn true;\n\t\t\t\t}\n\t\t\t\t// dataField types having no Value (DataFieldForAnnotationTypes, DataFieldForActionAbstractTypes, DataFieldForActionGroupTypes), there is nothing to check, but this should not occur anyway\n\t\t\t\treturn false;\n\t\t\t});\n\t\t});\n\t} else {\n\t\tisInFilterFacets = false;\n\t}\n\treturn isSelectionField || isInFilterFacets || !propertyAnnotations.annotations?.UI?.AdaptationHidden;\n};\n\nODataFilterBarDelegate._isFilterInSelectionFields = function (selectionFields: SelectionFields, filterFieldInfo: FilterField): boolean {\n\tconst filterFieldKey = filterFieldInfo.key?.indexOf(\"::\") > 0 ? filterFieldInfo.key?.replace(\"::\", \"/\") : filterFieldInfo.key;\n\treturn selectionFields.some(function (selectionField: AnnotationSelectionField) {\n\t\tif (selectionField.value === filterFieldKey) {\n\t\t\treturn true;\n\t\t}\n\t\treturn false;\n\t});\n};\n\nODataFilterBarDelegate._addFlexItem = async function (\n\tsFlexPropertyName: string,\n\toParentControl: FilterBar,\n\toMetaModel: ODataMetaModel,\n\toModifier: BaseTreeModifier | undefined,\n\toAppComponent: AppComponent | undefined,\n\tview?: View | undefined\n): Promise<NullableModifierElement> {\n\tconst sFilterBarId = oModifier ? oModifier.getId(oParentControl) : oParentControl.getId(),\n\t\tsIdPrefix = oModifier ? \"\" : \"Adaptation\",\n\t\taSelectionFields = FilterUtils.getConvertedFilterFields(\n\t\t\toParentControl as unknown as IFilterControl,\n\t\t\tundefined,\n\t\t\tundefined,\n\t\t\toMetaModel,\n\t\t\toAppComponent,\n\t\t\toModifier,\n\t\t\toModifier ? undefined : getLineItemQualifierFromTable(oParentControl.getParent()!, oMetaModel)\n\t\t),\n\t\toSelectionField = ODataFilterBarDelegate._findSelectionField(aSelectionFields, sFlexPropertyName),\n\t\tsPropertyPath = _getPropertyPath(sFlexPropertyName),\n\t\tbIsXML = !!oModifier && oModifier.targets === \"xmlTree\";\n\tif (sFlexPropertyName === EDIT_STATE_PROPERTY_NAME) {\n\t\treturn _templateEditState(_generateIdPrefix(sFilterBarId, `${sIdPrefix}FilterField`), oMetaModel, oModifier);\n\t} else if (sFlexPropertyName === SEARCH_PROPERTY_NAME) {\n\t\treturn Promise.resolve(null);\n\t} else if (oSelectionField?.template) {\n\t\treturn ODataFilterBarDelegate._templateCustomFilter(\n\t\t\toParentControl as unknown as IFilterControl,\n\t\t\t_generateIdPrefix(sFilterBarId, `${sIdPrefix}`),\n\t\t\toSelectionField,\n\t\t\toMetaModel,\n\t\t\toModifier!\n\t\t);\n\t}\n\n\tif (oSelectionField?.type === \"Slot\" && oModifier) {\n\t\treturn _addXMLCustomFilterField(oParentControl as unknown as IFilterControl, oModifier, sPropertyPath);\n\t}\n\n\tconst sNavigationPath = CommonHelper.getNavigationPath(sPropertyPath);\n\tlet sEntityTypePath: string;\n\tlet sUseSemanticDateRange;\n\tlet oSettings: {\n\t\tbindingContexts: {\n\t\t\tcontextPath: Context;\n\t\t\tproperty: Context;\n\t\t};\n\t\tmodels: {\n\t\t\tcontextPath: ODataMetaModel;\n\t\t\tproperty?: ODataMetaModel;\n\t\t\tmetaPath?: ODataMetaModel;\n\t\t};\n\t\tisXML: boolean;\n\t};\n\tlet sBindingPath;\n\tlet oParameters: {\n\t\tmetaPath: string;\n\t\tsPropertyName: string;\n\t\tsBindingPath: string;\n\t\tsValueHelpType: string;\n\t\toMetaModel: ODataMetaModel;\n\t\tsIdPrefix: string;\n\t\toSettings: unknown;\n\t\tsVhIdPrefix: string;\n\t\tsNavigationPrefix?: string;\n\t\tbUseSemanticDateRange: boolean;\n\t\toModifier?: BaseTreeModifier;\n\t\toControl: UI5Element;\n\t\tvisualFilter?: unknown;\n\t\tview?: View;\n\t\tlabel?: string;\n\t};\n\n\treturn Promise.resolve()\n\t\t.then(async function () {\n\t\t\tif (oSelectionField?.isParameter) {\n\t\t\t\tconst sAnnotationPath = oSelectionField.annotationPath;\n\t\t\t\treturn sAnnotationPath.substring(0, sAnnotationPath.lastIndexOf(\"/\") + 1);\n\t\t\t}\n\t\t\treturn DelegateUtil.getCustomDataWithModifier<string>(oParentControl, \"entityType\", oModifier);\n\t\t})\n\t\t.then(async function (sRetrievedEntityTypePath: string | undefined) {\n\t\t\tsEntityTypePath = sRetrievedEntityTypePath!;\n\t\t\treturn DelegateUtil.getCustomDataWithModifier<string>(oParentControl, \"useSemanticDateRange\", oModifier);\n\t\t})\n\t\t.then(async function (sRetrievedUseSemanticDateRange: string | undefined) {\n\t\t\tsUseSemanticDateRange = sRetrievedUseSemanticDateRange;\n\t\t\tconst oPropertyContext = oMetaModel.createBindingContext(sEntityTypePath + sPropertyPath)!;\n\t\t\tlet sInFilterBarId = oModifier ? oModifier.getId(oParentControl) : oParentControl.getId();\n\t\t\tif (sInFilterBarId.endsWith(\"-content\")) {\n\t\t\t\t// -content is only added when the building block is used directly in the filter bar\n\t\t\t\tsInFilterBarId = sInFilterBarId.substring(0, sInFilterBarId.lastIndexOf(\"-content\"));\n\t\t\t\t// By using the id of the parent control, we can get the correct idPrefix for the value help\n\t\t\t}\n\t\t\toSettings = {\n\t\t\t\tbindingContexts: {\n\t\t\t\t\tcontextPath: oMetaModel.createBindingContext(sEntityTypePath)!,\n\t\t\t\t\tproperty: oPropertyContext\n\t\t\t\t},\n\t\t\t\tmodels: {\n\t\t\t\t\tcontextPath: oMetaModel,\n\t\t\t\t\tproperty: oMetaModel\n\t\t\t\t},\n\t\t\t\tisXML: bIsXML\n\t\t\t};\n\t\t\tsBindingPath = `/${ModelHelper.getEntitySetPath(sEntityTypePath)\n\t\t\t\t.split(\"/\")\n\t\t\t\t.filter(ModelHelper.filterOutNavPropBinding)\n\t\t\t\t.join(\"/\")}`;\n\t\t\toParameters = {\n\t\t\t\tmetaPath: oPropertyContext.getPath(),\n\t\t\t\tsPropertyName: sPropertyPath,\n\t\t\t\tsBindingPath: sBindingPath,\n\t\t\t\tsValueHelpType: sIdPrefix + VALUE_HELP_TYPE,\n\t\t\t\toControl: oParentControl,\n\t\t\t\toMetaModel: oMetaModel,\n\t\t\t\toModifier: oModifier,\n\t\t\t\tsIdPrefix: _generateIdPrefix(sInFilterBarId, `${sIdPrefix}FilterField`, sNavigationPath),\n\t\t\t\tsVhIdPrefix: _generateIdPrefix(sInFilterBarId, sIdPrefix + VALUE_HELP_TYPE),\n\t\t\t\tsNavigationPrefix: sNavigationPath,\n\t\t\t\tbUseSemanticDateRange: sUseSemanticDateRange as unknown as boolean,\n\t\t\t\toSettings: oSelectionField?.settings ?? {},\n\t\t\t\tvisualFilter: oSelectionField?.visualFilter,\n\t\t\t\tview,\n\t\t\t\tlabel: oSelectionField?.label\n\t\t\t};\n\n\t\t\treturn DelegateUtil.doesValueHelpExist(oParameters);\n\t\t})\n\t\t.then(async function (bValueHelpExists: boolean) {\n\t\t\tif (!bValueHelpExists) {\n\t\t\t\treturn _templateValueHelp(\n\t\t\t\t\t{\n\t\t\t\t\t\tbindingContexts: {\n\t\t\t\t\t\t\tcontextPath: oMetaModel.createBindingContext(sEntityTypePath)!,\n\t\t\t\t\t\t\tmetaPath: oSettings.bindingContexts.property\n\t\t\t\t\t\t},\n\t\t\t\t\t\tmodels: {\n\t\t\t\t\t\t\tcontextPath: oMetaModel,\n\t\t\t\t\t\t\tmetaPath: oMetaModel\n\t\t\t\t\t\t},\n\t\t\t\t\t\tisXML: bIsXML\n\t\t\t\t\t},\n\t\t\t\t\toParameters\n\t\t\t\t);\n\t\t\t}\n\t\t\treturn;\n\t\t})\n\t\t.then(async function () {\n\t\t\treturn DelegateUtil.getCustomDataWithModifier<string>(oParentControl, \"localId\", oModifier);\n\t\t})\n\t\t.then(async function (localId: string | undefined) {\n\t\t\tlet pageModel;\n\t\t\tif (oParameters.visualFilter) {\n\t\t\t\t//Need to set the convertercontext as pageModel in settings for BuildingBlock 2.0\n\t\t\t\tpageModel = CommonUtils.getTargetView(oParentControl).getController()._getPageModel();\n\t\t\t}\n\t\t\treturn _templateFilterField(oSettings, oParameters, localId, pageModel);\n\t\t});\n};\nfunction _getCachedProperties(oFilterBar: IFilterControl | Element): null | PropertyInfo[] | undefined {\n\t// properties are not cached during templating\n\tif (oFilterBar instanceof window.Element) {\n\t\treturn null;\n\t}\n\treturn DelegateUtil.getCustomData<PropertyInfo[]>(oFilterBar, FETCHED_PROPERTIES_DATA_KEY);\n}\nfunction _setCachedProperties(oFilterBar: IFilterControl | Element, aFetchedProperties: PropertyInfo[]): void {\n\t// do not cache during templating, else it becomes part of the cached view\n\tif (oFilterBar instanceof window.Element) {\n\t\treturn;\n\t}\n\tDelegateUtil.setCustomData(oFilterBar, FETCHED_PROPERTIES_DATA_KEY, aFetchedProperties as unknown as string);\n}\nfunction _getCachedOrFetchPropertiesForEntity(\n\tsEntityTypePath: string,\n\toMetaModel: ODataMetaModel,\n\toFilterBar: IFilterControl\n): ControlPropertyInfo[] | PropertyInfoExternal[] {\n\tlet aFetchedProperties = _getCachedProperties(oFilterBar);\n\tlet localGroupLabel;\n\n\tif (!aFetchedProperties) {\n\t\taFetchedProperties = ODataFilterBarDelegate.fetchPropertiesForEntity(sEntityTypePath, oMetaModel, oFilterBar);\n\t\taFetchedProperties.forEach(function (oGroup: FEPropertyInfo) {\n\t\t\tlocalGroupLabel = null;\n\t\t\tif (oGroup.groupLabel) {\n\t\t\t\tlocalGroupLabel = getLocalizedText(oGroup.groupLabel, oFilterBar);\n\t\t\t\toGroup.groupLabel = localGroupLabel === null ? oGroup.groupLabel : localGroupLabel;\n\t\t\t}\n\t\t});\n\t\tsortPropertyInfosByGroupLabel(aFetchedProperties);\n\t\t_setCachedProperties(oFilterBar, aFetchedProperties);\n\t}\n\treturn aFetchedProperties;\n}\nODataFilterBarDelegate.fetchProperties = async function (filterBar: FilterBar): Promise<PropertyInfoExternal[]> {\n\tconst propertyInfos = await ODataFilterBarDelegate.fetchFilterProperties(filterBar as unknown as IFilterControl);\n\tDelegateUtil.setCustomData(filterBar, \"feFilterInfo\", propertyInfos);\n\tif (propertyInfos.length > 0) {\n\t\treturn FilterUtils.formatPropertyInfo(propertyInfos as PropertyInfo[]) as PropertyInfoExternal[];\n\t} else {\n\t\treturn [];\n\t}\n};\n\nODataFilterBarDelegate.fetchFilterProperties = async function (\n\tfilterBar: IFilterControl\n): Promise<ControlPropertyInfo[] | PropertyInfoExternal[]> {\n\tconst entityTypePath = DelegateUtil.getCustomData<string>(filterBar, \"entityType\")!;\n\treturn DelegateUtil.fetchModel(filterBar as FilterBar).then(function (model: Model) {\n\t\tif (!model) {\n\t\t\treturn [];\n\t\t}\n\t\treturn _getCachedOrFetchPropertiesForEntity(entityTypePath, model.getMetaModel() as ODataMetaModel, filterBar);\n\t});\n};\n\nODataFilterBarDelegate.getTypeMap = function (): typeof TypeMap {\n\treturn TypeMap;\n};\n\nexport default ODataFilterBarDelegate;\n"],"mappings":"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","ignoreList":[]}