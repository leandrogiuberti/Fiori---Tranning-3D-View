/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)
 *      (c) Copyright 2009-2025 SAP SE. All rights reserved
 */
sap.ui.define(["sap/base/Log","sap/fe/core/converters/MetaModelConverter","sap/fe/core/templating/PropertyHelper","sap/fe/core/type/EDM","sap/fe/macros/field/FieldHelper","sap/ui/mdc/condition/Condition","sap/ui/mdc/enums/ConditionValidated","../CommonHelper","./SemanticDateOperators"],function(e,t,n,o,i,r,a,s,d){"use strict";var c={};var l=o.isTypeFilterable;var u=n.hasValueHelp;var f=t.getInvolvedDataModelObjects;const p={Contains:"NotContains",StartsWith:"NotStartsWith",EndsWith:"NotEndsWith",Empty:"NotEmpty",NotEmpty:"Empty",LE:"NOTLE",GE:"NOTGE",LT:"NOTLT",GT:"NOTGT",BT:"NOTBT",NE:"EQ",EQ:"NE"};function g(e){let t;if(e.match(/^(\d{4})-(\d{1,2})-(\d{1,2})T(\d{1,2}):(\d{1,2}):(\d{1,2})\+(\d{1,2}):(\d{1,2})/)){t=e.match(/^(\d{4})-(\d{1,2})-(\d{1,2})T(\d{1,2}):(\d{1,2}):(\d{1,2})\+(\d{1,2}):(\d{1,2})/)[0]}else if(e.match(/^(\d{4})-(\d{1,2})-(\d{1,2})T(\d{1,2}):(\d{1,2}):(\d{1,2}).(\d{1,7})[+-](\d{1,2}):(\d{1,2})/)){t=e}else if(e.match(/^(\d{4})-(\d{1,2})-(\d{1,2})T(\d{1,2}):(\d{1,2}):(\d{1,2})/)){t=`${e.match(/^(\d{4})-(\d{1,2})-(\d{1,2})T(\d{1,2}):(\d{1,2}):(\d{1,2})/)[0]}+0000`}else if(e.match(/^(\d{4})-(\d{1,2})-(\d{1,2})/)){t=`${e.match(/^(\d{4})-(\d{1,2})-(\d{1,2})/)[0]}T00:00:00+0000`}else if(e.indexOf("Z")===e.length-1){t=`${e.split("Z")[0]}+0100`}else{t=undefined}return t}c._getDateTimeOffsetCompliantValue=g;function m(e){let t=arguments.length>1&&arguments[1]!==undefined?arguments[1]:false;if(t){return e.match(/^(\d{4})-(\d{1,2})-(\d{1,2})$/)?e.match(/^(\d{4})-(\d{1,2})-(\d{1,2})/)[0]:null}return e.match(/^(\d{4})-(\d{1,2})-(\d{1,2})/)?e.match(/^(\d{4})-(\d{1,2})-(\d{1,2})/)[0]:e.match(/^(\d{8})/)&&e.match(/^(\d{8})/)[0]}c._getDateCompliantValue=m;function E(e,t,n){if(!l(t)||!n){return undefined}if(e===undefined||e===null){return e}let o=e;switch(t){case"Edm.Boolean":if(typeof e==="boolean"){o=e}else{o=e==="true"||(e==="false"?false:undefined)}break;case"Edm.Double":case"Edm.Single":if(e===""&&n==="EQ"){break}const t=Number(e);o=isNaN(t)?undefined:parseFloat(e.toString());break;case"Edm.Byte":case"Edm.Int16":case"Edm.Int32":case"Edm.SByte":if(o===""&&n==="EQ"){break}const i=Number(e);o=isNaN(i)?undefined:parseInt(e.toString(),10);break;case"Edm.Date":o=m(e.toString());break;case"Edm.DateTimeOffset":o=m(e.toString(),true)??g(e.toString());break;case"Edm.TimeOfDay":o=e.toString().match(/(\d{1,2}):(\d{1,2}):(\d{1,2})/)?e.toString().match(/(\d{1,2}):(\d{1,2}):(\d{1,2})/)?.[0]:undefined;break;default:}return o===null?undefined:o}c.getTypeCompliantValue=E;function h(t,n,o,i){let r=arguments.length>4&&arguments[4]!==undefined?arguments[4]:[];let a=arguments.length>5&&arguments[5]!==undefined?arguments[5]:[];let s=arguments.length>6?arguments[6]:undefined;let d=n,c,l;if(n===undefined||n===null){return undefined}const u=s==="Edm.Date"||s==="Edm.DateTimeOffset";switch(t){case"CP":l="Contains";if(d){const t=d.indexOf("*");const n=d.lastIndexOf("*");if(t>-1){if(t===0&&n!==d.length-1){l="EndsWith";d=d.substring(1,d.length)}else if(t!==0&&n===d.length-1){l="StartsWith";d=d.substring(0,d.length-1)}else{d=d.substring(1,d.length-1)}}else{e.warning("Contains Option cannot be used without '*'.");return undefined}}break;case"EQ":l=t;if(n===""&&(r.length===0||r.includes("Empty"))){l="Empty"}else if(u&&a.includes("DATE")&&n.match(/^(\d{4})-(\d{1,2})-(\d{1,2})$/)){l="DATE"}else if(s==="Edm.DateTimeOffset"&&a.includes("DATETIME")){l="DATETIME"}break;case"NE":l=n===""?"NotEmpty":t;break;case"BT":if(o===undefined||o===null){return}c=o;l=u&&a.includes("DATERANGE")?"DATERANGE":t;break;case"LE":l=u&&a.includes("TO")?"TO":t;break;case"GE":l=u&&a.includes("FROM")?"FROM":t;break;case"GT":case"LT":l=t;break;default:e.warning(`Selection Option is not supported : '${t}'`);return undefined}if(i==="E"){l=p[l]}const f={values:[],isEmpty:null,operator:l};if(l!=="Empty"){f.values.push(d);if(c){f.values.push(c)}}return f}c.resolveConditionValues=h;function T(e){return e.indexOf("/")>0?e.split("/")[1]:e}c.getRangeProperty=T;function y(e,t,n,o){const i=[];const r=u(t);e?.forEach(e=>{const a=o?o(e,t,n):C(e,t.type,r);if(a){i.push(a)}});return i}function b(e,t,n){const o=t.getMetaContext(`${n}/${e}`),i=f(o);return i.targetObject}function O(e,t,n,o){const i=e.PropertyName,r={},a=i.value||i?.$PropertyPath,s=e.Ranges??[];const d=b(a,t,n);if(d){const e=y(s,d,a,o);if(e.length){r[a]=(r[a]||[]).concat(e)}}return r}function v(e,t,n,o){let i={};if(!n){return i}const r=n.SelectOptions,s=n.Parameters;r?.forEach(n=>{const r=n.PropertyName;const a=r.value||r.$PropertyPath;if(Object.keys(i).includes(a)){i[a]=i[a].concat(O(n,t,e,o)[a])}else{i={...i,...O(n,t,e,o)}}});s?.forEach(e=>{const t=e.PropertyName.value||e.PropertyName.$PropertyPath;const n=o?{operator:"EQ",value1:e.PropertyValue,value2:null,path:t,isParameter:true}:{operator:"EQ",values:[e.PropertyValue],isEmpty:null,validated:a.Validated,isParameter:true};i[t]=[n]});return i}c.getFiltersConditionsFromSelectionVariant=v;function C(t,n,o){let i=arguments.length>3&&arguments[3]!==undefined?arguments[3]:[];let s=arguments.length>4&&arguments[4]!==undefined?arguments[4]:[];let d;try{const e=T(t.Sign);const c=T(t.Option);const l=E(t.Low,n,c);const u=t.High?E(t.High,n,c):undefined;const f=h(c,l,u,e,i,s,n);if(f){const e=o&&f.operator==="EQ"?a.Validated:a.NotValidated;d=r.createCondition(f.operator,f.values,null,null,e)}}catch(t){const n=t instanceof Error?t.message:String(t);e.error(`FE : Core : FilterHelper : getConditions : ${n}`)}return d}c.getConditions=C;const N=function(e,t){const n={};const o=e.getInterface(1).getPath(),i=e.getInterface(1).getModel();if(t){for(const e in t){const t=i.getObject(`${o}/${e}@com.sap.vocabularies.Common.v1.FilterDefaultValue`);if(t!==undefined){const o=e;n[o]=[r.createCondition("EQ",[t],null,null,a.Validated)]}}}return n};const $=function(e,t){const n={};const o=e.getInterface(1);const i=o.getModel();const a=o.getPath();for(const e in t){if(t[e][0]){const o=e.split("::");let s="";const d=o.length;const c=o.slice(0,o.length-1).join("/");const l=o[d-1];if(c){const e=i.getObject(a+"/"+c);if(e.$kind==="NavigationProperty"&&e.$isCollection){s+=`${c}*/`}else if(e.$kind==="NavigationProperty"){s+=`${c}/`}}s+=l;const u="values"in t[e][0]?t[e][0].values:[];n[s]=[r.createCondition(t[e][0].operator,u,null,null,null)]}}return n};function S(){const e={};e["$editState"]=[r.createCondition("DRAFT_EDIT_STATE",["ALL"],null,null,a.Validated)];return e}c.getEditStatusFilter=S;function D(e,t,n,o){let i=arguments.length>4&&arguments[4]!==undefined?arguments[4]:true;let r;const a=e.getInterface(1).getPath(),s=e.getInterface(1).getModel(),d=s?.getObject(`${a}@`),c=s?.getObject(`${a}/`);if(d&&(d["@com.sap.vocabularies.Common.v1.DraftRoot"]||d["@com.sap.vocabularies.Common.v1.DraftNode"])&&i){r=S()}const l=t?.selectionVariant;const u=t?.defaultSemanticDates||{};const f=N(e,c);const p=$(e,u);let g={};if(l){g=v(a,s,l)}else if(f){g=f}if(p){g={...g,...p}}if(r){g={...g,...r}}const m=o?.controlConfiguration?.["@com.sap.vocabularies.UI.v1.SelectionFields"]??{};g=P(e.getInterface(1),g,m);return Object.keys(g).length>0?JSON.stringify(g).replace(/([{}])/g,"\\$1"):undefined}c.getFilterConditions=D;D.requiresIContext=true;function P(t,n,o){const r=t.getModel();const{filterFields:a={},useSemanticDateRange:d=true}=o;for(const o in n){try{const e=r.createBindingContext(`${t.getPath()}/${o}`);const c=e?.getObject();const l=a[o]?.settings;if(e){const r=i.operators(e,c,d,s.stringifyCustomData(l),t.getPath()||"");const a=r?r.split(","):[];n[o]=F(a,n[o],o)}}catch(t){const n=t instanceof Error?t.message:String(t);e.error(`FE : FilterBar : Error determining conditions for supported operators of property ${o} : ${n}`)}}return n}c.getConditionsOfSupportedOperators=P;function F(t,n,o){let i=n;const r=d.getSemanticDateOperations();if(t.length>0){i=n.filter(n=>{const i=n.operator;if(r.includes(i)&&!t.includes(i)){e.warning(`FE : FilterBar : ${i} not supported for property ${o}. Hence, not applied to FilterBar.`);return false}return true},[])}return i}return c},false);
//# sourceMappingURL=FilterHelper.js.map