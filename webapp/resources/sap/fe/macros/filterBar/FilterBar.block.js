/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)
 *      (c) Copyright 2009-2025 SAP SE. All rights reserved
 */
sap.ui.define(["sap/base/Log","sap/fe/base/jsx-runtime/jsx","sap/fe/core/CommonUtils","sap/fe/core/TemplateModel","sap/fe/core/buildingBlocks/templating/BuildingBlockSupport","sap/fe/core/buildingBlocks/templating/BuildingBlockTemplateProcessor","sap/fe/core/buildingBlocks/templating/BuildingBlockTemplatingBase","sap/fe/core/converters/MetaModelConverter","sap/fe/core/converters/controls/Common/DataVisualization","sap/fe/core/converters/controls/ListReport/FilterBar","sap/fe/core/helpers/MetaModelFunction","sap/fe/core/helpers/ModelHelper","sap/fe/core/helpers/StableIdHelper","sap/fe/macros/CommonHelper","sap/fe/macros/field/FieldHelper","sap/fe/macros/filter/FilterFieldHelper","sap/fe/macros/filter/FilterUtils","sap/fe/macros/filterBar/DraftEditState","sap/fe/macros/filterBar/FilterHelper","sap/fe/macros/fpm/CustomFragment.block","sap/fe/macros/internal/FilterField.block","sap/m/Select","sap/ui/core/CustomData","sap/ui/core/ListItem","sap/ui/core/fieldhelp/FieldHelpCustomData","sap/ui/mdc/FilterField","sap/ui/mdc/p13n/PersistenceProvider","../ValueHelp","../controls/CustomFilterFieldContentWrapper","../controls/FilterBar","../table/SlotColumn","./FilterBarAPI","sap/fe/base/jsx-runtime/jsx"],function(e,t,i,r,a,n,l,o,s,u,c,p,d,f,h,b,g,m,y,F,P,v,C,S,B,D,w,I,_,x,z,A,E){"use strict";var T,k,M,R,H,O,$,j,V,L,N,q,U,K,W,J,G,X,Q,Y,Z,ee,te,ie,re,ae,ne,le,oe,se,ue,ce,pe,de,fe,he,be,ge,me,ye,Fe,Pe,ve,Ce,Se,Be,De,we,Ie,_e,xe,ze,Ae,Ee,Te,ke,Me,Re,He,Oe,$e,je,Ve,Le,Ne;var qe={};var Ue=y.getFilterConditions;var Ke=b.maxConditions;var We=d.generate;var Je=c.getSearchRestrictions;var Ge=u.getSelectionFields;var Xe=s.getSelectionVariant;var Qe=o.getInvolvedDataModelObjects;var Ye=n.storeObjectValue;var Ze=a.defineBuildingBlock;var et=a.blockEvent;var tt=a.blockAttribute;var it=a.blockAggregation;function rt(e,t,i,r){i&&Object.defineProperty(e,t,{enumerable:i.enumerable,configurable:i.configurable,writable:i.writable,value:i.initializer?i.initializer.call(r):void 0})}function at(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function nt(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e,lt(e,t)}function lt(e,t){return lt=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},lt(e,t)}function ot(e,t,i,r,a){var n={};return Object.keys(r).forEach(function(e){n[e]=r[e]}),n.enumerable=!!n.enumerable,n.configurable=!!n.configurable,("value"in n||n.initializer)&&(n.writable=!0),n=i.slice().reverse().reduce(function(i,r){return r(e,t,i)||i},n),a&&void 0!==n.initializer&&(n.value=n.initializer?n.initializer.call(a):void 0,n.initializer=void 0),void 0===n.initializer?(Object.defineProperty(e,t,n),null):n}function st(e,t){throw Error("Decorating class property failed. Please ensure that transform-class-properties is enabled and runs after the decorators transform.")}const ut=function(e,t){t.slotName=t.key;t.key=t.key.replace("InlineXML_","");t.property=e.getAttribute("property");t.label=e.getAttribute("label");t.required=e.getAttribute("required")==="true";t.template=e.getAttribute("template");return t};let ct=(T=Ze({name:"FilterBar",namespace:"sap.fe.macros.internal",publicNamespace:"sap.fe.macros",returnTypes:["sap.fe.macros.filterBar.FilterBarAPI"]}),k=tt({type:"string",isPublic:true}),M=tt({type:"boolean",isPublic:true}),R=tt({type:"sap.ui.model.Context"}),H=tt({type:"string"}),O=tt({type:"sap.ui.model.Context",isPublic:true}),$=tt({type:"sap.ui.model.Context",isPublic:true}),j=tt({type:"boolean",isPublic:true}),V=tt({type:"string"}),L=tt({type:"boolean"}),N=tt({type:"boolean"}),q=tt({type:"boolean"}),U=tt({type:"string[]"}),K=tt({type:"string"}),W=tt({type:"boolean"}),J=tt({type:"string[]"}),G=tt({type:"boolean",isPublic:true}),X=tt({type:"string",required:false}),Q=tt({type:"boolean"}),Y=tt({type:"boolean"}),Z=tt({type:"string"}),ee=tt({type:"string"}),te=tt({type:"boolean",isPublic:true}),ie=tt({type:"boolean"}),re=tt({type:"boolean"}),ae=et(),ne=et(),le=et(),oe=et(),se=et(),ue=it({type:"sap.fe.macros.filterBar.FilterField",isPublic:true,hasVirtualNode:true,processAggregations:ut}),ce=tt({type:"boolean",isPublic:true}),T(pe=(de=function(a){function n(i,n,l){var o;o=a.call(this,i,n,l)||this;rt(o,"id",fe,o);rt(o,"visible",he,o);rt(o,"selectionFields",be,o);rt(o,"filterBarDelegate",ge,o);rt(o,"metaPath",me,o);rt(o,"contextPath",ye,o);rt(o,"showMessages",Fe,o);rt(o,"variantBackreference",Pe,o);rt(o,"hideBasicSearch",ve,o);rt(o,"enableFallback",Ce,o);rt(o,"showAdaptFiltersButton",Se,o);rt(o,"p13nMode",Be,o);rt(o,"propertyInfo",De,o);rt(o,"useSemanticDateRange",we,o);rt(o,"navigationProperties",Ie,o);rt(o,"liveMode",_e,o);rt(o,"filterConditions",xe,o);rt(o,"suspendSelection",ze,o);rt(o,"isDraftCollaborative",Ae,o);rt(o,"toggleControlId",Ee,o);rt(o,"initialLayout",Te,o);rt(o,"showClearButton",ke,o);rt(o,"_applyIdToContent",Me,o);rt(o,"disableDraftEditStateFilter",Re,o);rt(o,"search",He,o);rt(o,"filterChanged",Oe,o);rt(o,"internalFilterChanged",$e,o);rt(o,"internalSearch",je,o);rt(o,"afterClear",Ve,o);rt(o,"filterFields",Le,o);o.showDraftEditState=false;rt(o,"ignorePersonalizationChanges",Ne,o);o.checkIfEditingFilterIsDisabled=e=>{if(e.annotations?.Capabilities?.NavigationRestrictions?.RestrictedProperties?.some(e=>e.NavigationProperty?.value==="DraftAdministrativeData"&&e.FilterRestrictions?.Filterable===false)===true){o.showDraftEditState=false}};o.checkIfCollaborationDraftSupported=e=>{if(p.isCollaborationDraftSupported(e)){o.isDraftCollaborative=true}};o.getEntityTypePath=e=>e[0].endsWith("/")?e[0]:e[0]+"/";o.getSearch=()=>{if(!o.hideBasicSearch){return E(D,{id:We([o.id,"BasicSearchField"]),label:"",placeholder:"{sap.fe.i18n>M_FILTERBAR_SEARCH}",propertyKey:"$search",conditions:"{$filters>/conditions/$search}",dataType:"sap.ui.model.odata.type.String",maxConditions:"1",dataTypeConstraints:"{'maxLength':1000}"})}return""};o.processSelectionFields=()=>{let e="";if(o.showDraftEditState){const t=m.getEditStates(o.isDraftCollaborative);const i=o.getTranslatedText("FILTERBAR_EDITING_STATUS");e=E(D,{label:i,conditions:"{$filters>/conditions/$editState}",maxConditions:"1",id:We([o.id,"FilterField","DraftEditingStatus"]),operators:"EQ",dataType:"sap.ui.model.odata.type.String",propertyKey:"$editState",display:"Description",children:{contentEdit:E(v,{id:We([o.id,"FilterField","DraftEditingStatusSelect"]),width:"100%",forceSelection:"true",selectedKey:"{path: '$field>/conditions', type: 'sap.ui.mdc.field.ConditionsType'}",children:{items:t.map(e=>E(S,{text:e.display},e.id))}})}})}o._valueHelps=[];o._filterFields=[];o._filterFields?.push(e);if(!Array.isArray(o.selectionFields)){o.selectionFields=o.selectionFields.getObject()}o.selectionFields?.forEach(e=>{if(e.availability==="Default"){o.setFilterFieldsAndValueHelps(e)}});o._filterFields=o._filterFields?.length>0?o._filterFields:"";o._valueHelps=o._valueHelps?.length>0?o._valueHelps:""};o.setFilterFieldsAndValueHelps=e=>{if(e.template===undefined&&e.type!=="Slot"){o.pushFilterFieldsAndValueHelps(e)}else if(Array.isArray(o._filterFields)){const t=e.annotationPath;const i=o.metaPath.getModel().createBindingContext(t);const r=i?.getObject();let a;if(e.type==="Slot"){a=E(z,{templateId:e.template,children:E("slot",{name:e.slotName})})}else if(e.template){a=E(F,{fragmentName:e.template,id:We([o.id,"CustomFilterField",e.key]),contextPath:"{contextPath>}"})}let n=-1;if(i){n=Ke(e.annotationPath,{context:i})??-1}o._filterFields?.push(E(D,{id:We([o.id,"CustomFilterField",e.key]),delegate:{name:"sap/fe/macros/field/FieldBaseDelegate"},propertyKey:e.conditionPath,label:e.label,dataType:e.dataType,maxConditions:n,conditions:`{$filters>/conditions/${e.conditionPath}}`,operators:h.operators(i,r,o.useSemanticDateRange,e.settings,o.contextPath.getPath()),dataTypeConstraints:e.constraints,dataTypeFormatOptions:e.formatOptions,valueHelp:"undefined",required:e.required,children:{content:E(_,{"core:require":"{handler: 'sap/fe/macros/filter/FilterUtils'}",id:We([o.id,"FilterFieldContentWrapper",e.key]),binding:`{filterValues>/${g.conditionToModelPath(e.conditionPath)}}`,conditions:"{path: '$field>/conditions'}",children:{content:a}}),customData:[E(C,{value:e.type==="Slot"},"isSlot"),E(B,{value:`{parts: [{value: 'asArray'}, {value: '${e.documentRefText}'}], formatter: '._formatters.StandardFormatter'}`},"sap-ui-DocumentationRef")]}}))}};o.pushFilterFieldsAndValueHelps=e=>{if(Array.isArray(o._filterFields)){const t={...e.visualFilter,...{initialChartBindingEnabled:!o.suspendSelection}};o._filterFields?.push(E(P,{idPrefix:We([o.id,"FilterField",f.getNavigationPath(e.annotationPath)]),vhIdPrefix:We([o.id,"FilterFieldValueHelp"]),property:e.annotationPath,contextPath:o._getContextPathForFilterField(e,o._internalContextPath),useSemanticDateRange:o.useSemanticDateRange,label:e.label,settings:f.stringifyCustomData(e.settings),visualFilter:e.visualFilter!==undefined?Ye(t):undefined,editMode:`{internal>/${o.id}/filterFields/${e.conditionPath}/editMode}`}))}if(Array.isArray(o._valueHelps)){o._valueHelps?.push(E(I,{idPrefix:We([o.id,"FilterFieldValueHelp"]),conditionModel:"$filters",metaPath:e.annotationPath,contextPath:o._getContextPathForFilterField(e,o._internalContextPath),filterFieldValueHelp:true,useSemanticDateRange:o.useSemanticDateRange}))}};if(!o.metaPath){e.error("Context Path not available for FilterBar Macro.");return at(o)}const s=o.metaPath.getPath();let u="";const c=s?.split("/@com.sap.vocabularies.UI.v1.SelectionFields")||[];if(c.length>0){u=o.getEntityTypePath(c)}const d=p.getEntitySetPath(u);const b=o.contextPath?.getModel();o._internalContextPath=b?.createBindingContext(u);const y="@com.sap.vocabularies.UI.v1.SelectionFields"+(c.length&&c[1]||"");const w=l?.fullContextPath;let x=y;if(w!==""&&o._internalContextPath.getPath()?.startsWith(w)){x=s.replace(w,"")}o._annotationPath=y;const A={};if(o.filterFields){A[x]={filterFields:o.filterFields}}const T=Qe(o._internalContextPath);const k=o.getConverterContext(T,undefined,l,A);if(!o.propertyInfo){o.propertyInfo=Ge(k,[],y).sPropertyInfo}const M=Qe(o.metaPath,o.contextPath).targetEntitySet;if(M?.annotations?.Common?.DraftRoot&&!o.disableDraftEditStateFilter){o.showDraftEditState=true;o.checkIfEditingFilterIsDisabled(M);o.checkIfCollaborationDraftSupported(b)}if(!o.selectionFields){const e=Ge(k,[],y).selectionFields;o.selectionFields=new r(e,b).createBindingContext("/");const t=l?.models?.viewData?.getData();const i=k.getEntityType(),a=Xe(i,k),n=b.getContext(d),s=Ue(n,{selectionVariant:a},n.getObject(),t,o.showDraftEditState);o.filterConditions=s}o._processPropertyInfos(o.propertyInfo,b);if(o._applyIdToContent){o._apiId=o.id+"::FilterBar";o._contentId=o.id}else{o._apiId=o.id;o._contentId=o.getContentId(o.id+"")}if(o.hideBasicSearch!==true){const e=Je(d,b);o.hideBasicSearch=Boolean(e&&!e.Searchable)}t.renderAsXML(()=>o.processSelectionFields());o.designtime=o.getDesigntime();return o}qe=n;nt(n,a);var l=n.prototype;l._processPropertyInfos=function e(t,r){const a=[];if(t){const e=t.replace(/\\{/g,"{").replace(/\\}/g,"}");const n=JSON.parse(e);const l=this.getTranslatedText("FILTERBAR_EDITING_STATUS");n.forEach(function(e){e.key=e.name;if(e.isParameter){a.push(e.name)}if(e.path==="$editState"){e.label=l}if(e.key?.includes("/")){const t=e.annotationPath;const a=f.getLocationForPropertyPath(r,t);const n=t.replace(`${a}/`,"");e.required=i.getFilterRestrictionsByPath(a,r)?.RequiredProperties?.includes(n)}});this.propertyInfo=JSON.stringify(n).replace(/\{/g,"\\{").replace(/\}/g,"\\}")}this._parameters=JSON.stringify(a)};l.getPersistenceProvider=function e(t){if(this.ignorePersonalizationChanges){return E(w,{id:We([t,"PersistenceProvider"]),for:t,mode:"Transient"})}return undefined};l._getContextPathForFilterField=function e(t,i){let r=i?.getPath();if(t.isParameter){const e=t.annotationPath;r=e.substring(0,e.lastIndexOf("/")+1)}return r};l.getDesigntime=function e(){return"sap/fe/macros/filterBar/designtime/FilterBar.designtime"};l.getTemplate=function e(){const t=this._internalContextPath?.getPath();let i="";if(this.filterBarDelegate){i=this.filterBarDelegate}else{i="{name:'sap/fe/macros/filterBar/FilterBarDelegate', payload: {entityTypePath: '"+t+"'}}"}const r=g.formatPropertyInfo(this.propertyInfo);return E(A,{id:this._apiId,metaPath:this.metaPath.getPath(),search:this.search,filterChanged:this.filterChanged,afterClear:this.afterClear,internalSearch:this.internalSearch,internalFilterChanged:this.internalFilterChanged,children:{content:E(x,{"core:require":"{API: 'sap/fe/macros/filterBar/FilterBarAPI'}",id:this._contentId,liveMode:this.liveMode,delegate:i,variantBackreference:this.liveMode?undefined:this.variantBackreference,showAdaptFiltersButton:this.showAdaptFiltersButton,showClearButton:this.showClearButton,p13nMode:this.p13nMode,search:"API.handleSearch($event)",filtersChanged:"API.handleFilterChanged($event)",filterConditions:this.filterConditions,suspendSelection:this.suspendSelection,showMessages:this.showMessages,toggleControl:this.toggleControlId,initialLayout:this.initialLayout,visible:this.visible,disableDraftEditStateFilter:this.disableDraftEditStateFilter,"dt:designtime":this.designtime,"customData:entityType":t,children:{customData:[E(C,{value:this.id},"localId"),E(C,{value:this.hideBasicSearch},"hideBasicSearch"),E(C,{value:this.showDraftEditState},"showDraftEditState"),E(C,{value:this.useSemanticDateRange},"useSemanticDateRange"),E(C,{value:this._parameters},"parameters"),E(C,{value:this.propertyInfo},"feFilterInfo"),E(C,{value:this._annotationPath},"annotationPath")],dependents:[this._valueHelps,this.getPersistenceProvider(this._contentId)],basicSearchField:this.getSearch(),filterItems:this._filterFields}})}})};return n}(l),fe=ot(de.prototype,"id",[k],{configurable:true,enumerable:true,writable:true,initializer:null}),he=ot(de.prototype,"visible",[M],{configurable:true,enumerable:true,writable:true,initializer:null}),be=ot(de.prototype,"selectionFields",[R],{configurable:true,enumerable:true,writable:true,initializer:null}),ge=ot(de.prototype,"filterBarDelegate",[H],{configurable:true,enumerable:true,writable:true,initializer:null}),me=ot(de.prototype,"metaPath",[O],{configurable:true,enumerable:true,writable:true,initializer:null}),ye=ot(de.prototype,"contextPath",[$],{configurable:true,enumerable:true,writable:true,initializer:null}),Fe=ot(de.prototype,"showMessages",[j],{configurable:true,enumerable:true,writable:true,initializer:function(){return false}}),Pe=ot(de.prototype,"variantBackreference",[V],{configurable:true,enumerable:true,writable:true,initializer:null}),ve=ot(de.prototype,"hideBasicSearch",[L],{configurable:true,enumerable:true,writable:true,initializer:null}),Ce=ot(de.prototype,"enableFallback",[N],{configurable:true,enumerable:true,writable:true,initializer:function(){return false}}),Se=ot(de.prototype,"showAdaptFiltersButton",[q],{configurable:true,enumerable:true,writable:true,initializer:function(){return true}}),Be=ot(de.prototype,"p13nMode",[U],{configurable:true,enumerable:true,writable:true,initializer:function(){return"Item,Value"}}),De=ot(de.prototype,"propertyInfo",[K],{configurable:true,enumerable:true,writable:true,initializer:null}),we=ot(de.prototype,"useSemanticDateRange",[W],{configurable:true,enumerable:true,writable:true,initializer:function(){return true}}),Ie=ot(de.prototype,"navigationProperties",[J],{configurable:true,enumerable:true,writable:true,initializer:null}),_e=ot(de.prototype,"liveMode",[G],{configurable:true,enumerable:true,writable:true,initializer:function(){return false}}),xe=ot(de.prototype,"filterConditions",[X],{configurable:true,enumerable:true,writable:true,initializer:null}),ze=ot(de.prototype,"suspendSelection",[Q],{configurable:true,enumerable:true,writable:true,initializer:function(){return false}}),Ae=ot(de.prototype,"isDraftCollaborative",[Y],{configurable:true,enumerable:true,writable:true,initializer:function(){return false}}),Ee=ot(de.prototype,"toggleControlId",[Z],{configurable:true,enumerable:true,writable:true,initializer:null}),Te=ot(de.prototype,"initialLayout",[ee],{configurable:true,enumerable:true,writable:true,initializer:function(){return"compact"}}),ke=ot(de.prototype,"showClearButton",[te],{configurable:true,enumerable:true,writable:true,initializer:function(){return false}}),Me=ot(de.prototype,"_applyIdToContent",[ie],{configurable:true,enumerable:true,writable:true,initializer:function(){return false}}),Re=ot(de.prototype,"disableDraftEditStateFilter",[re],{configurable:true,enumerable:true,writable:true,initializer:function(){return false}}),He=ot(de.prototype,"search",[ae],{configurable:true,enumerable:true,writable:true,initializer:null}),Oe=ot(de.prototype,"filterChanged",[ne],{configurable:true,enumerable:true,writable:true,initializer:null}),$e=ot(de.prototype,"internalFilterChanged",[le],{configurable:true,enumerable:true,writable:true,initializer:null}),je=ot(de.prototype,"internalSearch",[oe],{configurable:true,enumerable:true,writable:true,initializer:null}),Ve=ot(de.prototype,"afterClear",[se],{configurable:true,enumerable:true,writable:true,initializer:null}),Le=ot(de.prototype,"filterFields",[ue],{configurable:true,enumerable:true,writable:true,initializer:null}),Ne=ot(de.prototype,"ignorePersonalizationChanges",[ce],{configurable:true,enumerable:true,writable:true,initializer:function(){return false}}),de))||pe);qe=ct;return qe},false);
//# sourceMappingURL=FilterBar.block.js.map