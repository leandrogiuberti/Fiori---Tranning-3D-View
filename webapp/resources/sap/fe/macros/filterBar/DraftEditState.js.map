{"version":3,"file":"DraftEditState.js","names":["feBundle","Library","getResourceBundleFor","EDITSTATE","ALL","id","display","getText","UNCHANGED","OWN_DRAFT","LOCKED","UNSAVED_CHANGES","ALL_HIDING_DRAFTS","SAVED_ONLY","MY_DRAFTS","getEditStates","isDraftCollaborative","this","getEditStatesContext","macroProps","availableEditStates","getProperty","JSONModel","bindContext","getBoundContext","getCurrentUserID","ushellContainer","sap","ui","require","getUser","getId","window","adt","userID","getFilterForEditState","editState","Filter","filters","path","operator","FilterOperator","EQ","value1","and","NE","currentUserID","Any","variable","condition"],"sources":["./DraftEditState.ts"],"sourcesContent":["import Library from \"sap/ui/core/Lib\";\nimport type Context from \"sap/ui/model/Context\";\nimport Filter from \"sap/ui/model/Filter\";\nimport FilterOperator from \"sap/ui/model/FilterOperator\";\nimport JSONModel from \"sap/ui/model/json/JSONModel\";\n\nconst feBundle = Library.getResourceBundleFor(\"sap.fe.core\")!;\n/**\n * Enum for edit state of a document in an draft enabled service collection.\n * Allows to simplify filtering on a set of documents as described by the\n * individual state\n * @readonly\n * @enum {string}\n */\nconst EDITSTATE = {\n\t/**\n\t * Active documents that don't have a corresponding draft and all own draft documents\n\t */\n\tALL: {\n\t\tid: \"\",\n\t\tdisplay: feBundle.getText(\"C_DRAFT_EDIT_STATE_DRAFT_ALL_FILTER\")\n\t},\n\t/**\n\t * Active documents that don't have a draft document\n\t */\n\tUNCHANGED: {\n\t\tid: \"UNCHANGED\",\n\t\tdisplay: feBundle.getText(\"C_DRAFT_EDIT_STATE_DRAFT_UNCHANGED_FILTER\")\n\t},\n\t/**\n\t * Own draft documents\n\t */\n\tOWN_DRAFT: {\n\t\tid: \"OWN_DRAFT\",\n\t\tdisplay: feBundle.getText(\"C_DRAFT_EDIT_STATE_DRAFT_OWN_DRAFT_FILTER\")\n\t},\n\t/**\n\t * Active documents that are locked by other users\n\t */\n\tLOCKED: {\n\t\tid: \"LOCKED\",\n\t\tdisplay: feBundle.getText(\"C_DRAFT_EDIT_STATE_DRAFT_LOCKED_FILTER\")\n\t},\n\t/**\n\t * Active documents that have draft documents by other users\n\t *\n\t */\n\tUNSAVED_CHANGES: {\n\t\tid: \"UNSAVED_CHANGES\",\n\t\tdisplay: feBundle.getText(\"C_DRAFT_EDIT_STATE_DRAFT_UNSAVED_CHANGES_FILTER\")\n\t},\n\t/**\n\t * Active documents only\n\t */\n\tALL_HIDING_DRAFTS: {\n\t\tid: \"ALL_HIDING_DRAFTS\",\n\t\tdisplay: feBundle.getText(\"C_DRAFT_EDIT_STATE_DRAFT_ALL_HIDING_DRAFTS_FILTER\")\n\t},\n\t/**\n\t * Active documents only (with collaborative draft)\n\t */\n\tSAVED_ONLY: {\n\t\tid: \"SAVED_ONLY\",\n\t\tdisplay: feBundle.getText(\"C_DRAFT_EDIT_STATE_DRAFT_SAVED_ONLY_FILTER\")\n\t},\n\t/**\n\t * My drafts, i.e. the drafts I have created, have been invited to or have made a change in (with collaborative draft)\n\t */\n\tMY_DRAFTS: {\n\t\tid: \"MY_DRAFTS\",\n\t\tdisplay: feBundle.getText(\"C_DRAFT_EDIT_STATE_DRAFT_MY_DRAFTS_FILTER\")\n\t},\n\n\tgetEditStates: function (isDraftCollaborative: boolean): Record<string, string>[] {\n\t\tif (isDraftCollaborative) {\n\t\t\treturn [this.ALL, this.MY_DRAFTS, this.SAVED_ONLY];\n\t\t} else {\n\t\t\treturn [this.ALL, this.ALL_HIDING_DRAFTS, this.UNCHANGED, this.OWN_DRAFT, this.LOCKED, this.UNSAVED_CHANGES];\n\t\t}\n\t},\n\n\t/**\n\t * Determines the context of the edit state of the document.\n\t * @param macroProps The macro properties\n\t * @returns The bound context.\n\t */\n\tgetEditStatesContext: function (macroProps: Context): Context {\n\t\tlet availableEditStates: Record<string, string>[];\n\t\tif (macroProps.getProperty(\"isDraftCollaborative\")) {\n\t\t\tavailableEditStates = [EDITSTATE.ALL, EDITSTATE.MY_DRAFTS, EDITSTATE.SAVED_ONLY];\n\t\t} else {\n\t\t\tavailableEditStates = [\n\t\t\t\tEDITSTATE.ALL,\n\t\t\t\tEDITSTATE.ALL_HIDING_DRAFTS,\n\t\t\t\tEDITSTATE.UNCHANGED,\n\t\t\t\tEDITSTATE.OWN_DRAFT,\n\t\t\t\tEDITSTATE.LOCKED,\n\t\t\t\tEDITSTATE.UNSAVED_CHANGES\n\t\t\t];\n\t\t}\n\n\t\treturn new JSONModel(availableEditStates).bindContext(\"/\").getBoundContext()!;\n\t},\n\n\t/**\n\t * Determines the current user id.\n\t * @returns The id of the current user.\n\t */\n\tgetCurrentUserID: function (): string | undefined {\n\t\t// in case no shell is available (e.g. in standalone mode), we use the user id from the adt object\n\t\tconst ushellContainer = sap.ui.require(\"sap/ushell/Container\");\n\t\treturn ushellContainer?.getUser()?.getId() ?? window.adt?.userID;\n\t},\n\n\t/**\n\t * Determines the filter of the current edit state of the document.\n\t * @param editState The current editState\n\t * @returns The associated filter.\n\t */\n\tgetFilterForEditState: function (editState: string): Filter {\n\t\tswitch (editState) {\n\t\t\tcase EDITSTATE.UNCHANGED.id:\n\t\t\t\treturn new Filter({\n\t\t\t\t\tfilters: [\n\t\t\t\t\t\tnew Filter({ path: \"IsActiveEntity\", operator: FilterOperator.EQ, value1: true }),\n\t\t\t\t\t\tnew Filter({ path: \"HasDraftEntity\", operator: FilterOperator.EQ, value1: false })\n\t\t\t\t\t],\n\t\t\t\t\tand: true\n\t\t\t\t});\n\t\t\tcase EDITSTATE.OWN_DRAFT.id:\n\t\t\t\treturn new Filter({ path: \"IsActiveEntity\", operator: FilterOperator.EQ, value1: false });\n\t\t\tcase EDITSTATE.LOCKED.id:\n\t\t\t\treturn new Filter({\n\t\t\t\t\tfilters: [\n\t\t\t\t\t\tnew Filter({ path: \"IsActiveEntity\", operator: FilterOperator.EQ, value1: true }),\n\t\t\t\t\t\tnew Filter({\n\t\t\t\t\t\t\tpath: \"SiblingEntity/IsActiveEntity\",\n\t\t\t\t\t\t\toperator: FilterOperator.EQ,\n\t\t\t\t\t\t\tvalue1: null\n\t\t\t\t\t\t}),\n\t\t\t\t\t\tnew Filter({\n\t\t\t\t\t\t\tpath: \"DraftAdministrativeData/InProcessByUser\",\n\t\t\t\t\t\t\toperator: FilterOperator.NE,\n\t\t\t\t\t\t\tvalue1: \"\"\n\t\t\t\t\t\t}),\n\t\t\t\t\t\tnew Filter({\n\t\t\t\t\t\t\tpath: \"DraftAdministrativeData/InProcessByUser\",\n\t\t\t\t\t\t\toperator: FilterOperator.NE,\n\t\t\t\t\t\t\tvalue1: null\n\t\t\t\t\t\t})\n\t\t\t\t\t],\n\t\t\t\t\tand: true\n\t\t\t\t});\n\t\t\tcase EDITSTATE.UNSAVED_CHANGES.id:\n\t\t\t\treturn new Filter({\n\t\t\t\t\tfilters: [\n\t\t\t\t\t\tnew Filter({ path: \"IsActiveEntity\", operator: FilterOperator.EQ, value1: true }),\n\t\t\t\t\t\tnew Filter({\n\t\t\t\t\t\t\tpath: \"SiblingEntity/IsActiveEntity\",\n\t\t\t\t\t\t\toperator: FilterOperator.EQ,\n\t\t\t\t\t\t\tvalue1: null\n\t\t\t\t\t\t}),\n\t\t\t\t\t\tnew Filter({\n\t\t\t\t\t\t\tpath: \"DraftAdministrativeData/InProcessByUser\",\n\t\t\t\t\t\t\toperator: FilterOperator.EQ,\n\t\t\t\t\t\t\tvalue1: \"\"\n\t\t\t\t\t\t})\n\t\t\t\t\t],\n\t\t\t\t\tand: true\n\t\t\t\t});\n\t\t\tcase EDITSTATE.ALL_HIDING_DRAFTS.id:\n\t\t\tcase EDITSTATE.SAVED_ONLY.id:\n\t\t\t\treturn new Filter({ path: \"IsActiveEntity\", operator: FilterOperator.EQ, value1: true });\n\t\t\tcase EDITSTATE.MY_DRAFTS.id:\n\t\t\t\tconst currentUserID = this.getCurrentUserID();\n\t\t\t\treturn currentUserID\n\t\t\t\t\t? new Filter({\n\t\t\t\t\t\t\tfilters: [\n\t\t\t\t\t\t\t\tnew Filter({ path: \"IsActiveEntity\", operator: FilterOperator.EQ, value1: false }),\n\t\t\t\t\t\t\t\tnew Filter({\n\t\t\t\t\t\t\t\t\tpath: \"DraftAdministrativeData/DraftAdministrativeUser\",\n\t\t\t\t\t\t\t\t\toperator: FilterOperator.Any,\n\t\t\t\t\t\t\t\t\tvariable: \"user\",\n\t\t\t\t\t\t\t\t\tcondition: new Filter({\n\t\t\t\t\t\t\t\t\t\tpath: \"user/UserID\",\n\t\t\t\t\t\t\t\t\t\toperator: FilterOperator.EQ,\n\t\t\t\t\t\t\t\t\t\tvalue1: this.getCurrentUserID()\n\t\t\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t],\n\t\t\t\t\t\t\tand: true\n\t\t\t\t\t  })\n\t\t\t\t\t: new Filter({ path: \"IsActiveEntity\", operator: FilterOperator.EQ, value1: false }); // Couldn't find current user (e.g. no shell) --> show all drafts\n\t\t\tdefault:\n\t\t\t\t// ALL\n\t\t\t\treturn new Filter({\n\t\t\t\t\tfilters: [\n\t\t\t\t\t\tnew Filter({ path: \"IsActiveEntity\", operator: FilterOperator.EQ, value1: false }),\n\t\t\t\t\t\tnew Filter({\n\t\t\t\t\t\t\tpath: \"SiblingEntity/IsActiveEntity\",\n\t\t\t\t\t\t\toperator: FilterOperator.EQ,\n\t\t\t\t\t\t\tvalue1: null\n\t\t\t\t\t\t})\n\t\t\t\t\t],\n\t\t\t\t\tand: false\n\t\t\t\t});\n\t\t}\n\t}\n};\n\nexport default EDITSTATE;\n"],"mappings":"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","ignoreList":[]}