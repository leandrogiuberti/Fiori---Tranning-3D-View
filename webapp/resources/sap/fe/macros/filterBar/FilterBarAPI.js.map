{"version":3,"file":"FilterBarAPI.js","names":["FilterBarTelemetry","filterBarAPI","this","countFilterActions","countVariantFilters","_proto","prototype","onFiltersChanged","reason","onSearch","eventParameters","conditions","filterNames","getFilterNamesFromConditions","getPageController","telemetry","storeAction","type","parameters","countFilters","Object","keys","length","variantLayer","getVariant","layer","autoLoad","searchUsed","$search","forEach","condition","VariantManagementType","DISPLAY_CURRENCY_PROPERTY_NAME","P_DISPLAY_CURRENCY_PROPERTY_NAME","FilterBarAPI","_dec","defineUI5Class","returnTypes","_dec2","mixin","FilterBarAPIStateHandler","_dec3","controllerExtensionHandler","_dec4","_dec5","property","_dec6","expectedAnnotations","expectedTypes","_dec7","_dec8","defaultValue","_dec9","_dec10","_dec11","_dec12","aggregation","multiple","_dec13","event","_dec14","_dec15","_dec16","_dec17","_dec18","xmlEventHandler","_dec19","_class","_class2","_MacroAPI","props","others","_this","call","initialControlState","_initialStatePromise","PromiseKeeper","_bSearchTriggered","_hasPendingFilters","_initializerDefineProperty","_descriptor","_descriptor2","_descriptor3","_descriptor4","_descriptor5","_descriptor6","_descriptor7","_descriptor8","_descriptor9","_descriptor10","_descriptor11","_descriptor12","_descriptor13","attachStateChangeHandler","_inheritsLoose","_proto2","retrieveAdditionalStates","additionalStates","getId","dataLoaded","applyAdditionalStates","instanceState","instanceDataLoaded","undefined","parentDataLoaded","triggerSearch","content","waitForInitialState","async","promise","getControlState","controlState","fullState","initialState","isSearchTriggeredByInitialLoad","navigationType","controller","view","getView","viewData","getViewData","variantManagement","Control","_getFilterBarVariantControl","byId","currentVariantKey","getCurrentVariantKey","NavType","xAppState","initialLoad","InitialLoadMode","Enabled","_shouldAutoTriggerSearch","_getFilterBarVM","_getApplyAutomaticallyOnVariant","_applySelectionVariant","navigationParameter","filterVariantApplied","filterBar","getContent","selectionVariant","sv","selectionVariantDefaults","svDefaults","requiresStandardVariant","Promise","resolve","shouldApplyAppState","_activateVariantAndDetermineApplyAppState","_addDefaultDisplayCurrencyToSV","svDefaultsArePresent","getSelectOptionsPropertyNames","stdVariantIsDefaultVariant","getDefaultVariantKey","getStandardVariantKey","useFLPDefaultValues","getParent","svToSet","_getAdjustedSV","setSelectionVariant","_enableFilterBar","filterBarControl","preventInitialSearch","fnOnSearch","getSuspendSelection","attachEventOnce","enableRequests","appStateSV","adjustedSV","SelectionVariant","toJSONObject","alreadyAppliedSV","getSelectionVariant","appliedSelOptNames","reduce","svCopy","selOptionName","svSelOpts","getSelectOption","selectOptions","massAddSelectOption","_preventInitialSearch","aVariants","getVariants","oCurrentVariant","find","item","getKey","executeOnSelect","isEmpty","metaModel","getModel","getMetaModel","contextPath","entitySet","metaContext","getMetaContext","dataModelObjectPath","getInvolvedDataModelObjects","displayCurrencyPropertyName","getDisplayCurrencyPropertyName","displayCurrencyIsMandatory","_checkIfDisplayCurrencyIsRequired","svOptions","defaultSVOptions","displayCurrencyDefaultExists","noSVDisplayCurrencyExists","displayCurrencySelectOption","sign","option","low","high","addSelectOption","isParameterized","startingEntitySet","entityType","annotations","Common","ResultContext","entityProperties","some","parameter","name","_type","requiredProperties","Capabilities","FilterRestrictions","RequiredProperties","requiredProperty","value","reqStdVariant","variantKey","ControlVariantApplyAPI","activateVariant","element","variantReference","Page","getController","None","handleVariantIdPassedViaURLParams","oUrlParams","aPageVariantId","aFilterBarVariantId","aTableVariantId","aChartVariantId","oVariantIDs","sPageVariantId","sFilterBarVariantId","sTableVariantId","sChartVariantId","_handleControlVariantId","oVM","oView","aPromises","sVariantManagement","_handlePageVariantId","_handleFilterBarVariantControlId","all","oVariant","_findAndPushVariantToPromise","sVariantId","bFilterVariantApplied","key","push","_applyControlVariant","sVariantID","arguments","sVariantReference","_checkIfVariantIdIsAvailable","then","bIsControlStateVariantAvailable","StateUtil","detachStateChange","stateChangeHandler","attachStateChange","oEvent","control","getParameter","isA","handleStateChange","handleSearch","oFilterBar","getSource","getParameters","getFilterConditions","preparedEventParameters","_prepareEventParameters","fireEvent","merge","liveMode","getExtensionAPI","updateAppState","handleFilterChanged","oEventParameters","oConditions","_getFilterBarReason","conditionsBased","_sReason","filters","search","FilterUtils","getFilters","setFilterValues","sConditionPath","sOperator","vValues","getActiveFiltersText","getAssignedFiltersText","filtersText","waitForInitialization","err","message","Error","String","Log","error","isSemanticDateFilterApplied","SemanticDateOperators","hasSemanticDateOperations","getConditions","stateHelper","appComponent","CommonUtils","getAppComponent","navigationService","getNavigationService","dataModelObject","getDataModelObjectForMetaPath","metaPath","targetEntitySet","sContextUrl","constructContextUrl","setFilterContextUrl","getMandatoryFilterPropertyNames","getPropertyInfoSet","filter","filterProp","required","map","requiredProp","conditionPath","data","Array","isArray","JSON","parse","currentVariant","variantModel","variantBackReference","getVariantBackreference","getCurrentVariantReference","e","debug","setFilterFieldVisible","visible","applyExternalState","items","getFilterFieldVisible","state","retrieveExternalState","getVariantManagement","variantBackreference","UI5Element","getElementById","id","setVariantBackReference","variant","isLiveMode","getLiveMode","setVariantBackreference","setCurrentVariantKey","setFilterFieldEnabled","enabled","setData","filterFields","editMode","FieldEditMode","Editable","Disabled","getFilterFieldEnabled","getProperty","convertSelectionVariantToStateFilters","prefillDescriptions","_clearFilterValuesWithOptions","options","result","setSelectionVariantToMdcControl","applyStateResult","diffState","getConditionPath","propertyPath","propertyTargetObjectPath","getDataModelObjectPathForProperty","getContextRelativeTargetObjectPath","showFilterField","targetFilterField","openValueHelpForFilterField","inputValue","reject","filterField","getFilterItems","getPropertyKey","valueHelp","getValueHelp","_oFocusInfo","targetInfo","silent","onfocusin","jQuery","Event","setTimeout","getAggregation","fireValueHelpRequest","fromKeyboard","_userInputValue","getCollapsedFiltersText","MacroAPI","_applyDecoratedDescriptor","getOwnPropertyDescriptor","configurable","enumerable","writable","initializer"],"sources":["./FilterBarAPI.ts"],"sourcesContent":["import type { EntitySet, Property, PropertyPath } from \"@sap-ux/vocabularies-types\";\nimport Log from \"sap/base/Log\";\nimport merge from \"sap/base/util/merge\";\nimport type { PropertiesOf } from \"sap/fe/base/ClassSupport\";\nimport { aggregation, defineUI5Class, event, mixin, property, xmlEventHandler } from \"sap/fe/base/ClassSupport\";\nimport { controllerExtensionHandler } from \"sap/fe/base/HookSupport\";\nimport CommonUtils from \"sap/fe/core/CommonUtils\";\nimport type { ControlState, LegacyFilterBarState, NavigationParameter } from \"sap/fe/core/controllerextensions/ViewState\";\nimport { getInvolvedDataModelObjects } from \"sap/fe/core/converters/MetaModelConverter\";\nimport PromiseKeeper from \"sap/fe/core/helpers/PromiseKeeper\";\nimport { InitialLoadMode } from \"sap/fe/core/library\";\nimport type { DataModelObjectPath } from \"sap/fe/core/templating/DataModelPathHelper\";\nimport { getContextRelativeTargetObjectPath } from \"sap/fe/core/templating/DataModelPathHelper\";\nimport MacroAPI from \"sap/fe/macros/MacroAPI\";\nimport type FilterBar from \"sap/fe/macros/controls/FilterBar\";\nimport type { IFilterControl } from \"sap/fe/macros/filter/FilterUtils\";\nimport FilterUtils from \"sap/fe/macros/filter/FilterUtils\";\nimport type FilterField from \"sap/fe/macros/filterBar/FilterField\";\nimport SemanticDateOperators from \"sap/fe/macros/filterBar/SemanticDateOperators\";\nimport type { ControlPropertyInfo } from \"sap/fe/macros/mdc/adapter/StateHelper\";\nimport stateHelper from \"sap/fe/macros/mdc/adapter/StateHelper\";\nimport type { InternalBindingInfo } from \"sap/fe/macros/table/Utils\";\nimport type { ExternalStateType } from \"sap/fe/macros/valuehelp/ValueHelpDelegate\";\nimport SelectionVariant from \"sap/fe/navigation/SelectionVariant\";\nimport { NavType } from \"sap/fe/navigation/library\";\nimport type { default as ListReportController } from \"sap/fe/templates/ListReport/ListReportController.controller\";\nimport type Input from \"sap/m/Input\";\nimport type { Input$ValueHelpRequestEventParameters } from \"sap/m/Input\";\nimport type { default as Event } from \"sap/ui/base/Event\";\nimport type { $ControlSettings } from \"sap/ui/core/Control\";\nimport UI5Element from \"sap/ui/core/Element\";\nimport type View from \"sap/ui/core/mvc/View\";\nimport ControlVariantApplyAPI from \"sap/ui/fl/apply/api/ControlVariantApplyAPI\";\nimport type VariantManagement from \"sap/ui/fl/variants/VariantManagement\";\nimport type VariantModel from \"sap/ui/fl/variants/VariantModel\";\nimport type { VariantData } from \"sap/ui/fl/variants/VariantModel\";\nimport type Control from \"sap/ui/mdc/Control\";\nimport type ValueHelp from \"sap/ui/mdc/ValueHelp\";\nimport type { ConditionObject } from \"sap/ui/mdc/condition/Condition\";\nimport FieldEditMode from \"sap/ui/mdc/enums/FieldEditMode\";\nimport type { FilterBarBase$FiltersChangedEvent, FilterBarBase$SearchEvent } from \"sap/ui/mdc/filterbar/FilterBarBase\";\nimport type { Filter as StateUtilFilter } from \"sap/ui/mdc/p13n/StateUtil\";\nimport StateUtil from \"sap/ui/mdc/p13n/StateUtil\";\nimport type JSONModel from \"sap/ui/model/json/JSONModel\";\nimport type { default as MetaModel, default as ODataMetaModel } from \"sap/ui/model/odata/v4/ODataMetaModel\";\nimport jQuery from \"sap/ui/thirdparty/jquery\";\nimport FilterBarAPIStateHandler from \"./mixin/FilterBarAPIStateHandler\";\n\n// Track telemetry content for the filterBar\nclass FilterBarTelemetry {\n\tprivate countFilterActions = 0;\n\n\tprivate countVariantFilters = 0;\n\n\tconstructor(private readonly filterBarAPI: FilterBarAPI) {}\n\n\tonFiltersChanged(reason?: string): void {\n\t\tif (reason === \"Variant\") {\n\t\t\tthis.countVariantFilters++;\n\t\t} else {\n\t\t\tthis.countFilterActions++;\n\t\t}\n\t}\n\n\tonSearch(eventParameters: { reason?: string }, conditions: Record<string, ConditionObject[]>): void {\n\t\tconst filterNames = this.getFilterNamesFromConditions(conditions);\n\t\tthis.filterBarAPI.getPageController()?.telemetry.storeAction({\n\t\t\ttype: \"FE.FilterBarSearch\",\n\t\t\tparameters: {\n\t\t\t\tcountFilterActions: this.countFilterActions, //  How many filterChanged actions are performed\n\t\t\t\tcountFilters: Object.keys(conditions).length, // How many different filters are applied\n\t\t\t\tcountVariantFilters: this.countVariantFilters, // How many filter belong to a variant\n\t\t\t\tvariantLayer: this.filterBarAPI.getVariant()?.layer ?? \"None\", // | \"SAP\" | \"Custom\"; // Type of variant\n\t\t\t\tautoLoad: eventParameters.reason === \"Variant\", // Is the filter automatically executed\n\t\t\t\tsearchUsed: conditions.$search ? !!Object.keys(conditions.$search).length : false, // Was the search field in the filterbar used?\n\t\t\t\tfilterNames: filterNames // Property names of the filters\n\t\t\t}\n\t\t});\n\t\t// Reset the count\n\t\tthis.countFilterActions = 0;\n\t\tthis.countVariantFilters = 0;\n\t}\n\n\tgetFilterNamesFromConditions(conditions: Record<string, ConditionObject[]>): string {\n\t\tlet filterNames = \"\";\n\t\tObject.keys(conditions).forEach((condition) => {\n\t\t\tif (condition != \"$search\") {\n\t\t\t\tfilterNames += condition + \";\";\n\t\t\t}\n\t\t});\n\t\treturn filterNames;\n\t}\n}\n\nexport type FilterBarState = {\n\tinnerState?: {\n\t\tfilter?: Record<string, ConditionObject[]>;\n\t\tinitialState?: LegacyFilterBarState;\n\t\tfullState?: LegacyFilterBarState;\n\t};\n};\n\ntype VariantIDs = {\n\tsPageVariantId: string;\n\tsFilterBarVariantId: string;\n\tsTableVariantId: string;\n\tsChartVariantId: string;\n};\n\ntype VariantObject = {\n\tauthor: string;\n\tchange: boolean;\n\tcontexts: object;\n\texecuteOnSelect: boolean;\n\tfavorite: boolean;\n\tkey: string;\n\toriginalContexts: object;\n\toriginalExecuteOnSelect: boolean;\n\toriginalFavorite: boolean;\n\toriginalTitle: string;\n\toriginalVisible: boolean;\n\tremove: boolean;\n\trename: boolean;\n\tsharing: string;\n\ttitle: string;\n\tvisible: boolean;\n};\n\nenum VariantManagementType {\n\tControl = \"Control\",\n\tPage = \"Page\",\n\tNone = \"None\"\n}\n\nconst DISPLAY_CURRENCY_PROPERTY_NAME = \"DisplayCurrency\";\nconst P_DISPLAY_CURRENCY_PROPERTY_NAME = \"P_DisplayCurrency\";\n\ntype LRViewData = {\n\tcontrolConfiguration?: Record<string, Record<string, unknown>>;\n\tentitySet?: string;\n\tcontextPath?: string;\n\tvariantManagement?: boolean | string;\n};\n\n/**\n * The key type includes 'boolean' to support legacy scenarios where 'dataLoaded' may be present at the parent level as a boolean,\n * as well as at instance level as an object with a 'dataLoaded' property. This ensures compatibility with both usages.\n */\ntype AdditionalStates = {\n\tdataLoaded?: boolean;\n\t[key: string]: { dataLoaded?: boolean } | boolean | undefined;\n};\n\ninterface FilterBarAPI extends FilterBarAPIStateHandler {}\n\n/**\n * Building block for creating a FilterBar based on the metadata provided by OData V4.\n * {@link demo:sap/fe/core/fpmExplorer/index.html#/buildingBlocks/filterBar/filterBarDefault Overview of Building Blocks}\n * <br>\n * Usually, a SelectionFields annotation is expected.\n *\n *\n * Usage example:\n * <pre>\n * &lt;macros:FilterBar id=\"MyFilterBar\" metaPath=\"@com.sap.vocabularies.UI.v1.SelectionFields\" /&gt;\n * </pre>\n * @alias sap.fe.macros.FilterBar\n * @public\n */\n@defineUI5Class(\"sap.fe.macros.filterBar.FilterBarAPI\", {\n\treturnTypes: [\"sap.ui.core.Control\"]\n})\n@mixin(FilterBarAPIStateHandler)\nclass FilterBarAPI extends MacroAPI {\n\tinitialControlState: Record<string, unknown> = {};\n\n\t_initialStatePromise: PromiseKeeper<void> = new PromiseKeeper();\n\n\t_bSearchTriggered = false;\n\n\tprivate _hasPendingFilters = true;\n\n\t@controllerExtensionHandler(\"viewState\", \"retrieveAdditionalStates\")\n\tpublic retrieveAdditionalStates(additionalStates: AdditionalStates): void {\n\t\tadditionalStates[this.getId()] = { dataLoaded: !this._hasPendingFilters };\n\t}\n\n\t@controllerExtensionHandler(\"viewState\", \"applyAdditionalStates\")\n\tpublic applyAdditionalStates(additionalStates: AdditionalStates): void {\n\t\tconst instanceState = additionalStates[this.getId()];\n\t\tlet instanceDataLoaded: boolean | undefined;\n\t\tif (typeof instanceState === \"object\" && instanceState !== null) {\n\t\t\tinstanceDataLoaded = instanceState.dataLoaded;\n\t\t} else {\n\t\t\tinstanceDataLoaded = undefined;\n\t\t}\n\n\t\tconst parentDataLoaded =\n\t\t\t\"dataLoaded\" in additionalStates && typeof additionalStates.dataLoaded === \"boolean\" ? additionalStates.dataLoaded : undefined;\n\n\t\tif (parentDataLoaded === true || instanceDataLoaded === true) {\n\t\t\tthis.triggerSearch();\n\t\t}\n\t\tif (parentDataLoaded === false || instanceDataLoaded === false) {\n\t\t\t(this.content as { _bSearchTriggered?: boolean })._bSearchTriggered = false;\n\t\t}\n\t}\n\n\tasync waitForInitialState(): Promise<void> {\n\t\treturn this._initialStatePromise.promise;\n\t}\n\n\tgetControlState(controlState: ControlState): ControlState {\n\t\tconst initialControlState: Record<string, unknown> = this.initialControlState;\n\t\tif (controlState) {\n\t\t\treturn {\n\t\t\t\tfullState: controlState as object,\n\t\t\t\tinitialState: initialControlState as object\n\t\t\t};\n\t\t}\n\t\treturn controlState;\n\t}\n\n\t/**\n\t * Determines whether Search can be triggered at initial load of the application or not.\n\t * @param navigationType Navigation Type during the load of the application\n\t * @returns A Boolean determining whether Search can be triggered or not\n\t */\n\tisSearchTriggeredByInitialLoad(navigationType: string): boolean {\n\t\tconst controller = this.getPageController() as ListReportController,\n\t\t\tview = controller.getView(),\n\t\t\tviewData = view.getViewData();\n\t\tlet isSearchTriggeredByInitialLoad = false,\n\t\t\tvariantManagement;\n\t\t// Determining whether it's Control variantManagement or Page variantManagement\n\t\tif (viewData.variantManagement === VariantManagementType.Control) {\n\t\t\tvariantManagement = controller._getFilterBarVariantControl();\n\t\t} else {\n\t\t\tvariantManagement = view.byId(\"fe::PageVariantManagement\") as VariantManagement;\n\t\t}\n\t\tconst currentVariantKey = variantManagement?.getCurrentVariantKey();\n\t\t//The check shall happen for 'intial load' and 'Apply Automatically' for collapsing the header or\n\t\t// always be collapsed if navType is xAppState\n\t\t// initialLoad Auto or Disabled\n\t\tif (navigationType === NavType.xAppState) {\n\t\t\treturn true;\n\t\t} else if (variantManagement && viewData.initialLoad !== InitialLoadMode.Enabled) {\n\t\t\t// Header is collapsed if preset filters are set for initial load Auto, Header shall remain expanded if initial load is Auto without preset filters or intial load is disabled\n\t\t\tif (controller._shouldAutoTriggerSearch(this._getFilterBarVM(view))) {\n\t\t\t\tisSearchTriggeredByInitialLoad = true;\n\t\t\t}\n\t\t}\n\t\t// initialLoad Enabled\n\t\telse if (\n\t\t\tvariantManagement &&\n\t\t\tviewData.initialLoad === InitialLoadMode.Enabled &&\n\t\t\tcontroller._getApplyAutomaticallyOnVariant(variantManagement, currentVariantKey)\n\t\t) {\n\t\t\tisSearchTriggeredByInitialLoad = true;\n\t\t}\n\t\treturn isSearchTriggeredByInitialLoad;\n\t}\n\n\t/**\n\t * Apply Selection Variant from Navigation Parameter.\n\t * @param view View of the LR filter bar\n\t * @param navigationParameter Selection Variant to apply from appState\n\t * @param filterVariantApplied Is a filter variant alaready applied\n\t * @returns Promise for asynchronous handling\n\t */\n\tasync _applySelectionVariant(view: View, navigationParameter: NavigationParameter, filterVariantApplied: boolean): Promise<unknown> {\n\t\tconst filterBar = this.getContent() as FilterBar;\n\t\tconst { selectionVariant: sv, selectionVariantDefaults: svDefaults, requiresStandardVariant = false } = navigationParameter;\n\n\t\tif (!filterBar || !sv) {\n\t\t\treturn Promise.resolve();\n\t\t}\n\t\tconst variantManagement = this._getFilterBarVM(view) as VariantManagement;\n\t\tconst shouldApplyAppState = await this._activateVariantAndDetermineApplyAppState(\n\t\t\tvariantManagement,\n\t\t\trequiresStandardVariant,\n\t\t\tfilterVariantApplied\n\t\t);\n\t\tif (shouldApplyAppState) {\n\t\t\tthis._addDefaultDisplayCurrencyToSV(view, sv, svDefaults);\n\n\t\t\t// check if FLP default values are there and is it standard variant\n\t\t\tconst svDefaultsArePresent = svDefaults ? svDefaults.getSelectOptionsPropertyNames().length > 0 : false;\n\t\t\tconst stdVariantIsDefaultVariant =\n\t\t\t\tvariantManagement && variantManagement.getDefaultVariantKey() === variantManagement.getStandardVariantKey();\n\t\t\tconst useFLPDefaultValues: boolean = svDefaultsArePresent && (stdVariantIsDefaultVariant || !variantManagement);\n\n\t\t\tconst filterBarAPI = filterBar.getParent() as FilterBarAPI;\n\t\t\tlet svToSet: SelectionVariant = sv;\n\t\t\tif (filterVariantApplied || useFLPDefaultValues) {\n\t\t\t\tsvToSet = await this._getAdjustedSV(sv, useFLPDefaultValues);\n\t\t\t}\n\t\t\treturn filterBarAPI.setSelectionVariant(svToSet, true);\n\t\t}\n\t}\n\n\t_enableFilterBar(filterBarControl: FilterBar, preventInitialSearch: boolean): void {\n\t\tconst filterBarAPI = filterBarControl.getParent() as FilterBarAPI;\n\t\tconst fnOnSearch = (): void => {\n\t\t\tthis._bSearchTriggered = !preventInitialSearch;\n\t\t};\n\n\t\t// reset the suspend selection on filter bar to allow loading of data when needed (was set on LR Init)\n\t\tif (filterBarControl.getSuspendSelection()) {\n\t\t\t// Only if search is fired we set _bSearchTriggered.\n\t\t\t// If there was an error due to required filterfields empty or other issues we skip setting _bSearchTriggered.\n\t\t\tfilterBarAPI.attachEventOnce(\"search\", fnOnSearch);\n\t\t\tfilterBarControl.enableRequests(true);\n\t\t} else {\n\t\t\t// search might already be triggered.\n\t\t\tfnOnSearch();\n\t\t}\n\t}\n\n\tasync _getAdjustedSV(appStateSV: SelectionVariant, useFLPDefaultValues: boolean): Promise<SelectionVariant> {\n\t\tlet adjustedSV = new SelectionVariant(appStateSV.toJSONObject());\n\t\tconst alreadyAppliedSV = await this.getSelectionVariant();\n\t\tconst appliedSelOptNames = alreadyAppliedSV?.getSelectOptionsPropertyNames() || [];\n\t\tif (appliedSelOptNames.length > 0) {\n\t\t\t// We merge 'applied SV' and 'appState SV' based on 'useFLPDefaultValues'.\n\t\t\tadjustedSV = appliedSelOptNames.reduce((svCopy: SelectionVariant, selOptionName) => {\n\t\t\t\t// (appStateSV = adjustedSV = svCopy)\n\t\t\t\tconst svSelOpts = svCopy.getSelectOption(selOptionName);\n\t\t\t\t// If useFLPDefaultValues = true, means (appStateSV = svDefaults)\n\t\t\t\tif ((useFLPDefaultValues && !svSelOpts?.length) || !useFLPDefaultValues) {\n\t\t\t\t\t// if default SV needs to be used, then select options from default select options take priority.\n\t\t\t\t\t// else we merge both: already applied SV and SV from navParams.\n\t\t\t\t\tconst selectOptions = alreadyAppliedSV.getSelectOption(selOptionName);\n\t\t\t\t\tsvCopy.massAddSelectOption(selOptionName, selectOptions || []);\n\t\t\t\t}\n\t\t\t\treturn svCopy;\n\t\t\t}, adjustedSV);\n\t\t}\n\n\t\treturn adjustedSV;\n\t}\n\n\t_preventInitialSearch(variantManagement: VariantManagement): boolean {\n\t\tif (!variantManagement) {\n\t\t\treturn true;\n\t\t}\n\t\tconst aVariants = variantManagement.getVariants();\n\t\tconst oCurrentVariant = aVariants.find(function (item): boolean {\n\t\t\treturn item.getKey() === variantManagement.getCurrentVariantKey();\n\t\t});\n\t\treturn !oCurrentVariant.executeOnSelect;\n\t}\n\n\t/**\n\t * Add DisplayCurrency to SV if it is mandatory and exists in SV defaults.\n\t * @param view View of the LR filter bar\n\t * @param sv Selection Variant to apply\n\t * @param svDefaults Selection Variant defaults\n\t */\n\t_addDefaultDisplayCurrencyToSV(view: View, sv: SelectionVariant, svDefaults?: SelectionVariant): void {\n\t\tif (!svDefaults || svDefaults?.isEmpty()) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst viewData = view.getViewData() as LRViewData,\n\t\t\tmetaModel = view.getModel()?.getMetaModel() as ODataMetaModel,\n\t\t\tcontextPath = viewData.contextPath || `/${viewData.entitySet}`,\n\t\t\tmetaContext = metaModel.getMetaContext(contextPath),\n\t\t\tdataModelObjectPath: DataModelObjectPath<MetaModel> = getInvolvedDataModelObjects(metaContext);\n\n\t\t// getDisplayCurrencyPropertyName already applies the isParameterized logic\n\t\tconst displayCurrencyPropertyName = this.getDisplayCurrencyPropertyName(dataModelObjectPath);\n\t\tconst displayCurrencyIsMandatory = this._checkIfDisplayCurrencyIsRequired(dataModelObjectPath);\n\t\tif (!displayCurrencyIsMandatory) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst svOptions = sv.getSelectOption(displayCurrencyPropertyName) || [],\n\t\t\tdefaultSVOptions = svDefaults.getSelectOption(displayCurrencyPropertyName) || [],\n\t\t\tdisplayCurrencyDefaultExists = defaultSVOptions.length > 0,\n\t\t\tnoSVDisplayCurrencyExists = svOptions.length === 0;\n\n\t\tif (noSVDisplayCurrencyExists && displayCurrencyDefaultExists) {\n\t\t\tconst displayCurrencySelectOption = defaultSVOptions[0],\n\t\t\t\tsign = displayCurrencySelectOption[\"Sign\"],\n\t\t\t\toption = displayCurrencySelectOption[\"Option\"],\n\t\t\t\tlow = displayCurrencySelectOption[\"Low\"],\n\t\t\t\thigh = displayCurrencySelectOption[\"High\"];\n\n\t\t\tsv.addSelectOption(displayCurrencyPropertyName, sign, option, low, high);\n\t\t}\n\t}\n\n\t/**\n\t * Checks if the data model object path is parameterized.\n\t * Looks for a ResultContext annotation in the starting entity's type\n\t * and ensures there's no target entity set.\n\t * @param dataModelObjectPath The path to check.\n\t * @returns True if it's parameterized, false otherwise.\n\t */\n\tprivate isParameterized(dataModelObjectPath: DataModelObjectPath<MetaModel>): boolean {\n\t\treturn !!dataModelObjectPath.startingEntitySet.entityType?.annotations?.Common?.ResultContext;\n\t}\n\n\t/**\n\t * Gets the display currency property name based on the entity type's parameterization.\n\t * Uses the isParameterized method to decide which property name to return.\n\t * @param dataModelObjectPath The path to check.\n\t * @returns The appropriate display currency property name.\n\t */\n\tgetDisplayCurrencyPropertyName(dataModelObjectPath: DataModelObjectPath<MetaModel>): string {\n\t\treturn this.isParameterized(dataModelObjectPath) ? P_DISPLAY_CURRENCY_PROPERTY_NAME : DISPLAY_CURRENCY_PROPERTY_NAME;\n\t}\n\n\t/**\n\t * Checks if DisplayCurrency is mandatory for filtering.\n\t * @param dataModelObjectPath\n\t * @returns Boolean\n\t */\n\t_checkIfDisplayCurrencyIsRequired(dataModelObjectPath: DataModelObjectPath<MetaModel>): boolean {\n\t\tlet displayCurrencyIsMandatory = false;\n\n\t\tif (this.isParameterized(dataModelObjectPath)) {\n\t\t\tdisplayCurrencyIsMandatory = dataModelObjectPath.startingEntitySet.entityType.entityProperties.some(\n\t\t\t\t(parameter: Property): boolean => parameter.name === P_DISPLAY_CURRENCY_PROPERTY_NAME\n\t\t\t);\n\t\t} else {\n\t\t\tconst entitySet: EntitySet | undefined =\n\t\t\t\t\tdataModelObjectPath.startingEntitySet._type === \"EntitySet\" ? dataModelObjectPath.startingEntitySet : undefined,\n\t\t\t\trequiredProperties = entitySet?.annotations.Capabilities?.FilterRestrictions?.RequiredProperties ?? [];\n\t\t\tdisplayCurrencyIsMandatory = requiredProperties.some(\n\t\t\t\t(requiredProperty: PropertyPath) => requiredProperty.value === DISPLAY_CURRENCY_PROPERTY_NAME\n\t\t\t);\n\t\t}\n\t\treturn displayCurrencyIsMandatory;\n\t}\n\n\t/**\n\t * Activate variant from variant management and return if appState needs to be applied.\n\t * @param variantManagement VariantManagement used by filter bar\n\t * @param reqStdVariant If standard variant is required to be used\n\t * @param filterVariantApplied Is a filter variant already applied\n\t * @returns Promise for asynchronous handling\n\t */\n\tasync _activateVariantAndDetermineApplyAppState(\n\t\tvariantManagement: VariantManagement | undefined,\n\t\treqStdVariant: boolean,\n\t\tfilterVariantApplied: boolean\n\t): Promise<boolean> {\n\t\tif (variantManagement && !filterVariantApplied) {\n\t\t\tlet variantKey = reqStdVariant ? variantManagement.getStandardVariantKey() : variantManagement.getDefaultVariantKey();\n\t\t\tif (variantKey === null) {\n\t\t\t\tvariantKey = variantManagement.getId();\n\t\t\t}\n\t\t\tawait ControlVariantApplyAPI.activateVariant({\n\t\t\t\telement: variantManagement,\n\t\t\t\tvariantReference: variantKey\n\t\t\t});\n\t\t\treturn reqStdVariant || variantManagement.getDefaultVariantKey() === variantManagement.getStandardVariantKey();\n\t\t}\n\n\t\treturn true;\n\t}\n\n\t/**\n\t * Variant management used by filter bar.\n\t * @param view View of the LR filter bar\n\t * @returns VariantManagement if used\n\t */\n\t_getFilterBarVM(view: View): VariantManagement | undefined {\n\t\tlet variantManagement;\n\t\tconst viewData = view.getViewData() as LRViewData;\n\t\tswitch (viewData.variantManagement) {\n\t\t\tcase VariantManagementType.Page:\n\t\t\t\tvariantManagement = view.byId(\"fe::PageVariantManagement\");\n\t\t\t\tbreak;\n\t\t\tcase VariantManagementType.Control:\n\t\t\t\tvariantManagement = (view.getController() as ListReportController)._getFilterBarVariantControl();\n\t\t\t\tbreak;\n\t\t\tcase VariantManagementType.None:\n\t\t\tdefault:\n\t\t\t\tbreak;\n\t\t}\n\t\treturn variantManagement as VariantManagement | undefined;\n\t}\n\n\t// eslint-disable-next-line @typescript-eslint/require-await\n\tasync handleVariantIdPassedViaURLParams(oUrlParams: Record<string, string>): Promise<unknown> {\n\t\tconst aPageVariantId = oUrlParams[\"sap-ui-fe-variant-id\"],\n\t\t\taFilterBarVariantId = oUrlParams[\"sap-ui-fe-filterbar-variant-id\"],\n\t\t\taTableVariantId = oUrlParams[\"sap-ui-fe-table-variant-id\"],\n\t\t\taChartVariantId = oUrlParams[\"sap-ui-fe-chart-variant-id\"];\n\t\tlet oVariantIDs: VariantIDs | undefined;\n\t\tif (aPageVariantId || aFilterBarVariantId || aTableVariantId || aChartVariantId) {\n\t\t\toVariantIDs = {\n\t\t\t\tsPageVariantId: aPageVariantId && aPageVariantId[0],\n\t\t\t\tsFilterBarVariantId: aFilterBarVariantId && aFilterBarVariantId[0],\n\t\t\t\tsTableVariantId: aTableVariantId && aTableVariantId[0],\n\t\t\t\tsChartVariantId: aChartVariantId && aChartVariantId[0]\n\t\t\t};\n\t\t}\n\t\treturn this._handleControlVariantId(oVariantIDs);\n\t}\n\n\tasync _handleControlVariantId(oVariantIDs: VariantIDs | undefined): Promise<unknown> {\n\t\tlet oVM: VariantManagement;\n\t\tconst oView = this.getPageController()?.getView(),\n\t\t\taPromises: Promise<boolean>[] = [];\n\t\tconst sVariantManagement = oView.getViewData().variantManagement;\n\t\tif (oVariantIDs && oVariantIDs.sPageVariantId && sVariantManagement === \"Page\") {\n\t\t\toVM = oView.byId(\"fe::PageVariantManagement\") as VariantManagement;\n\t\t\tthis._handlePageVariantId(oVariantIDs, oVM, aPromises);\n\t\t} else if (oVariantIDs && sVariantManagement === \"Control\") {\n\t\t\tif (oVariantIDs.sFilterBarVariantId) {\n\t\t\t\toVM = (oView.getController() as ListReportController)._getFilterBarVariantControl()!;\n\t\t\t\tthis._handleFilterBarVariantControlId(oVariantIDs, oVM, aPromises);\n\t\t\t}\n\t\t}\n\t\treturn Promise.all(aPromises);\n\t}\n\n\t/*\n\t * Handles page level variant and passes the variant to the function that pushes the promise to the promise array\n\t *\n\t * @param oVarinatIDs contains an object of all variant IDs\n\t * @param oVM contains the vairant management object for the page variant\n\t * @param aPromises is an array of all promises\n\t * @private\n\t */\n\t_handlePageVariantId(oVariantIDs: VariantIDs, oVM: VariantManagement, aPromises: Promise<boolean>[]): void {\n\t\toVM.getVariants()?.forEach((oVariant: VariantObject) => {\n\t\t\tthis._findAndPushVariantToPromise(oVariant, oVariantIDs.sPageVariantId, oVM, aPromises, true);\n\t\t});\n\t}\n\n\t/*\n\t * Handles control level variant for filter bar and passes the variant to the function that pushes the promise to the promise array\n\t *\n\t * @param oVarinatIDs contains an object of all variant IDs\n\t * @param oVM contains the vairant management object for the filter bar\n\t * @param aPromises is an array of all promises\n\t * @private\n\t */\n\n\t_handleFilterBarVariantControlId(oVariantIDs: VariantIDs, oVM: VariantManagement, aPromises: Promise<boolean>[]): void {\n\t\tif (oVM) {\n\t\t\toVM.getVariants().forEach((oVariant: VariantObject) => {\n\t\t\t\tthis._findAndPushVariantToPromise(oVariant, oVariantIDs.sFilterBarVariantId, oVM, aPromises, true);\n\t\t\t});\n\t\t}\n\t}\n\n\t/*\n\t * Matches the variant ID provided in the url to the available vairant IDs and pushes the appropriate promise to the promise array\n\t *\n\t * @param oVariant is an object for a specific variant\n\t * @param sVariantId is the variant ID provided in the url\n\t * @param oVM is the variant management object for the specfic variant\n\t * @param aPromises is an array of promises\n\t * @param bFilterVariantApplied is an optional parameter which is set to ture in case the filter variant is applied\n\t * @private\n\t */\n\t_findAndPushVariantToPromise(\n\t\t//This function finds the suitable variant for the variantID provided in the url and pushes them to the promise array\n\t\toVariant: VariantObject,\n\t\tsVariantId: string,\n\t\toVM: VariantManagement,\n\t\taPromises: Promise<boolean>[],\n\t\tbFilterVariantApplied?: boolean\n\t): void {\n\t\tif (oVariant.key === sVariantId) {\n\t\t\taPromises.push(this._applyControlVariant(oVM, sVariantId, bFilterVariantApplied));\n\t\t}\n\t}\n\n\tasync _applyControlVariant(oVariant: VariantManagement, sVariantID: string, bFilterVariantApplied = false): Promise<boolean> {\n\t\tconst sVariantReference = this._checkIfVariantIdIsAvailable(oVariant, sVariantID) ? sVariantID : oVariant.getStandardVariantKey();\n\t\tconst oVM = ControlVariantApplyAPI.activateVariant({\n\t\t\telement: oVariant,\n\t\t\tvariantReference: sVariantReference\n\t\t});\n\t\treturn oVM.then(function () {\n\t\t\treturn bFilterVariantApplied;\n\t\t});\n\t}\n\n\t_checkIfVariantIdIsAvailable(oVM: VariantManagement, sVariantId: string | null): boolean {\n\t\tconst aVariants = oVM.getVariants();\n\t\tlet bIsControlStateVariantAvailable = false;\n\t\taVariants.forEach(function (oVariant) {\n\t\t\tif (oVariant.getKey() === sVariantId) {\n\t\t\t\tbIsControlStateVariantAvailable = true;\n\t\t\t}\n\t\t});\n\t\treturn bIsControlStateVariantAvailable;\n\t}\n\n\t/**\n\t * The identifier of the FilterBar control.\n\t */\n\t@property({ type: \"string\" })\n\tid!: string;\n\n\t/**\n\t * Defines the relative path of the property in the metamodel, based on the current contextPath.\n\t * @public\n\t */\n\t@property({\n\t\ttype: \"string\",\n\t\texpectedAnnotations: [\"com.sap.vocabularies.UI.v1.SelectionFields\"],\n\t\texpectedTypes: [\"EntitySet\", \"EntityType\"]\n\t})\n\tmetaPath!: string;\n\n\t/**\n\t * Defines the path of the context used in the current page or block.\n\t * This setting is defined by the framework.\n\t * @public\n\t */\n\t@property({\n\t\ttype: \"string\",\n\t\texpectedTypes: [\"EntitySet\", \"EntityType\", \"NavigationProperty\"]\n\t})\n\tcontextPath!: string;\n\n\t/**\n\t * If true, the search is triggered automatically when a filter value is changed.\n\t * @public\n\t */\n\t@property({ type: \"boolean\", defaultValue: false })\n\tliveMode?: boolean;\n\n\t/**\n\t * Parameter which sets the visibility of the FilterBar building block\n\t * @public\n\t */\n\t@property({ type: \"boolean\", defaultValue: true })\n\tvisible?: boolean;\n\n\t/**\n\t * Displays possible errors during the search in a message box\n\t * @public\n\t */\n\t@property({ type: \"boolean\", defaultValue: true })\n\tshowMessages?: boolean;\n\n\t/**\n\t * Handles the visibility of the 'Clear' button on the FilterBar.\n\t * @public\n\t */\n\t@property({ type: \"boolean\", defaultValue: false })\n\tshowClearButton?: boolean;\n\n\t/**\n\t * Aggregate filter fields of the FilterBar building block\n\t * @public\n\t */\n\t@aggregation({ type: \"sap.fe.macros.filterBar.FilterField\", multiple: true })\n\tfilterFields?: FilterField[];\n\n\tcontent!: FilterBar;\n\n\t/**\n\t * This event is fired when the 'Go' button is pressed or after a condition change.\n\t * @public\n\t */\n\t@event()\n\tsearch!: string;\n\n\t/**\n\t * This event is fired when the 'Go' button is pressed or after a condition change. This is only internally used by sap.fe (Fiori elements) and\n\t * exposes parameters from internal MDC-FilterBar search event\n\t * @private\n\t */\n\t@event()\n\tinternalSearch!: string;\n\n\t/**\n\t * This event is fired after either a filter value or the visibility of a filter item has been changed. The event contains conditions that will be used as filters.\n\t * @public\n\t */\n\t@event()\n\tfilterChanged!: string;\n\n\t/**\n\t * This event is fired when the 'Clear' button is pressed. This is only possible when the 'Clear' button is enabled.\n\t * @public\n\t */\n\t@event()\n\tafterClear!: string;\n\n\t/**\n\t * This event is fired after either a filter value or the visibility of a filter item has been changed. The event contains conditions that will be used as filters.\n\t * This is used internally only by sap.fe (Fiori Elements). This exposes parameters from the MDC-FilterBar filterChanged event that is used by sap.fe in some cases.\n\t * @private\n\t */\n\t@event()\n\tinternalFilterChanged!: string;\n\n\tprivate telemetry?: FilterBarTelemetry;\n\n\tconstructor(props?: $ControlSettings & PropertiesOf<FilterBarAPI>, others?: $ControlSettings) {\n\t\tsuper(props, others);\n\t\tthis.telemetry = new FilterBarTelemetry(this);\n\t\tthis.attachStateChangeHandler();\n\t}\n\n\tprivate attachStateChangeHandler(): void {\n\t\tStateUtil.detachStateChange(this.stateChangeHandler);\n\t\tStateUtil.attachStateChange(this.stateChangeHandler);\n\t}\n\n\tstateChangeHandler(oEvent: Event<{ control: Control }>): void {\n\t\tconst control = oEvent.getParameter(\"control\");\n\t\tif (control.isA<FilterBar>(\"sap.ui.mdc.FilterBar\")) {\n\t\t\tconst filterBarAPI = control.getParent() as unknown as { handleStateChange?: Function };\n\t\t\tif (filterBarAPI?.handleStateChange) {\n\t\t\t\tfilterBarAPI.handleStateChange();\n\t\t\t}\n\t\t}\n\t}\n\n\t@xmlEventHandler()\n\thandleSearch(oEvent: FilterBarBase$SearchEvent): void {\n\t\tconst oFilterBar = oEvent.getSource() as FilterBar | undefined;\n\t\tconst eventParameters = oEvent.getParameters();\n\t\tif (oFilterBar) {\n\t\t\tconst conditions = (oFilterBar.getFilterConditions() ?? {}) as Record<string, ConditionObject[]>;\n\t\t\tconst preparedEventParameters = this._prepareEventParameters(oFilterBar);\n\t\t\tthis.telemetry?.onSearch(eventParameters, conditions);\n\t\t\tthis.fireEvent(\"internalSearch\", merge({ conditions: conditions }, eventParameters));\n\t\t\tthis.fireEvent(\"search\", merge({ reason: eventParameters.reason }, preparedEventParameters));\n\t\t\tthis._hasPendingFilters = false;\n\t\t\tif (!this.liveMode) {\n\t\t\t\tthis.getPageController()?.getExtensionAPI().updateAppState();\n\t\t\t}\n\t\t}\n\t}\n\n\t@xmlEventHandler()\n\thandleFilterChanged(oEvent: FilterBarBase$FiltersChangedEvent): void {\n\t\tconst filterBar = oEvent.getSource() as FilterBar | undefined;\n\t\tconst oEventParameters = oEvent.getParameters();\n\t\tif (filterBar) {\n\t\t\tconst oConditions = filterBar.getFilterConditions();\n\t\t\tconst eventParameters: object = this._prepareEventParameters(filterBar);\n\t\t\tthis.telemetry?.onFiltersChanged(this._getFilterBarReason(filterBar));\n\t\t\tthis.fireEvent(\"internalFilterChanged\", merge({ conditions: oConditions }, oEventParameters));\n\t\t\tthis.fireEvent(\"filterChanged\", eventParameters);\n\t\t\t// Set hasPendingFilters to true only if conditionsBased is true\n\t\t\tif (oEventParameters?.conditionsBased) {\n\t\t\t\tthis._hasPendingFilters = true;\n\t\t\t}\n\t\t}\n\t}\n\n\t_getFilterBarReason(filterBar: FilterBar & { _sReason?: string }): string {\n\t\treturn filterBar?._sReason ?? \"\";\n\t}\n\n\t_prepareEventParameters(oFilterBar: FilterBar): Partial<InternalBindingInfo> {\n\t\tconst { parameters, filters, search } = FilterUtils.getFilters(oFilterBar as unknown as IFilterControl) || {};\n\n\t\treturn { parameters, filters, search };\n\t}\n\n\t/**\n\t * Set the filter values for the given property in the filter bar.\n\t * The filter values can be either a single value or an array of values.\n\t * Each filter value must be represented as a primitive value.\n\t * @param sConditionPath The path to the property as a condition path\n\t * @param [sOperator] The operator to be used (optional) - if not set, the default operator (EQ) will be used\n\t * @param vValues The values to be applied\n\t * @returns A promise for asynchronous handling\n\t * @public\n\t */\n\tasync setFilterValues(\n\t\tsConditionPath: string,\n\t\tsOperator: string | undefined,\n\t\tvValues?: undefined | string | number | boolean | string[] | number[] | boolean[]\n\t): Promise<void> {\n\t\t// eslint-disable-next-line @typescript-eslint/ban-ts-comment\n\t\t// @ts-ignore\n\t\tif (arguments.length === 2) {\n\t\t\tvValues = sOperator;\n\t\t\treturn FilterUtils.setFilterValues(this.content, sConditionPath, vValues);\n\t\t}\n\t\treturn FilterUtils.setFilterValues(this.content, sConditionPath, sOperator, vValues);\n\t}\n\n\t/**\n\t * Get the Active Filters Text Summary for the filter bar.\n\t * @returns Active filters summary as text\n\t * @public\n\t */\n\tgetActiveFiltersText(): string {\n\t\treturn this.content?.getAssignedFiltersText()?.filtersText || \"\";\n\t}\n\n\t/**\n\t * Provides all the filters that are currently active\n\t * along with the search expression.\n\t * @returns An array of active filters and the search expression.\n\t * @public\n\t */\n\tgetFilters(): object {\n\t\treturn FilterUtils.getFilters(this.content as IFilterControl) || {};\n\t}\n\n\t/**\n\t * Triggers the API search on the filter bar.\n\t * @returns Returns a promise which resolves if filter go is triggered successfully; otherwise gets rejected.\n\t * @public\n\t */\n\tasync triggerSearch(): Promise<object | undefined> {\n\t\tconst filterBar = this.content;\n\t\ttry {\n\t\t\tif (filterBar) {\n\t\t\t\tawait filterBar.waitForInitialization();\n\t\t\t\treturn await filterBar.triggerSearch();\n\t\t\t}\n\t\t} catch (err: unknown) {\n\t\t\tconst message = err instanceof Error ? err.message : String(err);\n\t\t\tLog.error(`FE : Buildingblock : FilterBar : ${message}`);\n\t\t\tthrow Error(message);\n\t\t}\n\t}\n\n\tisSemanticDateFilterApplied(): boolean {\n\t\treturn SemanticDateOperators.hasSemanticDateOperations(this.content.getConditions(), false);\n\t}\n\n\t/**\n\t * Get the selection variant from the filter bar.\n\t * Note: This method returns all the filter values that are set in the filter bar, including the text from the search field (with $search as the property name). However, it doesn't return any filter field condition that uses a custom operator.\n\t * @returns A promise which resolves with a {@link sap.fe.navigation.SelectionVariant}\n\t * @public\n\t */\n\tasync getSelectionVariant(): Promise<SelectionVariant> {\n\t\tconst selectionVariant = await stateHelper.getSelectionVariant(this.getContent());\n\t\tconst controller = this.getPageController() as ListReportController;\n\t\tif (controller !== undefined) {\n\t\t\tconst view = controller?.getView(),\n\t\t\t\tappComponent = CommonUtils.getAppComponent(view),\n\t\t\t\tnavigationService = appComponent?.getNavigationService(),\n\t\t\t\tdataModelObject = this.getDataModelObjectForMetaPath(this.metaPath);\n\t\t\tif (dataModelObject?.targetEntitySet?.name) {\n\t\t\t\tconst sContextUrl =\n\t\t\t\t\tdataModelObject?.targetEntitySet?.name &&\n\t\t\t\t\tnavigationService?.constructContextUrl(dataModelObject?.targetEntitySet?.name, view.getModel());\n\t\t\t\tselectionVariant.setFilterContextUrl(sContextUrl);\n\t\t\t}\n\t\t}\n\t\treturn selectionVariant;\n\t}\n\n\t/**\n\t * Get the list of mandatory filter property names.\n\t * @returns The list of mandatory filter property names\n\t */\n\tgetMandatoryFilterPropertyNames(): string[] {\n\t\treturn (this.content.getPropertyInfoSet() as ControlPropertyInfo[])\n\t\t\t.filter(function (filterProp) {\n\t\t\t\treturn filterProp.required;\n\t\t\t})\n\t\t\t.map(function (requiredProp) {\n\t\t\t\treturn requiredProp.conditionPath;\n\t\t\t});\n\t}\n\n\t/**\n\t * Get the filter bar parameters for a parameterized service.\n\t * @returns Array of parameters configured in a parameterized service\n\t */\n\n\tgetParameters(): string[] {\n\t\tconst filterBar = this.content;\n\t\tconst parameters = filterBar.data(\"parameters\");\n\t\tif (parameters) {\n\t\t\treturn Array.isArray(parameters) ? parameters : JSON.parse(parameters);\n\t\t}\n\t\treturn [];\n\t}\n\n\tgetVariant(): VariantData | undefined {\n\t\tlet currentVariant;\n\t\ttry {\n\t\t\tconst variantModel = this.getModel(\"$FlexVariants\") as VariantModel | undefined;\n\t\t\tconst variantBackReference = this.content.getVariantBackreference();\n\n\t\t\tif (variantModel && variantBackReference) {\n\t\t\t\tcurrentVariant = variantModel.getVariant(variantModel.getCurrentVariantReference(variantBackReference));\n\t\t\t}\n\t\t} catch (e) {\n\t\t\tLog.debug(\"Couldn't fetch variant \", e as string);\n\t\t}\n\t\treturn currentVariant;\n\t}\n\n\t/**\n\t * Shows or hides any filter field from the filter bar.\n\t * The property will not be hidden inside the adaptation dialog and may be re-added.\n\t * @param conditionPath The path to the property as a condition path\n\t * @param visible Whether it should be shown or hidden\n\t * @returns A {@link Promise} resolving once the change in visibility was applied\n\t * @public\n\t */\n\tasync setFilterFieldVisible(conditionPath: string, visible: boolean): Promise<void> {\n\t\tawait StateUtil.applyExternalState(this.content, { items: [{ name: conditionPath, visible }] });\n\t}\n\n\t/**\n\t * Gets the visibility of a filter field.\n\t * @param conditionPath The path to the property as a condition path\n\t * @returns A {@link Promise} that resolves to check whether the filter field is visible or not.\n\t * @public\n\t */\n\tasync getFilterFieldVisible(conditionPath: string): Promise<boolean> {\n\t\tconst state: ExternalStateType = await StateUtil.retrieveExternalState(this.content);\n\t\treturn !!state.items.find((item) => item.name === conditionPath);\n\t}\n\n\t/**\n\t * Gets the associated variant management.\n\t * @returns The {@link sap.ui.fl.variants.VariantManagement} control associated with the filter bar.\n\t */\n\tgetVariantManagement(): VariantManagement {\n\t\tconst variantBackreference = this.content.getVariantBackreference();\n\t\tif (variantBackreference) {\n\t\t\treturn UI5Element.getElementById(variantBackreference) as VariantManagement;\n\t\t} else {\n\t\t\tthrow new Error(`Variant back reference not defined on the filter bar ${this.id}`);\n\t\t}\n\t}\n\n\t/**\n\t * Sets the variant back reference association for this instance.\n\t * @param variant The `VariantManagement` instance to set as the back reference.\n\t */\n\tsetVariantBackReference(variant: VariantManagement): void {\n\t\tconst content = this.getContent() as FilterBar;\n\t\tconst isLiveMode = content?.getLiveMode?.();\n\t\tif (!isLiveMode) {\n\t\t\tthis.content.setVariantBackreference(variant);\n\t\t}\n\t}\n\n\t/**\n\t * Gets the key of the current variant in the associated variant management.\n\t * @returns Key of the currently selected variant. In case the model is not yet set, `null` will be returned.\n\t * @public\n\t */\n\tgetCurrentVariantKey(): string | null {\n\t\treturn this.getVariantManagement().getCurrentVariantKey();\n\t}\n\n\t/**\n\t * Sets the new selected variant in the associated variant management.\n\t * @param key Key of the variant that should be selected. If the passed key doesn't identify a variant, it will be ignored.\n\t * @public\n\t */\n\tsetCurrentVariantKey(key: string): void {\n\t\tconst variantManagement = this.getVariantManagement();\n\t\tvariantManagement.setCurrentVariantKey(key);\n\t}\n\n\t/**\n\t * Sets the enablement of the field.\n\t * @param name Name of the field that should be enabled or disabled.\n\t * @param enabled Whether the field should be enabled or disabled.\n\t * @public\n\t */\n\tsetFilterFieldEnabled(name: string, enabled: boolean): void {\n\t\t(this.getModel(\"internal\") as JSONModel).setData(\n\t\t\t{\n\t\t\t\t[this.content.data(\"localId\")]: {\n\t\t\t\t\tfilterFields: { [name]: { editMode: enabled ? FieldEditMode.Editable : FieldEditMode.Disabled } }\n\t\t\t\t}\n\t\t\t},\n\t\t\ttrue\n\t\t);\n\t}\n\n\t/**\n\t * Determines whether the field is enabled or disabled.\n\t * @param name Name of the field.\n\t * @returns Whether the filterField is enabled or disabled.\n\t * @public\n\t */\n\tgetFilterFieldEnabled(name: string): boolean {\n\t\treturn (this.getModel(\"internal\") as JSONModel).getProperty(`/${this.content.data(\"localId\")}/filterFields/${name}/editMode`) ===\n\t\t\tFieldEditMode.Disabled\n\t\t\t? false\n\t\t\t: true;\n\t}\n\n\t/**\n\t * Convert {@link sap.fe.navigation.SelectionVariant} to conditions.\n\t * @param selectionVariant The selection variant to apply to the filter bar.\n\t * @param prefillDescriptions If true, we try to find the associated Text value for each property in the selectionVariant (to avoid fetching it from the server)\n\t * @returns A promise resolving to conditions\n\t */\n\tasync convertSelectionVariantToStateFilters(\n\t\tselectionVariant: SelectionVariant,\n\t\tprefillDescriptions: boolean\n\t): Promise<StateUtilFilter> {\n\t\treturn stateHelper.convertSelectionVariantToStateFilters(\n\t\t\tthis.content,\n\t\t\tselectionVariant,\n\t\t\tprefillDescriptions,\n\t\t\tthis.content?.getModel()\n\t\t);\n\t}\n\n\t/**\n\t * Clears all input values of visible filter fields in the filter bar with flag to indicate whether to clear Edit Filter or not.\n\t * @param filterBar The filter bar that contains the filter field\n\t * @param options Options for filtering on the filter bar\n\t * @param options.clearEditFilter Whether to clear the edit filter or let it be default value 'All' instead\n\t */\n\tasync _clearFilterValuesWithOptions(filterBar: FilterBar, options?: { clearEditFilter: boolean }): Promise<void> {\n\t\tawait stateHelper._clearFilterValuesWithOptions(filterBar, options);\n\t}\n\n\t/**\n\t * Sets {@link sap.fe.navigation.SelectionVariant} to the filter bar. Note: setSelectionVariant will clear existing filters and then apply the SelectionVariant values.\n\t * Note: This method cannot set the search field text or any filter field condition that relies on a custom operator.\n\t * @param selectionVariant The {@link sap.fe.navigation.SelectionVariant} to apply to the filter bar\n\t * @param prefillDescriptions Optional. If true, we will use the associated text property values (if they're available in the selectionVariant) to display the filter value descriptions, instead of loading them from the backend\n\t * @returns A promise for asynchronous handling\n\t * @public\n\t */\n\tasync setSelectionVariant(selectionVariant: SelectionVariant, prefillDescriptions = false): Promise<unknown> {\n\t\tconst content = this.getContent() as FilterBar | undefined;\n\t\tconst isLiveMode = content && content?.getLiveMode?.();\n\t\tlet result: { diffState: ExternalStateType; applyStateResult: unknown } | undefined;\n\t\tif (isLiveMode) {\n\t\t\tcontent.enableRequests(false);\n\t\t}\n\t\ttry {\n\t\t\tresult = await stateHelper.setSelectionVariantToMdcControl(this.getContent(), selectionVariant, prefillDescriptions);\n\t\t\treturn result?.applyStateResult;\n\t\t} catch (err: unknown) {\n\t\t\tconst message = err instanceof Error ? err.message : String(err);\n\t\t\tLog.error(`FE : Buildingblock : FilterBar : ${message}`);\n\t\t\tthrow Error(message);\n\t\t} finally {\n\t\t\tif (isLiveMode) {\n\t\t\t\tcontent.enableRequests(true, result?.diffState);\n\t\t\t}\n\t\t}\n\t}\n\n\t/**\n\t * Called by the MDC state util when the state for this control's child has changed.\n\t */\n\thandleStateChange(): void {\n\t\tthis.getPageController()?.getExtensionAPI().updateAppState();\n\t}\n\n\tprivate getConditionPath(propertyPath: string): string {\n\t\tconst propertyTargetObjectPath = FilterUtils.getDataModelObjectPathForProperty(this.content, propertyPath);\n\t\treturn (\n\t\t\t(propertyTargetObjectPath ? getContextRelativeTargetObjectPath(propertyTargetObjectPath, false, true) : undefined) ??\n\t\t\tpropertyPath\n\t\t);\n\t}\n\n\tasync showFilterField(name: string): Promise<void> {\n\t\tconst state: ExternalStateType = await StateUtil.retrieveExternalState(this.content);\n\t\tconst conditionPath = this.getConditionPath(name);\n\t\tconst targetFilterField = !!state.items.find((item) => item.name === conditionPath);\n\t\tif (!targetFilterField) {\n\t\t\tstate.items.push({ name: conditionPath });\n\t\t}\n\t\tawait StateUtil.applyExternalState(this.content, state);\n\t}\n\n\tasync openValueHelpForFilterField(name: string, inputValue?: string): Promise<ConditionObject[]> {\n\t\tconst conditionPath = this.getConditionPath(name);\n\n\t\treturn new Promise((resolve, reject) => {\n\t\t\tconst filterField = this.content.getFilterItems().find((item) => item.getPropertyKey() === conditionPath);\n\t\t\tconst valueHelp = UI5Element.getElementById(filterField?.getValueHelp()) as ValueHelp | undefined;\n\t\t\tif (!valueHelp || !filterField) {\n\t\t\t\treject(new Error(`ValueHelp for filter field ${name} not found`));\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tvalueHelp.attachEventOnce(\"closed\", () => {\n\t\t\t\tresolve(valueHelp.getConditions() as ConditionObject[]);\n\t\t\t});\n\n\t\t\t(filterField as unknown as { _oFocusInfo: object })._oFocusInfo = { targetInfo: { silent: true } };\n\t\t\t(filterField as unknown as { onfocusin?: Function }).onfocusin?.(new jQuery.Event(\"focusin\"));\n\t\t\tsetTimeout(() => {\n\t\t\t\t(filterField.getAggregation(\"_content\") as Input[])[0].fireValueHelpRequest({\n\t\t\t\t\tfromKeyboard: true,\n\t\t\t\t\t_userInputValue: inputValue\n\t\t\t\t} as unknown as Input$ValueHelpRequestEventParameters);\n\t\t\t}, 200);\n\t\t});\n\t}\n\n\tgetCollapsedFiltersText(): string {\n\t\treturn this.content?.getAssignedFiltersText()?.filtersText;\n\t}\n}\nexport default FilterBarAPI;\n"],"mappings":";;;;yhEAgDA,IACMA,GAAkB,WAKvB,SAAAA,EAA6BC,GAA4BC,KAJjDC,mBAAqB,EAACD,KAEtBE,oBAAsB,EAACF,KAEFD,cAA6B,CAAC,IAAAI,EAAAL,EAAAM,UAAAD,EAE3DE,iBAAA,SAAAA,EAAiBC,GAChB,GAAIA,IAAW,UAAW,CACzBN,KAAKE,qBACN,KAAO,CACNF,KAAKC,oBACN,CACD,EAACE,EAEDI,SAAA,SAAAA,EAASC,EAAsCC,GAC9C,MAAMC,EAAcV,KAAKW,6BAA6BF,GACtDT,KAAKD,aAAaa,qBAAqBC,UAAUC,YAAY,CAC5DC,KAAM,qBACNC,WAAY,CACXf,mBAAoBD,KAAKC,mBACzBgB,aAAcC,OAAOC,KAAKV,GAAYW,OACtClB,oBAAqBF,KAAKE,oBAC1BmB,aAAcrB,KAAKD,aAAauB,cAAcC,OAAS,OACvDC,SAAUhB,EAAgBF,SAAW,UACrCmB,WAAYhB,EAAWiB,UAAYR,OAAOC,KAAKV,EAAWiB,SAASN,OAAS,MAC5EV,YAAaA,KAIfV,KAAKC,mBAAqB,EAC1BD,KAAKE,oBAAsB,CAC5B,EAACC,EAEDQ,6BAAA,SAAAA,EAA6BF,GAC5B,IAAIC,EAAc,GAClBQ,OAAOC,KAAKV,GAAYkB,QAASC,IAChC,GAAIA,GAAa,UAAW,CAC3BlB,GAAekB,EAAY,GAC5B,IAED,OAAOlB,CACR,EAAC,OAAAZ,CAAA,CA1CsB,GA0CtB,IAqCG+B,GAAqB,SAArBA,KAAqB,qBAArBA,EAAqB,eAArBA,EAAqB,sBAArBA,CAAqB,EAArBA,IAAqB,IAM1B,MAAMC,GAAiC,kBACvC,MAAMC,GAAmC,oBAoBzC,IAkBMC,IAAYC,EAJjBC,GAAe,uCAAwC,CACvDC,YAAa,CAAC,yBACbC,EACDC,GAAMC,GAAyBC,EAU9BC,GAA2B,YAAa,4BAA2BC,EAKnED,GAA2B,YAAa,yBAAwBE,EA6ZhEC,GAAS,CAAE5B,KAAM,WAAW6B,EAO5BD,GAAS,CACT5B,KAAM,SACN8B,oBAAqB,CAAC,8CACtBC,cAAe,CAAC,YAAa,gBAC5BC,EAQDJ,GAAS,CACT5B,KAAM,SACN+B,cAAe,CAAC,YAAa,aAAc,wBAC1CE,EAODL,GAAS,CAAE5B,KAAM,UAAWkC,aAAc,QAAQC,EAOlDP,GAAS,CAAE5B,KAAM,UAAWkC,aAAc,OAAOE,EAOjDR,GAAS,CAAE5B,KAAM,UAAWkC,aAAc,OAAOG,EAOjDT,GAAS,CAAE5B,KAAM,UAAWkC,aAAc,QAAQI,EAOlDC,GAAY,CAAEvC,KAAM,sCAAuCwC,SAAU,OAAOC,EAS5EC,KAAOC,EAQPD,KAAOE,EAOPF,KAAOG,EAOPH,KAAOI,EAQPJ,KAAOK,EA0BPC,KAAiBC,EAiBjBD,KAAiB9B,EAAAgC,EAAA7B,EAAA6B,GAAAC,EAAA,SAAAC,GAtClB,SAAAnC,EAAYoC,EAAuDC,GAA2B,IAAAC,EAC7FA,EAAAH,EAAAI,KAAAvE,KAAMoE,EAAOC,IAAOrE,KAACsE,EAhhBtBE,oBAA+C,CAAC,EAACF,EAEjDG,qBAA4C,IAAIC,EAAeJ,EAE/DK,kBAAoB,MAAKL,EAEjBM,mBAAqB,KAia7BC,GAAAP,EAAA,KAAAQ,EAAAR,GAMAO,GAAAP,EAAA,WAAAS,EAAAT,GAWAO,GAAAP,EAAA,cAAAU,EAAAV,GAWAO,GAAAP,EAAA,WAAAW,EAAAX,GAOAO,GAAAP,EAAA,UAAAY,EAAAZ,GAOAO,GAAAP,EAAA,eAAAa,EAAAb,GAOAO,GAAAP,EAAA,kBAAAc,EAAAd,GAOAO,GAAAP,EAAA,eAAAe,EAAAf,GASAO,GAAAP,EAAA,SAAAgB,EAAAhB,GAOAO,GAAAP,EAAA,iBAAAiB,EAAAjB,GAQAO,GAAAP,EAAA,gBAAAkB,EAAAlB,GAOAO,GAAAP,EAAA,aAAAmB,EAAAnB,GAOAO,GAAAP,EAAA,wBAAAoB,EAAApB,GAYCA,EAAKzD,UAAY,IAAIf,GAAkBwE,GACvCA,EAAKqB,2BAA2B,OAAArB,CACjC,CAACsB,GAAA5D,EAAAmC,GAAA,IAAA0B,EAAA7D,EAAA5B,UAAAyF,EA1gBMC,yBADP,SACOA,EAAyBC,GAC/BA,EAAiB/F,KAAKgG,SAAW,CAAEC,YAAajG,KAAK4E,mBACtD,EAACiB,EAGMK,sBADP,SACOA,EAAsBH,GAC5B,MAAMI,EAAgBJ,EAAiB/F,KAAKgG,SAC5C,IAAII,EACJ,UAAWD,IAAkB,UAAYA,IAAkB,KAAM,CAChEC,EAAqBD,EAAcF,UACpC,KAAO,CACNG,EAAqBC,SACtB,CAEA,MAAMC,EACL,eAAgBP,UAA2BA,EAAiBE,aAAe,UAAYF,EAAiBE,WAAaI,UAEtH,GAAIC,IAAqB,MAAQF,IAAuB,KAAM,CAC7DpG,KAAKuG,eACN,CACA,GAAID,IAAqB,OAASF,IAAuB,MAAO,CAC9DpG,KAAKwG,QAA4C7B,kBAAoB,KACvE,CACD,EAACkB,EAEKY,oBAANC,eAAMD,IACL,OAAOzG,KAAKyE,qBAAqBkC,OAClC,EAACd,EAEDe,gBAAA,SAAAA,EAAgBC,GACf,MAAMrC,EAA+CxE,KAAKwE,oBAC1D,GAAIqC,EAAc,CACjB,MAAO,CACNC,UAAWD,EACXE,aAAcvC,EAEhB,CACA,OAAOqC,CACR,EAEAhB,EAKAmB,+BAAA,SAAAA,EAA+BC,GAC9B,MAAMC,EAAalH,KAAKY,oBACvBuG,EAAOD,EAAWE,UAClBC,EAAWF,EAAKG,cACjB,IAAIN,EAAiC,MACpCO,EAED,GAAIF,EAASE,oBAAsB1F,GAAsB2F,QAAS,CACjED,EAAoBL,EAAWO,6BAChC,KAAO,CACNF,EAAoBJ,EAAKO,KAAK,4BAC/B,CACA,MAAMC,EAAoBJ,GAAmBK,uBAI7C,GAAIX,IAAmBY,GAAQC,UAAW,CACzC,OAAO,IACR,MAAO,GAAIP,GAAqBF,EAASU,cAAgBC,GAAgBC,QAAS,CAEjF,GAAIf,EAAWgB,yBAAyBlI,KAAKmI,gBAAgBhB,IAAQ,CACpEH,EAAiC,IAClC,CACD,MAEK,GACJO,GACAF,EAASU,cAAgBC,GAAgBC,SACzCf,EAAWkB,gCAAgCb,EAAmBI,GAC7D,CACDX,EAAiC,IAClC,CACA,OAAOA,CACR,EAEAnB,EAOMwC,uBAAN3B,eAAM2B,EAAuBlB,EAAYmB,EAA0CC,GAClF,MAAMC,EAAYxI,KAAKyI,aACvB,MAAQC,iBAAkBC,EAAIC,yBAA0BC,EAAUC,wBAAEA,EAA0B,OAAUR,EAExG,IAAKE,IAAcG,EAAI,CACtB,OAAOI,QAAQC,SAChB,CACA,MAAMzB,EAAoBvH,KAAKmI,gBAAgBhB,GAC/C,MAAM8B,QAA4BjJ,KAAKkJ,0CACtC3B,EACAuB,EACAP,GAED,GAAIU,EAAqB,CACxBjJ,KAAKmJ,+BAA+BhC,EAAMwB,EAAIE,GAG9C,MAAMO,EAAuBP,EAAaA,EAAWQ,gCAAgCjI,OAAS,EAAI,MAClG,MAAMkI,EACL/B,GAAqBA,EAAkBgC,yBAA2BhC,EAAkBiC,wBACrF,MAAMC,EAA+BL,IAAyBE,IAA+B/B,GAE7F,MAAMxH,EAAeyI,EAAUkB,YAC/B,IAAIC,EAA4BhB,EAChC,GAAIJ,GAAwBkB,EAAqB,CAChDE,QAAgB3J,KAAK4J,eAAejB,EAAIc,EACzC,CACA,OAAO1J,EAAa8J,oBAAoBF,EAAS,KAClD,CACD,EAAC9D,EAEDiE,iBAAA,SAAAA,EAAiBC,EAA6BC,GAC7C,MAAMjK,EAAegK,EAAiBL,YACtC,MAAMO,EAAaA,KAClBjK,KAAK2E,mBAAqBqF,GAI3B,GAAID,EAAiBG,sBAAuB,CAG3CnK,EAAaoK,gBAAgB,SAAUF,GACvCF,EAAiBK,eAAe,KACjC,KAAO,CAENH,GACD,CACD,EAACpE,EAEK+D,eAANlD,eAAMkD,EAAeS,EAA8BZ,GAClD,IAAIa,EAAa,IAAIC,EAAiBF,EAAWG,gBACjD,MAAMC,QAAyBzK,KAAK0K,sBACpC,MAAMC,EAAqBF,GAAkBpB,iCAAmC,GAChF,GAAIsB,EAAmBvJ,OAAS,EAAG,CAElCkJ,EAAaK,EAAmBC,OAAO,CAACC,EAA0BC,KAEjE,MAAMC,EAAYF,EAAOG,gBAAgBF,GAEzC,GAAKrB,IAAwBsB,GAAW3J,SAAYqI,EAAqB,CAGxE,MAAMwB,EAAgBR,EAAiBO,gBAAgBF,GACvDD,EAAOK,oBAAoBJ,EAAeG,GAAiB,GAC5D,CACA,OAAOJ,GACLP,EACJ,CAEA,OAAOA,CACR,EAACzE,EAEDsF,sBAAA,SAAAA,EAAsB5D,GACrB,IAAKA,EAAmB,CACvB,OAAO,IACR,CACA,MAAM6D,EAAY7D,EAAkB8D,cACpC,MAAMC,EAAkBF,EAAUG,KAAK,SAAUC,GAChD,OAAOA,EAAKC,WAAalE,EAAkBK,sBAC5C,GACA,OAAQ0D,EAAgBI,eACzB,EAEA7F,EAMAsD,+BAAA,SAAAA,EAA+BhC,EAAYwB,EAAsBE,GAChE,IAAKA,GAAcA,GAAY8C,UAAW,CACzC,MACD,CAEA,MAAMtE,EAAWF,EAAKG,cACrBsE,EAAYzE,EAAK0E,YAAYC,eAC7BC,EAAc1E,EAAS0E,aAAe,IAAI1E,EAAS2E,YACnDC,EAAcL,EAAUM,eAAeH,GACvCI,EAAsDC,GAA4BH,GAGnF,MAAMI,EAA8BrM,KAAKsM,+BAA+BH,GACxE,MAAMI,EAA6BvM,KAAKwM,kCAAkCL,GAC1E,IAAKI,EAA4B,CAChC,MACD,CAEA,MAAME,EAAY9D,EAAGqC,gBAAgBqB,IAAgC,GACpEK,EAAmB7D,EAAWmC,gBAAgBqB,IAAgC,GAC9EM,EAA+BD,EAAiBtL,OAAS,EACzDwL,EAA4BH,EAAUrL,SAAW,EAElD,GAAIwL,GAA6BD,EAA8B,CAC9D,MAAME,EAA8BH,EAAiB,GACpDI,EAAOD,EAA4B,QACnCE,EAASF,EAA4B,UACrCG,EAAMH,EAA4B,OAClCI,EAAOJ,EAA4B,QAEpClE,EAAGuE,gBAAgBb,EAA6BS,EAAMC,EAAQC,EAAKC,EACpE,CACD,EAEApH,EAOQsH,gBAAR,SAAQA,EAAgBhB,GACvB,QAASA,EAAoBiB,kBAAkBC,YAAYC,aAAaC,QAAQC,aACjF,EAEA3H,EAMAyG,+BAAA,SAAAA,EAA+BH,GAC9B,OAAOnM,KAAKmN,gBAAgBhB,GAAuBpK,GAAmCD,EACvF,EAEA+D,EAKA2G,kCAAA,SAAAA,EAAkCL,GACjC,IAAII,EAA6B,MAEjC,GAAIvM,KAAKmN,gBAAgBhB,GAAsB,CAC9CI,EAA6BJ,EAAoBiB,kBAAkBC,WAAWI,iBAAiBC,KAC7FC,GAAiCA,EAAUC,OAAS7L,GAEvD,KAAO,CACN,MAAMiK,EACJG,EAAoBiB,kBAAkBS,QAAU,YAAc1B,EAAoBiB,kBAAoB/G,UACvGyH,EAAqB9B,GAAWsB,YAAYS,cAAcC,oBAAoBC,oBAAsB,GACrG1B,EAA6BuB,EAAmBJ,KAC9CQ,GAAmCA,EAAiBC,QAAUrM,GAEjE,CACA,OAAOyK,CACR,EAEA1G,EAOMqD,0CAANxC,eAAMwC,EACL3B,EACA6G,EACA7F,GAEA,GAAIhB,IAAsBgB,EAAsB,CAC/C,IAAI8F,EAAaD,EAAgB7G,EAAkBiC,wBAA0BjC,EAAkBgC,uBAC/F,GAAI8E,IAAe,KAAM,CACxBA,EAAa9G,EAAkBvB,OAChC,OACMsI,EAAuBC,gBAAgB,CAC5CC,QAASjH,EACTkH,iBAAkBJ,IAEnB,OAAOD,GAAiB7G,EAAkBgC,yBAA2BhC,EAAkBiC,uBACxF,CAEA,OAAO,IACR,EAEA3D,EAKAsC,gBAAA,SAAAA,EAAgBhB,GACf,IAAII,EACJ,MAAMF,EAAWF,EAAKG,cACtB,OAAQD,EAASE,mBAChB,KAAK1F,GAAsB6M,KAC1BnH,EAAoBJ,EAAKO,KAAK,6BAC9B,MACD,KAAK7F,GAAsB2F,QAC1BD,EAAqBJ,EAAKwH,gBAAyClH,8BACnE,MACD,KAAK5F,GAAsB+M,KAC3B,QACC,MAEF,OAAOrH,CACR,EAEA1B,EACMgJ,kCAANnI,eAAMmI,EAAkCC,GACvC,MAAMC,EAAiBD,EAAW,wBACjCE,EAAsBF,EAAW,kCACjCG,EAAkBH,EAAW,8BAC7BI,EAAkBJ,EAAW,8BAC9B,IAAIK,EACJ,GAAIJ,GAAkBC,GAAuBC,GAAmBC,EAAiB,CAChFC,EAAc,CACbC,eAAgBL,GAAkBA,EAAe,GACjDM,oBAAqBL,GAAuBA,EAAoB,GAChEM,gBAAiBL,GAAmBA,EAAgB,GACpDM,gBAAiBL,GAAmBA,EAAgB,GAEtD,CACA,OAAOlP,KAAKwP,wBAAwBL,EACrC,EAACtJ,EAEK2J,wBAAN9I,eAAM8I,EAAwBL,GAC7B,IAAIM,EACJ,MAAMC,EAAQ1P,KAAKY,qBAAqBwG,UACvCuI,EAAgC,GACjC,MAAMC,EAAqBF,EAAMpI,cAAcC,kBAC/C,GAAI4H,GAAeA,EAAYC,gBAAkBQ,IAAuB,OAAQ,CAC/EH,EAAMC,EAAMhI,KAAK,6BACjB1H,KAAK6P,qBAAqBV,EAAaM,EAAKE,EAC7C,MAAO,GAAIR,GAAeS,IAAuB,UAAW,CAC3D,GAAIT,EAAYE,oBAAqB,CACpCI,EAAOC,EAAMf,gBAAyClH,8BACtDzH,KAAK8P,iCAAiCX,EAAaM,EAAKE,EACzD,CACD,CACA,OAAO5G,QAAQgH,IAAIJ,EACpB,EAEA9J,EAQAgK,qBAAA,SAAAA,EAAqBV,EAAyBM,EAAwBE,GACrEF,EAAIpE,eAAe1J,QAASqO,IAC3BhQ,KAAKiQ,6BAA6BD,EAAUb,EAAYC,eAAgBK,EAAKE,EAAW,OAE1F,EAEA9J,EASAiK,iCAAA,SAAAA,EAAiCX,EAAyBM,EAAwBE,GACjF,GAAIF,EAAK,CACRA,EAAIpE,cAAc1J,QAASqO,IAC1BhQ,KAAKiQ,6BAA6BD,EAAUb,EAAYE,oBAAqBI,EAAKE,EAAW,OAE/F,CACD,EAEA9J,EAUAoK,6BAAA,SAAAA,EAECD,EACAE,EACAT,EACAE,EACAQ,GAEA,GAAIH,EAASI,MAAQF,EAAY,CAChCP,EAAUU,KAAKrQ,KAAKsQ,qBAAqBb,EAAKS,EAAYC,GAC3D,CACD,EAACtK,EAEKyK,qBAAN5J,eAAM4J,EAAqBN,EAA6BO,GAAqE,IAAjDJ,EAAqBK,UAAApP,OAAA,GAAAoP,UAAA,KAAAnK,UAAAmK,UAAA,GAAG,MACnG,MAAMC,EAAoBzQ,KAAK0Q,6BAA6BV,EAAUO,GAAcA,EAAaP,EAASxG,wBAC1G,MAAMiG,EAAMnB,EAAuBC,gBAAgB,CAClDC,QAASwB,EACTvB,iBAAkBgC,IAEnB,OAAOhB,EAAIkB,KAAK,WACf,OAAOR,CACR,EACD,EAACtK,EAED6K,6BAAA,SAAAA,EAA6BjB,EAAwBS,GACpD,MAAM9E,EAAYqE,EAAIpE,cACtB,IAAIuF,EAAkC,MACtCxF,EAAUzJ,QAAQ,SAAUqO,GAC3B,GAAIA,EAASvE,WAAayE,EAAY,CACrCU,EAAkC,IACnC,CACD,GACA,OAAOA,CACR,EAAC/K,EAgHOF,yBAAR,SAAQA,IACPkL,EAAUC,kBAAkB9Q,KAAK+Q,oBACjCF,EAAUG,kBAAkBhR,KAAK+Q,mBAClC,EAAClL,EAEDkL,mBAAA,SAAAA,EAAmBE,GAClB,MAAMC,EAAUD,EAAOE,aAAa,WACpC,GAAID,EAAQE,IAAe,wBAAyB,CACnD,MAAMrR,EAAemR,EAAQxH,YAC7B,GAAI3J,GAAcsR,kBAAmB,CACpCtR,EAAasR,mBACd,CACD,CACD,EAACxL,EAGDyL,aADA,SACAA,EAAaL,GACZ,MAAMM,EAAaN,EAAOO,YAC1B,MAAMhR,EAAkByQ,EAAOQ,gBAC/B,GAAIF,EAAY,CACf,MAAM9Q,EAAc8Q,EAAWG,uBAAyB,CAAC,EACzD,MAAMC,EAA0B3R,KAAK4R,wBAAwBL,GAC7DvR,KAAKa,WAAWN,SAASC,EAAiBC,GAC1CT,KAAK6R,UAAU,iBAAkBC,EAAM,CAAErR,WAAYA,GAAcD,IACnER,KAAK6R,UAAU,SAAUC,EAAM,CAAExR,OAAQE,EAAgBF,QAAUqR,IACnE3R,KAAK4E,mBAAqB,MAC1B,IAAK5E,KAAK+R,SAAU,CACnB/R,KAAKY,qBAAqBoR,kBAAkBC,gBAC7C,CACD,CACD,EAACpM,EAGDqM,oBADA,SACAA,EAAoBjB,GACnB,MAAMzI,EAAYyI,EAAOO,YACzB,MAAMW,EAAmBlB,EAAOQ,gBAChC,GAAIjJ,EAAW,CACd,MAAM4J,EAAc5J,EAAUkJ,sBAC9B,MAAMlR,EAA0BR,KAAK4R,wBAAwBpJ,GAC7DxI,KAAKa,WAAWR,iBAAiBL,KAAKqS,oBAAoB7J,IAC1DxI,KAAK6R,UAAU,wBAAyBC,EAAM,CAAErR,WAAY2R,GAAeD,IAC3EnS,KAAK6R,UAAU,gBAAiBrR,GAEhC,GAAI2R,GAAkBG,gBAAiB,CACtCtS,KAAK4E,mBAAqB,IAC3B,CACD,CACD,EAACiB,EAEDwM,oBAAA,SAAAA,EAAoB7J,GACnB,OAAOA,GAAW+J,UAAY,EAC/B,EAAC1M,EAED+L,wBAAA,SAAAA,EAAwBL,GACvB,MAAMvQ,WAAEA,EAAUwR,QAAEA,EAAOC,OAAEA,GAAWC,EAAYC,WAAWpB,IAA4C,CAAC,EAE5G,MAAO,CAAEvQ,aAAYwR,UAASC,SAC/B,EAEA5M,EAUM+M,gBAANlM,eAAMkM,EACLC,EACAC,EACAC,GAIA,GAAIvC,UAAUpP,SAAW,EAAG,CAC3B2R,EAAUD,EACV,OAAOJ,EAAYE,gBAAgB5S,KAAKwG,QAASqM,EAAgBE,EAClE,CACA,OAAOL,EAAYE,gBAAgB5S,KAAKwG,QAASqM,EAAgBC,EAAWC,EAC7E,EAEAlN,EAKAmN,qBAAA,SAAAA,IACC,OAAOhT,KAAKwG,SAASyM,0BAA0BC,aAAe,EAC/D,EAEArN,EAMA8M,WAAA,SAAAA,IACC,OAAOD,EAAYC,WAAW3S,KAAKwG,UAA8B,CAAC,CACnE,EAEAX,EAKMU,cAANG,eAAMH,IACL,MAAMiC,EAAYxI,KAAKwG,QACvB,IACC,GAAIgC,EAAW,OACRA,EAAU2K,wBAChB,aAAa3K,EAAUjC,eACxB,CACD,CAAE,MAAO6M,GACR,MAAMC,EAAUD,aAAeE,MAAQF,EAAIC,QAAUE,OAAOH,GAC5DI,EAAIC,MAAM,oCAAoCJ,KAC9C,MAAMC,MAAMD,EACb,CACD,EAACxN,EAED6N,4BAAA,SAAAA,IACC,OAAOC,EAAsBC,0BAA0B5T,KAAKwG,QAAQqN,gBAAiB,MACtF,EAEAhO,EAMM6E,oBAANhE,eAAMgE,IACL,MAAMhC,QAAyBoL,EAAYpJ,oBAAoB1K,KAAKyI,cACpE,MAAMvB,EAAalH,KAAKY,oBACxB,GAAIsG,IAAeb,UAAW,CAC7B,MAAMc,EAAOD,GAAYE,UACxB2M,EAAeC,EAAYC,gBAAgB9M,GAC3C+M,EAAoBH,GAAcI,uBAClCC,EAAkBpU,KAAKqU,8BAA8BrU,KAAKsU,UAC3D,GAAIF,GAAiBG,iBAAiB3G,KAAM,CAC3C,MAAM4G,EACLJ,GAAiBG,iBAAiB3G,MAClCsG,GAAmBO,oBAAoBL,GAAiBG,iBAAiB3G,KAAMzG,EAAK0E,YACrFnD,EAAiBgM,oBAAoBF,EACtC,CACD,CACA,OAAO9L,CACR,EAEA7C,EAIA8O,gCAAA,SAAAA,IACC,OAAQ3U,KAAKwG,QAAQoO,qBACnBC,OAAO,SAAUC,GACjB,OAAOA,EAAWC,QACnB,GACCC,IAAI,SAAUC,GACd,OAAOA,EAAaC,aACrB,EACF,EAEArP,EAKA4L,cAAA,SAAAA,IACC,MAAMjJ,EAAYxI,KAAKwG,QACvB,MAAMxF,EAAawH,EAAU2M,KAAK,cAClC,GAAInU,EAAY,CACf,OAAOoU,MAAMC,QAAQrU,GAAcA,EAAasU,KAAKC,MAAMvU,EAC5D,CACA,MAAO,EACR,EAAC6E,EAEDvE,WAAA,SAAAA,IACC,IAAIkU,EACJ,IACC,MAAMC,EAAezV,KAAK6L,SAAS,iBACnC,MAAM6J,EAAuB1V,KAAKwG,QAAQmP,0BAE1C,GAAIF,GAAgBC,EAAsB,CACzCF,EAAiBC,EAAanU,WAAWmU,EAAaG,2BAA2BF,GAClF,CACD,CAAE,MAAOG,GACRrC,EAAIsC,MAAM,0BAA2BD,EACtC,CACA,OAAOL,CACR,EAEA3P,EAQMkQ,sBAANrP,eAAMqP,EAAsBb,EAAuBc,SAC5CnF,EAAUoF,mBAAmBjW,KAAKwG,QAAS,CAAE0P,MAAO,CAAC,CAAEtI,KAAMsH,EAAec,aACnF,EAEAnQ,EAMMsQ,sBAANzP,eAAMyP,EAAsBjB,GAC3B,MAAMkB,QAAiCvF,EAAUwF,sBAAsBrW,KAAKwG,SAC5E,QAAS4P,EAAMF,MAAM3K,KAAMC,GAASA,EAAKoC,OAASsH,EACnD,EAEArP,EAIAyQ,qBAAA,SAAAA,IACC,MAAMC,EAAuBvW,KAAKwG,QAAQmP,0BAC1C,GAAIY,EAAsB,CACzB,OAAOC,EAAWC,eAAeF,EAClC,KAAO,CACN,MAAM,IAAIjD,MAAM,wDAAwDtT,KAAK0W,KAC9E,CACD,EAEA7Q,EAIA8Q,wBAAA,SAAAA,EAAwBC,GACvB,MAAMpQ,EAAUxG,KAAKyI,aACrB,MAAMoO,EAAarQ,GAASsQ,gBAC5B,IAAKD,EAAY,CAChB7W,KAAKwG,QAAQuQ,wBAAwBH,EACtC,CACD,EAEA/Q,EAKA+B,qBAAA,SAAAA,IACC,OAAO5H,KAAKsW,uBAAuB1O,sBACpC,EAEA/B,EAKAmR,qBAAA,SAAAA,EAAqB5G,GACpB,MAAM7I,EAAoBvH,KAAKsW,uBAC/B/O,EAAkByP,qBAAqB5G,EACxC,EAEAvK,EAMAoR,sBAAA,SAAAA,EAAsBrJ,EAAcsJ,GAClClX,KAAK6L,SAAS,YAA0BsL,QACxC,CACC,CAACnX,KAAKwG,QAAQ2O,KAAK,YAAa,CAC/BiC,aAAc,CAAExJ,CAACA,GAAO,CAAEyJ,SAAUH,EAAUI,EAAcC,SAAWD,EAAcE,aAGvF,KAEF,EAEA3R,EAMA4R,sBAAA,SAAAA,EAAsB7J,GACrB,OAAQ5N,KAAK6L,SAAS,YAA0B6L,YAAY,IAAI1X,KAAKwG,QAAQ2O,KAAK,2BAA2BvH,gBAC5G0J,EAAcE,SACZ,MACA,IACJ,EAEA3R,EAMM8R,sCAANjR,eAAMiR,EACLjP,EACAkP,GAEA,OAAO9D,EAAY6D,sCAClB3X,KAAKwG,QACLkC,EACAkP,EACA5X,KAAKwG,SAASqF,WAEhB,EAEAhG,EAMMgS,8BAANnR,eAAMmR,EAA8BrP,EAAsBsP,SACnDhE,EAAY+D,8BAA8BrP,EAAWsP,EAC5D,EAEAjS,EAQMgE,oBAANnD,eAAMmD,EAAoBnB,GAAmF,IAA/CkP,EAAmBpH,UAAApP,OAAA,GAAAoP,UAAA,KAAAnK,UAAAmK,UAAA,GAAG,MACnF,MAAMhK,EAAUxG,KAAKyI,aACrB,MAAMoO,EAAarQ,GAAWA,GAASsQ,gBACvC,IAAIiB,EACJ,GAAIlB,EAAY,CACfrQ,EAAQ4D,eAAe,MACxB,CACA,IACC2N,QAAejE,EAAYkE,gCAAgChY,KAAKyI,aAAcC,EAAkBkP,GAChG,OAAOG,GAAQE,gBAChB,CAAE,MAAO7E,GACR,MAAMC,EAAUD,aAAeE,MAAQF,EAAIC,QAAUE,OAAOH,GAC5DI,EAAIC,MAAM,oCAAoCJ,KAC9C,MAAMC,MAAMD,EACb,CAAC,QACA,GAAIwD,EAAY,CACfrQ,EAAQ4D,eAAe,KAAM2N,GAAQG,UACtC,CACD,CACD,EAEArS,EAGAwL,kBAAA,SAAAA,IACCrR,KAAKY,qBAAqBoR,kBAAkBC,gBAC7C,EAACpM,EAEOsS,iBAAR,SAAQA,EAAiBC,GACxB,MAAMC,EAA2B3F,EAAY4F,kCAAkCtY,KAAKwG,QAAS4R,GAC7F,OACEC,EAA2BE,GAAmCF,EAA0B,MAAO,MAAQhS,YACxG+R,CAEF,EAACvS,EAEK2S,gBAAN9R,eAAM8R,EAAgB5K,GACrB,MAAMwI,QAAiCvF,EAAUwF,sBAAsBrW,KAAKwG,SAC5E,MAAM0O,EAAgBlV,KAAKmY,iBAAiBvK,GAC5C,MAAM6K,IAAsBrC,EAAMF,MAAM3K,KAAMC,GAASA,EAAKoC,OAASsH,GACrE,IAAKuD,EAAmB,CACvBrC,EAAMF,MAAM7F,KAAK,CAAEzC,KAAMsH,GAC1B,OACMrE,EAAUoF,mBAAmBjW,KAAKwG,QAAS4P,EAClD,EAACvQ,EAEK6S,4BAANhS,eAAMgS,EAA4B9K,EAAc+K,GAC/C,MAAMzD,EAAgBlV,KAAKmY,iBAAiBvK,GAE5C,OAAO,IAAI7E,QAAQ,CAACC,EAAS4P,KAC5B,MAAMC,EAAc7Y,KAAKwG,QAAQsS,iBAAiBvN,KAAMC,GAASA,EAAKuN,mBAAqB7D,GAC3F,MAAM8D,EAAYxC,EAAWC,eAAeoC,GAAaI,gBACzD,IAAKD,IAAcH,EAAa,CAC/BD,EAAO,IAAItF,MAAM,8BAA8B1F,gBAC/C,MACD,CAEAoL,EAAU7O,gBAAgB,SAAU,KACnCnB,EAAQgQ,EAAUnF,mBAGlBgF,EAAmDK,YAAc,CAAEC,WAAY,CAAEC,OAAQ,OACzFP,EAAoDQ,YAAY,IAAIC,OAAOC,MAAM,YAClFC,WAAW,KACTX,EAAYY,eAAe,YAAwB,GAAGC,qBAAqB,CAC3EC,aAAc,KACdC,gBAAiBjB,KAEhB,MAEL,EAAC9S,EAEDgU,wBAAA,SAAAA,IACC,OAAO7Z,KAAKwG,SAASyM,0BAA0BC,WAChD,EAAC,OAAAlR,CAAA,CA/WiB,CAtjBQ8X,GAAQC,GAAA7V,EAAA9D,UAAA,4BAAAmC,GAAArB,OAAA8Y,yBAAA9V,EAAA9D,UAAA,4BAAA8D,EAAA9D,WAAA2Z,GAAA7V,EAAA9D,UAAA,yBAAAqC,GAAAvB,OAAA8Y,yBAAA9V,EAAA9D,UAAA,yBAAA8D,EAAA9D,WAAA0E,EAAAiV,GAAA7V,EAAA9D,UAAA,MAAAsC,GAAA,CAAAuX,aAAA,KAAAC,WAAA,KAAAC,SAAA,KAAAC,YAAA,OAAArV,EAAAgV,GAAA7V,EAAA9D,UAAA,YAAAwC,GAAA,CAAAqX,aAAA,KAAAC,WAAA,KAAAC,SAAA,KAAAC,YAAA,OAAApV,EAAA+U,GAAA7V,EAAA9D,UAAA,eAAA2C,GAAA,CAAAkX,aAAA,KAAAC,WAAA,KAAAC,SAAA,KAAAC,YAAA,OAAAnV,EAAA8U,GAAA7V,EAAA9D,UAAA,YAAA4C,GAAA,CAAAiX,aAAA,KAAAC,WAAA,KAAAC,SAAA,KAAAC,YAAA,OAAAlV,EAAA6U,GAAA7V,EAAA9D,UAAA,WAAA8C,GAAA,CAAA+W,aAAA,KAAAC,WAAA,KAAAC,SAAA,KAAAC,YAAA,OAAAjV,EAAA4U,GAAA7V,EAAA9D,UAAA,gBAAA+C,GAAA,CAAA8W,aAAA,KAAAC,WAAA,KAAAC,SAAA,KAAAC,YAAA,OAAAhV,EAAA2U,GAAA7V,EAAA9D,UAAA,mBAAAgD,GAAA,CAAA6W,aAAA,KAAAC,WAAA,KAAAC,SAAA,KAAAC,YAAA,OAAA/U,EAAA0U,GAAA7V,EAAA9D,UAAA,gBAAAiD,GAAA,CAAA4W,aAAA,KAAAC,WAAA,KAAAC,SAAA,KAAAC,YAAA,OAAA9U,EAAAyU,GAAA7V,EAAA9D,UAAA,UAAAoD,GAAA,CAAAyW,aAAA,KAAAC,WAAA,KAAAC,SAAA,KAAAC,YAAA,OAAA7U,EAAAwU,GAAA7V,EAAA9D,UAAA,kBAAAsD,GAAA,CAAAuW,aAAA,KAAAC,WAAA,KAAAC,SAAA,KAAAC,YAAA,OAAA5U,EAAAuU,GAAA7V,EAAA9D,UAAA,iBAAAuD,GAAA,CAAAsW,aAAA,KAAAC,WAAA,KAAAC,SAAA,KAAAC,YAAA,OAAA3U,EAAAsU,GAAA7V,EAAA9D,UAAA,cAAAwD,GAAA,CAAAqW,aAAA,KAAAC,WAAA,KAAAC,SAAA,KAAAC,YAAA,OAAA1U,EAAAqU,GAAA7V,EAAA9D,UAAA,yBAAAyD,GAAA,CAAAoW,aAAA,KAAAC,WAAA,KAAAC,SAAA,KAAAC,YAAA,OAAAL,GAAA7V,EAAA9D,UAAA,gBAAA0D,GAAA5C,OAAA8Y,yBAAA9V,EAAA9D,UAAA,gBAAA8D,EAAA9D,WAAA2Z,GAAA7V,EAAA9D,UAAA,uBAAA4D,GAAA9C,OAAA8Y,yBAAA9V,EAAA9D,UAAA,uBAAA8D,EAAA9D,WAAA8D,KAAAD,OAAA,OAu6BpBjC,EAAY","ignoreList":[]}