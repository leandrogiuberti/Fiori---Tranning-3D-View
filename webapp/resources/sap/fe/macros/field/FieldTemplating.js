/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)
 *      (c) Copyright 2009-2025 SAP SE. All rights reserved
 */
sap.ui.define(["sap/fe/base/BindingToolkit","sap/fe/core/converters/annotations/DataField","sap/fe/core/formatters/ValueFormatter","sap/fe/core/helpers/TypeGuards","sap/fe/core/templating/CommonFormatters","sap/fe/core/templating/DataFieldFormatters","sap/fe/core/templating/DataModelPathHelper","sap/fe/core/templating/PropertyHelper","sap/fe/core/templating/SemanticObjectHelper","sap/fe/core/templating/UIFormatters","sap/m/AvatarShape","sap/ui/model/json/JSONModel","./FieldHelper"],function(e,t,a,n,i,o,r,s,l,c,u,f,m){"use strict";var d={};var p=s.hasStaticPercentUnit;var g=r.getRelativePaths;var v=r.getContextRelativeTargetObjectPath;var y=r.getContextPropertyRestriction;var I=r.enhanceDataModelPath;var b=o.generateVisibleExpression;var h=n.isProperty;var O=n.isPathAnnotationExpression;var T=n.isNavigationProperty;var D=n.isAnnotationOfType;var U=n.isAnnotationOfTerm;var F=t.isDataFieldForAnnotation;var P=e.transformRecursively;var x=e.pathInModel;var j=e.or;var M=e.isPathInModelExpression;var E=e.isComplexTypeExpression;var S=e.ifElse;var k=e.getExpressionFromAnnotation;var V=e.formatWithTypeInformation;var C=e.formatResult;var $=e.constant;var A=e.compileExpression;const B=function(e,t){return P(e,"PathInModel",e=>{let a=e;if(e.modelName===undefined){const n=I(t,e.path);a=i.getBindingWithTextArrangement(n,e)}return a})};d.addTextArrangementToBindingExpression=B;const N=function(e,t){return P(e,"PathInModel",e=>{let a=e;if(e.modelName===undefined){const n=I(t,e.path);if(n.targetObject){a=V(n.targetObject,e)}}return a})};d.formatValueRecursively=N;const W=function(e,t){return R(e,t,true)};d.getTextBindingExpression=W;const R=function(e,t){let a=arguments.length>2&&arguments[2]!==undefined?arguments[2]:false;let n=arguments.length>3?arguments[3]:undefined;if(D(e.targetObject,["com.sap.vocabularies.UI.v1.DataField","com.sap.vocabularies.UI.v1.DataPointType","com.sap.vocabularies.UI.v1.DataFieldWithNavigationPath","com.sap.vocabularies.UI.v1.DataFieldWithUrl","com.sap.vocabularies.UI.v1.DataFieldWithIntentBasedNavigation","com.sap.vocabularies.UI.v1.DataFieldWithAction"])){const t=k(e.targetObject.Value)??"";return A(t)}if(O(e.targetObject)&&e.targetObject.$target){e=I(e,e.targetObject.path)}if(typeof e.targetObject==="string"){return e.targetObject}const o=x(v(e));let r;const s=e;const l=s.targetObject;if(l?.annotations?.UI?.InputMask){r=V(l,o);r.type="sap.fe.core.type.InputMask";r.formatOptions={mask:l.annotations?.UI?.InputMask?.Mask.toString(),placeholderSymbol:l.annotations?.UI?.InputMask?.PlaceholderSymbol.toString(),maskRule:te(l.annotations?.UI?.InputMask?.Rules)}}else if(l?.annotations?.Common?.Masked?.valueOf()){r=V(l,o);r.formatOptions={editStyle:"Masked"}}else if(l?.annotations?.Measures?.Unit||l?.annotations?.Measures?.ISOCurrency){r=c.getBindingWithUnitOrCurrency(s,o,undefined,{},true,t.showOnlyUnitDecimals,t.preserveDecimalsForCurrency);if(t?.measureDisplayMode==="Hidden"&&E(r)){r.formatOptions={...r.formatOptions,showMeasure:false}}}else if(l?.annotations?.Common?.Timezone&&l.type=="Edm.DateTimeOffset"){r=c.getBindingWithTimezone(s,o,false,true,t)}else if(l?.annotations?.Common?.IsTimezone){r=c.getBindingForTimezone(s,o)}else if(l?.annotations?.UI?.DateTimeStyle||t?.dateTimePattern||t?.dateTimeStyle){r=c.getBindingForDateFormat(s,o,t)}else{r=i.getBindingWithTextArrangement(s,o,t,n)}if(a){return r}return A(r)};d.getTextBinding=R;const w=function(e,t){let a=arguments.length>2&&arguments[2]!==undefined?arguments[2]:false;let n=arguments.length>3&&arguments[3]!==undefined?arguments[3]:false;let i=arguments.length>4?arguments[4]:undefined;let o=arguments.length>5&&arguments[5]!==undefined?arguments[5]:false;let r=arguments.length>6&&arguments[6]!==undefined?arguments[6]:false;let s=arguments.length>7?arguments[7]:undefined;let l=arguments.length>8&&arguments[8]!==undefined?arguments[8]:false;let u=arguments.length>9&&arguments[9]!==undefined?arguments[9]:false;if(O(e.targetObject)&&e.targetObject.$target){const t=e.targetEntityType.resolvePath(e.targetObject.path,true);e.targetObject=t.target;t.visitedObjects.forEach(t=>{if(T(t)){e.navigationProperties.push(t)}})}const f=e.targetObject;if(h(f)){let m=x(v(e));if(M(m)){if(f.annotations?.Communication?.IsEmailAddress){m=V(f,m);m.type="sap.fe.core.type.Email"}else if(f.annotations?.UI?.InputMask){m=V(f,m);m.type="sap.fe.core.type.InputMask";m.formatOptions={...m.formatOptions,mask:f.annotations.UI.InputMask.Mask,placeholderSymbol:f.annotations.UI.InputMask.PlaceholderSymbol,maskRule:te(f.annotations.UI.InputMask.Rules)}}else if(f.annotations?.Common?.Masked?.valueOf()){m=V(f,m);m.formatOptions={...m.formatOptions,style:"password"}}else if(!a&&(f.annotations?.Measures?.ISOCurrency||f.annotations?.Measures?.Unit)){const a={};if(!r){a["showMeasure"]=false}if(String(t.isCurrencyOrUnitAligned)==="true"){a["decimalPadding"]=s}m=c.getBindingWithUnitOrCurrency(e,m,true,r?undefined:a,l,t.showOnlyUnitDecimals,t.preserveDecimalsForCurrency)}else if(f?.annotations?.Common?.IsTimezone){m=c.getBindingForTimezone(e,m)}else if(f?.annotations?.UI?.DateTimeStyle||t?.dateTimePattern||t?.dateTimeStyle){m=c.getBindingForDateFormat(e,m,t)}else if(f?.annotations?.Common?.Timezone&&f.type==="Edm.DateTimeOffset"){m=c.getBindingWithTimezone(e,m,true)}else{m=V(f,m);if(f.annotations.Common?.ExternalID){m.path+="@$ui5.fe.@Common/ExternalID"}}if(M(m)){if(n){delete m.formatOptions;delete m.constraints;delete m.type}if(i){m.parameters=i}if(o){m.targetType="any"}}if(u){return m}return A(m)}else{return""}}else if(f?.$Type==="com.sap.vocabularies.UI.v1.DataFieldWithUrl"||f?.$Type==="com.sap.vocabularies.UI.v1.DataFieldWithNavigationPath"){return A(k(f.Value))}else{return""}};d.getValueBinding=w;const H=function(e,t){const a=s.getAssociatedTextPropertyPath(e.targetObject);if(a){const n=I(e,a);let i=false;const o=e.targetObject?.annotations?.Common?.ValueList?.Parameters.map(e=>{if(!e){return""}return e?.LocalDataProperty?.$target?.fullyQualifiedName??""})||[];if(n?.targetObject?.fullyQualifiedName&&o.includes(n.targetObject.fullyQualifiedName)){i=true}const r=i?undefined:{$$noPatch:true};return w(n,t,true,false,r,false,false,undefined,true)}return undefined};d.getAssociatedTextBinding=H;const z=function(e,t){const a=e?.targetEntityType?.navigationProperties||[];const n=e?.targetEntityType?.annotations?.Common?.SemanticKey||[];let i=false;a.forEach(e=>{if(e.referentialConstraint&&e.referentialConstraint.length){e.referentialConstraint.forEach(a=>{if(a?.sourceProperty===t.name){if(e?.targetType?.annotations?.UI?.QuickViewFacets){i=true}}})}});if(e.contextLocation?.targetEntitySet!==e.targetEntitySet){const a=n.some(function(e){return e?.$target?.name===t.name});if((a||t.isKey)&&e?.targetEntityType?.annotations?.UI?.QuickViewFacets){i=true}}return i};d.isUsedInNavigationWithQuickViewFacets=z;const Q=function(e,t){const a=O(e)&&e.$target||e;if(!a.annotations?.Common?.Text&&!a.annotations?.Measures&&s.hasValueHelp(a)&&t.textAlignMode==="Form"){return true}return false};d.isRetrieveTextFromValueListEnabled=Q;const L=function(e,t,a){let n=arguments.length>3&&arguments[3]!==undefined?arguments[3]:false;let i=e.targetObject?.Value?.$target.type||e.targetObject?.Target?.$target?.Value.$target.type;if(s.isKey(e.targetObject?.Value?.$target||e.targetObject?.Target?.$target?.Value?.$target)){return"Begin"}if(n&&t.displayMode&&["Description","DescriptionValue","ValueDescription"].includes(t.displayMode)){const t=e.targetObject?.Value?.$target.annotations?.Common?.Text;const a=t?.annotations?.UI?.TextArrangement.valueOf();if(t&&a!=="UI.TextArrangementType/TextSeparate"){i=t.$target.type}}return m.getPropertyAlignment(i,t,a)};d.getTextAlignment=L;const G=function(e,t){return A(b(e,t))};d.getVisibleExpression=G;const K=function(e){const t=e.targetObject;const a=A(b(e));const n=[];if(typeof a==="string"&&a.includes("{=")){return a}if(t.$Type==="com.sap.vocabularies.UI.v1.DataFieldForAnnotation"&&t.Target.$target?.$Type==="com.sap.vocabularies.UI.v1.ConnectedFieldsType"){const i=Object.values(t.Target.$target.Data).filter(e=>e?.hasOwnProperty("Value"));i.forEach(t=>{e.targetObject=t;const a=b(e);if(a!==undefined){n.push(a)}});return n.length?A(j(...n)):a}return a};d.visibleExpressionsForConnectedFieldsFormElement=K;const q=function(e){if(!e.targetObject){return""}if(typeof e.targetObject==="string"){return e.targetObject}return R(e,{})};d.getQuickViewBinding=q;const J=function(e){const t=e.targetObject;if(D(t,"com.sap.vocabularies.UI.v1.DataFieldWithUrl")&&t?.Url){return"link"}if(!h(t)&&t?.Value.$target?.annotations?.Communication?.IsEmailAddress||h(t)&&t?.annotations?.Communication?.IsEmailAddress){return"email"}if(!h(t)&&t?.Value.$target?.annotations?.Communication?.IsPhoneNumber||h(t)&&t?.annotations?.Communication?.IsPhoneNumber){return"phone"}return"text"};d.getQuickViewType=J;const Z=function(e){if(e.length>0){let t="";let a="";const n=[];for(const i of e){t=i.key;a=A(k(i.value));n.push({key:t,value:a})}const i=new f(n);i.$$valueAsPromise=true;return i.createBindingContext("/")}else{return new f([]).createBindingContext("/")}};d.getSemanticObjects=Z;const X=function(e,t){if(e.wrap===false){return false}return t};d.getMultipleLinesForDataField=X;const Y=function(e,t){const a=s.getAssociatedUnitProperty(e);const n=s.getAssociatedCurrencyProperty(e);return s.hasValueHelp(e)&&e.type!=="Edm.Boolean"||t!=="Hidden"&&(a&&s.hasValueHelp(a)||n&&s.hasValueHelp(n))};const _=function(t,n,i){const o=t?.Validation?.[n]?.$Date;const r=t?.Validation?.[n];if(o){return C([$(o)],a.provideDateInstance)}else if(r){return e.getExpressionFromAnnotation(t?.Validation?.[n],i)}return undefined};d.getMinMaxDateExpression=_;const ee=function(e,t,a,n){const i=a.targetObject;if(!h(i)||["com.sap.vocabularies.UI.v1.DataFieldForAction","com.sap.vocabularies.UI.v1.DataFieldWithNavigationPath","com.sap.vocabularies.UI.v1.DataFieldForActionGroup","com.sap.vocabularies.UI.v1.DataFieldForIntentBasedNavigation"].includes(t.$Type)){e.editStyle=null;return}if(!n){if(i?.annotations?.Validation?.Maximum?.$Date||i?.annotations?.Validation?.Minimum?.$Date){const t=x(v(a));e.valueBindingExpression=c.getBindingForDatePicker(a,t)}else{e.valueBindingExpression=e.value?e.value:w(a,e.formatOptions)}const n=t.annotations?.UI?.Placeholder||t?.Value?.$target?.annotations?.UI?.Placeholder;if(n){e.editStylePlaceholder=A(k(n))}}const o=F(t)?t.Target?.$target:t;if(o?.Visualization==="UI.VisualizationType/Rating"){e.editStyle="RatingIndicator";if(o.annotations?.Common?.QuickInfo){e.ratingIndicatorTooltip=A(k(o.annotations?.Common?.QuickInfo))}e.ratingIndicatorTargetValue=A(k(o.TargetValue));return}if(Y(i,e.formatOptions?.measureDisplayMode)||e.formatOptions?.measureDisplayMode!=="Hidden"&&(i.annotations?.Measures?.ISOCurrency||i.annotations?.Measures?.Unit&&!p(i))){if(!n){const t=i.annotations?.Common?.ExternalID?H(e.dataModelPathExternalID,e.formatOptions):H(a,e.formatOptions);const n=!!e.value&&/{\w+>.+}/.test(e.value);if(n){if(e.description){e.textBindingExpression=e.description}else{e.textBindingExpression=undefined;e.formatOptions.displayMode="Value"}}else{e.textBindingExpression=t}if(e.formatOptions?.measureDisplayMode!=="Hidden"){e.valueBindingExpression=e.value?e.value:w(a,e.formatOptions,false,false,undefined,false,true)}}e.editStyle="InputWithValueHelp";return}switch(i.type){case"Edm.Date":e.editStyle="DatePicker";const t=g(a);if(i?.annotations?.Validation?.Maximum){e.maxDateExpression=_(i?.annotations,"Maximum",t)}if(i?.annotations?.Validation?.Minimum){e.minDateExpression=_(i?.annotations,"Minimum",t)}return;case"Edm.Time":case"Edm.TimeOfDay":e.editStyle="TimePicker";return;case"Edm.DateTime":case"Edm.DateTimeOffset":e.editStyle="DateTimePicker";if(!i.annotations?.Common?.Timezone){e.showTimezone=undefined}else{e.showTimezone=true}return;case"Edm.Boolean":e.editStyle="CheckBox";return;case"Edm.Stream":e.editStyle="File";return;case"Edm.String":if(i.annotations?.UI?.MultiLineText?.valueOf()){e.editStyle="TextArea";return}if(i.annotations?.UI?.InputMask?.valueOf()){e.editStyle="InputMask";e.mask={mask:i.annotations?.UI?.InputMask?.Mask.toString(),placeholderSymbol:i.annotations?.UI?.InputMask?.PlaceholderSymbol.toString(),maskRule:te(i.annotations?.UI?.InputMask?.Rules)};return}if(i.annotations?.Common?.Masked?.valueOf()){e.editStyle="Masked";return}break;default:if(p(i)){e.staticDescription="%"}e.editStyle="Input"}e.editStyle="Input"};d.setEditStyleProperties=ee;const te=e=>{if(!e||e.length===0){return[{symbol:"*",regex:"[a-zA-Z0-9]"}]}return e.map(e=>({symbol:e.MaskSymbol.toString(),regex:e.RegExp.toString()}))};const ae=e=>{const t=e.targetObject;if(l.hasSemanticObject(t)){return true}const a=e?.navigationProperties?.length?e?.navigationProperties[e?.navigationProperties?.length-1]:null;if(!a||e.contextLocation?.navigationProperties?.find(e=>e.name===a.name)){return false}return l.hasSemanticObject(a)};d.hasSemanticObjectInNavigationOrProperty=ae;const ne=e=>{if(!e.targetObject){return undefined}if(h(e.targetObject)){return e}let t="";if(U(e,"com.sap.vocabularies.UI.v1.DataPoint")){e.targetObject.$Type=e.targetObject.$Type||"com.sap.vocabularies.UI.v1.DataPointType"}switch(e.targetObject.$Type){case"com.sap.vocabularies.UI.v1.DataField":case"com.sap.vocabularies.UI.v1.DataPointType":case"com.sap.vocabularies.UI.v1.DataFieldWithNavigationPath":case"com.sap.vocabularies.UI.v1.DataFieldWithUrl":case"com.sap.vocabularies.UI.v1.DataFieldWithIntentBasedNavigation":case"com.sap.vocabularies.UI.v1.DataFieldWithAction":if(typeof e.targetObject.Value==="object"){t=e.targetObject.Value.path}break;case"com.sap.vocabularies.UI.v1.DataFieldForAnnotation":if(e.targetObject.Target.$target){if(D(e.targetObject.Target.$target,["com.sap.vocabularies.UI.v1.DataPointType","com.sap.vocabularies.UI.v1.DataField"])){if(e.targetObject.Target.value.indexOf("/")>0){t=e.targetObject.Target.value.replace(/\/@.*/,`/${e.targetObject.Target.$target.Value?.path}`)}else{t=e.targetObject.Target.$target.Value?.path}}else{t=e.targetObject.Target?.path}}break;case"com.sap.vocabularies.UI.v1.DataFieldForAction":case"com.sap.vocabularies.UI.v1.DataFieldForIntentBasedNavigation":case"com.sap.vocabularies.UI.v1.DataFieldForActionGroup":case"com.sap.vocabularies.UI.v1.DataFieldWithActionGroup":break}if(t&&t.length>0){return I(e,t)}else{return undefined}};d.getDataModelObjectPathForValue=ne;const ie=e=>{const t=y(e,e=>e?.InsertRestrictions?.NonInsertableProperties);return t.some(t=>t?.$target?.fullyQualifiedName===e.targetObject?.fullyQualifiedName)};d.hasPropertyInsertRestrictions=ie;const oe=e=>e?A(C([$(e),x("semanticKeyHasDraftIndicator","internal"),x("HasDraftEntity"),x("IsActiveEntity"),x("hideDraftInfo","pageInternal")],"sap.fe.macros.field.FieldRuntime.isDraftIndicatorVisible")):"false";d.getDraftIndicatorVisibleBinding=oe;const re=e=>{const t=e.targetObject?.annotations?.UI?.IsImageURL?.annotations?.Common?.IsNaturalPerson||e.targetObject?.annotations?.UI?.IsImage?.annotations?.Common?.IsNaturalPerson;const a=e.targetEntityType.annotations?.Common?.IsNaturalPerson;let n;if(t){n=k(t)}else if(a){n=k(a)}else n=false;return A(S(n,u.Circle,u.Square))};d.getAvatarShape=re;return d},false);
//# sourceMappingURL=FieldTemplating.js.map