/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)
 *      (c) Copyright 2009-2025 SAP SE. All rights reserved
 */
sap.ui.define(["sap/base/Log","sap/fe/base/BindingToolkit","sap/fe/core/CommonUtils","sap/fe/core/converters/MetaModelConverter","sap/fe/core/converters/helpers/Key","sap/fe/core/helpers/BindingHelper","sap/fe/core/helpers/ModelHelper","sap/fe/core/helpers/StableIdHelper","sap/fe/core/templating/FieldControlHelper","sap/fe/core/templating/PropertyHelper","sap/fe/core/templating/UIFormatters","sap/fe/macros/CommonHelper","sap/fe/macros/internal/valuehelp/ValueListHelper","sap/ui/model/odata/v4/AnnotationHelper"],function(e,t,n,a,r,i,o,s,l,c,u,f,m,p){"use strict";var g=u.getAlignmentExpression;var d=c.hasValueListForValidation;var y=l.isRequiredExpression;var v=s.generate;var P=i.UI;var h=r.KeyHelper;var $=a.getInvolvedDataModelObjects;var b=t.pathInModel;var F=t.or;var D=t.ifElse;var T=t.getExpressionFromAnnotation;var O=t.formatResult;var I=t.equal;var A=t.constant;var V=t.compileExpression;const x="@Org.OData.Measures.V1.ISOCurrency",E="@Org.OData.Measures.V1.Unit";const C={getActionParameterVisibility:function(e,t){if(typeof e==="object"){const n=e;if(n&&n.$If&&n.$If.length===3){const e={$If:[]};e.$If[0]=n.$If[0];e.$If[1]=n.$If[2];e.$If[2]=n.$If[1];return p.value(e,t)}else{return"{= !%{"+e.$Path+"} }"}}else if(typeof e==="boolean"){return p.value(!e,t)}else{return undefined}},propertyName:function(e,t){let n;if(typeof e==="string"){if(t.context.getPath().includes("$Path")||t.context.getPath().includes("$PropertyPath")){n=e}}else if(e.$Path||e.$PropertyPath){const a=e.$Path?"/$Path":"/$PropertyPath";const r=t.context.getPath();n=t.context.getObject(`${r+a}/$@sapui.name`)}else if(e.Value&&e.Value.$Path){n=e.Value.$Path}else{n=t.context.getObject("@sapui.name")}return n},fieldControl:function(e,t){const n=t&&t.context.getModel();const a=t&&t.context.getPath();const r=n&&n.createBindingContext(`${a}@com.sap.vocabularies.Common.v1.FieldControl`);const i=r&&r.getProperty();if(i){if(i.hasOwnProperty("$EnumMember")){return i.$EnumMember}else if(i.hasOwnProperty("$Path")){return p.value(i,{context:r})}}else{return undefined}},valueHelpProperty:function(e,t){const n=e.getPath();const a=e.getObject()||{};let r=a.$Path?`${n}/$Path`:n;const i=`${r}@`;const o=e.getObject(i);let s;if(o){s=o.hasOwnProperty(x)&&x||o.hasOwnProperty(E)&&E;if(s&&!t){const t=`${r+s}/$Path`;if(e.getObject(t)){r=t}}}return r},valueHelpPropertyForFilterField:function(e){return C.valueHelpProperty(e,true)},getIDForFieldValueHelp:function(e,t,n,a){if(e){return e}let r=a;if(n!==a){r=`${n}::${a}`}return v([t,r])},getValueHelpPropertyForFilterField:function(e,t,a,r,i,o,s,l,c){const u=C.propertyName(t,{context:e}),m=c==="true"||c===true;const p=e.getModel(),g=e.getPath(),d=f.getLocationForPropertyPath(p,g),y=n.getFilterRestrictionsByPath(d,p);if((a==="Edm.DateTimeOffset"||a==="Edm.Date"||a==="Edm.TimeOfDay")&&m&&y&&y.FilterAllowedExpressions&&y.FilterAllowedExpressions[u]&&(y.FilterAllowedExpressions[u].includes("SingleRange")||y.FilterAllowedExpressions[u].includes("SingleValue"))||a==="Edm.Boolean"&&!l){return undefined}return C.getIDForFieldValueHelp(null,r||"FilterFieldValueHelp",o,s)},computeFieldBaseDelegate:function(e,t){if(t){return{name:e,payload:{retrieveTextFromValueList:t}}}return{name:e}},_getPrimaryIntents:async function(t,n){const a=[];const r=t.getShellServices();n.forEach(function(e){a.push(r.getPrimaryIntent(e))});return Promise.all(a).then(function(e){return e}).catch(function(t){e.error("Error fetching primary intents",t);return[]})},findPrimaryActionWithinIntents:function(e,t){const n=e.findIndex(e=>!!e);const a=e[n];const r=t.semanticObjects[n];return{semanticObjectWithPrimaryAction:r,primaryIntentFound:a}},_checkIfSemanticObjectsHasPrimaryAction:function(e,t,n){const a=function(e,t,n){for(const a in e.semanticObjectUnavailableActions[n].actions){if(t.intent.split("-")[1].indexOf(e.semanticObjectUnavailableActions[n].actions[a])===0){return false}}return true};e.semanticPrimaryActions=t;const{semanticObjectWithPrimaryAction:r,primaryIntentFound:i}=this.findPrimaryActionWithinIntents(t,e);const o=n.getShellServices().getHash();if(!!i&&i.intent.split("?")[0]!==o){for(let t=0;t<e.semanticObjectUnavailableActions.length;t++){if(e.semanticObjectUnavailableActions[t].semanticObject===r){return a(e,i,t)}}return true}return false},checkPrimaryActions:async function(t,n,a){return this._getPrimaryIntents(a,t&&t.semanticObjects).then(e=>n?{titleLink:e,hasTitleLink:this._checkIfSemanticObjectsHasPrimaryAction(t,e,a),payload:t}:this._checkIfSemanticObjectsHasPrimaryAction(t,e,a)).catch(function(t){e.error("Error in checkPrimaryActions",t)})},_getTitleLinkWithParameters:function(e,t){if(e&&e.titleLink){return e.titleLink}else{return t}},getPrimaryAction:function(e){const t=e.semanticPrimaryActions?.find(e=>!!e);return C._getTitleLinkWithParameters(e,t?.intent)},operators:function(e,t,a,r,i){if(!t||!i){return undefined}let s;const l=C.propertyName(t,{context:e});const c=e.getModel(),u=e.getPath(),m=f.getLocationForPropertyPath(c,u),p=t.$Type;if(p==="Edm.Guid"){return n.getOperatorsForGuidProperty()}i=i.slice(0,-1);const g=i.lastIndexOf("/")>0;const d=g&&i!==m||!g&&m.lastIndexOf("/")>0;const y=d&&m.substring(m.indexOf(i)+i.length+1)||"";const v=d&&y+"/"+l||l;if(!g){if(!d){s=f.getOperatorsForProperty(l,m,c,p,a,r)}else{s=f.getOperatorsForProperty(v,i,c,p,a,r);if(s.length===0){s=f.getOperatorsForProperty(l,m,c,p,a,r)}}}else if(!d){s=f.getOperatorsForProperty(v,i,c,p,a,r);if(s.length===0){s=f.getOperatorsForProperty(l,o.getEntitySetPath(i),c,p,a,r)}return s?.length>0?s.toString():undefined}else{s=f.getOperatorsForProperty(v,i,c,p,a,r);if(s.length===0){s=f.getOperatorsForProperty(v,o.getEntitySetPath(i),c,p,a,r)}}if((!s||s.length===0)&&(p==="Edm.Date"||p==="Edm.DateTimeOffset")){s=f.getOperatorsForDateProperty(p)}return s.length>0?s.toString():undefined},getDataFieldDefault:function(e){const t=e.getModel().getObject(`${e.getPath()}@com.sap.vocabularies.UI.v1.DataFieldDefault`);return t?`${e.getPath()}@com.sap.vocabularies.UI.v1.DataFieldDefault`:e.getPath()},isDataFieldActionButtonVisible:function(e,t,n){return e.annotations?.UI?.Hidden?.valueOf()!==true&&(t!==true||n!==false)},getPressEventForDataFieldActionButton:function(e,t){if(!t){return""}let n="Isolated";if(t.InvocationGrouping&&t.InvocationGrouping.$EnumMember==="com.sap.vocabularies.UI.v1.OperationGroupingType/ChangeSet"){n="ChangeSet"}let a=e.navigateAfterAction;a=a==="false"?false:true;const r=e?.contextPath?.getPath().split("/");const i=r[r.length-1];const o={contexts:"${$source>/}.getBindingContext()",invocationGrouping:f.addSingleQuotes(n),model:"${$source>/}.getModel()",label:typeof t?.Label==="string"?f.addSingleQuotes(t.Label,true):"",isNavigable:a,entitySetName:f.addSingleQuotes(i)};return f.generateFunction(".editFlow.invokeAction",f.addSingleQuotes(t.Action),f.objectToString(o))},isNumericDataType:function(e){const t=e;if(t!==undefined){const e=["Edm.Int16","Edm.Int32","Edm.Int64","Edm.Byte","Edm.SByte","Edm.Single","Edm.Decimal","Edm.Double"];return!e.includes(t)?false:true}else{return false}},isDateOrTimeDataType:function(e){if(e!==undefined){const t=["Edm.DateTimeOffset","Edm.DateTime","Edm.Date","Edm.TimeOfDay","Edm.Time"];return t.includes(e)}else{return false}},isDateTimeDataType:function(e){if(e!==undefined){const t=["Edm.DateTimeOffset","Edm.DateTime"];return t.includes(e)}else{return false}},isDateDataType:function(e){return e==="Edm.Date"},isTimeDataType:function(e){if(e!==undefined){const t=["Edm.TimeOfDay","Edm.Time"];return t.includes(e)}else{return false}},getDataTypeForVisualization:function(e,t){const n="@com.sap.vocabularies.Common.v1.Text",a="@com.sap.vocabularies.Common.v1.Text@com.sap.vocabularies.UI.v1.TextArrangement";return e?.[a]?.$EnumMember!=="com.sap.vocabularies.UI.v1.TextArrangementType/TextSeparate"&&e?.[n]?.$Path?"Edm.String":t},getColumnAlignment:function(e,t){const n=t.collection.getPath(),a=t.collection.getModel();if((e["$Type"]==="com.sap.vocabularies.UI.v1.DataFieldForAction"||e["$Type"]==="com.sap.vocabularies.UI.v1.DataFieldForIntentBasedNavigation")&&e.Inline&&e.IconUrl){return"Center"}const r=a.getObject(`${n}/@com.sap.vocabularies.Common.v1.SemanticKey`);if(e["$Type"]==="com.sap.vocabularies.UI.v1.DataField"){const t=e.Value.$Path;const n=r&&!r.every(function(e){return e.$PropertyPath!==t});if(n){return"Begin"}}return C.getDataFieldAlignment(e,a,n)},getPropertyAlignment:function(e,t,n){let a="Begin";const r=t?t.textAlignMode:"";if(r==="Form"){if(this.isNumericDataType(e)){a="Begin";if(n){a=g(n,"Begin","End")}}}else if(this.isNumericDataType(e)||this.isDateOrTimeDataType(e)){a="Right"}return a},getDataFieldAlignment:function(e,t,n,a,r){let i,o="Begin",s,l;if(e?.$Type==="com.sap.vocabularies.UI.v1.DataFieldForAnnotation"){i=e.Target?.$AnnotationPath;if(i&&i.includes("com.sap.vocabularies.UI.v1.FieldGroup")){const e=t.getObject(`${n}/${i}`);for(let c=0;c<e.Data.length;c++){s=t.getObject(`${n}/${i}/Data/${c.toString()}/Value/$Path/$Type`);l=t.getObject(`${n}/${i}/Data/${c.toString()}/Value/$Path@`);s=this.getDataTypeForVisualization(l,s);o=this.getPropertyAlignment(s,a,r);if(o==="Begin"){break}}return o}else if(i&&i.includes("com.sap.vocabularies.UI.v1.DataPoint")&&(t.getObject(`${n}/${i}/Visualization/$EnumMember`)==="com.sap.vocabularies.UI.v1.VisualizationType/Rating"||t.getObject(`${n}/${i}/Visualization/$EnumMember`)==="com.sap.vocabularies.UI.v1.VisualizationType/Progress")){return o}else{s=t.getObject(`${n}/${i}/$Type`);if(s==="com.sap.vocabularies.UI.v1.DataPointType"){s=t.getObject(`${n}/${i}/Value/$Path/$Type`);l=t.getObject(`${n}/${i}/Value/$Path@`);s=this.getDataTypeForVisualization(l,s)}o=this.getPropertyAlignment(s,a,r)}}else{i=e.Value?.$Path;s=t.getObject(`${n}/${i}/$Type`);l=t.getObject(`${n}/${i}@`);s=this.getDataTypeForVisualization(l,s);const c=t.getObject(`${n}/`)["$Key"];if(c&&c.indexOf(i)!==0){o=this.getPropertyAlignment(s,a,r)}}return o},isDataFieldActionButtonEnabled:function(e,t,n,a){if(t!==true){return"true"}return(n===null?"{= !${#"+e.Action+"} ? false : true }":n)?a:"true"},computeLabelText:function(e,t){const n=t.context.getModel();let a=t.context.getPath();if(a.endsWith("/")){a=a.slice(0,a.lastIndexOf("/"))}const r=n.getObject(`${a}/Label`);if(e.$Type==="com.sap.vocabularies.UI.v1.DataFieldForAction"||e.$Type==="com.sap.vocabularies.UI.v1.DataFieldForIntentBasedNavigation"){return undefined}if(r){return r}else if(r===""){return""}let i;if(e.$Type==="com.sap.vocabularies.UI.v1.DataFieldForAnnotation"){if(e?.Target?.$AnnotationPath.includes("@com.sap.vocabularies.UI.v1.DataPoint")||e?.Target?.$AnnotationPath.includes("@com.sap.vocabularies.UI.v1.Chart")){i=n.getObject(`${a}/Target/$AnnotationPath@/Title`)}if(e?.Target?.$AnnotationPath.includes("@com.sap.vocabularies.Communication.v1.Contact")){i=n.getObject(`${a}/Target/$AnnotationPath@/fn/$Path@com.sap.vocabularies.Common.v1.Label`)}}if(i){return i}let o;if(e.$Type==="com.sap.vocabularies.UI.v1.DataFieldForAnnotation"){o=n.getObject(`${a}/Target/$AnnotationPath@/Label`)}if(o){return o}const s=n.getObject(`${a}/Value/$Path@com.sap.vocabularies.Common.v1.Label`);if(s){return s}let l;if(e.$Type==="com.sap.vocabularies.UI.v1.DataFieldForAnnotation"){l=n.getObject(`${a}/Target/$AnnotationPath/Value/$Path@com.sap.vocabularies.Common.v1.Label`)}if(l){return l}return""},buildExpressionForAlignItems:function(e){const t=A(e);const n=A("com.sap.vocabularies.UI.v1.VisualizationType/Progress");const a=A("com.sap.vocabularies.UI.v1.VisualizationType/Rating");return V(D(F(I(t,n),I(t,a)),A("Center"),D(P.IsEditable,A("Center"),A("Stretch"))))},hasValueHelpAnnotation:function(e){if(e){return!!(e["@com.sap.vocabularies.Common.v1.ValueListReferences"]||e["@com.sap.vocabularies.Common.v1.ValueListMapping"]||e["@com.sap.vocabularies.Common.v1.ValueList"])}return false},getAPDialogDisplayFormat:async function(e,t){let a;const r=t.context.getModel();const i=t.context.getPath();const o=e.$Name||t.context.getProperty(`${i}@sapui.name`);const s=r.getObject(`${i}@`);const l=s["@com.sap.vocabularies.Common.v1.ValueList"]||s["@com.sap.vocabularies.Common.v1.ValueListMapping"]||s["@com.sap.vocabularies.Common.v1.ValueListReferences"];const c=function(e){const t=e.Parameters.find(function(e){return e.LocalDataProperty&&e.LocalDataProperty.$PropertyPath===o});return t&&t.ValueListProperty};let u;if(s["@com.sap.vocabularies.Common.v1.TextArrangement"]||s["@com.sap.vocabularies.Common.v1.Text@com.sap.vocabularies.UI.v1.TextArrangement"]){return n.computeDisplayMode(s,undefined)}else if(l){if(l.CollectionPath){u=c(l);if(!u){return"Value"}a=r.getObject(`/${l.CollectionPath}/${u}@`);return a&&a["@com.sap.vocabularies.Common.v1.Text"]?n.computeDisplayMode(a,undefined):"Value"}else{return r.requestValueListInfo(i,true).then(function(e){const t=C.getValueListQuliferForParameterDisplayFormat(r,i,e);u=c(e[t]);if(!u){return"Value"}a=e[t].$model.getMetaModel().getObject(`/${e[t]["CollectionPath"]}/${u}@`);return a&&a["@com.sap.vocabularies.Common.v1.Text"]?n.computeDisplayMode(a,undefined):"Value"})}}else{return"Value"}},getValueListQuliferForParameterDisplayFormat:function(t,n,a){const r=m.putDefaultQualifierFirst(Object.keys(a));let i=r[0];try{const e=t.createBindingContext(`${n}`);const a=$(e).targetObject;const r=d(a);i=r?V(T(a.annotations?.Common?.ValueListForValidation))??"":i}catch(t){e.warning(`Couldn't finding qualifer for value list of action parameter ${n}`)}return i},getActionParameterDialogValueHelp:function(e,t,n){return this.hasValueHelpAnnotation(e)?v([t,n]):undefined},getValueHelpDelegate:function(e,t,n,a){const r={name:f.addSingleQuotes("sap/fe/macros/valuehelp/ValueHelpDelegate"),payload:{propertyPath:f.addSingleQuotes(m.getPropertyPath({UnboundAction:!e,EntityTypePath:t,Action:n,Property:a})),qualifiers:{},valueHelpQualifier:f.addSingleQuotes(""),isActionParameterDialog:true}};return f.objectToString(r)},getValueHelpDelegateForNonComputedVisibleKeyField:function(e){const t={name:f.addSingleQuotes("sap/fe/macros/valuehelp/ValueHelpDelegate"),payload:{propertyPath:f.addSingleQuotes(e),qualifiers:{},valueHelpQualifier:f.addSingleQuotes("")}};return f.objectToString(t)},_getEntitySetFromMultiLevel:function(e,t,n,a,r){let i=t.split("/").filter(Boolean);i=i.filter(function(e){return e!=="$NavigationPropertyBinding"});if(i.length>0){for(let t=a;t<i.length-r;t++){n="/"+e.getObject(`${n}/$NavigationPropertyBinding/${i[t]}`)}}return n},getPathForIconSource:function(e){return V(O([b(`${e}@odata.mediaContentType`)],"._formatters.ValueFormatter#getIconForMimeType"))},getFilenameExpr:function(e,t){if(e){if(e.indexOf("{")===0){return"{= $"+e+" ? $"+e+" : $"+t+"}"}return e}return t},calculateMBfromByte:function(e){return e?(e/(1024*1024)).toFixed(6):undefined},getDownloadUrl:function(e){return e+"{= ${internal>/stickySessionToken} ? ('?SAP-ContextId=' + ${internal>/stickySessionToken}) : '' }"},getMarginClass:function(e){return e==="true"||e===true?"sapMTableContentMargin":undefined},getRequired:function(e,t,n){let a=A(false);if(t!==null){a=y(t?.targetObject)}return V(F(a,n.includes(e)))},isFieldPartOfForm:function(e,t){const n=h.generateKeyFromDataField(t.targetObject);const a=e.find(e=>e.key===n);return a?true:false}};C.fieldControl.requiresIContext=true;C.getAPDialogDisplayFormat.requiresIContext=true;C.computeLabelText.requiresIContext=true;C.getActionParameterVisibility.requiresIContext=true;return C},false);
//# sourceMappingURL=FieldHelper.js.map