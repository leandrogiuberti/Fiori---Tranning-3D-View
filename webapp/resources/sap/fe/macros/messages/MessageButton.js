/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)
 *      (c) Copyright 2009-2025 SAP SE. All rights reserved
 */
sap.ui.define(["sap/base/Log","sap/fe/base/ClassSupport","sap/fe/core/CommonUtils","sap/fe/core/controllerextensions/messageHandler/messageHandling","sap/fe/core/helpers/ResourceModelHelper","sap/fe/macros/messages/MessagePopover","sap/m/Button","sap/m/ColumnListItem","sap/m/FormattedText","sap/m/library","sap/ui/core/CustomData","sap/ui/core/Element","sap/ui/core/Lib","sap/ui/core/Messaging","sap/ui/core/message/MessageType","sap/ui/core/mvc/View","sap/ui/model/Filter","sap/ui/model/FilterOperator","sap/ui/model/Sorter","sap/ui/thirdparty/jquery","./MessageButtonHelper"],function(e,t,n,i,o,s,r,a,g,l,c,u,f,d,h,p,T,b,_,jQuery,m){"use strict";var E,C,I,S,P,M,y;var A=l.ButtonType;var O=o.getResourceModel;var x=t.event;var R=t.defineUI5Class;var w=t.aggregation;function B(e,t,n,i){n&&Object.defineProperty(e,t,{enumerable:n.enumerable,configurable:n.configurable,writable:n.writable,value:n.initializer?n.initializer.call(i):void 0})}function G(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e,v(e,t)}function v(e,t){return v=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},v(e,t)}function L(e,t,n,i,o){var s={};return Object.keys(i).forEach(function(e){s[e]=i[e]}),s.enumerable=!!s.enumerable,s.configurable=!!s.configurable,("value"in s||s.initializer)&&(s.writable=!0),s=n.slice().reverse().reduce(function(n,i){return i(e,t,n)||n},s),o&&void 0!==s.initializer&&(s.value=s.initializer?s.initializer.call(o):void 0,s.initializer=void 0),void 0===s.initializer?(Object.defineProperty(e,t,s),null):s}function N(e,t){throw Error("Decorating class property failed. Please ensure that transform-class-properties is enabled and runs after the decorators transform.")}let F=(E=R("sap.fe.macros.messages.MessageButton"),C=w({type:"sap.fe.macros.messages.MessageFilter",multiple:true,singularName:"customFilter"}),I=x(),E(S=(P=function(t){function o(e,n){var i;i=t.call(this,e,n)||this;B(i,"customFilters",M,i);B(i,"messageChange",y,i);i.sGeneralGroupText="";i.sViewId="";i.sLastActionText="";return i}G(o,t);var l=o.prototype;l.init=function e(){r.prototype.init.apply(this);this.isHiddenDraftEnabled=n.getAppComponent(this)?.getEnvironmentCapabilities()?.getCapabilities()?.HiddenDraft?.enabled;this.attachPress(this.handleMessagePopoverPress,this);this.oMessagePopover=new s;this.oItemBinding=this.oMessagePopover.getBinding("items");this.oItemBinding.attachChange(this._setMessageData,this);const t=this.getId();if(t){this.oMessagePopover.addCustomData(new c({key:"messageButtonId",value:t}))}this.attachModelContextChange(this._applyFiltersAndSort.bind(this));this.oMessagePopover.attachActiveTitlePress(this._activeTitlePress.bind(this))};l.handleMessagePopoverPress=function e(t){this.oMessagePopover.toggle(t.getSource())};l._applyGroupingAsync=async function t(n){const o=[];const s=n.getBindingContext();const r=e=>{const t=[];const n=this.oItemBinding.getContexts().map(function(e){return e.getObject()});const o=e.getBindingContext();if(o){const s=e.getContent()[0];i.getVisibleSectionsFromObjectPageLayout(s).forEach(function(e){e.getSubSections().forEach(function(e){e.findElements(true).forEach(function(i){if(i.isA("sap.ui.mdc.Table")){for(let s=0;s<n.length;s++){const r=i.getRowBinding();if(r){const r=`${o.getPath()}/${i.getRowBinding().getPath()}`;if(n[s].target.indexOf(r)===0){t.push({table:i,subsection:e});break}}}}})})})}return t};const a=r.bind(this)(n);a.forEach(function(e){const t=e.table,n=e.subsection;if(!t.getBindingContext()||t.getBindingContext()?.getPath()!==s?.getPath()){n.setBindingContext(s);if(!t.getRowBinding().isLengthFinal()){o.push(new Promise(function(e){t.getRowBinding().attachEventOnce("dataReceived",function(){e()})}))}}});const g=new Promise(e=>{setTimeout(()=>{this._applyGrouping();e()},0)});try{await Promise.all(o);n.getModel().checkMessages();await g}catch(t){e.error("Error while grouping the messages in the messagePopOver")}};l._applyGrouping=function e(){this.oObjectPageLayout=this._getObjectPageLayout(this,this.oObjectPageLayout);if(!this.oObjectPageLayout){return}const t=this.oMessagePopover.getItems();const n=i.getVisibleSectionsFromObjectPageLayout(this.oObjectPageLayout);const o=this._checkControlIdInSections(t,false);if(o){this._fnEnableBindings(n)}const s=this._getViewId(this.getId());const r=u.getElementById(s);const a=r?.getModel("internal");a?.setProperty("/messageTargetPropertyPath",undefined)};l._getTableRefErrorContext=function e(t){const n=t.getModel("internal");if(!t.getBindingContext("internal")?.getProperty("refError")){n.setProperty("refError",{},t.getBindingContext("internal"))}const i=t.getBindingContext("internal")?.getPath()+"/refError/"+t.getBindingContext()?.getPath().replace("/","$")+"$"+t.getRowBinding().getPath().replace("/","$");const o=n.getContext(i);if(!o.getProperty("")){n.setProperty("",{},o)}return o};l._updateInternalModel=function e(t,n,i,o,s,r){let a;if(r){a={rowIndex:"CreationRow",targetColProperty:i?i:""}}else{a={rowIndex:t?n:"",targetColProperty:i?i:""}}const g=o.getModel("internal"),l=this._getTableRefErrorContext(o);const c=d.getMessageModel().getData().map(function(e){return e.getId()});let u;if(l?.getProperty("")){u=Object.keys(l?.getProperty("")).filter(function(e){return c.indexOf(e)===-1});u.forEach(function(e){delete l?.getProperty("")[e]})}g?.setProperty(s.getId(),Object.assign({},l?.getProperty(s.getId())?l.getProperty(s.getId()):{},a),l)};l._setGroupLabelForTransientMsg=function e(t,n){this.sLastActionText=this.sLastActionText?this.sLastActionText:f.getResourceBundleFor("sap.fe.core").getText("T_MESSAGE_BUTTON_SAPFE_MESSAGE_GROUP_LAST_ACTION");t.setGroupName(`${this.sLastActionText}: ${n}`)};l._computeMessageGroupAndSubTitle=function e(t,n,o,s,r,a){const g=O(n);this.oItemBinding.detachChange(this._setMessageData,this);const l=t.getBindingContext("message")?.getObject();const c=true;let f,d,h={},p,T,b,_;const m=new RegExp("^/").test(l?.getTargets()[0]);if(m){for(p=0;p<s.length;p++){f=s[p];b=f;if(f.isA("sap.m.Table")||f.isA("sap.ui.table.Table")){d=f.getParent();const e=d.getRowBinding();const n=()=>{this._setGroupLabelForTransientMsg(t,a)};if(e&&e.isLengthFinal()&&d.getBindingContext()){const o=i.getTableColumnDataAndSetSubtile(l,d,f,e,a,c,n);h=o.oTargetTableInfo;if(o.subTitle){t.setSubtitle(o.subTitle)}t.setActiveTitle(!!h.oTableRowContext&&!h.oTableRowContext?.isInactive()&&h.oTableRowContext.getPath()!==t.getBindingContext("message")?.getProperty("target").replace(/\/$/,""));if(h.oTableRowContext&&!h.oTableRowContext.isInactive()){this._formatMessageDescription(t,h.oTableRowContext,h.sTableTargetColName,d)}T=h.oTableRowContext&&h.oTableRowContext.getIndex();this._updateInternalModel(h.oTableRowContext,T,h.sTableTargetColProperty,d,l)}}else{t.setActiveTitle(true);if(t.getSubtitle()===""){let e;let n=b.getParent();while(n){if(n&&n.isA("sap.ui.layout.form.FormElement")){e=n;break}n=n.getParent()}if(e){const n=e.getLabel();let i="";if(typeof n==="string"){i=n}else{i=n.getText()}t.setSubtitle(i)}}const e=i.bIsOrphanElement(b,s);if(e){break}}}}else{b=s[0];d=this._getMdcTable(b);h={};if(d){h.tableHeader=d.getHeader();const e=this._getTableColumnIndex(b);h.sTableTargetColProperty=e!==undefined&&e>-1?d.getColumns()[e].getPropertyKey():undefined;h.sTableTargetColName=h.sTableTargetColProperty&&e!==undefined&&e>-1?d.getColumns()[e].getHeader():undefined;_=this._getTableRow(b)?.isA("sap.ui.table.CreationRow")??false;if(!_){T=this._getTableRowIndex(b);h.oTableRowBindingContexts=d.getRowBinding().getCurrentContexts();h.oTableRowContext=T!==undefined?h.oTableRowBindingContexts[T]:undefined}const n=i.getMessageSubtitle(l,h.oTableRowBindingContexts,h.oTableRowContext,h.sTableTargetColName,d,_,e===0&&b.getValueState()==="Error"?b:undefined);if(n){t.setSubtitle(n)}t.setActiveTitle(!!h.oTableRowContext);if(h.oTableRowContext){this._formatMessageDescription(t,h.oTableRowContext,h.sTableTargetColName,d)}this._updateInternalModel(h.oTableRowContext,T,h.sTableTargetColProperty,d,l,_)}}if(c){const e=this._checkMergeLogicForMessageGrouping(n,o,r);const s=i.createSectionGroupName(n,o,r,h,g,e);t.setGroupName(s);const a=u.getElementById(this._getViewId(this.getId()));const c=a?.getBindingContext()?.getPath();const f=l.getTargets()[0]?.split("/").pop();const d=a?.getModel("internal");const p=d?.getProperty("/messageTargetPropertyPath");const T=p?.substring(0,p.lastIndexOf("/"));if(T&&f&&c&&f===p.split("/").pop()&&c.length>=T.length&&c.startsWith(T)){this.oMessagePopover.fireActiveTitlePress({item:t});d.setProperty("/messageTargetPropertyPath",false)}}this.oItemBinding.attachChange(this._setMessageData,this);return b};l._checkMergeLogicForMessageGrouping=function e(t,n,i){const o=this._getViewId(this.getId());const s=o?u.getElementById(o):undefined;let r=true;const a=!i&&s?.getViewData()?.sectionLayout==="Page";const g=i&&s?.getViewData()?.sectionLayout==="Tabs";if(a){const e=n.getBlocks();const t=e.length===1?e[0].getAggregation("content"):undefined;if(t?.isA("sap.fe.macros.table.TableAPI")){r=false}}else if(g){let e;const t=n.getBlocks();if(t.length===1&&t[0]?.isA("sap.fe.templates.ObjectPage.controls.SubSectionBlock")){e=t[0].getAggregation("content");if(e?.isA("sap.fe.macros.table.TableAPI")){r=false}else if(e?.isA("sap.ui.layout.DynamicSideContent")){e=e.getMainContent instanceof Function&&e?.getMainContent();if(e&&e.length===1&&e[0]?.isA("sap.fe.macros.table.TableAPI")){r=false}}}}return r};l._checkControlIdInSections=function e(t,n){let o,s,r,a,g,l;this.sGeneralGroupText=this.sGeneralGroupText?this.sGeneralGroupText:f.getResourceBundleFor("sap.fe.core").getText("T_MESSAGE_BUTTON_SAPFE_MESSAGE_GROUP_GENERAL");const c=i.getVisibleSectionsFromObjectPageLayout(this.oObjectPageLayout);if(c){const e=this._getViewId(this.getId());const f=e?u.getElementById(e):undefined;const d=f?.getBindingContext("internal")?.getProperty("sActionName");if(d){(f?.getBindingContext("internal")).setProperty("sActionName",null)}for(a=t.length-1;a>=0;--a){r=t[a];let e=true;for(g=c.length-1;g>=0;--g){let t=false;o=c[g];s=o.getSubSections();for(l=s.length-1;l>=0;--l){const n=s[l];const a=r?.getBindingContext("message")?.getObject();this.sGeneralGroupText=this._getGeneralGroupText(f,a);const g=i.getControlFromMessageRelatingToSubSection(n,a);if(g.length>0){const i=this._computeMessageGroupAndSubTitle(r,o,n,g,s.length>1,d);e=false;if(i&&!i.isA("sap.m.Table")&&!i.isA("sap.ui.table.Table")){t=true;break}}}if(t){break}}if(e){const e=r.getBindingContext("message")?.getObject();if(this.isHiddenDraftEnabled){r.setActiveTitle(true)}else{r.setActiveTitle(false)}if(e.persistent&&d){this._setGroupLabelForTransientMsg(r,d)}else{r.setGroupName(this.sGeneralGroupText)}}if(!n&&r.getGroupName()===this.sGeneralGroupText&&this._findTargetForMessage(r)){return true}}}};l._getGeneralGroupText=function e(t,n){const i=t?.getBindingContext()?.getPath();const o=n?.getTargets()[0];if(this.isHiddenDraftEnabled&&i&&!o.includes(i)){return f.getResourceBundleFor("sap.fe.core").getText("T_MESSAGE_BUTTON_SAPFE_MESSAGE_GROUP_OTHER_PAGES")}else{return f.getResourceBundleFor("sap.fe.core").getText("T_MESSAGE_BUTTON_SAPFE_MESSAGE_GROUP_GENERAL")}};l._findTargetForMessage=function e(t){const n=t.getBindingContext("message")&&t.getBindingContext("message")?.getObject();if(n&&n.target){const e=this.oObjectPageLayout?.getModel()?.getMetaModel(),t=e&&e.getMetaPath(n.target),i=e&&e.getObject(t);if(i&&i.$kind==="Property"){return true}}return false};l._fnEnableSubSectionBinding=function e(t){t.getBlocks().forEach(e=>e.setBindingContext(undefined));t.getMoreBlocks().forEach(e=>e.setBindingContext(undefined));t.getActions().forEach(e=>e.setBindingContext(undefined))};l._fnEnableBindings=function e(t){for(let e=0;e<t.length;e++){const n=t[e];const i=n.getSubSections();for(let e=0;e<i.length;e++){const t=i[e];const n=t.getBlocks();if(n){this._fnEnableSubSectionBinding(t)}if(t.getBindingContext()){this._findMessageGroupAfterRebinding();t.getBindingContext().getBinding().attachDataReceived(this._findMessageGroupAfterRebinding.bind(this))}}}};l._findMessageGroupAfterRebinding=function e(){const t=this.oMessagePopover.getItems();this._checkControlIdInSections(t,true)};l._getViewId=function e(t){let n,i=u.getElementById(t);while(i){if(i instanceof p){n=i.getId();break}i=i.getParent()}return n};l._setLongtextUrlDescription=function t(n){this.oMessagePopover.setAsyncDescriptionHandler(function(t){const i=t.item.getLongtextUrl();if(i){jQuery.ajax({type:"GET",url:i,success:function(e){const i=n.getHtmlText()+e;const o=t.item.getDescription()??"";t.item.setDescription(`${o}${i}`);t.promise.resolve()},error:function(){const n=`A request has failed for long text data. URL: ${i}`;e.error(n);t.promise.reject(n)}})}})};l.processTableColumnProperties=function e(t,n,o){let s="";const r=i.getTableColBindingContextForTextAnnotation(t,n,o);const a=r?r.getObject("$Path"):undefined;const g=a&&r?r.getObject("@com.sap.vocabularies.UI.v1.TextArrangement/$EnumMember"):undefined;const l=t.getParent()?.getTableColValue(n,a,g,o);s+=`${l}`;return s};l.computeColumnInfo=function e(t,n,o,s){const r=O(s);const a=t.getBindingContext("message")?.getObject();const g=i.fetchColumnInfo(a,s);let l="";if(n){l=`${r.getText("T_MESSAGE_GROUP_DESCRIPTION_TABLE_COLUMN")}: ${n}`}else if(g){if(g.availability==="Hidden"){if(t.getType()==="Error"){l=o.length>0?`${r.getText("T_COLUMN_AVAILABLE_DIAGNOSIS_MSGDESC_ERROR")} ${o.join(", ")}`+".":`${r.getText("T_COLUMN_AVAILABLE_DIAGNOSIS_MSGDESC_ERROR")}`+"."}else{l=o.length>0?`${r.getText("T_COLUMN_AVAILABLE_DIAGNOSIS_MSGDESC")} ${o.join(", ")}`+".":`${r.getText("T_COLUMN_AVAILABLE_DIAGNOSIS_MSGDESC")}`+"."}}else{if(!this._navigationConfigured(s)){t.setActiveTitle(false)}l=`${r.getText("T_MESSAGE_GROUP_DESCRIPTION_TABLE_COLUMN")}: ${g.label} (${r.getText("T_COLUMN_INDICATOR_IN_TABLE_DEFINITION")})`}}return l};l._formatMessageDescription=function e(t,n,i,o){const s=O(o);const r=o.getParent()?.getTableColumnVisibilityInfo(n);const a=[];r?.forEach(e=>{let{key:t,visibility:i}=e;a.push(this.processTableColumnProperties(o,n,[{key:t,visibility:i}]))});const l=this.computeColumnInfo(t,i,a,o);const c=new g({htmlText:`<html><body><strong>${s.getText("T_FIELDS_AFFECTED_TITLE")}</strong></body></html><br>`});let u;if(Array.isArray(a)&&a.length>0){if(a.length===1){u=`${c.getHtmlText()}<br>${s.getText("T_MESSAGE_GROUP_TITLE_TABLE_DENOMINATOR")}: ${o.getHeader()}<br>${s.getText("T_MESSAGE_GROUP_DESCRIPTION_TABLE_ROW")}: ${a}<br>${l}<br>`}else{u=`${c.getHtmlText()}<br>${s.getText("T_MESSAGE_GROUP_TITLE_TABLE_DENOMINATOR")}: ${o.getHeader()}<br>${s.getText("T_MESSAGE_GROUP_DESCRIPTION_TABLE_ROW")}:<br>&emsp; ${a.join("<br>&emsp; ")}<br>${l}<br>`}}else if(l==""||!l){u=""}else{u=`${c.getHtmlText()}<br>${s.getText("T_MESSAGE_GROUP_TITLE_TABLE_DENOMINATOR")}: ${o.getHeader()}<br>${l}<br>`}const f=new g({htmlText:`<html><body><strong>${s.getText("T_DIAGNOSIS_TITLE")}</strong></body></html><br>`});const d=t.getBindingContext("message")?.getObject().description;t.setDescription(undefined);let h="";let p="";if(t.getLongtextUrl()){p=u?`${u}<br>`:"";t.setDescription(p);this._setLongtextUrlDescription(f)}else if(d){h=`${f.getHtmlText()}<br>${d}`;p=`${u}<br>${h}`;t.setDescription(p)}else{t.setDescription(u)}};l.handleNoMessages=function e(){this.setVisible(false);this.fireEvent("messageChange",{iMessageLength:0})};l._setMessageData=function t(){clearTimeout(this._setMessageDataTimeout);this._setMessageDataTimeout=setTimeout(async()=>{const t="",n=this.oMessagePopover.getItems(),i={Error:0,Warning:0,Success:0,Information:0},o=f.getResourceBundleFor("sap.fe.core"),s=n.length;let r=A.Default,a="",g="";if(s>0){for(let e=0;e<s;e++){if(!n[e].getType()||n[e].getType().toString()===""){++i["Information"]}else{++i[n[e].getType()]}}if(i[h.Error]>0){r=A.Negative}else if(i[h.Warning]>0){r=A.Critical}else if(i[h.Success]>0){r=A.Success}else if(i[h.Information]>0){r=A.Neutral}const l=i[h.Error]+i[h.Warning]+i[h.Success]+i[h.Information];this.setText(l.toString());let c=0;const f={Error:{singleTooltipKey:"C_COMMON_SAPFE_ERROR_MESSAGES_PAGE_TITLE_ERROR",multipleTooltipKey:"C_COMMON_SAPFE_ERROR_MESSAGES_PAGE_MULTIPLE_ERROR_TOOLTIP"},Warning:{singleTooltipKey:"C_MESSAGE_HANDLING_SAPFE_ERROR_MESSAGES_PAGE_TITLE_WARNING",multipleTooltipKey:"C_COMMON_SAPFE_ERROR_MESSAGES_PAGE_WARNING_TOOLTIP"},Information:{singleTooltipKey:"C_MESSAGE_HANDLING_SAPFE_ERROR_MESSAGES_PAGE_TITLE_INFO",multipleTooltipKey:"C_MESSAGE_HANDLING_SAPFE_ERROR_MESSAGES_PAGE_TITLE_INFO"},Success:{singleTooltipKey:"C_MESSAGE_HANDLING_SAPFE_ERROR_MESSAGES_PAGE_TITLE_SUCCESS",multipleTooltipKey:"C_MESSAGE_HANDLING_SAPFE_ERROR_MESSAGES_PAGE_MULTIPLE_SUCCESS_TOOLTIP"}};for(const[e,t]of Object.entries(f)){const n=e;const o=i[n];if(o>1){c=o;a=t.multipleTooltipKey;break}else if(o===1){c=o;a=t.singleTooltipKey;break}}if(a){g=o.getText(a);const e="Ctrl+Shift+M";const t=`${o.getText("C_COMMON_SAPFE_ERROR_MESSAGES_PAGE_TOOLTIP")}: ${c} ${g} (${e})`;this.setTooltip(t)}this.setIcon(t);this.setType(r);this.setVisible(true);const d=u.getElementById(this.sViewId);if(d){const t=d.getController().pageReady;try{await t.waitPageReady();await this._applyGroupingAsync(d)}catch(t){e.error("fail grouping messages")}this.fireEvent("messageChange",{iMessageLength:s})}if(s>1){this.oMessagePopover.navigateBack()}}else{this.handleNoMessages()}},100)};l._activeTitlePress=async function t(n){const o=this.getBindingContext("pageInternal");o.setProperty("errorNavigationSectionFlag",true);const s=n.getParameter("item"),r=s?.getBindingContext("message")?.getObject(),a=new RegExp("^/").test(r.getTargets()[0]),g=u.getElementById(this.sViewId);if(!s){return}let l,c;const f=function(e,t){const n={preventScroll:true,targetInfo:e};t.focus(n)};let d=true;let h,p,T,b,_,m;const E=i.getVisibleSectionsFromObjectPageLayout(this.oObjectPageLayout);if(E){const e=this.oMessagePopover.getItems();for(b=e.length-1;b>=0;--b){T=e[b];for(_=E.length-1;_>=0;--_){h=E[_];p=h.getSubSections();for(m=p.length-1;m>=0;--m){const e=p[m];const t=T?.getBindingContext("message")?.getObject();const n=i.getControlFromMessageRelatingToSubSection(e,t);if(n.length>0){d=false}}}}}const C=r.controlIds.map(e=>{const t=u.getElementById(e);const n=t&&t.getParent();if(this.isHiddenDraftEnabled){return n?.isA("sap.ui.mdc.Table")?n:undefined}return n&&n.isA("sap.ui.mdc.Table")&&s.getGroupName().includes(n.getHeader())?n:null}).reduce(function(e,t){return t?t:e});if(C){if(a){c=s.getGroupName().split(", ")[0];try{if(this.isHiddenDraftEnabled&&(C.getId()!==this.sViewId||d)){const e=this._getViewId(C.getId());u.getElementById(e).getController()._routing.navigateToContext(C.getBindingContext())}else{await this._navigateFromMessageToSectionTableInIconTabBarMode(C,this.oObjectPageLayout,c)}const t=this._getTableRefErrorContext(C);const n=t?.getProperty(s.getBindingContext("message")?.getObject().getId());const i=async(e,t)=>{const n=this._getMdcTableRows(e),i=this._getGridTable(e)?.getFirstVisibleRow()??0;if(n.length>0&&n[0]){const o=n[t-i],s=this.getTargetCell(o,r);if(s){this.setFocusToControl(s);return undefined}else{const t=r.getTargets()[0];if(t){g.getModel("internal").setProperty("/messageTargetPropertyPath",t)}if(this._navigationConfigured(e)){return g.getController()._routing.navigateForwardToContext(o.getBindingContext())}else{return false}}}return undefined};if(C.data("tableType")==="GridTable"&&n.rowIndex!==""){try{await C.scrollToIndex(n.rowIndex);setTimeout(async function(){const e=await i(C,n.rowIndex);if(e===false){f(r,C)}},0)}catch(t){e.error("Error while focusing on error")}}else if(C.data("tableType")==="ResponsiveTable"&&n){const e=await this.focusOnMessageTargetControl(g,r,C,n.rowIndex);if(e===false){f(r,C)}}else{this.focusOnMessageTargetControl(g,r)}}catch(t){e.error("Fail to navigate to Error control")}}else{l=u.getElementById(r.controlIds[0]);if(l){const e=this.oObjectPageLayout.getSections();const t=e.find(e=>e.findElements(true).includes(l));if(t){c=s.getGroupName().split(", ")[0];this._navigateFromMessageToSectionInIconTabBarMode(this.oObjectPageLayout,c)}}this.setFocusToControl(l)}}else{this.handleMessageNavigation(s,E,r,g)}};l.handleMessageNavigation=function e(t,n,i,o){const s=u.getElementById(i.getControlIds()[0]);const r=this.findSubSection(t,n,s);if(r){r.setMode("Expanded")}const a=t.getGroupName().split(", ")[0];this._navigateFromMessageToSectionInIconTabBarMode(this.oObjectPageLayout,a);this.focusOnMessageTargetControl(o,i)};l.findSubSection=function e(t,n,i){const o=t.getGroupName().split(", ");return this.findSubSectionByTitleOrControl(n,o[1],i)};l.findSubSectionByTitleOrControl=function e(t,n,i){for(const e of t){for(const t of e.getSubSections()){if(t.getTitle()===n){return t}if(t.getMoreBlocks().some(e=>e.getContent()?.findElements(true).includes(i))){return t}}}return null};l.getTargetCell=function e(t,n){const i=n.getControlIds();const o=i.some(e=>{const t=u.getElementById(e);return t?.isA("sap.ui.mdc.Field")&&t.getEditable&&!t.getEditable()});return i.length>0?i.map(function(e){const n=t.findElements(true,function(t){return t.getId()===e});if(n.length>0){const t=u.getElementById(e);if(o){if(t?.isA("sap.ui.mdc.Field")){if(t.getEditable&&!t.getEditable()){return null}return t}}else{return t}}return null}).reduce(function(e,t){return t?t:e},null):null};l.focusOnMessageTargetControl=async function e(t,n,i,o){const s=t.findElements(true);const r=n.getControlIds().filter(function(e){return s.some(function(t){return t.getId()===e&&t.getDomRef()})}).map(function(e){return u.getElementById(e)});const g=r.filter(function(e){return!e?.isA("sap.m.Table")&&!e?.isA("sap.ui.table.Table")});if(g.length>0){this.setFocusToControl(g[0]);return undefined}else if(r.length>0){const e=i?i.findElements(true,e=>e.isA(a.getMetadata().getName())&&e.getParent()?.getParent()===i):[];if(e.length>0&&e[0]){const s=e[o];const r=this.getTargetCell(s,n);if(r){const e=r.isA("sap.fe.macros.Field")?r.getContent().getContentEdit()[0]:r.getItems()[0].getContent().getContentEdit()[0];this.setFocusToControl(e);return undefined}else{const e=n.getTargets()[0];if(e){t.getModel("internal").setProperty("/messageTargetPropertyPath",e)}if(i&&this._navigationConfigured(i)){return t.getController()._routing.navigateForwardToContext(s.getBindingContext())}else{return false}}}return undefined}return undefined};l._getMessageRank=function e(t,n){if(n){let e,i,o,s,r,a,g,l;for(s=n.length-1;s>=0;--s){e=n[s];i=e.getSubSections();for(r=i.length-1;r>=0;--r){o=i[r];g=o.findElements(true);a=g.filter(this._fnFilterUponId.bind(this,t.getControlId()));l=s+1;if(a.length>0){if(e.getVisible()&&o.getVisible()){if(!t.hasOwnProperty("sectionName")){t.sectionName=e.getTitle()}if(!t.hasOwnProperty("subSectionName")){t.subSectionName=o.getTitle()}return l*10+(r+1)}else{return 1}}}}if(!t.sectionName&&!t.subSectionName&&t.getPersistent()){return 1}return 999}return 999};l._filterOutMessagesInDialog=function e(){const t=e=>i.isMessageOutOfParameterDialog(e);return new T({path:"controlIds",test:t,caseSensitive:true})};l._filterOutContextSuccessMessages=function e(){const t=[];const n=d.getMessageModel().getData();n.filter(e=>{if(e.getTargets().length===1&&e.getTargets()[0]===this.getBindingContext()?.getPath()&&e.getPersistent()===true&&e.getType()===h.Success){t.push(e)}});if(t.length===1&&n.length===1){return false}return true};l._getFilterToHideBackendMessageOnErrorValidation=function e(){const t=function(){return d.getMessageModel().getData().filter(e=>e.validation===true&&e.getControlId()?.match(/field.*-inner$/i)).map(e=>e.getControlId()?.replace("-inner",""))};const n=function(e){return!e.some(e=>t().includes(e))};return new T({filters:[new T({filters:[new T({path:"validation",operator:b.EQ,value1:false}),new T({path:"controlIds",test:n,caseSensitive:true})],and:true}),new T({path:"validation",operator:b.EQ,value1:true})],and:false})};l._applyFiltersAndSort=async function e(){let t,n,i,o,s,r,a,g;const l=[];this.sViewId=this.sViewId?this.sViewId:this._getViewId(this.getId());const c=this.getAggregation("customFilters");if(c){c.forEach(function(e){l.push(new T({path:e.getProperty("path"),operator:e.getProperty("operator"),value1:e.getProperty("value1"),value2:e.getProperty("value2")}))})}const f=this.getBindingContext();if(!f){this.setVisible(false);return}else{s=f.getPath();t=new T({filters:[new T({path:"validation",operator:b.EQ,value1:true}),m.getCheckControlInViewFilter(this.sViewId)],and:true});a=new T({filters:[this._filterOutMessagesInDialog()]});const e=new T({path:"target",test:this._filterOutContextSuccessMessages.bind(this),caseSensitive:true});let c;if(this.isHiddenDraftEnabled){const e=this._getViewId(this.getId());const i=u.getElementById(e);const o=i?.getBindingContext();const s=(await(i.getController()?.editFlow.getRootContext(o)))?.getPath();n=m.getHiddenDraftUseCaseFilter(s);const r=new T({filters:[t,n],and:false});c=[r,a,this._getFilterToHideBackendMessageOnErrorValidation()]}else{i=new T({filters:[t,new T({path:"target",operator:b.StartsWith,value1:s})],and:false});c=[i,e,a,this._getFilterToHideBackendMessageOnErrorValidation()]}const d=new T({filters:c,and:true});if(l.length>0){o=new T({filters:[l,d],and:false})}else{o=d}this.oItemBinding.filter(o);this.oObjectPageLayout=this._getObjectPageLayout(this,this.oObjectPageLayout);if(this.oObjectPageLayout){r=new _("",undefined,undefined,(e,t)=>{if(!g){g=this.oObjectPageLayout&&this.oObjectPageLayout.getSections()}const n=this._getMessageRank(e,g);const i=this._getMessageRank(t,g);if(n<i){return-1}if(n>i){return 1}return 0});this.oItemBinding.sort(r)}}};l._fnFilterUponId=function e(t,n){return t===n.getId()};l._getSectionBySectionTitle=function e(t,n){let i;if(n){const e=t.getSections();for(let t=0;t<e.length;t++){if(e[t].getVisible()&&e[t].getTitle()===n){i=e[t];break}}}return i};l._navigateFromMessageToSectionInIconTabBarMode=function e(t,n){const i=t.getUseIconTabBar();if(i){const e=this._getSectionBySectionTitle(t,n);const i=t.getSelectedSection();if(e&&i!==e.getId()){t.setSelectedSection(e.getId())}}};l._navigateFromMessageToSectionTableInIconTabBarMode=async function e(t,n,i){const o=t.getRowBinding();const s=t.getBindingContext();const r=n.getBindingContext();const a=!(s===r);this._navigateFromMessageToSectionInIconTabBarMode(n,i);return new Promise(function(e){if(a){o.attachEventOnce("change",function(){e()})}else{e()}})};l._getMdcTable=function e(t){let n=t.getParent();while(n&&!n.isA("sap.ui.mdc.Table")){n=n.getParent()}return n&&n.isA("sap.ui.mdc.Table")?n:undefined};l._getGridTable=function e(t){return t.findElements(true,function(e){return e.isA("sap.ui.table.Table")&&e.getParent()===t})[0]};l._getTableRow=function e(t){let n=t.getParent();while(n&&!n.isA("sap.ui.table.Row")&&!n.isA("sap.ui.table.CreationRow")&&!n.isA(a.getMetadata().getName())){n=n.getParent()}return n&&(n.isA("sap.ui.table.Row")||n.isA("sap.ui.table.CreationRow")||n.isA(a.getMetadata().getName()))?n:undefined};l._getTableRowIndex=function e(t){const n=this._getTableRow(t);let i;if(n?.isA("sap.ui.table.Row")){i=n.getIndex()}else{i=n?.getTable?.().getItems().findIndex(function(e){return e.getId()===n?.getId()})}return i??-1};l._getTableColumnIndex=function e(t){const n=function(e,t){return t?.getCells().findIndex(function(t){return t.getId()===e.getId()})};const i=function(e,t){let i=e.getParent(),o=n(i,t);while(i&&o&&o<0){i=i.getParent();o=n(i,t)}return o};const o=this._getTableRow(t);let s=i(t,o);if(o?.isA("sap.ui.table.CreationRow")){const e=s?o.getCells()[s].getId():undefined,t=o.getTable()?.getColumns();s=t?.findIndex(function(t){if(t.getCreationTemplate()&&e){return e.search(t.getCreationTemplate().getId())>-1?true:false}else{return false}})}return s};l._getMdcTableRows=function e(t){return t.findElements(true,function(e){return e.isA("sap.ui.table.Row")&&e.getTable?.().getParent()===t})};l._getObjectPageLayout=function e(t,n){if(n){return n}let i=t;while(i&&!i.isA("sap.uxap.ObjectPageLayout")){i=i.getParent()??undefined}return i};l._navigationConfigured=function e(t){const n=sap.ui.require("sap/ui/core/Component"),i=t&&n.getOwnerComponentFor(t)&&n.getOwnerComponentFor(t).getNavigation();let o=false,s=false;if(i&&Object.keys(i).includes(t.getRowBinding().getPath())){o=i[t?.getRowBinding().getPath()]&&i[t?.getRowBinding().getPath()].detail&&i[t?.getRowBinding().getPath()].detail.route?true:false}s=o&&t?.getRowSettings().getRowActions()&&t?.getRowSettings().getRowActions()[0].getType().includes("Navigation");return s};l.setFocusToControl=function t(n){const i=this.oMessagePopover;if(i&&n&&n.focus){const e=()=>{n.focus()};if(!i.isOpen()){setTimeout(e,0)}else{const t=()=>{setTimeout(e,0);i.detachEvent("afterClose",t)};i.attachEvent("afterClose",t);i.close()}}else{e.warning("FE V4 : MessageButton : element doesn't have focus method for focusing.")}};l.escape=function e(t){return String(t).replace(/&/g,"&amp;").replace(/"/g,"&quot;").replace(/'/g,"&#39;").replace(/</g,"&lt;").replace(/>/g,"&gt;")};return o}(r),M=L(P.prototype,"customFilters",[C],{configurable:true,enumerable:true,writable:true,initializer:null}),y=L(P.prototype,"messageChange",[I],{configurable:true,enumerable:true,writable:true,initializer:null}),P))||S);return F},false);
//# sourceMappingURL=MessageButton.js.map