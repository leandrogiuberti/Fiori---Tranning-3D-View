/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)
 *      (c) Copyright 2009-2025 SAP SE. All rights reserved
 */
sap.ui.define(["sap/base/Log","sap/fe/base/BindingToolkit","sap/fe/core/CommonUtils","sap/fe/core/converters/controls/Common/Action","sap/fe/core/converters/MetaModelConverter","sap/fe/core/helpers/MetaModelFunction","sap/fe/core/helpers/ModelHelper","sap/fe/macros/filterBar/DefaultSemanticDateOperators","sap/fe/macros/filterBar/ExtendedSemanticDateOperators","sap/fe/macros/filterBar/SemanticDateOperators","sap/m/library","sap/ui/Device","sap/ui/mdc/condition/FilterOperatorUtil","sap/ui/mdc/enums/FieldEditMode","sap/ui/mdc/odata/v4/TypeMap","sap/ui/model/Context","sap/ui/model/odata/v4/AnnotationHelper"],function(t,e,n,r,i,o,a,s,c,u,l,f,g,p,d,m,h){"use strict";var b=o.isPropertyFilterable;var $=i.convertTypes;var y=r.aiIcon;var O=e.ref;var P=e.pathInModel;var E=e.notEqual;var M=e.ifElse;var v=e.fn;var D=e.equal;var T=e.constant;var C=e.compileExpression;function N(t,e){return t.filter(function(t){return e.includes(t)})}function x(t){const e=d.getDataTypeClassName(t);const n=d.getBaseType(e,{},{});return g.getOperatorsForType(n)}function S(t,e){if(!e?.operatorConfiguration)return false;return e.operatorConfiguration.some(e=>e.path==="key"&&e.equals===t&&e.exclude===true)}function j(t,e){if(t!=="Edm.Date"&&t!=="Edm.DateTimeOffset"){return[]}const n=[];const r=S("NotEmpty",e);const i=S("Empty",e);if(!r){n.push("NotEmpty")}if(!i){n.push("Empty")}return n}const A=l.ValueColor;const F={getPathToKey:function(t){return t.getObject()},getParameterEditMode:function(t,e){const n=e.context.getModel(),r=e.context.getPath(),i=n.getObject(`${r}@`),o=i["@com.sap.vocabularies.Common.v1.FieldControl"],a=i["@Org.OData.Core.V1.Immutable"],s=i["@Org.OData.Core.V1.Computed"];let c=p.Editable;if(a||s){c=p.ReadOnly}else if(o){if(o.$EnumMember){if(o.$EnumMember==="com.sap.vocabularies.Common.v1.FieldControlType/ReadOnly"){c=p.ReadOnly}if(o.$EnumMember==="com.sap.vocabularies.Common.v1.FieldControlType/Inapplicable"||o.$EnumMember==="com.sap.vocabularies.Common.v1.FieldControlType/Hidden"){c=p.Disabled}}if(o.$Path){c="{= %{"+o.$Path+"} < 3 ? (%{"+o.$Path+"} === 0 ? '"+p.Disabled+"' : '"+p.ReadOnly+"') : '"+p.Editable+"'}"}}return c},getMetaPath:function(t,e){return e&&e.context&&e.context.getPath()||undefined},getMetaModelId:function(t,e){$(e.context.getModel());return e.context.getModel().getId()},isDesktop:function(){return f.system.desktop===true},getTargetCollectionPath:function(t,e){let n=t.getPath();if(t.getObject("$kind")==="EntitySet"||t.getObject("$ContainsTarget")===true){return n}const r=t.getModel();const i=r.isA("sap.ui.model.odata.v4.ODataMetaModel")?r:r.getMetaModel();n=i.getMetaPath(n);const o=n.split("/").filter(function(t){return!!t&&t!="$Type"});const a=`/${o[0]}`;if(o.length===1){return a}const s=e===undefined?o.slice(1).join("/$NavigationPropertyBinding/"):e;return`${a}/$NavigationPropertyBinding/${s}`},isPropertyFilterable:function(t,e,n){const r=t.getModel(),i=t.getPath(),o=F.getLocationForPropertyPath(r,i),a=i.replace(`${o}/`,"");if(e&&(e.$Type==="com.sap.vocabularies.UI.v1.DataFieldForAction"||e.$Type==="com.sap.vocabularies.UI.v1.DataFieldForIntentBasedNavigation")){return false}return b(r,o,a,n)},getLocationForPropertyPath:function(t,e){let n;let r=e.slice(0,e.lastIndexOf("/"));if(t.getObject(`${r}/$kind`)==="EntityContainer"){n=r.length+1;r=e.slice(n,e.indexOf("/",n))}return r},gotoActionParameter:function(t){const e=t.getPath(),r=t.getObject(`${e}/$Name`);return n.getParameterPath(e,r)},getEntitySetName:function(t,e){const n=t.getObject("/");for(const t in n){if(typeof n[t]==="object"&&n[t].$Type===e){return t}}return undefined},getActionPath:function(t,e,n,r){let i=t.getPath().split("/@")[0];n=!n?t.getObject(t.getPath()):n;if(n&&n.includes("(")){n=n.split("(")[0]}else if(t.getObject(i)){const e=t.getObject(i).$Type;const n=this.getEntitySetName(t.getModel(),e);if(n){i=`/${n}`}}else{return i}if(r){return t.getObject(`${i}/${n}@Org.OData.Core.V1.OperationAvailable`)}if(e){return`${i}/${n}`}else{return{sContextPath:i,sProperty:t.getObject(`${i}/${n}@Org.OData.Core.V1.OperationAvailable/$Path`),sBindingParameter:t.getObject(`${i}/${n}/@$ui5.overload/0/$Parameter/0/$Name`)}}},getNavigationContext:function(t){return h.getNavigationPath(t.getPath())},getNavigationPath:function(t,e){const n=t.startsWith("/");const r=t.split("/").filter(function(t){return!!t});if(n){r.shift()}if(!e){r.pop()}return r.join("/")},getActionContext:function(t){return F.getActionPath(t,true)},getPathToBoundActionOverload:function(t){const e=F.getActionPath(t,true);return`${e}/@$ui5.overload/0`},addSingleQuotes:function(t,e){if(e&&t){t=this.escapeSingleQuotes(t)}return`'${t}'`},escapeSingleQuotes:function(t){return t.replace(/[']/g,"\\'")},generateFunction:function(t){let e="";for(let t=0;t<(arguments.length<=1?0:arguments.length-1);t++){e+=t+1<1||arguments.length<=t+1?undefined:arguments[t+1];if(t<(arguments.length<=1?0:arguments.length-1)-1){e+=", "}}let n=`${t}()`;if(e){n=`${t}(${e})`}return n},getHeaderDataPointLinkVisibility:function(t,e){return C(M(T(e),D(P(`isHeaderDPLinkVisible/${t}`,"internal"),true),E(P(`isHeaderDPLinkVisible/${t}`,"internal"),true)))},objectToString:function(t){let e=Object.keys(t).length,n="";for(const r in t){let i=t[r];if(i&&typeof i==="object"){i=this.objectToString(i)}n+=`${r}: ${i}`;if(e>1){--e;n+=", "}}return`{ ${n}}`},removeEscapeCharacters:function(t){return t?t.replace(/\\?\\([{}])/g,"$1"):undefined},stringifyObject:function(e){if(!e||e==="{}"){return undefined}else{const n=JSON.parse(e);if(typeof n==="object"&&!Array.isArray(n)){const t={ui5object:true};Object.assign(t,n);return JSON.stringify(t)}else{const e=Array.isArray(n)?"Array":typeof n;t.error(`Unexpected object type in stringifyObject (${e}) - only works with object`);throw new Error("stringifyObject only works with objects!")}}},stringifyCustomData:function(t){const e={ui5object:true};e["customData"]=t instanceof m?t.getObject():t;return JSON.stringify(e)},parseCustomData:function(t){t=typeof t==="string"?JSON.parse(t):t;if(t&&t.hasOwnProperty("customData")){return t["customData"]}return t},getContextPath:function(t,e){const n=e&&e.context&&e.context.getPath();return n[n.length-1]==="/"?n.slice(0,-1):n},getSortConditions:function(t,e,n){if(e&&F._isPresentationVariantAnnotation(n)&&e.SortOrder){const n={sorters:[]};const r=t.getPath(0).split("@")[0];e.SortOrder.forEach(function(){let e=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};let i;const o={};if(e.DynamicProperty){i=t.getModel(0).getObject(r+e.DynamicProperty.$AnnotationPath)?.Name}else if(e.Property){i=e.Property.$PropertyPath}if(i){o.name=i;o.descending=!!e.Descending;n.sorters.push(o)}else{throw new Error("Please define the right path to the sort property")}});return JSON.stringify(n)}return undefined},_isPresentationVariantAnnotation:function(t){return t.includes(`@${"com.sap.vocabularies.UI.v1.PresentationVariant"}`)||t.includes(`@${"com.sap.vocabularies.UI.v1.SelectionPresentationVariant"}`)},createPresentationPathContext:function(t){const e=t.getPath().split("@")||[];const n=t.getModel();if(e.length&&e[e.length-1].includes("com.sap.vocabularies.UI.v1.SelectionPresentationVariant")){const e=t.getPath().split("/PresentationVariant")[0];return n.createBindingContext(`${e}@sapui.name`)}return n.createBindingContext(`${t.getPath()}@sapui.name`)},getPressHandlerForDataFieldForIBN:function(t,e,n){let r=arguments.length>3&&arguments[3]!==undefined?arguments[3]:false;if(!t)return undefined;const i={navigationContexts:e?e:"${$source>/}.getBindingContext()"};if(t.RequiresContext&&!t.Inline&&n){const e=!r?"aApplicable":"aApplicableForContextMenu";const n=!r?"aNotApplicable":"aNotApplicableForContextMenu";i.applicableContexts=`\${internal>ibn/${t.SemanticObject}-${t.Action}/${e}/}`;i.notApplicableContexts=`\${internal>ibn/${t.SemanticObject}-${t.Action}/${n}/}`;i.label=this.addSingleQuotes(t.Label,true)}if(t.Mapping){i.semanticObjectMapping=this.addSingleQuotes(JSON.stringify(t.Mapping))}return this.generateFunction(n?"._intentBasedNavigation.navigateWithConfirmationDialog":"._intentBasedNavigation.navigate",this.addSingleQuotes(t.SemanticObject),this.addSingleQuotes(t.Action),this.objectToString(i),"${$source>/}")},getEntitySet:function(t){const e=t.getPath();return a.getEntitySetPath(e)},getCriticalityCalculationBinding:function(e,n,r,i,o,a,s,c){let u=A.Neutral;n=`%${n}`;r=r||-Infinity;i=i||r;o=o||i;c=c||Infinity;s=s||c;a=a||s;r=r&&(+r?+r:`%${r}`);i=i&&(+i?+i:`%${i}`);o=o&&(+o?+o:`%${o}`);a=a&&(+a?+a:`%${a}`);s=s&&(+s?+s:`%${s}`);c=c&&(+c?+c:`%${c}`);if(e.includes("Minimize")){u="{= "+n+" <= "+a+" ? '"+A.Good+"' : "+n+" <= "+s+" ? '"+A.Neutral+"' : "+"("+c+" && "+n+" <= "+c+") ? '"+A.Critical+"' : '"+A.Error+"' }"}else if(e.includes("Maximize")){u="{= "+n+" >= "+o+" ? '"+A.Good+"' : "+n+" >= "+i+" ? '"+A.Neutral+"' : "+"("+r+" && "+n+" >= "+r+") ? '"+A.Critical+"' : '"+A.Error+"' }"}else if(e.includes("Target")){u="{= ("+n+" <= "+a+" && "+n+" >= "+o+") ? '"+A.Good+"' : "+"(("+n+" >= "+i+" && "+n+" < "+o+") || ("+n+" > "+a+" && "+n+" <= "+s+")) ? '"+A.Neutral+"' : "+"(("+r+" && ("+n+" >= "+r+") && ("+n+" < "+i+")) || (("+n+" > "+s+") && "+c+" && ("+n+" <= "+c+"))) ? '"+A.Critical+"' : '"+A.Error+"' }"}else{t.warning("Case not supported, returning the default Value Neutral")}return u},getMeasureAttributeIndex:function(t,e,n){let r,i;if(e?.Measures?.length&&e?.Measures?.length>0){r=e.Measures;i=n?r[t].value:r[t].$PropertyPath}else if(e?.DynamicMeasures?.length&&e?.DynamicMeasures?.length>0){r=e.DynamicMeasures;i=r?.[t].$AnnotationPath}let o;const a=e.MeasureAttributes;let s=-1;const c=function(t,e,r){if(e){const i=n?e.Measure?.value:e.Measure?.$PropertyPath;if(e.Measure&&i===t){s=r;return true}else if(e.DynamicMeasure&&e?.DynamicMeasure?.$AnnotationPath===t){s=r;return true}}return false};if(a){o=a.some(c.bind(null,i))}return o&&s>-1?s:-1},getMeasureAttribute:async function(e){const n=e.getModel(),r=e.getPath();return n.requestObject(r).then(function(e){const n=e.MeasureAttributes,i=F.getMeasureAttributeIndex(0,e);const o=i>-1&&n?.[i]&&n[i].DataPoint?`${r}/MeasureAttributes/${i}/`:undefined;if(o===undefined){t.warning("DataPoint missing for the measure")}return o?`${o}DataPoint/$AnnotationPath/`:o})},getMeasureAttributeForMeasure:function(e){const n=e.getModel(),r=e.getPath(),i=r.substring(0,r.lastIndexOf("Measure")),o=r.replace(/.*\//,"");const a=n.getObject(i);const s=a.MeasureAttributes,c=F.getMeasureAttributeIndex(o,a);const u=c>-1&&s[c]&&s[c].DataPoint?`${i}MeasureAttributes/${c}/`:undefined;if(u===undefined){t.warning("DataPoint missing for the measure")}return u?`${u}DataPoint/$AnnotationPath/`:u},isDraftParentEntityForContainment:function(t,e){if(t){if(e&&e.parentEntitySet&&e.parentEntitySet.sPath){const t=e.parentEntitySet.sPath;const n=e.parentEntitySet.oModel.getObject(`${t}@com.sap.vocabularies.Common.v1.DraftRoot`);const r=e.parentEntitySet.oModel.getObject(`${t}@com.sap.vocabularies.Common.v1.DraftNode`);if(n||r){return true}else{return false}}}return false},getDataFromTemplate:function(t){const e=t.getPath().split("/");const n=e[e.length-1];const r=`/${e.slice(1,-2).join("/")}/@`;const i=t.getObject(r);const o=i.Template;const a=o.split("}");const s=[];for(let t=0;t<a.length-1;t++){const e=a[t].split("{")[1].trim();s.push(e)}Object.keys(i.Data).forEach(function(t){if(t.startsWith("$")){delete i.Data[t]}});const c=Object.keys(i.Data).indexOf(n);return`/${e.slice(1,-2).join("/")}/Data/${s[c]}`},notLastIndex:function(t,e){const n=t.Template;const r=n.split("}");const i=[];let o=false;for(let t=0;t<r.length-1;t++){const e=r[t].split("{")[1].trim();i.push(e)}i.forEach(function(n){const r=i.length-1;if(t.Data[n]===e&&i.indexOf(n)<r){o=true}});return o},getDelimiter:function(t){return t.split("}")[1].split("{")[0].trim()},oMetaModel:undefined,setMetaModel:function(t){this.oMetaModel=t},getMetaModel:function(){return this.oMetaModel},getParameters:function(t,e){if(e){const r=n.getParameterInfo(e,t);if(r.parameterProperties){return Object.keys(r.parameterProperties)}}return[]},buildActionWrapper:function(t,e){let n=arguments.length>2&&arguments[2]!==undefined?arguments[2]:false;const r=[O("$event"),t.handlerModule,t.handlerMethod];if(e&&e.id){const t=!n?"${internal>selectedContexts}":"${internal>contextmenu/selectedContexts}";const e={contexts:O(t)};r.push(e)}return C(v("FPM.actionWrapper",r))},getHiddenPathExpression:function(t){if(t["@com.sap.vocabularies.UI.v1.Hidden"]!==null){const e=t["@com.sap.vocabularies.UI.v1.Hidden"];return typeof e==="object"?"{= !${"+e.$Path+"} }":!e}return true},getOperatorsForProperty:function(t,e,r,i,o,a){const l=n.getFilterRestrictionsByPath(e,r);const f=["EQ"];const g=["EQ","GE","LE","LT","GT","BT","NE","NOTBT","NOTLE","NOTLT","NOTGE","NOTGT"];const p=["EQ","BT"];const d=["EQ","GE","LE","LT","GT","BT","NE","NOTBT","NOTLE","NOTLT","NOTGE","NOTGT"];const m=["Contains","NotContains","StartsWith","NotStartsWith","EndsWith","NotEndsWith"];const h=u.getBasicSemanticDateOperations();const b=o==="true"||o===true;let $=[];const y=a&&typeof a==="string"?JSON.parse(a).customData:a;const O=j(i||"",y);if(r.getObject(`${e}/@com.sap.vocabularies.Common.v1.ResultContext`)===true){return f}if(y&&y.operatorConfiguration&&y.operatorConfiguration.length>0){$=u.getFilterOperations(y.operatorConfiguration,i)}else{$=s.getSemanticDateOperations(i)}const P=x(i);let E=P;if(b){const t=c.getSemanticDateOperations();E=[...h,...P,...t]}let M=[];if(l&&l.FilterAllowedExpressions&&l.FilterAllowedExpressions[t]){const e=n.getSpecificAllowedExpression(l.FilterAllowedExpressions[t]);switch(e){case"SingleValue":const t=s.getSingleValueDateOperations();let e;if(i==="Edm.Date"&&b){e=[...t,...O]}else if(i==="Edm.Date"||i==="Edm.DateTimeOffset"){e=[...f,...O]}else{e=f}M=N(E,e);break;case"MultiValue":const n=[...f,"Empty","NotEmpty"];M=N(E,n);break;case"SingleRange":let r;if(b&&(i==="Edm.Date"||i==="Edm.DateTimeOffset")){r=[...$,...O]}else if(i==="Edm.DateTimeOffset"){r=[...p,...O]}else if(i==="Edm.Date"){r=[...g,...O]}else{r=g}M=N(E,r);break;case"MultiRange":const o=i==="Edm.Date"||i==="Edm.DateTimeOffset"?[...d,...O]:d;M=N(E,o);break;case"SearchExpression":M=N(E,m);break;case"MultiRangeOrSearchExpression":M=N(E,m.concat(d));break;default:break}}return M},getOperatorsForDateProperty:function(t){const e=x(t);const n=["EQ","GE","LE","LT","GT","BT","NE","NOTBT","NOTLE","NOTLT","NOTGE","NOTGT","Empty","NotEmpty"];return N(e,n)},getAIIcon:function(){return y}};F.getSortConditions.requiresIContext=true;return F},false);
//# sourceMappingURL=CommonHelper.js.map