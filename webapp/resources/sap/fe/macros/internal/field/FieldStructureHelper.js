/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)
 *      (c) Copyright 2009-2025 SAP SE. All rights reserved
 */
sap.ui.define(["sap/fe/base/BindingToolkit","sap/fe/core/controllerextensions/collaboration/CollaborationCommon","sap/fe/core/converters/MetaModelConverter","sap/fe/core/converters/annotations/DataField","sap/fe/core/formatters/CollaborationFormatter","sap/fe/core/formatters/ValueFormatter","sap/fe/core/helpers/BindingHelper","sap/fe/core/helpers/MetaModelFunction","sap/fe/core/helpers/ModelHelper","sap/fe/core/helpers/StableIdHelper","sap/fe/core/helpers/TitleHelper","sap/fe/core/helpers/TypeGuards","sap/fe/core/templating/DataModelPathHelper","sap/fe/core/templating/PropertyHelper","sap/fe/core/templating/SemanticObjectHelper","sap/fe/core/templating/UIFormatters","sap/fe/macros/field/FieldTemplating","sap/fe/macros/internal/valuehelp/AdditionalValueFormatter","sap/fe/macros/situations/SituationsIndicator","sap/ui/mdc/enums/FieldEditMode","../../field/FieldHelper"],function(t,e,a,i,o,n,r,s,l,d,c,p,u,f,m,y,h,P,v,M,g){"use strict";var x={};var O=h.setEditStyleProperties;var b=h.isUsedInNavigationWithQuickViewFacets;var I=h.isRetrieveTextFromValueListEnabled;var E=h.hasPropertyInsertRestrictions;var S=h.getVisibleExpression;var D=h.getValueBinding;var F=h.getTextBindingExpression;var C=h.getDraftIndicatorVisibleBinding;var T=h.getDataModelObjectPathForValue;var j=m.manageSemanticObjectsForCurrentUser;var U=m.getPropertyWithSemanticObject;var A=f.isSemanticKey;var V=f.getAssociatedExternalIdPropertyPath;var L=f.getAssociatedExternalIdProperty;var w=u.getTargetObjectPath;var $=u.getRelativePaths;var k=u.getContextRelativeTargetObjectPath;var B=u.enhanceDataModelPath;var R=p.isPropertyPathExpression;var H=p.isProperty;var N=p.isPathAnnotationExpression;var W=c.getTitleBindingExpression;var _=d.generate;var q=s.getRequiredPropertiesFromUpdateRestrictions;var Q=s.getRequiredPropertiesFromInsertRestrictions;var G=r.UI;var K=i.isDataField;var z=e.CollaborationFieldGroupPrefix;var J=t.transformRecursively;var X=t.pathInModel;var Y=t.not;var Z=t.ifElse;var tt=t.getExpressionFromAnnotation;var et=t.formatWithTypeInformation;var at=t.formatResult;var it=t.equal;var ot=t.constant;var nt=t.compileExpression;var rt=t.and;function st(t,e,a,i,o,n,r,s){const l={...t};Object.defineProperty(l,"value",{get:()=>t.value});Object.defineProperty(l,"description",{get:()=>t.description});l.change=t.change;l.metaPath=r?r:t.metaPath;l.contextPath=s?s:t.contextPath;l.visible=t.visible;if(!l.vhIdPrefix){l.vhIdPrefix="FieldValueHelp";l._flexId=t.id;if(!l.idPrefix){l.idPrefix=t.id}}l.formatOptions??={};l.formatOptions=yt(l);l.formatOptions.showOnlyUnitDecimals=a?.getProperty("/sapFeManifestConfiguration/app/showOnlyUnitDecimals")===true;l.formatOptions.preserveDecimalsForCurrency=a?.getProperty("/sapFeManifestConfiguration/app/preserveDecimalsForCurrency")===true;l.valueHelpMetaPath=r?r:l.metaPath;dt(l,l.valueHelpMetaPath?.getModel());l.convertedMetaPath=xt(l.convertedMetaPath);Ct(l);mt(l);l.dataSourcePath=w(l.dataModelPath);l.label=g.computeLabelText(t,{context:l.metaPath});ut(l);l.entityType=l.odataMetaModel.createBindingContext(`/${l.dataModelPath.targetEntityType.fullyQualifiedName}`);if(l.formatOptions?.forInlineCreationRows===true){l.hasPropertyInsertRestrictions=E(l.dataModelPath)}pt(l);lt(l);ct(l);l.formatOptions=l.formatOptions?l.formatOptions:{};Dt(l,l.dataModelPathExternalID||l.dataModelPath,e,a);bt(l,l.convertedMetaPath,l.dataModelPath,i,o);Et(l,o);l.valueState=Ft(l);if(l.editStyle==="InputWithValueHelp"){l.editStylePlaceholder=gt(l)}jt(l);Ut(l,a);const d=["Avatar","AmountWithCurrency"];if(l.displayStyle&&!d.includes(l.displayStyle)&&l.dataModelPath.targetObject){l.text=l.text??l.value??h.getTextBinding(l.dataModelPathExternalID||l.dataModelPath,l.formatOptions)}else{l.text=""}if(l.formatOptions.showEmptyIndicator){l.emptyIndicatorMode=String(l.formatOptions.showEmptyIndicator)==="true"?"On":undefined}else{l.emptyIndicatorMode=undefined}if(H(l.convertedMetaPath)&&l.convertedMetaPath.annotations?.UI?.DataFieldDefault!==undefined){l.metaPath=l.odataMetaModel.createBindingContext(`@${"com.sap.vocabularies.UI.v1.DataFieldDefault"}`,r?r:l.metaPath)}if(!n){l.computedEditMode=nt(Z(it(l.readOnly,true),"Display","Editable"))}l.eventHandlers={change:()=>{},liveChange:()=>{},validateFieldGroup:()=>{},handleTypeMissmatch:()=>{},handleFileSizeExceed:()=>{},handleUploadComplete:()=>{},uploadStream:()=>{},removeStream:()=>{},handleOpenUploader:()=>{},handleCloseUploader:()=>{},openExternalLink:()=>{},onFocusOut:()=>{},linkPressed:()=>{},displayAggregationDetails:()=>{},onDataFieldWithNavigationPath:()=>{},showCollaborationEditUser:()=>{},onDataFieldActionButton:()=>{},onDataFieldWithIBN:()=>{}};return l}x.setUpField=st;function lt(t){const e=y.getEditableExpressionAsObject(t.propertyForFieldControl,t.convertedMetaPath,t.dataModelPath);if(l.isCollaborationDraftSupported(t.odataMetaModel)&&t.editMode!==M.Display){const a=true;const i=y.getCollaborationExpression(t.dataModelPath,o.hasCollaborationActivity);const n=nt(rt(e,Y(i)));const r=nt(Z(i,ot("ReadOnly"),Z(rt(G.IsInactive,!!t.hasPropertyInsertRestrictions),"Display",t.editModeAsObject)));t.collaborationEnabled=a;t.collaborationExpression=i;t.editableExpression=n;t.computedEditMode=r}else{t.editableExpression=nt(e)}}x.computeCollaborationProperties=lt;function dt(t,e){t.convertedMetaPath=a.convertMetaModelContext(t.metaPathContext?t.metaPathContext:t.metaPath);let i=a.getInvolvedDataModelObjects(t.metaPathContext?t.metaPathContext:t.metaPath,t.contextPath);i=T(i)||i;t.dataModelPath=i;t.property=i.targetObject;t.odataMetaModel=e;t.propertyForFieldControl=i?.targetObject?.Value?(i?.targetObject).Value:i?.targetObject}x.computeCommonProperties=dt;function ct(t){const e=Q((t.contextPathContext?t.contextPathContext:t.contextPath)?.getPath().replaceAll("/$NavigationPropertyBinding/","/"),t.odataMetaModel);const a=q((t.contextPathContext?t.contextPathContext:t.contextPath)?.getPath().replaceAll("/$NavigationPropertyBinding/","/"),t.odataMetaModel);const i={requiredPropertiesFromInsertRestrictions:e,requiredPropertiesFromUpdateRestrictions:a};const o=y.getEnabledExpression(t.propertyForFieldControl,t.convertedMetaPath,false,t.dataModelPath);const n=y.getRequiredExpression(t.propertyForFieldControl,t.convertedMetaPath,false,false,i,t.dataModelPath);t.enabledExpression=o;t.requiredExpression=n}x.computeEditableExpressions=ct;function pt(t){if(t.editMode!==undefined&&t.editMode!==null){t.editModeAsObject=t.editMode}else{const e=t.formatOptions?.measureDisplayMode?t.formatOptions.measureDisplayMode==="ReadOnly":false;t.editModeAsObject=y.getEditMode(t.propertyForFieldControl,t.dataModelPath,e,true,t.convertedMetaPath);t.computedEditMode=nt(Z(rt(G.IsInactive,!!t.hasPropertyInsertRestrictions),"Display",t.editModeAsObject))}}x.computeEditMode=pt;function ut(t){const e=L(t.property);if(e){if(t.property)t.property.type=e.type;if(K(t.convertedMetaPath)){t.convertedMetaPath.Value.$target.type=e.type}const i=V(t.property);const o=t.metaPath.getModel().createBindingContext(t.contextPath?.getPath()+"/"+i,t.metaPath);t.convertedMetaPathExternalID=a.convertMetaModelContext(o);let n=a.getInvolvedDataModelObjects(o,t.contextPath);n=T(n)||n;t.dataModelPathExternalID=n}}x.computeExternalID=ut;function ft(t,e){const a=["InputWithValueHelp","TextArea","DatePicker","TimePicker","DateTimePicker","InputWithUnit","Input","InputMask","Masked"];if(!e){return}const i=e.getSideEffectsService();const o=i.computeFieldGroupIds(t.dataModelPath.targetEntityType?.fullyQualifiedName??"",t.dataModelPath.targetObject?.fullyQualifiedName??"");t.mainPropertyRelativePath=H(t.dataModelPath.targetObject)?k(t.dataModelPath):undefined;if(t.collaborationEnabled&&a.includes(t.editStyle||"")){const e=`${z}${t.dataSourcePath}`;o.push(e)}return o.length?o:undefined}function mt(t){if(t._flexId&&!t._apiId){t._apiId=t._flexId;t._flexId=Tt(t._flexId)}if(t.idPrefix){t.editStyleId=_([t.idPrefix,"Field-edit"])}if(t.formatOptions?.fieldMode==="nowrapper"&&t.editMode==="Display"){if(t._flexId){t.displayStyleId=t._flexId}else{t.displayStyleId=t.idPrefix?_([t.idPrefix,"Field-content"]):undefined}}else if(t.idPrefix){t.displayStyleId=_([t.idPrefix,"Field-display"])}}x.computeIDs=mt;function yt(t){return{...t.formatOptions,textAlignMode:t.formatOptions.textAlignMode??"Form",showEmptyIndicator:t.formatOptions.showEmptyIndicator??true,displayMode:t.formatOptions.displayMode,measureDisplayMode:t.formatOptions.measureDisplayMode,textLinesEdit:t.formatOptions.textLinesEdit,textMaxLines:t.formatOptions.textMaxLines,textMaxCharactersDisplay:t.formatOptions.textMaxCharactersDisplay,textExpandBehaviorDisplay:t.formatOptions.textExpandBehaviorDisplay,textMaxLength:t.formatOptions.textMaxLength,fieldEditStyle:t.formatOptions.fieldEditStyle,radioButtonsHorizontalLayout:t.formatOptions.radioButtonsHorizontalLayout,showTime:t.formatOptions.showTime,showTimezone:t.formatOptions.showTimezone,showDate:t.formatOptions.showDate}}x.getFormatOptions=yt;function ht(t,e){let a=X(k(e));const i=t?.displayMode;const o=R(e.targetObject)?e.targetObject.$target:e.targetObject;const r=o.annotations?.Common?.Text;if(r===undefined){return undefined}a=et(o,a);switch(i){case"ValueDescription":const t=$(e);return nt(tt(r,t));case"DescriptionValue":return nt(at([a],n.formatToKeepWhitespace));default:return undefined}}function Pt(t,e){const a={};if(t){const i=t[e];if(i){Object.keys(i).forEach(function(t){a[t]=i[t]})}}return a}function vt(t,e,a,i,o){if(o){t.hasQuickView=true;t.quickViewType="Facets"}if(i){const i=j(t.semanticObject,a,e);if(i.hasReachableStaticSemanticObject||i.dynamicSemanticObjects.length){t.hasQuickView=true;t.quickViewType=o?"FacetsAndSemanticLinks":"SemanticLinks";t.dynamicSemanticObjects=i.hasReachableStaticSemanticObject!==true?i.dynamicSemanticObjects:undefined}}}function Mt(t,e){return!!U(e)||t.semanticObject!==undefined&&t.semanticObject!==""}function gt(t){let e;const a=t.editStylePlaceholder;const i=t.formatOptions.textAlignMode;if(i==="Table"){e=t.dataModelPath.targetEntityType}const o=t.dataModelPath.targetObject?.name;const n=X(`${o}@$ui5.fe.recommendations.placeholderValue`);const r=X(`${o}@$ui5.fe.recommendations.placeholderDescription`);const s=at([n,r,X(`/recommendationsData`,"internal"),X(`/currentCtxt`,"internal"),X(`${o}@$ui5.fe.messageType`),a,t.formatOptions.displayMode],P.formatPlaceholder,e);return nt(s)}x.setInputWithValuehelpPlaceholder=gt;function xt(t){const e={...t};if(t?.term==="com.sap.vocabularies.UI.v1.DataPoint"){e.$Type=t.$Type||"com.sap.vocabularies.UI.v1.DataPointType"}return e}x.setUpDataPointType=xt;function Ot(t,e){const a=t?.getManifestEntry("sap.fe");return e?.annotations?.Measures?.ISOCurrency?a?.macros?.table?.currency?.decimalPadding??5:a?.macros?.table?.unitOfMeasure?.decimalPadding??3}x.getDecimalPadding=Ot;function bt(t,e,a,i,o){const n=t;const r=a.targetObject;if(!a.targetObject){n.displayStyle="Text";return n}n.hasUnitOrCurrency=r.annotations?.Measures?.Unit!==undefined||r.annotations?.Measures?.ISOCurrency!==undefined;n.hasValidAnalyticalCurrencyOrUnit=y.hasValidAnalyticalCurrencyOrUnit(a);n.textFromValueList=nt(at([X(k(a)),`/${r.fullyQualifiedName}`,n.formatOptions.displayMode],"sap.fe.macros.field.FieldRuntime.retrieveTextFromValueList"));if(r.annotations?.UI?.IsImage){n.displayStyle="File";return n}if(r.annotations?.UI?.IsImageURL){n.displayStyle="Avatar";return n}if(r.annotations?.UI?.InputMask){n.displayStyle="Text";return n}if(r.annotations?.Common?.Masked){n.displayStyle="Masked";return n}if(r.type==="Edm.Stream"){n.displayStyle="File";return n}if(n.formatOptions.isFieldGroupItem&&r.type==="Edm.Boolean"){n.displayStyle="CheckBoxGroupItem";return n}It(a,n);switch(e.$Type){case"com.sap.vocabularies.UI.v1.DataPointType":n.displayStyle="DataPoint";return n;case"com.sap.vocabularies.UI.v1.DataFieldForAnnotation":if(e.Target?.$target?.$Type==="com.sap.vocabularies.UI.v1.DataPointType"){n.displayStyle="DataPoint";return n}else if(e.Target?.$target?.$Type==="com.sap.vocabularies.Communication.v1.ContactType"){n.displayStyle="Contact";return n}break;case"com.sap.vocabularies.UI.v1.DataFieldForAction":case"com.sap.vocabularies.UI.v1.DataFieldForIntentBasedNavigation":n.displayStyle="Button";return n;case"com.sap.vocabularies.UI.v1.DataFieldWithIntentBasedNavigation":case"com.sap.vocabularies.UI.v1.DataFieldWithNavigationPath":case"com.sap.vocabularies.UI.v1.DataFieldWithAction":n.displayStyle="Link";return n}const s=b(a,r);const l=Mt(n,a);if(A(r,a)&&n.formatOptions.semanticKeyStyle){vt(n,i,a,l,s);St(n,a);n.showErrorIndicator=a.contextLocation?.targetObject?._type==="NavigationProperty"&&!n.formatOptions.fieldGroupDraftIndicatorPropertyPath;n.situationsIndicatorPropertyPath=a.targetObject.name;n.displayStyle=n.formatOptions.semanticKeyStyle==="ObjectIdentifier"?"ObjectIdentifier":"LabelSemanticKey";return n}if(e.Criticality){vt(n,i,a,l,s);n.displayStyle="ObjectStatus";return n}if((r.annotations?.Measures?.ISOCurrency||r.annotations?.Measures?.Unit)&&String(n.formatOptions.isCurrencyOrUnitAligned)==="true"&&n.formatOptions.measureDisplayMode!=="Hidden"){const e=At.getDecimalPadding(o,r);n.valueAsStringBindingExpression=n.value?n.value:D(a,n.formatOptions,false,true,undefined,true,false,e,true);n.unitBindingExpression=nt(y.getBindingForUnitOrCurrency(a,true,!!t.formatOptions.showOnlyUnitDecimals,!!t.formatOptions.preserveDecimalsForCurrency));n.displayStyle="NumberWithUnitOrCurrencyAligned";return n}if(r.annotations?.Communication?.IsEmailAddress||r.annotations?.Communication?.IsPhoneNumber){n.displayStyle="Link";return n}if(r.annotations?.UI?.MultiLineText){n.displayStyle="ExpandableText";return n}if(e.$Type==="com.sap.vocabularies.UI.v1.DataFieldWithUrl"){n.displayStyle="Link";return n}n.displayStyle="Text";vt(n,i,a,l,s);if(n.hasQuickView){n.displayStyle="LinkWithQuickView"}return n}x.setUpDisplayStyle=bt;function It(t,e){if(A(t.targetObject,t)){e.hasSituationsIndicator=v.getSituationsNavigationProperty(t.targetEntityType)!==undefined;if(t.contextLocation?.targetEntitySet?.annotations?.Common?.DraftRoot&&t.targetEntitySet?.annotations?.Common?.DraftRoot&&e.formatOptions?.hasDraftIndicator===true){e.draftIndicatorVisible=C(t.targetObject?.name);e.addDraftIndicator=true}}}function Et(t,e){const a=t;O(a,a.convertedMetaPath,a.dataModelPath);a.fieldGroupIds=ft(a,e);return a}x.setUpEditStyle=Et;function St(t,e){const a=t.formatOptions?.semanticKeyStyle;const i=t.formatOptions.displayMode;t.identifierTitle=W(e,F,{displayMode:i,splitTitleOnTwoLines:t.formatOptions.semanticKeyStyle==="ObjectIdentifier"},undefined,undefined);t.identifierText=a==="ObjectIdentifier"?ht(t.formatOptions,e):undefined}x.setUpObjectIdentifierTitleAndText=St;function Dt(t,e,a,i){const o=Pt(a,(t.metaPathContext?t.metaPathContext:t.metaPath).getPath());if(!t.formatOptions.displayMode){t.formatOptions.displayMode=y.getDisplayMode(e)}if(t.formatOptions.displayMode==="Description"){t.valueAsStringBindingExpression=t.value?t.value:D(e,t.formatOptions,true,true,undefined,true)}t.formatOptions.textLinesEdit=o.textLinesEdit||o.formatOptions&&o.formatOptions.textLinesEdit||t.formatOptions.textLinesEdit||4;t.formatOptions.textMaxLines=o.textMaxLines||o.formatOptions&&o.formatOptions.textMaxLines||t.formatOptions.textMaxLines;if(i?.getProperty("/retrieveTextFromValueList")){t.formatOptions.retrieveTextFromValueList=I(e.targetObject,t.formatOptions);if(t.formatOptions.retrieveTextFromValueList){const a=!!e?.targetEntityType?.annotations?.UI?.TextArrangement;t.formatOptions.displayMode=a?t.formatOptions.displayMode:"DescriptionValue"}}}x.setUpFormatOptions=Dt;function Ft(t){let e;const a=t.formatOptions?.textAlignMode?t.formatOptions?.textAlignMode:"Form";const i=X(k(t.dataModelPath));const o=$(t.dataModelPath);const n=tt(t.dataModelPath?.targetObject?.annotations?.Common?.Text,o);const r=t.dataModelPath.targetObject?.name;const s=X(`${r}@$ui5.fe.recommendations.placeholderValue`);const l=X(`${r}@$ui5.fe.recommendations.placeholderDescription`);if(a==="Table"){e=at([s,l,X(`/recommendationsData`,"internal"),X(`/isEditable`,"ui"),t.dataSourcePath,i,n],P.formatValueState,t.dataModelPath.targetEntityType)}else{e=at([s,l,X(`/recommendationsData`,"internal"),X(`/isEditable`,"ui"),t.dataSourcePath,i,n],P.formatValueState)}t.valueState=nt(e);return t.valueState}x.setUpValueState=Ft;function Ct(t){const e=a.getInvolvedDataModelObjects(t.metaPathContext?t.metaPathContext:t.metaPath,t.contextPath);t.visible??=S(e,t.formatOptions);t.displayVisible=t.formatOptions?.fieldMode==="nowrapper"?t.visible:undefined}x.setUpVisibleProperties=Ct;function Tt(t){return`${t}-content`}function jt(t){if(t.displayStyle==="File"){t.fileRelativePropertyPath=k(t.dataModelPath)||"";const e=t.property.annotations.Core?.ContentDisposition?.Filename;if(N(e)){const a=B(t.dataModelPath,e.path);t.fileFilenameExpression=k(a)??""}}}function Ut(t,e){if(t.displayStyle==="File"||t.displayStyle==="Avatar"){t.inlineEditEnabled=undefined;return}t.inlineEditEnabled=t.inlineEditEnabled===true||e?.getProperty("/isInlineEditEnabled")===true?true:undefined;if(t.inlineEditEnabled&&t.editModeAsObject!=="Display"){const e=y.getEditableExpressionAsObject(t.propertyForFieldControl,t.convertedMetaPath,t.dataModelPath);t.hasInlineEdit=J(e,"PathInModel",t=>{if(t.path==="isEditable"&&t.modelName==="ui"){return ot(true)}return t},true)}}const At={getDecimalPadding:Ot,setUpField:st,computeExternalID:ut,setUpDisplayStyle:bt,setUpObjectIdentifierTitleAndText:St,setUpValueState:Ft};return At},false);
//# sourceMappingURL=FieldStructureHelper.js.map