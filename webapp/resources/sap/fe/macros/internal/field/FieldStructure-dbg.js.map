{"version":3,"names":["getPossibleValueHelpTemplateId","field","pageController","metaModel","targetProperty","getAssociatedCurrencyProperty","property","getAssociatedUnitProperty","hasValueHelp","vhTemplate","ValueHelp","getValueHelpForMetaPath","dataSourcePath","contextPath","getPath","_requiresValidation","getContent","getId","_exports","createFieldWrapper","fieldWrapperID","_flexId","idPrefix","generate","undefined","contentDisplay","DisplayStyle","getTemplate","contentEdit","EditStyle","getTemplateWithWrapper","delaySwitchToDisplay","editStyle","computedEditMode","includes","_jsx","FieldWrapper","id","editMode","width","textAlign","class","validateFieldGroup","eventHandlers","onFocusOut","children","getFieldStructureTemplate","preparedProperties","isDynamicInstantiation","setUpField","_controlConfiguration","_settings","models","viewData","internal","appComponent","getModel","isPropertyInitial","fileFilename","fileFilenameExpression","change","liveChange","handleTypeMissmatch","handleFileSizeExceed","handleUploadComplete","fileRelativePropertyPath","uploadStream","removeStream","handleOpenUploader","handleCloseUploader","openExternalLink","linkPressed","displayAggregationDetails","getContextRelativeTargetObjectPath","dataModelPath","convertedMetaPath","$Type","onDataFieldWithNavigationPath","Target","value","showCollaborationEditUser","onDataFieldActionButton","FieldHelper","getPressEventForDataFieldActionButton","metaPath","getObject","onDataFieldWithIBN","CommonHelper","getPressHandlerForDataFieldForIBN","displayStyle","collaborationEnabled","FieldEditMode","Display","_jsxs","HBox","alignItems","VBox","getFileTemplate","getCollaborationAvatar","formatOptions","fieldMode"],"sourceRoot":".","sources":["FieldStructure.tsx"],"sourcesContent":["import type PageController from \"sap/fe/core/PageController\";\nimport { generate } from \"sap/fe/core/helpers/StableIdHelper\";\nimport { getContextRelativeTargetObjectPath } from \"sap/fe/core/templating/DataModelPathHelper\";\nimport { getAssociatedCurrencyProperty, getAssociatedUnitProperty, hasValueHelp } from \"sap/fe/core/templating/PropertyHelper\";\nimport ValueHelp from \"sap/fe/macros/ValueHelp\";\nimport HBox from \"sap/m/HBox\";\nimport VBox from \"sap/m/VBox\";\nimport type { TextAlign } from \"sap/ui/core/library\";\nimport FieldEditMode from \"sap/ui/mdc/enums/FieldEditMode\";\nimport type JSONModel from \"sap/ui/model/json/JSONModel\";\nimport type ODataMetaModel from \"sap/ui/model/odata/v4/ODataMetaModel\";\nimport type { EventHandler } from \"types/extension_types\";\nimport CommonHelper from \"../../CommonHelper\";\nimport FieldWrapper from \"../../controls/FieldWrapper\";\nimport FieldHelper from \"../../field/FieldHelper\";\nimport DisplayStyle from \"./DisplayStyle\";\nimport EditStyle from \"./EditStyle\";\nimport type { InputFieldBlockProperties } from \"./FieldStructureHelper\";\nimport { setUpField, type FieldBlockProperties } from \"./FieldStructureHelper\";\n\n/**\n * The function calculates the corresponding ValueHelp field in case it´s\n * defined for the specific control.\n * @param field\n * @param pageController\n * @param metaModel\n * @returns An XML-based string with a possible ValueHelp control.\n */\nexport function getPossibleValueHelpTemplateId(\n\tfield: FieldBlockProperties,\n\tpageController: PageController,\n\tmetaModel: ODataMetaModel\n): string | undefined {\n\t/* For currency (and later Unit) we need to forward the value help to the annotated field */\n\tconst targetProperty = getAssociatedCurrencyProperty(field.property) ?? getAssociatedUnitProperty(field.property) ?? field.property;\n\tif (targetProperty && hasValueHelp(targetProperty)) {\n\t\t// depending on whether this one has a value help annotation included, add the dependent\n\t\tconst vhTemplate = ValueHelp.getValueHelpForMetaPath(\n\t\t\tpageController,\n\t\t\tfield.dataSourcePath!,\n\t\t\tfield.contextPath?.getPath(),\n\t\t\tmetaModel,\n\t\t\tfield._requiresValidation\n\t\t);\n\t\treturn vhTemplate?.getContent()?.getId();\n\t}\n\treturn \"\";\n}\n\n/**\n * Create the fieldWrapper control for use cases with display and edit styles.\n * @param field Reference to the current internal field instance\n * @returns An XML-based string with the definition of the field control\n */\nexport function createFieldWrapper(field: FieldBlockProperties): string {\n\tlet fieldWrapperID;\n\tif (field._flexId) {\n\t\tfieldWrapperID = field._flexId;\n\t} else if (field.idPrefix) {\n\t\tfieldWrapperID = generate([field.idPrefix, \"Field-content\"]);\n\t} else {\n\t\tfieldWrapperID = undefined;\n\t}\n\n\t// compute the display part and the edit part for the fieldwrapper control\n\tconst contentDisplay = DisplayStyle.getTemplate(field);\n\t// content edit part needs to be wrapped further with an hbox in case of collaboration mode\n\t// that´s why we need to call this special helper here which finally calls internally EditStyle.getTemplate\n\t// const contentEdit = EditStyle.getTemplateWithWrapper(field, controller, handleChange, field);\n\tconst contentEdit = EditStyle.getTemplateWithWrapper(field);\n\n\t// if the edit style is InputWithValueHelp and the editableExpression depends on the context being transient or inactive,\n\t// we need to delay the switch to display to ensure that value help closing does not set the field's value to \"\".\n\t// DINC0524872\n\tconst delaySwitchToDisplay =\n\t\tfield.editStyle === \"InputWithValueHelp\" && field.computedEditMode?.includes(\"@$ui5.context\") ? true : undefined;\n\n\treturn (\n\t\t<FieldWrapper\n\t\t\tid={fieldWrapperID}\n\t\t\teditMode={field.editMode ?? field.computedEditMode}\n\t\t\twidth=\"100%\"\n\t\t\ttextAlign={field.textAlign as TextAlign}\n\t\t\tclass={field.class}\n\t\t\tvalidateFieldGroup={field.eventHandlers.onFocusOut}\n\t\t\tdelaySwitchToDisplay={delaySwitchToDisplay}\n\t\t>\n\t\t\t{{\n\t\t\t\tcontentDisplay: contentDisplay,\n\t\t\t\tcontentEdit: contentEdit\n\t\t\t}}\n\t\t</FieldWrapper>\n\t);\n}\n\n/**\n * Helps to calculate the field structure wrapper.\n * @param field Reference to the current internal field instance\n * @returns An XML-based string with the definition of the field control\n */\nexport function getFieldStructureTemplate(field: FieldBlockProperties): string {\n\tlet preparedProperties = field;\n\t// Check if the field is not dynamically instantiated (the code is used for the field)\n\tif (!(field.isDynamicInstantiation ?? false)) {\n\t\tpreparedProperties = setUpField(\n\t\t\tfield as unknown as InputFieldBlockProperties,\n\t\t\tfield._controlConfiguration,\n\t\t\tfield._settings.models.viewData,\n\t\t\tfield._settings.models.internal ?? (field._settings.appComponent?.getModel?.(\"internal\") as JSONModel),\n\t\t\tfield._settings.appComponent,\n\t\t\tfield.isPropertyInitial(\"readOnly\")\n\t\t);\n\t\tconst fileFilename = preparedProperties.fileFilenameExpression\n\t\t\t? \"{ path: '\" + preparedProperties.fileFilenameExpression + \"' }\"\n\t\t\t: \"undefined\";\n\t\tpreparedProperties.eventHandlers.change = \"Field.handleChange\" as unknown as EventHandler;\n\t\tpreparedProperties.eventHandlers.liveChange = \"Field.handleLiveChange\" as unknown as EventHandler;\n\t\tpreparedProperties.eventHandlers.validateFieldGroup = \"Field.onValidateFieldGroup\" as unknown as EventHandler;\n\t\tpreparedProperties.eventHandlers.handleTypeMissmatch = \"FieldRuntimeHelper.handleTypeMissmatch\" as unknown as EventHandler;\n\t\tpreparedProperties.eventHandlers.handleFileSizeExceed = \"FieldRuntimeHelper.handleFileSizeExceed\" as unknown as EventHandler;\n\t\tpreparedProperties.eventHandlers.handleUploadComplete =\n\t\t\t`FieldRuntimeHelper.handleUploadComplete($event, ${fileFilename}, '${preparedProperties.fileRelativePropertyPath}', $controller)` as unknown as EventHandler;\n\t\tpreparedProperties.eventHandlers.uploadStream = \"FieldRuntimeHelper.uploadStream($controller, $event)\" as unknown as EventHandler;\n\t\tpreparedProperties.eventHandlers.removeStream =\n\t\t\t`FieldRuntimeHelper.removeStream($event, ${fileFilename}, '${preparedProperties.fileRelativePropertyPath}', $controller)` as unknown as EventHandler;\n\t\tpreparedProperties.eventHandlers.handleOpenUploader = \"FieldRuntimeHelper.handleOpenUploader\" as unknown as EventHandler;\n\t\tpreparedProperties.eventHandlers.handleCloseUploader = \"FieldRuntimeHelper.handleCloseUploader\" as unknown as EventHandler;\n\t\tpreparedProperties.eventHandlers.openExternalLink = \"FieldRuntimeHelper.openExternalLink\" as unknown as EventHandler;\n\t\tpreparedProperties.eventHandlers.onFocusOut = \".collaborativeDraft.handleContentFocusOut\" as unknown as EventHandler;\n\t\tpreparedProperties.eventHandlers.linkPressed = \"FieldRuntimeHelper.pressLink\" as unknown as EventHandler;\n\t\tpreparedProperties.eventHandlers.displayAggregationDetails =\n\t\t\t`FIELDRUNTIME.displayAggregateDetails($event, '${getContextRelativeTargetObjectPath(\n\t\t\t\tpreparedProperties.dataModelPath\n\t\t\t)}')` as unknown as EventHandler;\n\t\tif (preparedProperties.convertedMetaPath.$Type === \"com.sap.vocabularies.UI.v1.DataFieldWithNavigationPath\") {\n\t\t\tpreparedProperties.eventHandlers.onDataFieldWithNavigationPath =\n\t\t\t\t`FieldRuntimeHelper.onDataFieldWithNavigationPath(\\${$source>/}, $controller, '${preparedProperties.convertedMetaPath.Target.value}')` as unknown as EventHandler;\n\t\t}\n\t\tpreparedProperties.eventHandlers.showCollaborationEditUser =\n\t\t\t\"FieldRuntimeHelper.showCollaborationEditUser(${$source>/}, ${$view>/})\" as unknown as EventHandler;\n\t\tpreparedProperties.eventHandlers.onDataFieldActionButton = FieldHelper.getPressEventForDataFieldActionButton(\n\t\t\tpreparedProperties,\n\t\t\tpreparedProperties.metaPath.getObject()\n\t\t) as unknown as EventHandler;\n\t\tpreparedProperties.eventHandlers.onDataFieldWithIBN = CommonHelper.getPressHandlerForDataFieldForIBN(\n\t\t\tpreparedProperties.metaPath.getObject()\n\t\t) as unknown as EventHandler;\n\t}\n\n\t//compute the field in case of mentioned display styles\n\tif (\n\t\tpreparedProperties.displayStyle === \"Avatar\" ||\n\t\tpreparedProperties.displayStyle === \"Contact\" ||\n\t\tpreparedProperties.displayStyle === \"Button\" ||\n\t\tpreparedProperties.displayStyle === \"File\"\n\t) {\n\t\t// check for special handling in case a file type is used with the collaboration mode\n\t\t// (renders an avatar directly)\n\t\tif (\n\t\t\tpreparedProperties.displayStyle === \"File\" &&\n\t\t\t(preparedProperties.collaborationEnabled ?? false) &&\n\t\t\t(preparedProperties.editMode ?? preparedProperties.computedEditMode) !== FieldEditMode.Display\n\t\t) {\n\t\t\treturn (\n\t\t\t\t<HBox width=\"100%\" alignItems=\"End\">\n\t\t\t\t\t<VBox width=\"100%\">{DisplayStyle.getFileTemplate(preparedProperties)}</VBox>\n\t\t\t\t\t{EditStyle.getCollaborationAvatar(preparedProperties)}\n\t\t\t\t</HBox>\n\t\t\t);\n\t\t} else {\n\t\t\t//for all other cases render the displayStyles with a field api wrapper\n\t\t\treturn DisplayStyle.getTemplate(preparedProperties);\n\t\t}\n\t} else if (\n\t\tpreparedProperties.formatOptions.fieldMode === \"nowrapper\" &&\n\t\t(preparedProperties.editMode ?? preparedProperties.computedEditMode) === FieldEditMode.Display\n\t) {\n\t\t//renders a display based building block (e.g. a button) that has no field api wrapper around it.\n\t\treturn DisplayStyle.getTemplate(preparedProperties);\n\t} else {\n\t\t//for all other cases create a field wrapper\n\t\treturn createFieldWrapper(preparedProperties);\n\t}\n}\n"],"mappings":"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","ignoreList":[],"file":"FieldStructure-dbg.js"}