{"version":3,"file":"FieldStructure.js","names":["getPossibleValueHelpTemplateId","field","pageController","metaModel","targetProperty","getAssociatedCurrencyProperty","property","getAssociatedUnitProperty","hasValueHelp","vhTemplate","ValueHelp","getValueHelpForMetaPath","dataSourcePath","contextPath","getPath","_requiresValidation","getContent","getId","_exports","createFieldWrapper","fieldWrapperID","_flexId","idPrefix","generate","undefined","contentDisplay","DisplayStyle","getTemplate","contentEdit","EditStyle","getTemplateWithWrapper","delaySwitchToDisplay","editStyle","computedEditMode","includes","_jsx","FieldWrapper","id","editMode","width","textAlign","class","validateFieldGroup","eventHandlers","onFocusOut","children","getFieldStructureTemplate","preparedProperties","isDynamicInstantiation","setUpField","_controlConfiguration","_settings","models","viewData","internal","appComponent","getModel","isPropertyInitial","fileFilename","fileFilenameExpression","change","liveChange","handleTypeMissmatch","handleFileSizeExceed","handleUploadComplete","fileRelativePropertyPath","uploadStream","removeStream","handleOpenUploader","handleCloseUploader","openExternalLink","linkPressed","displayAggregationDetails","getContextRelativeTargetObjectPath","dataModelPath","convertedMetaPath","$Type","onDataFieldWithNavigationPath","Target","value","showCollaborationEditUser","onDataFieldActionButton","FieldHelper","getPressEventForDataFieldActionButton","metaPath","getObject","onDataFieldWithIBN","CommonHelper","getPressHandlerForDataFieldForIBN","displayStyle","collaborationEnabled","FieldEditMode","Display","_jsxs","HBox","alignItems","VBox","getFileTemplate","getCollaborationAvatar","formatOptions","fieldMode"],"sources":["./FieldStructure.tsx"],"sourcesContent":["import type PageController from \"sap/fe/core/PageController\";\nimport { generate } from \"sap/fe/core/helpers/StableIdHelper\";\nimport { getContextRelativeTargetObjectPath } from \"sap/fe/core/templating/DataModelPathHelper\";\nimport { getAssociatedCurrencyProperty, getAssociatedUnitProperty, hasValueHelp } from \"sap/fe/core/templating/PropertyHelper\";\nimport ValueHelp from \"sap/fe/macros/ValueHelp\";\nimport HBox from \"sap/m/HBox\";\nimport VBox from \"sap/m/VBox\";\nimport type { TextAlign } from \"sap/ui/core/library\";\nimport FieldEditMode from \"sap/ui/mdc/enums/FieldEditMode\";\nimport type JSONModel from \"sap/ui/model/json/JSONModel\";\nimport type ODataMetaModel from \"sap/ui/model/odata/v4/ODataMetaModel\";\nimport type { EventHandler } from \"types/extension_types\";\nimport CommonHelper from \"../../CommonHelper\";\nimport FieldWrapper from \"../../controls/FieldWrapper\";\nimport FieldHelper from \"../../field/FieldHelper\";\nimport DisplayStyle from \"./DisplayStyle\";\nimport EditStyle from \"./EditStyle\";\nimport type { InputFieldBlockProperties } from \"./FieldStructureHelper\";\nimport { setUpField, type FieldBlockProperties } from \"./FieldStructureHelper\";\n\n/**\n * The function calculates the corresponding ValueHelp field in case it´s\n * defined for the specific control.\n * @param field\n * @param pageController\n * @param metaModel\n * @returns An XML-based string with a possible ValueHelp control.\n */\nexport function getPossibleValueHelpTemplateId(\n\tfield: FieldBlockProperties,\n\tpageController: PageController,\n\tmetaModel: ODataMetaModel\n): string | undefined {\n\t/* For currency (and later Unit) we need to forward the value help to the annotated field */\n\tconst targetProperty = getAssociatedCurrencyProperty(field.property) ?? getAssociatedUnitProperty(field.property) ?? field.property;\n\tif (targetProperty && hasValueHelp(targetProperty)) {\n\t\t// depending on whether this one has a value help annotation included, add the dependent\n\t\tconst vhTemplate = ValueHelp.getValueHelpForMetaPath(\n\t\t\tpageController,\n\t\t\tfield.dataSourcePath!,\n\t\t\tfield.contextPath?.getPath(),\n\t\t\tmetaModel,\n\t\t\tfield._requiresValidation\n\t\t);\n\t\treturn vhTemplate?.getContent()?.getId();\n\t}\n\treturn \"\";\n}\n\n/**\n * Create the fieldWrapper control for use cases with display and edit styles.\n * @param field Reference to the current internal field instance\n * @returns An XML-based string with the definition of the field control\n */\nexport function createFieldWrapper(field: FieldBlockProperties): string {\n\tlet fieldWrapperID;\n\tif (field._flexId) {\n\t\tfieldWrapperID = field._flexId;\n\t} else if (field.idPrefix) {\n\t\tfieldWrapperID = generate([field.idPrefix, \"Field-content\"]);\n\t} else {\n\t\tfieldWrapperID = undefined;\n\t}\n\n\t// compute the display part and the edit part for the fieldwrapper control\n\tconst contentDisplay = DisplayStyle.getTemplate(field);\n\t// content edit part needs to be wrapped further with an hbox in case of collaboration mode\n\t// that´s why we need to call this special helper here which finally calls internally EditStyle.getTemplate\n\t// const contentEdit = EditStyle.getTemplateWithWrapper(field, controller, handleChange, field);\n\tconst contentEdit = EditStyle.getTemplateWithWrapper(field);\n\n\t// if the edit style is InputWithValueHelp and the editableExpression depends on the context being transient or inactive,\n\t// we need to delay the switch to display to ensure that value help closing does not set the field's value to \"\".\n\t// DINC0524872\n\tconst delaySwitchToDisplay =\n\t\tfield.editStyle === \"InputWithValueHelp\" && field.computedEditMode?.includes(\"@$ui5.context\") ? true : undefined;\n\n\treturn (\n\t\t<FieldWrapper\n\t\t\tid={fieldWrapperID}\n\t\t\teditMode={field.editMode ?? field.computedEditMode}\n\t\t\twidth=\"100%\"\n\t\t\ttextAlign={field.textAlign as TextAlign}\n\t\t\tclass={field.class}\n\t\t\tvalidateFieldGroup={field.eventHandlers.onFocusOut}\n\t\t\tdelaySwitchToDisplay={delaySwitchToDisplay}\n\t\t>\n\t\t\t{{\n\t\t\t\tcontentDisplay: contentDisplay,\n\t\t\t\tcontentEdit: contentEdit\n\t\t\t}}\n\t\t</FieldWrapper>\n\t);\n}\n\n/**\n * Helps to calculate the field structure wrapper.\n * @param field Reference to the current internal field instance\n * @returns An XML-based string with the definition of the field control\n */\nexport function getFieldStructureTemplate(field: FieldBlockProperties): string {\n\tlet preparedProperties = field;\n\t// Check if the field is not dynamically instantiated (the code is used for the field)\n\tif (!(field.isDynamicInstantiation ?? false)) {\n\t\tpreparedProperties = setUpField(\n\t\t\tfield as unknown as InputFieldBlockProperties,\n\t\t\tfield._controlConfiguration,\n\t\t\tfield._settings.models.viewData,\n\t\t\tfield._settings.models.internal ?? (field._settings.appComponent?.getModel?.(\"internal\") as JSONModel),\n\t\t\tfield._settings.appComponent,\n\t\t\tfield.isPropertyInitial(\"readOnly\")\n\t\t);\n\t\tconst fileFilename = preparedProperties.fileFilenameExpression\n\t\t\t? \"{ path: '\" + preparedProperties.fileFilenameExpression + \"' }\"\n\t\t\t: \"undefined\";\n\t\tpreparedProperties.eventHandlers.change = \"Field.handleChange\" as unknown as EventHandler;\n\t\tpreparedProperties.eventHandlers.liveChange = \"Field.handleLiveChange\" as unknown as EventHandler;\n\t\tpreparedProperties.eventHandlers.validateFieldGroup = \"Field.onValidateFieldGroup\" as unknown as EventHandler;\n\t\tpreparedProperties.eventHandlers.handleTypeMissmatch = \"FieldRuntimeHelper.handleTypeMissmatch\" as unknown as EventHandler;\n\t\tpreparedProperties.eventHandlers.handleFileSizeExceed = \"FieldRuntimeHelper.handleFileSizeExceed\" as unknown as EventHandler;\n\t\tpreparedProperties.eventHandlers.handleUploadComplete =\n\t\t\t`FieldRuntimeHelper.handleUploadComplete($event, ${fileFilename}, '${preparedProperties.fileRelativePropertyPath}', $controller)` as unknown as EventHandler;\n\t\tpreparedProperties.eventHandlers.uploadStream = \"FieldRuntimeHelper.uploadStream($controller, $event)\" as unknown as EventHandler;\n\t\tpreparedProperties.eventHandlers.removeStream =\n\t\t\t`FieldRuntimeHelper.removeStream($event, ${fileFilename}, '${preparedProperties.fileRelativePropertyPath}', $controller)` as unknown as EventHandler;\n\t\tpreparedProperties.eventHandlers.handleOpenUploader = \"FieldRuntimeHelper.handleOpenUploader\" as unknown as EventHandler;\n\t\tpreparedProperties.eventHandlers.handleCloseUploader = \"FieldRuntimeHelper.handleCloseUploader\" as unknown as EventHandler;\n\t\tpreparedProperties.eventHandlers.openExternalLink = \"FieldRuntimeHelper.openExternalLink\" as unknown as EventHandler;\n\t\tpreparedProperties.eventHandlers.onFocusOut = \".collaborativeDraft.handleContentFocusOut\" as unknown as EventHandler;\n\t\tpreparedProperties.eventHandlers.linkPressed = \"FieldRuntimeHelper.pressLink\" as unknown as EventHandler;\n\t\tpreparedProperties.eventHandlers.displayAggregationDetails =\n\t\t\t`FIELDRUNTIME.displayAggregateDetails($event, '${getContextRelativeTargetObjectPath(\n\t\t\t\tpreparedProperties.dataModelPath\n\t\t\t)}')` as unknown as EventHandler;\n\t\tif (preparedProperties.convertedMetaPath.$Type === \"com.sap.vocabularies.UI.v1.DataFieldWithNavigationPath\") {\n\t\t\tpreparedProperties.eventHandlers.onDataFieldWithNavigationPath =\n\t\t\t\t`FieldRuntimeHelper.onDataFieldWithNavigationPath(\\${$source>/}, $controller, '${preparedProperties.convertedMetaPath.Target.value}')` as unknown as EventHandler;\n\t\t}\n\t\tpreparedProperties.eventHandlers.showCollaborationEditUser =\n\t\t\t\"FieldRuntimeHelper.showCollaborationEditUser(${$source>/}, ${$view>/})\" as unknown as EventHandler;\n\t\tpreparedProperties.eventHandlers.onDataFieldActionButton = FieldHelper.getPressEventForDataFieldActionButton(\n\t\t\tpreparedProperties,\n\t\t\tpreparedProperties.metaPath.getObject()\n\t\t) as unknown as EventHandler;\n\t\tpreparedProperties.eventHandlers.onDataFieldWithIBN = CommonHelper.getPressHandlerForDataFieldForIBN(\n\t\t\tpreparedProperties.metaPath.getObject()\n\t\t) as unknown as EventHandler;\n\t}\n\n\t//compute the field in case of mentioned display styles\n\tif (\n\t\tpreparedProperties.displayStyle === \"Avatar\" ||\n\t\tpreparedProperties.displayStyle === \"Contact\" ||\n\t\tpreparedProperties.displayStyle === \"Button\" ||\n\t\tpreparedProperties.displayStyle === \"File\"\n\t) {\n\t\t// check for special handling in case a file type is used with the collaboration mode\n\t\t// (renders an avatar directly)\n\t\tif (\n\t\t\tpreparedProperties.displayStyle === \"File\" &&\n\t\t\t(preparedProperties.collaborationEnabled ?? false) &&\n\t\t\t(preparedProperties.editMode ?? preparedProperties.computedEditMode) !== FieldEditMode.Display\n\t\t) {\n\t\t\treturn (\n\t\t\t\t<HBox width=\"100%\" alignItems=\"End\">\n\t\t\t\t\t<VBox width=\"100%\">{DisplayStyle.getFileTemplate(preparedProperties)}</VBox>\n\t\t\t\t\t{EditStyle.getCollaborationAvatar(preparedProperties)}\n\t\t\t\t</HBox>\n\t\t\t);\n\t\t} else {\n\t\t\t//for all other cases render the displayStyles with a field api wrapper\n\t\t\treturn DisplayStyle.getTemplate(preparedProperties);\n\t\t}\n\t} else if (\n\t\tpreparedProperties.formatOptions.fieldMode === \"nowrapper\" &&\n\t\t(preparedProperties.editMode ?? preparedProperties.computedEditMode) === FieldEditMode.Display\n\t) {\n\t\t//renders a display based building block (e.g. a button) that has no field api wrapper around it.\n\t\treturn DisplayStyle.getTemplate(preparedProperties);\n\t} else {\n\t\t//for all other cases create a field wrapper\n\t\treturn createFieldWrapper(preparedProperties);\n\t}\n}\n"],"mappings":"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","ignoreList":[]}