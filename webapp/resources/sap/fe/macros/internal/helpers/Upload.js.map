{"version":3,"file":"Upload.js","names":["showTypeMismatchDialog","source","givenType","acceptedTypes","resourceModel","getResourceModel","MessageBox","error","getText","details","toString","replaceAll","contentWidth","_exports","showFileSizeExceedDialog","maximumFileSize","showFileNameLengthExceedDialog","maximumFileNameLength","displayMessageForFailedUpload","control","messageText","errorObject","JSON","parse","message","e","addHeader","fileUploader","name","value","isA","header","FileUploaderParameter","setName","setValue","addHeaderParameter","Item","key","text","addHeaderField","setHeaderFields","fileType","eTagContext","removeAllHeaderParameters","removeAllHeaderFields","token","getModel","getHttpHeaders","eTag","getProperty","getBindingContext","view","CommonUtils","getTargetView","collaborativeDraft","getController","isConnected"],"sources":["./Upload.ts"],"sourcesContent":["import CommonUtils from \"sap/fe/core/CommonUtils\";\nimport { getResourceModel } from \"sap/fe/core/helpers/ResourceModelHelper\";\nimport MessageBox from \"sap/m/MessageBox\";\nimport type UploadItem from \"sap/m/upload/UploadItem\";\nimport type Control from \"sap/ui/core/Control\";\nimport Item from \"sap/ui/core/Item\";\nimport type Context from \"sap/ui/model/odata/v4/Context\";\nimport type ODataModel from \"sap/ui/model/odata/v4/ODataModel\";\nimport type FileUploader from \"sap/ui/unified/FileUploader\";\nimport FileUploaderParameter from \"sap/ui/unified/FileUploaderParameter\";\n\n/**\n * Shows an error dialog in case of non supported type.\n * @param source The control that raises the error\n * @param givenType The type the user tried to upload\n * @param acceptedTypes Array of supported types\n */\nexport function showTypeMismatchDialog(source: Control, givenType: string, acceptedTypes: string[]): void {\n\tconst resourceModel = getResourceModel(source);\n\tMessageBox.error(resourceModel.getText(\"M_FIELD_FILEUPLOADER_WRONG_MIMETYPE\"), {\n\t\tdetails:\n\t\t\t`<p><strong>${resourceModel.getText(\"M_FIELD_FILEUPLOADER_WRONG_MIMETYPE_DETAILS_SELECTED\")}</strong></p>${givenType}<br><br>` +\n\t\t\t`<p><strong>${resourceModel.getText(\"M_FIELD_FILEUPLOADER_WRONG_MIMETYPE_DETAILS_ALLOWED\")}</strong></p>${acceptedTypes\n\t\t\t\t.toString()\n\t\t\t\t.replaceAll(\",\", \", \")}`,\n\t\tcontentWidth: \"150px\"\n\t} as object);\n}\n\n/**\n * Shows an error dialog in case the file size exceeded.\n * @param source The control that raises the error\n * @param maximumFileSize The supported maximum file size\n */\nexport function showFileSizeExceedDialog(source: Control, maximumFileSize: string): void {\n\tconst resourceModel = getResourceModel(source);\n\tMessageBox.error(resourceModel.getText(\"M_FIELD_FILEUPLOADER_FILE_TOO_BIG\", [maximumFileSize]), {\n\t\tcontentWidth: \"150px\"\n\t} as object);\n}\n\n/**\n * Shows an error dialog in case the file name length exceeded.\n * @param source The control that raises the error\n * @param maximumFileNameLength The supported maximum file name length\n */\nexport function showFileNameLengthExceedDialog(source: Control, maximumFileNameLength: string): void {\n\tconst resourceModel = getResourceModel(source);\n\tMessageBox.error(resourceModel.getText(\"M_FIELD_FILEUPLOADER_FILENAME_TOO_BIG\", [maximumFileNameLength]), {\n\t\tcontentWidth: \"150px\"\n\t} as object);\n}\n\n/**\n * Shows the back-end error message or a standard error text in a message box.\n * @param control The control that raises the error\n * @param error The error text\n */\nexport function displayMessageForFailedUpload(control: Control, error: string): void {\n\tlet messageText, errorObject;\n\ttry {\n\t\terrorObject = error && JSON.parse(error);\n\t\tmessageText = errorObject.error?.message;\n\t} catch (e) {\n\t\tmessageText = error || getResourceModel(control).getText(\"M_FIELD_FILEUPLOADER_ABORTED_TEXT\");\n\t}\n\tMessageBox.error(messageText);\n}\n\nfunction addHeader(fileUploader: FileUploader | UploadItem, name: string, value: string): void {\n\tif (fileUploader.isA<FileUploader>(\"sap.ui.unified.FileUploader\")) {\n\t\tconst header = new FileUploaderParameter();\n\t\theader.setName(name);\n\t\theader.setValue(value);\n\t\tfileUploader.addHeaderParameter(header);\n\t} else if (fileUploader.isA<UploadItem>(\"sap.m.upload.UploadItem\")) {\n\t\tconst header = new Item({\n\t\t\tkey: name,\n\t\t\ttext: value\n\t\t});\n\t\tfileUploader.addHeaderField(header);\n\t}\n}\n\n/**\n * Set request header for the file upload.\n * @param fileUploader The upload control\n * @param fileType The file type\n * @param eTagContext If the eTag is not in the context of the file uploader, it can be passed here\n */\nexport function setHeaderFields(fileUploader: FileUploader | UploadItem, fileType: string, eTagContext?: Context): void {\n\tif (fileUploader.isA<FileUploader>(\"sap.ui.unified.FileUploader\")) {\n\t\tfileUploader.removeAllHeaderParameters();\n\t} else if (fileUploader.isA<UploadItem>(\"sap.m.upload.UploadItem\")) {\n\t\tfileUploader.removeAllHeaderFields();\n\t}\n\tconst token = (fileUploader.getModel() as ODataModel)?.getHttpHeaders()?.[\"X-CSRF-Token\"];\n\n\tif (token) {\n\t\taddHeader(fileUploader, \"x-csrf-token\", token);\n\t}\n\tconst eTag =\n\t\teTagContext?.getProperty(\"@odata.etag\") ??\n\t\t(fileUploader.getBindingContext() as Context | undefined | null)?.getProperty(\"@odata.etag\");\n\tif (eTag) {\n\t\tconst view = CommonUtils.getTargetView(fileUploader);\n\t\tconst collaborativeDraft = view.getController().collaborativeDraft;\n\t\taddHeader(fileUploader, \"If-Match\", collaborativeDraft.isConnected() ? \"*\" : eTag);\n\t}\n\n\taddHeader(fileUploader, \"Accept\", \"application/json\");\n\taddHeader(fileUploader, \"Content-Type\", fileType || \"application/octet-stream\");\n}\n"],"mappings":";;;;oOAiBO,SAASA,EAAuBC,EAAiBC,EAAmBC,GAC1E,MAAMC,EAAgBC,EAAiBJ,GACvCK,EAAWC,MAAMH,EAAcI,QAAQ,uCAAwC,CAC9EC,QACC,cAAcL,EAAcI,QAAQ,uEAAuEN,YAC3G,cAAcE,EAAcI,QAAQ,sEAAsEL,EACxGO,WACAC,WAAW,IAAK,QACnBC,aAAc,SAEhB,CAEAC,EAAAb,yBAKO,SAASc,EAAyBb,EAAiBc,GACzD,MAAMX,EAAgBC,EAAiBJ,GACvCK,EAAWC,MAAMH,EAAcI,QAAQ,oCAAqC,CAACO,IAAmB,CAC/FH,aAAc,SAEhB,CAEAC,EAAAC,2BAKO,SAASE,EAA+Bf,EAAiBgB,GAC/D,MAAMb,EAAgBC,EAAiBJ,GACvCK,EAAWC,MAAMH,EAAcI,QAAQ,wCAAyC,CAACS,IAAyB,CACzGL,aAAc,SAEhB,CAEAC,EAAAG,iCAKO,SAASE,EAA8BC,EAAkBZ,GAC/D,IAAIa,EAAaC,EACjB,IACCA,EAAcd,GAASe,KAAKC,MAAMhB,GAClCa,EAAcC,EAAYd,OAAOiB,OAClC,CAAE,MAAOC,GACRL,EAAcb,GAASF,EAAiBc,GAASX,QAAQ,oCAC1D,CACAF,EAAWC,MAAMa,EAClB,CAACP,EAAAK,gCAED,SAASQ,EAAUC,EAAyCC,EAAcC,GACzE,GAAIF,EAAaG,IAAkB,+BAAgC,CAClE,MAAMC,EAAS,IAAIC,EACnBD,EAAOE,QAAQL,GACfG,EAAOG,SAASL,GAChBF,EAAaQ,mBAAmBJ,EACjC,MAAO,GAAIJ,EAAaG,IAAgB,2BAA4B,CACnE,MAAMC,EAAS,IAAIK,EAAK,CACvBC,IAAKT,EACLU,KAAMT,IAEPF,EAAaY,eAAeR,EAC7B,CACD,CAQO,SAASS,EAAgBb,EAAyCc,EAAkBC,GAC1F,GAAIf,EAAaG,IAAkB,+BAAgC,CAClEH,EAAagB,2BACd,MAAO,GAAIhB,EAAaG,IAAgB,2BAA4B,CACnEH,EAAaiB,uBACd,CACA,MAAMC,EAASlB,EAAamB,YAA2BC,mBAAmB,gBAE1E,GAAIF,EAAO,CACVnB,EAAUC,EAAc,eAAgBkB,EACzC,CACA,MAAMG,EACLN,GAAaO,YAAY,gBACxBtB,EAAauB,qBAAoDD,YAAY,eAC/E,GAAID,EAAM,CACT,MAAMG,EAAOC,EAAYC,cAAc1B,GACvC,MAAM2B,EAAqBH,EAAKI,gBAAgBD,mBAChD5B,EAAUC,EAAc,WAAY2B,EAAmBE,cAAgB,IAAMR,EAC9E,CAEAtB,EAAUC,EAAc,SAAU,oBAClCD,EAAUC,EAAc,eAAgBc,GAAY,2BACrD,CAAC5B,EAAA2B,kBAAA,OAAA3B,CAAA","ignoreList":[]}