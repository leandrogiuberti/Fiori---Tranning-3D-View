{"version":3,"names":["showTypeMismatchDialog","source","givenType","acceptedTypes","resourceModel","getResourceModel","MessageBox","error","getText","details","toString","replaceAll","contentWidth","_exports","showFileSizeExceedDialog","maximumFileSize","showFileNameLengthExceedDialog","maximumFileNameLength","displayMessageForFailedUpload","control","messageText","errorObject","JSON","parse","message","e","addHeader","fileUploader","name","value","isA","header","FileUploaderParameter","setName","setValue","addHeaderParameter","Item","key","text","addHeaderField","setHeaderFields","fileType","eTagContext","removeAllHeaderParameters","removeAllHeaderFields","token","getModel","getHttpHeaders","eTag","getProperty","getBindingContext","view","CommonUtils","getTargetView","collaborativeDraft","getController","isConnected"],"sourceRoot":".","sources":["Upload.ts"],"sourcesContent":["import CommonUtils from \"sap/fe/core/CommonUtils\";\nimport { getResourceModel } from \"sap/fe/core/helpers/ResourceModelHelper\";\nimport MessageBox from \"sap/m/MessageBox\";\nimport type UploadItem from \"sap/m/upload/UploadItem\";\nimport type Control from \"sap/ui/core/Control\";\nimport Item from \"sap/ui/core/Item\";\nimport type Context from \"sap/ui/model/odata/v4/Context\";\nimport type ODataModel from \"sap/ui/model/odata/v4/ODataModel\";\nimport type FileUploader from \"sap/ui/unified/FileUploader\";\nimport FileUploaderParameter from \"sap/ui/unified/FileUploaderParameter\";\n\n/**\n * Shows an error dialog in case of non supported type.\n * @param source The control that raises the error\n * @param givenType The type the user tried to upload\n * @param acceptedTypes Array of supported types\n */\nexport function showTypeMismatchDialog(source: Control, givenType: string, acceptedTypes: string[]): void {\n\tconst resourceModel = getResourceModel(source);\n\tMessageBox.error(resourceModel.getText(\"M_FIELD_FILEUPLOADER_WRONG_MIMETYPE\"), {\n\t\tdetails:\n\t\t\t`<p><strong>${resourceModel.getText(\"M_FIELD_FILEUPLOADER_WRONG_MIMETYPE_DETAILS_SELECTED\")}</strong></p>${givenType}<br><br>` +\n\t\t\t`<p><strong>${resourceModel.getText(\"M_FIELD_FILEUPLOADER_WRONG_MIMETYPE_DETAILS_ALLOWED\")}</strong></p>${acceptedTypes\n\t\t\t\t.toString()\n\t\t\t\t.replaceAll(\",\", \", \")}`,\n\t\tcontentWidth: \"150px\"\n\t} as object);\n}\n\n/**\n * Shows an error dialog in case the file size exceeded.\n * @param source The control that raises the error\n * @param maximumFileSize The supported maximum file size\n */\nexport function showFileSizeExceedDialog(source: Control, maximumFileSize: string): void {\n\tconst resourceModel = getResourceModel(source);\n\tMessageBox.error(resourceModel.getText(\"M_FIELD_FILEUPLOADER_FILE_TOO_BIG\", [maximumFileSize]), {\n\t\tcontentWidth: \"150px\"\n\t} as object);\n}\n\n/**\n * Shows an error dialog in case the file name length exceeded.\n * @param source The control that raises the error\n * @param maximumFileNameLength The supported maximum file name length\n */\nexport function showFileNameLengthExceedDialog(source: Control, maximumFileNameLength: string): void {\n\tconst resourceModel = getResourceModel(source);\n\tMessageBox.error(resourceModel.getText(\"M_FIELD_FILEUPLOADER_FILENAME_TOO_BIG\", [maximumFileNameLength]), {\n\t\tcontentWidth: \"150px\"\n\t} as object);\n}\n\n/**\n * Shows the back-end error message or a standard error text in a message box.\n * @param control The control that raises the error\n * @param error The error text\n */\nexport function displayMessageForFailedUpload(control: Control, error: string): void {\n\tlet messageText, errorObject;\n\ttry {\n\t\terrorObject = error && JSON.parse(error);\n\t\tmessageText = errorObject.error?.message;\n\t} catch (e) {\n\t\tmessageText = error || getResourceModel(control).getText(\"M_FIELD_FILEUPLOADER_ABORTED_TEXT\");\n\t}\n\tMessageBox.error(messageText);\n}\n\nfunction addHeader(fileUploader: FileUploader | UploadItem, name: string, value: string): void {\n\tif (fileUploader.isA<FileUploader>(\"sap.ui.unified.FileUploader\")) {\n\t\tconst header = new FileUploaderParameter();\n\t\theader.setName(name);\n\t\theader.setValue(value);\n\t\tfileUploader.addHeaderParameter(header);\n\t} else if (fileUploader.isA<UploadItem>(\"sap.m.upload.UploadItem\")) {\n\t\tconst header = new Item({\n\t\t\tkey: name,\n\t\t\ttext: value\n\t\t});\n\t\tfileUploader.addHeaderField(header);\n\t}\n}\n\n/**\n * Set request header for the file upload.\n * @param fileUploader The upload control\n * @param fileType The file type\n * @param eTagContext If the eTag is not in the context of the file uploader, it can be passed here\n */\nexport function setHeaderFields(fileUploader: FileUploader | UploadItem, fileType: string, eTagContext?: Context): void {\n\tif (fileUploader.isA<FileUploader>(\"sap.ui.unified.FileUploader\")) {\n\t\tfileUploader.removeAllHeaderParameters();\n\t} else if (fileUploader.isA<UploadItem>(\"sap.m.upload.UploadItem\")) {\n\t\tfileUploader.removeAllHeaderFields();\n\t}\n\tconst token = (fileUploader.getModel() as ODataModel)?.getHttpHeaders()?.[\"X-CSRF-Token\"];\n\n\tif (token) {\n\t\taddHeader(fileUploader, \"x-csrf-token\", token);\n\t}\n\tconst eTag =\n\t\teTagContext?.getProperty(\"@odata.etag\") ??\n\t\t(fileUploader.getBindingContext() as Context | undefined | null)?.getProperty(\"@odata.etag\");\n\tif (eTag) {\n\t\tconst view = CommonUtils.getTargetView(fileUploader);\n\t\tconst collaborativeDraft = view.getController().collaborativeDraft;\n\t\taddHeader(fileUploader, \"If-Match\", collaborativeDraft.isConnected() ? \"*\" : eTag);\n\t}\n\n\taddHeader(fileUploader, \"Accept\", \"application/json\");\n\taddHeader(fileUploader, \"Content-Type\", fileType || \"application/octet-stream\");\n}\n"],"mappings":"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","ignoreList":[],"file":"Upload-dbg.js"}