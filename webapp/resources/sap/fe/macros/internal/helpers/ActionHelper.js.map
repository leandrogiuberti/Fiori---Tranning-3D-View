{"version":3,"file":"ActionHelper.js","names":["ActionHelper","getMultiSelectDisabledActions","collections","multiSelectDisabledActions","actions","filter","collection","$Type","action","actionTarget","ActionTarget","isBound","parameter","parameters","isPathAnnotationExpression","annotations","UI","Hidden","Common","FieldControl","push","name","getPressEventDataFieldForActionButton","sId","oAction","oParams","sOperationAvailableMap","sInvocationGrouping","InvocationGrouping","$EnumMember","CommonHelper","addSingleQuotes","Label","generateFunction","Action","objectToString","getNumberOfContextsExpression","vActionEnabled","forContextMenu","arguments","length","undefined","sNumberOfSelectedContexts","selectedContext","getOperationAvailableMap","control","context","operationAvailableMap","forEach","record","actionName","includes","Determining","this","_getOperationAvailableMapOfTable","_getOperationAvailableMapOfChart","recursiveMap","Actions","oDataFieldForAction","sActionName","oOperationAvailableMap","oConverterContext","Core","OperationAvailable","bindingParameterFullName","fullyQualifiedName","targetExpression","getExpressionFromAnnotation","path","bindingContextPathVisitor","getConvertedTypes","isPathInModelExpression","_addToMap","oContext","oResult","getActionPath","sProperty","substring","sBindingParameter","sKey","oValue","oMap","ensurePrimaryActionNeverOverflows","map","priority","isPrimaryAction","isEmphasized","emphasized","type","hasCriticality","criticality"],"sources":["./ActionHelper.ts"],"sourcesContent":["import type { DataFieldAbstractTypes, OperationGroupingType } from \"@sap-ux/vocabularies-types/vocabularies/UI\";\nimport { UIAnnotationTypes, type DataFieldForAction } from \"@sap-ux/vocabularies-types/vocabularies/UI\";\nimport { getExpressionFromAnnotation, isPathInModelExpression } from \"sap/fe/base/BindingToolkit\";\nimport type ConverterContext from \"sap/fe/core/converters/ConverterContext\";\nimport { bindingContextPathVisitor } from \"sap/fe/core/helpers/BindingHelper\";\nimport { isPathAnnotationExpression } from \"sap/fe/core/helpers/TypeGuards\";\nimport type { ComputedAnnotationInterface } from \"sap/fe/core/templating/UIFormatters\";\nimport CommonHelper from \"sap/fe/macros/CommonHelper\";\nimport type { MetaModelEnum, MetaModelType } from \"../../../../../../../../types/metamodel_types\";\n\nconst ActionHelper = {\n\t/**\n\t * Returns an array of actions that are not enabled with a multiple selection.\n\t * @param collections Array of records\n\t * @returns An array of action paths\n\t */\n\tgetMultiSelectDisabledActions(collections?: DataFieldAbstractTypes[]): string[] {\n\t\tconst multiSelectDisabledActions: string[] = [];\n\t\tconst actions = (collections?.filter((collection) => collection.$Type === UIAnnotationTypes.DataFieldForAction) ??\n\t\t\t[]) as DataFieldForAction[];\n\t\tfor (const action of actions) {\n\t\t\tconst actionTarget = action?.ActionTarget;\n\t\t\tif (actionTarget?.isBound === true) {\n\t\t\t\tfor (const parameter of actionTarget.parameters) {\n\t\t\t\t\tif (\n\t\t\t\t\t\tisPathAnnotationExpression(parameter.annotations.UI?.Hidden) ||\n\t\t\t\t\t\tisPathAnnotationExpression(parameter.annotations.Common?.FieldControl)\n\t\t\t\t\t) {\n\t\t\t\t\t\tmultiSelectDisabledActions.push(actionTarget.name);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\treturn multiSelectDisabledActions;\n\t},\n\n\t/**\n\t * Method to get the expression for the 'press' event for the DataFieldForActionButton.\n\t * @param sId Control ID\n\t * @param oAction Action object\n\t * @param oParams Parameters\n\t * @param oParams.invocationGrouping Invocation grouping\n\t * @param oParams.controlId Control ID\n\t * @param oParams.operationAvailableMap OperationAvailableMap\n\t * @param oParams.model Model\n\t * @param oParams.label Label\n\t * @param oParams.contexts Contexts\n\t * @param sOperationAvailableMap OperationAvailableMap as stringified JSON object\n\t * @returns The binding expression\n\t */\n\tgetPressEventDataFieldForActionButton(\n\t\tsId: string,\n\t\toAction: MetaModelType<DataFieldForAction> & { InvocationGrouping: MetaModelEnum<OperationGroupingType> },\n\t\toParams: {\n\t\t\tinvocationGrouping?: string;\n\t\t\tcontrolId?: string;\n\t\t\toperationAvailableMap?: string;\n\t\t\tmodel?: string;\n\t\t\tlabel?: string;\n\t\t\tcontexts?: string;\n\t\t},\n\t\tsOperationAvailableMap: string\n\t): string {\n\t\tconst sInvocationGrouping =\n\t\t\toAction.InvocationGrouping &&\n\t\t\toAction.InvocationGrouping.$EnumMember === \"com.sap.vocabularies.UI.v1.OperationGroupingType/ChangeSet\"\n\t\t\t\t? \"ChangeSet\"\n\t\t\t\t: \"Isolated\";\n\t\toParams = oParams || {};\n\t\toParams[\"invocationGrouping\"] = CommonHelper.addSingleQuotes(sInvocationGrouping);\n\t\toParams[\"controlId\"] = CommonHelper.addSingleQuotes(sId);\n\t\toParams[\"operationAvailableMap\"] = CommonHelper.addSingleQuotes(sOperationAvailableMap);\n\t\toParams[\"model\"] = \"${$source>/}.getModel()\";\n\t\toParams[\"label\"] = oAction.Label && CommonHelper.addSingleQuotes(oAction.Label, true);\n\n\t\treturn CommonHelper.generateFunction(\n\t\t\t\".editFlow.invokeAction\",\n\t\t\tCommonHelper.addSingleQuotes(oAction.Action!),\n\t\t\tCommonHelper.objectToString(oParams)\n\t\t);\n\t},\n\t/**\n\t * Return Number of contexts expression.\n\t * @param vActionEnabled Status of action (single or multiselect)\n\t * @param forContextMenu Indicates if the action appears in the context menu. If false, the action appears in the table toolbar\n\t * @returns Number of contexts expression\n\t */\n\tgetNumberOfContextsExpression(vActionEnabled: string, forContextMenu = false): string {\n\t\tlet sNumberOfSelectedContexts;\n\t\tconst selectedContext = !forContextMenu\n\t\t\t? \"${internal>numberOfSelectedContexts}\"\n\t\t\t: \"${internal>contextmenu/numberOfSelectedContexts}\";\n\t\tif (vActionEnabled === \"single\") {\n\t\t\tsNumberOfSelectedContexts = selectedContext + \" === 1\";\n\t\t} else {\n\t\t\tsNumberOfSelectedContexts = selectedContext + \" > 0\";\n\t\t}\n\t\treturn sNumberOfSelectedContexts;\n\t},\n\t/**\n\t * Return UI Control (LineItem/Chart) Operation Available Map.\n\t * @param collection Array of records\n\t * @param control Control name (lineItem / chart)\n\t * @param context Converter context\n\t * @returns The record containing all action names and their corresponding Core.OperationAvailable property paths\n\t */\n\tgetOperationAvailableMap(\n\t\tcollection: DataFieldAbstractTypes[] | undefined,\n\t\tcontrol: string,\n\t\tcontext: ConverterContext<unknown> | ComputedAnnotationInterface\n\t): Record<string, unknown> {\n\t\tlet operationAvailableMap: Record<string, unknown> = {};\n\t\tif (collection) {\n\t\t\tcollection.forEach((record: DataFieldAbstractTypes) => {\n\t\t\t\tif (record.$Type === UIAnnotationTypes.DataFieldForAction) {\n\t\t\t\t\tconst actionName = record.Action as string;\n\t\t\t\t\tif (!actionName?.includes(\"/\") && !record.Determining) {\n\t\t\t\t\t\tif (control === \"table\") {\n\t\t\t\t\t\t\toperationAvailableMap = this._getOperationAvailableMapOfTable(\n\t\t\t\t\t\t\t\trecord,\n\t\t\t\t\t\t\t\tactionName,\n\t\t\t\t\t\t\t\toperationAvailableMap,\n\t\t\t\t\t\t\t\tcontext as ConverterContext<unknown>\n\t\t\t\t\t\t\t);\n\t\t\t\t\t\t} else if (control === \"chart\") {\n\t\t\t\t\t\t\toperationAvailableMap = this._getOperationAvailableMapOfChart(\n\t\t\t\t\t\t\t\tactionName,\n\t\t\t\t\t\t\t\toperationAvailableMap,\n\t\t\t\t\t\t\t\tcontext as ComputedAnnotationInterface\n\t\t\t\t\t\t\t);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t} else if (record.$Type === UIAnnotationTypes.DataFieldForActionGroup) {\n\t\t\t\t\t// Merge recursive results with current operationAvailableMap\n\t\t\t\t\tconst recursiveMap: Record<string, unknown> = this.getOperationAvailableMap(record.Actions, control, context);\n\t\t\t\t\toperationAvailableMap = { ...operationAvailableMap, ...recursiveMap };\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t\treturn operationAvailableMap;\n\t},\n\n\t/**\n\t * Return LineItem Action Operation Available Map.\n\t * @private\n\t * @param oDataFieldForAction Data field for action object\n\t * @param sActionName Action name\n\t * @param oOperationAvailableMap Operation available map object\n\t * @param oConverterContext Converter context object\n\t * @returns The record containing all action name of line item and the corresponding Core.OperationAvailable property path\n\t */\n\t_getOperationAvailableMapOfTable(\n\t\toDataFieldForAction: DataFieldForAction,\n\t\tsActionName: string,\n\t\toOperationAvailableMap: Record<string, unknown>,\n\t\toConverterContext: ConverterContext<unknown>\n\t): Record<string, unknown> {\n\t\tconst actionTarget = oDataFieldForAction.ActionTarget;\n\t\tif (actionTarget?.annotations?.Core?.OperationAvailable === null) {\n\t\t\t// We disabled action advertisement but kept it in the code for the time being\n\t\t\t//oOperationAvailableMap = this._addToMap(sActionName, null, oOperationAvailableMap);\n\t\t} else if (actionTarget?.parameters?.length) {\n\t\t\tconst bindingParameterFullName = actionTarget.parameters[0].fullyQualifiedName,\n\t\t\t\ttargetExpression = getExpressionFromAnnotation(\n\t\t\t\t\tactionTarget?.annotations?.Core?.OperationAvailable,\n\t\t\t\t\t[],\n\t\t\t\t\tundefined,\n\t\t\t\t\t(path: string) => bindingContextPathVisitor(path, oConverterContext.getConvertedTypes(), bindingParameterFullName)\n\t\t\t\t);\n\t\t\tif (isPathInModelExpression(targetExpression)) {\n\t\t\t\toOperationAvailableMap = this._addToMap(sActionName, targetExpression.path, oOperationAvailableMap);\n\t\t\t} else if (actionTarget?.annotations?.Core?.OperationAvailable !== undefined) {\n\t\t\t\toOperationAvailableMap = this._addToMap(sActionName, targetExpression, oOperationAvailableMap);\n\t\t\t}\n\t\t}\n\t\treturn oOperationAvailableMap;\n\t},\n\n\t/**\n\t * Return LineItem Action Operation Available Map.\n\t * @private\n\t * @param sActionName Action name\n\t * @param oOperationAvailableMap Operation available map object\n\t * @param oContext Context object\n\t * @param oContext.context Context object\n\t * @returns The record containing all action name of chart and the corresponding Core.OperationAvailable property path\n\t */\n\t_getOperationAvailableMapOfChart(\n\t\tsActionName: string,\n\t\toOperationAvailableMap: Record<string, unknown>,\n\t\toContext: ComputedAnnotationInterface\n\t): Record<string, unknown> {\n\t\tlet oResult = CommonHelper.getActionPath(oContext.context, false, sActionName, true);\n\t\tif (oResult === null) {\n\t\t\toOperationAvailableMap = this._addToMap(sActionName, null, oOperationAvailableMap);\n\t\t} else {\n\t\t\toResult = CommonHelper.getActionPath(oContext.context, false, sActionName) as {\n\t\t\t\tsContextPath: string;\n\t\t\t\tsProperty: string;\n\t\t\t\tsBindingParameter: string;\n\t\t\t};\n\t\t\tif (oResult.sProperty) {\n\t\t\t\toOperationAvailableMap = this._addToMap(\n\t\t\t\t\tsActionName,\n\t\t\t\t\toResult.sProperty.substring(oResult.sBindingParameter.length + 1),\n\t\t\t\t\toOperationAvailableMap\n\t\t\t\t);\n\t\t\t}\n\t\t}\n\t\treturn oOperationAvailableMap;\n\t},\n\n\t/**\n\t * Return Map.\n\t * @private\n\t * @param sKey Key\n\t * @param oValue Value\n\t * @param oMap Map object\n\t * @returns Map object\n\t */\n\t_addToMap(sKey: string, oValue: unknown, oMap: Record<string, unknown>): Record<string, unknown> {\n\t\tif (sKey && oMap) {\n\t\t\toMap[sKey] = oValue;\n\t\t}\n\t\treturn oMap;\n\t},\n\n\t/**\n\t * Ensures primary actions never overflow by setting priority to NeverOverflow.\n\t * Primary action = emphasized OR has criticality defined.\n\t * @param actions Array of actions to process\n\t * @returns Processed actions with primary action overflow protection\n\t */\n\tensurePrimaryActionNeverOverflows<T extends Record<string, unknown>>(actions: T[]): T[] {\n\t\treturn actions.map((action) =>\n\t\t\taction.priority === \"NeverOverflow\" || !this.isPrimaryAction(action) ? action : { ...action, priority: \"NeverOverflow\" }\n\t\t);\n\t},\n\n\t/**\n\t * Determines if an action is a primary action.\n\t * Primary action = emphasized OR has criticality defined.\n\t * @param action Action to check\n\t * @returns True if action is primary\n\t */\n\tisPrimaryAction(action: Record<string, unknown>): boolean {\n\t\t// Check if action is emphasized\n\t\tconst isEmphasized = action.emphasized === true || action.type === \"Emphasized\";\n\n\t\t// Check if action has criticality defined\n\t\tconst hasCriticality = action.criticality !== undefined && action.criticality !== null;\n\n\t\treturn isEmphasized || hasCriticality;\n\t}\n};\n\nexport default ActionHelper;\n"],"mappings":"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","ignoreList":[]}