/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)
 *      (c) Copyright 2009-2025 SAP SE. All rights reserved
 */
sap.ui.define(["sap/base/Log","sap/base/util/ObjectPath","sap/fe/core/CommonUtils","sap/fe/core/converters/MetaModelConverter","sap/fe/core/helpers/MetaModelFunction","sap/fe/core/helpers/MetaPath","sap/fe/core/templating/PropertyHelper","sap/fe/core/templating/UIFormatters","sap/fe/macros/CommonHelper","sap/m/table/Util","sap/ui/core/Fragment","sap/ui/core/ResizeHandler","sap/ui/core/XMLTemplateProcessor","sap/ui/core/util/XMLPreprocessor","sap/ui/dom/units/Rem","sap/ui/mdc/valuehelp/content/Conditions","sap/ui/mdc/valuehelp/content/MDCTable","sap/ui/mdc/valuehelp/content/MTable","sap/ui/model/json/JSONModel"],function(e,t,n,a,o,i,r,s,l,c,u,p,d,f,m,g,h,P,v){"use strict";var y={};var C=s.getTypeConfig;var b=s.getDisplayMode;var I=r.getAssociatedUnitProperty;var $=r.getAssociatedTimezoneProperty;var V=r.getAssociatedTextProperty;var L=r.getAssociatedCurrencyProperty;var T=o.isPropertyFilterable;var M=o.getSortRestrictionsInfo;var O=a.convertTypes;const _=(e,t)=>!e.some(e=>e.path===t);const S="@com.sap.vocabularies.Common.v1.Label",x="@com.sap.vocabularies.Common.v1.Text",F="@com.sap.vocabularies.Common.v1.Text@com.sap.vocabularies.UI.v1.TextArrangement",H="com.sap.vocabularies.Common.v1.ValueListParameterIn",A="com.sap.vocabularies.Common.v1.ValueListParameterConstant",D="com.sap.vocabularies.Common.v1.ValueListParameterOut",w="com.sap.vocabularies.Common.v1.ValueListParameterInOut",j="@com.sap.vocabularies.Common.v1.ValueListWithFixedValues",E="@com.sap.vocabularies.PersonalData.v1.IsPotentiallySensitive",U="@com.sap.vocabularies.Common.v1.ValueListRelevantQualifiers";y.AnnotationLabel=S;y.AnnotationsValueListRelevantQualifiers=U;y.AnnotationsPersonalDataPotentiallySensitive=E;y.AnnotationValueListWithFixedValues=j;y.AnnotationValueListParameterInOut=w;y.AnnotationValueListParameterOut=D;y.AnnotationValueListParameterConstant=A;y.AnnotationValueListParameterIn=H;y.AnnotationTextUITextArrangement=F;y.AnnotationText=x;function N(e){let t;const n=e.$model.getMetaModel();const a=n.getObject(`/${e.CollectionPath}@`)||{};const o=M(a);const i=e.Parameters.find(function(t){return(t.$Type==="com.sap.vocabularies.Common.v1.ValueListParameterInOut"||t.$Type==="com.sap.vocabularies.Common.v1.ValueListParameterOut"||t.$Type==="com.sap.vocabularies.Common.v1.ValueListParameterDisplayOnly")&&!(n.getObject(`/${e.CollectionPath}/${t.ValueListProperty}@com.sap.vocabularies.UI.v1.Hidden`)===true)});if(i){if(n.getObject(`/${e.CollectionPath}/${i.ValueListProperty}@com.sap.vocabularies.Common.v1.Text@com.sap.vocabularies.UI.v1.TextArrangement/$EnumMember`)==="com.sap.vocabularies.UI.v1.TextArrangementType/TextOnly"){t=n.getObject(`/${e.CollectionPath}/${i.ValueListProperty}@com.sap.vocabularies.Common.v1.Text/$Path`)}else{t=i.ValueListProperty}}if(t&&(!o.propertyInfo[t]||o.propertyInfo[t].sortable)){return t}else{return undefined}}function W(e,t){const n=t.find(function(t){return e.ValueListProperty===t.textColumnName});if(e.ValueListProperty===n?.textColumnName&&!n.keyColumnHidden&&n.keyColumnDisplayFormat!=="Value"){return true}return undefined}function B(e){return e.Parameters.some(function(e){return e["@com.sap.vocabularies.UI.v1.Importance"]&&e["@com.sap.vocabularies.UI.v1.Importance"].$EnumMember==="com.sap.vocabularies.UI.v1.ImportanceType/High"})}function R(e){const t=e.getModel("viewData");if(t){const e=t.getData();if(e){const t=e.columns;if(t){return t.reduce(function(e,t){if(t.path&&!t.path.includes("/")){e=e?`${e},${t.path}`:t.path}return e},undefined)}}}return undefined}function k(e,t){const a=n.computeDisplayMode(e);const o=e&&e["@com.sap.vocabularies.Common.v1.Text"];const i=o&&e["@com.sap.vocabularies.Common.v1.Text@com.sap.vocabularies.UI.v1.TextArrangement"];if(t){return o&&typeof o!=="string"&&"$Path"in o&&o.$Path?a:"Value"}else{return i?a:"Value"}}function Q(e){const t=e.PresentationVariantQualifier?`#${e.PresentationVariantQualifier}`:"";const n=`/${e.CollectionPath}/@com.sap.vocabularies.UI.v1.PresentationVariant${t}`;return e.$model.getMetaModel().getObject(n)}const q={getValueListCollectionEntitySet:function(e){const t=e.getObject();return t.$model.getMetaModel().createBindingContext(`/${t.CollectionPath}`)},isTreeTableType(e){return Q(e)?.RecursiveHierarchyQualifier?true:false},getTableDelegate:function(e){let t=N(e);if(t){t=`'${t}'`}const n=Q(e);const a=n?.RecursiveHierarchyQualifier;if(a){const o=n.InitialExpansionLevel;return"{name: 'sap/fe/macros/internal/valuehelp/TableDelegate', payload: {collectionName: '"+e.CollectionPath+"'"+(t?", defaultSortPropertyName: "+t:"")+", hierarchyQualifier: '"+a+"'"+(o?", initialExpansionLevel: "+(o+1):"")+"}}"}return"{name: 'sap/fe/macros/internal/valuehelp/TableDelegate', payload: {collectionName: '"+e.CollectionPath+"'"+(t?", defaultSortPropertyName: "+t:"")+"}}"},getSortConditionsFromPresentationVariant:function(e,t){let n=arguments.length>2&&arguments[2]!==undefined?arguments[2]:false;const a=Q(e);if(a?.SortOrder){const e={sorters:[]};a.SortOrder.forEach(function(n){const a={},o=n?.Property?.$PropertyPath;if(t){a.path=o}else{a.name=o}if(n.Descending){a.descending=true}else{a.ascending=true}e.sorters.push(a)});const o=n?l.stringifyCustomData:JSON.stringify;return t?`sorter: ${o(e.sorters)}`:o(e)}return},getSortConditionsForValueList:function(e,t){const n=q.getSortConditionsFromPresentationVariant(e,false);if(n){return n}if(t){const t={sorters:[{name:N(e),ascending:true}]};return JSON.stringify(t)}},getPropertyPath:function(e){return!e.UnboundAction?`${e.EntityTypePath}/${e.Action}/${e.Property}`:`/${e.Action.substring(e.Action.lastIndexOf(".")+1)}/${e.Property}`},getValueListProperty:function(e){const t=e.getModel();const n=t.getObject("/");return n.$model.getMetaModel().createBindingContext(`/${n.CollectionPath}/${e.getObject()}`)},getColumnVisibility:function(e,t,n){const a=n&&!!n.valueHelpWithFixedValues,o=n.columnInfo,i=!W(t,o.columnInfos),r=o.isDialogTable;if(a||!a&&r||!a&&!B(e)){const e=o.columnInfos.find(function(e){return t.ValueListProperty===e.columnName&&e.hasHiddenAnnotation===true});return!e?i:false}else if(!a&&B(e)){return t&&t["@com.sap.vocabularies.UI.v1.Importance"]&&t["@com.sap.vocabularies.UI.v1.Importance"].$EnumMember==="com.sap.vocabularies.UI.v1.ImportanceType/High"?true:false}return true},getColumnVisibilityInfo:function(e,t,n,a){const o=e.$model.getMetaModel();const i=[];const r={isDialogTable:a,columnInfos:i};e.Parameters.forEach(function(t){const a=o.getObject(`/${e.CollectionPath}/${t.ValueListProperty}@`);const i=a&&a["@com.sap.vocabularies.Common.v1.Text"];let s={};if(i){s={keyColumnHidden:a["@com.sap.vocabularies.UI.v1.Hidden"]?true:false,keyColumnDisplayFormat:i&&k(a,n),textColumnName:i&&i.$Path,columnName:t.ValueListProperty,hasHiddenAnnotation:a&&a["@com.sap.vocabularies.UI.v1.Hidden"]?true:false}}else if(a&&a["@com.sap.vocabularies.UI.v1.Hidden"]){s={columnName:t.ValueListProperty,hasHiddenAnnotation:a&&a["@com.sap.vocabularies.UI.v1.Hidden"]?true:false}}r.columnInfos.push(s)});return r},getTableItemsParameters:function(e,t,n,a){const o=[`path: '/${e.CollectionPath}'`];const i=R(this);if(t){const e=i?`, '${i}'`:"";o.push(`parameters: {$$sharedRequest: false, $$updateGroupId: "donotsubmit", $$groupId: '${t}'${e}}`)}else if(i){o.push(`parameters: {$$sharedRequest: false, $$updateGroupId: "donotsubmit", $select: '${i}'}`)}const r=e.Parameters.some(function(e){return n||e.$Type==="com.sap.vocabularies.Common.v1.ValueListParameterIn"});o.push(`suspended: ${r}`);if(!a){o.push("length: 10")}const s=q.getSortConditionsFromPresentationVariant(e,n);if(s){o.push(s)}else if(a){const t=N(e);if(t){o.push(`sorter: [{path: '${t}', ascending: true}]`)}}return"{"+o.join(", ")+"}"},hasImportance:function(e){return B(e.getObject())?"Importance/High":"None"},getMinScreenWidth:function(e){return B(e)?"{= ${_VHUI>/minScreenWidth}}":"416px"},getColumnWidth:function(a){let o=arguments.length>1&&arguments[1]!==undefined?arguments[1]:false;if(n.isSmallDevice()||!a.targetObject)return;const i=a.targetObject;let r=[i];const s=V(i)||L(i)||I(i)||$(i),l=i.annotations?.Common?.Text,u=l?.annotations?.UI?.TextArrangement?.toString(),p=i.annotations?.Common?.Label?.toString();let d;if(o&&!u){d=b(a)}else{d=u&&b(a)}if(s){if(d==="Description"){r=[s]}else if(!l||d&&d!=="Value"){r.push(s)}}let f=0;const m=[];r.forEach(e=>{const n=C(e,undefined);const a=t.get(n.type);if(a){m.push(new a(n.formatOptions,n.constraints))}});const g=c.calcColumnWidth(m,p);f=g?parseFloat(g.replace("rem","")):0;if(f===0){e.error(`Cannot compute the column width for property: ${i.name}`)}return f<=20?f.toString()+"rem":"20rem"},getOutParameterPaths:function(e){let t="";e.forEach(function(e){if(e.$Type.endsWith("Out")){t+=`{${e.ValueListProperty}}`}});return t},entityIsSearchable:function(e,t){const n=e["@com.sap.vocabularies.Common.v1.ValueList"]?.SearchSupported,a=t["@Org.OData.Capabilities.V1.SearchRestrictions"]?.Searchable;if(a===undefined&&n===false||a===true&&n===false||a===false){return false}return true},_getConditionPath:function(e,t,n){const a=n.split("/");let o="",i;while(a.length){let n=a.shift();i=i?`${i}/${n}`:n;const r=e.getObject(`${t}/${i}`);if(r&&r.$kind==="NavigationProperty"&&r.$isCollection){n+="*"}o=o?`${o}/${n}`:n}return o},_getColumnDefinitionFromSelectionFields:function(e,t){const n=[],a=e.getObject(`${t}/@`),o=a["@com.sap.vocabularies.UI.v1.SelectionFields"];if(o){o.forEach(function(a){const o=`${t}/${a.$PropertyPath}`,i=q._getConditionPath(e,t,a.$PropertyPath),r=e.getObject(`${o}@`),s={path:i,label:r?.[S]||o,sortable:true,filterable:T(e,t,a.$PropertyPath,false),$Type:e.getObject(o)?.$Type};n.push(s)})}return n},_mergeColumnDefinitionsFromProperties:function(e,t,n,a,o){let i=n,r=a.$Type;const s=o[S]||i,l=o[x];if(l&&o[F]?.$EnumMember==="com.sap.vocabularies.UI.v1.TextArrangementType/TextOnly"){i=l.$Path;const e=`/${t.CollectionPath}/${i}`;r=t.$model.getMetaModel()?.getObject(e)?.$Type}if(_(e,i)){const t={path:i,textPath:l?.$Path&&n.includes("/")?n.substring(0,n.lastIndexOf("/"))+"/"+l.$Path:l?.$Path,label:s,sortable:true,filterable:!o["@com.sap.vocabularies.UI.v1.HiddenFilter"],$Type:r};e.push(t)}},filterInOutParameters:function(e,t){return e.filter(function(e){return t.includes(e.parmeterType)})},getInParameters:function(e){return q.filterInOutParameters(e,[H,A,w])},getOutParameters:function(e){return q.filterInOutParameters(e,[D,w])},createVHUIModel:function(e,t,n){const a=new v({}),o=n.getObject(`${t}@`);e.setModel(a,"_VHUI");a.setProperty("/hasValueListRelevantQualifiers",!!o[U]);a.setProperty("/propertyLabel",o[S]);return a},_getDialogTitle:function(e,t){const n=e.getModel("_VHUI").getProperty("/propertyLabel");const a=e.getControl()?.getProperty("label");return e.getModel("_VHUI").getProperty("/hasValueListRelevantQualifiers")?t||n||a:a||n||t},destroyVHContent:function(e){if(e){e.getDialog()?.destroyContent();e.getTypeahead()?.destroyContent()}},putDefaultQualifierFirst:function(e){const t=e.indexOf("");if(t>0){e.unshift(e[t]);e.splice(t+1,1)}return e},_getContextPrefix:function(e,t){if(e&&e.getPath()){const n=e.getPath().split("/");if(t.length-n.length>1){const e=[];for(let a=n.length;a<t.length-1;a++){e.push(t[a])}return`${e.join("/")}/`}}return""},_getVhParameter:function(e,t,n,a,o,r){let s="";const l=t?.getBindingContext();if(e&&e.length>0){if(t?.getParent()?.isA("sap.ui.mdc.Table")===true&&l&&q._parameterIsA(a,["com.sap.vocabularies.Common.v1.ValueListParameterIn","com.sap.vocabularies.Common.v1.ValueListParameterInOut"])){const e=r.split("/");if(e.length>1){const n=e[0];const a=o.getMetaContext(l.getPath());const i=t.getParent().getRowBinding().getPath();if(a.getObject(`${i}/$Partner`)===n){s=r}}}else if(t?.getParent()?.getParent()?.getParent()?.isA("sap.fe.macros.filterBar.FilterBarAPI")===true&&l&&q._parameterIsA(a,["com.sap.vocabularies.Common.v1.ValueListParameterIn","com.sap.vocabularies.Common.v1.ValueListParameterInOut"])){const e=t.getParent()?.getParent()?.getParent();const n=e.metaPath;const a=o.getMetaPath(l.getPath());const c=new i(O(o),a,a);const u=new i(O(o),n,a);const p=u.getMetaPathForPath(r);if(p&&p.getTarget()){const e=p.getClosestEntitySet();if(e===c.getClosestEntitySet()){s=c.getMetaPathForObject(p.getTarget())?.getRelativePath()}}}if(!s){s=e+">/conditions/"+r}}else{s=n+r}return{parmeterType:a.$Type,source:s,helpPath:a.ValueListProperty,constantValue:a.Constant,initialValueIsSignificant:Boolean(a.InitialValueIsSignificant)}},_parameterIsA(e,t){return t.includes(e.$Type)},_enrichPath:function(e,t,n,a,o,i,r){if(!e.key&&q._parameterIsA(a,["com.sap.vocabularies.Common.v1.ValueListParameterInOut"])&&n===o){const n=r?.split("/").pop();a.ValueListProperty=n?n:a.ValueListProperty;e.fieldPropertyPath=t;e.key=a.ValueListProperty;e.descriptionPath=i[x]?.$Path||""}},_enrichKeys:function(e,t){if(q._parameterIsA(t,q.getInAndOutParametersList())&&!e.includes(t.ValueListProperty)){e.push(t.ValueListProperty)}},_getEntityType:async function(e,t){return e.getObject(`${t}/`)||await e.requestObject(`${t}/`)},_processParameters:function(t,n,a,o,i,r,s,l,c){const u=l?.useMultiValueField;const p=t.$model.getMetaModel(),d=`/${t.CollectionPath}`;if(c===undefined){e.error(`Inconsistent value help metadata: Entity ${d} is not defined`);return}const f=q._getColumnDefinitionFromSelectionFields(p,d),m=[],g={fieldPropertyPath:"",descriptionPath:"",key:""};let h=[];if("$Key"in c&&c.$Key){h=[...c.$Key]}const P=h[0];for(const e of t.Parameters){const s=`/${t.CollectionPath}/${e.ValueListProperty}`,c=p.getObject(s),d=l?.externalIdPath?p.getObject(`/${l?.externalIdPath}@`)||{}:p.getObject(`${s}@`)||{},P=e.LocalDataProperty?.$PropertyPath||"";if(l&&d[E]){l.isPotentiallySensitive=true}if(c){q._enrichPath(g,s,P,e,n,d,l?.externalIdPath);const a=e.ValueListProperty;q._mergeColumnDefinitionsFromProperties(f,t,a,c,d)}if(q._parameterIsA(e,["com.sap.vocabularies.Common.v1.ValueListParameterIn","com.sap.vocabularies.Common.v1.ValueListParameterOut","com.sap.vocabularies.Common.v1.ValueListParameterInOut"])&&P!==n||q._parameterIsA(e,["com.sap.vocabularies.Common.v1.ValueListParameterOut"])){const t=q._getVhParameter(a,o,i,e,r,P);if(!u||u&&q._parameterIsA(e,["com.sap.vocabularies.Common.v1.ValueListParameterIn"])){m.push(t)}}if(e.$Type===A){m.push({parmeterType:e.$Type,source:e.ValueListProperty,helpPath:e.ValueListProperty,constantValue:e.Constant,initialValueIsSignificant:Boolean(e.InitialValueIsSignificant)})}q._enrichKeys(h,e)}if(!g.key){g.key=P;const e=`/${t.CollectionPath}/${P}`;const n=p.getObject(`${e}@`)||{};g.descriptionPath=n[x]?.$Path||""}for(const e of h){if(_(f,e)){const n={path:e,$Type:p.getObject(`/${t.CollectionPath}/${g.key}`)?.$Type,label:"",sortable:false,filterable:undefined};f.push(n)}}const v={keyPath:g.key,descriptionPath:g.descriptionPath,fieldPropertyPath:g.fieldPropertyPath,vhKeys:h,vhParameters:m,valueListInfo:t,columnDefs:f,valueHelpQualifier:s};return v},_logError:function(t,n){const a=n?n.status:undefined;const o=n instanceof Error?n.message:String(n);const i=a===404?`Metadata not found (${a}) for value help of property ${t}`:o;e.error(i)},getValueListInfo:async function(e,t,n,a){const o=e?.getBindingContext(),i=n?.conditionModel,r=[],s=t.split("/");try{const l=await a.requestValueListInfo(t,true,o);const c=q.putDefaultQualifierFirst(Object.keys(l)),u=s.pop();const p=n?.useMultiValueField===true?q._getContextPrefix(o,s):"";for(const t of c){const o=l[t];const s=o.$model.getMetaModel(),c=`/${o.CollectionPath}`;const d=await q._getEntityType(s,c);const f=q._processParameters(o,u,i,e,p,a,o.$qualifier??t,n,d);if(f){r.push(f)}}}catch(n){this._logError(t,n);q.destroyVHContent(e)}return r},ALLFRAGMENTS:[],logFragment:undefined,_logTemplatedFragments:function(t,n,a){const o={path:t,fragmentName:n,fragment:a};if(e.getLevel()===e.Level.DEBUG){q.ALLFRAGMENTS=q.ALLFRAGMENTS||[];q.ALLFRAGMENTS.push(o)}if(q.logFragment){setTimeout(function(){q.logFragment?.(o)},0)}},_templateFragment:async function(e,t,a,o,i){const r=n.getTargetView(i);const s=n.getAppComponent(n.getTargetView(i));const l=t.valueListInfo,c=new v(l),p=l.$model.getMetaModel(),m=new v({converterType:"ListReport",columns:t.columnDefs||null});const g=await f.process(d.loadTemplate(e,"fragment"),{name:e},{bindingContexts:{valueList:c.createBindingContext("/"),contextPath:p.createBindingContext(`/${l.CollectionPath}/`),source:a.createBindingContext("/")},models:{valueList:c,contextPath:p,source:a,metaModel:p,viewData:m},appComponent:s});q._logTemplatedFragments(o,e,g);const h=r.getController()?.getOwnerComponent();if(h){return h.runAsOwner(async()=>await u.load({definition:g,controller:r.getController()}))}else{return await u.load({definition:g,controller:r.getController()})}},_getContentId:function(e,t,n){const a=n?"Popover":"Dialog";return`${e}::${a}::qualifier::${t}`},_addInOutParametersToPayload:function(e,t){const n=t.valueHelpQualifier;if(!e.qualifiers){e.qualifiers={}}if(!e.qualifiers[n]){const a=new Set;t.columnDefs.forEach(e=>{if(!e.path.includes("*")){a.add(e.path)}if(e.textPath){a.add(e.textPath)}});e.qualifiers[n]={vhKeys:t.vhKeys,vhParameters:t.vhParameters,vhProperties:Array.from(a)}}},_getValueHelpColumnDisplayFormat:function(e,t){const a=n.computeDisplayMode(e,undefined),o=e&&e[x],i=o&&e[F];if(t){return o&&typeof o!=="string"&&o.$Path?a:"Value"}else{return i?a:"Value"}},_getWidthInRem:function(e,t){let n=e.$().width();if(t&&n){n=.3*n}const a=n?parseFloat(String(m.fromPx(n))):0;return isNaN(a)?0:a},_getTableWidth:function(e,t,n){let a;const o=e.getColumns(),i=o&&o.filter(function(e){return e&&e.getVisible&&e.getVisible()})||[],r=i.length+(n?2.5:0),s=i.reduce(function(e,t){a=t.getWidth();if(a&&a.endsWith("px")){a=String(m.fromPx(a))}const n=parseFloat(a);return e+(isNaN(n)?9:n)},r);return`${Math.max(s,t)}em`},_getJSONModelForDialog:function(e,t,n,a){const o=false,i=true,r=q.getColumnVisibilityInfo(e.valueListInfo,t,o,i);return new v({id:n.getId(),groupId:a.requestGroupId,bSuggestion:false,columnInfo:r,valueHelpWithFixedValues:o})},_getJSONModelForCondition:function(e,t,n,a,o){const i=false,r=false,s=q.getColumnVisibilityInfo(e.valueListInfo,t,i,r);return new v({id:n.getId(),groupId:a.requestGroupId||undefined,bSuggestion:true,columnInfo:s,valueHelpWithFixedValues:i,descriptionPath:e.descriptionPath,keyPath:e.keyPath,propertyPath:t,caseSensitive:o})},_getJSONModelForTypeahead:function(e,t,n,a,o){const i=false,r=n.getId(),s=q.getColumnVisibilityInfo(e.valueListInfo,t,o,i);return new v({id:r,groupId:a.requestGroupId||undefined,bSuggestion:true,propertyPath:t,columnInfo:s,valueHelpWithFixedValues:o})},_createValueHelpTypeahead:async function(t,n,a,o,i,r){const s=r.getObject(`${t}@`),l=s[j]??false,c=this._getJSONModelForTypeahead(o,t,a,i,l);a.setKeyPath(o.keyPath);a.setDescriptionPath(o.descriptionPath);i.isValueListWithFixedValues=l;i.isPotentiallySensitive=i.isPotentiallySensitive??s[E];i.history={enabled:this.checkHistoryEnabled(n,i)};const u=o.valueListInfo.$model.getMetaModel().getObject(`/${o.valueListInfo.CollectionPath}@`)||{};a.data("searchSupported",q.entityIsSearchable(s,u)?true:false);const d=await q._templateFragment("sap.fe.macros.internal.valuehelp.ValueListTable",o,c,t,n);d.setModel(o.valueListInfo.$model);e.info(`Value List- suggest Table XML content created [${t}]`,d.getMetadata().getName(),"MDC Templating");a.setTable(d);const f=n.getControl();if(f!==undefined&&(f.isA("sap.ui.mdc.FilterField")||f.isA("sap.ui.mdc.Field")||f.isA("sap.ui.mdc.Field")&&l||f.isA("sap.ui.mdc.MultiValueField"))){const e=l&&f.getMaxConditions()!==1?"MultiSelect":"SingleSelectMaster";d.setMode(e);d.addEventDelegate({onAfterRendering:function(){p.register(d,function(){q._setTableWidth(d,f,e,i.isUnitValueHelp)})}});this._setTableWidth(d,f,e,i.isUnitValueHelp)}},_setTableWidth(e,t,n,a){const o=Boolean(a);const i=q._getTableWidth(e,q._getWidthInRem(t,o),n==="MultiSelect");e.setWidth(i)},checkHistoryEnabled:function(e,t){const a=n.getAppComponent(n.getTargetView(e));const o=a.getManifestEntry("sap.fe")?.historySettings;return o?.fields?.[t.propertyPath]?.historyEnabled??true},isValueListSearchable(e,t){const n=t.valueListInfo.$model.getMetaModel();const a=n.getObject(`${e}@`)??{};const o=n.getObject(`/${t.valueListInfo.CollectionPath}@`)??{};return q.entityIsSearchable(a,o)},_createValueHelpDialog:async function(e,t,n,a,o,i,r){const s=n.getModel().getMetaModel().getObject(`${t}@`),l=this._getJSONModelForDialog(o,t,a,i);a.setKeyPath(o.keyPath);a.setDescriptionPath(o.descriptionPath);const c=o.valueListInfo.$model.getMetaModel().getObject(`/${o.valueListInfo.CollectionPath}@`)||{};a.data("searchSupported",q.entityIsSearchable(s,c)?true:false);i.isPotentiallySensitive=i.isPotentiallySensitive??s[E];if(r){const s=n.getTypeahead().getContent()[0],l=s.getCaseSensitive();const c=this._getJSONModelForCondition(o,t,a,i,l);const u=await q._templateFragment("sap.fe.macros.internal.valuehelp.ValueListForCondition",o,c,t,n);u.setModel(e);r.addDependent(u);r.setValueHelp(u.getId());const p=u.getTypeahead().getContent()[0].getTable();const d=q._getTableWidth(p,0,false);p.setWidth(d)}const u=q._templateFragment("sap.fe.macros.internal.valuehelp.ValueListDialogTable",o,l,t,n);const p=q._templateFragment("sap.fe.macros.internal.valuehelp.ValueListFilterBar",o,l,t,n);const[d,f]=await Promise.all([u,p]);d.setModel(o.valueListInfo.$model);f.setModel(o.valueListInfo.$model);a.setFilterBar(f);a.setTable(d);d.setFilter(f.getId());d.initialized();d.setWidth("100%");q.setCopyProviderVisibility(d,n);const m=d;m._setShowP13nButton(false)},setCopyProviderVisibility:function(e,t){if(t.getControl()?.isA("sap.ui.mdc.field.FieldBase")){e.getCopyProvider()?.setVisible(true)}},_getContentById:function(e,t){return e.find(function(e){return e.getId()===t})},_createPopoverContent:function(e,t,n){return new P({id:e,group:"group1",caseSensitive:t,useAsValueHelp:n})},_createDialogContent:function(e,t,n){return new h({id:e,group:"group1",caseSensitive:t,forceBind:n})},_showConditionsContent:function(e,t){let n=e.length&&e[e.length-1].getMetadata().getName()==="sap.ui.mdc.valuehelp.content.Conditions"?e[e.length-1]:undefined;if(n){n.setVisible(true)}else{n=new g;t.addContent(n)}return n},_alignOrCreateContent:function(e,t,n,a,o){const i=o.getContent();let r=q._getContentById(i,t);if(!r){const s=e.valueListInfo.FetchValues===2?false:true;r=q._createDialogContent(t,n,s);if(!a){o.addContent(r)}else{o.insertContent(r,i.length-1)}}return r},_prepareValueHelpTypeAhead:function(e,t,n,a,o,i){const r=t.getContent();let s=e.data("valuelistForValidation")||"";if(s===" "){s=""}const l=s?n.filter(function(e){return e.valueHelpQualifier===s})[0]||n[0]:n[0];q._addInOutParametersToPayload(a,l);const c=q._getContentId(e.getId(),l.valueHelpQualifier,true);let u=q._getContentById(r,c);if(!u){const e=i.getUseAsValueHelp();u=q._createPopoverContent(c,o,e);t.insertContent(u,0)}else if(c!==r[0].getId()){t.removeContent(u);t.insertContent(u,0)}return{valueListInfo:l,content:u}},_prepareValueHelpDialog:function(e,t,a,o,i,r){const s=e.data("showConditionPanel")&&e.data("showConditionPanel")!=="false";const l=t.getContent();for(const e of l){e.setVisible(false)}const c=s?this._showConditionsContent(l,t):undefined;const u=e.getControl();const p=u&&u.isA("sap.ui.mdc.FilterField")?u.getOperators().length===0||u.getOperators().includes("EQ"):true;let d,f;for(const l of a){const a=l.valueHelpQualifier;q._addInOutParametersToPayload(o,l);const c=q._getContentId(e.getId(),a,false);const m=this._alignOrCreateContent(l,c,r,s,t);m.setVisible(p);if(l.valueListInfo.Label&&u){const e=n.getTranslatedTextFromExpBindingString(l.valueListInfo.Label,u);m.setTitle(e)}if(!f||i&&i===c){f=m;d=l}}if(!d||!f){throw new Error("selectedInfo or selectedContent undefined")}return{selectedInfo:d,selectedContent:f,conditionContent:c}},_addDescriptionInfosToPayload:function(e,t,n){if(e.valueHelpDescriptionPath!==t.descriptionPath||e.externalIdPath){const a=O(n);const o=a.resolvePath(e.propertyPath).target?.annotations?.Common?.Text?.path;e.valueHelpDescriptionPath=t.descriptionPath;e.valueHelpKeyPath=t.keyPath;if(o){e.maxLength=e.valueHelpDescriptionPath?a.resolvePath(`/${t.valueListInfo.CollectionPath}/${e.valueHelpDescriptionPath}`)?.target?.maxLength:undefined;e.propertyDescriptionPath=o}const i=e.externalIdPath;if(i&&!e.valueHelpDescriptionPath){const o=n.getObject(`${e.propertyPath}@sapui.name`);const r=e.propertyPath.replace(o,i);const s=a.resolvePath(r).target?.annotations?.Common?.Text?.path;t.descriptionPath=s;e.valueHelpDescriptionPath=s}}},showValueList:async function(e,t,a){const o=t.getParent(),i=t.isTypeahead(),r=e.propertyPath,s=o.getControl(),l=s?(o.getControl()?.getModel()).getMetaModel():o.getModel().getMetaModel(),c=o.getModel("_VHUI")!==undefined?o.getModel("_VHUI"):q.createVHUIModel(o,r,l);e.externalIdPath=l?.getObject(`${e.propertyPath}@com.sap.vocabularies.Common.v1.ExternalID`)?.$Path;c.setProperty("/isSuggestion",i);c.setProperty("/minScreenWidth",!i?"418px":undefined);try{const s=await q.getValueListInfo(o,r,e,l);const u=o.getTypeahead().getContent()[0],p=u.getCaseSensitive();if(i){const{valueListInfo:n,content:a}=q._prepareValueHelpTypeAhead(o,t,s,e,p,u);e.valueHelpQualifier=n.valueHelpQualifier;c.setProperty("/selectedProperties",n.columnDefs.map(e=>e.path));q._addDescriptionInfosToPayload(e,n,l);if(a.getTable()===undefined||a.getTable()===null){await q._createValueHelpTypeahead(r,o,a,n,e,l)}}else{const{selectedInfo:i,selectedContent:c,conditionContent:u}=q._prepareValueHelpDialog(o,t,s,e,a,p);e.valueHelpQualifier=i.valueHelpQualifier;q._addDescriptionInfosToPayload(e,i,l);const d=o.getControl();if(d){const e=n.getTranslatedTextFromExpBindingString(q._getDialogTitle(o,i.valueListInfo?.Label),d);t.setTitle(e)}if(c.getTable()===undefined||c.getTable()===null){await q._createValueHelpDialog(l,r,o,c,i,e,u)}}}catch(e){this._logError(r,e);q.destroyVHContent(o)}},getInAndOutParametersList(){return["com.sap.vocabularies.Common.v1.ValueListParameterOut","com.sap.vocabularies.Common.v1.ValueListParameterIn","com.sap.vocabularies.Common.v1.ValueListParameterInOut"]}};return q},false);
//# sourceMappingURL=ValueListHelper.js.map