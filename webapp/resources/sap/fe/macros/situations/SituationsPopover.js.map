{"version":3,"file":"SituationsPopover.js","names":["bindTimestamp","timestampPropertyPath","path","type","constraints","precision","formatOptions","relative","currentSituationIndicator","createListPopover","controller","expectedNumberOfSituations","listDetailsPopover","listPopover","ResponsivePopover","showHeader","contentHeight","contentWidth","busyIndicatorDelay","placement","content","List","items","events","dataReceived","setContentHeight","parameters","$orderby","$expand","template","CustomListItem","press","goToDetails","HBox","ObjectStatus","icon","state","tooltip","getResourceModel","getText","addStyleClass","ObjectIdentifier","title","bindText","text","templateShareable","showNoData","goToList","unbindObject","close","openBy","async","event","pressedItem","getSource","context","getBindingContext","createPreviewPopover","setBindingContext","getView","addDependent","bindElement","getPath","BusyLocker","unlock","lock","back","toolBarContent","resourceModel","push","Button","titleActive","popoverSettings","customHeader","Toolbar","VBox","Label","Text","shellServices","getAppComponent","getShellServices","navigationArguments","target","action","semanticObject","isNavigationSupported","supported","endButton","situationKey","getObject","undefined","params","SitnInstceKey","toExternal","showPopover","situationsNavigationProperty","bindingContext","numberOfSituations","popover","getModel","bindContext","getBoundContext","_exports","__functionName"],"sources":["./SituationsPopover.ts"],"sourcesContent":["import BusyLocker from \"sap/fe/core/controllerextensions/BusyLocker\";\nimport { getResourceModel } from \"sap/fe/core/helpers/ResourceModelHelper\";\nimport type PageController from \"sap/fe/core/PageController\";\nimport { bindText } from \"sap/fe/macros/situations/SituationsText\";\nimport Button from \"sap/m/Button\";\nimport CustomListItem from \"sap/m/CustomListItem\";\nimport HBox from \"sap/m/HBox\";\nimport Label from \"sap/m/Label\";\nimport List from \"sap/m/List\";\nimport ObjectIdentifier from \"sap/m/ObjectIdentifier\";\nimport ObjectStatus from \"sap/m/ObjectStatus\";\nimport type { $ResponsivePopoverSettings } from \"sap/m/ResponsivePopover\";\nimport ResponsivePopover from \"sap/m/ResponsivePopover\";\nimport Text from \"sap/m/Text\";\nimport Toolbar from \"sap/m/Toolbar\";\nimport VBox from \"sap/m/VBox\";\nimport type UI5Event from \"sap/ui/base/Event\";\nimport type { AggregationBindingInfo, PropertyBindingInfo } from \"sap/ui/base/ManagedObject\";\nimport type Control from \"sap/ui/core/Control\";\nimport type Context from \"sap/ui/model/odata/v4/Context\";\n\nfunction bindTimestamp(timestampPropertyPath: string): PropertyBindingInfo {\n\treturn {\n\t\tpath: timestampPropertyPath,\n\t\ttype: \"sap.ui.model.odata.type.DateTimeOffset\",\n\t\tconstraints: { precision: 7 },\n\t\tformatOptions: { relative: true }\n\t};\n}\n\nlet currentSituationIndicator: Control | undefined;\n\nfunction createListPopover(controller: PageController, expectedNumberOfSituations: number): ResponsivePopover {\n\tlet listDetailsPopover: ResponsivePopover | null = null;\n\n\tconst listPopover = new ResponsivePopover({\n\t\tshowHeader: false,\n\t\tcontentHeight: `${expectedNumberOfSituations * 4.5}em`,\n\t\tcontentWidth: \"25em\",\n\t\tbusyIndicatorDelay: 200,\n\t\tplacement: \"Horizontal\",\n\t\tcontent: [\n\t\t\tnew List({\n\t\t\t\titems: {\n\t\t\t\t\tpath: \"_Instance\",\n\t\t\t\t\tevents: {\n\t\t\t\t\t\tdataReceived: () => {\n\t\t\t\t\t\t\tlistPopover.setContentHeight();\n\t\t\t\t\t\t}\n\t\t\t\t\t},\n\t\t\t\t\tparameters: {\n\t\t\t\t\t\t$orderby: \"SitnInstceLastChgdAtDateTime desc\",\n\t\t\t\t\t\t$expand: \"_InstanceAttribute($expand=_InstanceAttributeValue)\" // required for formatting the texts\n\t\t\t\t\t},\n\t\t\t\t\ttemplate: new CustomListItem({\n\t\t\t\t\t\ttype: \"Navigation\",\n\t\t\t\t\t\tpress: goToDetails,\n\t\t\t\t\t\tcontent: [\n\t\t\t\t\t\t\tnew HBox({\n\t\t\t\t\t\t\t\titems: [\n\t\t\t\t\t\t\t\t\tnew ObjectStatus({\n\t\t\t\t\t\t\t\t\t\ticon: \"sap-icon://alert\",\n\t\t\t\t\t\t\t\t\t\tstate: \"Warning\",\n\t\t\t\t\t\t\t\t\t\ttooltip: getResourceModel(controller).getText(\"situation\")\n\t\t\t\t\t\t\t\t\t}).addStyleClass(\"sapUiTinyMarginEnd\"),\n\t\t\t\t\t\t\t\t\tnew ObjectIdentifier({\n\t\t\t\t\t\t\t\t\t\ttitle: bindText(\"SituationTitle\"),\n\t\t\t\t\t\t\t\t\t\ttext: bindTimestamp(\"SitnInstceLastChgdAtDateTime\")\n\t\t\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t\t]\n\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t\t.addStyleClass(\"sapUiSmallMarginBeginEnd\")\n\t\t\t\t\t\t\t\t.addStyleClass(\"sapUiSmallMarginTopBottom\")\n\t\t\t\t\t\t]\n\t\t\t\t\t}),\n\t\t\t\t\ttemplateShareable: false\n\t\t\t\t} as AggregationBindingInfo,\n\t\t\t\tshowNoData: false\n\t\t\t})\n\t\t]\n\t});\n\n\tfunction goToList(): void {\n\t\tif (listDetailsPopover) {\n\t\t\tlistDetailsPopover.unbindObject();\n\t\t\tlistDetailsPopover.close();\n\t\t}\n\t\tif (currentSituationIndicator) {\n\t\t\tlistPopover.openBy(currentSituationIndicator);\n\t\t}\n\t}\n\n\tasync function goToDetails(event: UI5Event<{}, Control>): Promise<void> {\n\t\tconst pressedItem = event.getSource();\n\t\tconst context = pressedItem.getBindingContext();\n\n\t\tif (context && currentSituationIndicator) {\n\t\t\tif (listDetailsPopover === null) {\n\t\t\t\tlistDetailsPopover = await createPreviewPopover(controller, goToList);\n\t\t\t\tlistDetailsPopover.setBindingContext(null);\n\t\t\t\tcontroller.getView().addDependent(listDetailsPopover);\n\t\t\t}\n\n\t\t\tlistDetailsPopover.bindElement({\n\t\t\t\tpath: context.getPath(),\n\t\t\t\tparameters: { $expand: \"_InstanceAttribute($expand=_InstanceAttributeValue)\" },\n\t\t\t\tevents: {\n\t\t\t\t\tdataReceived: () => {\n\t\t\t\t\t\tBusyLocker.unlock(listDetailsPopover!);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tlistPopover.close();\n\n\t\t\tBusyLocker.lock(listDetailsPopover);\n\t\t\tlistDetailsPopover.openBy(currentSituationIndicator);\n\t\t}\n\t}\n\n\treturn listPopover;\n}\n\nasync function createPreviewPopover(controller: PageController, back?: (event: UI5Event) => void): Promise<ResponsivePopover> {\n\tconst toolBarContent: Control[] = [];\n\tconst resourceModel = getResourceModel(controller);\n\n\tif (back) {\n\t\ttoolBarContent.push(\n\t\t\tnew Button({\n\t\t\t\ttype: \"Back\",\n\t\t\t\ttooltip: resourceModel.getText(\"back\"),\n\t\t\t\tpress: back\n\t\t\t}).addStyleClass(\"sapUiNoMarginEnd\")\n\t\t);\n\t}\n\n\ttoolBarContent.push(\n\t\tnew ObjectStatus({\n\t\t\tstate: \"Warning\",\n\t\t\ticon: \"sap-icon://alert\",\n\t\t\ttooltip: resourceModel.getText(\"situationIconTooltip\")\n\t\t}).addStyleClass(\"sapUiSmallMarginBegin\")\n\t);\n\n\ttoolBarContent.push(\n\t\tnew ObjectIdentifier({\n\t\t\ttitleActive: false,\n\t\t\ttitle: bindText(\"SituationTitle\")\n\t\t}).addStyleClass(\"sapUiSmallMarginEnd\")\n\t);\n\n\tconst popoverSettings: $ResponsivePopoverSettings = {\n\t\tcontentWidth: \"25em\",\n\t\tcontentHeight: \"7em\",\n\t\tplacement: \"Horizontal\",\n\t\tcustomHeader: new Toolbar({ content: toolBarContent }),\n\t\tbusyIndicatorDelay: 100,\n\t\tcontent: [\n\t\t\tnew VBox({\n\t\t\t\titems: [\n\t\t\t\t\tnew Label({ text: bindTimestamp(\"SitnInstceLastChgdAtDateTime\") }),\n\t\t\t\t\tnew Text({ text: bindText(\"SituationText\") }).addStyleClass(\"sapUiTinyMarginTop\")\n\t\t\t\t]\n\t\t\t})\n\t\t]\n\t};\n\n\tconst shellServices = controller.getAppComponent().getShellServices();\n\tconst navigationArguments: { target: { action: string; semanticObject: string }; params?: Record<string, string> } = {\n\t\ttarget: {\n\t\t\taction: \"displayExtended\",\n\t\t\tsemanticObject: \"SituationInstance\"\n\t\t}\n\t};\n\tconst isNavigationSupported = await shellServices.isNavigationSupported([navigationArguments]);\n\n\tif (isNavigationSupported[0].supported) {\n\t\tpopoverSettings.endButton = new Button({\n\t\t\ttext: resourceModel.getText(\"showDetails\"),\n\n\t\t\tpress: (event: UI5Event<{}, Button>): void => {\n\t\t\t\tconst situationKey = event.getSource().getBindingContext()?.getObject(`SitnInstceKey`);\n\n\t\t\t\tif (situationKey !== undefined && situationKey !== null) {\n\t\t\t\t\tnavigationArguments.params = { SitnInstceKey: situationKey };\n\t\t\t\t\tshellServices.toExternal(navigationArguments);\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t}\n\n\treturn new ResponsivePopover(popoverSettings).addStyleClass(\"sapUiPopupWithPadding\").addStyleClass(\"sapUiResponsivePadding--header\");\n}\n\nexport async function showPopover(\n\tcontroller: PageController,\n\tevent: UI5Event<{}, Control>,\n\tsituationsNavigationProperty: string\n): Promise<void> {\n\tcurrentSituationIndicator = event.getSource();\n\n\tconst bindingContext = currentSituationIndicator.getBindingContext() as Context,\n\t\tnumberOfSituations = bindingContext.getObject(`${situationsNavigationProperty}/SitnNumberOfInstances`);\n\n\tlet popover: ResponsivePopover;\n\tconst context = bindingContext\n\t\t.getModel()\n\t\t.bindContext(situationsNavigationProperty, bindingContext, {\n\t\t\t$expand: \"_Instance($expand=_InstanceAttribute($expand=_InstanceAttributeValue))\"\n\t\t})\n\t\t.getBoundContext();\n\n\tif (numberOfSituations <= 1) {\n\t\tpopover = await createPreviewPopover(controller);\n\t\tpopover.setBindingContext(context);\n\t\tpopover.bindElement({ path: \"_Instance/0\" });\n\t} else {\n\t\tpopover = createListPopover(controller, numberOfSituations);\n\t\tpopover.setBindingContext(context);\n\t}\n\n\tcontroller.getView().addDependent(popover);\n\tpopover.openBy(currentSituationIndicator);\n}\n\nshowPopover.__functionName = \"rt.showPopover\";\n"],"mappings":"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","ignoreList":[]}