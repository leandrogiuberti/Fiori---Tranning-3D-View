{"version":3,"names":["CollaborativeDraftHandler","_dec","defineUI5Class","_dec2","property","type","_dec3","_dec4","event","_dec5","defaultValue","_dec6","_class","_class2","_BuildingBlock","idOrSettings","settings","_this","call","_initializerDefineProperty","_descriptor","_descriptor2","_descriptor3","_descriptor4","_descriptor5","_exports","_inheritsLoose","_proto","prototype","getFullMetaPath","metaPath","startsWith","contextPath","endsWith","onMetadataAvailable","owner","_getOwner","ModelHelper","isCollaborationDraftSupported","getAppComponent","getModel","getMetaModel","getOwnerContextPath","fullMetaPath","objectPath","getDataModelObjectPath","isProperty","targetObject","Error","keysBindingParts","targetEntityType","keys","map","key","path","name","targetType","bindingInfo","parts","formatter","CollaborationFormatters","getCollaborationInfo","bindProperty","content","showAvatar","createCollaborationAvatar","setLockInfo","lockInfo","fireEvent","isLocked","undefined","lockingUserID","id","lockingUserName","lockingUserInitials","initials","lockingUserColor","color","collaborationExpression","UIFormatters","getCollaborationExpression","hasCollaborationActivity","collaborationHasActivityExpression","compileExpression","collaborationInitialsExpression","getCollaborationActivityInitials","collaborationColorExpression","getCollaborationActivityColor","_jsx","Avatar","visible","displaySize","customDisplaySize","customFontSize","backgroundColor","press","evt","onAvatarPress","children","dependents","EventDelegateHook","stopTapPropagation","avatar","getSource","block","getParent","view","getPageController","getView","resourceModel","ResourceModelHelper","getResourceModel","popover","UI5Element","getElementById","ResponsivePopover","showHeader","placement","addStyleClass","addDependent","destroyContent","addContent","Label","text","getText","openBy","BuildingBlock","_applyDecoratedDescriptor","configurable","enumerable","writable","initializer"],"sourceRoot":".","sources":["CollaborativeDraftHandler.tsx"],"sourcesContent":["import { type Property } from \"@sap-ux/vocabularies-types\";\nimport { compileExpression } from \"sap/fe/base/BindingToolkit\";\nimport { defineUI5Class, event, property, type PropertiesOf } from \"sap/fe/base/ClassSupport\";\nimport EventDelegateHook from \"sap/fe/base/EventDelegateHook\";\nimport BuildingBlock from \"sap/fe/core/buildingBlocks/BuildingBlock\";\nimport { type UserActivity } from \"sap/fe/core/controllerextensions/collaboration/CollaborationCommon\";\nimport * as CollaborationFormatters from \"sap/fe/core/formatters/CollaborationFormatter\";\nimport ModelHelper from \"sap/fe/core/helpers/ModelHelper\";\nimport ResourceModelHelper from \"sap/fe/core/helpers/ResourceModelHelper\";\nimport { isProperty } from \"sap/fe/core/helpers/TypeGuards\";\nimport { type DataModelObjectPath } from \"sap/fe/core/templating/DataModelPathHelper\";\nimport * as UIFormatters from \"sap/fe/core/templating/UIFormatters\";\nimport Avatar, { type Avatar$PressEvent } from \"sap/m/Avatar\";\nimport Label from \"sap/m/Label\";\nimport ResponsivePopover from \"sap/m/ResponsivePopover\";\nimport type UI5Event from \"sap/ui/base/Event\";\nimport UI5Element from \"sap/ui/core/Element\";\nimport type { EventHandler } from \"types/extension_types\";\n\n/**\n * A BuildingBlock to watch the lock status of a property and to react on changes.\n * @public\n * @ui5-experimental-since 1.141.0\n * @since 1.141.0\n */\n@defineUI5Class(\"sap.fe.macros.CollaborativeDraftHandler\")\nexport default class CollaborativeDraftHandler extends BuildingBlock<Avatar> {\n\t/**\n\t * Defines the path of the context used in the current page or block.\n\t * This setting is defined by the framework, and can be overwritten.\n\t * @public\n\t * @ui5-experimental-since 1.141.0\n\t * @since 1.141.0\n\t */\n\t@property({ type: \"string\" })\n\tcontextPath!: string;\n\n\t/**\n\t * Defines the relative path of the property in the metamodel, based on the current contextPath.\n\t * @public\n\t * @ui5-experimental-since 1.141.0\n\t * @since 1.141.0\n\t */\n\t@property({ type: \"string\" })\n\tmetaPath!: string;\n\n\t/**\n\t * Event fired when the lock status changes.\n\t *\n\t * Parameters:<BR>\n\t * - isLocked : true if the property is locked, false otherwise<BR>\n\t * - lockingUserID: the ID of the user locking the property (undefined if not locked)<BR>\n\t * - lockingUserName: the name of the user locking the property (undefined if not locked)<BR>\n\t * - lockingUserInitials: the initials of the user locking the property (undefined if not locked)<BR>\n\t * - lockingUserColor: the color associated to the user locking the property (undefined if not locked)<BR>\n\t * @public\n\t * @ui5-experimental-since 1.141.0\n\t * @since 1.141.0\n\t */\n\t@event()\n\tlockChange?: EventHandler<\n\t\tUI5Event<\n\t\t\t{\n\t\t\t\tisLocked: boolean;\n\t\t\t\tlockingUserID?: string;\n\t\t\t\tlockingUserName?: string;\n\t\t\t\tlockingUserInitials?: string;\n\t\t\t\tlockingUserColor?: string;\n\t\t\t},\n\t\t\tCollaborativeDraftHandler\n\t\t>\n\t>;\n\n\t/**\n\t * If set to true, the standard Avatar control is displayed to indicate the lock status.\n\t * If set to false, nothing is displayed.\n\t * @public\n\t * @ui5-experimental-since 1.141.0\n\t * @since 1.141.0\n\t */\n\t@property({ type: \"boolean\", defaultValue: false })\n\tshowAvatar = false;\n\n\t/**\n\t * Internal property to receive the lock data\n\t */\n\t@property({ type: \"object\" })\n\tlockInfo?: UserActivity;\n\n\tconstructor(idOrSettings: string | PropertiesOf<CollaborativeDraftHandler>, settings?: PropertiesOf<CollaborativeDraftHandler>) {\n\t\tsuper(idOrSettings, settings);\n\t}\n\n\tprivate getFullMetaPath(): string {\n\t\tif (this.metaPath.startsWith(\"/\")) {\n\t\t\treturn this.metaPath;\n\t\t} else if (this.contextPath.endsWith(\"/\")) {\n\t\t\treturn `${this.contextPath}${this.metaPath}`;\n\t\t} else {\n\t\t\treturn `${this.contextPath}/${this.metaPath}`;\n\t\t}\n\t}\n\n\tonMetadataAvailable(): void {\n\t\tconst owner = this._getOwner();\n\t\tif (!owner) {\n\t\t\treturn;\n\t\t}\n\t\tif (!ModelHelper.isCollaborationDraftSupported(owner.getAppComponent().getModel().getMetaModel())) {\n\t\t\treturn;\n\t\t}\n\n\t\tthis.contextPath ??= this.getOwnerContextPath() as string;\n\t\tconst fullMetaPath = this.getFullMetaPath();\n\t\tconst objectPath = this.getDataModelObjectPath<Property>(fullMetaPath);\n\t\tif (!objectPath || !isProperty(objectPath.targetObject)) {\n\t\t\tthrow new Error(`CollaborativeDraftHandler: the provided metaPath '${fullMetaPath}' does not point to a valid property`);\n\t\t}\n\n\t\t// Bind the lockInfo property to the corresponding lockInfo in the internal model\n\t\tconst keysBindingParts = objectPath.targetEntityType.keys.map((key) => {\n\t\t\treturn { path: key.name, targetType: \"any\" };\n\t\t});\n\t\tconst bindingInfo = {\n\t\t\tparts: [{ path: `internal>/collaboration/activities${fullMetaPath}`, targetType: \"any\" }, ...keysBindingParts],\n\t\t\tformatter: CollaborationFormatters.getCollaborationInfo\n\t\t};\n\n\t\tthis.bindProperty(\"lockInfo\", bindingInfo);\n\n\t\tif (!this.content && this.showAvatar) {\n\t\t\tthis.content = this.createCollaborationAvatar(objectPath);\n\t\t}\n\t}\n\n\t/**\n\t * Update the lockInfo property and fire the lockChange event if there is a change.\n\t * @param lockInfo\n\t */\n\tsetLockInfo(lockInfo: object | undefined): void {\n\t\tif (this.lockInfo !== lockInfo) {\n\t\t\tthis.lockInfo = lockInfo as UserActivity | undefined;\n\t\t\tthis.fireEvent(\"lockChange\", {\n\t\t\t\tisLocked: this.lockInfo !== undefined,\n\t\t\t\tlockingUserID: this.lockInfo?.id,\n\t\t\t\tlockingUserName: this.lockInfo?.name,\n\t\t\t\tlockingUserInitials: this.lockInfo?.initials,\n\t\t\t\tlockingUserColor: this.lockInfo?.color\n\t\t\t});\n\t\t}\n\t}\n\n\t/**\n\t * Creates the content of the block (Avatar).\n\t * @param objectPath\n\t * @returns The Avatar control\n\t */\n\tcreateCollaborationAvatar(objectPath: DataModelObjectPath<Property>): Avatar {\n\t\tconst collaborationExpression = UIFormatters.getCollaborationExpression(\n\t\t\tobjectPath,\n\t\t\tCollaborationFormatters.hasCollaborationActivity\n\t\t);\n\t\tconst collaborationHasActivityExpression = compileExpression(collaborationExpression);\n\t\tconst collaborationInitialsExpression = compileExpression(\n\t\t\tUIFormatters.getCollaborationExpression(objectPath, CollaborationFormatters.getCollaborationActivityInitials)\n\t\t);\n\t\tconst collaborationColorExpression = compileExpression(\n\t\t\tUIFormatters.getCollaborationExpression(objectPath, CollaborationFormatters.getCollaborationActivityColor)\n\t\t);\n\n\t\treturn (\n\t\t\t<Avatar\n\t\t\t\tvisible={collaborationHasActivityExpression}\n\t\t\t\tinitials={collaborationInitialsExpression}\n\t\t\t\tdisplaySize=\"Custom\"\n\t\t\t\tcustomDisplaySize=\"1.5rem\"\n\t\t\t\tcustomFontSize=\"0.8rem\"\n\t\t\t\tbackgroundColor={collaborationColorExpression}\n\t\t\t\tpress={(evt: Avatar$PressEvent): void => {\n\t\t\t\t\tthis.onAvatarPress(evt);\n\t\t\t\t}}\n\t\t\t>\n\t\t\t\t{{\n\t\t\t\t\tdependents: <EventDelegateHook stopTapPropagation={true} />\n\t\t\t\t}}\n\t\t\t</Avatar>\n\t\t);\n\t}\n\n\t/**\n\t * Event handler for the press event of the Avatar.\n\t * @param evt\n\t */\n\tonAvatarPress(evt: Avatar$PressEvent): void {\n\t\tconst avatar = evt.getSource();\n\t\tconst block = avatar.getParent() as CollaborativeDraftHandler;\n\t\tconst view = this.getPageController().getView();\n\t\tconst resourceModel = ResourceModelHelper.getResourceModel(view);\n\t\tlet popover = UI5Element.getElementById(`manageCollaborationDraft--editUser`) as ResponsivePopover | undefined;\n\n\t\tif (!popover) {\n\t\t\tpopover = new ResponsivePopover(\"manageCollaborationDraft--editUser\", {\n\t\t\t\tshowHeader: false,\n\t\t\t\tplacement: \"Bottom\"\n\t\t\t});\n\t\t\tpopover.addStyleClass(\"sapUiContentPadding\");\n\t\t\tview.addDependent(popover);\n\t\t}\n\n\t\tpopover.destroyContent();\n\t\tpopover.addContent(\n\t\t\tnew Label({\n\t\t\t\ttext: resourceModel.getText(\"C_COLLABORATIONAVATAR_USER_EDIT_FIELD\", [`${block.lockInfo?.name}`])\n\t\t\t})\n\t\t);\n\t\tpopover.openBy(avatar);\n\t}\n}\n"],"mappings":"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","ignoreList":[],"file":"CollaborativeDraftHandler-dbg.js"}