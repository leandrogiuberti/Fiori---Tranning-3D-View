/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)
 *      (c) Copyright 2009-2025 SAP SE. All rights reserved
 */
sap.ui.define(["sap/fe/base/BindingToolkit","sap/fe/base/ClassSupport","sap/fe/base/EventDelegateHook","sap/fe/core/buildingBlocks/BuildingBlock","sap/fe/core/formatters/CollaborationFormatter","sap/fe/core/helpers/ModelHelper","sap/fe/core/helpers/ResourceModelHelper","sap/fe/core/helpers/TypeGuards","sap/fe/core/templating/UIFormatters","sap/m/Avatar","sap/m/Label","sap/m/ResponsivePopover","sap/ui/core/Element","sap/fe/base/jsx-runtime/jsx"],function(e,t,o,r,a,i,n,l,s,c,u,p,f,h){"use strict";var b,d,g,m,v,y,C,P,k,I,w,A,z;var x={};var E=l.isProperty;var O=t.property;var D=t.event;var j=t.defineUI5Class;var M=e.compileExpression;function T(e,t,o,r){o&&Object.defineProperty(e,t,{enumerable:o.enumerable,configurable:o.configurable,writable:o.writable,value:o.initializer?o.initializer.call(r):void 0})}function U(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e,_(e,t)}function _(e,t){return _=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},_(e,t)}function B(e,t,o,r,a){var i={};return Object.keys(r).forEach(function(e){i[e]=r[e]}),i.enumerable=!!i.enumerable,i.configurable=!!i.configurable,("value"in i||i.initializer)&&(i.writable=!0),i=o.slice().reverse().reduce(function(o,r){return r(e,t,o)||o},i),a&&void 0!==i.initializer&&(i.value=i.initializer?i.initializer.call(a):void 0,i.initializer=void 0),void 0===i.initializer?(Object.defineProperty(e,t,i),null):i}function S(e,t){throw Error("Decorating class property failed. Please ensure that transform-class-properties is enabled and runs after the decorators transform.")}let $=(b=j("sap.fe.macros.CollaborativeDraftHandler"),d=O({type:"string"}),g=O({type:"string"}),m=D(),v=O({type:"boolean",defaultValue:false}),y=O({type:"object"}),b(C=(P=function(e){function t(t,o){var r;r=e.call(this,t,o)||this;T(r,"contextPath",k,r);T(r,"metaPath",I,r);T(r,"lockChange",w,r);T(r,"showAvatar",A,r);T(r,"lockInfo",z,r);return r}x=t;U(t,e);var r=t.prototype;r.getFullMetaPath=function e(){if(this.metaPath.startsWith("/")){return this.metaPath}else if(this.contextPath.endsWith("/")){return`${this.contextPath}${this.metaPath}`}else{return`${this.contextPath}/${this.metaPath}`}};r.onMetadataAvailable=function e(){const t=this._getOwner();if(!t){return}if(!i.isCollaborationDraftSupported(t.getAppComponent().getModel().getMetaModel())){return}this.contextPath??=this.getOwnerContextPath();const o=this.getFullMetaPath();const r=this.getDataModelObjectPath(o);if(!r||!E(r.targetObject)){throw new Error(`CollaborativeDraftHandler: the provided metaPath '${o}' does not point to a valid property`)}const n=r.targetEntityType.keys.map(e=>({path:e.name,targetType:"any"}));const l={parts:[{path:`internal>/collaboration/activities${o}`,targetType:"any"},...n],formatter:a.getCollaborationInfo};this.bindProperty("lockInfo",l);if(!this.content&&this.showAvatar){this.content=this.createCollaborationAvatar(r)}};r.setLockInfo=function e(t){if(this.lockInfo!==t){this.lockInfo=t;this.fireEvent("lockChange",{isLocked:this.lockInfo!==undefined,lockingUserID:this.lockInfo?.id,lockingUserName:this.lockInfo?.name,lockingUserInitials:this.lockInfo?.initials,lockingUserColor:this.lockInfo?.color})}};r.createCollaborationAvatar=function e(t){const r=s.getCollaborationExpression(t,a.hasCollaborationActivity);const i=M(r);const n=M(s.getCollaborationExpression(t,a.getCollaborationActivityInitials));const l=M(s.getCollaborationExpression(t,a.getCollaborationActivityColor));return h(c,{visible:i,initials:n,displaySize:"Custom",customDisplaySize:"1.5rem",customFontSize:"0.8rem",backgroundColor:l,press:e=>{this.onAvatarPress(e)},children:{dependents:h(o,{stopTapPropagation:true})}})};r.onAvatarPress=function e(t){const o=t.getSource();const r=o.getParent();const a=this.getPageController().getView();const i=n.getResourceModel(a);let l=f.getElementById(`manageCollaborationDraft--editUser`);if(!l){l=new p("manageCollaborationDraft--editUser",{showHeader:false,placement:"Bottom"});l.addStyleClass("sapUiContentPadding");a.addDependent(l)}l.destroyContent();l.addContent(new u({text:i.getText("C_COLLABORATIONAVATAR_USER_EDIT_FIELD",[`${r.lockInfo?.name}`])}));l.openBy(o)};return t}(r),k=B(P.prototype,"contextPath",[d],{configurable:true,enumerable:true,writable:true,initializer:null}),I=B(P.prototype,"metaPath",[g],{configurable:true,enumerable:true,writable:true,initializer:null}),w=B(P.prototype,"lockChange",[m],{configurable:true,enumerable:true,writable:true,initializer:null}),A=B(P.prototype,"showAvatar",[v],{configurable:true,enumerable:true,writable:true,initializer:function(){return false}}),z=B(P.prototype,"lockInfo",[y],{configurable:true,enumerable:true,writable:true,initializer:null}),P))||C);x=$;return x},false);
//# sourceMappingURL=CollaborativeDraftHandler.js.map