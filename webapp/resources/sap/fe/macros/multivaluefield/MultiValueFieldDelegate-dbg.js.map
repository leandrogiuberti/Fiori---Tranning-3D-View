{"version":3,"names":["Object","assign","MdcMultiValueFieldDelegate","getDescription","field","valueHelp","key","_conditionIn","_conditionOut","bindingContext","_ConditionModel","_conditionModelName","conditionPayload","control","type","undefined","FieldBaseDelegate","updateItems","_payload","conditions","listBinding","getBinding","isJsonListBinding","isA","isODataListBinding","bindingInfo","getBindingInfo","keyBindingInfo","template","descriptionBindingInfo","keyPath","parts","path","descriptionPath","_updateItemsInODataListBinding","_updateItemsInJsonListBinding","contexts","getCurrentContexts","dataToAdd","controller","CommonUtils","getTargetView","getController","newKeys","map","condition","values","oldKeys","context","getProperty","modificationPromises","i","length","deleteContext","includes","push","editFlow","deleteMultipleDocuments","controlId","getId","noDialog","item","createMultipleDocuments","Promise","all","customDataValue","getCustomData","find","cdv","getKey","getValue","splice","modelNameForUpdate","model","getModel","updateBindings"],"sourceRoot":".","sources":["MultiValueFieldDelegate.ts"],"sourcesContent":["import CommonUtils from \"sap/fe/core/CommonUtils\";\nimport type CustomData from \"sap/ui/core/CustomData\";\nimport type Control from \"sap/ui/mdc/Control\";\nimport type Field from \"sap/ui/mdc/Field\";\nimport type MultiValueField from \"sap/ui/mdc/MultiValueField\";\nimport type ValueHelp from \"sap/ui/mdc/ValueHelp\";\nimport type { ConditionObject } from \"sap/ui/mdc/condition/Condition\";\nimport type ConditionModel from \"sap/ui/mdc/condition/ConditionModel\";\nimport FieldBaseDelegate from \"sap/ui/mdc/field/FieldBaseDelegate\";\nimport MdcMultiValueFieldDelegate from \"sap/ui/mdc/field/MultiValueFieldDelegate\";\nimport type Context from \"sap/ui/model/Context\";\nimport type ModelType from \"sap/ui/model/Type\";\nimport type JSONListBinding from \"sap/ui/model/json/JSONListBinding\";\nimport type JSONModel from \"sap/ui/model/json/JSONModel\";\nimport type ODataListBinding from \"sap/ui/model/odata/v4/ODataListBinding\";\nimport type { ConditionPayloadMap, ConditionPayloadType } from \"../valuehelp/ValueHelpDelegate\";\n\nexport default Object.assign({}, MdcMultiValueFieldDelegate, {\n\t/**\n\t * Determines the description for a given key.\n\t * @param field The <code>Field</code> instance\n\t * @param valueHelp Field help assigned to the <code>Field</code> or <code>FilterField</code> control\n\t * @param key Key value of the description\n\t * @param _conditionIn In parameters for the key (no longer supported)\n\t * @param _conditionOut Out parameters for the key (no longer supported)\n\t * @param bindingContext BindingContext <code>BindingContext</code> of the checked field. Inside a table, the <code>ValueHelp</code> element can be connected to a different row\n\t * @param _ConditionModel ConditionModel</code>, if bound to one\n\t * @param _conditionModelName Name of the <code>ConditionModel</code>, if bound to one\n\t * @param conditionPayload Additional context information for this key\n\t * @param control Instance of the calling control\n\t * @param type Type of the value\n\t * @returns Description for the key or object containing a description, key and payload. If the description is not available right away (it must be requested), a <code>Promise</code> is returned\n\t */\n\tgetDescription: function (\n\t\tfield: Field | null,\n\t\tvalueHelp: ValueHelp,\n\t\tkey: string | undefined | null,\n\t\t_conditionIn: object,\n\t\t_conditionOut: object,\n\t\tbindingContext: Context | undefined,\n\t\t_ConditionModel: ConditionModel,\n\t\t_conditionModelName: string,\n\t\tconditionPayload: ConditionPayloadMap,\n\t\tcontrol: Control,\n\t\ttype: ModelType\n\t) {\n\t\tif (key === undefined || key === null) {\n\t\t\treturn;\n\t\t}\n\n\t\treturn FieldBaseDelegate.getDescription(\n\t\t\tfield as Field,\n\t\t\tvalueHelp,\n\t\t\tkey,\n\t\t\t_conditionIn,\n\t\t\t_conditionOut,\n\t\t\tbindingContext as Context,\n\t\t\tundefined,\n\t\t\tundefined,\n\t\t\tconditionPayload,\n\t\t\tcontrol,\n\t\t\ttype\n\t\t);\n\t},\n\n\t/**\n\t * Implements the model-specific logic to update items after conditions have been updated.\n\t * Items can be removed, updated, or added. Use the binding information of the `MultiValueField` control\n\t * to update the data in the model.\n\t * @param _payload Additional context information for this key\n\t * @param conditions Current conditions\n\t * @param control Instance of the calling control\n\t * @returns Promise is returned\n\t */\n\tupdateItems: async function (_payload: undefined, conditions: ConditionObject[], control: MultiValueField) {\n\t\tconst listBinding = control.getBinding(\"items\") as ODataListBinding | JSONListBinding;\n\n\t\tconst isJsonListBinding = listBinding.isA(\"sap.ui.model.json.JSONListBinding\");\n\t\tconst isODataListBinding = listBinding.isA(\"sap.ui.model.odata.v4.ODataListBinding\");\n\n\t\tconst bindingInfo = control.getBindingInfo(\"items\");\n\t\t// check if conditions are added, removed or changed\n\t\tconst keyBindingInfo = bindingInfo.template.getBindingInfo(\"key\");\n\t\tconst descriptionBindingInfo = bindingInfo.template.getBindingInfo(\"description\");\n\t\tconst keyPath: string = keyBindingInfo && keyBindingInfo.parts[0].path;\n\t\tconst descriptionPath =\n\t\t\tdescriptionBindingInfo &&\n\t\t\tdescriptionBindingInfo.parts &&\n\t\t\tdescriptionBindingInfo.parts[0] &&\n\t\t\tdescriptionBindingInfo.parts[0].path;\n\n\t\tif (isODataListBinding) {\n\t\t\tawait this._updateItemsInODataListBinding(listBinding as ODataListBinding, conditions, control, keyPath, descriptionPath);\n\t\t} else if (isJsonListBinding) {\n\t\t\tthis._updateItemsInJsonListBinding(conditions, control, keyPath, descriptionPath);\n\t\t}\n\t},\n\n\t/**\n\t * Updates the items in an OData list binding.\n\t * @param listBinding\n\t * @param conditions\n\t * @param control\n\t * @param keyPath\n\t * @param descriptionPath\n\t * @returns Promise containing all the update promises\n\t */\n\t_updateItemsInODataListBinding: async function (\n\t\tlistBinding: ODataListBinding,\n\t\tconditions: ConditionObject[],\n\t\tcontrol: MultiValueField,\n\t\tkeyPath: string,\n\t\tdescriptionPath: string\n\t) {\n\t\tconst contexts = listBinding.getCurrentContexts();\n\n\t\tconst dataToAdd: ConditionPayloadType[] = [];\n\t\tconst controller = CommonUtils.getTargetView(control).getController();\n\n\t\t// Contexts to delete\n\t\tconst newKeys = conditions.map(function (condition: ConditionObject) {\n\t\t\treturn condition.values[0];\n\t\t});\n\t\tconst oldKeys = contexts.map(function (context: Context) {\n\t\t\treturn context.getProperty(keyPath);\n\t\t});\n\t\tconst modificationPromises = [];\n\n\t\tfor (let i = 0; i < contexts.length; i++) {\n\t\t\tconst deleteContext = contexts[i];\n\t\t\tif (!newKeys.includes(deleteContext.getProperty(keyPath))) {\n\t\t\t\tmodificationPromises.push(\n\t\t\t\t\tcontroller.editFlow.deleteMultipleDocuments([deleteContext], {\n\t\t\t\t\t\tcontrolId: control.getId(),\n\t\t\t\t\t\tnoDialog: true\n\t\t\t\t\t})\n\t\t\t\t);\n\t\t\t}\n\t\t}\n\t\t// data to add\n\t\tfor (const condition of conditions) {\n\t\t\tif (!oldKeys.includes(condition.values[0])) {\n\t\t\t\tconst item: ConditionPayloadType = {};\n\t\t\t\tif (keyPath && !keyPath.includes(\"/\")) {\n\t\t\t\t\t// we do not manage to create on a sub entity of the 1:n navigation\n\t\t\t\t\titem[keyPath] = condition.values[0];\n\n\t\t\t\t\tif (descriptionPath && !descriptionPath.includes(\"/\") && descriptionPath !== keyPath) {\n\t\t\t\t\t\titem[descriptionPath] = condition.values[1];\n\t\t\t\t\t}\n\t\t\t\t\tdataToAdd.push(item);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\tif (dataToAdd.length) {\n\t\t\tmodificationPromises.push(controller.editFlow.createMultipleDocuments(listBinding, dataToAdd, true, false));\n\t\t}\n\t\treturn Promise.all(modificationPromises);\n\t},\n\t/**\n\t * Updates the items in a JSON list binding.\n\t * @param conditions\n\t * @param control\n\t * @param keyPath\n\t * @param descriptionPath\n\t */\n\t_updateItemsInJsonListBinding: function (\n\t\tconditions: ConditionObject[],\n\t\tcontrol: MultiValueField,\n\t\tkeyPath: string,\n\t\tdescriptionPath: string\n\t) {\n\t\tconst customDataValue = control.getCustomData().find((cdv: CustomData) => cdv.getKey() === \"forwardedItemsBinding\");\n\t\tconst values = customDataValue?.getValue();\n\t\t//clean all entries to keep array reference\n\t\tvalues.splice(0);\n\t\tfor (const condition of conditions) {\n\t\t\tconst item: ConditionPayloadType = {};\n\t\t\titem[keyPath] = condition.values[0];\n\t\t\tif (condition.values[1]) {\n\t\t\t\titem[descriptionPath] = condition.values[1];\n\t\t\t}\n\t\t\tvalues.push(item);\n\t\t}\n\n\t\tconst modelNameForUpdate = customDataValue?.getBindingInfo(\"value\")?.parts[0]?.model;\n\t\t(customDataValue?.getModel(modelNameForUpdate) as JSONModel)?.updateBindings(true);\n\t}\n});\n"],"mappings":"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","ignoreList":[],"file":"MultiValueFieldDelegate-dbg.js"}