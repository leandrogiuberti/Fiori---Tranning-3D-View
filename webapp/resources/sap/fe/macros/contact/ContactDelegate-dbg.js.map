{"version":3,"names":["Object","assign","LinkDelegate","_fnTemplateFragment","payload","metaModel","mdcLinkControl","fragmentName","containingView","CommonUtils","getTargetView","appComponent","getAppComponent","preProcessorSettings","bindingContexts","models","contactContext","createBindingContext","contact","payloadModel","JSONModel","fragment","XMLTemplateProcessor","loadTemplate","templateComponent","getController","getOwnerComponent","templatedFragment","XMLPreprocessor","process","name","runAsOwner","Fragment","load","definition","controller","fetchAdditionalContent","getPayload","navigateRegexpMatch","navigationPath","match","binding","getBindingContext","getBinding","aggregation","isA","getAggregation","undefined","isListBindingAnalytical","hierarchyQualifier","bindingContext","length","getModel","bindContext","$$ownRequest","getMetaModel","popoverContent","setBindingContext","getBoundContext","Promise","resolve","fetchLinkType","initialType","type","LinkType","Popover","directLink","runtimeType"],"sourceRoot":".","sources":["ContactDelegate.ts"],"sourcesContent":["import CommonUtils from \"sap/fe/core/CommonUtils\";\nimport Fragment from \"sap/ui/core/Fragment\";\nimport XMLPreprocessor from \"sap/ui/core/util/XMLPreprocessor\";\nimport XMLTemplateProcessor from \"sap/ui/core/XMLTemplateProcessor\";\n\nimport type { EnhanceWithUI5 } from \"sap/fe/base/ClassSupport\";\nimport type AppComponent from \"sap/fe/core/AppComponent\";\nimport type TemplateComponent from \"sap/fe/core/TemplateComponent\";\nimport type Control from \"sap/ui/core/Control\";\nimport LinkType from \"sap/ui/mdc/enums/LinkType\";\nimport type Link from \"sap/ui/mdc/Link\";\nimport LinkDelegate from \"sap/ui/mdc/LinkDelegate\";\nimport JSONModel from \"sap/ui/model/json/JSONModel\";\nimport type { default as Context, default as ODataV4Context } from \"sap/ui/model/odata/v4/Context\";\nimport type ODataListBinding from \"sap/ui/model/odata/v4/ODataListBinding\";\nimport type ODataMetaModel from \"sap/ui/model/odata/v4/ODataMetaModel\";\nimport type ODataModel from \"sap/ui/model/odata/v4/ODataModel\";\n\ntype ContactPayload = { navigationPath: string; contact: string };\n\nexport default Object.assign({}, LinkDelegate, {\n\t/**\n\t * Method called to do the templating of the popover content.\n\t * @param payload\n\t * @param metaModel\n\t * @param mdcLinkControl\n\t * @returns  A promise containing the popover content\n\t */\n\t_fnTemplateFragment: async function (payload: ContactPayload, metaModel: ODataMetaModel, mdcLinkControl: Link) {\n\t\tconst fragmentName = \"sap.fe.macros.contact.ContactQuickView\";\n\t\tconst containingView = CommonUtils.getTargetView(mdcLinkControl);\n\t\tconst appComponent = CommonUtils.getAppComponent(containingView);\n\n\t\tconst preProcessorSettings: { bindingContexts: object; models: object; appComponent: AppComponent } = {\n\t\t\tbindingContexts: {},\n\t\t\tmodels: {},\n\t\t\tappComponent\n\t\t};\n\t\tconst contactContext = metaModel.createBindingContext(payload.contact);\n\t\tconst payloadModel = new JSONModel(payload);\n\n\t\tif (payload.contact && contactContext) {\n\t\t\tpreProcessorSettings.bindingContexts = {\n\t\t\t\tcontact: contactContext,\n\t\t\t\tpayload: payloadModel.createBindingContext(\"/\")\n\t\t\t};\n\t\t\tpreProcessorSettings.models = {\n\t\t\t\tcontact: metaModel,\n\t\t\t\tpayload: payloadModel\n\t\t\t};\n\t\t}\n\n\t\tconst fragment = XMLTemplateProcessor.loadTemplate(fragmentName, \"fragment\");\n\t\tconst templateComponent = containingView.getController().getOwnerComponent() as EnhanceWithUI5<TemplateComponent>;\n\n\t\tconst templatedFragment = await XMLPreprocessor.process(fragment, { name: fragmentName }, preProcessorSettings);\n\t\treturn templateComponent.runAsOwner(async (): Promise<Control> => {\n\t\t\treturn Fragment.load({\n\t\t\t\tdefinition: templatedFragment,\n\t\t\t\tcontroller: containingView.getController()\n\t\t\t}) as Promise<Control>;\n\t\t});\n\t},\n\n\t/**\n\t * Method calls by the mdc.field to determine what should be the content of the popup when mdcLink#open is called.\n\t * @param mdcLinkControl\n\t * @returns A promise containing the popover content\n\t */\n\tfetchAdditionalContent: async function (mdcLinkControl: Link) {\n\t\tconst payload: ContactPayload = mdcLinkControl.getPayload() as ContactPayload;\n\t\tconst navigateRegexpMatch = payload.navigationPath?.match(/{(.*?)}/);\n\n\t\tconst binding = (mdcLinkControl.getBindingContext() as ODataV4Context)?.getBinding();\n\t\tconst aggregation = binding?.isA<ODataListBinding>(\"sap.ui.model.odata.v4.ODataListBinding\")\n\t\t\t? (binding.getAggregation() as { hierarchyQualifier?: string } | undefined)\n\t\t\t: undefined;\n\t\tconst isListBindingAnalytical = aggregation !== undefined && !aggregation.hierarchyQualifier;\n\n\t\tlet bindingContext =\n\t\t\tnavigateRegexpMatch && navigateRegexpMatch.length > 1 && navigateRegexpMatch[1]\n\t\t\t\t? (mdcLinkControl.getModel() as ODataModel).bindContext(\n\t\t\t\t\t\tnavigateRegexpMatch[1],\n\t\t\t\t\t\tmdcLinkControl.getBindingContext() as Context,\n\t\t\t\t\t\t{ $$ownRequest: true }\n\t\t\t\t  )\n\t\t\t\t: null;\n\t\tif (isListBindingAnalytical && !bindingContext) {\n\t\t\t// in case of analytical binding, we need to have a binding with its own cache to ensure data is properly requested\n\t\t\tbindingContext = (mdcLinkControl.getModel() as ODataModel).bindContext(\"\", mdcLinkControl.getBindingContext() as Context, {\n\t\t\t\t$$ownRequest: true\n\t\t\t});\n\t\t}\n\t\tif (mdcLinkControl.isA(\"sap.ui.mdc.Link\")) {\n\t\t\tconst metaModel = (mdcLinkControl.getModel() as ODataModel).getMetaModel();\n\t\t\tconst popoverContent = (await this._fnTemplateFragment(payload, metaModel, mdcLinkControl)) as Control;\n\t\t\tif (bindingContext) {\n\t\t\t\tpopoverContent.setBindingContext(bindingContext.getBoundContext());\n\t\t\t}\n\t\t\treturn [popoverContent];\n\t\t}\n\t\treturn Promise.resolve([]);\n\t},\n\n\tfetchLinkType: async function (): Promise<object> {\n\t\treturn Promise.resolve({\n\t\t\tinitialType: {\n\t\t\t\ttype: LinkType.Popover, // this means mdcLink.open will open a popup which shows content retrieved by fetchAdditionalContent\n\t\t\t\tdirectLink: undefined\n\t\t\t},\n\t\t\truntimeType: undefined\n\t\t});\n\t}\n});\n"],"mappings":"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","ignoreList":[],"file":"ContactDelegate-dbg.js"}