{"version":3,"file":"Email.js","names":["Email","_dec","defineUI5Class","_dec2","property","type","isBindingInfo","_dec3","_dec4","_dec5","_dec6","_class","_class2","_BuildingBlock","properties","others","_this","call","this","_initializerDefineProperty","_descriptor","_descriptor2","_descriptor3","_descriptor4","_descriptor5","visible","undefined","Object","keys","length","constant","linkEnabled","_exports","_inheritsLoose","_proto","prototype","isTeamsConnectionActive","async","appComponent","getAppComponent","getCollaborativeToolsService","isContactsCollaborationSupported","getMailPopoverFromMsTeamsIntegration","mail","setLinkEnabled","enabled","content","setEnabled","onMetadataAvailable","createContent","openPopover","event","preventDefault","revertToDefaultBehaviour","link","getSource","mailBBv4","getParent","popover","openBy","MLibrary","URLHelper","redirect","getValue","getText","setValue","value","setProperty","setText","_jsx","Link","text","emptyIndicatorMode","class","press","ariaLabelledBy","wrapping","BuildingBlock","_applyDecoratedDescriptor","configurable","enumerable","writable","initializer"],"sources":["./Email.tsx"],"sourcesContent":["import { constant } from \"sap/fe/base/BindingToolkit\";\nimport { defineUI5Class, property, type PropertiesOf } from \"sap/fe/base/ClassSupport\";\nimport BuildingBlock from \"sap/fe/core/buildingBlocks/BuildingBlock\";\nimport type { Link$PressEvent } from \"sap/m/Link\";\nimport Link from \"sap/m/Link\";\nimport type Popover from \"sap/m/Popover\";\nimport MLibrary from \"sap/m/library\";\nimport type { PropertyBindingInfo } from \"sap/ui/base/ManagedObject\";\nimport type { $ControlSettings } from \"sap/ui/core/Control\";\n\n@defineUI5Class(\"sap.fe.macros.contact.Email\")\nexport default class Email extends BuildingBlock<Link> {\n\t@property({\n\t\ttype: \"any\",\n\t\tisBindingInfo: true\n\t})\n\tvisible: PropertyBindingInfo = constant(true);\n\n\t@property({\n\t\ttype: \"any\",\n\t\tisBindingInfo: true\n\t})\n\ttext!: PropertyBindingInfo;\n\n\t@property({ type: \"boolean\" })\n\tlinkEnabled = true;\n\n\t@property({ type: \"string\" })\n\tmail!: string | undefined;\n\n\t@property({ type: \"string\" })\n\temptyIndicatorMode = \"Off\";\n\n\tconstructor(properties: $ControlSettings & PropertiesOf<Email>, others?: $ControlSettings) {\n\t\tsuper(properties, others);\n\t\tif (this.visible === undefined || (typeof this.visible === \"object\" && Object.keys(this.visible).length === 0)) {\n\t\t\tthis.visible = constant(true);\n\t\t}\n\t\tif (!this.linkEnabled) this.linkEnabled = true;\n\t}\n\n\t/**\n\t * Checks if the Teams connection is active.\n\t * @returns Boolean value\n\t */\n\tasync isTeamsConnectionActive(): Promise<boolean> {\n\t\tconst appComponent = this.getAppComponent();\n\t\tif (appComponent) {\n\t\t\treturn appComponent.getCollaborativeToolsService().isContactsCollaborationSupported();\n\t\t} else {\n\t\t\treturn false;\n\t\t}\n\t}\n\n\t/**\n\t * Get the mail Popover from the Teams integration.\n\t * @param mail\n\t * @returns Popover or undefined\n\t */\n\tgetMailPopoverFromMsTeamsIntegration(mail: string): Promise<Popover | undefined> | undefined {\n\t\tconst appComponent = this.getAppComponent();\n\t\tif (appComponent) {\n\t\t\treturn appComponent.getCollaborativeToolsService().getMailPopoverFromMsTeamsIntegration(mail);\n\t\t} else {\n\t\t\treturn undefined;\n\t\t}\n\t}\n\n\t/**\n\t * Setter for the linkEnabled property.\n\t * @param enabled\n\t */\n\tsetLinkEnabled(enabled: boolean): void {\n\t\tthis.linkEnabled = enabled;\n\t\tthis.content?.setEnabled(enabled);\n\t}\n\n\t/**\n\t * Handler for the onMetadataAvailable event.\n\t */\n\tonMetadataAvailable(): void {\n\t\tif (!this.content) {\n\t\t\tif (this.visible === undefined || (typeof this.visible === \"object\" && Object.keys(this.visible).length === 0)) {\n\t\t\t\tthis.visible = constant(true);\n\t\t\t}\n\t\t\tif (!this.linkEnabled) this.linkEnabled = true;\n\t\t\tthis.content = this.createContent();\n\t\t}\n\t}\n\n\t/**\n\t * Open a popover if the Teams connection is active or a classic mail.\n\t * @param event\n\t */\n\tasync openPopover(event: Link$PressEvent): Promise<void> {\n\t\tevent.preventDefault(); // stop default behavior based on href\n\t\tlet revertToDefaultBehaviour = false;\n\t\tconst link = event.getSource();\n\t\t// \"this\" doesn't contain the Email instance corresponding to the link so we need to retrieve it in order to read the mail\n\t\tconst mailBBv4 = link.getParent() as Email;\n\n\t\t// we need to check if the teams connection is active now because at templating the teamshelper service might not have been initialized yet\n\t\tif (await this.isTeamsConnectionActive()) {\n\t\t\tif (mailBBv4.mail) {\n\t\t\t\tconst popover = await this.getMailPopoverFromMsTeamsIntegration(mailBBv4.mail);\n\t\t\t\tif (popover) {\n\t\t\t\t\tpopover.openBy(link);\n\t\t\t\t} else {\n\t\t\t\t\trevertToDefaultBehaviour = true;\n\t\t\t\t}\n\t\t\t}\n\t\t} else {\n\t\t\trevertToDefaultBehaviour = true;\n\t\t}\n\t\tif (revertToDefaultBehaviour) {\n\t\t\tMLibrary.URLHelper.redirect(`mailto:${mailBBv4.mail}`);\n\t\t}\n\t}\n\n\t/**\n\t * Retrieves the current value of the Link.\n\t * @returns The current value of the Link\n\t */\n\tgetValue(): string | undefined {\n\t\treturn this.content?.getText();\n\t}\n\n\t/**\n\t * Sets the current value of the Link.\n\t * @param value\n\t * @returns The current Email reference\n\t */\n\tsetValue(value: string | undefined): Email {\n\t\tthis.setProperty(\"text\", value);\n\t\tthis.content?.setText(value);\n\t\treturn this;\n\t}\n\n\t/**\n\t * Create the content.\n\t * @returns The Link\n\t */\n\tcreateContent(): Link {\n\t\treturn (\n\t\t\t<Link\n\t\t\t\tvisible={this.visible}\n\t\t\t\ttext={this.text}\n\t\t\t\tenabled={this.linkEnabled}\n\t\t\t\temptyIndicatorMode={this.emptyIndicatorMode}\n\t\t\t\tclass=\"sapMTextRenderWhitespaceWrap\"\n\t\t\t\tpress={async (event: Link$PressEvent): Promise<void> => this.openPopover(event)}\n\t\t\t\tariaLabelledBy={this.ariaLabelledBy}\n\t\t\t\twrapping={true}\n\t\t\t/>\n\t\t) as Link;\n\t}\n}\n"],"mappings":";;;;yvCAWqBA,GAAKC,EADzBC,EAAe,+BAA8BC,EAE5CC,EAAS,CACTC,KAAM,MACNC,cAAe,OACdC,EAGDH,EAAS,CACTC,KAAM,MACNC,cAAe,OACdE,EAGDJ,EAAS,CAAEC,KAAM,YAAYI,EAG7BL,EAAS,CAAEC,KAAM,WAAWK,EAG5BN,EAAS,CAAEC,KAAM,WAAWJ,EAAAU,GAAAC,EAAA,SAAAC,GAG7B,SAAAb,EAAYc,EAAoDC,GAA2B,IAAAC,EAC1FA,EAAAH,EAAAI,KAAAC,KAAMJ,EAAYC,IAAOG,KAACC,EAAAH,EAAA,UAAAI,EAAAJ,GAAAG,EAAAH,EAAA,OAAAK,EAAAL,GAAAG,EAAAH,EAAA,cAAAM,EAAAN,GAAAG,EAAAH,EAAA,OAAAO,EAAAP,GAAAG,EAAAH,EAAA,qBAAAQ,EAAAR,GAC1B,GAAIA,EAAKS,UAAYC,kBAAqBV,EAAKS,UAAY,UAAYE,OAAOC,KAAKZ,EAAKS,SAASI,SAAW,EAAI,CAC/Gb,EAAKS,QAAUK,EAAS,KACzB,CACA,IAAKd,EAAKe,YAAaf,EAAKe,YAAc,KAAK,OAAAf,CAChD,CAEAgB,EAAAhC,EAAAiC,EAAAjC,EAAAa,GAAA,IAAAqB,EAAAlC,EAAAmC,UAAAD,EAIME,wBAANC,eAAMD,IACL,MAAME,EAAepB,KAAKqB,kBAC1B,GAAID,EAAc,CACjB,OAAOA,EAAaE,+BAA+BC,kCACpD,KAAO,CACN,OAAO,KACR,CACD,EAEAP,EAKAQ,qCAAA,SAAAA,EAAqCC,GACpC,MAAML,EAAepB,KAAKqB,kBAC1B,GAAID,EAAc,CACjB,OAAOA,EAAaE,+BAA+BE,qCAAqCC,EACzF,KAAO,CACN,OAAOjB,SACR,CACD,EAEAQ,EAIAU,eAAA,SAAAA,EAAeC,GACd3B,KAAKa,YAAcc,EACnB3B,KAAK4B,SAASC,WAAWF,EAC1B,EAEAX,EAGAc,oBAAA,SAAAA,IACC,IAAK9B,KAAK4B,QAAS,CAClB,GAAI5B,KAAKO,UAAYC,kBAAqBR,KAAKO,UAAY,UAAYE,OAAOC,KAAKV,KAAKO,SAASI,SAAW,EAAI,CAC/GX,KAAKO,QAAUK,EAAS,KACzB,CACA,IAAKZ,KAAKa,YAAab,KAAKa,YAAc,KAC1Cb,KAAK4B,QAAU5B,KAAK+B,eACrB,CACD,EAEAf,EAIMgB,YAANb,eAAMa,EAAYC,GACjBA,EAAMC,iBACN,IAAIC,EAA2B,MAC/B,MAAMC,EAAOH,EAAMI,YAEnB,MAAMC,EAAWF,EAAKG,YAGtB,SAAUvC,KAAKkB,0BAA2B,CACzC,GAAIoB,EAASb,KAAM,CAClB,MAAMe,QAAgBxC,KAAKwB,qCAAqCc,EAASb,MACzE,GAAIe,EAAS,CACZA,EAAQC,OAAOL,EAChB,KAAO,CACND,EAA2B,IAC5B,CACD,CACD,KAAO,CACNA,EAA2B,IAC5B,CACA,GAAIA,EAA0B,CAC7BO,EAASC,UAAUC,SAAS,UAAUN,EAASb,OAChD,CACD,EAEAT,EAIA6B,SAAA,SAAAA,IACC,OAAO7C,KAAK4B,SAASkB,SACtB,EAEA9B,EAKA+B,SAAA,SAAAA,EAASC,GACRhD,KAAKiD,YAAY,OAAQD,GACzBhD,KAAK4B,SAASsB,QAAQF,GACtB,OAAOhD,IACR,EAEAgB,EAIAe,cAAA,SAAAA,IACC,OACCoB,EAACC,EAAI,CACJ7C,QAASP,KAAKO,QACd8C,KAAMrD,KAAKqD,KACX1B,QAAS3B,KAAKa,YACdyC,mBAAoBtD,KAAKsD,mBACzBC,MAAM,+BACNC,MAAOrC,SAAiDnB,KAAKgC,YAAYC,GACzEwB,eAAgBzD,KAAKyD,eACrBC,SAAU,MAGb,EAAC,OAAA5E,CAAA,CA7H4B,CAnBK6E,GAAazD,EAAA0D,EAAAlE,EAAAuB,UAAA,WAAAhC,GAAA,CAAA4E,aAAA,KAAAC,WAAA,KAAAC,SAAA,KAAAC,YAAA,kBAKhBpD,EAAS,KAAK,IAAAT,EAAAyD,EAAAlE,EAAAuB,UAAA,QAAA5B,GAAA,CAAAwE,aAAA,KAAAC,WAAA,KAAAC,SAAA,KAAAC,YAAA,OAAA5D,EAAAwD,EAAAlE,EAAAuB,UAAA,eAAA3B,GAAA,CAAAuE,aAAA,KAAAC,WAAA,KAAAC,SAAA,KAAAC,YAAA,kBAS/B,IAAI,IAAA3D,EAAAuD,EAAAlE,EAAAuB,UAAA,QAAA1B,GAAA,CAAAsE,aAAA,KAAAC,WAAA,KAAAC,SAAA,KAAAC,YAAA,OAAA1D,EAAAsD,EAAAlE,EAAAuB,UAAA,sBAAAzB,GAAA,CAAAqE,aAAA,KAAAC,WAAA,KAAAC,SAAA,KAAAC,YAAA,iBAMG,KAAK,IAAAtE,KAAAD,GAAAqB,EAAAhC,EAAA,OAAAgC,CAAA","ignoreList":[]}