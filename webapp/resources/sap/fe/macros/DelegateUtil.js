/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)
 *      (c) Copyright 2009-2025 SAP SE. All rights reserved
 */
sap.ui.define(["sap/base/Log","sap/fe/core/CommonUtils","sap/fe/core/converters/MetaModelConverter","sap/fe/core/helpers/StableIdHelper","sap/fe/core/templating/DataModelPathHelper","sap/fe/core/templating/PropertyFormatters","sap/fe/core/templating/PropertyHelper","sap/fe/macros/field/FieldHelper","sap/fe/macros/internal/valuehelp/ValueHelpTemplating"],function(e,t,r,a,o,n,s,i,l){"use strict";var c=l.generateID;var u=s.getAssociatedUnitPropertyPath;var p=s.getAssociatedCurrencyPropertyPath;var d=n.getRelativePropertyPath;var f=o.getTargetObjectPath;var g=o.enhanceDataModelPath;var m=a.generate;var h=r.getInvolvedDataModelObjects;const P="http://schemas.sap.com/sapui5/extension/sap.ui.core.CustomData/1";function y(){this.control.detachModelContextChange(y,this);const e=this.modelName,t=this.control.getModel(e);if(t){this.resolve(t)}else{this.control.attachModelContextChange(y,this)}}const C={FETCHED_PROPERTIES_DATA_KEY:"sap_fe_ControlDelegate_propertyInfoMap",setCachedProperties(e,t){if(e instanceof window.Element){return}const r=C.FETCHED_PROPERTIES_DATA_KEY;C.setCustomData(e,r,t)},getCachedProperties(e){if(e instanceof window.Element){return undefined}const t=C.FETCHED_PROPERTIES_DATA_KEY;return C.getCustomData(e,t)},async getCustomDataWithModifier(e,t,r){if(!r){return Promise.resolve(C.getCustomData(e,t))}const a=await C.retrieveCustomDataNode(e,t,r);if(a.length===1){return r.getProperty(a[0],"value")}else{return undefined}},getCustomData(e,t){if(e&&t){if(e instanceof window.Element){return e.getAttributeNS(P,t)}if(e.data instanceof Function){return e.data(t)}}return undefined},setCustomData(e,t,r){if(e&&t){if(e instanceof window.Element){return e.setAttributeNS(P,`customData:${t}`,r)}if(e.data instanceof Function){return e.data(t,r)}}},fetchPropertiesForEntity(e,t){return t.requestObject(`${e}/`)},fetchAnnotationsForEntity(e,t){return t.requestObject(`${e}@`)},async fetchModel(e){return new Promise(t=>{const r=e.getDelegate().payload&&e.getDelegate().payload?.modelName,a={modelName:r,control:e,resolve:t};y.call(a)})},async templateControlFragment(e,r,a,o){return t.templateControlFragment(e,r,a,o)},async doesValueHelpExist(e){const t=e.sPropertyName||"";const r=e.sValueHelpType||"";const a=e.oMetaModel;const o=e.oModifier;const n=`${e.sBindingPath}/${t}`;const s=a.createBindingContext(n);let l=i.valueHelpProperty(s);const P=e.sBindingPath&&e.sBindingPath.indexOf("/")===0;if(l.includes("$Path")){l=a.getObject(l)}const y=h(s);if(P&&l.indexOf("/")!==0){const e=p(y.targetObject)||u(y.targetObject);const t=g(y,e);l=f(t)}const C=c(e.flexId,m([o?o.getId(e.oControl):e.oControl.getId(),r]),undefined,d(s.getProperty(n),{context:{getModel:()=>e.oMetaModel,getPath:()=>n}}),d(s.getProperty(l),{context:{getModel:()=>e.oMetaModel,getPath:()=>l}}));return Promise.resolve().then(async function(){if(o){return o.getAggregation(e.oControl,"dependents")}return e.oControl.getAggregation("dependents")}).then(async function(t){if(t){for(const r of t){let t=r;if(o){if(o.getControlType(r)==="sap.fe.macros.ValueHelp"&&await o.getProperty(r,"metaPath")===e.metaPath){return true}else if(o.getControlType(r)==="sap.fe.macros.ValueHelp"&&o.targets!=="xmlTree"){t=r.getContent()}else if(o.getControlType(r)==="sap.ui.mdc.ValueHelp"&&o.targets!=="xmlTree"&&o.getId(t).includes("::FilterFieldValueHelp::")){const a=r.getPayload();if(a?.propertyPath&&a?.propertyPath===e.metaPath){return true}else if(!a?.propertyPath){const e=o.getId(t);const r=e.split("::FilterFieldValueHelp::")[1];const a=C.split("::FilterFieldValueHelp::")[1];if(r===a){return true}}}if(t&&o.getId(t)===C){return true}}else{const e=r;if(e.isA("sap.fe.macros.ValueHelp")){t=e.getContent()}if(t?.getId()===C){return true}}}}return false})},async isValueHelpRequired(t,r){const a=t.sPropertyName||"",o=t.oMetaModel,n=`${t.sBindingPath}/${a}`,s=o.createBindingContext(n),l=i.valueHelpProperty(s,r);return this.getCustomDataWithModifier(t.oControl,"displayModePropertyBinding",t.oModifier).then(async function(e){e=typeof e==="boolean"?e:e==="true";if(e){return false}return Promise.all([o.requestObject(`${l}@com.sap.vocabularies.Common.v1.ValueListWithFixedValues`),o.requestObject(`${l}@com.sap.vocabularies.Common.v1.ValueListReferences`),o.requestObject(`${l}@com.sap.vocabularies.Common.v1.ValueListMapping`),o.requestObject(`${l}@com.sap.vocabularies.Common.v1.ValueList`)])}).then(function(e){if(!Array.isArray(e)){return e}return!!e[0]||!!e[1]||!!e[2]||!!e[3]}).catch(function(t){e.warning("Error while retrieving custom data / value list annotation values",t);return false})},isMultiValue(e){let t=true;if(e.dataType&&e.dataType?.indexOf("Boolean")>0){t=false}return t},async retrieveCustomDataNode(e,t,r){const a=[];const o=await Promise.resolve().then(r.getAggregation.bind(r,e,"customData"));for(const e of o){const o=await r.getProperty(e,"key");if(o===t){a.push(e)}}return a}};return C},false);
//# sourceMappingURL=DelegateUtil.js.map