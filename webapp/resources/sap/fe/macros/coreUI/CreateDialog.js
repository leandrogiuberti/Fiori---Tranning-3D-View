/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)
 *      (c) Copyright 2009-2025 SAP SE. All rights reserved
 */
sap.ui.define(["sap/fe/base/BindingToolkit","sap/fe/base/ClassSupport","sap/fe/core/ActionRuntime","sap/fe/core/controllerextensions/BusyLocker","sap/fe/core/converters/MetaModelConverter","sap/fe/core/helpers/MetaModelFunction","sap/fe/core/helpers/ResourceModelHelper","sap/fe/core/helpers/StableIdHelper","sap/fe/core/templating/DataModelPathHelper","sap/fe/core/templating/FieldControlHelper","sap/fe/core/templating/PropertyHelper","sap/fe/macros/field/FieldHelper","sap/fe/macros/internal/valuehelp/ValueHelpTemplating","sap/m/Button","sap/m/Dialog","sap/m/Label","sap/ui/base/EventProvider","sap/ui/core/CustomData","sap/ui/core/Messaging","sap/ui/core/message/MessageType","sap/ui/layout/form/SimpleForm","sap/ui/mdc/Field","sap/ui/mdc/ValueHelp","sap/ui/mdc/valuehelp/Dialog","sap/ui/mdc/valuehelp/Popover","sap/ui/mdc/valuehelp/content/MTable","sap/ui/model/odata/v4/AnnotationHelper","sap/fe/base/jsx-runtime/jsx","sap/fe/base/jsx-runtime/Fragment","sap/fe/base/jsx-runtime/jsxs"],function(e,t,i,a,o,n,r,s,l,c,d,u,p,f,h,g,m,v,C,E,b,P,M,y,T,x,F,O,A,D){"use strict";var I,_,H,V,N;var R={};var S=p.useCaseSensitiveFilterRequests;var j=p.requiresValidation;var L=d.hasValueHelp;var w=c.isRequiredExpression;var B=l.getTargetObjectPath;var z=l.enhanceDataModelPath;var q=s.generate;var U=r.getResourceModel;var k=n.getRequiredPropertiesFromInsertRestrictions;var $=o.getInvolvedDataModelObjects;var K=t.event;var W=t.defineUI5Class;var G=e.or;var Q=e.compileExpression;function J(e,t,i,a){i&&Object.defineProperty(e,t,{enumerable:i.enumerable,configurable:i.configurable,writable:i.writable,value:i.initializer?i.initializer.call(a):void 0})}function X(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e,Y(e,t)}function Y(e,t){return Y=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},Y(e,t)}function Z(e,t,i,a,o){var n={};return Object.keys(a).forEach(function(e){n[e]=a[e]}),n.enumerable=!!n.enumerable,n.configurable=!!n.configurable,("value"in n||n.initializer)&&(n.writable=!0),n=i.slice().reverse().reduce(function(i,a){return a(e,t,i)||i},n),o&&void 0!==n.initializer&&(n.value=n.initializer?n.initializer.call(o):void 0,n.initializer=void 0),void 0===n.initializer?(Object.defineProperty(e,t,n),null):n}function ee(e,t){throw Error("Decorating class property failed. Please ensure that transform-class-properties is enabled and runs after the decorators transform.")}let te=(I=W("sap.fe.core.services.RoutingServiceEventing"),_=K(),I(H=(V=function(e){function t(){var t;for(var i=arguments.length,a=new Array(i),o=0;o<i;o++){a[o]=arguments[o]}t=e.call(this,...a)||this;J(t,"exitDialog",N,t);return t}X(t,e);return t}(m),N=Z(V.prototype,"exitDialog",[_],{configurable:true,enumerable:true,writable:true,initializer:null}),V))||H);let ie=function(){function e(e,t,i,a,o){this.actionParameterInfos=[];this.eventProvider=new te;this.contextToUpdate=e;this.fieldNames=t;this.appComponent=i;this.mode=a;this.parentControl=o;const n=e.getModel();this.metaModel=n.getMetaModel();const r=this.metaModel.getMetaPath(e.getPath());this.requiredFieldNames=k(r,this.metaModel)}R=e;var t=e.prototype;t.attachExitDialog=function e(t,i,a){this.eventProvider.attachEvent("exitDialog",t,i,a)};t.fireExitDialog=function e(t){this.eventProvider.fireEvent("exitDialog",{accept:t})};t.getEditMode=function e(t){if(t.annotations.Common?.FieldControl){const e=t.annotations.Common.FieldControl;return e.$EnumMember==="com.sap.vocabularies.Common.v1.FieldControlType/ReadOnly"?"Display":"Editable"}else{return"Editable"}};t.getFieldVHTypeAhead=function e(t,i,a){return O(T,{children:O(x,{id:q([t,"VH","Popover","qualifier"]),caseSensitive:S(a,a.convertedTypes.entityContainer.annotations.Capabilities?.FilterFunctions??[]),useAsValueHelp:!!i.annotations.Common?.ValueListWithFixedValues})})};t.getFieldVHDialog=function e(t){if(t.annotations.Common?.ValueListWithFixedValues?.valueOf()!==true){return O(y,{})}else{return undefined}};t.getFieldValueHelp=function e(t,i,a){if(!L(i)){return undefined}const o={name:"sap/fe/macros/valuehelp/ValueHelpDelegate",payload:{propertyPath:B(a),qualifiers:{},valueHelpQualifier:""}};return O(M,{id:q([t,"VH"]),delegate:o,validateInput:j(i),typeahead:this.getFieldVHTypeAhead(t,i,a),dialog:this.getFieldVHDialog(i)})};t.createFormElement=function e(t,i,a){const o=z(i,t);const n=o.targetObject;const r=this.metaModel.createBindingContext(`${a}/${t}`);const s=this.metaModel.createBindingContext(`${a}/${t}@com.sap.vocabularies.UI.v1.Placeholder`);const l=O(P,{delegate:{name:"sap/fe/macros/field/FieldBaseDelegate",payload:{retrieveTextFromValueList:true}},id:q(["CreateDialog",i.targetEntityType.name,t]),value:F.format(r.getObject(),{context:r}),placeholder:F.value(s.getObject(),{context:s}),width:"100%",required:Q(G(w(n),this.requiredFieldNames.includes(t))),display:u.getAPDialogDisplayFormat(r.getObject(),{context:r}),valueHelp:L(n)?q([t,"VH"]):undefined,editMode:this.getEditMode(n),dependents:this.getFieldValueHelp(t,n,o),customData:O(v,{value:t},"fieldName"),liveChange:this.handleLiveChange.bind(this),change:this.handleChange.bind(this)});this.actionParameterInfos.push({isMultiValue:false,field:l,value:l.getValue(),validationPromise:undefined,hasError:false,propertyPath:t});return D(A,{children:[O(g,{text:n.annotations.Common?.Label}),l]})};t.afterOpen=function e(){const t=this.actionParameterInfos[0].field;const i=t.getFocusInfo();i.targetInfo={silent:true};t.focus(i)};t.createDialog=function e(){const t=U(this.parentControl??this.appComponent);const i=this.metaModel.getMetaPath(this.contextToUpdate.getPath());const a=this.metaModel.createBindingContext(i);const o=$(a);this.actionParameterInfos=[];const n=t.getText(this.mode==="Standalone"?"C_TRANSACTION_HELPER_SAPFE_ACTION_CREATE_BUTTON_CREATE":"C_TRANSACTION_HELPER_SAPFE_ACTION_CREATE_BUTTON_CONTINUE");const r=O(f,{text:t.getText("C_COMMON_ACTION_PARAMETER_DIALOG_CANCEL"),press:this.onCancel.bind(this)});return O(h,{id:q(["CreateDialog",i]),title:t.getText("C_TRANSACTION_HELPER_SAPFE_ACTION_CREATE",undefined,o.targetEntitySet?.name),afterOpen:()=>{this.afterOpen()},resizable:true,draggable:true,initialFocus:r,children:{beginButton:O(f,{text:n,press:this.onOK.bind(this),type:"Emphasized"}),endButton:r,content:O(b,{children:this.fieldNames.map(e=>this.createFormElement(e,o,i))})}})};t.displayErrorMessages=function e(t){const i=this.metaModel.getMetaPath(this.contextToUpdate.getPath());for(const e of t){for(const t of e.getTargets()){const a=this.metaModel.getMetaPath(t);const o=this.actionParameterInfos.find(e=>`${i}/${e.propertyPath}`===a);if(o){o.hasError=true;o.field.setValueState(e.getType()||E.Error);o.field.setValueStateText(e.getMessage());const t=e.getControlIds();if(!t.includes(o.field.getId())){t.push(o.field.getId())}}}}};t.removeMessagesForActionParameter=function e(t){const i=C.getMessageModel().getData();const a=i.filter(e=>e.getControlIds().some(e=>e.includes(t)));C.removeMessages(a)};t.handleLiveChange=function e(t){const i=t.getSource().getId();this.removeMessagesForActionParameter(i)};t.handleChange=async function e(t){const i=t.getSource();const a=this.actionParameterInfos.find(e=>e.field===i);if(a!==undefined){this.removeMessagesForActionParameter(i.getId());a.validationPromise=t.getParameter("promise");try{a.value=await a.validationPromise;a.hasError=false;a.field.setValueState(E.None)}catch(e){delete a.value;a.hasError=true}}};t.onOK=async function e(){const t=U(this.appComponent);if(await i.validateProperties(this.actionParameterInfos,t)){this.fireExitDialog(true)}};t.onCancel=function e(){this.fireExitDialog(false)};t.onEscape=function e(t){t.reject();this.onCancel()};t.openDialog=function e(){if(this.dialog){throw new Error("Cannot open the Create dialog twice")}this.dialog=this.createDialog();this.dialog.setEscapeHandler(this.onEscape.bind(this));this.parentControl?.addDependent(this.dialog);this.dialog.setBindingContext(this.contextToUpdate);this.dialog.open();return this.dialog};t.closeDialog=function e(){for(const e of this.actionParameterInfos){const t=e.field.getId();this.removeMessagesForActionParameter(t)}if(this.dialog&&a.isLocked(this.dialog)){a.unlock(this.dialog)}this.dialog?.close();this.dialog?.destroy();this.dialog=undefined};t.setBusy=function e(t){if(!this.dialog){return}if(t){a.lock(this.dialog)}else{a.unlock(this.dialog)}};t.isOpen=function e(){return this.dialog?.isOpen()??false};return e}();R=ie;return R},false);
//# sourceMappingURL=CreateDialog.js.map