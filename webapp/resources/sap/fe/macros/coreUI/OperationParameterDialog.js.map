{"version":3,"file":"OperationParameterDialog.js","names":["ActionParameterDialog","action","parameters","parameterValues","entitySetName","messageHandler","this","isDialogOpen","buttonLock","actionParameterInfos","parameterModel","JSONModel","$displayMode","actionName","actionHelper","getActionName","metaModel","model","getMetaModel","resourceModel","view","getResourceModel","appComponent","parametersValuesPromise","Promise","resolve","reject","parametersValuesResolve","parametersValuesReject","_exports","_proto","prototype","getParameterEditMode","parameter","annotations","fieldControl","Common","FieldControl","immutable","Core","Immutable","valueOf","computed","Computed","constant","FieldEditMode","ReadOnly","ifElse","isReadOnlyExpression","isDisabledExpression","Disabled","Editable","createFormElement","async","actionMetaPath","isBound","getMetaPath","contexts","getPath","convertTypes","namespace","name","metaContext","createBindingContext","field","label","Label","getText","toString","streamParameter","isCollection","createMultiField","type","startsWith","getStreamProperty","createFileUploader","createField","_jsxs","_Fragment","children","_jsx","id","generate","text","parameterContext","display","FieldHelper","getAPDialogDisplayFormat","getObject","context","err","Log","warning","placeHolder","UI","Placeholder","placeHolderExpression","compileExpression","getExpressionFromAnnotation","undefined","parameterType","EDM_TYPE_MAPPING","MultiValueField","placeholder","items","path","delegate","editMode","width","multipleLines","MultiLineText","required","isActionParameterRequiredExpression","valueHelp","hasValueHelp","change","handleFieldChange","e","visible","not","equal","Hidden","ariaLabelledBy","dependents","createParameterDialogValueHelp","MultiValueFieldItem","description","fileAcceptableMediaTypes","AcceptableMediaTypes","acceptedTypes","Array","from","map","join","handleTypeMissmatch","event","fileUploader","getSource","givenType","getParameter","getMimeType","showTypeMismatchDialog","fileMaximumSize","calculateMBfromByte","maxLength","handleFileSizeExceed","showFileSizeExceedDialog","getMaximumFileSize","toFixed","onUploadComplete","displayMessageForFailedUpload","FileUploader","buttonOnly","iconOnly","multiple","tooltip","icon","style","sendXHR","useMultipart","sameFilenameAllowed","uploadOnChange","mimeType","typeMissmatch","maximumFileSize","fileSizeExceed","httpRequestMethod","FileUploaderHttpRequestMethod","Put","uploadComplete","handleFileUploaderChange","additionalValue","getAdditionalValue","Field","payload","retrieveTextFromValueList","value","AnnotationHelper","format","isMultiLineText","ValueHelp","propertyPath","getTargetNavigationPath","getInvolvedDataModelObjects","substring","lastIndexOf","qualifiers","valueHelpQualifier","validateInput","requiresValidation","typeahead","Popover","MTable","caseSensitive","useCaseSensitiveFilterRequests","entityContainer","Capabilities","FilterFunctions","ModelHelper","isFilteringCaseSensitive","useAsValueHelp","ValueListWithFixedValues","dialog","createFieldVHDialog","VHDialog","fieldPromise","parameterInfo","find","actionParameterInfo","validationPromise","removeMessagesForParameter","parametersValues","hasError","error","ActionRuntime","_addMessageForActionParameter","message","files","getBase64File","getMimeTypePath","getFileNamePath","ContentDisposition","Filename","MediaType","typeReference","properties","property","reader","FileReader","onload","result","split","readAsDataURL","item","messages","Messaging","getMessageModel","getData","controlId","relevantMessages","filter","msg","getControlIds","some","includes","removeMessages","getFormElements","formElements","getDialog","createDialog","dialogContents","dialogContentsWithParameters","actionParameters","slice","OperationParameterFacets","actionParameterGroups","forEach","facet","facetTitle","$Type","hasFieldGroupTarget","fieldGroup","Target","$target","groupedActionParameters","Data","group","push","Value","data","getGroupForm","all","bind","formData","parameterGroup","opFacets","dialogContent","Title","element","opFacet","registerActionParameterInfo","messageStrip","getCustomActionMessageStripText","endButton","Button","press","onCancel","Dialog","title","getTitleText","escapeHandler","draggable","resizable","afterClose","beforeOpen","afterOpen","initialFocus","beginButton","isCreateAction","getBeginButtonLabel","onApply","content","MessageStrip","showIcon","SimpleForm","columnsM","editable","labelSpanL","labelSpanM","binding","actionLabel","key","defaultKey","getOverriddenText","boundActionName","pop","suffixResourceKey","checkIfResourceKeyExists","getObjectBinding","getParameterContext","BusyLocker","lock","validateProperties","unlock","newValuesDictionary","Object","assign","values","getModel","getProperty","paramValue","Key","isNewValue","setProperty","UiModelConstants","DocumentModified","removeTransitionMessages","resetState","unlockDialog","updateDialogBindingContextForError","length","warningContext","infoContext","erroneousCtx","getMessages","getType","MessageType","Warning","Information","Error","contextToUse","setBindingContext","isLocked","FELibrary","Constants","CancelActionDialog","closeDialog","events","onParameterDialogClosed","close","openDialog","CommonUtils","setUserDefaults","setModels","addDependent","setOperationDefaultValues","open","setModel","bindElement","_event","waitForParametersValues","isOpen","getParameterDefaultValue","bindingParameter","operationBinding","parameterModelData","paramName","defaultValue","ParameterDefaultValue","isPathAnnotationExpression","pathForContext","replace","requestSingletonProperty","requestProperty","noPossibleValue","latePropertyError","getManifestFunctionValues","bindingContext","getBindingContext","defaultValuesExtensionFunction","FPMHelper","loadModuleAndCallMethod","getPreDefinedValues","boundFunctionName","DefaultValuesFunction","requestContextObject","functionParams","boundFunction","Operation","getOperationFromName","ODataOperation","enhance$select","groupId","execute","isFulfilled","boundContext","requestObject","contextValues","promises","defaultValues","functionValues","manifestFunctionValues","firstVisibleParameter","getVisible","firstField","focusInfo","getFocusInfo","targetInfo","silent","focus","onParameterDialogOpened","isMultiValue","setParameter","i","parameterName","parameterProvidedValue","hasOwnProperty","setOfFunctionValues","Set","index","size","next","refresh","MessageBox","actions","Action","OK","emphasizedAction","onClose","extensionAPI","getController","getExtensionAPI","contentWidth","functionContext","getBinding","isA","destroy","oInterface","textContext","contextPath","localDataProperty","$Name","valueListByQualifier","requestValueListInfo","valueListParameter","Parameters","LocalDataProperty","$PropertyPath","ValueListProperty","textProperty","CollectionPath","propAnnotations","textProp","textPath","$Path"],"sources":["./OperationParameterDialog.tsx"],"sourcesContent":["import type { ComplexType, PathAnnotationExpression, PrimitiveType, Property, PropertyAnnotationValue } from \"@sap-ux/vocabularies-types\";\nimport { type Action, type ActionParameter } from \"@sap-ux/vocabularies-types\";\nimport { type PropertyAnnotations_Core } from \"@sap-ux/vocabularies-types/vocabularies/Core_Edm\";\nimport type { DataField, FieldGroupType, ReferenceFacet } from \"@sap-ux/vocabularies-types/vocabularies/UI\";\nimport { UIAnnotationTypes } from \"@sap-ux/vocabularies-types/vocabularies/UI\";\nimport Log from \"sap/base/Log\";\nimport type { PathInModelExpression } from \"sap/fe/base/BindingToolkit\";\nimport {\n\tEDM_TYPE_MAPPING,\n\tcompileExpression,\n\tconstant,\n\tequal,\n\tgetExpressionFromAnnotation,\n\tifElse,\n\tnot,\n\ttype BindingToolkitExpression\n} from \"sap/fe/base/BindingToolkit\";\nimport type { ActionParameterInfo } from \"sap/fe/core/ActionRuntime\";\nimport ActionRuntime from \"sap/fe/core/ActionRuntime\";\nimport type AppComponent from \"sap/fe/core/AppComponent\";\nimport type { FEView } from \"sap/fe/core/BaseController\";\nimport CommonUtils from \"sap/fe/core/CommonUtils\";\nimport type ResourceModel from \"sap/fe/core/ResourceModel\";\nimport BusyLocker from \"sap/fe/core/controllerextensions/BusyLocker\";\nimport type MessageHandler from \"sap/fe/core/controllerextensions/MessageHandler\";\nimport UiModelConstants from \"sap/fe/core/controllerextensions/editFlow/editFlowConstants\";\nimport ODataOperation from \"sap/fe/core/controllerextensions/editFlow/operations/ODataOperation\";\nimport Operation from \"sap/fe/core/controllerextensions/editFlow/operations/Operation\";\nimport actionHelper from \"sap/fe/core/controllerextensions/editFlow/operations/actionHelper\";\nimport { convertTypes, getInvolvedDataModelObjects } from \"sap/fe/core/converters/MetaModelConverter\";\nimport { hasFieldGroupTarget } from \"sap/fe/core/converters/annotations/DataField\";\nimport FPMHelper from \"sap/fe/core/helpers/FPMHelper\";\nimport ModelHelper from \"sap/fe/core/helpers/ModelHelper\";\nimport { getResourceModel } from \"sap/fe/core/helpers/ResourceModelHelper\";\nimport { generate } from \"sap/fe/core/helpers/StableIdHelper\";\nimport { isFulfilled, isPathAnnotationExpression } from \"sap/fe/core/helpers/TypeGuards\";\nimport FELibrary from \"sap/fe/core/library\";\nimport { getTargetNavigationPath } from \"sap/fe/core/templating/DataModelPathHelper\";\nimport { isActionParameterRequiredExpression, isDisabledExpression, isReadOnlyExpression } from \"sap/fe/core/templating/FieldControlHelper\";\nimport { hasValueHelp, isMultiLineText } from \"sap/fe/core/templating/PropertyHelper\";\nimport type { ComputedAnnotationInterface } from \"sap/fe/core/templating/UIFormatters\";\nimport FieldHelper from \"sap/fe/macros/field/FieldHelper\";\nimport { requiresValidation, useCaseSensitiveFilterRequests } from \"sap/fe/macros/internal/valuehelp/ValueHelpTemplating\";\nimport type { AnnotationValueListParameter } from \"sap/fe/macros/internal/valuehelp/ValueListHelper\";\nimport type ListReportExtensionAPI from \"sap/fe/templates/ListReport/ExtensionAPI\";\nimport type ObjectPageExtensionAPI from \"sap/fe/templates/ObjectPage/ExtensionAPI\";\nimport Button from \"sap/m/Button\";\nimport type { Dialog$BeforeOpenEvent } from \"sap/m/Dialog\";\nimport Dialog from \"sap/m/Dialog\";\nimport Label from \"sap/m/Label\";\nimport MessageBox from \"sap/m/MessageBox\";\nimport MessageStrip from \"sap/m/MessageStrip\";\nimport Messaging from \"sap/ui/core/Messaging\";\nimport Title from \"sap/ui/core/Title\";\nimport type Message from \"sap/ui/core/message/Message\";\nimport MessageType from \"sap/ui/core/message/MessageType\";\nimport SimpleForm from \"sap/ui/layout/form/SimpleForm\";\nimport type { Field$ChangeEvent } from \"sap/ui/mdc/Field\";\nimport Field from \"sap/ui/mdc/Field\";\nimport type { MultiValueField$ChangeEvent } from \"sap/ui/mdc/MultiValueField\";\nimport MultiValueField from \"sap/ui/mdc/MultiValueField\";\nimport ValueHelp from \"sap/ui/mdc/ValueHelp\";\nimport FieldEditMode from \"sap/ui/mdc/enums/FieldEditMode\";\nimport MultiValueFieldItem from \"sap/ui/mdc/field/MultiValueFieldItem\";\nimport VHDialog from \"sap/ui/mdc/valuehelp/Dialog\";\nimport Popover from \"sap/ui/mdc/valuehelp/Popover\";\nimport MTable from \"sap/ui/mdc/valuehelp/content/MTable\";\nimport type Context from \"sap/ui/model/Context\";\nimport JSONModel from \"sap/ui/model/json/JSONModel\";\nimport AnnotationHelper from \"sap/ui/model/odata/v4/AnnotationHelper\";\nimport type { default as ODataV4Context } from \"sap/ui/model/odata/v4/Context\";\nimport type ODataContextBinding from \"sap/ui/model/odata/v4/ODataContextBinding\";\nimport type ODataMetaModel from \"sap/ui/model/odata/v4/ODataMetaModel\";\nimport type ODataModel from \"sap/ui/model/odata/v4/ODataModel\";\nimport type {\n\tFileUploader$ChangeEvent,\n\tFileUploader$FileSizeExceedEvent,\n\tFileUploader$TypeMissmatchEvent,\n\tFileUploader$UploadCompleteEvent\n} from \"sap/ui/unified/FileUploader\";\nimport FileUploader from \"sap/ui/unified/FileUploader\";\nimport FileUploaderHttpRequestMethod from \"sap/ui/unified/FileUploaderHttpRequestMethod\";\nimport { displayMessageForFailedUpload, showFileSizeExceedDialog, showTypeMismatchDialog } from \"../internal/helpers/Upload\";\n\ntype ParameterDefaultValue = { paramName: string; value: unknown; latePropertyError?: boolean; noPossibleValue?: boolean };\n\ntype ElementGroup = { facetTitle: PropertyAnnotationValue<string> | undefined; data: ActionParameter[] };\ntype ElementGroupConverted = { facetTitle: PropertyAnnotationValue<string> | undefined; data: DialogContentTypes[] };\n\ntype FormElementType = [Label, Field | MultiValueField];\n\ntype DialogContentTypes = {\n\tformElements: FormElementType;\n\tparameter: ActionParameter;\n};\nexport default class ActionParameterDialog {\n\tprivate parametersValuesPromise: Promise<Record<string, PrimitiveType>>;\n\n\tprivate parametersValuesResolve!: (resolveValue: Record<string, PrimitiveType>) => void;\n\n\tprivate parametersValuesReject!: (error: unknown) => void;\n\n\t// the dialog is considered as closed after the afterClose event has been triggered\n\t// this is asynchronous, so we need to keep track of the dialog state since the message handling is synchronous\n\t// and we need to know if the dialog is open or closed\n\tprivate isDialogOpen = false;\n\n\tprivate dialog: Dialog | undefined;\n\n\tprivate readonly actionName: string;\n\n\tprivate buttonLock = false;\n\n\tprivate readonly metaModel: ODataMetaModel;\n\n\tprivate readonly actionParameterInfos: (ActionParameterInfo & { parameter: ActionParameter })[] = [];\n\n\tprivate readonly parameterModel: JSONModel = new JSONModel({\n\t\t$displayMode: {}\n\t});\n\n\tprivate readonly resourceModel: ResourceModel;\n\n\tconstructor(\n\t\tprivate readonly action: Action,\n\t\tprivate readonly parameters: {\n\t\t\tappComponent: AppComponent;\n\t\t\tcontexts: ODataV4Context[];\n\t\t\tparametersValues: Record<string, PrimitiveType>;\n\t\t\tdefaultValuesExtensionFunction?: string;\n\t\t\tisCreateAction?: boolean;\n\t\t\tlabel?: string;\n\t\t\tmodel: ODataModel;\n\t\t\tview?: FEView;\n\t\t\tevents?: {\n\t\t\t\tonParameterDialogOpened?: () => void;\n\t\t\t\tonParameterDialogClosed?: () => void;\n\t\t\t};\n\t\t},\n\t\tprivate readonly parameterValues: Record<string, unknown>[] | undefined,\n\t\tprivate readonly entitySetName: string | undefined,\n\t\tprivate readonly messageHandler: MessageHandler\n\t) {\n\t\tthis.actionName = actionHelper.getActionName(this.action);\n\t\tthis.metaModel = this.parameters.model.getMetaModel();\n\t\tthis.resourceModel = this.parameters.view ? getResourceModel(this.parameters.view) : getResourceModel(this.parameters.appComponent);\n\t\tthis.parametersValuesPromise = new Promise((resolve, reject) => {\n\t\t\tthis.parametersValuesResolve = resolve;\n\t\t\tthis.parametersValuesReject = reject;\n\t\t});\n\t}\n\n\t/**\n\t * Gets binding expression of the edit mode property for a parameter.\n\t * @param parameter The parameter\n\t * @returns The binding expression.\n\t */\n\tprivate getParameterEditMode(parameter: ActionParameter): BindingToolkitExpression<FieldEditMode> {\n\t\tconst annotations = parameter.annotations,\n\t\t\tfieldControl = annotations.Common?.FieldControl,\n\t\t\timmutable = (annotations.Core as unknown as PropertyAnnotations_Core)?.Immutable?.valueOf(),\n\t\t\tcomputed = (annotations.Core as unknown as PropertyAnnotations_Core)?.Computed?.valueOf();\n\n\t\tif (immutable || computed) {\n\t\t\treturn constant(FieldEditMode.ReadOnly);\n\t\t} else if (fieldControl) {\n\t\t\treturn ifElse(\n\t\t\t\tisReadOnlyExpression(parameter),\n\t\t\t\tFieldEditMode.ReadOnly,\n\t\t\t\tifElse(isDisabledExpression(parameter), FieldEditMode.Disabled, FieldEditMode.Editable)\n\t\t\t);\n\t\t}\n\t\treturn constant(FieldEditMode.Editable);\n\t}\n\n\t/**\n\t * Creates the form element control for a parameter.\n\t * @param parameter The parameter\n\t * @returns The form element control.\n\t */\n\tprivate async createFormElement(parameter: ActionParameter): Promise<FormElementType> {\n\t\tconst actionMetaPath = this.action.isBound\n\t\t\t? `${this.metaModel.getMetaPath(this.parameters.contexts[0].getPath())}/${convertTypes(this.metaModel).namespace}.${\n\t\t\t\t\tthis.action.name\n\t\t\t  }`\n\t\t\t: `/${this.action.name}`;\n\t\tconst metaContext = this.metaModel.createBindingContext(`${actionMetaPath}/${parameter.name}`)!;\n\t\tlet field;\n\t\tlet label = parameter.annotations.Common?.Label\n\t\t\t? this.resourceModel.getText(parameter.annotations.Common.Label.toString())\n\t\t\t: parameter.name;\n\t\tlet streamParameter;\n\t\tif (parameter.isCollection) {\n\t\t\tfield = await this.createMultiField(parameter, metaContext);\n\t\t} else if (!parameter.type.startsWith(\"Edm.\") && this.getStreamProperty(parameter)) {\n\t\t\tstreamParameter = this.getStreamProperty(parameter);\n\t\t\t// calculate label from the stream property within the ComplexType\n\t\t\tlabel = streamParameter?.annotations.Common?.Label\n\t\t\t\t? this.resourceModel.getText(streamParameter.annotations.Common.Label.toString())\n\t\t\t\t: (streamParameter?.name as string);\n\t\t\tfield = this.createFileUploader(parameter);\n\t\t} else {\n\t\t\tfield = await this.createField(parameter, metaContext);\n\t\t}\n\t\treturn (\n\t\t\t<>\n\t\t\t\t<Label id={generate([\"APD_\", parameter.name, streamParameter?.name, \"Label\"])} text={label} />\n\t\t\t\t{field}\n\t\t\t</>\n\t\t);\n\t}\n\n\t/**\n\t * Creates the multi field control for a parameter.\n\t * @param parameter The parameter\n\t * @param parameterContext The parameter context\n\t * @returns The multi value field control.\n\t */\n\tprivate async createMultiField(parameter: ActionParameter, parameterContext: Context): Promise<MultiValueField> {\n\t\tlet display = \"Value\";\n\t\ttry {\n\t\t\tdisplay = await FieldHelper.getAPDialogDisplayFormat(parameterContext.getObject(), { context: parameterContext });\n\t\t} catch (err: unknown) {\n\t\t\tLog.warning(`Parameter dialog multifield: display format couldn't be calculated for parameter '${parameter.name}': ${err}`);\n\t\t}\n\t\tconst placeHolder = parameter.annotations.UI?.Placeholder as PropertyAnnotationValue<PrimitiveType> | undefined;\n\t\tconst placeHolderExpression = placeHolder ? compileExpression(getExpressionFromAnnotation(placeHolder)) : undefined;\n\t\tconst parameterType = EDM_TYPE_MAPPING?.[parameter.type]?.type;\n\t\treturn (\n\t\t\t<MultiValueField\n\t\t\t\tid={generate([\"APD_\", parameter.name])}\n\t\t\t\tplaceholder={placeHolderExpression}\n\t\t\t\titems={{ path: `mvfview>/${parameter.name}` }}\n\t\t\t\tdelegate={{ name: \"sap/fe/core/controls/MultiValueParameterDelegate\" }}\n\t\t\t\tdisplay={display}\n\t\t\t\teditMode={this.getParameterEditMode(parameter)}\n\t\t\t\twidth=\"100%\"\n\t\t\t\tmultipleLines={parameter.annotations.UI?.MultiLineText?.valueOf() === true}\n\t\t\t\trequired={compileExpression(isActionParameterRequiredExpression(parameter, this.action, convertTypes(this.metaModel)))}\n\t\t\t\tvalueHelp={hasValueHelp(parameter) ? generate([this.actionName, parameter.name]) : undefined}\n\t\t\t\tchange={async (e): Promise<void> => this.handleFieldChange(e, parameter)}\n\t\t\t\tvisible={compileExpression(not(equal(getExpressionFromAnnotation(parameter.annotations?.UI?.Hidden), true)))}\n\t\t\t\tariaLabelledBy={[generate([\"APD_\", parameter.name, \"Label\"])]}\n\t\t\t\tdependents={this.createParameterDialogValueHelp(parameter, parameterContext)}\n\t\t\t>\n\t\t\t\t<MultiValueFieldItem key={`{path: 'mvfview>Key', type:'${parameterType}'}`} description=\"{mvfview>Desc}\" />\n\t\t\t</MultiValueField>\n\t\t);\n\t}\n\n\t/**\n\t * Creates the FileUploader control for a parameter.\n\t * @param parameter The parameter\n\t * @returns The FileUploader control.\n\t */\n\tprivate createFileUploader(parameter: ActionParameter): FileUploader {\n\t\tlet fileAcceptableMediaTypes;\n\t\tif (this.getStreamProperty(parameter)?.annotations.Core?.AcceptableMediaTypes) {\n\t\t\tconst acceptedTypes = Array.from(\n\t\t\t\tthis.getStreamProperty(parameter)?.annotations.Core?.AcceptableMediaTypes as unknown as string[]\n\t\t\t).map((type) => `'${type}'`);\n\t\t\tfileAcceptableMediaTypes = `{=odata.collection([${acceptedTypes.join(\",\")}])}`;\n\t\t}\n\t\tconst handleTypeMissmatch = function (event: FileUploader$TypeMissmatchEvent): void {\n\t\t\tconst fileUploader = event.getSource();\n\t\t\tconst givenType = event.getParameter(\"mimeType\");\n\t\t\tconst acceptedTypes = fileUploader.getMimeType();\n\t\t\tif (givenType) {\n\t\t\t\tshowTypeMismatchDialog(fileUploader, givenType, acceptedTypes);\n\t\t\t}\n\t\t};\n\t\t// verify check for stream\n\t\tconst fileMaximumSize = FieldHelper.calculateMBfromByte(this.getStreamProperty(parameter)?.maxLength);\n\t\tconst handleFileSizeExceed = function (event: FileUploader$FileSizeExceedEvent): void {\n\t\t\tconst fileUploader = event?.getSource();\n\t\t\tshowFileSizeExceedDialog(fileUploader, fileUploader.getMaximumFileSize().toFixed(3));\n\t\t};\n\t\tconst onUploadComplete = function (event: FileUploader$UploadCompleteEvent): void {\n\t\t\tif (event.getParameter(\"status\") === 0 || (event.getParameter(\"status\") as number) >= 400) {\n\t\t\t\tdisplayMessageForFailedUpload(\n\t\t\t\t\tevent.getSource(),\n\t\t\t\t\t(event.getParameter(\"responseRaw\") as string) || (event.getParameter(\"response\") as string)\n\t\t\t\t);\n\t\t\t}\n\t\t};\n\t\treturn (\n\t\t\t<FileUploader\n\t\t\t\tname=\"FEV4FileUpload\"\n\t\t\t\tbuttonOnly=\"false\"\n\t\t\t\ticonOnly=\"true\"\n\t\t\t\tmultiple=\"false\"\n\t\t\t\ttooltip=\"{sap.fe.i18n>M_FIELD_FILEUPLOADER_UPLOAD_BUTTON_TOOLTIP}\"\n\t\t\t\ticon=\"sap-icon://upload\"\n\t\t\t\tstyle=\"Transparent\"\n\t\t\t\tsendXHR=\"true\"\n\t\t\t\tuseMultipart=\"false\"\n\t\t\t\tsameFilenameAllowed=\"true\"\n\t\t\t\tuploadOnChange=\"false\"\n\t\t\t\tmimeType={fileAcceptableMediaTypes}\n\t\t\t\ttypeMissmatch={handleTypeMissmatch}\n\t\t\t\tmaximumFileSize={fileMaximumSize}\n\t\t\t\tfileSizeExceed={handleFileSizeExceed}\n\t\t\t\thttpRequestMethod={FileUploaderHttpRequestMethod.Put}\n\t\t\t\tuploadComplete={onUploadComplete}\n\t\t\t\tchange={async (e): Promise<void> => this.handleFileUploaderChange(e, parameter)}\n\t\t\t/>\n\t\t);\n\t}\n\n\t/**\n\t * Creates the field control for a parameter.\n\t * @param parameter The parameter\n\t * @param parameterContext The parameter context\n\t * @returns The field control.\n\t */\n\tprivate async createField(parameter: ActionParameter, parameterContext: Context): Promise<Field> {\n\t\tlet display = \"Value\";\n\t\tlet additionalValue;\n\t\ttry {\n\t\t\tdisplay = await FieldHelper.getAPDialogDisplayFormat(parameterContext.getObject(), { context: parameterContext });\n\t\t\tif (hasValueHelp(parameter)) {\n\t\t\t\tadditionalValue = await this.getAdditionalValue({ context: parameterContext });\n\t\t\t}\n\t\t} catch (err: unknown) {\n\t\t\tLog.warning(`Parameter dialog field: display format couldn't be calculated for parameter '${parameter.name}': ${err}`);\n\t\t}\n\t\tconst placeHolder = parameter.annotations.UI?.Placeholder as PropertyAnnotationValue<PrimitiveType> | undefined;\n\t\tconst placeHolderExpression = placeHolder ? compileExpression(getExpressionFromAnnotation(placeHolder)) : undefined;\n\t\treturn (\n\t\t\t<Field\n\t\t\t\tdelegate={{ name: \"sap/fe/macros/field/FieldBaseDelegate\", payload: { retrieveTextFromValueList: true } }}\n\t\t\t\tid={generate([\"APD_\", parameter.name])}\n\t\t\t\tvalue={AnnotationHelper.format(parameterContext.getObject(), { context: parameterContext })}\n\t\t\t\tplaceholder={placeHolderExpression}\n\t\t\t\tdisplay={display}\n\t\t\t\teditMode={this.getParameterEditMode(parameter)}\n\t\t\t\twidth=\"100%\"\n\t\t\t\tmultipleLines={isMultiLineText(parameter)}\n\t\t\t\trequired={compileExpression(isActionParameterRequiredExpression(parameter, this.action, convertTypes(this.metaModel)))}\n\t\t\t\tchange={async (e): Promise<void> => this.handleFieldChange(e, parameter)}\n\t\t\t\tvalueHelp={hasValueHelp(parameter) ? generate([this.actionName, parameter.name]) : undefined}\n\t\t\t\tdependents={this.createParameterDialogValueHelp(parameter, parameterContext)}\n\t\t\t\tvisible={compileExpression(\n\t\t\t\t\tifElse(\n\t\t\t\t\t\tparameter.name === \"ResultIsActiveEntity\",\n\t\t\t\t\t\tfalse,\n\t\t\t\t\t\tnot(equal(getExpressionFromAnnotation(parameter.annotations?.UI?.Hidden), true))\n\t\t\t\t\t)\n\t\t\t\t)}\n\t\t\t\tariaLabelledBy={[generate([\"APD_\", parameter.name, \"Label\"])]}\n\t\t\t\tadditionalValue={additionalValue}\n\t\t\t/>\n\t\t);\n\t}\n\n\t/**\n\t * Creates the valueHelp  for a parameter.\n\t * @param parameter The parameter\n\t * @param parameterContext The parameter context\n\t * @returns A valueHelp if the parameter has a VH, undefined otherwise\n\t */\n\tprivate createParameterDialogValueHelp(parameter: ActionParameter, parameterContext: Context): ValueHelp | undefined {\n\t\tif (!hasValueHelp(parameter)) {\n\t\t\treturn undefined;\n\t\t}\n\t\treturn (\n\t\t\t<ValueHelp\n\t\t\t\tid={generate([this.actionName, parameter.name])}\n\t\t\t\tdelegate={{\n\t\t\t\t\tname: \"sap/fe/macros/valuehelp/ValueHelpDelegate\",\n\t\t\t\t\tpayload: {\n\t\t\t\t\t\tpropertyPath: this.action.isBound\n\t\t\t\t\t\t\t? `${getTargetNavigationPath(getInvolvedDataModelObjects<ActionParameter>(parameterContext))}/${\n\t\t\t\t\t\t\t\t\tthis.actionName\n\t\t\t\t\t\t\t  }/${parameter.name}`\n\t\t\t\t\t\t\t: `/${this.action.name.substring(this.action.name.lastIndexOf(\".\") + 1)}/${parameter.name}`,\n\t\t\t\t\t\tqualifiers: {},\n\t\t\t\t\t\tvalueHelpQualifier: \"\"\n\t\t\t\t\t}\n\t\t\t\t}}\n\t\t\t\tvalidateInput={requiresValidation(parameter)}\n\t\t\t\ttypeahead={\n\t\t\t\t\t<Popover>\n\t\t\t\t\t\t<MTable\n\t\t\t\t\t\t\tid={generate([this.actionName, parameter.name, \"Popover\", \"qualifier\"])}\n\t\t\t\t\t\t\tcaseSensitive={\n\t\t\t\t\t\t\t\tthis.action.isBound\n\t\t\t\t\t\t\t\t\t? useCaseSensitiveFilterRequests(\n\t\t\t\t\t\t\t\t\t\t\tgetInvolvedDataModelObjects<ActionParameter>(parameterContext),\n\t\t\t\t\t\t\t\t\t\t\t(convertTypes(this.metaModel).entityContainer.annotations.Capabilities\n\t\t\t\t\t\t\t\t\t\t\t\t?.FilterFunctions as unknown as string[]) ?? []\n\t\t\t\t\t\t\t\t\t  )\n\t\t\t\t\t\t\t\t\t: ModelHelper.isFilteringCaseSensitive(this.metaModel)\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tuseAsValueHelp={!!parameter.annotations.Common?.ValueListWithFixedValues}\n\t\t\t\t\t\t/>\n\t\t\t\t\t</Popover>\n\t\t\t\t}\n\t\t\t\tdialog={this.createFieldVHDialog(parameter)}\n\t\t\t></ValueHelp>\n\t\t);\n\t}\n\n\t/**\n\t * Creates the ValueHelp dialog for a parameter.\n\t * @param parameter The parameter\n\t * @returns A dialog if the parameter has a VH, undefined otherwise\n\t */\n\tprivate createFieldVHDialog(parameter: ActionParameter): VHDialog | undefined {\n\t\tif (parameter.annotations.Common?.ValueListWithFixedValues?.valueOf() !== true) {\n\t\t\treturn <VHDialog />;\n\t\t} else {\n\t\t\treturn undefined;\n\t\t}\n\t}\n\n\t/**\n\t * Handles the field change event for a parameter.\n\t * @param event The ui5 event\n\t * @param parameter The parameter\n\t * @returns Promise.\n\t */\n\tprivate async handleFieldChange(event: MultiValueField$ChangeEvent | Field$ChangeEvent, parameter: ActionParameter): Promise<void> {\n\t\tconst fieldPromise = (event as Field$ChangeEvent).getParameter(\"promise\");\n\t\tconst field = (event as Field$ChangeEvent).getSource() as Field | MultiValueField;\n\t\tconst parameterInfo = this.actionParameterInfos.find((actionParameterInfo) => actionParameterInfo.field === field);\n\t\tif (!parameterInfo) {\n\t\t\treturn;\n\t\t}\n\t\tparameterInfo.validationPromise = fieldPromise;\n\t\t// field value is being changed, thus existing messages related to that field are not valid anymore\n\t\tthis.removeMessagesForParameter(parameter);\n\t\ttry {\n\t\t\tparameterInfo.value = await fieldPromise;\n\t\t\tthis.parameters.parametersValues[parameterInfo.parameter.name] = parameterInfo.value;\n\t\t\tparameterInfo.hasError = false;\n\t\t} catch (error) {\n\t\t\tdelete parameterInfo.value;\n\t\t\tparameterInfo.hasError = true;\n\t\t\tActionRuntime._addMessageForActionParameter([\n\t\t\t\t{\n\t\t\t\t\tactionParameterInfo: parameterInfo,\n\t\t\t\t\tmessage: (error as { message: string }).message\n\t\t\t\t}\n\t\t\t]);\n\t\t}\n\t}\n\n\t/**\n\t * Handles the FileUploader change event for a parameter.\n\t * @param event The SAPUI5 event corresponding to the FileUploader change event.\n\t * @param parameter The action parameter.\n\t * @returns Promise.\n\t */\n\tprivate async handleFileUploaderChange(event: FileUploader$ChangeEvent, parameter: ActionParameter): Promise<void> {\n\t\tconst files = event.getParameter(\"files\");\n\t\tconst fileUploader = event.getSource();\n\t\t// correction needed for multiple file uploaders\n\t\tconst parameterInfo = this.actionParameterInfos.find((actionParameterInfo) => actionParameterInfo.field === fileUploader);\n\t\tif (!parameterInfo || !files) {\n\t\t\treturn;\n\t\t}\n\t\tthis.removeMessagesForParameter(parameter);\n\t\tparameterInfo.value = {};\n\t\tif (this.getStreamProperty(parameter)) {\n\t\t\tparameterInfo.value[this.getStreamProperty(parameter)?.name as keyof typeof parameterInfo.value] =\n\t\t\t\tawait this.getBase64File(files);\n\t\t\tparameterInfo.value[(this.getMimeTypePath(parameter) as PathInModelExpression<string>).path] =\n\t\t\t\t(files[0] as File).type || \"application/octet-stream\";\n\t\t\tparameterInfo.value[this.getFileNamePath(parameter) as string] = (files[0] as File).name;\n\t\t\tparameterInfo.hasError = false;\n\t\t\tthis.parameters.parametersValues[parameterInfo.parameter.name] = parameterInfo.value;\n\t\t}\n\t}\n\n\t/**\n\t * Provides the property name for the file name associated with the Stream property in the action parameter.\n\t * @param parameter The action parameter.\n\t * @returns Path as a string.\n\t */\n\tprivate getFileNamePath(parameter: ActionParameter): string | undefined {\n\t\treturn (this.getStreamProperty(parameter)?.annotations.Core?.ContentDisposition?.Filename as PathAnnotationExpression<string>).path;\n\t}\n\n\t/**\n\t * Provides the property name for the Mime type with the associated Stream property in the action parameter.\n\t * @param parameter The action parameter.\n\t * @returns The path expression.\n\t */\n\tprivate getMimeTypePath(parameter: ActionParameter): BindingToolkitExpression<string> | undefined {\n\t\treturn getExpressionFromAnnotation(this.getStreamProperty(parameter)?.annotations.Core?.MediaType);\n\t}\n\n\t/**\n\t * Provides the Stream property associated with the Complex type action parameter.\n\t * @param parameter The action parameter.\n\t * @returns The Edm.Stream property.\n\t */\n\tprivate getStreamProperty(parameter: ActionParameter): Property | undefined {\n\t\treturn (parameter.typeReference as ComplexType).properties?.find((property) => property.type === \"Edm.Stream\");\n\t}\n\n\t/**\n\t * Provides the content of the file.\n\t * @param files The file selected.\n\t * @returns The file content.\n\t */\n\tprivate async getBase64File(files: object[]): Promise<string> {\n\t\treturn new Promise((resolve) => {\n\t\t\tconst reader = new FileReader();\n\t\t\treader.onload = (): void => {\n\t\t\t\tif (!reader.result) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\tresolve((reader.result as string).split(\",\")[1]);\n\t\t\t};\n\t\t\treader.readAsDataURL((files as unknown as FileList).item(0)!);\n\t\t});\n\t}\n\n\t/**\n\t * Removes the messages for a parameter.\n\t * @param parameter The parameter\n\t */\n\tprivate removeMessagesForParameter(parameter: ActionParameter): void {\n\t\tconst messages = Messaging.getMessageModel().getData();\n\t\tconst controlId = generate([\"APD_\", parameter.name]);\n\t\t// also remove messages assigned to inner controls, but avoid removing messages for different parameters (with name being substring of another parameter name)\n\t\tconst relevantMessages = messages.filter((msg: Message) =>\n\t\t\tmsg.getControlIds().some((id: string) => controlId.split(\"-\").includes(id))\n\t\t);\n\t\tMessaging.removeMessages(relevantMessages);\n\t}\n\n\t/**\n\t * Gets the FormElements along with the array of parameters.\n\t * @param parameter The parameter\n\t * @returns The parameter information along with the FormElements.\n\t */\n\tprivate async getFormElements(parameter: ActionParameter): Promise<DialogContentTypes> {\n\t\tconst formElements = await this.createFormElement(parameter);\n\t\treturn {\n\t\t\tformElements: formElements,\n\t\t\tparameter: parameter\n\t\t};\n\t}\n\n\t/**\n\t * Gets the action parameter dialog.\n\t * @returns The dialog or undefined.\n\t */\n\tgetDialog(): Dialog | undefined {\n\t\treturn this.dialog;\n\t}\n\n\t/**\n\t * Creates the action parameter dialog.\n\t * @returns The dialog.\n\t */\n\tasync createDialog(): Promise<Dialog> {\n\t\tlet dialogContents: FormElementType[] = [];\n\t\tlet dialogContentsWithParameters: DialogContentTypes[] = [];\n\t\tconst actionParameters = this.action.isBound ? this.action.parameters.slice(1) : this.action.parameters;\n\n\t\t// If OperationalParameterFacets have been defined for this action, they are used to group the action parameters\n\t\t// with titles\n\t\tif (this.action.annotations?.UI?.OperationParameterFacets) {\n\t\t\tconst actionParameterGroups: ElementGroup[] = [];\n\t\t\tthis.action.annotations.UI?.OperationParameterFacets?.forEach(function (facet: ReferenceFacet) {\n\t\t\t\tlet facetTitle;\n\t\t\t\tif (facet.$Type === UIAnnotationTypes.ReferenceFacet) {\n\t\t\t\t\tfacetTitle = facet.Label;\n\t\t\t\t}\n\t\t\t\tif (hasFieldGroupTarget(facet)) {\n\t\t\t\t\tconst fieldGroup = facet?.Target?.$target as FieldGroupType;\n\t\t\t\t\tconst groupedActionParameters: ActionParameter[] = [];\n\n\t\t\t\t\tfieldGroup.Data.forEach(function (group: unknown) {\n\t\t\t\t\t\tgroupedActionParameters.push((group as DataField).Value.$target as ActionParameter);\n\t\t\t\t\t});\n\t\t\t\t\tactionParameterGroups.push({\n\t\t\t\t\t\tfacetTitle: facetTitle as PropertyAnnotationValue<string> | undefined,\n\t\t\t\t\t\tdata: groupedActionParameters\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t});\n\n\t\t\t// Get the fields for each parameter group\n\t\t\tconst getGroupForm = async (group: ElementGroup): Promise<ElementGroupConverted> => {\n\t\t\t\tconst formElements = await Promise.all(group.data.map(this.getFormElements.bind(this)));\n\t\t\t\treturn { facetTitle: group.facetTitle, data: formElements };\n\t\t\t};\n\n\t\t\tconst formData = actionParameterGroups.map(async (parameterGroup) => getGroupForm(parameterGroup));\n\t\t\tconst opFacets = await Promise.all(formData);\n\n\t\t\t// Add the title control to each parameter group\n\t\t\topFacets.forEach((dialogContent) => {\n\t\t\t\tdialogContents.push(<Title text={dialogContent.facetTitle} />);\n\t\t\t\treturn dialogContent.data.map((element) => dialogContents.push(element.formElements));\n\t\t\t});\n\n\t\t\topFacets.forEach(function (opFacet) {\n\t\t\t\topFacet.data.forEach(function (element) {\n\t\t\t\t\tdialogContentsWithParameters.push(element);\n\t\t\t\t});\n\t\t\t});\n\t\t} else {\n\t\t\t// No OperationParameterFacets have been defined\n\t\t\tdialogContentsWithParameters = await Promise.all(actionParameters.map(this.getFormElements.bind(this)));\n\t\t\tdialogContents = dialogContentsWithParameters.map((dialogContent) => {\n\t\t\t\treturn dialogContent.formElements;\n\t\t\t});\n\t\t}\n\n\t\tthis.registerActionParameterInfo(dialogContentsWithParameters);\n\n\t\t// In case of deferred create we have no view, so we need to get the resource model from the app component\n\n\t\tconst messageStrip = this.getCustomActionMessageStripText();\n\n\t\tconst endButton = (\n\t\t\t<Button\n\t\t\t\tid={generate([\"fe\", \"APD_\", this.actionName, \"Action\", \"Cancel\"])}\n\t\t\t\ttext={this.resourceModel.getText(\"C_COMMON_ACTION_PARAMETER_DIALOG_CANCEL\")}\n\t\t\t\tpress={(): void => {\n\t\t\t\t\tthis.onCancel.bind(this)();\n\t\t\t\t}}\n\t\t\t/>\n\t\t);\n\t\tconst dialog = (\n\t\t\t<Dialog\n\t\t\t\ttitle={this.getTitleText(this.parameters.label)}\n\t\t\t\tid={generate([\"fe\", \"APD_\", this.actionName])}\n\t\t\t\tescapeHandler={this.onCancel.bind(this)}\n\t\t\t\tdraggable={true}\n\t\t\t\tresizable={true}\n\t\t\t\tafterClose={this.afterClose.bind(this)}\n\t\t\t\tbeforeOpen={this.beforeOpen.bind(this)}\n\t\t\t\tafterOpen={(): void => {\n\t\t\t\t\tthis.afterOpen();\n\t\t\t\t}}\n\t\t\t\tinitialFocus={endButton} // The initial focus is set programmatically in afterOpen, to avoid opening the VH dialog\n\t\t\t>\n\t\t\t\t{{\n\t\t\t\t\tbeginButton: (\n\t\t\t\t\t\t<Button\n\t\t\t\t\t\t\tid={generate([\"fe\", \"APD_\", this.actionName, \"Action\", \"Ok\"])}\n\t\t\t\t\t\t\ttext={\n\t\t\t\t\t\t\t\tthis.parameters.isCreateAction === true\n\t\t\t\t\t\t\t\t\t? this.resourceModel.getText(\"C_TRANSACTION_HELPER_SAPFE_ACTION_CREATE_BUTTON_CONTINUE\")\n\t\t\t\t\t\t\t\t\t: this.getBeginButtonLabel(this.parameters.label)\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tpress={(): void => {\n\t\t\t\t\t\t\t\tthis.onApply.bind(this)();\n\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\ttype=\"Emphasized\"\n\t\t\t\t\t\t/>\n\t\t\t\t\t),\n\t\t\t\t\tendButton: endButton,\n\t\t\t\t\tcontent: (\n\t\t\t\t\t\t// eslint-disable-next-line @typescript-eslint/ban-ts-comment\n\t\t\t\t\t\t// @ts-ignore (unknown property binding)\n\t\t\t\t\t\t// columnsM only takes effect if there are titles in the content.\n\t\t\t\t\t\t<>\n\t\t\t\t\t\t\t{messageStrip && <MessageStrip showIcon=\"true\" text={messageStrip}></MessageStrip>}\n\t\t\t\t\t\t\t<SimpleForm columnsM={\"2\"} editable=\"true\" labelSpanL={\"12\"} labelSpanM={\"12\"} binding={\"$Parameter\"}>\n\t\t\t\t\t\t\t\t{{ content: dialogContents }}\n\t\t\t\t\t\t\t</SimpleForm>\n\t\t\t\t\t\t</>\n\t\t\t\t\t)\n\t\t\t\t}}\n\t\t\t</Dialog>\n\t\t);\n\t\tthis.dialog = dialog;\n\t\treturn dialog;\n\t}\n\n\t/**\n\t * Gets the label for the begin button of the dialog.\n\t * @param actionLabel The label of the action\n\t * @returns The label.\n\t */\n\tprivate getBeginButtonLabel(actionLabel: string | undefined): string {\n\t\tconst key = \"ACTION_PARAMETER_DIALOG_ACTION_NAME\";\n\t\tconst defaultKey = \"C_COMMON_DIALOG_OK\";\n\t\treturn this.getOverriddenText(key, defaultKey, actionLabel);\n\t}\n\n\t/**\n\t * Gets the title of the dialog.\n\t * @param actionLabel The label of the action\n\t * @returns The title.\n\t */\n\tprivate getTitleText(actionLabel: string | undefined): string {\n\t\tconst key = \"ACTION_PARAMETER_DIALOG_ACTION_TITLE\";\n\t\tconst defaultKey = \"C_OPERATIONS_ACTION_PARAMETER_DIALOG_TITLE\";\n\t\treturn this.getOverriddenText(key, defaultKey, actionLabel);\n\t}\n\n\t/**\n\t * Gets an overridden text for message strip.\n\t * @returns The overridden text for message strip.\n\t */\n\tprivate getCustomActionMessageStripText(): string | undefined {\n\t\tconst key = \"ACTION_PARAMETER_DIALOG_MESSAGE_TEXT\";\n\t\tlet boundActionName = this.actionName;\n\t\tboundActionName = boundActionName.split(\".\").pop() ?? boundActionName;\n\t\tconst suffixResourceKey = boundActionName && this.entitySetName ? `${this.entitySetName}|${boundActionName}` : \"\";\n\t\tif (this.resourceModel.checkIfResourceKeyExists(`${key}|${suffixResourceKey}`)) {\n\t\t\treturn this.resourceModel.getText(key, undefined, suffixResourceKey);\n\t\t} else if (this.resourceModel.checkIfResourceKeyExists(`${key}|${this.entitySetName}`)) {\n\t\t\treturn this.resourceModel.getText(key, undefined, `${this.entitySetName}`);\n\t\t} else if (this.resourceModel.checkIfResourceKeyExists(`${key}`)) {\n\t\t\treturn this.resourceModel.getText(key);\n\t\t}\n\t\treturn undefined;\n\t}\n\n\t/**\n\t * Gets an overridden text.\n\t * @param key The key for an overridden text\n\t * @param defaultKey The default key for the text\n\t * @param actionLabel The label of the action\n\t * @returns The overridden text or label.\n\t */\n\tprivate getOverriddenText(key: string, defaultKey: string, actionLabel?: string): string {\n\t\tlet boundActionName = this.actionName;\n\t\tboundActionName = boundActionName.split(\".\").pop() ?? boundActionName;\n\t\tconst suffixResourceKey = boundActionName && this.entitySetName ? `${this.entitySetName}|${boundActionName}` : \"\";\n\t\tif (actionLabel) {\n\t\t\tif (this.resourceModel.checkIfResourceKeyExists(`${key}|${suffixResourceKey}`)) {\n\t\t\t\treturn this.resourceModel.getText(key, undefined, suffixResourceKey);\n\t\t\t} else if (this.resourceModel.checkIfResourceKeyExists(`${key}|${this.entitySetName}`)) {\n\t\t\t\treturn this.resourceModel.getText(key, undefined, `${this.entitySetName}`);\n\t\t\t} else if (this.resourceModel.checkIfResourceKeyExists(`${key}`)) {\n\t\t\t\treturn this.resourceModel.getText(key);\n\t\t\t} else {\n\t\t\t\treturn actionLabel;\n\t\t\t}\n\t\t} else {\n\t\t\treturn this.resourceModel.getText(defaultKey);\n\t\t}\n\t}\n\n\t/**\n\t * Manages the press event of the begin button of the dialog.\n\t * @returns The promise.\n\t */\n\tprivate async onApply(): Promise<void> {\n\t\t// prevent multiple press events. The BusyLocker is not fast enough. (BCP: 2370130210)\n\t\tif (this.buttonLock || !this.dialog) {\n\t\t\treturn;\n\t\t}\n\t\tconst dialog = this.dialog;\n\n\t\tconst parameterContext = (dialog.getObjectBinding() as ODataContextBinding | undefined)?.getParameterContext();\n\n\t\t// lock the button to prevent multiple press events\n\t\tthis.buttonLock = true;\n\t\tBusyLocker.lock(dialog);\n\n\t\t// validate the action parameters. It is important to do this as a first operation as there is a\n\t\t// wait done for the value changes to complete updating the model. Even in cases where validation is\n\t\t// not configured this promise needs to be resolved to read from the model to return user entered values.\n\t\tif (!(await ActionRuntime.validateProperties(this.actionParameterInfos, this.resourceModel))) {\n\t\t\tBusyLocker.unlock(dialog);\n\t\t\tthis.buttonLock = false;\n\t\t\treturn;\n\t\t}\n\n\t\tconst newValuesDictionary = Object.assign(\n\t\t\t{},\n\t\t\t...this.actionParameterInfos.map((actionParameterInfos) => {\n\t\t\t\tconst parameter = actionParameterInfos.parameter;\n\t\t\t\tlet value;\n\t\t\t\tif (parameter.isCollection) {\n\t\t\t\t\tvalue = Object.values((dialog.getModel(\"mvfview\") as JSONModel).getProperty(`/${parameter.name}`) ?? {}).map(\n\t\t\t\t\t\t(paramValue) => (paramValue as { Key?: PrimitiveType })?.Key\n\t\t\t\t\t);\n\t\t\t\t} else if (!parameter.type.startsWith(\"Edm.\") && this.getStreamProperty(parameter)) {\n\t\t\t\t\t// File Uploader\n\t\t\t\t\tvalue = actionParameterInfos.value;\n\t\t\t\t} else {\n\t\t\t\t\tvalue = parameterContext?.getProperty(parameter.name);\n\t\t\t\t}\n\t\t\t\treturn { [parameter.name]: value };\n\t\t\t})\n\t\t) as Record<string, PrimitiveType>;\n\t\tconst isNewValue = Object.values(newValuesDictionary).some((value) => !!value);\n\n\t\tthis.parametersValuesResolve(newValuesDictionary);\n\n\t\tthis.parameters.appComponent.getModel(\"ui\").setProperty(UiModelConstants.DocumentModified, isNewValue);\n\t\t// Due to using the search and value helps on the action dialog transient messages could appear\n\t\t// we need an UX design for those to show them to the user - for now remove them before continuing\n\t\tthis.messageHandler.removeTransitionMessages();\n\t}\n\n\t/**\n\t * Reset the state of the dialog to start a new iteration.\n\t *\n\t */\n\tpublic resetState(): void {\n\t\tthis.unlockDialog();\n\t\tthis.buttonLock = false;\n\t\tthis.updateDialogBindingContextForError();\n\t\tthis.parametersValuesPromise = new Promise((resolve, reject) => {\n\t\t\tthis.parametersValuesResolve = resolve;\n\t\t\tthis.parametersValuesReject = reject;\n\t\t});\n\t}\n\n\t/**\n\t * Change the binding context of the dialog to one with priority message.\n\t *\n\t * On initial action execution, we might have bound messages with any selected contexts as target apart from the dialog's initial context.\n\t * We change the binding context of dialog for the parameter fields' to get the valid value state from the priority bound message.\n\t */\n\tupdateDialogBindingContextForError(): void {\n\t\tif (this.parameters.contexts.length < 2) {\n\t\t\t// We would need to switch the binding context of the dialog only when we have multiple contexts for executing the action.\n\t\t\treturn;\n\t\t}\n\n\t\tlet warningContext: ODataV4Context | undefined, infoContext: ODataV4Context | undefined;\n\t\tconst erroneousCtx = this.parameters.contexts.find((context) => {\n\t\t\tconst messages = context.getMessages();\n\t\t\treturn messages.some((msg) => {\n\t\t\t\t// We hold first context with warning or info messages.\n\t\t\t\twarningContext = !warningContext && msg.getType() === MessageType.Warning ? context : undefined;\n\t\t\t\tinfoContext = !infoContext && msg.getType() === MessageType.Information ? context : undefined;\n\t\t\t\t// Error is found!!! We shall exit.\n\t\t\t\treturn msg.getType() === MessageType.Error;\n\t\t\t});\n\t\t});\n\t\tconst contextToUse = erroneousCtx ?? warningContext ?? infoContext;\n\n\t\tif (contextToUse) {\n\t\t\tthis.dialog?.setBindingContext(contextToUse);\n\t\t}\n\t}\n\n\t/**\n\t * Removes the busy state of the dialog.\n\t */\n\tprivate unlockDialog(): void {\n\t\tif (this.dialog && BusyLocker.isLocked(this.dialog)) {\n\t\t\tBusyLocker.unlock(this.dialog);\n\t\t}\n\t}\n\n\t/**\n\t * Handler for the cancel action of the dialog.\n\t */\n\tprivate onCancel(): void {\n\t\tthis.parametersValuesReject(FELibrary.Constants.CancelActionDialog);\n\t\tthis.closeDialog();\n\t}\n\n\t/**\n\t * Closes the dialog.\n\t */\n\tpublic closeDialog(): void {\n\t\tif (this.dialog) {\n\t\t\tthis.parameters.events?.onParameterDialogClosed?.();\n\t\t\tthis.dialog.close();\n\t\t}\n\t\tthis.isDialogOpen = false;\n\t}\n\n\t/**\n\t * Opens the dialog.\n\t * @returns The promise of the action result.\n\t */\n\tasync openDialog(): Promise<void> {\n\t\tif (!this.dialog) {\n\t\t\tthrow new Error(\"Error on opening the dialog\");\n\t\t}\n\t\tawait CommonUtils.setUserDefaults(\n\t\t\tthis.parameters.appComponent,\n\t\t\tthis.actionParameterInfos.map((actionParameterInfo) => actionParameterInfo.parameter),\n\t\t\tthis.parameterModel,\n\t\t\ttrue\n\t\t);\n\t\tthis.setModels(this.dialog);\n\t\tthis.parameters.view?.addDependent(this.dialog);\n\t\tawait this.setOperationDefaultValues(this.dialog);\n\t\tthis.dialog.open();\n\t\tthis.isDialogOpen = true;\n\t}\n\n\t/**\n\t * Sets the model configuration for the dialog.\n\t * @param dialog The owner of the dialog\n\t */\n\tprivate setModels(dialog: Dialog): void {\n\t\tdialog.setModel(this.parameterModel, \"paramsModel\");\n\t\tdialog.bindElement({\n\t\t\tpath: \"/\",\n\t\t\tmodel: \"paramsModel\"\n\t\t});\n\t\tdialog.setModel(this.parameters.model);\n\t\tdialog.bindElement({\n\t\t\tpath: `${this.parameters.contexts.length ? \"\" : \"/\"}${this.actionName}(...)`\n\t\t});\n\n\t\tif (this.parameters.contexts.length) {\n\t\t\tdialog.setBindingContext(this.parameters.contexts[0]); // use context of first selected line item\n\t\t}\n\t\t// empty model to add elements dynamically depending on number of MVF fields defined on the dialog\n\t\tdialog.setModel(new JSONModel({}), \"mvfview\");\n\t}\n\n\t/**\n\t * Removes the messages before opening the dialog.\n\t * @param _event\n\t */\n\tprivate beforeOpen(_event: Dialog$BeforeOpenEvent): void {\n\t\tthis.messageHandler.removeTransitionMessages();\n\t}\n\n\t/**\n\t * Wait for the parameter values to be set.\n\t * @returns Promise containing the parameter values.\n\t */\n\tpublic async waitForParametersValues(): Promise<Record<string, PrimitiveType>> {\n\t\treturn this.parametersValuesPromise;\n\t}\n\n\t/**\n\t * Determines if the dialog is opened.\n\t * @returns True if the dialog is opened, false otherwise.\n\t */\n\tpublic isOpen(): boolean {\n\t\treturn this.isDialogOpen;\n\t}\n\n\t/**\n\t * Gets the default values for a parameter.\n\t * @param parameter The parameter\n\t * @param bindingParameter The binding parameter\n\t * @param dialog The dialog\n\t * @returns The promise of the default values.\n\t */\n\tprivate async getParameterDefaultValue(\n\t\tparameter: ActionParameter,\n\t\tbindingParameter: string,\n\t\tdialog: Dialog\n\t): Promise<ParameterDefaultValue> {\n\t\tconst operationBinding = dialog.getObjectBinding() as ODataContextBinding;\n\t\tconst parameterModelData = this.parameterModel.getData();\n\t\tconst paramName = parameter.name;\n\t\tconst defaultValue = parameter.annotations.UI?.ParameterDefaultValue;\n\t\t// Case 1: There is a ParameterDefaultValue annotation\n\t\tif (defaultValue) {\n\t\t\tif (this.parameters.contexts.length > 0 && isPathAnnotationExpression(defaultValue)) {\n\t\t\t\ttry {\n\t\t\t\t\tconst pathForContext: string =\n\t\t\t\t\t\tbindingParameter && defaultValue.path.startsWith(`${bindingParameter}/`)\n\t\t\t\t\t\t\t? defaultValue.path.replace(`${bindingParameter}/`, \"\")\n\t\t\t\t\t\t\t: defaultValue.path;\n\t\t\t\t\tlet paramValue = await CommonUtils.requestSingletonProperty(defaultValue.path, operationBinding.getModel());\n\t\t\t\t\tif (paramValue === null) {\n\t\t\t\t\t\tparamValue = await operationBinding.getParameterContext().requestProperty(defaultValue.path);\n\t\t\t\t\t}\n\t\t\t\t\tif (this.parameters.contexts.length > 1) {\n\t\t\t\t\t\t// For multi select, need to loop over contexts (as contexts cannot be retrieved via binding parameter of the operation binding)\n\n\t\t\t\t\t\tif (this.parameters.contexts.some((context) => context.getProperty(pathForContext) !== paramValue)) {\n\t\t\t\t\t\t\t// if the values from the contexts are not all the same, do not prefill\n\t\t\t\t\t\t\treturn {\n\t\t\t\t\t\t\t\tparamName,\n\t\t\t\t\t\t\t\tvalue: undefined,\n\t\t\t\t\t\t\t\tnoPossibleValue: true\n\t\t\t\t\t\t\t};\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\treturn { paramName, value: paramValue };\n\t\t\t\t} catch (error) {\n\t\t\t\t\tLog.error(\"Error while reading default action parameter\", paramName, this.action.name);\n\t\t\t\t\treturn {\n\t\t\t\t\t\tparamName,\n\t\t\t\t\t\tvalue: undefined,\n\t\t\t\t\t\tlatePropertyError: true\n\t\t\t\t\t};\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\t// Case 1.2: ParameterDefaultValue defines a fixed string value (i.e. vParamDefaultValue = 'someString')\n\t\t\t\treturn { paramName, value: defaultValue.valueOf() };\n\t\t\t}\n\t\t}\n\t\treturn { paramName, value: parameterModelData[paramName] };\n\t}\n\n\t/**\n\t * Gets the manifest values.\n\t * @returns The promise of the manifest values.\n\t */\n\tprivate async getManifestFunctionValues(): Promise<Record<string, unknown>> {\n\t\tconst bindingContext = this.dialog?.getBindingContext();\n\t\tif (!this.parameters.view || !this.parameters.defaultValuesExtensionFunction || !bindingContext) {\n\t\t\treturn {};\n\t\t}\n\n\t\treturn FPMHelper.loadModuleAndCallMethod(\n\t\t\tthis.parameters.defaultValuesExtensionFunction\n\t\t\t\t.substring(0, this.parameters.defaultValuesExtensionFunction.lastIndexOf(\".\") || -1)\n\t\t\t\t.replace(/\\./gi, \"/\"),\n\t\t\tthis.parameters.defaultValuesExtensionFunction.substring(\n\t\t\t\tthis.parameters.defaultValuesExtensionFunction.lastIndexOf(\".\") + 1,\n\t\t\t\tthis.parameters.defaultValuesExtensionFunction.length\n\t\t\t),\n\t\t\tthis.parameters.view,\n\t\t\tbindingContext,\n\t\t\tthis.parameters.contexts\n\t\t) as Promise<Record<string, unknown>>;\n\t}\n\n\t/**\n\t * Gets the predefined values for the parameters.\n\t * @param bindingParameter The binding parameter\n\t * @param dialog The dialog\n\t * @returns The promise containing all predefined values.\n\t */\n\tprivate async getPreDefinedValues(\n\t\tbindingParameter: string,\n\t\tdialog: Dialog\n\t): Promise<{\n\t\tcontextValues: Record<string, unknown>;\n\t\tdefaultValues: ParameterDefaultValue[];\n\t\tfunctionValues: ODataV4Context[];\n\t\tmanifestFunctionValues: Record<string, unknown>;\n\t}> {\n\t\tconst boundFunctionName = this.action.annotations.Common?.DefaultValuesFunction?.valueOf();\n\t\tlet requestContextObject: Promise<Record<string, unknown>> = Promise.resolve({});\n\t\tlet functionParams: Promise<ODataV4Context>[] = [];\n\t\tif (this.action.isBound) {\n\t\t\tif (typeof boundFunctionName === \"string\") {\n\t\t\t\tconst model = this.parameters.contexts[0].getModel();\n\t\t\t\tconst boundFunction = Operation.getOperationFromName(boundFunctionName, model, this.parameters.contexts[0]);\n\t\t\t\tif (boundFunction) {\n\t\t\t\t\tfunctionParams = this.parameters.contexts.map(async (context) => {\n\t\t\t\t\t\tconst result = await new ODataOperation(\n\t\t\t\t\t\t\tboundFunction,\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tappComponent: this.parameters.appComponent,\n\t\t\t\t\t\t\t\tmodel: model,\n\t\t\t\t\t\t\t\tcontexts: [context]\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tenhance$select: false,\n\t\t\t\t\t\t\t\tgroupId: \"functionGroup\"\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t).execute();\n\t\t\t\t\t\treturn result.filter(isFulfilled)[0]?.value.boundContext;\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t}\n\t\t\tif (this.parameters.contexts.length > 0) {\n\t\t\t\trequestContextObject = this.parameters.contexts[0].requestObject();\n\t\t\t}\n\t\t}\n\n\t\ttry {\n\t\t\tconst contextValues = await requestContextObject;\n\n\t\t\tconst promises = await Promise.all([\n\t\t\t\tPromise.all(\n\t\t\t\t\tthis.actionParameterInfos.map(async (actionParameterInfo) =>\n\t\t\t\t\t\tthis.getParameterDefaultValue(actionParameterInfo.parameter, bindingParameter, dialog)\n\t\t\t\t\t)\n\t\t\t\t),\n\t\t\t\tPromise.all(functionParams),\n\t\t\t\tthis.getManifestFunctionValues()\n\t\t\t]);\n\t\t\treturn {\n\t\t\t\tcontextValues,\n\t\t\t\tdefaultValues: promises[0],\n\t\t\t\tfunctionValues: promises[1],\n\t\t\t\tmanifestFunctionValues: promises[2]\n\t\t\t};\n\t\t} catch (error: unknown) {\n\t\t\tLog.error(\"Error while retrieving the parameter\", error as string);\n\t\t\t// Remove messages relating to the function for default values as they aren't helpful for a user\n\t\t\tthis.messageHandler.removeTransitionMessages();\n\t\t\treturn {\n\t\t\t\tcontextValues: {},\n\t\t\t\tdefaultValues: [],\n\t\t\t\tfunctionValues: [],\n\t\t\t\tmanifestFunctionValues: {}\n\t\t\t};\n\t\t}\n\t}\n\n\t/**\n\t * Callback when the dialog is opened. Sets the focus on the first field without opening the VH dialog.\n\t */\n\tprivate afterOpen(): void {\n\t\tconst firstVisibleParameter = this.actionParameterInfos.find((parameterInfo) => parameterInfo.field.getVisible());\n\t\tif (firstVisibleParameter) {\n\t\t\tconst firstField = firstVisibleParameter?.field;\n\t\t\tconst focusInfo = firstField?.getFocusInfo() as { targetInfo: object };\n\t\t\tfocusInfo.targetInfo = { silent: true };\n\t\t\tfirstField?.focus(focusInfo);\n\t\t}\n\t\tthis.parameters.events?.onParameterDialogOpened?.();\n\t}\n\n\t/**\n\t * Registers the action parameter info.\n\t * @param dialogContents The dialog contents\n\t */\n\tprivate registerActionParameterInfo(dialogContents: DialogContentTypes[]): void {\n\t\t//Register the field\n\t\tdialogContents.forEach((dialogContent) => {\n\t\t\tconst parameter = dialogContent?.parameter;\n\t\t\tconst field = dialogContent?.formElements?.[1];\n\t\t\tthis.actionParameterInfos.push({\n\t\t\t\tparameter,\n\t\t\t\tfield,\n\t\t\t\tisMultiValue: parameter.isCollection,\n\t\t\t\thasError: false\n\t\t\t});\n\t\t});\n\t}\n\n\t/**\n\t * Sets the default values for the parameters.\n\t * @param dialog The dialog\n\t * @returns The promise.\n\t */\n\tprivate async setOperationDefaultValues(dialog: Dialog): Promise<void> {\n\t\tconst bindingParameter = this.action.isBound ? this.action.parameters[0].name : \"\";\n\t\tconst { contextValues, defaultValues, functionValues, manifestFunctionValues } = await this.getPreDefinedValues(\n\t\t\tbindingParameter,\n\t\t\tdialog\n\t\t);\n\t\tconst operationBinding = dialog.getObjectBinding() as ODataContextBinding;\n\n\t\tif (bindingParameter) {\n\t\t\toperationBinding.setParameter(bindingParameter, contextValues);\n\t\t}\n\n\t\tfor (const i in this.actionParameterInfos) {\n\t\t\tif (this.actionParameterInfos[i].parameter.name !== \"ResultIsActiveEntity\") {\n\t\t\t\tconst parameterName = this.actionParameterInfos[i].parameter.name;\n\t\t\t\t// Parameter values provided in the call of invokeAction overrule other sources\n\t\t\t\tconst parameterProvidedValue = this.parameterValues?.find((element) => element.name === parameterName)?.value;\n\t\t\t\tif (parameterProvidedValue) {\n\t\t\t\t\toperationBinding.setParameter(parameterName, parameterProvidedValue);\n\t\t\t\t} else if (manifestFunctionValues.hasOwnProperty(parameterName)) {\n\t\t\t\t\toperationBinding.setParameter(parameterName, manifestFunctionValues[parameterName]);\n\t\t\t\t} else if (defaultValues[i] && defaultValues[i].value !== undefined) {\n\t\t\t\t\toperationBinding.setParameter(parameterName, defaultValues[i].value);\n\t\t\t\t} else if (this.action.annotations.Common?.DefaultValuesFunction && !defaultValues[i].noPossibleValue) {\n\t\t\t\t\tconst setOfFunctionValues = new Set<string>(\n\t\t\t\t\t\tthis.parameters.contexts.map((context, index) => functionValues[index].getObject(parameterName))\n\t\t\t\t\t);\n\t\t\t\t\tif (setOfFunctionValues.size === 1 && setOfFunctionValues.values().next().value !== undefined) {\n\t\t\t\t\t\t//param values are all the same:\n\t\t\t\t\t\toperationBinding.setParameter(parameterName, Array.from(setOfFunctionValues)[0]);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\t// If at least one Default Property is a Late Property and an eTag error was raised.\n\t\tif (defaultValues.some((value) => value.latePropertyError)) {\n\t\t\tconst refresh = this.resourceModel.getText(\"C_COMMON_SAPFE_REFRESH\");\n\t\t\tMessageBox.warning(getResourceModel(this.parameters.appComponent).getText(\"C_APP_COMPONENT_SAPFE_ETAG_LATE_PROPERTY\"), {\n\t\t\t\tactions: [refresh, MessageBox.Action.OK],\n\t\t\t\temphasizedAction: refresh,\n\t\t\t\tonClose: (action: string) => {\n\t\t\t\t\tif (action === refresh) {\n\t\t\t\t\t\tconst extensionAPI = this.parameters.view?.getController().getExtensionAPI();\n\t\t\t\t\t\t(extensionAPI as ListReportExtensionAPI | ObjectPageExtensionAPI).refresh();\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tcontentWidth: \"25em\"\n\t\t\t} as object);\n\t\t}\n\n\t\t// destroy the odataContextBinding related to the function call\n\t\tfor (const functionContext of functionValues) {\n\t\t\tconst binding = functionContext.getBinding();\n\t\t\tif (binding?.isA(\"sap.ui.model.odata.v4.ODataContextBinding\")) {\n\t\t\t\tbinding.destroy();\n\t\t\t}\n\t\t}\n\t}\n\n\t/**\n\t * Manages the close of the dialog.\n\t */\n\tprivate afterClose(): void {\n\t\t// when the dialog is cancelled, messages need to be removed in case the same action should be executed again\n\t\tfor (const i in this.actionParameterInfos) {\n\t\t\tthis.removeMessagesForParameter(this.actionParameterInfos[i].parameter);\n\t\t}\n\t\tthis.dialog?.destroy();\n\t\tthis.buttonLock = false; //needed here, not in the press events finally clause. In case the UI is sluggish, begin button could be pressed again.\n\t}\n\n\t/**\n\t * Gets the type of the property used for text annotation in the ValueHelp for the action parameter and provides the formatted binding.\n\t * @param oInterface The parameter\n\t * @returns The form element control.\n\t */\n\tprivate async getAdditionalValue(oInterface: ComputedAnnotationInterface): Promise<string | undefined> {\n\t\tlet textContext;\n\n\t\tconst contextPath = oInterface.context.getPath();\n\t\tconst localDataProperty = oInterface.context.getObject()?.$Name;\n\t\tconst valueListByQualifier = await this.metaModel.requestValueListInfo(contextPath, true);\n\n\t\t// Look for LocalDataProperty in ValueListParameterOut or ValueListParameterInOut where this is the parameter name\n\t\t// We only consider TextAnnotations for this action parameter\n\t\tconst valueListParameter = valueListByQualifier[\"\"].Parameters.find(\n\t\t\t(parameter: AnnotationValueListParameter) =>\n\t\t\t\tparameter.$Type === \"com.sap.vocabularies.Common.v1.ValueListParameterInOut\" ||\n\t\t\t\t(parameter.$Type === \"com.sap.vocabularies.Common.v1.ValueListParameterOut\" &&\n\t\t\t\t\tparameter.LocalDataProperty?.$PropertyPath === localDataProperty)\n\t\t);\n\n\t\tif (valueListParameter && valueListParameter.ValueListProperty) {\n\t\t\tconst textProperty = valueListParameter.ValueListProperty;\n\t\t\t// Now we have the name of the property that is the annotated text\n\t\t\tconst propertyPath = `/${valueListByQualifier[\"\"].CollectionPath}/${textProperty}`;\n\t\t\tconst propAnnotations = this.metaModel.getObject(`${propertyPath}@`);\n\n\t\t\tif (propAnnotations[\"@com.sap.vocabularies.Common.v1.Text@com.sap.vocabularies.UI.v1.TextArrangement\"]) {\n\t\t\t\tconst textProp = propAnnotations[\"@com.sap.vocabularies.Common.v1.Text\"];\n\t\t\t\tconst textPath = `/${valueListByQualifier[\"\"].CollectionPath}/${textProp.$Path}`;\n\t\t\t\ttextContext = this.metaModel.createBindingContext(textPath);\n\t\t\t}\n\n\t\t\tif (textContext) {\n\t\t\t\treturn AnnotationHelper.format(textContext.getObject(), { context: textContext });\n\t\t\t}\n\t\t}\n\t}\n}\n"],"mappings":"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","ignoreList":[]}