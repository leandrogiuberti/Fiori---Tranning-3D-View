/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)
 *      (c) Copyright 2009-2025 SAP SE. All rights reserved
 */
sap.ui.define(["sap/base/Log","sap/fe/base/BindingToolkit","sap/fe/base/ClassSupport","sap/fe/controls/easyFilter/AINotice","sap/fe/core/buildingBlocks/BuildingBlock","sap/fe/core/controllerextensions/collaboration/CollaborationCommon","sap/fe/core/converters/MetaModelConverter","sap/fe/core/templating/PropertyHelper","sap/fe/macros/Field","sap/fe/macros/ai/EasyFilterDataFetcher","sap/fe/macros/internal/valuehelp/ValueListHelper","sap/m/Button","sap/m/Dialog","sap/m/FlexBox","sap/m/FlexItemData","sap/m/FormattedText","sap/m/HBox","sap/m/IllustratedMessage","sap/m/IllustratedMessageSize","sap/m/IllustratedMessageType","sap/m/MessageStrip","sap/m/MessageToast","sap/m/OverflowToolbar","sap/m/ScrollContainer","sap/m/Text","sap/m/TextArea","sap/m/Title","sap/m/ToggleButton","sap/m/ToolbarSpacer","sap/m/VBox","sap/m/library","sap/ui/base/BindingInfo","sap/ui/core/InvisibleText","sap/ui/core/Title","sap/ui/core/message/MessageType","sap/ui/layout/form/ColumnLayout","sap/ui/layout/form/Form","sap/ui/layout/form/FormContainer","sap/ui/layout/form/FormElement","sap/ui/model/FilterOperator","sap/ui/model/odata/v4/AnnotationHelper","sap/ui/performance/trace/FESRHelper","sap/fe/base/jsx-runtime/jsx","sap/fe/base/jsx-runtime/jsxs"],function(e,t,a,s,i,n,r,o,l,c,d,u,h,p,g,f,T,E,m,b,y,C,_,I,S,x,A,v,D,V,P,M,L,O,w,F,B,R,N,U,Y,G,j,z){"use strict";var $,H,k,W,q,X,Q,K,J;function Z(e){return new Promise((t,a)=>{sap.ui.require([e],a=>{if(!(a&&a.__esModule)){a=a===null||!(typeof a==="object"&&e.endsWith("/library"))?{default:a}:a;Object.defineProperty(a,"__esModule",{value:true})}t(a)},e=>{a(e)})})}var ee={};var te=P.FlexDirection;var ae=P.ButtonType;var se=c.resolveTokenValue;var ie=o.isImmutable;var ne=o.isComputed;var re=o.getLabel;var oe=n.CollaborationUtils;var le=s.AILinkNotice;var ce=a.property;var de=a.defineUI5Class;var ue=a.defineReference;var he=a.createReference;var pe=t.not;var ge=t.isEmpty;var fe=t.equal;var Te=t.and;function Ee(e,t,a,s){a&&Object.defineProperty(e,t,{enumerable:a.enumerable,configurable:a.configurable,writable:a.writable,value:a.initializer?a.initializer.call(s):void 0})}function me(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e,be(e,t)}function be(e,t){return be=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},be(e,t)}function ye(e,t,a,s,i){var n={};return Object.keys(s).forEach(function(e){n[e]=s[e]}),n.enumerable=!!n.enumerable,n.configurable=!!n.configurable,("value"in n||n.initializer)&&(n.writable=!0),n=a.slice().reverse().reduce(function(a,s){return s(e,t,a)||a},n),i&&void 0!==n.initializer&&(n.value=n.initializer?n.initializer.call(i):void 0,n.initializer=void 0),void 0===n.initializer?(Object.defineProperty(e,t,n),null):n}function Ce(e,t){throw Error("Decorating class property failed. Please ensure that transform-class-properties is enabled and runs after the decorators transform.")}const _e=2e3;let Ie=($=de("sap.fe.macros.ai.EasyFillDialog"),H=ue(),k=ue(),W=ce({type:"Function"}),$(q=(X=function(t){function a(e,a){var s;s=t.call(this,e,a)||this;Ee(s,"$reviewArea",Q,s);Ee(s,"$scrollContainer",K,s);Ee(s,"getEditableFields",J,s);return s}ee=a;me(a,t);var s=a.prototype;s.onMetadataAvailable=function e(a){t.prototype.onMetadataAvailable.call(this,a);this.state.newValues={};this.state.hasValues=false;this.state.hasError=false;this.state.stateType="Initial";this.content=this.createContent()};s.onConfirm=async function t(a){const s=this.getPageController().getView()?.getBindingContext();const i=[];const n=this._bindingContext?.getObject()??this.state.newValues;for(const e in n){if(e!=="__bindingInfo"&&!e.startsWith("@$")){if(typeof n[e]!=="object"){s?.setProperty(e,n[e]);i.push(this.applyUpdatesForChange(this.getPageController().getView(),s.getPath(e)))}}}try{await Promise.all(i);s.refresh()}catch(t){e.error("Failed to update data after change:"+t)}this.content?.close()};s.applyUpdatesForChange=async function t(a,s){const i=a.getModel().getMetaModel();const n=i.getMetaContext(s);const o=r.getInvolvedDataModelObjects(n);const l=a.getBindingContext();try{const e=[];const t=oe.getAppComponent(a).getSideEffectsService();const n=i.getMetaPath(l.getPath());const r=i.getMetaPath(s).replace(n,"").slice(1);e.push(t.requestSideEffects([r],l,"$auto"));const c=t.computeFieldGroupIds(o.targetEntityType.fullyQualifiedName,o.targetObject.fullyQualifiedName);if(c.length){const t=a.getController();const s=t._sideEffects.getSideEffectsMapForFieldGroups(c,l);Object.keys(s).forEach(a=>{const i=s[a];e.push(t._sideEffects.requestSideEffects(i.sideEffects,i.context,"$auto",undefined,true))})}await Promise.all(e)}catch(t){e.error("Failed to update data after change:"+t);throw t}};s.onCancel=function e(){this.content?.close()};s.open=function e(){this.content?.open()};s._getFieldMapping=function e(t){const a={};if(t){const e=t.getMetaPath().getTarget();let s;switch(e._type){case"EntitySet":case"Singleton":s=e.entityType;break;case"NavigationProperty":s=e.targetType;break}if(s!==undefined){for(const e of s.entityProperties){if(!ie(e)&&!ne(e)&&e.annotations.UI?.Hidden?.valueOf()!==true&&!e.targetType){a[e.name]={description:re(e)??e.name,dataType:e.type}}}}}return a};s.generateListBinding=function e(t,a){const s=a.bindList(t,undefined,[],[],{$$updateGroupId:"submitLater"});s.refreshInternal=()=>{};return s};s.onThumbPress=function e(t,a){t.setEnabled(false);a.setEnabled(false);C.show(this.getTranslatedText("C_EASYEDIT_FEEDBACK_SENT"))};s.formatRemainingCharacters=function e(t){return this.getTranslatedText("C_EASYEDIT_REMAINING_CHARACTERS",[_e-(t?.length??0)])};s.onClearAll=function e(){this.state.newValues={};this.state.hasValues=false;this.state.hasIncorrectValues=false;this.state.enteredText="";this.state.hasError=false;this.state.stateType="Initial";this.state.currentlyEnteredText="";this.state.incorrectValues={}};s.onValidateFieldGroups=function e(t){const a=this.$reviewArea.current?.getControlsByFieldGroupId("EasyFillField")??[];this.state.hasError=a.some(e=>!!e.data("messageId")||!!e.getValueState&&e.getValueState?.()==="Error")};s.onFieldChange=function e(t){t.getSource().removeMessage(t.getSource().data("messageId"));t.getSource().data("messageId",undefined)};s.onEasyEditPressed=async function e(){const t=this.getOwnerPageDefinition();const a=this._getFieldMapping(t);const s=await Z("ux/eng/fioriai/reuse/easyfill/EasyFill");const i=this.getModel();const n=this.generateListBinding(i.getMetaModel().getMetaPath(this.getPageController().getView()?.getBindingContext()?.getPath()),this.getModel());this._bindingContext=n.create({},true);this.state.isBusy=true;try{const e=await s.extractFieldValuesFromText(this.state.enteredText,a);this.state.isBusy=false;if(e.success){const t=e.data;if(Object.keys(t).length===0){this.state.hasValues=false;this.state.hasIncorrectValues=false;this.state.stateType="NoEntries";return}this.state.stateType="HasEntries";this.state.hasError=false;const s=await(this.getEditableFields?.())??{};this.state.hasValues=false;this.state.hasIncorrectValues=false;this.$scrollContainer.current?.destroy();const i=j(B,{editable:true,class:"sapUiSmallMarginTopBottom",visible:this.bindState("hasValues"),children:{layout:j(F,{columnsM:2,columnsL:2,columnsXL:2,labelCellsLarge:1,emptyCellsLarge:1})}});const n=j(B,{editable:false,class:"sapUiSmallMarginTopBottom",visible:this.bindState("hasIncorrectValues"),children:{layout:j(F,{columnsM:2,columnsL:2,columnsXL:2,labelCellsLarge:1,emptyCellsLarge:1})}});const r=j(y,{text:this.getTranslatedText("C_EASYEDIT_DIALOG_WARNING_MSG"),type:"Warning",showIcon:true,visible:this.bindState("hasIncorrectValues")});const o=j(v,{icon:"sap-icon://thumb-up",tooltip:this.getTranslatedText("C_EASYEDIT_THUMBS_UP"),type:"Transparent",press:()=>this.onThumbPress(o,c)});G.setSemanticStepname(o,"press","fe4:ef:thumbUp");const c=j(v,{icon:"sap-icon://thumb-down",tooltip:this.getTranslatedText("C_EASYEDIT_THUMBS_DOWN"),type:"Transparent",press:()=>this.onThumbPress(o,c)});G.setSemanticStepname(c,"press","fe4:ef:thumbDown");const u=z(T,{alignItems:"Center",visible:fe(this.bindState("stateType"),"HasEntries"),children:[j(le,{}),j(S,{text:this.getTranslatedText("C_EASYEDIT_AI_NOTICE_TEXT"),class:"sapUiTinyMarginBegin"}),o,", ",c]});const h=j(R,{children:{title:j(O,{text:this.getTranslatedText("C_EASYEDIT_PREVIOUS_VALUES")})}});const p=j(R,{children:{title:j(O,{text:this.getTranslatedText("C_EASYEDIT_PREVIOUS_VALUES")})}});const f=j(R,{children:{title:j(O,{text:this.getTranslatedText("C_EASYEDIT_NEW_VALUES")})}});const E=j(R,{children:{title:j(O,{text:this.getTranslatedText("C_EASYEDIT_NEW_VALUES")})}});const m=this.getPageController().getModel("ui")?.createBindingContext("/easyEditDialog");this.getPageController().getModel("ui").setProperty("/easyEditDialog",{});m.setProperty("isEditable",true);f.setBindingContext(m,"ui");i.addFormContainer(h);i.addFormContainer(f);n.addFormContainer(p);n.addFormContainer(E);const b={};const C={};f.setBindingContext(this._bindingContext);E.setBindingContext(this.getModel("$componentState")?.createBindingContext("/incorrectValues"));E.setModel(this.getModel("$componentState"));const _=he();this.$reviewArea.current?.addItem(j(I,{ref:this.$scrollContainer,vertical:true,class:"sapUiContentPadding",children:{content:j(V,{ref:_,children:{items:[z(T,{children:[{layoutData:j(g,{alignSelf:"End"})},u]}),j(A,{text:this.getTranslatedText("C_EASYEDIT_FILLED_FIELDS"),visible:this.bindState("hasValues")}),i,j(A,{text:this.getTranslatedText("C_EASYEDIT_INCORRECT_FIELDS"),class:"sapUiSmallMarginTopBottom",visible:this.bindState("hasIncorrectValues")}),r,n]}})}}));for(const e in t){if(s[e]&&s[e].isEditable===true){this.state.hasValues=true;h.addFormElement(j(N,{label:a[e].description,children:j(l,{metaPath:e,contextPath:this.getOwnerContextPath(),readOnly:true,required:false,visible:true})}));const s=this._getOwner()?.runAsOwner(()=>j(l,{_requiresValidation:true,validateFieldGroup:this.onValidateFieldGroups.bind(this),fieldGroupIds:"EasyFillField",metaPath:e,contextPath:this.getOwnerContextPath(),change:this.onFieldChange.bind(this)}));f.addFormElement(j(N,{label:a[e].description,children:{fields:s}}));const i=this.getMetaModel();const n=i.getMetaPath(this._bindingContext.getPath(e));const r=i.getObject(n);const o=Y.format(r,{context:i.createBindingContext(n)});const c=M.parse(o);let u="";if(c&&c.type){try{c.type.validateValue(t[e])}catch(e){this.state.hasError=true;u=e.message}}const p=await this._getValueList(n);let g=false;if(p&&d.isValueListSearchable(n,p)){const a=await se(p,{operator:U.EQ,selectedValues:[t[e]]},true);if(!a[0].noMatch){t[e]=a[0].selectedValues[0].value;u=""}else{this.state.hasError=true;g=true;u=this.getTranslatedText("C_EASYEDIT_VH_ERROR",a[0].selectedValues[0].value)}}setTimeout(()=>{s.setValue(t[e]);if(u.length>0||g){const e=s.addMessage({type:w.Error,message:u});s.data("messageId",e)}},200)}else{C[e]=t[e];this.state.hasIncorrectValues=true;p.addFormElement(j(N,{label:a[e]?.description??e,children:j(l,{metaPath:e,contextPath:this.getOwnerContextPath(),readOnly:true,required:false,visible:true})}));E.addFormElement(j(N,{label:a[e]?.description??e,children:j(l,{metaPath:e,contextPath:this.getOwnerContextPath(),readOnly:true})}))}}_.current?.setBindingContext(this.getPageController().getView()?.getBindingContext());_.current?.setModel(this.getPageController().getModel());_.current?.setModel(this.getPageController().getModel("ui"),"ui");setTimeout(()=>{this.onValidateFieldGroups()},1e3);this.state.newValues=b;this.state.incorrectValues=C}else{this.state.hasValues=false;this.state.hasIncorrectValues=false;this.state.stateType="Error";this.state.newValues={};this.state.incorrectValues={}}}catch(e){this.state.isBusy=false;this.state.hasValues=false;this.state.hasIncorrectValues=false;this.state.stateType="Error";this.state.newValues={};this.state.incorrectValues={}}};s.createContent=function e(){const t=j(L,{text:this.getTranslatedText("C_EASYEDIT_DIALOG_DESCRIPTION")});const a=he();const s=he();const i=he();const n=he();const r=j(h,{title:this.getTranslatedText("C_EASYEDIT_DIALOG_TITLE"),resizable:true,horizontalScrolling:false,verticalScrolling:false,contentWidth:"1100px",contentHeight:"800px",escapeHandler:()=>{this.onCancel()},afterClose:()=>{this.destroy()},children:{content:z(p,{direction:te.Row,renderType:"Bare",width:"100%",height:"100%",children:[z(p,{width:"40%",id:this.createId("inputArea"),direction:te.Column,class:"sapUiContentPadding",renderType:"Bare",children:[j(f,{htmlText:this.getTranslatedText("C_EASYEDIT_DIALOG_DESCRIPTION"),class:"sapUiTinyMarginBottom"}),t,j(x,{value:this.bindState("enteredText"),class:"sapUiTinyMarginBottom",liveChange:e=>{this.state.currentlyEnteredText=e.getParameter("value")??""},width:"100%",placeholder:this.getTranslatedText("C_EASYEDIT_TEXTAREA_PLACEHOLDER"),rows:20,growing:true,growingMaxLines:30,maxLength:_e,ariaLabelledBy:t}),j(S,{class:"sapUiTinyMarginBottom",text:{path:"/currentlyEnteredText",model:"$componentState",formatter:this.formatRemainingCharacters.bind(this)},children:{layoutData:j(g,{alignSelf:"End"})}}),z(T,{children:[{layoutData:j(g,{alignSelf:"End"})},j(u,{text:this.getTranslatedText("C_EASYEDIT_BUTTON"),icon:"sap-icon://ai",enabled:pe(ge(this.bindState("currentlyEnteredText"))),press:this.onEasyEditPressed.bind(this),ref:a,class:"sapUiSmallMarginEnd"}),j(u,{text:this.getTranslatedText("C_EASYEDIT_DIALOG_CLEAR_ALL"),type:ae.Transparent,press:this.onClearAll.bind(this),ref:n})]})]}),z(p,{id:this.createId("reviewArea"),ref:this.$reviewArea,width:"60%",renderType:"Bare",busy:this.bindState("isBusy"),direction:te.Column,class:"sapFeEasyFillReviewArea",children:[j(E,{illustrationType:b.NoSearchResults,illustrationSize:m.Large,title:this.getTranslatedText("C_EASYEDIT_DIALOG_REVIEW_TITLE"),description:this.getTranslatedText("C_EASYEDIT_DIALOG_REVIEW_DESCRIPTION"),visible:fe(this.bindState("stateType"),"Initial")}),j(E,{illustrationType:b.NoEntries,illustrationSize:m.Large,title:this.getTranslatedText("C_EASYEDIT_DIALOG_NO_ENTRIES_TITLE"),description:this.getTranslatedText("C_EASYEDIT_DIALOG_NO_ENTRIES_DESCRIPTION"),visible:fe(this.bindState("stateType"),"NoEntries")}),j(E,{illustrationType:b.UnableToLoad,illustrationSize:m.Large,title:this.getTranslatedText("C_EASYEDIT_DIALOG_ERROR_TITLE"),description:this.getTranslatedText("C_EASYEDIT_DIALOG_ERROR_DESCRIPTION"),visible:fe(this.bindState("stateType"),"Error")})]})]}),footer:z(_,{children:[j(D,{}),j(u,{text:this.getTranslatedText("C_EASYEDIT_DIALOG_SAVE"),type:"Emphasized",enabled:Te(this.bindState("hasValues"),pe(this.bindState("hasError"))),press:this.onConfirm.bind(this),ref:s}),j(u,{text:this.getTranslatedText("C_EASYEDIT_DIALOG_CANCEL"),type:"Transparent",press:this.onCancel.bind(this),ref:i})]})}});G.setSemanticStepname(a.current,"press","fai:ef:analyzeText");G.setSemanticStepname(s.current,"press","fai:ef:save");G.setSemanticStepname(i.current,"press","fai:ef:cancel");G.setSemanticStepname(n.current,"press","fai:ef:clearAll");return r};s._getValueList=async function e(t){const a=this.getMetaModel();const s=await d.getValueListInfo(undefined,t,undefined,a);return s[0]};return a}(i),Q=ye(X.prototype,"$reviewArea",[H],{configurable:true,enumerable:true,writable:true,initializer:null}),K=ye(X.prototype,"$scrollContainer",[k],{configurable:true,enumerable:true,writable:true,initializer:null}),J=ye(X.prototype,"getEditableFields",[W],{configurable:true,enumerable:true,writable:true,initializer:null}),X))||q);ee=Ie;return ee},false);
//# sourceMappingURL=EasyFillDialog.js.map