/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)
 *      (c) Copyright 2009-2025 SAP SE. All rights reserved
 */
sap.ui.define(["sap/base/Log","sap/fe/base/BindingToolkit","sap/fe/base/ClassSupport","sap/fe/core/CommonUtils","sap/fe/core/buildingBlocks/BuildingBlock","sap/fe/core/converters/MetaModelConverter","sap/fe/core/helpers/StableIdHelper","sap/fe/core/helpers/TypeGuards","sap/fe/core/templating/DataModelPathHelper","sap/fe/macros/table/Utils","sap/m/SegmentedButton","sap/m/SegmentedButtonItem","sap/m/Select","sap/ui/core/InvisibleText","sap/ui/core/Item","sap/fe/base/jsx-runtime/jsx"],function(t,e,n,i,o,r,a,s,l,c,u,f,g,h,d,p){"use strict";var b,m,y,v,C,S,I,P,T,w,O;var B={};var A=l.getTargetObjectPath;var x=l.getTargetNavigationPath;var F=l.enhanceDataModelPath;var _=s.isAnnotationOfType;var E=a.generate;var M=r.getInvolvedDataModelObjects;var z=n.property;var j=n.implementInterface;var k=n.defineUI5Class;var K=e.pathInModel;var L=e.notEqual;function D(t,e,n,i){n&&Object.defineProperty(t,e,{enumerable:n.enumerable,configurable:n.configurable,writable:n.writable,value:n.initializer?n.initializer.call(i):void 0})}function $(t,e){t.prototype=Object.create(e.prototype),t.prototype.constructor=t,Q(t,e)}function Q(t,e){return Q=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},Q(t,e)}function U(t,e,n,i,o){var r={};return Object.keys(i).forEach(function(t){r[t]=i[t]}),r.enumerable=!!r.enumerable,r.configurable=!!r.configurable,("value"in r||r.initializer)&&(r.writable=!0),r=n.slice().reverse().reduce(function(n,i){return i(t,e,n)||n},r),o&&void 0!==r.initializer&&(r.value=r.initializer?r.initializer.call(o):void 0,r.initializer=void 0),void 0===r.initializer?(Object.defineProperty(t,e,r),null):r}function q(t,e){throw Error("Decorating class property failed. Please ensure that transform-class-properties is enabled and runs after the decorators transform.")}let N=(b=k("sap.fe.macros.table.QuickFilterSelector",{interfaces:["sap.m.IToolbarInteractiveControl"]}),m=j("sap.m.IOverflowToolbarContent"),y=z({type:"string"}),v=z({type:"string[]"}),C=z({type:"boolean"}),b(S=(I=function(e){function n(t,n){var i;i=e.call(this,t,n)||this;D(i,"__implements__sap_m_IOverflowToolbarContent",P,i);D(i,"id",T,i);D(i,"paths",w,i);D(i,"showCounts",O,i);i._getToolbarInteractive=()=>true;return i}B=n;$(n,e);var o=n.prototype;o.onMetadataAvailable=function t(){this.metaDataAvailable=true;if(!this.content&&this.metaPath){this.initializeContent()}};o.getOverflowToolbarConfig=function t(){return{canOverflow:true,onBeforeEnterOverflow:function(t){const e=t?.getContent();e?.getOverflowToolbarConfig()?.onBeforeEnterOverflow?.(e)},onAfterExitOverflow:function(t){const e=t?.getContent();e?.getOverflowToolbarConfig()?.onAfterExitOverflow?.(e)}}};o.setMetaPath=function t(e){this.metaPath=e;if(!this.content&&this.metaDataAvailable===true){this.initializeContent()}};o.onSelChange=function t(){const e=this.getMDCTable().getParent();if(e?.isA("sap.fe.macros.table.TableAPI")){e.onQuickFilterSelectionChange()}};o.getSegmentedButtonSelector=function t(e){const n=this.paths.map((t,n)=>p(f,{...this.getSelectorItemProperties(n,e)}));return p(u,{id:`${this.id}-content`,enabled:L(K("hasPendingFilters","pageInternal"),true),ariaLabelledBy:[this.getSelectorAriaLabelledById()],selectionChange:this.onSelChange.bind(this),children:{items:n}})};o.getSelectSelector=function t(e){const n=this.paths.map((t,n)=>p(d,{...this.getSelectorItemProperties(n,e)}));return p(g,{id:`${this.id}-content`,enabled:L(K("hasPendingFilters","pageInternal"),true),ariaLabelledBy:[this.getSelectorAriaLabelledById()],autoAdjustWidth:true,change:this.onSelChange.bind(this),children:{items:n}})};o.getSelectorItemProperties=function t(e,n){return{key:this.paths[e],text:this.getSelectorItemText(e,n)}};o.getSelectorAriaLabelledById=function t(){return E([`${this.id}-content`,"AriaText"])};o.getSelectorItemText=function t(e,n){const i=` ({internal>quickFilters/counts/${e}})`;const o=M(n);const r=F(o,this.paths[e]).targetObject;const a=r?.Text?.toString()??"";return`${a}${this.showCounts?i:""}`};o.registerSideEffectForQuickFilter=function t(e,n){const i=M(e,n);const o=i.contextLocation?.targetEntityType.fullyQualifiedName;const r=x(i,true);if(r&&o){const t=new Set;for(const e of this.paths){const n=F(i,e).targetObject;if(n.SelectOptions&&_(n,"com.sap.vocabularies.UI.v1.SelectionVariantType")){n.SelectOptions.forEach(e=>{const n=e.PropertyName?.value;if(n){const e=F(i,n);t.add(A(e,true))}})}}this.getAppComponent().getSideEffectsService().addControlSideEffects(o,{sourceProperties:Array.from(t),targetEntities:[{$NavigationPropertyPath:r}],sourceControlId:`${this.id}-content`})}};o.getAccessibilityControl=function t(){const e=`{sap.fe.i18n>M_TABLE_QUICKFILTER_ARIA}`;const n=p(h,{text:e,id:this.getSelectorAriaLabelledById()});n.toStatic();return n};o.initializeContent=function t(){if(this.metaPath){const t=this.getMetaPathObject(this.metaPath);if(t){const e=this._getOwner()?.getMetaModel();const n=e?.createBindingContext(t.getPath());const i=e?.createBindingContext(t.getContextPath());if(!n||!i){return}if(this.showCounts){this.registerSideEffectForQuickFilter(n,i)}const o=this.paths.length>3?this.getSelectSelector(n):this.getSegmentedButtonSelector(n);o.addDependent(this.getAccessibilityControl());this.content=o}}};o.getMDCTable=function t(){if(!this.mdcTable){let t=this.content;while(t&&!t.isA("sap.ui.mdc.Table")){t=t.getParent()}this.mdcTable=t;return this.mdcTable}else{return this.mdcTable}};o.getSelectedKey=function t(){return this.content?.getSelectedKey()||this.content?.getItems()[0].getKey()||""};o.setSelectedKey=function t(e){this.content?.setSelectedKey(e)};o.setCountsAsLoading=function t(){const e={};const n=this.getBindingContext("internal");for(const t in this.content?.getItems()){e[t]="..."}n.setProperty("quickFilters",{counts:e})};o.refreshSelectedCount=function t(){const e=this.getMDCTable().getRowBinding().getCount();if(this.showCounts===true&&e!==undefined){const t=this.content?.getItems().findIndex(t=>t.getKey()===this.getSelectedKey());if(t!==undefined&&t>-1){this.getBindingContext("internal")?.setProperty(`quickFilters/counts/${t}`,c.getCountFormatted(e))}}};o.refreshUnSelectedCounts=async function e(){if(!this.content){return Promise.resolve()}const n=this.getMDCTable();const o=this.content.getItems();const r=this.getBindingContext("internal");const a=this.getPageController();const s=a.getChartControl?.();const l=s?.getParent();const u=async t=>{const e=t.getKey();const a=i.getFiltersFromAnnotation(n,e);const s=await c.getListBindingForCount(n,n.getBindingContext(),{batchGroupId:"$auto",additionalFilters:[...g,...a],itemKey:e});const l=o.findIndex(t=>t.getKey()===e);if(l>-1){r.setProperty(`quickFilters/counts/${l}`,c.getCountFormatted(s))}};const f=l?.hasSelections()&&l?.getFilter();const g=c.getHiddenFilters(n);if(f){g.push(f)}const h=o.filter(t=>t.getKey()!==this.getSelectedKey()).map(async t=>u(t));try{await Promise.all(h)}catch(e){t.error("Error while retrieving the binding promises",e)}};return n}(o),P=U(I.prototype,"__implements__sap_m_IOverflowToolbarContent",[m],{configurable:true,enumerable:true,writable:true,initializer:function(){return true}}),T=U(I.prototype,"id",[y],{configurable:true,enumerable:true,writable:true,initializer:null}),w=U(I.prototype,"paths",[v],{configurable:true,enumerable:true,writable:true,initializer:null}),O=U(I.prototype,"showCounts",[C],{configurable:true,enumerable:true,writable:true,initializer:function(){return false}}),I))||S);B=N;return B},false);
//# sourceMappingURL=QuickFilterSelector.js.map