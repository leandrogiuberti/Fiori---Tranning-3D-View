/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)
 *      (c) Copyright 2009-2025 SAP SE. All rights reserved
 */
sap.ui.define(["sap/fe/core/ActionRuntime","sap/fe/core/CommonUtils","sap/fe/core/converters/ManifestSettings","sap/fe/core/helpers/DeleteHelper","sap/fe/core/helpers/ModelHelper","sap/fe/core/helpers/StableIdHelper","sap/m/MenuItem","sap/ui/fl/util/ManagedObjectModel","sap/ui/performance/trace/FESRHelper","../TableRuntime"],function(t,e,n,o,i,s,a,c,r,l){"use strict";var u={};var d=s.generate;var g=n.CreationMode;let f=function(){function n(){this.contextMenuActive=false}u=n;var s=n.prototype;s.setupMixin=function t(e){};s.alignContextMenuWithTableToolbarChanges=function t(e){const n=e.getContextMenu();const o=[];const i=e.getActions();i?.forEach(t=>{const i=t.getAggregation("action");if(this._isActionSplit(i)){this._splitActionsInContextMenu(i,n)}if(this._isActionCombined(i)){this._combineActionInContextMenu(i,n,e)}const s=this._getCorrespondingContextMenuAction(i,n);if(s){this._alignTextAndVisiblityInContextMenu(i,s,t);o.push(s)}});if(o.length){o.forEach((t,e)=>{const o=n.indexOfItem(t);if(o!==e){n.removeItem(t);n.insertItem(t,e)}})}};s.hideAllContextMenuActionsExceptDelete=function t(e){const n=e.getContextMenu();const o=n.getItems();const i=e.getActions().find(t=>t.getId().endsWith("StandardAction::Delete::ActionToolbarAction"));const s=i?.getAction().getVisible()??true;o.forEach(t=>{if(t.getId().includes("StandardAction::Delete::ContextMenu")){t.setVisible(s)}else{t.setVisible(false)}})};s._isActionCombined=function t(e){if(e.getMetadata().getName()==="sap.m.MenuButton"){const t=e.getDependents();const n=t.filter(t=>t instanceof c);return n.some(t=>t.getName().includes("$sap.m.flexibility.MenuButtonModel"))}return false};s._combineActionInContextMenu=function t(e,n,o){const i=n.getItems();const s=this._findOrCreateMenuButtonInContextMenu(e,o);const a=e.getMenu().getItems();for(const t of a){const o=t;for(const t of i){const i=t.data("actionId");const a=o.data("actionId");if(i===a+"::ContextMenu"||i===a.replace("::ActionMenu","::ContextMenu")){t.setText(o.getText());n.removeItem(t);s.addItem(t)}if(t.getItems().length>0&&!t.getId().includes(e.getId())){const e=this._findActionInSubMenu(t.getItems(),o);if(e){e.setText(o.getText());s.addItem(e);if(t.getItems().length===0){t.destroy()}}}}}};s._findActionInSubMenu=function t(e,n){for(const t of e){if(t.data("actionId")===n.data("actionId").replace("::ActionMenu","::ContextMenu")||t.data("actionId")===n.data("actionId")+"::ContextMenu"){const n=t;e.splice(e.indexOf(t),1);return n}}return undefined};s._findOrCreateMenuButtonInContextMenu=function t(e,n){const o=n.getContextMenu();const i=o.getItems();for(const t of i){if(t.getId().includes(e.getId())){return t}}const s=new a({id:d([n.getId(),e.getId(),"::ContextMenu"]),text:e.getText()});o.addItem(s);return s};s._splitActionsInContextMenu=function t(e,n){const o=n.getItems();for(let t=0;t<o.length;t++){if(o[t].getItems().length>0){if(o[t].getItems().some(t=>t.data("actionId")===e.data("actionId").replace("::ActionMenu","::ContextMenu"))){const e=o[t];const i=e.getItems();n.removeItem(e);i.forEach((e,o)=>{n.insertItem(e,t+o)})}}}};s._getCorrespondingContextMenuAction=function t(e,n){const o=n.getItems();for(const t of o){if(e.getId()+"::ContextMenu"===t.getId()||t.data("actionId")===e.data("actionId")?.replace("::ActionMenu","::ContextMenu")){return t}if(t.getId().includes(e.getId())){return t}}return null};s._alignTextAndVisiblityInContextMenu=function t(e,n,o){n.setText(e.getText());const i=e.getVisible()&&o.getVisible();if(i!==n.getVisible()){n.setVisible(i)}};s._isActionSplit=function t(e){if(e.getMetadata().getName()==="sap.m.MenuButton"){return false}const n=e.getDependents();const o=n.filter(t=>t instanceof c);return o.some(t=>t.getName()==="$sap.m.flexibility.SplitButtonsModel")};s.setContextMenuActive=function t(e){this.contextMenuActive=e};s.isContextMenuActive=function t(){return this.contextMenuActive};s.setCollaborationManagerMenuItemVisibility=function t(n,o){const s=n.getContextMenu();const a=s.getItems();const c=a?.find(t=>t.getId().includes("ContextMenu::CollaborationManager"));if(c){const t=e.getAppComponent(n);const s=t?.getCollaborativeToolsService();const a=s?.collaborationService.cmHelperService?.getOptions();const l=n?.getParent()?.getTableDefinition();const u=l?.annotation?.row?.navigationInfo?.type;if(a&&u==="Navigation"&&o.length>0){const t=e.getTargetView(n);const s=t.getController().collaborativeDraft;const a=o[0].getModel()?.getMetaModel();const l=i.isDraftSupported(a,o[0].getPath());const u=s.isCollaborationEnabled()||!l?true:o.some(t=>t.getObject().IsActiveEntity||t.getObject().HasActiveEntity);c.setVisible(u);r.setSemanticStepname(c,"press","CM:ShareLink")}else{c.setVisible(false)}}};s._onContextMenuPress=function e(n){const i=n.getSource(),s=i.getSelectedContexts(),a=n.getParameter("bindingContext"),c=this.getBindingContext("internal");const r=this.getRelevantSelection(s,a);let u=true;u=r.some(t=>!t.isInactive());c?.setProperty("contextmenu/inactiveContext",!u);const d=r.filter(function(t){return!t.isInactive()});const f=r.length>0&&d.length===0;const p=i.getParent()?.getCreationMode().getName()===g.InlineCreationRows;const m=this.getTableDefinition();const x=r.filter(function(t){return!t.isInactive()&&t.getModel()?.getLocalAnnotationModel().getProperty("@$ui5.fe.virtual.routeNavigable-"+m.annotation.row?.navigationInfo?.routePath,t)!==false});c?.setProperty("contextmenu/selectedContextsIncludingInactive",r);c?.setProperty("contextmenu/selectedContexts",d);c?.setProperty("contextmenu/navigableContexts",x);c?.setProperty("contextmenu/numberOfSelectedContexts",-1);c?.setProperty("contextmenu/numberOfNavigableContexts",x.length);c?.setProperty("contextmenu/numberOfSelectedContexts",d.length);c?.setProperty("contextmenu/numberOfSelectedContextsForDelete",r.length);if(d.length>0){this.alignContextMenuWithTableToolbarChanges(i)}else if(f&&p){this.hideAllContextMenuActionsExceptDelete(i)}this.setCollaborationManagerMenuItemVisibility(i,d);const M=i.getContextMenu();const I=M.getItems();const C=I.filter(t=>t.getVisible());if(C.length===0){n.preventDefault()}const b=r.some(t=>t.isExpanded()!==undefined);const h=r.some(t=>t.isExpanded());c?.setProperty("contextmenu/isExpandable",b);c?.setProperty("contextmenu/isCollapsable",h);c?.setProperty("controlId",i.getId());o.updateDeleteInfoForSelectedContexts(c,r,true);if(!i.data("enableAnalytics")){const t=i?.data("navigationAvailableMap");l.setIntentBasedNavigationEnablement(c,t,d,true)}const A=i?.data("updatablePropertyPath");const v=i?.data("draft");const y=i.data("displayModePropertyBinding")==="true"&&v!=="undefined";const S=[];for(const t of d){if(l.isUpdatableContext(A,t,y)){S.push(t)}}c?.setProperty("contextmenu/updatableContexts",S);if(m.control.createEnablement&&r.length===1){l._updateCreateEnablement(c,m.control.createEnablement,i,r[0],m.control.nodeType,true)}l.updateCutCopyPasteEnablement(c.getObject(),i,true);l.updateMoveUpDownEnablement(c.getObject(),i,true);t.setActionEnablement(c,JSON.parse(m.operationAvailableMap),d,"table",true)};s.getRelevantSelection=function t(e,n){let o;if(e.includes(n)){o=e}else{o=[n]}return o};return n}();u=f;return u},false);
//# sourceMappingURL=ContextMenuHandler.js.map