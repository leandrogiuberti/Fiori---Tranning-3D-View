/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)
 *      (c) Copyright 2009-2025 SAP SE. All rights reserved
 */
sap.ui.define(["sap/base/Log","sap/fe/core/helpers/ResourceModelHelper","sap/ui/core/Lib"],function(e,t,o){"use strict";var r={};var n=t.getLocalizedText;let i=function(){function t(){}r=t;var i=t.prototype;i.setupMixin=function e(t){};i.setTableBindingInfo=function e(t){this.tableBindingInfo=t};i.setDownloadUrl=async function t(){this.downloadUrl=undefined;if(this.getTableDefinition().enableAnalytics===true){return}let o;const r=this.getContent();try{const e=r.getPropertyHelper();let t=[];for(const o of r.getColumns()){t=t.concat(e.getColumnExportSettings(o))}const n={};const i=this.getDataModelObjectForMetaPath(this.metaPath,this.contextPath)?.targetEntityType.keys.map(e=>e.name);const a=t.map(e=>Array.isArray(e.property)?e.property.join(","):e.property);i?.forEach(e=>{if(!a.includes(e)){a.push(e)}});const s=Object.keys(this.getTableDefinition().requestAtLeast);s?.forEach(e=>{if(!a.includes(e)){a.push(e)}});n["$select"]=a.join(",");if(this.tableBindingInfo?.parameters?.$search){n.$search=this.tableBindingInfo.parameters.$search}if(this.tableBindingInfo?.parameters?.$$aggregation){n.$$aggregation=this.tableBindingInfo.parameters.$$aggregation}const l=r.getRowBinding();const p=l.getModel().bindList(l.getPath(),l.getContext(),this.tableBindingInfo?.sorter,this.tableBindingInfo?.filters,n);o=await p.requestDownloadUrl();p.destroy()}catch(t){e.debug("Error while computing the download URL for the export",t)}if(o){this.downloadUrl=o}};i._onBeforeExport=function e(o){const r=o.getParameter("userExportSettings")?.splitCells===true;const n=o.getSource(),i=o.getParameter("exportSettings"),a=this.getTableDefinition();t.updateExportSettings(i,a,n,r)};t.updateExportSettings=function e(t,r,i,a){const s=r.columns;this.setStaticSizeLimit(r,t);const l=t.workbook.columns;for(let e=l.length-1;e>=0;e--){const t=l[e];const r=o.getResourceBundleFor("sap.fe.macros");t.label=n(t.label,i);this.translateBooleanValueForExport(t,r);if(a){this.setExportConfig(s,l,e);this.addTargetValueColumn(s,l,r,e)}if(t.valueMap&&typeof t.valueMap==="string"){t.valueMap=JSON.parse(t.valueMap)}}const p=i.getParent().downloadUrl;if(p){t.dataSource.dataUrl=p}this.setFileAndSheetName(t,r);return t};t.setFileAndSheetName=function e(t,o){if(o.control.exportFileName){t.fileName=o.control.exportFileName}if(o.control.exportSheetName&&t.workbook.context){t.workbook.context.sheetName=o.control.exportSheetName}};t.setStaticSizeLimit=function e(t,o){if(!t.enableAnalytics&&(t.control.type==="ResponsiveTable"||t.control.type==="GridTable")){o.dataSource.sizeLimit=t.control.exportRequestSize??1e3}else if(t.control.exportRequestSize){o.dataSource.sizeLimit=t.control.exportRequestSize}};t.translateBooleanValueForExport=function e(t,o){if(t.type==="Boolean"&&!(t.trueValue||t.falseValue)){t.falseValue=o.getText("no");t.trueValue=o.getText("yes")}};t.setExportConfig=function e(t,o,r){const n=t.find(e=>!e.propertyInfos&&e.relativePath===o[r].property.toString());if(n?.exportSettings){const e=["scale","delimiter","format","utc","type","inputFormat"];for(const t of e){if(n.exportSettings[t]){o[r]={...o[r],...{[t]:n.exportSettings[t]}};if(o[r].type==="Currency"){o[r].type="Number"}}}}};t.addTargetValueColumn=function e(t,o,r,n){const i=t?.find(e=>{if(!this.isPropertyFromExport(e,o[n])){return false}return this.columnWithTargetValueToBeAdded(e,o[n])});if(i){const e={label:r.getText("TargetValue"),property:Array.isArray(o[n].property)?o[n].property:[o[n].property],template:i.exportDataPointTargetValue};o.splice(n+1,0,e)}};t.isPropertyFromExport=function e(t,o){if(t.relativePath===o.property||o.property.includes(t.relativePath)||o.property.includes(t.name)){return true}if(t.propertyInfos?.length===1&&o.property[0]===t.propertyInfos[0]){return true}return false};t.columnWithTargetValueToBeAdded=function e(t,o){let r=false;if(t.exportDataPointTargetValue&&t.propertyInfos?.length===1){delete o.template;r=true}return r};return t}();r=i;return r},false);
//# sourceMappingURL=TableExport.js.map