/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)
 *      (c) Copyright 2009-2025 SAP SE. All rights reserved
 */
sap.ui.define(["sap/base/Log","sap/fe/core/CommonUtils","sap/fe/core/controllerextensions/viewState/IViewStateContributorMixin","sap/ui/mdc/p13n/StateUtil"],function(t,e,a,n){"use strict";function i(t){return new Promise((e,a)=>{sap.ui.require([t],a=>{if(!(a&&a.__esModule)){a=a===null||!(typeof a==="object"&&t.endsWith("/library"))?{default:a}:a;Object.defineProperty(a,"__esModule",{value:true})}e(a)},t=>{a(t)})})}var r={};function o(t,e){t.prototype=Object.create(e.prototype),t.prototype.constructor=t,s(t,e)}function s(t,e){return s=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},s(t,e)}let l=function(a){function s(){return a.apply(this,arguments)||this}r=s;o(s,a);var l=s.prototype;l.retrieveState=async function t(){const e={};e.innerTable=this.getControlState(await n.retrieveExternalState(this.content));const a=this.getQuickFilter();if(a){const t=a.getSelectedKey();if(!e.quickFilter){e.quickFilter={}}e.quickFilter.selectedKey=t}const i=this.content.getVariant()?.getId();if(i){const t=this.content.getVariant();if(!e.variantManagement){e.variantManagement={variantId:t?.getCurrentVariantKey()}}else{e.variantManagement.variantId=t?.getCurrentVariantKey()}}return e};l.setInitialState=async function e(){try{const t=await n.retrieveExternalState(this.content);this.initialControlState=t}catch(e){t.error(e)}};l.applyLegacyState=async function t(e,a,n){const i=this.content;const r=i.getVariant();const o=this.getQuickFilter();const s=e(i);const l=r?e(r):null;const c=o?.content?e(o.content):null;const u={};if(s){u.innerTable={...u.innerTable,...s,fullState:{...u.innerTable?.fullState,...s.fullState},initialState:{...u.innerTable?.initialState,...s.initialState}}}if(l?.variantId){u.variantManagement={...u.variantManagement,variantId:l.variantId.toString()}}if(c?.selectedKey){u.quickFilter={...u.quickFilter,selectedKey:c.selectedKey.toString()}}if(u&&Object.keys(u).length>0){await this.applyState(u,a,n)}};l.handleVariantIdPassedViaURLParams=async function t(){const a=this.getStartupParameters();const n=a["sap-ui-fe-table-variant-id"]?.[0];const r=e.getTargetView(this);const o=r.getViewData();const s=o.variantManagement;const l=this.content.getVariant();if(l&&n&&s==="Control"){const t=l.getVariants().find(t=>t.getKey()===n);const e=(await i("sap/ui/fl/apply/api/ControlVariantApplyAPI")).default;return e.activateVariant({element:l,variantReference:t.getKey()})}};l.getStartupParameters=function t(){const e=this.getPageController();const a=e.getAppComponent();const n=a.getComponentData();return n.startupParameters};l.applyNavigationParameters=async function e(a){try{if(a.applyVariantFromURLParams??false){await this.handleVariantIdPassedViaURLParams()}}catch(e){t.error(`Error tying to apply navigation parameters to ${this.getMetadata().getName()}} control with ID: ${this.getId()}`,e)}return Promise.resolve()};l.applyState=async function e(a,r,o){if(!a)return;await this.content.initialized();const s=a?.innerTable;const l=a?.variantManagement?.variantId;const c=this.content?.getVariant();const u=a?.quickFilter?.selectedKey;const f=this.getQuickFilter();if(l!==undefined&&l!==c.getCurrentVariantKey()){const e=this.content?.getVariant();const a=e?.getVariants();const n=a?.some(t=>t.getKey()===l)?l:e?.getStandardVariantKey;try{const t=(await i("sap/ui/fl/apply/api/ControlVariantApplyAPI")).default;await t.activateVariant({element:e,variantReference:n});await this.setInitialState()}catch(e){t.error(e);await this.setInitialState()}}else{await this.setInitialState()}let p;if(s){if(o&&s.initialState){if(!s.initialState.supplementaryConfig){s.initialState.supplementaryConfig={}}p=await n.diffState(this.content,s.initialState,s.fullState)}else{if(a&&!a?.supplementaryConfig){a.supplementaryConfig={}}p=s.fullState}await n.applyExternalState(this.content,p)}if(u&&u!==f?.getSelectedKey()){f?.setSelectedKey(u);this.onQuickFilterSelectionChange()}if(this.initialLoad&&this.filterBar){const e=this.getFilterBarControl(this.filterBar);if(e&&e.isA("sap.fe.macros.filterBar.FilterBarAPI")){e.waitForInitialState().then(()=>{this.content.rebind();return}).catch(()=>{t.error("Error while waiting for initial state of filter bar")})}}};return s}(a);r=l;return r},false);
//# sourceMappingURL=TableAPIStateHandler.js.map