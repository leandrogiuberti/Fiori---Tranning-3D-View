/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)
 *      (c) Copyright 2009-2025 SAP SE. All rights reserved
 */
sap.ui.define(["sap/base/Log","sap/fe/base/HookSupport","sap/fe/core/CommonUtils","sap/fe/core/controllerextensions/editFlow/draft","sap/fe/core/helpers/ModelHelper","sap/fe/core/helpers/ResourceModelHelper","sap/fe/macros/insights/CommonInsightsHelper","sap/fe/macros/insights/InsightsService","sap/fe/macros/insights/TableInsightsHelper","sap/fe/macros/table/Utils","sap/m/MessageBox","sap/ui/core/Element","sap/ui/core/Lib","sap/ui/core/routing/HashChanger","sap/ui/model/Filter","../../filterBar/SemanticDateOperators"],function(e,t,n,o,r,i,a,s,l,c,g,u,f,d,h,p){"use strict";var C,b;var m={};var v=a.showGenericErrorMessage;var A=a.hasInsightActionEnabled;var w=t.controllerExtensionHandler;function E(e,t,n,o,r){var i={};return Object.keys(o).forEach(function(e){i[e]=o[e]}),i.enumerable=!!i.enumerable,i.configurable=!!i.configurable,("value"in i||i.initializer)&&(i.writable=!0),i=n.slice().reverse().reduce(function(n,o){return o(e,t,n)||n},i),r&&void 0!==i.initializer&&(i.value=i.initializer?i.initializer.call(r):void 0,i.initializer=void 0),void 0===i.initializer?(Object.defineProperty(e,t,i),null):i}let M=(C=w("collaborationManager","collectAvailableCards"),b=function(){function t(){}m=t;var a=t.prototype;a.setupMixin=function e(t){};a._onShareToCollaborationManagerPress=function e(t,n,o){if(n.length<=o){n.forEach(async e=>{const n=await this.getUrlForCollaborationManager(e);if(this.isTableRowNavigationPossible(e)&&n){const e=t.getAppComponent();const o=e.getManifestEntry("sap.app").title;const r=e?.getCollaborativeToolsService();const i=r?.collaborationService.cmHelperService;i?.triggerH2HChat(o,n)}else{g.warning(f.getResourceBundleFor("sap.fe.macros").getText("T_TABLE_SHARE_TO_COLLABORATION_MANAGER_NO_NAVIGATION_POSSIBLE"))}})}else{g.warning(f.getResourceBundleFor("sap.fe.macros").getText("T_TABLE_SHARE_TO_COLLABORATION_MANAGER_TOO_MANY_ITEMS_SELECTED",[o]))}};a.getUrlForCollaborationManager=async function e(t){let i;const a=n.getTargetView(this.getContent());const s=a.getController().collaborativeDraft;const l=t.getModel()?.getMetaModel();const c=r.isDraftSupported(l,t.getPath());if(c&&!s.isCollaborationEnabled()&&t.getObject().IsActiveEntity===false){if(t.getObject().HasActiveEntity===false){return undefined}else{const e=t.getPath();const n=e.substring(0,e.indexOf("/",1));const r=n?t.getModel().bindContext(n).getBoundContext():t;const a=await o.computeSiblingInformation(r,t);i=a?.targetContext?.getPath()}}else{i=t.getPath()}if(i){if(i[0]==="/"){i=i.substring(1)}const e=n.getAppComponent(this.getContent());if(e._isFclEnabled()){const t=this.getFCLLayoutForCM(e);i+=`?layout=${t}`}const t=d.getInstance();const o=t.hrefForAppSpecificHash?t.hrefForAppSpecificHash(""):"";return window.location.origin+window.location.pathname+window.location.search+o+i}return undefined};a.getFCLLayoutForCM=function e(t){const o=n.getTargetView(this.getContent()).getController()._routing.getFCLLevel();if(t.getRootViewController().getFclConfig().maxColumnsCount===2){return"MidColumnFullScreen"}return o===0?"MidColumnFullScreen":"EndColumnFullScreen"};a.collectAvailableCards=async function e(t){const n=this.getContent().getActions();const o=this.getPageController()?.getAppComponent();const r=o?._isFclEnabled()?o?.getRootViewController()?.getRightmostView?.()?.getViewData()?.converterType==="ObjectPage":false;if(A(n,this.getContent().getFilter(),l.getInsightsRelevantColumns(this))&&!r){const e=await this.getCardManifestTable();if(Object.keys(e).length>0){t.push({card:e,title:this.getTableDefinition().headerInfoTypeName??"",callback:this.onAddCardToCollaborationManagerCallback.bind(this)})}}};a.getCardManifestTable=async function e(){const t=l.getInsightsRelevantColumns(this);const n=await l.createTableCardParams(this,t,this.getSortConditionsQuery());return s.getCardManifest(n)};a.onAddCardToCollaborationManagerCallback=async function t(n){try{if(n){await s.showCollaborationManagerCardPreview(n,this.getPageController().collaborationManager.getService());return}}catch(t){v(this.getContent());e.error(t)}};a._onAddCardToInsightsPressed=async function t(){try{const e=l.getInsightsRelevantColumns(this);const t=await l.createTableCardParams(this,e,this.getSortConditionsQuery());if(t){const e=t.parameters.isNavigationEnabled?undefined:{type:"Warning",text:this.createNavigationErrorMessage(this.getContent())};s.showInsightsCardPreview(t,e);return}}catch(t){v(this.getContent());e.error(t)}};a.createNavigationErrorMessage=function e(t){const n=i.getResourceModel(t);return n.getText("M_ROW_LEVEL_NAVIGATION_DISABLED_MSG_REASON_EXTERNAL_NAVIGATION_CONFIGURED")};a.getDownloadUrlWithFilters=async function e(){const t=this.getContent();const o=u.getElementById(t.getFilter());if(!o){throw new Error("filter bar is not available")}const r=t.getRowBinding();const i=t.getModel();const a=await o.getParent().getSelectionVariant();const s=p.getSemanticOpsFilterProperties(a._getSelectOptions());const l=c.getAllFilterInfo(t,s.map(e=>e.filterName));const g=o.getPropertyInfoSet();const[f,d]=p.getSemanticDateFiltersWithFlpPlaceholders(s,g);let C=[];if(l.filters.length>0){C=C.concat(l.filters)}if(d.length>0){C.push(...d)}const b=new h({filters:C,and:true});const m={$search:n.normalizeSearchTerm(o.getSearch())||undefined};const v=i.bindList(r.getPath(),undefined,undefined,b,m);let A=await v.requestDownloadUrl()??"";for(const[e,t]of Object.entries(f)){A=A.replace(e,t)}return A};a.getSortConditionsQuery=function e(){const t=this.getContent();const n=t.getSortConditions()?.sorters;return n?n.map(function(e){const n=t.getPropertyHelper().getProperty(e.name)?.path;if(n){return`${n}${e.descending?" desc":""}`}return""}).join(","):""};return t}(),E(b.prototype,"collectAvailableCards",[C],Object.getOwnPropertyDescriptor(b.prototype,"collectAvailableCards"),b.prototype),b);m=M;return m},false);
//# sourceMappingURL=TableSharing.js.map