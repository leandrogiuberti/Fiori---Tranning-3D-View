/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)
 *      (c) Copyright 2009-2025 SAP SE. All rights reserved
 */
sap.ui.define(["sap/fe/core/CommonUtils","sap/fe/core/converters/MetaModelConverter","sap/fe/core/helpers/TypeGuards","sap/fe/core/templating/DataModelPathHelper","sap/fe/macros/table/TableHelper"],function(e,t,i,s,n){"use strict";var r={};var f=s.getTargetEntitySetInfo;var o=s.enhanceDataModelPath;var c=i.isProperty;var a=i.isNavigationProperty;var d=t.getInvolvedDataModelObjects;let g=function(){function t(t){this.immediateActionExecution=new Set;this.massEditDialog=t;this.massEditDialog=t;this.referenceRowContext=t.contexts[0];this.table=t.table;this.view=e.getTargetView(this.table);this.sideEffectsDefinition=this.generateSideEffectsDefinition()}r=t;var i=t.prototype;i.refreshDescription=async function t(i,s,n){const r=i.properties.descriptionPath;if(r&&!this.sideEffectsDefinition["genericField"]){return e.getAppComponent(this.table).getSideEffectsService().requestSideEffects(r.includes("/")?[{$NavigationPropertyPath:r.substring(0,r.lastIndexOf("/"))}]:[r],s,n)}};i.generateSideEffectsDefinition=function t(){const i=this.getSideEffectsMap();const s={};const n=this.table.getParent().getTableDefinition();const r=e.getTargetView(this.table);for(const t in i){const f=i[t];for(const i in f){const o=f[i];const c=i.split("#")[0];const a=r.getController()._sideEffects.getContextForSideEffects(this.referenceRowContext,c);if(a){const i=this.getSpecificTargetsAndActions(o.sideEffects,a,this.table.getModel().getMetaModel().getContext(n.annotation.collection),e.getAppComponent(this.table).getSideEffectsService());const r={...i,...{onRowContext:this.referenceRowContext===a}};s[t]=s[t]||[];s[t].push(r);if(!s["genericField"]&&i.tableRefresh.isRequested){s["genericField"]=[r]}}}}return s};i.getSideEffectsInformation=function e(t,i,s,r){const g=s.getModel();const l=t.targetProperties??[];const E=t.targetEntities??[];const u=!r.isControlSideEffects(t)?t.triggerAction:undefined;let h=[];const p=d(s);const m=d(g.getContext(g.getMetaPath(i.getPath())));const{parentEntitySet:y}=f(p);let S=false;let T;h=E.reduce((e,t)=>{const i=m.targetEntityType.resolvePath(t.$NavigationPropertyPath);if(a(i)){if(i.targetType==p.targetEntityType){S=true;T=t;return e}if(m.targetEntityType===y?.entityType){return e}if(i.targetType!==y?.entityType){e.push(t)}}return e},[]);for(const e of l){const t=o(m,e);if(c(t.targetObject)||e==="*"){if(y?.entityType!==t.targetEntityType){h.push(e)}}}const C=!!u&&m.targetEntityType===p.targetEntityType&&!n._isStaticAction(g.getObject(`/${u}`),u);return{immediateTargets:h,isImmediateTriggerAction:C,isRequestingTableEntityRefresh:S,tableTargetEntity:T}};i.getSpecificTargetsAndActions=function e(t,i,s,n){const r=this.getSideEffectsInformation(t,i,s,n);const f=!n.isControlSideEffects(t)?t.triggerAction:undefined;const o=[...t.targetProperties??[],...t.targetEntities??[]].filter(e=>!r.immediateTargets.includes(e)&&e!==r.tableTargetEntity);return{sideEffects:t,tableRefresh:{isRequested:r.isRequestingTableEntityRefresh,targetEntity:r.tableTargetEntity},immediate:{targets:r.isRequestingTableEntityRefresh?[]:r.immediateTargets,triggerAction:r.isImmediateTriggerAction?f:undefined},deferred:{targets:o,triggerAction:!r.isImmediateTriggerAction?f:undefined}}};i.getSideEffectsMap=function t(){const i=this.table.getModel(),s=i.getMetaModel(),n=s.getMetaPath(this.massEditDialog.bindingContext.getPath()),r=s.getContext(n);const f=d(r);const c={};const a=e.getAppComponent(this.view);const g=this.massEditDialog.fieldProperties.filter(e=>e.visible).map(e=>[e.propertyInfo.relativePath,e.propertyInfo.unitOrCurrencyPropertyPath]).flat().filter(e=>!!e);for(const e of g){const t=o(f,e);const i=a.getSideEffectsService().computeFieldGroupIds(f.targetEntityType.fullyQualifiedName,t.targetObject.fullyQualifiedName)??[];c[e]=this.view.getController()._sideEffects.getSideEffectsMapForFieldGroups(i)}return c};i.executeImmediateSideEffects=async function e(t,i,s){const n=[];const r=this.view.getController();for(const e of(this.sideEffectsDefinition[i]??[]).filter(e=>e.immediate.targets.length||e.immediate.triggerAction)){const i=e.onRowContext?t:r._sideEffects.getContextForSideEffects(t,e.sideEffects.fullyQualifiedName.split("@")[0]);if(i){const t=e.immediate.triggerAction;const f=i.getPath();n.push(r._sideEffects.requestSideEffects(e.sideEffects,i,s,()=>{let i=false;if(t){i=this.immediateActionExecution.has(`${f}_${t}`);this.immediateActionExecution.add(`${f}_${t}`)}return{targets:this.sideEffectsDefinition["genericField"]?[]:e.immediate.targets,triggerAction:t&&!i?e.immediate.triggerAction:undefined}}));r._sideEffects.unregisterFailedSideEffects(e.sideEffects.fullyQualifiedName,i)}}const f=r._sideEffects.getRegisteredFailedRequests();for(const e of[t,this.view.getBindingContext()]){if(e){const t=e.getPath();const i=f[t]??[];r._sideEffects.unregisterFailedSideEffectsForAContext(t);for(const t of i){n.push(r._sideEffects.requestSideEffects(t,e))}}}return Promise.allSettled(n)};i.executeDeferredSideEffects=function e(t){const i=this.sideEffectsDefinition["genericField"]?.[0];const s=i?.tableRefresh.targetEntity;const n=new Set;const r=this.view.getController();for(const e of Object.keys(this.sideEffectsDefinition).filter(e=>t.has(e))){for(const t of this.sideEffectsDefinition[e].filter(e=>e.deferred.targets.length||e.deferred.triggerAction)){const e=t.onRowContext?this.referenceRowContext:r._sideEffects.getContextForSideEffects(this.referenceRowContext,t.sideEffects.fullyQualifiedName.split("@")[0]);if(e&&!n.has(t.sideEffects.fullyQualifiedName)){n.add(t.sideEffects.fullyQualifiedName);r._sideEffects.requestSideEffects(t.sideEffects,e,"$auto.massEditDeferred",()=>({targets:s?t.deferred.targets.filter(e=>typeof e==="string"||e!==s):t.deferred.targets,triggerAction:t.deferred.triggerAction}))}}}if(i&&s){const e=r._sideEffects.getContextForSideEffects(this.referenceRowContext,i.sideEffects.fullyQualifiedName.split("@")[0]);if(e){r._sideEffects.requestSideEffects(i.sideEffects,e,"$auto.massEditDeferred",()=>({targets:[s],triggerAction:undefined}))}}};return t}();r=g;return r},false);
//# sourceMappingURL=MassEditSideEffects.js.map