/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)
 *      (c) Copyright 2009-2025 SAP SE. All rights reserved
 */
sap.ui.define(["sap/base/Log","sap/fe/core/converters/ManifestSettings","sap/fe/core/converters/MetaModelConverter","sap/fe/core/converters/controls/Common/DataVisualization","sap/fe/core/helpers/TypeGuards","sap/fe/core/templating/DataModelPathHelper","../MacroAPI"],function(t,e,a,n,o,i,r){"use strict";var c={};var s=i.getContextRelativeTargetObjectPath;var l=o.isAnnotationOfTerm;var p=n.getVisualizationsFromAnnotation;var u=n.getDataVisualizationConfiguration;var m=a.getInvolvedDataModelObjects;var d=e.VisualizationType;function f(e){const a=e._getOwner();const n=a?.getMetaModel();if(!a||!n){t.error("Cannot create a table definition for a TableAPI without an owner or a metamodel");throw new Error("Cannot create a table definition for a TableAPI without an owner or a metamodel")}const o=n.createBindingContext(e.getFullMetaPath());const i=n.createBindingContext(e.contextPath);if(!o||!i){t.error(`Incorrect metaPath (${e.metaPath}) or contextPath (${e.contextPath}) for tableAPI`);throw new Error("Incorrect metaPath or contextPath for tableAPI")}e.contextObjectPath=m(o,i);const c=r.getConverterContext(e.contextObjectPath,e.contextPath,{appComponent:a.getAppComponent(),models:a.preprocessorContext?.models});const l=h(e.contextObjectPath,c);const p=e.getSettingsForManifest();const f={actions:{},columns:{},tableSettings:p};g(e,f);v(e,f);const b={};b[l]=f;const A=r.getConverterContext(e.contextObjectPath,e.contextPath,{appComponent:a?.getAppComponent(),models:a?.preprocessorContext?.models},b);let x;if(e.associatedSelectionVariantPath){const t=m(n.createBindingContext(e.associatedSelectionVariantPath),i);x=t.targetObject}const P=u(e.inMultiView&&e.contextObjectPath.targetObject?A.getRelativeAnnotationPath(e.contextObjectPath.targetObject.fullyQualifiedName,A.getEntityType()):s(e.contextObjectPath),A,{isCondensedTableLayoutCompliant:e.useCondensedLayout,associatedSelectionVariant:x,isMacroOrMultipleView:e.inMultiView??true});return P.visualizations.find(t=>t.type===d.Table)}c.createTableDefinition=f;function h(e,a){const n=s(e);if(!n){t.error(`Missing meta path parameter for LineItem`);return`@${"com.sap.vocabularies.UI.v1.LineItem"}`}if(l(e.targetObject,"com.sap.vocabularies.UI.v1.LineItem")){return n}const o=a.getEntityTypeAnnotation(n);let i=[];if(l(e.targetObject,"com.sap.vocabularies.UI.v1.SelectionPresentationVariant")||l(e.targetObject,"com.sap.vocabularies.UI.v1.PresentationVariant")){i=p(e.targetObject,n,o.converterContext,true)}else{t.error(`Bad metapath parameter for table : ${e.targetObject.term}`)}const r=i.find(t=>t.visualization.term==="com.sap.vocabularies.UI.v1.LineItem");if(r){return r.annotationPath}else{t.error(`Bad meta path parameter for LineItem: ${e.targetObject.term}`);return`@${"com.sap.vocabularies.UI.v1.LineItem"}`}}function b(t){Object.keys(t).forEach(e=>{if(t[e]===undefined){delete t[e]}})}function g(t,e){let a;t.columns?.forEach(t=>{const n=t.isA("sap.fe.macros.table.Column");if(n){a={header:t.header,width:t.width,importance:t.importance,horizontalAlign:t.horizontalAlign,widthIncludingColumnHeader:t.widthIncludingColumnHeader,exportSettings:t.exportSettings,properties:t.properties,tooltip:t.tooltip,template:t.template,availability:t.availability,required:t.required,type:"Slot"}}else{a={key:t.key,width:t.width,importance:t.importance,horizontalAlign:t.horizontalAlign,widthIncludingColumnHeader:t.widthIncludingColumnHeader,exportSettings:t.exportSettings,availability:t.availability}}b(a);if(n&&(t.anchor||t.placement)){a.position={anchor:t.anchor,placement:t.placement??"After"}}e.columns[t.key]=a})}function v(t,e){function a(t){const a=e.actions;const n=t.key;a[n]={position:{placement:t.placement??"After",anchor:t.anchor},command:t.command,enableOnSelect:t.enableOnSelect,visible:t.visible,enabled:t.enabled,isAIOperation:t.isAIOperation,priority:t.priority,group:t.group??0};if(t.isA("sap.fe.macros.table.Action")){a[n]={...a[n],text:t.text,__noWrap:true,press:"some handler",requiresSelection:t.requiresSelection};return}const o={enableAutoScroll:t["enableAutoScroll"],navigateToInstance:t["navigateToInstance"]};b(o);a[n]={...a[n],afterExecution:Object.entries(o).length?o:undefined,defaultValuesFunction:t.defaultValuesFunction}}t.actions?.forEach(t=>{if(t.isA("sap.fe.macros.table.Action")||t.isA("sap.fe.macros.table.ActionOverride")){a(t)}else{const n=e.actions;const o=t.key;n[o]={position:{placement:t.placement??"After",anchor:t.anchor},menu:t.actions.map(t=>t.key)};if(t.isA("sap.fe.macros.table.ActionGroup")){n[o]={...n[o],text:t.text,defaultAction:t.defaultAction,__noWrap:true}}t.actions.forEach(t=>{a(t)})}})}return c},false);
//# sourceMappingURL=TableDefinition.js.map