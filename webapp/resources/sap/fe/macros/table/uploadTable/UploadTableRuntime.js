/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)
 *      (c) Copyright 2009-2025 SAP SE. All rights reserved
 */
sap.ui.define(["sap/fe/core/CommonUtils","sap/fe/macros/internal/helpers/Upload","../../field/FieldRuntimeHelper"],function(e,t,o){"use strict";var a=t.showTypeMismatchDialog;var n=t.showFileSizeExceedDialog;var r=t.showFileNameLengthExceedDialog;var i=t.setHeaderFields;var s=t.displayMessageForFailedUpload;const l={async uploadFile(t){const a=t.oItem,n=t.oSource,r=n.getParent(),s=r.getRowBinding(),l=n.getRowConfiguration().getFileNamePath(),g=l?{[l]:a.getFileName()}:{},d=s.create(g,true);try{const t=n.getBindingContext("internal");const r=new Promise((e,o)=>{t.setProperty(`UploadPromises/${a.getId()}`,{resolve:e,reject:o})});t.setProperty("uploadInstance",d);const s=e.getTargetView(n);const l=o.getExtensionController(s.getController());l.editFlow.syncTask(r);await d.created();return await new Promise(e=>{const t=n.getUploadUrl();let o=d.getProperty(t);o=o.replace(d.getPath(),d.getCanonicalPath());i(a,a.getMediaType(),d);a.setUploadUrl(o);e(a)})}catch(e){this.onUploadFailed(n,a,String(e));return Promise.reject("The new instance could not be created")}},onUploadFailed(e,t,o){s(e,o);e.getBindingContext("internal").getProperty(`UploadPromises/${t.getId()}`).reject()},async onUploadCompleted(e){const t=e.getParameter("item"),o=Number(e.getParameter("status")),a=t.getBindingContext("internal");if(o===0||o>=400){const o=t.getParent();const n=e.getParameter("responseText")||e.getParameter("response");l.onUploadFailed(o,t,n);const r=a.getProperty("uploadInstance");if(r){await r.delete()}}else{const e=t.getBindingContext();if(e&&!e.hasPendingChanges()){await e.requestRefresh()}a.getProperty(`UploadPromises/${t.getId()}`).resolve()}a.setProperty("uploadInstance",null)},onMediaTypeMismatch(e){const t=e.getSource();const o=e.getParameter("item").getProperty("mediaType");const n=t.getMediaTypes();a(t,o,n)},onFileSizeExceeded(e){const t=e.getSource();n(t,t.getMaxFileSize().toString())},onFileNameLengthExceeded(e){const t=e.getSource();r(t,t.getMaxFileNameLength().toString())}};return l},false);
//# sourceMappingURL=UploadTableRuntime.js.map