{"version":3,"names":["TableSizeHelper","getMDCColumnWidthFromDataField","dataField","properties","convertedMetaData","widthIncludingColumnHeader","arguments","length","undefined","property","find","prop","annotationPath","resolvePath","target","fullyQualifiedName","getMDCColumnWidthFromProperty","isSortableColumn","isColumnRequired","mWidthCalculation","Object","assign","headerGap","gap","truncateLabel","excludeProperties","required","visualSettings","widthCalculation","types","propertyInfos","map","propName","_property","key","propertyTypeConfig","dataType","typeConfig","TypeMap","getTypeConfig","formatOptions","constraints","typeInstance","filter","item","size","TableUtil","calcColumnWidth","label","Log","error","parseFloat","replace","getWidthForDataFieldForAnnotation","showDataFieldsLabel","oTargetedProperty","isAnnotationOfType","Target","$target","nPropertyWidth","fLabelWidth","Visualization","nbStars","TargetValue","parseInt","sLabel","Label","toString","SizeHelper","getButtonWidth","isPathAnnotationExpression","fn","labelWidth","propertyWidth","getWidthForDataField","Value","oTextArrangementTarget","annotations","Common","Text","displayMode","getDisplayMode","$Type"],"sourceRoot":".","sources":["TableSizeHelper.ts"],"sourcesContent":["import type { Property, ServiceObject } from \"@sap-ux/vocabularies-types\";\nimport type { ConvertedMetadata } from \"@sap-ux/vocabularies-types/Edm\";\nimport type { ContactType } from \"@sap-ux/vocabularies-types/vocabularies/Communication\";\nimport { CommunicationAnnotationTypes } from \"@sap-ux/vocabularies-types/vocabularies/Communication\";\nimport type {\n\tDataField,\n\tDataFieldForAction,\n\tDataFieldForAnnotation,\n\tDataFieldForIntentBasedNavigation,\n\tDataPointType\n} from \"@sap-ux/vocabularies-types/vocabularies/UI\";\nimport { UIAnnotationTypes } from \"@sap-ux/vocabularies-types/vocabularies/UI\";\nimport Log from \"sap/base/Log\";\nimport SizeHelper from \"sap/fe/core/helpers/SizeHelper\";\nimport { isAnnotationOfType, isPathAnnotationExpression } from \"sap/fe/core/helpers/TypeGuards\";\nimport { getDisplayMode } from \"sap/fe/core/templating/DisplayModeFormatter\";\nimport type { EnhancedFEPropertyInfo } from \"sap/fe/macros/table/TableAPI\";\nimport TableUtil from \"sap/m/table/Util\";\nimport type TypeConfig from \"sap/ui/mdc/TypeConfig\";\nimport TypeMap from \"sap/ui/mdc/odata/v4/TypeMap\";\n\nconst TableSizeHelper = {\n\t/**\n\t * Method to calculate the width of the MDCColumn.\n\t * @param dataField The Property or PropertyInfo Object for which the width will be calculated.\n\t * @param properties An array containing all property definitions (optional)\n\t * @param convertedMetaData\n\t * @param widthIncludingColumnHeader Indicates if the label should be a part of the width calculation\n\t * @private\n\t * @alias sap.fe.macros.TableSizeHelper\n\t * @returns The width of the column.\n\t */\n\tgetMDCColumnWidthFromDataField: function (\n\t\tdataField: DataField | Property | undefined,\n\t\tproperties: EnhancedFEPropertyInfo[],\n\t\tconvertedMetaData: ConvertedMetadata,\n\t\twidthIncludingColumnHeader = false\n\t): number {\n\t\tconst property = properties.find(\n\t\t\t(prop) =>\n\t\t\t\tprop.annotationPath &&\n\t\t\t\tconvertedMetaData.resolvePath<ServiceObject>(prop.annotationPath)?.target?.fullyQualifiedName ===\n\t\t\t\t\tdataField?.fullyQualifiedName\n\t\t);\n\t\treturn property ? this.getMDCColumnWidthFromProperty(property, properties, widthIncludingColumnHeader) : 0;\n\t},\n\n\t/**\n\t *  Method to calculate the width of the MDCColumn.\n\t * @param property The PropertyInfo object for which the width is calculated\n\t * @param properties  An array containing all property definitions (optional)\n\t * @param widthIncludingColumnHeader Indicates if the label is part of the width calculation\n\t * @param isSortableColumn Indicates if the column is sortable\n\t * @param isColumnRequired Indicates if the column is required\n\t * @returns The width of the column.\n\t */\n\tgetMDCColumnWidthFromProperty: function (\n\t\tproperty: EnhancedFEPropertyInfo,\n\t\tproperties: EnhancedFEPropertyInfo[],\n\t\twidthIncludingColumnHeader = false,\n\t\tisSortableColumn = false,\n\t\tisColumnRequired = false\n\t): number {\n\t\tconst mWidthCalculation = Object.assign(\n\t\t\t{\n\t\t\t\theaderGap: widthIncludingColumnHeader && isSortableColumn,\n\t\t\t\tgap: 0,\n\t\t\t\ttruncateLabel: !widthIncludingColumnHeader,\n\t\t\t\texcludeProperties: [],\n\t\t\t\trequired: isColumnRequired\n\t\t\t},\n\t\t\tproperty.visualSettings?.widthCalculation\n\t\t);\n\n\t\tlet types;\n\t\tif (property.propertyInfos?.length) {\n\t\t\ttypes = property.propertyInfos\n\t\t\t\t.map((propName) => {\n\t\t\t\t\tconst prop = properties.find((_property) => _property.key === propName);\n\t\t\t\t\t//add the typeConfig to the properties as it's not available in the table value help\n\t\t\t\t\tconst propertyTypeConfig =\n\t\t\t\t\t\tprop && prop.dataType && !prop.typeConfig\n\t\t\t\t\t\t\t? TypeMap.getTypeConfig(prop.dataType, prop.formatOptions, prop.constraints)\n\t\t\t\t\t\t\t: null;\n\t\t\t\t\treturn propertyTypeConfig ? propertyTypeConfig.typeInstance : prop?.typeConfig?.typeInstance;\n\t\t\t\t})\n\t\t\t\t.filter((item) => item);\n\t\t} else {\n\t\t\tlet propertyTypeConfig: TypeConfig | null = null;\n\t\t\t//add the typeConfig to the properties as it's not available in the table value help\n\t\t\tif (property.dataType && !property.typeConfig) {\n\t\t\t\tpropertyTypeConfig = TypeMap.getTypeConfig(property.dataType, property.formatOptions, property.constraints);\n\t\t\t}\n\t\t\tif (property.typeConfig?.typeInstance || propertyTypeConfig) {\n\t\t\t\ttypes = propertyTypeConfig ? [propertyTypeConfig.typeInstance] : [property.typeConfig?.typeInstance];\n\t\t\t}\n\t\t}\n\t\tconst size = types ? TableUtil.calcColumnWidth(types, property.label, mWidthCalculation) : null;\n\t\tif (!size) {\n\t\t\tLog.error(`Cannot compute the column width for property: ${property.key}`);\n\t\t}\n\t\treturn size ? parseFloat(size.replace(\"Rem\", \"\")) : 0;\n\t},\n\n\t/**\n\t * Method to calculate the  width of a DataFieldAnnotation object contained in a fieldGroup.\n\t * @param dataField DataFieldAnnotation object.\n\t * @param widthIncludingColumnHeader Indicates if the column header should be a part of the width calculation.\n\t * @param properties Array containing all PropertyInfo objects.\n\t * @param convertedMetaData\n\t * @param showDataFieldsLabel Label is displayed inside the field\n\t * @private\n\t * @alias sap.fe.macros.TableSizeHelper\n\t * @returns Object containing the width of the label and the width of the property.\n\t */\n\tgetWidthForDataFieldForAnnotation: function (\n\t\tdataField: DataFieldForAnnotation | DataFieldForAction | DataFieldForIntentBasedNavigation | undefined,\n\t\twidthIncludingColumnHeader?: boolean,\n\t\tproperties?: EnhancedFEPropertyInfo[],\n\t\tconvertedMetaData?: ConvertedMetadata,\n\t\tshowDataFieldsLabel = false\n\t): { labelWidth: number; propertyWidth: number } {\n\t\tconst oTargetedProperty = isAnnotationOfType<DataFieldForAnnotation>(dataField, UIAnnotationTypes.DataFieldForAnnotation)\n\t\t\t? (dataField?.Target?.$target as DataPointType | ContactType | undefined)\n\t\t\t: undefined;\n\t\tlet nPropertyWidth = 0,\n\t\t\tfLabelWidth = 0;\n\t\tif (isAnnotationOfType<DataPointType>(oTargetedProperty, UIAnnotationTypes.DataPointType) && oTargetedProperty?.Visualization) {\n\t\t\tswitch (oTargetedProperty.Visualization) {\n\t\t\t\tcase \"UI.VisualizationType/Rating\":\n\t\t\t\t\tconst nbStars = oTargetedProperty.TargetValue;\n\t\t\t\t\tnPropertyWidth = parseInt(nbStars, 10) * 1.375;\n\t\t\t\t\tbreak;\n\t\t\t\tcase \"UI.VisualizationType/Progress\":\n\t\t\t\tdefault:\n\t\t\t\t\tnPropertyWidth = 5;\n\t\t\t}\n\t\t\tconst sLabel = oTargetedProperty ? (oTargetedProperty as { label?: string }).label : dataField?.Label?.toString() || \"\";\n\t\t\tfLabelWidth = showDataFieldsLabel && sLabel ? SizeHelper.getButtonWidth(sLabel) : 0;\n\t\t} else if (\n\t\t\tconvertedMetaData &&\n\t\t\tproperties &&\n\t\t\tisAnnotationOfType<ContactType>(oTargetedProperty, CommunicationAnnotationTypes.ContactType) &&\n\t\t\tisPathAnnotationExpression(oTargetedProperty.fn)\n\t\t) {\n\t\t\tnPropertyWidth = this.getMDCColumnWidthFromDataField(\n\t\t\t\toTargetedProperty.fn.$target,\n\t\t\t\tproperties,\n\t\t\t\tconvertedMetaData,\n\t\t\t\twidthIncludingColumnHeader\n\t\t\t);\n\t\t}\n\t\treturn { labelWidth: fLabelWidth, propertyWidth: nPropertyWidth };\n\t},\n\n\t/**\n\t * Method to calculate the width of a DataField object.\n\t * @param dataField DataFieldAnnotation object.\n\t * @param showDataFieldsLabel Label is displayed inside the field.\n\t * @param properties Array containing all PropertyInfo objects.\n\t * @param convertedMetaData Context Object of the parent property.\n\t * @private\n\t * @alias sap.fe.macros.TableSizeHelper\n\t * @returns {object} Object containing the width of the label and the width of the property.\n\t */\n\n\tgetWidthForDataField: function (\n\t\tdataField: DataField,\n\t\tshowDataFieldsLabel: boolean,\n\t\tproperties: EnhancedFEPropertyInfo[],\n\t\tconvertedMetaData: ConvertedMetadata,\n\t\twidthIncludingColumnHeader: boolean\n\t): { labelWidth: number; propertyWidth: number } {\n\t\tconst oTargetedProperty = dataField.Value?.$target,\n\t\t\toTextArrangementTarget = oTargetedProperty?.annotations?.Common?.Text,\n\t\t\tdisplayMode = getDisplayMode(dataField.Value?.$target);\n\n\t\tlet nPropertyWidth = 0,\n\t\t\tfLabelWidth = 0;\n\t\tif (oTargetedProperty) {\n\t\t\tswitch (displayMode) {\n\t\t\t\tcase \"Description\":\n\t\t\t\t\tnPropertyWidth =\n\t\t\t\t\t\tthis.getMDCColumnWidthFromDataField(\n\t\t\t\t\t\t\toTextArrangementTarget.$target,\n\t\t\t\t\t\t\tproperties,\n\t\t\t\t\t\t\tconvertedMetaData,\n\t\t\t\t\t\t\twidthIncludingColumnHeader\n\t\t\t\t\t\t) - 1;\n\t\t\t\t\tbreak;\n\t\t\t\tcase \"DescriptionValue\":\n\t\t\t\tcase \"ValueDescription\":\n\t\t\t\tcase \"Value\":\n\t\t\t\tdefault:\n\t\t\t\t\tnPropertyWidth =\n\t\t\t\t\t\tthis.getMDCColumnWidthFromDataField(oTargetedProperty, properties, convertedMetaData, widthIncludingColumnHeader) -\n\t\t\t\t\t\t1;\n\t\t\t}\n\t\t\tconst sLabel = dataField.Label ? dataField.Label : oTargetedProperty.label;\n\t\t\tfLabelWidth = showDataFieldsLabel && sLabel ? SizeHelper.getButtonWidth(sLabel) : 0;\n\t\t} else {\n\t\t\tLog.error(`Cannot compute width for type object: ${dataField.$Type}`);\n\t\t}\n\t\treturn { labelWidth: fLabelWidth, propertyWidth: nPropertyWidth };\n\t}\n};\n\nexport default TableSizeHelper;\n"],"mappings":"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","ignoreList":[],"file":"TableSizeHelper-dbg.js"}