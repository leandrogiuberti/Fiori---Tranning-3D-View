/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)
 *      (c) Copyright 2009-2025 SAP SE. All rights reserved
 */
sap.ui.define(["sap/base/Log","sap/fe/base/BindingToolkit","sap/fe/core/CommonUtils","sap/fe/core/helpers/BindingHelper","sap/fe/core/helpers/SizeHelper","sap/fe/core/helpers/StableIdHelper","sap/fe/core/helpers/TypeGuards","sap/fe/core/templating/PropertyHelper","sap/fe/core/templating/UIFormatters","sap/fe/macros/formatters/TableFormatter","sap/fe/macros/internal/helpers/ActionHelper","sap/fe/macros/table/TableSizeHelper","sap/ui/mdc/enums/FieldEditMode"],function(e,t,n,a,i,r,o,l,s,c,u,d,f){"use strict";var g=s.getEditMode;var p=l.isImageURL;var b=l.hasText;var v=o.isPathAnnotationExpression;var h=o.isAnnotationOfType;var m=r.generate;var y=a.UI;var I=t.resolveBindingString;var A=t.ref;var F=t.pathInModel;var $=t.or;var C=t.ifElse;var T=t.formatResult;var O=t.fn;var S=t.equal;var x=t.constant;var U=t.compileExpression;var D=t.and;const E={_isStaticAction:function(e,t){let n;if(e){if(Array.isArray(e)){const a=this._getActionOverloadEntityType(t.toString());if(a){n=e.find(function(e){return e.$IsBound&&e.$Parameter[0].$Type===a})}else{n=e[0]}}else{n=e}}return!!n&&typeof n!=="string"&&n.$IsBound&&!!n.$Parameter[0].$isCollection},_getActionOverloadEntityType:function(e){if(e&&e.includes("(")){const t=e.split("(");return t[t.length-1].replaceAll(")","")}return undefined},_isActionOverloadOnDifferentType:function(e,t){const n=this._getActionOverloadEntityType(e);return!!n&&t!==n},getNavigationAvailableMap:function(e){const t={};e?.forEach(e=>{if("SemanticObject"in e){const n=`${e.SemanticObject}-${e.Action}`;if(e.$Type==="com.sap.vocabularies.UI.v1.DataFieldForIntentBasedNavigation"&&!e.Inline&&e.RequiresContext){if(e.NavigationAvailable!==undefined){t[n]=v(e.NavigationAvailable)?e.NavigationAvailable.path:e.NavigationAvailable}}}});return Object.keys(t).length>0?t:undefined},getUiLineItemObject:function(e,t){const n=t.resolvePath(e.getPath()).target;if(!n)return undefined;const a=t.resolvePath(e.getPath()).target.Visualizations;const i=a?a?.find(e=>e.value.indexOf("@"+"com.sap.vocabularies.UI.v1.LineItem")===0)?.$target:n;return i?.term==="com.sap.vocabularies.UI.v1.LineItem"?i:undefined},createBindingToLoadProperties:function(e){if(e===undefined||e.length===0){return undefined}const t=e?.map(e=>F(e))??[];return U(T(t,"._formatters.StandardFormatter#loadProperties"))},getColumnWidth:function(e,t,n,a,i,r,o){if(t.width){return t.width}if(e.enableAutoColumnWidth===true){let l;l=this.getColumnWidthForImage(i)||this.getColumnWidthForDataField(e,t,n,a,i,o)||undefined;if(l){return r?`${l}rem`:l}l=U(T([F("/editMode","ui"),F("tablePropertiesAvailable","internal"),t.name,r,this._shouldIncludeHeaderInColumnwidhCalculation(e,t),t.sortable??false,I(t.required??false,"boolean")],c.getColumnWidth));return l}return undefined},getColumnWidthForImage:function(e){let t=null;const n=e.targetObject?.Value?.$target?.annotations;const a=e.targetObject?.Value?.$target?.type;if(e.targetObject?.Value&&g(e.targetObject.Value?.$target,e,false,false,e.targetObject)===f.Display&&e.targetObject.Value?.$target){const i=b(e.targetObject.Value.$target);if(a==="Edm.Stream"&&!i&&n?.Core?.MediaType?.includes?.("image/")){t=6.2}}else if(n&&(p(e.targetObject?.Value?.$target)||n?.Core?.MediaType?.includes?.("image/"))){t=6.2}return t},_shouldIncludeHeaderInColumnwidhCalculation(e,t){return t.widthIncludingColumnHeader!==undefined?t.widthIncludingColumnHeader:e.widthIncludingColumnHeader},getColumnWidthForDataField:function(e,t,n,a,r,o){const l=r.targetObject?.annotations;const s=r.targetObject?.$Type;let c=null;if(s==="com.sap.vocabularies.UI.v1.DataFieldForAction"||s==="com.sap.vocabularies.UI.v1.DataFieldForIntentBasedNavigation"||s==="com.sap.vocabularies.UI.v1.DataFieldForAnnotation"&&!n.Target?.$AnnotationPath.includes(`@${"com.sap.vocabularies.UI.v1.FieldGroup"}`)){let s;s=i.getButtonWidth(a)||i.getButtonWidth(n?.Label?.toString())||i.getButtonWidth(l?.Label);const u=d.getWidthForDataFieldForAnnotation(r.targetObject,this._shouldIncludeHeaderInColumnwidhCalculation(e,t)).propertyWidth;if(u>s){c=u}else if(a||l&&(h(l,"com.sap.vocabularies.UI.v1.DataFieldForIntentBasedNavigation")||h(l,"com.sap.vocabularies.UI.v1.DataFieldForAction"))){s+=1.8;c=s}c=c??this.getColumnWidthForChart(e,t,n,s,o)}return c},getColumnWidthForChart(e,t,n,a,r){let o,l=null;if(n.Target?.$AnnotationPath?.includes(`@${"com.sap.vocabularies.UI.v1.Chart"}`)){switch(this.getChartSize(e,t)){case"XS":o=4.4;break;case"S":o=4.6;break;case"M":o=5.5;break;case"L":o=6.9;break;default:o=5.3}a+=1.8;if(!this.getShowOnlyChart(e,t)&&(r?.title.length||r?.description.length)){const e=r.title.length>r.description.length?r.title:r.description;const t=i.getButtonWidth(e)+7;const n=t>a?t:a;l=n}else if(a>o){l=a}else{l=o}}return l},getMarginClass:function(e,t){let n="";if(t){if(e=="com.sap.vocabularies.UI.v1.VisualizationType/Rating"){n="sapUiNoMarginBottom sapUiNoMarginTop"}}else if(e==="com.sap.vocabularies.UI.v1.VisualizationType/Rating"){n="sapUiNoMarginTop"}else{n="sapUiTinyMarginBottom"}return n},getVBoxVisibility:function(e,t,n){let a=true;const i=[];if(n[`@${"com.sap.vocabularies.UI.v1.Hidden"}`]){return t}for(const n of e){const e=n[`@${"com.sap.vocabularies.UI.v1.Hidden"}`];if(e===undefined||e===false){i.push(false);continue}if(e===true){i.push(true);continue}if(e.$Path){i.push(F(e.$Path));a=false;continue}if(typeof e==="object"){return t}}const r=x(i.length>0&&a!==true);const o=x(i.length>0&&!i.includes(false)&&a);return U(C(r,T(i,c.getVBoxVisibility),C(o,x(false),x(true))))},getElementStableId:function(e,t,n){if(!e){return undefined}const a=n.targetObject;let i;switch(a?.$Type){case"com.sap.vocabularies.UI.v1.DataFieldForAnnotation":i=a.Target.value;break;case"com.sap.vocabularies.UI.v1.DataFieldForIntentBasedNavigation":case"com.sap.vocabularies.UI.v1.DataFieldForAction":case"com.sap.vocabularies.UI.v1.DataFieldWithUrl":i=a;break;default:i=a.Value?.path??"";break}return m([e,t,i])},getColumnStableId:function(e,t){return E.getElementStableId(e,"C",t)},getFieldGroupLabelStableId:function(e,t){return E.getElementStableId(e,"FGLabel",t)},pressEventDataFieldForActionButton:function(e,t,n,a,i){let r=arguments.length>5&&arguments[5]!==undefined?arguments[5]:false;let o=arguments.length>6?arguments[6]:undefined;let l=arguments.length>7?arguments[7]:undefined;let s=arguments.length>8?arguments[8]:undefined;if(!t)return undefined;const c=t.Action,u=e.contextObjectPath.targetEntityType.fullyQualifiedName,d=typeof i!=="string"&&(this._isStaticAction(i,c)||this._isActionOverloadOnDifferentType(c.toString(),u)),f=!s?"aApplicable":"aApplicableForContextMenu",g=!s?"aNotApplicable":"aNotApplicableForContextMenu",p=!s?"":"contextmenu/",b=F(`${p}selectedContexts`,"internal"),v={contexts:!d?b:null,bStaticAction:d?d:undefined,entitySetName:n,applicableContexts:!d?F(`dynamicActions/${t.Action}/${f}/`,"internal"):null,notApplicableContexts:!d?F(`dynamicActions/${t.Action}/${g}/`,"internal"):null,isNavigable:r,enableAutoScroll:o,defaultValuesExtensionFunction:l,invocationGrouping:t?.InvocationGrouping==="UI.OperationGroupingType/ChangeSet"?"ChangeSet":"Isolated",controlId:e.contentId,operationAvailableMap:a,label:t.Label};return U(O("API.onActionPress",[A("$event"),A("$controller"),t.Action,v]))},isDataFieldForActionEnabled:function(e,t,n,a,i,r,o,l){if(!r)return false;const s=this._isStaticAction(a,t);if(this._isActionOverloadOnDifferentType(t.toString(),r.fullyQualifiedName)){const n=e&&JSON.parse(e.operationAvailableMap);if(n?.hasOwnProperty(t)){return!o?`{= \${internal>dynamicActions/${t}/bEnabled} }`:`{= \${internal>dynamicActions/${t}/bEnabledForContextMenu} }`}return true}if(!n||s){return true}const c=l?u.getNumberOfContextsExpression("single",o):u.getNumberOfContextsExpression(i??"multiselect",o);let d="";const f=!o?`\${internal>dynamicActions/${t}/bEnabled}`:`\${internal>dynamicActions/${t}/bEnabledForContextMenu}`;d=`${c} && ${f}`;return`{= ${d}}`},isDataFieldForIBNEnabled:function(t,n,a,i,r){let o=null;if(v(i)){o=i.path}const l=t?.tableDefinition?.enableAnalytics;if(!a){const a=t.collection.getPath();const r=t.collection.getModel();if(i===false&&!l){e.warning("NavigationAvailable as false is incorrect usage");return false}else if(o&&!l&&v(n?.NavigationAvailable)&&r.getObject(a+"/$Partner")===n.NavigationAvailable.path.split("/")[0]){return`{= \${${o.substring(o.indexOf("/")+1,o.length)}}}`}return true}let s="",c,u;if(i===true||l){s=!(r??false)?"%{internal>numberOfSelectedContexts} >= 1":"%{internal>contextmenu/numberOfSelectedContexts} >= 1"}else if(i===false){e.warning("NavigationAvailable as false is incorrect usage");return false}else{c=!(r??false)?"%{internal>numberOfSelectedContexts} >= 1":"%{internal>contextmenu/numberOfSelectedContexts} >= 1";u=!(r??false)?`\${internal>ibn/${n.SemanticObject}-${n.Action}/bEnabled}`:`\${internal>ibn/${n.SemanticObject}-${n.Action}/bEnabledForContextMenu}`;s=c+" && "+u}return`{= ${s}}`},buildExpressionForMultiValueFieldReadOnly:function(e){return U(C($(e.readOnly===true,D(y.IsInactive,e.creationMode.name==="InlineCreationRows")),x(true),S(e.fieldMode,"nowrapper")))},setHeaderLabelVisibility:function(e,t){if(!t){if(e.$Type?.includes("DataFieldForAction")&&e.Inline){return false}if(e.$Type?.includes("DataFieldForIntentBasedNavigation")&&e.Inline){return false}return true}return t.some(function(e){if((e.$Type==="com.sap.vocabularies.UI.v1.DataField"||e.$Type==="com.sap.vocabularies.UI.v1.DataFieldForAnnotation")&&e[`@${"com.sap.vocabularies.UI.v1.Hidden"}`]!==true){return true}})},getTextOnActionField:function(e,t){if(e.$Type==="com.sap.vocabularies.UI.v1.DataFieldForAction"||e.$Type==="com.sap.vocabularies.UI.v1.DataFieldForIntentBasedNavigation"){return e.Label}if(e.$Type==="com.sap.vocabularies.UI.v1.DataFieldForAnnotation"&&t.context.getObject("Target/$AnnotationPath").indexOf("@"+"com.sap.vocabularies.UI.v1.FieldGroup")>-1){const e="Target/$AnnotationPath/Data/";const n=[];for(const a in t.context.getObject(e)){if(t.context.getObject(`${e+a}/$Type`)==="com.sap.vocabularies.UI.v1.DataFieldForAction"||t.context.getObject(`${e+a}/$Type`)==="com.sap.vocabularies.UI.v1.DataFieldForIntentBasedNavigation"){n.push(t.context.getObject(`${e+a}/Label`))}}if(n.length>1){return n.reduce(function(e,t){return e.length>t.length?e:t})}else{return n.length===0?undefined:n.toString()}}return undefined},_getResponsiveTableColumnSettings:function(e,t){if(e.tableType==="ResponsiveTable"){return t.settings}return undefined},getChartSize:function(e,t){const n=this._getResponsiveTableColumnSettings(e,t);if(n&&n.microChartSize){return n.microChartSize}return"XS"},getShowOnlyChart:function(e,t){const n=this._getResponsiveTableColumnSettings(e,t);if(n&&n.showMicroChartLabel){return!n.showMicroChartLabel}return true},getDelegate:function(e,t,n,a){let i;if(t){if(e.control.type==="TreeTable"){throw new Error("TreeTable not supported in Analytical ListPage")}i={name:"sap/fe/macros/table/delegates/ALPTableDelegate",payload:{collectionName:n}};if(e.enableAnalytics&&a){i.payload.filterOnActiveEntities=true}}else if(e.control.type==="TreeTable"){if(!e.control.hierarchyQualifier){throw new Error("A hierarchy qualifier is mandatory with a TreeTable")}i={name:"sap/fe/macros/table/delegates/TreeTableDelegate",payload:{hierarchyQualifier:e.control.hierarchyQualifier,initialExpansionLevel:e.annotation.initialExpansionLevel,filterOnActiveEntities:a,createInPlace:e.control.createInPlace===true}}}else{i={name:"sap/fe/macros/table/delegates/TableDelegate"};if(e.enableAnalytics&&a){i.payload={filterOnActiveEntities:a}}}if(e.enableAnalytics===true&&e.control.analyticalConfiguration?.aggregationOnLeafLevel===true){i.payload={...i.payload,...{aggregationConfiguration:{leafLevel:true}}}}return JSON.stringify(i)},enableFastCreationRow:async function(t,a,i,r,o){let l,s;if(t){try{await o;if(n.getIsEditable(t)&&!i.isDeleted()){l=r.bindList(a,i,[],[],{$$updateGroupId:"doNotSubmit",$$groupId:"doNotSubmit"});l.refreshInternal=function(){};s=l.create();t.setBindingContext(s);try{await s.created()}catch(t){e.trace("transient fast creation context deleted")}}}catch(t){e.error("Error while computing the final UI state",t)}}},isActionShownInContextMenu:function(e,t){const n=e.annotationPath?t.convertedTypes.resolvePath(e.annotationPath).target:undefined;switch(n?.$Type){case"com.sap.vocabularies.UI.v1.DataFieldForAction":{const e=n.ActionTarget;return e?.isBound===true&&!e.parameters[0].isCollection&&e.sourceEntityType===t.targetEntityType}case"com.sap.vocabularies.UI.v1.DataFieldForIntentBasedNavigation":return n.RequiresContext?.valueOf()===true;default:if(e.type==="Default"){return e.requiresSelection===true}}return false}};E.getNavigationAvailableMap.requiresIContext=true;E.getTextOnActionField.requiresIContext=true;return E},false);
//# sourceMappingURL=TableHelper.js.map