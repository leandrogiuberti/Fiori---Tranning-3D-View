{"version":3,"names":["ShortcutExplanationProvider","_dec","defineUI5Class","_class","_ShortcutExplanationProvider","_ManagedObject","_this","_len","arguments","length","args","Array","_key","call","_popupIdx","_exports","_inheritsLoose","_proto","prototype","getShellDialogContent","windowWidth","left","window","screenLeft","outerWidth","screen","availWidth","theme","Theming","getTheme","_sanitizeTheme","url","sap","ui","require","toUrl","localOrigin","location","protocol","host","params","encodeURL","myWin","open","screenTop","handleMessageReceived","messageEvent","origin","messageData","data","service","messagePort","ports","postMessage","startsWith","removeEventListener","opener","e","Log","debug","Error","message","String","setTimeout","addEventListener","id","onunload","close","computedStyles","getComputedStyle","document","documentElement","getPropertyValue","themeMetadata","themeMatch","JSON","parse","Extends","info","getInstance","shellContainer","resolveCreation","instance","instancePromise","Promise","resolve","extensionService","getServiceAsync","shellHistoryProvider","registerUserAction","error","undefined","shellExtensionService","resourceBundle","Lib","getResourceBundleFor","shellHistoryDialog","isDialogAdded","userAction","createUserAction","text","getText","icon","IconPool","getIconURI","press","controlType","showForAllApps","err","ManagedObject"],"sourceRoot":".","sources":["ShortcutExplanationProvider.tsx"],"sourcesContent":["import Log from \"sap/base/Log\";\nimport encodeURL from \"sap/base/security/encodeURL\";\nimport { defineUI5Class } from \"sap/fe/base/ClassSupport\";\nimport ManagedObject from \"sap/ui/base/ManagedObject\";\nimport IconPool from \"sap/ui/core/IconPool\";\nimport Lib from \"sap/ui/core/Lib\";\nimport Theming from \"sap/ui/core/Theming\";\nimport type Container from \"sap/ushell/Container\";\nimport type Extension from \"sap/ushell/services/Extension\";\n\n/**\n * Provides a dialog to explain the shortcuts to the user.\n * This dialog will be registered in the shell user menu and will open as an independent window.\n */\n@defineUI5Class(\"sap.fe.controls.shortcuts.ShortcutExplanationProvider\")\nexport default class ShortcutExplanationProvider extends ManagedObject {\n\tprivate _popupIdx = 0;\n\n\tgetShellDialogContent(): void {\n\t\t// Position to top right of the main window if possible\n\t\tconst windowWidth = 620;\n\t\tlet left = window.screenLeft + window.outerWidth;\n\t\tif (left + windowWidth > window.screen.availWidth) {\n\t\t\tleft = window.screen.availWidth - windowWidth;\n\t\t}\n\t\tlet theme = Theming.getTheme();\n\t\ttheme = this._sanitizeTheme(theme);\n\t\tconst url = sap.ui.require.toUrl(\"sap/fe/controls/shortcuts/popup/index.html\");\n\t\tconst localOrigin = window.location.protocol + \"//\" + window.location.host;\n\t\t// We pass the theme and the origin to the popup so that it can communicate safely with the parent\n\t\tconst params = \"?sap-ui-xx-shortcut-origin=\" + encodeURL(localOrigin) + \"&sap-ui-theme=\" + theme;\n\t\tconst myWin = window.open(\n\t\t\turl + params,\n\t\t\t\"_blank\",\n\t\t\t`popup,toolbar=no,menubar=no,scrollbars=no,location=no,width=${windowWidth},height=550,top=${window.screenTop},left=${left}`\n\t\t);\n\t\tif (myWin) {\n\t\t\tconst handleMessageReceived = (messageEvent: MessageEvent): void => {\n\t\t\t\tif (localOrigin === messageEvent.origin) {\n\t\t\t\t\tconst messageData = messageEvent?.data;\n\t\t\t\t\tif (messageData.service === \"sap.ui.interaction.MessagePortReady\") {\n\t\t\t\t\t\tconst messagePort = messageEvent.ports[0]; // Remember the port\n\t\t\t\t\t\tmyWin.postMessage({ service: \"sap.ui.interaction.MessagePortReady\" }, url.startsWith(\"/\") ? localOrigin : url, [\n\t\t\t\t\t\t\tmessagePort\n\t\t\t\t\t\t]);\n\t\t\t\t\t\twindow.removeEventListener(\"message\", handleMessageReceived);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t};\n\t\t\ttry {\n\t\t\t\tmyWin.opener = null;\n\t\t\t} catch (e) {\n\t\t\t\t// This might fail when there is CORS involved anyway and we can't access the opener anyway\n\t\t\t\tLog.debug(\"Cannot set opener to null\", e instanceof Error ? e.message : String(e));\n\t\t\t}\n\n\t\t\tsetTimeout((): void => {\n\t\t\t\twindow.addEventListener(\"message\", handleMessageReceived);\n\t\t\t\twindow.postMessage(\n\t\t\t\t\t{ id: \"sap.fe.interaction.Popup\" + this._popupIdx++, service: \"sap.ui.interaction.RequestMessagePort\" },\n\t\t\t\t\tlocalOrigin\n\t\t\t\t);\n\t\t\t}, 1500); // give a bit of time for the popup to be ready\n\t\t\t// We can't rely on the onload of the popup because it is not always availble in CORS scenarios\n\t\t\twindow.onunload = function (): void {\n\t\t\t\tmyWin.close();\n\t\t\t};\n\t\t}\n\t}\n\n\t/**\n\t * Sanitizes the theme name to ensure it starts with \"sap-\".\n\t * If the theme does not start with \"sap-\", it tries to get the theme from the computed styles.\n\t * If it still does not find a valid theme, it defaults to \"sap_horizon\".\n\t * This is to ensure that the popup always uses a valid theme.\n\t * @param theme The theme name to sanitize\n\t * @returns The sanitized theme name\n\t * @private\n\t */\n\tprivate _sanitizeTheme(theme: string): string {\n\t\tif (!theme.startsWith(\"sap_\")) {\n\t\t\ttry {\n\t\t\t\tconst computedStyles = getComputedStyle(document.documentElement);\n\t\t\t\ttheme = computedStyles.getPropertyValue(\"--sapSapThemeId\");\n\t\t\t\tif (!theme) {\n\t\t\t\t\tconst themeMetadata = computedStyles.getPropertyValue(\"--sapThemeMetaData-UI5-sap-ui-core\");\n\t\t\t\t\tif (themeMetadata) {\n\t\t\t\t\t\tconst themeMatch = JSON.parse(themeMetadata);\n\t\t\t\t\t\tif (themeMatch && themeMatch.Extends && themeMatch.Extends.length > 0) {\n\t\t\t\t\t\t\ttheme = themeMatch.Extends[0];\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t} catch (e) {\n\t\t\t\tLog.info(\"Cannot get theme from computed styles\", e instanceof Error ? e.message : String(e));\n\t\t\t\ttheme = \"sap_horizon\";\n\t\t\t}\n\t\t\tif (!theme || !theme.startsWith(\"sap_\")) {\n\t\t\t\t// Final fallback to sap_horizon\n\t\t\t\ttheme = \"sap_horizon\";\n\t\t\t}\n\t\t}\n\t\treturn theme;\n\t}\n\n\tstatic instancePromise: Promise<ShortcutExplanationProvider | undefined>;\n\n\tstatic instance: ShortcutExplanationProvider | undefined;\n\n\tstatic isDialogAdded = false;\n\n\t/**\n\t * Creates or returns the instance of the ShortcutExplanationProvider.\n\t * This is a singleton to ensure we only have one instance of the dialog.\n\t * @returns The instance of the ShortcutExplanationProvider\n\t */\n\tstatic async getInstance(): Promise<ShortcutExplanationProvider | undefined> {\n\t\t// Test the shell existence and register the extension\n\t\tconst shellContainer = sap.ui.require(\"sap/ushell/Container\") as Container | undefined;\n\t\tlet resolveCreation: Function | undefined;\n\t\ttry {\n\t\t\tif (shellContainer && !this.instance) {\n\t\t\t\tthis.instancePromise = new Promise<ShortcutExplanationProvider | undefined>((resolve) => {\n\t\t\t\t\tresolveCreation = resolve;\n\t\t\t\t});\n\t\t\t\tconst extensionService = (await shellContainer.getServiceAsync(\"Extension\")) as Extension | undefined;\n\t\t\t\tif (extensionService) {\n\t\t\t\t\tconst shellHistoryProvider = await ShortcutExplanationProvider.registerUserAction(extensionService);\n\t\t\t\t\tthis.instance = shellHistoryProvider;\n\t\t\t\t\tresolveCreation!(shellHistoryProvider);\n\t\t\t\t}\n\t\t\t}\n\t\t} catch (e) {\n\t\t\tLog.error(\"Cannot register extension\", e instanceof Error ? e.message : String(e));\n\t\t\tresolveCreation?.(undefined);\n\t\t}\n\t\treturn this.instancePromise;\n\t}\n\n\t/**\n\t * Adds the user action to the shell, the action will open the dialog with the shortcuts.\n\t * @param shellExtensionService The extension service to add the user action to the shell\n\t * @returns The dialog with the shortcuts\n\t */\n\tstatic async registerUserAction(shellExtensionService: Extension): Promise<ShortcutExplanationProvider | undefined> {\n\t\ttry {\n\t\t\tconst resourceBundle = Lib.getResourceBundleFor(\"sap.fe.controls\")!;\n\n\t\t\tconst shellHistoryDialog = new ShortcutExplanationProvider();\n\t\t\tif (!this.isDialogAdded) {\n\t\t\t\tthis.isDialogAdded = true;\n\t\t\t\tconst userAction = await shellExtensionService.createUserAction(\n\t\t\t\t\t{\n\t\t\t\t\t\ttext: resourceBundle.getText(\"C_SHORTCUT_TITLE\"),\n\t\t\t\t\t\ticon: IconPool.getIconURI(\"keyboard-and-mouse\"),\n\t\t\t\t\t\tpress: (): void => {\n\t\t\t\t\t\t\tshellHistoryDialog.getShellDialogContent();\n\t\t\t\t\t\t}\n\t\t\t\t\t},\n\t\t\t\t\t{\n\t\t\t\t\t\tcontrolType: \"sap.m.Button\"\n\t\t\t\t\t}\n\t\t\t\t);\n\t\t\t\tuserAction.showForAllApps();\n\t\t\t}\n\t\t\treturn shellHistoryDialog;\n\t\t} catch (err) {\n\t\t\tLog.error(\"Cannot add user action\", err instanceof Error ? err.message : String(err));\n\t\t}\n\t}\n}\n"],"mappings":";;;;;;;;;;;;EAUA;AACA;AACA;AACA;EAHA,IAKqBA,2BAA2B,IAAAC,IAAA,GAD/CC,cAAc,CAAC,uDAAuD,CAAC,EAAAD,IAAA,CAAAE,MAAA,IAAAC,4BAAA,0BAAAC,cAAA;IAAA,SAAAL,4BAAA;MAAA,IAAAM,KAAA;MAAA,SAAAC,IAAA,GAAAC,SAAA,CAAAC,MAAA,EAAAC,IAAA,OAAAC,KAAA,CAAAJ,IAAA,GAAAK,IAAA,MAAAA,IAAA,GAAAL,IAAA,EAAAK,IAAA;QAAAF,IAAA,CAAAE,IAAA,IAAAJ,SAAA,CAAAI,IAAA;MAAA;MAAAN,KAAA,GAAAD,cAAA,CAAAQ,IAAA,UAAAH,IAAA;MAAAJ,KAAA,CAE/DQ,SAAS,GAAG,CAAC;MAAA,OAAAR,KAAA;IAAA;IAAAS,QAAA,GAAAf,2BAAA;IAAAgB,cAAA,CAAAhB,2BAAA,EAAAK,cAAA;IAAA,IAAAY,MAAA,GAAAjB,2BAAA,CAAAkB,SAAA;IAAAD,MAAA,CAErBE,qBAAqB,GAArB,SAAAA,qBAAqBA,CAAA,EAAS;MAC7B;MACA,MAAMC,WAAW,GAAG,GAAG;MACvB,IAAIC,IAAI,GAAGC,MAAM,CAACC,UAAU,GAAGD,MAAM,CAACE,UAAU;MAChD,IAAIH,IAAI,GAAGD,WAAW,GAAGE,MAAM,CAACG,MAAM,CAACC,UAAU,EAAE;QAClDL,IAAI,GAAGC,MAAM,CAACG,MAAM,CAACC,UAAU,GAAGN,WAAW;MAC9C;MACA,IAAIO,KAAK,GAAGC,OAAO,CAACC,QAAQ,CAAC,CAAC;MAC9BF,KAAK,GAAG,IAAI,CAACG,cAAc,CAACH,KAAK,CAAC;MAClC,MAAMI,GAAG,GAAGC,GAAG,CAACC,EAAE,CAACC,OAAO,CAACC,KAAK,CAAC,4CAA4C,CAAC;MAC9E,MAAMC,WAAW,GAAGd,MAAM,CAACe,QAAQ,CAACC,QAAQ,GAAG,IAAI,GAAGhB,MAAM,CAACe,QAAQ,CAACE,IAAI;MAC1E;MACA,MAAMC,MAAM,GAAG,6BAA6B,GAAGC,SAAS,CAACL,WAAW,CAAC,GAAG,gBAAgB,GAAGT,KAAK;MAChG,MAAMe,KAAK,GAAGpB,MAAM,CAACqB,IAAI,CACxBZ,GAAG,GAAGS,MAAM,EACZ,QAAQ,EACR,+DAA+DpB,WAAW,mBAAmBE,MAAM,CAACsB,SAAS,SAASvB,IAAI,EAC3H,CAAC;MACD,IAAIqB,KAAK,EAAE;QACV,MAAMG,qBAAqB,GAAIC,YAA0B,IAAW;UACnE,IAAIV,WAAW,KAAKU,YAAY,CAACC,MAAM,EAAE;YACxC,MAAMC,WAAW,GAAGF,YAAY,EAAEG,IAAI;YACtC,IAAID,WAAW,CAACE,OAAO,KAAK,qCAAqC,EAAE;cAClE,MAAMC,WAAW,GAAGL,YAAY,CAACM,KAAK,CAAC,CAAC,CAAC,CAAC,CAAC;cAC3CV,KAAK,CAACW,WAAW,CAAC;gBAAEH,OAAO,EAAE;cAAsC,CAAC,EAAEnB,GAAG,CAACuB,UAAU,CAAC,GAAG,CAAC,GAAGlB,WAAW,GAAGL,GAAG,EAAE,CAC9GoB,WAAW,CACX,CAAC;cACF7B,MAAM,CAACiC,mBAAmB,CAAC,SAAS,EAAEV,qBAAqB,CAAC;YAC7D;UACD;QACD,CAAC;QACD,IAAI;UACHH,KAAK,CAACc,MAAM,GAAG,IAAI;QACpB,CAAC,CAAC,OAAOC,CAAC,EAAE;UACX;UACAC,GAAG,CAACC,KAAK,CAAC,2BAA2B,EAAEF,CAAC,YAAYG,KAAK,GAAGH,CAAC,CAACI,OAAO,GAAGC,MAAM,CAACL,CAAC,CAAC,CAAC;QACnF;QAEAM,UAAU,CAAC,MAAY;UACtBzC,MAAM,CAAC0C,gBAAgB,CAAC,SAAS,EAAEnB,qBAAqB,CAAC;UACzDvB,MAAM,CAAC+B,WAAW,CACjB;YAAEY,EAAE,EAAE,0BAA0B,GAAG,IAAI,CAACnD,SAAS,EAAE;YAAEoC,OAAO,EAAE;UAAwC,CAAC,EACvGd,WACD,CAAC;QACF,CAAC,EAAE,IAAI,CAAC,CAAC,CAAC;QACV;QACAd,MAAM,CAAC4C,QAAQ,GAAG,YAAkB;UACnCxB,KAAK,CAACyB,KAAK,CAAC,CAAC;QACd,CAAC;MACF;IACD;;IAEA;AACD;AACA;AACA;AACA;AACA;AACA;AACA;AACA,OARC;IAAAlD,MAAA,CASQa,cAAc,GAAtB,SAAQA,cAAcA,CAACH,KAAa,EAAU;MAC7C,IAAI,CAACA,KAAK,CAAC2B,UAAU,CAAC,MAAM,CAAC,EAAE;QAC9B,IAAI;UACH,MAAMc,cAAc,GAAGC,gBAAgB,CAACC,QAAQ,CAACC,eAAe,CAAC;UACjE5C,KAAK,GAAGyC,cAAc,CAACI,gBAAgB,CAAC,iBAAiB,CAAC;UAC1D,IAAI,CAAC7C,KAAK,EAAE;YACX,MAAM8C,aAAa,GAAGL,cAAc,CAACI,gBAAgB,CAAC,oCAAoC,CAAC;YAC3F,IAAIC,aAAa,EAAE;cAClB,MAAMC,UAAU,GAAGC,IAAI,CAACC,KAAK,CAACH,aAAa,CAAC;cAC5C,IAAIC,UAAU,IAAIA,UAAU,CAACG,OAAO,IAAIH,UAAU,CAACG,OAAO,CAACpE,MAAM,GAAG,CAAC,EAAE;gBACtEkB,KAAK,GAAG+C,UAAU,CAACG,OAAO,CAAC,CAAC,CAAC;cAC9B;YACD;UACD;QACD,CAAC,CAAC,OAAOpB,CAAC,EAAE;UACXC,GAAG,CAACoB,IAAI,CAAC,uCAAuC,EAAErB,CAAC,YAAYG,KAAK,GAAGH,CAAC,CAACI,OAAO,GAAGC,MAAM,CAACL,CAAC,CAAC,CAAC;UAC7F9B,KAAK,GAAG,aAAa;QACtB;QACA,IAAI,CAACA,KAAK,IAAI,CAACA,KAAK,CAAC2B,UAAU,CAAC,MAAM,CAAC,EAAE;UACxC;UACA3B,KAAK,GAAG,aAAa;QACtB;MACD;MACA,OAAOA,KAAK;IACb,CAAC;IAQD;AACD;AACA;AACA;AACA;IAJC3B,2BAAA,CAKa+E,WAAW,GAAxB,eAAaA,WAAWA,CAAA,EAAqD;MAC5E;MACA,MAAMC,cAAc,GAAGhD,GAAG,CAACC,EAAE,CAACC,OAAO,CAAC,sBAAsB,CAA0B;MACtF,IAAI+C,eAAqC;MACzC,IAAI;QACH,IAAID,cAAc,IAAI,CAAC,IAAI,CAACE,QAAQ,EAAE;UACrC,IAAI,CAACC,eAAe,GAAG,IAAIC,OAAO,CAA2CC,OAAO,IAAK;YACxFJ,eAAe,GAAGI,OAAO;UAC1B,CAAC,CAAC;UACF,MAAMC,gBAAgB,GAAI,MAAMN,cAAc,CAACO,eAAe,CAAC,WAAW,CAA2B;UACrG,IAAID,gBAAgB,EAAE;YACrB,MAAME,oBAAoB,GAAG,MAAMxF,2BAA2B,CAACyF,kBAAkB,CAACH,gBAAgB,CAAC;YACnG,IAAI,CAACJ,QAAQ,GAAGM,oBAAoB;YACpCP,eAAe,CAAEO,oBAAoB,CAAC;UACvC;QACD;MACD,CAAC,CAAC,OAAO/B,CAAC,EAAE;QACXC,GAAG,CAACgC,KAAK,CAAC,2BAA2B,EAAEjC,CAAC,YAAYG,KAAK,GAAGH,CAAC,CAACI,OAAO,GAAGC,MAAM,CAACL,CAAC,CAAC,CAAC;QAClFwB,eAAe,GAAGU,SAAS,CAAC;MAC7B;MACA,OAAO,IAAI,CAACR,eAAe;IAC5B;;IAEA;AACD;AACA;AACA;AACA,OAJC;IAAAnF,2BAAA,CAKayF,kBAAkB,GAA/B,eAAaA,kBAAkBA,CAACG,qBAAgC,EAAoD;MACnH,IAAI;QACH,MAAMC,cAAc,GAAGC,GAAG,CAACC,oBAAoB,CAAC,iBAAiB,CAAE;QAEnE,MAAMC,kBAAkB,GAAG,IAAIhG,2BAA2B,CAAC,CAAC;QAC5D,IAAI,CAAC,IAAI,CAACiG,aAAa,EAAE;UACxB,IAAI,CAACA,aAAa,GAAG,IAAI;UACzB,MAAMC,UAAU,GAAG,MAAMN,qBAAqB,CAACO,gBAAgB,CAC9D;YACCC,IAAI,EAAEP,cAAc,CAACQ,OAAO,CAAC,kBAAkB,CAAC;YAChDC,IAAI,EAAEC,QAAQ,CAACC,UAAU,CAAC,oBAAoB,CAAC;YAC/CC,KAAK,EAAEA,CAAA,KAAY;cAClBT,kBAAkB,CAAC7E,qBAAqB,CAAC,CAAC;YAC3C;UACD,CAAC,EACD;YACCuF,WAAW,EAAE;UACd,CACD,CAAC;UACDR,UAAU,CAACS,cAAc,CAAC,CAAC;QAC5B;QACA,OAAOX,kBAAkB;MAC1B,CAAC,CAAC,OAAOY,GAAG,EAAE;QACblD,GAAG,CAACgC,KAAK,CAAC,wBAAwB,EAAEkB,GAAG,YAAYhD,KAAK,GAAGgD,GAAG,CAAC/C,OAAO,GAAGC,MAAM,CAAC8C,GAAG,CAAC,CAAC;MACtF;IACD,CAAC;IAAA,OAAA5G,2BAAA;EAAA,EA1JuD6G,aAAa,GAAAzG,4BAAA,CA8F9D6F,aAAa,GAAG,KAAK,EAAA7F,4BAAA,MAAAD,MAAA;EAAAY,QAAA,GAAAf,2BAAA;EAAA,OAAAe,QAAA;AAAA","ignoreList":[],"file":"ShortcutExplanationProvider-dbg.js"}