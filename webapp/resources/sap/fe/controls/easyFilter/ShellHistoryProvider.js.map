{"version":3,"file":"ShellHistoryProvider.js","names":["ShellHistoryProvider","_dec","defineUI5Class","_dec2","defineState","_dec3","defineReference","_dec4","_class","_class2","_ShellHistoryProvider","_ManagedObject","personalizationService","globalPersonalizer","appPersonalizer","data","appData","_this","call","this","_initializerDefineProperty","_descriptor","instances","add","state","isHistoryEnabled","apps","recentQueries","favoriteQueries","_exports","_inheritsLoose","getShellDialogContent","selectedValue","$form","_jsxs","VBox","children","_jsx","Title","text","resourceBundle","getText","CheckBox","ref","$historyEnabled","selected","saveShellDialog","currentSelectedState","current","getSelected","forEach","instance","_proto","prototype","onStateChange","async","setPersData","valueOf","getRecentQueries","concat","getFavoriteQueries","setRecentQueries","setFavoriteQueries","getInstance","appId","shellContainer","sap","ui","require","resolveCreation","Promise","resolve","extensionService","getServiceAsync","frameBoundExtension","shellHistoryProvider","registerUserAction","e","Log","error","Error","message","String","shellExtensionService","Lib","getResourceBundleFor","scope","clientStorageAllowed","keyCategory","constants","FIXED_KEY","validity","Infinity","writeFrequency","LOW","getPersonalizer","container","item","globalData","getPersData","uid","shellHistoryDialog","isDialogAdded","addGroupedUserSettingsEntry","title","icon","entryHelpId","groupingId","groupingTabTitle","groupingTabHelpId","value","content","onSave","onCancel","err","ManagedObject","Set","_applyDecoratedDescriptor","configurable","enumerable","writable","initializer","_init","Object","getOwnPropertyDescriptor","undefined","_init2"],"sources":["./ShellHistoryProvider.tsx"],"sourcesContent":["import Log from \"sap/base/Log\";\nimport uid from \"sap/base/util/uid\";\nimport { defineReference, defineState, defineUI5Class } from \"sap/fe/base/ClassSupport\";\nimport type { Ref } from \"sap/fe/base/jsx-runtime/jsx\";\nimport CheckBox from \"sap/m/CheckBox\";\nimport Title from \"sap/m/Title\";\nimport VBox from \"sap/m/VBox\";\nimport ManagedObject from \"sap/ui/base/ManagedObject\";\nimport Lib from \"sap/ui/core/Lib\";\nimport type Container from \"sap/ushell/Container\";\nimport type Extension from \"sap/ushell/services/Extension\";\nimport type PersonalizationV2 from \"sap/ushell/services/PersonalizationV2\";\n\nexport type PersonalizationWithConstants = PersonalizationV2 & {\n\tconstants: {\n\t\tkeyCategory: {\n\t\t\tFIXED_KEY: string;\n\t\t\tGENERATED_KEY: string;\n\t\t};\n\t\twriteFrequency: {\n\t\t\tHIGH: string;\n\t\t\tLOW: string;\n\t\t};\n\t};\n};\n\ntype FrameBoundExtension = {\n\taddGroupedUserSettingsEntry: (settings: unknown) => Promise<void>;\n};\ntype PersonalizerType = {\n\tgetPersData: () => Promise<object>;\n\tsetPersData: (persData: object) => Promise<void>;\n};\n\ntype ShellHistorySettings = {\n\tisHistoryEnabled: boolean;\n\tapps: Record<string, string>;\n};\n\ntype ShellAppHistorySettings = {\n\trecentQueries: string[];\n\tfavoriteQueries: string[];\n};\n\n@defineUI5Class(\"sap.fe.controls.easyFilter.ShellHistoryProvider\")\nexport default class ShellHistoryProvider extends ManagedObject {\n\t@defineState()\n\tprivate state = {\n\t\tisHistoryEnabled: true,\n\t\tapps: {} as Record<string, string>,\n\t\trecentQueries: [] as readonly string[],\n\t\tfavoriteQueries: [] as readonly string[]\n\t};\n\n\tprivate static instances: Set<ShellHistoryProvider> = new Set();\n\n\tconstructor(\n\t\tprivate readonly personalizationService: PersonalizationWithConstants,\n\t\tprivate readonly globalPersonalizer: PersonalizerType,\n\t\tprivate readonly appPersonalizer: PersonalizerType,\n\t\tprivate readonly data: ShellHistorySettings,\n\t\tprivate readonly appData: ShellAppHistorySettings\n\t) {\n\t\tsuper();\n\t\tShellHistoryProvider.instances.add(this);\n\t\tthis.state.isHistoryEnabled = data.isHistoryEnabled;\n\t\tthis.state.apps = data.apps;\n\t\tthis.state.recentQueries = appData.recentQueries;\n\t\tthis.state.favoriteQueries = appData.favoriteQueries;\n\t}\n\n\tprivate static resourceBundle = Lib.getResourceBundleFor(\"sap.fe.controls\")!;\n\n\tprivate static $form: VBox;\n\n\t@defineReference()\n\tprivate static $defaultOption: Ref<CheckBox>;\n\n\t@defineReference()\n\tprivate static $historyEnabled: Ref<CheckBox>;\n\n\tstatic getShellDialogContent(selectedValue: boolean): VBox {\n\t\tthis.$form = (\n\t\t\t<VBox>\n\t\t\t\t<Title text={this.resourceBundle.getText(\"M_BUSINESS_AI_SHELL_SETTINGS_EASY_FILTER\")}></Title>\n\t\t\t\t<CheckBox\n\t\t\t\t\tref={this.$historyEnabled}\n\t\t\t\t\tselected={selectedValue}\n\t\t\t\t\ttext={this.resourceBundle.getText(\"M_BUSINESS_AI_SHELL_SETTINGS_EASY_FILTER_KEEP_QUERIES\")}\n\t\t\t\t/>\n\t\t\t</VBox>\n\t\t) as VBox;\n\t\treturn this.$form;\n\t}\n\n\tstatic saveShellDialog(): void {\n\t\tconst currentSelectedState = ShellHistoryProvider.$historyEnabled.current!.getSelected();\n\t\t//updating the value in all the objects\n\t\tthis.instances.forEach((instance) => {\n\t\t\tinstance.state.isHistoryEnabled = currentSelectedState;\n\t\t});\n\t}\n\n\tasync onStateChange(): Promise<void> {\n\t\t// We confirm the value of the switch\n\t\tawait this.globalPersonalizer.setPersData({\n\t\t\tisHistoryEnabled: this.state.isHistoryEnabled,\n\t\t\tapps: this.state.apps\n\t\t});\n\t\tawait this.appPersonalizer.setPersData({ recentQueries: this.state.recentQueries, favoriteQueries: this.state.favoriteQueries });\n\t}\n\n\tisHistoryEnabled(): boolean {\n\t\treturn this.state.isHistoryEnabled.valueOf();\n\t}\n\n\tgetRecentQueries(): string[] {\n\t\treturn this.state.recentQueries.concat();\n\t}\n\n\tgetFavoriteQueries(): string[] {\n\t\treturn this.state.favoriteQueries.concat();\n\t}\n\n\tsetRecentQueries(recentQueries: readonly string[]): void {\n\t\tthis.state.recentQueries = recentQueries;\n\t}\n\n\tsetFavoriteQueries(favoriteQueries: readonly string[]): void {\n\t\tthis.state.favoriteQueries = favoriteQueries;\n\t}\n\n\tstatic instance: Promise<ShellHistoryProvider | undefined>;\n\n\tstatic isDialogAdded = false;\n\n\tstatic async getInstance(appId: string): Promise<ShellHistoryProvider | undefined> {\n\t\t// Register the extension\n\t\tconst shellContainer = sap.ui.require(\"sap/ushell/Container\") as Container | undefined;\n\t\ttry {\n\t\t\tif (shellContainer) {\n\t\t\t\tlet resolveCreation!: Function;\n\t\t\t\tthis.instance = new Promise<ShellHistoryProvider | undefined>((resolve) => {\n\t\t\t\t\tresolveCreation = resolve;\n\t\t\t\t});\n\t\t\t\tconst extensionService = (await shellContainer.getServiceAsync(\"Extension\")) as Extension | undefined;\n\t\t\t\tconst frameBoundExtension = (await shellContainer.getServiceAsync(\"FrameBoundExtension\")) as\n\t\t\t\t\t| FrameBoundExtension\n\t\t\t\t\t| undefined;\n\t\t\t\tconst personalizationService = (await shellContainer.getServiceAsync(\"PersonalizationV2\")) as\n\t\t\t\t\t| PersonalizationWithConstants\n\t\t\t\t\t| undefined;\n\t\t\t\tif (extensionService && personalizationService && frameBoundExtension) {\n\t\t\t\t\tconst shellHistoryProvider = await ShellHistoryProvider.registerUserAction(\n\t\t\t\t\t\textensionService,\n\t\t\t\t\t\tpersonalizationService,\n\t\t\t\t\t\tframeBoundExtension,\n\t\t\t\t\t\tappId\n\t\t\t\t\t);\n\t\t\t\t\tresolveCreation(shellHistoryProvider);\n\t\t\t\t}\n\t\t\t}\n\t\t} catch (e) {\n\t\t\tLog.error(\"Cannot register extension\", e instanceof Error ? e.message : String(e));\n\t\t}\n\t\treturn this.instance;\n\t}\n\n\tstatic async registerUserAction(\n\t\tshellExtensionService: Extension,\n\t\tpersonalizationService: PersonalizationWithConstants,\n\t\tframeBoundExtension: FrameBoundExtension,\n\t\tappId: string\n\t): Promise<ShellHistoryProvider | undefined> {\n\t\ttry {\n\t\t\tconst resourceBundle = Lib.getResourceBundleFor(\"sap.fe.controls\")!;\n\t\t\tconst scope = {\n\t\t\t\tclientStorageAllowed: false,\n\t\t\t\tkeyCategory: personalizationService.constants.keyCategory.FIXED_KEY,\n\t\t\t\tvalidity: Infinity,\n\t\t\t\twriteFrequency: personalizationService.constants.writeFrequency.LOW\n\t\t\t};\n\t\t\tconst globalPersonalizer = (await personalizationService.getPersonalizer(\n\t\t\t\t{\n\t\t\t\t\tcontainer: \"sap.fe.easyFilter\",\n\t\t\t\t\titem: \"settings\"\n\t\t\t\t},\n\t\t\t\tscope\n\t\t\t)) as PersonalizerType;\n\t\t\tlet globalData = (await globalPersonalizer.getPersData()) as ShellHistorySettings | undefined;\n\t\t\tif (!globalData) {\n\t\t\t\t// In case defaut value don't exist we create it\n\t\t\t\tglobalData = {\n\t\t\t\t\tisHistoryEnabled: true,\n\t\t\t\t\tapps: {\n\t\t\t\t\t\t[appId]: uid()\n\t\t\t\t\t}\n\t\t\t\t};\n\t\t\t\tglobalPersonalizer.setPersData(globalData);\n\t\t\t} else if (!globalData.apps?.[appId]) {\n\t\t\t\tglobalData.apps ??= {};\n\t\t\t\tglobalData.apps[appId] = uid();\n\t\t\t\tawait globalPersonalizer.setPersData(globalData);\n\t\t\t}\n\t\t\tconst appPersonalizer = (await personalizationService.getPersonalizer(\n\t\t\t\t{\n\t\t\t\t\tcontainer: \"sap.fe.easyFilter\" + globalData.apps[appId],\n\t\t\t\t\titem: \"recentQueries\"\n\t\t\t\t},\n\t\t\t\tscope\n\t\t\t)) as PersonalizerType;\n\t\t\tlet appData = (await appPersonalizer.getPersData()) as ShellAppHistorySettings | undefined;\n\t\t\tif (!appData) {\n\t\t\t\tappData = {\n\t\t\t\t\trecentQueries: [],\n\t\t\t\t\tfavoriteQueries: []\n\t\t\t\t};\n\t\t\t\tawait appPersonalizer.setPersData(appData);\n\t\t\t}\n\t\t\tconst shellHistoryDialog = new ShellHistoryProvider(\n\t\t\t\tpersonalizationService,\n\t\t\t\tglobalPersonalizer,\n\t\t\t\tappPersonalizer,\n\t\t\t\tglobalData,\n\t\t\t\tappData\n\t\t\t);\n\t\t\tif (!this.isDialogAdded) {\n\t\t\t\tthis.isDialogAdded = true;\n\t\t\t\tawait frameBoundExtension.addGroupedUserSettingsEntry({\n\t\t\t\t\ttitle: resourceBundle.getText(\"M_BUSINESS_AI_SHELL_SETTINGS_TITLE\"),\n\t\t\t\t\ticon: \"sap-icon://laptop\",\n\t\t\t\t\tentryHelpId: \"userActivitiesEntry\",\n\t\t\t\t\tgroupingId: \"userActivities\",\n\t\t\t\t\tgroupingTabTitle: resourceBundle.getText(\"M_BUSINESS_AI_SHELL_SETTINGS_TITLE\"),\n\t\t\t\t\tgroupingTabHelpId: \"sapBusinessAI-helpId\",\n\t\t\t\t\tvalue: async () => {\n\t\t\t\t\t\treturn Promise.resolve();\n\t\t\t\t\t},\n\t\t\t\t\tcontent: async () => {\n\t\t\t\t\t\treturn Promise.resolve(this.getShellDialogContent(globalData?.isHistoryEnabled as boolean));\n\t\t\t\t\t},\n\t\t\t\t\tonSave: () => {\n\t\t\t\t\t\tthis.saveShellDialog();\n\t\t\t\t\t},\n\t\t\t\t\tonCancel: () => {\n\t\t\t\t\t\t//return (this.viewInstance.getController() as RequestSettingsController).onCancel();\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\t\t\treturn shellHistoryDialog;\n\t\t} catch (err) {\n\t\t\tLog.error(\"Cannot add user action\", err instanceof Error ? err.message : String(err));\n\t\t}\n\t}\n}\n"],"mappings":";;;;4zCA6CqBA,GAAoBC,EADxCC,EAAe,mDAAkDC,EAEhEC,IAAaC,EA6BbC,IAAiBC,EAGjBD,IAAiBL,EAAAO,GAAAC,GAAAC,EAAA,SAAAC,GAtBlB,SAAAX,EACkBY,EACAC,EACAC,EACAC,EACAC,GAChB,IAAAC,EACDA,EAAAN,EAAAO,KAAAC,OAAOA,KAACC,EAAAH,EAAA,QAAAI,EAAAJ,KANSL,yBAAoDK,EACpDJ,qBAAoCI,EACpCH,kBAAiCG,EACjCF,OAA0BE,EAC1BD,UAGjBhB,EAAqBsB,UAAUC,IAAGN,GAClCA,EAAKO,MAAMC,iBAAmBV,EAAKU,iBACnCR,EAAKO,MAAME,KAAOX,EAAKW,KACvBT,EAAKO,MAAMG,cAAgBX,EAAQW,cACnCV,EAAKO,MAAMI,gBAAkBZ,EAAQY,gBAAgB,OAAAX,CACtD,CAACY,EAAA7B,EAAA8B,EAAA9B,EAAAW,GAAAX,EAYM+B,sBAAP,SAAOA,EAAsBC,GAC5Bb,KAAKc,MACJC,EAACC,EAAI,CAAAC,SAAA,CACJC,EAACC,EAAK,CAACC,KAAMpB,KAAKqB,eAAeC,QAAQ,8CACzCJ,EAACK,EAAQ,CACRC,IAAKxB,KAAKyB,gBACVC,SAAUb,EACVO,KAAMpB,KAAKqB,eAAeC,QAAQ,8DAIrC,OAAOtB,KAAKc,KACb,EAACjC,EAEM8C,gBAAP,SAAOA,IACN,MAAMC,EAAuB/C,EAAqB4C,gBAAgBI,QAASC,cAE3E9B,KAAKG,UAAU4B,QAASC,IACvBA,EAAS3B,MAAMC,iBAAmBsB,GAEpC,EAAC,IAAAK,EAAApD,EAAAqD,UAAAD,EAEKE,cAANC,eAAMD,UAECnC,KAAKN,mBAAmB2C,YAAY,CACzC/B,iBAAkBN,KAAKK,MAAMC,iBAC7BC,KAAMP,KAAKK,MAAME,aAEZP,KAAKL,gBAAgB0C,YAAY,CAAE7B,cAAeR,KAAKK,MAAMG,cAAeC,gBAAiBT,KAAKK,MAAMI,iBAC/G,EAACwB,EAED3B,iBAAA,SAAAA,IACC,OAAON,KAAKK,MAAMC,iBAAiBgC,SACpC,EAACL,EAEDM,iBAAA,SAAAA,IACC,OAAOvC,KAAKK,MAAMG,cAAcgC,QACjC,EAACP,EAEDQ,mBAAA,SAAAA,IACC,OAAOzC,KAAKK,MAAMI,gBAAgB+B,QACnC,EAACP,EAEDS,iBAAA,SAAAA,EAAiBlC,GAChBR,KAAKK,MAAMG,cAAgBA,CAC5B,EAACyB,EAEDU,mBAAA,SAAAA,EAAmBlC,GAClBT,KAAKK,MAAMI,gBAAkBA,CAC9B,EAAC5B,EAMY+D,YAAbR,eAAaQ,EAAYC,GAExB,MAAMC,EAAiBC,IAAIC,GAAGC,QAAQ,wBACtC,IACC,GAAIH,EAAgB,CACnB,IAAII,EACJlD,KAAKgC,SAAW,IAAImB,QAA2CC,IAC9DF,EAAkBE,IAEnB,MAAMC,QAA0BP,EAAeQ,gBAAgB,aAC/D,MAAMC,QAA6BT,EAAeQ,gBAAgB,uBAGlE,MAAM7D,QAAgCqD,EAAeQ,gBAAgB,qBAGrE,GAAID,GAAoB5D,GAA0B8D,EAAqB,CACtE,MAAMC,QAA6B3E,EAAqB4E,mBACvDJ,EACA5D,EACA8D,EACAV,GAEDK,EAAgBM,EACjB,CACD,CACD,CAAE,MAAOE,GACRC,EAAIC,MAAM,4BAA6BF,aAAaG,MAAQH,EAAEI,QAAUC,OAAOL,GAChF,CACA,OAAO1D,KAAKgC,QACb,EAACnD,EAEY4E,mBAAbrB,eAAaqB,EACZO,EACAvE,EACA8D,EACAV,GAEA,IACC,MAAMxB,EAAiB4C,EAAIC,qBAAqB,mBAChD,MAAMC,EAAQ,CACbC,qBAAsB,MACtBC,YAAa5E,EAAuB6E,UAAUD,YAAYE,UAC1DC,SAAUC,SACVC,eAAgBjF,EAAuB6E,UAAUI,eAAeC,KAEjE,MAAMjF,QAA4BD,EAAuBmF,gBACxD,CACCC,UAAW,oBACXC,KAAM,YAEPX,GAED,IAAIY,QAAoBrF,EAAmBsF,cAC3C,IAAKD,EAAY,CAEhBA,EAAa,CACZzE,iBAAkB,KAClBC,KAAM,CACLsC,CAACA,GAAQoC,MAGXvF,EAAmB2C,YAAY0C,EAChC,MAAO,IAAKA,EAAWxE,OAAOsC,GAAQ,CACrCkC,EAAWxE,OAAS,CAAC,EACrBwE,EAAWxE,KAAKsC,GAASoC,UACnBvF,EAAmB2C,YAAY0C,EACtC,CACA,MAAMpF,QAAyBF,EAAuBmF,gBACrD,CACCC,UAAW,oBAAsBE,EAAWxE,KAAKsC,GACjDiC,KAAM,iBAEPX,GAED,IAAItE,QAAiBF,EAAgBqF,cACrC,IAAKnF,EAAS,CACbA,EAAU,CACTW,cAAe,GACfC,gBAAiB,UAEZd,EAAgB0C,YAAYxC,EACnC,CACA,MAAMqF,EAAqB,IAAIrG,EAC9BY,EACAC,EACAC,EACAoF,EACAlF,GAED,IAAKG,KAAKmF,cAAe,CACxBnF,KAAKmF,cAAgB,WACf5B,EAAoB6B,4BAA4B,CACrDC,MAAOhE,EAAeC,QAAQ,sCAC9BgE,KAAM,oBACNC,YAAa,sBACbC,WAAY,iBACZC,iBAAkBpE,EAAeC,QAAQ,sCACzCoE,kBAAmB,uBACnBC,MAAOvD,SACCe,QAAQC,UAEhBwC,QAASxD,SACDe,QAAQC,QAAQpD,KAAKY,sBAAsBmE,GAAYzE,mBAE/DuF,OAAQA,KACP7F,KAAK2B,mBAENmE,SAAUA,QAIZ,CACA,OAAOZ,CACR,CAAE,MAAOa,GACRpC,EAAIC,MAAM,yBAA0BmC,aAAelC,MAAQkC,EAAIjC,QAAUC,OAAOgC,GACjF,CACD,EAAC,OAAAlH,CAAA,CA/KiB,CAjC+BmH,GAAazG,EAS/CY,UAAuC,IAAI8F,IAAK1G,EAiBhD8B,eAAiB4C,EAAIC,qBAAqB,mBAAkB3E,EA+DpE4F,cAAgB,MAAK5F,GAAAW,EAAAgG,EAAA5G,EAAA4C,UAAA,SAAAlD,GAAA,CAAAmH,aAAA,KAAAC,WAAA,KAAAC,SAAA,KAAAC,YAAA,iBAvFZ,CACfhG,iBAAkB,KAClBC,KAAM,CAAC,EACPC,cAAe,GACfC,gBAAiB,GACjB,IAAAyF,EAAA5G,EAAA,kBAAAJ,IAAAqH,EAAAC,OAAAC,yBAAAnH,EAAA,kBAAAiH,MAAAZ,MAAAe,UAAA,CAAAN,WAAA,KAAAD,aAAA,KAAAE,SAAA,KAAAC,YAAA,kBAAAC,CAAA,IAAAjH,GAAA4G,EAAA5G,EAAA,mBAAAF,IAAAuH,EAAAH,OAAAC,yBAAAnH,EAAA,mBAAAqH,MAAAhB,MAAAe,UAAA,CAAAN,WAAA,KAAAD,aAAA,KAAAE,SAAA,KAAAC,YAAA,kBAAAK,CAAA,IAAArH,QAAAD,GAAAqB,EAAA7B,EAAA,OAAA6B,CAAA","ignoreList":[]}