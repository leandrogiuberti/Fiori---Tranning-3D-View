/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)
 *      (c) Copyright 2009-2025 SAP SE. All rights reserved
 */
sap.ui.define(["sap/base/Log","sap/base/util/uid","sap/fe/base/ClassSupport","sap/m/CheckBox","sap/m/Title","sap/m/VBox","sap/ui/base/ManagedObject","sap/ui/core/Lib","sap/fe/base/jsx-runtime/jsx","sap/fe/base/jsx-runtime/jsxs"],function(e,t,i,r,a,s,n,o,c,l){"use strict";var u,p,f,d,g,b,y,E,h,S;var v={};var _=i.defineUI5Class;var w=i.defineState;var I=i.defineReference;function P(e,t,i,r){i&&Object.defineProperty(e,t,{enumerable:i.enumerable,configurable:i.configurable,writable:i.writable,value:i.initializer?i.initializer.call(r):void 0})}function m(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e,Q(e,t)}function Q(e,t){return Q=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},Q(e,t)}function T(e,t,i,r,a){var s={};return Object.keys(r).forEach(function(e){s[e]=r[e]}),s.enumerable=!!s.enumerable,s.configurable=!!s.configurable,("value"in s||s.initializer)&&(s.writable=!0),s=i.slice().reverse().reduce(function(i,r){return r(e,t,i)||i},s),a&&void 0!==s.initializer&&(s.value=s.initializer?s.initializer.call(a):void 0,s.initializer=void 0),void 0===s.initializer?(Object.defineProperty(e,t,s),null):s}function z(e,t){throw Error("Decorating class property failed. Please ensure that transform-class-properties is enabled and runs after the decorators transform.")}let D=(u=_("sap.fe.controls.easyFilter.ShellHistoryProvider"),p=w(),f=I(),d=I(),u(g=(b=(S=function(i){function n(e,t,r,a,s){var o;o=i.call(this)||this;P(o,"state",y,o);o.personalizationService=e;o.globalPersonalizer=t;o.appPersonalizer=r;o.data=a;o.appData=s;n.instances.add(o);o.state.isHistoryEnabled=a.isHistoryEnabled;o.state.apps=a.apps;o.state.recentQueries=s.recentQueries;o.state.favoriteQueries=s.favoriteQueries;return o}v=n;m(n,i);n.getShellDialogContent=function e(t){this.$form=l(s,{children:[c(a,{text:this.resourceBundle.getText("M_BUSINESS_AI_SHELL_SETTINGS_EASY_FILTER")}),c(r,{ref:this.$historyEnabled,selected:t,text:this.resourceBundle.getText("M_BUSINESS_AI_SHELL_SETTINGS_EASY_FILTER_KEEP_QUERIES")})]});return this.$form};n.saveShellDialog=function e(){const t=n.$historyEnabled.current.getSelected();this.instances.forEach(e=>{e.state.isHistoryEnabled=t})};var u=n.prototype;u.onStateChange=async function e(){await this.globalPersonalizer.setPersData({isHistoryEnabled:this.state.isHistoryEnabled,apps:this.state.apps});await this.appPersonalizer.setPersData({recentQueries:this.state.recentQueries,favoriteQueries:this.state.favoriteQueries})};u.isHistoryEnabled=function e(){return this.state.isHistoryEnabled.valueOf()};u.getRecentQueries=function e(){return this.state.recentQueries.concat()};u.getFavoriteQueries=function e(){return this.state.favoriteQueries.concat()};u.setRecentQueries=function e(t){this.state.recentQueries=t};u.setFavoriteQueries=function e(t){this.state.favoriteQueries=t};n.getInstance=async function t(i){const r=sap.ui.require("sap/ushell/Container");try{if(r){let e;this.instance=new Promise(t=>{e=t});const t=await r.getServiceAsync("Extension");const a=await r.getServiceAsync("FrameBoundExtension");const s=await r.getServiceAsync("PersonalizationV2");if(t&&s&&a){const r=await n.registerUserAction(t,s,a,i);e(r)}}}catch(t){e.error("Cannot register extension",t instanceof Error?t.message:String(t))}return this.instance};n.registerUserAction=async function i(r,a,s,c){try{const e=o.getResourceBundleFor("sap.fe.controls");const i={clientStorageAllowed:false,keyCategory:a.constants.keyCategory.FIXED_KEY,validity:Infinity,writeFrequency:a.constants.writeFrequency.LOW};const r=await a.getPersonalizer({container:"sap.fe.easyFilter",item:"settings"},i);let l=await r.getPersData();if(!l){l={isHistoryEnabled:true,apps:{[c]:t()}};r.setPersData(l)}else if(!l.apps?.[c]){l.apps??={};l.apps[c]=t();await r.setPersData(l)}const u=await a.getPersonalizer({container:"sap.fe.easyFilter"+l.apps[c],item:"recentQueries"},i);let p=await u.getPersData();if(!p){p={recentQueries:[],favoriteQueries:[]};await u.setPersData(p)}const f=new n(a,r,u,l,p);if(!this.isDialogAdded){this.isDialogAdded=true;await s.addGroupedUserSettingsEntry({title:e.getText("M_BUSINESS_AI_SHELL_SETTINGS_TITLE"),icon:"sap-icon://laptop",entryHelpId:"userActivitiesEntry",groupingId:"userActivities",groupingTabTitle:e.getText("M_BUSINESS_AI_SHELL_SETTINGS_TITLE"),groupingTabHelpId:"sapBusinessAI-helpId",value:async()=>Promise.resolve(),content:async()=>Promise.resolve(this.getShellDialogContent(l?.isHistoryEnabled)),onSave:()=>{this.saveShellDialog()},onCancel:()=>{}})}return f}catch(t){e.error("Cannot add user action",t instanceof Error?t.message:String(t))}};return n}(n),S.instances=new Set,S.resourceBundle=o.getResourceBundleFor("sap.fe.controls"),S.isDialogAdded=false,S),y=T(b.prototype,"state",[p],{configurable:true,enumerable:true,writable:true,initializer:function(){return{isHistoryEnabled:true,apps:{},recentQueries:[],favoriteQueries:[]}}}),T(b,"$defaultOption",[f],(E=Object.getOwnPropertyDescriptor(b,"$defaultOption"),E=E?E.value:undefined,{enumerable:true,configurable:true,writable:true,initializer:function(){return E}}),b),T(b,"$historyEnabled",[d],(h=Object.getOwnPropertyDescriptor(b,"$historyEnabled"),h=h?h.value:undefined,{enumerable:true,configurable:true,writable:true,initializer:function(){return h}}),b),b))||g);v=D;return v},false);
//# sourceMappingURL=ShellHistoryProvider.js.map