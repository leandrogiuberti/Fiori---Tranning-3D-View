/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)
 *      (c) Copyright 2009-2025 SAP SE. All rights reserved
 */
sap.ui.define(["sap/base/Log","sap/fe/base/ClassSupport","sap/fe/base/jsx-runtime/jsx","sap/m/Token","sap/m/delegate/ValueStateMessage","sap/ui/core/Lib","sap/ui/core/library","sap/ui/model/FilterOperator","./innerControls/CalendarFactory","./innerControls/MenuWithCheckBoxFactory","./innerControls/MenuWithSingleSelectFactory","./innerControls/TimeFactory","./innerControls/ValueHelpPreviewFactory","./utils","sap/fe/base/jsx-runtime/jsxs","sap/fe/base/jsx-runtime/jsx"],function(e,t,i,n,s,o,a,r,l,u,h,c,p,d,f,g){"use strict";var m,C,v,y,S,V,b,k,D,T,B,w,F,M,P,O,A,E,H,x,W;var z={};var _=a.ValueState;var I=t.property;var L=t.defineUI5Class;function j(e,t,i,n){i&&Object.defineProperty(e,t,{enumerable:i.enumerable,configurable:i.configurable,writable:i.writable,value:i.initializer?i.initializer.call(n):void 0})}function R(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e,K(e,t)}function K(e,t){return K=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},K(e,t)}function N(e,t,i,n,s){var o={};return Object.keys(n).forEach(function(e){o[e]=n[e]}),o.enumerable=!!o.enumerable,o.configurable=!!o.configurable,("value"in o||o.initializer)&&(o.writable=!0),o=i.slice().reverse().reduce(function(i,n){return n(e,t,i)||i},o),s&&void 0!==o.initializer&&(o.value=o.initializer?o.initializer.call(s):void 0,o.initializer=void 0),void 0===o.initializer?(Object.defineProperty(e,t,o),null):o}function Y(e,t){throw Error("Decorating class property failed. Please ensure that transform-class-properties is enabled and runs after the decorators transform.")}let U=(m=L("sap.fe.controls.easyFilter.Token"),C=I({type:"string"}),v=I({type:"string"}),y=I({type:"string"}),S=I({type:"string",defaultValue:null}),V=I({type:"boolean"}),b=I({type:"array"}),k=I({type:"sap.ui.core.ValueState",group:"Appearance",defaultValue:_.None}),D=I({type:"int",visibility:"hidden"}),T=I({type:"int",visibility:"hidden"}),m(B=(w=function(t){function a(e,i){var n;n=t.call(this,e,i)||this;j(n,"label",F,n);j(n,"titlePopover",M,n);j(n,"value",P,n);j(n,"valueStateText",O,n);j(n,"mandatory",A,n);j(n,"items",E,n);j(n,"valueState",H,n);j(n,"posinset",x,n);j(n,"setsize",W,n);n.resourceBundle=o.getResourceBundleFor("sap.fe.controls");n.eventAttached=false;n.isDescriptionFetched=false;n.valueStateMessage=new s(n);n.attachCloseHandlersForValueStateMessagePopup();return n}z=a;R(a,t);var m=a.prototype;m.firePress=function e(t){const i=this.getParent();if(!i.getEditable()){return this}this.fireEvent("press");this.valueStateMessage?.close();const n=this.getCustomDataValue("easyFilterBarContainer");const s=this.getCustomDataValue("popover");const{key:o,type:r,keySpecificSelectedValues:l}=this.getCustomDataValue("TokenInfo");if(s.isOpen()){if(a.prevTokenKey===o){return this}else{a.prevTokenKey=o;s.close()}}else{a.prevTokenKey=o}s?.setShowHeader(true);s?.getFooter()?.setVisible(true);if(r==="Calendar"&&this.shouldOpenDefaultFragment(l)){this.invokeCalendar()}else if(r==="Time"&&this.shouldOpenDefaultFragment(l)){this.invokeTime()}else if(r==="MenuWithCheckBox"){this.invokeMenuWithCheckBox()}else if(r==="MenuWithSingleSelect"){this.invokeMenuWithSingleSelect()}else{this.invokeValueHelpPreview()}const u=n?.getOkButton();const h=n?.getShowAllButton();if(!(this.eventAttached??false)){u?.attachPress(this.handleOkClick.bind(this));h?.attachPress(this.handleShowAllClick.bind(this));s.attachAfterClose(this.handleAttachAfterClose.bind(this));this.eventAttached=true}return this};m.getCustomDataValue=function e(t){return this.getCustomData().find(e=>e.getKey()===t)?.getValue()};m.onBeforeRendering=function e(t){n.prototype.onBeforeRendering.apply(this,[t]);if(!this.isDescriptionFetched){this.setValueForToken()}this.isDescriptionFetched=false};m.attachCloseHandlersForValueStateMessagePopup=function e(){document.addEventListener("click",()=>{if(this?.valueStateMessage){this.valueStateMessage.close()}});document.addEventListener("touchstart",()=>{if(this?.valueStateMessage){this.valueStateMessage.close()}})};m.setValueForToken=function e(){const t=this.items;if(t.length===0){this.setProperty("value",this.resourceBundle.getText("M_EASY_FILTER_MANDATORY_TOKEN_SELECT_VALUE"),true);return}const i=t[0];const n=this.calculateTotalSelectedValues(t);if(n===1){this.handleSingleSelectedValue(i)}else{this.handleMultipleSelectedValues(n)}};m.calculateTotalSelectedValues=function e(t){return t.reduce((e,t)=>d.isBetweenSelectedValues(t.operator)?e+1:e+t.selectedValues.length,0)};m.handleSingleSelectedValue=function e(t){const i=this.getCustomDataValue("TokenInfo");const n=t?.operator;const s=t.selectedValues[0];const o=t.selectedValues;const a=this.getCustomDataValue("easyFilterBarContainer");const r=a?.filterBarMetadata?.find(e=>e.name===this.getKey());if(!r){return}const{type:l,dataType:u}=r;if(i){const{key:e}=i;if(l==="MenuWithCheckBox"||l==="MenuWithSingleSelect"){this.setValueForMenu(e);return}if(l==="ValueHelp"){if(d.isBetweenSelectedValues(n)){this.setProperty("value",d.mapOperatorForBetweenOperator(n,o,l,u==="Edm.DateTimeOffset"),true)}else{this.setProperty("value",d.mapOperatorForValueHelp(n,s,l,u==="Edm.DateTimeOffset"),true)}}else if(d.isBetweenSelectedValues(n)){this.setProperty("value",d.mapOperatorForBetweenOperator(n,o,l,u==="Edm.DateTimeOffset"),true)}else{this.setProperty("value",d.mapOperator(n,s,l,u==="Edm.DateTimeOffset"),true)}}};m.handleMultipleSelectedValues=function e(t){this.setProperty("value",this.resourceBundle.getText("M_EASY_FILTER_MANDATORY_TOKEN_ITEMS",[t]),true)};m.setValueForMenu=function t(i){const n=this.getCustomDataValue("easyFilterBarContainer");this.setBusy(true);(async()=>{try{const e=await this.getDescriptionByKey(n.filterBarMetadata?.find(e=>e.name===i),this.items);this.setProperty("value",e);this.isDescriptionFetched=true;this.setBusy(false)}catch(t){e.error("Error while fetching codeList",t)}})()};m.getDomRefForValueStateMessage=function e(){return this.getDomRef()};m.getDescriptionByKey=async function e(t,i){const n=await d.getCodeListArray(t.codeList);return n?.find(e=>e.value===i[0].selectedValues[0])?.description};m.invokeMenuWithCheckBox=async function e(){const t=this.getCustomDataValue("easyFilterBarContainer");const i=this.getCustomDataValue("popover");const n=this.getCustomDataValue("codeList");const{keySpecificSelectedValues:s}=this.getCustomDataValue("TokenInfo");if(!this.menuWithCheckBox){this.menuWithCheckBox=new u(t,this)}this.innerControl=this.menuWithCheckBox.getControl();this.addDependent(this.innerControl);await this.menuWithCheckBox.setItems(n,s);i?.removeAllContent();i?.addContent(this.innerControl);t?.getShowAllButton()?.setVisible(false);this.openPopover()};m.invokeMenuWithSingleSelect=async function e(){const t=this.getCustomDataValue("easyFilterBarContainer");const i=this.getCustomDataValue("popover");const n=this.getCustomDataValue("codeList");const{keySpecificSelectedValues:s}=this.getCustomDataValue("TokenInfo");if(!this.menuWithSingleSelect){this.menuWithSingleSelect=new h(t,this)}this.innerControl=this.menuWithSingleSelect.getControl();this.addDependent(this.innerControl);await this.menuWithSingleSelect.setItems(n,s);i.setShowHeader(false);i.getFooter()?.setVisible(false);i?.removeAllContent();i?.addContent(this.innerControl);this.openPopover()};m.invokeCalendar=function e(){const t=this.getCustomDataValue("easyFilterBarContainer");const i=this.getCustomDataValue("popover");if(!this.calender){this.calender=new l(t,this)}this.innerControl=this.calender.getControl();this.addDependent(this.innerControl);i?.removeAllContent();i?.addContent(this.innerControl);t?.getShowAllButton()?.setVisible(true);this.openPopover()};m.invokeTime=function e(){const t=this.getCustomDataValue("easyFilterBarContainer");const i=this.getCustomDataValue("popover");if(!this.time){this.time=new c(t,this)}this.innerControl=this.time.getControl();this.addDependent(this.innerControl);i?.removeAllContent();i?.addContent(this.innerControl);t?.getShowAllButton()?.setVisible(true);this.openPopover()};m.invokeValueHelpPreview=function e(){const t=this.getCustomDataValue("easyFilterBarContainer");const i=this.getCustomDataValue("popover");if(!this.valueHelpPreview){this.valueHelpPreview=new p(t,this)}const{type:n,dataType:s}=t.filterBarMetadata?.find(e=>e.name===this.getKey());if(n==="ValueHelp"){this.valueHelpPreview.setItems(this.items,n,s==="Edm.DateTimeOffset")}else{this.valueHelpPreview.setItems(this.items,n,s==="Edm.DateTimeOffset")}this.innerControl=this.valueHelpPreview.getControl();this.addDependent(this.innerControl);i?.removeAllContent();i?.addContent(this.innerControl);t?.getShowAllButton()?.setVisible(true);this.openPopover()};m.openPopover=function e(){const t=this.getCustomDataValue("popover");t?.setTitle(this.label);t?.openBy(this)};m.handleOkClick=function e(){if(!this.innerControl?.getDomRef()){return}const{type:t,keySpecificSelectedValues:i}=this.getCustomDataValue("TokenInfo");const n=this.getCustomDataValue("popover");let s;if(t==="Calendar"&&this.shouldOpenDefaultFragment(i)){s=this.calender?.invokeOkButtonHandler.bind(this.calender)}else if(t==="Time"&&this.shouldOpenDefaultFragment(i)){s=this.time?.invokeOkButtonHandler.bind(this.time)}else if(t==="MenuWithCheckBox"){s=this.menuWithCheckBox?.invokeOkButtonHandler.bind(this.menuWithCheckBox)}else{s=this.valueHelpPreview?.invokeOkButtonHandler.bind(this.valueHelpPreview)}if(s){s()}n?.close()};m.handleShowAllClick=function e(){if(!this.innerControl?.getDomRef()){return}const t=this.getCustomDataValue("popover");const{type:i,keySpecificSelectedValues:n}=this.getCustomDataValue("TokenInfo");t.close();let s;if(i==="Calendar"&&this.shouldOpenDefaultFragment(n)){s=this.calender?.invokeShowAllButtonHandler.bind(this.calender)}else if(i==="Time"&&this.shouldOpenDefaultFragment(n)){s=this.time?.invokeShowAllButtonHandler.bind(this.time)}else{s=this.valueHelpPreview?.invokeShowAllButtonHandler.bind(this.valueHelpPreview)}if(s){(()=>{s()})()}};m.handleAttachAfterClose=function e(){if(!this.innerControl?.getDomRef()){return}const t=this.getCustomDataValue("TokenInfo");if(t){const{type:e,keySpecificSelectedValues:t}=this.getCustomDataValue("TokenInfo");if(e==="ValueHelp"||(e==="Calendar"||e==="Time")&&!this.shouldOpenDefaultFragment(t)){this.valueHelpPreview?.invokePopupCloseHandler()}else if(e==="MenuWithCheckBox"){this.menuWithCheckBox?.invokePopupCloseHandler()}}};m.getInnerControl=function e(){return this.innerControl};m.openValueStateMessage=function e(){this.valueStateMessage?.open()};m.closeValueStateMessage=function e(){this.valueStateMessage?.close()};m.shouldOpenDefaultFragment=function e(t){const i=t.find(e=>e.operator===r.BT||e.operator===r.NB);return t.length===0||t.length===1&&t[0].selectedValues.length===1&&!i};m.focusout=function e(){this.valueStateMessage?.close()};a.render=function e(t,n){return i.renderUsingRenderManager(t,n,()=>{const e=n.getParent();const t=["sapMToken","sapFeControlsToken"];const i=["sapMTokenText","sapFeControlsTokenPropertyName"];const s=["sapMTokenText","sapFeControlsTokenPropertyValues"];const o=n.getMandatory();if(typeof e?.getEditable==="function"&&e?.getEditable()){t.push("sapFEControlsPointer")}if(n.getSelected()){t.push("sapMTokenSelected")}if(o??false){t.push("sapFeControlsTokenMandatory");if(n.getValue()===n.resourceBundle.getText("M_EASY_FILTER_MANDATORY_TOKEN_SELECT_VALUE")){s.push("sapFeControlsTokenMandatory")}}if(n.getValueState()===_.Error){t.push("sapFeTokenError")}return f("div",{ref:n,class:t.join(" "),"aria-selected":n.getSelected(),tabindex:-1,"aria-posinset":n.getProperty("posinset"),"aria-setsize":n.getProperty("setsize"),children:[f("span",{class:i.join(" "),children:[n.getLabel(),":"]}),g("span",{class:s.join(" "),children:n.getValue()}),o===true?null:n.getAggregation("deleteIcon")]})})};return a}(n),F=N(w.prototype,"label",[C],{configurable:true,enumerable:true,writable:true,initializer:null}),M=N(w.prototype,"titlePopover",[v],{configurable:true,enumerable:true,writable:true,initializer:null}),P=N(w.prototype,"value",[y],{configurable:true,enumerable:true,writable:true,initializer:null}),O=N(w.prototype,"valueStateText",[S],{configurable:true,enumerable:true,writable:true,initializer:null}),A=N(w.prototype,"mandatory",[V],{configurable:true,enumerable:true,writable:true,initializer:null}),E=N(w.prototype,"items",[b],{configurable:true,enumerable:true,writable:true,initializer:null}),H=N(w.prototype,"valueState",[k],{configurable:true,enumerable:true,writable:true,initializer:null}),x=N(w.prototype,"posinset",[D],{configurable:true,enumerable:true,writable:true,initializer:null}),W=N(w.prototype,"setsize",[T],{configurable:true,enumerable:true,writable:true,initializer:null}),w))||B);z=U;return z},false);
//# sourceMappingURL=Token.js.map