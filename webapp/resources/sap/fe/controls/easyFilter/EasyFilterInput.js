/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)
 *      (c) Copyright 2009-2025 SAP SE. All rights reserved
 */
sap.ui.define(["sap/base/Log","sap/fe/base/BindingToolkit","sap/fe/base/ClassSupport","sap/fe/base/EventDelegateHook","sap/fe/base/jsx-runtime/jsx","sap/fe/controls/easyFilter/ShellHistoryProvider","sap/m/Button","sap/m/CustomListItem","sap/m/FlexBox","sap/m/HBox","sap/m/IllustratedMessage","sap/m/IllustratedMessageSize","sap/m/IllustratedMessageType","sap/m/Input","sap/m/List","sap/m/Popover","sap/m/Text","sap/m/Title","sap/m/library","sap/ui/core/Control","sap/ui/core/CustomData","sap/ui/core/InvisibleMessage","sap/ui/core/Lib","sap/ui/core/library","./PXFeedback","sap/fe/base/jsx-runtime/jsx","sap/fe/base/jsx-runtime/jsxs"],function(e,t,s,r,i,a,n,o,l,u,c,h,p,d,v,f,g,E,I,b,y,P,m,T,_,F,S){"use strict";var L,O,x,$,C,Q,R,V,w,A,B,M,j,H,D,z,Y;var k={};var U=_.triggerPXIntegration;var q=T.ValueState;var N=T.TitleLevel;var W=T.InvisibleMessageMode;var X=I.PlacementType;var G=I.ListMode;var J=I.FlexWrap;var K=I.FlexJustifyContent;var Z=I.FlexDirection;var ee=I.FlexAlignItems;var te=I.ButtonType;var se=s.property;var re=s.event;var ie=s.defineUI5Class;var ae=s.defineState;var ne=s.aggregation;var oe=t.lessThan;var le=t.length;var ue=t.equal;var ce=t.bindState;function he(e,t,s,r){s&&Object.defineProperty(e,t,{enumerable:s.enumerable,configurable:s.configurable,writable:s.writable,value:s.initializer?s.initializer.call(r):void 0})}function pe(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e,de(e,t)}function de(e,t){return de=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},de(e,t)}function ve(e,t,s,r,i){var a={};return Object.keys(r).forEach(function(e){a[e]=r[e]}),a.enumerable=!!a.enumerable,a.configurable=!!a.configurable,("value"in a||a.initializer)&&(a.writable=!0),a=s.slice().reverse().reduce(function(s,r){return r(e,t,s)||s},a),i&&void 0!==a.initializer&&(a.value=a.initializer?a.initializer.call(i):void 0,a.initializer=void 0),void 0===a.initializer?(Object.defineProperty(e,t,a),null):a}function fe(e,t){throw Error("Decorating class property failed. Please ensure that transform-class-properties is enabled and runs after the decorators transform.")}let ge=(L=ie("sap.fe.controls.easyFilter.EasyFilterInput"),O=ne({type:"sap.m.Input",multiple:false,isDefault:true}),x=se({type:"string"}),$=se({type:"array"}),C=re(),Q=re(),R=re(),V=ae(),L(w=(A=function(t){function s(e,s){var r;r=t.call(this,e,s)||this;he(r,"$searchInput",B,r);he(r,"appId",M,r);he(r,"recommendedValues",j,r);he(r,"queryChanged",H,r);he(r,"enterPressed",D,r);he(r,"liveChange",z,r);he(r,"state",Y,r);r.initialize();return r}k=s;pe(s,t);var I=s.prototype;I.getValue=function e(){return this.$searchInput.getValue()};I.isHistoryEnabled=function e(){return this.state.isHistoryEnabled.valueOf()};I.setValue=function e(t){this.$searchInput.setValue(t);return this};I.setPlaceholder=function e(t){this.$searchInput.setPlaceholder(t);return this};I.getPlaceholder=function e(){return this.$searchInput.getPlaceholder()};I.initialize=function e(){this.state.recommendedQueries=this.recommendedValues??[];this.resourceBundle=m.getResourceBundleFor("sap.fe.controls");this.popoverInvisibleMessage=P.getInstance();this.createInput()};I.setAsInvalid=function e(t){this.$searchInput.setValueState(q.Warning);this.$searchInput.setValueStateText(t);this.$searchInput.openValueStateMessage()};I.setAsValid=function e(){this.$searchInput.setValueState(q.None);this.$searchInput.closeValueStateMessage()};I.createInput=function e(){this.$searchInput=F(d,{width:"100%",showClearIcon:true,change:e=>{this.fireEvent("queryChanged",{query:e.getParameter("value")})},liveChange:e=>{this.state.queryChanged=true;this.fireEvent("liveChange");if(!e.getSource().getValue()&&!(this.$favoritePopover?.isOpen()??false)){this.openSuggestionPopover()}if(e.getParameter("value")===""){this.setPlaceholder(this.resourceBundle.getText("M_EASY_FILTER_PLACEHOLDER"))}if(this.$searchInput.getValueState()===q.Warning){this.setAsValid()}},placeholder:this.resourceBundle.getText("M_EASY_FILTER_PLACEHOLDER")});const t=this.createFavoritePopover();this.$favoritePopover=t;this.$searchInput.addDependent(t);this.$searchInput.addEventDelegate({onkeyup:e=>{if(e.key==="Enter"){this.onEnterPressed()}if(this.$favoritePopover&&this.$searchInput.getValue()){this.$favoritePopover.close()}},onkeydown:e=>{if(e.key==="Tab"&&this.$searchInput?.getValue().length===0&&this.$searchInput?.getValue()!==this.$searchInput?.getPlaceholder()&&this.$searchInput?.getPlaceholder()!==this.resourceBundle.getText("M_EASY_FILTER_PLACEHOLDER")){e.preventDefault();this.$searchInput?.setValue(this.$searchInput?.getPlaceholder());this.fireEvent("liveChange")}else if(e.key==="ArrowDown"){const e=this.$favoritePopover?.getContent()[0];const t=e.getItems();t?.find(e=>e.isFocusable()&&(e.focus(),true))}},ontap:()=>{this.openSuggestionPopover()},onfocusin:()=>{this.openSuggestionPopover()}});this.$favoritePopover.addEventDelegate({onkeydown:e=>{const t=e.target?.outerText;const s=e.target?.id;switch(e.key){case"Enter":this.$searchInput?.setValue(t);break;case"Delete":if(s?.includes("easyFilterFavoriteItem")){this.state.favoriteQueries=this.state.favoriteQueries.filter(e=>e.toLowerCase()!==t.toLowerCase())}else{this.state.recentQueries=this.state.recentQueries.filter(e=>e!==t)}break;case"Escape":if(this.$favoritePopover?.isOpen()){this.$favoritePopover.close()}break}},onAfterRendering:()=>{this.popoverInvisibleMessage?.announce(this.resourceBundle.getText("T_EASY_FILTER_INPUT_TEXT_LINK_POPOVER_ARIA"),W.Assertive)}})};I.openSuggestionPopover=function e(){if(!this.$searchInput?.getValue()&&(!this.$favoritePopover||!this.$favoritePopover?.isOpen())){this.state.isHistoryEnabled=this.shellHistoryProvider?.isHistoryEnabled()??false;this.state.favoriteQueries=this.shellHistoryProvider?.getFavoriteQueries()??[];this.state.recentQueries=(this.shellHistoryProvider?.getRecentQueries()??[]).map(e=>e);this.$favoritePopover?.openBy(this.$searchInput)}};I.requestFavorite=function e(t){this.$favoritePopover?.close();this.$searchInput?.setValue(t.getSource().getText());this.onEnterPressed()};I.onEnterPressed=function e(){this.$favoritePopover?.close();this.state.queryChanged=false;let t=this.$searchInput?.getValue();if(t===""&&this.$searchInput.getPlaceholder()!==this.resourceBundle.getText("M_EASY_FILTER_PLACEHOLDER")){t=this.$searchInput.getPlaceholder();this.$searchInput?.setValue(t)}this.$searchInput?.setValueStateText("");this.$searchInput?.setValueState("None");this.fireEvent("enterPressed",{query:t})};I.addRecentQuery=function e(t){t=t?.replace(/\\/g,"\\\\");const s=this.state.recentQueries.findIndex(e=>e.toLowerCase()===t?.toLowerCase());if(t&&s===-1){this.state.recentQueries=[t].concat(this.state.recentQueries);if(this.state.recentQueries.length>5){this.state.recentQueries=this.state.recentQueries.slice(0,5)}}else if(t){const e=this.state.recentQueries.filter(e=>e.toLowerCase()!==t?.toLowerCase());e.unshift(t);this.state.recentQueries=e}};I.onStateChange=function e(){let t=arguments.length>0&&arguments[0]!==undefined?arguments[0]:[];if(t.includes("favoriteQueries")||t.includes("recentQueries")){this.shellHistoryProvider?.setFavoriteQueries(this.state.favoriteQueries);this.shellHistoryProvider?.setRecentQueries(this.state.recentQueries.map(e=>e));this.state.recentQueriesWitFavorites=this.state.recentQueries.map(e=>({text:e,isFavorite:!!this.state.favoriteQueries.find(t=>t===e)}))}};I.initShellHistoryProvider=async function t(){try{this.shellHistoryProvider=await a.getInstance(this.appId??"<unknownApp>")}catch(t){e.error("Error while creating ShellHistoryProvider for easy filter",t)}};I.createFavoritePopover=function e(){return F(f,{id:this.getId()+"-favoritePopover",showHeader:false,horizontalScrolling:false,placement:X.Bottom,showArrow:false,initialFocus:this.$searchInput,class:"sapFEControlsPopover",visible:this.state.recommendedQueries.length>0||ue(ce(this.state,"isHistoryEnabled"),true),children:{content:F(l,{direction:Z.Column,class:"sapUiContentPadding",renderType:"Bare",children:{items:[F(E,{titleStyle:N.H6,text:this.resourceBundle.getText("M_EASY_FILTER_POPOVER_SUGGESTIONS_TITLE"),class:"sapFeControlsTitleBorder",visible:this.state.recommendedQueries.length>0}),F(u,{class:"sapUiContentPadding",items:ce(this.state,"recommendedQueries"),wrap:J.Wrap,visible:this.state.recommendedQueries.length>0,children:{items:(e,t)=>F(n,{class:"sapUiTinyMarginEnd",text:t.getObject(),press:this.requestFavorite.bind(this)})}}),F(E,{id:this.getId()+"-easyFilterFavoriteTitle",titleStyle:N.H6,text:this.resourceBundle.getText("M_EASY_FILTER_POPOVER_FAVORITE_TITLE"),class:"sapFeControlsTitleBorder",visible:ue(ce(this.state,"isHistoryEnabled"),true)}),F(v,{items:ce(this.state,"favoriteQueries"),visible:ue(ce(this.state,"isHistoryEnabled"),true),children:{noData:F(c,{title:this.resourceBundle.getText("M_EASY_FILTER_POPOVER_EMPTY_FAVORITE_TITLE"),illustrationSize:h.ExtraSmall,illustrationType:p.NoEntries,description:this.resourceBundle.getText("M_EASY_FILTER_POPOVER_EMPTY_FAVORITE_DESCRIPTION")}),items:(e,t)=>F(o,{id:e+"-easyFilterFavoriteItem",class:"sapUiSmallMarginBegin",ariaLabelledBy:[e+"-easyFilterFavoriteTitle"],customData:[F(y,{value:t.getObject()},"text")],press:()=>{this.$searchInput.setValue(t.getObject());this.onEnterPressed()},children:S(l,{width:"100%",direction:Z.Row,alignItems:ee.Center,justifyContent:K.SpaceBetween,renderType:"Bare",id:e,children:[F(g,{text:t.getObject(),tooltip:t.getObject(),wrapping:false,class:"sapFEControlsPointer"}),F(n,{icon:"sap-icon://favorite",tooltip:this.resourceBundle.getText("M_EASY_FILTER_FILLED_STAR"),ariaLabelledBy:[this.getId()+"-easyFilterFavoriteItem"],type:te.Transparent,press:()=>{this.$favoritePopover?.focus();const e=t.getObject();const s=this.state.favoriteQueries.indexOf(e);if(s!==-1){this.state.favoriteQueries=this.state.favoriteQueries.filter(t=>t!==e)}}}),{dependents:F(r,{tap:()=>{this.$searchInput?.setValue(t.getObject().replace(/\\\\/g,"\\"));U("favorite");this.onEnterPressed()}})}]})})}}),F(E,{id:this.getId()+"-easyFilterLastUsedTitle",titleStyle:N.H6,text:this.resourceBundle.getText("M_EASY_FILTER_POPOVER_LAST_USED"),class:"sapFeControlsTitleBorder",visible:ue(ce(this.state,"isHistoryEnabled"),true)}),F(v,{items:ce(this.state,"recentQueriesWitFavorites"),visible:ue(ce(this.state,"isHistoryEnabled"),true),mode:G.Delete,delete:e=>{const t=e.getParameter("listItem");t.focus();let s=e.getParameter("listItem")?.data("text");if(!s)return;s=s?.replace(/\\/g,"\\\\");this.state.recentQueries=this.state.recentQueries.filter(e=>e!==s)},children:{noData:F(c,{title:this.resourceBundle.getText("M_EASY_FILTER_POPOVER_EMPTY_LAST_USED_TITLE"),illustrationSize:h.ExtraSmall,illustrationType:p.NoEntries,description:this.resourceBundle.getText("M_EASY_FILTER_POPOVER_EMPTY_RECENT_DESCRIPTION")}),items:(e,t)=>F(o,{id:e+"-easyFilterLastUsedItem",press:()=>{this.$searchInput?.setValue(t.getObject().text);this.onEnterPressed()},class:"sapUiSmallMarginBegin",customData:[F(y,{value:t.getObject().text},"text")],ariaLabelledBy:[e+"-easyFilterLastUsedTitle"],children:S(l,{width:"100%",direction:Z.Row,alignItems:ee.Center,justifyContent:K.SpaceBetween,renderType:"Bare",id:e,children:[F(g,{text:t.getObject().text,tooltip:t.getObject().text,wrapping:false,class:"sapFEControlsPointer"}),F(n,{icon:t.getObject().isFavorite?"sap-icon://favorite":"sap-icon://add-favorite",tooltip:t.getObject().isFavorite?this.resourceBundle.getText("M_EASY_FILTER_FILLED_STAR"):this.resourceBundle.getText("M_EASY_FILTER_EMPTY_START"),enabled:oe(le(ce(this.state,"favoriteQueries")),5),type:te.Transparent,ariaLabelledBy:[e+"-easyFilterLastUsedItem"],press:()=>{this.$favoritePopover?.focus();const e=t.getObject().text;const s=t.getObject().isFavorite;if(s){this.removeFromFavorites(e)}else{this.addToFavorites(e)}}}),{dependents:F(r,{tap:()=>{this.$searchInput?.setValue(t.getObject().text.replace(/\\\\/g,"\\"));U("recent");this.onEnterPressed()}})}]})})}})]}})}})};I.removeFromFavorites=function e(t){this.state.favoriteQueries=this.state.favoriteQueries.filter(e=>e.toLowerCase()!==t.toLowerCase())};I.addToFavorites=function e(t){const s=[t].concat(this.state.favoriteQueries.concat());if(s.length>5){s.pop()}this.state.favoriteQueries=s};s.render=function e(t,s){return i.renderUsingRenderManager(t,s,()=>F("span",{ref:s,class:"sapFEEasyFilterInput",children:s.$searchInput}))};return s}(b),B=ve(A.prototype,"$searchInput",[O],{configurable:true,enumerable:true,writable:true,initializer:null}),M=ve(A.prototype,"appId",[x],{configurable:true,enumerable:true,writable:true,initializer:null}),j=ve(A.prototype,"recommendedValues",[$],{configurable:true,enumerable:true,writable:true,initializer:null}),H=ve(A.prototype,"queryChanged",[C],{configurable:true,enumerable:true,writable:true,initializer:null}),D=ve(A.prototype,"enterPressed",[Q],{configurable:true,enumerable:true,writable:true,initializer:null}),z=ve(A.prototype,"liveChange",[R],{configurable:true,enumerable:true,writable:true,initializer:null}),Y=ve(A.prototype,"state",[V],{configurable:true,enumerable:true,writable:true,initializer:function(){return{queryChanged:false,isHistoryEnabled:false,recentQueries:[],recentQueriesWitFavorites:[],favoriteQueries:[],recommendedQueries:[]}}}),A))||w);k=ge;return k},false);
//# sourceMappingURL=EasyFilterInput.js.map