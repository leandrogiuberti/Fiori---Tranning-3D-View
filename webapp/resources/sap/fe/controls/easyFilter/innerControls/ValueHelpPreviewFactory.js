/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)
 *      (c) Copyright 2009-2025 SAP SE. All rights reserved
 */
sap.ui.define(["sap/base/Log","sap/base/util/deepClone","sap/fe/controls/easyFilter/innerControls/BaseFactory","sap/fe/controls/easyFilter/utils","sap/m/List","sap/m/StandardListItem","sap/m/library","sap/ui/core/CustomData"],function(e,t,r,o,s,a,n,i){"use strict";var l=n.ListSeparators;var u=n.ListMode;var c=r.BaseFactory;function p(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e,f(e,t)}function f(e,t){return f=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},f(e,t)}let m=function(r){function n(e,t){var o;o=r.call(this,e,t)||this;o.setControl(new s({delete:o.onDelete.bind(o),mode:u.Delete,showSeparators:l.None}));return o}p(n,r);var c=n.prototype;c.setItems=function e(t,r,s){if(o.areItemsSame(t,this.items)){return}this.items=t;const a=this.getControl();a?.destroyAggregation("items");t.forEach((e,t)=>{const{operator:n,selectedValues:i}=e;let l="";if(r==="ValueHelp"){if(o.isBetweenSelectedValues(n)){l=o.mapOperatorForBetweenOperator(n,i,r,s);this.insertItem(a,l,[t])}else{i.forEach((e,i)=>{l=o.mapOperatorForValueHelp(n,e,r,s);this.insertItem(a,l,[t,i])})}}else{if(o.isBetweenSelectedValues(n)){l=o.mapOperatorForBetweenOperator(n,i,r,s);this.insertItem(a,l,[t])}else{i.forEach((e,i)=>{l=o.mapOperator(n,e,r,s);this.insertItem(a,l,[t,i])})}}})};c.insertItem=function e(t,r,o){t?.addItem(new a({title:r,customData:new i({key:"arrayIndex",value:o})}))};c.onDelete=function e(t){const r=this.getToken()?.getCustomDataValue("popover");t.getParameter("listItem")?.setVisible(false);r.focus()};c.normalizeString=function e(t){const r=/^(>=|<=|!=|>|<)+/;return t.replace(r,"")};c.invokeOkButtonHandler=function e(){const r=this.getToken()?.getCustomDataValue("popover");const o=this.getToken();const s=this.getEasyFilter();const a=o?.getItems()?.map(e=>({operator:JSON.parse(JSON.stringify(e.operator)),selectedValues:t(e.selectedValues)}));const n=[];this.getControl()?.getItems().forEach(e=>{if(!e.getVisible()){const[t=Infinity,r=Infinity]=e?.getCustomData()?.find(e=>e?.getKey()==="arrayIndex")?.getValue()??[];if(t===Infinity||!a){return}n.push([t,r])}});n.sort((e,t)=>t[0]-e[0]||t[1]-e[1]);n.forEach(e=>{let[t,r]=e;if(a){if(r===Infinity){a.splice(t,1);return}a[t].selectedValues.splice(r,1);if(a[t].selectedValues.length===0){a.splice(t,1)}}});s.updateTokenArray("setSelectedValues",a,o?.getKey());r.close()};c.invokeShowAllButtonHandler=async function t(){const r=this.getToken();const{type:o}=r?.getCustomDataValue("TokenInfo");const s=r?.getKey();const a=r?.getItems();const n=new Promise((e,t)=>{this.getEasyFilter()?.fireEvent("showValueHelp",{key:s,values:r?.getItems()?.map(e=>{if(o==="ValueHelp"){return{operator:e.operator,selectedValues:e.selectedValues.map(e=>e.value)}}else{return e}}),resolve:e,reject:t})});try{const e=await n;if(!this.areTokenArraysEqual(a,e)){this.getEasyFilter()?.updateTokenArray("setSelectedValues",e,s)}}catch(t){if(t instanceof Error){e.error("Error while fetching new tokens",t.message)}else{e.error("Error while fetching new tokens",String(t))}}};c.normalizeTokenArray=function e(t){return t.flatMap(e=>e.selectedValues.map(t=>({operator:e.operator,value:t.value})))};c.areTokenArraysEqual=function e(t,r){const o=this.normalizeTokenArray(t).sort((e,t)=>e.value.localeCompare(t.value));const s=this.normalizeTokenArray(r).sort((e,t)=>e.value.localeCompare(t.value));if(o.length===s.length){return o.every((e,t)=>{const r=s[t];return e.operator===r.operator&&e.value===r.value})}return false};c.invokePopupCloseHandler=function e(){this.getControl()?.getItems().forEach(e=>e.setVisible(true))};return n}(c);return m},false);
//# sourceMappingURL=ValueHelpPreviewFactory.js.map