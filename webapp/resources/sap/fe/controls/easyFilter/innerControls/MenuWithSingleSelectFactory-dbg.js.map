{"version":3,"names":["MenuWithSingleSelectFactory","_BaseFactory","EFB","token","_this","ListSeparators","library","ListMode","call","selectedItemIndex","setControl","List","mode","SingleSelectMaster","showSeparators","None","selectionChange","onItemSelected","bind","_inheritsLoose","_proto","prototype","setItems","newItems","allSelectedValues","Utils","areCodeListsSame","getItems","list","getControl","items","getCodeListArray","destroyAggregation","forEach","item","idx","selectState","length","selectedValues","firstValue","value","addItem","StandardListItem","title","description","selected","customData","CustomData","key","event","selectedItem","getParameter","easyFilterBarContainer","getEasyFilter","getCustomData","find","getKey","getValue","undefined","selectedValue","operator","FilterOperator","EQ","closeInnerControlPopover","getToken","getCustomDataValue","updateTokenArray","indexOfItem","getSelectedIndex","getSelectedItems","BaseFactory"],"sourceRoot":".","sources":["MenuWithSingleSelectFactory.ts"],"sourcesContent":["import type { PrimitiveType } from \"@sap-ux/vocabularies-types/Edm\";\nimport type { EnhanceWithUI5 } from \"sap/fe/base/ClassSupport\";\nimport type { finalCodeListType } from \"sap/fe/controls/easyFilter/innerControls/BaseFactory\";\nimport { BaseFactory } from \"sap/fe/controls/easyFilter/innerControls/BaseFactory\";\nimport Utils from \"sap/fe/controls/easyFilter/utils\";\nimport List from \"sap/m/List\";\nimport type { ListBase$SelectionChangeEvent } from \"sap/m/ListBase\";\nimport StandardListItem from \"sap/m/StandardListItem\";\nimport library from \"sap/m/library\";\nimport CustomData from \"sap/ui/core/CustomData\";\nimport FilterOperator from \"sap/ui/model/FilterOperator\";\nimport type { PropertyMetadata } from \"ux/eng/fioriai/reuse/easyfilter/EasyFilter\";\nimport type EasyFilterBarContainer from \"../EasyFilterBarContainer\";\nimport type { TokenDefinition, TokenSelectedValuesDefinition } from \"../EasyFilterBarContainer\";\nimport type EasyFilterToken from \"../Token\";\n\ntype codeListType = PropertyMetadata[\"codeList\"];\n\nclass MenuWithSingleSelectFactory extends BaseFactory<List> {\n\tprivate selectedItemIndex = -1;\n\n\tconstructor(EFB: EnhanceWithUI5<EasyFilterBarContainer>, token: EnhanceWithUI5<EasyFilterToken>) {\n\t\tconst ListSeparators = library.ListSeparators;\n\t\tconst ListMode = library.ListMode;\n\n\t\tsuper(EFB, token);\n\n\t\t// Initialize the list with single-select mode.\n\t\tthis.setControl(\n\t\t\tnew List({\n\t\t\t\tmode: ListMode.SingleSelectMaster,\n\t\t\t\tshowSeparators: ListSeparators.None,\n\t\t\t\tselectionChange: this.onItemSelected.bind(this) // Attach the selection event handler.\n\t\t\t})\n\t\t);\n\t}\n\n\t/**\n\t * Sets the items for the list and initializes the selection.\n\t * @param newItems\n\t * @param allSelectedValues\n\t */\n\tasync setItems(newItems: codeListType, allSelectedValues: TokenDefinition[\"keySpecificSelectedValues\"]): Promise<void> {\n\t\tif (await Utils.areCodeListsSame(newItems, this.getItems() as codeListType)) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst list: List | undefined = this.getControl();\n\t\tthis.items = (await Utils.getCodeListArray(newItems)) as finalCodeListType[];\n\t\tlist?.destroyAggregation(\"items\");\n\t\tthis.selectedItemIndex = -1;\n\n\t\tthis.items.forEach((item, idx) => {\n\t\t\tlet selectState = false;\n\n\t\t\t// Check if the item matches any preselected value.\n\t\t\tif (allSelectedValues.length > 0 && allSelectedValues[0].selectedValues.length > 0) {\n\t\t\t\tconst firstValue = allSelectedValues[0].selectedValues[0];\n\t\t\t\tif (typeof firstValue === typeof item.value && firstValue === item.value) {\n\t\t\t\t\tselectState = true;\n\t\t\t\t\tthis.selectedItemIndex = idx;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// Add item to the list with the appropriate selection state.\n\t\t\tlist?.addItem(\n\t\t\t\tnew StandardListItem({\n\t\t\t\t\ttitle: item.description,\n\t\t\t\t\tselected: selectState,\n\t\t\t\t\tcustomData: [\n\t\t\t\t\t\tnew CustomData({\n\t\t\t\t\t\t\tkey: \"value\",\n\t\t\t\t\t\t\tvalue: item.value\n\t\t\t\t\t\t})\n\t\t\t\t\t]\n\t\t\t\t})\n\t\t\t);\n\t\t});\n\t}\n\n\t/**\n\t * Event handler for item selection.\n\t * Directly triggers the token update when an item is selected.\n\t * @param event\n\t */\n\tprivate onItemSelected(event: ListBase$SelectionChangeEvent): void {\n\t\tconst selectedItem = event.getParameter(\"listItem\");\n\t\tconst list: List | undefined = this.getControl();\n\t\tconst easyFilterBarContainer = this.getEasyFilter() as EasyFilterBarContainer;\n\n\t\tif (!selectedItem || !list) {\n\t\t\treturn;\n\t\t}\n\n\t\t// Get the value of the selected item.\n\t\tconst value: PrimitiveType = selectedItem\n\t\t\t.getCustomData()\n\t\t\t.find((customData: CustomData) => customData.getKey() === \"value\")\n\t\t\t?.getValue() as string | number | boolean;\n\n\t\tif (value !== undefined) {\n\t\t\t// Prepare the selected values definition.\n\t\t\tconst selectedValue: TokenSelectedValuesDefinition[] = [\n\t\t\t\t{\n\t\t\t\t\toperator: FilterOperator.EQ,\n\t\t\t\t\tselectedValues: [value]\n\t\t\t\t}\n\t\t\t];\n\n\t\t\teasyFilterBarContainer?.closeInnerControlPopover();\n\n\t\t\t// Get the key of the token and update the token array.\n\t\t\tconst { key } = this.getToken()?.getCustomDataValue(\"TokenInfo\") as TokenDefinition;\n\t\t\teasyFilterBarContainer.updateTokenArray(\"setSelectedValues\", selectedValue, key);\n\n\t\t\t// Update the selected item index for internal tracking.\n\t\t\tthis.selectedItemIndex = list.indexOfItem(selectedItem);\n\t\t}\n\t}\n\n\t//Retrieves the index of the currently selected item.\n\tgetSelectedIndex(): number {\n\t\tconst selectedItem: StandardListItem | undefined = this.getControl()?.getSelectedItems()?.[0] as StandardListItem;\n\n\t\treturn selectedItem ? this.getControl()?.indexOfItem(selectedItem) ?? -1 : -1;\n\t}\n}\n\nexport default MenuWithSingleSelectFactory;\n"],"mappings":"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","ignoreList":[],"file":"MenuWithSingleSelectFactory-dbg.js"}