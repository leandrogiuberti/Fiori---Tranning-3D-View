/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)
 *      (c) Copyright 2009-2025 SAP SE. All rights reserved
 */
sap.ui.define(["sap/base/Log","sap/fe/base/ClassSupport","sap/fe/base/jsx-runtime/jsx","sap/fe/controls/easyFilter/Token","sap/m/Button","sap/m/FlexBox","sap/m/Popover","sap/m/Tokenizer","sap/m/VBox","sap/m/library","sap/ui/core/Control","sap/ui/core/CustomData","sap/ui/core/Lib","sap/ui/core/library","sap/base/util/deepClone","sap/fe/base/BindingToolkit","sap/fe/controls/easyFilter/EasyFilterInput","sap/m/HBox","sap/m/MessageStrip","sap/m/MessageToast","sap/m/OverflowToolbar","sap/m/ToggleButton","sap/m/ToolbarSpacer","sap/ui/core/message/MessageType","sap/ui/model/FilterOperator","sap/ui/performance/trace/FESRHelper","./AINotice","./PXFeedback","./utils","sap/fe/base/jsx-runtime/jsx","sap/fe/base/jsx-runtime/Fragment","sap/fe/base/jsx-runtime/jsxs"],function(e,t,s,r,i,n,a,o,l,u,c,h,p,d,f,y,b,g,m,S,k,T,E,v,P,B,F,M,w,V,C,I){"use strict";var _,x,R,z,A,L,U,D,O,j,q,H,K,Y,N,G,W,Q,J,X,$,Z,ee,te,se,re,ie,ne,ae,oe,le,ue,ce,he,pe;function de(e){return new Promise((t,s)=>{sap.ui.require([e],s=>{if(!(s&&s.__esModule)){s=s===null||!(typeof s==="object"&&e.endsWith("/library"))?{default:s}:s;Object.defineProperty(s,"__esModule",{value:true})}t(s)},e=>{s(e)})})}var fe={};var ye=M.triggerPXIntegration;var be=F.AINotice;var ge=y.bindState;var me=y.and;var Se=d.ValueState;var ke=u.TokenizerRenderMode;var Te=u.PlacementType;var Ee=u.FlexWrap;var ve=u.FlexJustifyContent;var Pe=u.FlexAlignItems;var Be=u.ButtonType;var Fe=t.property;var Me=t.event;var we=t.defineUI5Class;var Ve=t.defineState;var Ce=t.defineReference;var Ie=t.createReference;var _e=t.aggregation;function xe(e,t,s,r){s&&Object.defineProperty(e,t,{enumerable:s.enumerable,configurable:s.configurable,writable:s.writable,value:s.initializer?s.initializer.call(r):void 0})}function Re(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e,ze(e,t)}function ze(e,t){return ze=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},ze(e,t)}function Ae(e,t,s,r,i){var n={};return Object.keys(r).forEach(function(e){n[e]=r[e]}),n.enumerable=!!n.enumerable,n.configurable=!!n.configurable,("value"in n||n.initializer)&&(n.writable=!0),n=s.slice().reverse().reduce(function(s,r){return r(e,t,s)||s},n),i&&void 0!==n.initializer&&(n.value=n.initializer?n.initializer.call(i):void 0,n.initializer=void 0),void 0===n.initializer?(Object.defineProperty(e,t,n),null):n}function Le(e,t){throw Error("Decorating class property failed. Please ensure that transform-class-properties is enabled and runs after the decorators transform.")}let Ue=(_=we("sap.fe.controls.easyFilter.EasyFilterBarContainer"),x=Fe({type:"string"}),R=Fe({type:"string"}),z=Fe({type:"string"}),A=Fe({type:"array"}),L=Fe({type:"array"}),U=Fe({type:"function"}),D=Ce(),O=Ce(),j=_e({type:"sap.ui.core.Control"}),q=Me(),H=Me(),K=Me(),Y=Me(),N=Me(),G=Me(),W=Ve(),_(Q=(J=function(t){function u(e,s){var r;r=t.call(this,e,s)||this;xe(r,"contextPath",X,r);xe(r,"appId",$,r);xe(r,"easyFilterLib",Z,r);xe(r,"filterBarMetadata",ee,r);xe(r,"recommendedValues",te,r);xe(r,"dataFetcher",se,r);xe(r,"easyFilterInput",re,r);xe(r,"tokenizer",ie,r);xe(r,"content",ne,r);xe(r,"tokensChanged",ae,r);xe(r,"queryChanged",oe,r);xe(r,"showValueHelp",le,r);xe(r,"clearFilters",ue,r);xe(r,"beforeQueryProcessing",ce,r);xe(r,"afterQueryProcessing",he,r);xe(r,"state",pe,r);r.shouldTokenChangeEventFired=true;r.inputFieldReady=new Promise(e=>{r.resolveContentReady=e});r.initialize();return r}fe=u;Re(u,t);var c=u.prototype;c.setEasyFilterLib=function e(t){this.setProperty("easyFilterLib",t);if(this.easyFilterLib){this.easyfilter=de(this.easyFilterLib)}};c.setAppId=async function e(t){if(!this.appId){this.setProperty("appId",t,true);await this.inputFieldReady;this.easyFilterInput.current?.setProperty("appId",t,true);await(this.easyFilterInput.current?.initShellHistoryProvider())}};c.setFilterBarMetadata=function e(t){if(!this.filterBarMetadata){this.setProperty("filterBarMetadata",t,true);const e=this.getDefaultTokens();if(!this.innerControlPopover){this.innerControlPopover=this.createPopoverForInnerControls();this.addDependent(this.innerControlPopover)}this.state.tokens=e;this.state.showResult=e.length>0;this.isMandatoryCheckRequired=true;this.shouldTokenChangeEventFired=false}};c.init=function e(){this.resourceBundle=p.getResourceBundleFor("sap.fe.controls")};c.initialize=function e(){this.content=this.createContent();this.resolveContentReady();if(!this.innerControlPopover){this.innerControlPopover=this.createPopoverForInnerControls();this.addDependent(this.innerControlPopover)}this.isMandatoryCheckRequired=true;this.shouldTokenChangeEventFired=false};c.getDefaultTokens=function e(){const t=[];if(!this.mandatoryKeyMap){this.mandatoryKeyMap={}}this.filterBarMetadata?.forEach(e=>{const s=e.required;if(s){this.mandatoryKeyMap[e.name]=true;if(e.type==="ValueHelp"){t.push({key:e.name,label:e.label,keySpecificSelectedValues:e.defaultValue??[],type:e.type,busy:false,isRequired:s})}else{t.push({key:e.name,label:e.label,keySpecificSelectedValues:e.defaultValue??[],type:e.type,busy:false,isRequired:s})}}});return t};c.onEnterPressed=function e(t){this.onGoPress(t.getParameter("query"))};c.checkIfAllMandatoryTokensFilled=function e(){const t=this.getUnSetMandatoryTokensInCurrentState();if(t.length!==0){const e=this.getActualTokensFromState(t);e?.forEach(e=>{e.setProperty("valueState",Se.Error);e.setProperty("valueStateText",this.resourceBundle.getText("M_EASY_FILTER_MANDATORY_TOKEN_ERROR"));e.openValueStateMessage()});return false}return true};c.closeAllMandatoryValueStateMessages=function e(){const t=this.tokenizer.current?.getTokens();t.forEach(e=>e.closeValueStateMessage())};c.onGoPress=async function t(s){if(!s){this.resetState();return}this.state.tokenizerEditable=true;const r=await this.easyfilter;if(!r){return}this.fireEvent("beforeQueryProcessing");const i={version:1,entitySet:this.contextPath,fields:this.filterBarMetadata};const n=await r.easyFilter(s,i);if(n.success){if(this.easyFilterInput.current?.isHistoryEnabled()??false){this.easyFilterInput.current?.addRecentQuery(s)}if(n.data.version===1){this.handleV1Success(n)}else if(n.data.version===2){}}else{this.removeNonMandatoryTokens();this.setMessageStrip(n.message);this.state.messageStripType=v.Warning;e.error("Error while generating filter criteria: ",n.message)}this.fireEvent("afterQueryProcessing")};c.handleV1Success=function t(s){if(s.data.filter){e.debug("Filter criteria generated: ",JSON.stringify(s.data.filter,null,2));const t=[...this.state.tokens].filter(e=>e.isRequired);this.clearMessageStrip();w.formatData(t,s.data.filter,this.filterBarMetadata,this.setMessageStrip.bind(this));const r=t.filter(e=>e.type==="ValueHelp");const i=r.filter(e=>s.data.filter?.find(t=>t.name===e.key));if(this.dataFetcher){i.forEach(async e=>{const t=await(this.dataFetcher?.(e.key,e.keySpecificSelectedValues,s));e.busy=false;if(t){e.keySpecificSelectedValues=t;this.state.showResult=true;this.state.tokens=n}})}else{i.forEach(e=>{e.busy=false;e.keySpecificSelectedValues.forEach((t,s)=>{if(t.operator===P.BT||t.operator===P.NB){e.keySpecificSelectedValues[s].selectedValues=[{value:t.selectedValues[0],description:t.selectedValues[0]},{value:t.selectedValues[1],description:t.selectedValues[1]}]}else{e.keySpecificSelectedValues[s].selectedValues.forEach((t,r)=>{e.keySpecificSelectedValues[s].selectedValues[r]={value:t,description:t}})}})})}const n=this.verifySingleSelectTokenValues(t);this.state.showResult=true;this.state.thumbButtonEnabled=true;this.state.thumbDownButtonPressed=false;this.state.thumbUpButtonPressed=false;this.state.tokens=n}};c.verifySingleSelectTokenValues=function e(t){const s=[];t.forEach(e=>{if(e.type==="MenuWithSingleSelect"){if(e.keySpecificSelectedValues[0].selectedValues.length>1){s.push(e.label);e.keySpecificSelectedValues[0].selectedValues.splice(1)}}});if(s.length){this.state.singleValueMessageStripText=this.resourceBundle.getText("M_EASY_FILTER_SINGLE_VALUE_MESSAGE",[`<strong>${s.join(", ")}</strong>`]);this.state.showSingleValueMessageStrip=true}return t};c.clearMessageStrip=function e(){this.state.thumbDownButtonPressed=false;this.state.thumbUpButtonPressed=false;this.state.showMessageStrip=false;this.state.messageStripText="";this.state.messageStripType=v.Error};c.setMessageStrip=function e(t){this.state.thumbDownButtonPressed=false;this.state.thumbUpButtonPressed=false;this.state.thumbButtonEnabled=true;this.state.messageStripText=t;this.state.showMessageStrip=true};c.createPopoverForInnerControls=function e(){if(!this.innerControlPopover){this.innerControlPopover=V(a,{id:this.getId()+"-innerPopover",showArrow:false,showHeader:true,placement:Te.Bottom,class:"sapUiMediumMarginBottom",children:{footer:this.getToolbar()}})}return this.innerControlPopover};c.getToolbar=function e(){if(!this.toolbar){const e=this.getOkButton();const t=this.getShowAllButton();this.toolbar=V(k,{children:{content:I(C,{children:[V(E,{}),e,t]})}})}return this.toolbar};c.getOkButton=function e(){if(!this.okButton){this.okButton=V(i,{text:this.resourceBundle.getText("M_EASY_FILTER_POPOVER_OK"),type:Be.Emphasized})}return this.okButton};c.getShowAllButton=function e(){if(!this.showAllButton){this.showAllButton=V(i,{text:this.resourceBundle.getText("M_EASY_FILTER_POPOVER_SHOW_ALL_ITEMS")})}return this.showAllButton};c.formatTokens=function e(t){return t.map(e=>{if(e.type==="ValueHelp"){return{...e,keySpecificSelectedValues:e.keySpecificSelectedValues.map(e=>({operator:e.operator,selectedValues:e.selectedValues.map(e=>e.value)}))}}else{return f(e)}})};c.onStateChange=function e(){let t=arguments.length>0&&arguments[0]!==undefined?arguments[0]:[];if(t.includes("tokens")){if(this.shouldTokenChangeEventFired){this.fireEvent("tokensChanged",{tokens:this.formatTokens(this.state.tokens)})}this.state.showResult=this.state.tokens.length>0;if(!(this.isMandatoryCheckRequired??false)){this.checkIfAllMandatoryTokensFilled()}}this.isMandatoryCheckRequired=false;this.shouldTokenChangeEventFired=true;(this.tokenizer?.current).onsapfocusleave=()=>{}};c.onThumbUpPressed=function e(){this.state.thumbUpButtonPressed=true;this.state.thumbDownButtonPressed=false;ye("thumbUp");this.onThumbPressed()};c.onThumbDownPressed=function e(){this.state.thumbDownButtonPressed=true;this.state.thumbUpButtonPressed=false;ye("thumbDown");this.onThumbPressed()};c.onThumbPressed=function e(){this.state.thumbButtonEnabled=false;S.show(this.resourceBundle.getText("C_EASY_FILTER_FEEDBACK_SENT"))};c.createContent=function e(){const t=Ie();const s=V(T,{icon:"sap-icon://thumb-up",tooltip:this.resourceBundle.getText("C_EASY_FILTER_THUMBS_UP"),type:"Transparent",press:()=>this.onThumbUpPressed(),enabled:ge(this.state,"thumbButtonEnabled"),pressed:ge(this.state,"thumbUpButtonPressed")});B.setSemanticStepname(s,"press","fe4:eft:t:thumbUp");const a=V(T,{icon:"sap-icon://thumb-down",tooltip:this.resourceBundle.getText("C_EASY_FILTER_THUMBS_DOWN"),type:"Transparent",press:()=>this.onThumbDownPressed(),enabled:ge(this.state,"thumbButtonEnabled"),pressed:ge(this.state,"thumbDownButtonPressed")});B.setSemanticStepname(a,"press","fe4:eft:t:thumbDown");const u=V(T,{icon:"sap-icon://thumb-up",tooltip:this.resourceBundle.getText("C_EASY_FILTER_THUMBS_UP"),type:"Transparent",press:()=>this.onThumbUpPressed(),enabled:ge(this.state,"thumbButtonEnabled"),pressed:ge(this.state,"thumbUpButtonPressed")});B.setSemanticStepname(u,"press","fe4:eft:ms:thumbUp");const c=V(T,{icon:"sap-icon://thumb-down",tooltip:this.resourceBundle.getText("C_EASY_FILTER_THUMBS_DOWN"),type:"Transparent",press:()=>this.onThumbDownPressed(),enabled:ge(this.state,"thumbButtonEnabled"),pressed:ge(this.state,"thumbDownButtonPressed")});B.setSemanticStepname(c,"press","fe4:eft:ms:thumbDown");const p=I(l,{children:[I(n,{renderType:"Bare",children:[V(b,{recommendedValues:this.recommendedValues,ref:this.easyFilterInput,enterPressed:this.onEnterPressed.bind(this),queryChanged:e=>{this.fireEvent("queryChanged",{query:e.getParameter("query")})},liveChange:()=>{this.state.tokenizerEditable=false}}),V(i,{icon:"sap-icon://ai",class:"sapUiSmallMarginBegin",ref:t,text:this.resourceBundle.getText("M_EASY_FILTER_GO"),type:Be.Emphasized,press:this.onGoButtonPress.bind(this)})]}),V(n,{renderType:"Bare",visible:ge(this.state,"showResult"),alignItems:Pe.Center,wrap:Ee.Wrap,justifyContent:ve.SpaceBetween,class:"sapUiTinyMarginTop",children:I(n,{class:"sapFeControlsGap8px",renderType:"Bare",alignItems:Pe.Center,wrap:Ee.Wrap,children:[V(be,{resourceBundle:this.resourceBundle}),V(o,{editable:me(ge(this.state,"tokenizerEditable"),true),class:"sapFeControlsTokenizer",tokens:ge(this.state,"tokens"),renderMode:ke.Loose,ref:this.tokenizer,children:{tokens:(e,t)=>{const s=t.getObject();return V(r,{label:this.state.tokens.label,items:this.state.tokens.keySpecificSelectedValues,mandatory:this.isKeyMandatory(s.key),busy:this.state.tokens.busy,delete:()=>{const e=this.state.tokens.findIndex(e=>e.key===s.key);const t=this.state.tokens.concat();t.splice(e,1);this.state.tokens=t;this.updateFilterInput("tokenUpdated")},children:{customData:[V(h,{value:s},"TokenInfo"),V(h,{value:this.innerControlPopover},"popover"),V(h,{value:this},"easyFilterBarContainer"),V(h,{value:this.filterBarMetadata?.find(e=>e.name===s.key)?.codeList},"codeList")]}},this.state.tokens.key)}}}),I(g,{children:[s,", ",a]}),V(i,{text:this.resourceBundle.getText("M_EASY_FILTER_RESET"),type:Be.Transparent,press:()=>{this.resetState();this.easyFilterInput.current?.$searchInput.focus()}})]})}),V(n,{renderType:"Bare",children:V(m,{text:ge(this.state,"singleValueMessageStripText"),showIcon:true,enableFormattedText:true,visible:ge(this.state,"showSingleValueMessageStrip"),showCloseButton:true,close:()=>{this.state.showSingleValueMessageStrip=false;this.state.singleValueMessageStripText=""}})}),I(n,{renderType:"Bare",class:"sapFeControlsGap8px",children:[V(m,{type:ge(this.state,"messageStripType"),text:ge(this.state,"messageStripText"),showIcon:true,enableFormattedText:true,showCloseButton:true,close:()=>{this.clearMessageStrip()},visible:ge(this.state,"showMessageStrip")}),I(g,{visible:ge(this.state,"showMessageStrip"),children:[u,", ",c]})]})]});B.setSemanticStepname(t.current,"press","fe:ai:search");return p};c.onGoButtonPress=async function e(){this.state.tokenizerEditable=true;let t=this.easyFilterInput.current?.getValue();const s=this.easyFilterInput.current?.getPlaceholder();if(t===""&&s!==this.resourceBundle.getText("M_EASY_FILTER_PLACEHOLDER")){this.easyFilterInput.current?.setValue(s||"");t=s}await this.onGoPress(t)};c.resetState=function e(){let t=arguments.length>0&&arguments[0]!==undefined?arguments[0]:true;if(t){this.fireEvent("clearFilters")}else{this.shouldTokenChangeEventFired=false}this.state.tokens=this.getDefaultTokens();this.updateFilterInput("tokenReset");this.state.tokenizerEditable=true;this.isMandatoryCheckRequired=true;this.tokenizer.current?.getTokens().forEach(e=>e.setProperty("valueState",Se.None));this.tokenizer.current?.getTokens().forEach(e=>e.setProperty("valueStateText",null));this.clearMessageStrip()};c.updateTokenArray=function t(s,r,i){const n=this.state.tokens.map(e=>({...e,keySpecificSelectedValues:[...e.keySpecificSelectedValues]}));const a=n.findIndex(e=>e.key===i);const o=n[a];if(a!=-1){switch(s){case"setSelectedValues":this.setSelectedValues(o,r,a,n);o.keySpecificSelectedValues=r;if(!this.isKeyMandatory(o.key)&&o.keySpecificSelectedValues.length===0){n.splice(a,1)}break;default:e.error("Specifying a setter that is out of the boundary");break}this.state.tokens=n;this.state.showResult=n.length>0;this.updateFilterInput("tokenUpdated")}};c.closeInnerControlPopover=function e(){this.innerControlPopover?.close()};c.setSelectedValues=function e(t,s,r,i){t.keySpecificSelectedValues=s;if(!this.isKeyMandatory(t.key)&&t.keySpecificSelectedValues.length===0){i.splice(r,1)}};c.isKeyMandatory=function e(t){if(!this.mandatoryKeyMap){this.mandatoryKeyMap={}}return this.mandatoryKeyMap[t]?true:false};c.removeNonMandatoryTokens=function e(){const t=this.state.tokens.filter(e=>this.isKeyMandatory(e.key));this.state.tokens=t;return this};c.updateFilterInput=function e(t){const s=this.easyFilterInput.current?.getValue()||"";if(t==="tokenUpdated"&&s!==""){this.easyFilterInput.current?.setValue("");this.easyFilterInput.current?.setPlaceholder(s)}else if(t==="tokenReset"){this.easyFilterInput.current?.setValue("");this.easyFilterInput.current?.setPlaceholder(this.resourceBundle.getText("M_EASY_FILTER_PLACEHOLDER"))}};c.getTokensInInitialState=function e(){const t=this.state.tokens.map(e=>({...e,keySpecificSelectedValues:[...e.keySpecificSelectedValues]}));const s=t.filter(e=>{if(this.isKeyMandatory(e.key)){return true}});return s.map(e=>({...e,keySpecificSelectedValues:[]}))};c.getUnSetMandatoryTokensInCurrentState=function e(){return this.state.tokens.filter(e=>{const t=this.isKeyMandatory(e.key);if(t){return e.keySpecificSelectedValues.length===0}})};c.getActualTokensFromState=function e(t){const s=t.map(e=>e.key);return this.tokenizer.current?.getTokens().filter(e=>s.includes(e.getKey()))};u.render=function e(t,r){return s.renderUsingRenderManager(t,r,()=>V("span",{ref:r,children:r.getAggregation("content")}))};return u}(c),X=Ae(J.prototype,"contextPath",[x],{configurable:true,enumerable:true,writable:true,initializer:null}),$=Ae(J.prototype,"appId",[R],{configurable:true,enumerable:true,writable:true,initializer:null}),Z=Ae(J.prototype,"easyFilterLib",[z],{configurable:true,enumerable:true,writable:true,initializer:null}),ee=Ae(J.prototype,"filterBarMetadata",[A],{configurable:true,enumerable:true,writable:true,initializer:null}),te=Ae(J.prototype,"recommendedValues",[L],{configurable:true,enumerable:true,writable:true,initializer:null}),se=Ae(J.prototype,"dataFetcher",[U],{configurable:true,enumerable:true,writable:true,initializer:null}),re=Ae(J.prototype,"easyFilterInput",[D],{configurable:true,enumerable:true,writable:true,initializer:null}),ie=Ae(J.prototype,"tokenizer",[O],{configurable:true,enumerable:true,writable:true,initializer:null}),ne=Ae(J.prototype,"content",[j],{configurable:true,enumerable:true,writable:true,initializer:null}),ae=Ae(J.prototype,"tokensChanged",[q],{configurable:true,enumerable:true,writable:true,initializer:null}),oe=Ae(J.prototype,"queryChanged",[H],{configurable:true,enumerable:true,writable:true,initializer:null}),le=Ae(J.prototype,"showValueHelp",[K],{configurable:true,enumerable:true,writable:true,initializer:null}),ue=Ae(J.prototype,"clearFilters",[Y],{configurable:true,enumerable:true,writable:true,initializer:null}),ce=Ae(J.prototype,"beforeQueryProcessing",[N],{configurable:true,enumerable:true,writable:true,initializer:null}),he=Ae(J.prototype,"afterQueryProcessing",[G],{configurable:true,enumerable:true,writable:true,initializer:null}),pe=Ae(J.prototype,"state",[W],{configurable:true,enumerable:true,writable:true,initializer:function(){return{showResult:false,tokens:[],tokenizerEditable:true,showSingleValueMessageStrip:false,singleValueMessageStripText:"",messageStripText:"",showMessageStrip:false,messageStripType:v.Error,thumbButtonEnabled:true,thumbUpButtonPressed:false,thumbDownButtonPressed:false}}}),J))||Q);fe=Ue;return fe},false);
//# sourceMappingURL=EasyFilterBarContainer.js.map