/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)
 *      (c) Copyright 2009-2025 SAP SE. All rights reserved
 */
sap.ui.define(["sap/base/Log", "sap/ui/core/Lib", "sap/ui/core/UIComponent", "sap/ui/core/cache/CacheManager", "sap/ui/core/mvc/View", "sap/ui/core/mvc/ViewType", "sap/ui/model/json/JSONModel", "sap/ui/model/resource/ResourceModel"], function (Log, Lib, UIComponent, CacheManager, View, ViewType, JSONModel, i18nModel) {
  "use strict";

  function _inheritsLoose(t, o) { t.prototype = Object.create(o.prototype), t.prototype.constructor = t, _setPrototypeOf(t, o); }
  function _setPrototypeOf(t, e) { return _setPrototypeOf = Object.setPrototypeOf ? Object.setPrototypeOf.bind() : function (t, e) { return t.__proto__ = e, t; }, _setPrototypeOf(t, e); }
  let RequestSettingsComponent = /*#__PURE__*/function (_UIComponent) {
    function RequestSettingsComponent() {
      return _UIComponent.apply(this, arguments) || this;
    }
    _inheritsLoose(RequestSettingsComponent, _UIComponent);
    var _proto = RequestSettingsComponent.prototype;
    _proto.getWaitInit = async function getWaitInit() {
      return this.waitInit;
    };
    _proto.asyncInit = async function asyncInit() {
      let resolveFunction;
      _UIComponent.prototype.init.call(this);
      this.waitInit = new Promise(resolve => {
        resolveFunction = resolve;
      });
      try {
        await Lib.load({
          name: "sap.fe.controls"
        });
      } catch (error) {
        Log.debug('"Error loading sap.fe.controls library", error');
      }
      const container = sap.ui.require("sap/ushell/Container");
      const personalizationService = await container.getServiceAsync("PersonalizationV2");
      this.model = new JSONModel({});
      this.personalizationService = personalizationService;
      this.scope = {
        clientStorageAllowed: false,
        keyCategory: personalizationService.constants.keyCategory.FIXED_KEY,
        validity: "Infinity",
        writeFrequency: personalizationService.constants.writeFrequency.LOW
      };
      this.personalizationId = {
        container: "sap.ushell.optimisticreq.personalization",
        item: "data"
      };
      const period = await this._getPersonalizedPeriod(personalizationService);
      // Remove old managecache entries via cache manager
      const timeStamp = new Date(Date.now() - period * 86400000);
      const filters = {
        olderThan: timeStamp,
        prefix: "sap.ui.model.odata.v4.managecache"
      };
      CacheManager.delWithFilters(filters);
      // Enhance user activities section with optimistic batch settings
      await this._createActivitiesSection();
      resolveFunction();
    };
    _proto.init = function init() {
      this.asyncInit().catch(err => {
        Log.error(err.message);
      });
    };
    _proto._getPersonalizedPeriod = async function _getPersonalizedPeriod(personalizationService) {
      const personalizer = await personalizationService.getPersonalizer(this.personalizationId, this.scope);
      const personalizationContainer = await personalizer.getPersData();
      // Use personalization service to get/set period
      let period = personalizationContainer?.period;
      period ??= 30;
      this.model.setProperty("/period", period);
      this.model.setProperty("/oldperiod", period);
      return period;
    };
    _proto._setPersonalizedPeriod = async function _setPersonalizedPeriod(personalizationService, period) {
      const personalizer = await personalizationService.getPersonalizer(this.personalizationId, this.scope);
      return personalizer.setPersData(period);
    };
    _proto._createActivitiesSection = async function _createActivitiesSection() {
      const i18n = new i18nModel({
        bundleName: "sap.fe.plugins.managecache.comp.i18n.messagebundle"
      });
      const viewType = ViewType.XML;
      const viewSettings = {
        type: viewType,
        id: "requestCacheView",
        viewName: "sap.fe.plugins.managecache.comp.view.settings"
      };
      const container = sap.ui.require("sap/ushell/Container");
      const frameBoundExtension = await container.getServiceAsync("FrameBoundExtension");
      await frameBoundExtension.addGroupedUserSettingsEntry({
        title: i18n.getResourceBundle().getText("T_GROUP"),
        icon: "sap-icon://laptop",
        entryHelpId: "userActivitiesEntry",
        groupingId: "userActivities",
        groupingTabTitle: i18n.getResourceBundle().getText("title"),
        groupingTabHelpId: "requestCacheUserActivities-helpId",
        value: async function () {
          return Promise.resolve("Request Cache"); //check
        },
        content: async () => {
          return View.create(viewSettings).then(view => {
            view.setModel(this.model);
            view.setModel(i18n, "i18n");
            this.viewInstance = view;
            return this.viewInstance;
          });
        },
        onSave: async () => {
          const period = this.model.getProperty("/period");
          await this._setPersonalizedPeriod(this.personalizationService, {
            period: period
          });
          return this.viewInstance.getController().onSave(period);
        },
        onCancel: () => {
          return this.viewInstance.getController().onCancel();
        }
      });
    };
    return RequestSettingsComponent;
  }(UIComponent);
  return RequestSettingsComponent;
}, false);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJSZXF1ZXN0U2V0dGluZ3NDb21wb25lbnQiLCJfVUlDb21wb25lbnQiLCJhcHBseSIsImFyZ3VtZW50cyIsIl9pbmhlcml0c0xvb3NlIiwiX3Byb3RvIiwicHJvdG90eXBlIiwiZ2V0V2FpdEluaXQiLCJ3YWl0SW5pdCIsImFzeW5jSW5pdCIsInJlc29sdmVGdW5jdGlvbiIsImluaXQiLCJjYWxsIiwiUHJvbWlzZSIsInJlc29sdmUiLCJMaWIiLCJsb2FkIiwibmFtZSIsImVycm9yIiwiTG9nIiwiZGVidWciLCJjb250YWluZXIiLCJzYXAiLCJ1aSIsInJlcXVpcmUiLCJwZXJzb25hbGl6YXRpb25TZXJ2aWNlIiwiZ2V0U2VydmljZUFzeW5jIiwibW9kZWwiLCJKU09OTW9kZWwiLCJzY29wZSIsImNsaWVudFN0b3JhZ2VBbGxvd2VkIiwia2V5Q2F0ZWdvcnkiLCJjb25zdGFudHMiLCJGSVhFRF9LRVkiLCJ2YWxpZGl0eSIsIndyaXRlRnJlcXVlbmN5IiwiTE9XIiwicGVyc29uYWxpemF0aW9uSWQiLCJpdGVtIiwicGVyaW9kIiwiX2dldFBlcnNvbmFsaXplZFBlcmlvZCIsInRpbWVTdGFtcCIsIkRhdGUiLCJub3ciLCJmaWx0ZXJzIiwib2xkZXJUaGFuIiwicHJlZml4IiwiQ2FjaGVNYW5hZ2VyIiwiZGVsV2l0aEZpbHRlcnMiLCJfY3JlYXRlQWN0aXZpdGllc1NlY3Rpb24iLCJjYXRjaCIsImVyciIsIm1lc3NhZ2UiLCJwZXJzb25hbGl6ZXIiLCJnZXRQZXJzb25hbGl6ZXIiLCJwZXJzb25hbGl6YXRpb25Db250YWluZXIiLCJnZXRQZXJzRGF0YSIsInNldFByb3BlcnR5IiwiX3NldFBlcnNvbmFsaXplZFBlcmlvZCIsInNldFBlcnNEYXRhIiwiaTE4biIsImkxOG5Nb2RlbCIsImJ1bmRsZU5hbWUiLCJ2aWV3VHlwZSIsIlZpZXdUeXBlIiwiWE1MIiwidmlld1NldHRpbmdzIiwidHlwZSIsImlkIiwidmlld05hbWUiLCJmcmFtZUJvdW5kRXh0ZW5zaW9uIiwiYWRkR3JvdXBlZFVzZXJTZXR0aW5nc0VudHJ5IiwidGl0bGUiLCJnZXRSZXNvdXJjZUJ1bmRsZSIsImdldFRleHQiLCJpY29uIiwiZW50cnlIZWxwSWQiLCJncm91cGluZ0lkIiwiZ3JvdXBpbmdUYWJUaXRsZSIsImdyb3VwaW5nVGFiSGVscElkIiwidmFsdWUiLCJjb250ZW50IiwiVmlldyIsImNyZWF0ZSIsInRoZW4iLCJ2aWV3Iiwic2V0TW9kZWwiLCJ2aWV3SW5zdGFuY2UiLCJvblNhdmUiLCJnZXRQcm9wZXJ0eSIsImdldENvbnRyb2xsZXIiLCJvbkNhbmNlbCIsIlVJQ29tcG9uZW50Il0sInNvdXJjZVJvb3QiOiIuIiwic291cmNlcyI6WyJDb21wb25lbnQudHMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IExvZyBmcm9tIFwic2FwL2Jhc2UvTG9nXCI7XG5pbXBvcnQgdHlwZSBSZXNvdXJjZUJ1bmRsZSBmcm9tIFwic2FwL2Jhc2UvaTE4bi9SZXNvdXJjZUJ1bmRsZVwiO1xuaW1wb3J0IExpYiBmcm9tIFwic2FwL3VpL2NvcmUvTGliXCI7XG5pbXBvcnQgVUlDb21wb25lbnQgZnJvbSBcInNhcC91aS9jb3JlL1VJQ29tcG9uZW50XCI7XG5pbXBvcnQgQ2FjaGVNYW5hZ2VyIGZyb20gXCJzYXAvdWkvY29yZS9jYWNoZS9DYWNoZU1hbmFnZXJcIjtcbmltcG9ydCBWaWV3IGZyb20gXCJzYXAvdWkvY29yZS9tdmMvVmlld1wiO1xuaW1wb3J0IFZpZXdUeXBlIGZyb20gXCJzYXAvdWkvY29yZS9tdmMvVmlld1R5cGVcIjtcbmltcG9ydCBKU09OTW9kZWwgZnJvbSBcInNhcC91aS9tb2RlbC9qc29uL0pTT05Nb2RlbFwiO1xuaW1wb3J0IGkxOG5Nb2RlbCBmcm9tIFwic2FwL3VpL21vZGVsL3Jlc291cmNlL1Jlc291cmNlTW9kZWxcIjtcbmltcG9ydCB0eXBlIFJlcXVlc3RTZXR0aW5nc0NvbnRyb2xsZXIgZnJvbSBcIi4vY29udHJvbGxlci9zZXR0aW5ncy5jb250cm9sbGVyXCI7XG5cbmV4cG9ydCB0eXBlIFNjb3BlID0ge1xuXHR2YWxpZGl0eTogc3RyaW5nO1xuXHRrZXlDYXRlZ29yeTogc3RyaW5nO1xuXHR3cml0ZUZyZXF1ZW5jeTogc3RyaW5nO1xuXHRjbGllbnRTdG9yYWdlQWxsb3dlZDogYm9vbGVhbjtcbn07XG5leHBvcnQgdHlwZSBQZXJzb25hbGl6YXRpb25JZCA9IHtcblx0Y29udGFpbmVyOiBzdHJpbmc7XG5cdGl0ZW06IHN0cmluZztcbn07XG5leHBvcnQgdHlwZSBDdXN0b21TY29wZUNvbnN0YW50cyA9IHtcblx0Y29uc3RhbnRzOiB7XG5cdFx0a2V5Q2F0ZWdvcnk6IHtcblx0XHRcdEZJWEVEX0tFWTogc3RyaW5nO1xuXHRcdFx0R0VORVJBVEVEX0tFWTogc3RyaW5nO1xuXHRcdH07XG5cdFx0d3JpdGVGcmVxdWVuY3k6IHtcblx0XHRcdEhJR0g6IHN0cmluZztcblx0XHRcdExPVzogc3RyaW5nO1xuXHRcdH07XG5cdH07XG5cdGdldFBlcnNvbmFsaXplcjogKFxuXHRcdHBlcnNvbmFsaXphdGlvbklkOiBQZXJzb25hbGl6YXRpb25JZCxcblx0XHRzY29wZTogU2NvcGVcblx0KSA9PiBQcm9taXNlPHtcblx0XHRnZXRQZXJzRGF0YTogKCkgPT4gUHJvbWlzZTx7IHBlcmlvZDogbnVtYmVyIH0gfCB1bmRlZmluZWQ+O1xuXHRcdHNldFBlcnNEYXRhOiAoYXJnOiBvYmplY3QpID0+IFByb21pc2U8b2JqZWN0Pjtcblx0fT47XG59O1xuXG5leHBvcnQgdHlwZSBQZXJzb25hbGl6YXRpb25Db25zdGFudHMgPSB7XG5cdGtleUNhdGVnb3J5OiB7XG5cdFx0RklYRURfS0VZOiBzdHJpbmc7XG5cdFx0R0VORVJBVEVEX0tFWTogc3RyaW5nO1xuXHR9O1xuXHR3cml0ZUZyZXF1ZW5jeToge1xuXHRcdEhJR0g6IHN0cmluZztcblx0XHRMT1c6IHN0cmluZztcblx0fTtcbn07XG5cbmV4cG9ydCB0eXBlIFNoZWxsQ29udGFpbmVyID0ge1xuXHRnZXRTZXJ2aWNlQXN5bmMoYXJnOiBzdHJpbmcpOiBQcm9taXNlPEN1c3RvbVNjb3BlQ29uc3RhbnRzPjtcblx0Z2V0UmVuZGVyZXIoKToge1xuXHRcdGFkZFVzZXJQcmVmZXJlbmNlc0dyb3VwZWRFbnRyeShhcmc6IHtcblx0XHRcdG9uU2F2ZTogKCkgPT4gUHJvbWlzZTx2b2lkPjtcblx0XHRcdGdyb3VwaW5nSWQ6IHN0cmluZztcblx0XHRcdG9uQ2FuY2VsOiAoKSA9PiB2b2lkO1xuXHRcdFx0aWNvbjogc3RyaW5nO1xuXHRcdFx0Z3JvdXBpbmdUYWJIZWxwSWQ6IHN0cmluZztcblx0XHRcdHRpdGxlOiBzdHJpbmc7XG5cdFx0XHRlbnRyeUhlbHBJZDogc3RyaW5nO1xuXHRcdFx0Z3JvdXBpbmdUYWJUaXRsZTogc3RyaW5nO1xuXHRcdFx0dmFsdWU6ICgpID0+IFByb21pc2U8QXdhaXRlZDxzdHJpbmc+Pjtcblx0XHRcdGNvbnRlbnQ6ICgpID0+IFByb21pc2U8Vmlldz47XG5cdFx0fSk6IFByb21pc2U8dm9pZD47XG5cdH07XG59O1xuXG5jbGFzcyBSZXF1ZXN0U2V0dGluZ3NDb21wb25lbnQgZXh0ZW5kcyBVSUNvbXBvbmVudCB7XG5cdHZpZXdJbnN0YW5jZSE6IFZpZXc7XG5cblx0cGVyc29uYWxpemF0aW9uU2VydmljZSE6IEN1c3RvbVNjb3BlQ29uc3RhbnRzO1xuXG5cdG1vZGVsITogSlNPTk1vZGVsO1xuXG5cdHBlcnNvbmFsaXphdGlvbklkITogUGVyc29uYWxpemF0aW9uSWQ7XG5cblx0c2NvcGUhOiBTY29wZTtcblxuXHRwcml2YXRlIHdhaXRJbml0ITogUHJvbWlzZTx2b2lkPjtcblxuXHRwdWJsaWMgYXN5bmMgZ2V0V2FpdEluaXQoKTogUHJvbWlzZTx2b2lkPiB7XG5cdFx0cmV0dXJuIHRoaXMud2FpdEluaXQ7XG5cdH1cblxuXHRwcml2YXRlIGFzeW5jIGFzeW5jSW5pdCgpOiBQcm9taXNlPHZvaWQ+IHtcblx0XHRsZXQgcmVzb2x2ZUZ1bmN0aW9uITogKCkgPT4gdm9pZDtcblx0XHRzdXBlci5pbml0KCk7XG5cdFx0dGhpcy53YWl0SW5pdCA9IG5ldyBQcm9taXNlPHZvaWQ+KChyZXNvbHZlKSA9PiB7XG5cdFx0XHRyZXNvbHZlRnVuY3Rpb24gPSByZXNvbHZlO1xuXHRcdH0pO1xuXG5cdFx0dHJ5IHtcblx0XHRcdGF3YWl0IExpYi5sb2FkKHsgbmFtZTogXCJzYXAuZmUuY29udHJvbHNcIiB9KTtcblx0XHR9IGNhdGNoIChlcnJvcikge1xuXHRcdFx0TG9nLmRlYnVnKCdcIkVycm9yIGxvYWRpbmcgc2FwLmZlLmNvbnRyb2xzIGxpYnJhcnlcIiwgZXJyb3InKTtcblx0XHR9XG5cdFx0Y29uc3QgY29udGFpbmVyID0gc2FwLnVpLnJlcXVpcmUoXCJzYXAvdXNoZWxsL0NvbnRhaW5lclwiKSBhcyBTaGVsbENvbnRhaW5lcjtcblx0XHRjb25zdCBwZXJzb25hbGl6YXRpb25TZXJ2aWNlID0gKGF3YWl0IGNvbnRhaW5lci5nZXRTZXJ2aWNlQXN5bmMoXCJQZXJzb25hbGl6YXRpb25WMlwiKSkgYXMgdW5rbm93biBhcyBDdXN0b21TY29wZUNvbnN0YW50cztcblx0XHR0aGlzLm1vZGVsID0gbmV3IEpTT05Nb2RlbCh7fSk7XG5cdFx0dGhpcy5wZXJzb25hbGl6YXRpb25TZXJ2aWNlID0gcGVyc29uYWxpemF0aW9uU2VydmljZTtcblx0XHR0aGlzLnNjb3BlID0ge1xuXHRcdFx0Y2xpZW50U3RvcmFnZUFsbG93ZWQ6IGZhbHNlLFxuXHRcdFx0a2V5Q2F0ZWdvcnk6IChwZXJzb25hbGl6YXRpb25TZXJ2aWNlLmNvbnN0YW50cyBhcyBQZXJzb25hbGl6YXRpb25Db25zdGFudHMpLmtleUNhdGVnb3J5LkZJWEVEX0tFWSxcblx0XHRcdHZhbGlkaXR5OiBcIkluZmluaXR5XCIsXG5cdFx0XHR3cml0ZUZyZXF1ZW5jeTogKHBlcnNvbmFsaXphdGlvblNlcnZpY2UuY29uc3RhbnRzIGFzIFBlcnNvbmFsaXphdGlvbkNvbnN0YW50cykud3JpdGVGcmVxdWVuY3kuTE9XXG5cdFx0fTtcblx0XHR0aGlzLnBlcnNvbmFsaXphdGlvbklkID0ge1xuXHRcdFx0Y29udGFpbmVyOiBcInNhcC51c2hlbGwub3B0aW1pc3RpY3JlcS5wZXJzb25hbGl6YXRpb25cIixcblx0XHRcdGl0ZW06IFwiZGF0YVwiXG5cdFx0fTtcblx0XHRjb25zdCBwZXJpb2QgPSBhd2FpdCB0aGlzLl9nZXRQZXJzb25hbGl6ZWRQZXJpb2QocGVyc29uYWxpemF0aW9uU2VydmljZSk7XG5cdFx0Ly8gUmVtb3ZlIG9sZCBtYW5hZ2VjYWNoZSBlbnRyaWVzIHZpYSBjYWNoZSBtYW5hZ2VyXG5cdFx0Y29uc3QgdGltZVN0YW1wID0gbmV3IERhdGUoRGF0ZS5ub3coKSAtIHBlcmlvZCAqIDg2NDAwMDAwKTtcblx0XHRjb25zdCBmaWx0ZXJzOiB7IG9sZGVyVGhhbjogRGF0ZTsgcHJlZml4OiBzdHJpbmcgfSA9IHtcblx0XHRcdG9sZGVyVGhhbjogdGltZVN0YW1wLFxuXHRcdFx0cHJlZml4OiBcInNhcC51aS5tb2RlbC5vZGF0YS52NC5tYW5hZ2VjYWNoZVwiXG5cdFx0fTtcblx0XHRDYWNoZU1hbmFnZXIuZGVsV2l0aEZpbHRlcnMoZmlsdGVycyk7XG5cdFx0Ly8gRW5oYW5jZSB1c2VyIGFjdGl2aXRpZXMgc2VjdGlvbiB3aXRoIG9wdGltaXN0aWMgYmF0Y2ggc2V0dGluZ3Ncblx0XHRhd2FpdCB0aGlzLl9jcmVhdGVBY3Rpdml0aWVzU2VjdGlvbigpO1xuXHRcdHJlc29sdmVGdW5jdGlvbigpO1xuXHR9XG5cblx0cHVibGljIGluaXQoKTogdm9pZCB7XG5cdFx0dGhpcy5hc3luY0luaXQoKS5jYXRjaCgoZXJyKTogdm9pZCA9PiB7XG5cdFx0XHRMb2cuZXJyb3IoKGVyciBhcyBFcnJvcikubWVzc2FnZSk7XG5cdFx0fSk7XG5cdH1cblxuXHRhc3luYyBfZ2V0UGVyc29uYWxpemVkUGVyaW9kKHBlcnNvbmFsaXphdGlvblNlcnZpY2U6IEN1c3RvbVNjb3BlQ29uc3RhbnRzKTogUHJvbWlzZTxudW1iZXI+IHtcblx0XHRjb25zdCBwZXJzb25hbGl6ZXIgPSBhd2FpdCBwZXJzb25hbGl6YXRpb25TZXJ2aWNlLmdldFBlcnNvbmFsaXplcih0aGlzLnBlcnNvbmFsaXphdGlvbklkLCB0aGlzLnNjb3BlKTtcblx0XHRjb25zdCBwZXJzb25hbGl6YXRpb25Db250YWluZXIgPSBhd2FpdCBwZXJzb25hbGl6ZXIuZ2V0UGVyc0RhdGEoKTtcblx0XHQvLyBVc2UgcGVyc29uYWxpemF0aW9uIHNlcnZpY2UgdG8gZ2V0L3NldCBwZXJpb2Rcblx0XHRsZXQgcGVyaW9kID0gcGVyc29uYWxpemF0aW9uQ29udGFpbmVyPy5wZXJpb2Q7XG5cdFx0cGVyaW9kID8/PSAzMDtcblx0XHR0aGlzLm1vZGVsLnNldFByb3BlcnR5KFwiL3BlcmlvZFwiLCBwZXJpb2QpO1xuXHRcdHRoaXMubW9kZWwuc2V0UHJvcGVydHkoXCIvb2xkcGVyaW9kXCIsIHBlcmlvZCk7XG5cdFx0cmV0dXJuIHBlcmlvZDtcblx0fVxuXG5cdGFzeW5jIF9zZXRQZXJzb25hbGl6ZWRQZXJpb2QocGVyc29uYWxpemF0aW9uU2VydmljZTogQ3VzdG9tU2NvcGVDb25zdGFudHMsIHBlcmlvZDogeyBwZXJpb2Q6IG51bWJlciB9KTogUHJvbWlzZTxvYmplY3Q+IHtcblx0XHRjb25zdCBwZXJzb25hbGl6ZXIgPSBhd2FpdCBwZXJzb25hbGl6YXRpb25TZXJ2aWNlLmdldFBlcnNvbmFsaXplcih0aGlzLnBlcnNvbmFsaXphdGlvbklkLCB0aGlzLnNjb3BlKTtcblx0XHRyZXR1cm4gcGVyc29uYWxpemVyLnNldFBlcnNEYXRhKHBlcmlvZCk7XG5cdH1cblxuXHRhc3luYyBfY3JlYXRlQWN0aXZpdGllc1NlY3Rpb24oKTogUHJvbWlzZTx2b2lkPiB7XG5cdFx0Y29uc3QgaTE4biA9IG5ldyBpMThuTW9kZWwoeyBidW5kbGVOYW1lOiBcInNhcC5mZS5wbHVnaW5zLm1hbmFnZWNhY2hlLmNvbXAuaTE4bi5tZXNzYWdlYnVuZGxlXCIgfSk7XG5cdFx0Y29uc3Qgdmlld1R5cGUgPSBWaWV3VHlwZS5YTUw7XG5cdFx0Y29uc3Qgdmlld1NldHRpbmdzID0ge1xuXHRcdFx0dHlwZTogdmlld1R5cGUsXG5cdFx0XHRpZDogXCJyZXF1ZXN0Q2FjaGVWaWV3XCIsXG5cdFx0XHR2aWV3TmFtZTogXCJzYXAuZmUucGx1Z2lucy5tYW5hZ2VjYWNoZS5jb21wLnZpZXcuc2V0dGluZ3NcIlxuXHRcdH07XG5cdFx0Y29uc3QgY29udGFpbmVyID0gc2FwLnVpLnJlcXVpcmUoXCJzYXAvdXNoZWxsL0NvbnRhaW5lclwiKSBhcyBTaGVsbENvbnRhaW5lcjtcblx0XHRjb25zdCBmcmFtZUJvdW5kRXh0ZW5zaW9uID0gKGF3YWl0IGNvbnRhaW5lci5nZXRTZXJ2aWNlQXN5bmMoXCJGcmFtZUJvdW5kRXh0ZW5zaW9uXCIpKSBhcyB1bmtub3duIGFzIHtcblx0XHRcdGFkZEdyb3VwZWRVc2VyU2V0dGluZ3NFbnRyeTogKHNldHRpbmdzOiB1bmtub3duKSA9PiBQcm9taXNlPHZvaWQ+O1xuXHRcdH07XG5cdFx0YXdhaXQgZnJhbWVCb3VuZEV4dGVuc2lvbi5hZGRHcm91cGVkVXNlclNldHRpbmdzRW50cnkoe1xuXHRcdFx0dGl0bGU6IChpMThuLmdldFJlc291cmNlQnVuZGxlKCkgYXMgUmVzb3VyY2VCdW5kbGUpLmdldFRleHQoXCJUX0dST1VQXCIpLFxuXHRcdFx0aWNvbjogXCJzYXAtaWNvbjovL2xhcHRvcFwiLFxuXHRcdFx0ZW50cnlIZWxwSWQ6IFwidXNlckFjdGl2aXRpZXNFbnRyeVwiLFxuXHRcdFx0Z3JvdXBpbmdJZDogXCJ1c2VyQWN0aXZpdGllc1wiLFxuXHRcdFx0Z3JvdXBpbmdUYWJUaXRsZTogKGkxOG4uZ2V0UmVzb3VyY2VCdW5kbGUoKSBhcyBSZXNvdXJjZUJ1bmRsZSkuZ2V0VGV4dChcInRpdGxlXCIpLFxuXHRcdFx0Z3JvdXBpbmdUYWJIZWxwSWQ6IFwicmVxdWVzdENhY2hlVXNlckFjdGl2aXRpZXMtaGVscElkXCIsXG5cdFx0XHR2YWx1ZTogYXN5bmMgZnVuY3Rpb24gKCkge1xuXHRcdFx0XHRyZXR1cm4gUHJvbWlzZS5yZXNvbHZlKFwiUmVxdWVzdCBDYWNoZVwiKTsgLy9jaGVja1xuXHRcdFx0fSxcblx0XHRcdGNvbnRlbnQ6IGFzeW5jICgpID0+IHtcblx0XHRcdFx0cmV0dXJuIFZpZXcuY3JlYXRlKHZpZXdTZXR0aW5ncykudGhlbigodmlldzogVmlldykgPT4ge1xuXHRcdFx0XHRcdHZpZXcuc2V0TW9kZWwodGhpcy5tb2RlbCk7XG5cdFx0XHRcdFx0dmlldy5zZXRNb2RlbChpMThuLCBcImkxOG5cIik7XG5cdFx0XHRcdFx0dGhpcy52aWV3SW5zdGFuY2UgPSB2aWV3O1xuXHRcdFx0XHRcdHJldHVybiB0aGlzLnZpZXdJbnN0YW5jZTtcblx0XHRcdFx0fSk7XG5cdFx0XHR9LFxuXHRcdFx0b25TYXZlOiBhc3luYyAoKSA9PiB7XG5cdFx0XHRcdGNvbnN0IHBlcmlvZCA9IHRoaXMubW9kZWwuZ2V0UHJvcGVydHkoXCIvcGVyaW9kXCIpIGFzIHVua25vd24gYXMgbnVtYmVyO1xuXHRcdFx0XHRhd2FpdCB0aGlzLl9zZXRQZXJzb25hbGl6ZWRQZXJpb2QodGhpcy5wZXJzb25hbGl6YXRpb25TZXJ2aWNlLCB7IHBlcmlvZDogcGVyaW9kIH0pO1xuXHRcdFx0XHRyZXR1cm4gKHRoaXMudmlld0luc3RhbmNlLmdldENvbnRyb2xsZXIoKSBhcyBSZXF1ZXN0U2V0dGluZ3NDb250cm9sbGVyKS5vblNhdmUocGVyaW9kKTtcblx0XHRcdH0sXG5cdFx0XHRvbkNhbmNlbDogKCkgPT4ge1xuXHRcdFx0XHRyZXR1cm4gKHRoaXMudmlld0luc3RhbmNlLmdldENvbnRyb2xsZXIoKSBhcyBSZXF1ZXN0U2V0dGluZ3NDb250cm9sbGVyKS5vbkNhbmNlbCgpO1xuXHRcdFx0fVxuXHRcdH0pO1xuXHR9XG59XG5leHBvcnQgZGVmYXVsdCBSZXF1ZXN0U2V0dGluZ3NDb21wb25lbnQ7XG4iXSwibWFwcGluZ3MiOiI7Ozs7Ozs7OztNQXNFTUEsd0JBQXdCLDBCQUFBQyxZQUFBO0lBQUEsU0FBQUQseUJBQUE7TUFBQSxPQUFBQyxZQUFBLENBQUFDLEtBQUEsT0FB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QUFDYSxpQkFBaUIsQ0FBQyxDQUFDLENBQW9CQyxPQUFPLENBQUMsU0FBUyxDQUFDO1FBQ3RFQyxJQUFJLEVBQUUsbUJBQW1CO1FBQ3pCQyxXQUFXLEVBQUUscUJBQXFCO1FBQ2xDQyxVQUFVLEVBQUUsZ0JBQWdCO1FBQzVCQyxnQkFBZ0IsRUFBR2xCLElBQUksQ0FBQ2EsaUJBQWlCLENBQUMsQ0FBQyxDQUFvQkMsT0FBTyxDQUFDLE9BQU8sQ0FBQztRQUMvRUssaUJBQWlCLEVBQUUsbUNBQW1DO1FBQ3REQyxLQUFLLEVBQUUsZUFBQUEsQ0FBQSxFQUFrQjtVQUN4QixPQUFPbkUsT0FBTyxDQUFDQyxPQUFPLENBQUMsZUFBZSxDQUFDLENBQUMsQ0FBQztRQUMxQyxDQUFDO1FBQ0RtRSxPQUFPLEVBQUUsTUFBQUEsQ0FBQSxLQUFZO1VBQ3BCLE9BQU9DLElBQUksQ0FBQ0MsTUFBTSxDQUFDakIsWUFBWSxDQUFDLENBQUNrQixJQUFJLENBQUVDLElBQVUsSUFBSztZQUNyREEsSUFBSSxDQUFDQyxRQUFRLENBQUMsSUFBSSxDQUFDM0QsS0FBSyxDQUFDO1lBQ3pCMEQsSUFBSSxDQUFDQyxRQUFRLENBQUMxQixJQUFJLEVBQUUsTUFBTSxDQUFDO1lBQzNCLElBQUksQ0FBQzJCLFlBQVksR0FBR0YsSUFBSTtZQUN4QixPQUFPLElBQUksQ0FBQ0UsWUFBWTtVQUN6QixDQUFDLENBQUM7UUFDSCxDQUFDO1FBQ0RDLE1BQU0sRUFBRSxNQUFBQSxDQUFBLEtBQVk7VUFDbkIsTUFBTWpELE1BQU0sR0FBRyxJQUFJLENBQUNaLEtBQUssQ0FBQzhELFdBQVcsQ0FBQyxTQUFTLENBQXNCO1VBQ3JFLE1BQU0sSUFBSSxDQUFDL0Isc0JBQXNCLENBQUMsSUFBSSxDQUFDakMsc0JBQXNCLEVBQUU7WUFBRWMsTUFBTSxFQUFFQTtVQUFPLENBQUMsQ0FBQztVQUNsRixPQUFRLElBQUksQ0FBQ2dELFlBQVksQ0FBQ0csYUFBYSxDQUFDLENBQUMsQ0FBK0JGLE1BQU0sQ0FBQ2pELE1BQU0sQ0FBQztRQUN2RixDQUFDO1FBQ0RvRCxRQUFRLEVBQUVBLENBQUEsS0FBTTtVQUNmLE9BQVEsSUFBSSxDQUFDSixZQUFZLENBQUNHLGFBQWEsQ0FBQyxDQUFDLENBQStCQyxRQUFRLENBQUMsQ0FBQztRQUNuRjtNQUNELENBQUMsQ0FBQztJQUNILENBQUM7SUFBQSxPQUFBM0Ysd0JBQUE7RUFBQSxFQXJIcUM0RixXQUFXO0VBQUEsT0F1SG5DNUYsd0JBQXdCO0FBQUEiLCJpZ25vcmVMaXN0IjpbXX0=