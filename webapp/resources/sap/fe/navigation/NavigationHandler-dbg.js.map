{"version":3,"names":["NavType","NavLibrary","ParamHandlingMode","SuppressionBehavior","Mode","IAPP_STATE","DEFAULTED_PARAMETER_PROPERTY","HYBRID_IAPP_STATE_KEY","NavigationHandler","_BaseObject","oController","_this","sMode","arguments","length","undefined","ODataV4","sParamHandlingMode","SelVarWins","call","_aTechnicalParamaters","_oLastSavedInnerAppData","sAppStateKey","oAppData","iCacheHit","iCacheMiss","_rIAppStateOld","RegExp","_rIAppStateOldAtStart","_rIAppStateNew","NavError","UIComponent","oRouter","getRouter","oComponent","getOwnerComponent","_getRouter","getAppComponent","getComponentData","URLParamWins","InsertInSelOpt","ODataV2","_sMode","_exports","_inheritsLoose","_proto","prototype","_getAppNavigationService","ushellContainer","sap","ui","require","getService","_getAppNavigationServiceAsync","getServiceAsync","then","oCrossAppNavService","catch","Log","error","getRouterFor","registerNavigateCallback","fnCallback","_navigateCallback","navigate","sSemanticObject","sActionName","vNavigationParameters","oInnerAppData","fnOnError","oExternalAppData","sNavMode","sSelectionVariant","mParameters","oXAppDataObj","oStartupParameters","bExPlace","oTmpData","oNavHandler","oComponentData","startupParameters","oEnrichedSelVar","_splitInboundNavigationParameters","SelectionVariant","oNavigationSelVar","toJSONString","selectionVariant","_removeTechnicalParameters","toJSONObject","_removeMeasureBasedInformation","_checkIsPotentiallySensitive","_getURLParametersFromSelectionVariant","oNavArguments","target","semanticObject","action","params","fnNavigate","fnNavExplace","sNewHrefPromise","getHref","sNewHref","openWindow","oError","_fnSaveAppStateAsync","oSaveAppStateReturn","appStateKey","ptoExt","fnStoreAndNavigate","storeInnerAppStateAsync","replaceHash","oTargets","isNavigationSupported","supported","technicalError","_createTechnicalError","parseNavigation","sAppHash","HashChanger","getInstance","getHash","sIAppState","_getInnerAppStateKey","warning","hybridIAppStateKeyParams","hybridDeferred","jQuery","Deferred","iAppStateHybridDeferred","_loadAppState","hybrid","aDefaultedParameters","JSON","parse","oMyDeferred","parseUrlParams","oSubStartupParameters","aSubDefaultedParameters","oSubMyDeferred","sNavType","oSelVars","isEmpty","oDefaultedSelVar","xAppState","reject","resolve","initial","oAppStateData","oSelectionVariant","oDefaultedSelectionVariant","bNavSelVarHasDefaultsOnly","successHandlerHybridState","iAppStateData","_ref","navType","iAppState","failureHandlerHybridState","done","fail","bIsXappStateNavigation","that","getStartupAppState","oAppState","getData","stringify","x","promise","oSelVar","URLParams","setTechnicalParameters","aTechnicalParameters","Array","isArray","getTechnicalParameters","concat","_isTechnicalParameter","sParameterName","toLowerCase","indexOf","includes","_isFEParameter","sPropName","i","aSelVarPropNames","getSelectOptionsPropertyNames","removeSelectOption","oStartupParametersAdjusted","hasOwnProperty","getParameterNames","massAddSelectOption","getValue","_addParameterValues","aPropNames","oSelVariant","sSign","sOption","oValues","addSelectOption","oHashChanger","sAppHashOld","sAppHashNew","_replaceInnerAppStateKey","mInnerAppData","bImmediateHashReplace","bSkipHashReplace","fnReplaceHash","isEmptyObject","sAppStateKeyCached","bInnerAppDataEqual","fnOnAfterSave","_saveAppStateAsync","storeInnerAppState","_saveAppState","storeInnerAppStateWithImmediateReturn","oAppStatePromise","processBeforeSmartLinkPopoverOpens","oTableEventParameters","mSemanticAttributes","semanticAttributes","fnStoreXappAndCallOpen","mSubSemanticAttributes","sSubSelectionVariant","iSuppressionBehavior","raiseErrorOnNull","raiseErrorOnUndefined","oMixedSelVar","mixAttributesAndSelectionVariant","fnOnContainerSave","setSemanticAttributes","setAppStateKey","open","oStoreInnerAppStatePromise","_getAppStateKeyAndUrlParameters","_getAppSpecificHash","appHash","crossAppService","appSpecificRoute","message","Error","String","_mixAttributesToSelVariant","sPropertyName","vSemanticAttributeValue","Date","toJSON","toString","ignoreEmptyString","info","vSemanticAttributes","standard","oNewSelVariant","filterUrl","getFilterContextUrl","setFilterContextUrl","contextUrl","getParameterContextUrl","setParameterContextUrl","forEach","aParameters","getSelectOption","getParameter","aSelOptionNames","aSelectOption","j","Sign","Option","Low","High","_ensureSelectionVariantFormatString","vSelectionVariant","vConvertedSelectionVariant","_fnHandleAppStatePromise","oReturn","_saveAppStateWithImmediateReturn","_fnSaveAppStateWithImmediateReturn","getKey","oAppDataForSave","_fetchAppDataForSave","setData","oSavePromise","save","extend","tableVariantId","customData","presentationVariant","valueTexts","semanticDates","oAppDataClone","Object","assign","merge","createEmptyAppState","oDeferred","getAppState","oAppDataLoaded","data","aMatches","exec","sNewIAppState","fnAppendToQueryParameter","sSubAppHash","test","replace","sNeedle","fnReplaceOldApproach","rOldApproach","assert","mURLParameters","aSelectProperties","aSelectOptions","aParameterNames","sParameterValue","sErrorCode","setModel","oModel","_oModel","_getModel","getModel","_removeAllProperties","oData","_removeProperties","aFilterName","aParameterName","sName","SelectOptions","some","oValue","nIdx","PropertyName","splice","Texts","oTexts","PropertyTexts","Dates","oDates","Parameters","_isTermTrue","oProperty","sTerm","fIsTermDefaultTrue","oTerm","Bool","_isExcludedFromNavigationContext","_isPotentiallySensitive","_isMeasureProperty","_isToBeExcluded","constructContextUrl","sEntitySetName","_constructContextUrl","sServerUrl","isA","_getServerUrl","oServiceURI","URI","getServiceUrl","absoluteTo","document","baseURI","lastIndexOf","substring","sServiceUrl","oAdaptedData","FilterContextUrl","ParameterContextUrl","aSensitiveFilterName","aSensitiveParameterName","oEntitySet","oEntityDef","oSubEntityDef","oEndRole","aFilterContextPart","aParamContextPart","oMetaModel","getMetaModel","getServiceMetadata","split","getODataEntitySet","getODataEntityType","entityType","property","push","name","navigationProperty","getODataAssociationEnd","type","multiplicity","_removeSensitiveDataForODataV4","_removeMeasureBasedProperties","aMeasureFilterName","aMeasureParameterName","bMeasure","oSV","getObject","sEntitySet","aPropertyNames","getPropertyNames","fnIsSensitiveData","sProp","esName","aPropertyAnnotations","_checkPropertyAnnotationsForSensitiveData","oFieldControl","k","sProperty","getIAppStateKey","BaseObject","NavigationHandlerUI5Class"],"sourceRoot":".","sources":["NavigationHandler.ts"],"sourcesContent":["import Log from \"sap/base/Log\";\nimport assert from \"sap/base/assert\";\nimport extend from \"sap/base/util/extend\";\nimport isEmptyObject from \"sap/base/util/isEmptyObject\";\nimport merge from \"sap/base/util/merge\";\nimport BaseObject from \"sap/ui/base/Object\";\nimport type Component from \"sap/ui/core/Component\";\nimport UIComponent from \"sap/ui/core/UIComponent\";\nimport type Controller from \"sap/ui/core/mvc/Controller\";\nimport HashChanger from \"sap/ui/core/routing/HashChanger\";\nimport type Router from \"sap/ui/core/routing/Router\";\nimport type V2ODataModel from \"sap/ui/model/odata/v2/ODataModel\";\nimport type V4ODataModel from \"sap/ui/model/odata/v4/ODataModel\";\nimport URI from \"sap/ui/thirdparty/URI\";\nimport jQuery from \"sap/ui/thirdparty/jquery\";\nimport openWindow from \"sap/ui/util/openWindow\";\nimport type Container from \"sap/ushell/Container\";\nimport type CrossApplicationNavigation from \"sap/ushell/services/CrossApplicationNavigation\";\nimport type Navigation from \"sap/ushell/services/Navigation\";\nimport NavError from \"./NavError\";\nimport type { SerializedSelectionVariant } from \"./SelectionVariant\";\nimport SelectionVariant from \"./SelectionVariant\";\nimport NavLibrary from \"./library\";\n\ntype ShellAppStateReturn = {\n\tpromise: JQuery.Promise<string>;\n\tappStateKey: string;\n};\n\ntype ShellAppState = {\n\tgetKey(): string;\n\tsetData(obj: object): void;\n\tgetData(): InnerAppData;\n\tsave(): JQuery.Promise<string>;\n};\n/**\n * Structure of stored app state.\n */\nexport interface InnerAppData {\n\t[key: string]: unknown;\n\t/**\n\t * Sringified JSON object as returned, for example, from getDataSuiteFormat() of the SmartFilterBar control\n\t */\n\tselectionVariant?: string | SerializedSelectionVariant;\n\n\t/**\n\t * ID of the SmartTable variant.\n\t */\n\ttableVariantId?: string;\n\n\t/**\n\t * Object that can be used to store arbitrary data.\n\t */\n\tcustomData?: object;\n\n\t/**\n\t * Object containing the current ui state of the app.\n\t */\n\tpresentationVariant?: object;\n\n\t/**\n\t * Object containing value descriptions.\n\t */\n\tvalueTexts?: object | null;\n\n\t/**\n\t * Object containing semanticDates filter information.\n\t */\n\tsemanticDates?: object | null;\n}\n\n// shortcuts for sap.ui.generic.app enums\nconst NavType = NavLibrary.NavType;\nconst ParamHandlingMode = NavLibrary.ParamHandlingMode;\nconst SuppressionBehavior = NavLibrary.SuppressionBehavior;\nconst Mode = NavLibrary.Mode;\n\nconst IAPP_STATE = \"sap-iapp-state\";\nconst DEFAULTED_PARAMETER_PROPERTY = \"sap-ushell-defaultedParameterNames\";\nconst HYBRID_IAPP_STATE_KEY = \"nhHybridIAppStateKey\";\n\n/**\n * This is the successor of {@link sap.ui.generic.app.navigation.service.NavigationHandler}.<br> Creates a new NavigationHandler class by providing the required environment. <br>\n * The <code>NavigationHandler</code> supports the verification of sensitive information. All properties that are part of\n * <code>selectionVariant</code> and <code>valueTexts</code> will be verified if they are annotated as\n * <code>com.sap.vocabularies.PersonalData.v1.IsPotentiallySensitive</code> or\n * <code>com.sap.vocabularies.UI.v1.ExcludeFromNavigationContext</code> and will be removed before the data is persisted as the app\n * state.<br>\n * Also, all properties annotated as <code>com.sap.vocabularies.Analytics.v1.Measure</code> will be removed from the data stored as the\n * xapp state.<br>\n * To verify the information to be removed, the <code>NavigationHandler</code> requires an unnamed model of type\n * {@link sap.ui.model.odata.v2.ODataModel} on component level. It is possible to set such a model using the <code>setModel</code>\n * method.<br>\n * <b>Note:</b> The check for excluded data requires that the OData metadata has already been loaded completely.<br>\n * If the OData metadata model has not been loaded completely, all properties are removed from the application context.<br>\n * <b>Note:</b> This class requires that the UShell {@link sap.ushell.services.CrossApplicationNavigation} is available and initialized.\n * @public\n * @since 1.83.0\n */\nexport class NavigationHandler extends BaseObject {\n\tprivate oRouter: any;\n\n\tprivate oComponent: Component;\n\n\tprivate _oModel: any;\n\n\tprivate sParamHandlingMode: string;\n\n\tprivate _sMode: string | undefined;\n\n\t// list of technical parameters\n\tprivate _aTechnicalParamaters = [\"hcpApplicationId\"];\n\n\tprivate _oLastSavedInnerAppData: any = {\n\t\tsAppStateKey: \"\",\n\t\toAppData: {},\n\t\tiCacheHit: 0,\n\t\tiCacheMiss: 0\n\t};\n\n\t/*\n\t * There exists a generation of \"old\" sap-iapp-states which are based on the following URL schema:\n\t * #SemObj-action&/route/sap-iapp-state=ABC12345678 The new URL schema is: #SemObj-action&/route?sap-iapp-state=ABC12345678 (mind the\n\t * difference between / and ? above), i.e. the sap-iapp-state has become a parameter of the query parameter section in the AppHash string.\n\t * Yet, this tool shall be able to deal even with old sap-iapp-states. Therefore, we use two Regular Expressions (rIAppStateOld and\n\t * rIAppStateOldAtStart) as defined below to scan for these old variants. The new variant is being scanned using rIAppStateNew as Regular\n\t * Expression search string. Compatibility is centrally ensured by the two methods _getInnerAppStateKey and _replaceInnerAppStateKey (see\n\t * below). Never use these RegExp in a method on your own, as it typically indicates that you will fall into the compatibility trap!\n\t */\n\t// Warning! Do not use GLOBAL flags here; RegExp in GLOBAL mode store the lastIndex value\n\t// Therefore, repeated calls to the RegExp will then only start beginning with that stored\n\t// lastIndex. Thus, multiple calls therefore could yield strange results.\n\t// Moreover, there shall only be exactly one IAPP_STATE per RegExp in an AppHash.\n\t// Therefore, GLOBAL search should be superfluous.\n\tprivate _rIAppStateOld = new RegExp(\"/\" + IAPP_STATE + \"=([^/?]+)\");\n\n\tprivate _rIAppStateOldAtStart = new RegExp(\"^\" + IAPP_STATE + \"=([^/?]+)\");\n\n\t/*\n\t * Regular Expression in words: Search for something that either starts with ? or &, followed by the term \"sap-iapp-state\". That one is\n\t * followed by an equal sign (=). The stuff that is after the equal sign forms the first regexp group. This group consists of at least one\n\t * (or arbitrary many) characters, as long as it is not an ampersand sign (&). Characters after such an ampersand would be ignored and do\n\t * not belong to the group. Alternatively, the string also may end.\n\t */\n\tprivate _rIAppStateNew = new RegExp(\"[?&]\" + IAPP_STATE + \"=([^&]+)\");\n\n\tprivate _navigateCallback: Function | undefined;\n\n\t/**\n\t * Temporarily added again because an application was (illegially) relying on it. Should be removed again, once the app is corrected\n\t */\n\tprivate IAPP_STATE = IAPP_STATE;\n\n\t/**\n\t * Constructor requiring a controller/component owning the navigation handler.\n\t * @param oController UI5 controller that contains a router and a component; typically the main controller of your application, for\n\t *        example, a subclass of the sap.ca.scfld.md.controller.BaseFullscreenController if scaffolding is used\n\t * @param sMode Mode to be used to indicates the Odata version used for runnning the Navigation Handler,\n\t *        see {@link sap.fe.navigation.Mode}.<br>\n\t * \t\t  Note: Mode has to be sap.fe.navigation.Mode.ODataV2 whenever this constructor is used to initialize a OData V2 based service.\n\t * @param sParamHandlingMode Mode to be used to handle conflicts when merging URL parameters and the SelectionVariant class,\n\t *        see {@link sap.fe.navigation.ParamHandlingMode}\n\t * @throws An instance of {@link sap.fe.navigation.NavError} in case of input errors. Valid error codes are: <table>\n\t *         <tr>\n\t *         <th align=\"left\">NavError code</th>\n\t *         <th align=\"left\">Description</th>\n\t *         </tr>\n\t *         <tr>\n\t *         <td>NavigationHandler.INVALID_INPUT</td>\n\t *         <td>Indicates that the input parameter is invalid</td>\n\t *         </tr>\n\t *         </table>\n\t */\n\tconstructor(\n\t\toController: Controller | UIComponent,\n\t\tsMode: string = Mode.ODataV4,\n\t\tsParamHandlingMode: string = ParamHandlingMode.SelVarWins\n\t) {\n\t\tsuper();\n\t\tif (!oController) {\n\t\t\tthrow new NavError(\"NavigationHandler.INVALID_INPUT\");\n\t\t}\n\n\t\tif (oController instanceof UIComponent) {\n\t\t\tthis.oRouter = oController.getRouter();\n\t\t\tthis.oComponent = oController;\n\t\t} else {\n\t\t\tif (typeof oController.getOwnerComponent !== \"function\") {\n\t\t\t\tthrow new NavError(\"NavigationHandler.INVALID_INPUT\");\n\t\t\t}\n\n\t\t\tthis.oRouter = this._getRouter(oController);\n\t\t\tthis.oComponent = oController.getOwnerComponent() as Component;\n\t\t}\n\n\t\t// special handling for SmartTemplates\n\t\tif (this.oComponent && (this.oComponent as { getAppComponent?: Function }).getAppComponent) {\n\t\t\tthis.oComponent = (this.oComponent as { getAppComponent?: Function }).getAppComponent?.();\n\t\t}\n\n\t\tif (\n\t\t\ttypeof this.oRouter === \"undefined\" ||\n\t\t\ttypeof this.oComponent === \"undefined\" ||\n\t\t\ttypeof this.oComponent.getComponentData !== \"function\"\n\t\t) {\n\t\t\tthrow new NavError(\"NavigationHandler.INVALID_INPUT\");\n\t\t}\n\n\t\tif (sParamHandlingMode === ParamHandlingMode.URLParamWins || sParamHandlingMode === ParamHandlingMode.InsertInSelOpt) {\n\t\t\tthis.sParamHandlingMode = sParamHandlingMode;\n\t\t} else {\n\t\t\tthis.sParamHandlingMode = ParamHandlingMode.SelVarWins; // default\n\t\t}\n\t\tif (sMode === Mode.ODataV2) {\n\t\t\tthis._sMode = sMode;\n\t\t}\n\t}\n\n\t/**\n\t * Retrieves the shell navigation service.\n\t * @returns The Navigation service\n\t * @private\n\t */\n\t// eslint-disable-next-line deprecation/deprecation\n\t_getAppNavigationService(): CrossApplicationNavigation {\n\t\tconst ushellContainer: Container = sap.ui.require(\"sap/ushell/Container\");\n\t\t// eslint-disable-next-line deprecation/deprecation\n\t\treturn ushellContainer.getService(\"CrossApplicationNavigation\") as CrossApplicationNavigation;\n\t}\n\n\t/**\n\t * Retrieves the shell navigation service.\n\t * @returns The Navigation service\n\t * @private\n\t */\n\tasync _getAppNavigationServiceAsync(): Promise<Navigation> {\n\t\tconst ushellContainer: Container = sap.ui.require(\"sap/ushell/Container\");\n\t\treturn ushellContainer\n\t\t\t?.getServiceAsync(\"Navigation\")\n\t\t\t.then(function (oCrossAppNavService: object) {\n\t\t\t\treturn oCrossAppNavService as Navigation;\n\t\t\t})\n\t\t\t.catch(function () {\n\t\t\t\tLog.error(\"NavigationHandler: Navigation is not available.\");\n\t\t\t\tthrow new NavError(\"NavigationHandler.NO.XAPPSERVICE\");\n\t\t\t});\n\t}\n\n\t/**\n\t * Retrieves the reference to the router object for navigation for this given Controller.\n\t * @param oController The reference to the Controller for which the Router instance shall be determined.\n\t * @returns The Router for the given Controller\n\t * @private\n\t */\n\t_getRouter(oController: Controller): Router {\n\t\treturn UIComponent.getRouterFor(oController);\n\t}\n\n\t/**\n\t * This method is to be used only by FE V2 to get access to toExternal promise.\n\t * @param fnCallback Callback to be called by 'navigate' method in case of toExternal is used to navigate.\n\t * @private\n\t */\n\tregisterNavigateCallback(fnCallback: Function): void {\n\t\tthis._navigateCallback = fnCallback;\n\t}\n\n\t/**\n\t * Triggers a cross-app navigation after saving the inner and the cross-app states. The navigation mode based on\n\t * <code>sap-ushell-next-navmode</code> is taken into account. If set to <code>explace</code> the inner app state will not be changed.\n\t * <b>Note:</b> The <code>sNavMode</code> argument can be used to overwrite the SAP Fiori launchpad default navigation for opening a URL\n\t * in-place or ex-place.\n\t * <br>\n\t * <b>Node:</b> If the <code>oExternalAppData</code> parameter is not supplied, the external app data will be calculated based on\n\t * the <code>oInnerAppData</code> data.<br>\n\t * SmartFilterBar control <b>Parameters:</b> <table>\n\t * <tr>\n\t * <td align=\"center\">{object}</td>\n\t * <td><b>oError</b></td>\n\t * <td>NavError object (instance of {@link sap.fe.navigation.NavError}) that describes which kind of error occurred</td>\n\t * <tr>\n\t * <td align=\"center\">{string}</td>\n\t * <td><b>oError.errorCode</b></td>\n\t * <td>Code to identify the error</td>\n\t * <tr>\n\t * <td align=\"center\">{string}</td>\n\t * <td><b>oError.type</b></td>\n\t * <td>Severity of the error (info/warning/error)</td>\n\t * <tr>\n\t * <td align=\"center\">{array}</td>\n\t * <td><b>oError.params</b></td>\n\t * <td>An array of objects (typically strings) that describe additional value parameters required for generating the message</td>\n\t * </table>.\n\t * @public\n\t * @param sSemanticObject Name of the semantic object of the target app\n\t * @param sActionName Name of the action of the target app\n\t * @param vNavigationParameters Navigation parameters as an object with key/value pairs or as a string representation of such an object. If passed as an object, the properties are not checked against the <code>IsPotentialSensitive</code> or <code>Measure</code> type.\n\t * @param oInnerAppData Object for storing current state of the app\n\t * @param fnOnError Callback that is called if an error occurs during navigation <br>\n\t * @param oExternalAppData Object for storing the state which will be forwarded to the target component.\n\t * @param oExternalAppData.presentationVariant Object containing the current ui state of the app which will be forwarded to the\n\t *        target component.\n\t * @param oExternalAppData.valueTexts Object containing value descriptions which will be forwarded to the target component.\n\t * @param oExternalAppData.selectionVariant Stringified JSON object, which will be forwarded to the target component. If not\n\t *        provided the selectionVariant will be constructed based on the vNavigationParameters.\n\t * @param sNavMode Argument is used to overwrite the FLP-configured target for opening a URL. If used, only the\n\t *        <code>explace</code> or <code>inplace</code> values are allowed. Any other value will lead to an exception\n\t *        <code>NavigationHandler.INVALID_NAV_MODE</code>.\n\t * @example <code>\n\t * sap.ui.define([\"sap/fe/navigation/NavigationHandler\", \"sap/fe/navigation/SelectionVariant\"], function (NavigationHandler, SelectionVariant) {\n\t * \tvar oNavigationHandler = new NavigationHandler(oController);\n\t * \tvar sSemanticObject = \"SalesOrder\";\n\t * \tvar sActionName = \"create\";\n\t *\n\t * \t//simple parameters as Object\n\t * \tvar vNavigationParameters = {\n\t * \t\tCompanyCode : \"0001\",\n\t * \t\tCustomer : \"C0001\"\n\t * \t};\n\t *\n\t * \t//or as selection variant\n\t * \tvar oSelectionVariant = new SelectionVariant();\n\t *\t oSelectionVariant.addSelectOption(\"CompanyCode\", \"I\", \"EQ\", \"0001\");\n\t * \toSelectionVariant.addSelectOption(\"Customer\", \"I\", \"EQ\", \"C0001\");\n\t * \tvNavigationParameters = oSelectionVariant.toJSONString();\n\t *\n\t * \t//or directly from SmartFilterBar\n\t * \tvNavigationParameters = oSmartFilterBar.getDataSuiteFormat();\n\t *\n\t * \t//app state for back navigation\n\t *\t var oInnerAppData = {\n\t * \t\tselectionVariant : oSmartFilterBar.getDataSuiteFormat(),\n\t * \t\ttableVariantId : oSmartTable.getCurrentVariantId(),\n\t * \t\tcustomData : oMyCustomData\n\t * \t};\n\t *\n\t * \t// callback function in case of errors\n\t * \tvar fnOnError = function(oError){\n\t * \t\tvar oi18n = oController.getView().getModel(\"i18n\").getResourceBundle();\n\t * \t\toError.setUIText({oi18n : oi18n, sTextKey : \"OUTBOUND_NAV_ERROR\"});\n\t * \t\toError.showMessageBox();\n\t * \t};\n\t *\n\t * \toNavigationHandler.navigate(sSemanticObject, sActionName, vNavigationParameters, oInnerAppData, fnOnError);\n\t * });\n\t * </code>\n\t */\n\tnavigate(\n\t\tsSemanticObject: string,\n\t\tsActionName: string,\n\t\tvNavigationParameters: object | string,\n\t\toInnerAppData?: InnerAppData,\n\t\tfnOnError?: Function,\n\t\toExternalAppData?: {\n\t\t\tvalueTexts?: object | undefined;\n\t\t\tpresentationVariant?: object | undefined;\n\t\t\tselectionVariant?: object | undefined;\n\t\t},\n\t\tsNavMode?: string\n\t): void {\n\t\tlet sSelectionVariant: any,\n\t\t\tmParameters,\n\t\t\toXAppDataObj: any,\n\t\t\toStartupParameters,\n\t\t\tbExPlace = false,\n\t\t\toTmpData: any = {};\n\t\tconst oNavHandler: NavigationHandler = this;\n\n\t\tconst oComponentData = this.oComponent.getComponentData() as Record<string, any>;\n\t\t/*\n\t\t * There are some race conditions where the oComponentData may not be set, for example in case the UShell was not initialized properly. To\n\t\t * make sure that we do not dump here with an exception, we take this special error handling behavior:\n\t\t */\n\t\tif (oComponentData) {\n\t\t\toStartupParameters = oComponentData.startupParameters;\n\n\t\t\tif (\n\t\t\t\toStartupParameters &&\n\t\t\t\toStartupParameters[\"sap-ushell-next-navmode\"] &&\n\t\t\t\toStartupParameters[\"sap-ushell-next-navmode\"].length > 0\n\t\t\t) {\n\t\t\t\t// bExPlace = (JSON.parse(oStartupParameters[\"sap-ushell-next-navmode\"][0]) === \"explace\");\n\t\t\t\tbExPlace = oStartupParameters[\"sap-ushell-next-navmode\"][0] === \"explace\";\n\t\t\t}\n\t\t}\n\n\t\t// only nav-mode 'inplace' or 'explace' are supported. Any other value will lead to an exception.\n\t\tif (sNavMode && (sNavMode === \"inplace\" || sNavMode === \"explace\")) {\n\t\t\tbExPlace = sNavMode === \"explace\";\n\t\t} else if (sNavMode) {\n\t\t\tthrow new NavError(\"NavigationHandler.INVALID_NAV_MODE\");\n\t\t}\n\n\t\tif (oExternalAppData === undefined || oExternalAppData === null) {\n\t\t\toXAppDataObj = {};\n\t\t} else {\n\t\t\toXAppDataObj = oExternalAppData;\n\t\t}\n\n\t\t// for navigation we need URL parameters (legacy navigation) and sap-xapp-state, therefore we need to create the missing one from the\n\t\t// passed one\n\t\tif (typeof vNavigationParameters === \"string\") {\n\t\t\tsSelectionVariant = vNavigationParameters;\n\t\t} else if (typeof vNavigationParameters === \"object\") {\n\t\t\tconst oEnrichedSelVar = this._splitInboundNavigationParameters(\n\t\t\t\tnew SelectionVariant(),\n\t\t\t\tvNavigationParameters,\n\t\t\t\t[]\n\t\t\t).oNavigationSelVar;\n\t\t\tsSelectionVariant = oEnrichedSelVar.toJSONString();\n\t\t} else {\n\t\t\tthrow new NavError(\"NavigationHandler.INVALID_INPUT\");\n\t\t}\n\n\t\toTmpData.selectionVariant = new SelectionVariant(sSelectionVariant);\n\t\tif (typeof vNavigationParameters === \"string\") {\n\t\t\toTmpData.selectionVariant = this._removeTechnicalParameters(oTmpData.selectionVariant);\n\t\t}\n\t\toTmpData.selectionVariant = oTmpData.selectionVariant && oTmpData.selectionVariant.toJSONObject();\n\t\toTmpData = this._removeMeasureBasedInformation(oTmpData); // remove eventual measures\n\t\toTmpData = this._checkIsPotentiallySensitive(oTmpData); // remove eventual sensitive data\n\n\t\tif (oTmpData.selectionVariant) {\n\t\t\tmParameters = this._getURLParametersFromSelectionVariant(new SelectionVariant(oTmpData.selectionVariant));\n\t\t\tsSelectionVariant = new SelectionVariant(oTmpData.selectionVariant).toJSONString();\n\t\t} else {\n\t\t\tmParameters = {};\n\t\t\tsSelectionVariant = null;\n\t\t}\n\n\t\tconst oNavArguments: any = {\n\t\t\ttarget: {\n\t\t\t\tsemanticObject: sSemanticObject,\n\t\t\t\taction: sActionName\n\t\t\t},\n\t\t\tparams: mParameters || {}\n\t\t};\n\n\t\tconst fnNavigate = async function (oCrossAppNavService: any): Promise<void> {\n\t\t\tif (!oXAppDataObj.selectionVariant) {\n\t\t\t\toXAppDataObj.selectionVariant = sSelectionVariant;\n\t\t\t}\n\n\t\t\tconst fnNavExplace = function (): void {\n\t\t\t\tconst sNewHrefPromise = oCrossAppNavService.getHref(oNavArguments, oNavHandler.oComponent);\n\t\t\t\tsNewHrefPromise\n\t\t\t\t\t.then(function (sNewHref: string): void {\n\t\t\t\t\t\topenWindow(sNewHref);\n\t\t\t\t\t\treturn;\n\t\t\t\t\t})\n\t\t\t\t\t.catch(function (oError: unknown): void {\n\t\t\t\t\t\tLog.error(\"Error while retireving hrefForExternal : \" + oError);\n\t\t\t\t\t});\n\t\t\t};\n\n\t\t\toXAppDataObj = oNavHandler._removeMeasureBasedInformation(oXAppDataObj);\n\t\t\treturn oNavHandler._fnSaveAppStateAsync(oXAppDataObj, fnOnError).then(function (oSaveAppStateReturn: any): void {\n\t\t\t\tif (oSaveAppStateReturn) {\n\t\t\t\t\toNavArguments.appStateKey = oSaveAppStateReturn.appStateKey;\n\n\t\t\t\t\t// Remark:\n\t\t\t\t\t// The Cross App Service takes care of encoding parameter keys and values. Example:\n\t\t\t\t\t// mParams = { \"$@%\" : \"&/=\" } results in the URL parameter %2524%2540%2525=%2526%252F%253D\n\t\t\t\t\t// Note the double encoding, this is correct.\n\n\t\t\t\t\t// toExternal sets sap-xapp-state in the URL if appStateKey is provided in oNavArguments\n\t\t\t\t\t// toExternal has issues on sticky apps FIORITECHP1-14400, temp fix using hrefForExternal\n\t\t\t\t\tif (sNavMode == \"explace\") {\n\t\t\t\t\t\tfnNavExplace();\n\t\t\t\t\t} else {\n\t\t\t\t\t\tconst ptoExt = oCrossAppNavService.navigate(oNavArguments, oNavHandler.oComponent);\n\t\t\t\t\t\t// TODO: This is just a temporary solution to allow FE V2 to use toExternal promise.\n\t\t\t\t\t\tif (oNavHandler._navigateCallback) {\n\t\t\t\t\t\t\toNavHandler._navigateCallback(ptoExt);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t} // else : error was already reported\n\t\t\t\treturn;\n\t\t\t});\n\t\t};\n\t\tconst fnStoreAndNavigate = function (oCrossAppNavService: any): void {\n\t\t\toNavHandler\n\t\t\t\t.storeInnerAppStateAsync(oInnerAppData as any, true)\n\t\t\t\t.then(async function (sAppStateKey: string): Promise<void> {\n\t\t\t\t\tif (sAppStateKey) {\n\t\t\t\t\t\toNavHandler.replaceHash(sAppStateKey);\n\t\t\t\t\t}\n\t\t\t\t\treturn fnNavigate(oCrossAppNavService);\n\t\t\t\t})\n\t\t\t\t.catch(function (oError: any) {\n\t\t\t\t\tif (fnOnError) {\n\t\t\t\t\t\tfnOnError(oError);\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t};\n\t\tif (sNavMode) {\n\t\t\toNavArguments.params[\"sap-ushell-navmode\"] = bExPlace ? \"explace\" : \"inplace\";\n\t\t}\n\t\toNavHandler\n\t\t\t._getAppNavigationServiceAsync()\n\t\t\t.then(async function (oCrossAppNavService: Navigation) {\n\t\t\t\ttry {\n\t\t\t\t\tconst oTargets = await (oCrossAppNavService.isNavigationSupported(\n\t\t\t\t\t\t[oNavArguments],\n\t\t\t\t\t\toNavHandler.oComponent\n\t\t\t\t\t) as unknown as Promise<{ supported: boolean }[]>);\n\t\t\t\t\tif (oTargets[0].supported) {\n\t\t\t\t\t\tif (!bExPlace) {\n\t\t\t\t\t\t\tfnStoreAndNavigate(oCrossAppNavService);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tfnNavigate(oCrossAppNavService);\n\t\t\t\t\t\t}\n\t\t\t\t\t} else if (fnOnError) {\n\t\t\t\t\t\t// intent is not supported\n\t\t\t\t\t\tconst oError = new NavError(\"NavigationHandler.isIntentSupported.notSupported\");\n\t\t\t\t\t\tfnOnError(oError);\n\t\t\t\t\t}\n\t\t\t\t} catch (oError) {\n\t\t\t\t\tif (fnOnError) {\n\t\t\t\t\t\t// technical error: could not determine if intent is supported\n\t\t\t\t\t\tconst technicalError = oNavHandler._createTechnicalError(\"NavigationHandler.isIntentSupported.failed\");\n\t\t\t\t\t\tfnOnError(technicalError);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\treturn;\n\t\t\t})\n\t\t\t.catch(function (oError: any) {\n\t\t\t\tif (fnOnError) {\n\t\t\t\t\tfnOnError(oError);\n\t\t\t\t}\n\t\t\t});\n\t}\n\n\t/**\n\t * Parses the incoming URL and returns a Promise. If this method detects a back navigation, the inner app state is returned in the resolved\n\t * Promise. Otherwise startup parameters will be merged into the app state provided by cross app navigation, and a combined app state will be\n\t * returned. The conflict resolution can be influenced with sParamHandlingMode defined in the constructor.\n\t * @returns A Promise object to monitor when all the actions of the function have been executed. If the execution is successful, the\n\t *          extracted app state, the startup parameters, and the type of navigation are returned, see also the example above. The app state is\n\t *          an object that contains the following information:\n\t *          <ul>\n\t *          <li><code>oAppData.oSelectionVariant</code>: An instance of {@link sap.fe.navigation.SelectionVariant}\n\t *          containing only parameters/select options that are related to navigation</li>\n\t *          <li><code>oAppData.selectionVariant</code>: The navigation-related selection variant as a JSON-formatted string</li>\n\t *          <li><code>oAppData.oDefaultedSelectionVariant</code>: An instance of\n\t *          {@link sap.fe.navigation.SelectionVariant} containing only the parameters/select options that are set by user\n\t *          default data</li>\n\t *          <li><code>oAppData.bNavSelVarHasDefaultsOnly</code>: A Boolean flag that indicates whether only defaulted parameters and no\n\t *          navigation parameters are present.<br>\n\t *          <b>Note:</b> If no navigation parameters are available, <code>bNavSelVarHasDefaultsOnly</code> is set to <code>true</code>,\n\t *          even though parameters without default might be available as well.</li>\n\t *          </ul>\n\t *          If the navigation-related selection variant is empty, it is replaced by a copy of the defaulted selection variant.<br>\n\t *          The navigation type is an enumeration type of type {@link sap.fe.navigation.NavType} (possible values are\n\t *          initial, URLParams, xAppState, and iAppState).<br>\n\t *          <b>Note:</b> If the navigation type is {@link sap.fe.navigation.NavType.iAppState} oAppData has two\n\t *          additional properties\n\t *          <ul>\n\t *          <li><code>oAppData.tableVariantId</code></li>\n\t *          <li><code>oAppData.customData</code></li>\n\t *          </ul>\n\t *          which return the inner app data as stored in {@link #.navigate navigate} or {@link #.storeInnerAppStateAsync storeInnerAppStateAsync}.\n\t *          <code>oAppData.oDefaultedSelectionVariant</code> is an empty selection variant and\n\t *          <code>oAppData.bNavSelVarHasDefaultsOnly</code> is <code>false</code> in this case.<br>\n\t *          <b>Note:</b> If the navigation type is {@link sap.fe.navigation.NavType.initial} oAppData is an empty object!<br>\n\t *          If an error occurs, an error object of type {@link sap.fe.navigation.NavError}, URL parameters (if available)\n\t *          and the type of navigation are returned.\n\t * @public\n\t * @example <code>\n\t * sap.ui.define([\"sap/fe/navigation/NavigationHandler\"], function (NavigationHandler) {\n\t * \tvar oNavigationHandler = new NavigationHandler(oController);\n\t * \tvar oParseNavigationPromise = oNavigationHandler.parseNavigation();\n\t *\n\t * \toParseNavigationPromise.done(function(oAppData, oStartupParameters, sNavType){\n\t * \t\t\toSmartFilterBar.setDataSuiteFormat(oAppData.selectionVariant);\n\t * \t\t\t// oAppData.oSelectionVariant can be used to manipulate the selection variant\n\t * \t\t\t// oAppData.oDefaultedSelectionVariant contains the parameters which are set by user defaults\n\t * \t\t\t// oAppData.bNavSelVarHasDefaultsOnly indicates whether only defaulted parameters and no navigation parameters are present\n\t * \t});\n\t * \toParseNavigationPromise.fail(function(oError, oURLParameters, sNavType){\n\t * \t\t// if e.g. the xapp state could not be loaded, nevertheless there may be URL parameters available\n\t * \t\t//some error handling\n\t * \t});\n\t * });\n\t * </code>\n\t */\n\t// eslint-disable-next-line @typescript-eslint/promise-function-async\n\tparseNavigation(): JQuery.Promise<unknown> {\n\t\tconst sAppHash = HashChanger.getInstance().getHash();\n\t\t/*\n\t\t * use .getHash() here instead of .getAppHash() to also be able dealing with environments where only SAPUI5 is loaded and the UShell is\n\t\t * not initialized properly.\n\t\t */\n\t\tconst sIAppState = this._getInnerAppStateKey(sAppHash);\n\n\t\tlet oComponentData = this.oComponent.getComponentData() as Record<string, unknown>;\n\t\t/*\n\t\t * There are some race conditions where the oComponentData may not be set, for example in case the UShell was not initialized properly. To\n\t\t * make sure that we do not dump here with an exception, we take this special error handling behavior:\n\t\t */\n\t\tif (oComponentData === undefined) {\n\t\t\tLog.warning(\"The navigation Component's data was not set properly; assuming instead that no parameters are provided.\");\n\t\t\toComponentData = {};\n\t\t}\n\n\t\t// Remark:\n\t\t// The startup parameters are already decoded. Example:\n\t\t// The original URL parameter %2524%2540%2525=%2526%252F%253D results in oStartupParameters = { \"$@%\" : \"&/=\" }\n\t\t// Note the double encoding in the URL, this is correct. An URL parameter like xyz=%25 causes an \"URI malformed\" error.\n\t\t// If the decoded value should be e.g. \"%25\", the parameter in the URL needs to be: xyz=%252525\n\t\tconst oStartupParameters = oComponentData.startupParameters as Record<string, any>;\n\t\tconst hybridIAppStateKeyParams: string | undefined = oStartupParameters?.[HYBRID_IAPP_STATE_KEY]?.[0];\n\t\tconst hybridDeferred = jQuery.Deferred() as JQuery.Deferred<unknown>;\n\t\tlet iAppStateHybridDeferred: JQuery.Deferred<unknown> | undefined;\n\t\tif (hybridIAppStateKeyParams !== undefined) {\n\t\t\tiAppStateHybridDeferred = this._loadAppState(hybridIAppStateKeyParams, hybridDeferred, NavType.hybrid);\n\t\t}\n\n\t\tlet aDefaultedParameters: any = [];\n\t\tif (\n\t\t\toStartupParameters &&\n\t\t\toStartupParameters[DEFAULTED_PARAMETER_PROPERTY] &&\n\t\t\toStartupParameters[DEFAULTED_PARAMETER_PROPERTY].length > 0\n\t\t) {\n\t\t\taDefaultedParameters = JSON.parse(oStartupParameters[DEFAULTED_PARAMETER_PROPERTY][0]);\n\t\t}\n\n\t\tconst oMyDeferred = jQuery.Deferred() as JQuery.Deferred<unknown>;\n\n\t\tconst oNavHandler = this;\n\t\tconst parseUrlParams = function (\n\t\t\toSubStartupParameters: any,\n\t\t\taSubDefaultedParameters: any,\n\t\t\toSubMyDeferred: JQuery.Deferred<unknown>,\n\t\t\tsNavType: string\n\t\t): void {\n\t\t\t// standard URL navigation\n\t\t\tconst oSelVars = oNavHandler._splitInboundNavigationParameters(\n\t\t\t\tnew SelectionVariant(),\n\t\t\t\toSubStartupParameters,\n\t\t\t\taSubDefaultedParameters\n\t\t\t);\n\t\t\t// For scenario, where only hybridIAppStateKey is part of urlParams, we ignore this condition\n\t\t\tif (oSelVars.oNavigationSelVar.isEmpty() && oSelVars.oDefaultedSelVar.isEmpty() && sNavType !== NavType.hybrid) {\n\t\t\t\t// Startup parameters contain only technical parameters (SAP system) which were filtered out.\n\t\t\t\t// oNavigationSelVar and oDefaultedSelVar are empty.\n\t\t\t\t// Thus, consider this type of navigation as an initial navigation.\n\t\t\t\tif (sNavType === NavType.xAppState) {\n\t\t\t\t\tconst oError = oNavHandler._createTechnicalError(\"NavigationHandler.getDataFromAppState.failed\");\n\t\t\t\t\toSubMyDeferred.reject(oError, oSubStartupParameters || {}, NavType.xAppState);\n\t\t\t\t} else {\n\t\t\t\t\toSubMyDeferred.resolve({}, oSubStartupParameters, NavType.initial);\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tconst oAppStateData: any = {};\n\t\t\t\toAppStateData.selectionVariant = oSelVars.oNavigationSelVar.toJSONString();\n\t\t\t\toAppStateData.oSelectionVariant = oSelVars.oNavigationSelVar;\n\t\t\t\toAppStateData.oDefaultedSelectionVariant = oSelVars.oDefaultedSelVar;\n\t\t\t\toAppStateData.bNavSelVarHasDefaultsOnly = oSelVars.bNavSelVarHasDefaultsOnly;\n\n\t\t\t\t// no sap-xapp-state but navType is hybrid, extract the IAppStateData\n\t\t\t\tif (sNavType === NavType.hybrid) {\n\t\t\t\t\tconst successHandlerHybridState = function (iAppStateData: unknown, _ref: unknown, navType: unknown): void {\n\t\t\t\t\t\toAppStateData.iAppState = iAppStateData;\n\t\t\t\t\t\toSubMyDeferred.resolve(oAppStateData, oStartupParameters, navType);\n\t\t\t\t\t};\n\t\t\t\t\tconst failureHandlerHybridState = function (oError: object, _ref: object, navType: string): void {\n\t\t\t\t\t\toSubMyDeferred.reject(oError, _ref, navType);\n\t\t\t\t\t};\n\n\t\t\t\t\tif (iAppStateHybridDeferred !== undefined) {\n\t\t\t\t\t\tiAppStateHybridDeferred.done(successHandlerHybridState);\n\t\t\t\t\t\tiAppStateHybridDeferred.fail(failureHandlerHybridState);\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\toSubMyDeferred.resolve(oAppStateData, oSubStartupParameters, sNavType);\n\t\t\t\t}\n\t\t\t}\n\t\t};\n\t\tif (sIAppState) {\n\t\t\t// inner app state is available in the AppHash (back navigation); extract the parameter value\n\t\t\tthis._loadAppState(sIAppState, oMyDeferred, NavType.iAppState);\n\t\t} else {\n\t\t\t// no back navigation\n\t\t\tconst bIsXappStateNavigation = oComponentData[\"sap-xapp-state\"] !== undefined;\n\t\t\tif (bIsXappStateNavigation) {\n\t\t\t\tconst that = this;\n\t\t\t\t// inner app state was not found in the AppHash, but xapp state => try to read the xapp state\n\t\t\t\tthis._getAppNavigationServiceAsync()\n\t\t\t\t\t.then(function (oCrossAppNavService: any) {\n\t\t\t\t\t\treturn oCrossAppNavService.getStartupAppState(that.oComponent);\n\t\t\t\t\t})\n\t\t\t\t\t.catch(function () {\n\t\t\t\t\t\tconst oError = oNavHandler._createTechnicalError(\"NavigationHandler.getStartupState.failed\");\n\t\t\t\t\t\toMyDeferred.reject(oError, {}, NavType.xAppState);\n\t\t\t\t\t})\n\t\t\t\t\t// eslint-disable-next-line @typescript-eslint/promise-function-async\n\t\t\t\t\t.then(function (oAppState: ShellAppState): JQuery.Promise<unknown> | undefined {\n\t\t\t\t\t\t// get app state from sap-xapp-state,\n\t\t\t\t\t\t// create a copy, not only a reference, because we want to modify the object\n\t\t\t\t\t\tlet oAppStateData = oAppState.getData();\n\t\t\t\t\t\tlet oError;\n\t\t\t\t\t\tif (oAppStateData) {\n\t\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\t\toAppStateData = JSON.parse(JSON.stringify(oAppStateData));\n\t\t\t\t\t\t\t} catch (x) {\n\t\t\t\t\t\t\t\toError = oNavHandler._createTechnicalError(\"NavigationHandler.AppStateData.parseError\");\n\t\t\t\t\t\t\t\toMyDeferred.reject(oError, oStartupParameters, NavType.xAppState);\n\t\t\t\t\t\t\t\treturn oMyDeferred.promise();\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif (oAppStateData) {\n\t\t\t\t\t\t\tconst oSelVar = new SelectionVariant(oAppStateData.selectionVariant);\n\n\t\t\t\t\t\t\tconst oSelVars = oNavHandler._splitInboundNavigationParameters(\n\t\t\t\t\t\t\t\toSelVar,\n\t\t\t\t\t\t\t\toStartupParameters,\n\t\t\t\t\t\t\t\taDefaultedParameters\n\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\toAppStateData.selectionVariant = oSelVars.oNavigationSelVar.toJSONString();\n\t\t\t\t\t\t\toAppStateData.oSelectionVariant = oSelVars.oNavigationSelVar;\n\t\t\t\t\t\t\toAppStateData.oDefaultedSelectionVariant = oSelVars.oDefaultedSelVar;\n\t\t\t\t\t\t\toAppStateData.bNavSelVarHasDefaultsOnly = oSelVars.bNavSelVarHasDefaultsOnly;\n\t\t\t\t\t\t\tconst successHandlerHybridState = function (iAppStateData: unknown, _ref: unknown, navType: unknown): void {\n\t\t\t\t\t\t\t\toAppStateData.iAppState = iAppStateData;\n\t\t\t\t\t\t\t\toMyDeferred.resolve(oAppStateData, oStartupParameters, navType);\n\t\t\t\t\t\t\t};\n\t\t\t\t\t\t\tconst failureHandlerHybridState = function (error: object, _ref: object, navType: string): void {\n\t\t\t\t\t\t\t\terror = oNavHandler._createTechnicalError(\"NavigationHandler.getAppState.failed\");\n\t\t\t\t\t\t\t\toMyDeferred.reject(error, _ref, navType);\n\t\t\t\t\t\t\t};\n\t\t\t\t\t\t\tif (hybridIAppStateKeyParams !== undefined && iAppStateHybridDeferred !== undefined) {\n\t\t\t\t\t\t\t\tiAppStateHybridDeferred.done(successHandlerHybridState);\n\t\t\t\t\t\t\t\tiAppStateHybridDeferred.fail(failureHandlerHybridState);\n\t\t\t\t\t\t\t} else if (oAppStateData[HYBRID_IAPP_STATE_KEY]) {\n\t\t\t\t\t\t\t\tthat._loadAppState(oAppStateData[HYBRID_IAPP_STATE_KEY] as string, hybridDeferred, NavType.hybrid).done(\n\t\t\t\t\t\t\t\t\tsuccessHandlerHybridState\n\t\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\toMyDeferred.resolve(oAppStateData, oStartupParameters, NavType.xAppState);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t} else if (oStartupParameters) {\n\t\t\t\t\t\t\tparseUrlParams(oStartupParameters, aDefaultedParameters, oMyDeferred, NavType.xAppState);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t// sap-xapp-state navigation, but ID has already expired, but URL parameters available\n\t\t\t\t\t\t\toError = oNavHandler._createTechnicalError(\"NavigationHandler.getDataFromAppState.failed\");\n\t\t\t\t\t\t\toMyDeferred.reject(oError, oStartupParameters || {}, NavType.xAppState);\n\t\t\t\t\t\t}\n\t\t\t\t\t\treturn;\n\t\t\t\t\t})\n\t\t\t\t\t.catch(function () {\n\t\t\t\t\t\tconst oError = oNavHandler._createTechnicalError(\"NavigationHandler._getAppNavigationServiceAsync.failed\");\n\t\t\t\t\t\toMyDeferred.reject(oError, {}, NavType.xAppState);\n\t\t\t\t\t});\n\t\t\t} else if (oStartupParameters) {\n\t\t\t\t// no sap-xapp-state\n\t\t\t\tparseUrlParams(\n\t\t\t\t\toStartupParameters,\n\t\t\t\t\taDefaultedParameters,\n\t\t\t\t\toMyDeferred,\n\t\t\t\t\thybridIAppStateKeyParams !== undefined ? NavType.hybrid : NavType.URLParams\n\t\t\t\t);\n\t\t\t} else {\n\t\t\t\t// initial navigation\n\t\t\t\toMyDeferred.resolve({}, {}, NavType.initial);\n\t\t\t}\n\t\t}\n\n\t\treturn oMyDeferred.promise();\n\t}\n\n\t/**\n\t * Sets the application specific technical parameters. Technical parameters will not be added to the selection variant passed to the\n\t * application. As a default the following values are considered as technical parameters:\n\t * <ul>\n\t * <li><code>sap-system</code></li>\n\t * <li><code>sap-ushell-defaultedParameterNames</code></li>\n\t * <li><code>\"hcpApplicationId\"</code></li>\n\t * </ul>.\n\t * @public\n\t * @param aTechnicalParameters List of parameter names to be considered as technical parameters. <code>null</code> or\n\t *        <code>undefined</code> may be used to reset the complete list.\n\t */\n\tsetTechnicalParameters(aTechnicalParameters?: any[]): void {\n\t\tif (!aTechnicalParameters) {\n\t\t\taTechnicalParameters = [];\n\t\t}\n\n\t\tif (!Array.isArray(aTechnicalParameters)) {\n\t\t\tLog.error(\"NavigationHandler: parameter incorrect, array of strings expected\");\n\t\t\tthrow new NavError(\"NavigationHandler.INVALID_INPUT\");\n\t\t}\n\n\t\tthis._aTechnicalParamaters = aTechnicalParameters;\n\t}\n\n\t/**\n\t * Gets the application specific technical parameters. Technical parameters will not be added to the selection variant passed to the\n\t * application. As a default the following values are considered as technical parameters:\n\t * <ul>\n\t * <li><code>sap-system</code></li>\n\t * <li><code>sap-ushell-defaultedParameterNames</code></li>\n\t * <li><code>\"hcpApplicationId\"</code></li>\n\t * </ul>.\n\t * @public\n\t * @returns An Array containing the technical parameters.\n\t */\n\tgetTechnicalParameters(): string[] {\n\t\treturn this._aTechnicalParamaters.concat([]);\n\t}\n\n\t/**\n\t * Checks if the passed parameter is considered as technical parameter.\n\t * @param sParameterName Name of a request parameter, considered as technical parameter.\n\t * @returns Indicates if the parameter is considered as technical parameter or not.\n\t * @private\n\t */\n\t_isTechnicalParameter(sParameterName: string): boolean {\n\t\tif (sParameterName) {\n\t\t\tif (\n\t\t\t\t!(\n\t\t\t\t\tsParameterName === \"sap-ui-fe-variant-id\" ||\n\t\t\t\t\tsParameterName === \"sap-ui-fe-table-variant-id\" ||\n\t\t\t\t\tsParameterName === \"sap-ui-fe-chart-variant-id\" ||\n\t\t\t\t\tsParameterName === \"sap-ui-fe-filterbar-variant-id\"\n\t\t\t\t)\n\t\t\t) {\n\t\t\t\tif (sParameterName.toLowerCase().indexOf(\"sap-\") === 0) {\n\t\t\t\t\treturn true;\n\t\t\t\t} else if (this._aTechnicalParamaters.includes(sParameterName)) {\n\t\t\t\t\treturn true;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\treturn false;\n\t}\n\n\t_isFEParameter(sParameterName: string): boolean {\n\t\treturn sParameterName.toLowerCase().indexOf(\"sap-ui-fe\") === 0;\n\t}\n\n\t/**\n\t * Rmoves if the passed parameter is considered as technical parameter.\n\t * @param oSelectionVariant Selection Variant which consists of technical Parameters.\n\t * @returns Selection Variant without technical Parameters.\n\t * @private\n\t */\n\t_removeTechnicalParameters(oSelectionVariant: SelectionVariant): SelectionVariant {\n\t\tlet sPropName, i;\n\t\tconst aSelVarPropNames = oSelectionVariant.getSelectOptionsPropertyNames();\n\t\tfor (i = 0; i < aSelVarPropNames.length; i++) {\n\t\t\tsPropName = aSelVarPropNames[i];\n\t\t\tif (this._isTechnicalParameter(sPropName)) {\n\t\t\t\toSelectionVariant.removeSelectOption(sPropName);\n\t\t\t}\n\t\t}\n\t\treturn oSelectionVariant;\n\t}\n\n\t/**\n\t * Splits the parameters provided during inbound navigation and separates the contextual information between defaulted parameter values and\n\t * navigation parameters.\n\t * @param oSelectionVariant Instance of {@link sap.fe.navigation.SelectionVariant} containing navigation data of\n\t *        the app\n\t * @param oStartupParameters Object containing startup parameters of the app (derived from the component)\n\t * @param aDefaultedParameters Array containing defaulted parameter names\n\t * @returns Object containing two SelectionVariants, one for navigation (oNavigationSelVar) and one for defaulted startup parameters\n\t *          (oDefaultedSelVar), and a flag (bNavSelVarHasDefaultsOnly) indicating whether all parameters were defaulted. The function is\n\t *          handed two objects containing parameters (names and their corresponding values), oSelectionVariant and oStartupParameters. A\n\t *          parameter could be stored in just one of these two objects or in both of them simultaneously. Because of the latter case a\n\t *          parameter could be associated with conflicting values and it is the job of this function to resolve any such conflict. Parameters\n\t *          are assigned to the two returned SelectionVariants, oNavigationSelVar and oDefaultedSelVar, as follows: | parameter NOT in |\n\t *          parameter in | oSelectionVariant | oSelectionVariant ---------------------------------------|------------------ parameter NOT in |\n\t *          nothing to do | Add parameter oStartupParameters | here | (see below) ----------------------------------------------------------\n\t *          parameter in | Add parameter | Conflict resolution oStartupParameters | (see below) | (see below) Add parameter: if parameter in\n\t *          aDefaultedParameters: add parameter to oDefaultedSelVar else: add parameter to oNavigationSelVar Conflict resolution: if parameter\n\t *          in aDefaultedParameters: add parameter value from oSelectionVariant to oNavigationSelVar add parameter value from\n\t *          oStartupParameters to oDefaultedSelVar Note: This case only occurs in UI5 1.32. In later versions UShell stores any defaulted\n\t *          parameter either in oSelectionVariant or oStartupParameters but never simultaneously in both. else: Choose 1 of the following\n\t *          options based on given handling mode (this.sParamHandlingMode). -> add parameter value from oStartupParameters to\n\t *          oNavigationSelVar | -> add parameter value from oAppState.selectionVariant to oNavigationSelVar -> add both parameter values to\n\t *          navigationSelVar If navigationSelVar is still empty at the end of execution, navigationSelVar is replaced by a copy of\n\t *          oDefaultedSelVar and the flag bNavSelVarHasDefaultsOnly is set to true. The selection variant oDefaultedSelVar itself is always\n\t *          returned as is.\n\t * @private\n\t */\n\t_splitInboundNavigationParameters(\n\t\toSelectionVariant: SelectionVariant,\n\t\toStartupParameters: Record<string, any>,\n\t\taDefaultedParameters: any[]\n\t): {\n\t\toNavigationSelVar: SelectionVariant;\n\t\toDefaultedSelVar: SelectionVariant;\n\t\tbNavSelVarHasDefaultsOnly: boolean;\n\t} {\n\t\tif (!Array.isArray(aDefaultedParameters)) {\n\t\t\tthrow new NavError(\"NavigationHandler.INVALID_INPUT\");\n\t\t}\n\n\t\tlet sPropName, i;\n\t\t// First we do some parsing of the StartUp Parameters.\n\t\tconst oStartupParametersAdjusted: { [key: string]: any } = {};\n\t\tfor (sPropName in oStartupParameters) {\n\t\t\tif (!oStartupParameters.hasOwnProperty(sPropName)) {\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\t// if (sPropName === SAP_SYSTEM_PROPERTY || sPropName === DEFAULTED_PARAMETER_PROPERTY) {\n\t\t\tif (this._isTechnicalParameter(sPropName) || this._isFEParameter(sPropName) || sPropName === HYBRID_IAPP_STATE_KEY) {\n\t\t\t\t// Do not add the SAP system parameter to the selection variant as it is a technical parameter\n\t\t\t\t// not relevant for the selection variant.\n\t\t\t\t// Do not add the startup parameter for default values to the selection variant. The information, which parameters\n\t\t\t\t// are defaulted, is available in the defaulted selection variant.\n\t\t\t\t// In case, FE Parameters we shall skip it.(the application needs to fetch it from URL params)\n\t\t\t\t// Skip the hybridIAppStateKey present as part of 'Hybrid' navigation type not relevant for the selection variant\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\t// We support parameters as a map with strings and as a map with value arrays\n\t\t\tif (typeof oStartupParameters[sPropName] === \"string\") {\n\t\t\t\toStartupParametersAdjusted[sPropName] = oStartupParameters[sPropName];\n\t\t\t} else if (Array.isArray(oStartupParameters[sPropName]) && oStartupParameters[sPropName].length === 1) {\n\t\t\t\toStartupParametersAdjusted[sPropName] = oStartupParameters[sPropName][0]; // single-valued parameters\n\t\t\t} else if (Array.isArray(oStartupParameters[sPropName]) && oStartupParameters[sPropName].length > 1) {\n\t\t\t\toStartupParametersAdjusted[sPropName] = oStartupParameters[sPropName]; // multi-valued parameters\n\t\t\t} else {\n\t\t\t\tthrow new NavError(\"NavigationHandler.INVALID_INPUT\");\n\t\t\t}\n\t\t}\n\n\t\t// Construct two selection variants for defaults and navigation to be returned by the function.\n\t\tconst oDefaultedSelVar = new SelectionVariant();\n\t\tconst oNavigationSelVar = new SelectionVariant();\n\n\t\tconst aSelVarPropNames = oSelectionVariant.getParameterNames().concat(oSelectionVariant.getSelectOptionsPropertyNames());\n\t\tfor (i = 0; i < aSelVarPropNames.length; i++) {\n\t\t\tsPropName = aSelVarPropNames[i];\n\t\t\tif (sPropName in oStartupParametersAdjusted) {\n\t\t\t\t// Resolve conflict.\n\t\t\t\tif (aDefaultedParameters.includes(sPropName)) {\n\t\t\t\t\toNavigationSelVar.massAddSelectOption(sPropName, oSelectionVariant.getValue(sPropName)!);\n\t\t\t\t\tthis._addParameterValues(oDefaultedSelVar, sPropName, \"I\", \"EQ\", oStartupParametersAdjusted[sPropName]);\n\t\t\t\t} else {\n\t\t\t\t\tswitch (this.sParamHandlingMode) {\n\t\t\t\t\t\tcase ParamHandlingMode.SelVarWins:\n\t\t\t\t\t\t\toNavigationSelVar.massAddSelectOption(sPropName, oSelectionVariant.getValue(sPropName)!);\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\tcase ParamHandlingMode.URLParamWins:\n\t\t\t\t\t\t\tthis._addParameterValues(oNavigationSelVar, sPropName, \"I\", \"EQ\", oStartupParametersAdjusted[sPropName]);\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\tcase ParamHandlingMode.InsertInSelOpt:\n\t\t\t\t\t\t\toNavigationSelVar.massAddSelectOption(sPropName, oSelectionVariant.getValue(sPropName)!);\n\t\t\t\t\t\t\tthis._addParameterValues(oNavigationSelVar, sPropName, \"I\", \"EQ\", oStartupParametersAdjusted[sPropName]);\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\tdefault:\n\t\t\t\t\t\t\tthrow new NavError(\"NavigationHandler.INVALID_INPUT\");\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t} else if (aDefaultedParameters.includes(sPropName)) {\n\t\t\t\t// parameter only in SelVar\n\t\t\t\toDefaultedSelVar.massAddSelectOption(sPropName, oSelectionVariant.getValue(sPropName)!);\n\t\t\t} else {\n\t\t\t\toNavigationSelVar.massAddSelectOption(sPropName, oSelectionVariant.getValue(sPropName)!);\n\t\t\t}\n\t\t}\n\n\t\tfor (sPropName in oStartupParametersAdjusted) {\n\t\t\t// The case where the parameter appears twice has already been taken care of above so we skip it here.\n\t\t\tif (aSelVarPropNames.includes(sPropName)) {\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\tif (aDefaultedParameters.includes(sPropName)) {\n\t\t\t\tthis._addParameterValues(oDefaultedSelVar, sPropName, \"I\", \"EQ\", oStartupParametersAdjusted[sPropName]);\n\t\t\t} else {\n\t\t\t\tthis._addParameterValues(oNavigationSelVar, sPropName, \"I\", \"EQ\", oStartupParametersAdjusted[sPropName]);\n\t\t\t}\n\t\t}\n\n\t\t// the selection variant used for navigation should be filled with defaults in case that only defaults exist\n\t\tlet bNavSelVarHasDefaultsOnly = false;\n\t\tif (oNavigationSelVar.isEmpty()) {\n\t\t\tbNavSelVarHasDefaultsOnly = true;\n\t\t\tconst aPropNames = oDefaultedSelVar.getSelectOptionsPropertyNames();\n\t\t\tfor (i = 0; i < aPropNames.length; i++) {\n\t\t\t\toNavigationSelVar.massAddSelectOption(aPropNames[i], oDefaultedSelVar.getValue(aPropNames[i])!);\n\t\t\t}\n\t\t}\n\n\t\treturn {\n\t\t\toNavigationSelVar: oNavigationSelVar,\n\t\t\toDefaultedSelVar: oDefaultedSelVar,\n\t\t\tbNavSelVarHasDefaultsOnly: bNavSelVarHasDefaultsOnly\n\t\t};\n\t}\n\n\t_addParameterValues(\n\t\toSelVariant: SelectionVariant,\n\t\tsPropName: string,\n\t\tsSign: string,\n\t\tsOption: string,\n\t\toValues: string | string[]\n\t): void {\n\t\tif (Array.isArray(oValues)) {\n\t\t\tfor (let i = 0; i < oValues.length; i++) {\n\t\t\t\toSelVariant.addSelectOption(sPropName, sSign, sOption, oValues[i]);\n\t\t\t}\n\t\t} else {\n\t\t\toSelVariant.addSelectOption(sPropName, sSign, sOption, oValues);\n\t\t}\n\t}\n\n\t/**\n\t * Changes the URL according to the current sAppStateKey. As an reaction route change event will be triggered.\n\t * @param sAppStateKey The new app state key.\n\t * @public\n\t */\n\treplaceHash(sAppStateKey: string): void {\n\t\tconst oHashChanger = this.oRouter.oHashChanger ? this.oRouter.oHashChanger : HashChanger.getInstance();\n\t\tconst sAppHashOld = oHashChanger.getHash();\n\t\t/*\n\t\t * use .getHash() here instead of .getAppHash() to also be able dealing with environments where only SAPUI5 is loaded and the UShell is\n\t\t * not initialized properly.\n\t\t */\n\t\tconst sAppHashNew = this._replaceInnerAppStateKey(sAppHashOld, sAppStateKey);\n\t\toHashChanger.replaceHash(sAppHashNew);\n\t}\n\n\t/**\n\t * Changes the URL according to the current app state and stores the app state for later retrieval.\n\t * @param mInnerAppData Object containing the current state of the app\n\t * @param bImmediateHashReplace If set to false, the inner app hash will not be replaced until storing is successful; do not\n\t *        set to false if you cannot react to the resolution of the Promise, for example, when calling the beforeLinkPressed event\n\t * @param bSkipHashReplace If set to true, the inner app hash will not be replaced in the storeInnerAppStateAsync. Also the bImmediateHashReplace\n\t * \t\t  will be ignored.\n\t * @returns A Promise object to monitor when all the actions of the function have been executed; if the execution is successful, the\n\t *          app state key is returned; if an error occurs, an object of type {@link sap.fe.navigation.NavError} is\n\t *          returned\n\t * @public\n\t * @example <code>\n\t * sap.ui.define([\"sap/fe/navigation/NavigationHandler\"], function (NavigationHandler) {\n\t * \tvar oNavigationHandler = new NavigationHandler(oController);\n\t * \tvar mInnerAppData = {\n\t * \t\tselectionVariant : oSmartFilterBar.getDataSuiteFormat(),\n\t * \t\ttableVariantId : oSmartTable.getCurrentVariantId(),\n\t * \t\tcustomData : oMyCustomData\n\t * \t};\n\t *\n\t * \tvar oStoreInnerAppStatePromise = oNavigationHandler.storeInnerAppStateAsync(mInnerAppData);\n\t *\n\t * \toStoreInnerAppStatePromise.done(function(sAppStateKey){\n\t * \t\t//your inner app state is saved now, sAppStateKey was added to URL\n\t * \t\t//perform actions that must run after save\n\t * \t});\n\t *\n\t * \toStoreInnerAppStatePromise.fail(function(oError){\n\t * \t\t//some error handling\n\t * \t});\n\t * });\n\t * </code>\n\t */\n\tstoreInnerAppStateAsync(\n\t\tmInnerAppData: InnerAppData,\n\t\tbImmediateHashReplace?: boolean,\n\t\tbSkipHashReplace?: boolean\n\t): jQuery.Promise<string> {\n\t\tif (typeof bImmediateHashReplace !== \"boolean\") {\n\t\t\tbImmediateHashReplace = true; // default\n\t\t}\n\t\tconst oNavHandler = this;\n\t\tconst oMyDeferred = jQuery.Deferred();\n\n\t\tconst fnReplaceHash = function (sAppStateKey: string): void {\n\t\t\tconst oHashChanger = oNavHandler.oRouter.oHashChanger ? oNavHandler.oRouter.oHashChanger : HashChanger.getInstance();\n\t\t\tconst sAppHashOld = oHashChanger.getHash();\n\t\t\t/*\n\t\t\t * use .getHash() here instead of .getAppHash() to also be able dealing with environments where only SAPUI5 is loaded and the UShell\n\t\t\t * is not initialized properly.\n\t\t\t */\n\t\t\tconst sAppHashNew = oNavHandler._replaceInnerAppStateKey(sAppHashOld, sAppStateKey);\n\t\t\toHashChanger.replaceHash(sAppHashNew);\n\t\t};\n\n\t\t// in case mInnerAppState is empty, do not overwrite the last saved state\n\t\tif (isEmptyObject(mInnerAppData as object)) {\n\t\t\toMyDeferred.resolve(\"\");\n\t\t\treturn oMyDeferred.promise();\n\t\t}\n\n\t\t// check if we already saved the same data\n\t\tconst sAppStateKeyCached = this._oLastSavedInnerAppData.sAppStateKey;\n\n\t\tconst bInnerAppDataEqual = JSON.stringify(mInnerAppData) === JSON.stringify(this._oLastSavedInnerAppData.oAppData);\n\t\tif (bInnerAppDataEqual && sAppStateKeyCached) {\n\t\t\t// passed inner app state found in cache\n\t\t\tthis._oLastSavedInnerAppData.iCacheHit++;\n\n\t\t\t// replace inner app hash with cached appStateKey in url (just in case the app has changed the hash in meantime)\n\t\t\tfnReplaceHash(sAppStateKeyCached);\n\t\t\toMyDeferred.resolve(sAppStateKeyCached);\n\t\t\treturn oMyDeferred.promise();\n\t\t}\n\n\t\t// passed inner app state not found in cache\n\t\tthis._oLastSavedInnerAppData.iCacheMiss++;\n\n\t\tconst fnOnAfterSave = function (sAppStateKey: string): void {\n\t\t\t// replace inner app hash with new appStateKey in url\n\t\t\tif (!bSkipHashReplace && !bImmediateHashReplace) {\n\t\t\t\tfnReplaceHash(sAppStateKey);\n\t\t\t}\n\n\t\t\t// remember last saved state\n\t\t\toNavHandler._oLastSavedInnerAppData.oAppData = mInnerAppData;\n\t\t\toNavHandler._oLastSavedInnerAppData.sAppStateKey = sAppStateKey;\n\t\t\toMyDeferred.resolve(sAppStateKey);\n\t\t};\n\n\t\tconst fnOnError = function (oError: unknown): void {\n\t\t\toMyDeferred.reject(oError);\n\t\t};\n\n\t\tthis._saveAppStateAsync(mInnerAppData, fnOnAfterSave, fnOnError)\n\t\t\t.then(function (sAppStateKey: any) {\n\t\t\t\t/* Note that _sapAppState may return 'undefined' in case that the parsing has failed. In this case, we should not trigger the replacement\n\t\t\t\t * of the App Hash with the generated key, as the container was not written before. Note as well that the error handling has already\n\t\t\t\t * happened before by making the oMyDeferred promise fail (see fnOnError above).\n\t\t\t\t */\n\t\t\t\tif (sAppStateKey !== undefined) {\n\t\t\t\t\t// replace inner app hash with new appStateKey in url\n\t\t\t\t\t// note: we do not wait for the save to be completed: this asynchronously behaviour is necessary if\n\t\t\t\t\t// this method is called e.g. in a onLinkPressed event with no possibility to wait for the promise resolution\n\t\t\t\t\tif (!bSkipHashReplace && bImmediateHashReplace) {\n\t\t\t\t\t\tfnReplaceHash(sAppStateKey);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\treturn;\n\t\t\t})\n\t\t\t.catch(function () {\n\t\t\t\tLog.error(\"NavigationHandler._saveAppStateAsync failed\");\n\t\t\t});\n\n\t\treturn oMyDeferred.promise();\n\t}\n\n\t/**\n\t * Changes the URL according to the current app state and stores the app state for later retrieval.\n\t * @param mInnerAppData Object containing the current state of the app\n\t * @param bImmediateHashReplace If set to false, the inner app hash will not be replaced until storing is successful; do not\n\t *        set to false if you cannot react to the resolution of the Promise, for example, when calling the beforeLinkPressed event\n\t * @returns A Promise object to monitor when all the actions of the function have been executed; if the execution is successful, the\n\t *          app state key is returned; if an error occurs, an object of type {@link sap.fe.navigation.NavError} is\n\t *          returned\n\t * @public\n\t * @example <code>\n\t * sap.ui.define([\"sap/fe/navigation/NavigationHandler\"], function (NavigationHandler) {\n\t * \tvar oNavigationHandler = new NavigationHandler(oController);\n\t * \tvar mInnerAppData = {\n\t * \t\tselectionVariant : oSmartFilterBar.getDataSuiteFormat(),\n\t * \t\ttableVariantId : oSmartTable.getCurrentVariantId(),\n\t * \t\tcustomData : oMyCustomData\n\t * \t};\n\t *\n\t * \tvar oStoreInnerAppStatePromise = oNavigationHandler.storeInnerAppState(mInnerAppData);\n\t *\n\t * \toStoreInnerAppStatePromise.done(function(sAppStateKey){\n\t * \t\t//your inner app state is saved now, sAppStateKey was added to URL\n\t * \t\t//perform actions that must run after save\n\t * \t});\n\t *\n\t * \toStoreInnerAppStatePromise.fail(function(oError){\n\t * \t\t//some error handling\n\t * \t});\n\t * });\n\t * </code>\n\t * @deprecatedsince 1.104\n\t * @deprecated Use the {@link sap.fe.navigation.NavigationHandler.storeInnerAppStateAsync} instead.\n\t */\n\tstoreInnerAppState(mInnerAppData: InnerAppData, bImmediateHashReplace?: boolean): jQuery.Promise<string> {\n\t\tLog.error(\n\t\t\t\"Deprecated API call of 'sap.fe.navigation.NavigationHandler.storeInnerAppState'. Please use 'storeInnerAppStateAsync' instead\",\n\t\t\tundefined,\n\t\t\t\"sap.fe.navigation.NavigationHandler\"\n\t\t);\n\t\tif (typeof bImmediateHashReplace !== \"boolean\") {\n\t\t\tbImmediateHashReplace = true; // default\n\t\t}\n\t\tconst oNavHandler = this;\n\t\tconst oMyDeferred = jQuery.Deferred();\n\n\t\tconst fnReplaceHash = function (sAppStateKey: string): void {\n\t\t\tconst oHashChanger = oNavHandler.oRouter.oHashChanger ? oNavHandler.oRouter.oHashChanger : HashChanger.getInstance();\n\t\t\tconst sAppHashOld = oHashChanger.getHash();\n\t\t\t/*\n\t\t\t * use .getHash() here instead of .getAppHash() to also be able dealing with environments where only SAPUI5 is loaded and the UShell\n\t\t\t * is not initialized properly.\n\t\t\t */\n\t\t\tconst sAppHashNew = oNavHandler._replaceInnerAppStateKey(sAppHashOld, sAppStateKey);\n\t\t\toHashChanger.replaceHash(sAppHashNew);\n\t\t};\n\n\t\t// in case mInnerAppState is empty, do not overwrite the last saved state\n\t\tif (isEmptyObject(mInnerAppData as object)) {\n\t\t\toMyDeferred.resolve(\"\");\n\t\t\treturn oMyDeferred.promise();\n\t\t}\n\n\t\t// check if we already saved the same data\n\t\tconst sAppStateKeyCached = this._oLastSavedInnerAppData.sAppStateKey;\n\n\t\tconst bInnerAppDataEqual = JSON.stringify(mInnerAppData) === JSON.stringify(this._oLastSavedInnerAppData.oAppData);\n\t\tif (bInnerAppDataEqual && sAppStateKeyCached) {\n\t\t\t// passed inner app state found in cache\n\t\t\tthis._oLastSavedInnerAppData.iCacheHit++;\n\n\t\t\t// replace inner app hash with cached appStateKey in url (just in case the app has changed the hash in meantime)\n\t\t\tfnReplaceHash(sAppStateKeyCached);\n\t\t\toMyDeferred.resolve(sAppStateKeyCached);\n\t\t\treturn oMyDeferred.promise();\n\t\t}\n\n\t\t// passed inner app state not found in cache\n\t\tthis._oLastSavedInnerAppData.iCacheMiss++;\n\n\t\tconst fnOnAfterSave = function (sAppStateKey: any): void {\n\t\t\t// replace inner app hash with new appStateKey in url\n\t\t\tif (!bImmediateHashReplace) {\n\t\t\t\tfnReplaceHash(sAppStateKey);\n\t\t\t}\n\n\t\t\t// remember last saved state\n\t\t\toNavHandler._oLastSavedInnerAppData.oAppData = mInnerAppData;\n\t\t\toNavHandler._oLastSavedInnerAppData.sAppStateKey = sAppStateKey;\n\t\t\toMyDeferred.resolve(sAppStateKey);\n\t\t};\n\n\t\tconst fnOnError = function (oError: any): void {\n\t\t\toMyDeferred.reject(oError);\n\t\t};\n\n\t\tconst sAppStateKey = this._saveAppState(mInnerAppData, fnOnAfterSave, fnOnError);\n\t\t/*\n\t\t * Note that _sapAppState may return 'undefined' in case that the parsing has failed. In this case, we should not trigger the replacement\n\t\t * of the App Hash with the generated key, as the container was not written before. Note as well that the error handling has already\n\t\t * happened before by making the oMyDeferred promise fail (see fnOnError above).\n\t\t */\n\t\tif (sAppStateKey !== undefined) {\n\t\t\t// replace inner app hash with new appStateKey in url\n\t\t\t// note: we do not wait for the save to be completed: this asynchronously behaviour is necessary if\n\t\t\t// this method is called e.g. in a onLinkPressed event with no possibility to wait for the promise resolution\n\t\t\tif (bImmediateHashReplace) {\n\t\t\t\tfnReplaceHash(sAppStateKey);\n\t\t\t}\n\t\t}\n\n\t\treturn oMyDeferred.promise();\n\t}\n\n\t/**\n\t * Changes the URL according to the current app state and stores the app state for later retrieval.\n\t * @param mInnerAppData Object containing the current state of the app\n\t * @param bImmediateHashReplace If set to false, the inner app hash will not be replaced until storing is successful; do not\n\t *        set to false if you cannot react to the resolution of the Promise, for example, when calling the beforeLinkPressed event. <b>Note:</b>If\n\t *        not provided it will be treated as set to false. <b>Note:</b>If set to true, the calling instance has to ensure that a follow-on\n\t *        call to <code>replaceHash</code> will take place!\n\t * @returns An object containing the appStateId and a promise object to monitor when all the actions of the function have been\n\t *          executed; Please note that the appStateKey may be undefined or empty.\n\t * @example <code>\n\t * sap.ui.define([\"sap/fe/navigation/NavigationHandler\"], function (NavigationHandler) {\n\t * \tvar oNavigationHandler = new NavigationHandler(oController);\n\t * \tvar mInnerAppData = {\n\t * \t\tselectionVariant : oSmartFilterBar.getDataSuiteFormat(),\n\t * \t\ttableVariantId : oSmartTable.getCurrentVariantId(),\n\t * \t\tcustomData : oMyCustomData\n\t * \t};\n\t *\n\t * \tvar oStoreInnerAppState = storeInnerAppStateWithNonDelayedReturn(mInnerAppData);\n\t * \tvar sAppStateKey = oStoreInnerAppState.appStateKey;\n\t * \tif (!sAppStateKey) {\n\t *    // no appStateKey obtained...\n\t * \t};\n\t * \tvar oStoreInnerAppStatePromise = oStoreInnerAppState.promise;\n\t *\n\t * \toStoreInnerAppStatePromise.done(function(sAppStateKey){\n\t * \t\t//your inner app state is saved now, sAppStateKey was added to URL\n\t * \t\t//perform actions that must run after save\n\t * \t});\n\t *\n\t * \toStoreInnerAppStatePromise.fail(function(oError){\n\t * \t\t//some error handling\n\t * \t});\n\t * });\n\t * </code>\n\t * @public\n\t * @deprecatedsince 1.104\n\t * @deprecated Use the {@link sap.fe.navigation.NavigationHandler.storeInnerAppStateAsync} instead.\n\t */\n\tstoreInnerAppStateWithImmediateReturn(mInnerAppData: InnerAppData, bImmediateHashReplace?: boolean): object {\n\t\tLog.error(\n\t\t\t\"Deprecated API call of 'sap.fe.navigation.NavigationHandler.storeInnerAppStateWithImmediateReturn'. Please use 'storeInnerAppStateAsync' instead\",\n\t\t\tundefined,\n\t\t\t\"sap.fe.navigation.NavigationHandler\"\n\t\t);\n\t\tif (typeof bImmediateHashReplace !== \"boolean\") {\n\t\t\tbImmediateHashReplace = false; // default\n\t\t}\n\n\t\tconst oNavHandler = this;\n\t\tconst oAppStatePromise = jQuery.Deferred();\n\n\t\t// in case mInnerAppState is empty, do not overwrite the last saved state\n\t\tif (isEmptyObject(mInnerAppData)) {\n\t\t\treturn {\n\t\t\t\tappStateKey: \"\",\n\t\t\t\tpromise: oAppStatePromise.resolve(\"\")\n\t\t\t};\n\t\t}\n\n\t\t// check if we already saved the same data\n\t\tconst sAppStateKeyCached = this._oLastSavedInnerAppData.sAppStateKey;\n\n\t\tconst bInnerAppDataEqual = JSON.stringify(mInnerAppData) === JSON.stringify(this._oLastSavedInnerAppData.oAppData);\n\t\tif (bInnerAppDataEqual && sAppStateKeyCached) {\n\t\t\t// passed inner app state found in cache\n\t\t\tthis._oLastSavedInnerAppData.iCacheHit++;\n\t\t\treturn {\n\t\t\t\tappStateKey: sAppStateKeyCached,\n\t\t\t\tpromise: oAppStatePromise.resolve(sAppStateKeyCached)\n\t\t\t};\n\t\t}\n\n\t\t// passed inner app state not found in cache\n\t\tthis._oLastSavedInnerAppData.iCacheMiss++;\n\n\t\tconst fnOnAfterSave = function (sAppStateKey: any): void {\n\t\t\t// replace inner app hash with new appStateKey in url\n\t\t\tif (!bImmediateHashReplace) {\n\t\t\t\toNavHandler.replaceHash(sAppStateKey);\n\t\t\t}\n\n\t\t\t// remember last saved state\n\t\t\toNavHandler._oLastSavedInnerAppData.oAppData = mInnerAppData;\n\t\t\toNavHandler._oLastSavedInnerAppData.sAppStateKey = sAppStateKey;\n\t\t\toAppStatePromise.resolve(sAppStateKey);\n\t\t};\n\n\t\tconst fnOnError = function (oError: any): void {\n\t\t\toAppStatePromise.reject(oError);\n\t\t};\n\n\t\tconst sAppStateKey = this._saveAppState(mInnerAppData, fnOnAfterSave, fnOnError);\n\t\t/*\n\t\t * Note that _sapAppState may return 'undefined' in case that the parsing has failed. In this case, we should not trigger the replacement\n\t\t * of the App Hash with the generated key, as the container was not written before. Note as well that the error handling has already\n\t\t * happened before by making the oMyDeferred promise fail (see fnOnError above).\n\t\t */\n\t\t// if (sAppStateKey !== undefined) {\n\t\t// //replace inner app hash with new appStateKey in url\n\t\t// //note: we do not wait for the save to be completed: this asynchronously behaviour is necessary if\n\t\t// //this method is called e.g. in a onLinkPressed event with no possibility to wait for the promise resolution\n\t\t// if (bImmediateHashReplace) {\n\t\t// fnReplaceHash(sAppStateKey);\n\t\t// }\n\t\t// }\n\t\treturn {\n\t\t\tappStateKey: sAppStateKey,\n\t\t\tpromise: oAppStatePromise.promise()\n\t\t};\n\t}\n\n\t/**\n\t * Processes navigation-related tasks related to beforePopoverOpens event handling for the SmartLink control and returns a Promise object. In\n\t * particular, the following tasks are performed before the SmartLink popover can be opened:\n\t * <ul>\n\t * <li>If <code>mInnerAppData</code> is provided, this inner app state is saved for back navigation at a later time.</li>\n\t * <li>The table event parameters (semantic attributes) and the selection variant data are combined by calling the method\n\t * {@link #.mixAttributesAndSelectionVariant mixAttributesAndSelectionVariant}.</li>\n\t * <li>The combined data is saved as the cross app state to be handed over to the target app, and the corresponding sap-xapp-state key is set\n\t * in the URL.</li>\n\t * <li>All single selections (\"including equal\") of the combined selection data are passed to the SmartLink popover as semantic attributes.</li>\n\t * <li>The method <code>oTableEventParameters.open()</code> is called. Note that this does not really open the popover, but the SmartLink\n\t * control proceeds with firing the event <code>navigationTargetsObtained</code>.</li>\n\t * </ul>.\n\t * <br>\n\t * <b>Node:</b> If the <code>oExternalAppData</code> parameter is not supplied, the external app data will be calculated based on\n\t * the <code>mInnerAppData</code> data.<br>.\n\t * @param oTableEventParameters The parameters made available by the SmartTable control when the SmartLink control has been clicked,\n\t *        an instance of a PopOver object\n\t * @param sSelectionVariant Stringified JSON object as returned, for example, from getDataSuiteFormat() of the SmartFilterBar control\n\t * @param mInnerAppData Object containing the current state of the app. If provided, opening the Popover is deferred until the\n\t *        inner app data is saved in a consistent way.\n\t * @param oExternalAppData Object containing the state which will be passed to the target screen.\n\t * @param oExternalAppData.selectionVariant Object containing selectionVariant, which will be passed to the target screen. If not\n\t *        set the sSelectionVariant will be used.\n\t * @param oExternalAppData.presentationVariant Object containing the current ui presentationVariant of the app, which will be\n\t *        passed to the target screen\n\t * @param oExternalAppData.valueTexts Object containing value descriptions, which will be passed to the target screen\n\t * @returns A Promise object to monitor when all actions of the function have been executed; if the execution is successful, the\n\t *          modified oTableEventParameters is returned; if an error occurs, an error object of type\n\t *          {@link sap.fe.navigation.NavError} is returned\n\t * @public\n\t * @example <code>\n\t * sap.ui.define([\"sap/fe/navigation/NavigationHandler\", \"sap/fe/navigation/SelectionVariant\"], function (NavigationHandler, SelectionVariant) {\n\t * \t//event handler for the smart link event \"beforePopoverOpens\"\n\t * \t\tonBeforePopoverOpens: function(oEvent) {\n\t * \t\t\tvar oTableEventParameters = oEvent.getParameters();\n\t *\n\t * \t\t\tvar mInnerAppData = {\n\t * \t\t\t\tselectionVariant : oSmartFilterBar.getDataSuiteFormat(),\n\t * \t\t\t\ttableVariantId : oSmartTable.getCurrentVariantId(),\n\t * \t\t\t\tcustomData : oMyCustomData\n\t * \t\t\t};\n\t *\n\t * \t\t\tvar oSelectionVariant = new SelectionVariant();\n\t * \t\t\toSelectionVariant.addSelectOption(\"CompanyCode\", \"I\", \"EQ\", \"0001\");\n\t * \t\t\toSelectionVariant.addSelectOption(\"Customer\", \"I\", \"EQ\", \"C0001\");\n\t * \t\t\tvar sSelectionVariant= oSelectionVariant.toJSONString();\n\t *\n\t * \t\t\tvar oNavigationHandler = new NavigationHandler(oController);\n\t * \t\t\tvar oSmartLinkPromise = oNavigationHandler.processBeforeSmartLinkPopoverOpens(oTableEventParameters, sSelectionVariant, mInnerAppData);\n\t *\n\t * \t\t\toSmartLinkPromise.done(function(oTableEventParameters){\n\t * \t\t\t\t// here you can add coding that should run after all app states are saved and the semantic attributes are set\n\t * \t\t\t});\n\t *\n\t * \t\t\toSmartLinkPromise.fail(function(oError){\n\t * \t\t\t//some error handling\n\t * \t\t\t});\n\t * \t\t};\n\t * \t});\n\t * </code>\n\t */\n\t// eslint-disable-next-line @typescript-eslint/promise-function-async\n\tprocessBeforeSmartLinkPopoverOpens(\n\t\toTableEventParameters: any,\n\t\tsSelectionVariant: string,\n\t\tmInnerAppData?: InnerAppData,\n\t\toExternalAppData?: {\n\t\t\tselectionVariant?: object;\n\t\t\tpresentationVariant?: object;\n\t\t\tvalueTexts?: object;\n\t\t}\n\t): JQuery.Promise<string[], unknown, unknown> {\n\t\tconst oMyDeferred = jQuery.Deferred() as JQuery.Deferred<string[], unknown, unknown>;\n\t\tlet mSemanticAttributes: any;\n\t\tif (oTableEventParameters != undefined) {\n\t\t\tmSemanticAttributes = oTableEventParameters.semanticAttributes;\n\t\t}\n\n\t\tlet oXAppDataObj: any;\n\t\tconst oNavHandler: NavigationHandler = this;\n\n\t\tif (oExternalAppData === undefined) {\n\t\t\toXAppDataObj = {};\n\t\t} else {\n\t\t\toXAppDataObj = oExternalAppData;\n\t\t}\n\n\t\tconst fnStoreXappAndCallOpen = function (mSubSemanticAttributes: any, sSubSelectionVariant: any): void {\n\t\t\t// mix the semantic attributes (e.g. from the row line) with the selection variant (e.g. from the filter bar)\n\t\t\tsSubSelectionVariant = oXAppDataObj.selectionVariant || sSubSelectionVariant || \"{}\";\n\n\t\t\tconst iSuppressionBehavior = SuppressionBehavior.raiseErrorOnNull | SuppressionBehavior.raiseErrorOnUndefined;\n\t\t\t/*\n\t\t\t * compatiblity: Until SAPUI5 1.28.5 (or even later) the Smart Link in a Smart Table is filtering all null- and undefined values.\n\t\t\t * Therefore, mSemanticAttributes are already reduced appropriately -- this does not need to be done by\n\t\t\t * mixAttributesAndSelectionVariant again. To ensure that we still have the old behaviour (i.e. an NavError is raised in case that\n\t\t\t * behaviour of the Smart Link control has changed), the \"old\" Suppression Behaviour is retained.\n\t\t\t */\n\n\t\t\tconst oMixedSelVar = oNavHandler.mixAttributesAndSelectionVariant(\n\t\t\t\tmSubSemanticAttributes,\n\t\t\t\tsSubSelectionVariant,\n\t\t\t\tiSuppressionBehavior\n\t\t\t);\n\t\t\tsSubSelectionVariant = oMixedSelVar.toJSONString();\n\n\t\t\t// enrich the semantic attributes with single selections from the selection variant\n\t\t\tlet oTmpData: any = {};\n\t\t\toTmpData.selectionVariant = oMixedSelVar.toJSONObject();\n\n\t\t\toTmpData = oNavHandler._removeMeasureBasedInformation(oTmpData);\n\n\t\t\toTmpData = oNavHandler._checkIsPotentiallySensitive(oTmpData);\n\n\t\t\tmSubSemanticAttributes = oTmpData.selectionVariant\n\t\t\t\t? oNavHandler._getURLParametersFromSelectionVariant(new SelectionVariant(oTmpData.selectionVariant))\n\t\t\t\t: {};\n\n\t\t\tconst fnOnContainerSave = function (sAppStateKey: any): void {\n\t\t\t\tif (oTableEventParameters === undefined) {\n\t\t\t\t\t// If oTableEventParameters is undefined, return both semanticAttributes and appStatekey\n\t\t\t\t\toMyDeferred.resolve(mSubSemanticAttributes, sAppStateKey);\n\t\t\t\t} else {\n\t\t\t\t\t// set the stored data in popover and call open()\n\t\t\t\t\toTableEventParameters.setSemanticAttributes(mSubSemanticAttributes);\n\t\t\t\t\toTableEventParameters.setAppStateKey(sAppStateKey);\n\t\t\t\t\toTableEventParameters.open(); // >>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>> Note that \"open\" does not open the popover, but proceeds\n\t\t\t\t\t// with firing the onNavTargetsObtained event.\n\t\t\t\t\toMyDeferred.resolve(oTableEventParameters);\n\t\t\t\t}\n\t\t\t};\n\n\t\t\tconst fnOnError = function (oError: any): void {\n\t\t\t\toMyDeferred.reject(oError);\n\t\t\t};\n\n\t\t\toXAppDataObj.selectionVariant = sSubSelectionVariant;\n\n\t\t\toXAppDataObj = oNavHandler._removeMeasureBasedInformation(oXAppDataObj);\n\n\t\t\toNavHandler._saveAppStateAsync(oXAppDataObj, fnOnContainerSave, fnOnError);\n\t\t};\n\n\t\tif (mInnerAppData) {\n\t\t\tconst oStoreInnerAppStatePromise = this.storeInnerAppStateAsync(mInnerAppData, true);\n\n\t\t\t// if the inner app state was successfully stored, store also the xapp-state\n\t\t\toStoreInnerAppStatePromise.done(function () {\n\t\t\t\tfnStoreXappAndCallOpen(mSemanticAttributes, sSelectionVariant);\n\t\t\t});\n\n\t\t\toStoreInnerAppStatePromise.fail(function (oError: any) {\n\t\t\t\toMyDeferred.reject(oError);\n\t\t\t});\n\t\t} else {\n\t\t\t// there is no inner app state to save, just put the parameters into xapp-state\n\t\t\tfnStoreXappAndCallOpen(mSemanticAttributes, sSelectionVariant);\n\t\t}\n\n\t\treturn oMyDeferred.promise();\n\t}\n\n\t/**\n\t * Processes selectionVariant string and returns a Promise object (semanticAttributes and AppStateKey).\n\t * @param sSelectionVariant Stringified JSON object\n\t * @returns A Promise object to monitor when all actions of the function have been executed; if the execution is successful, the\n\t *          semanticAttributes as well as the appStateKey are returned; if an error occurs, an error object of type\n\t *          {@link sap.fe.navigation.NavError} is returned\n\t * <br>\n\t * @example <code>\n\t * sap.ui.define([\"sap/fe/navigation/NavigationHandler\", \"sap/fe/navigation/SelectionVariant\"], function (NavigationHandler, SelectionVariant) {\n\t * \t\tvar oSelectionVariant = new SelectionVariant();\n\t * \t\toSelectionVariant.addSelectOption(\"CompanyCode\", \"I\", \"EQ\", \"0001\");\n\t * \t\toSelectionVariant.addSelectOption(\"Customer\", \"I\", \"EQ\", \"C0001\");\n\t * \t\tvar sSelectionVariant= oSelectionVariant.toJSONString();\n\t *\n\t * \t\tvar oNavigationHandler = new NavigationHandler(oController);\n\t * \t\tvar oPromiseObject = oNavigationHandler._getAppStateKeyAndUrlParameters(sSelectionVariant);\n\t *\n\t * \t\toPromiseObject.done(function(oSemanticAttributes, sAppStateKey){\n\t * \t\t\t// here you can add coding that should run after all app state and the semantic attributes have been returned.\n\t * \t\t});\n\t *\n\t * \t\toPromiseObject.fail(function(oError){\n\t * \t\t\t//some error handling\n\t * \t\t});\n\t *\t});\n\t * </code>\n\t * @private\n\t */\n\t// eslint-disable-next-line @typescript-eslint/promise-function-async\n\t_getAppStateKeyAndUrlParameters(sSelectionVariant: string): JQuery.Promise<string[], unknown, unknown> {\n\t\treturn this.processBeforeSmartLinkPopoverOpens(undefined, sSelectionVariant, undefined, undefined);\n\t}\n\n\t/**\n\t * Get App specific hash.\n\t * @param appHash The path string\n\t * @returns A string representing base path\n\t */\n\tasync _getAppSpecificHash(appHash: string): Promise<string | undefined> {\n\t\ttry {\n\t\t\tconst crossAppService = await this._getAppNavigationServiceAsync();\n\t\t\treturn await crossAppService.getHref({ appSpecificRoute: appHash });\n\t\t} catch (error: unknown) {\n\t\t\tconst message = error instanceof Error ? error.message : String(error);\n\t\t\tLog.error(`FE : Can not fetch App sepcific URL : ${message}`);\n\t\t\tthrow Error(message);\n\t\t}\n\t}\n\n\t_mixAttributesToSelVariant(\n\t\tmSemanticAttributes: Record<string, unknown>,\n\t\toSelVariant: SelectionVariant,\n\t\tiSuppressionBehavior: any\n\t): SelectionVariant {\n\t\t// add all semantic attributes to the mixed selection variant\n\t\tfor (const sPropertyName in mSemanticAttributes) {\n\t\t\tif (mSemanticAttributes.hasOwnProperty(sPropertyName)) {\n\t\t\t\t// A value of a semantic attribute may not be a string, but can be e.g. a date.\n\t\t\t\t// Since the selection variant accepts only a string, we have to convert it in dependence of the type.\n\t\t\t\tlet vSemanticAttributeValue = mSemanticAttributes[sPropertyName];\n\t\t\t\tif (vSemanticAttributeValue instanceof Date) {\n\t\t\t\t\t// use the same conversion method for dates as the SmartFilterBar: toJSON()\n\t\t\t\t\tvSemanticAttributeValue = vSemanticAttributeValue.toJSON();\n\t\t\t\t} else if (\n\t\t\t\t\tArray.isArray(vSemanticAttributeValue) ||\n\t\t\t\t\t(vSemanticAttributeValue && typeof vSemanticAttributeValue === \"object\")\n\t\t\t\t) {\n\t\t\t\t\tvSemanticAttributeValue = JSON.stringify(vSemanticAttributeValue);\n\t\t\t\t} else if (typeof vSemanticAttributeValue === \"number\" || typeof vSemanticAttributeValue === \"boolean\") {\n\t\t\t\t\tvSemanticAttributeValue = vSemanticAttributeValue.toString();\n\t\t\t\t}\n\n\t\t\t\tif (vSemanticAttributeValue === \"\") {\n\t\t\t\t\tif (iSuppressionBehavior & SuppressionBehavior.ignoreEmptyString) {\n\t\t\t\t\t\tLog.info(\n\t\t\t\t\t\t\t\"Semantic attribute \" +\n\t\t\t\t\t\t\t\tsPropertyName +\n\t\t\t\t\t\t\t\t\" is an empty string and due to the chosen Suppression Behiavour is being ignored.\"\n\t\t\t\t\t\t);\n\t\t\t\t\t\tcontinue;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tif (vSemanticAttributeValue === null) {\n\t\t\t\t\tif (iSuppressionBehavior & SuppressionBehavior.raiseErrorOnNull) {\n\t\t\t\t\t\tthrow new NavError(\"NavigationHandler.INVALID_INPUT\");\n\t\t\t\t\t} else {\n\t\t\t\t\t\tLog.warning(\"Semantic attribute \" + sPropertyName + \" is null and ignored for mix in to selection variant\");\n\t\t\t\t\t\tcontinue; // ignore!\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tif (vSemanticAttributeValue === undefined) {\n\t\t\t\t\tif (iSuppressionBehavior & SuppressionBehavior.raiseErrorOnUndefined) {\n\t\t\t\t\t\tthrow new NavError(\"NavigationHandler.INVALID_INPUT\");\n\t\t\t\t\t} else {\n\t\t\t\t\t\tLog.warning(\"Semantic attribute \" + sPropertyName + \" is undefined and ignored for mix in to selection variant\");\n\t\t\t\t\t\tcontinue;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tif (typeof vSemanticAttributeValue === \"string\" || vSemanticAttributeValue instanceof String) {\n\t\t\t\t\toSelVariant.addSelectOption(sPropertyName, \"I\", \"EQ\", vSemanticAttributeValue.toString());\n\t\t\t\t} else {\n\t\t\t\t\tthrow new NavError(\"NavigationHandler.INVALID_INPUT\");\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\treturn oSelVariant;\n\t}\n\n\t/**\n\t * Combines the given parameters and selection variant into a new selection variant containing properties from both, with the parameters\n\t * overriding existing properties in the selection variant. The new selection variant does not contain any parameters. All parameters are\n\t * merged into select options. The output of this function, converted to a JSON string, can be used for the\n\t * {@link #.navigate NavigationHandler.navigate} method.\n\t * @param vSemanticAttributes Object/(Array of Objects) containing key/value pairs\n\t * @param sSelectionVariant The selection variant in string format as provided by the SmartFilterBar control\n\t * @param iSuppressionBehavior Indicates whether semantic\n\t *        attributes with special values (see {@link sap.fe.navigation.SuppressionBehavior suppression behavior}) must be\n\t *        suppressed before they are combined with the selection variant; several\n\t *        {@link sap.fe.navigation.SuppressionBehavior suppression behaviors} can be combined with the bitwise OR operator\n\t *        (|)\n\t * @returns Instance of {@link sap.fe.navigation.SelectionVariant}\n\t * @public\n\t * @example <code>\n\t * sap.ui.define([\"sap/fe/navigation/NavigationHandler\", \"sap/fe/navigation/SelectionVariant\"], function (NavigationHandler, SelectionVariant) {\n\t * \tvar vSemanticAttributes = { \"Customer\" : \"C0001\" };\n\t * \tor\n\t * \tvar vSemanticAttributes = [{ \"Customer\" : \"C0001\" },{ \"Customer\" : \"C0002\" }];\n\t * \tvar sSelectionVariant = oSmartFilterBar.getDataSuiteFormat();\n\t * \tvar oNavigationHandler = new NavigationHandler(oController);\n\t * \tvar sNavigationSelectionVariant = oNavigationHandler.mixAttributesAndSelectionVariant(vSemanticAttributes, sSelectionVariant).toJSONString();\n\t * \t// In case of an vSemanticAttributes being an array, the semanticAttributes are merged to a single SV and compared against the sSelectionVariant(second agrument).\n\t * \t// Optionally, you can specify one or several suppression behaviors. Several suppression behaviors are combined with the bitwise OR operator, e.g.\n\t * \t// var iSuppressionBehavior = sap.fe.navigation.SuppressionBehavior.raiseErrorOnNull | sap.fe.navigation.SuppressionBehavior.raiseErrorOnUndefined;\n\t * \t// var sNavigationSelectionVariant = oNavigationHandler.mixAttributesAndSelectionVariant(mSemanticAttributes, sSelectionVariant, iSuppressionBehavior).toJSONString();\n\t *\n\t * \toNavigationHandler.navigate(\"SalesOrder\", \"create\", sNavigationSelectionVariant);\n\t * });\n\t * </code>\n\t */\n\tmixAttributesAndSelectionVariant(\n\t\tvSemanticAttributes: object | any[],\n\t\tsSelectionVariant: string | SerializedSelectionVariant,\n\t\tiSuppressionBehavior: number = SuppressionBehavior.standard\n\t): SelectionVariant {\n\t\tconst oSelectionVariant = new SelectionVariant(sSelectionVariant);\n\t\tconst oNewSelVariant = new SelectionVariant();\n\t\tconst oNavHandler = this;\n\n\t\tconst filterUrl = oSelectionVariant.getFilterContextUrl();\n\t\tif (filterUrl) {\n\t\t\toNewSelVariant.setFilterContextUrl(filterUrl);\n\t\t}\n\n\t\tconst contextUrl = oSelectionVariant.getParameterContextUrl();\n\t\tif (contextUrl) {\n\t\t\toNewSelVariant.setParameterContextUrl(contextUrl);\n\t\t}\n\t\tif (Array.isArray(vSemanticAttributes)) {\n\t\t\tvSemanticAttributes.forEach(function (mSemanticAttributes: any) {\n\t\t\t\toNavHandler._mixAttributesToSelVariant(mSemanticAttributes, oNewSelVariant, iSuppressionBehavior);\n\t\t\t});\n\t\t} else {\n\t\t\tthis._mixAttributesToSelVariant(vSemanticAttributes as Record<string, unknown>, oNewSelVariant, iSuppressionBehavior);\n\t\t}\n\n\t\t// add parameters that are not part of the oNewSelVariant yet\n\t\tconst aParameters = oSelectionVariant.getParameterNames();\n\t\tlet i;\n\t\tfor (i = 0; i < aParameters.length; i++) {\n\t\t\tif (!oNewSelVariant.getSelectOption(aParameters[i])) {\n\t\t\t\toNewSelVariant.addSelectOption(aParameters[i], \"I\", \"EQ\", oSelectionVariant.getParameter(aParameters[i]));\n\t\t\t}\n\t\t}\n\n\t\t// add selOptions that are not part of the oNewSelVariant yet\n\t\tconst aSelOptionNames = oSelectionVariant.getSelectOptionsPropertyNames();\n\t\tfor (i = 0; i < aSelOptionNames.length; i++) {\n\t\t\t// add selOptions that are not part of the oNewSelVariant yet\n\t\t\tconst aSelectOption: any[] = oSelectionVariant.getSelectOption(aSelOptionNames[i])!;\n\t\t\tif (!oNewSelVariant.getSelectOption(aSelOptionNames[i])) {\n\t\t\t\tfor (let j = 0; j < aSelectOption.length; j++) {\n\t\t\t\t\toNewSelVariant.addSelectOption(\n\t\t\t\t\t\taSelOptionNames[i],\n\t\t\t\t\t\taSelectOption[j].Sign,\n\t\t\t\t\t\taSelectOption[j].Option,\n\t\t\t\t\t\taSelectOption[j].Low,\n\t\t\t\t\t\taSelectOption[j].High\n\t\t\t\t\t);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\treturn oNewSelVariant;\n\t}\n\n\t_ensureSelectionVariantFormatString(vSelectionVariant: unknown): unknown {\n\t\t/*\n\t\t * There are legacy AppStates where the SelectionVariant is being stored as a string. However, that is not compliant to the specification,\n\t\t * which states that a standard JS object shall be provided. Internally, however, the selectionVariant is always of type string. Situation\n\t\t * Persistency internal API ---------------- ------------------ --------------------- legacy string string new approach (JSON) object\n\t\t * string\n\t\t */\n\n\t\tif (vSelectionVariant === undefined) {\n\t\t\treturn undefined;\n\t\t}\n\n\t\tlet vConvertedSelectionVariant = vSelectionVariant;\n\n\t\tif (typeof vSelectionVariant === \"object\") {\n\t\t\tvConvertedSelectionVariant = JSON.stringify(vSelectionVariant);\n\t\t}\n\n\t\treturn vConvertedSelectionVariant;\n\t}\n\n\t_fnHandleAppStatePromise(oReturn: ShellAppStateReturn, fnOnAfterSave?: Function, fnOnError?: Function): void {\n\t\toReturn.promise.done(function () {\n\t\t\tif (fnOnAfterSave) {\n\t\t\t\tfnOnAfterSave(oReturn.appStateKey);\n\t\t\t}\n\t\t});\n\n\t\tif (fnOnError) {\n\t\t\tconst oNavHandler = this;\n\t\t\toReturn.promise.fail(function () {\n\t\t\t\tconst oError = oNavHandler._createTechnicalError(\"NavigationHandler.AppStateSave.failed\");\n\t\t\t\tfnOnError(oError);\n\t\t\t});\n\t\t}\n\t}\n\n\tasync _saveAppStateAsync(oAppData: InnerAppData, fnOnAfterSave: Function, fnOnError: Function): Promise<string | undefined> {\n\t\tconst oNavHandler = this;\n\t\treturn this._fnSaveAppStateAsync(oAppData, fnOnError).then(function (\n\t\t\toReturn: ShellAppStateReturn | undefined | void\n\t\t): string | undefined {\n\t\t\tif (oReturn) {\n\t\t\t\toNavHandler._fnHandleAppStatePromise(oReturn, fnOnAfterSave, fnOnError);\n\t\t\t\treturn oReturn.appStateKey;\n\t\t\t}\n\n\t\t\treturn undefined;\n\t\t});\n\t}\n\n\t_saveAppState(oAppData: InnerAppData, fnOnAfterSave: Function, fnOnError: Function): string | undefined {\n\t\tconst oReturn = this._saveAppStateWithImmediateReturn(oAppData, fnOnError);\n\t\tif (oReturn) {\n\t\t\tthis._fnHandleAppStatePromise(oReturn, fnOnAfterSave, fnOnError);\n\t\t\treturn oReturn.appStateKey;\n\t\t}\n\n\t\treturn undefined;\n\t}\n\n\t_fnSaveAppStateWithImmediateReturn(\n\t\toAppData: InnerAppData,\n\t\toAppState: ShellAppState,\n\t\tfnOnError?: Function\n\t): { appStateKey: string; promise: JQuery.Promise<string> } | undefined {\n\t\tconst sAppStateKey = oAppState.getKey();\n\t\tconst oAppDataForSave = this._fetchAppDataForSave(oAppData, fnOnError);\n\t\tif (!oAppDataForSave) {\n\t\t\treturn undefined;\n\t\t}\n\t\toAppState.setData(oAppDataForSave);\n\t\tconst oSavePromise = oAppState.save();\n\n\t\treturn {\n\t\t\tappStateKey: sAppStateKey,\n\t\t\tpromise: oSavePromise.promise()\n\t\t};\n\t}\n\n\t_fetchAppDataForSave(oAppData: InnerAppData, fnOnError: any): InnerAppData | undefined {\n\t\tlet oAppDataForSave: Partial<InnerAppData> = {};\n\n\t\tif (oAppData.hasOwnProperty(\"selectionVariant\")) {\n\t\t\toAppDataForSave.selectionVariant = oAppData.selectionVariant;\n\n\t\t\tif (oAppData.selectionVariant) {\n\t\t\t\t/*\n\t\t\t\t * The specification states that Selection Variants need to be JSON objects. However, internally, we work with strings for\n\t\t\t\t * \"selectionVariant\". Therefore, in case that this is a string, we need to JSON-parse the data.\n\t\t\t\t */\n\t\t\t\tif (typeof oAppData.selectionVariant === \"string\") {\n\t\t\t\t\ttry {\n\t\t\t\t\t\toAppDataForSave.selectionVariant = JSON.parse(oAppData.selectionVariant);\n\t\t\t\t\t} catch (x) {\n\t\t\t\t\t\tconst oError = this._createTechnicalError(\"NavigationHandler.AppStateSave.parseError\");\n\t\t\t\t\t\tif (fnOnError) {\n\t\t\t\t\t\t\tfnOnError(oError);\n\t\t\t\t\t\t}\n\t\t\t\t\t\treturn undefined;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tif (this._sMode === Mode.ODataV2) {\n\t\t\toAppDataForSave = extend(\n\t\t\t\t{\n\t\t\t\t\tselectionVariant: {},\n\t\t\t\t\ttableVariantId: \"\",\n\t\t\t\t\tcustomData: {}\n\t\t\t\t},\n\t\t\t\toAppDataForSave\n\t\t\t) as InnerAppData;\n\n\t\t\tif (oAppData.tableVariantId) {\n\t\t\t\toAppDataForSave.tableVariantId = oAppData.tableVariantId;\n\t\t\t}\n\t\t\tif (oAppData.customData) {\n\t\t\t\toAppDataForSave.customData = oAppData.customData;\n\t\t\t}\n\t\t\tif (oAppData.presentationVariant) {\n\t\t\t\toAppDataForSave.presentationVariant = oAppData.presentationVariant;\n\t\t\t}\n\t\t\tif (oAppData.valueTexts) {\n\t\t\t\toAppDataForSave.valueTexts = oAppData.valueTexts;\n\t\t\t}\n\t\t\tif (oAppData.semanticDates) {\n\t\t\t\toAppDataForSave.semanticDates = oAppData.semanticDates;\n\t\t\t}\n\t\t} else {\n\t\t\tconst oAppDataClone = Object.assign({}, oAppData);\n\t\t\toAppDataForSave = merge(oAppDataClone, oAppDataForSave);\n\t\t}\n\t\toAppDataForSave = this._checkIsPotentiallySensitive(oAppDataForSave) as InnerAppData;\n\t\treturn oAppDataForSave as InnerAppData;\n\t}\n\n\tasync _fnSaveAppStateAsync(oAppData: any, fnOnError?: any): Promise<ShellAppStateReturn | undefined | void> {\n\t\tconst oNavHandler = this;\n\t\treturn this._getAppNavigationServiceAsync()\n\t\t\t.then(async function (oCrossAppNavService: Navigation): Promise<ShellAppState> {\n\t\t\t\treturn oCrossAppNavService.createEmptyAppState(oNavHandler.oComponent);\n\t\t\t})\n\t\t\t.then(function (oAppState: ShellAppState) {\n\t\t\t\treturn oNavHandler._fnSaveAppStateWithImmediateReturn(oAppData, oAppState, fnOnError);\n\t\t\t})\n\t\t\t.catch(function (oError) {\n\t\t\t\tif (fnOnError) {\n\t\t\t\t\tfnOnError(oError);\n\t\t\t\t}\n\t\t\t});\n\t}\n\n\t_saveAppStateWithImmediateReturn(oAppData: InnerAppData, fnOnError?: Function): ShellAppStateReturn | undefined {\n\t\tconst oAppState = this._getAppNavigationService().createEmptyAppState(this.oComponent);\n\t\treturn this._fnSaveAppStateWithImmediateReturn(oAppData, oAppState, fnOnError);\n\t}\n\n\t/**\n\t * Retrieves the loaded IApp State and navigation type once resolved.\n\t * @param sAppStateKey The IAppStateKey to retrieve the AppState data.\n\t * @param oDeferred Jquery deferred object to resolve the AppState data.\n\t * @param navType Navigation type for which AppState is retrieved.\n\t * @returns The deferred object which is resolved with loaded app state data\n\t and navigation type.\n\t * @private\n\t */\n\t_loadAppState(sAppStateKey: string, oDeferred: JQuery.Deferred<unknown>, navType: string): JQuery.Deferred<unknown> {\n\t\tconst oNavHandler = this;\n\t\tthis._getAppNavigationServiceAsync()\n\t\t\t.then(function (oCrossAppNavService: any) {\n\t\t\t\treturn oCrossAppNavService.getAppState(oNavHandler.oComponent, sAppStateKey);\n\t\t\t})\n\t\t\t.catch(function () {\n\t\t\t\tconst oError = oNavHandler._createTechnicalError(\"NavigationHandler._getAppNavigationServiceAsync.failed\");\n\t\t\t\toDeferred.reject(oError, {}, navType);\n\t\t\t})\n\t\t\t.then(function (oAppState: any) {\n\t\t\t\tlet oAppData: any = {};\n\t\t\t\tconst oAppDataLoaded = oAppState.getData();\n\n\t\t\t\tif (typeof oAppDataLoaded === \"undefined\") {\n\t\t\t\t\tconst oError = oNavHandler._createTechnicalError(\"NavigationHandler.getDataFromAppState.failed\");\n\t\t\t\t\toDeferred.reject(oError, {}, navType);\n\t\t\t\t} else if (oNavHandler._sMode === Mode.ODataV2) {\n\t\t\t\t\toAppData = {\n\t\t\t\t\t\tselectionVariant: \"{}\",\n\t\t\t\t\t\toSelectionVariant: new SelectionVariant(),\n\t\t\t\t\t\toDefaultedSelectionVariant: new SelectionVariant(),\n\t\t\t\t\t\tbNavSelVarHasDefaultsOnly: false,\n\t\t\t\t\t\ttableVariantId: \"\",\n\t\t\t\t\t\tcustomData: {},\n\t\t\t\t\t\tappStateKey: sAppStateKey,\n\t\t\t\t\t\tpresentationVariant: {},\n\t\t\t\t\t\tvalueTexts: {},\n\t\t\t\t\t\tsemanticDates: {},\n\t\t\t\t\t\tdata: {}\n\t\t\t\t\t};\n\t\t\t\t\tif (oAppDataLoaded.selectionVariant) {\n\t\t\t\t\t\t/*\n\t\t\t\t\t\t * In case that we get an object from the stored AppData (=persistency), we need to stringify the JSON object.\n\t\t\t\t\t\t */\n\t\t\t\t\t\toAppData.selectionVariant = oNavHandler._ensureSelectionVariantFormatString(oAppDataLoaded.selectionVariant);\n\t\t\t\t\t\toAppData.oSelectionVariant = new SelectionVariant(oAppData.selectionVariant);\n\t\t\t\t\t}\n\t\t\t\t\tif (oAppDataLoaded.tableVariantId) {\n\t\t\t\t\t\toAppData.tableVariantId = oAppDataLoaded.tableVariantId;\n\t\t\t\t\t}\n\t\t\t\t\tif (oAppDataLoaded.customData) {\n\t\t\t\t\t\toAppData.customData = oAppDataLoaded.customData;\n\t\t\t\t\t}\n\t\t\t\t\tif (oAppDataLoaded.presentationVariant) {\n\t\t\t\t\t\toAppData.presentationVariant = oAppDataLoaded.presentationVariant;\n\t\t\t\t\t}\n\t\t\t\t\tif (oAppDataLoaded.valueTexts) {\n\t\t\t\t\t\toAppData.valueTexts = oAppDataLoaded.valueTexts;\n\t\t\t\t\t}\n\t\t\t\t\tif (oAppDataLoaded.semanticDates) {\n\t\t\t\t\t\toAppData.semanticDates = oAppDataLoaded.semanticDates;\n\t\t\t\t\t}\n\t\t\t\t\t/* In V2 case, we need the data in the below format for hybrid case */\n\t\t\t\t\tif (navType === NavType.hybrid) {\n\t\t\t\t\t\toAppData.data = oAppDataLoaded;\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\toAppData = merge(oAppData, oAppDataLoaded);\n\t\t\t\t\tif (oAppDataLoaded.selectionVariant) {\n\t\t\t\t\t\t/*\n\t\t\t\t\t\t * In case that we get an object from the stored AppData (=persistency), we need to stringify the JSON object.\n\t\t\t\t\t\t */\n\t\t\t\t\t\toAppData.selectionVariant = oNavHandler._ensureSelectionVariantFormatString(oAppDataLoaded.selectionVariant);\n\t\t\t\t\t\toAppData.oSelectionVariant = new SelectionVariant(oAppData.selectionVariant);\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\t// resolve is called on passed Deferred object to trigger a call of the done method, if implemented\n\t\t\t\t// the done method will receive the loaded appState and the navigation type as parameters\n\t\t\t\toDeferred.resolve(oAppData, {}, navType);\n\t\t\t\treturn;\n\t\t\t})\n\t\t\t.catch(function () {\n\t\t\t\tconst oError = oNavHandler._createTechnicalError(\"NavigationHandler.getAppState.failed\");\n\t\t\t\toDeferred.reject(oError, {}, navType);\n\t\t\t});\n\n\t\treturn oDeferred;\n\t}\n\n\t/**\n\t * Retrieves the parameter value of the sap-iapp-state (the internal apps) from the AppHash string. It automatically takes care about\n\t * compatibility between the old and the new approach of the sap-iapp-state. Precedence is that the new approach is favoured against the old\n\t * approach.\n\t * @param sAppHash The AppHash, which may contain a sap-iapp-state parameter (both old and/or new approach)\n\t * @returns The value of sap-iapp-state (i.e. the name of the container to retrieve the parameters), or <code>undefined</code> in\n\t *         case that no sap-iapp-state was found in <code>sAppHash</code>.\n\t * @private\n\t */\n\t_getInnerAppStateKey(sAppHash: string): string | undefined {\n\t\t// trivial case: no app hash available at all.\n\t\tif (!sAppHash) {\n\t\t\treturn undefined;\n\t\t}\n\n\t\t/* new approach: separated via question mark / part of the query parameter of the AppHash */\n\t\tlet aMatches = this._rIAppStateNew.exec(sAppHash);\n\n\t\t/* old approach: spearated via slashes / i.e. part of the route itself */\n\t\tif (aMatches === null) {\n\t\t\taMatches = this._rIAppStateOld.exec(sAppHash);\n\t\t}\n\n\t\t/*\n\t\t * old approach: special case: if there is no deep route/key defined, the sap-iapp-state may be at the beginning of the string, without\n\t\t * any separation with the slashes\n\t\t */\n\t\tif (aMatches === null) {\n\t\t\taMatches = this._rIAppStateOldAtStart.exec(sAppHash);\n\t\t}\n\n\t\tif (aMatches === null) {\n\t\t\t// there is no (valid) sap-iapp-state in the App Hash\n\t\t\treturn undefined;\n\t\t}\n\n\t\treturn aMatches[1];\n\t}\n\n\t/**\n\t * Replaces (or inserts) a parameter value (an AppStateKey) for the sap-iapp-state into an existing AppHash string. Other routes/parameters\n\t * are ignored and returned without modification (\"environmental agnostic\" property). Only the new approach (sap-iapp-state as query parameter\n\t * in the AppHash) is being issued.\n\t * @param sAppHash The AppHash into which the sap-iapp-state parameter shall be made available\n\t * @param sAppStateKey The key value of the AppState which shall be stored as parameter value of the sap-iapp-state property.\n\t * @returns The modified sAppHash string, such that the sap-iapp-state has been set based on the new (query option-based)\n\t *         sap-iapp-state. If a sap-iapp-state has been specified before, the key is replaced. If <code>sAppHash</code> was of the old\n\t *         format (sap-iapp-state as part of the keys/route), the format is converted to the new format before the result is returned.\n\t * @private\n\t */\n\t_replaceInnerAppStateKey(sAppHash: string, sAppStateKey: string): string | undefined {\n\t\tconst sNewIAppState = IAPP_STATE + \"=\" + sAppStateKey;\n\n\t\t/*\n\t\t * generate sap-iapp-states with the new way\n\t\t */\n\t\tif (!sAppHash) {\n\t\t\t// there's no sAppHash key yet\n\t\t\treturn \"?\" + sNewIAppState;\n\t\t}\n\n\t\tconst fnAppendToQueryParameter = function (sSubAppHash: any): string {\n\t\t\t// there is an AppHash available, but it does not contain a sap-iapp-state parameter yet - we need to append one\n\n\t\t\t// new approach: we need to check, if a set of query parameters is already available\n\t\t\tif (sSubAppHash.indexOf(\"?\") !== -1) {\n\t\t\t\t// there are already query parameters available - append it as another parameter\n\t\t\t\treturn sSubAppHash + \"&\" + sNewIAppState;\n\t\t\t}\n\t\t\t// there are no a query parameters available yet; create a set with a single parameter\n\t\t\treturn sSubAppHash + \"?\" + sNewIAppState;\n\t\t};\n\n\t\tif (!this._getInnerAppStateKey(sAppHash)) {\n\t\t\treturn fnAppendToQueryParameter(sAppHash);\n\t\t}\n\t\t// There is an AppHash available and there is already an sap-iapp-state in the AppHash\n\n\t\tif (this._rIAppStateNew.test(sAppHash)) {\n\t\t\t// the new approach is being used\n\t\t\treturn sAppHash.replace(this._rIAppStateNew, function (sNeedle: string) {\n\t\t\t\treturn sNeedle.replace(/[=].*/gi, \"=\" + sAppStateKey);\n\t\t\t});\n\t\t}\n\n\t\t// we need to remove the old AppHash entirely and replace it with a new one.\n\n\t\tconst fnReplaceOldApproach = function (rOldApproach: any, sSubAppHash: any): string {\n\t\t\tsSubAppHash = sSubAppHash.replace(rOldApproach, \"\");\n\t\t\treturn fnAppendToQueryParameter(sSubAppHash);\n\t\t};\n\n\t\tif (this._rIAppStateOld.test(sAppHash)) {\n\t\t\treturn fnReplaceOldApproach(this._rIAppStateOld, sAppHash);\n\t\t}\n\n\t\tif (this._rIAppStateOldAtStart.test(sAppHash)) {\n\t\t\treturn fnReplaceOldApproach(this._rIAppStateOldAtStart, sAppHash);\n\t\t}\n\n\t\tassert(false, \"internal inconsistency: Approach of sap-iapp-state not known, but _getInnerAppStateKey returned it\");\n\t\treturn undefined;\n\t}\n\n\t_getURLParametersFromSelectionVariant(vSelectionVariant?: SelectionVariant | string): Record<string, string> {\n\t\tconst mURLParameters: Record<string, string> = {};\n\t\tlet i = 0;\n\t\tlet oSelectionVariant;\n\n\t\tif (typeof vSelectionVariant === \"string\") {\n\t\t\toSelectionVariant = new SelectionVariant(vSelectionVariant);\n\t\t} else if (typeof vSelectionVariant === \"object\") {\n\t\t\toSelectionVariant = vSelectionVariant;\n\t\t} else {\n\t\t\tthrow new NavError(\"NavigationHandler.INVALID_INPUT\");\n\t\t}\n\n\t\t// add URLs parameters from SelectionVariant.SelectOptions (if single value)\n\t\tconst aSelectProperties = oSelectionVariant.getSelectOptionsPropertyNames();\n\t\tfor (i = 0; i < aSelectProperties.length; i++) {\n\t\t\tconst aSelectOptions = oSelectionVariant.getSelectOption(aSelectProperties[i]);\n\t\t\tif (aSelectOptions && aSelectOptions.length === 1 && aSelectOptions[0].Sign === \"I\" && aSelectOptions[0].Option === \"EQ\") {\n\t\t\t\tmURLParameters[aSelectProperties[i]] = aSelectOptions[0].Low;\n\t\t\t}\n\t\t}\n\n\t\t// add parameters from SelectionVariant.Parameters\n\t\tconst aParameterNames = oSelectionVariant.getParameterNames();\n\t\tfor (i = 0; i < aParameterNames.length; i++) {\n\t\t\tconst sParameterValue = oSelectionVariant.getParameter(aParameterNames[i]);\n\n\t\t\tmURLParameters[aParameterNames[i]] = sParameterValue;\n\t\t}\n\t\treturn mURLParameters;\n\t}\n\n\t_createTechnicalError(sErrorCode: any): NavError {\n\t\treturn new NavError(sErrorCode);\n\t}\n\n\t/**\n\t * Sets the model that is used for verification of sensitive information. If the model is not set, the unnamed component model is used for the\n\t * verification of sensitive information.\n\t * @public\n\t * @param oModel For checking sensitive information\n\t */\n\tsetModel(oModel: V2ODataModel | V4ODataModel): void {\n\t\tthis._oModel = oModel;\n\t}\n\n\t_getModel(): V2ODataModel | V4ODataModel {\n\t\treturn this._oModel || this.oComponent.getModel();\n\t}\n\n\t_removeAllProperties(oData: InnerAppData): void {\n\t\tif (oData) {\n\t\t\tif (oData.selectionVariant) {\n\t\t\t\toData.selectionVariant = null as unknown as undefined;\n\t\t\t}\n\n\t\t\tif (oData.valueTexts) {\n\t\t\t\toData.valueTexts = null;\n\t\t\t}\n\n\t\t\tif (oData.semanticDates) {\n\t\t\t\toData.semanticDates = null;\n\t\t\t}\n\t\t}\n\t}\n\n\t_removeProperties(aFilterName: any, aParameterName: any, oData: any): void {\n\t\tif (aFilterName.length && oData && (oData.selectionVariant || oData.valueTexts || oData.semanticDates)) {\n\t\t\taFilterName.forEach(function (sName: any) {\n\t\t\t\tif (oData.selectionVariant.SelectOptions) {\n\t\t\t\t\toData.selectionVariant.SelectOptions.some(function (oValue: any, nIdx: any) {\n\t\t\t\t\t\tif (sName === oValue.PropertyName) {\n\t\t\t\t\t\t\toData.selectionVariant.SelectOptions.splice(nIdx, 1);\n\t\t\t\t\t\t\treturn true;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\treturn false;\n\t\t\t\t\t});\n\t\t\t\t}\n\n\t\t\t\tif (oData.valueTexts && oData.valueTexts.Texts) {\n\t\t\t\t\toData.valueTexts.Texts.forEach(function (oTexts: any) {\n\t\t\t\t\t\tif (oTexts.PropertyTexts) {\n\t\t\t\t\t\t\toTexts.PropertyTexts.some(function (oValue: any, nIdx: any) {\n\t\t\t\t\t\t\t\tif (sName === oValue.PropertyName) {\n\t\t\t\t\t\t\t\t\toTexts.PropertyTexts.splice(nIdx, 1);\n\t\t\t\t\t\t\t\t\treturn true;\n\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\treturn false;\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t}\n\n\t\t\t\tif (oData.semanticDates && oData.semanticDates.Dates) {\n\t\t\t\t\toData.semanticDates.Dates.forEach(function (oDates: any, nIdx: any) {\n\t\t\t\t\t\tif (sName === oDates.PropertyName) {\n\t\t\t\t\t\t\toData.semanticDates.Dates.splice(nIdx, 1);\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\n\t\tif (aParameterName.length && oData && oData.selectionVariant && oData.selectionVariant.Parameters) {\n\t\t\taParameterName.forEach(function (sName: any) {\n\t\t\t\toData.selectionVariant.Parameters.some(function (oValue: any, nIdx: any) {\n\t\t\t\t\tif (sName === oValue.PropertyName || \"$Parameter.\" + sName === oValue.PropertyName) {\n\t\t\t\t\t\toData.selectionVariant.Parameters.splice(nIdx, 1);\n\t\t\t\t\t\treturn true;\n\t\t\t\t\t}\n\n\t\t\t\t\treturn false;\n\t\t\t\t});\n\t\t\t});\n\t\t}\n\t}\n\n\t_isTermTrue(oProperty: any, sTerm: string): boolean {\n\t\tconst fIsTermDefaultTrue = function (oTerm: any): boolean {\n\t\t\tif (oTerm) {\n\t\t\t\treturn oTerm.Bool ? oTerm.Bool !== \"false\" : true;\n\t\t\t}\n\t\t\treturn false;\n\t\t};\n\n\t\treturn !!oProperty[sTerm] && fIsTermDefaultTrue(oProperty[sTerm]);\n\t}\n\n\t_isExcludedFromNavigationContext(oProperty: any): boolean {\n\t\treturn this._isTermTrue(oProperty, \"com.sap.vocabularies.UI.v1.ExcludeFromNavigationContext\");\n\t}\n\n\t_isPotentiallySensitive(oProperty: any): boolean {\n\t\treturn this._isTermTrue(oProperty, \"com.sap.vocabularies.PersonalData.v1.IsPotentiallySensitive\");\n\t}\n\n\t_isMeasureProperty(oProperty: any): boolean {\n\t\treturn this._isTermTrue(oProperty, \"com.sap.vocabularies.Analytics.v1.Measure\");\n\t}\n\n\t_isToBeExcluded(oProperty: any): boolean {\n\t\treturn this._isPotentiallySensitive(oProperty) || this._isExcludedFromNavigationContext(oProperty);\n\t}\n\n\t/**\n\t * The method creates a context url based on provided data. This context url can either be used as\n\t * {@link sap.fe.navigation.NavigationHandler#setParameterContextUrl ParameterContextUrl} or\n\t * {@link sap.fe.navigation.NavigationHandler#setFilterContextUrl FilterContextUrl}.\n\t * @param sEntitySetName Used for url determination\n\t * @param [oModel] Used for url determination. If omitted, the NavigationHandler model is used.\n\t * @throws An instance of {@link sap.fe.navigation.NavError} in case of missing or wrong passed parameters\n\t * @returns The context url for the given entities\n\t * @protected\n\t */\n\tconstructContextUrl(sEntitySetName: string, oModel?: V2ODataModel | V4ODataModel): string {\n\t\tif (!sEntitySetName) {\n\t\t\tthrow new NavError(\"NavigationHandler.NO_ENTITY_SET_PROVIDED\");\n\t\t}\n\n\t\tif (oModel === undefined) {\n\t\t\toModel = this._getModel();\n\t\t}\n\n\t\treturn this._constructContextUrl(oModel) + \"#\" + sEntitySetName;\n\t}\n\n\t_constructContextUrl(oModel: V2ODataModel | V4ODataModel): string {\n\t\tlet sServerUrl;\n\n\t\tif (oModel.isA<V2ODataModel>(\"sap.ui.model.odata.v2.ODataModel\")) {\n\t\t\tsServerUrl = oModel._getServerUrl();\n\t\t} else if (oModel.isA<V4ODataModel>(\"sap.ui.model.odata.v4.ODataModel\")) {\n\t\t\tconst oServiceURI = new URI(oModel.getServiceUrl()).absoluteTo(document.baseURI);\n\t\t\tsServerUrl = new URI(\"/\").absoluteTo(oServiceURI).toString();\n\t\t}\n\n\t\tif (sServerUrl && sServerUrl.lastIndexOf(\"/\") === sServerUrl.length - 1) {\n\t\t\tsServerUrl = sServerUrl.substring(0, sServerUrl.length - 1);\n\t\t}\n\n\t\treturn sServerUrl + oModel.sServiceUrl + \"/$metadata\";\n\t}\n\n\t/**\n\t * The method verifies, if any of the passed parameters/filters are marked as sensitive, and if this is the case remove those from the app\n\t * data. <b>Note:</b> To use this method, the metadata must be loaded first.\n\t * @param oData With potential sensitive information (for OData, external representation using\n\t * <code>oSelectionVariant.toJSONObject()</code> must be used), with the <code>FilterContextUrl</code> or\n\t * <code>ParameterContextUrl</code> property.\n\t * @returns Data without properties marked as sensitive or an empty object if the OData metadata is not fully loaded yet\n\t * @private\n\t */\n\t_checkIsPotentiallySensitive(oData: any): unknown {\n\t\tlet oAdaptedData = oData;\n\t\tif (\n\t\t\toData &&\n\t\t\toData.selectionVariant &&\n\t\t\t((oData.selectionVariant.FilterContextUrl && oData.selectionVariant.SelectOptions) ||\n\t\t\t\t(oData.selectionVariant.ParameterContextUrl && oData.selectionVariant.Parameters))\n\t\t) {\n\t\t\tconst oModel = this._getModel();\n\t\t\tif (this.oComponent && oModel && oModel.isA<V2ODataModel>(\"sap.ui.model.odata.v2.ODataModel\")) {\n\t\t\t\tconst aSensitiveFilterName = [];\n\t\t\t\tconst aSensitiveParameterName = [];\n\t\t\t\tlet i,\n\t\t\t\t\toEntitySet: any,\n\t\t\t\t\toEntityDef: any,\n\t\t\t\t\toSubEntityDef: any,\n\t\t\t\t\toEndRole: any,\n\t\t\t\t\taFilterContextPart = [],\n\t\t\t\t\taParamContextPart = [];\n\n\t\t\t\tconst oMetaModel = oModel.getMetaModel();\n\t\t\t\tif (oModel.getServiceMetadata() && oMetaModel?.oModel) {\n\t\t\t\t\tif (oData.selectionVariant.FilterContextUrl) {\n\t\t\t\t\t\taFilterContextPart = oData.selectionVariant.FilterContextUrl.split(\"#\");\n\t\t\t\t\t}\n\n\t\t\t\t\tif (\n\t\t\t\t\t\taFilterContextPart.length === 2 &&\n\t\t\t\t\t\toData.selectionVariant.SelectOptions &&\n\t\t\t\t\t\tthis._constructContextUrl(oModel).indexOf(aFilterContextPart[0]) === 0\n\t\t\t\t\t) {\n\t\t\t\t\t\toEntitySet = oMetaModel.getODataEntitySet(aFilterContextPart[1]);\n\t\t\t\t\t\tif (oEntitySet) {\n\t\t\t\t\t\t\toEntityDef = oMetaModel.getODataEntityType(oEntitySet.entityType);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\toEntityDef = oMetaModel.getODataEntityType(aFilterContextPart[1]);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif (oEntityDef) {\n\t\t\t\t\t\t\tif (oEntityDef && oEntityDef.property) {\n\t\t\t\t\t\t\t\tfor (i = 0; i < oEntityDef.property.length; i++) {\n\t\t\t\t\t\t\t\t\tif (this._isToBeExcluded(oEntityDef.property[i])) {\n\t\t\t\t\t\t\t\t\t\taSensitiveFilterName.push(oEntityDef.property[i].name);\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tif (oEntityDef.navigationProperty) {\n\t\t\t\t\t\t\t\tfor (i = 0; i < oEntityDef.navigationProperty.length; i++) {\n\t\t\t\t\t\t\t\t\toEndRole = oMetaModel.getODataAssociationEnd(oEntityDef, oEntityDef.navigationProperty[i].name);\n\t\t\t\t\t\t\t\t\tif (!oEndRole || oEndRole.type === oData.selectionVariant.FilterContextUrl) {\n\t\t\t\t\t\t\t\t\t\tcontinue;\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t// check if the end role has cardinality 0..1 or 1\n\t\t\t\t\t\t\t\t\tif (oEndRole.multiplicity === \"1\" || oEndRole.multiplicity === \"0..1\") {\n\t\t\t\t\t\t\t\t\t\toSubEntityDef = oMetaModel.getODataEntityType(oEndRole.type);\n\t\t\t\t\t\t\t\t\t\tif (oSubEntityDef && oSubEntityDef.property) {\n\t\t\t\t\t\t\t\t\t\t\tfor (let j = 0; j < oSubEntityDef.property.length; j++) {\n\t\t\t\t\t\t\t\t\t\t\t\tif (this._isToBeExcluded(oSubEntityDef.property[j])) {\n\t\t\t\t\t\t\t\t\t\t\t\t\taSensitiveFilterName.push(\n\t\t\t\t\t\t\t\t\t\t\t\t\t\toEntityDef.navigationProperty[i].name + \".\" + oSubEntityDef.property[j].name\n\t\t\t\t\t\t\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\tif (oData.selectionVariant.ParameterContextUrl) {\n\t\t\t\t\t\taParamContextPart = oData.selectionVariant.ParameterContextUrl.split(\"#\");\n\t\t\t\t\t}\n\n\t\t\t\t\tif (\n\t\t\t\t\t\taParamContextPart.length === 2 &&\n\t\t\t\t\t\toData.selectionVariant.Parameters &&\n\t\t\t\t\t\tthis._constructContextUrl(oModel).indexOf(aParamContextPart[0]) === 0\n\t\t\t\t\t) {\n\t\t\t\t\t\toEntitySet = oMetaModel.getODataEntitySet(aParamContextPart[1]);\n\t\t\t\t\t\tif (oEntitySet) {\n\t\t\t\t\t\t\toEntityDef = oMetaModel.getODataEntityType(oEntitySet.entityType);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\toEntityDef = oMetaModel.getODataEntityType(aFilterContextPart[1]);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif (oEntityDef) {\n\t\t\t\t\t\t\tif (oEntityDef.property) {\n\t\t\t\t\t\t\t\tfor (i = 0; i < oEntityDef.property.length; i++) {\n\t\t\t\t\t\t\t\t\tif (this._isToBeExcluded(oEntityDef.property[i])) {\n\t\t\t\t\t\t\t\t\t\taSensitiveParameterName.push(oEntityDef.property[i].name);\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\tif (aSensitiveFilterName.length || aSensitiveParameterName.length) {\n\t\t\t\t\t\toAdaptedData = extend(true as any, {}, oAdaptedData);\n\n\t\t\t\t\t\tthis._removeProperties(aSensitiveFilterName, aSensitiveParameterName, oAdaptedData);\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\t// annotations are not loaded\n\n\t\t\t\t\tthis._removeAllProperties(oAdaptedData);\n\t\t\t\t\tLog.error(\"NavigationHandler: oMetadata are not fully loaded!\");\n\t\t\t\t}\n\t\t\t} else if (this.oComponent && oModel && oModel.isA(\"sap.ui.model.odata.v4.ODataModel\")) {\n\t\t\t\treturn this._removeSensitiveDataForODataV4(oAdaptedData);\n\t\t\t}\n\t\t}\n\n\t\treturn oAdaptedData;\n\t}\n\n\t_removeMeasureBasedInformation(oAppData: InnerAppData): InnerAppData {\n\t\tlet oAppDataForSave = oAppData;\n\n\t\tif (oAppData.selectionVariant) {\n\t\t\t/*\n\t\t\t * The specification states that Selection Variants need to be JSON objects. However, internally, we work with strings for\n\t\t\t * \"selectionVariant\". Therefore, in case that this is a string, we need to JSON-parse the data.\n\t\t\t */\n\t\t\tif (typeof oAppData.selectionVariant === \"string\") {\n\t\t\t\ttry {\n\t\t\t\t\toAppDataForSave.selectionVariant = JSON.parse(oAppData.selectionVariant);\n\t\t\t\t} catch (x) {\n\t\t\t\t\tLog.error(\"NavigationHandler: _removeMeasureBasedInformation parse error\");\n\t\t\t\t}\n\t\t\t}\n\n\t\t\toAppDataForSave = this._removeMeasureBasedProperties(oAppDataForSave);\n\t\t}\n\n\t\treturn oAppDataForSave;\n\t}\n\n\t/**\n\t * The method verifies if any of the passed parameters/filters are marked as a measure. If this is the case, they are removed from the xapp\n\t * app data. <b>Note:</b> To use this method, the metadata must be loaded first.\n\t * @param oData With potential sensitive information (for OData, external representation using\n\t * <code>oSelectionVariant.toJSONObject()</code> must be used), with the <code>FilterContextUrl</code> or\n\t * <code>ParameterContextUrl</code> property.\n\t * @returns Data without properties marked as measures or an empty object if the OData metadata is not fully loaded yet\n\t * @private\n\t */\n\t_removeMeasureBasedProperties(oData: InnerAppData): InnerAppData {\n\t\tlet oAdaptedData = oData;\n\t\tconst aMeasureFilterName = [];\n\t\tconst aMeasureParameterName = [];\n\t\tlet i,\n\t\t\toModel,\n\t\t\toMetaModel,\n\t\t\toEntitySet: any,\n\t\t\toEntityDef: any,\n\t\t\toSubEntityDef: any,\n\t\t\toEndRole: any,\n\t\t\taFilterContextPart: string[] = [],\n\t\t\taParamContextPart: string[] = [];\n\n\t\tif (\n\t\t\toData &&\n\t\t\toData.selectionVariant &&\n\t\t\t(((oData.selectionVariant as SerializedSelectionVariant).FilterContextUrl &&\n\t\t\t\t(oData.selectionVariant as SerializedSelectionVariant).SelectOptions) ||\n\t\t\t\t((oData.selectionVariant as SerializedSelectionVariant).ParameterContextUrl &&\n\t\t\t\t\t(oData.selectionVariant as SerializedSelectionVariant).Parameters))\n\t\t) {\n\t\t\toModel = this._getModel();\n\t\t\tif (this.oComponent && oModel && oModel.isA<V2ODataModel>(\"sap.ui.model.odata.v2.ODataModel\")) {\n\t\t\t\toMetaModel = oModel.getMetaModel();\n\t\t\t\tif (oModel.getServiceMetadata() && oMetaModel && oMetaModel.oModel) {\n\t\t\t\t\tif ((oData.selectionVariant as SerializedSelectionVariant).FilterContextUrl) {\n\t\t\t\t\t\taFilterContextPart = (oData.selectionVariant as SerializedSelectionVariant).FilterContextUrl!.split(\"#\");\n\t\t\t\t\t}\n\n\t\t\t\t\tif (\n\t\t\t\t\t\taFilterContextPart.length === 2 &&\n\t\t\t\t\t\t(oData.selectionVariant as SerializedSelectionVariant).SelectOptions &&\n\t\t\t\t\t\tthis._constructContextUrl(oModel).indexOf(aFilterContextPart[0]) === 0\n\t\t\t\t\t) {\n\t\t\t\t\t\toEntitySet = oMetaModel.getODataEntitySet(aFilterContextPart[1]);\n\t\t\t\t\t\tif (oEntitySet) {\n\t\t\t\t\t\t\toEntityDef = oMetaModel.getODataEntityType(oEntitySet.entityType);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\toEntityDef = oMetaModel.getODataEntityType(aFilterContextPart[1]);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif (oEntityDef) {\n\t\t\t\t\t\t\tif (oEntityDef && oEntityDef.property) {\n\t\t\t\t\t\t\t\tfor (i = 0; i < oEntityDef.property.length; i++) {\n\t\t\t\t\t\t\t\t\tif (this._isMeasureProperty(oEntityDef.property[i])) {\n\t\t\t\t\t\t\t\t\t\taMeasureFilterName.push(oEntityDef.property[i].name);\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tif (oEntityDef.navigationProperty) {\n\t\t\t\t\t\t\t\tfor (i = 0; i < oEntityDef.navigationProperty.length; i++) {\n\t\t\t\t\t\t\t\t\toEndRole = oMetaModel.getODataAssociationEnd(oEntityDef, oEntityDef.navigationProperty[i].name);\n\t\t\t\t\t\t\t\t\tif (\n\t\t\t\t\t\t\t\t\t\t!oEndRole ||\n\t\t\t\t\t\t\t\t\t\toEndRole.type === (oData.selectionVariant as SerializedSelectionVariant).FilterContextUrl\n\t\t\t\t\t\t\t\t\t) {\n\t\t\t\t\t\t\t\t\t\tcontinue;\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t// check if the end role has cardinality 0..1 or 1\n\t\t\t\t\t\t\t\t\tif (oEndRole.multiplicity === \"1\" || oEndRole.multiplicity === \"0..1\") {\n\t\t\t\t\t\t\t\t\t\toSubEntityDef = oMetaModel.getODataEntityType(oEndRole.type);\n\t\t\t\t\t\t\t\t\t\tif (oSubEntityDef && oSubEntityDef.property) {\n\t\t\t\t\t\t\t\t\t\t\tfor (let j = 0; j < oSubEntityDef.property.length; j++) {\n\t\t\t\t\t\t\t\t\t\t\t\tif (this._isMeasureProperty(oSubEntityDef.property[j])) {\n\t\t\t\t\t\t\t\t\t\t\t\t\taMeasureFilterName.push(\n\t\t\t\t\t\t\t\t\t\t\t\t\t\toEntityDef.navigationProperty[i].name + \".\" + oSubEntityDef.property[j].name\n\t\t\t\t\t\t\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\tif ((oData.selectionVariant as SerializedSelectionVariant).ParameterContextUrl) {\n\t\t\t\t\t\taParamContextPart = (oData.selectionVariant as SerializedSelectionVariant).ParameterContextUrl!.split(\"#\");\n\t\t\t\t\t}\n\n\t\t\t\t\tif (\n\t\t\t\t\t\taParamContextPart.length === 2 &&\n\t\t\t\t\t\t(oData.selectionVariant as SerializedSelectionVariant).Parameters &&\n\t\t\t\t\t\tthis._constructContextUrl(oModel).indexOf(aParamContextPart[0]) === 0\n\t\t\t\t\t) {\n\t\t\t\t\t\toEntitySet = oMetaModel.getODataEntitySet(aParamContextPart[1]);\n\t\t\t\t\t\tif (oEntitySet) {\n\t\t\t\t\t\t\toEntityDef = oMetaModel.getODataEntityType(oEntitySet.entityType);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\toEntityDef = oMetaModel.getODataEntityType(aFilterContextPart[1]);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif (oEntityDef) {\n\t\t\t\t\t\t\tif (oEntityDef.property) {\n\t\t\t\t\t\t\t\tfor (i = 0; i < oEntityDef.property.length; i++) {\n\t\t\t\t\t\t\t\t\tif (this._isMeasureProperty(oEntityDef.property[i])) {\n\t\t\t\t\t\t\t\t\t\taMeasureParameterName.push(oEntityDef.property[i].name);\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\tif (aMeasureFilterName.length || aMeasureParameterName.length) {\n\t\t\t\t\t\t// TQ: needs attention\n\t\t\t\t\t\toAdaptedData = extend(true as any, {}, oAdaptedData) as InnerAppData;\n\n\t\t\t\t\t\tthis._removeProperties(aMeasureFilterName, aMeasureParameterName, oAdaptedData);\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\t// annotations are not loaded\n\n\t\t\t\t\tthis._removeAllProperties(oAdaptedData);\n\t\t\t\t\tLog.error(\"NavigationHandler: oMetadata are not fully loaded!\");\n\t\t\t\t}\n\t\t\t} else if (this.oComponent && oModel && oModel.isA(\"sap.ui.model.odata.v4.ODataModel\")) {\n\t\t\t\treturn this._removeSensitiveDataForODataV4(oAdaptedData, true);\n\t\t\t}\n\t\t}\n\t\treturn oAdaptedData;\n\t}\n\n\t/**\n\t * Removes sensitive data from the navigation context.\n\t * @param oData Selection variant\n\t * @param bMeasure Should measures be removed\n\t * @returns The selection variant after sensitive data has been removed\n\t */\n\t_removeSensitiveDataForODataV4(oData: InnerAppData, bMeasure?: boolean): InnerAppData {\n\t\tconst oNavHandler = this,\n\t\t\toSV = new SelectionVariant(oData.selectionVariant),\n\t\t\toModel = this._getModel();\n\t\tlet aFilterContextPart: string[] | undefined;\n\n\t\tif (!oModel.getMetaModel().getObject(\"/\")) {\n\t\t\t// annotations are not loaded\n\t\t\tthis._removeAllProperties(oData);\n\t\t\tLog.error(\"NavigationHandler: oMetadata are not fully loaded!\");\n\t\t\treturn oData;\n\t\t}\n\n\t\tif ((oData.selectionVariant as SerializedSelectionVariant).FilterContextUrl) {\n\t\t\taFilterContextPart = (oData.selectionVariant as SerializedSelectionVariant).FilterContextUrl!.split(\"#\");\n\t\t}\n\n\t\tif (\n\t\t\taFilterContextPart?.length === 2 &&\n\t\t\t(oData.selectionVariant as SerializedSelectionVariant).SelectOptions &&\n\t\t\tthis._constructContextUrl(oModel).indexOf(aFilterContextPart[0]) === 0\n\t\t) {\n\t\t\toSV.removeSelectOption(\"@odata.context\");\n\t\t\toSV.removeSelectOption(\"@odata.metadataEtag\");\n\t\t\toSV.removeSelectOption(\"SAP__Messages\");\n\n\t\t\tconst sEntitySet = aFilterContextPart[1],\n\t\t\t\toMetaModel = oModel.getMetaModel(),\n\t\t\t\taPropertyNames = oSV.getPropertyNames() || [],\n\t\t\t\tfnIsSensitiveData = function (sProp: string, esName: string): boolean {\n\t\t\t\t\tesName = esName || sEntitySet;\n\t\t\t\t\tconst aPropertyAnnotations = oMetaModel.getObject(\"/\" + esName + \"/\" + sProp + \"@\");\n\t\t\t\t\tif (aPropertyAnnotations) {\n\t\t\t\t\t\tif (\n\t\t\t\t\t\t\t(bMeasure && aPropertyAnnotations[\"@com.sap.vocabularies.Analytics.v1.Measure\"]) ||\n\t\t\t\t\t\t\toNavHandler._checkPropertyAnnotationsForSensitiveData(aPropertyAnnotations)\n\t\t\t\t\t\t) {\n\t\t\t\t\t\t\treturn true;\n\t\t\t\t\t\t} else if (aPropertyAnnotations[\"@com.sap.vocabularies.Common.v1.FieldControl\"]) {\n\t\t\t\t\t\t\tconst oFieldControl = aPropertyAnnotations[\"@com.sap.vocabularies.Common.v1.FieldControl\"];\n\t\t\t\t\t\t\tif (oFieldControl[\"$EnumMember\"] && oFieldControl[\"$EnumMember\"].split(\"/\")[1] === \"Inapplicable\") {\n\t\t\t\t\t\t\t\treturn true;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\treturn false;\n\t\t\t\t};\n\n\t\t\tfor (let k = 0; k < aPropertyNames.length; k++) {\n\t\t\t\tconst sProperty = aPropertyNames[k];\n\t\t\t\t// properties of the entity set\n\t\t\t\tif (fnIsSensitiveData(sProperty, sEntitySet)) {\n\t\t\t\t\toSV.removeSelectOption(sProperty);\n\t\t\t\t}\n\t\t\t}\n\t\t\toData.selectionVariant = oSV.toJSONObject();\n\t\t}\n\t\treturn oData;\n\t}\n\n\t_checkPropertyAnnotationsForSensitiveData(aPropertyAnnotations: Record<string, unknown>): boolean {\n\t\treturn !!(\n\t\t\taPropertyAnnotations[\"@com.sap.vocabularies.PersonalData.v1.IsPotentiallySensitive\"] ||\n\t\t\taPropertyAnnotations[\"@com.sap.vocabularies.UI.v1.ExcludeFromNavigationContext\"]\n\t\t);\n\t}\n\n\t/**\n\t * Retrieves the parameter value of the sap-iapp-state (the internal apps) from the AppHash string. It automatically takes care about\n\t * compatibility between the old and the new approach of the sap-iapp-state. Precedence is that the new approach is favoured against the old\n\t * approach.\n\t * @returns The value of sap-iapp-state (i.e. the name of the container to retrieve the parameters), or <code>undefined</code> in\n\t *         case that no sap-iapp-state was found in <code>sAppHash</code>.\n\t * @private\n\t */\n\tgetIAppStateKey(): string | undefined {\n\t\tconst sAppHash = HashChanger.getInstance().getHash();\n\t\treturn this._getInnerAppStateKey(sAppHash);\n\t}\n}\n\n// Exporting the class as properly typed UI5Class\n\nconst NavigationHandlerUI5Class = BaseObject.extend(\n\t\"sap.fe.navigation.NavigationHandler\",\n\tNavigationHandler.prototype as any\n) as typeof NavigationHandler;\ntype NavigationHandlerUI5Class = InstanceType<typeof NavigationHandler>;\nexport default NavigationHandlerUI5Class;\n"],"mappings":";;;;;;;;;;EAmCA;AACA;AACA;;EAkCA;EACA,MAAMA,OAAO,GAAGC,UAAU,CAACD,OAAO;EAClC,MAAME,iBAAiB,GAAGD,UAAU,CAACC,iBAAiB;EACtD,MAAMC,mBAAmB,GAAGF,UAAU,CAACE,mBAAmB;EAC1D,MAAMC,IAAI,GAAGH,UAAU,CAACG,IAAI;EAE5B,MAAMC,UAAU,GAAG,gBAAgB;EACnC,MAAMC,4BAA4B,GAAG,oCAAoC;EACzE,MAAMC,qBAAqB,GAAG,sBAAsB;;EAEpD;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;EAjBA,IAkBaC,iBAAiB,0BAAAC,WAAA;IAsD7B;AACD;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;IACC,SAAAD,kBACCE,WAAqC,EAGpC;MAAA,IAAAC,KAAA;MAAA,IAFDC,KAAa,GAAAC,SAAA,CAAAC,MAAA,QAAAD,SAAA,QAAAE,SAAA,GAAAF,SAAA,MAAGT,IAAI,CAACY,OAAO;MAAA,IAC5BC,kBAA0B,GAAAJ,SAAA,CAAAC,MAAA,QAAAD,SAAA,QAAAE,SAAA,GAAAF,SAAA,MAAGX,iBAAiB,CAACgB,UAAU;MAEzDP,KAAA,GAAAF,WAAA,CAAAU,IAAA,KAAM,CAAC;MApER;MAAAR,KAAA,CACQS,qBAAqB,GAAG,CAAC,kBAAkB,CAAC;MAAAT,KAAA,CAE5CU,uBAAuB,GAAQ;QACtCC,YAAY,EAAE,EAAE;QAChBC,QAAQ,EAAE,CAAC,CAAC;QACZC,SAAS,EAAE,CAAC;QACZC,UAAU,EAAE;MACb,CAAC;MAED;AACD;AACA;AACA;AACA;AACA;AACA;AACA;AACA;MACC;MACA;MACA;MACA;MACA;MAAAd,KAAA,CACQe,cAAc,GAAG,IAAIC,MAAM,CAAC,GAAG,GAAGtB,UAAU,GAAG,WAAW,CAAC;MAAAM,KAAA,CAE3DiB,qBAAqB,GAAG,IAAID,MAAM,CAAC,GAAG,GAAGtB,UAAU,GAAG,WAAW,CAAC;MAE1E;AACD;AACA;AACA;AACA;AACA;MALCM,KAAA,CAMQkB,cAAc,GAAG,IAAIF,MAAM,CAAC,MAAM,GAAGtB,UAAU,GAAG,UAAU,CAAC;MAIrE;AACD;AACA;MAFCM,KAAA,CAGQN,UAAU,GAAGA,UAAU;MA4B9B,IAAI,CAACK,WAAW,EAAE;QACjB,MAAM,IAAIoB,QAAQ,CAAC,iCAAiC,CAAC;MACtD;MAEA,IAAIpB,WAAW,YAAYqB,WAAW,EAAE;QACvCpB,KAAA,CAAKqB,OAAO,GAAGtB,WAAW,CAACuB,SAAS,CAAC,CAAC;QACtCtB,KAAA,CAAKuB,UAAU,GAAGxB,WAAW;MAC9B,CAAC,MAAM;QACN,IAAI,OAAOA,WAAW,CAACyB,iBAAiB,KAAK,UAAU,EAAE;UACxD,MAAM,IAAIL,QAAQ,CAAC,iCAAiC,CAAC;QACtD;QAEAnB,KAAA,CAAKqB,OAAO,GAAGrB,KAAA,CAAKyB,UAAU,CAAC1B,WAAW,CAAC;QAC3CC,KAAA,CAAKuB,UAAU,GAAGxB,WAAW,CAACyB,iBAAiB,CAAC,CAAc;MAC/D;;MAEA;MACA,IAAIxB,KAAA,CAAKuB,UAAU,IAAKvB,KAAA,CAAKuB,UAAU,CAAoCG,eAAe,EAAE;QAC3F1B,KAAA,CAAKuB,UAAU,GAAIvB,KAAA,CAAKuB,UAAU,CAAoCG,eAAe,GAAG,CAAC;MAC1F;MAEA,IACC,OAAO1B,KAAA,CAAKqB,OAAO,KAAK,WAAW,IACnC,OAAOrB,KAAA,CAAKuB,UAAU,KAAK,WAAW,IACtC,OAAOvB,KAAA,CAAKuB,UAAU,CAACI,gBAAgB,KAAK,UAAU,EACrD;QACD,MAAM,IAAIR,QAAQ,CAAC,iCAAiC,CAAC;MACtD;MAEA,IAAIb,kBAAkB,KAAKf,iBAAiB,CAACqC,YAAY,IAAItB,kBAAkB,KAAKf,iBAAiB,CAACsC,cAAc,EAAE;QACrH7B,KAAA,CAAKM,kBAAkB,GAAGA,kBAAkB;MAC7C,CAAC,MAAM;QACNN,KAAA,CAAKM,kBAAkB,GAAGf,iBAAiB,CAACgB,UAAU,CAAC,CAAC;MACzD;MACA,IAAIN,KAAK,KAAKR,IAAI,CAACqC,OAAO,EAAE;QAC3B9B,KAAA,CAAK+B,MAAM,GAAG9B,KAAK;MACpB;MAAC,OAAAD,KAAA;IACF;;IAEA;AACD;AACA;AACA;AACA;IACC;IAAAgC,QAAA,CAAAnC,iBAAA,GAAAA,iBAAA;IAAAoC,cAAA,CAAApC,iBAAA,EAAAC,WAAA;IAAA,IAAAoC,MAAA,GAAArC,iBAAA,CAAAsC,SAAA;IAAAD,MAAA,CACAE,wBAAwB,GAAxB,SAAAA,wBAAwBA,CAAA,EAA+B;MACtD,MAAMC,eAA0B,GAAGC,GAAG,CAACC,EAAE,CAACC,OAAO,CAAC,sBAAsB,CAAC;MACzE;MACA,OAAOH,eAAe,CAACI,UAAU,CAAC,4BAA4B,CAAC;IAChE;;IAEA;AACD;AACA;AACA;AACA,OAJC;IAAAP,MAAA,CAKMQ,6BAA6B,GAAnC,eAAMA,6BAA6BA,CAAA,EAAwB;MAC1D,MAAML,eAA0B,GAAGC,GAAG,CAACC,EAAE,CAACC,OAAO,CAAC,sBAAsB,CAAC;MACzE,OAAOH,eAAe,EACnBM,eAAe,CAAC,YAAY,CAAC,CAC9BC,IAAI,CAAC,UAAUC,mBAA2B,EAAE;QAC5C,OAAOA,mBAAmB;MAC3B,CAAC,CAAC,CACDC,KAAK,CAAC,YAAY;QAClBC,GAAG,CAACC,KAAK,CAAC,iDAAiD,CAAC;QAC5D,MAAM,IAAI7B,QAAQ,CAAC,kCAAkC,CAAC;MACvD,CAAC,CAAC;IACJ;;IAEA;AACD;AACA;AACA;AACA;AACA,OALC;IAAAe,MAAA,CAMAT,UAAU,GAAV,SAAAA,UAAUA,CAAC1B,WAAuB,EAAU;MAC3C,OAAOqB,WAAW,CAAC6B,YAAY,CAAClD,WAAW,CAAC;IAC7C;;IAEA;AACD;AACA;AACA;AACA,OAJC;IAAAmC,MAAA,CAKAgB,wBAAwB,GAAxB,SAAAA,wBAAwBA,CAACC,UAAoB,EAAQ;MACpD,IAAI,CAACC,iBAAiB,GAAGD,UAAU;IACpC;;IAEA;AACD;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,OA/EC;IAAAjB,MAAA,CAgFAmB,QAAQ,GAAR,SAAAA,QAAQA,CACPC,eAAuB,EACvBC,WAAmB,EACnBC,qBAAsC,EACtCC,aAA4B,EAC5BC,SAAoB,EACpBC,gBAIC,EACDC,QAAiB,EACV;MACP,IAAIC,iBAAsB;QACzBC,WAAW;QACXC,YAAiB;QACjBC,kBAAkB;QAClBC,QAAQ,GAAG,KAAK;QAChBC,QAAa,GAAG,CAAC,CAAC;MACnB,MAAMC,WAA8B,GAAG,IAAI;MAE3C,MAAMC,cAAc,GAAG,IAAI,CAAC7C,UAAU,CAACI,gBAAgB,CAAC,CAAwB;MAChF;AACF;AACA;AACA;MACE,IAAIyC,cAAc,EAAE;QACnBJ,kBAAkB,GAAGI,cAAc,CAACC,iBAAiB;QAErD,IACCL,kBAAkB,IAClBA,kBAAkB,CAAC,yBAAyB,CAAC,IAC7CA,kBAAkB,CAAC,yBAAyB,CAAC,CAAC7D,MAAM,GAAG,CAAC,EACvD;UACD;UACA8D,QAAQ,GAAGD,kBAAkB,CAAC,yBAAyB,CAAC,CAAC,CAAC,CAAC,KAAK,SAAS;QAC1E;MACD;;MAEA;MACA,IAAIJ,QAAQ,KAAKA,QAAQ,KAAK,SAAS,IAAIA,QAAQ,KAAK,SAAS,CAAC,EAAE;QACnEK,QAAQ,GAAGL,QAAQ,KAAK,SAAS;MAClC,CAAC,MAAM,IAAIA,QAAQ,EAAE;QACpB,MAAM,IAAIzC,QAAQ,CAAC,oCAAoC,CAAC;MACzD;MAEA,IAAIwC,gBAAgB,KAAKvD,SAAS,IAAIuD,gBAAgB,KAAK,IAAI,EAAE;QAChEI,YAAY,GAAG,CAAC,CAAC;MAClB,CAAC,MAAM;QACNA,YAAY,GAAGJ,gBAAgB;MAChC;;MAEA;MACA;MACA,IAAI,OAAOH,qBAAqB,KAAK,QAAQ,EAAE;QAC9CK,iBAAiB,GAAGL,qBAAqB;MAC1C,CAAC,MAAM,IAAI,OAAOA,qBAAqB,KAAK,QAAQ,EAAE;QACrD,MAAMc,eAAe,GAAG,IAAI,CAACC,iCAAiC,CAC7D,IAAIC,gBAAgB,CAAC,CAAC,EACtBhB,qBAAqB,EACrB,EACD,CAAC,CAACiB,iBAAiB;QACnBZ,iBAAiB,GAAGS,eAAe,CAACI,YAAY,CAAC,CAAC;MACnD,CAAC,MAAM;QACN,MAAM,IAAIvD,QAAQ,CAAC,iCAAiC,CAAC;MACtD;MAEA+C,QAAQ,CAACS,gBAAgB,GAAG,IAAIH,gBAAgB,CAACX,iBAAiB,CAAC;MACnE,IAAI,OAAOL,qBAAqB,KAAK,QAAQ,EAAE;QAC9CU,QAAQ,CAACS,gBAAgB,GAAG,IAAI,CAACC,0BAA0B,CAACV,QAAQ,CAACS,gBAAgB,CAAC;MACvF;MACAT,QAAQ,CAACS,gBAAgB,GAAGT,QAAQ,CAACS,gBAAgB,IAAIT,QAAQ,CAACS,gBAAgB,CAACE,YAAY,CAAC,CAAC;MACjGX,QAAQ,GAAG,IAAI,CAACY,8BAA8B,CAACZ,QAAQ,CAAC,CAAC,CAAC;MAC1DA,QAAQ,GAAG,IAAI,CAACa,4BAA4B,CAACb,QAAQ,CAAC,CAAC,CAAC;;MAExD,IAAIA,QAAQ,CAACS,gBAAgB,EAAE;QAC9Bb,WAAW,GAAG,IAAI,CAACkB,qCAAqC,CAAC,IAAIR,gBAAgB,CAACN,QAAQ,CAACS,gBAAgB,CAAC,CAAC;QACzGd,iBAAiB,GAAG,IAAIW,gBAAgB,CAACN,QAAQ,CAACS,gBAAgB,CAAC,CAACD,YAAY,CAAC,CAAC;MACnF,CAAC,MAAM;QACNZ,WAAW,GAAG,CAAC,CAAC;QAChBD,iBAAiB,GAAG,IAAI;MACzB;MAEA,MAAMoB,aAAkB,GAAG;QAC1BC,MAAM,EAAE;UACPC,cAAc,EAAE7B,eAAe;UAC/B8B,MAAM,EAAE7B;QACT,CAAC;QACD8B,MAAM,EAAEvB,WAAW,IAAI,CAAC;MACzB,CAAC;MAED,MAAMwB,UAAU,GAAG,eAAAA,CAAgBzC,mBAAwB,EAAiB;QAC3E,IAAI,CAACkB,YAAY,CAACY,gBAAgB,EAAE;UACnCZ,YAAY,CAACY,gBAAgB,GAAGd,iBAAiB;QAClD;QAEA,MAAM0B,YAAY,GAAG,SAAAA,CAAA,EAAkB;UACtC,MAAMC,eAAe,GAAG3C,mBAAmB,CAAC4C,OAAO,CAACR,aAAa,EAAEd,WAAW,CAAC5C,UAAU,CAAC;UAC1FiE,eAAe,CACb5C,IAAI,CAAC,UAAU8C,QAAgB,EAAQ;YACvCC,UAAU,CAACD,QAAQ,CAAC;YACpB;UACD,CAAC,CAAC,CACD5C,KAAK,CAAC,UAAU8C,MAAe,EAAQ;YACvC7C,GAAG,CAACC,KAAK,CAAC,2CAA2C,GAAG4C,MAAM,CAAC;UAChE,CAAC,CAAC;QACJ,CAAC;QAED7B,YAAY,GAAGI,WAAW,CAACW,8BAA8B,CAACf,YAAY,CAAC;QACvE,OAAOI,WAAW,CAAC0B,oBAAoB,CAAC9B,YAAY,EAAEL,SAAS,CAAC,CAACd,IAAI,CAAC,UAAUkD,mBAAwB,EAAQ;UAC/G,IAAIA,mBAAmB,EAAE;YACxBb,aAAa,CAACc,WAAW,GAAGD,mBAAmB,CAACC,WAAW;;YAE3D;YACA;YACA;YACA;;YAEA;YACA;YACA,IAAInC,QAAQ,IAAI,SAAS,EAAE;cAC1B2B,YAAY,CAAC,CAAC;YACf,CAAC,MAAM;cACN,MAAMS,MAAM,GAAGnD,mBAAmB,CAACQ,QAAQ,CAAC4B,aAAa,EAAEd,WAAW,CAAC5C,UAAU,CAAC;cAClF;cACA,IAAI4C,WAAW,CAACf,iBAAiB,EAAE;gBAClCe,WAAW,CAACf,iBAAiB,CAAC4C,MAAM,CAAC;cACtC;YACD;UACD,CAAC,CAAC;UACF;QACD,CAAC,CAAC;MACH,CAAC;MACD,MAAMC,kBAAkB,GAAG,SAAAA,CAAUpD,mBAAwB,EAAQ;QACpEsB,WAAW,CACT+B,uBAAuB,CAACzC,aAAa,EAAS,IAAI,CAAC,CACnDb,IAAI,CAAC,gBAAgBjC,YAAoB,EAAiB;UAC1D,IAAIA,YAAY,EAAE;YACjBwD,WAAW,CAACgC,WAAW,CAACxF,YAAY,CAAC;UACtC;UACA,OAAO2E,UAAU,CAACzC,mBAAmB,CAAC;QACvC,CAAC,CAAC,CACDC,KAAK,CAAC,UAAU8C,MAAW,EAAE;UAC7B,IAAIlC,SAAS,EAAE;YACdA,SAAS,CAACkC,MAAM,CAAC;UAClB;QACD,CAAC,CAAC;MACJ,CAAC;MACD,IAAIhC,QAAQ,EAAE;QACbqB,aAAa,CAACI,MAAM,CAAC,oBAAoB,CAAC,GAAGpB,QAAQ,GAAG,SAAS,GAAG,SAAS;MAC9E;MACAE,WAAW,CACTzB,6BAA6B,CAAC,CAAC,CAC/BE,IAAI,CAAC,gBAAgBC,mBAA+B,EAAE;QACtD,IAAI;UACH,MAAMuD,QAAQ,GAAG,MAAOvD,mBAAmB,CAACwD,qBAAqB,CAChE,CAACpB,aAAa,CAAC,EACfd,WAAW,CAAC5C,UACb,CAAkD;UAClD,IAAI6E,QAAQ,CAAC,CAAC,CAAC,CAACE,SAAS,EAAE;YAC1B,IAAI,CAACrC,QAAQ,EAAE;cACdgC,kBAAkB,CAACpD,mBAAmB,CAAC;YACxC,CAAC,MAAM;cACNyC,UAAU,CAACzC,mBAAmB,CAAC;YAChC;UACD,CAAC,MAAM,IAAIa,SAAS,EAAE;YACrB;YACA,MAAMkC,MAAM,GAAG,IAAIzE,QAAQ,CAAC,kDAAkD,CAAC;YAC/EuC,SAAS,CAACkC,MAAM,CAAC;UAClB;QACD,CAAC,CAAC,OAAOA,MAAM,EAAE;UAChB,IAAIlC,SAAS,EAAE;YACd;YACA,MAAM6C,cAAc,GAAGpC,WAAW,CAACqC,qBAAqB,CAAC,4CAA4C,CAAC;YACtG9C,SAAS,CAAC6C,cAAc,CAAC;UAC1B;QACD;QACA;MACD,CAAC,CAAC,CACDzD,KAAK,CAAC,UAAU8C,MAAW,EAAE;QAC7B,IAAIlC,SAAS,EAAE;UACdA,SAAS,CAACkC,MAAM,CAAC;QAClB;MACD,CAAC,CAAC;IACJ;;IAEA;AACD;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;IACC;IAAA;IAAA1D,MAAA,CACAuE,eAAe,GAAf,SAAAA,eAAeA,CAAA,EAA4B;MAC1C,MAAMC,QAAQ,GAAGC,WAAW,CAACC,WAAW,CAAC,CAAC,CAACC,OAAO,CAAC,CAAC;MACpD;AACF;AACA;AACA;MACE,MAAMC,UAAU,GAAG,IAAI,CAACC,oBAAoB,CAACL,QAAQ,CAAC;MAEtD,IAAItC,cAAc,GAAG,IAAI,CAAC7C,UAAU,CAACI,gBAAgB,CAAC,CAA4B;MAClF;AACF;AACA;AACA;MACE,IAAIyC,cAAc,KAAKhE,SAAS,EAAE;QACjC2C,GAAG,CAACiE,OAAO,CAAC,yGAAyG,CAAC;QACtH5C,cAAc,GAAG,CAAC,CAAC;MACpB;;MAEA;MACA;MACA;MACA;MACA;MACA,MAAMJ,kBAAkB,GAAGI,cAAc,CAACC,iBAAwC;MAClF,MAAM4C,wBAA4C,GAAGjD,kBAAkB,GAAGpE,qBAAqB,CAAC,GAAG,CAAC,CAAC;MACrG,MAAMsH,cAAc,GAAGC,MAAM,CAACC,QAAQ,CAAC,CAA6B;MACpE,IAAIC,uBAA6D;MACjE,IAAIJ,wBAAwB,KAAK7G,SAAS,EAAE;QAC3CiH,uBAAuB,GAAG,IAAI,CAACC,aAAa,CAACL,wBAAwB,EAAEC,cAAc,EAAE7H,OAAO,CAACkI,MAAM,CAAC;MACvG;MAEA,IAAIC,oBAAyB,GAAG,EAAE;MAClC,IACCxD,kBAAkB,IAClBA,kBAAkB,CAACrE,4BAA4B,CAAC,IAChDqE,kBAAkB,CAACrE,4BAA4B,CAAC,CAACQ,MAAM,GAAG,CAAC,EAC1D;QACDqH,oBAAoB,GAAGC,IAAI,CAACC,KAAK,CAAC1D,kBAAkB,CAACrE,4BAA4B,CAAC,CAAC,CAAC,CAAC,CAAC;MACvF;MAEA,MAAMgI,WAAW,GAAGR,MAAM,CAACC,QAAQ,CAAC,CAA6B;MAEjE,MAAMjD,WAAW,GAAG,IAAI;MACxB,MAAMyD,cAAc,GAAG,SAAAA,CACtBC,qBAA0B,EAC1BC,uBAA4B,EAC5BC,cAAwC,EACxCC,QAAgB,EACT;QACP;QACA,MAAMC,QAAQ,GAAG9D,WAAW,CAACI,iCAAiC,CAC7D,IAAIC,gBAAgB,CAAC,CAAC,EACtBqD,qBAAqB,EACrBC,uBACD,CAAC;QACD;QACA,IAAIG,QAAQ,CAACxD,iBAAiB,CAACyD,OAAO,CAAC,CAAC,IAAID,QAAQ,CAACE,gBAAgB,CAACD,OAAO,CAAC,CAAC,IAAIF,QAAQ,KAAK3I,OAAO,CAACkI,MAAM,EAAE;UAC/G;UACA;UACA;UACA,IAAIS,QAAQ,KAAK3I,OAAO,CAAC+I,SAAS,EAAE;YACnC,MAAMxC,MAAM,GAAGzB,WAAW,CAACqC,qBAAqB,CAAC,8CAA8C,CAAC;YAChGuB,cAAc,CAACM,MAAM,CAACzC,MAAM,EAAEiC,qBAAqB,IAAI,CAAC,CAAC,EAAExI,OAAO,CAAC+I,SAAS,CAAC;UAC9E,CAAC,MAAM;YACNL,cAAc,CAACO,OAAO,CAAC,CAAC,CAAC,EAAET,qBAAqB,EAAExI,OAAO,CAACkJ,OAAO,CAAC;UACnE;QACD,CAAC,MAAM;UACN,MAAMC,aAAkB,GAAG,CAAC,CAAC;UAC7BA,aAAa,CAAC7D,gBAAgB,GAAGsD,QAAQ,CAACxD,iBAAiB,CAACC,YAAY,CAAC,CAAC;UAC1E8D,aAAa,CAACC,iBAAiB,GAAGR,QAAQ,CAACxD,iBAAiB;UAC5D+D,aAAa,CAACE,0BAA0B,GAAGT,QAAQ,CAACE,gBAAgB;UACpEK,aAAa,CAACG,yBAAyB,GAAGV,QAAQ,CAACU,yBAAyB;;UAE5E;UACA,IAAIX,QAAQ,KAAK3I,OAAO,CAACkI,MAAM,EAAE;YAChC,MAAMqB,yBAAyB,GAAG,SAAAA,CAAUC,aAAsB,EAAEC,IAAa,EAAEC,OAAgB,EAAQ;cAC1GP,aAAa,CAACQ,SAAS,GAAGH,aAAa;cACvCd,cAAc,CAACO,OAAO,CAACE,aAAa,EAAExE,kBAAkB,EAAE+E,OAAO,CAAC;YACnE,CAAC;YACD,MAAME,yBAAyB,GAAG,SAAAA,CAAUrD,MAAc,EAAEkD,IAAY,EAAEC,OAAe,EAAQ;cAChGhB,cAAc,CAACM,MAAM,CAACzC,MAAM,EAAEkD,IAAI,EAAEC,OAAO,CAAC;YAC7C,CAAC;YAED,IAAI1B,uBAAuB,KAAKjH,SAAS,EAAE;cAC1CiH,uBAAuB,CAAC6B,IAAI,CAACN,yBAAyB,CAAC;cACvDvB,uBAAuB,CAAC8B,IAAI,CAACF,yBAAyB,CAAC;YACxD;UACD,CAAC,MAAM;YACNlB,cAAc,CAACO,OAAO,CAACE,aAAa,EAAEX,qBAAqB,EAAEG,QAAQ,CAAC;UACvE;QACD;MACD,CAAC;MACD,IAAIlB,UAAU,EAAE;QACf;QACA,IAAI,CAACQ,aAAa,CAACR,UAAU,EAAEa,WAAW,EAAEtI,OAAO,CAAC2J,SAAS,CAAC;MAC/D,CAAC,MAAM;QACN;QACA,MAAMI,sBAAsB,GAAGhF,cAAc,CAAC,gBAAgB,CAAC,KAAKhE,SAAS;QAC7E,IAAIgJ,sBAAsB,EAAE;UAC3B,MAAMC,IAAI,GAAG,IAAI;UACjB;UACA,IAAI,CAAC3G,6BAA6B,CAAC,CAAC,CAClCE,IAAI,CAAC,UAAUC,mBAAwB,EAAE;YACzC,OAAOA,mBAAmB,CAACyG,kBAAkB,CAACD,IAAI,CAAC9H,UAAU,CAAC;UAC/D,CAAC,CAAC,CACDuB,KAAK,CAAC,YAAY;YAClB,MAAM8C,MAAM,GAAGzB,WAAW,CAACqC,qBAAqB,CAAC,0CAA0C,CAAC;YAC5FmB,WAAW,CAACU,MAAM,CAACzC,MAAM,EAAE,CAAC,CAAC,EAAEvG,OAAO,CAAC+I,SAAS,CAAC;UAClD,CAAC;UACD;UAAA,CACCxF,IAAI,CAAC,UAAU2G,SAAwB,EAAuC;YAC9E;YACA;YACA,IAAIf,aAAa,GAAGe,SAAS,CAACC,OAAO,CAAC,CAAC;YACvC,IAAI5D,MAAM;YACV,IAAI4C,aAAa,EAAE;cAClB,IAAI;gBACHA,aAAa,GAAGf,IAAI,CAACC,KAAK,CAACD,IAAI,CAACgC,SAAS,CAACjB,aAAa,CAAC,CAAC;cAC1D,CAAC,CAAC,OAAOkB,CAAC,EAAE;gBACX9D,MAAM,GAAGzB,WAAW,CAACqC,qBAAqB,CAAC,2CAA2C,CAAC;gBACvFmB,WAAW,CAACU,MAAM,CAACzC,MAAM,EAAE5B,kBAAkB,EAAE3E,OAAO,CAAC+I,SAAS,CAAC;gBACjE,OAAOT,WAAW,CAACgC,OAAO,CAAC,CAAC;cAC7B;YACD;YAEA,IAAInB,aAAa,EAAE;cAClB,MAAMoB,OAAO,GAAG,IAAIpF,gBAAgB,CAACgE,aAAa,CAAC7D,gBAAgB,CAAC;cAEpE,MAAMsD,QAAQ,GAAG9D,WAAW,CAACI,iCAAiC,CAC7DqF,OAAO,EACP5F,kBAAkB,EAClBwD,oBACD,CAAC;cACDgB,aAAa,CAAC7D,gBAAgB,GAAGsD,QAAQ,CAACxD,iBAAiB,CAACC,YAAY,CAAC,CAAC;cAC1E8D,aAAa,CAACC,iBAAiB,GAAGR,QAAQ,CAACxD,iBAAiB;cAC5D+D,aAAa,CAACE,0BAA0B,GAAGT,QAAQ,CAACE,gBAAgB;cACpEK,aAAa,CAACG,yBAAyB,GAAGV,QAAQ,CAACU,yBAAyB;cAC5E,MAAMC,yBAAyB,GAAG,SAAAA,CAAUC,aAAsB,EAAEC,IAAa,EAAEC,OAAgB,EAAQ;gBAC1GP,aAAa,CAACQ,SAAS,GAAGH,aAAa;gBACvClB,WAAW,CAACW,OAAO,CAACE,aAAa,EAAExE,kBAAkB,EAAE+E,OAAO,CAAC;cAChE,CAAC;cACD,MAAME,yBAAyB,GAAG,SAAAA,CAAUjG,KAAa,EAAE8F,IAAY,EAAEC,OAAe,EAAQ;gBAC/F/F,KAAK,GAAGmB,WAAW,CAACqC,qBAAqB,CAAC,sCAAsC,CAAC;gBACjFmB,WAAW,CAACU,MAAM,CAACrF,KAAK,EAAE8F,IAAI,EAAEC,OAAO,CAAC;cACzC,CAAC;cACD,IAAI9B,wBAAwB,KAAK7G,SAAS,IAAIiH,uBAAuB,KAAKjH,SAAS,EAAE;gBACpFiH,uBAAuB,CAAC6B,IAAI,CAACN,yBAAyB,CAAC;gBACvDvB,uBAAuB,CAAC8B,IAAI,CAACF,yBAAyB,CAAC;cACxD,CAAC,MAAM,IAAIT,aAAa,CAAC5I,qBAAqB,CAAC,EAAE;gBAChDyJ,IAAI,CAAC/B,aAAa,CAACkB,aAAa,CAAC5I,qBAAqB,CAAC,EAAYsH,cAAc,EAAE7H,OAAO,CAACkI,MAAM,CAAC,CAAC2B,IAAI,CACtGN,yBACD,CAAC;cACF,CAAC,MAAM;gBACNjB,WAAW,CAACW,OAAO,CAACE,aAAa,EAAExE,kBAAkB,EAAE3E,OAAO,CAAC+I,SAAS,CAAC;cAC1E;YACD,CAAC,MAAM,IAAIpE,kBAAkB,EAAE;cAC9B4D,cAAc,CAAC5D,kBAAkB,EAAEwD,oBAAoB,EAAEG,WAAW,EAAEtI,OAAO,CAAC+I,SAAS,CAAC;YACzF,CAAC,MAAM;cACN;cACAxC,MAAM,GAAGzB,WAAW,CAACqC,qBAAqB,CAAC,8CAA8C,CAAC;cAC1FmB,WAAW,CAACU,MAAM,CAACzC,MAAM,EAAE5B,kBAAkB,IAAI,CAAC,CAAC,EAAE3E,OAAO,CAAC+I,SAAS,CAAC;YACxE;YACA;UACD,CAAC,CAAC,CACDtF,KAAK,CAAC,YAAY;YAClB,MAAM8C,MAAM,GAAGzB,WAAW,CAACqC,qBAAqB,CAAC,wDAAwD,CAAC;YAC1GmB,WAAW,CAACU,MAAM,CAACzC,MAAM,EAAE,CAAC,CAAC,EAAEvG,OAAO,CAAC+I,SAAS,CAAC;UAClD,CAAC,CAAC;QACJ,CAAC,MAAM,IAAIpE,kBAAkB,EAAE;UAC9B;UACA4D,cAAc,CACb5D,kBAAkB,EAClBwD,oBAAoB,EACpBG,WAAW,EACXV,wBAAwB,KAAK7G,SAAS,GAAGf,OAAO,CAACkI,MAAM,GAAGlI,OAAO,CAACwK,SACnE,CAAC;QACF,CAAC,MAAM;UACN;UACAlC,WAAW,CAACW,OAAO,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,EAAEjJ,OAAO,CAACkJ,OAAO,CAAC;QAC7C;MACD;MAEA,OAAOZ,WAAW,CAACgC,OAAO,CAAC,CAAC;IAC7B;;IAEA;AACD;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,OAXC;IAAAzH,MAAA,CAYA4H,sBAAsB,GAAtB,SAAAA,sBAAsBA,CAACC,oBAA4B,EAAQ;MAC1D,IAAI,CAACA,oBAAoB,EAAE;QAC1BA,oBAAoB,GAAG,EAAE;MAC1B;MAEA,IAAI,CAACC,KAAK,CAACC,OAAO,CAACF,oBAAoB,CAAC,EAAE;QACzChH,GAAG,CAACC,KAAK,CAAC,mEAAmE,CAAC;QAC9E,MAAM,IAAI7B,QAAQ,CAAC,iCAAiC,CAAC;MACtD;MAEA,IAAI,CAACV,qBAAqB,GAAGsJ,oBAAoB;IAClD;;IAEA;AACD;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,OAVC;IAAA7H,MAAA,CAWAgI,sBAAsB,GAAtB,SAAAA,sBAAsBA,CAAA,EAAa;MAClC,OAAO,IAAI,CAACzJ,qBAAqB,CAAC0J,MAAM,CAAC,EAAE,CAAC;IAC7C;;IAEA;AACD;AACA;AACA;AACA;AACA,OALC;IAAAjI,MAAA,CAMAkI,qBAAqB,GAArB,SAAAA,qBAAqBA,CAACC,cAAsB,EAAW;MACtD,IAAIA,cAAc,EAAE;QACnB,IACC,EACCA,cAAc,KAAK,sBAAsB,IACzCA,cAAc,KAAK,4BAA4B,IAC/CA,cAAc,KAAK,4BAA4B,IAC/CA,cAAc,KAAK,gCAAgC,CACnD,EACA;UACD,IAAIA,cAAc,CAACC,WAAW,CAAC,CAAC,CAACC,OAAO,CAAC,MAAM,CAAC,KAAK,CAAC,EAAE;YACvD,OAAO,IAAI;UACZ,CAAC,MAAM,IAAI,IAAI,CAAC9J,qBAAqB,CAAC+J,QAAQ,CAACH,cAAc,CAAC,EAAE;YAC/D,OAAO,IAAI;UACZ;QACD;MACD;MACA,OAAO,KAAK;IACb,CAAC;IAAAnI,MAAA,CAEDuI,cAAc,GAAd,SAAAA,cAAcA,CAACJ,cAAsB,EAAW;MAC/C,OAAOA,cAAc,CAACC,WAAW,CAAC,CAAC,CAACC,OAAO,CAAC,WAAW,CAAC,KAAK,CAAC;IAC/D;;IAEA;AACD;AACA;AACA;AACA;AACA,OALC;IAAArI,MAAA,CAMA0C,0BAA0B,GAA1B,SAAAA,0BAA0BA,CAAC6D,iBAAmC,EAAoB;MACjF,IAAIiC,SAAS,EAAEC,CAAC;MAChB,MAAMC,gBAAgB,GAAGnC,iBAAiB,CAACoC,6BAA6B,CAAC,CAAC;MAC1E,KAAKF,CAAC,GAAG,CAAC,EAAEA,CAAC,GAAGC,gBAAgB,CAACzK,MAAM,EAAEwK,CAAC,EAAE,EAAE;QAC7CD,SAAS,GAAGE,gBAAgB,CAACD,CAAC,CAAC;QAC/B,IAAI,IAAI,CAACP,qBAAqB,CAACM,SAAS,CAAC,EAAE;UAC1CjC,iBAAiB,CAACqC,kBAAkB,CAACJ,SAAS,CAAC;QAChD;MACD;MACA,OAAOjC,iBAAiB;IACzB;;IAEA;AACD;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,OA1BC;IAAAvG,MAAA,CA2BAqC,iCAAiC,GAAjC,SAAAA,iCAAiCA,CAChCkE,iBAAmC,EACnCzE,kBAAuC,EACvCwD,oBAA2B,EAK1B;MACD,IAAI,CAACwC,KAAK,CAACC,OAAO,CAACzC,oBAAoB,CAAC,EAAE;QACzC,MAAM,IAAIrG,QAAQ,CAAC,iCAAiC,CAAC;MACtD;MAEA,IAAIuJ,SAAS,EAAEC,CAAC;MAChB;MACA,MAAMI,0BAAkD,GAAG,CAAC,CAAC;MAC7D,KAAKL,SAAS,IAAI1G,kBAAkB,EAAE;QACrC,IAAI,CAACA,kBAAkB,CAACgH,cAAc,CAACN,SAAS,CAAC,EAAE;UAClD;QACD;;QAEA;QACA,IAAI,IAAI,CAACN,qBAAqB,CAACM,SAAS,CAAC,IAAI,IAAI,CAACD,cAAc,CAACC,SAAS,CAAC,IAAIA,SAAS,KAAK9K,qBAAqB,EAAE;UACnH;UACA;UACA;UACA;UACA;UACA;UACA;QACD;;QAEA;QACA,IAAI,OAAOoE,kBAAkB,CAAC0G,SAAS,CAAC,KAAK,QAAQ,EAAE;UACtDK,0BAA0B,CAACL,SAAS,CAAC,GAAG1G,kBAAkB,CAAC0G,SAAS,CAAC;QACtE,CAAC,MAAM,IAAIV,KAAK,CAACC,OAAO,CAACjG,kBAAkB,CAAC0G,SAAS,CAAC,CAAC,IAAI1G,kBAAkB,CAAC0G,SAAS,CAAC,CAACvK,MAAM,KAAK,CAAC,EAAE;UACtG4K,0BAA0B,CAACL,SAAS,CAAC,GAAG1G,kBAAkB,CAAC0G,SAAS,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC;QAC3E,CAAC,MAAM,IAAIV,KAAK,CAACC,OAAO,CAACjG,kBAAkB,CAAC0G,SAAS,CAAC,CAAC,IAAI1G,kBAAkB,CAAC0G,SAAS,CAAC,CAACvK,MAAM,GAAG,CAAC,EAAE;UACpG4K,0BAA0B,CAACL,SAAS,CAAC,GAAG1G,kBAAkB,CAAC0G,SAAS,CAAC,CAAC,CAAC;QACxE,CAAC,MAAM;UACN,MAAM,IAAIvJ,QAAQ,CAAC,iCAAiC,CAAC;QACtD;MACD;;MAEA;MACA,MAAMgH,gBAAgB,GAAG,IAAI3D,gBAAgB,CAAC,CAAC;MAC/C,MAAMC,iBAAiB,GAAG,IAAID,gBAAgB,CAAC,CAAC;MAEhD,MAAMoG,gBAAgB,GAAGnC,iBAAiB,CAACwC,iBAAiB,CAAC,CAAC,CAACd,MAAM,CAAC1B,iBAAiB,CAACoC,6BAA6B,CAAC,CAAC,CAAC;MACxH,KAAKF,CAAC,GAAG,CAAC,EAAEA,CAAC,GAAGC,gBAAgB,CAACzK,MAAM,EAAEwK,CAAC,EAAE,EAAE;QAC7CD,SAAS,GAAGE,gBAAgB,CAACD,CAAC,CAAC;QAC/B,IAAID,SAAS,IAAIK,0BAA0B,EAAE;UAC5C;UACA,IAAIvD,oBAAoB,CAACgD,QAAQ,CAACE,SAAS,CAAC,EAAE;YAC7CjG,iBAAiB,CAACyG,mBAAmB,CAACR,SAAS,EAAEjC,iBAAiB,CAAC0C,QAAQ,CAACT,SAAS,CAAE,CAAC;YACxF,IAAI,CAACU,mBAAmB,CAACjD,gBAAgB,EAAEuC,SAAS,EAAE,GAAG,EAAE,IAAI,EAAEK,0BAA0B,CAACL,SAAS,CAAC,CAAC;UACxG,CAAC,MAAM;YACN,QAAQ,IAAI,CAACpK,kBAAkB;cAC9B,KAAKf,iBAAiB,CAACgB,UAAU;gBAChCkE,iBAAiB,CAACyG,mBAAmB,CAACR,SAAS,EAAEjC,iBAAiB,CAAC0C,QAAQ,CAACT,SAAS,CAAE,CAAC;gBACxF;cACD,KAAKnL,iBAAiB,CAACqC,YAAY;gBAClC,IAAI,CAACwJ,mBAAmB,CAAC3G,iBAAiB,EAAEiG,SAAS,EAAE,GAAG,EAAE,IAAI,EAAEK,0BAA0B,CAACL,SAAS,CAAC,CAAC;gBACxG;cACD,KAAKnL,iBAAiB,CAACsC,cAAc;gBACpC4C,iBAAiB,CAACyG,mBAAmB,CAACR,SAAS,EAAEjC,iBAAiB,CAAC0C,QAAQ,CAACT,SAAS,CAAE,CAAC;gBACxF,IAAI,CAACU,mBAAmB,CAAC3G,iBAAiB,EAAEiG,SAAS,EAAE,GAAG,EAAE,IAAI,EAAEK,0BAA0B,CAACL,SAAS,CAAC,CAAC;gBACxG;cACD;gBACC,MAAM,IAAIvJ,QAAQ,CAAC,iCAAiC,CAAC;YACvD;UACD;QACD,CAAC,MAAM,IAAIqG,oBAAoB,CAACgD,QAAQ,CAACE,SAAS,CAAC,EAAE;UACpD;UACAvC,gBAAgB,CAAC+C,mBAAmB,CAACR,SAAS,EAAEjC,iBAAiB,CAAC0C,QAAQ,CAACT,SAAS,CAAE,CAAC;QACxF,CAAC,MAAM;UACNjG,iBAAiB,CAACyG,mBAAmB,CAACR,SAAS,EAAEjC,iBAAiB,CAAC0C,QAAQ,CAACT,SAAS,CAAE,CAAC;QACzF;MACD;MAEA,KAAKA,SAAS,IAAIK,0BAA0B,EAAE;QAC7C;QACA,IAAIH,gBAAgB,CAACJ,QAAQ,CAACE,SAAS,CAAC,EAAE;UACzC;QACD;QAEA,IAAIlD,oBAAoB,CAACgD,QAAQ,CAACE,SAAS,CAAC,EAAE;UAC7C,IAAI,CAACU,mBAAmB,CAACjD,gBAAgB,EAAEuC,SAAS,EAAE,GAAG,EAAE,IAAI,EAAEK,0BAA0B,CAACL,SAAS,CAAC,CAAC;QACxG,CAAC,MAAM;UACN,IAAI,CAACU,mBAAmB,CAAC3G,iBAAiB,EAAEiG,SAAS,EAAE,GAAG,EAAE,IAAI,EAAEK,0BAA0B,CAACL,SAAS,CAAC,CAAC;QACzG;MACD;;MAEA;MACA,IAAI/B,yBAAyB,GAAG,KAAK;MACrC,IAAIlE,iBAAiB,CAACyD,OAAO,CAAC,CAAC,EAAE;QAChCS,yBAAyB,GAAG,IAAI;QAChC,MAAM0C,UAAU,GAAGlD,gBAAgB,CAAC0C,6BAA6B,CAAC,CAAC;QACnE,KAAKF,CAAC,GAAG,CAAC,EAAEA,CAAC,GAAGU,UAAU,CAAClL,MAAM,EAAEwK,CAAC,EAAE,EAAE;UACvClG,iBAAiB,CAACyG,mBAAmB,CAACG,UAAU,CAACV,CAAC,CAAC,EAAExC,gBAAgB,CAACgD,QAAQ,CAACE,UAAU,CAACV,CAAC,CAAC,CAAE,CAAC;QAChG;MACD;MAEA,OAAO;QACNlG,iBAAiB,EAAEA,iBAAiB;QACpC0D,gBAAgB,EAAEA,gBAAgB;QAClCQ,yBAAyB,EAAEA;MAC5B,CAAC;IACF,CAAC;IAAAzG,MAAA,CAEDkJ,mBAAmB,GAAnB,SAAAA,mBAAmBA,CAClBE,WAA6B,EAC7BZ,SAAiB,EACjBa,KAAa,EACbC,OAAe,EACfC,OAA0B,EACnB;MACP,IAAIzB,KAAK,CAACC,OAAO,CAACwB,OAAO,CAAC,EAAE;QAC3B,KAAK,IAAId,CAAC,GAAG,CAAC,EAAEA,CAAC,GAAGc,OAAO,CAACtL,MAAM,EAAEwK,CAAC,EAAE,EAAE;UACxCW,WAAW,CAACI,eAAe,CAAChB,SAAS,EAAEa,KAAK,EAAEC,OAAO,EAAEC,OAAO,CAACd,CAAC,CAAC,CAAC;QACnE;MACD,CAAC,MAAM;QACNW,WAAW,CAACI,eAAe,CAAChB,SAAS,EAAEa,KAAK,EAAEC,OAAO,EAAEC,OAAO,CAAC;MAChE;IACD;;IAEA;AACD;AACA;AACA;AACA,OAJC;IAAAvJ,MAAA,CAKAiE,WAAW,GAAX,SAAAA,WAAWA,CAACxF,YAAoB,EAAQ;MACvC,MAAMgL,YAAY,GAAG,IAAI,CAACtK,OAAO,CAACsK,YAAY,GAAG,IAAI,CAACtK,OAAO,CAACsK,YAAY,GAAGhF,WAAW,CAACC,WAAW,CAAC,CAAC;MACtG,MAAMgF,WAAW,GAAGD,YAAY,CAAC9E,OAAO,CAAC,CAAC;MAC1C;AACF;AACA;AACA;MACE,MAAMgF,WAAW,GAAG,IAAI,CAACC,wBAAwB,CAACF,WAAW,EAAEjL,YAAY,CAAC;MAC5EgL,YAAY,CAACxF,WAAW,CAAC0F,WAAW,CAAC;IACtC;;IAEA;AACD;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,OAhCC;IAAA3J,MAAA,CAiCAgE,uBAAuB,GAAvB,SAAAA,uBAAuBA,CACtB6F,aAA2B,EAC3BC,qBAA+B,EAC/BC,gBAA0B,EACD;MACzB,IAAI,OAAOD,qBAAqB,KAAK,SAAS,EAAE;QAC/CA,qBAAqB,GAAG,IAAI,CAAC,CAAC;MAC/B;MACA,MAAM7H,WAAW,GAAG,IAAI;MACxB,MAAMwD,WAAW,GAAGR,MAAM,CAACC,QAAQ,CAAC,CAAC;MAErC,MAAM8E,aAAa,GAAG,SAAAA,CAAUvL,YAAoB,EAAQ;QAC3D,MAAMgL,YAAY,GAAGxH,WAAW,CAAC9C,OAAO,CAACsK,YAAY,GAAGxH,WAAW,CAAC9C,OAAO,CAACsK,YAAY,GAAGhF,WAAW,CAACC,WAAW,CAAC,CAAC;QACpH,MAAMgF,WAAW,GAAGD,YAAY,CAAC9E,OAAO,CAAC,CAAC;QAC1C;AACH;AACA;AACA;QACG,MAAMgF,WAAW,GAAG1H,WAAW,CAAC2H,wBAAwB,CAACF,WAAW,EAAEjL,YAAY,CAAC;QACnFgL,YAAY,CAACxF,WAAW,CAAC0F,WAAW,CAAC;MACtC,CAAC;;MAED;MACA,IAAIM,aAAa,CAACJ,aAAuB,CAAC,EAAE;QAC3CpE,WAAW,CAACW,OAAO,CAAC,EAAE,CAAC;QACvB,OAAOX,WAAW,CAACgC,OAAO,CAAC,CAAC;MAC7B;;MAEA;MACA,MAAMyC,kBAAkB,GAAG,IAAI,CAAC1L,uBAAuB,CAACC,YAAY;MAEpE,MAAM0L,kBAAkB,GAAG5E,IAAI,CAACgC,SAAS,CAACsC,aAAa,CAAC,KAAKtE,IAAI,CAACgC,SAAS,CAAC,IAAI,CAAC/I,uBAAuB,CAACE,QAAQ,CAAC;MAClH,IAAIyL,kBAAkB,IAAID,kBAAkB,EAAE;QAC7C;QACA,IAAI,CAAC1L,uBAAuB,CAACG,SAAS,EAAE;;QAExC;QACAqL,aAAa,CAACE,kBAAkB,CAAC;QACjCzE,WAAW,CAACW,OAAO,CAAC8D,kBAAkB,CAAC;QACvC,OAAOzE,WAAW,CAACgC,OAAO,CAAC,CAAC;MAC7B;;MAEA;MACA,IAAI,CAACjJ,uBAAuB,CAACI,UAAU,EAAE;MAEzC,MAAMwL,aAAa,GAAG,SAAAA,CAAU3L,YAAoB,EAAQ;QAC3D;QACA,IAAI,CAACsL,gBAAgB,IAAI,CAACD,qBAAqB,EAAE;UAChDE,aAAa,CAACvL,YAAY,CAAC;QAC5B;;QAEA;QACAwD,WAAW,CAACzD,uBAAuB,CAACE,QAAQ,GAAGmL,aAAa;QAC5D5H,WAAW,CAACzD,uBAAuB,CAACC,YAAY,GAAGA,YAAY;QAC/DgH,WAAW,CAACW,OAAO,CAAC3H,YAAY,CAAC;MAClC,CAAC;MAED,MAAM+C,SAAS,GAAG,SAAAA,CAAUkC,MAAe,EAAQ;QAClD+B,WAAW,CAACU,MAAM,CAACzC,MAAM,CAAC;MAC3B,CAAC;MAED,IAAI,CAAC2G,kBAAkB,CAACR,aAAa,EAAEO,aAAa,EAAE5I,SAAS,CAAC,CAC9Dd,IAAI,CAAC,UAAUjC,YAAiB,EAAE;QAClC;AACJ;AACA;AACA;QACI,IAAIA,YAAY,KAAKP,SAAS,EAAE;UAC/B;UACA;UACA;UACA,IAAI,CAAC6L,gBAAgB,IAAID,qBAAqB,EAAE;YAC/CE,aAAa,CAACvL,YAAY,CAAC;UAC5B;QACD;QACA;MACD,CAAC,CAAC,CACDmC,KAAK,CAAC,YAAY;QAClBC,GAAG,CAACC,KAAK,CAAC,6CAA6C,CAAC;MACzD,CAAC,CAAC;MAEH,OAAO2E,WAAW,CAACgC,OAAO,CAAC,CAAC;IAC7B;;IAEA;AACD;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,OAhCC;IAAAzH,MAAA,CAiCAsK,kBAAkB,GAAlB,SAAAA,kBAAkBA,CAACT,aAA2B,EAAEC,qBAA+B,EAA0B;MACxGjJ,GAAG,CAACC,KAAK,CACR,+HAA+H,EAC/H5C,SAAS,EACT,qCACD,CAAC;MACD,IAAI,OAAO4L,qBAAqB,KAAK,SAAS,EAAE;QAC/CA,qBAAqB,GAAG,IAAI,CAAC,CAAC;MAC/B;MACA,MAAM7H,WAAW,GAAG,IAAI;MACxB,MAAMwD,WAAW,GAAGR,MAAM,CAACC,QAAQ,CAAC,CAAC;MAErC,MAAM8E,aAAa,GAAG,SAAAA,CAAUvL,YAAoB,EAAQ;QAC3D,MAAMgL,YAAY,GAAGxH,WAAW,CAAC9C,OAAO,CAACsK,YAAY,GAAGxH,WAAW,CAAC9C,OAAO,CAACsK,YAAY,GAAGhF,WAAW,CAACC,WAAW,CAAC,CAAC;QACpH,MAAMgF,WAAW,GAAGD,YAAY,CAAC9E,OAAO,CAAC,CAAC;QAC1C;AACH;AACA;AACA;QACG,MAAMgF,WAAW,GAAG1H,WAAW,CAAC2H,wBAAwB,CAACF,WAAW,EAAEjL,YAAY,CAAC;QACnFgL,YAAY,CAACxF,WAAW,CAAC0F,WAAW,CAAC;MACtC,CAAC;;MAED;MACA,IAAIM,aAAa,CAACJ,aAAuB,CAAC,EAAE;QAC3CpE,WAAW,CAACW,OAAO,CAAC,EAAE,CAAC;QACvB,OAAOX,WAAW,CAACgC,OAAO,CAAC,CAAC;MAC7B;;MAEA;MACA,MAAMyC,kBAAkB,GAAG,IAAI,CAAC1L,uBAAuB,CAACC,YAAY;MAEpE,MAAM0L,kBAAkB,GAAG5E,IAAI,CAACgC,SAAS,CAACsC,aAAa,CAAC,KAAKtE,IAAI,CAACgC,SAAS,CAAC,IAAI,CAAC/I,uBAAuB,CAACE,QAAQ,CAAC;MAClH,IAAIyL,kBAAkB,IAAID,kBAAkB,EAAE;QAC7C;QACA,IAAI,CAAC1L,uBAAuB,CAACG,SAAS,EAAE;;QAExC;QACAqL,aAAa,CAACE,kBAAkB,CAAC;QACjCzE,WAAW,CAACW,OAAO,CAAC8D,kBAAkB,CAAC;QACvC,OAAOzE,WAAW,CAACgC,OAAO,CAAC,CAAC;MAC7B;;MAEA;MACA,IAAI,CAACjJ,uBAAuB,CAACI,UAAU,EAAE;MAEzC,MAAMwL,aAAa,GAAG,SAAAA,CAAU3L,YAAiB,EAAQ;QACxD;QACA,IAAI,CAACqL,qBAAqB,EAAE;UAC3BE,aAAa,CAACvL,YAAY,CAAC;QAC5B;;QAEA;QACAwD,WAAW,CAACzD,uBAAuB,CAACE,QAAQ,GAAGmL,aAAa;QAC5D5H,WAAW,CAACzD,uBAAuB,CAACC,YAAY,GAAGA,YAAY;QAC/DgH,WAAW,CAACW,OAAO,CAAC3H,YAAY,CAAC;MAClC,CAAC;MAED,MAAM+C,SAAS,GAAG,SAAAA,CAAUkC,MAAW,EAAQ;QAC9C+B,WAAW,CAACU,MAAM,CAACzC,MAAM,CAAC;MAC3B,CAAC;MAED,MAAMjF,YAAY,GAAG,IAAI,CAAC8L,aAAa,CAACV,aAAa,EAAEO,aAAa,EAAE5I,SAAS,CAAC;MAChF;AACF;AACA;AACA;AACA;MACE,IAAI/C,YAAY,KAAKP,SAAS,EAAE;QAC/B;QACA;QACA;QACA,IAAI4L,qBAAqB,EAAE;UAC1BE,aAAa,CAACvL,YAAY,CAAC;QAC5B;MACD;MAEA,OAAOgH,WAAW,CAACgC,OAAO,CAAC,CAAC;IAC7B;;IAEA;AACD;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,OAtCC;IAAAzH,MAAA,CAuCAwK,qCAAqC,GAArC,SAAAA,qCAAqCA,CAACX,aAA2B,EAAEC,qBAA+B,EAAU;MAC3GjJ,GAAG,CAACC,KAAK,CACR,kJAAkJ,EAClJ5C,SAAS,EACT,qCACD,CAAC;MACD,IAAI,OAAO4L,qBAAqB,KAAK,SAAS,EAAE;QAC/CA,qBAAqB,GAAG,KAAK,CAAC,CAAC;MAChC;MAEA,MAAM7H,WAAW,GAAG,IAAI;MACxB,MAAMwI,gBAAgB,GAAGxF,MAAM,CAACC,QAAQ,CAAC,CAAC;;MAE1C;MACA,IAAI+E,aAAa,CAACJ,aAAa,CAAC,EAAE;QACjC,OAAO;UACNhG,WAAW,EAAE,EAAE;UACf4D,OAAO,EAAEgD,gBAAgB,CAACrE,OAAO,CAAC,EAAE;QACrC,CAAC;MACF;;MAEA;MACA,MAAM8D,kBAAkB,GAAG,IAAI,CAAC1L,uBAAuB,CAACC,YAAY;MAEpE,MAAM0L,kBAAkB,GAAG5E,IAAI,CAACgC,SAAS,CAACsC,aAAa,CAAC,KAAKtE,IAAI,CAACgC,SAAS,CAAC,IAAI,CAAC/I,uBAAuB,CAACE,QAAQ,CAAC;MAClH,IAAIyL,kBAAkB,IAAID,kBAAkB,EAAE;QAC7C;QACA,IAAI,CAAC1L,uBAAuB,CAACG,SAAS,EAAE;QACxC,OAAO;UACNkF,WAAW,EAAEqG,kBAAkB;UAC/BzC,OAAO,EAAEgD,gBAAgB,CAACrE,OAAO,CAAC8D,kBAAkB;QACrD,CAAC;MACF;;MAEA;MACA,IAAI,CAAC1L,uBAAuB,CAACI,UAAU,EAAE;MAEzC,MAAMwL,aAAa,GAAG,SAAAA,CAAU3L,YAAiB,EAAQ;QACxD;QACA,IAAI,CAACqL,qBAAqB,EAAE;UAC3B7H,WAAW,CAACgC,WAAW,CAACxF,YAAY,CAAC;QACtC;;QAEA;QACAwD,WAAW,CAACzD,uBAAuB,CAACE,QAAQ,GAAGmL,aAAa;QAC5D5H,WAAW,CAACzD,uBAAuB,CAACC,YAAY,GAAGA,YAAY;QAC/DgM,gBAAgB,CAACrE,OAAO,CAAC3H,YAAY,CAAC;MACvC,CAAC;MAED,MAAM+C,SAAS,GAAG,SAAAA,CAAUkC,MAAW,EAAQ;QAC9C+G,gBAAgB,CAACtE,MAAM,CAACzC,MAAM,CAAC;MAChC,CAAC;MAED,MAAMjF,YAAY,GAAG,IAAI,CAAC8L,aAAa,CAACV,aAAa,EAAEO,aAAa,EAAE5I,SAAS,CAAC;MAChF;AACF;AACA;AACA;AACA;MACE;MACA;MACA;MACA;MACA;MACA;MACA;MACA;MACA,OAAO;QACNqC,WAAW,EAAEpF,YAAY;QACzBgJ,OAAO,EAAEgD,gBAAgB,CAAChD,OAAO,CAAC;MACnC,CAAC;IACF;;IAEA;AACD;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;IACC;IAAA;IAAAzH,MAAA,CACA0K,kCAAkC,GAAlC,SAAAA,kCAAkCA,CACjCC,qBAA0B,EAC1BhJ,iBAAyB,EACzBkI,aAA4B,EAC5BpI,gBAIC,EAC4C;MAC7C,MAAMgE,WAAW,GAAGR,MAAM,CAACC,QAAQ,CAAC,CAAgD;MACpF,IAAI0F,mBAAwB;MAC5B,IAAID,qBAAqB,IAAIzM,SAAS,EAAE;QACvC0M,mBAAmB,GAAGD,qBAAqB,CAACE,kBAAkB;MAC/D;MAEA,IAAIhJ,YAAiB;MACrB,MAAMI,WAA8B,GAAG,IAAI;MAE3C,IAAIR,gBAAgB,KAAKvD,SAAS,EAAE;QACnC2D,YAAY,GAAG,CAAC,CAAC;MAClB,CAAC,MAAM;QACNA,YAAY,GAAGJ,gBAAgB;MAChC;MAEA,MAAMqJ,sBAAsB,GAAG,SAAAA,CAAUC,sBAA2B,EAAEC,oBAAyB,EAAQ;QACtG;QACAA,oBAAoB,GAAGnJ,YAAY,CAACY,gBAAgB,IAAIuI,oBAAoB,IAAI,IAAI;QAEpF,MAAMC,oBAAoB,GAAG3N,mBAAmB,CAAC4N,gBAAgB,GAAG5N,mBAAmB,CAAC6N,qBAAqB;QAC7G;AACH;AACA;AACA;AACA;AACA;;QAEG,MAAMC,YAAY,GAAGnJ,WAAW,CAACoJ,gCAAgC,CAChEN,sBAAsB,EACtBC,oBAAoB,EACpBC,oBACD,CAAC;QACDD,oBAAoB,GAAGI,YAAY,CAAC5I,YAAY,CAAC,CAAC;;QAElD;QACA,IAAIR,QAAa,GAAG,CAAC,CAAC;QACtBA,QAAQ,CAACS,gBAAgB,GAAG2I,YAAY,CAACzI,YAAY,CAAC,CAAC;QAEvDX,QAAQ,GAAGC,WAAW,CAACW,8BAA8B,CAACZ,QAAQ,CAAC;QAE/DA,QAAQ,GAAGC,WAAW,CAACY,4BAA4B,CAACb,QAAQ,CAAC;QAE7D+I,sBAAsB,GAAG/I,QAAQ,CAACS,gBAAgB,GAC/CR,WAAW,CAACa,qCAAqC,CAAC,IAAIR,gBAAgB,CAACN,QAAQ,CAACS,gBAAgB,CAAC,CAAC,GAClG,CAAC,CAAC;QAEL,MAAM6I,iBAAiB,GAAG,SAAAA,CAAU7M,YAAiB,EAAQ;UAC5D,IAAIkM,qBAAqB,KAAKzM,SAAS,EAAE;YACxC;YACAuH,WAAW,CAACW,OAAO,CAAC2E,sBAAsB,EAAEtM,YAAY,CAAC;UAC1D,CAAC,MAAM;YACN;YACAkM,qBAAqB,CAACY,qBAAqB,CAACR,sBAAsB,CAAC;YACnEJ,qBAAqB,CAACa,cAAc,CAAC/M,YAAY,CAAC;YAClDkM,qBAAqB,CAACc,IAAI,CAAC,CAAC,CAAC,CAAC;YAC9B;YACAhG,WAAW,CAACW,OAAO,CAACuE,qBAAqB,CAAC;UAC3C;QACD,CAAC;QAED,MAAMnJ,SAAS,GAAG,SAAAA,CAAUkC,MAAW,EAAQ;UAC9C+B,WAAW,CAACU,MAAM,CAACzC,MAAM,CAAC;QAC3B,CAAC;QAED7B,YAAY,CAACY,gBAAgB,GAAGuI,oBAAoB;QAEpDnJ,YAAY,GAAGI,WAAW,CAACW,8BAA8B,CAACf,YAAY,CAAC;QAEvEI,WAAW,CAACoI,kBAAkB,CAACxI,YAAY,EAAEyJ,iBAAiB,EAAE9J,SAAS,CAAC;MAC3E,CAAC;MAED,IAAIqI,aAAa,EAAE;QAClB,MAAM6B,0BAA0B,GAAG,IAAI,CAAC1H,uBAAuB,CAAC6F,aAAa,EAAE,IAAI,CAAC;;QAEpF;QACA6B,0BAA0B,CAAC1E,IAAI,CAAC,YAAY;UAC3C8D,sBAAsB,CAACF,mBAAmB,EAAEjJ,iBAAiB,CAAC;QAC/D,CAAC,CAAC;QAEF+J,0BAA0B,CAACzE,IAAI,CAAC,UAAUvD,MAAW,EAAE;UACtD+B,WAAW,CAACU,MAAM,CAACzC,MAAM,CAAC;QAC3B,CAAC,CAAC;MACH,CAAC,MAAM;QACN;QACAoH,sBAAsB,CAACF,mBAAmB,EAAEjJ,iBAAiB,CAAC;MAC/D;MAEA,OAAO8D,WAAW,CAACgC,OAAO,CAAC,CAAC;IAC7B;;IAEA;AACD;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;IACC;IAAA;IAAAzH,MAAA,CACA2L,+BAA+B,GAA/B,SAAAA,+BAA+BA,CAAChK,iBAAyB,EAA8C;MACtG,OAAO,IAAI,CAAC+I,kCAAkC,CAACxM,SAAS,EAAEyD,iBAAiB,EAAEzD,SAAS,EAAEA,SAAS,CAAC;IACnG;;IAEA;AACD;AACA;AACA;AACA,OAJC;IAAA8B,MAAA,CAKM4L,mBAAmB,GAAzB,eAAMA,mBAAmBA,CAACC,OAAe,EAA+B;MACvE,IAAI;QACH,MAAMC,eAAe,GAAG,MAAM,IAAI,CAACtL,6BAA6B,CAAC,CAAC;QAClE,OAAO,MAAMsL,eAAe,CAACvI,OAAO,CAAC;UAAEwI,gBAAgB,EAAEF;QAAQ,CAAC,CAAC;MACpE,CAAC,CAAC,OAAO/K,KAAc,EAAE;QACxB,MAAMkL,OAAO,GAAGlL,KAAK,YAAYmL,KAAK,GAAGnL,KAAK,CAACkL,OAAO,GAAGE,MAAM,CAACpL,KAAK,CAAC;QACtED,GAAG,CAACC,KAAK,CAAC,yCAAyCkL,OAAO,EAAE,CAAC;QAC7D,MAAMC,KAAK,CAACD,OAAO,CAAC;MACrB;IACD,CAAC;IAAAhM,MAAA,CAEDmM,0BAA0B,GAA1B,SAAAA,0BAA0BA,CACzBvB,mBAA4C,EAC5CxB,WAA6B,EAC7B6B,oBAAyB,EACN;MACnB;MACA,KAAK,MAAMmB,aAAa,IAAIxB,mBAAmB,EAAE;QAChD,IAAIA,mBAAmB,CAAC9B,cAAc,CAACsD,aAAa,CAAC,EAAE;UACtD;UACA;UACA,IAAIC,uBAAuB,GAAGzB,mBAAmB,CAACwB,aAAa,CAAC;UAChE,IAAIC,uBAAuB,YAAYC,IAAI,EAAE;YAC5C;YACAD,uBAAuB,GAAGA,uBAAuB,CAACE,MAAM,CAAC,CAAC;UAC3D,CAAC,MAAM,IACNzE,KAAK,CAACC,OAAO,CAACsE,uBAAuB,CAAC,IACrCA,uBAAuB,IAAI,OAAOA,uBAAuB,KAAK,QAAS,EACvE;YACDA,uBAAuB,GAAG9G,IAAI,CAACgC,SAAS,CAAC8E,uBAAuB,CAAC;UAClE,CAAC,MAAM,IAAI,OAAOA,uBAAuB,KAAK,QAAQ,IAAI,OAAOA,uBAAuB,KAAK,SAAS,EAAE;YACvGA,uBAAuB,GAAGA,uBAAuB,CAACG,QAAQ,CAAC,CAAC;UAC7D;UAEA,IAAIH,uBAAuB,KAAK,EAAE,EAAE;YACnC,IAAIpB,oBAAoB,GAAG3N,mBAAmB,CAACmP,iBAAiB,EAAE;cACjE5L,GAAG,CAAC6L,IAAI,CACP,qBAAqB,GACpBN,aAAa,GACb,mFACF,CAAC;cACD;YACD;UACD;UAEA,IAAIC,uBAAuB,KAAK,IAAI,EAAE;YACrC,IAAIpB,oBAAoB,GAAG3N,mBAAmB,CAAC4N,gBAAgB,EAAE;cAChE,MAAM,IAAIjM,QAAQ,CAAC,iCAAiC,CAAC;YACtD,CAAC,MAAM;cACN4B,GAAG,CAACiE,OAAO,CAAC,qBAAqB,GAAGsH,aAAa,GAAG,sDAAsD,CAAC;cAC3G,SAAS,CAAC;YACX;UACD;UAEA,IAAIC,uBAAuB,KAAKnO,SAAS,EAAE;YAC1C,IAAI+M,oBAAoB,GAAG3N,mBAAmB,CAAC6N,qBAAqB,EAAE;cACrE,MAAM,IAAIlM,QAAQ,CAAC,iCAAiC,CAAC;YACtD,CAAC,MAAM;cACN4B,GAAG,CAACiE,OAAO,CAAC,qBAAqB,GAAGsH,aAAa,GAAG,2DAA2D,CAAC;cAChH;YACD;UACD;UAEA,IAAI,OAAOC,uBAAuB,KAAK,QAAQ,IAAIA,uBAAuB,YAAYH,MAAM,EAAE;YAC7F9C,WAAW,CAACI,eAAe,CAAC4C,aAAa,EAAE,GAAG,EAAE,IAAI,EAAEC,uBAAuB,CAACG,QAAQ,CAAC,CAAC,CAAC;UAC1F,CAAC,MAAM;YACN,MAAM,IAAIvN,QAAQ,CAAC,iCAAiC,CAAC;UACtD;QACD;MACD;MACA,OAAOmK,WAAW;IACnB;;IAEA;AACD;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,OA9BC;IAAApJ,MAAA,CA+BAqL,gCAAgC,GAAhC,SAAAA,gCAAgCA,CAC/BsB,mBAAmC,EACnChL,iBAAsD,EAEnC;MAAA,IADnBsJ,oBAA4B,GAAAjN,SAAA,CAAAC,MAAA,QAAAD,SAAA,QAAAE,SAAA,GAAAF,SAAA,MAAGV,mBAAmB,CAACsP,QAAQ;MAE3D,MAAMrG,iBAAiB,GAAG,IAAIjE,gBAAgB,CAACX,iBAAiB,CAAC;MACjE,MAAMkL,cAAc,GAAG,IAAIvK,gBAAgB,CAAC,CAAC;MAC7C,MAAML,WAAW,GAAG,IAAI;MAExB,MAAM6K,SAAS,GAAGvG,iBAAiB,CAACwG,mBAAmB,CAAC,CAAC;MACzD,IAAID,SAAS,EAAE;QACdD,cAAc,CAACG,mBAAmB,CAACF,SAAS,CAAC;MAC9C;MAEA,MAAMG,UAAU,GAAG1G,iBAAiB,CAAC2G,sBAAsB,CAAC,CAAC;MAC7D,IAAID,UAAU,EAAE;QACfJ,cAAc,CAACM,sBAAsB,CAACF,UAAU,CAAC;MAClD;MACA,IAAInF,KAAK,CAACC,OAAO,CAAC4E,mBAAmB,CAAC,EAAE;QACvCA,mBAAmB,CAACS,OAAO,CAAC,UAAUxC,mBAAwB,EAAE;UAC/D3I,WAAW,CAACkK,0BAA0B,CAACvB,mBAAmB,EAAEiC,cAAc,EAAE5B,oBAAoB,CAAC;QAClG,CAAC,CAAC;MACH,CAAC,MAAM;QACN,IAAI,CAACkB,0BAA0B,CAACQ,mBAAmB,EAA6BE,cAAc,EAAE5B,oBAAoB,CAAC;MACtH;;MAEA;MACA,MAAMoC,WAAW,GAAG9G,iBAAiB,CAACwC,iBAAiB,CAAC,CAAC;MACzD,IAAIN,CAAC;MACL,KAAKA,CAAC,GAAG,CAAC,EAAEA,CAAC,GAAG4E,WAAW,CAACpP,MAAM,EAAEwK,CAAC,EAAE,EAAE;QACxC,IAAI,CAACoE,cAAc,CAACS,eAAe,CAACD,WAAW,CAAC5E,CAAC,CAAC,CAAC,EAAE;UACpDoE,cAAc,CAACrD,eAAe,CAAC6D,WAAW,CAAC5E,CAAC,CAAC,EAAE,GAAG,EAAE,IAAI,EAAElC,iBAAiB,CAACgH,YAAY,CAACF,WAAW,CAAC5E,CAAC,CAAC,CAAC,CAAC;QAC1G;MACD;;MAEA;MACA,MAAM+E,eAAe,GAAGjH,iBAAiB,CAACoC,6BAA6B,CAAC,CAAC;MACzE,KAAKF,CAAC,GAAG,CAAC,EAAEA,CAAC,GAAG+E,eAAe,CAACvP,MAAM,EAAEwK,CAAC,EAAE,EAAE;QAC5C;QACA,MAAMgF,aAAoB,GAAGlH,iBAAiB,CAAC+G,eAAe,CAACE,eAAe,CAAC/E,CAAC,CAAC,CAAE;QACnF,IAAI,CAACoE,cAAc,CAACS,eAAe,CAACE,eAAe,CAAC/E,CAAC,CAAC,CAAC,EAAE;UACxD,KAAK,IAAIiF,CAAC,GAAG,CAAC,EAAEA,CAAC,GAAGD,aAAa,CAACxP,MAAM,EAAEyP,CAAC,EAAE,EAAE;YAC9Cb,cAAc,CAACrD,eAAe,CAC7BgE,eAAe,CAAC/E,CAAC,CAAC,EAClBgF,aAAa,CAACC,CAAC,CAAC,CAACC,IAAI,EACrBF,aAAa,CAACC,CAAC,CAAC,CAACE,MAAM,EACvBH,aAAa,CAACC,CAAC,CAAC,CAACG,GAAG,EACpBJ,aAAa,CAACC,CAAC,CAAC,CAACI,IAClB,CAAC;UACF;QACD;MACD;MAEA,OAAOjB,cAAc;IACtB,CAAC;IAAA7M,MAAA,CAED+N,mCAAmC,GAAnC,SAAAA,mCAAmCA,CAACC,iBAA0B,EAAW;MACxE;AACF;AACA;AACA;AACA;AACA;;MAEE,IAAIA,iBAAiB,KAAK9P,SAAS,EAAE;QACpC,OAAOA,SAAS;MACjB;MAEA,IAAI+P,0BAA0B,GAAGD,iBAAiB;MAElD,IAAI,OAAOA,iBAAiB,KAAK,QAAQ,EAAE;QAC1CC,0BAA0B,GAAG1I,IAAI,CAACgC,SAAS,CAACyG,iBAAiB,CAAC;MAC/D;MAEA,OAAOC,0BAA0B;IAClC,CAAC;IAAAjO,MAAA,CAEDkO,wBAAwB,GAAxB,SAAAA,wBAAwBA,CAACC,OAA4B,EAAE/D,aAAwB,EAAE5I,SAAoB,EAAQ;MAC5G2M,OAAO,CAAC1G,OAAO,CAACT,IAAI,CAAC,YAAY;QAChC,IAAIoD,aAAa,EAAE;UAClBA,aAAa,CAAC+D,OAAO,CAACtK,WAAW,CAAC;QACnC;MACD,CAAC,CAAC;MAEF,IAAIrC,SAAS,EAAE;QACd,MAAMS,WAAW,GAAG,IAAI;QACxBkM,OAAO,CAAC1G,OAAO,CAACR,IAAI,CAAC,YAAY;UAChC,MAAMvD,MAAM,GAAGzB,WAAW,CAACqC,qBAAqB,CAAC,uCAAuC,CAAC;UACzF9C,SAAS,CAACkC,MAAM,CAAC;QAClB,CAAC,CAAC;MACH;IACD,CAAC;IAAA1D,MAAA,CAEKqK,kBAAkB,GAAxB,eAAMA,kBAAkBA,CAAC3L,QAAsB,EAAE0L,aAAuB,EAAE5I,SAAmB,EAA+B;MAC3H,MAAMS,WAAW,GAAG,IAAI;MACxB,OAAO,IAAI,CAAC0B,oBAAoB,CAACjF,QAAQ,EAAE8C,SAAS,CAAC,CAACd,IAAI,CAAC,UAC1DyN,OAA+C,EAC1B;QACrB,IAAIA,OAAO,EAAE;UACZlM,WAAW,CAACiM,wBAAwB,CAACC,OAAO,EAAE/D,aAAa,EAAE5I,SAAS,CAAC;UACvE,OAAO2M,OAAO,CAACtK,WAAW;QAC3B;QAEA,OAAO3F,SAAS;MACjB,CAAC,CAAC;IACH,CAAC;IAAA8B,MAAA,CAEDuK,aAAa,GAAb,SAAAA,aAAaA,CAAC7L,QAAsB,EAAE0L,aAAuB,EAAE5I,SAAmB,EAAsB;MACvG,MAAM2M,OAAO,GAAG,IAAI,CAACC,gCAAgC,CAAC1P,QAAQ,EAAE8C,SAAS,CAAC;MAC1E,IAAI2M,OAAO,EAAE;QACZ,IAAI,CAACD,wBAAwB,CAACC,OAAO,EAAE/D,aAAa,EAAE5I,SAAS,CAAC;QAChE,OAAO2M,OAAO,CAACtK,WAAW;MAC3B;MAEA,OAAO3F,SAAS;IACjB,CAAC;IAAA8B,MAAA,CAEDqO,kCAAkC,GAAlC,SAAAA,kCAAkCA,CACjC3P,QAAsB,EACtB2I,SAAwB,EACxB7F,SAAoB,EACmD;MACvE,MAAM/C,YAAY,GAAG4I,SAAS,CAACiH,MAAM,CAAC,CAAC;MACvC,MAAMC,eAAe,GAAG,IAAI,CAACC,oBAAoB,CAAC9P,QAAQ,EAAE8C,SAAS,CAAC;MACtE,IAAI,CAAC+M,eAAe,EAAE;QACrB,OAAOrQ,SAAS;MACjB;MACAmJ,SAAS,CAACoH,OAAO,CAACF,eAAe,CAAC;MAClC,MAAMG,YAAY,GAAGrH,SAAS,CAACsH,IAAI,CAAC,CAAC;MAErC,OAAO;QACN9K,WAAW,EAAEpF,YAAY;QACzBgJ,OAAO,EAAEiH,YAAY,CAACjH,OAAO,CAAC;MAC/B,CAAC;IACF,CAAC;IAAAzH,MAAA,CAEDwO,oBAAoB,GAApB,SAAAA,oBAAoBA,CAAC9P,QAAsB,EAAE8C,SAAc,EAA4B;MACtF,IAAI+M,eAAsC,GAAG,CAAC,CAAC;MAE/C,IAAI7P,QAAQ,CAACoK,cAAc,CAAC,kBAAkB,CAAC,EAAE;QAChDyF,eAAe,CAAC9L,gBAAgB,GAAG/D,QAAQ,CAAC+D,gBAAgB;QAE5D,IAAI/D,QAAQ,CAAC+D,gBAAgB,EAAE;UAC9B;AACJ;AACA;AACA;UACI,IAAI,OAAO/D,QAAQ,CAAC+D,gBAAgB,KAAK,QAAQ,EAAE;YAClD,IAAI;cACH8L,eAAe,CAAC9L,gBAAgB,GAAG8C,IAAI,CAACC,KAAK,CAAC9G,QAAQ,CAAC+D,gBAAgB,CAAC;YACzE,CAAC,CAAC,OAAO+E,CAAC,EAAE;cACX,MAAM9D,MAAM,GAAG,IAAI,CAACY,qBAAqB,CAAC,2CAA2C,CAAC;cACtF,IAAI9C,SAAS,EAAE;gBACdA,SAAS,CAACkC,MAAM,CAAC;cAClB;cACA,OAAOxF,SAAS;YACjB;UACD;QACD;MACD;MAEA,IAAI,IAAI,CAAC2B,MAAM,KAAKtC,IAAI,CAACqC,OAAO,EAAE;QACjC2O,eAAe,GAAGK,MAAM,CACvB;UACCnM,gBAAgB,EAAE,CAAC,CAAC;UACpBoM,cAAc,EAAE,EAAE;UAClBC,UAAU,EAAE,CAAC;QACd,CAAC,EACDP,eACD,CAAiB;QAEjB,IAAI7P,QAAQ,CAACmQ,cAAc,EAAE;UAC5BN,eAAe,CAACM,cAAc,GAAGnQ,QAAQ,CAACmQ,cAAc;QACzD;QACA,IAAInQ,QAAQ,CAACoQ,UAAU,EAAE;UACxBP,eAAe,CAACO,UAAU,GAAGpQ,QAAQ,CAACoQ,UAAU;QACjD;QACA,IAAIpQ,QAAQ,CAACqQ,mBAAmB,EAAE;UACjCR,eAAe,CAACQ,mBAAmB,GAAGrQ,QAAQ,CAACqQ,mBAAmB;QACnE;QACA,IAAIrQ,QAAQ,CAACsQ,UAAU,EAAE;UACxBT,eAAe,CAACS,UAAU,GAAGtQ,QAAQ,CAACsQ,UAAU;QACjD;QACA,IAAItQ,QAAQ,CAACuQ,aAAa,EAAE;UAC3BV,eAAe,CAACU,aAAa,GAAGvQ,QAAQ,CAACuQ,aAAa;QACvD;MACD,CAAC,MAAM;QACN,MAAMC,aAAa,GAAGC,MAAM,CAACC,MAAM,CAAC,CAAC,CAAC,EAAE1Q,QAAQ,CAAC;QACjD6P,eAAe,GAAGc,KAAK,CAACH,aAAa,EAAEX,eAAe,CAAC;MACxD;MACAA,eAAe,GAAG,IAAI,CAAC1L,4BAA4B,CAAC0L,eAAe,CAAiB;MACpF,OAAOA,eAAe;IACvB,CAAC;IAAAvO,MAAA,CAEK2D,oBAAoB,GAA1B,eAAMA,oBAAoBA,CAACjF,QAAa,EAAE8C,SAAe,EAAmD;MAC3G,MAAMS,WAAW,GAAG,IAAI;MACxB,OAAO,IAAI,CAACzB,6BAA6B,CAAC,CAAC,CACzCE,IAAI,CAAC,gBAAgBC,mBAA+B,EAA0B;QAC9E,OAAOA,mBAAmB,CAAC2O,mBAAmB,CAACrN,WAAW,CAAC5C,UAAU,CAAC;MACvE,CAAC,CAAC,CACDqB,IAAI,CAAC,UAAU2G,SAAwB,EAAE;QACzC,OAAOpF,WAAW,CAACoM,kCAAkC,CAAC3P,QAAQ,EAAE2I,SAAS,EAAE7F,SAAS,CAAC;MACtF,CAAC,CAAC,CACDZ,KAAK,CAAC,UAAU8C,MAAM,EAAE;QACxB,IAAIlC,SAAS,EAAE;UACdA,SAAS,CAACkC,MAAM,CAAC;QAClB;MACD,CAAC,CAAC;IACJ,CAAC;IAAA1D,MAAA,CAEDoO,gCAAgC,GAAhC,SAAAA,gCAAgCA,CAAC1P,QAAsB,EAAE8C,SAAoB,EAAmC;MAC/G,MAAM6F,SAAS,GAAG,IAAI,CAACnH,wBAAwB,CAAC,CAAC,CAACoP,mBAAmB,CAAC,IAAI,CAACjQ,UAAU,CAAC;MACtF,OAAO,IAAI,CAACgP,kCAAkC,CAAC3P,QAAQ,EAAE2I,SAAS,EAAE7F,SAAS,CAAC;IAC/E;;IAEA;AACD;AACA;AACA;AACA;AACA;AACA;AACA;AACA,OARC;IAAAxB,MAAA,CASAoF,aAAa,GAAb,SAAAA,aAAaA,CAAC3G,YAAoB,EAAE8Q,SAAmC,EAAE1I,OAAe,EAA4B;MACnH,MAAM5E,WAAW,GAAG,IAAI;MACxB,IAAI,CAACzB,6BAA6B,CAAC,CAAC,CAClCE,IAAI,CAAC,UAAUC,mBAAwB,EAAE;QACzC,OAAOA,mBAAmB,CAAC6O,WAAW,CAACvN,WAAW,CAAC5C,UAAU,EAAEZ,YAAY,CAAC;MAC7E,CAAC,CAAC,CACDmC,KAAK,CAAC,YAAY;QAClB,MAAM8C,MAAM,GAAGzB,WAAW,CAACqC,qBAAqB,CAAC,wDAAwD,CAAC;QAC1GiL,SAAS,CAACpJ,MAAM,CAACzC,MAAM,EAAE,CAAC,CAAC,EAAEmD,OAAO,CAAC;MACtC,CAAC,CAAC,CACDnG,IAAI,CAAC,UAAU2G,SAAc,EAAE;QAC/B,IAAI3I,QAAa,GAAG,CAAC,CAAC;QACtB,MAAM+Q,cAAc,GAAGpI,SAAS,CAACC,OAAO,CAAC,CAAC;QAE1C,IAAI,OAAOmI,cAAc,KAAK,WAAW,EAAE;UAC1C,MAAM/L,MAAM,GAAGzB,WAAW,CAACqC,qBAAqB,CAAC,8CAA8C,CAAC;UAChGiL,SAAS,CAACpJ,MAAM,CAACzC,MAAM,EAAE,CAAC,CAAC,EAAEmD,OAAO,CAAC;QACtC,CAAC,MAAM,IAAI5E,WAAW,CAACpC,MAAM,KAAKtC,IAAI,CAACqC,OAAO,EAAE;UAC/ClB,QAAQ,GAAG;YACV+D,gBAAgB,EAAE,IAAI;YACtB8D,iBAAiB,EAAE,IAAIjE,gBAAgB,CAAC,CAAC;YACzCkE,0BAA0B,EAAE,IAAIlE,gBAAgB,CAAC,CAAC;YAClDmE,yBAAyB,EAAE,KAAK;YAChCoI,cAAc,EAAE,EAAE;YAClBC,UAAU,EAAE,CAAC,CAAC;YACdjL,WAAW,EAAEpF,YAAY;YACzBsQ,mBAAmB,EAAE,CAAC,CAAC;YACvBC,UAAU,EAAE,CAAC,CAAC;YACdC,aAAa,EAAE,CAAC,CAAC;YACjBS,IAAI,EAAE,CAAC;UACR,CAAC;UACD,IAAID,cAAc,CAAChN,gBAAgB,EAAE;YACpC;AACN;AACA;YACM/D,QAAQ,CAAC+D,gBAAgB,GAAGR,WAAW,CAAC8L,mCAAmC,CAAC0B,cAAc,CAAChN,gBAAgB,CAAC;YAC5G/D,QAAQ,CAAC6H,iBAAiB,GAAG,IAAIjE,gBAAgB,CAAC5D,QAAQ,CAAC+D,gBAAgB,CAAC;UAC7E;UACA,IAAIgN,cAAc,CAACZ,cAAc,EAAE;YAClCnQ,QAAQ,CAACmQ,cAAc,GAAGY,cAAc,CAACZ,cAAc;UACxD;UACA,IAAIY,cAAc,CAACX,UAAU,EAAE;YAC9BpQ,QAAQ,CAACoQ,UAAU,GAAGW,cAAc,CAACX,UAAU;UAChD;UACA,IAAIW,cAAc,CAACV,mBAAmB,EAAE;YACvCrQ,QAAQ,CAACqQ,mBAAmB,GAAGU,cAAc,CAACV,mBAAmB;UAClE;UACA,IAAIU,cAAc,CAACT,UAAU,EAAE;YAC9BtQ,QAAQ,CAACsQ,UAAU,GAAGS,cAAc,CAACT,UAAU;UAChD;UACA,IAAIS,cAAc,CAACR,aAAa,EAAE;YACjCvQ,QAAQ,CAACuQ,aAAa,GAAGQ,cAAc,CAACR,aAAa;UACtD;UACA;UACA,IAAIpI,OAAO,KAAK1J,OAAO,CAACkI,MAAM,EAAE;YAC/B3G,QAAQ,CAACgR,IAAI,GAAGD,cAAc;UAC/B;QACD,CAAC,MAAM;UACN/Q,QAAQ,GAAG2Q,KAAK,CAAC3Q,QAAQ,EAAE+Q,cAAc,CAAC;UAC1C,IAAIA,cAAc,CAAChN,gBAAgB,EAAE;YACpC;AACN;AACA;YACM/D,QAAQ,CAAC+D,gBAAgB,GAAGR,WAAW,CAAC8L,mCAAmC,CAAC0B,cAAc,CAAChN,gBAAgB,CAAC;YAC5G/D,QAAQ,CAAC6H,iBAAiB,GAAG,IAAIjE,gBAAgB,CAAC5D,QAAQ,CAAC+D,gBAAgB,CAAC;UAC7E;QACD;;QAEA;QACA;QACA8M,SAAS,CAACnJ,OAAO,CAAC1H,QAAQ,EAAE,CAAC,CAAC,EAAEmI,OAAO,CAAC;QACxC;MACD,CAAC,CAAC,CACDjG,KAAK,CAAC,YAAY;QAClB,MAAM8C,MAAM,GAAGzB,WAAW,CAACqC,qBAAqB,CAAC,sCAAsC,CAAC;QACxFiL,SAAS,CAACpJ,MAAM,CAACzC,MAAM,EAAE,CAAC,CAAC,EAAEmD,OAAO,CAAC;MACtC,CAAC,CAAC;MAEH,OAAO0I,SAAS;IACjB;;IAEA;AACD;AACA;AACA;AACA;AACA;AACA;AACA;AACA,OARC;IAAAvP,MAAA,CASA6E,oBAAoB,GAApB,SAAAA,oBAAoBA,CAACL,QAAgB,EAAsB;MAC1D;MACA,IAAI,CAACA,QAAQ,EAAE;QACd,OAAOtG,SAAS;MACjB;;MAEA;MACA,IAAIyR,QAAQ,GAAG,IAAI,CAAC3Q,cAAc,CAAC4Q,IAAI,CAACpL,QAAQ,CAAC;;MAEjD;MACA,IAAImL,QAAQ,KAAK,IAAI,EAAE;QACtBA,QAAQ,GAAG,IAAI,CAAC9Q,cAAc,CAAC+Q,IAAI,CAACpL,QAAQ,CAAC;MAC9C;;MAEA;AACF;AACA;AACA;MACE,IAAImL,QAAQ,KAAK,IAAI,EAAE;QACtBA,QAAQ,GAAG,IAAI,CAAC5Q,qBAAqB,CAAC6Q,IAAI,CAACpL,QAAQ,CAAC;MACrD;MAEA,IAAImL,QAAQ,KAAK,IAAI,EAAE;QACtB;QACA,OAAOzR,SAAS;MACjB;MAEA,OAAOyR,QAAQ,CAAC,CAAC,CAAC;IACnB;;IAEA;AACD;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,OAVC;IAAA3P,MAAA,CAWA4J,wBAAwB,GAAxB,SAAAA,wBAAwBA,CAACpF,QAAgB,EAAE/F,YAAoB,EAAsB;MACpF,MAAMoR,aAAa,GAAGrS,UAAU,GAAG,GAAG,GAAGiB,YAAY;;MAErD;AACF;AACA;MACE,IAAI,CAAC+F,QAAQ,EAAE;QACd;QACA,OAAO,GAAG,GAAGqL,aAAa;MAC3B;MAEA,MAAMC,wBAAwB,GAAG,SAAAA,CAAUC,WAAgB,EAAU;QACpE;;QAEA;QACA,IAAIA,WAAW,CAAC1H,OAAO,CAAC,GAAG,CAAC,KAAK,CAAC,CAAC,EAAE;UACpC;UACA,OAAO0H,WAAW,GAAG,GAAG,GAAGF,aAAa;QACzC;QACA;QACA,OAAOE,WAAW,GAAG,GAAG,GAAGF,aAAa;MACzC,CAAC;MAED,IAAI,CAAC,IAAI,CAAChL,oBAAoB,CAACL,QAAQ,CAAC,EAAE;QACzC,OAAOsL,wBAAwB,CAACtL,QAAQ,CAAC;MAC1C;MACA;;MAEA,IAAI,IAAI,CAACxF,cAAc,CAACgR,IAAI,CAACxL,QAAQ,CAAC,EAAE;QACvC;QACA,OAAOA,QAAQ,CAACyL,OAAO,CAAC,IAAI,CAACjR,cAAc,EAAE,UAAUkR,OAAe,EAAE;UACvE,OAAOA,OAAO,CAACD,OAAO,CAAC,SAAS,EAAE,GAAG,GAAGxR,YAAY,CAAC;QACtD,CAAC,CAAC;MACH;;MAEA;;MAEA,MAAM0R,oBAAoB,GAAG,SAAAA,CAAUC,YAAiB,EAAEL,WAAgB,EAAU;QACnFA,WAAW,GAAGA,WAAW,CAACE,OAAO,CAACG,YAAY,EAAE,EAAE,CAAC;QACnD,OAAON,wBAAwB,CAACC,WAAW,CAAC;MAC7C,CAAC;MAED,IAAI,IAAI,CAAClR,cAAc,CAACmR,IAAI,CAACxL,QAAQ,CAAC,EAAE;QACvC,OAAO2L,oBAAoB,CAAC,IAAI,CAACtR,cAAc,EAAE2F,QAAQ,CAAC;MAC3D;MAEA,IAAI,IAAI,CAACzF,qBAAqB,CAACiR,IAAI,CAACxL,QAAQ,CAAC,EAAE;QAC9C,OAAO2L,oBAAoB,CAAC,IAAI,CAACpR,qBAAqB,EAAEyF,QAAQ,CAAC;MAClE;MAEA6L,MAAM,CAAC,KAAK,EAAE,oGAAoG,CAAC;MACnH,OAAOnS,SAAS;IACjB,CAAC;IAAA8B,MAAA,CAED8C,qCAAqC,GAArC,SAAAA,qCAAqCA,CAACkL,iBAA6C,EAA0B;MAC5G,MAAMsC,cAAsC,GAAG,CAAC,CAAC;MACjD,IAAI7H,CAAC,GAAG,CAAC;MACT,IAAIlC,iBAAiB;MAErB,IAAI,OAAOyH,iBAAiB,KAAK,QAAQ,EAAE;QAC1CzH,iBAAiB,GAAG,IAAIjE,gBAAgB,CAAC0L,iBAAiB,CAAC;MAC5D,CAAC,MAAM,IAAI,OAAOA,iBAAiB,KAAK,QAAQ,EAAE;QACjDzH,iBAAiB,GAAGyH,iBAAiB;MACtC,CAAC,MAAM;QACN,MAAM,IAAI/O,QAAQ,CAAC,iCAAiC,CAAC;MACtD;;MAEA;MACA,MAAMsR,iBAAiB,GAAGhK,iBAAiB,CAACoC,6BAA6B,CAAC,CAAC;MAC3E,KAAKF,CAAC,GAAG,CAAC,EAAEA,CAAC,GAAG8H,iBAAiB,CAACtS,MAAM,EAAEwK,CAAC,EAAE,EAAE;QAC9C,MAAM+H,cAAc,GAAGjK,iBAAiB,CAAC+G,eAAe,CAACiD,iBAAiB,CAAC9H,CAAC,CAAC,CAAC;QAC9E,IAAI+H,cAAc,IAAIA,cAAc,CAACvS,MAAM,KAAK,CAAC,IAAIuS,cAAc,CAAC,CAAC,CAAC,CAAC7C,IAAI,KAAK,GAAG,IAAI6C,cAAc,CAAC,CAAC,CAAC,CAAC5C,MAAM,KAAK,IAAI,EAAE;UACzH0C,cAAc,CAACC,iBAAiB,CAAC9H,CAAC,CAAC,CAAC,GAAG+H,cAAc,CAAC,CAAC,CAAC,CAAC3C,GAAG;QAC7D;MACD;;MAEA;MACA,MAAM4C,eAAe,GAAGlK,iBAAiB,CAACwC,iBAAiB,CAAC,CAAC;MAC7D,KAAKN,CAAC,GAAG,CAAC,EAAEA,CAAC,GAAGgI,eAAe,CAACxS,MAAM,EAAEwK,CAAC,EAAE,EAAE;QAC5C,MAAMiI,eAAe,GAAGnK,iBAAiB,CAACgH,YAAY,CAACkD,eAAe,CAAChI,CAAC,CAAC,CAAC;QAE1E6H,cAAc,CAACG,eAAe,CAAChI,CAAC,CAAC,CAAC,GAAGiI,eAAe;MACrD;MACA,OAAOJ,cAAc;IACtB,CAAC;IAAAtQ,MAAA,CAEDsE,qBAAqB,GAArB,SAAAA,qBAAqBA,CAACqM,UAAe,EAAY;MAChD,OAAO,IAAI1R,QAAQ,CAAC0R,UAAU,CAAC;IAChC;;IAEA;AACD;AACA;AACA;AACA;AACA,OALC;IAAA3Q,MAAA,CAMA4Q,QAAQ,GAAR,SAAAA,QAAQA,CAACC,MAAmC,EAAQ;MACnD,IAAI,CAACC,OAAO,GAAGD,MAAM;IACtB,CAAC;IAAA7Q,MAAA,CAED+Q,SAAS,GAAT,SAAAA,SAASA,CAAA,EAAgC;MACxC,OAAO,IAAI,CAACD,OAAO,IAAI,IAAI,CAACzR,UAAU,CAAC2R,QAAQ,CAAC,CAAC;IAClD,CAAC;IAAAhR,MAAA,CAEDiR,oBAAoB,GAApB,SAAAA,oBAAoBA,CAACC,KAAmB,EAAQ;MAC/C,IAAIA,KAAK,EAAE;QACV,IAAIA,KAAK,CAACzO,gBAAgB,EAAE;UAC3ByO,KAAK,CAACzO,gBAAgB,GAAG,IAA4B;QACtD;QAEA,IAAIyO,KAAK,CAAClC,UAAU,EAAE;UACrBkC,KAAK,CAAClC,UAAU,GAAG,IAAI;QACxB;QAEA,IAAIkC,KAAK,CAACjC,aAAa,EAAE;UACxBiC,KAAK,CAACjC,aAAa,GAAG,IAAI;QAC3B;MACD;IACD,CAAC;IAAAjP,MAAA,CAEDmR,iBAAiB,GAAjB,SAAAA,iBAAiBA,CAACC,WAAgB,EAAEC,cAAmB,EAAEH,KAAU,EAAQ;MAC1E,IAAIE,WAAW,CAACnT,MAAM,IAAIiT,KAAK,KAAKA,KAAK,CAACzO,gBAAgB,IAAIyO,KAAK,CAAClC,UAAU,IAAIkC,KAAK,CAACjC,aAAa,CAAC,EAAE;QACvGmC,WAAW,CAAChE,OAAO,CAAC,UAAUkE,KAAU,EAAE;UACzC,IAAIJ,KAAK,CAACzO,gBAAgB,CAAC8O,aAAa,EAAE;YACzCL,KAAK,CAACzO,gBAAgB,CAAC8O,aAAa,CAACC,IAAI,CAAC,UAAUC,MAAW,EAAEC,IAAS,EAAE;cAC3E,IAAIJ,KAAK,KAAKG,MAAM,CAACE,YAAY,EAAE;gBAClCT,KAAK,CAACzO,gBAAgB,CAAC8O,aAAa,CAACK,MAAM,CAACF,IAAI,EAAE,CAAC,CAAC;gBACpD,OAAO,IAAI;cACZ;cAEA,OAAO,KAAK;YACb,CAAC,CAAC;UACH;UAEA,IAAIR,KAAK,CAAClC,UAAU,IAAIkC,KAAK,CAAClC,UAAU,CAAC6C,KAAK,EAAE;YAC/CX,KAAK,CAAClC,UAAU,CAAC6C,KAAK,CAACzE,OAAO,CAAC,UAAU0E,MAAW,EAAE;cACrD,IAAIA,MAAM,CAACC,aAAa,EAAE;gBACzBD,MAAM,CAACC,aAAa,CAACP,IAAI,CAAC,UAAUC,MAAW,EAAEC,IAAS,EAAE;kBAC3D,IAAIJ,KAAK,KAAKG,MAAM,CAACE,YAAY,EAAE;oBAClCG,MAAM,CAACC,aAAa,CAACH,MAAM,CAACF,IAAI,EAAE,CAAC,CAAC;oBACpC,OAAO,IAAI;kBACZ;kBAEA,OAAO,KAAK;gBACb,CAAC,CAAC;cACH;YACD,CAAC,CAAC;UACH;UAEA,IAAIR,KAAK,CAACjC,aAAa,IAAIiC,KAAK,CAACjC,aAAa,CAAC+C,KAAK,EAAE;YACrDd,KAAK,CAACjC,aAAa,CAAC+C,KAAK,CAAC5E,OAAO,CAAC,UAAU6E,MAAW,EAAEP,IAAS,EAAE;cACnE,IAAIJ,KAAK,KAAKW,MAAM,CAACN,YAAY,EAAE;gBAClCT,KAAK,CAACjC,aAAa,CAAC+C,KAAK,CAACJ,MAAM,CAACF,IAAI,EAAE,CAAC,CAAC;cAC1C;YACD,CAAC,CAAC;UACH;QACD,CAAC,CAAC;MACH;MAEA,IAAIL,cAAc,CAACpT,MAAM,IAAIiT,KAAK,IAAIA,KAAK,CAACzO,gBAAgB,IAAIyO,KAAK,CAACzO,gBAAgB,CAACyP,UAAU,EAAE;QAClGb,cAAc,CAACjE,OAAO,CAAC,UAAUkE,KAAU,EAAE;UAC5CJ,KAAK,CAACzO,gBAAgB,CAACyP,UAAU,CAACV,IAAI,CAAC,UAAUC,MAAW,EAAEC,IAAS,EAAE;YACxE,IAAIJ,KAAK,KAAKG,MAAM,CAACE,YAAY,IAAI,aAAa,GAAGL,KAAK,KAAKG,MAAM,CAACE,YAAY,EAAE;cACnFT,KAAK,CAACzO,gBAAgB,CAACyP,UAAU,CAACN,MAAM,CAACF,IAAI,EAAE,CAAC,CAAC;cACjD,OAAO,IAAI;YACZ;YAEA,OAAO,KAAK;UACb,CAAC,CAAC;QACH,CAAC,CAAC;MACH;IACD,CAAC;IAAA1R,MAAA,CAEDmS,WAAW,GAAX,SAAAA,WAAWA,CAACC,SAAc,EAAEC,KAAa,EAAW;MACnD,MAAMC,kBAAkB,GAAG,SAAAA,CAAUC,KAAU,EAAW;QACzD,IAAIA,KAAK,EAAE;UACV,OAAOA,KAAK,CAACC,IAAI,GAAGD,KAAK,CAACC,IAAI,KAAK,OAAO,GAAG,IAAI;QAClD;QACA,OAAO,KAAK;MACb,CAAC;MAED,OAAO,CAAC,CAACJ,SAAS,CAACC,KAAK,CAAC,IAAIC,kBAAkB,CAACF,SAAS,CAACC,KAAK,CAAC,CAAC;IAClE,CAAC;IAAArS,MAAA,CAEDyS,gCAAgC,GAAhC,SAAAA,gCAAgCA,CAACL,SAAc,EAAW;MACzD,OAAO,IAAI,CAACD,WAAW,CAACC,SAAS,EAAE,yDAAyD,CAAC;IAC9F,CAAC;IAAApS,MAAA,CAED0S,uBAAuB,GAAvB,SAAAA,uBAAuBA,CAACN,SAAc,EAAW;MAChD,OAAO,IAAI,CAACD,WAAW,CAACC,SAAS,EAAE,6DAA6D,CAAC;IAClG,CAAC;IAAApS,MAAA,CAED2S,kBAAkB,GAAlB,SAAAA,kBAAkBA,CAACP,SAAc,EAAW;MAC3C,OAAO,IAAI,CAACD,WAAW,CAACC,SAAS,EAAE,2CAA2C,CAAC;IAChF,CAAC;IAAApS,MAAA,CAED4S,eAAe,GAAf,SAAAA,eAAeA,CAACR,SAAc,EAAW;MACxC,OAAO,IAAI,CAACM,uBAAuB,CAACN,SAAS,CAAC,IAAI,IAAI,CAACK,gCAAgC,CAACL,SAAS,CAAC;IACnG;;IAEA;AACD;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,OATC;IAAApS,MAAA,CAUA6S,mBAAmB,GAAnB,SAAAA,mBAAmBA,CAACC,cAAsB,EAAEjC,MAAoC,EAAU;MACzF,IAAI,CAACiC,cAAc,EAAE;QACpB,MAAM,IAAI7T,QAAQ,CAAC,0CAA0C,CAAC;MAC/D;MAEA,IAAI4R,MAAM,KAAK3S,SAAS,EAAE;QACzB2S,MAAM,GAAG,IAAI,CAACE,SAAS,CAAC,CAAC;MAC1B;MAEA,OAAO,IAAI,CAACgC,oBAAoB,CAAClC,MAAM,CAAC,GAAG,GAAG,GAAGiC,cAAc;IAChE,CAAC;IAAA9S,MAAA,CAED+S,oBAAoB,GAApB,SAAAA,oBAAoBA,CAAClC,MAAmC,EAAU;MACjE,IAAImC,UAAU;MAEd,IAAInC,MAAM,CAACoC,GAAG,CAAe,kCAAkC,CAAC,EAAE;QACjED,UAAU,GAAGnC,MAAM,CAACqC,aAAa,CAAC,CAAC;MACpC,CAAC,MAAM,IAAIrC,MAAM,CAACoC,GAAG,CAAe,kCAAkC,CAAC,EAAE;QACxE,MAAME,WAAW,GAAG,IAAIC,GAAG,CAACvC,MAAM,CAACwC,aAAa,CAAC,CAAC,CAAC,CAACC,UAAU,CAACC,QAAQ,CAACC,OAAO,CAAC;QAChFR,UAAU,GAAG,IAAII,GAAG,CAAC,GAAG,CAAC,CAACE,UAAU,CAACH,WAAW,CAAC,CAAC3G,QAAQ,CAAC,CAAC;MAC7D;MAEA,IAAIwG,UAAU,IAAIA,UAAU,CAACS,WAAW,CAAC,GAAG,CAAC,KAAKT,UAAU,CAAC/U,MAAM,GAAG,CAAC,EAAE;QACxE+U,UAAU,GAAGA,UAAU,CAACU,SAAS,CAAC,CAAC,EAAEV,UAAU,CAAC/U,MAAM,GAAG,CAAC,CAAC;MAC5D;MAEA,OAAO+U,UAAU,GAAGnC,MAAM,CAAC8C,WAAW,GAAG,YAAY;IACtD;;IAEA;AACD;AACA;AACA;AACA;AACA;AACA;AACA;AACA,OARC;IAAA3T,MAAA,CASA6C,4BAA4B,GAA5B,SAAAA,4BAA4BA,CAACqO,KAAU,EAAW;MACjD,IAAI0C,YAAY,GAAG1C,KAAK;MACxB,IACCA,KAAK,IACLA,KAAK,CAACzO,gBAAgB,KACpByO,KAAK,CAACzO,gBAAgB,CAACoR,gBAAgB,IAAI3C,KAAK,CAACzO,gBAAgB,CAAC8O,aAAa,IAC/EL,KAAK,CAACzO,gBAAgB,CAACqR,mBAAmB,IAAI5C,KAAK,CAACzO,gBAAgB,CAACyP,UAAW,CAAC,EAClF;QACD,MAAMrB,MAAM,GAAG,IAAI,CAACE,SAAS,CAAC,CAAC;QAC/B,IAAI,IAAI,CAAC1R,UAAU,IAAIwR,MAAM,IAAIA,MAAM,CAACoC,GAAG,CAAe,kCAAkC,CAAC,EAAE;UAC9F,MAAMc,oBAAoB,GAAG,EAAE;UAC/B,MAAMC,uBAAuB,GAAG,EAAE;UAClC,IAAIvL,CAAC;YACJwL,UAAe;YACfC,UAAe;YACfC,aAAkB;YAClBC,QAAa;YACbC,kBAAkB,GAAG,EAAE;YACvBC,iBAAiB,GAAG,EAAE;UAEvB,MAAMC,UAAU,GAAG1D,MAAM,CAAC2D,YAAY,CAAC,CAAC;UACxC,IAAI3D,MAAM,CAAC4D,kBAAkB,CAAC,CAAC,IAAIF,UAAU,EAAE1D,MAAM,EAAE;YACtD,IAAIK,KAAK,CAACzO,gBAAgB,CAACoR,gBAAgB,EAAE;cAC5CQ,kBAAkB,GAAGnD,KAAK,CAACzO,gBAAgB,CAACoR,gBAAgB,CAACa,KAAK,CAAC,GAAG,CAAC;YACxE;YAEA,IACCL,kBAAkB,CAACpW,MAAM,KAAK,CAAC,IAC/BiT,KAAK,CAACzO,gBAAgB,CAAC8O,aAAa,IACpC,IAAI,CAACwB,oBAAoB,CAAClC,MAAM,CAAC,CAACxI,OAAO,CAACgM,kBAAkB,CAAC,CAAC,CAAC,CAAC,KAAK,CAAC,EACrE;cACDJ,UAAU,GAAGM,UAAU,CAACI,iBAAiB,CAACN,kBAAkB,CAAC,CAAC,CAAC,CAAC;cAChE,IAAIJ,UAAU,EAAE;gBACfC,UAAU,GAAGK,UAAU,CAACK,kBAAkB,CAACX,UAAU,CAACY,UAAU,CAAC;cAClE,CAAC,MAAM;gBACNX,UAAU,GAAGK,UAAU,CAACK,kBAAkB,CAACP,kBAAkB,CAAC,CAAC,CAAC,CAAC;cAClE;cAEA,IAAIH,UAAU,EAAE;gBACf,IAAIA,UAAU,IAAIA,UAAU,CAACY,QAAQ,EAAE;kBACtC,KAAKrM,CAAC,GAAG,CAAC,EAAEA,CAAC,GAAGyL,UAAU,CAACY,QAAQ,CAAC7W,MAAM,EAAEwK,CAAC,EAAE,EAAE;oBAChD,IAAI,IAAI,CAACmK,eAAe,CAACsB,UAAU,CAACY,QAAQ,CAACrM,CAAC,CAAC,CAAC,EAAE;sBACjDsL,oBAAoB,CAACgB,IAAI,CAACb,UAAU,CAACY,QAAQ,CAACrM,CAAC,CAAC,CAACuM,IAAI,CAAC;oBACvD;kBACD;gBACD;gBAEA,IAAId,UAAU,CAACe,kBAAkB,EAAE;kBAClC,KAAKxM,CAAC,GAAG,CAAC,EAAEA,CAAC,GAAGyL,UAAU,CAACe,kBAAkB,CAAChX,MAAM,EAAEwK,CAAC,EAAE,EAAE;oBAC1D2L,QAAQ,GAAGG,UAAU,CAACW,sBAAsB,CAAChB,UAAU,EAAEA,UAAU,CAACe,kBAAkB,CAACxM,CAAC,CAAC,CAACuM,IAAI,CAAC;oBAC/F,IAAI,CAACZ,QAAQ,IAAIA,QAAQ,CAACe,IAAI,KAAKjE,KAAK,CAACzO,gBAAgB,CAACoR,gBAAgB,EAAE;sBAC3E;oBACD;oBACA;oBACA,IAAIO,QAAQ,CAACgB,YAAY,KAAK,GAAG,IAAIhB,QAAQ,CAACgB,YAAY,KAAK,MAAM,EAAE;sBACtEjB,aAAa,GAAGI,UAAU,CAACK,kBAAkB,CAACR,QAAQ,CAACe,IAAI,CAAC;sBAC5D,IAAIhB,aAAa,IAAIA,aAAa,CAACW,QAAQ,EAAE;wBAC5C,KAAK,IAAIpH,CAAC,GAAG,CAAC,EAAEA,CAAC,GAAGyG,aAAa,CAACW,QAAQ,CAAC7W,MAAM,EAAEyP,CAAC,EAAE,EAAE;0BACvD,IAAI,IAAI,CAACkF,eAAe,CAACuB,aAAa,CAACW,QAAQ,CAACpH,CAAC,CAAC,CAAC,EAAE;4BACpDqG,oBAAoB,CAACgB,IAAI,CACxBb,UAAU,CAACe,kBAAkB,CAACxM,CAAC,CAAC,CAACuM,IAAI,GAAG,GAAG,GAAGb,aAAa,CAACW,QAAQ,CAACpH,CAAC,CAAC,CAACsH,IACzE,CAAC;0BACF;wBACD;sBACD;oBACD;kBACD;gBACD;cACD;YACD;YAEA,IAAI9D,KAAK,CAACzO,gBAAgB,CAACqR,mBAAmB,EAAE;cAC/CQ,iBAAiB,GAAGpD,KAAK,CAACzO,gBAAgB,CAACqR,mBAAmB,CAACY,KAAK,CAAC,GAAG,CAAC;YAC1E;YAEA,IACCJ,iBAAiB,CAACrW,MAAM,KAAK,CAAC,IAC9BiT,KAAK,CAACzO,gBAAgB,CAACyP,UAAU,IACjC,IAAI,CAACa,oBAAoB,CAAClC,MAAM,CAAC,CAACxI,OAAO,CAACiM,iBAAiB,CAAC,CAAC,CAAC,CAAC,KAAK,CAAC,EACpE;cACDL,UAAU,GAAGM,UAAU,CAACI,iBAAiB,CAACL,iBAAiB,CAAC,CAAC,CAAC,CAAC;cAC/D,IAAIL,UAAU,EAAE;gBACfC,UAAU,GAAGK,UAAU,CAACK,kBAAkB,CAACX,UAAU,CAACY,UAAU,CAAC;cAClE,CAAC,MAAM;gBACNX,UAAU,GAAGK,UAAU,CAACK,kBAAkB,CAACP,kBAAkB,CAAC,CAAC,CAAC,CAAC;cAClE;cAEA,IAAIH,UAAU,EAAE;gBACf,IAAIA,UAAU,CAACY,QAAQ,EAAE;kBACxB,KAAKrM,CAAC,GAAG,CAAC,EAAEA,CAAC,GAAGyL,UAAU,CAACY,QAAQ,CAAC7W,MAAM,EAAEwK,CAAC,EAAE,EAAE;oBAChD,IAAI,IAAI,CAACmK,eAAe,CAACsB,UAAU,CAACY,QAAQ,CAACrM,CAAC,CAAC,CAAC,EAAE;sBACjDuL,uBAAuB,CAACe,IAAI,CAACb,UAAU,CAACY,QAAQ,CAACrM,CAAC,CAAC,CAACuM,IAAI,CAAC;oBAC1D;kBACD;gBACD;cACD;YACD;YAEA,IAAIjB,oBAAoB,CAAC9V,MAAM,IAAI+V,uBAAuB,CAAC/V,MAAM,EAAE;cAClE2V,YAAY,GAAGhF,MAAM,CAAC,IAAI,EAAS,CAAC,CAAC,EAAEgF,YAAY,CAAC;cAEpD,IAAI,CAACzC,iBAAiB,CAAC4C,oBAAoB,EAAEC,uBAAuB,EAAEJ,YAAY,CAAC;YACpF;UACD,CAAC,MAAM;YACN;;YAEA,IAAI,CAAC3C,oBAAoB,CAAC2C,YAAY,CAAC;YACvC/S,GAAG,CAACC,KAAK,CAAC,oDAAoD,CAAC;UAChE;QACD,CAAC,MAAM,IAAI,IAAI,CAACzB,UAAU,IAAIwR,MAAM,IAAIA,MAAM,CAACoC,GAAG,CAAC,kCAAkC,CAAC,EAAE;UACvF,OAAO,IAAI,CAACoC,8BAA8B,CAACzB,YAAY,CAAC;QACzD;MACD;MAEA,OAAOA,YAAY;IACpB,CAAC;IAAA5T,MAAA,CAED4C,8BAA8B,GAA9B,SAAAA,8BAA8BA,CAAClE,QAAsB,EAAgB;MACpE,IAAI6P,eAAe,GAAG7P,QAAQ;MAE9B,IAAIA,QAAQ,CAAC+D,gBAAgB,EAAE;QAC9B;AACH;AACA;AACA;QACG,IAAI,OAAO/D,QAAQ,CAAC+D,gBAAgB,KAAK,QAAQ,EAAE;UAClD,IAAI;YACH8L,eAAe,CAAC9L,gBAAgB,GAAG8C,IAAI,CAACC,KAAK,CAAC9G,QAAQ,CAAC+D,gBAAgB,CAAC;UACzE,CAAC,CAAC,OAAO+E,CAAC,EAAE;YACX3G,GAAG,CAACC,KAAK,CAAC,+DAA+D,CAAC;UAC3E;QACD;QAEAyN,eAAe,GAAG,IAAI,CAAC+G,6BAA6B,CAAC/G,eAAe,CAAC;MACtE;MAEA,OAAOA,eAAe;IACvB;;IAEA;AACD;AACA;AACA;AACA;AACA;AACA;AACA;AACA,OARC;IAAAvO,MAAA,CASAsV,6BAA6B,GAA7B,SAAAA,6BAA6BA,CAACpE,KAAmB,EAAgB;MAChE,IAAI0C,YAAY,GAAG1C,KAAK;MACxB,MAAMqE,kBAAkB,GAAG,EAAE;MAC7B,MAAMC,qBAAqB,GAAG,EAAE;MAChC,IAAI/M,CAAC;QACJoI,MAAM;QACN0D,UAAU;QACVN,UAAe;QACfC,UAAe;QACfC,aAAkB;QAClBC,QAAa;QACbC,kBAA4B,GAAG,EAAE;QACjCC,iBAA2B,GAAG,EAAE;MAEjC,IACCpD,KAAK,IACLA,KAAK,CAACzO,gBAAgB,KACnByO,KAAK,CAACzO,gBAAgB,CAAgCoR,gBAAgB,IACvE3C,KAAK,CAACzO,gBAAgB,CAAgC8O,aAAa,IAClEL,KAAK,CAACzO,gBAAgB,CAAgCqR,mBAAmB,IACzE5C,KAAK,CAACzO,gBAAgB,CAAgCyP,UAAW,CAAC,EACpE;QACDrB,MAAM,GAAG,IAAI,CAACE,SAAS,CAAC,CAAC;QACzB,IAAI,IAAI,CAAC1R,UAAU,IAAIwR,MAAM,IAAIA,MAAM,CAACoC,GAAG,CAAe,kCAAkC,CAAC,EAAE;UAC9FsB,UAAU,GAAG1D,MAAM,CAAC2D,YAAY,CAAC,CAAC;UAClC,IAAI3D,MAAM,CAAC4D,kBAAkB,CAAC,CAAC,IAAIF,UAAU,IAAIA,UAAU,CAAC1D,MAAM,EAAE;YACnE,IAAKK,KAAK,CAACzO,gBAAgB,CAAgCoR,gBAAgB,EAAE;cAC5EQ,kBAAkB,GAAInD,KAAK,CAACzO,gBAAgB,CAAgCoR,gBAAgB,CAAEa,KAAK,CAAC,GAAG,CAAC;YACzG;YAEA,IACCL,kBAAkB,CAACpW,MAAM,KAAK,CAAC,IAC9BiT,KAAK,CAACzO,gBAAgB,CAAgC8O,aAAa,IACpE,IAAI,CAACwB,oBAAoB,CAAClC,MAAM,CAAC,CAACxI,OAAO,CAACgM,kBAAkB,CAAC,CAAC,CAAC,CAAC,KAAK,CAAC,EACrE;cACDJ,UAAU,GAAGM,UAAU,CAACI,iBAAiB,CAACN,kBAAkB,CAAC,CAAC,CAAC,CAAC;cAChE,IAAIJ,UAAU,EAAE;gBACfC,UAAU,GAAGK,UAAU,CAACK,kBAAkB,CAACX,UAAU,CAACY,UAAU,CAAC;cAClE,CAAC,MAAM;gBACNX,UAAU,GAAGK,UAAU,CAACK,kBAAkB,CAACP,kBAAkB,CAAC,CAAC,CAAC,CAAC;cAClE;cAEA,IAAIH,UAAU,EAAE;gBACf,IAAIA,UAAU,IAAIA,UAAU,CAACY,QAAQ,EAAE;kBACtC,KAAKrM,CAAC,GAAG,CAAC,EAAEA,CAAC,GAAGyL,UAAU,CAACY,QAAQ,CAAC7W,MAAM,EAAEwK,CAAC,EAAE,EAAE;oBAChD,IAAI,IAAI,CAACkK,kBAAkB,CAACuB,UAAU,CAACY,QAAQ,CAACrM,CAAC,CAAC,CAAC,EAAE;sBACpD8M,kBAAkB,CAACR,IAAI,CAACb,UAAU,CAACY,QAAQ,CAACrM,CAAC,CAAC,CAACuM,IAAI,CAAC;oBACrD;kBACD;gBACD;gBAEA,IAAId,UAAU,CAACe,kBAAkB,EAAE;kBAClC,KAAKxM,CAAC,GAAG,CAAC,EAAEA,CAAC,GAAGyL,UAAU,CAACe,kBAAkB,CAAChX,MAAM,EAAEwK,CAAC,EAAE,EAAE;oBAC1D2L,QAAQ,GAAGG,UAAU,CAACW,sBAAsB,CAAChB,UAAU,EAAEA,UAAU,CAACe,kBAAkB,CAACxM,CAAC,CAAC,CAACuM,IAAI,CAAC;oBAC/F,IACC,CAACZ,QAAQ,IACTA,QAAQ,CAACe,IAAI,KAAMjE,KAAK,CAACzO,gBAAgB,CAAgCoR,gBAAgB,EACxF;sBACD;oBACD;oBACA;oBACA,IAAIO,QAAQ,CAACgB,YAAY,KAAK,GAAG,IAAIhB,QAAQ,CAACgB,YAAY,KAAK,MAAM,EAAE;sBACtEjB,aAAa,GAAGI,UAAU,CAACK,kBAAkB,CAACR,QAAQ,CAACe,IAAI,CAAC;sBAC5D,IAAIhB,aAAa,IAAIA,aAAa,CAACW,QAAQ,EAAE;wBAC5C,KAAK,IAAIpH,CAAC,GAAG,CAAC,EAAEA,CAAC,GAAGyG,aAAa,CAACW,QAAQ,CAAC7W,MAAM,EAAEyP,CAAC,EAAE,EAAE;0BACvD,IAAI,IAAI,CAACiF,kBAAkB,CAACwB,aAAa,CAACW,QAAQ,CAACpH,CAAC,CAAC,CAAC,EAAE;4BACvD6H,kBAAkB,CAACR,IAAI,CACtBb,UAAU,CAACe,kBAAkB,CAACxM,CAAC,CAAC,CAACuM,IAAI,GAAG,GAAG,GAAGb,aAAa,CAACW,QAAQ,CAACpH,CAAC,CAAC,CAACsH,IACzE,CAAC;0BACF;wBACD;sBACD;oBACD;kBACD;gBACD;cACD;YACD;YAEA,IAAK9D,KAAK,CAACzO,gBAAgB,CAAgCqR,mBAAmB,EAAE;cAC/EQ,iBAAiB,GAAIpD,KAAK,CAACzO,gBAAgB,CAAgCqR,mBAAmB,CAAEY,KAAK,CAAC,GAAG,CAAC;YAC3G;YAEA,IACCJ,iBAAiB,CAACrW,MAAM,KAAK,CAAC,IAC7BiT,KAAK,CAACzO,gBAAgB,CAAgCyP,UAAU,IACjE,IAAI,CAACa,oBAAoB,CAAClC,MAAM,CAAC,CAACxI,OAAO,CAACiM,iBAAiB,CAAC,CAAC,CAAC,CAAC,KAAK,CAAC,EACpE;cACDL,UAAU,GAAGM,UAAU,CAACI,iBAAiB,CAACL,iBAAiB,CAAC,CAAC,CAAC,CAAC;cAC/D,IAAIL,UAAU,EAAE;gBACfC,UAAU,GAAGK,UAAU,CAACK,kBAAkB,CAACX,UAAU,CAACY,UAAU,CAAC;cAClE,CAAC,MAAM;gBACNX,UAAU,GAAGK,UAAU,CAACK,kBAAkB,CAACP,kBAAkB,CAAC,CAAC,CAAC,CAAC;cAClE;cAEA,IAAIH,UAAU,EAAE;gBACf,IAAIA,UAAU,CAACY,QAAQ,EAAE;kBACxB,KAAKrM,CAAC,GAAG,CAAC,EAAEA,CAAC,GAAGyL,UAAU,CAACY,QAAQ,CAAC7W,MAAM,EAAEwK,CAAC,EAAE,EAAE;oBAChD,IAAI,IAAI,CAACkK,kBAAkB,CAACuB,UAAU,CAACY,QAAQ,CAACrM,CAAC,CAAC,CAAC,EAAE;sBACpD+M,qBAAqB,CAACT,IAAI,CAACb,UAAU,CAACY,QAAQ,CAACrM,CAAC,CAAC,CAACuM,IAAI,CAAC;oBACxD;kBACD;gBACD;cACD;YACD;YAEA,IAAIO,kBAAkB,CAACtX,MAAM,IAAIuX,qBAAqB,CAACvX,MAAM,EAAE;cAC9D;cACA2V,YAAY,GAAGhF,MAAM,CAAC,IAAI,EAAS,CAAC,CAAC,EAAEgF,YAAY,CAAiB;cAEpE,IAAI,CAACzC,iBAAiB,CAACoE,kBAAkB,EAAEC,qBAAqB,EAAE5B,YAAY,CAAC;YAChF;UACD,CAAC,MAAM;YACN;;YAEA,IAAI,CAAC3C,oBAAoB,CAAC2C,YAAY,CAAC;YACvC/S,GAAG,CAACC,KAAK,CAAC,oDAAoD,CAAC;UAChE;QACD,CAAC,MAAM,IAAI,IAAI,CAACzB,UAAU,IAAIwR,MAAM,IAAIA,MAAM,CAACoC,GAAG,CAAC,kCAAkC,CAAC,EAAE;UACvF,OAAO,IAAI,CAACoC,8BAA8B,CAACzB,YAAY,EAAE,IAAI,CAAC;QAC/D;MACD;MACA,OAAOA,YAAY;IACpB;;IAEA;AACD;AACA;AACA;AACA;AACA,OALC;IAAA5T,MAAA,CAMAqV,8BAA8B,GAA9B,SAAAA,8BAA8BA,CAACnE,KAAmB,EAAEuE,QAAkB,EAAgB;MACrF,MAAMxT,WAAW,GAAG,IAAI;QACvByT,GAAG,GAAG,IAAIpT,gBAAgB,CAAC4O,KAAK,CAACzO,gBAAgB,CAAC;QAClDoO,MAAM,GAAG,IAAI,CAACE,SAAS,CAAC,CAAC;MAC1B,IAAIsD,kBAAwC;MAE5C,IAAI,CAACxD,MAAM,CAAC2D,YAAY,CAAC,CAAC,CAACmB,SAAS,CAAC,GAAG,CAAC,EAAE;QAC1C;QACA,IAAI,CAAC1E,oBAAoB,CAACC,KAAK,CAAC;QAChCrQ,GAAG,CAACC,KAAK,CAAC,oDAAoD,CAAC;QAC/D,OAAOoQ,KAAK;MACb;MAEA,IAAKA,KAAK,CAACzO,gBAAgB,CAAgCoR,gBAAgB,EAAE;QAC5EQ,kBAAkB,GAAInD,KAAK,CAACzO,gBAAgB,CAAgCoR,gBAAgB,CAAEa,KAAK,CAAC,GAAG,CAAC;MACzG;MAEA,IACCL,kBAAkB,EAAEpW,MAAM,KAAK,CAAC,IAC/BiT,KAAK,CAACzO,gBAAgB,CAAgC8O,aAAa,IACpE,IAAI,CAACwB,oBAAoB,CAAClC,MAAM,CAAC,CAACxI,OAAO,CAACgM,kBAAkB,CAAC,CAAC,CAAC,CAAC,KAAK,CAAC,EACrE;QACDqB,GAAG,CAAC9M,kBAAkB,CAAC,gBAAgB,CAAC;QACxC8M,GAAG,CAAC9M,kBAAkB,CAAC,qBAAqB,CAAC;QAC7C8M,GAAG,CAAC9M,kBAAkB,CAAC,eAAe,CAAC;QAEvC,MAAMgN,UAAU,GAAGvB,kBAAkB,CAAC,CAAC,CAAC;UACvCE,UAAU,GAAG1D,MAAM,CAAC2D,YAAY,CAAC,CAAC;UAClCqB,cAAc,GAAGH,GAAG,CAACI,gBAAgB,CAAC,CAAC,IAAI,EAAE;UAC7CC,iBAAiB,GAAG,SAAAA,CAAUC,KAAa,EAAEC,MAAc,EAAW;YACrEA,MAAM,GAAGA,MAAM,IAAIL,UAAU;YAC7B,MAAMM,oBAAoB,GAAG3B,UAAU,CAACoB,SAAS,CAAC,GAAG,GAAGM,MAAM,GAAG,GAAG,GAAGD,KAAK,GAAG,GAAG,CAAC;YACnF,IAAIE,oBAAoB,EAAE;cACzB,IACET,QAAQ,IAAIS,oBAAoB,CAAC,4CAA4C,CAAC,IAC/EjU,WAAW,CAACkU,yCAAyC,CAACD,oBAAoB,CAAC,EAC1E;gBACD,OAAO,IAAI;cACZ,CAAC,MAAM,IAAIA,oBAAoB,CAAC,8CAA8C,CAAC,EAAE;gBAChF,MAAME,aAAa,GAAGF,oBAAoB,CAAC,8CAA8C,CAAC;gBAC1F,IAAIE,aAAa,CAAC,aAAa,CAAC,IAAIA,aAAa,CAAC,aAAa,CAAC,CAAC1B,KAAK,CAAC,GAAG,CAAC,CAAC,CAAC,CAAC,KAAK,cAAc,EAAE;kBAClG,OAAO,IAAI;gBACZ;cACD;YACD;YACA,OAAO,KAAK;UACb,CAAC;QAEF,KAAK,IAAI2B,CAAC,GAAG,CAAC,EAAEA,CAAC,GAAGR,cAAc,CAAC5X,MAAM,EAAEoY,CAAC,EAAE,EAAE;UAC/C,MAAMC,SAAS,GAAGT,cAAc,CAACQ,CAAC,CAAC;UACnC;UACA,IAAIN,iBAAiB,CAACO,SAAS,EAAEV,UAAU,CAAC,EAAE;YAC7CF,GAAG,CAAC9M,kBAAkB,CAAC0N,SAAS,CAAC;UAClC;QACD;QACApF,KAAK,CAACzO,gBAAgB,GAAGiT,GAAG,CAAC/S,YAAY,CAAC,CAAC;MAC5C;MACA,OAAOuO,KAAK;IACb,CAAC;IAAAlR,MAAA,CAEDmW,yCAAyC,GAAzC,SAAAA,yCAAyCA,CAACD,oBAA6C,EAAW;MACjG,OAAO,CAAC,EACPA,oBAAoB,CAAC,8DAA8D,CAAC,IACpFA,oBAAoB,CAAC,0DAA0D,CAAC,CAChF;IACF;;IAEA;AACD;AACA;AACA;AACA;AACA;AACA;AACA,OAPC;IAAAlW,MAAA,CAQAuW,eAAe,GAAf,SAAAA,eAAeA,CAAA,EAAuB;MACrC,MAAM/R,QAAQ,GAAGC,WAAW,CAACC,WAAW,CAAC,CAAC,CAACC,OAAO,CAAC,CAAC;MACpD,OAAO,IAAI,CAACE,oBAAoB,CAACL,QAAQ,CAAC;IAC3C,CAAC;IAAA,OAAA7G,iBAAA;EAAA,EAx+EqC6Y,UAAU,GA2+EjD;EAAA1W,QAAA,CAAAnC,iBAAA,GAAAA,iBAAA;EAEA,MAAM8Y,yBAAyB,GAAGD,UAAU,CAAC5H,MAAM,CAClD,qCAAqC,EACrCjR,iBAAiB,CAACsC,SACnB,CAA6B;EAAC,OAEfwW,yBAAyB;AAAA","ignoreList":[],"file":"NavigationHandler-dbg.js"}