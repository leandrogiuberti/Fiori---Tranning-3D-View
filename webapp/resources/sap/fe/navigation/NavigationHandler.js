/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)
 *      (c) Copyright 2009-2025 SAP SE. All rights reserved
 */
sap.ui.define(["sap/base/Log","sap/base/assert","sap/base/util/extend","sap/base/util/isEmptyObject","sap/base/util/merge","sap/ui/base/Object","sap/ui/core/UIComponent","sap/ui/core/routing/HashChanger","sap/ui/thirdparty/URI","sap/ui/thirdparty/jquery","sap/ui/util/openWindow","./NavError","./SelectionVariant","./library"],function(e,t,n,a,i,r,o,s,c,jQuery,l,p,f,u){"use strict";var d={};function h(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e,g(e,t)}function g(e,t){return g=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},g(e,t)}const S=u.NavType;const m=u.ParamHandlingMode;const v=u.SuppressionBehavior;const y=u.Mode;const A="sap-iapp-state";const _="sap-ushell-defaultedParameterNames";const V="nhHybridIAppStateKey";let I=function(r){function u(e){var t;let n=arguments.length>1&&arguments[1]!==undefined?arguments[1]:y.ODataV4;let a=arguments.length>2&&arguments[2]!==undefined?arguments[2]:m.SelVarWins;t=r.call(this)||this;t._aTechnicalParamaters=["hcpApplicationId"];t._oLastSavedInnerAppData={sAppStateKey:"",oAppData:{},iCacheHit:0,iCacheMiss:0};t._rIAppStateOld=new RegExp("/"+A+"=([^/?]+)");t._rIAppStateOldAtStart=new RegExp("^"+A+"=([^/?]+)");t._rIAppStateNew=new RegExp("[?&]"+A+"=([^&]+)");t.IAPP_STATE=A;if(!e){throw new p("NavigationHandler.INVALID_INPUT")}if(e instanceof o){t.oRouter=e.getRouter();t.oComponent=e}else{if(typeof e.getOwnerComponent!=="function"){throw new p("NavigationHandler.INVALID_INPUT")}t.oRouter=t._getRouter(e);t.oComponent=e.getOwnerComponent()}if(t.oComponent&&t.oComponent.getAppComponent){t.oComponent=t.oComponent.getAppComponent?.()}if(typeof t.oRouter==="undefined"||typeof t.oComponent==="undefined"||typeof t.oComponent.getComponentData!=="function"){throw new p("NavigationHandler.INVALID_INPUT")}if(a===m.URLParamWins||a===m.InsertInSelOpt){t.sParamHandlingMode=a}else{t.sParamHandlingMode=m.SelVarWins}if(n===y.ODataV2){t._sMode=n}return t}d.NavigationHandler=u;h(u,r);var g=u.prototype;g._getAppNavigationService=function e(){const t=sap.ui.require("sap/ushell/Container");return t.getService("CrossApplicationNavigation")};g._getAppNavigationServiceAsync=async function t(){const n=sap.ui.require("sap/ushell/Container");return n?.getServiceAsync("Navigation").then(function(e){return e}).catch(function(){e.error("NavigationHandler: Navigation is not available.");throw new p("NavigationHandler.NO.XAPPSERVICE")})};g._getRouter=function e(t){return o.getRouterFor(t)};g.registerNavigateCallback=function e(t){this._navigateCallback=t};g.navigate=function t(n,a,i,r,o,s,c){let u,d,h,g,S=false,m={};const v=this;const y=this.oComponent.getComponentData();if(y){g=y.startupParameters;if(g&&g["sap-ushell-next-navmode"]&&g["sap-ushell-next-navmode"].length>0){S=g["sap-ushell-next-navmode"][0]==="explace"}}if(c&&(c==="inplace"||c==="explace")){S=c==="explace"}else if(c){throw new p("NavigationHandler.INVALID_NAV_MODE")}if(s===undefined||s===null){h={}}else{h=s}if(typeof i==="string"){u=i}else if(typeof i==="object"){const e=this._splitInboundNavigationParameters(new f,i,[]).oNavigationSelVar;u=e.toJSONString()}else{throw new p("NavigationHandler.INVALID_INPUT")}m.selectionVariant=new f(u);if(typeof i==="string"){m.selectionVariant=this._removeTechnicalParameters(m.selectionVariant)}m.selectionVariant=m.selectionVariant&&m.selectionVariant.toJSONObject();m=this._removeMeasureBasedInformation(m);m=this._checkIsPotentiallySensitive(m);if(m.selectionVariant){d=this._getURLParametersFromSelectionVariant(new f(m.selectionVariant));u=new f(m.selectionVariant).toJSONString()}else{d={};u=null}const A={target:{semanticObject:n,action:a},params:d||{}};const _=async function(t){if(!h.selectionVariant){h.selectionVariant=u}const n=function(){const n=t.getHref(A,v.oComponent);n.then(function(e){l(e);return}).catch(function(t){e.error("Error while retireving hrefForExternal : "+t)})};h=v._removeMeasureBasedInformation(h);return v._fnSaveAppStateAsync(h,o).then(function(e){if(e){A.appStateKey=e.appStateKey;if(c=="explace"){n()}else{const e=t.navigate(A,v.oComponent);if(v._navigateCallback){v._navigateCallback(e)}}}return})};const V=function(e){v.storeInnerAppStateAsync(r,true).then(async function(t){if(t){v.replaceHash(t)}return _(e)}).catch(function(e){if(o){o(e)}})};if(c){A.params["sap-ushell-navmode"]=S?"explace":"inplace"}v._getAppNavigationServiceAsync().then(async function(e){try{const t=await e.isNavigationSupported([A],v.oComponent);if(t[0].supported){if(!S){V(e)}else{_(e)}}else if(o){const e=new p("NavigationHandler.isIntentSupported.notSupported");o(e)}}catch(e){if(o){const e=v._createTechnicalError("NavigationHandler.isIntentSupported.failed");o(e)}}return}).catch(function(e){if(o){o(e)}})};g.parseNavigation=function t(){const n=s.getInstance().getHash();const a=this._getInnerAppStateKey(n);let i=this.oComponent.getComponentData();if(i===undefined){e.warning("The navigation Component's data was not set properly; assuming instead that no parameters are provided.");i={}}const r=i.startupParameters;const o=r?.[V]?.[0];const c=jQuery.Deferred();let l;if(o!==undefined){l=this._loadAppState(o,c,S.hybrid)}let p=[];if(r&&r[_]&&r[_].length>0){p=JSON.parse(r[_][0])}const u=jQuery.Deferred();const d=this;const h=function(e,t,n,a){const i=d._splitInboundNavigationParameters(new f,e,t);if(i.oNavigationSelVar.isEmpty()&&i.oDefaultedSelVar.isEmpty()&&a!==S.hybrid){if(a===S.xAppState){const t=d._createTechnicalError("NavigationHandler.getDataFromAppState.failed");n.reject(t,e||{},S.xAppState)}else{n.resolve({},e,S.initial)}}else{const t={};t.selectionVariant=i.oNavigationSelVar.toJSONString();t.oSelectionVariant=i.oNavigationSelVar;t.oDefaultedSelectionVariant=i.oDefaultedSelVar;t.bNavSelVarHasDefaultsOnly=i.bNavSelVarHasDefaultsOnly;if(a===S.hybrid){const e=function(e,a,i){t.iAppState=e;n.resolve(t,r,i)};const a=function(e,t,a){n.reject(e,t,a)};if(l!==undefined){l.done(e);l.fail(a)}}else{n.resolve(t,e,a)}}};if(a){this._loadAppState(a,u,S.iAppState)}else{const e=i["sap-xapp-state"]!==undefined;if(e){const e=this;this._getAppNavigationServiceAsync().then(function(t){return t.getStartupAppState(e.oComponent)}).catch(function(){const e=d._createTechnicalError("NavigationHandler.getStartupState.failed");u.reject(e,{},S.xAppState)}).then(function(t){let n=t.getData();let a;if(n){try{n=JSON.parse(JSON.stringify(n))}catch(e){a=d._createTechnicalError("NavigationHandler.AppStateData.parseError");u.reject(a,r,S.xAppState);return u.promise()}}if(n){const t=new f(n.selectionVariant);const a=d._splitInboundNavigationParameters(t,r,p);n.selectionVariant=a.oNavigationSelVar.toJSONString();n.oSelectionVariant=a.oNavigationSelVar;n.oDefaultedSelectionVariant=a.oDefaultedSelVar;n.bNavSelVarHasDefaultsOnly=a.bNavSelVarHasDefaultsOnly;const i=function(e,t,a){n.iAppState=e;u.resolve(n,r,a)};const s=function(e,t,n){e=d._createTechnicalError("NavigationHandler.getAppState.failed");u.reject(e,t,n)};if(o!==undefined&&l!==undefined){l.done(i);l.fail(s)}else if(n[V]){e._loadAppState(n[V],c,S.hybrid).done(i)}else{u.resolve(n,r,S.xAppState)}}else if(r){h(r,p,u,S.xAppState)}else{a=d._createTechnicalError("NavigationHandler.getDataFromAppState.failed");u.reject(a,r||{},S.xAppState)}return}).catch(function(){const e=d._createTechnicalError("NavigationHandler._getAppNavigationServiceAsync.failed");u.reject(e,{},S.xAppState)})}else if(r){h(r,p,u,o!==undefined?S.hybrid:S.URLParams)}else{u.resolve({},{},S.initial)}}return u.promise()};g.setTechnicalParameters=function t(n){if(!n){n=[]}if(!Array.isArray(n)){e.error("NavigationHandler: parameter incorrect, array of strings expected");throw new p("NavigationHandler.INVALID_INPUT")}this._aTechnicalParamaters=n};g.getTechnicalParameters=function e(){return this._aTechnicalParamaters.concat([])};g._isTechnicalParameter=function e(t){if(t){if(!(t==="sap-ui-fe-variant-id"||t==="sap-ui-fe-table-variant-id"||t==="sap-ui-fe-chart-variant-id"||t==="sap-ui-fe-filterbar-variant-id")){if(t.toLowerCase().indexOf("sap-")===0){return true}else if(this._aTechnicalParamaters.includes(t)){return true}}}return false};g._isFEParameter=function e(t){return t.toLowerCase().indexOf("sap-ui-fe")===0};g._removeTechnicalParameters=function e(t){let n,a;const i=t.getSelectOptionsPropertyNames();for(a=0;a<i.length;a++){n=i[a];if(this._isTechnicalParameter(n)){t.removeSelectOption(n)}}return t};g._splitInboundNavigationParameters=function e(t,n,a){if(!Array.isArray(a)){throw new p("NavigationHandler.INVALID_INPUT")}let i,r;const o={};for(i in n){if(!n.hasOwnProperty(i)){continue}if(this._isTechnicalParameter(i)||this._isFEParameter(i)||i===V){continue}if(typeof n[i]==="string"){o[i]=n[i]}else if(Array.isArray(n[i])&&n[i].length===1){o[i]=n[i][0]}else if(Array.isArray(n[i])&&n[i].length>1){o[i]=n[i]}else{throw new p("NavigationHandler.INVALID_INPUT")}}const s=new f;const c=new f;const l=t.getParameterNames().concat(t.getSelectOptionsPropertyNames());for(r=0;r<l.length;r++){i=l[r];if(i in o){if(a.includes(i)){c.massAddSelectOption(i,t.getValue(i));this._addParameterValues(s,i,"I","EQ",o[i])}else{switch(this.sParamHandlingMode){case m.SelVarWins:c.massAddSelectOption(i,t.getValue(i));break;case m.URLParamWins:this._addParameterValues(c,i,"I","EQ",o[i]);break;case m.InsertInSelOpt:c.massAddSelectOption(i,t.getValue(i));this._addParameterValues(c,i,"I","EQ",o[i]);break;default:throw new p("NavigationHandler.INVALID_INPUT")}}}else if(a.includes(i)){s.massAddSelectOption(i,t.getValue(i))}else{c.massAddSelectOption(i,t.getValue(i))}}for(i in o){if(l.includes(i)){continue}if(a.includes(i)){this._addParameterValues(s,i,"I","EQ",o[i])}else{this._addParameterValues(c,i,"I","EQ",o[i])}}let u=false;if(c.isEmpty()){u=true;const e=s.getSelectOptionsPropertyNames();for(r=0;r<e.length;r++){c.massAddSelectOption(e[r],s.getValue(e[r]))}}return{oNavigationSelVar:c,oDefaultedSelVar:s,bNavSelVarHasDefaultsOnly:u}};g._addParameterValues=function e(t,n,a,i,r){if(Array.isArray(r)){for(let e=0;e<r.length;e++){t.addSelectOption(n,a,i,r[e])}}else{t.addSelectOption(n,a,i,r)}};g.replaceHash=function e(t){const n=this.oRouter.oHashChanger?this.oRouter.oHashChanger:s.getInstance();const a=n.getHash();const i=this._replaceInnerAppStateKey(a,t);n.replaceHash(i)};g.storeInnerAppStateAsync=function t(n,i,r){if(typeof i!=="boolean"){i=true}const o=this;const c=jQuery.Deferred();const l=function(e){const t=o.oRouter.oHashChanger?o.oRouter.oHashChanger:s.getInstance();const n=t.getHash();const a=o._replaceInnerAppStateKey(n,e);t.replaceHash(a)};if(a(n)){c.resolve("");return c.promise()}const p=this._oLastSavedInnerAppData.sAppStateKey;const f=JSON.stringify(n)===JSON.stringify(this._oLastSavedInnerAppData.oAppData);if(f&&p){this._oLastSavedInnerAppData.iCacheHit++;l(p);c.resolve(p);return c.promise()}this._oLastSavedInnerAppData.iCacheMiss++;const u=function(e){if(!r&&!i){l(e)}o._oLastSavedInnerAppData.oAppData=n;o._oLastSavedInnerAppData.sAppStateKey=e;c.resolve(e)};const d=function(e){c.reject(e)};this._saveAppStateAsync(n,u,d).then(function(e){if(e!==undefined){if(!r&&i){l(e)}}return}).catch(function(){e.error("NavigationHandler._saveAppStateAsync failed")});return c.promise()};g.storeInnerAppState=function t(n,i){e.error("Deprecated API call of 'sap.fe.navigation.NavigationHandler.storeInnerAppState'. Please use 'storeInnerAppStateAsync' instead",undefined,"sap.fe.navigation.NavigationHandler");if(typeof i!=="boolean"){i=true}const r=this;const o=jQuery.Deferred();const c=function(e){const t=r.oRouter.oHashChanger?r.oRouter.oHashChanger:s.getInstance();const n=t.getHash();const a=r._replaceInnerAppStateKey(n,e);t.replaceHash(a)};if(a(n)){o.resolve("");return o.promise()}const l=this._oLastSavedInnerAppData.sAppStateKey;const p=JSON.stringify(n)===JSON.stringify(this._oLastSavedInnerAppData.oAppData);if(p&&l){this._oLastSavedInnerAppData.iCacheHit++;c(l);o.resolve(l);return o.promise()}this._oLastSavedInnerAppData.iCacheMiss++;const f=function(e){if(!i){c(e)}r._oLastSavedInnerAppData.oAppData=n;r._oLastSavedInnerAppData.sAppStateKey=e;o.resolve(e)};const u=function(e){o.reject(e)};const d=this._saveAppState(n,f,u);if(d!==undefined){if(i){c(d)}}return o.promise()};g.storeInnerAppStateWithImmediateReturn=function t(n,i){e.error("Deprecated API call of 'sap.fe.navigation.NavigationHandler.storeInnerAppStateWithImmediateReturn'. Please use 'storeInnerAppStateAsync' instead",undefined,"sap.fe.navigation.NavigationHandler");if(typeof i!=="boolean"){i=false}const r=this;const o=jQuery.Deferred();if(a(n)){return{appStateKey:"",promise:o.resolve("")}}const s=this._oLastSavedInnerAppData.sAppStateKey;const c=JSON.stringify(n)===JSON.stringify(this._oLastSavedInnerAppData.oAppData);if(c&&s){this._oLastSavedInnerAppData.iCacheHit++;return{appStateKey:s,promise:o.resolve(s)}}this._oLastSavedInnerAppData.iCacheMiss++;const l=function(e){if(!i){r.replaceHash(e)}r._oLastSavedInnerAppData.oAppData=n;r._oLastSavedInnerAppData.sAppStateKey=e;o.resolve(e)};const p=function(e){o.reject(e)};const f=this._saveAppState(n,l,p);return{appStateKey:f,promise:o.promise()}};g.processBeforeSmartLinkPopoverOpens=function e(t,n,a,i){const r=jQuery.Deferred();let o;if(t!=undefined){o=t.semanticAttributes}let s;const c=this;if(i===undefined){s={}}else{s=i}const l=function(e,n){n=s.selectionVariant||n||"{}";const a=v.raiseErrorOnNull|v.raiseErrorOnUndefined;const i=c.mixAttributesAndSelectionVariant(e,n,a);n=i.toJSONString();let o={};o.selectionVariant=i.toJSONObject();o=c._removeMeasureBasedInformation(o);o=c._checkIsPotentiallySensitive(o);e=o.selectionVariant?c._getURLParametersFromSelectionVariant(new f(o.selectionVariant)):{};const l=function(n){if(t===undefined){r.resolve(e,n)}else{t.setSemanticAttributes(e);t.setAppStateKey(n);t.open();r.resolve(t)}};const p=function(e){r.reject(e)};s.selectionVariant=n;s=c._removeMeasureBasedInformation(s);c._saveAppStateAsync(s,l,p)};if(a){const e=this.storeInnerAppStateAsync(a,true);e.done(function(){l(o,n)});e.fail(function(e){r.reject(e)})}else{l(o,n)}return r.promise()};g._getAppStateKeyAndUrlParameters=function e(t){return this.processBeforeSmartLinkPopoverOpens(undefined,t,undefined,undefined)};g._getAppSpecificHash=async function t(n){try{const e=await this._getAppNavigationServiceAsync();return await e.getHref({appSpecificRoute:n})}catch(t){const n=t instanceof Error?t.message:String(t);e.error(`FE : Can not fetch App sepcific URL : ${n}`);throw Error(n)}};g._mixAttributesToSelVariant=function t(n,a,i){for(const t in n){if(n.hasOwnProperty(t)){let r=n[t];if(r instanceof Date){r=r.toJSON()}else if(Array.isArray(r)||r&&typeof r==="object"){r=JSON.stringify(r)}else if(typeof r==="number"||typeof r==="boolean"){r=r.toString()}if(r===""){if(i&v.ignoreEmptyString){e.info("Semantic attribute "+t+" is an empty string and due to the chosen Suppression Behiavour is being ignored.");continue}}if(r===null){if(i&v.raiseErrorOnNull){throw new p("NavigationHandler.INVALID_INPUT")}else{e.warning("Semantic attribute "+t+" is null and ignored for mix in to selection variant");continue}}if(r===undefined){if(i&v.raiseErrorOnUndefined){throw new p("NavigationHandler.INVALID_INPUT")}else{e.warning("Semantic attribute "+t+" is undefined and ignored for mix in to selection variant");continue}}if(typeof r==="string"||r instanceof String){a.addSelectOption(t,"I","EQ",r.toString())}else{throw new p("NavigationHandler.INVALID_INPUT")}}}return a};g.mixAttributesAndSelectionVariant=function e(t,n){let a=arguments.length>2&&arguments[2]!==undefined?arguments[2]:v.standard;const i=new f(n);const r=new f;const o=this;const s=i.getFilterContextUrl();if(s){r.setFilterContextUrl(s)}const c=i.getParameterContextUrl();if(c){r.setParameterContextUrl(c)}if(Array.isArray(t)){t.forEach(function(e){o._mixAttributesToSelVariant(e,r,a)})}else{this._mixAttributesToSelVariant(t,r,a)}const l=i.getParameterNames();let p;for(p=0;p<l.length;p++){if(!r.getSelectOption(l[p])){r.addSelectOption(l[p],"I","EQ",i.getParameter(l[p]))}}const u=i.getSelectOptionsPropertyNames();for(p=0;p<u.length;p++){const e=i.getSelectOption(u[p]);if(!r.getSelectOption(u[p])){for(let t=0;t<e.length;t++){r.addSelectOption(u[p],e[t].Sign,e[t].Option,e[t].Low,e[t].High)}}}return r};g._ensureSelectionVariantFormatString=function e(t){if(t===undefined){return undefined}let n=t;if(typeof t==="object"){n=JSON.stringify(t)}return n};g._fnHandleAppStatePromise=function e(t,n,a){t.promise.done(function(){if(n){n(t.appStateKey)}});if(a){const e=this;t.promise.fail(function(){const t=e._createTechnicalError("NavigationHandler.AppStateSave.failed");a(t)})}};g._saveAppStateAsync=async function e(t,n,a){const i=this;return this._fnSaveAppStateAsync(t,a).then(function(e){if(e){i._fnHandleAppStatePromise(e,n,a);return e.appStateKey}return undefined})};g._saveAppState=function e(t,n,a){const i=this._saveAppStateWithImmediateReturn(t,a);if(i){this._fnHandleAppStatePromise(i,n,a);return i.appStateKey}return undefined};g._fnSaveAppStateWithImmediateReturn=function e(t,n,a){const i=n.getKey();const r=this._fetchAppDataForSave(t,a);if(!r){return undefined}n.setData(r);const o=n.save();return{appStateKey:i,promise:o.promise()}};g._fetchAppDataForSave=function e(t,a){let r={};if(t.hasOwnProperty("selectionVariant")){r.selectionVariant=t.selectionVariant;if(t.selectionVariant){if(typeof t.selectionVariant==="string"){try{r.selectionVariant=JSON.parse(t.selectionVariant)}catch(e){const t=this._createTechnicalError("NavigationHandler.AppStateSave.parseError");if(a){a(t)}return undefined}}}}if(this._sMode===y.ODataV2){r=n({selectionVariant:{},tableVariantId:"",customData:{}},r);if(t.tableVariantId){r.tableVariantId=t.tableVariantId}if(t.customData){r.customData=t.customData}if(t.presentationVariant){r.presentationVariant=t.presentationVariant}if(t.valueTexts){r.valueTexts=t.valueTexts}if(t.semanticDates){r.semanticDates=t.semanticDates}}else{const e=Object.assign({},t);r=i(e,r)}r=this._checkIsPotentiallySensitive(r);return r};g._fnSaveAppStateAsync=async function e(t,n){const a=this;return this._getAppNavigationServiceAsync().then(async function(e){return e.createEmptyAppState(a.oComponent)}).then(function(e){return a._fnSaveAppStateWithImmediateReturn(t,e,n)}).catch(function(e){if(n){n(e)}})};g._saveAppStateWithImmediateReturn=function e(t,n){const a=this._getAppNavigationService().createEmptyAppState(this.oComponent);return this._fnSaveAppStateWithImmediateReturn(t,a,n)};g._loadAppState=function e(t,n,a){const r=this;this._getAppNavigationServiceAsync().then(function(e){return e.getAppState(r.oComponent,t)}).catch(function(){const e=r._createTechnicalError("NavigationHandler._getAppNavigationServiceAsync.failed");n.reject(e,{},a)}).then(function(e){let o={};const s=e.getData();if(typeof s==="undefined"){const e=r._createTechnicalError("NavigationHandler.getDataFromAppState.failed");n.reject(e,{},a)}else if(r._sMode===y.ODataV2){o={selectionVariant:"{}",oSelectionVariant:new f,oDefaultedSelectionVariant:new f,bNavSelVarHasDefaultsOnly:false,tableVariantId:"",customData:{},appStateKey:t,presentationVariant:{},valueTexts:{},semanticDates:{},data:{}};if(s.selectionVariant){o.selectionVariant=r._ensureSelectionVariantFormatString(s.selectionVariant);o.oSelectionVariant=new f(o.selectionVariant)}if(s.tableVariantId){o.tableVariantId=s.tableVariantId}if(s.customData){o.customData=s.customData}if(s.presentationVariant){o.presentationVariant=s.presentationVariant}if(s.valueTexts){o.valueTexts=s.valueTexts}if(s.semanticDates){o.semanticDates=s.semanticDates}if(a===S.hybrid){o.data=s}}else{o=i(o,s);if(s.selectionVariant){o.selectionVariant=r._ensureSelectionVariantFormatString(s.selectionVariant);o.oSelectionVariant=new f(o.selectionVariant)}}n.resolve(o,{},a);return}).catch(function(){const e=r._createTechnicalError("NavigationHandler.getAppState.failed");n.reject(e,{},a)});return n};g._getInnerAppStateKey=function e(t){if(!t){return undefined}let n=this._rIAppStateNew.exec(t);if(n===null){n=this._rIAppStateOld.exec(t)}if(n===null){n=this._rIAppStateOldAtStart.exec(t)}if(n===null){return undefined}return n[1]};g._replaceInnerAppStateKey=function e(n,a){const i=A+"="+a;if(!n){return"?"+i}const r=function(e){if(e.indexOf("?")!==-1){return e+"&"+i}return e+"?"+i};if(!this._getInnerAppStateKey(n)){return r(n)}if(this._rIAppStateNew.test(n)){return n.replace(this._rIAppStateNew,function(e){return e.replace(/[=].*/gi,"="+a)})}const o=function(e,t){t=t.replace(e,"");return r(t)};if(this._rIAppStateOld.test(n)){return o(this._rIAppStateOld,n)}if(this._rIAppStateOldAtStart.test(n)){return o(this._rIAppStateOldAtStart,n)}t(false,"internal inconsistency: Approach of sap-iapp-state not known, but _getInnerAppStateKey returned it");return undefined};g._getURLParametersFromSelectionVariant=function e(t){const n={};let a=0;let i;if(typeof t==="string"){i=new f(t)}else if(typeof t==="object"){i=t}else{throw new p("NavigationHandler.INVALID_INPUT")}const r=i.getSelectOptionsPropertyNames();for(a=0;a<r.length;a++){const e=i.getSelectOption(r[a]);if(e&&e.length===1&&e[0].Sign==="I"&&e[0].Option==="EQ"){n[r[a]]=e[0].Low}}const o=i.getParameterNames();for(a=0;a<o.length;a++){const e=i.getParameter(o[a]);n[o[a]]=e}return n};g._createTechnicalError=function e(t){return new p(t)};g.setModel=function e(t){this._oModel=t};g._getModel=function e(){return this._oModel||this.oComponent.getModel()};g._removeAllProperties=function e(t){if(t){if(t.selectionVariant){t.selectionVariant=null}if(t.valueTexts){t.valueTexts=null}if(t.semanticDates){t.semanticDates=null}}};g._removeProperties=function e(t,n,a){if(t.length&&a&&(a.selectionVariant||a.valueTexts||a.semanticDates)){t.forEach(function(e){if(a.selectionVariant.SelectOptions){a.selectionVariant.SelectOptions.some(function(t,n){if(e===t.PropertyName){a.selectionVariant.SelectOptions.splice(n,1);return true}return false})}if(a.valueTexts&&a.valueTexts.Texts){a.valueTexts.Texts.forEach(function(t){if(t.PropertyTexts){t.PropertyTexts.some(function(n,a){if(e===n.PropertyName){t.PropertyTexts.splice(a,1);return true}return false})}})}if(a.semanticDates&&a.semanticDates.Dates){a.semanticDates.Dates.forEach(function(t,n){if(e===t.PropertyName){a.semanticDates.Dates.splice(n,1)}})}})}if(n.length&&a&&a.selectionVariant&&a.selectionVariant.Parameters){n.forEach(function(e){a.selectionVariant.Parameters.some(function(t,n){if(e===t.PropertyName||"$Parameter."+e===t.PropertyName){a.selectionVariant.Parameters.splice(n,1);return true}return false})})}};g._isTermTrue=function e(t,n){const a=function(e){if(e){return e.Bool?e.Bool!=="false":true}return false};return!!t[n]&&a(t[n])};g._isExcludedFromNavigationContext=function e(t){return this._isTermTrue(t,"com.sap.vocabularies.UI.v1.ExcludeFromNavigationContext")};g._isPotentiallySensitive=function e(t){return this._isTermTrue(t,"com.sap.vocabularies.PersonalData.v1.IsPotentiallySensitive")};g._isMeasureProperty=function e(t){return this._isTermTrue(t,"com.sap.vocabularies.Analytics.v1.Measure")};g._isToBeExcluded=function e(t){return this._isPotentiallySensitive(t)||this._isExcludedFromNavigationContext(t)};g.constructContextUrl=function e(t,n){if(!t){throw new p("NavigationHandler.NO_ENTITY_SET_PROVIDED")}if(n===undefined){n=this._getModel()}return this._constructContextUrl(n)+"#"+t};g._constructContextUrl=function e(t){let n;if(t.isA("sap.ui.model.odata.v2.ODataModel")){n=t._getServerUrl()}else if(t.isA("sap.ui.model.odata.v4.ODataModel")){const e=new c(t.getServiceUrl()).absoluteTo(document.baseURI);n=new c("/").absoluteTo(e).toString()}if(n&&n.lastIndexOf("/")===n.length-1){n=n.substring(0,n.length-1)}return n+t.sServiceUrl+"/$metadata"};g._checkIsPotentiallySensitive=function t(a){let i=a;if(a&&a.selectionVariant&&(a.selectionVariant.FilterContextUrl&&a.selectionVariant.SelectOptions||a.selectionVariant.ParameterContextUrl&&a.selectionVariant.Parameters)){const t=this._getModel();if(this.oComponent&&t&&t.isA("sap.ui.model.odata.v2.ODataModel")){const r=[];const o=[];let s,c,l,p,f,u=[],d=[];const h=t.getMetaModel();if(t.getServiceMetadata()&&h?.oModel){if(a.selectionVariant.FilterContextUrl){u=a.selectionVariant.FilterContextUrl.split("#")}if(u.length===2&&a.selectionVariant.SelectOptions&&this._constructContextUrl(t).indexOf(u[0])===0){c=h.getODataEntitySet(u[1]);if(c){l=h.getODataEntityType(c.entityType)}else{l=h.getODataEntityType(u[1])}if(l){if(l&&l.property){for(s=0;s<l.property.length;s++){if(this._isToBeExcluded(l.property[s])){r.push(l.property[s].name)}}}if(l.navigationProperty){for(s=0;s<l.navigationProperty.length;s++){f=h.getODataAssociationEnd(l,l.navigationProperty[s].name);if(!f||f.type===a.selectionVariant.FilterContextUrl){continue}if(f.multiplicity==="1"||f.multiplicity==="0..1"){p=h.getODataEntityType(f.type);if(p&&p.property){for(let e=0;e<p.property.length;e++){if(this._isToBeExcluded(p.property[e])){r.push(l.navigationProperty[s].name+"."+p.property[e].name)}}}}}}}}if(a.selectionVariant.ParameterContextUrl){d=a.selectionVariant.ParameterContextUrl.split("#")}if(d.length===2&&a.selectionVariant.Parameters&&this._constructContextUrl(t).indexOf(d[0])===0){c=h.getODataEntitySet(d[1]);if(c){l=h.getODataEntityType(c.entityType)}else{l=h.getODataEntityType(u[1])}if(l){if(l.property){for(s=0;s<l.property.length;s++){if(this._isToBeExcluded(l.property[s])){o.push(l.property[s].name)}}}}}if(r.length||o.length){i=n(true,{},i);this._removeProperties(r,o,i)}}else{this._removeAllProperties(i);e.error("NavigationHandler: oMetadata are not fully loaded!")}}else if(this.oComponent&&t&&t.isA("sap.ui.model.odata.v4.ODataModel")){return this._removeSensitiveDataForODataV4(i)}}return i};g._removeMeasureBasedInformation=function t(n){let a=n;if(n.selectionVariant){if(typeof n.selectionVariant==="string"){try{a.selectionVariant=JSON.parse(n.selectionVariant)}catch(t){e.error("NavigationHandler: _removeMeasureBasedInformation parse error")}}a=this._removeMeasureBasedProperties(a)}return a};g._removeMeasureBasedProperties=function t(a){let i=a;const r=[];const o=[];let s,c,l,p,f,u,d,h=[],g=[];if(a&&a.selectionVariant&&(a.selectionVariant.FilterContextUrl&&a.selectionVariant.SelectOptions||a.selectionVariant.ParameterContextUrl&&a.selectionVariant.Parameters)){c=this._getModel();if(this.oComponent&&c&&c.isA("sap.ui.model.odata.v2.ODataModel")){l=c.getMetaModel();if(c.getServiceMetadata()&&l&&l.oModel){if(a.selectionVariant.FilterContextUrl){h=a.selectionVariant.FilterContextUrl.split("#")}if(h.length===2&&a.selectionVariant.SelectOptions&&this._constructContextUrl(c).indexOf(h[0])===0){p=l.getODataEntitySet(h[1]);if(p){f=l.getODataEntityType(p.entityType)}else{f=l.getODataEntityType(h[1])}if(f){if(f&&f.property){for(s=0;s<f.property.length;s++){if(this._isMeasureProperty(f.property[s])){r.push(f.property[s].name)}}}if(f.navigationProperty){for(s=0;s<f.navigationProperty.length;s++){d=l.getODataAssociationEnd(f,f.navigationProperty[s].name);if(!d||d.type===a.selectionVariant.FilterContextUrl){continue}if(d.multiplicity==="1"||d.multiplicity==="0..1"){u=l.getODataEntityType(d.type);if(u&&u.property){for(let e=0;e<u.property.length;e++){if(this._isMeasureProperty(u.property[e])){r.push(f.navigationProperty[s].name+"."+u.property[e].name)}}}}}}}}if(a.selectionVariant.ParameterContextUrl){g=a.selectionVariant.ParameterContextUrl.split("#")}if(g.length===2&&a.selectionVariant.Parameters&&this._constructContextUrl(c).indexOf(g[0])===0){p=l.getODataEntitySet(g[1]);if(p){f=l.getODataEntityType(p.entityType)}else{f=l.getODataEntityType(h[1])}if(f){if(f.property){for(s=0;s<f.property.length;s++){if(this._isMeasureProperty(f.property[s])){o.push(f.property[s].name)}}}}}if(r.length||o.length){i=n(true,{},i);this._removeProperties(r,o,i)}}else{this._removeAllProperties(i);e.error("NavigationHandler: oMetadata are not fully loaded!")}}else if(this.oComponent&&c&&c.isA("sap.ui.model.odata.v4.ODataModel")){return this._removeSensitiveDataForODataV4(i,true)}}return i};g._removeSensitiveDataForODataV4=function t(n,a){const i=this,r=new f(n.selectionVariant),o=this._getModel();let s;if(!o.getMetaModel().getObject("/")){this._removeAllProperties(n);e.error("NavigationHandler: oMetadata are not fully loaded!");return n}if(n.selectionVariant.FilterContextUrl){s=n.selectionVariant.FilterContextUrl.split("#")}if(s?.length===2&&n.selectionVariant.SelectOptions&&this._constructContextUrl(o).indexOf(s[0])===0){r.removeSelectOption("@odata.context");r.removeSelectOption("@odata.metadataEtag");r.removeSelectOption("SAP__Messages");const e=s[1],t=o.getMetaModel(),c=r.getPropertyNames()||[],l=function(n,r){r=r||e;const o=t.getObject("/"+r+"/"+n+"@");if(o){if(a&&o["@com.sap.vocabularies.Analytics.v1.Measure"]||i._checkPropertyAnnotationsForSensitiveData(o)){return true}else if(o["@com.sap.vocabularies.Common.v1.FieldControl"]){const e=o["@com.sap.vocabularies.Common.v1.FieldControl"];if(e["$EnumMember"]&&e["$EnumMember"].split("/")[1]==="Inapplicable"){return true}}}return false};for(let t=0;t<c.length;t++){const n=c[t];if(l(n,e)){r.removeSelectOption(n)}}n.selectionVariant=r.toJSONObject()}return n};g._checkPropertyAnnotationsForSensitiveData=function e(t){return!!(t["@com.sap.vocabularies.PersonalData.v1.IsPotentiallySensitive"]||t["@com.sap.vocabularies.UI.v1.ExcludeFromNavigationContext"])};g.getIAppStateKey=function e(){const t=s.getInstance().getHash();return this._getInnerAppStateKey(t)};return u}(r);d.NavigationHandler=I;const N=r.extend("sap.fe.navigation.NavigationHandler",I.prototype);return N},false);
//# sourceMappingURL=NavigationHandler.js.map