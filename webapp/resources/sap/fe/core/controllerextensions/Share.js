/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)
 *      (c) Copyright 2009-2025 SAP SE. All rights reserved
 */
sap.ui.define(["sap/base/Log","sap/base/util/ObjectPath","sap/base/util/extend","sap/fe/base/ClassSupport","sap/m/library","sap/ui/core/Component","sap/ui/core/Element","sap/ui/core/Fragment","sap/ui/core/Lib","sap/ui/core/XMLTemplateProcessor","sap/ui/core/routing/HashChanger","sap/ui/core/util/XMLPreprocessor","sap/ui/model/json/JSONModel","./BaseControllerExtension"],function(e,t,o,a,r,i,n,s,l,c,p,u,h,d){"use strict";var g,f,m,y,S,b,w,_,T,P,O,E,M,A,D,C,I,v,j;var x=a.publicExtension;var U=a.methodOverride;var H=a.finalExtension;var F=a.extensible;var R=a.defineUI5Class;function L(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e,B(e,t)}function B(e,t){return B=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},B(e,t)}function J(e,t,o,a,r){var i={};return Object.keys(a).forEach(function(e){i[e]=a[e]}),i.enumerable=!!i.enumerable,i.configurable=!!i.configurable,("value"in i||i.initializer)&&(i.writable=!0),i=o.slice().reverse().reduce(function(o,a){return a(e,t,o)||o},i),r&&void 0!==i.initializer&&(i.value=i.initializer?i.initializer.call(r):void 0,i.initializer=void 0),void 0===i.initializer?(Object.defineProperty(e,t,i),null):i}let V;let z=(g=R("sap.fe.core.controllerextensions.Share"),f=U(),m=U(),y=x(),S=H(),b=x(),w=F("AfterAsync"),_=x(),T=F("AfterAsync"),P=x(),O=H(),E=x(),M=H(),A=x(),D=H(),C=x(),I=H(),g(v=(j=function(a){function d(){return a.call(this)||this}L(d,a);var g=d.prototype;g.onInit=function e(){const t=new h({saveAsTileClicked:false,collaborationInfo:{url:"",appTitle:"",subTitle:"",minifyUrlForChat:true,appId:""}});this.base.getView().setModel(t,"shareInfo")};g.onExit=function e(){const t=this.base?.getView()?.getModel("shareInfo");if(t){t.destroy()}};g.openShareSheet=function e(t){this._openShareSheetImpl(t)};g.getCardDefinition=async function e(){return Promise.resolve(undefined)};g.adaptShareMetadata=function e(t){const o=this.base?.getView()?.getModel("shareInfo");const a=this.base.getAppComponent().getManifest();const r=a?.["sap.app"]?.id;const i=a?.["sap.app"]?.title||document.title;if(o){o.setProperty("/collaborationInfo/appId",r);o.setProperty("/collaborationInfo/url",t.url);o.setProperty("/collaborationInfo/appTitle",i)}return t};g._openShareSheetImpl=async function t(a){let i;const d=p.getInstance();const g=d.getHash();const f=d.hrefForAppSpecificHash?d.hrefForAppSpecificHash(""):"";const m={url:window.location.origin+window.location.pathname+window.location.search+(g?f+g:window.location.hash),title:await(this.base.getAppComponent()?.getShellServices()?.getTitle()),email:{url:"",title:""},jam:{url:"",title:""},tile:{url:"",title:"",subtitle:"",icon:"",queryUrl:""}};V=a;const y=function(e,t){const a=e.getModel("shareData");const r=o(a.getData(),t);a.setData(r)};try{const t=await(this.base.getView().getController()?.share?.adaptShareMetadata(m));const p={shareEmailPressed:function(){const e=i.getModel("shareData");const t=e.getData();const o=l.getResourceBundleFor("sap.fe.core");const a=t.email.title?t.email.title:o.getText("T_SHARE_UTIL_HELPER_SAPFE_EMAIL_SUBJECT",[t.title]);r.URLHelper.triggerEmail(undefined,a,t.email.url?t.email.url:t.url)},shareMSTeamsPressed:function(){const e=i.getModel("shareData");const t=e.getData();const o=t.email.title?t.email.title:t.title;const a=t.email.url?t.email.url:t.url;const r=window.open("","ms-teams-share-popup","width=700,height=600");r.opener=null;r.location=`https://teams.microsoft.com/share?msgText=${encodeURIComponent(o)}&href=${encodeURIComponent(a)}`},onSaveTilePress:function(){setTimeout(function(){n.getElementById("bookmarkDialog")?.attachAfterClose(function(){V.focus()})},0)},shareJamPressed:async()=>{await this._doOpenJamShareDialog(t?.jam?.title?t.jam.title:t.title,t?.jam?.url?t.jam.url:t.url)}};p.onCancelPressed=function(){i.close()};p.setShareSheet=function(e){a.shareSheet=e};const d=new h({});const g={bindingContexts:{this:d.createBindingContext("/")},models:{this:d}};const f={title:t?.tile?.title?t.tile.title:t.title,subtitle:t?.tile?.subtitle,icon:t?.tile?.icon,url:t?.tile?.url?t.tile.url:t.url.substring(t.url.indexOf("#")),queryUrl:t?.tile?.queryUrl};if(a.shareSheet){i=a.shareSheet;const e=i.getModel("share");this._setStaticShareData(e);const r=o(e.getData(),f);e.setData(r);y(i,t);i.openBy(a)}else{const r="sap.fe.macros.share.ShareSheet";const n=c.loadTemplate(r,"fragment");try{const e=await u.process(n,{name:r},g);i=await s.load({definition:e,controller:p});i.setModel(new h(f||{}),"share");const l=i.getModel("share");this._setStaticShareData(l);const c=o(l.getData(),f);l.setData(c);i.setModel(new h(t||{}),"shareData");y(i,t);a.addDependent(i);i.openBy(a);p.setShareSheet(i)}catch(t){e.error("Error while opening the share fragment",t)}}}catch(t){e.error("Error while fetching the share model data",t)}};g.getTeamsUrl=async function e(t){const o=await(this.base.getAppComponent()?.getShellServices().getInframeUrl());return o?o:t};g._setStaticShareData=function e(o){const a=l.getResourceBundleFor("sap.fe.core");o.setProperty("/jamButtonText",a.getText("T_COMMON_SAPFE_SHARE_JAM"));o.setProperty("/emailButtonText",a.getText("T_SEMANTIC_CONTROL_SEND_EMAIL"));o.setProperty("/msTeamsShareButtonText",a.getText("T_COMMON_SAPFE_SHARE_MSTEAMS"));if(t.get("sap-ushell-config.renderers.fiori2.componentData.config.sapHorizonEnabled")===true){o.setProperty("/msTeamsVisible",true)}else{o.setProperty("/msTeamsVisible",false)}const r=t.get("sap.ushell.Container.getUser");o.setProperty("/jamVisible",!!r&&r().isJamActive());o.setProperty("/saveAsTileVisible",!!sap.ui.require("sap/ushell/Container"))};g._doOpenJamShareDialog=async function e(t,o){const a=await i.create({name:"sap.collaboration.components.fiori.sharing.dialog",settings:{object:{id:o,share:t}}});a.open()};g._triggerEmail=async function e(){const t=await this._adaptShareMetadata();const o=l.getResourceBundleFor("sap.fe.core");const a=t.email.title?t.email.title:o.getText("T_SHARE_UTIL_HELPER_SAPFE_EMAIL_SUBJECT",[t.title]);r.URLHelper.triggerEmail(undefined,a,t.email.url?t.email.url:t.url)};g._triggerShareToJam=async function e(){const t=await this._adaptShareMetadata();await this._doOpenJamShareDialog(t.jam.title?t.jam.title:t.title,t.jam.url?t.jam.url:window.location.origin+window.location.pathname+t.url)};g._saveAsTile=async function e(t){const o=this.base?.getView()?.getModel("shareInfo");if(o){o.setProperty("/saveAsTileClicked",true)}const a=await this._adaptShareMetadata(),r=t.getDependents()[0],i=p.getInstance(),n=i.getHash(),s=i.hrefForAppSpecificHash?i.hrefForAppSpecificHash(""):"";a.url=n?s+n:window.location.hash;r.setTitle(a.tile.title?a.tile.title:a.title);r.setSubtitle(a.tile.subtitle);r.setTileIcon(a.tile.icon);r.setCustomUrl(a.tile.url?a.tile.url:a.url);r.setServiceUrl(a.tile.queryUrl);r.setDataSource({type:"OData",settings:{odataVersion:"4.0"}});if(o){o.setProperty("/saveAsTileClicked",false)}r.firePress()};g._adaptShareMetadata=async function e(){const t=p.getInstance();const o=encodeURIComponent(t.getHash());const a=t.hrefForAppSpecificHash?t.hrefForAppSpecificHash(""):"";const r={url:window.location.origin+window.location.pathname+window.location.search+(o?a+o:window.location.hash),title:await(this.base.getAppComponent()?.getShellServices()?.getTitle()),email:{url:"",title:""},jam:{url:"",title:""},tile:{url:"",title:"",subtitle:"",icon:"",queryUrl:""}};return this.base.getView().getController().share.adaptShareMetadata(r)};return d}(d),J(j.prototype,"onInit",[f],Object.getOwnPropertyDescriptor(j.prototype,"onInit"),j.prototype),J(j.prototype,"onExit",[m],Object.getOwnPropertyDescriptor(j.prototype,"onExit"),j.prototype),J(j.prototype,"openShareSheet",[y,S],Object.getOwnPropertyDescriptor(j.prototype,"openShareSheet"),j.prototype),J(j.prototype,"getCardDefinition",[b,w],Object.getOwnPropertyDescriptor(j.prototype,"getCardDefinition"),j.prototype),J(j.prototype,"adaptShareMetadata",[_,T],Object.getOwnPropertyDescriptor(j.prototype,"adaptShareMetadata"),j.prototype),J(j.prototype,"_triggerEmail",[P,O],Object.getOwnPropertyDescriptor(j.prototype,"_triggerEmail"),j.prototype),J(j.prototype,"_triggerShareToJam",[E,M],Object.getOwnPropertyDescriptor(j.prototype,"_triggerShareToJam"),j.prototype),J(j.prototype,"_saveAsTile",[A,D],Object.getOwnPropertyDescriptor(j.prototype,"_saveAsTile"),j.prototype),J(j.prototype,"_adaptShareMetadata",[C,I],Object.getOwnPropertyDescriptor(j.prototype,"_adaptShareMetadata"),j.prototype),j))||v);return z},false);
//# sourceMappingURL=Share.js.map