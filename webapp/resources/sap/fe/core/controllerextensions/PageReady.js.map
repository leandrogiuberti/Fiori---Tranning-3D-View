{"version":3,"file":"PageReady.js","names":["PageReadyControllerExtension","_dec","defineUI5Class","_dec2","methodOverride","_dec3","_dec4","publicExtension","_dec5","finalExtension","_dec6","_dec7","_dec8","_dec9","_dec10","_dec11","_dec12","_dec13","_dec14","_dec15","_dec16","_dec17","_dec18","_dec19","privateExtension","_dec20","extensible","OverrideExecution","Instead","_dec21","_class","_class2","_ControllerExtension","_this","call","this","pageReadyTimeoutDefault","_inheritsLoose","_proto","prototype","onInit","_nbWaits","_oEventProvider","EventProvider","view","getView","appComponent","CommonUtils","getAppComponent","pageComponent","Component","getOwnerComponentFor","manifestContent","getManifest","pageReadyTimeout","attachContainerDefined","oEvent","registerContainer","getParameter","rootControlController","getRootControl","getController","placeholder","getPlaceholder","isPlaceholderDebugEnabled","attachEvent","getPlaceholderDebugStats","iPageReadyEventTimestamp","Date","now","iHeroesBatchReceivedEventTimestamp","queryWatcher","DataQueryWatcher","checkPageReadyDebounced","bind","onExit","_oAppComponent","_oContainer","_fnContainerDelegate","removeEventDelegate","waitFor","oPromise","finally","setTimeout","catch","onRouteMatched","_bIsPageReady","onRouteMatchedFinished","async","onAfterBindingPromise","registerAggregatedControls","mainBindingContext","mainObjectBinding","getBinding","registerBinding","promises","controls","findAggregatedObjects","forEach","element","objectBinding","getObjectBinding","aBindingKeys","Object","keys","mBindingInfos","propertyName","listBinding","binding","isA","tableOrChart","getContent","getChartControl","getBindingContext","bTablesChartsLoaded","push","registerTableOrChart","registerFilterBar","onAfterBinding","oBindingContext","parameters","pageReadyTimeoutTimer","clearTimeout","deferredCreation","isContextExpected","Log","error","fireEvent","disableAnimation","bHasContext","_bAfterBindingAlreadyApplied","attachEventOnce","undefined","reset","Promise","aTableChartInitializedPromises","length","all","resolve","isPageReady","waitPageReady","sEventId","oData","fnFunction","oListener","detachEvent","oContainer","onBeforeShow","bShown","onBeforeHide","onAfterShow","then","addEventDelegate","bFromNav","arguments","pageReadyTimer","model","getModel","timeOut","getOptimisticBatchEnabler","_checkPageReady","fnUIUpdated","Rendering","isPending","detachUIUpdated","_bWaitingForRefresh","checkUIUpdated","isDataReceived","resetDataReceived","attachUIUpdated","TemplatedViewServiceFactory","getNumberOfViewsInCreationState","isSearchPending","forcePageReady","ControllerExtension","_applyDecoratedDescriptor","getOwnPropertyDescriptor"],"sources":["./PageReady.ts"],"sourcesContent":["import Log from \"sap/base/Log\";\nimport { defineUI5Class, extensible, finalExtension, methodOverride, privateExtension, publicExtension } from \"sap/fe/base/ClassSupport\";\nimport type AppComponent from \"sap/fe/core/AppComponent\";\nimport type PageController from \"sap/fe/core/PageController\";\nimport DataQueryWatcher from \"sap/fe/core/controllerextensions/pageReady/DataQueryWatcher\";\nimport { TemplatedViewServiceFactory } from \"sap/fe/core/services/TemplatedViewServiceFactory\";\nimport type ChartBlock from \"sap/fe/macros/Chart\";\nimport type FilterBar from \"sap/fe/macros/controls/FilterBar\";\nimport type TableAPI from \"sap/fe/macros/table/TableAPI\";\nimport type Event from \"sap/ui/base/Event\";\nimport EventProvider from \"sap/ui/base/EventProvider\";\nimport type ManagedObject from \"sap/ui/base/ManagedObject\";\nimport Component from \"sap/ui/core/Component\";\nimport type ComponentContainer from \"sap/ui/core/ComponentContainer\";\nimport type Control from \"sap/ui/core/Control\";\nimport Rendering from \"sap/ui/core/Rendering\";\nimport ControllerExtension from \"sap/ui/core/mvc/ControllerExtension\";\nimport OverrideExecution from \"sap/ui/core/mvc/OverrideExecution\";\nimport type View from \"sap/ui/core/mvc/View\";\nimport type Binding from \"sap/ui/model/Binding\";\nimport type Context from \"sap/ui/model/odata/v4/Context\";\nimport type ODataListBinding from \"sap/ui/model/odata/v4/ODataListBinding\";\nimport type ODataModel from \"sap/ui/model/odata/v4/ODataModel\";\nimport CommonUtils from \"../CommonUtils\";\n\ntype RenderingEx = typeof Rendering & {\n\tattachUIUpdated: Function;\n\tdetachUIUpdated: Function;\n};\n@defineUI5Class(\"sap.fe.core.controllerextensions.PageReady\")\nclass PageReadyControllerExtension extends ControllerExtension {\n\tprotected base!: PageController;\n\n\tprivate _oEventProvider!: EventProvider;\n\n\tprivate view!: View;\n\n\tprivate appComponent!: AppComponent;\n\n\tprivate pageComponent!: Component;\n\n\tprivate _oContainer!: Control;\n\n\tprivate _bAfterBindingAlreadyApplied!: boolean;\n\n\tprivate _fnContainerDelegate?: object;\n\n\tprivate _nbWaits!: number;\n\n\tprivate _bIsPageReady!: boolean;\n\n\tprivate _bWaitingForRefresh!: boolean;\n\n\tprivate bShown!: boolean;\n\n\tprivate bHasContext!: boolean;\n\n\tprivate bTablesChartsLoaded?: boolean;\n\n\tprivate pageReadyTimer: number | undefined;\n\n\tprivate queryWatcher!: DataQueryWatcher;\n\n\tprivate onAfterBindingPromise!: Promise<void>;\n\n\tprivate pageReadyTimeoutDefault = 7000;\n\n\tprivate pageReadyTimeoutTimer?: number;\n\n\tprivate pageReadyTimeout?: number;\n\n\tconstructor() {\n\t\tsuper();\n\t}\n\n\t@methodOverride()\n\tpublic onInit(): void {\n\t\tthis._nbWaits = 0;\n\t\tthis._oEventProvider = this._oEventProvider ? this._oEventProvider : new EventProvider();\n\t\tthis.view = this.getView();\n\n\t\tthis.appComponent = CommonUtils.getAppComponent(this.view);\n\t\tthis.pageComponent = Component.getOwnerComponentFor(this.view) as Component;\n\t\tconst manifestContent = this.appComponent.getManifest();\n\t\tthis.pageReadyTimeout = manifestContent[\"sap.ui5\"]?.pageReadyTimeout ?? this.pageReadyTimeoutDefault;\n\n\t\tif (this.pageComponent?.attachContainerDefined) {\n\t\t\tthis.pageComponent.attachContainerDefined((oEvent: Event<{ container: ComponentContainer }>) =>\n\t\t\t\tthis.registerContainer(oEvent.getParameter(\"container\"))\n\t\t\t);\n\t\t} else {\n\t\t\tthis.registerContainer(this.view);\n\t\t}\n\n\t\tconst rootControlController = this.appComponent.getRootControl().getController();\n\t\tconst placeholder = rootControlController?.getPlaceholder?.();\n\t\tif (placeholder?.isPlaceholderDebugEnabled()) {\n\t\t\tthis.attachEvent(\n\t\t\t\t\"pageReady\",\n\t\t\t\tnull,\n\t\t\t\t() => {\n\t\t\t\t\tplaceholder.getPlaceholderDebugStats().iPageReadyEventTimestamp = Date.now();\n\t\t\t\t},\n\t\t\t\tthis\n\t\t\t);\n\t\t\tthis.attachEvent(\n\t\t\t\t\"heroesBatchReceived\",\n\t\t\t\tnull,\n\t\t\t\t() => {\n\t\t\t\t\tplaceholder.getPlaceholderDebugStats().iHeroesBatchReceivedEventTimestamp = Date.now();\n\t\t\t\t},\n\t\t\t\tthis\n\t\t\t);\n\t\t}\n\n\t\tthis.queryWatcher = new DataQueryWatcher(this._oEventProvider, this.checkPageReadyDebounced.bind(this));\n\t}\n\n\t@methodOverride()\n\tpublic onExit(): void {\n\t\t// eslint-disable-next-line @typescript-eslint/ban-ts-comment\n\t\t// @ts-ignore\n\t\tdelete this._oAppComponent;\n\t\tif (this._oContainer && this._fnContainerDelegate) {\n\t\t\tthis._oContainer.removeEventDelegate(this._fnContainerDelegate);\n\t\t}\n\t}\n\n\t@publicExtension()\n\t@finalExtension()\n\tpublic waitFor(oPromise: Promise<unknown>): void {\n\t\tthis._nbWaits++;\n\t\toPromise\n\t\t\t.finally(() => {\n\t\t\t\tsetTimeout(() => {\n\t\t\t\t\tthis._nbWaits--;\n\t\t\t\t}, 0);\n\t\t\t})\n\t\t\t.catch(null);\n\t}\n\n\t@methodOverride(\"_routing\")\n\tonRouteMatched(): void {\n\t\tthis._bIsPageReady = false;\n\t}\n\n\t@methodOverride(\"_routing\")\n\tasync onRouteMatchedFinished(): Promise<void> {\n\t\tawait this.onAfterBindingPromise;\n\t\tthis.checkPageReadyDebounced();\n\t}\n\n\tpublic registerAggregatedControls(mainBindingContext?: Context): Promise<void>[] {\n\t\tif (mainBindingContext) {\n\t\t\tconst mainObjectBinding = mainBindingContext.getBinding();\n\t\t\tthis.queryWatcher.registerBinding(mainObjectBinding);\n\t\t}\n\n\t\tconst promises: Promise<void>[] = [];\n\t\tconst controls = this.getView().findAggregatedObjects(true);\n\n\t\tcontrols.forEach((element: ManagedObject & { mBindingInfos?: Record<string, { binding?: Binding }> }): void => {\n\t\t\tconst objectBinding = element.getObjectBinding();\n\t\t\tif (objectBinding) {\n\t\t\t\t// Register on all object binding (mostly used on object pages)\n\t\t\t\tthis.queryWatcher.registerBinding(objectBinding);\n\t\t\t} else {\n\t\t\t\tconst aBindingKeys = Object.keys(element?.mBindingInfos ?? {});\n\t\t\t\taBindingKeys.forEach((propertyName) => {\n\t\t\t\t\tconst listBinding = element?.mBindingInfos?.[propertyName].binding;\n\n\t\t\t\t\tif (listBinding && listBinding.isA<ODataListBinding>(\"sap.ui.model.odata.v4.ODataListBinding\")) {\n\t\t\t\t\t\tthis.queryWatcher.registerBinding(listBinding);\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\t\t\t// This is dirty but MDCTables and MDCCharts have a weird loading lifecycle\n\t\t\tif (element.isA<TableAPI>(\"sap.fe.macros.table.TableAPI\") || element.isA<ChartBlock>(\"sap.fe.macros.Chart\")) {\n\t\t\t\tconst tableOrChart = (element as TableAPI).getContent?.() ?? (element as ChartBlock).getChartControl();\n\n\t\t\t\tif (tableOrChart.getBindingContext() !== null) {\n\t\t\t\t\t// Only consider non lazy loaded tables and charts\n\t\t\t\t\tthis.bTablesChartsLoaded = false;\n\t\t\t\t\tpromises.push(this.queryWatcher.registerTableOrChart(tableOrChart));\n\t\t\t\t}\n\t\t\t} else if (element.isA<FilterBar>(\"sap.fe.macros.controls.FilterBar\")) {\n\t\t\t\tthis.queryWatcher.registerFilterBar(element);\n\t\t\t}\n\t\t});\n\n\t\treturn promises;\n\t}\n\n\t@methodOverride(\"_routing\")\n\tonAfterBinding(oBindingContext?: Context, parameters?: { deferredCreation?: boolean }): void {\n\t\t// In case the page is rebind we need to clear the timer (eg: in FCL, the user can select 2 items successively in the list report)\n\t\tif (this.pageReadyTimeoutTimer) {\n\t\t\tclearTimeout(this.pageReadyTimeoutTimer);\n\t\t}\n\n\t\tif (!parameters?.deferredCreation || !this.isContextExpected() || oBindingContext) {\n\t\t\tthis.pageReadyTimeoutTimer = setTimeout(() => {\n\t\t\t\tLog.error(\n\t\t\t\t\t`The PageReady Event was not fired within the ${this.pageReadyTimeout} ms timeout . It has been forced. Please contact your application developer for further analysis`\n\t\t\t\t);\n\t\t\t\tthis._oEventProvider.fireEvent(\"pageReady\");\n\t\t\t}, this.pageReadyTimeout);\n\t\t} else {\n\t\t\t// We are in deferred creation with no context, we need to wait for the context to be set by the create dialog\n\t\t\t// We also need to disable the placeholder animation\n\t\t\tconst rootControlController = this.appComponent.getRootControl().getController();\n\t\t\tconst placeholder = rootControlController?.getPlaceholder?.();\n\t\t\tplaceholder?.disableAnimation();\n\t\t}\n\n\t\tif (this.isContextExpected() && !oBindingContext) {\n\t\t\t// Force to mention we are expecting data\n\t\t\tthis.bHasContext = false;\n\t\t\treturn;\n\t\t} else {\n\t\t\tthis.bHasContext = true;\n\t\t}\n\n\t\tif (this._bAfterBindingAlreadyApplied) {\n\t\t\treturn;\n\t\t}\n\n\t\tthis._bAfterBindingAlreadyApplied = true;\n\n\t\tthis.attachEventOnce(\"pageReady\", null, () => {\n\t\t\tclearTimeout(this.pageReadyTimeoutTimer);\n\t\t\tthis.pageReadyTimeoutTimer = undefined;\n\t\t\tthis._bAfterBindingAlreadyApplied = false;\n\t\t\tthis.queryWatcher.reset();\n\t\t});\n\n\t\tthis.onAfterBindingPromise = new Promise<void>(async (resolve): Promise<void> => {\n\t\t\tconst aTableChartInitializedPromises = this.registerAggregatedControls(oBindingContext);\n\n\t\t\tif (aTableChartInitializedPromises.length > 0) {\n\t\t\t\tawait Promise.all(aTableChartInitializedPromises);\n\t\t\t\tthis.bTablesChartsLoaded = true;\n\t\t\t\tthis.checkPageReadyDebounced();\n\t\t\t\tresolve();\n\t\t\t} else {\n\t\t\t\tthis.checkPageReadyDebounced();\n\t\t\t\tresolve();\n\t\t\t}\n\t\t});\n\t}\n\n\t@publicExtension()\n\t@finalExtension()\n\tpublic isPageReady(): boolean {\n\t\treturn this._bIsPageReady;\n\t}\n\n\t@publicExtension()\n\t@finalExtension()\n\tpublic async waitPageReady(): Promise<void> {\n\t\treturn new Promise((resolve) => {\n\t\t\tif (this.isPageReady()) {\n\t\t\t\tresolve();\n\t\t\t} else {\n\t\t\t\tif (!this._oEventProvider) {\n\t\t\t\t\tthis._oEventProvider = new EventProvider();\n\t\t\t\t}\n\t\t\t\tthis.attachEventOnce(\n\t\t\t\t\t\"pageReady\",\n\t\t\t\t\tnull,\n\t\t\t\t\t() => {\n\t\t\t\t\t\tresolve();\n\t\t\t\t\t},\n\t\t\t\t\tthis\n\t\t\t\t);\n\t\t\t}\n\t\t});\n\t}\n\n\t@publicExtension()\n\t@finalExtension()\n\tpublic attachEventOnce(sEventId: string, oData: object | null, fnFunction?: Function, oListener?: object): EventProvider {\n\t\t// eslint-disable-next-line prefer-rest-params\n\t\treturn this._oEventProvider.attachEventOnce(sEventId, oData as object, fnFunction as Function, oListener);\n\t}\n\n\t@publicExtension()\n\t@finalExtension()\n\tpublic attachEvent(sEventId: string, oData: object | null, fnFunction: Function, oListener: object): EventProvider {\n\t\t// eslint-disable-next-line prefer-rest-params\n\t\treturn this._oEventProvider.attachEvent(sEventId, oData as object, fnFunction, oListener);\n\t}\n\n\t@publicExtension()\n\t@finalExtension()\n\tpublic detachEvent(sEventId: string, fnFunction: Function): EventProvider {\n\t\t// eslint-disable-next-line prefer-rest-params\n\t\treturn this._oEventProvider.detachEvent(sEventId, fnFunction);\n\t}\n\n\tprivate registerContainer(oContainer: Control): void {\n\t\tthis._oContainer = oContainer;\n\t\tthis._fnContainerDelegate = {\n\t\t\tonBeforeShow: (): void => {\n\t\t\t\tthis.bShown = false;\n\t\t\t\tthis._bIsPageReady = false;\n\t\t\t},\n\t\t\tonBeforeHide: (): void => {\n\t\t\t\tthis.bShown = false;\n\t\t\t\tthis._bIsPageReady = false;\n\t\t\t},\n\t\t\tonAfterShow: (): void => {\n\t\t\t\tthis.bShown = true;\n\t\t\t\tthis.onAfterBindingPromise?.then((): void => {\n\t\t\t\t\treturn this.checkPageReadyDebounced(true);\n\t\t\t\t});\n\t\t\t}\n\t\t};\n\t\tthis._oContainer?.addEventDelegate(this._fnContainerDelegate, this);\n\t}\n\n\t@privateExtension()\n\t@extensible(OverrideExecution.Instead)\n\tpublic isContextExpected(): boolean {\n\t\treturn false;\n\t}\n\n\t@publicExtension()\n\tpublic checkPageReadyDebounced(bFromNav = false): void {\n\t\tif (this.pageReadyTimer) {\n\t\t\tclearTimeout(this.pageReadyTimer);\n\t\t}\n\t\tconst model = this.getView().getModel() as ODataModel;\n\t\tlet timeOut: number;\n\t\t// isContextExpected = true when Object Page is displayed\n\t\tif ((model && model.getOptimisticBatchEnabler() === null) || this.isContextExpected()) {\n\t\t\ttimeOut = 200;\n\t\t} else {\n\t\t\t// We are waiting less time because data is already there (optimisticBatch)\n\t\t\ttimeOut = 20;\n\t\t}\n\t\tthis.pageReadyTimer = setTimeout(() => {\n\t\t\tthis._checkPageReady(bFromNav);\n\t\t}, timeOut) as unknown as number;\n\t}\n\n\tpublic _checkPageReady(bFromNav = false): void {\n\t\tconst fnUIUpdated = (): void => {\n\t\t\t// Wait until the UI is no longer dirty\n\t\t\tif (!Rendering.isPending()) {\n\t\t\t\t(Rendering as RenderingEx).detachUIUpdated(fnUIUpdated);\n\t\t\t\tthis._bWaitingForRefresh = false;\n\t\t\t\tthis.checkPageReadyDebounced();\n\t\t\t}\n\t\t};\n\n\t\t// In case UIUpdate does not get called, check if UI is not dirty and then call _checkPageReady\n\t\tconst checkUIUpdated = (): void => {\n\t\t\tif (Rendering.isPending()) {\n\t\t\t\tsetTimeout(checkUIUpdated, 500);\n\t\t\t} else if (this._bWaitingForRefresh) {\n\t\t\t\tthis._bWaitingForRefresh = false;\n\t\t\t\t(Rendering as RenderingEx).detachUIUpdated(fnUIUpdated);\n\t\t\t\tthis.checkPageReadyDebounced();\n\t\t\t}\n\t\t};\n\n\t\tif (\n\t\t\tthis.bShown &&\n\t\t\tthis.queryWatcher.isDataReceived() !== false &&\n\t\t\tthis.bTablesChartsLoaded !== false &&\n\t\t\t(!this.isContextExpected() || this.bHasContext) // Either no context is expected or there is one\n\t\t) {\n\t\t\tif (this.queryWatcher.isDataReceived() === true && !bFromNav && !this._bWaitingForRefresh && Rendering.isPending()) {\n\t\t\t\t// If we requested data we get notified as soon as the data arrived, so before the next rendering tick\n\t\t\t\tthis.queryWatcher.resetDataReceived();\n\t\t\t\tthis._bWaitingForRefresh = true;\n\t\t\t\t(Rendering as RenderingEx).attachUIUpdated(fnUIUpdated);\n\t\t\t\tsetTimeout(checkUIUpdated, 500);\n\t\t\t} else if (\n\t\t\t\t(!this._bWaitingForRefresh && Rendering.isPending()) ||\n\t\t\t\tthis._nbWaits !== 0 ||\n\t\t\t\tTemplatedViewServiceFactory.getNumberOfViewsInCreationState() > 0 ||\n\t\t\t\tthis.queryWatcher.isSearchPending()\n\t\t\t) {\n\t\t\t\tthis._bWaitingForRefresh = true;\n\t\t\t\t(Rendering as RenderingEx).attachUIUpdated(fnUIUpdated);\n\t\t\t\tsetTimeout(checkUIUpdated, 500);\n\t\t\t} else if (!this._bWaitingForRefresh) {\n\t\t\t\t// In the case we're not waiting for any data (navigating back to a page we already have loaded)\n\t\t\t\t// just wait for a frame to fire the event.\n\t\t\t\tthis._bIsPageReady = true;\n\t\t\t\tthis._oEventProvider.fireEvent(\"pageReady\");\n\t\t\t}\n\t\t}\n\t}\n\n\t/**\n\t * Forces the 'pageReady' event to be sent.\n\t */\n\tforcePageReady(): void {\n\t\tthis._oEventProvider.fireEvent(\"pageReady\");\n\t}\n}\n\nexport default PageReadyControllerExtension;\n"],"mappings":"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","ignoreList":[]}