{"version":3,"file":"CollaborationManager.js","names":["CollaborationManagerExtension","_dec","defineUI5Class","_dec2","methodOverride","_dec3","_dec4","_dec5","publicExtension","_dec6","extensible","_class","_class2","_ControllerExtension","_this","call","this","init","_exports","_inheritsLoose","_proto","prototype","onInit","asyncOnInit","async","feView","base","getView","appComponent","CommonUtils","getAppComponent","environmentCapabilities","getService","serviceEnabled","getCapabilities","InsightsSupported","isInsightsEnabled","apply","onAfterBinding","connect","getId","cards","collectAvailableCards","cardObject","updateCards","parentAppId","addCardsToCollaborationManager","reduce","acc","cur","card","id","onExit","unregisterProvider","getCollaborationManagerService","Promise","resolve","ControllerExtension","_applyDecoratedDescriptor","Object","getOwnPropertyDescriptor"],"sources":["./CollaborationManager.ts"],"sourcesContent":["import { defineUI5Class, extensible, methodOverride, publicExtension } from \"sap/fe/base/ClassSupport\";\nimport type AppComponent from \"sap/fe/core/AppComponent\";\nimport type { FEView } from \"sap/fe/core/BaseController\";\nimport CommonUtils from \"sap/fe/core/CommonUtils\";\nimport type PageController from \"sap/fe/core/PageController\";\nimport type { CollaborationManagerService, WrappedCard } from \"sap/fe/core/services/CollaborationManagerServiceFactory\";\nimport type { EnvironmentCapabilitiesService } from \"sap/fe/core/services/EnvironmentServiceFactory\";\nimport ControllerExtension from \"sap/ui/core/mvc/ControllerExtension\";\n\n/**\n * An implementation for controller extension used internally in sap.fe for central functionalities to serve collaboration manager use cases.\n * @since 1.120.0\n */\n@defineUI5Class(\"sap.fe.core.controllerextensions.cards.CollaborationManager\")\nexport default class CollaborationManagerExtension extends ControllerExtension {\n\tprotected base!: PageController;\n\n\tprotected feView!: FEView;\n\n\tprivate appComponent!: AppComponent;\n\n\tprivate serviceEnabled!: boolean;\n\n\tconstructor() {\n\t\tsuper();\n\t\t(this as unknown as { init: Function }).init();\n\t}\n\n\t@methodOverride()\n\tonInit(): void {\n\t\tconst asyncOnInit = async function (this: CollaborationManagerExtension): Promise<void> {\n\t\t\tthis.feView = this.base.getView();\n\t\t\tthis.appComponent = CommonUtils.getAppComponent(this.feView);\n\t\t\tconst environmentCapabilities = (await this.appComponent.getService(\n\t\t\t\t\"environmentCapabilities\"\n\t\t\t)) as EnvironmentCapabilitiesService;\n\n\t\t\tthis.serviceEnabled = true;\n\t\t\t// Only connect to the Collaboration Manager if it is explicitly enabled and the sap.insights library is loaded\n\t\t\tif (\n\t\t\t\t!this.appComponent[\"isCollaborationManagerServiceEnabled\"]() ||\n\t\t\t\t!environmentCapabilities.getCapabilities().InsightsSupported ||\n\t\t\t\t!(await environmentCapabilities.isInsightsEnabled())\n\t\t\t) {\n\t\t\t\tthis.serviceEnabled = false;\n\t\t\t}\n\t\t};\n\t\tasyncOnInit.apply(this);\n\t}\n\n\t@methodOverride(\"_routing\")\n\tasync onAfterBinding(): Promise<void> {\n\t\tif (this.serviceEnabled === false) {\n\t\t\treturn;\n\t\t}\n\t\tawait this.getService().connect(this.appComponent.getId(), async () => {\n\t\t\tconst cards: WrappedCard[] = [];\n\t\t\tawait this.collectAvailableCards(cards);\n\t\t\tconst cardObject = this.updateCards(cards);\n\t\t\tconst parentAppId = this.appComponent.getId();\n\t\t\tthis.getService().addCardsToCollaborationManager(cardObject, parentAppId, this.base.getView().getId());\n\t\t});\n\t}\n\n\tupdateCards(cards: WrappedCard[]): Record<string, WrappedCard> {\n\t\treturn cards.reduce(\n\t\t\t(acc, cur) => {\n\t\t\t\tif (cur?.card[\"sap.app\"]?.id) {\n\t\t\t\t\tacc[cur?.card[\"sap.app\"]?.id] = cur;\n\t\t\t\t}\n\t\t\t\treturn acc;\n\t\t\t},\n\t\t\t{} as Record<string, WrappedCard>\n\t\t);\n\t}\n\n\t/**\n\t * Automatic unregistering on exit of the application.\n\t *\n\t */\n\t@methodOverride()\n\tonExit(): void {\n\t\tthis.getService().unregisterProvider();\n\t}\n\n\tgetService(): CollaborationManagerService {\n\t\treturn this.appComponent.getCollaborationManagerService();\n\t}\n\n\t@publicExtension()\n\t@extensible(\"AfterAsync\")\n\t// eslint-disable-next-line @typescript-eslint/no-unused-vars\n\tasync collectAvailableCards(cards: WrappedCard[]): Promise<void> {\n\t\treturn Promise.resolve();\n\t}\n}\n"],"mappings":";;;;k3BASA,IAKqBA,GAA6BC,EADjDC,EAAe,+DAA8DC,EAe5EC,IAAgBC,EAsBhBD,EAAe,YAAWE,EA8B1BF,IAAgBG,EAShBC,IAAiBC,EACjBC,EAAW,cAAaT,EAAAU,GAAAC,EAAA,SAAAC,GAnEzB,SAAAb,IAAc,IAAAc,EACbA,EAAAD,EAAAE,KAAAC,OAAOA,KACPF,EAAwCG,OAAO,OAAAH,CAChD,CAACI,EAAAlB,EAAAmB,EAAAnB,EAAAa,GAAA,IAAAO,EAAApB,EAAAqB,UAAAD,EAGDE,OADA,SACAA,IACC,MAAMC,EAAcC,iBACnBR,KAAKS,OAAST,KAAKU,KAAKC,UACxBX,KAAKY,aAAeC,EAAYC,gBAAgBd,KAAKS,QACrD,MAAMM,QAAiCf,KAAKY,aAAaI,WACxD,2BAGDhB,KAAKiB,eAAiB,KAEtB,IACEjB,KAAKY,aAAa,4CAClBG,EAAwBG,kBAAkBC,0BACnCJ,EAAwBK,oBAC/B,CACDpB,KAAKiB,eAAiB,KACvB,CACD,EACAV,EAAYc,MAAMrB,KACnB,EAACI,EAGKkB,eADNd,eACMc,IACL,GAAItB,KAAKiB,iBAAmB,MAAO,CAClC,MACD,OACMjB,KAAKgB,aAAaO,QAAQvB,KAAKY,aAAaY,QAAShB,UAC1D,MAAMiB,EAAuB,SACvBzB,KAAK0B,sBAAsBD,GACjC,MAAME,EAAa3B,KAAK4B,YAAYH,GACpC,MAAMI,EAAc7B,KAAKY,aAAaY,QACtCxB,KAAKgB,aAAac,+BAA+BH,EAAYE,EAAa7B,KAAKU,KAAKC,UAAUa,UAEhG,EAACpB,EAEDwB,YAAA,SAAAA,EAAYH,GACX,OAAOA,EAAMM,OACZ,CAACC,EAAKC,KACL,GAAIA,GAAKC,KAAK,YAAYC,GAAI,CAC7BH,EAAIC,GAAKC,KAAK,YAAYC,IAAMF,CACjC,CACA,OAAOD,GAER,CAAC,EAEH,EAEA5B,EAKAgC,OADA,SACAA,IACCpC,KAAKgB,aAAaqB,oBACnB,EAACjC,EAEDY,WAAA,SAAAA,IACC,OAAOhB,KAAKY,aAAa0B,gCAC1B,EAAClC,EAKKsB,sBAHNlB,eAGMkB,EAAsBD,GAC3B,OAAOc,QAAQC,SAChB,EAAC,OAAAxD,CAAA,CAJwB,CA5EiCyD,GAAmBC,EAAA9C,EAAAS,UAAA,UAAAlB,GAAAwD,OAAAC,yBAAAhD,EAAAS,UAAA,UAAAT,EAAAS,WAAAqC,EAAA9C,EAAAS,UAAA,kBAAAhB,GAAAsD,OAAAC,yBAAAhD,EAAAS,UAAA,kBAAAT,EAAAS,WAAAqC,EAAA9C,EAAAS,UAAA,UAAAf,GAAAqD,OAAAC,yBAAAhD,EAAAS,UAAA,UAAAT,EAAAS,WAAAqC,EAAA9C,EAAAS,UAAA,yBAAAd,EAAAE,GAAAkD,OAAAC,yBAAAhD,EAAAS,UAAA,yBAAAT,EAAAS,WAAAT,KAAAD,GAAAO,EAAAlB,EAAA,OAAAkB,CAAA","ignoreList":[]}