{"version":3,"names":["CollaborationManagerExtension","_dec","defineUI5Class","_dec2","methodOverride","_dec3","_dec4","_dec5","publicExtension","_dec6","extensible","_class","_class2","_ControllerExtension","_this","call","init","_exports","_inheritsLoose","_proto","prototype","onInit","asyncOnInit","feView","base","getView","appComponent","CommonUtils","getAppComponent","environmentCapabilities","getService","serviceEnabled","getCapabilities","InsightsSupported","isInsightsEnabled","apply","onAfterBinding","connect","getId","cards","collectAvailableCards","cardObject","updateCards","parentAppId","addCardsToCollaborationManager","reduce","acc","cur","card","id","onExit","unregisterProvider","getCollaborationManagerService","Promise","resolve","ControllerExtension","_applyDecoratedDescriptor","Object","getOwnPropertyDescriptor"],"sourceRoot":".","sources":["CollaborationManager.ts"],"sourcesContent":["import { defineUI5Class, extensible, methodOverride, publicExtension } from \"sap/fe/base/ClassSupport\";\nimport type AppComponent from \"sap/fe/core/AppComponent\";\nimport type { FEView } from \"sap/fe/core/BaseController\";\nimport CommonUtils from \"sap/fe/core/CommonUtils\";\nimport type PageController from \"sap/fe/core/PageController\";\nimport type { CollaborationManagerService, WrappedCard } from \"sap/fe/core/services/CollaborationManagerServiceFactory\";\nimport type { EnvironmentCapabilitiesService } from \"sap/fe/core/services/EnvironmentServiceFactory\";\nimport ControllerExtension from \"sap/ui/core/mvc/ControllerExtension\";\n\n/**\n * An implementation for controller extension used internally in sap.fe for central functionalities to serve collaboration manager use cases.\n * @since 1.120.0\n */\n@defineUI5Class(\"sap.fe.core.controllerextensions.cards.CollaborationManager\")\nexport default class CollaborationManagerExtension extends ControllerExtension {\n\tprotected base!: PageController;\n\n\tprotected feView!: FEView;\n\n\tprivate appComponent!: AppComponent;\n\n\tprivate serviceEnabled!: boolean;\n\n\tconstructor() {\n\t\tsuper();\n\t\t(this as unknown as { init: Function }).init();\n\t}\n\n\t@methodOverride()\n\tonInit(): void {\n\t\tconst asyncOnInit = async function (this: CollaborationManagerExtension): Promise<void> {\n\t\t\tthis.feView = this.base.getView();\n\t\t\tthis.appComponent = CommonUtils.getAppComponent(this.feView);\n\t\t\tconst environmentCapabilities = (await this.appComponent.getService(\n\t\t\t\t\"environmentCapabilities\"\n\t\t\t)) as EnvironmentCapabilitiesService;\n\n\t\t\tthis.serviceEnabled = true;\n\t\t\t// Only connect to the Collaboration Manager if it is explicitly enabled and the sap.insights library is loaded\n\t\t\tif (\n\t\t\t\t!this.appComponent[\"isCollaborationManagerServiceEnabled\"]() ||\n\t\t\t\t!environmentCapabilities.getCapabilities().InsightsSupported ||\n\t\t\t\t!(await environmentCapabilities.isInsightsEnabled())\n\t\t\t) {\n\t\t\t\tthis.serviceEnabled = false;\n\t\t\t}\n\t\t};\n\t\tasyncOnInit.apply(this);\n\t}\n\n\t@methodOverride(\"_routing\")\n\tasync onAfterBinding(): Promise<void> {\n\t\tif (this.serviceEnabled === false) {\n\t\t\treturn;\n\t\t}\n\t\tawait this.getService().connect(this.appComponent.getId(), async () => {\n\t\t\tconst cards: WrappedCard[] = [];\n\t\t\tawait this.collectAvailableCards(cards);\n\t\t\tconst cardObject = this.updateCards(cards);\n\t\t\tconst parentAppId = this.appComponent.getId();\n\t\t\tthis.getService().addCardsToCollaborationManager(cardObject, parentAppId, this.base.getView().getId());\n\t\t});\n\t}\n\n\tupdateCards(cards: WrappedCard[]): Record<string, WrappedCard> {\n\t\treturn cards.reduce(\n\t\t\t(acc, cur) => {\n\t\t\t\tif (cur?.card[\"sap.app\"]?.id) {\n\t\t\t\t\tacc[cur?.card[\"sap.app\"]?.id] = cur;\n\t\t\t\t}\n\t\t\t\treturn acc;\n\t\t\t},\n\t\t\t{} as Record<string, WrappedCard>\n\t\t);\n\t}\n\n\t/**\n\t * Automatic unregistering on exit of the application.\n\t *\n\t */\n\t@methodOverride()\n\tonExit(): void {\n\t\tthis.getService().unregisterProvider();\n\t}\n\n\tgetService(): CollaborationManagerService {\n\t\treturn this.appComponent.getCollaborationManagerService();\n\t}\n\n\t@publicExtension()\n\t@extensible(\"AfterAsync\")\n\t// eslint-disable-next-line @typescript-eslint/no-unused-vars\n\tasync collectAvailableCards(cards: WrappedCard[]): Promise<void> {\n\t\treturn Promise.resolve();\n\t}\n}\n"],"mappings":"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","ignoreList":[],"file":"CollaborationManager-dbg.js"}