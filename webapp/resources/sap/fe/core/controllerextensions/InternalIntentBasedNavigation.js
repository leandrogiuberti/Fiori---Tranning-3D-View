/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)
 *      (c) Copyright 2009-2025 SAP SE. All rights reserved
 */
sap.ui.define(["sap/base/Log","sap/base/util/merge","sap/fe/base/ClassSupport","sap/fe/core/CommonUtils","sap/fe/core/controllerextensions/editFlow/NotApplicableContextDialog","sap/fe/core/controllerextensions/editFlow/draft","sap/fe/core/converters/MetaModelConverter","sap/fe/core/helpers/FPMHelper","sap/fe/core/helpers/KeepAliveHelper","sap/fe/core/helpers/KeepAliveRefreshTypes","sap/fe/core/helpers/ModelHelper","sap/fe/core/helpers/ResourceModelHelper","sap/fe/navigation/SelectionVariant","sap/ui/core/Element","sap/ui/core/Lib","sap/ui/core/mvc/ControllerExtension","sap/ui/core/mvc/OverrideExecution","../converters/helpers/Aggregation"],function(t,e,o,n,i,a,r,s,c,p,l,g,u,f,d,v,y,h){"use strict";var b,m,O,P,C,A,S,M,x,N,j,_,w,E,D,F,$,I,V,R,T,B,k,W,H;var L=h.AggregationHelper;var z=g.getResourceModel;var U=p.RefreshStrategyType;var J=r.convertTypes;var q=o.publicExtension;var G=o.privateExtension;var K=o.methodOverride;var Q=o.finalExtension;var X=o.extensible;var Y=o.defineUI5Class;function Z(t,e){t.prototype=Object.create(e.prototype),t.prototype.constructor=t,tt(t,e)}function tt(t,e){return tt=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},tt(t,e)}function et(t,e,o,n,i){var a={};return Object.keys(n).forEach(function(t){a[t]=n[t]}),a.enumerable=!!a.enumerable,a.configurable=!!a.configurable,("value"in a||a.initializer)&&(a.writable=!0),a=o.slice().reverse().reduce(function(o,n){return n(t,e,o)||o},a),i&&void 0!==a.initializer&&(a.value=a.initializer?a.initializer.call(i):void 0,a.initializer=void 0),void 0===a.initializer?(Object.defineProperty(t,e,a),null):a}let ot=(b=Y("sap.fe.core.controllerextensions.InternalInternalBasedNavigation"),m=K(),O=q(),P=Q(),C=q(),A=Q(),S=q(),M=X(y.Instead),x=q(),N=Q(),j=G(),_=q(),w=Q(),E=q(),D=Q(),F=q(),$=Q(),I=q(),V=Q(),R=q(),T=Q(),B=q(),k=Q(),b(W=(H=function(o){function p(){return o.call(this)||this}Z(p,o);var g=p.prototype;g.onInit=function t(){this._oAppComponent=this.base.getAppComponent();this._oMetaModel=this._oAppComponent.getModel().getMetaModel();this._oNavigationService=this._oAppComponent.getNavigationService();this._oView=this.base.getView()};g.navigate=function t(o,n,i,r){try{if(this.navigationAlreadyStarted!==true){this.navigationAlreadyStarted=true;const t=()=>{const t=i&&i.navigationContexts;const a=t&&!Array.isArray(t)?[t]:t;const r=i&&i.semanticObjectMapping,s=i&&i.additionalNavigationParameters,p={semanticObject:o,action:n},l=this.base.getView(),g=l.getController();if(o&&n){let t=[],f=new u;if(a&&a.length){a.forEach(e=>{const o=e;const n=e;if(o.isA&&o.isA("sap.ui.model.odata.v4.Context")){let e=o.getObject();const n=this._oMetaModel.getMetaPath(o.getPath());const i=this.processSemanticAttributes(o,e);e=this.removeSensitiveData(i,n);const a=this.prepareContextForExternalNavigation(i,o);p["propertiesWithoutConflict"]=a.propertiesWithoutConflict;t.push(a.semanticAttributes)}else if(n&&!(n&&Array.isArray(n.data))&&typeof e==="object"){t.push(this.removeSensitiveData(n.data,n.metaPath))}else if(n&&Array.isArray(n.data)){t=this.removeSensitiveData(n.data,n.metaPath)}})}if(t&&t.length){f=this._oNavigationService.mixAttributesAndSelectionVariant(t,f.toJSONString())}const v=this._oView.getModel(),y=this.getEntitySet(),h=y?this._oNavigationService.constructContextUrl(y,v):undefined;if(h){f.setFilterContextUrl(h)}if(s){this._applyOutboundParams(f,s)}g.intentBasedNavigation.adaptNavigationContext(f,p);if(r){this._applySemanticObjectMappings(f,r)}this._removeTechnicalParameters(f);let b=g._intentBasedNavigation.getNavigationMode();const m=i&&i.refreshStrategies||{},O=l.getModel("internal");if(O){if((l&&l.getViewData()).refreshStrategyOnAppRestore){const t=l.getViewData().refreshStrategyOnAppRestore||{};e(m,t)}const t=c.getRefreshStrategyForIntent(m,o,n);if(t){O.setProperty("/refreshStrategyOnAppRestore",t)}}b=i?.navMode?i?.navMode:b;const P=function(){sap.ui.require(["sap/m/MessageBox"],function(t){const e=d.getResourceBundleFor("sap.fe.core");t.error(e.getText("C_COMMON_HELPER_NAVIGATION_ERROR_MESSAGE"),{title:e.getText("C_COMMON_SAPFE_ERROR")})})};this._oNavigationService.navigate(o,n,f.toJSONString(),undefined,P,undefined,b)}else{throw new Error("Semantic Object/action is not provided")}};if(r?.data("debounce"))return;r?.data("debounce",true);const s=this.base.getView().getBindingContext();const p=s&&s.getModel().getMetaModel();if(this.base.getView().getViewData().converterType==="ObjectPage"&&p&&!l.isStickySessionSupported(p)&&!(i?.navMode==="explace")){a.processDataLossOrDraftDiscardConfirmation(t.bind(this),Function.prototype,this.base.getView().getBindingContext(),this.base.getView().getController(),false,a.NavigationType.ForwardNavigation)}else{t()}r?.data("debounce",false)}}finally{this.navigationAlreadyStarted=false}};g.prepareContextForExternalNavigation=function t(e,o){const n={},i=o.getPath(),a=o.getModel().getMetaModel(),r=a.getMetaPath(i),s=r.split("/").filter(Boolean);function c(t,e){for(const o in t){if(t[o]===null||typeof t[o]!=="object"){if(!n[o]){n[o]=[]}n[o].push(e)}else{const n=t[o];c(n,`${e}/${o}`)}}}c(e,r);const p=s[0],l=a.getObject(`/${p}/@sapui.name`),g={};let u,f,d;const v=Object.keys(o.getObject())||[];const y=v.filter(t=>!Object.keys(e).includes(t));for(const t in n){if(y.includes(t)){continue}const i=n[t];let s;if(i.length>1){for(let n=0;n<=i.length-1;n++){const s=i[n];let c=s.replace(s===r?r:`${r}/`,"");c=(c===""?c:`${c}/`)+t;const p=a.getObject(`${s}/@sapui.name`);if(p===l){u=c}if(s===r){f=c}d=c;e[`${r}/${c}`.split("/").filter(function(t){return t!=""}).join(".")]=o.getProperty(c)}s=u||f||d;e[t]=o.getProperty(s);u=undefined;f=undefined;d=undefined}else{const n=i[0];let a=n.replace(n===r?r:`${r}/`,"");a=(a===""?a:`${a}/`)+t;e[t]=o.getProperty(a);g[t]=`${r}/${a}`.split("/").filter(function(t){return t!=""}).join(".")}}for(const t in e){if(e[t]!==null&&typeof e[t]==="object"){delete e[t]}}return{semanticAttributes:e,propertiesWithoutConflict:g}};g.getNavigationMode=function t(){return undefined};g.navigateWithConfirmationDialog=async function t(e,o,n,a){let r=true;if(a?.data("debounce"))return;a?.data("debounce",true);if(n?.notApplicableContexts&&n.notApplicableContexts?.length>=1){const t=this.base.getView().getModel().getMetaModel();const e=t.getMetaPath(n.notApplicableContexts[0].getPath());const a=J(t);const s=a.resolvePath(e).target;const c=new i({title:"",entityType:s.entityType,resourceModel:z(this.getView()),notApplicableContexts:n.notApplicableContexts,applicableContexts:n?.applicableContexts??[],entitySet:s.name,actionName:o});n.navigationContexts=n.applicableContexts;r=await c.open(this.getView())}if(r){this.navigate(e,o,n)}a?.data("debounce",false)};g._removeTechnicalParameters=function t(e){e.removeSelectOption("@odata.context");e.removeSelectOption("@odata.metadataEtag");e.removeSelectOption("SAP__Messages")};g.getEntitySet=function t(){return this._oView.getViewData().entitySet};g.removeSensitiveData=function t(e,o,n){if(e){const{transAggregations:t,customAggregates:i}=this._getAggregates(o,this.base.getView(),this.base.getAppComponent().getDiagnostics());const a=Object.keys(e);if(!Array.isArray(e)&&a.length){delete e["@odata.context"];delete e["@odata.metadataEtag"];delete e["SAP__Messages"];for(const r of a){if(e[r]&&typeof e[r]==="object"){this.removeSensitiveData(e[r],`${o}/${r}`,n)}if(r.includes("@odata.type")){delete e[r];continue}this._deleteAggregates([...t,...i],r,e);const a=this._getPropertyAnnotations(r,o,e,n||this._oMetaModel);if(a){if(a.PersonalData?.IsPotentiallySensitive||a.UI?.ExcludeFromNavigationContext||a.Analytics?.Measure){delete e[r]}else if(a.Common?.FieldControl){const t=a.Common.FieldControl;if(t["$EnumMember"]&&t["$EnumMember"].split("/")[1]==="Inapplicable"||t["$Path"]&&this._isFieldControlPathInapplicable(t["$Path"],e)){delete e[r]}}}}}}return e};g._deleteAggregates=function t(e,o,n){if(e&&e.includes(o)){delete n[o]}};g._getPropertyAnnotations=function t(e,o,n,i){if(n[e]&&o&&!o.includes("undefined")){const t=i.createBindingContext(`${o}/${e}`);const n=r.getInvolvedDataModelObjects(t);return n?.targetObject?.annotations}return null};g._getAggregates=function t(e,o,n){const i=this._getConverterContext(e,o,n);const a=new L(i.getEntityType(),i);const r=a.isAnalyticsSupported();let s,c;if(r){const t=a.getTransAggregations();if(t?.length){s=t.map(t=>t.Name||t.Value)}c=a.getCustomAggregateDefinitions();if(c?.length){c=c.map(t=>t.qualifier)}}s??=[];c=c?c:[];return{transAggregations:s,customAggregates:c}};g._getConverterContext=function t(e,o,i){const a=o.getViewData();let r=a.entitySet;const s=a.contextPath;if(s&&(!r||r.includes("/"))){r=a?.fullContextPath.split("/")[1]}return n.getConverterContextForPath(e,o.getModel().getMetaModel(),r,i)};g._isFieldControlPathInapplicable=function t(e,o){let n=false;const i=e.split("/");if(i.length>1){n=!!(o[i[0]]&&o[i[0]].hasOwnProperty(i[1])&&o[i[0]][i[1]]===0)}else{n=o[e]===0}return n};g._applySemanticObjectMappings=function t(e,o){const n=typeof o==="string"?JSON.parse(o):o;for(const t of n){const o=t["LocalProperty"]&&t["LocalProperty"]["$PropertyPath"]||t["@com.sap.vocabularies.Common.v1.LocalProperty"]&&t["@com.sap.vocabularies.Common.v1.LocalProperty"]["$Path"];const n=t["SemanticObjectProperty"]||t["@com.sap.vocabularies.Common.v1.SemanticObjectProperty"];const i=e.getSelectOption(o);if(i&&o!==n){e.removeSelectOption(n);e.renameSelectOption(o,n)}}return e};g.storeFocusInfoInHistory=function t(){let e=null;const o=f.getActiveElement();const n=o?.getId();const i=o&&s.getMdcTable(o);if(o?.isA("sap.m.Button")){e={type:"Control",controlId:n}}else if(i){e={type:"Row",tableId:i.getId(),contextPathFocus:o.getBindingContext()?.getPath()}}history.replaceState(Object.assign({},history.state,{focusInfo:e}),"")};g.navigateOutbound=function e(o,n){this.storeFocusInfoInHistory();let i;const a=this.base.getAppComponent().getManifestEntry("sap.app"),r=a.crossNavigation?.outbounds?.[o];if(!r){t.error("Outbound is not defined in manifest!!");return}const s=r.semanticObject,c=r.action,p=r.parameters&&this.getOutboundParams(r.parameters);if(n){i=[];Object.keys(n).forEach(function(t){let e;const o=n[t];if(Array.isArray(o)){for(const n of o){e={};e[t]=n;i?.push(e)}}else{e={};e[t]=o;i?.push(e)}})}if(i||p){n={navigationContexts:{data:i||p}}}this.base._intentBasedNavigation.navigate(s,c,n)};g._applyOutboundParams=function t(e,o){const n=Object.keys(o);const i=e.getSelectOptionsPropertyNames();n.forEach(function(t){if(!i.includes(t)){e.addSelectOption(t,"I","EQ",o[t])}});return e};g.getOutboundParams=function t(e){const o={};if(e){const t=Object.keys(e)||[];if(t.length>0){t.forEach(function(t){const n=e[t];if(n.value&&n.value.value&&n.value.format==="plain"){if(!o[t]){o[t]=n.value.value}}})}}return o};g.onChevronPressNavigateOutBound=async function t(e,o,n,i,a){const r=e.getAppComponent().getRoutingService().getOutbounds();const s=r[o];let c;if(s&&s.semanticObject&&s.action){const t={intents:{}};const o={};let r;let p=[];if(n){if(Array.isArray(n)){p=n;r=l.getMetaPathForContext(n[0])}else if(n.isA&&n.isA("sap.ui.model.odata.v4.Context")){r=l.getMetaPathForContext(n);p=[n]}o[r]=U.Self;t._feDefault=o}if(i){const e=`${s.semanticObject}-${s.action}`;t.intents[e]={};t.intents[e][i]=U.Self}if(s&&s.parameters){const t=s.parameters&&this.getOutboundParams(s.parameters);if(Object.keys(t).length>0){c=t}}e._intentBasedNavigation.navigate(s.semanticObject,s.action,{navigationContexts:p,refreshStrategies:t,additionalNavigationParameters:c,navMode:a});return Promise.resolve()}else{throw new Error(`outbound target ${o} not found in cross navigation definition of manifest`)}};g.processSemanticAttributes=function t(e,o,n){const i=this.keepNavigationPropertiesForNavigation();if(!i){return this.getSemanticAttributesWithoutNavigationProperties(e,n)}else{return o}};g.keepNavigationPropertiesForNavigation=function t(){let e=false;const o=this.base.getAppComponent().getManifestEntry("sap.fe");e=o?.app?.considerNavigationPropertiesForExternalNavigation||false;return e};g.getSemanticAttributesWithoutNavigationProperties=function t(e,o){const n=e.getModel().getMetaModel(),i=e.getPath(),a=n.getMetaPath(i),r=e.getObject();const s=this.getNavigationPropertiesFromEntityType(n,a);if(s&&s.length>0){s.forEach(t=>{const e=t.name;if(Array.isArray(o)&&o.length>0){if(r.hasOwnProperty(e)&&r[e]){Object.keys(r[e]).forEach(function(t){const n=`${e}/${t}`;if(!o?.includes(n)&&r[e].hasOwnProperty(t)){delete r[e][t];if(Object.keys(r[e]).length===0){delete r[e]}}})}else{delete r[e]}}else if(r.hasOwnProperty(e)){delete r[e]}})}return r};g.getNavigationPropertiesFromEntityType=function t(e,o){const n=J(e);const i=n.resolvePath(`${o}/`).target;return i?.navigationProperties};return p}(v),et(H.prototype,"onInit",[m],Object.getOwnPropertyDescriptor(H.prototype,"onInit"),H.prototype),et(H.prototype,"navigate",[O,P],Object.getOwnPropertyDescriptor(H.prototype,"navigate"),H.prototype),et(H.prototype,"prepareContextForExternalNavigation",[C,A],Object.getOwnPropertyDescriptor(H.prototype,"prepareContextForExternalNavigation"),H.prototype),et(H.prototype,"getNavigationMode",[S,M],Object.getOwnPropertyDescriptor(H.prototype,"getNavigationMode"),H.prototype),et(H.prototype,"navigateWithConfirmationDialog",[x,N],Object.getOwnPropertyDescriptor(H.prototype,"navigateWithConfirmationDialog"),H.prototype),et(H.prototype,"getEntitySet",[j],Object.getOwnPropertyDescriptor(H.prototype,"getEntitySet"),H.prototype),et(H.prototype,"removeSensitiveData",[_,w],Object.getOwnPropertyDescriptor(H.prototype,"removeSensitiveData"),H.prototype),et(H.prototype,"navigateOutbound",[E,D],Object.getOwnPropertyDescriptor(H.prototype,"navigateOutbound"),H.prototype),et(H.prototype,"getOutboundParams",[F,$],Object.getOwnPropertyDescriptor(H.prototype,"getOutboundParams"),H.prototype),et(H.prototype,"onChevronPressNavigateOutBound",[I,V],Object.getOwnPropertyDescriptor(H.prototype,"onChevronPressNavigateOutBound"),H.prototype),et(H.prototype,"keepNavigationPropertiesForNavigation",[R,T],Object.getOwnPropertyDescriptor(H.prototype,"keepNavigationPropertiesForNavigation"),H.prototype),et(H.prototype,"getSemanticAttributesWithoutNavigationProperties",[B,k],Object.getOwnPropertyDescriptor(H.prototype,"getSemanticAttributesWithoutNavigationProperties"),H.prototype),H))||W);return ot},false);
//# sourceMappingURL=InternalIntentBasedNavigation.js.map