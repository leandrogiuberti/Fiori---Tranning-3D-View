{"version":3,"names":["MessageTypeFromCriticality","MessageType","Error","Warning","Success","Information","ValueColorFromMessageType","None","messageTypeFromTargetCalculation","kpiValue","aThresholds","criticalityProperty","undefined","messageTypeFromMinimizeCalculation","messageTypeFromMaximizeCalculation","deviationIndicatorFromTrendType","trendValue","deviationIndicator","deviationIndicatorFromCalculation","referenceValue","isRelative","compValue","createFilterFromDefinition","filterDefinition","ranges","length","Filter","propertyPath","operator","rangeLow","rangeHigh","aRangeFilters","map","range","filters","and","getFilterStringFromDefinition","currentLocale","Locale","Localization","getLanguage","resBundle","Library","getResourceBundleFor","dateFormat","DateFormat","getDateInstance","style","formatRange","valueLow","propertyType","indexOf","format","Date","valueHigh","getText","join","formatChartTitle","kpiDef","formatList","items","label","res","I","chart","title","measures","dimensions","updateChartLabelSettings","chartDefinition","oChartProperties","chartType","categoryAxis","visible","valueAxis","formatString","plotArea","dataLabel","type","valueAxis2","legendGroup","layout","position","alignment","sizeLegend","filterMap","aObjects","aRoles","filter","dimension","includes","role","getScatterBubbleChartFeeds","axis1Measures","axis2Measures","axis3Measures","otherMeasures","seriesDimensions","shapeDimension","find","xMeasure","shift","yMeasure","uid","values","sizeMeasure","push","getChartFeeds","getNavigationParameters","navInfo","oShellService","semanticObject","action","getLinks","then","aLinks","getPrimaryIntent","oLink","oInfo","parseShellHash","intent","unavailableActions","outboundNavigation","Promise","resolve","outbound","KPIManagementControllerExtension","_dec","defineUI5Class","_dec2","methodOverride","_dec3","_class","_class2","_ControllerExtension","call","_inheritsLoose","_proto","prototype","initCardManifest","kpiDefinition","oKPIModel","oCardManifest","id","technology","data","json","header","datapoint","subTitle","description","unitOfMeasurement","mainIndicator","number","unit","state","trend","content","minHeight","chartProperties","path","targetPath","targetValue","sideIndicators","selectionVariantFilterDefinitions","aDescriptions","forEach","desc","details","text","value","name","measure","feeds","setProperty","manifest","initNavigationInfo","navigation","oNavInfo","parameters","onInit","aKPIDefinitions","getView","getController","_getPageModel","getProperty","oView","oAppComponent","getAppComponent","JSONModel","setModel","getShellServices","catch","err","Log","error","loadKPITagData","getModel","onExit","destroy","updateDatapointValueAndCurrency","kpiContext","rawUnit","isPath","isPercentage","isCurrency","rawValue","Number","parseFloat","NumberFormat","getFloatInstance","minFractionDigits","maxFractionDigits","numberOfFractionalDigits","showScale","kpiValueUnscaled","groupingEnabled","kpiValueNoScale","kpiValueScale","decimals","maxIntegerDigits","kpiUnit","getUnitInstance","showNumber","updateDatapointCriticality","criticalityValue","criticalityPath","criticalityCalculationThresholds","criticalityCalculationMode","updateDatapointTrend","trendPath","trendCalculationReferenceValue","trendCalculationReferencePath","trendReferenceValue","trendCalculationIsRelative","trendCalculationTresholds","updateTargetValue","targetRawValue","deviationRawValue","targetScale","deviationValue","oMainModel","loadFull","oListBinding","bindList","contextPath","$$groupId","oAggregate","setAggregation","aggregate","aFilters","requestContexts","aContexts","loadKPICardData","oGroup","additionally","group","sortOrder","sort","sortInfo","Sorter","descending","allContexts","maxItems","chartData","oContext","oData","textArrangement","valueFormatters","formatWithBrackets","getPopover","oKPITag","_this","oPopover","reject","load","sap","ui","require","_len","arguments","params","Array","_key","CardClass","Host","oHost","attachAction","oEvent","sType","getParameter","oParams","base","_intentBasedNavigation","navigate","navigateOutbound","oCard","width","height","setHost","Popover","showHeader","placement","addDependent","onKPIPressed","kpiID","oDef","oModel","popover","setModal","setManifest","setPreviewMode","openBy","promises","all","attachEventOnce","getFocusDomRef","focus","refresh","ControllerExtension","_applyDecoratedDescriptor","Object","getOwnPropertyDescriptor"],"sourceRoot":".","sources":["KPIManagement.ts"],"sourcesContent":["import Log from \"sap/base/Log\";\nimport Localization from \"sap/base/i18n/Localization\";\nimport { defineUI5Class, methodOverride } from \"sap/fe/base/ClassSupport\";\nimport type BaseController from \"sap/fe/core/BaseController\";\nimport type PageController from \"sap/fe/core/PageController\";\nimport type {\n\tAnalyticalKPIDefinition,\n\tKPIChartDefinition,\n\tKPIDefinition,\n\tNavigationInfo\n} from \"sap/fe/core/converters/controls/Common/KPI\";\nimport type { FilterDefinition, RangeDefinition } from \"sap/fe/core/converters/helpers/SelectionVariantHelper\";\nimport valueFormatters from \"sap/fe/core/formatters/ValueFormatter\";\nimport type { IShellServices } from \"sap/fe/core/services/ShellServicesFactory\";\nimport type GenericTag from \"sap/m/GenericTag\";\nimport Popover from \"sap/m/Popover\";\nimport type Control from \"sap/ui/core/Control\";\nimport Library from \"sap/ui/core/Lib\";\nimport Locale from \"sap/ui/core/Locale\";\nimport DateFormat from \"sap/ui/core/format/DateFormat\";\nimport NumberFormat from \"sap/ui/core/format/NumberFormat\";\nimport MessageType from \"sap/ui/core/message/MessageType\";\nimport ControllerExtension from \"sap/ui/core/mvc/ControllerExtension\";\nimport type HostType from \"sap/ui/integration/Host\";\nimport type { Host$ActionEvent } from \"sap/ui/integration/Host\";\nimport type { default as Card, CardManifest, default as CardType, ChartCardContent } from \"sap/ui/integration/widgets/Card\";\nimport Filter from \"sap/ui/model/Filter\";\nimport type FilterOperator from \"sap/ui/model/FilterOperator\";\nimport Sorter from \"sap/ui/model/Sorter\";\nimport JSONModel from \"sap/ui/model/json/JSONModel\";\nimport type Context from \"sap/ui/model/odata/v4/Context\";\nimport type ODataModel from \"sap/ui/model/odata/v4/ODataModel\";\n\nconst MessageTypeFromCriticality: Record<string, MessageType> = {\n\t\"1\": MessageType.Error,\n\t\"2\": MessageType.Warning,\n\t\"3\": MessageType.Success,\n\t\"5\": MessageType.Information\n};\n\nconst ValueColorFromMessageType: Record<MessageType, string> = {\n\tError: \"Error\",\n\tWarning: \"Critical\",\n\tSuccess: \"Good\",\n\tInformation: \"None\",\n\tNone: \"None\"\n};\n\n/**\n * Function to get a message state from a calculated criticality of type 'Target'.\n * @param kpiValue The value of the KPI to be tested against.\n * @param aThresholds Thresholds to be used [DeviationRangeLowValue,ToleranceRangeLowValue,AcceptanceRangeLowValue,AcceptanceRangeHighValue,ToleranceRangeHighValue,DeviationRangeHighValue].\n * @returns The corresponding MessageType\n */\nfunction messageTypeFromTargetCalculation(kpiValue: number, aThresholds: (number | undefined | null)[]): MessageType {\n\tlet criticalityProperty: MessageType;\n\n\tif (aThresholds[0] !== undefined && aThresholds[0] !== null && kpiValue < aThresholds[0]) {\n\t\tcriticalityProperty = MessageType.Error;\n\t} else if (aThresholds[1] !== undefined && aThresholds[1] !== null && kpiValue < aThresholds[1]) {\n\t\tcriticalityProperty = MessageType.Warning;\n\t} else if (aThresholds[2] !== undefined && aThresholds[2] !== null && kpiValue < aThresholds[2]) {\n\t\tcriticalityProperty = MessageType.None;\n\t} else if (aThresholds[5] !== undefined && aThresholds[5] !== null && kpiValue > aThresholds[5]) {\n\t\tcriticalityProperty = MessageType.Error;\n\t} else if (aThresholds[4] !== undefined && aThresholds[4] !== null && kpiValue > aThresholds[4]) {\n\t\tcriticalityProperty = MessageType.Warning;\n\t} else if (aThresholds[3] !== undefined && aThresholds[3] !== null && kpiValue > aThresholds[3]) {\n\t\tcriticalityProperty = MessageType.None;\n\t} else {\n\t\tcriticalityProperty = MessageType.Success;\n\t}\n\n\treturn criticalityProperty;\n}\n\n/**\n * Function to get a message state from a calculated criticality of type 'Minimize'.\n * @param kpiValue The value of the KPI to be tested against.\n * @param aThresholds Thresholds to be used [AcceptanceRangeHighValue,ToleranceRangeHighValue,DeviationRangeHighValue].\n * @returns The corresponding MessageType\n */\nfunction messageTypeFromMinimizeCalculation(kpiValue: number, aThresholds: (number | undefined | null)[]): MessageType {\n\tlet criticalityProperty: MessageType;\n\n\tif (aThresholds[2] !== undefined && aThresholds[2] !== null && kpiValue > aThresholds[2]) {\n\t\tcriticalityProperty = MessageType.Error;\n\t} else if (aThresholds[1] !== undefined && aThresholds[1] !== null && kpiValue > aThresholds[1]) {\n\t\tcriticalityProperty = MessageType.Warning;\n\t} else if (aThresholds[0] !== undefined && aThresholds[0] !== null && kpiValue > aThresholds[0]) {\n\t\tcriticalityProperty = MessageType.None;\n\t} else {\n\t\tcriticalityProperty = MessageType.Success;\n\t}\n\n\treturn criticalityProperty;\n}\n\n/**\n * Function to get a message state from a calculated criticality of type 'Maximize'.\n * @param kpiValue The value of the KPI to be tested against.\n * @param aThresholds Thresholds to be used [DeviationRangeLowValue,ToleranceRangeLowValue,AcceptanceRangeLowValue].\n * @returns The corresponding MessageType\n */\nfunction messageTypeFromMaximizeCalculation(kpiValue: number, aThresholds: (number | undefined | null)[]): MessageType {\n\tlet criticalityProperty: MessageType;\n\n\tif (aThresholds[0] !== undefined && aThresholds[0] !== null && kpiValue < aThresholds[0]) {\n\t\tcriticalityProperty = MessageType.Error;\n\t} else if (aThresholds[1] !== undefined && aThresholds[1] !== null && kpiValue < aThresholds[1]) {\n\t\tcriticalityProperty = MessageType.Warning;\n\t} else if (aThresholds[2] !== undefined && aThresholds[2] !== null && kpiValue < aThresholds[2]) {\n\t\tcriticalityProperty = MessageType.None;\n\t} else {\n\t\tcriticalityProperty = MessageType.Success;\n\t}\n\n\treturn criticalityProperty;\n}\n\n/**\n * Function to calculate a DeviationIndicator value from a trend value.\n * @param trendValue The criticality values.\n * @returns The corresponding DeviationIndicator value\n */\nfunction deviationIndicatorFromTrendType(trendValue: number | string): string {\n\tlet deviationIndicator: string;\n\n\tswitch (trendValue) {\n\t\tcase 1: // StrongUp\n\t\tcase \"1\":\n\t\tcase 2: // Up\n\t\tcase \"2\":\n\t\t\tdeviationIndicator = \"Up\";\n\t\t\tbreak;\n\n\t\tcase 4: // Down\n\t\tcase \"4\":\n\t\tcase 5: // StrongDown\n\t\tcase \"5\":\n\t\t\tdeviationIndicator = \"Down\";\n\t\t\tbreak;\n\n\t\tdefault:\n\t\t\tdeviationIndicator = \"None\";\n\t}\n\n\treturn deviationIndicator;\n}\n\n/**\n * Function to calculate a DeviationIndicator from a TrendCalculation.\n * @param kpiValue The value of the KPI\n * @param referenceValue The reference value to compare with\n * @param isRelative True is the comparison is relative\n * @param aThresholds Array of thresholds [StrongDownDifference, DownDifference, UpDifference, StrongUpDifference]\n * @returns The corresponding DeviationIndicator value\n */\nfunction deviationIndicatorFromCalculation(\n\tkpiValue: number,\n\treferenceValue: number,\n\tisRelative: boolean,\n\taThresholds: (number | undefined | null)[] | undefined\n): string {\n\tlet deviationIndicator: string;\n\n\tif (!aThresholds || (isRelative && !referenceValue)) {\n\t\treturn \"None\";\n\t}\n\n\tconst compValue = isRelative ? (kpiValue - referenceValue) / referenceValue : kpiValue - referenceValue;\n\n\tif (aThresholds[0] !== undefined && aThresholds[0] !== null && compValue <= aThresholds[0]) {\n\t\t// StrongDown --> Down\n\t\tdeviationIndicator = \"Down\";\n\t} else if (aThresholds[1] !== undefined && aThresholds[1] !== null && compValue <= aThresholds[1]) {\n\t\t// Down --> Down\n\t\tdeviationIndicator = \"Down\";\n\t} else if (aThresholds[3] !== undefined && aThresholds[3] !== null && compValue >= aThresholds[3]) {\n\t\t// StrongUp --> Up\n\t\tdeviationIndicator = \"Up\";\n\t} else if (aThresholds[2] !== undefined && aThresholds[2] !== null && compValue >= aThresholds[2]) {\n\t\t// Up --> Up\n\t\tdeviationIndicator = \"Up\";\n\t} else {\n\t\t// Sideways --> None\n\t\tdeviationIndicator = \"None\";\n\t}\n\n\treturn deviationIndicator;\n}\n\n/**\n * Creates a sap.ui.model.Filter from a filter definition.\n * @param filterDefinition The filter definition\n * @returns Returns a sap.ui.model.Filter from the definition, or undefined if the definition is empty (no ranges)\n */\nfunction createFilterFromDefinition(filterDefinition: FilterDefinition): Filter | undefined {\n\tif (filterDefinition.ranges.length === 0) {\n\t\treturn undefined;\n\t} else if (filterDefinition.ranges.length === 1) {\n\t\treturn new Filter(\n\t\t\tfilterDefinition.propertyPath,\n\t\t\tfilterDefinition.ranges[0].operator as FilterOperator,\n\t\t\tfilterDefinition.ranges[0].rangeLow,\n\t\t\tfilterDefinition.ranges[0].rangeHigh\n\t\t);\n\t} else {\n\t\tconst aRangeFilters = filterDefinition.ranges.map((range) => {\n\t\t\treturn new Filter(filterDefinition.propertyPath, range.operator as FilterOperator, range.rangeLow, range.rangeHigh);\n\t\t});\n\t\treturn new Filter({\n\t\t\tfilters: aRangeFilters,\n\t\t\tand: false\n\t\t});\n\t}\n}\n\nfunction getFilterStringFromDefinition(filterDefinition: FilterDefinition): string {\n\tconst currentLocale = new Locale(Localization.getLanguage());\n\tconst resBundle = Library.getResourceBundleFor(\"sap.fe.core\")!;\n\tconst dateFormat = DateFormat.getDateInstance({ style: \"medium\" }, currentLocale);\n\n\tfunction formatRange(range: RangeDefinition): string {\n\t\tconst valueLow =\n\t\t\tfilterDefinition.propertyType.indexOf(\"Edm.Date\") === 0\n\t\t\t\t? dateFormat.format(new Date(range.rangeLow))\n\t\t\t\t: (range.rangeLow as string);\n\t\tconst valueHigh =\n\t\t\tfilterDefinition.propertyType.indexOf(\"Edm.Date\") === 0 && range.rangeHigh !== undefined\n\t\t\t\t? dateFormat.format(new Date(range.rangeHigh))\n\t\t\t\t: range.rangeHigh;\n\n\t\tswitch (range.operator) {\n\t\t\tcase \"BT\":\n\t\t\t\treturn `[${valueLow} - ${valueHigh}]`;\n\n\t\t\tcase \"Contains\":\n\t\t\t\treturn `*${valueLow}*`;\n\n\t\t\tcase \"GE\":\n\t\t\t\treturn `\\u2265${valueLow}`;\n\n\t\t\tcase \"GT\":\n\t\t\t\treturn `>${valueLow}`;\n\n\t\t\tcase \"LE\":\n\t\t\t\treturn `\\u2264${valueLow}`;\n\n\t\t\tcase \"LT\":\n\t\t\t\treturn `<${valueLow}`;\n\n\t\t\tcase \"NB\":\n\t\t\t\treturn resBundle.getText(\"C_KPICARD_FILTERSTRING_NOT\", [`[${valueLow} - ${valueHigh}]`]);\n\n\t\t\tcase \"NE\":\n\t\t\t\treturn `\\u2260${valueLow}`;\n\n\t\t\tcase \"NotContains\":\n\t\t\t\treturn resBundle.getText(\"C_KPICARD_FILTERSTRING_NOT\", [`*${valueLow}*`]);\n\n\t\t\tcase \"EQ\":\n\t\t\tdefault:\n\t\t\t\treturn valueLow;\n\t\t}\n\t}\n\tif (filterDefinition.ranges.length === 0) {\n\t\treturn \"\";\n\t} else if (filterDefinition.ranges.length === 1) {\n\t\treturn formatRange(filterDefinition.ranges[0]);\n\t} else {\n\t\treturn `(${filterDefinition.ranges.map(formatRange).join(\",\")})`;\n\t}\n}\n\nfunction formatChartTitle(kpiDef: AnalyticalKPIDefinition): string {\n\tconst resBundle = Library.getResourceBundleFor(\"sap.fe.core\")!;\n\n\tfunction formatList(items: { name: string; label: string }[]): string {\n\t\tif (items.length === 0) {\n\t\t\treturn \"\";\n\t\t} else if (items.length === 1) {\n\t\t\treturn items[0].label;\n\t\t} else {\n\t\t\tlet res = items[0].label;\n\t\t\tfor (let I = 1; I < items.length - 1; I++) {\n\t\t\t\tres += `, ${items[I].label}`;\n\t\t\t}\n\n\t\t\treturn resBundle.getText(\"C_KPICARD_ITEMSLIST\", [res, items[items.length - 1].label]);\n\t\t}\n\t}\n\n\t// If the chart has a title, use it. Otherwise, create a title from the dimensions and measures\n\treturn (\n\t\tkpiDef.chart.title ??\n\t\tresBundle.getText(\"C_KPICARD_CHARTTITLE\", [formatList(kpiDef.chart.measures), formatList(kpiDef.chart.dimensions)])\n\t);\n}\n\nfunction updateChartLabelSettings(\n\tchartDefinition: KPIChartDefinition,\n\toChartProperties: {\n\t\tcategoryAxis: { title: { visible: boolean } };\n\t\tsizeLegend: { visible: boolean };\n\t\tlegendGroup: { layout: { position: string; alignment: string } };\n\t\tvalueAxis: {\n\t\t\ttitle: { visible: boolean };\n\t\t\tlabel: {\n\t\t\t\tformatString: string;\n\t\t\t};\n\t\t};\n\t\tvalueAxis2: {\n\t\t\ttitle: { visible: boolean };\n\t\t\tlabel: {\n\t\t\t\tformatString: string;\n\t\t\t};\n\t\t};\n\t\tplotArea: {\n\t\t\tdataLabel: {};\n\t\t};\n\t}\n): void {\n\tswitch (chartDefinition.chartType) {\n\t\tcase \"Donut\":\n\t\t\t// Show data labels, do not show axis titles\n\t\t\toChartProperties.categoryAxis = {\n\t\t\t\ttitle: {\n\t\t\t\t\tvisible: false\n\t\t\t\t}\n\t\t\t};\n\t\t\toChartProperties.valueAxis = {\n\t\t\t\ttitle: {\n\t\t\t\t\tvisible: false\n\t\t\t\t},\n\t\t\t\tlabel: {\n\t\t\t\t\tformatString: \"ShortFloat\"\n\t\t\t\t}\n\t\t\t};\n\t\t\toChartProperties.plotArea.dataLabel = {\n\t\t\t\tvisible: true,\n\t\t\t\ttype: \"value\",\n\t\t\t\tformatString: \"ShortFloat_MFD2\"\n\t\t\t};\n\t\t\tbreak;\n\n\t\tcase \"bubble\":\n\t\t\t// Show axis title, bubble size legend, do not show data labels\n\t\t\toChartProperties.valueAxis = {\n\t\t\t\ttitle: {\n\t\t\t\t\tvisible: true\n\t\t\t\t},\n\t\t\t\tlabel: {\n\t\t\t\t\tformatString: \"ShortFloat\"\n\t\t\t\t}\n\t\t\t};\n\t\t\toChartProperties.valueAxis2 = {\n\t\t\t\ttitle: {\n\t\t\t\t\tvisible: true\n\t\t\t\t},\n\t\t\t\tlabel: {\n\t\t\t\t\tformatString: \"ShortFloat\"\n\t\t\t\t}\n\t\t\t};\n\t\t\toChartProperties.legendGroup = {\n\t\t\t\tlayout: {\n\t\t\t\t\tposition: \"bottom\",\n\t\t\t\t\talignment: \"topLeft\"\n\t\t\t\t}\n\t\t\t};\n\t\t\toChartProperties.sizeLegend = {\n\t\t\t\tvisible: true\n\t\t\t};\n\t\t\toChartProperties.plotArea.dataLabel = { visible: false };\n\t\t\tbreak;\n\n\t\tcase \"scatter\":\n\t\t\t// Do not show data labels and axis titles\n\t\t\toChartProperties.valueAxis = {\n\t\t\t\ttitle: {\n\t\t\t\t\tvisible: false\n\t\t\t\t},\n\t\t\t\tlabel: {\n\t\t\t\t\tformatString: \"ShortFloat\"\n\t\t\t\t}\n\t\t\t};\n\t\t\toChartProperties.valueAxis2 = {\n\t\t\t\ttitle: {\n\t\t\t\t\tvisible: false\n\t\t\t\t},\n\t\t\t\tlabel: {\n\t\t\t\t\tformatString: \"ShortFloat\"\n\t\t\t\t}\n\t\t\t};\n\t\t\toChartProperties.plotArea.dataLabel = { visible: false };\n\t\t\tbreak;\n\n\t\tdefault:\n\t\t\t// Do not show data labels and axis titles\n\t\t\toChartProperties.categoryAxis = {\n\t\t\t\ttitle: {\n\t\t\t\t\tvisible: false\n\t\t\t\t}\n\t\t\t};\n\t\t\toChartProperties.valueAxis = {\n\t\t\t\ttitle: {\n\t\t\t\t\tvisible: false\n\t\t\t\t},\n\t\t\t\tlabel: {\n\t\t\t\t\tformatString: \"ShortFloat\"\n\t\t\t\t}\n\t\t\t};\n\t\t\toChartProperties.plotArea.dataLabel = { visible: false };\n\t}\n}\nfunction filterMap(aObjects: { name: string; label: string; role?: string }[], aRoles?: (string | undefined)[]): string[] {\n\tif (aRoles && aRoles.length) {\n\t\treturn aObjects\n\t\t\t.filter((dimension) => {\n\t\t\t\treturn aRoles.includes(dimension.role);\n\t\t\t})\n\t\t\t.map((dimension) => {\n\t\t\t\treturn dimension.label;\n\t\t\t});\n\t} else {\n\t\treturn aObjects.map((dimension) => {\n\t\t\treturn dimension.label;\n\t\t});\n\t}\n}\n\nfunction getScatterBubbleChartFeeds(chartDefinition: KPIChartDefinition): { uid: string; type: string; values: string[] }[] {\n\tconst axis1Measures = filterMap(chartDefinition.measures, [\"Axis1\"]);\n\tconst axis2Measures = filterMap(chartDefinition.measures, [\"Axis2\"]);\n\tconst axis3Measures = filterMap(chartDefinition.measures, [\"Axis3\"]);\n\tconst otherMeasures = filterMap(chartDefinition.measures, [undefined]);\n\tconst seriesDimensions = filterMap(chartDefinition.dimensions, [\"Series\"]);\n\n\t// Get the first dimension with role \"Category\" for the shape\n\tconst shapeDimension = chartDefinition.dimensions.find((dimension) => {\n\t\treturn dimension.role === \"Category\";\n\t});\n\n\t// Measure for the x-Axis : first measure for Axis1, or for Axis2 if not found, or for Axis3 if not found\n\tconst xMeasure = axis1Measures.shift() || axis2Measures.shift() || axis3Measures.shift() || otherMeasures.shift() || \"\";\n\t// Measure for the y-Axis : first measure for Axis2, or second measure for Axis1 if not found, or first measure for Axis3 if not found\n\tconst yMeasure = axis2Measures.shift() || axis1Measures.shift() || axis3Measures.shift() || otherMeasures.shift() || \"\";\n\tconst res = [\n\t\t{\n\t\t\tuid: \"valueAxis\",\n\t\t\ttype: \"Measure\",\n\t\t\tvalues: [xMeasure]\n\t\t},\n\t\t{\n\t\t\tuid: \"valueAxis2\",\n\t\t\ttype: \"Measure\",\n\t\t\tvalues: [yMeasure]\n\t\t}\n\t];\n\n\tif (chartDefinition.chartType === \"bubble\") {\n\t\t// Measure for the size of the bubble: first measure for Axis3, or remaining measure for Axis1/Axis2 if not found\n\t\tconst sizeMeasure = axis3Measures.shift() || axis1Measures.shift() || axis2Measures.shift() || otherMeasures.shift() || \"\";\n\t\tres.push({\n\t\t\tuid: \"bubbleWidth\",\n\t\t\ttype: \"Measure\",\n\t\t\tvalues: [sizeMeasure]\n\t\t});\n\t}\n\n\t// Color (optional)\n\tif (seriesDimensions.length) {\n\t\tres.push({\n\t\t\tuid: \"color\",\n\t\t\ttype: \"Dimension\",\n\t\t\tvalues: seriesDimensions\n\t\t});\n\t}\n\t// Shape (optional)\n\tif (shapeDimension) {\n\t\tres.push({\n\t\t\tuid: \"shape\",\n\t\t\ttype: \"Dimension\",\n\t\t\tvalues: [shapeDimension.label]\n\t\t});\n\t}\n\treturn res;\n}\n\nfunction getChartFeeds(chartDefinition: KPIChartDefinition): { uid: string; type: string; values: string[] }[] {\n\tlet res: { uid: string; type: string; values: string[] }[];\n\n\tswitch (chartDefinition.chartType) {\n\t\tcase \"Donut\":\n\t\t\tres = [\n\t\t\t\t{\n\t\t\t\t\tuid: \"size\",\n\t\t\t\t\ttype: \"Measure\",\n\t\t\t\t\tvalues: filterMap(chartDefinition.measures)\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tuid: \"color\",\n\t\t\t\t\ttype: \"Dimension\",\n\t\t\t\t\tvalues: filterMap(chartDefinition.dimensions)\n\t\t\t\t}\n\t\t\t];\n\t\t\tbreak;\n\n\t\tcase \"bubble\":\n\t\tcase \"scatter\":\n\t\t\tres = getScatterBubbleChartFeeds(chartDefinition);\n\t\t\tbreak;\n\n\t\tcase \"vertical_bullet\":\n\t\t\tres = [\n\t\t\t\t{\n\t\t\t\t\tuid: \"actualValues\",\n\t\t\t\t\ttype: \"Measure\",\n\t\t\t\t\tvalues: filterMap(chartDefinition.measures, [undefined, \"Axis1\"])\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tuid: \"targetValues\",\n\t\t\t\t\ttype: \"Measure\",\n\t\t\t\t\tvalues: filterMap(chartDefinition.measures, [\"Axis2\"])\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tuid: \"categoryAxis\",\n\t\t\t\t\ttype: \"Dimension\",\n\t\t\t\t\tvalues: filterMap(chartDefinition.dimensions, [undefined, \"Category\"])\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tuid: \"color\",\n\t\t\t\t\ttype: \"Dimension\",\n\t\t\t\t\tvalues: filterMap(chartDefinition.dimensions, [\"Series\"])\n\t\t\t\t}\n\t\t\t];\n\t\t\tbreak;\n\n\t\tdefault:\n\t\t\tres = [\n\t\t\t\t{\n\t\t\t\t\tuid: \"valueAxis\",\n\t\t\t\t\ttype: \"Measure\",\n\t\t\t\t\tvalues: filterMap(chartDefinition.measures)\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tuid: \"categoryAxis\",\n\t\t\t\t\ttype: \"Dimension\",\n\t\t\t\t\tvalues: filterMap(chartDefinition.dimensions, [undefined, \"Category\"])\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tuid: \"color\",\n\t\t\t\t\ttype: \"Dimension\",\n\t\t\t\t\tvalues: filterMap(chartDefinition.dimensions, [\"Series\"])\n\t\t\t\t}\n\t\t\t];\n\t}\n\n\treturn res;\n}\n\nasync function getNavigationParameters(\n\tnavInfo: NavigationInfo,\n\toShellService: IShellServices\n): Promise<{ semanticObject?: string; action?: string; outbound?: string } | undefined> {\n\tif (navInfo.semanticObject) {\n\t\tif (navInfo.action) {\n\t\t\t// Action is already specified: check if it's available in the shell\n\t\t\treturn oShellService.getLinks([{ semanticObject: navInfo.semanticObject, action: navInfo.action }]).then((aLinks) => {\n\t\t\t\treturn aLinks.length && aLinks[0].length ? { semanticObject: navInfo.semanticObject, action: navInfo.action } : undefined;\n\t\t\t});\n\t\t} else {\n\t\t\t// We get the primary intent from the shell\n\t\t\treturn oShellService.getPrimaryIntent(navInfo.semanticObject).then((oLink) => {\n\t\t\t\tif (!oLink) {\n\t\t\t\t\t// No primary intent...\n\t\t\t\t\treturn undefined;\n\t\t\t\t}\n\n\t\t\t\t// Check that the primary intent is not part of the unavailable actions\n\t\t\t\tconst oInfo = oShellService.parseShellHash(oLink.intent);\n\t\t\t\treturn navInfo.unavailableActions && navInfo.unavailableActions.includes(oInfo.action)\n\t\t\t\t\t? undefined\n\t\t\t\t\t: { semanticObject: oInfo.semanticObject, action: oInfo.action };\n\t\t\t});\n\t\t}\n\t} else {\n\t\t// Outbound navigation specified in the manifest\n\t\treturn navInfo.outboundNavigation ? Promise.resolve({ outbound: navInfo.outboundNavigation }) : Promise.resolve(undefined);\n\t}\n}\n\n/**\n * A controller extension for managing the KPIs in an analytical list page.\n * @hideconstructor\n * @since 1.93.0\n */\n@defineUI5Class(\"sap.fe.core.controllerextensions.KPIManagement\")\nclass KPIManagementControllerExtension extends ControllerExtension {\n\tprivate base!: PageController;\n\n\tprotected aKPIDefinitions?: KPIDefinition[];\n\n\tprotected oCard!: Card;\n\n\tprotected oPopover!: Popover;\n\n\tconstructor() {\n\t\tsuper();\n\t}\n\n\t/**\n\t * Creates the card manifest for a KPI definition and stores it in a JSON model.\n\t * @param kpiDefinition The KPI definition\n\t * @param oKPIModel The JSON model in which the manifest will be stored\n\t */\n\tprotected initCardManifest(kpiDefinition: AnalyticalKPIDefinition, oKPIModel: JSONModel): void {\n\t\tconst oCardManifest: CardManifest<Partial<ChartCardContent>> = {\n\t\t\t\"sap.app\": {\n\t\t\t\tid: \"sap.fe.KPICard\",\n\t\t\t\ttype: \"card\"\n\t\t\t},\n\t\t\t\"sap.ui\": {\n\t\t\t\ttechnology: \"UI5\"\n\t\t\t},\n\t\t\t\"sap.card\": {\n\t\t\t\ttype: \"Analytical\",\n\t\t\t\tdata: {\n\t\t\t\t\tjson: {}\n\t\t\t\t},\n\t\t\t\theader: {\n\t\t\t\t\ttype: \"Numeric\",\n\t\t\t\t\ttitle: kpiDefinition.datapoint.title,\n\t\t\t\t\tsubTitle: kpiDefinition.datapoint.description,\n\t\t\t\t\tunitOfMeasurement: \"{mainUnit}\",\n\t\t\t\t\tmainIndicator: {\n\t\t\t\t\t\tnumber: \"{mainValueNoScale}\",\n\t\t\t\t\t\tunit: \"{mainValueScale}\",\n\t\t\t\t\t\tstate: \"{mainState}\",\n\t\t\t\t\t\ttrend: \"{trend}\"\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tcontent: {\n\t\t\t\t\tminHeight: \"25rem\",\n\t\t\t\t\tchartProperties: {\n\t\t\t\t\t\tplotArea: {},\n\t\t\t\t\t\ttitle: {\n\t\t\t\t\t\t\tvisible: true,\n\t\t\t\t\t\t\talignment: \"left\"\n\t\t\t\t\t\t}\n\t\t\t\t\t},\n\t\t\t\t\tdata: {\n\t\t\t\t\t\tpath: \"/chartData\"\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t};\n\n\t\t// Add side indicators in the card header if a target is defined for the KPI\n\t\tif (kpiDefinition.datapoint.targetPath || kpiDefinition.datapoint.targetValue !== undefined) {\n\t\t\tconst resBundle = Library.getResourceBundleFor(\"sap.fe.core\")!;\n\t\t\toCardManifest[\"sap.card\"].header.sideIndicators = [\n\t\t\t\t{\n\t\t\t\t\ttitle: resBundle.getText(\"C_KPICARD_INDICATOR_TARGET\"),\n\t\t\t\t\tnumber: \"{targetNumber}\",\n\t\t\t\t\tunit: \"{targetUnit}\"\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\ttitle: resBundle.getText(\"C_KPICARD_INDICATOR_DEVIATION\"),\n\t\t\t\t\tnumber: \"{deviationNumber}\",\n\t\t\t\t\tunit: \"%\"\n\t\t\t\t}\n\t\t\t];\n\t\t}\n\n\t\t// Details of the card: filter descriptions\n\t\tif (kpiDefinition.selectionVariantFilterDefinitions?.length) {\n\t\t\tconst aDescriptions: string[] = [];\n\t\t\tkpiDefinition.selectionVariantFilterDefinitions.forEach((filterDefinition) => {\n\t\t\t\tconst desc = getFilterStringFromDefinition(filterDefinition);\n\t\t\t\tif (desc) {\n\t\t\t\t\taDescriptions.push(desc);\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tif (aDescriptions.length) {\n\t\t\t\toCardManifest[\"sap.card\"].header.details = aDescriptions.join(\", \");\n\t\t\t}\n\t\t}\n\n\t\t// Chart settings: type, title, dimensions and measures in the manifest\n\t\toCardManifest[\"sap.card\"].content.chartType = kpiDefinition.chart.chartType;\n\t\tupdateChartLabelSettings(kpiDefinition.chart, oCardManifest[\"sap.card\"].content.chartProperties);\n\t\toCardManifest[\"sap.card\"].content.chartProperties.title.text = formatChartTitle(kpiDefinition);\n\t\toCardManifest[\"sap.card\"].content.dimensions = kpiDefinition.chart.dimensions.map((dimension) => {\n\t\t\treturn { label: dimension.label, value: `{${dimension.name}}` };\n\t\t});\n\t\toCardManifest[\"sap.card\"].content.measures = kpiDefinition.chart.measures.map((measure) => {\n\t\t\treturn { label: measure.label, value: `{${measure.name}}` };\n\t\t});\n\t\toCardManifest[\"sap.card\"].content.feeds = getChartFeeds(kpiDefinition.chart);\n\n\t\toKPIModel.setProperty(`/${kpiDefinition.id}`, {\n\t\t\tmanifest: oCardManifest\n\t\t});\n\t}\n\n\tprotected async initNavigationInfo(\n\t\tkpiDefinition: AnalyticalKPIDefinition,\n\t\toKPIModel: JSONModel,\n\t\toShellService: IShellServices\n\t): Promise<void> {\n\t\t// Add navigation\n\t\tif (kpiDefinition.navigation) {\n\t\t\treturn getNavigationParameters(kpiDefinition.navigation, oShellService).then((oNavInfo) => {\n\t\t\t\tif (oNavInfo) {\n\t\t\t\t\toKPIModel.setProperty(`/${kpiDefinition.id}/manifest/sap.card/header/actions`, [\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\ttype: \"Navigation\",\n\t\t\t\t\t\t\tparameters: oNavInfo\n\t\t\t\t\t\t}\n\t\t\t\t\t]);\n\t\t\t\t}\n\t\t\t\treturn;\n\t\t\t});\n\t\t} else {\n\t\t\treturn Promise.resolve();\n\t\t}\n\t}\n\n\t@methodOverride()\n\tpublic onInit(): void {\n\t\tthis.aKPIDefinitions = (this.getView().getController() as PageController)._getPageModel()?.getProperty(\"/kpiDefinitions\");\n\n\t\tif (this.aKPIDefinitions && this.aKPIDefinitions.length) {\n\t\t\tconst oView = this.getView();\n\t\t\tconst oAppComponent = (oView.getController() as BaseController).getAppComponent();\n\n\t\t\t// Create a JSON model to store KPI data\n\t\t\tconst oKPIModel = new JSONModel();\n\t\t\toView.setModel(oKPIModel, \"kpiModel\");\n\n\t\t\tthis.aKPIDefinitions.forEach((kpiDefinition) => {\n\t\t\t\t// We only need to worry about analytical KPI definition\n\t\t\t\tif (kpiDefinition.type === \"Analytical\") {\n\t\t\t\t\t// Create the manifest for the KPI card and store it in the KPI model\n\t\t\t\t\tthis.initCardManifest(kpiDefinition, oKPIModel);\n\n\t\t\t\t\t// Set the navigation information in the manifest\n\t\t\t\t\tthis.initNavigationInfo(kpiDefinition, oKPIModel, oAppComponent.getShellServices()).catch(function (err: string) {\n\t\t\t\t\t\tLog.error(err);\n\t\t\t\t\t});\n\n\t\t\t\t\t// Load tag data for the KPI\n\t\t\t\t\tthis.loadKPITagData(kpiDefinition, oAppComponent.getModel(), oKPIModel).catch(function (err: string) {\n\t\t\t\t\t\tLog.error(err);\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t}\n\n\t@methodOverride()\n\tpublic onExit(): void {\n\t\tconst oKPIModel = this.getView().getModel(\"kpiModel\") as JSONModel;\n\n\t\tif (oKPIModel) {\n\t\t\toKPIModel.destroy();\n\t\t}\n\t}\n\n\tprivate updateDatapointValueAndCurrency(kpiDefinition: AnalyticalKPIDefinition, kpiContext: Context, oKPIModel: JSONModel): void {\n\t\tconst currentLocale = new Locale(Localization.getLanguage());\n\t\tconst rawUnit = kpiDefinition.datapoint.unit?.isPath\n\t\t\t? kpiContext.getProperty(kpiDefinition.datapoint.unit.value)\n\t\t\t: kpiDefinition.datapoint.unit?.value;\n\n\t\tconst isPercentage = kpiDefinition.datapoint.unit?.isCurrency === false && rawUnit === \"%\";\n\n\t\t// /////////////////////\n\t\t// Main KPI value\n\t\tconst rawValue = Number.parseFloat(kpiContext.getProperty(kpiDefinition.datapoint.propertyPath));\n\n\t\t// Value formatted with a scale\n\t\tconst kpiValue = NumberFormat.getFloatInstance(\n\t\t\t{\n\t\t\t\tstyle: isPercentage ? undefined : \"short\",\n\t\t\t\tminFractionDigits: 0,\n\t\t\t\tmaxFractionDigits: kpiDefinition.datapoint.numberOfFractionalDigits ?? 1,\n\t\t\t\tshowScale: !isPercentage\n\t\t\t},\n\t\t\tcurrentLocale\n\t\t).format(rawValue);\n\t\toKPIModel.setProperty(`/${kpiDefinition.id}/manifest/sap.card/data/json/mainValue`, kpiValue);\n\n\t\t// Value without a scale\n\t\tconst kpiValueUnscaled = NumberFormat.getFloatInstance(\n\t\t\t{\n\t\t\t\tmaxFractionDigits: kpiDefinition.datapoint.numberOfFractionalDigits ?? 2,\n\t\t\t\tshowScale: false,\n\t\t\t\tgroupingEnabled: true\n\t\t\t},\n\t\t\tcurrentLocale\n\t\t).format(rawValue);\n\t\toKPIModel.setProperty(`/${kpiDefinition.id}/manifest/sap.card/data/json/mainValueUnscaled`, kpiValueUnscaled);\n\n\t\t// Value formatted with the scale omitted\n\t\tconst kpiValueNoScale = NumberFormat.getFloatInstance(\n\t\t\t{\n\t\t\t\tstyle: isPercentage ? undefined : \"short\",\n\t\t\t\tminFractionDigits: 0,\n\t\t\t\tmaxFractionDigits: kpiDefinition.datapoint.numberOfFractionalDigits ?? 1,\n\t\t\t\tshowScale: false\n\t\t\t},\n\t\t\tcurrentLocale\n\t\t).format(rawValue);\n\t\toKPIModel.setProperty(`/${kpiDefinition.id}/manifest/sap.card/data/json/mainValueNoScale`, kpiValueNoScale);\n\n\t\t// Scale of the value\n\t\tconst kpiValueScale = NumberFormat.getFloatInstance(\n\t\t\t{\n\t\t\t\tstyle: isPercentage ? undefined : \"short\",\n\t\t\t\tdecimals: 0,\n\t\t\t\tmaxIntegerDigits: 0,\n\t\t\t\tshowScale: true\n\t\t\t},\n\t\t\tcurrentLocale\n\t\t).format(rawValue);\n\t\toKPIModel.setProperty(`/${kpiDefinition.id}/manifest/sap.card/data/json/mainValueScale`, kpiValueScale);\n\n\t\t// /////////////////////\n\t\t// Unit or currency\n\t\tif (kpiDefinition.datapoint.unit && rawUnit) {\n\t\t\tif (kpiDefinition.datapoint.unit.isCurrency) {\n\t\t\t\toKPIModel.setProperty(`/${kpiDefinition.id}/manifest/sap.card/data/json/mainUnit`, rawUnit);\n\t\t\t} else {\n\t\t\t\t// In case of unit of measure, we have to format it properly\n\t\t\t\tconst kpiUnit = NumberFormat.getUnitInstance({ showNumber: false }, currentLocale).format(rawValue, rawUnit);\n\t\t\t\toKPIModel.setProperty(`/${kpiDefinition.id}/manifest/sap.card/data/json/mainUnit`, kpiUnit);\n\t\t\t}\n\t\t}\n\t}\n\n\tprivate updateDatapointCriticality(kpiDefinition: AnalyticalKPIDefinition, kpiContext: Context, oKPIModel: JSONModel): void {\n\t\tconst rawValue = Number.parseFloat(kpiContext.getProperty(kpiDefinition.datapoint.propertyPath));\n\n\t\tlet criticalityValue = MessageType.None;\n\t\tif (kpiDefinition.datapoint.criticalityValue != null) {\n\t\t\t// Criticality is a fixed value\n\t\t\tcriticalityValue = kpiDefinition.datapoint.criticalityValue;\n\t\t} else if (kpiDefinition.datapoint.criticalityPath) {\n\t\t\t// Criticality comes from another property (via a path)\n\t\t\tcriticalityValue =\n\t\t\t\tMessageTypeFromCriticality[kpiContext.getProperty(kpiDefinition.datapoint.criticalityPath)] || MessageType.None;\n\t\t} else if (kpiDefinition.datapoint.criticalityCalculationThresholds && kpiDefinition.datapoint.criticalityCalculationMode != null) {\n\t\t\t// Criticality calculation\n\t\t\tswitch (kpiDefinition.datapoint.criticalityCalculationMode) {\n\t\t\t\tcase \"UI.ImprovementDirectionType/Target\":\n\t\t\t\t\tcriticalityValue = messageTypeFromTargetCalculation(rawValue, kpiDefinition.datapoint.criticalityCalculationThresholds);\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase \"UI.ImprovementDirectionType/Minimize\":\n\t\t\t\t\tcriticalityValue = messageTypeFromMinimizeCalculation(\n\t\t\t\t\t\trawValue,\n\t\t\t\t\t\tkpiDefinition.datapoint.criticalityCalculationThresholds\n\t\t\t\t\t);\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase \"UI.ImprovementDirectionType/Maximize\":\n\t\t\t\tdefault:\n\t\t\t\t\tcriticalityValue = messageTypeFromMaximizeCalculation(\n\t\t\t\t\t\trawValue,\n\t\t\t\t\t\tkpiDefinition.datapoint.criticalityCalculationThresholds\n\t\t\t\t\t);\n\t\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\n\t\toKPIModel.setProperty(`/${kpiDefinition.id}/manifest/sap.card/data/json/mainCriticality`, criticalityValue);\n\t\toKPIModel.setProperty(\n\t\t\t`/${kpiDefinition.id}/manifest/sap.card/data/json/mainState`,\n\t\t\tValueColorFromMessageType[criticalityValue] || \"None\"\n\t\t);\n\t}\n\n\tprivate updateDatapointTrend(kpiDefinition: AnalyticalKPIDefinition, kpiContext: Context, oKPIModel: JSONModel): void {\n\t\tconst rawValue = Number.parseFloat(kpiContext.getProperty(kpiDefinition.datapoint.propertyPath));\n\n\t\tlet trendValue = \"None\";\n\n\t\tif (kpiDefinition.datapoint.trendValue) {\n\t\t\t// Trend is a fixed value\n\t\t\ttrendValue = kpiDefinition.datapoint.trendValue;\n\t\t} else if (kpiDefinition.datapoint.trendPath) {\n\t\t\t// Trend comes from another property via a path\n\t\t\ttrendValue = deviationIndicatorFromTrendType(kpiContext.getProperty(kpiDefinition.datapoint.trendPath));\n\t\t} else if (\n\t\t\tkpiDefinition.datapoint.trendCalculationReferenceValue !== undefined ||\n\t\t\tkpiDefinition.datapoint.trendCalculationReferencePath\n\t\t) {\n\t\t\t// Calculated trend\n\t\t\tlet trendReferenceValue: number;\n\t\t\tif (kpiDefinition.datapoint.trendCalculationReferenceValue !== undefined) {\n\t\t\t\ttrendReferenceValue = kpiDefinition.datapoint.trendCalculationReferenceValue;\n\t\t\t} else {\n\t\t\t\ttrendReferenceValue = Number.parseFloat(\n\t\t\t\t\tkpiContext.getProperty(kpiDefinition.datapoint.trendCalculationReferencePath || \"\")\n\t\t\t\t);\n\t\t\t}\n\t\t\ttrendValue = deviationIndicatorFromCalculation(\n\t\t\t\trawValue,\n\t\t\t\ttrendReferenceValue,\n\t\t\t\t!!kpiDefinition.datapoint.trendCalculationIsRelative,\n\t\t\t\tkpiDefinition.datapoint.trendCalculationTresholds\n\t\t\t);\n\t\t}\n\n\t\toKPIModel.setProperty(`/${kpiDefinition.id}/manifest/sap.card/data/json/trend`, trendValue);\n\t}\n\n\tprivate updateTargetValue(kpiDefinition: AnalyticalKPIDefinition, kpiContext: Context, oKPIModel: JSONModel): void {\n\t\tif (kpiDefinition.datapoint.targetValue === undefined && kpiDefinition.datapoint.targetPath === undefined) {\n\t\t\treturn; // No target set for the KPI\n\t\t}\n\t\tconst rawValue = Number.parseFloat(kpiContext.getProperty(kpiDefinition.datapoint.propertyPath));\n\t\tconst currentLocale = new Locale(Localization.getLanguage());\n\n\t\tlet targetRawValue: number;\n\t\tif (kpiDefinition.datapoint.targetValue !== undefined) {\n\t\t\ttargetRawValue = kpiDefinition.datapoint.targetValue;\n\t\t} else {\n\t\t\ttargetRawValue = Number.parseFloat(kpiContext.getProperty(kpiDefinition.datapoint.targetPath || \"\"));\n\t\t}\n\t\tconst deviationRawValue = targetRawValue !== 0 ? ((rawValue - targetRawValue) / targetRawValue) * 100 : undefined;\n\n\t\t// Formatting\n\t\tconst targetValue = NumberFormat.getFloatInstance(\n\t\t\t{\n\t\t\t\tstyle: \"short\",\n\t\t\t\tminFractionDigits: 0,\n\t\t\t\tmaxFractionDigits: kpiDefinition.datapoint.numberOfFractionalDigits ?? 1, // Use the same precision as the main value\n\t\t\t\tshowScale: false\n\t\t\t},\n\t\t\tcurrentLocale\n\t\t).format(targetRawValue);\n\t\tconst targetScale = NumberFormat.getFloatInstance(\n\t\t\t{\n\t\t\t\tstyle: \"short\",\n\t\t\t\tdecimals: 0,\n\t\t\t\tmaxIntegerDigits: 0,\n\t\t\t\tshowScale: true\n\t\t\t},\n\t\t\tcurrentLocale\n\t\t).format(targetRawValue);\n\n\t\toKPIModel.setProperty(`/${kpiDefinition.id}/manifest/sap.card/data/json/targetNumber`, targetValue);\n\t\toKPIModel.setProperty(`/${kpiDefinition.id}/manifest/sap.card/data/json/targetUnit`, targetScale);\n\n\t\tif (deviationRawValue !== undefined) {\n\t\t\tconst deviationValue = NumberFormat.getFloatInstance(\n\t\t\t\t{\n\t\t\t\t\tminFractionDigits: 0,\n\t\t\t\t\tmaxFractionDigits: 1,\n\t\t\t\t\tshowScale: false\n\t\t\t\t},\n\t\t\t\tcurrentLocale\n\t\t\t).format(deviationRawValue);\n\t\t\toKPIModel.setProperty(`/${kpiDefinition.id}/manifest/sap.card/data/json/deviationNumber`, deviationValue);\n\t\t} else {\n\t\t\toKPIModel.setProperty(`/${kpiDefinition.id}/manifest/sap.card/data/json/deviationNumber`, \"N/A\");\n\t\t}\n\t}\n\n\t/**\n\t * Loads tag data for a KPI, and stores it in the JSON KPI model.\n\t * @param kpiDefinition The definition of the KPI.\n\t * @param oMainModel The model used to load the data.\n\t * @param oKPIModel The JSON model where the data will be stored\n\t * @param loadFull If not true, loads only data for the KPI tag\n\t * @returns The promise that is resolved when data is loaded.\n\t */\n\tprotected async loadKPITagData(\n\t\tkpiDefinition: AnalyticalKPIDefinition,\n\t\toMainModel: ODataModel,\n\t\toKPIModel: JSONModel,\n\t\tloadFull?: boolean\n\t): Promise<void | Context[]> {\n\t\t// If loadFull=false, then we're just loading data for the tag and we use the \"$auto.LongRunners\" groupID\n\t\t// If loadFull=true, we're loading data for the whole KPI (tag + card) and we use the \"$auto.Workers\" groupID\n\t\tconst oListBinding = loadFull\n\t\t\t? oMainModel.bindList(kpiDefinition.contextPath, undefined, undefined, undefined, { $$groupId: \"$auto.Workers\" })\n\t\t\t: oMainModel.bindList(kpiDefinition.contextPath, undefined, undefined, undefined, { $$groupId: \"$auto.LongRunners\" });\n\t\tconst oAggregate: Record<string, { unit?: string }> = {};\n\n\t\t// Main value + currency/unit\n\t\tif (kpiDefinition.datapoint.unit?.isPath) {\n\t\t\toAggregate[kpiDefinition.datapoint.propertyPath] = { unit: kpiDefinition.datapoint.unit.value };\n\t\t} else {\n\t\t\toAggregate[kpiDefinition.datapoint.propertyPath] = {};\n\t\t}\n\n\t\t// Property for criticality\n\t\tif (kpiDefinition.datapoint.criticalityPath) {\n\t\t\toAggregate[kpiDefinition.datapoint.criticalityPath] = {};\n\t\t}\n\n\t\t// Properties for trend and trend calculation\n\t\tif (loadFull) {\n\t\t\tif (kpiDefinition.datapoint.trendPath) {\n\t\t\t\toAggregate[kpiDefinition.datapoint.trendPath] = {};\n\t\t\t}\n\t\t\tif (kpiDefinition.datapoint.trendCalculationReferencePath) {\n\t\t\t\toAggregate[kpiDefinition.datapoint.trendCalculationReferencePath] = {};\n\t\t\t}\n\t\t\tif (kpiDefinition.datapoint.targetPath) {\n\t\t\t\toAggregate[kpiDefinition.datapoint.targetPath] = {};\n\t\t\t}\n\t\t}\n\n\t\toListBinding.setAggregation({ aggregate: oAggregate });\n\n\t\t// Manage SelectionVariant filters\n\t\tif (kpiDefinition.selectionVariantFilterDefinitions?.length) {\n\t\t\tconst aFilters = kpiDefinition.selectionVariantFilterDefinitions.map(createFilterFromDefinition).filter((filter) => {\n\t\t\t\treturn filter !== undefined;\n\t\t\t}) as Filter[];\n\t\t\toListBinding.filter(aFilters);\n\t\t}\n\n\t\treturn oListBinding.requestContexts(0, 1).then((aContexts: Context[]): void => {\n\t\t\tif (aContexts.length) {\n\t\t\t\tconst rawUnit = kpiDefinition.datapoint.unit?.isPath\n\t\t\t\t\t? aContexts[0].getProperty(kpiDefinition.datapoint.unit.value)\n\t\t\t\t\t: kpiDefinition.datapoint.unit?.value;\n\n\t\t\t\tif (kpiDefinition.datapoint.unit && !rawUnit) {\n\t\t\t\t\t// A unit/currency is defined, but its value is undefined --> multi-unit situation\n\t\t\t\t\toKPIModel.setProperty(`/${kpiDefinition.id}/manifest/sap.card/data/json/mainValue`, \"*\");\n\t\t\t\t\toKPIModel.setProperty(`/${kpiDefinition.id}/manifest/sap.card/data/json/mainValueUnscaled`, \"*\");\n\t\t\t\t\toKPIModel.setProperty(`/${kpiDefinition.id}/manifest/sap.card/data/json/mainValueNoScale`, \"*\");\n\t\t\t\t\toKPIModel.setProperty(`/${kpiDefinition.id}/manifest/sap.card/data/json/mainValueScale`, \"\");\n\t\t\t\t\toKPIModel.setProperty(`/${kpiDefinition.id}/manifest/sap.card/data/json/mainUnit`, undefined);\n\t\t\t\t\toKPIModel.setProperty(`/${kpiDefinition.id}/manifest/sap.card/data/json/mainCriticality`, MessageType.None);\n\t\t\t\t\toKPIModel.setProperty(`/${kpiDefinition.id}/manifest/sap.card/data/json/mainState`, \"None\");\n\t\t\t\t\toKPIModel.setProperty(`/${kpiDefinition.id}/manifest/sap.card/data/json/trend`, \"None\");\n\t\t\t\t\toKPIModel.setProperty(`/${kpiDefinition.id}/manifest/sap.card/data/json/targetNumber`, undefined);\n\t\t\t\t\toKPIModel.setProperty(`/${kpiDefinition.id}/manifest/sap.card/data/json/targetUnit`, undefined);\n\t\t\t\t\toKPIModel.setProperty(`/${kpiDefinition.id}/manifest/sap.card/data/json/deviationNumber`, undefined);\n\t\t\t\t} else {\n\t\t\t\t\tthis.updateDatapointValueAndCurrency(kpiDefinition, aContexts[0], oKPIModel);\n\t\t\t\t\tthis.updateDatapointCriticality(kpiDefinition, aContexts[0], oKPIModel);\n\n\t\t\t\t\tif (loadFull) {\n\t\t\t\t\t\tthis.updateDatapointTrend(kpiDefinition, aContexts[0], oKPIModel);\n\t\t\t\t\t\tthis.updateTargetValue(kpiDefinition, aContexts[0], oKPIModel);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn;\n\t\t});\n\t}\n\n\t/**\n\t * Loads card data for a KPI, and stores it in the JSON KPI model.\n\t * @param kpiDefinition The definition of the KPI.\n\t * @param oMainModel The model used to load the data.\n\t * @param oKPIModel The JSON model where the data will be stored\n\t * @returns The promise that is resolved when data is loaded.\n\t */\n\tprotected async loadKPICardData(\n\t\tkpiDefinition: AnalyticalKPIDefinition,\n\t\toMainModel: ODataModel,\n\t\toKPIModel: JSONModel\n\t): Promise<void | Context[]> {\n\t\tconst oListBinding = oMainModel.bindList(kpiDefinition.contextPath, undefined, undefined, undefined, {\n\t\t\t$$groupId: \"$auto.Workers\"\n\t\t});\n\t\tconst oGroup: Record<string, { additionally?: string[] }> = {};\n\t\tconst oAggregate: Record<string, Object> = {};\n\n\t\tkpiDefinition.chart.dimensions.forEach((dimension) => {\n\t\t\toGroup[dimension.name] = {};\n\t\t\tif (dimension.text) {\n\t\t\t\t// Also load the text property if there's one (as an additional property)\n\t\t\t\toGroup[dimension.name].additionally = [dimension.text];\n\t\t\t}\n\t\t});\n\t\tkpiDefinition.chart.measures.forEach((measure) => {\n\t\t\toAggregate[measure.name] = {};\n\t\t});\n\t\toListBinding.setAggregation({\n\t\t\tgroup: oGroup,\n\t\t\taggregate: oAggregate\n\t\t});\n\n\t\t// Manage SelectionVariant filters\n\t\tif (kpiDefinition.selectionVariantFilterDefinitions?.length) {\n\t\t\tconst aFilters = kpiDefinition.selectionVariantFilterDefinitions.map(createFilterFromDefinition).filter((filter) => {\n\t\t\t\treturn filter !== undefined;\n\t\t\t}) as Filter[];\n\t\t\toListBinding.filter(aFilters);\n\t\t}\n\n\t\t// Sorting\n\t\tif (kpiDefinition.chart.sortOrder) {\n\t\t\toListBinding.sort(\n\t\t\t\tkpiDefinition.chart.sortOrder.map((sortInfo) => {\n\t\t\t\t\treturn new Sorter(sortInfo.name, sortInfo.descending);\n\t\t\t\t})\n\t\t\t);\n\t\t}\n\n\t\tconst allContexts = await oListBinding.requestContexts(0, kpiDefinition.chart.maxItems);\n\t\tconst chartData = allContexts.map((oContext) => {\n\t\t\tconst oData: Record<string, unknown> = {};\n\t\t\tkpiDefinition.chart.dimensions.forEach((dimension) => {\n\t\t\t\t// We have to format the dimension value here, as the card doesn't support calculated bindings yet\n\t\t\t\tswitch (dimension.textArrangement) {\n\t\t\t\t\tcase \"TextOnly\":\n\t\t\t\t\t\toData[dimension.name] = oContext.getProperty(dimension.text!);\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\tcase \"TextLast\":\n\t\t\t\t\t\toData[dimension.name] = valueFormatters.formatWithBrackets(\n\t\t\t\t\t\t\toContext.getProperty(dimension.name),\n\t\t\t\t\t\t\toContext.getProperty(dimension.text!)\n\t\t\t\t\t\t);\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\tcase undefined:\n\t\t\t\t\t\t// No text arrangement\n\t\t\t\t\t\toData[dimension.name] = oContext.getProperty(dimension.name);\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\tdefault:\n\t\t\t\t\t\t//Default should be TextFirst if there is a Text annotation and neither TextOnly nor TextLast are set\n\t\t\t\t\t\toData[dimension.name] = valueFormatters.formatWithBrackets(\n\t\t\t\t\t\t\toContext.getProperty(dimension.text!),\n\t\t\t\t\t\t\toContext.getProperty(dimension.name)\n\t\t\t\t\t\t);\n\t\t\t\t}\n\t\t\t});\n\t\t\tkpiDefinition.chart.measures.forEach((measure) => {\n\t\t\t\toData[measure.name] = oContext.getProperty(measure.name);\n\t\t\t});\n\n\t\t\treturn oData;\n\t\t});\n\n\t\toKPIModel.setProperty(`/${kpiDefinition.id}/manifest/sap.card/data/json/chartData`, chartData);\n\t}\n\n\t/**\n\t * Gets the popover to display the KPI card\n\t * The popover and the contained card for the KPIs are created if necessary.\n\t * The popover is shared between all KPIs, so it's created only once.\n\t * @param oKPITag The tag that triggered the popover opening.\n\t * @returns The shared popover as a promise.\n\t */\n\tprotected async getPopover(oKPITag: GenericTag): Promise<Popover> {\n\t\tif (!this.oPopover) {\n\t\t\treturn new Promise((resolve, reject) => {\n\t\t\t\tLibrary.load({ name: \"sap/ui/integration\" })\n\t\t\t\t\t.then((): void => {\n\t\t\t\t\t\tsap.ui.require([\"sap/ui/integration/widgets/Card\", \"sap/ui/integration/Host\"], (...params: unknown[]) => {\n\t\t\t\t\t\t\tconst CardClass = params[0] as typeof CardType;\n\t\t\t\t\t\t\tconst Host = params[1] as typeof HostType;\n\t\t\t\t\t\t\tconst oHost = new Host();\n\n\t\t\t\t\t\t\toHost.attachAction((oEvent: Host$ActionEvent) => {\n\t\t\t\t\t\t\t\tconst sType = oEvent.getParameter(\"type\");\n\t\t\t\t\t\t\t\tconst oParams = oEvent.getParameter(\"parameters\") as {\n\t\t\t\t\t\t\t\t\tsemanticObject?: string;\n\t\t\t\t\t\t\t\t\taction: string;\n\t\t\t\t\t\t\t\t\toutbound: string;\n\t\t\t\t\t\t\t\t};\n\n\t\t\t\t\t\t\t\tif (sType === \"Navigation\") {\n\t\t\t\t\t\t\t\t\tif (oParams.semanticObject) {\n\t\t\t\t\t\t\t\t\t\tthis.base._intentBasedNavigation.navigate(oParams.semanticObject, oParams.action);\n\t\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\t\tthis.base._intentBasedNavigation.navigateOutbound(oParams.outbound);\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t});\n\n\t\t\t\t\t\t\tthis.oCard = new CardClass({\n\t\t\t\t\t\t\t\twidth: \"25rem\",\n\t\t\t\t\t\t\t\theight: \"auto\"\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\tthis.oCard.setHost(oHost as unknown as Control);\n\n\t\t\t\t\t\t\tthis.oPopover = new Popover(\"kpi-Popover\", {\n\t\t\t\t\t\t\t\tshowHeader: false,\n\t\t\t\t\t\t\t\tplacement: \"Auto\",\n\t\t\t\t\t\t\t\tcontent: [this.oCard]\n\t\t\t\t\t\t\t});\n\n\t\t\t\t\t\t\toKPITag.addDependent(this.oPopover); // The first clicked tag gets the popover as dependent\n\n\t\t\t\t\t\t\tresolve(this.oPopover);\n\t\t\t\t\t\t});\n\t\t\t\t\t\treturn;\n\t\t\t\t\t})\n\t\t\t\t\t.catch(function () {\n\t\t\t\t\t\treject();\n\t\t\t\t\t});\n\t\t\t});\n\t\t} else {\n\t\t\treturn Promise.resolve(this.oPopover);\n\t\t}\n\t}\n\n\tpublic async onKPIPressed(oKPITag: GenericTag, kpiID: string): Promise<void> {\n\t\tconst oKPIModel = oKPITag.getModel(\"kpiModel\") as JSONModel;\n\n\t\tif (this.aKPIDefinitions && this.aKPIDefinitions.length) {\n\t\t\tconst kpiDefinition = this.aKPIDefinitions.find(function (oDef) {\n\t\t\t\treturn (oDef as AnalyticalKPIDefinition).id === kpiID;\n\t\t\t}) as AnalyticalKPIDefinition | undefined;\n\n\t\t\tif (kpiDefinition) {\n\t\t\t\ttry {\n\t\t\t\t\tconst oModel = oKPITag.getModel() as ODataModel;\n\n\t\t\t\t\tconst popover = await this.getPopover(oKPITag);\n\t\t\t\t\t// Set the popover as modal while the card is loading (so that card rendering doesn't interfere with the popover and close it)\n\t\t\t\t\tpopover.setModal(true);\n\n\t\t\t\t\tthis.oCard.setManifest(oKPIModel.getProperty(`/${kpiID}/manifest`));\n\t\t\t\t\tthis.oCard.setPreviewMode(\"Abstract\"); // Display placeholders in the card until data is loaded\n\t\t\t\t\tpopover.openBy(oKPITag, false); // Open the popover immediately\n\n\t\t\t\t\tconst promises = [\n\t\t\t\t\t\tthis.loadKPITagData(kpiDefinition, oModel, oKPIModel, true),\n\t\t\t\t\t\tthis.loadKPICardData(kpiDefinition, oModel, oKPIModel)\n\t\t\t\t\t];\n\n\t\t\t\t\tawait Promise.all(promises);\n\t\t\t\t\tthis.oCard.attachEventOnce(\"stateChanged\", () => {\n\t\t\t\t\t\t// Once the card has been rendered, set the focus properly and set the popover as non-modal\n\t\t\t\t\t\t(this.oCard.getFocusDomRef() as HTMLElement)?.focus();\n\t\t\t\t\t\tpopover.setModal(false);\n\t\t\t\t\t});\n\t\t\t\t\tthis.oCard.setManifest(oKPIModel.getProperty(`/${kpiID}/manifest`));\n\t\t\t\t\tthis.oCard.refresh();\n\t\t\t\t\tthis.oCard.setPreviewMode(\"Off\"); // Display real data in the card\n\t\t\t\t} catch (err) {\n\t\t\t\t\tLog.error(err as string);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n}\n\nexport default KPIManagementControllerExtension;\n"],"mappings":"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","ignoreList":[],"file":"KPIManagement-dbg.js"}