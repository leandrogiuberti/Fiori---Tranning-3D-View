{"version":3,"file":"Recommendations.js","names":["Recommendations","_dec","defineUI5Class","_dec2","methodOverride","_dec3","_dec4","publicExtension","_dec5","_dec6","extensible","OverrideExecution","Instead","_dec7","_dec8","finalExtension","_dec9","_dec10","_dec11","_dec12","_dec13","_dec14","_dec15","_dec16","_class","_class2","_ControllerExtension","_this","call","this","dataToBeAccepted","_exports","_inheritsLoose","_proto","prototype","onInit","telemetry","Telemetry","allRecommendedFields","internalModel","base","getView","getModel","previousContext","undefined","onAfterBinding","async","context","currentContextBasePath","getPath","split","previousContextBasePath","rootContext","isRecommendationEnabled","getProperty","viewLevel","getViewData","_getRootContext","recommendations","isEnabled","setProperty","isFclEnabled","getAppComponent","_isFclEnabled","isFullScreen","getRootViewController","getHelper","getCurrentUIState","tryResetRecommendations","resetData","programmingModel","TransactionHelper","getProgrammingModel","CommonUtils","createRootContext","clearRecommendations","bindingContext","getBindingContext","recommendationHelper","_rootContext","fetchRecommendations","_context","Promise","resolve","fetchAndApplyRecommendations","currentContextsInfo","considerOnlyNewContext","isSuccess","sideEffects","getSideEffectsService","recommendationRegistry","getRecommendationsMapping","filteredContextsInfo","filter","contextInfo","standardRecommendationHelper","checkIfRecommendationRoleExistsForContext","contextsInfo","getContextsWithNoRecommendations","contexts","map","length","startTime","performance","now","recommendationData","endTime","updateResponseTimeInfo","updateAllRecommendedFields","updateDataFromRecommendationResponse","increaseCount","applyRecommendation","e","Log","error","storeRecommendationContexts","fetchAndApplyRecommendationsOnFieldChange","field","appComponent","isFieldRecommendationRelevant","checkIfFieldIsRecommendationRelevant","targets","fetchTargets","filteredRecommendationContexts","fetchFilteredRecommendationContexts","recommendationContext","filteredRecommendationContext","includes","clearIgnoredContexts","onBeforeAcceptRecommendations","_params","acceptRecommendations","promises","propertyPath","push","value","all","recommendationResponses","storeRecommendations","contextPaths","recommendationContexts","forEach","contextPath","index","indexOf","contextIdentifier","key","contextPathFromKey","substring","lastIndexOf","fetchFilteredRecommendationData","filteredTargets","filterRecommendationsData","Object","keys","assign","considerRecommendationContexts","version","isRecommendationAcceptable","splitPathAndCheckIfRecommendationAcceptable","ctxtPath","pathArray","newPath","newPathArray","slice","some","rightMostContext","getRightmostContext","dataToBeFiltered","fetchDataToBeFiltered","adjustAcceptAllParams","filterRecommendationData","filterRecommendationContexts","params","text","propertyPathFromKey","matchingContext","isRecommendationFieldNull","fetchAcceptAllParams","getController","addContextIdentifierText","checkIfRecommendationsExist","ignoreRecommendationForContexts","view","setCurrentRootContext","resetRecommendations","storeDataForTelemetry","recommendationOptionChoosen","RecommendationDialogDecision","Accept","updateData","Reject","storeData","increaseTelemetryDataCount","updateTelemetryDataBasedOnUserSelection","fieldPath","selectedValue","viewBindingContextPath","newRecommendationsForCurrentContexts","response","resetRejectedRecommendations","localAnnotationModel","getLocalAnnotationModel","rejectedRecommendations","startsWith","ControllerExtension","_applyDecoratedDescriptor","getOwnPropertyDescriptor"],"sources":["./Recommendations.ts"],"sourcesContent":["import Log from \"sap/base/Log\";\nimport { defineUI5Class, extensible, finalExtension, methodOverride, publicExtension } from \"sap/fe/base/ClassSupport\";\nimport type PageController from \"sap/fe/core/PageController\";\nimport { recommendationHelper } from \"sap/fe/core/helpers/RecommendationHelper\";\nimport type {\n\tRecommendationContextsInfo,\n\tRecommendationInfo,\n\tStandardRecommendationResponse\n} from \"sap/fe/core/helpers/StandardRecommendationHelper\";\nimport { standardRecommendationHelper } from \"sap/fe/core/helpers/StandardRecommendationHelper\";\nimport type Control from \"sap/ui/core/Control\";\nimport ControllerExtension from \"sap/ui/core/mvc/ControllerExtension\";\nimport OverrideExecution from \"sap/ui/core/mvc/OverrideExecution\";\nimport type Context from \"sap/ui/model/Context\";\nimport type JSONModel from \"sap/ui/model/json/JSONModel\";\nimport type { default as ODataV4Context } from \"sap/ui/model/odata/v4/Context\";\nimport type { FEView } from \"../BaseController\";\nimport CommonUtils from \"../CommonUtils\";\nimport type FclController from \"../rootView/Fcl.controller\";\nimport TransactionHelper from \"./editFlow/TransactionHelper\";\n\nimport { RecommendationDialogDecision } from \"../controls/Recommendations/ConfirmRecommendationDialog\";\nimport { type BaseManifestSettings } from \"../converters/ManifestSettings\";\nimport type { RecommendationTelemetry } from \"../services/TelemetryServiceFactory\";\nimport Telemetry from \"./recommendations/Telemetry\";\n\n/**\n * Parameters for the acceptRecommendations and onBeforeAcceptRecommendations methods.\n * @public\n */\nexport type AcceptAllParams = {\n\trecommendationData?: RecommendationData[];\n};\n\n/**\n * Represents a single recommendation entry.\n * @public\n */\nexport type RecommendationData = {\n\t/**\n\t * The OData V4 context associated with the recommendation.\n\t */\n\tcontext?: ODataV4Context;\n\n\t/**\n\t * An array of context identifiers relevant to the recommendation.\n\t */\n\tcontextIdentifier?: string[];\n\n\t/**\n\t * An array of context identifier texts for display purposes.\n\t */\n\tcontextIdentifierText?: string[];\n\n\t/**\n\t * The property path related to the recommendation.\n\t */\n\tpropertyPath?: string;\n\n\t/**\n\t * The value associated with the recommendation.\n\t */\n\tvalue?: string;\n\n\t/**\n\t * The display text for the recommendation.\n\t */\n\ttext?: string;\n};\n@defineUI5Class(\"sap.fe.core.controllerextensions.Recommendations\")\nexport default class Recommendations extends ControllerExtension {\n\tbase!: PageController;\n\n\trecommendationContexts!: RecommendationContextsInfo[];\n\n\trootContext!: Context | undefined;\n\n\tinternalModel!: JSONModel;\n\n\ttelemetry!: Telemetry;\n\n\tallRecommendedFields!: string[];\n\n\t// the data shown in Accept/Ignore dialog of Recommendations\n\tdataToBeAccepted: RecommendationData[] = [];\n\n\tpreviousContext: Context | null | undefined;\n\n\tconstructor() {\n\t\tsuper();\n\t}\n\n\t@methodOverride()\n\tonInit(): void {\n\t\tthis.telemetry = new Telemetry();\n\t\tthis.allRecommendedFields = [];\n\t\tthis.internalModel = this.base.getView().getModel(\"internal\");\n\t\tthis.previousContext = undefined;\n\t}\n\n\t@methodOverride(\"_routing\")\n\tasync onAfterBinding(context: Context | null): Promise<void> {\n\t\tif (context) {\n\t\t\tconst currentContextBasePath = context.getPath().split(\"/\")[1];\n\t\t\tconst previousContextBasePath = this.previousContext?.getPath().split(\"/\")[1];\n\t\t\t//\tconsole.log('current::', currentContextBasePath);\n\t\t\t//\tconsole.log('previous', previousContextBasePath);\n\t\t\tthis.rootContext = undefined;\n\t\t\t// use internal model because we have to use this information across the application for different instances.\n\t\t\tlet isRecommendationEnabled = this.internalModel.getProperty(\"/isRecommendationEnabled\");\n\t\t\t// onAfter binding is called for all contexts\n\t\t\t// but we do not need to call the isEnabled hook all the time\n\t\t\t// so check if recommendation enabled is already available\n\t\t\tthis.previousContext = context;\n\t\t\tconst viewLevel = (this.getView().getViewData() as BaseManifestSettings)?.viewLevel;\n\t\t\tconst rootContext: Context | undefined =\n\t\t\t\tviewLevel && viewLevel > 1 ? await this._getRootContext(context as ODataV4Context) : context;\n\t\t\tif (rootContext) {\n\t\t\t\tif (isRecommendationEnabled === undefined) {\n\t\t\t\t\tisRecommendationEnabled = this.base.recommendations.isEnabled(rootContext);\n\t\t\t\t\tthis.internalModel.setProperty(\"/isRecommendationEnabled\", isRecommendationEnabled);\n\t\t\t\t}\n\t\t\t\t//\tif(!this.previousContext) {\n\n\t\t\t\t//\t}\n\t\t\t\tconst isFclEnabled = this.base.getAppComponent()._isFclEnabled();\n\t\t\t\tconst isFullScreen = isFclEnabled\n\t\t\t\t\t? (this.base.getAppComponent().getRootViewController() as FclController).getHelper().getCurrentUIState().isFullScreen\n\t\t\t\t\t: true;\n\t\t\t\tif (currentContextBasePath !== previousContextBasePath) {\n\t\t\t\t\t// different contexts/ OP\n\t\t\t\t\t//\tconsole.log(\"run reset logic\")\n\t\t\t\t\tthis.tryResetRecommendations(rootContext as ODataV4Context);\n\t\t\t\t\tthis.telemetry.resetData();\n\t\t\t\t}\n\t\t\t\tif (isFclEnabled && !isFullScreen) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\tprivate async _getRootContext(context: ODataV4Context): Promise<Context | undefined> {\n\t\tconst programmingModel = TransactionHelper.getProgrammingModel(context);\n\t\treturn CommonUtils.createRootContext(programmingModel, this.base.getView(), this.base.getAppComponent());\n\t}\n\n\t/**\n\t * Clear all recommendations currently available on the UI.\n\t * @public\n\t */\n\t@publicExtension()\n\tpublic clearRecommendations(): void {\n\t\tconst bindingContext = this.getView().getBindingContext();\n\t\tif (bindingContext) {\n\t\t\trecommendationHelper.clearRecommendations(this.base.getView(), bindingContext);\n\t\t}\n\t}\n\n\t/**\n\t * Check if recommendations are enabled or not.\n\t * @param _rootContext The root entity context\n\t * @returns True if recommendation is enabled. False if recommendation is disabled.\n\t * @public\n\t */\n\t@publicExtension()\n\t@extensible(OverrideExecution.Instead)\n\tpublic isEnabled(_rootContext: Context): boolean {\n\t\treturn false;\n\t}\n\n\t/**\n\t * Method returns a boolean value indicating recommendation is enabled or not. In case called before\n\t * the enablement check is completed, method will return false which is the default value.\n\t * @returns True if recommendation is enabled else false.\n\t */\n\t@publicExtension()\n\t@finalExtension()\n\tpublic isRecommendationEnabled(): boolean {\n\t\treturn !!this.internalModel?.getProperty(\"/isRecommendationEnabled\");\n\t}\n\n\t/**\n\t * Fetch the recommendation for a specific context.\n\t * @param _context The context that shall be considered when fetching recommendations\n\t * @param _rootContext The root entity context\n\t * @returns The recommendation entries\n\t * @public\n\t */\n\t@publicExtension()\n\t@extensible(OverrideExecution.Instead)\n\tpublic async fetchRecommendations(_context: ODataV4Context[], _rootContext?: Context): Promise<StandardRecommendationResponse[]> {\n\t\treturn Promise.resolve([]);\n\t}\n\n\t/**\n\t * Fetch the recommendations and apply them on the UI.\n\t * @param currentContextsInfo Contexts Info that contains the context that shall be considered when fetching recommendations along with contextIdentifier\n\t * @param considerOnlyNewContext Boolean property indicating Recommendation\n\t * should be fetched only for new contexts with no recommendation fetch call\n\t * @returns `true` if the recommendations were fetched and applied correctly\n\t */\n\t@publicExtension()\n\tpublic async fetchAndApplyRecommendations(\n\t\tcurrentContextsInfo: RecommendationContextsInfo[],\n\t\tconsiderOnlyNewContext?: boolean\n\t): Promise<boolean> {\n\t\tlet isSuccess = false;\n\t\tconst sideEffects = this.base.getAppComponent().getSideEffectsService();\n\t\tconst recommendationRegistry = sideEffects.getRecommendationsMapping();\n\t\tconst filteredContextsInfo = currentContextsInfo.filter((contextInfo: RecommendationContextsInfo) => {\n\t\t\treturn standardRecommendationHelper.checkIfRecommendationRoleExistsForContext(contextInfo, recommendationRegistry);\n\t\t});\n\t\tif (this.isRecommendationEnabled()) {\n\t\t\tconst contextsInfo: RecommendationContextsInfo[] = considerOnlyNewContext\n\t\t\t\t? standardRecommendationHelper.getContextsWithNoRecommendations(filteredContextsInfo, this.internalModel)\n\t\t\t\t: filteredContextsInfo;\n\t\t\tconst contexts: ODataV4Context[] = contextsInfo.map(\n\t\t\t\t(contextInfo: RecommendationContextsInfo) => contextInfo.context\n\t\t\t) as ODataV4Context[];\n\t\t\tif (contexts && contexts.length > 0) {\n\t\t\t\ttry {\n\t\t\t\t\tconst rootContext = await this._getRootContext(contexts[0]);\n\t\t\t\t\tconst startTime = performance.now();\n\t\t\t\t\tconst recommendationData = await this.base.recommendations.fetchRecommendations(contexts, rootContext);\n\t\t\t\t\tconst endTime = performance.now();\n\t\t\t\t\tthis.telemetry.updateResponseTimeInfo(endTime - startTime);\n\t\t\t\t\tif (recommendationData?.length) {\n\t\t\t\t\t\tthis.updateAllRecommendedFields(recommendationData);\n\t\t\t\t\t\tthis.telemetry.updateDataFromRecommendationResponse(recommendationData);\n\t\t\t\t\t} else {\n\t\t\t\t\t\t// if empty recommendations, then store it for telemetry purpose\n\t\t\t\t\t\tthis.telemetry.increaseCount(\"numberOfTimesEmptyRecommendations\");\n\t\t\t\t\t}\n\t\t\t\t\t// need to validate that the response is properly formatted\n\t\t\t\t\tisSuccess = this.applyRecommendation(recommendationData, contexts);\n\t\t\t\t} catch (e) {\n\t\t\t\t\tLog.error(\"There was an error fetching the recommendations\", e as Error);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tthis.storeRecommendationContexts(filteredContextsInfo);\n\t\t}\n\n\t\treturn isSuccess;\n\t}\n\n\t/**\n\t * Fetch the recommendations on field change and apply them on the UI.\n\t * @param field The changed field.\n\t * @param contextInfo ContextInfo which contains the context is only considered when fetching the recommendations along with contextIdentifier\n\t * @returns `true` if the recommendation were fetched and applied correctly\n\t */\n\t@publicExtension()\n\tpublic async fetchAndApplyRecommendationsOnFieldChange(field: Control, contextInfo: RecommendationContextsInfo): Promise<boolean> {\n\t\tconst appComponent = this.base.getAppComponent();\n\t\tconst isFieldRecommendationRelevant = appComponent.getSideEffectsService().checkIfFieldIsRecommendationRelevant(field);\n\t\tif (isFieldRecommendationRelevant) {\n\t\t\t//getting the visible targets on the UI and their respective contexts\n\t\t\tconst targets = this.fetchTargets(true);\n\t\t\tconst filteredRecommendationContexts = this.fetchFilteredRecommendationContexts(targets);\n\t\t\t//filtering the child contexts from the available contexts\n\t\t\tconst recommendationContext = filteredRecommendationContexts.filter(function (filteredRecommendationContext) {\n\t\t\t\tif (\n\t\t\t\t\t(filteredRecommendationContext.context as ODataV4Context)\n\t\t\t\t\t\t.getPath()\n\t\t\t\t\t\t?.includes((contextInfo?.context as ODataV4Context).getPath())\n\t\t\t\t) {\n\t\t\t\t\treturn filteredRecommendationContext;\n\t\t\t\t}\n\t\t\t});\n\t\t\tstandardRecommendationHelper.clearIgnoredContexts(this.internalModel, (contextInfo?.context as ODataV4Context).getPath());\n\t\t\treturn this.fetchAndApplyRecommendations(recommendationContext);\n\t\t} else {\n\t\t\treturn false;\n\t\t}\n\t}\n\n\t/**\n\t * Returns the filtered recommendations from passed recommendations and then based on it we either show the filtered recommendations or not show the Accept all Dialog if there are no recommendations.\n\t * @param _params Params object containing recommendationData property which is an array of objects containing context, propertyPath, value and text for a recommendation\n\t * @param _params.recommendationData Array of recommendation data objects, each containing:\n\t * _params.recommendationData[].context The context for the recommendation.\n\t * _params.recommendationData[].contextIdentifier Unique identifier for the context.\n\t * _params.recommendationData[].propertyPath The property path for the recommended field.\n\t * _params.recommendationData[].value The recommended value.\n\t * _params.recommendationData[].text The display text for the recommendation.\n\t * @returns Promise\n\t * @public\n\t * @since 1.139.0\n\t */\n\t@publicExtension()\n\t@extensible(\"AfterAsync\")\n\tpublic async onBeforeAcceptRecommendations(_params: AcceptAllParams): Promise<void> {\n\t\t//do nothing\n\t\treturn Promise.resolve();\n\t}\n\n\t/**\n\t * This function is responsible for accepting the recommendations.\n\t * @param _params Params object containing recommendationData property which is an array of objects containing context, propertyPath, value and text for a recommendation\n\t * @returns Promise which resolved to a Boolean value based on whether recommendations are accepted or not\n\t */\n\t@publicExtension()\n\t@extensible(OverrideExecution.Instead)\n\tpublic async acceptRecommendations(_params: AcceptAllParams): Promise<boolean> {\n\t\t// the following code will be executed if there is no hook implementation i.e. for the new orchestration\n\t\tconst promises = [];\n\t\tif (_params.recommendationData) {\n\t\t\tfor (const recommendationData of _params.recommendationData) {\n\t\t\t\tif (recommendationData.context && recommendationData.propertyPath) {\n\t\t\t\t\tpromises.push(\n\t\t\t\t\t\trecommendationData.context.setProperty(recommendationData.propertyPath, recommendationData.value, \"$auto.abc\")\n\t\t\t\t\t);\n\t\t\t\t}\n\t\t\t}\n\t\t\tawait Promise.all(promises);\n\t\t}\n\t\treturn true;\n\t}\n\n\tprivate applyRecommendation(recommendationResponses: StandardRecommendationResponse[], _context: ODataV4Context[]): boolean {\n\t\tstandardRecommendationHelper.storeRecommendations(\n\t\t\trecommendationResponses,\n\t\t\tthis.getView().getModel(\"internal\") as JSONModel,\n\t\t\t_context\n\t\t);\n\t\treturn true;\n\t}\n\n\t/**\n\t * Stores the recommendation contexts.\n\t * @param contextsInfo\n\t */\n\tprivate storeRecommendationContexts(contextsInfo: RecommendationContextsInfo[]): void {\n\t\tconst contextPaths: string[] = [];\n\t\tlet recommendationContexts = this.internalModel.getProperty(\"/recommendationContexts\") || [];\n\t\tcontextsInfo.forEach((contextInfo: RecommendationContextsInfo) => {\n\t\t\tcontextPaths.push((contextInfo.context as ODataV4Context).getPath());\n\t\t});\n\n\t\trecommendationContexts = recommendationContexts?.filter((recommendationContext: RecommendationContextsInfo) => {\n\t\t\tconst context = recommendationContext?.context;\n\t\t\tif (context) {\n\t\t\t\tconst contextPath = context.getPath();\n\t\t\t\tconst index = contextPaths.indexOf(contextPath);\n\t\t\t\tif (index < 0) {\n\t\t\t\t\t// Existing context path is not found in the newly fetched recommendation & therefore don't do anything\n\t\t\t\t\treturn true;\n\t\t\t\t} else if (recommendationContext.contextIdentifier) {\n\t\t\t\t\t// Existing context path is found. we try to update the contextInfo with the latest context\n\t\t\t\t\t// instead of outdated one\n\t\t\t\t\tcontextsInfo[index].contextIdentifier = recommendationContext.contextIdentifier;\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn false;\n\t\t});\n\n\t\tthis.internalModel.setProperty(\"/recommendationContexts\", [...recommendationContexts, ...contextsInfo]);\n\t}\n\n\t/**\n\t * Filters the contexts and only returns those that matches the contexts.\n\t * @param targets\n\t * @returns Returns the filtered recommendation relevant contexts\n\t */\n\tprivate fetchFilteredRecommendationContexts(targets: string[]): RecommendationContextsInfo[] {\n\t\tconst contextPaths: string[] = [];\n\t\tconst filteredRecommendationContexts: RecommendationContextsInfo[] = [];\n\t\tfor (const key of targets) {\n\t\t\tconst contextPathFromKey = key.substring(0, key.lastIndexOf(\")\") + 1);\n\t\t\tconst recommendationContexts = (this.getView().getModel(\"internal\") as JSONModel).getProperty(\"/recommendationContexts\");\n\t\t\trecommendationContexts.forEach((contextInfo: RecommendationContextsInfo) => {\n\t\t\t\tconst context = contextInfo.context;\n\t\t\t\tif ((context as ODataV4Context).getPath() == contextPathFromKey && !contextPaths.includes(contextPathFromKey)) {\n\t\t\t\t\tcontextPaths.push(contextPathFromKey);\n\t\t\t\t\tfilteredRecommendationContexts.push(contextInfo);\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t\treturn filteredRecommendationContexts;\n\t}\n\n\t/**\n\t * Fetches RecommendationData based on filtered targets.\n\t * @param filteredTargets\n\t * @returns RecommendationData\n\t */\n\tprivate fetchFilteredRecommendationData(filteredTargets: string[]): RecommendationInfo {\n\t\tconst filterRecommendationsData: RecommendationInfo = {};\n\t\tconst recommendationData = this.getView().getModel(\"internal\")?.getProperty(\"/recommendationsData\");\n\t\tObject.keys(recommendationData).forEach((key: string) => {\n\t\t\tif (filteredTargets.includes(key)) {\n\t\t\t\tfilterRecommendationsData[key] = Object.assign(recommendationData[key], {});\n\t\t\t}\n\t\t});\n\t\treturn filterRecommendationsData;\n\t}\n\n\t/**\n\t * Fetches the filtered targets.\n\t * @param considerRecommendationContexts Passed as true when recommendation contexts should be considered instead of data\n\t * @returns Array of Filtered targets\n\t */\n\tprivate fetchTargets(considerRecommendationContexts?: boolean): string[] {\n\t\tconst recommendationData = this.getView().getModel(\"internal\")?.getProperty(\"/recommendationsData\");\n\t\tif (recommendationData.version === null) {\n\t\t\treturn [];\n\t\t}\n\t\tconst isFclEnabled = this.base.getAppComponent()._isFclEnabled();\n\t\tconst isFullScreen = isFclEnabled\n\t\t\t? (this.base.getAppComponent().getRootViewController() as FclController).getHelper().getCurrentUIState().isFullScreen\n\t\t\t: true;\n\t\tconst isRecommendationAcceptable = (contextPath: string, key: string): boolean => {\n\t\t\tconst splitPathAndCheckIfRecommendationAcceptable = (ctxtPath: string): boolean => {\n\t\t\t\tconst pathArray = key.split(ctxtPath);\n\t\t\t\tconst newPath = pathArray[1];\n\t\t\t\tlet newPathArray = newPath.split(\"/\");\n\t\t\t\t//here we check the path by splitting to decide whether to include recommendations or not in dialog\n\t\t\t\tif (newPathArray.length <= 3) {\n\t\t\t\t\treturn true;\n\t\t\t\t} else {\n\t\t\t\t\tnewPathArray = newPathArray.slice(2);\n\t\t\t\t\treturn !newPathArray.some((value: string) => value.includes(\"(\"));\n\t\t\t\t}\n\t\t\t};\n\t\t\tif (isFclEnabled && !isFullScreen) {\n\t\t\t\tconst rightMostContext = (this.base.getAppComponent().getRootViewController() as FclController).getRightmostContext();\n\t\t\t\tif (key.includes(rightMostContext?.getPath() as string)) {\n\t\t\t\t\treturn splitPathAndCheckIfRecommendationAcceptable(rightMostContext?.getPath() as string);\n\t\t\t\t} else {\n\t\t\t\t\treturn splitPathAndCheckIfRecommendationAcceptable(contextPath);\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\treturn splitPathAndCheckIfRecommendationAcceptable(contextPath);\n\t\t\t}\n\t\t};\n\n\t\tconst dataToBeFiltered = this.fetchDataToBeFiltered(recommendationData, considerRecommendationContexts);\n\t\treturn (\n\t\t\tdataToBeFiltered.filter((key: string) => {\n\t\t\t\treturn (\n\t\t\t\t\tkey.includes(this.getView().getBindingContext()?.getPath() as string) &&\n\t\t\t\t\tisRecommendationAcceptable(this.getView().getBindingContext()?.getPath() as string, key)\n\t\t\t\t);\n\t\t\t}) || []\n\t\t);\n\t}\n\n\t/**\n\t * Fetches the data to be filtered depending on the recommendationData.\n\t * @param recommendationData\n\t * @param considerRecommendationContexts Passed as true when recommendation contexts should be considered instead of data\n\t * @returns Array of contextPaths to be filtered\n\t */\n\tprivate fetchDataToBeFiltered(recommendationData: RecommendationInfo, considerRecommendationContexts: boolean | undefined): string[] {\n\t\tlet dataToBeFiltered: string[] = [];\n\t\t// consider recommendationContexts for fetching the paths in case of field change so that contexts for which empty recommendation data is returned are also considered\n\t\tif (considerRecommendationContexts) {\n\t\t\tconst recommendationContexts = this.getView().getModel(\"internal\")?.getProperty(\"/recommendationContexts\");\n\t\t\trecommendationContexts.forEach((recommendationContext: RecommendationContextsInfo) => {\n\t\t\t\tdataToBeFiltered.push((recommendationContext.context as ODataV4Context).getPath());\n\t\t\t});\n\t\t} else {\n\t\t\t// consider recommendationData in case of accept all dialog scenarios\n\t\t\tdataToBeFiltered = Object.keys(recommendationData).filter((key) => {\n\t\t\t\treturn key !== \"version\" && key !== \"keys\";\n\t\t\t});\n\t\t}\n\t\treturn dataToBeFiltered;\n\t}\n\n\t/**\n\t * Overwrites AcceptAll Params based of recommendation data and contexts.\n\t * @param filterRecommendationData\n\t * @param filterRecommendationContexts\n\t * @param params\n\t */\n\tprivate adjustAcceptAllParams(\n\t\tfilterRecommendationData: RecommendationInfo,\n\t\tfilterRecommendationContexts: RecommendationContextsInfo[],\n\t\tparams: AcceptAllParams\n\t): void {\n\t\tparams.recommendationData = [];\n\t\tfor (const key in filterRecommendationData) {\n\t\t\tif (filterRecommendationData[key].value || filterRecommendationData[key].text) {\n\t\t\t\t// In case there is no placeholder value or placeholder text then this recommendation is not relevant for Accept.\n\t\t\t\t// User needs to manually select the recommended value in these cases & therefore filter the same.\n\t\t\t\tconst contextPathFromKey = key.substring(0, key.lastIndexOf(\")\") + 1);\n\t\t\t\tconst propertyPathFromKey = key.substring(key.lastIndexOf(\")\") + 2);\n\t\t\t\tconst matchingContext = filterRecommendationContexts.filter(function (contextInfo) {\n\t\t\t\t\tif ((contextInfo?.context as ODataV4Context).getPath() === contextPathFromKey) {\n\t\t\t\t\t\treturn true;\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t\tif (\n\t\t\t\t\tmatchingContext?.length > 0 &&\n\t\t\t\t\tstandardRecommendationHelper.isRecommendationFieldNull(\n\t\t\t\t\t\tmatchingContext[0].context as ODataV4Context,\n\t\t\t\t\t\tkey,\n\t\t\t\t\t\tpropertyPathFromKey\n\t\t\t\t\t)\n\t\t\t\t) {\n\t\t\t\t\tparams.recommendationData.push({\n\t\t\t\t\t\tcontext: matchingContext[0].context,\n\t\t\t\t\t\tcontextIdentifier: matchingContext[0].contextIdentifier,\n\t\t\t\t\t\tpropertyPath: propertyPathFromKey,\n\t\t\t\t\t\tvalue: filterRecommendationData[key].value,\n\t\t\t\t\t\ttext: filterRecommendationData[key].text\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\t/**\n\t * Fetches RecommendationInfo that contains targets, filterRecommendationData, filterRecommendationContexts.\n\t * @returns Promise which resolves with AcceptallParams\n\t */\n\tpublic async fetchAcceptAllParams(): Promise<AcceptAllParams> {\n\t\tconst targets: string[] = this.fetchTargets();\n\t\tconst filterRecommendationData = this.fetchFilteredRecommendationData(targets);\n\t\tconst filterRecommendationContexts = this.fetchFilteredRecommendationContexts(targets);\n\t\tconst params = {};\n\t\tthis.adjustAcceptAllParams(filterRecommendationData, filterRecommendationContexts, params);\n\t\tawait (this.getView().getController() as PageController).recommendations.onBeforeAcceptRecommendations(params);\n\t\tstandardRecommendationHelper.addContextIdentifierText(params, this.getView()?.getBindingContext()?.getPath());\n\t\tthis.dataToBeAccepted = (params as AcceptAllParams).recommendationData || [];\n\t\treturn params;\n\t}\n\n\t/**\n\t * Checks if recommendations exist or not.\n\t * @returns Boolean value based on whether recommendations are present or not\n\t */\n\tpublic checkIfRecommendationsExist(): boolean {\n\t\tconst recommendationData = this.internalModel.getProperty(\"/recommendationsData\") || {};\n\t\treturn Object.keys(recommendationData).length !== 0;\n\t}\n\n\t/**\n\t * This function will clear recommendation Data for a given context and all its children.\n\t * @param contexts Context for which recommendation has to be cleared\n\t */\n\tpublic ignoreRecommendationForContexts(contexts?: ODataV4Context[]): void {\n\t\tif (!contexts || !contexts.length) {\n\t\t\tconst view = this.getView();\n\t\t\tconst bindingContext = view.getBindingContext() as ODataV4Context;\n\t\t\tcontexts = [bindingContext];\n\t\t}\n\t\tstandardRecommendationHelper.ignoreRecommendationForContexts(contexts, this.internalModel);\n\t}\n\n\tprivate tryResetRecommendations(rootContext: ODataV4Context): void {\n\t\tstandardRecommendationHelper.setCurrentRootContext(rootContext);\n\t\t// TODO: StandardRecommendationHelper stores all the recommendations for an instance of business object\n\t\t// meaning doesn't matter the recommendations are on the OP/SubOP. But the recommendations contexts here\n\t\t// is specific to this controller, SubOP controller will have its own recommendation contexts. Ideally it\n\t\t// should be cleared but this is not done here. This complete thing needs to be refactored\n\t\tthis.internalModel.setProperty(\"/recommendationContexts\", []);\n\t\tstandardRecommendationHelper.resetRecommendations(this.internalModel);\n\t}\n\n\t/**\n\t * This function will store the number of fields Accepted/Ignored when Save button is clicked, depending on which recommedation option was choosen Accept/Reject and Save.\n\t * @param recommendationOptionChoosen\n\t */\n\tpublic async storeDataForTelemetry(recommendationOptionChoosen: undefined | RecommendationDialogDecision): Promise<void> {\n\t\tconst rootContext = await this._getRootContext(this.getView().getBindingContext() as ODataV4Context);\n\t\tif (rootContext && this.base.recommendations.isEnabled(rootContext)) {\n\t\t\tif (recommendationOptionChoosen === RecommendationDialogDecision.Accept) {\n\t\t\t\t// increase accept count\n\t\t\t\tthis.telemetry.updateData(\"numberOfFieldsAcceptedThroughAcceptButton\", this.dataToBeAccepted.length);\n\t\t\t} else if (recommendationOptionChoosen === RecommendationDialogDecision.Reject) {\n\t\t\t\t// increase ignore count\n\t\t\t\tthis.telemetry.updateData(\"numberOfFieldsIgnoredThroughIgnoreButton\", this.dataToBeAccepted.length);\n\t\t\t}\n\t\t\tthis.telemetry.storeData(this.getView() as FEView);\n\t\t}\n\t}\n\n\t/**\n\t * This function will update the count by 1 in telemetry data.\n\t * @param key\n\t */\n\tpublic increaseTelemetryDataCount(key: keyof RecommendationTelemetry): void {\n\t\tthis.telemetry.increaseCount(key);\n\t}\n\n\t/**\n\t * This function will update telemetry data for which option user chose when selecting a field value, as top/non-top recommendation or some other value.\n\t * @param fieldPath\n\t * @param selectedValue\n\t */\n\tpublic updateTelemetryDataBasedOnUserSelection(fieldPath: string, selectedValue: string): void {\n\t\tthis.telemetry.updateTelemetryDataBasedOnUserSelection(this.getView(), fieldPath, selectedValue);\n\t}\n\n\t/**\n\t * This function will update the total number of fields recommended. If the field is already included in telemetry count then we do not include.\n\t * This way we know the total number of unique fields recommended.\n\t * @param recommendationData\n\t */\n\tupdateAllRecommendedFields(recommendationData: StandardRecommendationResponse[]): void {\n\t\tconst viewBindingContextPath = (this.getView().getBindingContext() as Context).getPath();\n\t\tconst newRecommendationsForCurrentContexts = recommendationData.filter(\n\t\t\t(response) => response[\"AIRecommendedFieldPath\"]?.includes(viewBindingContextPath)\n\t\t);\n\t\tif (!this.allRecommendedFields) {\n\t\t\tthis.allRecommendedFields = [];\n\t\t}\n\t\tnewRecommendationsForCurrentContexts.forEach((response) => {\n\t\t\tconst fieldPath = response[\"AIRecommendedFieldPath\"];\n\t\t\tif (fieldPath) {\n\t\t\t\tif (!this.allRecommendedFields.includes(fieldPath)) {\n\t\t\t\t\tthis.allRecommendedFields.push(fieldPath);\n\t\t\t\t\tthis.telemetry.increaseCount(\"numberOfRecommendedFields\");\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t}\n\n\t/**\n\t * Clears all rejected recommendations from the local annotation model for the given context.\n\t * This resets the \"/rejectedRecommendations\" property to an empty object.\n\t * @param context The ODataV4 context for which rejected recommendations should be reset.\n\t */\n\tresetRejectedRecommendations(context: ODataV4Context): void {\n\t\tconst localAnnotationModel = context.getModel()?.getLocalAnnotationModel();\n\t\tconst rejectedRecommendations = localAnnotationModel?.getProperty(\"/rejectedRecommendations\");\n\t\tObject.keys(rejectedRecommendations || {}).forEach((key) => {\n\t\t\tif (key.startsWith(context.getPath())) {\n\t\t\t\tdelete rejectedRecommendations[key];\n\t\t\t}\n\t\t});\n\t\tlocalAnnotationModel?.setProperty(\"/rejectedRecommendations\", rejectedRecommendations);\n\t}\n}\n"],"mappings":"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","ignoreList":[]}