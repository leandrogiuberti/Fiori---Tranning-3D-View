{"version":3,"names":["IViewStateContributorMixin","_ref","apply","arguments","_exports","_inheritsLoose","_proto","prototype","getInterfaceName","interfaceName","setupMixin","baseClass","_getOwner","inControl","owner","Component","getOwnerComponentFor","control","isA","getParent","getPageController","getRootController","_stateContributorChangeEventHandler","ev","pageControllerInHandler","getSource","viewState","registerStateContributor","detachEvent","baseInit","init","call","pageController","attachEvent","baseDestroy","destroy","deregisterStateContributor","IViewStateContributor"],"sourceRoot":".","sources":["IViewStateContributorMixin.ts"],"sourcesContent":["import type { FEView } from \"sap/fe/core/BaseController\";\n\nimport type { IInterfaceWithMixin } from \"sap/fe/base/ClassSupport\";\nimport type PageController from \"sap/fe/core/PageController\";\nimport type TemplateComponent from \"sap/fe/core/TemplateComponent\";\nimport type { ControlState, NavigationParameter } from \"sap/fe/core/controllerextensions/ViewState\";\nimport IViewStateContributor from \"sap/fe/core/controllerextensions/viewState/IViewStateContributor\";\nimport type ManagedObject from \"sap/ui/base/ManagedObject\";\nimport type { ManagedObject$ModelContextChangeEvent } from \"sap/ui/base/ManagedObject\";\nimport Component from \"sap/ui/core/Component\";\nimport type Control from \"sap/ui/core/Control\";\n\nexport default abstract class IViewStateContributorMixin<StateDefinition>\n\textends IViewStateContributor<StateDefinition>\n\timplements IInterfaceWithMixin\n{\n\tstatic interfaceName = \"sap.fe.core.controllerextensions.viewState.IViewStateContributor\";\n\n\tgetInterfaceName(): string {\n\t\treturn IViewStateContributorMixin.interfaceName;\n\t}\n\n\tabstract retrieveState(): Promise<StateDefinition | null> | StateDefinition | null;\n\n\tabstract applyState(\n\t\tstate: StateDefinition,\n\t\toNavParameters?: NavigationParameter,\n\t\tshouldApplyDiffState?: boolean,\n\t\tskipMerge?: boolean\n\t): Promise<void> | void;\n\n\t/**\n\t * Sets the initial state of the control by retrieving the external state at the time of apply.\n\t * Also updates the initial state of the specified variant controls\n\t * @returns A promise that resolves when the initial state has been set.\n\t */\n\tabstract setInitialState?(): Promise<void>;\n\n\t/**\n\t * Abstract method to apply legacy state to a view.\n\t * @abstract\n\t * @param {Function} [getContrilState] Optional function to get the control state, accepting a `ManagedObject` and returning a `ControlState`.\n\t * @param {NavigationParameter} [oNavParameters] Optional navigation parameters that might influence the state application.\n\t * @param {boolean} [shouldApplyDiffState] Optional flag indicating whether a differential state application should be performed.\n\t * @returns {Promise<void>} - A promise that resolves when the state has been applied.\n\t */\n\tabstract applyLegacyState?(\n\t\tgetContrilState?: (control: ManagedObject) => ControlState,\n\t\toNavParameters?: NavigationParameter,\n\t\tshouldApplyDiffState?: boolean,\n\t\tskipMerge?: boolean\n\t): Promise<void>;\n\n\tsetupMixin(baseClass: Function): void {\n\t\tfunction _getOwner(inControl: Control): TemplateComponent | undefined {\n\t\t\tlet owner = Component.getOwnerComponentFor(inControl);\n\t\t\tlet control: Control | undefined = inControl;\n\t\t\twhile (!owner && control && !control.isA<FEView>(\"sap.ui.core.mvc.View\")) {\n\t\t\t\tcontrol = control.getParent() as Control | undefined;\n\t\t\t\tif (control) {\n\t\t\t\t\towner = Component.getOwnerComponentFor(control);\n\t\t\t\t}\n\t\t\t}\n\t\t\tif (owner?.isA<TemplateComponent>(\"sap.fe.core.TemplateComponent\")) {\n\t\t\t\treturn owner;\n\t\t\t}\n\t\t}\n\n\t\tfunction getPageController(inControl: Control): PageController | undefined {\n\t\t\treturn _getOwner(inControl)?.getRootController();\n\t\t}\n\n\t\tfunction _stateContributorChangeEventHandler(ev: ManagedObject$ModelContextChangeEvent): void {\n\t\t\tconst pageControllerInHandler = getPageController(ev.getSource());\n\t\t\tif (pageControllerInHandler) {\n\t\t\t\tpageControllerInHandler?.viewState?.registerStateContributor(ev.getSource());\n\t\t\t\tev.getSource().detachEvent(\"modelContextChange\", _stateContributorChangeEventHandler);\n\t\t\t}\n\t\t}\n\n\t\tconst baseInit = baseClass.prototype.init;\n\t\tbaseClass.prototype.init = function (): void {\n\t\t\tbaseInit?.call(this);\n\t\t\tconst pageController = getPageController(this);\n\t\t\tif (!pageController) {\n\t\t\t\tthis.attachEvent(\"modelContextChange\", _stateContributorChangeEventHandler);\n\t\t\t} else {\n\t\t\t\tpageController.viewState.registerStateContributor(this as unknown as ManagedObject & IViewStateContributor<unknown>);\n\t\t\t}\n\t\t};\n\t\tconst baseDestroy = baseClass.prototype.destroy;\n\t\tbaseClass.prototype.destroy = function (): void {\n\t\t\tgetPageController(this)?.viewState?.deregisterStateContributor(\n\t\t\t\tthis as unknown as ManagedObject & IViewStateContributor<unknown>\n\t\t\t);\n\t\t\tbaseDestroy?.call(this);\n\t\t};\n\t}\n}\n"],"mappings":";;;;;;;;;;MAY8BA,0BAA0B,0BAAAC,IAAA;IAAA,SAAAD,2BAAA;MAAA,OAAAC,IAAA,CAAAC,KAAA,OAAAC,SAAA;IAAA;IAAAC,QAAA,GAAAJ,0BAAA;IAAAK,cAAA,CAAAL,0BAAA,EAAAC,IAAA;IAAA,IAAAK,MAAA,GAAAN,0BAAA,CAAAO,SAAA;IAAAD,MAAA,CAMvDE,gBAAgB,GAAhB,SAAAA,gBAAgBA,CAAA,EAAW;MAC1B,OAAOR,0BAA0B,CAACS,aAAa;IAChD,CAAC;IAAAH,MAAA,CAiCDI,UAAU,GAAV,SAAAA,UAAUA,CAACC,SAAmB,EAAQ;MACrC,SAASC,SAASA,CAACC,SAAkB,EAAiC;QACrE,IAAIC,KAAK,GAAGC,SAAS,CAACC,oBAAoB,CAACH,SAAS,CAAC;QACrD,IAAII,OAA4B,GAAGJ,SAAS;QAC5C,OAAO,CAACC,KAAK,IAAIG,OAAO,IAAI,CAACA,OAAO,CAACC,GAAG,CAAS,sBAAsB,CAAC,EAAE;UACzED,OAAO,GAAGA,OAAO,CAACE,SAAS,CAAC,CAAwB;UACpD,IAAIF,OAAO,EAAE;YACZH,KAAK,GAAGC,SAAS,CAACC,oBAAoB,CAACC,OAAO,CAAC;UAChD;QACD;QACA,IAAIH,KAAK,EAAEI,GAAG,CAAoB,+BAA+B,CAAC,EAAE;UACnE,OAAOJ,KAAK;QACb;MACD;MAEA,SAASM,iBAAiBA,CAACP,SAAkB,EAA8B;QAC1E,OAAOD,SAAS,CAACC,SAAS,CAAC,EAAEQ,iBAAiB,CAAC,CAAC;MACjD;MAEA,SAASC,mCAAmCA,CAACC,EAAyC,EAAQ;QAC7F,MAAMC,uBAAuB,GAAGJ,iBAAiB,CAACG,EAAE,CAACE,SAAS,CAAC,CAAC,CAAC;QACjE,IAAID,uBAAuB,EAAE;UAC5BA,uBAAuB,EAAEE,SAAS,EAAEC,wBAAwB,CAACJ,EAAE,CAACE,SAAS,CAAC,CAAC,CAAC;UAC5EF,EAAE,CAACE,SAAS,CAAC,CAAC,CAACG,WAAW,CAAC,oBAAoB,EAAEN,mCAAmC,CAAC;QACtF;MACD;MAEA,MAAMO,QAAQ,GAAGlB,SAAS,CAACJ,SAAS,CAACuB,IAAI;MACzCnB,SAAS,CAACJ,SAAS,CAACuB,IAAI,GAAG,YAAkB;QAC5CD,QAAQ,EAAEE,IAAI,CAAC,IAAI,CAAC;QACpB,MAAMC,cAAc,GAAGZ,iBAAiB,CAAC,IAAI,CAAC;QAC9C,IAAI,CAACY,cAAc,EAAE;UACpB,IAAI,CAACC,WAAW,CAAC,oBAAoB,EAAEX,mCAAmC,CAAC;QAC5E,CAAC,MAAM;UACNU,cAAc,CAACN,SAAS,CAACC,wBAAwB,CAAC,IAAiE,CAAC;QACrH;MACD,CAAC;MACD,MAAMO,WAAW,GAAGvB,SAAS,CAACJ,SAAS,CAAC4B,OAAO;MAC/CxB,SAAS,CAACJ,SAAS,CAAC4B,OAAO,GAAG,YAAkB;QAC/Cf,iBAAiB,CAAC,IAAI,CAAC,EAAEM,SAAS,EAAEU,0BAA0B,CAC7D,IACD,CAAC;QACDF,WAAW,EAAEH,IAAI,CAAC,IAAI,CAAC;MACxB,CAAC;IACF,CAAC;IAAA,OAAA/B,0BAAA;EAAA,EApFOqC,qBAAqB;EADArC,0BAA0B,CAIhDS,aAAa,GAAG,kEAAkE;EAAAL,QAAA,GAAAJ,0BAAA;EAAA,OAAAI,QAAA;AAAA","ignoreList":[],"file":"IViewStateContributorMixin-dbg.js"}