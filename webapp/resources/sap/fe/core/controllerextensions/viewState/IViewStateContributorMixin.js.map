{"version":3,"file":"IViewStateContributorMixin.js","names":["IViewStateContributorMixin","_ref","apply","this","arguments","_exports","_inheritsLoose","_proto","prototype","getInterfaceName","interfaceName","setupMixin","baseClass","_getOwner","inControl","owner","Component","getOwnerComponentFor","control","isA","getParent","getPageController","getRootController","_stateContributorChangeEventHandler","ev","pageControllerInHandler","getSource","viewState","registerStateContributor","detachEvent","baseInit","init","call","pageController","attachEvent","baseDestroy","destroy","deregisterStateContributor","IViewStateContributor"],"sources":["./IViewStateContributorMixin.ts"],"sourcesContent":["import type { FEView } from \"sap/fe/core/BaseController\";\n\nimport type { IInterfaceWithMixin } from \"sap/fe/base/ClassSupport\";\nimport type PageController from \"sap/fe/core/PageController\";\nimport type TemplateComponent from \"sap/fe/core/TemplateComponent\";\nimport type { ControlState, NavigationParameter } from \"sap/fe/core/controllerextensions/ViewState\";\nimport IViewStateContributor from \"sap/fe/core/controllerextensions/viewState/IViewStateContributor\";\nimport type ManagedObject from \"sap/ui/base/ManagedObject\";\nimport type { ManagedObject$ModelContextChangeEvent } from \"sap/ui/base/ManagedObject\";\nimport Component from \"sap/ui/core/Component\";\nimport type Control from \"sap/ui/core/Control\";\n\nexport default abstract class IViewStateContributorMixin<StateDefinition>\n\textends IViewStateContributor<StateDefinition>\n\timplements IInterfaceWithMixin\n{\n\tstatic interfaceName = \"sap.fe.core.controllerextensions.viewState.IViewStateContributor\";\n\n\tgetInterfaceName(): string {\n\t\treturn IViewStateContributorMixin.interfaceName;\n\t}\n\n\tabstract retrieveState(): Promise<StateDefinition | null> | StateDefinition | null;\n\n\tabstract applyState(\n\t\tstate: StateDefinition,\n\t\toNavParameters?: NavigationParameter,\n\t\tshouldApplyDiffState?: boolean,\n\t\tskipMerge?: boolean\n\t): Promise<void> | void;\n\n\t/**\n\t * Sets the initial state of the control by retrieving the external state at the time of apply.\n\t * Also updates the initial state of the specified variant controls\n\t * @returns A promise that resolves when the initial state has been set.\n\t */\n\tabstract setInitialState?(): Promise<void>;\n\n\t/**\n\t * Abstract method to apply legacy state to a view.\n\t * @abstract\n\t * @param {Function} [getContrilState] Optional function to get the control state, accepting a `ManagedObject` and returning a `ControlState`.\n\t * @param {NavigationParameter} [oNavParameters] Optional navigation parameters that might influence the state application.\n\t * @param {boolean} [shouldApplyDiffState] Optional flag indicating whether a differential state application should be performed.\n\t * @returns {Promise<void>} - A promise that resolves when the state has been applied.\n\t */\n\tabstract applyLegacyState?(\n\t\tgetContrilState?: (control: ManagedObject) => ControlState,\n\t\toNavParameters?: NavigationParameter,\n\t\tshouldApplyDiffState?: boolean,\n\t\tskipMerge?: boolean\n\t): Promise<void>;\n\n\tsetupMixin(baseClass: Function): void {\n\t\tfunction _getOwner(inControl: Control): TemplateComponent | undefined {\n\t\t\tlet owner = Component.getOwnerComponentFor(inControl);\n\t\t\tlet control: Control | undefined = inControl;\n\t\t\twhile (!owner && control && !control.isA<FEView>(\"sap.ui.core.mvc.View\")) {\n\t\t\t\tcontrol = control.getParent() as Control | undefined;\n\t\t\t\tif (control) {\n\t\t\t\t\towner = Component.getOwnerComponentFor(control);\n\t\t\t\t}\n\t\t\t}\n\t\t\tif (owner?.isA<TemplateComponent>(\"sap.fe.core.TemplateComponent\")) {\n\t\t\t\treturn owner;\n\t\t\t}\n\t\t}\n\n\t\tfunction getPageController(inControl: Control): PageController | undefined {\n\t\t\treturn _getOwner(inControl)?.getRootController();\n\t\t}\n\n\t\tfunction _stateContributorChangeEventHandler(ev: ManagedObject$ModelContextChangeEvent): void {\n\t\t\tconst pageControllerInHandler = getPageController(ev.getSource());\n\t\t\tif (pageControllerInHandler) {\n\t\t\t\tpageControllerInHandler?.viewState?.registerStateContributor(ev.getSource());\n\t\t\t\tev.getSource().detachEvent(\"modelContextChange\", _stateContributorChangeEventHandler);\n\t\t\t}\n\t\t}\n\n\t\tconst baseInit = baseClass.prototype.init;\n\t\tbaseClass.prototype.init = function (): void {\n\t\t\tbaseInit?.call(this);\n\t\t\tconst pageController = getPageController(this);\n\t\t\tif (!pageController) {\n\t\t\t\tthis.attachEvent(\"modelContextChange\", _stateContributorChangeEventHandler);\n\t\t\t} else {\n\t\t\t\tpageController.viewState.registerStateContributor(this as unknown as ManagedObject & IViewStateContributor<unknown>);\n\t\t\t}\n\t\t};\n\t\tconst baseDestroy = baseClass.prototype.destroy;\n\t\tbaseClass.prototype.destroy = function (): void {\n\t\t\tgetPageController(this)?.viewState?.deregisterStateContributor(\n\t\t\t\tthis as unknown as ManagedObject & IViewStateContributor<unknown>\n\t\t\t);\n\t\t\tbaseDestroy?.call(this);\n\t\t};\n\t}\n}\n"],"mappings":";;;;oWAY8BA,EAA0B,SAAAC,GAAA,SAAAD,IAAA,OAAAC,EAAAC,MAAAC,KAAAC,YAAAD,IAAA,CAAAE,EAAAL,EAAAM,EAAAN,EAAAC,GAAA,IAAAM,EAAAP,EAAAQ,UAAAD,EAMvDE,iBAAA,SAAAA,IACC,OAAOT,EAA2BU,aACnC,EAACH,EAiCDI,WAAA,SAAAA,EAAWC,GACV,SAASC,EAAUC,GAClB,IAAIC,EAAQC,EAAUC,qBAAqBH,GAC3C,IAAII,EAA+BJ,EACnC,OAAQC,GAASG,IAAYA,EAAQC,IAAY,wBAAyB,CACzED,EAAUA,EAAQE,YAClB,GAAIF,EAAS,CACZH,EAAQC,EAAUC,qBAAqBC,EACxC,CACD,CACA,GAAIH,GAAOI,IAAuB,iCAAkC,CACnE,OAAOJ,CACR,CACD,CAEA,SAASM,EAAkBP,GAC1B,OAAOD,EAAUC,IAAYQ,mBAC9B,CAEA,SAASC,EAAoCC,GAC5C,MAAMC,EAA0BJ,EAAkBG,EAAGE,aACrD,GAAID,EAAyB,CAC5BA,GAAyBE,WAAWC,yBAAyBJ,EAAGE,aAChEF,EAAGE,YAAYG,YAAY,qBAAsBN,EAClD,CACD,CAEA,MAAMO,EAAWlB,EAAUJ,UAAUuB,KACrCnB,EAAUJ,UAAUuB,KAAO,WAC1BD,GAAUE,KAAK7B,MACf,MAAM8B,EAAiBZ,EAAkBlB,MACzC,IAAK8B,EAAgB,CACpB9B,KAAK+B,YAAY,qBAAsBX,EACxC,KAAO,CACNU,EAAeN,UAAUC,yBAAyBzB,KACnD,CACD,EACA,MAAMgC,EAAcvB,EAAUJ,UAAU4B,QACxCxB,EAAUJ,UAAU4B,QAAU,WAC7Bf,EAAkBlB,OAAOwB,WAAWU,2BACnClC,MAEDgC,GAAaH,KAAK7B,KACnB,CACD,EAAC,OAAAH,CAAA,CArFsD,CAC/CsC,GADqBtC,EAItBU,cAAgB,mEAAkEL,EAAAL,EAAA,OAAAK,CAAA","ignoreList":[]}