{"version":3,"file":"CollaborationCommon.js","names":["UserStatus","_exports","UserEditingState","Activity","formatInitials","fullName","academicTitles","forEach","academicTitle","replace","initials","parts","trimStart","split","length","shift","charAt","pop","substring","toUpperCase","getUserColor","UserID","activeUsers","invitedUsers","user","find","u","id","color","i","findIndex","getAppComponent","oControl","isA","oOwner","Component","getOwnerComponentFor","getMe","appComponent","shellServiceHelper","getShellServices","name","hasUShell","getUserInitials","getUser","getId","getFullName","window","adt","userID","userName","getText","initialName","me","status","CurrentlyEditing","textId","oResourceModel","Library","getResourceBundleFor","_len","arguments","args","Array","_key","CollaborationUtils","async","addSelf","context","model","getModel","metaModel","getMetaModel","entitySet","getMetaPath","getPath","shareActionName","getObject","shareAction","bindContext","setParameter","invoke","undefined","shareObject","bindingContext","users","groupId","getActivityKeyFromPath","path","lastIndexOf","CollaborationFieldGroupPrefix"],"sources":["./CollaborationCommon.ts"],"sourcesContent":["import type AppComponent from \"sap/fe/core/AppComponent\";\nimport Component from \"sap/ui/core/Component\";\n\nimport type Control from \"sap/ui/core/Control\";\nimport Library from \"sap/ui/core/Lib\";\nimport type Context from \"sap/ui/model/odata/v4/Context\";\n\n// ADT Preview provides the user name and id for collaboration draft\ndeclare global {\n\tinterface Window {\n\t\tadt: {\n\t\t\tuserName: string;\n\t\t\tuserID: string;\n\t\t};\n\t}\n}\n\nexport enum UserStatus {\n\tNotYetInvited = 0,\n\tNoChangesMade = 1,\n\tChangesMade = 2,\n\tCurrentlyEditing = 3\n}\n\nexport enum UserEditingState {\n\tNoChanges = \"N\",\n\tInProgress = \"P\"\n}\n\nexport type User = {\n\tid: string;\n\tinitials?: string;\n\tname: string;\n\tcolor?: string;\n\ttransient?: boolean;\n\tstatus?: UserStatus;\n\tme?: boolean;\n\tinitialName?: string;\n};\n\n// backend representation of a user according to collaboration draft spec\nexport type BackendUser = {\n\tUserID: string;\n\tUserAccessRole: string;\n\tUserEditingState?: UserEditingState;\n\tUserDescription?: string;\n};\n\nexport type UserActivity = User & {\n\tkey?: string;\n};\n\nexport enum Activity {\n\tJoin = \"JOIN\",\n\tJoinEcho = \"JOINECHO\",\n\tLeave = \"LEAVE\",\n\tChange = \"CHANGE\",\n\tCreate = \"CREATE\",\n\tDelete = \"DELETE\",\n\tAction = \"ACTION\",\n\tLock = \"LOCK\",\n\tLockEcho = \"LOCKECHO\",\n\tActivate = \"ACTIVATE\",\n\tDiscard = \"DISCARD\",\n\tUnlock = \"UNLOCK\"\n}\n\nexport type Message = {\n\tuserDescription: string;\n\tuserID: string;\n\tuserAction: string;\n\tclientAction: string;\n\tclientTriggeredActionName?: string;\n\tclientRefreshListBinding?: string;\n\tclientRequestedProperties?: string;\n\tclientContent: string;\n};\n\nfunction formatInitials(fullName: string): string {\n\t// remove titles - those are the ones from S/4 to be checked if there are others\n\tconst academicTitles = [\"Dr.\", \"Prof.\", \"Prof. Dr.\", \"B.A.\", \"MBA\", \"Ph.D.\"];\n\tacademicTitles.forEach(function (academicTitle) {\n\t\tfullName = fullName.replace(academicTitle, \"\");\n\t});\n\n\tlet initials: string;\n\tconst parts = fullName.trimStart().split(\" \");\n\n\tif (parts.length > 1) {\n\t\tinitials = (parts?.shift()?.charAt(0) || \"\") + parts.pop()?.charAt(0);\n\t} else {\n\t\tinitials = fullName.substring(0, 2);\n\t}\n\n\treturn initials.toUpperCase();\n}\n\nfunction getUserColor(UserID: string, activeUsers: User[], invitedUsers: User[]): string | undefined {\n\t// search if user is known\n\tconst user = activeUsers.find((u) => u.id === UserID);\n\tif (user) {\n\t\treturn user.color;\n\t} else {\n\t\t// search for next free color\n\t\tfor (let i = 1; i <= 10; i++) {\n\t\t\tif (\n\t\t\t\tactiveUsers.findIndex((u) => u.color === `Accent${i}`) === -1 &&\n\t\t\t\tinvitedUsers.findIndex((u) => u.color === `Accent${i}`) === -1\n\t\t\t) {\n\t\t\t\treturn `Accent${i}`;\n\t\t\t}\n\t\t}\n\t\t// this seems to be a popular object :) for now just return 10 for all.\n\t\t// for invited we should start from 1 again so the colors are different\n\t\treturn \"Accent10\";\n\t}\n}\n\n// copied from CommonUtils. Due to a cycle dependency I can't use CommonUtils here.\n// That's to be fixed. the discard popover thingy shouldn't be in the common utils at all\nfunction getAppComponent(oControl: Control | Component): AppComponent {\n\tif (oControl.isA<AppComponent>(\"sap.fe.core.AppComponent\")) {\n\t\treturn oControl;\n\t}\n\tconst oOwner = Component.getOwnerComponentFor(oControl);\n\tif (!oOwner) {\n\t\treturn oControl as AppComponent;\n\t} else {\n\t\treturn getAppComponent(oOwner);\n\t}\n}\n\nfunction getMe(appComponent: AppComponent): User {\n\tconst shellServiceHelper = appComponent.getShellServices();\n\tlet initials, id, name;\n\tif (shellServiceHelper?.hasUShell()) {\n\t\tinitials = shellServiceHelper.getUserInitials();\n\t\tid = shellServiceHelper.getUser().getId();\n\t\tname = shellServiceHelper.getUser().getFullName();\n\t} else if (window.adt) {\n\t\t// check if we are in ADT preview, if so use the user provided by ADT\n\t\tid = window.adt.userID;\n\t\tname = window.adt.userName;\n\t\tinitials = formatInitials(name);\n\t} else {\n\t\tthrow \"No Shell... No User\";\n\t}\n\n\treturn {\n\t\tinitials: initials,\n\t\tid: id,\n\t\tname: getText(\"C_COLLABORATIONDRAFT_ME\", name),\n\t\tinitialName: name,\n\t\tcolor: \"Accent6\", //  same color as FLP...\n\t\tme: true,\n\t\tstatus: UserStatus.CurrentlyEditing\n\t};\n}\n\nexport function getText(textId: string, ...args: string[]): string {\n\tconst oResourceModel = Library.getResourceBundleFor(\"sap.fe.core\")!;\n\treturn oResourceModel.getText(textId, args);\n}\n\nexport const CollaborationUtils = {\n\tformatInitials: formatInitials,\n\tgetUserColor: getUserColor,\n\tgetMe: getMe,\n\tgetAppComponent: getAppComponent,\n\tgetText: getText\n};\n\nexport async function addSelf(context: Context): Promise<Context> {\n\tconst model = context.getModel();\n\tconst metaModel = model.getMetaModel();\n\tconst entitySet = metaModel.getMetaPath(context.getPath());\n\tconst shareActionName = metaModel.getObject(`${entitySet}@com.sap.vocabularies.Common.v1.DraftRoot/ShareAction`);\n\tconst shareAction = model.bindContext(`${shareActionName}(...)`, context);\n\tshareAction.setParameter(\"Users\", []);\n\tshareAction.setParameter(\"ShareAll\", true);\n\tshareAction.setParameter(\"IsDeltaUpdate\", true);\n\tshareAction.setParameter(\"If-Match\", \"*\");\n\treturn shareAction.invoke(undefined, true);\n}\n\nexport async function shareObject(bindingContext: Context, users: BackendUser[] = [], groupId = \"$auto.Workers\"): Promise<Context> {\n\tconst model = bindingContext.getModel();\n\tconst metaModel = model.getMetaModel();\n\tconst entitySet = metaModel.getMetaPath(bindingContext.getPath());\n\tconst shareActionName = metaModel.getObject(`${entitySet}@com.sap.vocabularies.Common.v1.DraftRoot/ShareAction`);\n\tconst shareAction = model.bindContext(`${shareActionName}(...)`, bindingContext);\n\tshareAction.setParameter(\"Users\", users);\n\tshareAction.setParameter(\"ShareAll\", true);\n\treturn shareAction.invoke(groupId, true);\n}\n\nexport function getActivityKeyFromPath(path: string): string {\n\treturn path.substring(path.lastIndexOf(\"(\") + 1, path.lastIndexOf(\")\"));\n}\n\nexport const CollaborationFieldGroupPrefix = \"_CollaborationDraft_\";\n"],"mappings":"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","ignoreList":[]}