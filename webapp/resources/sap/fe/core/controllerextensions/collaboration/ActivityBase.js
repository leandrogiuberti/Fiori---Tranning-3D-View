/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)
 *      (c) Copyright 2009-2025 SAP SE. All rights reserved
 */
sap.ui.define(["sap/fe/core/controllerextensions/collaboration/CollaborationCommon","sap/fe/core/helpers/ResourceModelHelper","sap/fe/core/helpers/WebSocket","sap/m/MessageBox"],function(e,t,o,r){"use strict";var n={};var a=o.createWebSocket;var i=o.WEBSOCKET_STATUS;var s=o.ChannelType;var c=t.getResourceModel;var l=e.Activity;const f="/collaboration";const p="/collaboration/connection";const C="/collaboration/DraftID";const u="/collaboration/websocket_status";function d(e){return e.getProperty(u)===i.CONNECTED}n.isCollaborationConnected=d;function g(e,t,o,n,l){let d=arguments.length>5&&arguments[5]!==undefined?arguments[5]:false;if(o.getProperty(p)){if(o.getProperty(C)===t){return false}else{P(o)}}const g=[e];o.setProperty(f,{activeUsers:g,activities:{}});const N={draft:t};if(d||new URLSearchParams(window.location.search).get("useFLPUser")==="true"){N["userID"]=e.id;N["userName"]=e.initialName??""}const O=a(s.CollaborationDraft,l.getModel(),N);o.setProperty(u,i.CONNECTING);o.setProperty(p,O);o.setProperty(C,t);O.attachMessage(function(e){const t=e.getParameter("pcpFields");if(t){n(t)}});O.attachOpen(function(){o.setProperty(u,i.CONNECTED)});function y(){const e=c(l);const t=e.getText("C_COLLABORATIONDRAFT_CONNECTION_LOST");r.warning(t,{actions:[r.Action.OK],emphasizedAction:r.Action.OK})}O.attachError(function(){if([i.CONNECTING,i.CONNECTED].includes(o.getProperty(u))){y()}o.setProperty(u,i.ERROR)});O.attachClose(function(e){o.setProperty(u,i.CLOSED);if(e.getParameter("code")!==1e3){y()}});return true}n.initializeCollaboration=g;function N(e,t,o,r,n,a){if(d(o)){const i=o.getProperty(p);i.send("",{clientAction:e,clientContent:t,clientTriggeredActionName:r,clientRefreshListBinding:n,clientRequestedProperties:a});if(e===l.Activate||e===l.Discard){P(o)}}}n.broadcastCollaborationMessage=N;function P(e){const t=e.getProperty(p);e.setProperty(f,{});e.setProperty(u,i.CLOSING);t?.close()}n.endCollaboration=P;return n},false);
//# sourceMappingURL=ActivityBase.js.map