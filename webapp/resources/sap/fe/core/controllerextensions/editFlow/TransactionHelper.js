/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)
 *      (c) Copyright 2009-2025 SAP SE. All rights reserved
 */
sap.ui.define(["sap/base/Log","sap/fe/core/CommonUtils","sap/fe/core/UIProvider","sap/fe/core/controllerextensions/BusyLocker","sap/fe/core/controllerextensions/editFlow/draft","sap/fe/core/controllerextensions/editFlow/editFlowConstants","sap/fe/core/controllerextensions/editFlow/sticky","sap/fe/core/controllerextensions/messageHandler/messageHandling","sap/fe/core/converters/MetaModelConverter","sap/fe/core/converters/annotations/DataField","sap/fe/core/helpers/DeleteHelper","sap/fe/core/helpers/FPMHelper","sap/fe/core/helpers/MetaModelFunction","sap/fe/core/helpers/ModelHelper","sap/fe/core/helpers/PromiseKeeper","sap/fe/core/helpers/SemanticKeyHelper","sap/fe/core/helpers/ToES6Promise","sap/fe/core/helpers/TypeGuards","sap/fe/core/library","sap/m/Button","sap/m/Dialog","sap/m/MessageBox","sap/m/MessageToast","sap/m/Popover","sap/m/Text","sap/m/VBox","sap/ui/core/Lib","sap/ui/core/Messaging","sap/ui/core/message/MessageType","../../ActionRuntime","./operations/ODataOperation","./operations/Operation","./operations/actionHelper"],function(e,t,n,a,o,i,r,s,c,l,d,g,u,f,p,h,C,m,D,y,w,E,b,M,x,A,v,P,T,O,I,S,_){"use strict";var N=m.isNavigationProperty;var B=m.isFulfilled;var L=m.isAction;var R=u.getCreatePopupFields;var F=l.isDataFieldForAction;var k=n.getCoreUIFactory;const H=D.CreationMode;const $=D.ProgrammingModel;const U=d.DeleteOptionTypes;const j=d.DeleteDialogContentControl;function W(e){if(e&&e.getMetadata&&e.getMetadata().getName()==="sap.ui.base.Event"){e={}}return e||{}}let G=function(){function n(){}var l=n.prototype;l.busyLock=function e(t,n){a.lock(t.getModel("ui"),n)};l.busyUnlock=function e(t,n){a.unlock(t.getModel("ui"),n)};l.getProgrammingModel=function e(t){let n;if(t.isA("sap.ui.model.odata.v4.Context")){n=t.getPath()}else{n=(t.isRelative()?t.getResolvedPath():t.getPath())??""}const a=t.getModel()?.getMetaModel();if(a&&f.isDraftSupported(a,n)){return $.Draft}else if(a&&f.isStickySessionSupported(a)){return $.Sticky}else{return $.NonDraft}};l.validateDocument=async function e(t,n,a){const o=n&&n.customValidationFunction;if(o){const e=o.substring(0,o.lastIndexOf(".")||-1).replace(/\./gi,"/"),i=o.substring(o.lastIndexOf(".")+1,o.length),r=n.data;delete r["@$ui5.context.isTransient"];return g.validationWrapper(e,i,r,a,t)}return Promise.resolve([])};l.getDataFromDefaultValueFunction=async function e(t,n){const a=t.getModel();const o=a.getMetaModel();const i=o.getMetaContext(t.getResolvedPath());const r=c.getInvolvedDataModelObjects(i);const s=r.targetObject.annotations.Common?.DefaultValuesFunction;const l=r.targetEntitySet?.annotations.Common?.DefaultValuesFunction;const d=(s??l)?.toString();if(!d){return undefined}const g=N(r.targetObject)&&s!==undefined;let u;if(g){const e=t.getPath();const n=t.getContext();if(e?.startsWith("/")){u=n}else if(e&&n&&e.includes("/")){const t=e.split("/")[0];const o=`${n.getPath()}/${t}`;u=a.bindContext(o).getBoundContext()}else{u=n}}else{u=t.getHeaderContext()}if(!u){return undefined}const f=S.getOperationFromName(d,a,u)??S.getOperationFromName(d,a);if(!f){return undefined}const p=L(f);const h=await new I(f,{appComponent:n,model:a,contexts:p?[u]:[]},{enhance$select:false,groupId:p?"functionGroup":"functionImport"}).execute();return h.filter(B)[0]?.value.boundContext.getObject()};l.isListBindingHierarchical=function e(t){return t.getAggregation()?.hierarchyQualifier?true:false};l.isListBindingAnalytical=function e(t){const n=t.getAggregation();return n!==undefined&&!n.hierarchyQualifier};l.createContext=async function e(t,n,a){const o=n??{};if(this.isListBindingHierarchical(t)){let e;if(a.parentContext?.isExpanded()===false){await t.expand(a.parentContext)}if(t.isRelative()){Object.assign(o,{"@$ui5.node.parent":a.parentContext});e=t}else{const n=t.getModel();const i=n.getMetaModel();e=n.bindList(t.getPath(),undefined,undefined,undefined,{$$groupId:t.getGroupId(),$$updateGroupId:t.getUpdateGroupId()});if(a.parentContext){const e=c.getInvolvedDataModelObjects(i.getMetaContext(t.getPath()));const n=t.getAggregation().hierarchyQualifier;const r=e.targetEntityType.annotations.Aggregation?.[`RecursiveHierarchy#${n}`]?.ParentNavigationProperty.value;if(!r){throw new Error(`Cannot find parent navigation property for ${t.getPath()}`)}const s={};s[`${r}@odata.bind`]=a.parentContext.getPath().replace(/^\//,"");Object.assign(o,s)}}return e.create(o,true)}else if(this.isListBindingAnalytical(t)){if(t.isRelative()){throw new Error("Creating a new document in a analytical table is supported only in a ListReport")}else{const e=t.getModel();const n=e.bindList(t.getPath(),undefined,undefined,undefined,{$$groupId:t.getGroupId(),$$updateGroupId:t.getUpdateGroupId()});return n.create(o,true)}}else{return t.create(o,true,a.createAtEnd,a.createInactive)}};l.getCreationParameters=function e(t,n,a){const o=t.getModel().getMetaModel();const i=o.getMetaPath(t.getHeaderContext().getPath());const r=R(o,i,a);return r.filter(e=>!(e in(n??{})))};l.createDocument=async function e(t,n,a,o,i,r,s){let c;const l=W(n);if(!t){throw new Error("Binding required for new document creation")}const d=this.getProgrammingModel(t);if(d!==$.Draft&&d!==$.Sticky){throw new Error("Create document only allowed for draft or sticky session supported services")}const g=this.getBusyPath(l);l.beforeCreateCallBack=r?undefined:l.beforeCreateCallBack;if(!n?.inactive){this.busyLock(a,g)}const u=i.registerToHoldMessages();try{c=await this.performCreation(t,l,a,i,o,r,s);await i.showMessageDialog({control:l.parentControl,unHoldKey:u});return c}catch(e){await i.showMessageDialog({control:l.parentControl,unHoldKey:u});if((e===D.Constants.ActionExecutionFailed||e===D.Constants.CancelActionDialog)&&c?.isTransient()){c.delete("$direct")}throw e}finally{if(!n?.inactive){this.busyUnlock(a,g)}}};l.getBusyPath=function e(t){return t.busyMode==="Local"?`/busyLocal/${t.busyId}`:"/busy"};l.createDocumentContext=async function n(a,o){if(o.beforeCreateCallBack){const t=o.data?Object.entries(o.data).map(e=>{let[t,n]=e;return{[t]:n}}):[];try{await C(o.beforeCreateCallBack({contextPath:a&&a.getPath(),createParameters:t}))}catch(t){e.error(t);throw D.Constants.OnBeforeCreateFailed}o.data=t.reduce((e,t)=>({...e,...t}),{})}const i=this.createContext(a,o.data,{createAtEnd:!!o.createAtEnd,createInactive:!!o.inactive,parentContext:o.parentContext});if(a.getUpdateGroupId()===t.INLINEEDIT_UPDATEGROUPID){a.getModel().submitBatch(t.INLINEEDIT_UPDATEGROUPID)}return i};l.performCreation=async function e(t,n,a,o,i,r,s){const c=t.getModel().getMetaModel();const l=c.getMetaPath(t.getHeaderContext().getPath());const d=a.getRouterProxy().getHash();const g=a.getComponentData();const u=g?.startupParameters??{};const f=!t.isRelative()?this._getNewAction(u,d,c,l):undefined;if(f){const e=await this.performCreationWithAction(f,t,n,a,i,o);if(e.status==="rejected"){throw e.reason}return e.value.returnedContext}else{return this.performCreationWithPOST(t,n,a,i,o,r,s)}};l.performCreationWithAction=async function e(t,n,a,o,i,r){const s=n.getHeaderContext().getPath();const c=n.getModel().getMetaModel();const l=c.getMetaPath(s);const d=f.getMessagesPath(c,l);const g={$$patchWithoutSideEffects:true,$$updateGroupId:"$auto"};const u=[];if(d){u.push(d)}if(this.getProgrammingModel(n)===$.Draft){u.push("IsActiveEntity","HasDraftEntity","HasActiveEntity")}if(u.length>0){g["$select"]=u.join(",")}const p=await this.callAction(t,{contexts:n.getHeaderContext(),showActionParameterDialog:true,label:this._getSpecificCreateActionDialogLabel(c,l,t,i),bindingParameters:g,view:a.parentControl,isCreateAction:true,skipParameterDialog:a.skipParameterDialog},o,r);return p[0]};l.performCreationWithPOST=async function t(n,a,o,i,r,s,c){try{let e;const t=a.data;if(!s){let e=c;if(e===undefined){e=await this.getDataFromDefaultValueFunction(n,o)}a.data=Object.assign({},e,a.data)}if(a.data){delete a.data["@odata.context"]}const l=a.creationMode!==H.CreationRow&&a.creationMode!==H.Inline;const d=l?this.getCreationParameters(n,t,o):[];if(a.creationMode===H.CreationDialog){a.creationDialogFields?.forEach(e=>{if(!d.includes(e)){d.push(e)}});if(d.length===0){throw new Error("No fields available for the creation dialog")}}if(d.length>0){e=await this.createWithDialog(n,d,a,o,i,r);if(this.isListBindingAnalytical(n)){this.refreshListBinding(n,o)}}else{e=await this.createDocumentContext(n,a);if(!a.inactive){await this.waitForCreateCompletion(e,a.keepTransientContextOnFailed===true)}}return e}catch(t){const n=t.message??t;e.error("Error while creating the new document",n);throw n}};l._isDraftEnabled=function e(t){const n=t[0];const a=this.getProgrammingModel(n);return a===$.Draft};l.deleteDocument=async function e(t,n,a,o,i){this.busyLock(a);const r=Array.isArray(t)?[...t]:[t];const c=(n.selectedContexts??r)[0];try{const e=this._isDraftEnabled(n.selectedContexts||r);const t=[];let l=[];let g;if(n){n=W(n);n.entitySetName=this.getCollectionNameFromContext(c);if(!n.numberOfSelectedContexts){if(e){const e=r.find(e=>{const t=e.getObject();return t.IsActiveEntity===true&&t.HasDraftEntity===true&&t.DraftAdministrativeData&&t.DraftAdministrativeData.InProcessByUser&&!t.DraftAdministrativeData.DraftIsCreatedByMe});if(e){await this.showDeleMessageLockedObjet(e,o);return false}else{g=r.find(e=>{const{IsActiveEntity:t,HasDraftEntity:n,DraftAdministrativeData:a}=e.getObject()||{};return t===true&&n===true&&!!a?.InProcessByUser})}}let t="";if(g){const e=g.getObject().DraftAdministrativeData.InProcessByUser;t=o.getText("C_TRANSACTION_HELPER_CONFIRM_DELETE_WITH_UNSAVED_CHANGES",[e],n.entitySetName)}else if(n.title){if(n.description){t=o.getText("C_TRANSACTION_HELPER_CONFIRM_DELETE_WITH_OBJECTINFO",[n.title,n.description],n.entitySetName)}else{t=o.getText("C_TRANSACTION_HELPER_CONFIRM_DELETE_WITH_OBJECTTITLE_ONLY",[n.title],n.entitySetName)}}else{t=o.getText("C_TRANSACTION_HELPER_CONFIRM_DELETE_WITH_OBJECTTITLE_SINGULAR",undefined,n.entitySetName)}l.push({type:U.deletableContexts,contexts:r,text:t,selected:true,control:j.TEXT})}else{let a=r.length;if(e){a+=(n.draftsWithNonDeletableActive?.length??0)+(n.draftsWithDeletableActive?.length??0)+(n.unSavedContexts?.length??0);d.updateDraftOptionsForDeletableTexts(n,r,a,o,t,l)}else{const e=d.getNonDeletableText(n,a,o);if(e){t.push(e)}}const i=d.getOptionsForDeletableTexts(n,r,o);l=[...l,...i]}}const u=c.getBinding();let f;if(u.isA("sap.ui.model.odata.v4.ODataListBinding")){if(this.isListBindingHierarchical(u)){f="Tree"}else if(this.isListBindingAnalytical(u)){f="Analytical"}}d.updateContentForDeleteDialog(l,t);if(n.noDialog!==true&&n.silentMode!==true){const e=await this.showDeleteConfirmationDialog(t,n,o);if(!e){return false}}s.removeBoundTransitionMessages();await d.deleteConfirmHandler(l,n,i,o,a,e,f);return true}finally{this.busyUnlock(a)}};l.showDeleMessageLockedObjet=async function e(t,n){const a=t.getObject().DraftAdministrativeData.InProcessByUser;const o=new p;E.show(n.getText("C_TRANSACTION_HELPER_CONFIRM_DELETE_WITH_SINGLE_OBJECT_LOCKED",[a]),{title:n.getText("C_COMMON_DELETE"),onClose:()=>{o.resolve()}});return o.promise};l.showDeleteConfirmationDialog=async function e(t,n,a){const o=new p;const i=this.createDeleteDialog(t,n,a,o);i.addStyleClass("sapUiContentPadding");i.open();return o.promise};l.createDeleteDialog=function e(t,n,a,o){let i=false;const r=new A({items:t});const s=v.getResourceBundleFor("sap.fe.core");let c;if(n.parentControl?.isA("sap.ui.mdc.Table")){c=a.getText("M_COMMON_TABLE_DELETE",undefined,n.entitySetName)}else{c=s.getText("C_COMMON_DELETE")}const l=new w({title:c,state:"Warning",content:[r],ariaLabelledBy:t,beginButton:new y({text:c,type:"Emphasized",press:function(){i=true;l.close()}}),endButton:new y({text:a.getText("C_COMMON_DIALOG_CANCEL"),press:function(){l.close()}}),afterClose:function(){l.destroy();o.resolve(i)}});return l};l.editDocument=async function e(t,n,a,i,s,c){const l=this.getProgrammingModel(t);if(!t){throw new Error("Binding context to active document is required")}if(l!==$.Draft&&l!==$.Sticky){throw new Error("Edit is only allowed for draft or sticky session supported services")}this.busyLock(a);i.removeTransitionMessages();const d=i.registerToHoldMessages();try{const e=l===$.Draft?await o.createDraftFromActiveDocument(t,a,{bPreserveChanges:true,oView:n},s,i,c):await r.editDocumentInStickySession(t,a,i);await i.showMessageDialog({unHoldKey:d});return e}catch(e){await i.showMessages({concurrentEditFlag:true,unHoldKey:d});throw e}finally{this.busyUnlock(a)}};l.prepareSiblingContext=function e(t){const n=t.getModel();const a=n.getMetaModel();const o=t.getPath();const i=h.getSemanticKeys(a,a.getMetaContext(o).getObject("@sapui.name"));if(i&&i.length){const e=i.map(e=>e.$PropertyPath);return n.bindContext(`${o}/SiblingEntity`,undefined,{$select:e}).getBoundContext()}const r=a.getMetaPath(o);const s=a.getObject(`${r}/SiblingEntity/`)["$Key"];return n.bindContext(`${o}/SiblingEntity`,undefined,{$select:s}).getBoundContext()};l.cancelDocument=async function e(t,n,a,i,s,c,l){if(!t){throw new Error("No context exists. Pass a meaningful context")}const d=W(n);const g=t.getModel();const u=this.getProgrammingModel(t);if(u!==$.Draft&&u!==$.Sticky){throw new Error("Cancel document only allowed for draft or sticky session supported services")}this.busyLock(a);try{let e;let n,f,p,h;if(u===$.Draft&&!l){n=this.prepareSiblingContext(t);const e=g.bindContext(t.getPath(),undefined,{$select:["DraftAdministrativeData/CreationDateTime","DraftAdministrativeData/LastChangeDateTime"]}).getBoundContext();[f,p,h]=await Promise.all([c?undefined:n?.requestCanonicalPath(),e.requestObject(),c?undefined:n?.requestObject()]);if(p){l=p.DraftAdministrativeData?.CreationDateTime!==p.DraftAdministrativeData?.LastChangeDateTime}}if(!d.skipDiscardPopover){await this._confirmDiscard(d.cancelButton,l,i)}if(t.isKeepAlive()){t.setKeepAlive(true,undefined)}if(d.beforeCancelCallBack){await d.beforeCancelCallBack({context:t})}if(u===$.Draft){if(c){if(t.hasPendingChanges()){t.getBinding().resetChanges()}await o.deleteDraft(t,s,a)}else{try{if(t.hasPendingChanges()){t.getBinding().resetChanges()}n=n??this.prepareSiblingContext(t);[f,h]=await Promise.all([n?.requestCanonicalPath(),n?.requestObject()]);e=f?g.bindContext(f).getBoundContext():undefined}finally{await o.deleteDraft(t,s,a)}}}else{const n=await r.discardDocument(t);if(n){if(n.hasPendingChanges()){n.getBinding().resetChanges()}if(!c){n.refresh();e=n}}}s.removeTransitionMessages();await s.showMessages();return{activeContext:e,activeContextData:h}}catch(e){await s.showMessages();throw e}finally{this.busyUnlock(a)}};l.saveDocument=async function e(n,a,i,c,l,d,g){let u=arguments.length>7&&arguments[7]!==undefined?arguments[7]:false;let f=arguments.length>8?arguments[8]:undefined;const p=this.getProgrammingModel(n);if(p!==$.Sticky&&p!==$.Draft){throw new Error("Save is only allowed for draft or sticky session supported services")}try{this.busyLock(a);const e=this.getCollectionNameFromContext(n);const t=p===$.Draft?await o.activateDocument(n,a,d,{resourceModel:i},f):await r.activateDocument(n,a,d,{resourceModel:i},f);const c=s.getMessages().concat(s.getMessages(true,true));if(!u&&!(c.length===1&&c[0].getType()===T.Success)){b.show(g?i.getText("C_TRANSACTION_HELPER_OBJECT_CREATED",undefined,e):i.getText("C_TRANSACTION_HELPER_OBJECT_SAVED",undefined,e))}return t}catch(e){if(c&&l?.length>0){l.forEach(e=>{if(!t.hasTransientContext(e)){a.getSideEffectsService().requestSideEffectsForNavigationProperty(e.getPath(),n)}})}await d.showMessages();throw e}finally{this.busyUnlock(a)}};l.callAction=async function e(t,n,a,o){n=W(n);let i;let r;if(!t){throw new Error("Provide name of action to be executed")}const s=t.split("/")[1];i=s?undefined:n.contexts;if(i&&(Array.isArray(i)&&i.length||!Array.isArray(i))){i=Array.isArray(i)?i[0]:i;r=i.getModel()}if(n.model){r=n.model}if(!r){throw new Error("Pass a context for a bound action or pass the model for an unbound action")}try{const e=n.controlId?n.view.byId(n.controlId):n.view;let s;if(i&&n.contexts){const i=Array.isArray(n.contexts)?n.contexts:[n.contexts];const c=S.getOperationFromName(t,r,i[0]);if(!L(c)){throw new Error("Unknown bound action")}s=await new S(a,r,c,{parameterValues:n.parameterValues,contexts:i,invocationGrouping:n.invocationGrouping,label:n.label,skipParameterDialog:n.skipParameterDialog,bindingParameters:n.bindingParameters,entitySetName:n.entitySetName,oDataProperties:{ghostContextBindingProtection:true,enhance$select:true,groupId:n.groupId,ignoreETag:n.ignoreETag},oDataEvents:{onODataSubmit:()=>{o?.removeTransitionMessages();this.busyLock(a)},onODataResponse:()=>{this.busyUnlock(a)},onRequestSideEffects:()=>{this.handleActionEnablementOnOperation({internalModelContext:n.internalModelContext,operationAvailableMap:n.operationAvailableMap,control:e,contexts:i,convertedAction:c})}},view:n.view,isCreateAction:n.isCreateAction,messageHandler:o,defaultValuesExtensionFunction:n.defaultValuesExtensionFunction}).execute()}else{const e=S.getOperationFromName(t,r);if(!e||L(e)){throw new Error("Unknown action import")}s=await new S(a,r,e.action,{parameterValues:n.parameterValues,label:n.label,skipParameterDialog:n.skipParameterDialog,bindingParameters:n.bindingParameters,entitySetName:n.entitySetName,oDataEvents:{onODataSubmit:()=>{this.busyLock(a)},onODataResponse:()=>{this.busyUnlock(a)}},oDataProperties:{ignoreETag:n.ignoreETag},messageHandler:o,view:n.view}).execute()}if(o){this._handleActionResponse(n,t)}return s}catch(e){if(o){this._handleActionResponse(n,t)}throw e}};l.getCollectionNameFromContext=function e(t){const n=t.getModel().getMetaModel().getMetaContext(t.getPath());return c.getInvolvedDataModelObjects(n).targetObject?.name};l.handleActionEnablementOnOperation=function e(t){if(t.internalModelContext&&t.operationAvailableMap){let e=[];if(!_.isStaticAction(t.convertedAction)){e=t.internalModelContext.getProperty("selectedContexts")||[];O.setActionEnablement(t.internalModelContext,JSON.parse(t.operationAvailableMap),e,"table")}else if(t.control){if(t.control.isA("sap.ui.mdc.Table")){e=t.control.getSelectedContexts();O.setActionEnablement(t.internalModelContext,JSON.parse(t.operationAvailableMap),e,"table")}}d.updateDeleteInfoForSelectedContexts(t.internalModelContext,e)}};l._handleActionResponse=function e(t,n){const a=s.getMessages(true,true);if(a.length>0&&t&&t.internalModelContext){t.internalModelContext.setProperty("sActionName",t.label?t.label:n)}};l.handleValidationError=function e(){const t=P.getMessageModel().getData().filter(e=>e.validation);P.removeMessages(t)};l._createPopover=function e(t){return new M(t)};l._confirmDiscard=async function e(t,n,a){if(!n){this.handleValidationError();return Promise.resolve()}t.setEnabled(false);return new Promise((e,n)=>{const o=this._createPopover({showHeader:false,placement:"Top"});o.addStyleClass("sapUiContentPadding");const i=new x({id:"DraftDiscardMessage",text:a.getText("C_TRANSACTION_HELPER_DRAFT_DISCARD_MESSAGE")});const r=new y({text:a.getText("C_TRANSACTION_HELPER_DRAFT_DISCARD_BUTTON"),width:"100%",press:()=>{this.handleValidationError();o.data("continueDiscard",true);o.close()}});r.addAriaLabelledBy(i);o.addContent(new A({items:[i,r]}));o.attachBeforeOpen(()=>{o.setInitialFocus(r)});o.attachAfterClose(()=>{o.destroyContent();t.setEnabled(true);if(o.data("continueDiscard")){e()}else{n(D.Constants.CancelDiscardDraft)}});o.openBy(t,false)})};l.refreshListBinding=async function t(n,a){try{if(n.isRoot()){if(this.isListBindingHierarchical(n)){await a.getSideEffectsService().requestSideEffects([{$NavigationPropertyPath:""}],n.getHeaderContext())}else{await n.requestRefresh()}}else{await a.getSideEffectsService().requestSideEffects([{$NavigationPropertyPath:n.getPath()}],n.getContext())}}catch(t){e.error(`Error while refreshing list binding ${n.getPath()}`,t)}};l.createWithDialog=async function n(a,o,r,s,c,l){const d=a.getModel();const g=d.getMetaModel();const u=g.getMetaPath(a.getResolvedPath());const f=d.bindList(a.getPath(),a.getContext(),undefined,undefined,{$$updateGroupId:"submitLater"});f.refreshInternal=function(){};const h=f.create(r.data,true);const m=o.map(e=>g.createBindingContext(`${u}/${e}`));const y=k().newCreateDialog(h,o,s,r.creationMode===H.CreationDialog?"Standalone":"WithNavigation",r.parentControl);try{await t.setUserDefaults(s,m,h,false,r.createAction,r.data);y.openDialog()}catch(e){await l.showMessages();throw e}const w=new p;const E=async t=>{if(!t.getParameter("accept")){f.destroy();y.closeDialog();w.reject(D.Constants.CancelActionDialog);return}y.setBusy(true);r.bIsCreateDialog=true;try{const t=h.getObject();let n={};Object.keys(t).forEach(e=>{const a=g.getObject(`${u}/${e}`);if(a&&a.$kind!=="NavigationProperty"&&!e?.startsWith("@$ui5")){n[e]=t[e]}});if(r.beforeCreateCallBack){const t=Object.entries(n).map(e=>{let[t,n]=e;return{[t]:n}});try{await C(r.beforeCreateCallBack({contextPath:a.getPath(),createParameters:t}))}catch(t){e.error("Error while creating the new document",t);throw D.Constants.OnBeforeCreateFailed}n=t.reduce((e,t)=>({...e,...t}),{})}if(Object.keys(n).length>0){s.getModel("ui").setProperty(i.DocumentModified,true)}const o=await this.createContext(a,n,{createAtEnd:r.createAtEnd,createInactive:r.inactive,parentContext:r.parentContext});const d=await this.waitForCreateCompletion(o,r.keepTransientContextOnFailed===true);if(d){try{await(r.afterCreateCallBack?.(o))}catch(t){y.displayErrorMessages(P.getMessageModel().getData());await l.showMessageDialog({showBoundStateMessages:true});await this.deleteDocument(o,{silentMode:true},s,c,l);await this.refreshListBinding(a,s);e.error("Error while creating/saving the new document",t);throw D.Constants.CreationFailed}f.destroy();y.closeDialog();w.resolve(o)}}catch(e){if(![D.Constants.OnBeforeCreateFailed,D.Constants.CreationFailed].includes(e)){f.destroy();y.closeDialog();w.reject(e)}}finally{y.setBusy(false);l.showMessages({isOperationDialogOpen:y.isOpen()})}};y.attachExitDialog({},E);return w.promise};l.waitForCreateCompletion=async function t(n,a){const o=new p;const i=n.getBinding();const r=e=>{const t=e.getParameter("context");const a=e.getParameter("success");if(t===n){i.detachCreateCompleted(r);o.resolve(a===true)}};i.attachCreateCompleted(r);const s=await o.promise;if(!s){if(!a){(n.created()??Promise.resolve()).catch(function(t){e.trace("transient creation context deletion error",t)});i.resetChanges();i.getModel().resetChanges(i.getUpdateGroupId());throw D.Constants.CreationFailed}return false}else{await n.created();return true}};l._getNewAction=function e(t,n,a,o){let i;if(t&&t.preferredMode&&n.toUpperCase().includes("I-ACTION=CREATEWITH")){const e=t.preferredMode[0];i=e.toUpperCase().includes("CREATEWITH:")?e.substring(e.lastIndexOf(":")+1):undefined}else if(t&&t.preferredMode&&n.toUpperCase().includes("I-ACTION=AUTOCREATEWITH")){const e=t.preferredMode[0];i=e.toUpperCase().includes("AUTOCREATEWITH:")?e.substring(e.lastIndexOf(":")+1):undefined}else{i=a&&a.getObject!==undefined?a.getObject(`${o}@com.sap.vocabularies.Session.v1.StickySessionSupported/NewAction`)||a.getObject(`${o}@com.sap.vocabularies.Common.v1.DraftRoot/NewAction`):undefined}return i};l._getSpecificCreateActionDialogLabel=function e(t,n,a,o){const i=t?.getObject(`${n}/@com.sap.vocabularies.UI.v1.LineItem`);const r=i?.find(e=>F(e)&&e.Action.split("(",1)[0]===a)?.Label;return r||t?.getObject(`${n}/${a}@com.sap.vocabularies.Common.v1.Label`)||o?.getText("C_TRANSACTION_HELPER_SAPFE_ACTION_CREATE")};return n}();const V=new G;return V},false);
//# sourceMappingURL=TransactionHelper.js.map