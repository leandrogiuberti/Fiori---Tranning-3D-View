/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)
 *      (c) Copyright 2009-2025 SAP SE. All rights reserved
 */
sap.ui.define(["sap/base/Log","sap/fe/core/CommonUtils","sap/fe/core/helpers/EditState","sap/fe/core/helpers/ModelHelper","../../controls/DataLossOrDraftDiscard/DraftDataLossDialog","../../controls/Recommendations/ConfirmRecommendationDialog"],function(e,t,n,a,i,o){"use strict";var r=o.RecommendationDialogDecision;var s=function(e){e["BackNavigation"]="BackNavigation";e["ForwardNavigation"]="ForwardNavigation";return e}(s||{});var c=function(e){e["Save"]="draftDataLossOptionSave";e["Keep"]="draftDataLossOptionKeep";e["Discard"]="draftDataLossOptionDiscard";return e}(c||{});const d=new i("fe::DraftDataLossPopup");function l(e){const t=e.getAppComponent().getManifestEntry("sap.fe");return t?.app?.silentlyKeepDraftOnForwardNavigation||false}async function f(e,t,n,a,i,o,r){let s;if(e.CreationDateTime===e.LastChangeDateTime&&!n.editFlow.isDocumentModified()){a()}else{s=r===true&&a.name==="afterCancel";return d.open(n,s).then(e=>y.handleDialogSelection(e,a,t,n,i,o,r))}}async function g(t,a,i,o,r,c,l,f,g,u){if(n.isEditStateDirty()){if(t.CreationDateTime===t.LastChangeDateTime&&!i.editFlow.isDocumentModified()&&r===s.BackNavigation){try{await y.discardDraft(i,l,f,g,u);o()}catch(t){e.error("Error while canceling the document",t)}}else if(r===s.ForwardNavigation&&c){o()}else{return d.open(i).then(e=>y.handleDialogSelection(e,o,a,i,l,f,g,u))}}else{o()}}async function u(t,n,a,i){if(i===s.BackNavigation){const i={skipDiscardPopover:true,skipBindingToView:true};try{await t.editFlow.cancelDocument(n,i);a()}catch(t){e.error("Error while canceling the document",t)}}else{a()}}async function D(e,t,n,a,i,o,r,c){if(a===s.ForwardNavigation&&i){n()}else{return d.open(e).then(a=>y.handleDialogSelection(a,n,t,e,o,r,c))}}async function p(e,t,a,i,o,r){let c=arguments.length>6&&arguments[6]!==undefined?arguments[6]:s.BackNavigation;let d=arguments.length>7?arguments[7]:undefined;let p=arguments.length>8?arguments[8]:undefined;let m=arguments.length>9?arguments[9]:undefined;const v=o.collaborativeDraft.isConnected();const h=!v?t:function(){o.collaborativeDraft.disconnect();for(var e=arguments.length,n=new Array(e),a=0;a<e;a++){n[a]=arguments[a]}t.apply(null,...n)};const w=l(o);if(e){if(o.getAppComponent().getRootViewController().isFclEnabled()){await f(e,a,o,h,r,i,p)}else if(!d){g(e,a,o,h,c,w,r,undefined,p,m)}else if(e.CreationDateTime===e.LastChangeDateTime&&(!p||p&&!o.editFlow.isDocumentModified())){u(o,i,h,c)}else if(n.isEditStateDirty()){D(o,a,h,c,w,r,i,p)}else{h()}}else{t()}}async function m(n,i,o,r,c){let d=arguments.length>5&&arguments[5]!==undefined?arguments[5]:s.BackNavigation;let l=arguments.length>6?arguments[6]:undefined;let f=arguments.length>7?arguments[7]:undefined;const g=r.getView();const u=g.getBindingContext().getModel();const D=u.getMetaModel();const m=g.getViewData();const v=m.contextPath||(m.entitySet?`/${m.entitySet}`:undefined);const h=v?!!D.getObject(`${v}@com.sap.vocabularies.Common.v1.DraftRoot`):false;const w=t.getIsEditable(g);const y=o;let C=o.getPath();if(!h){C=a.getDraftRootPath(o)??C;o=u.bindContext(C,undefined,{$expand:"DraftAdministrativeData"}).getBoundContext()}const E=r.getAppComponent().getEnvironmentCapabilities()?.getCapabilities()?.HiddenDraft?.enabled;const k=h||r.getAppComponent().getRouterProxy().checkIfBackExitsApp()||E&&l;if(y.isDeleted()||!k&&d===s.BackNavigation||!w){n()}else{try{await o.requestProperty(["DraftAdministrativeData/CreationDateTime","DraftAdministrativeData/LastChangeDateTime","HasActiveEntity"]);const e=o.getObject("DraftAdministrativeData");await p(e,n,i,E?y:o,r,c,d,o.getProperty("HasActiveEntity"),E,f)}catch(t){e.error("Cannot retrieve draftDataContext information",t);n()}}}async function v(e,t,n){const a=t!==undefined;t=t??e.getView().getBindingContext();if(!a&&e.isA("sap.fe.templates.ObjectPage.ObjectPageController")){return e._saveDocument(n)}else{return e.editFlow.saveDocument(t,{skipBindingToView:n})}}async function h(e,t,n,a,i){n=n??e.getView().getBindingContext();let o=i;if(!i){o=a===true&&!n.getProperty("HasActiveEntity")?false:true}const r={skipBackNavigation:o,skipDiscardPopover:true,skipBindingToView:t!==undefined?t:true};return e.editFlow.cancelDocument(n,r)}function w(t,n,a,i,o,s,l,f){switch(t){case c.Save:y.saveDocument(i,s,o).then(e=>n(e)).catch(function(t){if(t===r.Continue){return a()}e.error("Error while saving document",t)});d.close();break;case c.Keep:n();d.close();break;case c.Discard:y.discardDraft(i,o,s,l,f).then(e=>n(e)).catch(function(t){e.error("Error while discarding draft",t)});d.close();break;default:a();d.close()}}const y={processDataLossOrDraftDiscardConfirmation:m,silentlyKeepDraftOnForwardNavigation:l,NavigationType:s,processFclMode:f,processNoActiveEntityMode:g,processEditingDraftForExistingEntity:u,processEditStateDirty:D,handleDialogSelection:w,saveDocument:v,discardDraft:h};return y},false);
//# sourceMappingURL=draftDataLossPopup.js.map