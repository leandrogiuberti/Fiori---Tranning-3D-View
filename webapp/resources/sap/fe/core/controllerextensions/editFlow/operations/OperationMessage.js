/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)
 *      (c) Copyright 2009-2025 SAP SE. All rights reserved
 */
sap.ui.define(["sap/fe/core/library","sap/ui/core/ElementRegistry","sap/ui/core/Lib","sap/ui/core/Messaging","sap/ui/core/message/Message","sap/ui/core/message/MessageType","../../../CommonUtils","../../messageHandler/messageHandling","./actionHelper"],function(e,t,s,a,i,n,r,o,g){"use strict";var l={};const c=e.InvocationGrouping;let h=function(){function e(e){this.isParameterDialogOpened=false;this.is412toBeManaged=false;this.parameters=e;if(this.parameters.contexts.length){const e=this.parameters.contexts[0].getBinding();if(e.isA("sap.ui.model.odata.v4.ODataListBinding")){this.table=t.filter(t=>t.isA("sap.ui.mdc.Table")&&t.getRowBinding()===e)[0]}}}l=e;var h=e.prototype;h.onParameterDialogClosed=function e(){this.isParameterDialogOpened=false};h.onParameterDialogOpened=function e(){this.isParameterDialogOpened=true};h.onStrictHandling=function e(){this.is412toBeManaged=true};h.reactToOperations=async function e(t){if(this.parameters.disableNotification===true){this.parameters.events?.onMessageCollected?.();return}const s=this.isParameterDialogOpened;await this.parameters.messageHandler.showMessages({isOperationDialogOpen:s,messagePageNavigationCallback:()=>{this.parameters.events?.onMessagePageNavigationCallback?.()},onBeforeShowMessage:(e,s)=>this.actionParameterShowMessageCallback(e,s,!t.some(e=>e.status==="rejected")),aSelectedContexts:this.parameters.contexts,sActionName:this.parameters.label,entitySet:this.parameters.entitySetName,boundActionName:g.getActionName(this.parameters.action),control:this.table});this.parameters.messageHandler.clearStrictWarningMessages()};h.isErrorIntoParameterDialog=function e(){return!!this.getParameterDialogMessages().length};h.getParameterDialogMessages=function e(t){const s=g.getActionName(this.parameters.action);const a=g.getActionParameters(this.parameters.action);return(t??o.getMessages(true,true)).filter(e=>e.getTargets()?.[0].includes(s)&&a.some(t=>e.getTargets()?.[0].includes(t.name)))};h.actionParameterShowMessageCallback=function e(t,s,i){const n=e=>["Error","Warning"].includes(e.getType());const r=a.getMessageModel().getData();const g=t.findIndex(n);const l=r.findIndex(n);const h=this.parameters.invocationGrouping===c.ChangeSet;const m=this.getParameterDialogMessages(t);const d=!!m.length;let u=s.showMessageBox,p=s.showMessageDialog;if(h){if((this.is412toBeManaged||o.hasTransitionErrorsOrWarnings())&&!d&&!i&&g!==1&&l!==-1&&this.parameters.contexts.length>1){const e=r.length===1;u=e||t.length===1;p=!u;t.unshift(this.getGenericMsgForChangeSet(e))}}else if(!this.isParameterDialogOpened&&d){p=true;t=t.concat(m)}this.parameters.events?.onMessageCollected?.();const{messagesToShow:M,containsBoundTransition:f,showMessageInDialog:E}=this.filterApdAndContextMessages(t,d);return{showMessageBox:u,showMessageDialog:E??p,filteredMessages:M,fnGetMessageSubtitle:this.table?o.setMessageSubtitle.bind({},this.table,this.parameters.contexts):undefined,showChangeSetErrorDialog:h,containsBoundTransistion:f}};h.getGenericMsgForChangeSet=function e(t){const a=s.getResourceBundleFor("sap.fe.core");const o=(this.table&&r.getIsEditable(this.table))??false;const g=a.getText(`C_COMMON_DIALOG_CANCEL_SINGLE_ERROR_MESSAGE_TEXT${o?"_EDIT":""}`);return t?new i({message:g,type:n.Error,target:"",persistent:true,code:"FE_CUSTOM_MESSAGE_CHANGESET_ALL_FAILED",technicalDetails:{fe:{changeSetPreTextForSingleError:g}}}):new i({message:a.getText("C_COMMON_DIALOG_CANCEL_ERROR_MESSAGES_TEXT"),type:n.Error,target:"",persistent:true,code:"FE_CUSTOM_MESSAGE_CHANGESET_ALL_FAILED",description:a.getText("C_COMMON_DIALOG_CANCEL_ERROR_MESSAGES_DETAIL_TEXT")})};h.filterApdAndContextMessages=function e(t,s){const a=t.filter(e=>e.getTargets()?.[0]==="");const i=this.isParameterDialogOpened;let n=true;if(i&&s){o.removeContextMessagesfromModel(t,this.parameters.contexts)}let g;if(!(this.table&&r.getIsEditable(this.table))){if(i&&s){if(a.length===0){g=false;n=false}t=o.removeMessagesForActionParameterDialog(t)}}else{if(a.length===0){g=false}t=o.removeMessagesForActionParameterDialog(t)}return{messagesToShow:t,containsBoundTransition:g,showMessageInDialog:n}};return e}();l=h;return l},false);
//# sourceMappingURL=OperationMessage.js.map