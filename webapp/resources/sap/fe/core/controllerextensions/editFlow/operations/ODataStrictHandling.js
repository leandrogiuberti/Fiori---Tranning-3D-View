/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)
 *      (c) Copyright 2009-2025 SAP SE. All rights reserved
 */
sap.ui.define(["sap/base/Log","sap/fe/core/CommonUtils","sap/fe/core/helpers/ResourceModelHelper","sap/fe/core/library","sap/m/MessageBox","sap/ui/core/ElementRegistry","sap/ui/core/Messaging","sap/ui/core/message/Message","sap/ui/core/message/MessageType","sap/ui/model/json/JSONModel","../../dialog/ODataStrictDialog","../../messageHandler/messageHandling"],function(e,t,n,s,i,a,o,r,g,l,c,h){"use strict";var d={};const p=s.InvocationGrouping;let C=function(){function s(e){this.strictHandlingResolves=[];this.strictHandlingWarningMessages=[];this.canceled=false;this.isCanceled=()=>this.canceled;this.parameters=e;if(this.parameters.contexts.length){const e=this.parameters.contexts[0].getBinding();if(e?.isA("sap.ui.model.odata.v4.ODataListBinding")){this.tableAPI=a.filter(t=>t.isA("sap.fe.macros.table.TableAPI")&&t.getContent()?.getRowBinding()===e)[0]}}}d=s;var C=s.prototype;C.handleOdataStrictHandling=async function t(n,s,i){let a=arguments.length>3&&arguments[3]!==undefined?arguments[3]:[];let o;const r=new Promise(function(e){o=e});this.strictHandlingResolves.push({handlingResolve:o,onContextValidation:i});if(a.filter(e=>e.getType()===g.Error).length){e.warning("Warning: 412 ('Pre-condition Check Failed due to strict-handling') returns messages of type error but only warning messages are appropriate!")}let l="";if(this.parameters.contexts.length>1){const e=this.tableAPI?.getIdentifierColumn();if(typeof e==="string"){l=n.getContext()?.getObject(e)}}for(const e of a){e.setAdditionalText(l);this.strictHandlingWarningMessages.push(e)}this.parameters.events?.onResponse?.(a);s?.();return r};C.manageStrictHandlingFails=async function t(){if(this.strictHandlingResolves.length){try{if((!h.hasTransitionErrorsOrWarnings()||this.parameters.invocationGrouping!==p.ChangeSet)&&this.strictHandlingWarningMessages.length){await this.displayMessages()}else{for(const e of this.strictHandlingResolves){e.handlingResolve(false)}const e=o.getMessageModel();const t=e.getData();e.setData(t.concat(this.strictHandlingWarningMessages))}}catch{e.error("Re-triggering of strict handling operations failed")}}};C.displayMessages=async function e(){const t=this.strictHandlingWarningMessages;if(!t.length){return}const s=n.getLocalizedText(this.parameters.label,this.parameters.appComponent);return t.length===1&&!(t[0].getDescription()?.length||t[0].getDescriptionUrl()?.length)?this.displayMessageOnMessageBox(t[0],s):this.displayMessagesOnDialog(t,s)};C.displayMessageOnMessageBox=async function e(s,a){let o;const r=new Promise(e=>{o=e});const g=n.getResourceModel(this.parameters.appComponent);const l=s.getMessage();const c=s.getAdditionalText();const h=this.parameters.contexts.length>1;const d=g.getText("C_COMMON_DIALOG_CANCEL_SINGLE_MESSAGE_TEXT");const C=this.parameters.invocationGrouping===p.ChangeSet?g.getText("C_COMMON_DIALOG_CANCEL_MESSAGE_TEXT",[a]):g.getText("C_COMMON_DIALOG_SKIP_SINGLE_MESSAGE_TEXT");let M=g.getText("C_COMMON_DIALOG_CANCEL");let _="";if(!h){_=`${l}\n${g.getText("PROCEED")}`}else if(c!==undefined&&c!==""){M=this.parameters.invocationGrouping===p.ChangeSet?M:g.getText("C_COMMON_DIALOG_SKIP");const e=this.tableAPI?.getTableDefinition().headerInfoTypeName;const n=this.tableAPI&&typeof e==="string"?t.getTranslatedTextFromExpBindingString(e,this.tableAPI):e;if(n){_=`${n.toString()} ${c}: ${l}\n\n${C}`}else{_=`${c}: ${l}\n\n${C}`}}else{M=this.parameters.invocationGrouping===p.ChangeSet?M:g.getText("C_COMMON_DIALOG_SKIP");_=`${l}\n\n${C}`}if(h&&this.parameters.invocationGrouping===p.ChangeSet){_=`${d}\n\n${_}`}i.warning(_,{title:g.getText("WARNING"),actions:[a,M],emphasizedAction:a,onClose:e=>{this[e===a?"handleMessageOnValidation":"handleMessageOnCancel"]();o()}});return r};C.displayMessagesOnDialog=async function e(t,s){let i;const a=new Promise(e=>{i=e});const o=new l;const d=n.getResourceModel(this.parameters.appComponent);const C=this.parameters.contexts.length>1;let M="";let _="";let u=d.getText("C_COMMON_DIALOG_CANCEL");if(C){u=this.parameters.invocationGrouping===p.ChangeSet?u:d.getText("C_COMMON_DIALOG_SKIP");M=d.getText(this.parameters.invocationGrouping===p.ChangeSet?"C_COMMON_DIALOG_CANCEL_MESSAGES_WARNING":"C_COMMON_DIALOG_SKIP_MESSAGES_WARNING");_=d.getText(this.parameters.invocationGrouping===p.ChangeSet?"C_COMMON_DIALOG_CANCEL_MESSAGES_TEXT":"C_COMMON_DIALOG_SKIP_MESSAGES_TEXT",[s])}else{M=d.getText("C_COMMON_DIALOG_CANCEL_MESSAGES_GENERIC_ACTION_WARNING",[s])}const f=new r({message:M,type:g.Information,target:undefined,persistent:true,description:_.length?_:undefined});t=[f].concat(t);o.setData(t);new c({messageObject:h.prepareMessageViewForDialog(o,true,C),actionName:s,messageDialogModel:o,cancelButtonTxt:u,onBeginButtonPress:this.handleMessageOnValidation.bind(this),onEndButtonPress:this.handleMessageOnCancel.bind(this),onClose:i}).open();return a};C.handleMessageOnValidation=function e(){for(const e of this.strictHandlingResolves){e.onContextValidation();e.handlingResolve(true)}h.removeBoundTransitionMessages();h.removeUnboundTransitionMessages();this.strictHandlingWarningMessages=[];this.parameters.events?.onValidation?.()};C.handleMessageOnCancel=function e(){const t=n.getResourceModel(this.parameters.appComponent);this.strictHandlingWarningMessages=[];this.canceled=true;for(const e of this.strictHandlingResolves){e.handlingResolve(false)}this.strictHandlingResolves=[];if(this.parameters.invocationGrouping===p.ChangeSet){i.information(t.getText("M_CHANGESET_CANCEL_MESSAGES"),{contentWidth:"150px"})}this.parameters.events?.onCancel?.()};return s}();d=C;return d},false);
//# sourceMappingURL=ODataStrictHandling.js.map