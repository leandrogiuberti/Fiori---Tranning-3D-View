/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)
 *      (c) Copyright 2009-2025 SAP SE. All rights reserved
 */
sap.ui.define(["sap/base/Log","sap/fe/base/ClassSupport","sap/fe/core/BaseController","sap/fe/core/CommonUtils","sap/fe/core/controllerextensions/Placeholder","sap/fe/core/controllerextensions/ViewState","sap/fe/core/helpers/ManifestHelper","sap/fe/core/helpers/PromiseKeeper","sap/fe/core/helpers/SizeHelper","sap/ui/base/BindingInfo","sap/ui/core/Element","sap/ui/core/routing/HashChanger","sap/ui/model/json/JSONModel","sap/ui/model/odata/v4/AnnotationHelper","sap/ui/thirdparty/URI","../controls/Any"],function(e,t,o,n,i,r,s,a,c,l,u,h,f,g,p,d){"use strict";var m,y,C,b,P,I,w;var R=s.getRouteTargetNames;var v=t.usingExtension;var T=t.defineUI5Class;function H(e,t,o,n){o&&Object.defineProperty(e,t,{enumerable:o.enumerable,configurable:o.configurable,writable:o.writable,value:o.initializer?o.initializer.call(n):void 0})}function _(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e,M(e,t)}function M(e,t){return M=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},M(e,t)}function A(e,t,o,n,i){var r={};return Object.keys(n).forEach(function(e){r[e]=n[e]}),r.enumerable=!!r.enumerable,r.configurable=!!r.configurable,("value"in r||r.initializer)&&(r.writable=!0),r=o.slice().reverse().reduce(function(o,n){return n(e,t,o)||o},r),i&&void 0!==r.initializer&&(r.value=r.initializer?r.initializer.call(i):void 0,r.initializer=void 0),void 0===r.initializer?(Object.defineProperty(e,t,r),null):r}function S(e,t){throw Error("Decorating class property failed. Please ensure that transform-class-properties is enabled and runs after the decorators transform.")}let V=(m=T("sap.fe.core.rootView.RootViewBaseController"),y=v(i),C=v(r),m(b=(P=function(t){function o(){var e;for(var o=arguments.length,n=new Array(o),i=0;i<o;i++){n[i]=arguments[i]}e=t.call(this,...n)||this;H(e,"oPlaceholder",I,e);H(e,"viewState",w,e);e.bIsComputingTitleHierachy=false;e._numberOfRoutesInProgress=0;return e}_(o,t);var i=o.prototype;i.onInit=function e(){c.init();this._aHelperModels=[]};i.getPlaceholder=function e(){return this.oPlaceholder};i.attachRouteMatchers=function e(){this.oPlaceholder.attachRouteMatchers();this.getAppComponent().getRoutingService().attachAfterRouteMatched({},this.onAfterRouteMatched,this)};i.onExit=function e(){this.getAppComponent().getRoutingService().detachAfterRouteMatched(this.onAfterRouteMatched,this);this.oRouter=undefined;c.exit();this._aHelperModels.forEach(function(e){e.destroy()})};i.getViewFromContainer=function e(t){const o=t.isA("sap.ui.core.ComponentContainer")?t.getComponentInstance().getRootControl():t;return o?.isA("sap.ui.core.mvc.View")?o:undefined};i.getViewsFromPages=function e(t){const o=[];t.forEach(e=>{const t=this.getViewFromContainer(e);if(t!==undefined){o.push(t)}});return o};i.getResourceBundle=function e(){return this.getOwnerComponent().getModel("i18n").getResourceBundle()};i.getRouter=function e(){if(!this.oRouter){this.oRouter=this.getAppComponent().getRouter()}return this.oRouter};i._createHelperModel=function e(){const t=new f;this._aHelperModels.push(t);return t};i.routingIsComplete=async function e(){await(this._routingIsComplete?.promise||Promise.resolve())};i.waitForRightMostViewReady=async function e(t){return new Promise(function(e,o){const n=t.getParameter("views")??[],i=[];let r;n.forEach(function(e){let t=e;if(e&&e.getComponentInstance){const o=e.getComponentInstance();t=o.getRootControl()}if(t&&t.getController()&&t.getController().pageReady){i.push(t)}else if(t){r=t}});const s=i[i.length-1];if(s&&s.getController().pageReady.isPageReady()){e(s)}else if(s){s.getController().pageReady.attachEventOnce("pageReady",function(){e(s)})}else if(r){e(r)}else{o(new Error("No view was found during onAfterRouteMatched"))}})};i.restoreFocusFromHistory=function e(){switch(history.state.focusInfo.type){case"Row":const e=u.getElementById(history.state.focusInfo.tableId);const t=e.getRowBinding().getCurrentContexts().findIndex(e=>e.getPath()===history.state.focusInfo.contextPathFocus);if(t!==-1){e.focusRow(t)}break;default:u.getElementById(history.state.focusInfo.controlId)?.focus()}history.replaceState(Object.assign(history.state,{focusInfo:null}),"")};i.onAfterRouteMatched=async function t(o){this._routingIsComplete=this._routingIsComplete??new a;this._numberOfRoutesInProgress=++this._numberOfRoutesInProgress;const n=this._numberOfRoutesInProgress;try{const e=await this.waitForRightMostViewReady(o);if(e&&this.getVisibleViews().includes(e)){const t=this.getView().getContent()[0];if(t&&t.getAutoFocus&&!t.getAutoFocus()){t.setProperty("autoFocus",true,true)}const o=this.getAppComponent();this._scrollTablesToLastNavigatedItems();if(o.getEnvironmentCapabilities().getCapabilities().UShell){this.computeTitleHierarchy(e)}const n=o.getRouterProxy().isFocusForced();o.getRouterProxy().setFocusForced(false);if(e.getController()&&e.getParent().onPageReady){e.getParent().onPageReady({forceFocus:n})}if(history.state.focusInfo){this.restoreFocusFromHistory()}else if(o.getRouterProxy().getLastHistoryEntry().focusControlId){o.getRouterProxy().restoreFocusForCurrentHash()}if(this.onContainerReady){this.onContainerReady()}}return e}catch(t){e.error("An error occurs while computing the title hierarchy and calling focus method",t);return undefined}finally{if(n===this._numberOfRoutesInProgress){this._numberOfRoutesInProgress=0;this._routingIsComplete.resolve();this._routingIsComplete=undefined}}};i._getTitleHierarchyCache=function e(){if(!this.oTitleHierarchyCache){this.oTitleHierarchyCache={}}return this.oTitleHierarchyCache};i.clearTitleHierarchyCache=function e(t){delete this._getTitleHierarchyCache()[t]};i._computeTitleInfo=function e(t,o,n,i){let r=arguments.length>4&&arguments[4]!==undefined?arguments[4]:"";const s=n.split("/");if(!s[s.length-1].includes("?")){n+="?restoreHistory=true"}else{n+="&restoreHistory=true"}return{title:t,subtitle:o,intent:n,icon:r,description:i}};i._formatTitle=function e(t,o,n){let i="";switch(t){case"Value":i=`${o}`;break;case"ValueDescription":i=`${o} (${n})`;break;case"DescriptionValue":i=`${n} (${o})`;break;case"Description":i=`${n}`;break;default:}return i};i._fetchTitleValue=async function t(o){const i=this.getAppComponent(),r=this.getView().getModel(),s=i.getMetaModel(),a=s.getMetaPath(o),c=r.createBindingContext(o),u=s.getObject(`${a}/@com.sap.vocabularies.UI.v1.HeaderInfo/Title/Value`),h=g.format(u,{context:s.createBindingContext("/")});if(!h){return Promise.resolve("")}if(u.$Function==="odata.concat"){const e=new d({any:h});e.setModel(r);e.setBindingContext(c);const t=e.getBinding("any");if(t?.isA("sap.ui.model.CompositeBinding")){await Promise.all(t.getBindings().map(e=>e.requestValue?.()))}const o=e.getAny();e.destroy();return Promise.resolve(o)}const f=g.format(s.getObject(`${a}/@com.sap.vocabularies.UI.v1.HeaderInfo/Title/Value/$Path@com.sap.vocabularies.Common.v1.Text`),{context:s.createBindingContext("/")}),p=s.getObject(`${a}/@com.sap.vocabularies.UI.v1.HeaderInfo/Title/Value/$Path@`),m=[],y=l.parse(h),C=new Promise(function(e){const t=n.computeDisplayMode(p);e(t)});m.push(C);const b=y.parts?y.parts[0].path:y.path,P=y.formatter,I=r.bindProperty(b,c,{$$groupId:"$auto.Heroes"});I.initialize();const w=new Promise(function(e){const t=function(o){const n=P?P(o.getSource().getValue()):o.getSource().getValue();I.detachChange(t);e(n)};I.attachChange(t)});m.push(w);if(f){const e=l.parse(f);let t=e.parts?e.parts[0].path:e.path;t=b.lastIndexOf("/")>-1?`${b.slice(0,b.lastIndexOf("/"))}/${t}`:t;const o=e.formatter,n=r.bindProperty(t,c,{$$groupId:"$auto.Heroes"});n.initialize();const i=new Promise(function(e){const t=function(i){const r=o?o(i.getSource().getValue()):i.getSource().getValue();n.detachChange(t);e(r)};n.attachChange(t)});m.push(i)}try{const e=await Promise.all(m);let t="";if(typeof e!=="string"){t=this._formatTitle(e[0],e[1],e[2])}return t}catch(t){e.error("Error while fetching the title from the header info :"+t)}return""};i.getAppSpecificHash=function e(){const t=h.getInstance();return t.hrefForAppSpecificHash?p.decode(t.hrefForAppSpecificHash("")):"#/"};i._getHash=function e(){return h.getInstance().getHash()};i.getTitleInfoFromPath=async function e(t){const o=this._getTitleHierarchyCache();if(o[t]){return Promise.resolve(o[t])}const n=this.getAppComponent().getMetaModel();const i=n.getMetaPath(t);const r=n.getObject(`${i}/@com.sap.vocabularies.UI.v1.HeaderInfo/TypeName`);const s=this.getAppSpecificHash();const a=s+t.slice(1);return this._fetchTitleValue(t).then(e=>{const n=this._computeTitleInfo(r,e,a);o[t]=n;return n})};i._ensureHierarchyElementsAreStrings=function e(t){const o=[];for(const e in t){const n=t[e];const i={};for(const e in n){i[e]=typeof n[e]!=="string"?String(n[e]):n[e]}o.push(i)}return o};i.getTargetOptionsFromHash=function e(t){const o=this.getAppComponent();const n=o.getManifestEntry("sap.ui5").routing?.routes??[];for(const e of n){const n=o.getRouter().getRoute(e.name);if(n?.match(t)){const t=R(e.target)[0];return o.getRouter().getTarget(t)._oOptions}}};i.getTargetTypeFromHash=function e(t){return this.getTargetOptionsFromHash(t)?.name||""};i._getBrowserTitle=function e(t,o){const n=[];let i="",r="";const s=[...t];if(s.length>1){s.pop();s.forEach(e=>{if(e.subtitle){n.push(e.subtitle)}})}if(o.title){n.push(o.title)}if(o.description){i=`${o.subtitle?.toString().trim()} (${o.description})`}else{i=`${o.subtitle}`}r=n.join(" - ");return{headerText:r?`${i} - ${r}`:i}};i._setTitles=async function e(t,o,n){let i;const r=this.getAppComponent(),s=n.title??"";if(o.length){i=this._getBrowserTitle(o,n)}await this._setShellMenuTitle(r,s,t,i)};i.removeEmptyParamFromHash=function e(t,o){const n=t.getShellServices();const i=n.parseShellHash(o);for(const e in i?.params){if(!e.startsWith("sap-")&&i.params[e][0]===""){delete i.params[e]}}if(i?.params){delete i.params["sap-xapp-state"]}return`#${n.constructShellHash(i)}`};i.computeTitleHierarchy=async function t(o){const n=this.getAppComponent(),i=o.getBindingContext(),r=o.getParent(),s=[],a=this.getAppSpecificHash(),c=n.getManifestEntry("sap.app"),l=c.title||"",u=c.subTitle||"",h=c.icon||"";let f,g;if(r&&r._getPageTitleInformation){if(i){if(this.getTargetTypeFromHash("")==="sap.fe.templates.ListReport"){s.push(await this.getRootLevelTitleInformation(this.removeEmptyParamFromHash(n,a),l,u,h))}g=i.getPath();const e=g.split("/");let t="";e.shift();e.pop();for(const o of e){t+=`/${o}`;if(!n.getRouter().getRouteInfoByHash(t)){continue}const e=n.getMetaModel(),i=e.getMetaPath(t),r=e.getObject(`${i}/@com.sap.vocabularies.Common.v1.ResultContext`);if(!r){s.push(await this.getTitleInfoFromPath(t))}}}f=await r._getPageTitleInformation();const e=this._getHash();const t=a.endsWith("/")&&e.startsWith("/")?a+e.substring(1):a+e;f=this._computeTitleInfo(f.title??"",f.subtitle??"",t,f.description);if(i&&g){this._getTitleHierarchyCache()[g]=f}else if(!this._getTitleHierarchyCache()[a]){this._getTitleHierarchyCache()[a]=f}}else{throw new Error("Title information missing in HeaderInfo")}try{const e=s;const t=this._ensureHierarchyElementsAreStrings(e);t.reverse();await n.getShellServices().setHierarchy(t);await this._setTitles(l,t,f);return}catch(t){e.error(t)}finally{this.bIsComputingTitleHierachy=false}};i.getRootLevelTitleInformation=async function e(t,o,n,i){const r=this._getTitleHierarchyCache();if(r[t]){return Promise.resolve(r[t])}else{return Promise.resolve(this._computeTitleInfo(o,n,t,undefined,i))}};i.calculateLayout=function e(t,o,n){let i=arguments.length>3&&arguments[3]!==undefined?arguments[3]:false;return""};i.onContextBoundToView=function e(t){if(t){const e=this.getView().getModel("internal").getProperty("/deepestPath"),o=t.getPath();if(!e||e.indexOf(o)!==0){this.getView().getModel("internal").setProperty("/deepestPath",o,undefined,true)}}};i.displayErrorPage=async function e(t,o){let n=arguments.length>2&&arguments[2]!==undefined?arguments[2]:0;return Promise.resolve(true)};i.updateUIStateForView=function e(t,o){};i.getInstancedViews=function e(){return[]};i.getVisibleViews=function e(){return[]};i._scrollTablesToLastNavigatedItems=function e(){};i.isFclEnabled=function e(){return false};i._setShellMenuTitle=async function e(t,o,n,i){await t.getShellServices().setTitle(o,i)};i.getAppContentContainer=function e(){const t=this.getAppComponent();const o=t.getManifestEntry("sap.ui5").routing?.config?.controlId??"appContent";return this.getView().byId(o)};return o}(o),I=A(P.prototype,"oPlaceholder",[y],{configurable:true,enumerable:true,writable:true,initializer:null}),w=A(P.prototype,"viewState",[C],{configurable:true,enumerable:true,writable:true,initializer:null}),P))||b);return V},false);
//# sourceMappingURL=RootViewBaseController.js.map