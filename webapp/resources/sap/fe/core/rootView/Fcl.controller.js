/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)
 *      (c) Copyright 2009-2025 SAP SE. All rights reserved
 */
sap.ui.define(["sap/base/Log","sap/f/FlexibleColumnLayoutSemanticHelper","sap/f/library","sap/fe/base/ClassSupport","sap/fe/core/controllerextensions/ViewState","sap/fe/core/helpers/KeepAliveHelper","sap/fe/core/helpers/ManifestHelper","sap/m/Button","sap/m/FlexBox","sap/m/IllustratedMessage","sap/m/Page","../CommonUtils","./RootViewBaseController"],function(e,t,n,o,i,a,s,r,l,u,c,g,d){"use strict";var C,h,f,m,p;var y=s.getRouteTargetName;var w=o.usingExtension;var F=o.defineUI5Class;function b(e,t,n,o){n&&Object.defineProperty(e,t,{enumerable:n.enumerable,configurable:n.configurable,writable:n.writable,value:n.initializer?n.initializer.call(o):void 0})}function P(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e,E(e,t)}function E(e,t){return E=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},E(e,t)}function T(e,t,n,o,i){var a={};return Object.keys(o).forEach(function(e){a[e]=o[e]}),a.enumerable=!!a.enumerable,a.configurable=!!a.configurable,("value"in a||a.initializer)&&(a.writable=!0),a=n.slice().reverse().reduce(function(n,o){return o(e,t,n)||n},a),i&&void 0!==a.initializer&&(a.value=a.initializer?a.initializer.call(i):void 0,a.initializer=void 0),void 0===a.initializer?(Object.defineProperty(e,t,a),null):a}function S(e,t){throw Error("Decorating class property failed. Please ensure that transform-class-properties is enabled and runs after the decorators transform.")}const v=n.LayoutType;let L=(C=F("sap.fe.core.rootView.Fcl"),h=w(i.override({applyInitialStateOnly:function(){return false},adaptBindingRefreshControls:function(e){this.getView().getController()._getAllViews().forEach(function(t){const n=Promise.resolve(t);e.push(n)})},adaptStateControls:function(e){this.getView().getController()._getAllViews().forEach(function(t){const n=Promise.resolve(t);e.push(n)})},onRestore:function(){const e=this.getView().getController();const t=e.getAppContentContainer();const n=t.getModel("internal");const o=n.getProperty("/pages");for(const e in o){n.setProperty(`/pages/${e}/restoreStatus`,"pending")}e.onContainerReady()},onSuspend:function(){const e=this.getView().getController();const t=e.getFclControl();const n=t.getBeginColumnPages();const o=t.getMidColumnPages();const i=t.getEndColumnPages();const a=[].concat(n,o,i);e.getViewsFromPages(a).forEach(e=>{const t=e.getController();if(t?.viewState?.onSuspend){t.viewState.onSuspend()}})}})),C(f=(m=function(n){function o(){var e;for(var t=arguments.length,o=new Array(t),i=0;i<t;i++){o[i]=arguments[i]}e=n.call(this,...o)||this;b(e,"viewState",p,e);e._oTargetsAggregation={};e._oTargetsFromRoutePattern={};e.messagePages=[undefined,undefined,undefined];return e}P(o,n);var i=o.prototype;i.onInit=function e(){n.prototype.onInit.call(this);this._internalInit();this.setColumnDistributionModel()};i.manageDataReceived=function e(t){if(t.getParameter("error")){const e=t.getParameter("path");const n=this._getAllVisibleViews().find(t=>t.getBindingContext()?.getPath()===e);if(e&&n?.getBindingContext()?.isKeepAlive()){n.getController()._routing.onDataReceived(t)}}};i.attachRouteMatchers=function e(){this.getRouter().attachBeforeRouteMatched(this._updateViewForNavigatedRowsComputation,this);n.prototype.attachRouteMatchers.call(this);this._internalInit();this.getRouter().attachBeforeRouteMatched(this.onBeforeRouteMatched,this);this.getRouter().attachRouteMatched(this.onRouteMatched,this);this.getFclControl().attachStateChange(this._saveLayout,this)};i._internalInit=function e(){if(this._oRouterProxy){return}this.sCurrentRouteName="";this.sCurrentArguments={};const t=this.getAppComponent();const n=this.getAppComponent().getModel();n?.attachEvent("dataReceived",this.manageDataReceived.bind(this));this._oRouterProxy=t.getRouterProxy();this._oFCLConfig={maxColumnsCount:3};const o=t.getManifest()["sap.ui5"].routing;if(o?.config?.flexibleColumnLayout){const e=o.config.flexibleColumnLayout;if(e.defaultTwoColumnLayoutType){this._oFCLConfig.defaultTwoColumnLayoutType=e.defaultTwoColumnLayoutType}if(e.defaultThreeColumnLayoutType){this._oFCLConfig.defaultThreeColumnLayoutType=e.defaultThreeColumnLayoutType}if(e.limitFCLToTwoColumns===true){this._oFCLConfig.maxColumnsCount=2}}if(o?.config?.controlAggregation){this._oFCLConfig.defaultControlAggregation=o.config.controlAggregation}this._initializeTargetAggregation(t);this._initializeRoutesInformation(t);this.getFclControl().attachStateChange(this.onStateChanged,this);this.getFclControl().attachAfterEndColumnNavigate(this.onStateChanged,this)};i.getFclControl=function e(){return this.getAppContentContainer()};i.getFclConfig=function e(){return this._oFCLConfig};i._saveLayout=function e(t){this.sPreviousLayout=t.getParameters().layout};i._updateViewForNavigatedRowsComputation=function e(){const t=this._getAllVisibleViews(this.sPreviousLayout);const n=t.length?t[t.length-1]:undefined;this.getRouter().attachEventOnce("routeMatched",e=>{const t=e.getParameter("views");const o=this.getViewFromContainer(t[t.length-1]);if(n&&o){const e=n.getViewData()?.viewLevel;const t=o.getViewData()?.viewLevel;if(t===this._oFCLConfig.maxColumnsCount){this.oAdditionalViewForNavRowsComputation=o}if(e!==undefined&&t!==undefined&&e<this._oFCLConfig.maxColumnsCount&&e>t&&o!==n){this.oAdditionalViewForNavRowsComputation=n}}})};i.getViewForNavigatedRowsComputation=function e(){return this.oAdditionalViewForNavRowsComputation};i.onExit=function e(){this.getRouter().detachRouteMatched(this.onRouteMatched,this);this.getRouter().detachBeforeRouteMatched(this.onBeforeRouteMatched,this);this.getFclControl().detachStateChange(this.onStateChanged,this);this.getFclControl().detachAfterEndColumnNavigate(this.onStateChanged,this);d.prototype.onExit.bind(this)()};i.isFclEnabled=function e(){return true};i.displayErrorPage=async function t(n,o){let i=arguments.length>2&&arguments[2]!==undefined?arguments[2]:0;return new Promise(async(t,a)=>{try{const e=this.getFclControl();const a=o;if(a.FCLLevel!==undefined&&i===0){i=a.FCLLevel}if(this._oFCLConfig&&i>=this._oFCLConfig.maxColumnsCount){i=this._oFCLConfig.maxColumnsCount-1}if(i<0||i>2){i=0}let s=this.messagePages[i];if(!s){s=new c({showHeader:false});this.messagePages[i]=s;switch(i){case 0:e.addBeginColumnPage(s);break;case 1:e.addMidColumnPage(s);break;default:e.addEndColumnPage(s)}}let d;const C=new l({alignItems:"Start",justifyContent:"End",items:[new r({type:"Transparent",icon:"sap-icon://decline",tooltip:"{sap.fe.i18n>C_COMMON_SAPFE_CLOSE}",press:()=>{if(o.handleShellBack===true){e.to(d.getId(),{},{})}else{window.history.back()}}}).addStyleClass("sapUiLargeMarginEnd")]});const h=new u({title:n,description:o.description??"",illustrationType:o.errorType?`sapIllus-${o.errorType}`:"sapIllus-UnableToLoad"});s.removeAllContent();s.addContent(C);s.addContent(h);let f;switch(i){case 0:d=e.getCurrentBeginColumnPage();f="afterBeginColumnNavigate";break;case 1:d=e.getCurrentMidColumnPage();f="afterMidColumnNavigate";break;default:d=e.getCurrentEndColumnPage();f="afterEndColumnNavigate"}if(o.handleShellBack===true){const t=g.getAppComponent(d);await t.getShellServices().setBackNavigation(async function(){e.to(d.getId(),{},{});await t.getShellServices().setBackNavigation()})}const m=this.getViewFromContainer(d);e.attachEventOnce(f,e=>{if(m&&m.isA("sap.ui.core.mvc.View")){m.getController().pageReady?.forcePageReady()}t(true)});e.to(s.getId(),{},{})}catch(t){a(false);e.info(`${t}`)}})};i._initializeTargetAggregation=function e(t){const n=t.getManifest(),o=n["sap.ui5"].routing?n["sap.ui5"].routing.targets:null;this._oTargetsAggregation={};if(o){Object.keys(o).forEach(e=>{const t=o[e];if(t.controlAggregation){this._oTargetsAggregation[e]={aggregation:t.controlAggregation,pattern:t.contextPattern}}else{this._oTargetsAggregation[e]={aggregation:"page",pattern:null}}})}};i._initializeRoutesInformation=function e(t){const n=t.getManifest(),o=n["sap.ui5"].routing?n["sap.ui5"].routing.routes:null;this._oTargetsFromRoutePattern={};if(o){o.forEach(e=>{if(e.pattern){this._oTargetsFromRoutePattern[e.pattern]=e.target}})}};i.getCurrentArgument=function e(){return this.sCurrentArguments};i.getCurrentRouteName=function e(){return this.sCurrentRouteName};i.getTargetAggregation=function e(){return this._oTargetsAggregation};i.onRouteMatched=function e(t){const n=t.getParameter("name");this.sCurrentRouteName=n;this.sCurrentArguments=t.getParameter("arguments")};i._scrollTablesToLastNavigatedItems=function e(){const t=this._getAllVisibleViews();if(t.length>1||t.length&&t[0].getViewData().viewLevel<this._oFCLConfig.maxColumnsCount){const e=this.getViewForNavigatedRowsComputation();if(e&&!t.includes(e)){t.push(e)}for(let e=t.length-1;e>0;e--){const n=t[e],o=t[e-1];const i=n.getBindingContext();const a=o.getController();if(i&&a._scrollTablesToRow){a._scrollTablesToRow(i.getPath())}}}};i.onStateChanged=function e(t){const n=t.getParameter("isNavigationArrow");if(this.sCurrentArguments!==undefined){if(!this.sCurrentArguments["?query"]){this.sCurrentArguments["?query"]={}}this.sCurrentArguments["?query"].layout=t.getParameter("layout")}this._forceModelContextChangeOnBreadCrumbs(t);if(n&&this.sCurrentRouteName){this._oRouterProxy.navTo(this.sCurrentRouteName,this.sCurrentArguments)}const o=this.getRightmostView();if(o){this.computeTitleHierarchy(o)}};i._forceModelContextChangeOnBreadCrumbs=function e(t){const n=t.getSource();let o=[];o=o.concat(n.getBeginColumnPages()).concat(n.getMidColumnPages()).concat(n.getEndColumnPages());o.forEach(e=>{const t=this.getViewFromContainer(e);const n=t?.byId&&t.byId("breadcrumbs");if(n){n.fireModelContextChange()}})};i._updateShareButtonVisibility=function e(t,n){let o;switch(n){case"OneColumn":o=t==="beginColumn";break;case"MidColumnFullScreen":case"ThreeColumnsBeginExpandedEndHidden":case"ThreeColumnsMidExpandedEndHidden":case"TwoColumnsBeginExpanded":case"TwoColumnsMidExpanded":o=t==="midColumn";break;case"EndColumnFullScreen":case"ThreeColumnsEndExpanded":case"ThreeColumnsMidExpanded":o=t==="endColumn";break;default:o=false}return o};i._updateEditButtonVisiblity=function e(t,n){const o=this.getAppComponent()?.getEnvironmentCapabilities()?.getCapabilities()?.HiddenDraft?.enabled;let i=true;switch(t){case"midColumn":switch(n){case"TwoColumnsMidExpanded":case"ThreeColumnsMidExpandedEndHidden":case"ThreeColumnsBeginExpandedEndHidden":case"TwoColumnsBeginExpanded":if(!o){i=false}break;case"ThreeColumnsMidExpanded":case"ThreeColumnsEndExpanded":i=false;break}break;case"endColumn":switch(n){case"ThreeColumnsMidExpanded":case"ThreeColumnsEndExpanded":if(!o){i=false}break}break}return i};i._updateSaveAndCancelButtonVisiblity=function e(t,n){const o=this.getAppComponent()?.getEnvironmentCapabilities()?.getCapabilities()?.HiddenDraft?.enabled;let i=true;switch(t){case"midColumn":switch(n){case"ThreeColumnsEndExpanded":case"ThreeColumnsMidExpanded":if(o){i=false}break}break}return i};i.updateUIStateForView=function e(t,n){const o=this.getHelper().getCurrentUIState(),i=["beginColumn","midColumn","endColumn"],a=this.getFclControl().getLayout();let s;if(!t.getModel("fclhelper")){t.setModel(this._createHelperModel(),"fclhelper")}if(!o.actionButtonsInfo){o.actionButtonsInfo={}}if(!o.actionButtonsInfo.midColumn){o.actionButtonsInfo.midColumn={}}if(!o.actionButtonsInfo.endColumn){o.actionButtonsInfo.endColumn={}}if(n>=this._oFCLConfig.maxColumnsCount){s=i[this._oFCLConfig.maxColumnsCount-1];o.actionButtonsInfo.midColumn.fullScreen=null;o.actionButtonsInfo.midColumn.exitFullScreen=null;o.actionButtonsInfo.midColumn.closeColumn=null;o.actionButtonsInfo.endColumn.exitFullScreen=null;o.actionButtonsInfo.endColumn.fullScreen=null;o.actionButtonsInfo.endColumn.closeColumn=null}else{s=i[n]}if(n>=this._oFCLConfig.maxColumnsCount||a==="EndColumnFullScreen"||a==="MidColumnFullScreen"||a==="OneColumn"){t.getModel("fclhelper").setProperty("/breadCrumbIsVisible",true)}else{t.getModel("fclhelper").setProperty("/breadCrumbIsVisible",false)}o.actionButtonsInfo.beginColumn={fullScreen:null,exitFullScreen:null,closeColumn:null};const r=Object.assign({},o.actionButtonsInfo[s]);r.switchVisible=r.fullScreen!==null||r.exitFullScreen!==null;r.switchIcon=r.fullScreen!==null?"sap-icon://full-screen":"sap-icon://exit-full-screen";r.isFullScreen=r.fullScreen===null;r.closeVisible=r.closeColumn!==null;t.getModel("fclhelper").setProperty("/actionButtonsInfo",r);t.getModel("fclhelper").setProperty("/showEditButton",this._updateEditButtonVisiblity(s,a));t.getModel("fclhelper").setProperty("/showSaveAndCancelButton",this._updateSaveAndCancelButtonVisiblity(s,a));t.getModel("fclhelper").setProperty("/showShareIcon",this._updateShareButtonVisibility(s,a))};i.onBeforeRouteMatched=async function e(t){if(t){const e=t.getParameters().arguments["?query"];let n=e?e.layout:undefined;if(!n){const e=this.getHelper().getNextUIState(0);n=e.layout}const o=t.getParameter("config")?.target;n=this._correctLayoutForTargets(n,o);n=await this.getStoredLayout(n);if(n){this.getFclControl().setLayout(n)}}};i.getHelper=function e(){return t.getInstanceFor(this.getFclControl(),this._oFCLConfig)};i.calculateLayout=function e(t,n,o){let i=arguments.length>3&&arguments[3]!==undefined?arguments[3]:false;if(!o){o=i?this.getFclControl().getLayout():this.getHelper().getNextUIState(t).layout}const a=this.getRouter().getRouteByHash?.(`${n}?layout=${o}`);const s=this._oTargetsFromRoutePattern[a.getPattern()];return this._correctLayoutForTargets(o,s)};i._correctLayoutForTargets=function e(t,n){const o={2:["TwoColumnsMidExpanded","TwoColumnsBeginExpanded","MidColumnFullScreen"],3:["ThreeColumnsMidExpanded","ThreeColumnsEndExpanded","ThreeColumnsMidExpandedEndHidden","ThreeColumnsBeginExpandedEndHidden","MidColumnFullScreen","EndColumnFullScreen"]};if(n&&!Array.isArray(n)){n=[n]}if(!n){return t}else if(n.length>1){const e=o[n.length.toString()];if(!e.includes(t)){const o=this._getDefaultLayout(n.length);t=o&&e.includes(o)?o:e[0]}}else{const e=this.getTargetAggregation()[y(n[0])].aggregation||this._oFCLConfig.defaultControlAggregation;switch(e){case"beginColumnPages":t=v.OneColumn;break;case"midColumnPages":t=v.MidColumnFullScreen;break;case"endColumnPages":t=v.EndColumnFullScreen;break;default:break}}return t};i._getDefaultLayout=function e(t){switch(t){case 3:return this._oFCLConfig.defaultTwoColumnLayoutType;case 2:return this._oFCLConfig.defaultTwoColumnLayoutType;default:return undefined}};i.getInstancedViews=function e(){const t=this.getFclControl();const n=[...t.getBeginColumnPages(),...t.getMidColumnPages(),...t.getEndColumnPages()];return this.getViewsFromPages(n)};i.getVisibleViews=function e(){return this._getAllVisibleViews()};i._getAllVisibleViews=function t(n){const o=[];const i=n?n:this.getFclControl().getLayout();const a=e=>{if(e){const t=this.getViewFromContainer(e);if(t){o.push(t)}}};switch(i){case v.EndColumnFullScreen:a(this.getFclControl().getCurrentEndColumnPage());break;case v.MidColumnFullScreen:a(this.getFclControl().getCurrentMidColumnPage());break;case v.OneColumn:a(this.getFclControl().getCurrentBeginColumnPage());break;case v.ThreeColumnsEndExpanded:case v.ThreeColumnsMidExpanded:a(this.getFclControl().getCurrentBeginColumnPage());a(this.getFclControl().getCurrentMidColumnPage());a(this.getFclControl().getCurrentEndColumnPage());break;case v.TwoColumnsBeginExpanded:case v.TwoColumnsMidExpanded:case v.ThreeColumnsMidExpandedEndHidden:case v.ThreeColumnsBeginExpandedEndHidden:a(this.getFclControl().getCurrentBeginColumnPage());a(this.getFclControl().getCurrentMidColumnPage());break;default:e.error(`Unhandled switch case for ${this.getFclControl().getLayout()}`)}return o};i._getAllViews=function t(n){const o=[];const i=n?n:this.getFclControl().getLayout();const a=e=>{if(e){const t=this.getViewFromContainer(e);if(t){o.push(t)}}};switch(i){case v.OneColumn:a(this.getFclControl().getCurrentBeginColumnPage());break;case v.ThreeColumnsEndExpanded:case v.ThreeColumnsMidExpanded:case v.ThreeColumnsMidExpandedEndHidden:case v.ThreeColumnsBeginExpandedEndHidden:case v.EndColumnFullScreen:a(this.getFclControl().getCurrentBeginColumnPage());a(this.getFclControl().getCurrentMidColumnPage());a(this.getFclControl().getCurrentEndColumnPage());break;case v.TwoColumnsBeginExpanded:case v.TwoColumnsMidExpanded:a(this.getFclControl().getCurrentBeginColumnPage());a(this.getFclControl().getCurrentMidColumnPage());break;case v.MidColumnFullScreen:{const e=this.getHelper().getCurrentUIState().actionButtonsInfo?.midColumn?.exitFullScreen??"";a(this.getFclControl().getCurrentBeginColumnPage());a(this.getFclControl().getCurrentMidColumnPage());if(e.startsWith("ThreeColumn")){a(this.getFclControl().getCurrentEndColumnPage())}}break;default:e.error(`Unhandled switch case for ${this.getFclControl().getLayout()}`)}return o};i.onContainerReady=async function e(){const t=this._getAllVisibleViews();const n=t.reduce(function(e,t){if(t.isA&&t.isA("sap.ui.core.mvc.View")){e.push(a.restoreView(t))}return e},[]);return Promise.all(n)};i.getRightmostContext=function e(){return this.getRightmostView()?.getBindingContext()??undefined};i.getRightmostView=function e(){return this._getAllViews().pop()};i.isContextUsedInPages=function e(t){if(!this.getFclControl()){return false}const n=this._getAllViews();for(const e of n){if(e){if(e.getBindingContext()===t){return true}}else{return false}}return false};i._setShellMenuTitle=async function e(t,n,o,i){if(this.getHelper().getCurrentUIState().isFullScreen!==true){await t.getShellServices().setTitle(o,i)}else{await t.getShellServices().setTitle(n,i)}};i.getFCLPersonalizationData=async function t(){const n=this.getAppComponent()?.getShellServices();let o;try{o=await(n.getApplicationPersonalizationData?.("FCL-Personalization"))}catch(t){e.error("Error while getting the FCL-Personalization data from the personalization service",t)}return o??{defaultLayouts:{},columnsDistribution:{desktop:{},tablet:{}}}};i.setFCLPersonalizationData=function e(t){const n=this.getAppComponent()?.getShellServices();n.setApplicationPersonalizationData("FCL-Personalization",t)};i.setColumnDistributionModel=async function e(){this.fclStateCache=this.getFCLPersonalizationData();const t=(await this.fclStateCache).columnsDistribution;if(t){const e=this.getView().getModel("internal");e.setProperty("/FCLColumnsDistribution",t)}};i.onColumnsDistributionChange=async function e(t){const{media:n,layout:o,columnsSizes:i}=t.getParameters();const a=this.getView().getModel("internal");a.setProperty(`/FCLColumnsDistribution/${n}/${o}`,i);const s=await this.fclStateCache;const r=this.getNumberOfColumnsFromLayout(o);if(r){s.defaultLayouts[r]=o;s.columnsDistribution[n][o]=i;this.setFCLPersonalizationData(s);this.fclStateCache=Promise.resolve(s)}};i.getNumberOfColumnsFromLayout=function e(t){const n=/^(One|Two|Three)Column/.exec(t)?.[1];switch(n){case"One":return 1;case"Two":return 2;case"Three":return 3;default:return null}};i.getStoredLayout=async function e(t){const n=t??this.getFclControl().getLayout();const o=this.getNumberOfColumnsFromLayout(n);if(o){const e=(await this.fclStateCache).defaultLayouts;return e?.[o]??n}return n};return o}(d),p=T(m.prototype,"viewState",[h],{configurable:true,enumerable:true,writable:true,initializer:null}),m))||f);return L},false);
//# sourceMappingURL=Fcl.controller.js.map