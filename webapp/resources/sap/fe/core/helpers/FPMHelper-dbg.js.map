{"version":3,"names":["FPMHelper","loadModuleAndCallMethod","module","method","source","_len","arguments","length","args","Array","_key","Promise","resolve","extensionAPI","view","isA","CommonUtils","getTargetView","getSource","getControllerName","getController","getExtensionAPI","startsWith","fnTarget","ObjectPath","get","replace","substring","sap","ui","require","loadedModule","bind","actionWrapper","oEvent","sModule","sMethod","oParameters","Log","debug","oSource","oView","oBindingContext","getBindingContext","listBinding","aSelectedContexts","undefined","contexts","getParent","getMdcTable","getRowBinding","control","parent","validationWrapper","oValidationContexts","getCustomFunction","moduleName","functionName","customFunction","controllerExt","error"],"sourceRoot":".","sources":["FPMHelper.ts"],"sourcesContent":["import Log from \"sap/base/Log\";\nimport ObjectPath from \"sap/base/util/ObjectPath\";\nimport type { FEView } from \"sap/fe/core/BaseController\";\nimport CommonUtils from \"sap/fe/core/CommonUtils\";\nimport type ExtensionAPI from \"sap/fe/core/ExtensionAPI\";\nimport type UI5Event from \"sap/ui/base/Event\";\nimport type EventProvider from \"sap/ui/base/EventProvider\";\nimport type Control from \"sap/ui/core/Control\";\nimport type UI5Element from \"sap/ui/core/Element\";\nimport type View from \"sap/ui/core/mvc/View\";\nimport type MdcTable from \"sap/ui/mdc/Table\";\nimport type Context from \"sap/ui/model/Context\";\nimport type ODataListBinding from \"sap/ui/model/odata/v4/ODataListBinding\";\n\nconst FPMHelper = {\n\tloadModuleAndCallMethod: async function (\n\t\tmodule: string,\n\t\tmethod: string,\n\t\tsource: View | UI5Event<{}, Control>,\n\t\t...args: unknown[]\n\t): Promise<unknown> {\n\t\treturn new Promise(function (resolve: (value: unknown) => void) {\n\t\t\tlet extensionAPI: ExtensionAPI | undefined;\n\t\t\tlet view: View;\n\t\t\tif (source.isA<UI5Event>(\"sap.ui.base.Event\")) {\n\t\t\t\tview = CommonUtils.getTargetView(source.getSource());\n\t\t\t} else {\n\t\t\t\tview = source;\n\t\t\t}\n\n\t\t\tif (\n\t\t\t\tview.getControllerName() === \"sap.fe.templates.ObjectPage.ObjectPageController\" ||\n\t\t\t\tview.getControllerName() === \"sap.fe.ariba.ObjectPage.ObjectPageController\" ||\n\t\t\t\tview.getControllerName() === \"sap.fe.templates.ListReport.ListReportController\" ||\n\t\t\t\tview.getControllerName() === \"sap.fe.ariba.ListReport.ListReportController\"\n\t\t\t) {\n\t\t\t\textensionAPI = (view as FEView).getController().getExtensionAPI();\n\t\t\t}\n\n\t\t\tif (module.startsWith(\"/extension/\")) {\n\t\t\t\tconst fnTarget = ObjectPath.get(module.replace(/\\//g, \".\").substring(1), extensionAPI);\n\t\t\t\tresolve(fnTarget[method](...args));\n\t\t\t} else {\n\t\t\t\tsap.ui.require([module], function (loadedModule: Record<string, Function>) {\n\t\t\t\t\t// - we bind the action to the extensionAPI of the controller so it has the same scope as a custom section\n\t\t\t\t\t// - we provide the context as API, maybe if needed further properties\n\t\t\t\t\tresolve(loadedModule[method].bind(extensionAPI)(...args));\n\t\t\t\t});\n\t\t\t}\n\t\t});\n\t},\n\n\tactionWrapper: async function (\n\t\toEvent: UI5Event,\n\t\tsModule?: string,\n\t\tsMethod?: string,\n\t\toParameters?: { contexts?: Context[] }\n\t): Promise<unknown> {\n\t\tif (!sModule || !sMethod) {\n\t\t\tLog.debug(\"Both the module and the method must be defined to execute a custom action\");\n\t\t\treturn;\n\t\t}\n\n\t\t//The source would be command execution, in case a command is defined for the action in the manifest.\n\t\tconst oSource = (oEvent.getSource ? oEvent.getSource() : (oEvent as { oSource?: EventProvider }).oSource) as Control,\n\t\t\toView = CommonUtils.getTargetView(oSource),\n\t\t\toBindingContext = oSource.getBindingContext()!;\n\n\t\tlet listBinding: ODataListBinding | undefined;\n\t\tlet aSelectedContexts: Context[];\n\n\t\tif (oParameters !== undefined) {\n\t\t\taSelectedContexts = oParameters.contexts || [];\n\t\t} else if (oBindingContext !== undefined) {\n\t\t\taSelectedContexts = [oBindingContext];\n\t\t} else {\n\t\t\taSelectedContexts = [];\n\t\t}\n\t\tif (oSource.getParent()?.isA(\"sap.ui.mdc.actiontoolbar.ActionToolbarAction\") || oSource.getParent()?.isA(\"sap.m.MenuWrapper\")) {\n\t\t\tlistBinding = FPMHelper.getMdcTable(oSource)?.getRowBinding();\n\t\t}\n\n\t\treturn FPMHelper.loadModuleAndCallMethod(sModule, sMethod, oView, oBindingContext, aSelectedContexts, listBinding);\n\t},\n\tgetMdcTable: function (control: UI5Element): MdcTable | null | undefined {\n\t\tconst parent = control.getParent();\n\t\tif (!parent || parent.isA<MdcTable>(\"sap.ui.mdc.Table\")) {\n\t\t\treturn parent;\n\t\t}\n\t\treturn FPMHelper.getMdcTable(parent as Control);\n\t},\n\tvalidationWrapper: async function (\n\t\tsModule: string,\n\t\tsMethod: string,\n\t\toValidationContexts: Record<string, unknown>,\n\t\toView: View,\n\t\toBindingContext: Context\n\t): Promise<{ messageTarget?: string; messageText: string }[]> {\n\t\treturn FPMHelper.loadModuleAndCallMethod(sModule, sMethod, oView, oBindingContext, oValidationContexts) as Promise<\n\t\t\t{ messageTarget?: string; messageText: string }[]\n\t\t>;\n\t},\n\t/**\n\t * Returns an external custom function defined either in a custom controller extension or in an external module.\n\t * @param moduleName The external module name, or /extension/<path to the custom controller extension module>\n\t * @param functionName The name of the function\n\t * @param source A control in the view or an event triggered by a control in the view\n\t * @returns The function (or undefined if it couldn't be found)\n\t */\n\tgetCustomFunction<FunctionType>(\n\t\tmoduleName: string,\n\t\tfunctionName: string,\n\t\tsource: Control | UI5Event<{}, Control>\n\t): FunctionType | undefined {\n\t\tlet control: Control;\n\t\tif (source.isA<UI5Event>(\"sap.ui.base.Event\")) {\n\t\t\tcontrol = source.getSource();\n\t\t} else {\n\t\t\tcontrol = source;\n\t\t}\n\t\tconst view = CommonUtils.getTargetView(control);\n\t\tconst extensionAPI = view.getController().getExtensionAPI();\n\n\t\tlet customFunction: FunctionType | undefined;\n\n\t\tif (moduleName.startsWith(\"/extension/\")) {\n\t\t\tconst controllerExt = ObjectPath.get(moduleName.replace(/\\//g, \".\").substring(1), extensionAPI);\n\t\t\tcustomFunction = controllerExt ? controllerExt[functionName] : undefined;\n\t\t} else {\n\t\t\tconst module = sap.ui.require(moduleName);\n\t\t\tcustomFunction = module ? module[functionName]?.bind(extensionAPI) : undefined;\n\t\t}\n\n\t\tif (!customFunction) {\n\t\t\tLog.error(`Couldn't find method ${functionName} in ${moduleName}`);\n\t\t}\n\t\treturn customFunction;\n\t}\n};\n\nexport default FPMHelper;\n"],"mappings":";;;;;;;EAcA,MAAMA,SAAS,GAAG;IACjBC,uBAAuB,EAAE,eAAAA,CACxBC,MAAc,EACdC,MAAc,EACdC,MAAoC,EAEjB;MAAA,SAAAC,IAAA,GAAAC,SAAA,CAAAC,MAAA,EADhBC,IAAI,OAAAC,KAAA,CAAAJ,IAAA,OAAAA,IAAA,WAAAK,IAAA,MAAAA,IAAA,GAAAL,IAAA,EAAAK,IAAA;QAAJF,IAAI,CAAAE,IAAA,QAAAJ,SAAA,CAAAI,IAAA;MAAA;MAEP,OAAO,IAAIC,OAAO,CAAC,UAAUC,OAAiC,EAAE;QAC/D,IAAIC,YAAsC;QAC1C,IAAIC,IAAU;QACd,IAAIV,MAAM,CAACW,GAAG,CAAW,mBAAmB,CAAC,EAAE;UAC9CD,IAAI,GAAGE,WAAW,CAACC,aAAa,CAACb,MAAM,CAACc,SAAS,CAAC,CAAC,CAAC;QACrD,CAAC,MAAM;UACNJ,IAAI,GAAGV,MAAM;QACd;QAEA,IACCU,IAAI,CAACK,iBAAiB,CAAC,CAAC,KAAK,kDAAkD,IAC/EL,IAAI,CAACK,iBAAiB,CAAC,CAAC,KAAK,8CAA8C,IAC3EL,IAAI,CAACK,iBAAiB,CAAC,CAAC,KAAK,kDAAkD,IAC/EL,IAAI,CAACK,iBAAiB,CAAC,CAAC,KAAK,8CAA8C,EAC1E;UACDN,YAAY,GAAIC,IAAI,CAAYM,aAAa,CAAC,CAAC,CAACC,eAAe,CAAC,CAAC;QAClE;QAEA,IAAInB,MAAM,CAACoB,UAAU,CAAC,aAAa,CAAC,EAAE;UACrC,MAAMC,QAAQ,GAAGC,UAAU,CAACC,GAAG,CAACvB,MAAM,CAACwB,OAAO,CAAC,KAAK,EAAE,GAAG,CAAC,CAACC,SAAS,CAAC,CAAC,CAAC,EAAEd,YAAY,CAAC;UACtFD,OAAO,CAACW,QAAQ,CAACpB,MAAM,CAAC,CAAC,GAAGK,IAAI,CAAC,CAAC;QACnC,CAAC,MAAM;UACNoB,GAAG,CAACC,EAAE,CAACC,OAAO,CAAC,CAAC5B,MAAM,CAAC,EAAE,UAAU6B,YAAsC,EAAE;YAC1E;YACA;YACAnB,OAAO,CAACmB,YAAY,CAAC5B,MAAM,CAAC,CAAC6B,IAAI,CAACnB,YAAY,CAAC,CAAC,GAAGL,IAAI,CAAC,CAAC;UAC1D,CAAC,CAAC;QACH;MACD,CAAC,CAAC;IACH,CAAC;IAEDyB,aAAa,EAAE,eAAAA,CACdC,MAAgB,EAChBC,OAAgB,EAChBC,OAAgB,EAChBC,WAAsC,EACnB;MACnB,IAAI,CAACF,OAAO,IAAI,CAACC,OAAO,EAAE;QACzBE,GAAG,CAACC,KAAK,CAAC,2EAA2E,CAAC;QACtF;MACD;;MAEA;MACA,MAAMC,OAAO,GAAIN,MAAM,CAAChB,SAAS,GAAGgB,MAAM,CAAChB,SAAS,CAAC,CAAC,GAAIgB,MAAM,CAAiCM,OAAmB;QACnHC,KAAK,GAAGzB,WAAW,CAACC,aAAa,CAACuB,OAAO,CAAC;QAC1CE,eAAe,GAAGF,OAAO,CAACG,iBAAiB,CAAC,CAAE;MAE/C,IAAIC,WAAyC;MAC7C,IAAIC,iBAA4B;MAEhC,IAAIR,WAAW,KAAKS,SAAS,EAAE;QAC9BD,iBAAiB,GAAGR,WAAW,CAACU,QAAQ,IAAI,EAAE;MAC/C,CAAC,MAAM,IAAIL,eAAe,KAAKI,SAAS,EAAE;QACzCD,iBAAiB,GAAG,CAACH,eAAe,CAAC;MACtC,CAAC,MAAM;QACNG,iBAAiB,GAAG,EAAE;MACvB;MACA,IAAIL,OAAO,CAACQ,SAAS,CAAC,CAAC,EAAEjC,GAAG,CAAC,8CAA8C,CAAC,IAAIyB,OAAO,CAACQ,SAAS,CAAC,CAAC,EAAEjC,GAAG,CAAC,mBAAmB,CAAC,EAAE;QAC9H6B,WAAW,GAAG5C,SAAS,CAACiD,WAAW,CAACT,OAAO,CAAC,EAAEU,aAAa,CAAC,CAAC;MAC9D;MAEA,OAAOlD,SAAS,CAACC,uBAAuB,CAACkC,OAAO,EAAEC,OAAO,EAAEK,KAAK,EAAEC,eAAe,EAAEG,iBAAiB,EAAED,WAAW,CAAC;IACnH,CAAC;IACDK,WAAW,EAAE,SAAAA,CAAUE,OAAmB,EAA+B;MACxE,MAAMC,MAAM,GAAGD,OAAO,CAACH,SAAS,CAAC,CAAC;MAClC,IAAI,CAACI,MAAM,IAAIA,MAAM,CAACrC,GAAG,CAAW,kBAAkB,CAAC,EAAE;QACxD,OAAOqC,MAAM;MACd;MACA,OAAOpD,SAAS,CAACiD,WAAW,CAACG,MAAiB,CAAC;IAChD,CAAC;IACDC,iBAAiB,EAAE,eAAAA,CAClBlB,OAAe,EACfC,OAAe,EACfkB,mBAA4C,EAC5Cb,KAAW,EACXC,eAAwB,EACqC;MAC7D,OAAO1C,SAAS,CAACC,uBAAuB,CAACkC,OAAO,EAAEC,OAAO,EAAEK,KAAK,EAAEC,eAAe,EAAEY,mBAAmB,CAAC;IAGxG,CAAC;IACD;AACD;AACA;AACA;AACA;AACA;AACA;IACCC,iBAAiBA,CAChBC,UAAkB,EAClBC,YAAoB,EACpBrD,MAAuC,EACZ;MAC3B,IAAI+C,OAAgB;MACpB,IAAI/C,MAAM,CAACW,GAAG,CAAW,mBAAmB,CAAC,EAAE;QAC9CoC,OAAO,GAAG/C,MAAM,CAACc,SAAS,CAAC,CAAC;MAC7B,CAAC,MAAM;QACNiC,OAAO,GAAG/C,MAAM;MACjB;MACA,MAAMU,IAAI,GAAGE,WAAW,CAACC,aAAa,CAACkC,OAAO,CAAC;MAC/C,MAAMtC,YAAY,GAAGC,IAAI,CAACM,aAAa,CAAC,CAAC,CAACC,eAAe,CAAC,CAAC;MAE3D,IAAIqC,cAAwC;MAE5C,IAAIF,UAAU,CAAClC,UAAU,CAAC,aAAa,CAAC,EAAE;QACzC,MAAMqC,aAAa,GAAGnC,UAAU,CAACC,GAAG,CAAC+B,UAAU,CAAC9B,OAAO,CAAC,KAAK,EAAE,GAAG,CAAC,CAACC,SAAS,CAAC,CAAC,CAAC,EAAEd,YAAY,CAAC;QAC/F6C,cAAc,GAAGC,aAAa,GAAGA,aAAa,CAACF,YAAY,CAAC,GAAGX,SAAS;MACzE,CAAC,MAAM;QACN,MAAM5C,MAAM,GAAG0B,GAAG,CAACC,EAAE,CAACC,OAAO,CAAC0B,UAAU,CAAC;QACzCE,cAAc,GAAGxD,MAAM,GAAGA,MAAM,CAACuD,YAAY,CAAC,EAAEzB,IAAI,CAACnB,YAAY,CAAC,GAAGiC,SAAS;MAC/E;MAEA,IAAI,CAACY,cAAc,EAAE;QACpBpB,GAAG,CAACsB,KAAK,CAAC,wBAAwBH,YAAY,OAAOD,UAAU,EAAE,CAAC;MACnE;MACA,OAAOE,cAAc;IACtB;EACD,CAAC;EAAC,OAEa1D,SAAS;AAAA","ignoreList":[],"file":"FPMHelper-dbg.js"}