{"version":3,"names":["UI","IsCreateMode","pathInModel","IsEditable","IsTransientBinding","equal","IsTotal","IsExpanded","NodeLevel","IsInactive","isNodeLevelNavigable","hasCollaborationAuthorization","_exports","Entity","HasDraft","HasActive","IsActive","Draft","IsNewObject","and","not","HasNoDraftForCurrentUser","or","getSingleton","convertedTypes","fullyQualifiedName","singletons","find","singleton","singletonPathVisitor","path","visitedNavigationPaths","indexOf","parts","split","filter","Boolean","propertyName","pop","entitySetName","join","name","localPath","concat","push","bindingContextPathVisitor","bindingParameterFullName","bindingParameterPrefix","substring","lastIndexOf","startsWith","length"],"sourceRoot":".","sources":["BindingHelper.ts"],"sourcesContent":["import type { ConvertedMetadata, Singleton } from \"@sap-ux/vocabularies-types\";\nimport type { BindingToolkitExpression } from \"sap/fe/base/BindingToolkit\";\nimport { and, equal, not, or, pathInModel } from \"sap/fe/base/BindingToolkit\";\n\nexport const UI = {\n\tIsCreateMode: pathInModel(\"createMode\", \"pageInternal\") as BindingToolkitExpression<boolean>,\n\tIsEditable: pathInModel(\"isEditable\", \"ui\") as BindingToolkitExpression<boolean>,\n\tIsTransientBinding: equal(pathInModel(\"@$ui5.context.isTransient\"), true),\n\tIsTotal: equal(pathInModel(\"@$ui5.node.isTotal\"), true),\n\tIsExpanded: equal(pathInModel(\"@$ui5.node.isExpanded\"), true),\n\tNodeLevel: pathInModel(\"@$ui5.node.level\"),\n\tIsInactive: pathInModel(\"@$ui5.context.isInactive\"),\n\tisNodeLevelNavigable: pathInModel(\"isNodeLevelNavigable\", \"internal\"),\n\thasCollaborationAuthorization: pathInModel(\"hasCollaborationAuthorization\", \"ui\") as BindingToolkitExpression<boolean>\n};\n\nexport const Entity = {\n\tHasDraft: pathInModel(\"HasDraftEntity\"),\n\tHasActive: pathInModel(\"HasActiveEntity\"),\n\tIsActive: pathInModel(\"IsActiveEntity\")\n};\n\nexport const Draft = {\n\tIsNewObject: and(not(Entity.HasActive), not(Entity.IsActive)),\n\tHasNoDraftForCurrentUser: or(\n\t\tnot(Entity.HasDraft),\n\t\tand(Entity.HasDraft, not(pathInModel(\"DraftAdministrativeData/DraftIsCreatedByMe\") as BindingToolkitExpression<boolean>))\n\t)\n};\n\n/**\n * Gets a singleton based on the fully qualified name.\n * @param convertedTypes The converted types\n * @param fullyQualifiedName The fully qualified name of the singleton\n * @returns The singleton instance.\n */\nfunction getSingleton(convertedTypes: ConvertedMetadata, fullyQualifiedName: string): Singleton | undefined {\n\treturn convertedTypes.singletons.find((singleton) => singleton.fullyQualifiedName === fullyQualifiedName);\n}\n\n/**\n * Function to adjust singleton paths in the annotation.\n * The absolute path via EntityContainer needs to be shortened to /SingletonName/PropertyName.\n * @param path The path configured in the annotation\n * @param convertedTypes The instance of the converter context\n * @param visitedNavigationPaths The array of visited navigation paths\n * @returns The adjusted path for the reference of the singleton property, otherwise the input path itself.\n */\nexport const singletonPathVisitor = function (path: string, convertedTypes: ConvertedMetadata, visitedNavigationPaths: string[]): string {\n\t// Determine whether the path is absolute and whether it points to a singleton.\n\tif (path.indexOf(\"/\") === 0) {\n\t\tconst parts = path.split(\"/\").filter(Boolean),\n\t\t\tpropertyName = parts.pop(),\n\t\t\tentitySetName = parts.join(\"/\"),\n\t\t\tsingleton = getSingleton(convertedTypes, entitySetName);\n\t\tif (singleton) {\n\t\t\t// Set the absolute binding path to access the singleton property\n\t\t\tpath = `/${singleton.name}/${propertyName}`;\n\t\t}\n\t} else {\n\t\t// Not a singleton reference.\n\t\t// Prefix the navigation path to the property path\n\t\tconst localPath = visitedNavigationPaths.concat();\n\t\tlocalPath.push(path);\n\t\tpath = localPath.join(\"/\");\n\t}\n\treturn path;\n};\n\n/**\n * Function to adjust property paths defined in the binding of an action.\n *\n * The binding parameter name needs to be removed. Singleton paths need to be resolved.\n * @param path The path configured in the annotation\n * @param convertedTypes Convertered metadata\n * @param bindingParameterFullName The fully qualified name of the binding parameter\n * @returns The adjusted property path\n */\nexport function bindingContextPathVisitor(path: string, convertedTypes: ConvertedMetadata, bindingParameterFullName?: string): string {\n\tif (bindingParameterFullName) {\n\t\tconst bindingParameterPrefix = `${bindingParameterFullName?.substring(bindingParameterFullName.lastIndexOf(\"/\") + 1)}/`;\n\t\t// Strip the binding parameter name from OperationAvailable path\n\t\t// For e.g. _it/property1 --> property1\n\t\tif (path.startsWith(bindingParameterPrefix)) {\n\t\t\treturn path.substring(bindingParameterPrefix.length);\n\t\t}\n\t}\n\treturn singletonPathVisitor(path, convertedTypes, []);\n}\n"],"mappings":"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","ignoreList":[],"file":"BindingHelper-dbg.js"}