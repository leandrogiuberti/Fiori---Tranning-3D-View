{"version":3,"file":"ModelHelper.js","names":["ModelHelper","disableCollaborationDraft","isStickySessionSupported","metaModel","entityContainer","getObject","entitySetName","$kind","isDraftSupported","path","metaContext","getMetaContext","objectPath","getInvolvedDataModelObjects","this","isObjectPathDraftSupported","dataModelObjectPath","currentEntitySet","targetEntitySet","bIsDraftRoot","isDraftRoot","bIsDraftNode","isDraftNode","bIsDraftParentEntityForContainment","isNavigationProperty","targetObject","containsTarget","startingEntitySet","annotations","Common","DraftRoot","DraftNode","hasIsActiveEntityKey","targetEntityType","keys","some","key","name","isMetaPathDraftSupported","getClosestEntitySet","isCollaborationDraftSupportedFromConverterContext","converterContext","getConvertedTypes","entitySets","entitySet","ShareAction","undefined","isCollaborationDraftSupported","metaObject","templateInterface","oMetaModel","context","getModel","__$feIsCollaborationDraftEnabled","oEntityContainer","sEntitySet","getDraftRootPath","oContext","getMetaModel","getRootPath","sPath","model","firstIteration","arguments","length","sIterationPath","RegExp","exec","sEntityPath","getMetaPath","mDataModel","MetaModelConverter","getContext","getPath","getStickyRootPath","Session","StickySessionSupported","getTargetEntitySet","sEntitySetPath","getEntitySetPath","odataMetaModel","entitySetPath","split","filter","filterOutNavPropBinding","join","pathParts","initialPathObject","growingPath","pendingNavPropBinding","pathObject","reduce","pathUnderConstruction","pathPart","idx","delimiter","tempPath","navPropBindings","navPropBindingToCheck","Object","hasOwnProperty","replace","getActionParameterItemsModelPath","oParameter","$Name","sPathPart","enhanceInternalJSONModel","oInternalModel","fnBindContext","bindContext","mParameters","oEvents","contextBinding","apply","fnGetBoundContext","getBoundContext","oBoundContext","setProperty","propertyPath","value","propertyPathSplit","i","getProperty","enhanceUiJSONModel","uiModel","library","fnSetProperty","asyncUpdate","EditMode","Editable","Display","enhanceViewJSONModel","viewModel","fnGetObject","_getObject","isFilteringCaseSensitive","filterFunctions","_filterFunctions","indexOf","getMetaPathForContext","oModel","getRootEntitySetPath","contextPath","rootEntitySetPath","aPaths","getAbsoluteMetaPathForListBinding","oView","vListBinding","sMetaPath","startsWith","oBindingContext","getBindingContext","sRootContextPath","oBinding","oRootBinding","getRootBinding","sRootBindingPath","sRelativePath","getRelativeMetaPathForListBinding","parentContext","listBinding","listBindingContext","parentContextPath","viewBindingMetaPath","getDraftRoot","getDraftNode","isSticky","getStickySession","isUpdateHidden","entityType","isEntitySet","UI","UpdateHidden","getDeleteHidden","DeleteHidden","getAbsolutePathFromListBinding","metamodel","metaPath","rootBinding","rootBindingPath","relativePath","enhanceODataModel","odataModel","appComponent","virtualPropertyBindingRegistry","Array","fnMessage","setMessages","localAnnotationModel","JSONModel","setDefaultBindingMode","BindingMode","OneWay","baseSetProperty","baseGetProperty","propertyName","annotationType","isTransient","contextObject","MetaPath","convertTypes","externalIdProperty","getMetaPathForPath","getTarget","ExternalID","isPathAnnotationExpression","fullPath","_refreshLocalModel","refresh","externalIdPropPath","propertiesToRequest","substring","lastIndexOf","textProperty","Text","textPropPath","includes","push","requestSideEffects","then","catch","err","Log","error","pathFromRoot","clearAnnotationType","annotationTypes","dataSet","isContext","isA","endsWith","_localAnnotationModel","getLocalAnnotationModel","messages","cleanedData","getData","setData","messageTarget","getType","getMessage","fnBindProperty","bindProperty","bind","parameters","recommendationFeatureDisabled","getEnvironmentCapabilities","getCapabilities","DisableInputAssistance","recommendationPropertyBinding","setUpRecommendationLocalModelBinding","internalIdPropertyName","internalIdBinding","externalIDBinding","externalIdTextProperty","externalIDTextBinding","externalIdBinding","attachChange","requestValue","propBinding","updateRequired","expression","viewId","getVirtualBindingExpression","owner","UI5Element","getElementById","ghostControl","Any","any","compileExpression","bindBackProperty","getController","jsx","getFormatterContext","fnDestroyPropertyBinding","destroy","fnSetContext","setContext","newContext","setBindingContext","setModel","ghostBinding","getBindingInfo","binding","fnCheckUpdate","checkUpdate","forceUpdate","isContextLoaded","getBindBackProperty","valueInLocalAnnotation","getExternalValue","fnDestroy","vpBinding","evaluateVirtualExpression","promiseKeeper","PromiseKeeper","DataWatcher","valueChanged","event","resolve","getParameter","getSource","propertyBinding","promise","fetchTextFromMetaModel","text","metaModelPath","getEntityTypeAnnotation","annotation","toString","e","info","getMessagesPath","Messages","recommendationbinding","setContextOnRecommendationBinding","odataPropertyBinding","recommendationComplexProperty","isRecommendedProperty","validateRecommendationBindingPath","alreadyBound","existingBinding","setType","Raw","setBindingMode","currentContext","contextRecommendations","getValue","setRecommendationsOnLocalAnnotationModel","bindingPath","contextMetaPath","Recommendations","entityProperties","entityProperty","targetType","properties","property","recommendationObj","rejectedRecommendations","recommendedProperty","propertyRecommendations","localModelPath","placeholderValueKey","placeholderDescriptionKey","typeAheadValuesKey","propertyRecommendation","RecommendedFieldIsSuggestion","RecommendedFieldValue","RecommendedFieldDescription","_compareRecommendations","forEach","recommendations","recommendationKeys","rejectedRecommendationKeys","recommendationTypeAheadValues","rejectedRecommendationTypeAheadValues","isArray","val","getAlternateAndSecondaryKeys","alternateKeys","_fetchAlternateKeys","entityTypeOrSet","Core","AlternateKeys","alternateKey","Key","Name","_fetchSecondaryKeys","eT","SecondaryKey","secondaryKey"],"sources":["./ModelHelper.ts"],"sourcesContent":["/* This class contains helpers to be used at runtime to retrieve further information on the model */\nimport type { ComplexType, EntitySet, EntityType, Property, PropertyPath, Singleton } from \"@sap-ux/vocabularies-types\";\nimport type { FilterFunctions } from \"@sap-ux/vocabularies-types/vocabularies/Capabilities\";\nimport type { DraftNode, DraftRoot } from \"@sap-ux/vocabularies-types/vocabularies/Common\";\nimport type { AlternateKey, PropertyRef } from \"@sap-ux/vocabularies-types/vocabularies/Core\";\nimport type { StickySessionSupported } from \"@sap-ux/vocabularies-types/vocabularies/Session\";\nimport type { DeleteHidden, UpdateHidden } from \"@sap-ux/vocabularies-types/vocabularies/UI\";\nimport type { EntityTypeAnnotations_UI } from \"@sap-ux/vocabularies-types/vocabularies/UI_Edm\";\nimport Log from \"sap/base/Log\";\nimport { compileExpression } from \"sap/fe/base/BindingToolkit\";\nimport type { PropertiesOf } from \"sap/fe/base/ClassSupport\";\nimport jsx from \"sap/fe/base/jsx-runtime/jsx\";\nimport type { FEView } from \"sap/fe/core/BaseController\";\nimport Any from \"sap/fe/core/controls/Any\";\nimport DataWatcher from \"sap/fe/core/controls/DataWatcher\";\nimport type ConverterContext from \"sap/fe/core/converters/ConverterContext\";\nimport type { MetaModelActionParameter } from \"sap/fe/core/converters/MetaModelConverter\";\nimport * as MetaModelConverter from \"sap/fe/core/converters/MetaModelConverter\";\nimport { convertTypes, getInvolvedDataModelObjects } from \"sap/fe/core/converters/MetaModelConverter\";\nimport type { PageContextPathTarget } from \"sap/fe/core/converters/TemplateConverter\";\nimport MetaPath from \"sap/fe/core/helpers/MetaPath\";\nimport PromiseKeeper from \"sap/fe/core/helpers/PromiseKeeper\";\nimport { isEntitySet, isNavigationProperty, isPathAnnotationExpression } from \"sap/fe/core/helpers/TypeGuards\";\nimport type { DataModelObjectPath } from \"sap/fe/core/templating/DataModelPathHelper\";\nimport UI5Element from \"sap/ui/core/Element\";\nimport type Message from \"sap/ui/core/message/Message\";\nimport type View from \"sap/ui/core/mvc/View\";\nimport BindingMode from \"sap/ui/model/BindingMode\";\nimport type BaseContext from \"sap/ui/model/Context\";\nimport type ContextBinding from \"sap/ui/model/ContextBinding\";\nimport type MetaModel from \"sap/ui/model/MetaModel\";\nimport type PropertyBinding from \"sap/ui/model/PropertyBinding\";\nimport JSONModel from \"sap/ui/model/json/JSONModel\";\nimport Raw from \"sap/ui/model/odata/type/Raw\";\nimport type { default as Context, default as ODataV4Context } from \"sap/ui/model/odata/v4/Context\";\nimport type { default as ODataListBinding } from \"sap/ui/model/odata/v4/ODataListBinding\";\nimport type ODataMetaModel from \"sap/ui/model/odata/v4/ODataMetaModel\";\nimport type ODataModel from \"sap/ui/model/odata/v4/ODataModel\";\nimport type ODataPropertyBinding from \"sap/ui/model/odata/v4/ODataPropertyBinding\";\nimport type { ODataPropertyBinding$ChangeEvent } from \"sap/ui/model/odata/v4/ODataPropertyBinding\";\nimport type AppComponent from \"../AppComponent\";\n\n// TODO: Right now recommendations is not part of the UI vocabulary.\n// hence we are adding it to the type.\n// once this becomes part of the UI vocabulary then we can remove this.\nexport type EntityTypeAnnotations_UI_With_Recommendations = EntityTypeAnnotations_UI & {\n\tRecommendations?: {\n\t\tpath: string;\n\t};\n};\n\nconst ModelHelper = {\n\t// global switch to disable the collaboration draft by a private manifest flag\n\t// this allows customers to disable the collaboration draft in case we run into issues with the first delivery\n\t// this will be removed with the next S/4 release\n\tdisableCollaborationDraft: false,\n\t/**\n\t * Method to determine if the programming model is sticky.\n\t * @param metaModel ODataModelMetaModel to check for sticky enabled entity\n\t * @returns Returns true if sticky, else false\n\t */\n\tisStickySessionSupported: function (metaModel: ODataMetaModel): boolean {\n\t\tconst entityContainer = metaModel.getObject(\"/\");\n\t\tfor (const entitySetName in entityContainer) {\n\t\t\tif (\n\t\t\t\tentityContainer[entitySetName].$kind === \"EntitySet\" &&\n\t\t\t\tmetaModel.getObject(`/${entitySetName}@com.sap.vocabularies.Session.v1.StickySessionSupported`)\n\t\t\t) {\n\t\t\t\treturn true;\n\t\t\t}\n\t\t}\n\t\treturn false;\n\t},\n\n\t/**\n\t * Method to determine if the programming model is draft.\n\t * @param metaModel ODataModelMetaModel of the context for which draft support shall be checked\n\t * @param path Path for which draft support shall be checked\n\t * @returns Returns true if draft, else false\n\t */\n\tisDraftSupported: function (metaModel: ODataMetaModel, path: string): boolean {\n\t\tconst metaContext = metaModel.getMetaContext(path);\n\t\tconst objectPath = getInvolvedDataModelObjects<PageContextPathTarget>(metaContext);\n\t\treturn this.isObjectPathDraftSupported(objectPath);\n\t},\n\n\t/**\n\t * Checks if draft is supported for the data model object path.\n\t * @param dataModelObjectPath\n\t * @returns `true` if it is supported\n\t */\n\tisObjectPathDraftSupported: function (dataModelObjectPath: DataModelObjectPath<unknown>): boolean {\n\t\tconst currentEntitySet = dataModelObjectPath.targetEntitySet as EntitySet;\n\t\tconst bIsDraftRoot = ModelHelper.isDraftRoot(currentEntitySet);\n\t\tconst bIsDraftNode = ModelHelper.isDraftNode(currentEntitySet);\n\t\tconst bIsDraftParentEntityForContainment =\n\t\t\tisNavigationProperty(dataModelObjectPath.targetObject) &&\n\t\t\tdataModelObjectPath.targetObject?.containsTarget &&\n\t\t\t((dataModelObjectPath.startingEntitySet as EntitySet)?.annotations?.Common?.DraftRoot ||\n\t\t\t\t(dataModelObjectPath.startingEntitySet as EntitySet)?.annotations?.Common?.DraftNode)\n\t\t\t\t? true\n\t\t\t\t: false;\n\t\tconst hasIsActiveEntityKey = dataModelObjectPath.targetEntityType.keys?.some((key) => key.name === \"IsActiveEntity\");\n\t\treturn bIsDraftRoot || bIsDraftNode || (!currentEntitySet && bIsDraftParentEntityForContainment && hasIsActiveEntityKey);\n\t},\n\n\tisMetaPathDraftSupported: function (dataModelObjectPath: MetaPath<unknown>): boolean {\n\t\tconst currentEntitySet = dataModelObjectPath.getClosestEntitySet() as EntitySet;\n\t\tconst bIsDraftRoot = ModelHelper.isDraftRoot(currentEntitySet);\n\t\tconst bIsDraftNode = ModelHelper.isDraftNode(currentEntitySet);\n\t\treturn bIsDraftRoot || bIsDraftNode;\n\t},\n\n\t/**\n\t * Returns whether or not we have a ShareAction in any EntitySet of the application.\n\t * @param converterContext The instance of the converter context\n\t * @returns True if the annotation exists. False otherwise.\n\t */\n\tisCollaborationDraftSupportedFromConverterContext(converterContext: ConverterContext): boolean {\n\t\treturn converterContext.getConvertedTypes().entitySets.some((entitySet) => {\n\t\t\treturn entitySet.annotations?.Common?.DraftRoot?.ShareAction !== undefined;\n\t\t});\n\t},\n\n\t/**\n\t * Method to determine if the service, supports collaboration draft.\n\t * @param metaObject MetaObject to be used for determination\n\t * @param templateInterface API provided by UI5 templating if used\n\t * @param templateInterface.context Context of the template\n\t * @returns Returns true if the service supports collaboration draft, else false\n\t */\n\tisCollaborationDraftSupported: function (metaObject: unknown, templateInterface?: { context: Context }): boolean {\n\t\tif (!ModelHelper.disableCollaborationDraft) {\n\t\t\tconst oMetaModel = (templateInterface?.context?.getModel() || metaObject) as ODataMetaModel & {\n\t\t\t\t__$feIsCollaborationDraftEnabled?: boolean;\n\t\t\t};\n\t\t\tif (oMetaModel.__$feIsCollaborationDraftEnabled !== undefined) {\n\t\t\t\treturn oMetaModel.__$feIsCollaborationDraftEnabled;\n\t\t\t}\n\t\t\tconst oEntityContainer = oMetaModel.getObject(\"/\");\n\t\t\tfor (const sEntitySet in oEntityContainer) {\n\t\t\t\tif (\n\t\t\t\t\toEntityContainer[sEntitySet].$kind === \"EntitySet\" &&\n\t\t\t\t\toMetaModel.getObject(`/${sEntitySet}@com.sap.vocabularies.Common.v1.DraftRoot/ShareAction`)\n\t\t\t\t) {\n\t\t\t\t\toMetaModel.__$feIsCollaborationDraftEnabled = true;\n\t\t\t\t\treturn true;\n\t\t\t\t}\n\t\t\t}\n\t\t\toMetaModel.__$feIsCollaborationDraftEnabled = false;\n\t\t}\n\t\treturn false;\n\t},\n\n\t/**\n\t * Method to get the path of the DraftRoot path according to the provided context.\n\t * @param oContext OdataModel context\n\t * @returns Returns the path of the draftRoot entity, or undefined if no draftRoot is found\n\t */\n\tgetDraftRootPath: function (oContext: Context): string | undefined {\n\t\tconst oMetaModel = oContext.getModel().getMetaModel();\n\t\tconst getRootPath = function (sPath: string, model: ODataModel, firstIteration = true): string | undefined {\n\t\t\tconst sIterationPath = firstIteration ? sPath : new RegExp(/.*(?=\\/)/).exec(sPath)?.[0]; // *Regex to get the ancestor\n\t\t\tif (sIterationPath && sIterationPath !== \"/\") {\n\t\t\t\tconst sEntityPath = oMetaModel.getMetaPath(sIterationPath);\n\t\t\t\tconst mDataModel = MetaModelConverter.getInvolvedDataModelObjects(oMetaModel.getContext(sEntityPath));\n\t\t\t\tif ((mDataModel.targetEntitySet as EntitySet)?.annotations.Common?.DraftRoot) {\n\t\t\t\t\treturn sIterationPath;\n\t\t\t\t}\n\t\t\t\treturn getRootPath(sIterationPath, model, false);\n\t\t\t}\n\t\t\treturn undefined;\n\t\t};\n\t\treturn getRootPath(oContext.getPath(), oContext.getModel());\n\t},\n\n\t/**\n\t * Method to get the path of the StickyRoot path according to the provided context.\n\t * @param oContext OdataModel context\n\t * @returns Returns the path of the StickyRoot entity, or undefined if no StickyRoot is found\n\t */\n\tgetStickyRootPath: function (oContext: Context): string | undefined {\n\t\tconst oMetaModel = oContext.getModel().getMetaModel();\n\t\tconst getRootPath = function (sPath: string, model: ODataModel, firstIteration = true): string | undefined {\n\t\t\tconst sIterationPath = firstIteration ? sPath : new RegExp(/.*(?=\\/)/).exec(sPath)?.[0]; // *Regex to get the ancestor\n\t\t\tif (sIterationPath && sIterationPath !== \"/\") {\n\t\t\t\tconst sEntityPath = oMetaModel.getMetaPath(sIterationPath);\n\t\t\t\tconst mDataModel = MetaModelConverter.getInvolvedDataModelObjects(oMetaModel.getContext(sEntityPath));\n\t\t\t\tif (\n\t\t\t\t\tmDataModel.startingEntitySet === mDataModel.targetEntitySet &&\n\t\t\t\t\t(mDataModel.targetEntitySet as EntitySet)?.annotations?.Session?.StickySessionSupported\n\t\t\t\t) {\n\t\t\t\t\treturn sIterationPath;\n\t\t\t\t}\n\t\t\t\treturn getRootPath(sIterationPath, model, false);\n\t\t\t}\n\t\t\treturn undefined;\n\t\t};\n\t\treturn getRootPath(oContext.getPath(), oContext.getModel());\n\t},\n\t/**\n\t * Returns the path to the target entity set with navigation property binding.\n\t * @param oContext Context for which the target entity set will be determined\n\t * @returns Returns the path to the target entity set\n\t */\n\tgetTargetEntitySet: function (oContext: BaseContext): string {\n\t\tconst sPath = oContext.getPath();\n\t\tif (\n\t\t\toContext.getObject(\"$kind\") === \"EntitySet\" ||\n\t\t\toContext.getObject(\"$kind\") === \"Action\" ||\n\t\t\toContext.getObject(\"0/$kind\") === \"Action\"\n\t\t) {\n\t\t\treturn sPath;\n\t\t}\n\t\tconst sEntitySetPath = ModelHelper.getEntitySetPath(sPath);\n\t\treturn `/${oContext.getObject(sEntitySetPath)}`;\n\t},\n\n\t/**\n\t * Returns complete path to the entity set via using navigation property binding. Note: To be used only after the metamodel has loaded.\n\t * @param path Path for which complete entitySet path needs to be determined from entityType path\n\t * @param odataMetaModel Metamodel to be used.(Optional in normal scenarios, but needed for parameterized service scenarios)\n\t * @returns Returns complete path to the entity set\n\t */\n\tgetEntitySetPath: function (path: string, odataMetaModel?: ODataMetaModel): string {\n\t\tlet entitySetPath = \"\";\n\t\tif (!odataMetaModel) {\n\t\t\t// Previous implementation for getting entitySetPath from entityTypePath\n\t\t\tentitySetPath = `/${path.split(\"/\").filter(ModelHelper.filterOutNavPropBinding).join(\"/$NavigationPropertyBinding/\")}`;\n\t\t} else {\n\t\t\t// Calculating the entitySetPath from MetaModel.\n\t\t\tconst pathParts = path.split(\"/\").filter(ModelHelper.filterOutNavPropBinding);\n\t\t\tif (pathParts.length > 1) {\n\t\t\t\tconst initialPathObject = {\n\t\t\t\t\tgrowingPath: \"/\",\n\t\t\t\t\tpendingNavPropBinding: \"\"\n\t\t\t\t};\n\n\t\t\t\tconst pathObject = pathParts.reduce(\n\t\t\t\t\t(pathUnderConstruction: { growingPath: string; pendingNavPropBinding: string }, pathPart: string, idx: number) => {\n\t\t\t\t\t\tconst delimiter = (!!idx && \"/$NavigationPropertyBinding/\") || \"\";\n\t\t\t\t\t\tlet { growingPath, pendingNavPropBinding } = pathUnderConstruction;\n\t\t\t\t\t\tconst tempPath = growingPath + delimiter;\n\t\t\t\t\t\tconst navPropBindings = odataMetaModel.getObject(tempPath);\n\t\t\t\t\t\tconst navPropBindingToCheck = pendingNavPropBinding ? `${pendingNavPropBinding}/${pathPart}` : pathPart;\n\t\t\t\t\t\tif (\n\t\t\t\t\t\t\tnavPropBindings &&\n\t\t\t\t\t\t\tObject.keys(navPropBindings).length > 0 &&\n\t\t\t\t\t\t\tnavPropBindings.hasOwnProperty(navPropBindingToCheck)\n\t\t\t\t\t\t) {\n\t\t\t\t\t\t\tgrowingPath = tempPath + navPropBindingToCheck.replace(\"/\", \"%2F\");\n\t\t\t\t\t\t\tpendingNavPropBinding = \"\";\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tpendingNavPropBinding += pendingNavPropBinding ? `/${pathPart}` : pathPart;\n\t\t\t\t\t\t}\n\t\t\t\t\t\treturn { growingPath, pendingNavPropBinding };\n\t\t\t\t\t},\n\t\t\t\t\tinitialPathObject\n\t\t\t\t);\n\n\t\t\t\tentitySetPath = pathObject.growingPath;\n\t\t\t} else {\n\t\t\t\tentitySetPath = `/${pathParts[0]}`;\n\t\t\t}\n\t\t}\n\n\t\treturn entitySetPath;\n\t},\n\n\t/**\n\t * Gets the path for the items property of MultiValueField parameters.\n\t * @param oParameter Action Parameter\n\t * @returns Returns the complete model path for the items property of MultiValueField parameters\n\t */\n\tgetActionParameterItemsModelPath: function (oParameter: MetaModelActionParameter): string | undefined {\n\t\treturn oParameter && oParameter.$Name ? `{path: 'mvfview>/${oParameter.$Name}'}` : undefined;\n\t},\n\n\tfilterOutNavPropBinding: function (sPathPart: string): boolean {\n\t\treturn sPathPart !== \"\" && sPathPart !== \"$NavigationPropertyBinding\";\n\t},\n\n\t/**\n\t * Adds a setProperty to the created binding contexts of the internal JSON model.\n\t * @param Internal JSON Model which is enhanced\n\t */\n\n\tenhanceInternalJSONModel: function (oInternalModel: JSONModel): void {\n\t\tconst fnBindContext = oInternalModel.bindContext;\n\t\toInternalModel.bindContext = function (\n\t\t\tsPath: string,\n\t\t\tcontext: BaseContext,\n\t\t\tmParameters: object | undefined,\n\t\t\toEvents: object | undefined\n\t\t): ContextBinding {\n\t\t\tconst contextBinding = fnBindContext.apply(this, [sPath, context, mParameters, oEvents]);\n\t\t\tconst fnGetBoundContext = contextBinding.getBoundContext;\n\n\t\t\tcontextBinding.getBoundContext = function (): BaseContext | null {\n\t\t\t\tconst oBoundContext = fnGetBoundContext.apply(this);\n\t\t\t\tif (oBoundContext) {\n\t\t\t\t\toBoundContext.setProperty = function (propertyPath: string, value: unknown): void {\n\t\t\t\t\t\tif (this.getObject() === undefined) {\n\t\t\t\t\t\t\t// initialize\n\t\t\t\t\t\t\tthis.getModel().setProperty(this.getPath(), {});\n\t\t\t\t\t\t}\n\t\t\t\t\t\tconst propertyPathSplit = propertyPath.split(\"/\");\n\t\t\t\t\t\tlet path = this.getPath().replace(/\\/$/, \"\"); // Remove slash if it is at the end\n\t\t\t\t\t\t// let's ensure that sub objects are initialized\n\t\t\t\t\t\tfor (let i = 0; i < propertyPathSplit.length - 1; i++) {\n\t\t\t\t\t\t\tpath = `${path}/${propertyPathSplit[i]}`;\n\t\t\t\t\t\t\tif (this.getModel().getProperty(path) === undefined) {\n\t\t\t\t\t\t\t\t// initialize\n\t\t\t\t\t\t\t\tthis.getModel().setProperty(path, {});\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t\tthis.getModel().setProperty(propertyPath, value, this);\n\t\t\t\t\t};\n\t\t\t\t}\n\t\t\t\treturn oBoundContext;\n\t\t\t};\n\t\t\treturn contextBinding;\n\t\t};\n\t},\n\n\t/**\n\t * Adds an handler on propertyChange.\n\t * The property \"/editMode\" is changed according to property '/isEditable' when this last one is set\n\t * in order to be compliant with former versions where building blocks use the property \"/editMode\"\n\t * @param uiModel JSON Model which is enhanced\n\t * @param library Core library of SAP Fiori elements\n\t */\n\n\tenhanceUiJSONModel: function (uiModel: JSONModel, library: { EditMode: { Editable: string; Display: string } }): void {\n\t\tconst fnSetProperty = uiModel.setProperty;\n\t\tuiModel.setProperty = function (\n\t\t\tpath: string,\n\t\t\tvalue: unknown,\n\t\t\tcontext: BaseContext | undefined,\n\t\t\tasyncUpdate: boolean | undefined\n\t\t): boolean {\n\t\t\tif (path === \"/isEditable\") {\n\t\t\t\tuiModel.setProperty(\"/editMode\", value ? library.EditMode.Editable : library.EditMode.Display, context, asyncUpdate);\n\t\t\t}\n\t\t\treturn fnSetProperty.apply(this, [path, value, context, asyncUpdate]);\n\t\t};\n\t},\n\n\tenhanceViewJSONModel: function (viewModel: JSONModel & { _getObject: Function }): void {\n\t\tconst fnGetObject = viewModel._getObject;\n\t\tviewModel._getObject = function (sPath: string, oContext?: Context): unknown {\n\t\t\tif (sPath === undefined || sPath === \"\") {\n\t\t\t\tsPath = \"/\";\n\t\t\t}\n\t\t\treturn fnGetObject.apply(this, [sPath, oContext]);\n\t\t};\n\t},\n\t/**\n\t * Returns whether filtering on the table is case sensitive.\n\t * @param oMetaModel The instance of the meta model\n\t * @param filterFunctions Filter functions supported by the service\n\t * @returns Returns 'false' if the service supports 'tolower', else 'true'\n\t */\n\tisFilteringCaseSensitive: function (oMetaModel?: ODataMetaModel, filterFunctions?: FilterFunctions | string[]): boolean {\n\t\tconst _filterFunctions = filterFunctions ?? oMetaModel?.getObject(\"/@Org.OData.Capabilities.V1.FilterFunctions\");\n\n\t\tif (!_filterFunctions) {\n\t\t\t// if no filters function defined in service, we assume that the service is case sensitive\n\t\t\treturn true;\n\t\t}\n\n\t\treturn _filterFunctions.indexOf(\"tolower\") === -1;\n\t},\n\n\t/**\n\t * Get MetaPath for the context.\n\t * @param oContext Context to be used\n\t * @returns Returns the metapath for the context.\n\t */\n\tgetMetaPathForContext: function (oContext: Context): string {\n\t\tconst oModel = oContext.getModel(),\n\t\t\toMetaModel = oModel.getMetaModel(),\n\t\t\tsPath = oContext.getPath();\n\t\treturn oMetaModel && sPath && oMetaModel.getMetaPath(sPath);\n\t},\n\n\t/**\n\t * Get MetaPath for the context.\n\t * @param contextPath MetaPath to be used\n\t * @returns Returns the root entity set path.\n\t */\n\tgetRootEntitySetPath: function (contextPath: string): string {\n\t\tlet rootEntitySetPath = \"\";\n\t\tconst aPaths = contextPath ? contextPath.split(\"/\") : [];\n\t\tif (aPaths.length > 1) {\n\t\t\trootEntitySetPath = aPaths[1];\n\t\t}\n\t\treturn rootEntitySetPath;\n\t},\n\t/**\n\t * Get MetaPath for the listBinding.\n\t * @param oView View of the control using listBinding\n\t * @param vListBinding ODataListBinding object or the binding path for a temporary list binding\n\t * @returns Returns the metapath for the listbinding.\n\t */\n\tgetAbsoluteMetaPathForListBinding: function (oView: FEView, vListBinding: ODataListBinding | string): string {\n\t\tconst oMetaModel = oView.getModel().getMetaModel();\n\t\tlet sMetaPath;\n\n\t\tif (typeof vListBinding === \"string\") {\n\t\t\tif (vListBinding.startsWith(\"/\")) {\n\t\t\t\t// absolute path\n\t\t\t\tsMetaPath = oMetaModel.getMetaPath(vListBinding);\n\t\t\t} else {\n\t\t\t\t// relative path\n\t\t\t\tconst oBindingContext = oView.getBindingContext();\n\t\t\t\tconst sRootContextPath = oBindingContext.getPath();\n\t\t\t\tsMetaPath = oMetaModel.getMetaPath(`${sRootContextPath}/${vListBinding}`);\n\t\t\t}\n\t\t} else {\n\t\t\t// we already get a list binding use this one\n\t\t\tconst oBinding = vListBinding;\n\t\t\tconst oRootBinding = oBinding.getRootBinding();\n\t\t\tif (oBinding === oRootBinding) {\n\t\t\t\t// absolute path\n\t\t\t\tsMetaPath = oMetaModel.getMetaPath(oBinding.getPath());\n\t\t\t} else {\n\t\t\t\t// relative path\n\t\t\t\tconst sRootBindingPath = oRootBinding!.getPath();\n\t\t\t\tconst sRelativePath = oBinding.getPath();\n\t\t\t\tif (vListBinding.getContext() === oView.getBindingContext()) {\n\t\t\t\t\tsMetaPath = oMetaModel.getMetaPath(`${sRootBindingPath}/${sRelativePath}`);\n\t\t\t\t} else {\n\t\t\t\t\t//On the case of a multi value field, the context of the list binding is not the same as the view binding context.\n\t\t\t\t\t// we have to get the meta path from the context of the list binding\n\t\t\t\t\tsMetaPath = `${oMetaModel.getMetaPath(vListBinding.getContext().getPath())}/${sRelativePath}`;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\treturn sMetaPath;\n\t},\n\n\t/**\n\t * Get the relative metaPath from the view for the listBinding.\n\t * @param parentContext Context of the view or the parent control\n\t * @param listBinding ODataListBinding object or the binding path for a temporary list binding\n\t * @returns Returns the metaPath for the ODataListBinding.\n\t */\n\tgetRelativeMetaPathForListBinding(parentContext: Context, listBinding: ODataListBinding): string | undefined {\n\t\tconst listBindingContext = listBinding.getContext();\n\t\tconst parentContextPath = parentContext.getPath();\n\n\t\t//For absolute path we return undefined\n\t\tif (!listBindingContext) {\n\t\t\treturn;\n\t\t}\n\t\t// if the list binding context is the parent context, we return the list binding path\n\t\tif (listBindingContext.getPath() === parentContextPath) {\n\t\t\treturn listBinding.getPath();\n\t\t}\n\t\t// if the list binding context is not the parent context, we try to find the relative path\n\t\tif (listBindingContext.getPath().startsWith(parentContextPath)) {\n\t\t\tconst metaModel = listBinding.getModel().getMetaModel();\n\t\t\tconst viewBindingMetaPath = metaModel.getMetaPath(parentContextPath);\n\t\t\treturn `${metaModel.getMetaPath(listBindingContext.getPath())}/${listBinding.getPath()}`.replace(`${viewBindingMetaPath}/`, \"\");\n\t\t}\n\t\t// otherwise, we return undefined since the list binding is not relative to the view binding context\n\t\treturn;\n\t},\n\n\t/**\n\t * Method to determine whether the argument is a draft root.\n\t * @param entitySet EntitySet | Singleton | undefined\n\t * @returns Whether the argument is a draft root\n\t */\n\tisDraftRoot: function (entitySet: EntitySet | Singleton | unknown | undefined): boolean {\n\t\treturn this.getDraftRoot(entitySet) !== undefined;\n\t},\n\n\t/**\n\t * Method to determine whether the argument is a draft node.\n\t * @param entitySet EntitySet | Singleton | undefined\n\t * @returns Whether the argument is a draft node\n\t */\n\tisDraftNode: function (entitySet: EntitySet | Singleton | unknown | undefined): boolean {\n\t\treturn this.getDraftNode(entitySet) !== undefined;\n\t},\n\n\t/**\n\t * Method to determine whether the argument is a sticky session root.\n\t * @param entitySet EntitySet | Singleton | undefined\n\t * @returns Whether the argument is a sticky session root\n\t */\n\tisSticky: function (entitySet: EntitySet | Singleton | undefined): boolean {\n\t\treturn this.getStickySession(entitySet) !== undefined;\n\t},\n\n\t/**\n\t * Method to determine if entity is updatable or not.\n\t * @param entitySet EntitySet | Singleton | undefined\n\t * @param entityType EntityType\n\t * @returns True if updatable else false\n\t */\n\tisUpdateHidden: function (entitySet: EntitySet | Singleton | undefined, entityType: EntityType): UpdateHidden | undefined {\n\t\tif (isEntitySet(entitySet)) {\n\t\t\treturn entitySet.annotations.UI?.UpdateHidden ?? entityType?.annotations.UI?.UpdateHidden;\n\t\t}\n\t},\n\t/**\n\t * Gets the @Common.DraftRoot annotation if the argument is an EntitySet.\n\t * @param entitySet EntitySet | Singleton | undefined\n\t * @returns DraftRoot\n\t */\n\tgetDraftRoot: function (entitySet: EntitySet | Singleton | unknown | undefined): DraftRoot | undefined {\n\t\treturn isEntitySet(entitySet) ? entitySet.annotations.Common?.DraftRoot : undefined;\n\t},\n\n\t/**\n\t * Gets the @Common.DraftNode annotation if the argument is an EntitySet.\n\t * @param entitySet EntitySet | Singleton | undefined\n\t * @returns DraftRoot\n\t */\n\tgetDraftNode: function (entitySet: EntitySet | Singleton | unknown | undefined): DraftNode | undefined {\n\t\treturn isEntitySet(entitySet) ? entitySet.annotations.Common?.DraftNode : undefined;\n\t},\n\n\t/**\n\t * Helper method to get sticky session.\n\t * @param entitySet EntitySet | Singleton | undefined\n\t * @returns Session StickySessionSupported\n\t */\n\tgetStickySession: function (entitySet: EntitySet | Singleton | unknown | undefined): StickySessionSupported | undefined {\n\t\treturn isEntitySet(entitySet) ? entitySet.annotations.Session?.StickySessionSupported : undefined;\n\t},\n\n\t/**\n\t * Method to get the visibility state of delete button.\n\t * @param entitySet EntitySet | Singleton | undefined\n\t * @param entityType EntityType\n\t * @returns True if delete button is hidden\n\t */\n\tgetDeleteHidden: function (entitySet: EntitySet | Singleton | undefined, entityType: EntityType): DeleteHidden | undefined {\n\t\tif (isEntitySet(entitySet)) {\n\t\t\treturn entitySet.annotations.UI?.DeleteHidden ?? entityType.annotations.UI?.DeleteHidden;\n\t\t}\n\t},\n\t/**\n\t * This function will return metapath for the given list binding.\n\t * @param listBinding ListBinding.\n\t * @returns MetaPath\n\t */\n\tgetAbsolutePathFromListBinding(listBinding: ODataListBinding): string {\n\t\tconst metamodel = listBinding.getModel().getMetaModel();\n\t\tlet metaPath;\n\t\tconst rootBinding = listBinding.getRootBinding();\n\t\tif (listBinding === rootBinding) {\n\t\t\tmetaPath = metamodel.getMetaPath(listBinding.getPath());\n\t\t} else {\n\t\t\tconst rootBindingPath = rootBinding?.getPath();\n\t\t\tconst relativePath = listBinding.getPath();\n\t\t\tmetaPath = metamodel.getMetaPath(`${rootBindingPath}/${relativePath}`);\n\t\t}\n\t\treturn metaPath;\n\t},\n\n\tenhanceODataModel(odataModel: ODataModel, appComponent: AppComponent): void {\n\t\todataModel.virtualPropertyBindingRegistry = new Array<ODataPropertyBinding>();\n\t\tconst fnMessage = odataModel.setMessages;\n\t\tconst localAnnotationModel = new JSONModel({});\n\t\tlocalAnnotationModel.setDefaultBindingMode(BindingMode.OneWay);\n\t\tconst baseSetProperty = localAnnotationModel.setProperty;\n\t\tconst baseGetProperty = localAnnotationModel.getProperty;\n\t\tlocalAnnotationModel.getProperty = function (path, context: ODataV4Context): unknown {\n\t\t\tconst [propertyName, annotationType] = path.split(\"@$ui5.fe.\");\n\n\t\t\tif (context && context.isTransient() !== true && annotationType === \"@Common/ExternalID\") {\n\t\t\t\tconst contextObject = context.getObject();\n\t\t\t\tif (contextObject) {\n\t\t\t\t\tconst metaPath = new MetaPath<EntitySet>(\n\t\t\t\t\t\tconvertTypes(odataModel.getMetaModel()),\n\t\t\t\t\t\todataModel.getMetaModel().getMetaPath(context.getPath()),\n\t\t\t\t\t\todataModel.getMetaModel().getMetaPath(context.getPath())\n\t\t\t\t\t);\n\t\t\t\t\tconst externalIdProperty = metaPath.getMetaPathForPath<Property>(metaPath.getPath() + \"/\" + propertyName)?.getTarget()\n\t\t\t\t\t\t.annotations.Common?.ExternalID;\n\n\t\t\t\t\tif (isPathAnnotationExpression(externalIdProperty)) {\n\t\t\t\t\t\treturn context.getObject(externalIdProperty.path);\n\t\t\t\t\t} else {\n\t\t\t\t\t\treturn context.getObject(propertyName);\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\treturn undefined;\n\t\t\t\t}\n\t\t\t} else if (context && annotationType === \"contextPath\") {\n\t\t\t\treturn context.getPath();\n\t\t\t}\n\n\t\t\treturn baseGetProperty.apply(this, [path, context]);\n\t\t};\n\n\t\tlocalAnnotationModel.setProperty = function (path, value, context, asyncUpdate): boolean {\n\t\t\tlet fullPath = path;\n\t\t\tif (context) {\n\t\t\t\tfullPath = context.getPath(path);\n\t\t\t}\n\t\t\tconst _refreshLocalModel = (): void => {\n\t\t\t\tthis.refresh();\n\t\t\t};\n\t\t\tconst [propertyName, annotationType] = path.split(\"@$ui5.fe.\");\n\t\t\tif (context && annotationType === \"@Common/ExternalID\") {\n\t\t\t\tcontext.setProperty(propertyName, value);\n\t\t\t\t// refreshing ExternalID and text properties (paths need to be determined generically)\n\t\t\t\tconst metaPath = new MetaPath<EntitySet>(\n\t\t\t\t\tconvertTypes(odataModel.getMetaModel()),\n\t\t\t\t\todataModel.getMetaModel().getMetaPath(context.getPath()),\n\t\t\t\t\todataModel.getMetaModel().getMetaPath(context.getPath())\n\t\t\t\t);\n\t\t\t\tconst externalIdProperty = metaPath.getMetaPathForPath<Property>(metaPath.getPath() + \"/\" + propertyName)?.getTarget()\n\t\t\t\t\t.annotations.Common?.ExternalID;\n\n\t\t\t\tif (isPathAnnotationExpression(externalIdProperty)) {\n\t\t\t\t\tconst externalIdPropPath = externalIdProperty.path;\n\t\t\t\t\tconst propertiesToRequest = [externalIdPropPath.substring(0, externalIdPropPath.lastIndexOf(\"/\"))];\n\t\t\t\t\tconst textProperty = metaPath.getMetaPathForPath<Property>(metaPath.getPath() + \"/\" + externalIdPropPath)?.getTarget()\n\t\t\t\t\t\t.annotations.Common?.Text;\n\t\t\t\t\tif (isPathAnnotationExpression(textProperty)) {\n\t\t\t\t\t\tconst textPropPath = textProperty.path;\n\t\t\t\t\t\tif (textPropPath.includes(\"/\")) {\n\t\t\t\t\t\t\tpropertiesToRequest.push(textPropPath);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\t(context as ODataV4Context)\n\t\t\t\t\t\t.requestSideEffects(propertiesToRequest)\n\t\t\t\t\t\t.then(_refreshLocalModel)\n\t\t\t\t\t\t.catch((err) => {\n\t\t\t\t\t\t\tLog.error(err as string);\n\t\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t}\n\t\t\tconst propertyPathSplit = fullPath.split(\"/\");\n\t\t\t// let's ensure that sub objects are initialized\n\t\t\tlet pathFromRoot = \"\";\n\t\t\tfor (let i = 0; i < propertyPathSplit.length - 1; i++) {\n\t\t\t\tif (i > 0) {\n\t\t\t\t\tpathFromRoot += \"/\";\n\t\t\t\t}\n\t\t\t\tpathFromRoot += propertyPathSplit[i];\n\t\t\t\tif (this.getObject(pathFromRoot) === undefined) {\n\t\t\t\t\t// initialize\n\t\t\t\t\tthis.setProperty(pathFromRoot, {});\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn baseSetProperty.apply(this, [path, value, context, asyncUpdate]);\n\t\t};\n\t\tfunction clearAnnotationType(annotationTypes: string[], dataSet: Record<string, unknown>): object {\n\t\t\tfor (const contextPath in dataSet) {\n\t\t\t\t// we added a context for accepting recommendations eventually.\n\t\t\t\t// the context is a deeply nested object iterating over it cause the code the break\n\t\t\t\t// hence we are skipping it here.\n\t\t\t\tconst context = dataSet?.[contextPath] as ODataV4Context;\n\t\t\t\tconst isContext = context?.isA?.(\"sap.ui.model.odata.v4.Context\");\n\t\t\t\tif (typeof context === \"object\" && !isContext) {\n\t\t\t\t\tdataSet[contextPath] = clearAnnotationType(annotationTypes, dataSet[contextPath] as Record<string, unknown>);\n\t\t\t\t\tif (dataSet[contextPath] && Object.keys(dataSet[contextPath] as object).length === 0) {\n\t\t\t\t\t\tdelete dataSet[contextPath];\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tfor (const annotationType of annotationTypes) {\n\t\t\t\t\tif (contextPath.endsWith(annotationType)) {\n\t\t\t\t\t\tdelete dataSet[contextPath];\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn dataSet;\n\t\t}\n\t\todataModel._localAnnotationModel = localAnnotationModel;\n\t\todataModel.getLocalAnnotationModel = function (): JSONModel {\n\t\t\treturn this._localAnnotationModel;\n\t\t};\n\t\todataModel.setMessages = function (messages: Record<string, Message[]>): void {\n\t\t\tconst cleanedData = clearAnnotationType([\"@$ui5.fe.messageType\", \"@$ui5.fe.messageText\"], this._localAnnotationModel.getData());\n\t\t\tthis._localAnnotationModel.setData(cleanedData);\n\t\t\tfor (const messageTarget in messages) {\n\t\t\t\tthis._localAnnotationModel.setProperty(`${messageTarget}@$ui5.fe.messageType`, messages[messageTarget][0].getType());\n\t\t\t\tthis._localAnnotationModel.setProperty(`${messageTarget}@$ui5.fe.messageText`, messages[messageTarget][0].getMessage());\n\t\t\t}\n\t\t\tfnMessage.apply(this, [messages]);\n\t\t};\n\t\tconst fnBindProperty = odataModel.bindProperty.bind(odataModel);\n\t\todataModel.bindProperty = function (path: string, context: ODataV4Context, parameters): ODataPropertyBinding {\n\t\t\tconst recommendationFeatureDisabled = appComponent.getEnvironmentCapabilities()?.getCapabilities?.().DisableInputAssistance;\n\t\t\tconst recommendationPropertyBinding = ModelHelper.setUpRecommendationLocalModelBinding(\n\t\t\t\tthis,\n\t\t\t\tfnBindProperty,\n\t\t\t\tpath,\n\t\t\t\tcontext,\n\t\t\t\trecommendationFeatureDisabled\n\t\t\t);\n\t\t\tif (recommendationPropertyBinding) {\n\t\t\t\treturn recommendationPropertyBinding as ODataPropertyBinding;\n\t\t\t}\n\t\t\tif (path.endsWith(\"@$ui5.fe.@Common/ExternalID\") && context) {\n\t\t\t\tconst internalIdPropertyName = path.split(\"@$ui5.fe.\")[0];\n\t\t\t\tconst internalIdBinding = fnBindProperty(internalIdPropertyName, context);\n\t\t\t\tconst metaPath = new MetaPath<EntitySet>(\n\t\t\t\t\tconvertTypes(odataModel.getMetaModel()),\n\t\t\t\t\todataModel.getMetaModel().getMetaPath(context.getPath()),\n\t\t\t\t\todataModel.getMetaModel().getMetaPath(context.getPath())\n\t\t\t\t);\n\n\t\t\t\tconst externalIdProperty = metaPath\n\t\t\t\t\t.getMetaPathForPath<Property>(metaPath.getPath() + \"/\" + internalIdPropertyName)\n\t\t\t\t\t?.getTarget().annotations.Common?.ExternalID;\n\n\t\t\t\tif (isPathAnnotationExpression(externalIdProperty)) {\n\t\t\t\t\tconst externalIDBinding = fnBindProperty(externalIdProperty.path, context);\n\t\t\t\t\todataModel.virtualPropertyBindingRegistry.push(externalIDBinding);\n\t\t\t\t\tconst externalIdTextProperty = metaPath\n\t\t\t\t\t\t.getMetaPathForPath<Property>(externalIDBinding.getContext()?.getPath() + \"/\" + externalIdProperty.path)\n\t\t\t\t\t\t?.getTarget().annotations.Common?.Text;\n\t\t\t\t\tif (isPathAnnotationExpression(externalIdTextProperty)) {\n\t\t\t\t\t\tconst externalIDTextBinding = fnBindProperty(externalIdTextProperty.path, context);\n\t\t\t\t\t\todataModel.virtualPropertyBindingRegistry.push(externalIDTextBinding);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tconst externalIdBinding = this._localAnnotationModel.bindProperty(path, context) as unknown as ODataPropertyBinding;\n\n\t\t\t\tinternalIdBinding.attachChange(() => {\n\t\t\t\t\texternalIdBinding.refresh();\n\t\t\t\t});\n\t\t\t\tinternalIdBinding\n\t\t\t\t\t.requestValue()\n\t\t\t\t\t.then(() => {\n\t\t\t\t\t\texternalIdBinding.refresh();\n\t\t\t\t\t\treturn;\n\t\t\t\t\t})\n\t\t\t\t\t.catch((err) => {\n\t\t\t\t\t\tLog.error(err as string);\n\t\t\t\t\t});\n\t\t\t\treturn externalIdBinding;\n\t\t\t}\n\t\t\tif (path.includes(\"@$ui5.fe.\")) {\n\t\t\t\tconst propBinding = this._localAnnotationModel.bindProperty(path, context) as ODataPropertyBinding & {\n\t\t\t\t\tsetContext?: Function;\n\t\t\t\t};\n\t\t\t\tif (path.endsWith(\"@$ui5.fe.@Common/ExternalID\")) {\n\t\t\t\t\treturn propBinding;\n\t\t\t\t}\n\t\t\t\tpropBinding.updateRequired = function (model: object): boolean {\n\t\t\t\t\treturn model && model === odataModel;\n\t\t\t\t};\n\t\t\t\tif (path.includes(\"@$ui5.fe.virtual.\")) {\n\t\t\t\t\tconst { expression, viewId } = MetaModelConverter.getVirtualBindingExpression(\n\t\t\t\t\t\tpath,\n\t\t\t\t\t\tMetaModelConverter.convertTypes(this.getMetaModel())\n\t\t\t\t\t);\n\t\t\t\t\tconst owner = viewId ? (UI5Element.getElementById(viewId) as View) : undefined;\n\t\t\t\t\tconst ghostControl = new Any(\n\t\t\t\t\t\t{ any: compileExpression(expression), bindBackProperty: path },\n\t\t\t\t\t\towner?.getController() ?? jsx.getFormatterContext()\n\t\t\t\t\t);\n\t\t\t\t\tconst fnDestroyPropertyBinding = propBinding.destroy.bind(propBinding);\n\t\t\t\t\tpropBinding.destroy = (): void => {\n\t\t\t\t\t\tghostControl?.destroy();\n\t\t\t\t\t\treturn fnDestroyPropertyBinding();\n\t\t\t\t\t};\n\t\t\t\t\tconst fnSetContext = propBinding.setContext;\n\t\t\t\t\tif (fnSetContext) {\n\t\t\t\t\t\tpropBinding.setContext = (newContext: Context): void => {\n\t\t\t\t\t\t\tghostControl?.setBindingContext(newContext);\n\t\t\t\t\t\t\treturn fnSetContext.bind(propBinding)(newContext);\n\t\t\t\t\t\t};\n\t\t\t\t\t}\n\n\t\t\t\t\tghostControl.setModel(this);\n\t\t\t\t\tconst ghostBinding = ghostControl.getBindingInfo(\"any\")?.binding;\n\t\t\t\t\tconst fnCheckUpdate = ghostBinding?.checkUpdate;\n\t\t\t\t\tif (fnCheckUpdate) {\n\t\t\t\t\t\tghostControl.getBindingInfo(\"any\").binding.checkUpdate = (forceUpdate: boolean): void => {\n\t\t\t\t\t\t\t// We need to force the update only if the ghost control is bound to a context\n\t\t\t\t\t\t\t// and the value in the local annotation model is different from the external value.\n\t\t\t\t\t\t\t// This is to ensure that the ghost control is updated only when necessary.\n\t\t\t\t\t\t\tconst isContextLoaded = ghostControl.getBindingContext()?.getObject() !== undefined;\n\t\t\t\t\t\t\tconst bindBackProperty = ghostControl.getBindBackProperty();\n\t\t\t\t\t\t\tconst valueInLocalAnnotation = isContextLoaded\n\t\t\t\t\t\t\t\t? localAnnotationModel.getProperty(ghostControl.getBindingContext()!.getPath(bindBackProperty))\n\t\t\t\t\t\t\t\t: undefined;\n\t\t\t\t\t\t\treturn fnCheckUpdate.bind(ghostBinding)(\n\t\t\t\t\t\t\t\tforceUpdate ||\n\t\t\t\t\t\t\t\t\t(bindBackProperty && isContextLoaded && ghostBinding.getExternalValue() !== valueInLocalAnnotation)\n\t\t\t\t\t\t\t);\n\t\t\t\t\t\t};\n\t\t\t\t\t}\n\t\t\t\t\tghostControl.setBindingContext(context);\n\t\t\t\t}\n\t\t\t\treturn propBinding;\n\t\t\t}\n\t\t\treturn fnBindProperty(path, context, parameters);\n\t\t};\n\t\tconst fnDestroy = odataModel.destroy.bind(odataModel);\n\t\todataModel.destroy = function (): void {\n\t\t\tfor (const vpBinding of odataModel.virtualPropertyBindingRegistry) {\n\t\t\t\tvpBinding.destroy();\n\t\t\t}\n\t\t\tthis._localAnnotationModel.destroy();\n\t\t\treturn fnDestroy.apply(this);\n\t\t};\n\t},\n\n\t/**\n\t * Evaluates a virtual binding expression and returns the result as a promise.\n\t * @param path The path to the virtual property\n\t * @param context The binding context to be used for evaluation\n\t * @returns A promise that resolves with the evaluated value\n\t */\n\tasync evaluateVirtualExpression<T>(path: string, context: ODataV4Context): Promise<T> {\n\t\tconst promiseKeeper = new PromiseKeeper<T>();\n\t\tconst { expression, viewId } = MetaModelConverter.getVirtualBindingExpression(\n\t\t\tpath,\n\t\t\tMetaModelConverter.convertTypes(context.getModel().getMetaModel())\n\t\t);\n\t\tconst owner = viewId ? (UI5Element.getElementById(viewId) as View) : undefined;\n\t\tconst ghostControl = new DataWatcher(\n\t\t\t{\n\t\t\t\tvalueChanged: function (event): void {\n\t\t\t\t\tpromiseKeeper.resolve(event.getParameter(\"value\") as T);\n\t\t\t\t\tevent.getSource().destroy();\n\t\t\t\t},\n\t\t\t\tpropertyBinding: compileExpression(expression)\n\t\t\t},\n\t\t\t(owner?.getController() ?? jsx.getFormatterContext()) as PropertiesOf<DataWatcher>\n\t\t);\n\t\tghostControl.setBindingContext(context);\n\t\tghostControl.setModel(context.getModel());\n\n\t\treturn promiseKeeper.promise;\n\t},\n\n\t/**\n\t * Resolves a metadata binding to its text, either using the converterContext or the metaModel directly.\n\t * @param path\n\t * @param converterContext\n\t * @param metaModel\n\t * @returns The resolved text if possible, else the input value or an empty string if the path was undefined\n\t */\n\tfetchTextFromMetaModel(path: string | undefined, converterContext?: ConverterContext<unknown>, metaModel?: MetaModel): string {\n\t\tlet text = path !== undefined ? path : \"\";\n\t\tif (path?.startsWith(\"{metaModel>\")) {\n\t\t\tconst metaModelPath = path.substring(11, path.length - 1);\n\t\t\ttry {\n\t\t\t\tif (converterContext) {\n\t\t\t\t\ttext = converterContext.getEntityTypeAnnotation(metaModelPath).annotation?.toString() ?? \"\";\n\t\t\t\t} else {\n\t\t\t\t\ttext = metaModel?.getObject(metaModelPath);\n\t\t\t\t}\n\t\t\t} catch (e) {\n\t\t\t\tLog.info(`Unable to retrieve text from meta model using path ${metaModelPath}`);\n\t\t\t}\n\t\t}\n\t\treturn text;\n\t},\n\n\t/**\n\t * Method to retrieve the property path corresponding to state messages.\n\t * @param metaModel The metamodel\n\t * @param contextPath Path for the context on which we what to retreive the message path\n\t * @returns Returns the property path, or undefined if no Messages annotation is defined\n\t */\n\tgetMessagesPath: function (metaModel: ODataMetaModel, contextPath: string): string | undefined {\n\t\tconst metaContext = metaModel.getMetaContext(contextPath);\n\t\tconst objectPath = getInvolvedDataModelObjects(metaContext);\n\t\tconst messages = objectPath.targetEntityType.annotations.Common?.Messages;\n\t\treturn isPathAnnotationExpression(messages) ? messages.path : undefined;\n\t},\n\t/**\n\t * Setup recommendation local binding to make recommendations accessible via client side instance annotations.\n\t *\n\t * Recommendations is a complex property.\n\t * Model does not provide an easy way to bind to complex properties. It has 2 major limitations.\n\t *\n\t * It only supports one time binding to complex properties. This is needed to show updated recommendations on the UI.\n\t * It does not support bindings to properties inside a complex property which is needed for recommendations.\n\t *\n\t * This function provides a workaround to overcome the above two short comings and\n\t * to support client side instance annotations for recommendations.\n\t * @param odataModel The odata model instance.\n\t * @param fnBindProperty Original bind property of the oDataModel\n\t * @param path Binding path for which recommendation is being requested\n\t * @param context Context where recommendation is being requested\n\t * @param recommendationFeatureDisabled Flag which toggles the recommendation feature\n\t * @returns Recommendation property path for the entity related to the context and whether the bindingPath is relevant or not based on metadata.\n\t */\n\tsetUpRecommendationLocalModelBinding: function (\n\t\todataModel: ODataModel,\n\t\tfnBindProperty: Function,\n\t\tpath: string,\n\t\tcontext: ODataV4Context,\n\t\trecommendationFeatureDisabled: boolean\n\t): PropertyBinding | undefined {\n\t\tif (path.includes(\"ui5.fe.recommendations\")) {\n\t\t\tconst recommendationbinding = odataModel.getLocalAnnotationModel().bindProperty(path, context) as ODataPropertyBinding & {\n\t\t\t\tsetContext: Function;\n\t\t\t};\n\t\t\tconst setContextOnRecommendationBinding = (odataPropertyBinding: ODataPropertyBinding & { setContext: Function }): void => {\n\t\t\t\t//we make sure the parent context is set to the propertybinding\n\t\t\t\tconst fnSetContext = recommendationbinding.setContext;\n\t\t\t\tif (fnSetContext) {\n\t\t\t\t\trecommendationbinding.setContext = (newContext: Context): void => {\n\t\t\t\t\t\todataPropertyBinding?.setContext(newContext);\n\t\t\t\t\t\tfnSetContext.bind(odataPropertyBinding)(newContext);\n\t\t\t\t\t\treturn fnSetContext.bind(recommendationbinding)(newContext);\n\t\t\t\t\t};\n\t\t\t\t}\n\t\t\t};\n\t\t\tif (context) {\n\t\t\t\tconst { recommendationComplexProperty, isRecommendedProperty } = ModelHelper.validateRecommendationBindingPath(\n\t\t\t\t\tcontext,\n\t\t\t\t\tpath\n\t\t\t\t);\n\t\t\t\tif (recommendationComplexProperty && isRecommendedProperty && !recommendationFeatureDisabled) {\n\t\t\t\t\tconst alreadyBound = odataModel.virtualPropertyBindingRegistry.some((existingBinding) => {\n\t\t\t\t\t\treturn (\n\t\t\t\t\t\t\t// We do not want the binding to the complex property to be created too many times\n\t\t\t\t\t\t\t// hence we rely on checking whether the contexts are same or not before creating a binding.\n\t\t\t\t\t\t\tcontext === existingBinding.getContext() && recommendationComplexProperty === existingBinding.getPath()\n\t\t\t\t\t\t);\n\t\t\t\t\t});\n\t\t\t\t\tif (!alreadyBound) {\n\t\t\t\t\t\tconst odataPropertyBinding = fnBindProperty(recommendationComplexProperty, context) as ODataPropertyBinding & {\n\t\t\t\t\t\t\tsetContext: Function;\n\t\t\t\t\t\t};\n\t\t\t\t\t\t// Becuase recommendations is a complex property and not a primitive type hence use a raw type.\n\t\t\t\t\t\todataPropertyBinding.setType(new Raw(), \"any\");\n\t\t\t\t\t\todataPropertyBinding.setBindingMode(BindingMode.OneWay);\n\t\t\t\t\t\todataModel.virtualPropertyBindingRegistry.push(odataPropertyBinding);\n\t\t\t\t\t\todataPropertyBinding.attachChange((event: ODataPropertyBinding$ChangeEvent) => {\n\t\t\t\t\t\t\t// refresh the local annotation binding once recommendation binding is updated.\n\t\t\t\t\t\t\tconst propertyBinding = event.getSource();\n\t\t\t\t\t\t\tconst currentContext = event.getSource().getContext() as ODataV4Context;\n\t\t\t\t\t\t\tif (currentContext) {\n\t\t\t\t\t\t\t\tconst contextRecommendations = propertyBinding.getValue();\n\t\t\t\t\t\t\t\tModelHelper.setRecommendationsOnLocalAnnotationModel(contextRecommendations, currentContext);\n\t\t\t\t\t\t\t\trecommendationbinding.refresh();\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t});\n\t\t\t\t\t\t// reuestValue will add the recommendation property to the $select\n\t\t\t\t\t\t// hence we do not need to add it to the $select when constructing the binding at various places (forms, table etc.)\n\t\t\t\t\t\todataPropertyBinding.requestValue().catch((error) => {\n\t\t\t\t\t\t\tLog.error(\"Recommendations could not be resolved\", error);\n\t\t\t\t\t\t});\n\t\t\t\t\t\tsetContextOnRecommendationBinding(odataPropertyBinding);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\t// We need to ensure that the binding becomes invalid and a new binding is created so the recommendation property binding can be created.\n\t\t\t//\n\t\t\t// For this we need to override updateRequired so that the binding is updated until it has not received a context\n\t\t\t// post that we do not need the binding to be updated.\n\t\t\t// If we remove the updateRequired override then recommendations work fine by during save of a newly created document\n\t\t\t// we get binding related issues.\n\t\t\t//\n\t\t\t// Updating the binding to recommendations will be done by setProperty on the localAnnotationModel\n\t\t\t// when the recommendation property is actually updated.\n\t\t\trecommendationbinding.updateRequired = function (model: object): boolean {\n\t\t\t\treturn this.getContext() ? model && model === odataModel : model && this.getModel() === model;\n\t\t\t};\n\t\t\treturn recommendationbinding;\n\t\t}\n\t},\n\t/**\n\t * Validates based on metadata whether a given binding should deal with recommendations or not.\n\t * @param context Context where recommendation is being requested.\n\t * @param bindingPath Binding path for which recommendation is being requested.\n\t * @returns Recommendation property path for the entity related to the context and whether the bindingPath is relevant or not based on metadata.\n\t */\n\tvalidateRecommendationBindingPath: function (\n\t\tcontext: ODataV4Context,\n\t\tbindingPath: string\n\t): { recommendationComplexProperty: string | undefined; isRecommendedProperty: boolean } {\n\t\tconst metaModel = context.getModel().getMetaModel();\n\t\tconst contextMetaPath = metaModel.getMetaPath(context.getPath());\n\t\tconst metaContext = metaModel.getMetaContext(contextMetaPath);\n\t\tconst targetEntityType = getInvolvedDataModelObjects(metaContext).targetEntityType;\n\t\tconst recommendationComplexProperty = (targetEntityType?.annotations?.UI as EntityTypeAnnotations_UI_With_Recommendations)\n\t\t\t?.Recommendations?.path;\n\t\t// sample binding - ShippingCondition@$ui5.fe.recommendations.placeholderValue\n\t\tconst propertyPath = bindingPath.split(\"@$ui5.fe.recommendations\")[0];\n\t\tconst isRecommendedProperty = targetEntityType.entityProperties.some((entityProperty) => {\n\t\t\tif (entityProperty.name === recommendationComplexProperty) {\n\t\t\t\treturn (entityProperty?.targetType as ComplexType)?.properties.some((property) => {\n\t\t\t\t\treturn propertyPath === property.name;\n\t\t\t\t});\n\t\t\t}\n\t\t});\n\t\treturn {\n\t\t\trecommendationComplexProperty,\n\t\t\tisRecommendedProperty\n\t\t};\n\t},\n\t/**\n\t * Update recommendation client side instance annotations.\n\t * @param contextRecommendations Updated recommendations.\n\t * @param currentContext Context where recommendation was updated.\n\t */\n\tsetRecommendationsOnLocalAnnotationModel: function (contextRecommendations: Recommendations, currentContext: ODataV4Context): void {\n\t\tif (contextRecommendations) {\n\t\t\tconst localAnnotationModel = currentContext.getModel().getLocalAnnotationModel();\n\t\t\tconst recommendationObj: Record<string, unknown> = {};\n\t\t\tconst rejectedRecommendations = localAnnotationModel.getProperty(\"/rejectedRecommendations\") || {};\n\t\t\tfor (const recommendedProperty in contextRecommendations) {\n\t\t\t\tconst propertyRecommendations = contextRecommendations[recommendedProperty];\n\t\t\t\tconst localModelPath = recommendedProperty;\n\t\t\t\tconst placeholderValueKey = localModelPath + \"@$ui5.fe.recommendations.placeholderValue\";\n\t\t\t\tconst placeholderDescriptionKey = localModelPath + \"@$ui5.fe.recommendations.placeholderDescription\";\n\t\t\t\tconst typeAheadValuesKey = localModelPath + \"@$ui5.fe.recommendations.typeAheadValues\";\n\n\t\t\t\trecommendationObj[typeAheadValuesKey] = [];\n\n\t\t\t\tfor (const propertyRecommendation of propertyRecommendations) {\n\t\t\t\t\tif (propertyRecommendation.RecommendedFieldIsSuggestion) {\n\t\t\t\t\t\trecommendationObj[placeholderValueKey] = propertyRecommendation.RecommendedFieldValue;\n\t\t\t\t\t\trecommendationObj[placeholderDescriptionKey] = propertyRecommendation.RecommendedFieldDescription;\n\t\t\t\t\t}\n\t\t\t\t\tif (propertyRecommendation.RecommendedFieldValue) {\n\t\t\t\t\t\t(recommendationObj[typeAheadValuesKey] as string[]).push(propertyRecommendation.RecommendedFieldValue);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tif (!propertyRecommendations || !propertyRecommendations.length) {\n\t\t\t\t\trecommendationObj[placeholderValueKey] = null;\n\t\t\t\t\trecommendationObj[placeholderDescriptionKey] = \"\";\n\t\t\t\t}\n\t\t\t}\n\t\t\trecommendationObj[\"recommendationContext\"] = currentContext;\n\t\t\tif (!this._compareRecommendations(recommendationObj, rejectedRecommendations[currentContext.getPath()] || {})) {\n\t\t\t\tObject.keys(recommendationObj).forEach((key) => {\n\t\t\t\t\tconst fullPath = currentContext.getPath(key);\n\t\t\t\t\t// Set the final value at the last path\n\t\t\t\t\tlocalAnnotationModel.setProperty(fullPath, recommendationObj[key], currentContext, false);\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\t},\n\n\t_compareRecommendations: function (\n\t\trecommendations: Record<string, unknown>,\n\t\trejectedRecommendations: Record<string, unknown>\n\t): boolean {\n\t\tconst recommendationKeys = Object.keys(recommendations).filter((key) => key !== \"recommendationContext\");\n\t\tconst rejectedRecommendationKeys = Object.keys(rejectedRecommendations).filter((key) => key !== \"recommendationContext\");\n\t\tif (recommendationKeys.length !== rejectedRecommendationKeys.length) {\n\t\t\treturn false;\n\t\t}\n\t\tfor (const key of recommendationKeys) {\n\t\t\tif (!rejectedRecommendationKeys.includes(key)) {\n\t\t\t\treturn false;\n\t\t\t}\n\t\t\tif (key.includes(\"ui5.fe.recommendations.typeAheadValues\")) {\n\t\t\t\tconst recommendationTypeAheadValues = recommendations[key] as unknown[];\n\t\t\t\tconst rejectedRecommendationTypeAheadValues = rejectedRecommendations[key] as unknown[];\n\t\t\t\tif (\n\t\t\t\t\t!Array.isArray(recommendationTypeAheadValues) ||\n\t\t\t\t\t!Array.isArray(rejectedRecommendationTypeAheadValues) ||\n\t\t\t\t\trecommendationTypeAheadValues.length !== rejectedRecommendationTypeAheadValues.length ||\n\t\t\t\t\trecommendationTypeAheadValues.some((val, idx) => val !== rejectedRecommendationTypeAheadValues[idx])\n\t\t\t\t) {\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\t\t\t} else if (recommendations[key] !== rejectedRecommendations[key]) {\n\t\t\t\treturn false;\n\t\t\t}\n\t\t}\n\t\treturn true;\n\t},\n\t/**\n\t * Fetches the SecondaryKeys from entitytype.\n\t * @param entityType Datamodel object of entityType\n\t * @param entitySet Datamodel object of entitySet\n\t * @returns An array of alternate keys\n\t */\n\tgetAlternateAndSecondaryKeys: (entityType: EntityType, entitySet: EntitySet): string[] => {\n\t\tconst alternateKeys: string[] = [];\n\t\tconst _fetchAlternateKeys = (entityTypeOrSet: EntitySet | EntityType): void => {\n\t\t\tentityTypeOrSet?.annotations?.Core?.AlternateKeys?.forEach((alternateKey: AlternateKey) => {\n\t\t\t\talternateKey.Key.forEach((key: PropertyRef) => {\n\t\t\t\t\talternateKeys.push(key.Name.value);\n\t\t\t\t});\n\t\t\t});\n\t\t};\n\t\tconst _fetchSecondaryKeys = (eT: EntityType): void => {\n\t\t\teT?.annotations?.Common?.SecondaryKey?.forEach((secondaryKey: PropertyPath) => {\n\t\t\t\tif (!alternateKeys.includes(secondaryKey.value)) {\n\t\t\t\t\talternateKeys.push(secondaryKey.value);\n\t\t\t\t}\n\t\t\t});\n\t\t};\n\t\t_fetchAlternateKeys(entitySet);\n\t\tif (!alternateKeys.length) {\n\t\t\t_fetchAlternateKeys(entityType);\n\t\t}\n\t\t_fetchSecondaryKeys(entityType);\n\t\treturn alternateKeys;\n\t}\n};\n\ntype Recommendations = Record<string, RecommendationDetails[]>;\ntype RecommendationDetails = {\n\tRecommendedFieldValue: string;\n\tRecommendedFieldIsSuggestion: boolean;\n\tRecommendedFieldDescription: string;\n};\n\nexport type InternalModelContext = { getModel(): JSONModel } & BaseContext & {\n\t\tsetProperty(sPath: string, vValue: unknown): void;\n\t};\n\nexport default ModelHelper;\n"],"mappings":"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","ignoreList":[]}