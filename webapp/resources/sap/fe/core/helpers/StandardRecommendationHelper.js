/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)
 *      (c) Copyright 2009-2025 SAP SE. All rights reserved
 */
sap.ui.define(["sap/fe/base/BindingToolkit","sap/fe/core/converters/MetaModelConverter","../templating/UIFormatters","./BindingToolkitEvaluator","./TypeGuards"],function(e,t,o,n,r){"use strict";var a={};var s=r.isPropertyPathExpression;var c=r.isPathAnnotationExpression;var i=n.evaluateExpression;var d=o.getDisplayMode;var l=e.getExpressionFromAnnotation;var g=e.compileExpression;let m;const h={storeRecommendations:(e,t,o)=>{const n=t.getProperty("/recommendationsData")||{};h.clearRecommendationsDataFromModelForGivenContexts(n,o);h.enhanceRecommendationModel(e,n);h.updateFetchedContextPaths(o,t);h.updateContextsKeysInModel(n,o);n["version"]=2;t.setProperty("/recommendationsData",n);t.refresh(true)},ignoreRecommendationForContexts:(e,t)=>{let o=t.getProperty("/recommendationContexts")||[];const n=t.getProperty("/recommendationsData");const r=t.getProperty("/ignoredContextPaths")||[];e.forEach(e=>{const t=e.getPath();r.push(t);o=o.filter(e=>!(e?.context).getPath().startsWith(t));Object.keys(n).forEach(e=>{if(e.startsWith(t)){delete n[e]}})});t.setProperty("/recommendationsData",n);t.setProperty("/recommendationContexts",o);t.setProperty("/ignoredContextPaths",r)},clearIgnoredContexts:(e,t)=>{let o=e.getProperty("/ignoredContextPaths")||[];o=o.filter(e=>!e.startsWith(t));e.setProperty("/ignoredContextPaths",o)},checkIfRecommendationRoleExistsForContext:(e,o)=>{const n=t.getInvolvedDataModelObjectsForTargetPath((e?.context).getPath(),(e?.context).getModel()?.getMetaModel());const r=n?.targetEntityType.name;return Object.keys(o.roles).includes(r)},updateContextsKeysInModel:(e,o)=>{if(!e.hasOwnProperty("keys")){e["keys"]={}}const n=e["keys"];o.forEach(e=>{const o=e.getModel()?.getMetaModel();const r=o.getMetaPath(e?.getPath());const a=t.getInvolvedDataModelObjects(o.getMetaContext(r));const s=a.targetEntityType.annotations.Common?.SemanticKey;if(s){if(n&&!n.hasOwnProperty(r)&&s){n[r]=s.map(e=>e.value)}}})},clearRecommendationsDataFromModelForGivenContexts:(e,t)=>{if(t){Object.keys(e).forEach(o=>{const n=o.lastIndexOf(")");if(t.find(e=>e.getPath()===o.substring(0,n+1))){delete e[o]}})}},enhanceRecommendationModel:(e,t)=>{e?.forEach(e=>{const o=e.AIRecommendedFieldPath;if(o){const n=[];let r=false;e._AIAltvRecmddFldVals?.forEach(t=>{const o={value:t.AIRecommendedFieldValue,probability:t.AIRecommendedFieldScoreValue};if(e.AIRecommendedFieldValue===t.AIRecommendedFieldValue){r=true}n.push(o)});t[o]={value:r?e.AIRecommendedFieldValue:undefined,text:r?e.AIRecommendedFieldDescription:undefined,additionalValues:n}}})},getStandardRecommendations:function(e,t,o){if(e&&t){const n=e.getPath()+"/"+t;return o[n]||undefined}},getDisplayModeForTargetPath(e,o){const n=t.getInvolvedDataModelObjectsForTargetPath(e,o);const r=n&&d(n);return r?r:"DescriptionValue"},isRecommendationFieldNull(e,o,n){const r=t.getInvolvedDataModelObjectsForTargetPath(o,e.getModel()?.getMetaModel());if(!e?.getProperty(n)){const t=h.getDisplayModeForTargetPath(o,e?.getModel()?.getMetaModel());if(t&&t!=="Value"){const t=c(r?.targetObject?.annotations?.Common?.Text)&&r?.targetObject?.annotations?.Common?.Text?.path;return t?!e?.getProperty(t):true}return true}return false},updateFetchedContextPaths:function(e,t){const o=[];e?.forEach(e=>{const t=e?.getPath();if(t&&!o.includes(t)){o.push(t)}});t?.setProperty("/fetchedContextPaths",o);t.refresh()},getContextsWithNoRecommendations:function(e,t){const o=t.getProperty("/fetchedContextPaths")||[];const n=t.getProperty("/ignoredContextPaths")||[];return e.filter(e=>{const t=(e?.context).getPath();return!o.includes(t)&&!n.includes(t)})},resetRecommendations:function(e){const t=e.getProperty("/recommendationsData");if(t&&t.hasOwnProperty("version")){e.setProperty("/recommendationsData",{});e?.setProperty("/fetchedContextPaths",[]);e?.setProperty("/ignoredContextPaths",[]);e.refresh(true)}},getCurrentRootContext:function(){return m},setCurrentRootContext:function(e){m=e},addContextIdentifierText(e,t){for(const o of e?.recommendationData||[]){let e=0;const n=[];if(o.context?.getPath()!==t){if(o.contextIdentifier&&o.context){o.contextIdentifier.forEach(t=>{const r=`${o.context?.getPath()})/${t}`;const a=this.getTextForKey(o.context,r,t);if(a){n.push(e===0?`${a}`:` ${a}`);e=e+1}})}}o.contextIdentifierText=n}},getEntityName(e){const o=t.getInvolvedDataModelObjectsForTargetPath(e.getPath(),e.getModel()?.getMetaModel());const n=o?.targetEntityType?.annotations?.UI?.HeaderInfo?.TypeName;return n&&g(l(n))},getTextForKey(e,o,n){let r="";const a=t.getInvolvedDataModelObjectsForTargetPath(o,e?.getModel()?.getMetaModel());const d=a?.targetObject;const g=(c(d)||s(d))&&d.$target||d;const m=l(g?.annotations?.Common?.Text);if(m){try{r=i(m,{"":e.getObject()});r=r?r:e.getProperty(n)}catch{r=e.getProperty(n)}}return r??e.getProperty(n)}};a.standardRecommendationHelper=h;return a},false);
//# sourceMappingURL=StandardRecommendationHelper.js.map