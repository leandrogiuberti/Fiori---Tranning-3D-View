{"version":3,"names":["WEBSOCKET_STATUS","_exports","ChannelType","createWebSocket","channelType","model","additionalParameters","hostLocation","window","location","serviceUrl","getServiceUrl","socketBaseURL","getWebSocketBaseUrl","Error","channelUrl","getWebSocketChannelUrl","socketURI","useBackendUrl","URLSearchParams","search","get","replace","protocol","host","startsWith","p","encodeURI","SapPcpWebSocket","SUPPORTED_PROTOCOLS","v10","getMetaModel","getObject","CollaborationDraft","SideEffectsEvents","channelName"],"sourceRoot":".","sources":["WebSocket.ts"],"sourcesContent":["import SapPcpWebSocket, { SUPPORTED_PROTOCOLS } from \"sap/ui/core/ws/SapPcpWebSocket\";\nimport type ODataModel from \"sap/ui/model/odata/v4/ODataModel\";\n\nexport enum WEBSOCKET_STATUS {\n\tCLOSED = 0,\n\tCLOSING = 1,\n\tCONNECTING = 2,\n\tCONNECTED = 3,\n\tERROR = 4\n}\n\nexport enum ChannelType {\n\tCollaborationDraft = \"CollaborationDraft\",\n\tSideEffectsEvents = \"SideEffectsEvents\"\n}\n\nexport type WebSocketParameter = Record<string, string>;\n\nexport function createWebSocket(channelType: ChannelType, model: ODataModel, additionalParameters?: WebSocketParameter): SapPcpWebSocket {\n\tconst hostLocation = window.location;\n\tconst serviceUrl = model.getServiceUrl();\n\tconst socketBaseURL = getWebSocketBaseUrl(model);\n\tif (!socketBaseURL) {\n\t\tthrow Error(\"WebSocket Base URL annotation not found\");\n\t}\n\n\tconst channelUrl = getWebSocketChannelUrl(channelType, model);\n\tlet socketURI;\n\n\t// Support useBackendUrl for local testing\n\tconst useBackendUrl = new URLSearchParams(window.location.search).get(\"useBackendUrl\");\n\tif (useBackendUrl) {\n\t\tsocketURI = useBackendUrl.replace(\"https\", \"wss\");\n\t} else {\n\t\tsocketURI = hostLocation.protocol === \"https:\" ? \"wss:\" : \"ws:\";\n\t\tsocketURI += `//${hostLocation.host}`;\n\t}\n\n\tsocketURI += `${(socketBaseURL.startsWith(\"/\") ? \"\" : \"/\") + socketBaseURL}?${channelUrl}relatedService=${serviceUrl}`;\n\n\tif (additionalParameters) {\n\t\tfor (const p in additionalParameters) {\n\t\t\tsocketURI += `&${p}=${encodeURI(additionalParameters[p])}`;\n\t\t}\n\t}\n\treturn new SapPcpWebSocket(socketURI, [SUPPORTED_PROTOCOLS.v10]);\n}\n\nexport function getWebSocketBaseUrl(model: ODataModel): string | undefined {\n\treturn model.getMetaModel().getObject(\"/@com.sap.vocabularies.Common.v1.WebSocketBaseURL\");\n}\n\nexport function getWebSocketChannelUrl(channelType: ChannelType, model: ODataModel): string | undefined {\n\tif (!getWebSocketBaseUrl(model)) {\n\t\treturn \"\";\n\t}\n\n\tswitch (channelType) {\n\t\tcase ChannelType.CollaborationDraft:\n\t\t\t// currently collaboration draft does not need a channel (might change later)\n\t\t\treturn \"\";\n\t\tcase ChannelType.SideEffectsEvents:\n\t\t\t// the service need a WebSocketChannel annotated with a #sideEffects qualifier\n\t\t\tconst channelName = model.getMetaModel().getObject(\"/@com.sap.vocabularies.Common.v1.WebSocketChannel#sideEffects\");\n\t\t\treturn `sideEffects=${channelName}&`;\n\t}\n}\n"],"mappings":";;;;;;;;;MAGYA,gBAAgB,0BAAhBA,gBAAgB;IAAhBA,gBAAgB,CAAhBA,gBAAgB;IAAhBA,gBAAgB,CAAhBA,gBAAgB;IAAhBA,gBAAgB,CAAhBA,gBAAgB;IAAhBA,gBAAgB,CAAhBA,gBAAgB;IAAhBA,gBAAgB,CAAhBA,gBAAgB;IAAA,OAAhBA,gBAAgB;EAAA;EAAAC,QAAA,CAAAD,gBAAA,GAAAA,gBAAA;EAAA,IAQhBE,WAAW,0BAAXA,WAAW;IAAXA,WAAW;IAAXA,WAAW;IAAA,OAAXA,WAAW;EAAA;EAAAD,QAAA,CAAAC,WAAA,GAAAA,WAAA;EAOhB,SAASC,eAAeA,CAACC,WAAwB,EAAEC,KAAiB,EAAEC,oBAAyC,EAAmB;IACxI,MAAMC,YAAY,GAAGC,MAAM,CAACC,QAAQ;IACpC,MAAMC,UAAU,GAAGL,KAAK,CAACM,aAAa,CAAC,CAAC;IACxC,MAAMC,aAAa,GAAGC,mBAAmB,CAACR,KAAK,CAAC;IAChD,IAAI,CAACO,aAAa,EAAE;MACnB,MAAME,KAAK,CAAC,yCAAyC,CAAC;IACvD;IAEA,MAAMC,UAAU,GAAGC,sBAAsB,CAACZ,WAAW,EAAEC,KAAK,CAAC;IAC7D,IAAIY,SAAS;;IAEb;IACA,MAAMC,aAAa,GAAG,IAAIC,eAAe,CAACX,MAAM,CAACC,QAAQ,CAACW,MAAM,CAAC,CAACC,GAAG,CAAC,eAAe,CAAC;IACtF,IAAIH,aAAa,EAAE;MAClBD,SAAS,GAAGC,aAAa,CAACI,OAAO,CAAC,OAAO,EAAE,KAAK,CAAC;IAClD,CAAC,MAAM;MACNL,SAAS,GAAGV,YAAY,CAACgB,QAAQ,KAAK,QAAQ,GAAG,MAAM,GAAG,KAAK;MAC/DN,SAAS,IAAI,KAAKV,YAAY,CAACiB,IAAI,EAAE;IACtC;IAEAP,SAAS,IAAI,GAAG,CAACL,aAAa,CAACa,UAAU,CAAC,GAAG,CAAC,GAAG,EAAE,GAAG,GAAG,IAAIb,aAAa,IAAIG,UAAU,kBAAkBL,UAAU,EAAE;IAEtH,IAAIJ,oBAAoB,EAAE;MACzB,KAAK,MAAMoB,CAAC,IAAIpB,oBAAoB,EAAE;QACrCW,SAAS,IAAI,IAAIS,CAAC,IAAIC,SAAS,CAACrB,oBAAoB,CAACoB,CAAC,CAAC,CAAC,EAAE;MAC3D;IACD;IACA,OAAO,IAAIE,eAAe,CAACX,SAAS,EAAE,CAACY,mBAAmB,CAACC,GAAG,CAAC,CAAC;EACjE;EAAC7B,QAAA,CAAAE,eAAA,GAAAA,eAAA;EAEM,SAASU,mBAAmBA,CAACR,KAAiB,EAAsB;IAC1E,OAAOA,KAAK,CAAC0B,YAAY,CAAC,CAAC,CAACC,SAAS,CAAC,mDAAmD,CAAC;EAC3F;EAAC/B,QAAA,CAAAY,mBAAA,GAAAA,mBAAA;EAEM,SAASG,sBAAsBA,CAACZ,WAAwB,EAAEC,KAAiB,EAAsB;IACvG,IAAI,CAACQ,mBAAmB,CAACR,KAAK,CAAC,EAAE;MAChC,OAAO,EAAE;IACV;IAEA,QAAQD,WAAW;MAClB,KAAKF,WAAW,CAAC+B,kBAAkB;QAClC;QACA,OAAO,EAAE;MACV,KAAK/B,WAAW,CAACgC,iBAAiB;QACjC;QACA,MAAMC,WAAW,GAAG9B,KAAK,CAAC0B,YAAY,CAAC,CAAC,CAACC,SAAS,CAAC,+DAA+D,CAAC;QACnH,OAAO,eAAeG,WAAW,GAAG;IACtC;EACD;EAAClC,QAAA,CAAAe,sBAAA,GAAAA,sBAAA;EAAA,OAAAf,QAAA;AAAA","ignoreList":[],"file":"WebSocket-dbg.js"}