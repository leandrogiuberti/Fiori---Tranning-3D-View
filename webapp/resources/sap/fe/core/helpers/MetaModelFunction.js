/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)
 *      (c) Copyright 2009-2025 SAP SE. All rights reserved
 */
sap.ui.define(["sap/fe/base/BindingToolkit","sap/fe/core/converters/helpers/IssueManager","sap/fe/core/helpers/ModelHelper","sap/fe/core/type/EDM","../converters/MetaModelConverter"],function(e,t,r,i,n){"use strict";var o={};var s=n.getInvolvedDataModelObjects;var a=i.isTypeFilterable;var l=t.IssueSeverity;var c=t.IssueCategoryType;var u=t.IssueCategory;var p=e.pathInModel;var f=e.or;var g=e.not;var d=e.compileExpression;function P(e,t){let i;let n;const o="$NavigationPropertyBinding";const s="@Org.OData.Capabilities.V1.SearchRestrictions";const a=e.replaceAll("%2F","/").split("/").filter(r.filterOutNavPropBinding);const l=r.getEntitySetPath(e,t);const c=l.split("/").filter(r.filterOutNavPropBinding);const u=t.getObject(`/${a.join("/")}/$ContainsTarget`)?true:false;const p=u?a[a.length-1]:"";if(!u){i=t.getObject(`${l}${s}`)}if(a.length>1){const e=u?p:c[c.length-1];const r=`/${o}/`;const i=u?l:`/${c.slice(0,-1).join(r)}`;const s=V.getNavigationRestrictions(t,i,e.replaceAll("%2F","/"));n=s?.SearchRestrictions}return n??i}o.getSearchRestrictions=P;function h(e,t,r){const i=e.getObject(`${t}@Org.OData.Capabilities.V1.NavigationRestrictions`);const n=i?.RestrictedProperties;return n?.find(function(e){return e.NavigationProperty?.$NavigationPropertyPath===r})}o.getNavigationRestrictions=h;function v(e,t,r){let i=false;const n=e.getObject(`${t}@Org.OData.Capabilities.V1.FilterRestrictions`);if(n?.NonFilterableProperties){i=n.NonFilterableProperties.some(function(e){return e.$NavigationPropertyPath===r||e.$PropertyPath===r})}return i}function b(e,t,r){let i=false;const n=e.getObject(t+"@Org.OData.Aggregation.V1.ApplySupported")?true:false;if(n){const n=e.getObject(`${t}@`);const o=V.getAllCustomAggregates(n);const s=o?Object.keys(o):undefined;if(s?.includes(r)){i=true}}return i}o.isCustomAggregate=b;function y(e,t,r,i){let n=e.split("/").length===2&&!r.includes("/")?!v(t,e,r):!R(t,e,r);if(n&&i){const e=m(i);if(e){n=e?a(e):false}else{n=false}}return n}function R(e,t,r){const i=`${t}/${r}`,n=i.split("/").splice(0,2),o=i.split("/").splice(2);let s=false,a="";t=n.join("/");s=o.some(function(r,i,n){if(a.length>0){a+=`/${r}`}else{a=r}if(i===n.length-2){const i=V.getNavigationRestrictions(e,t,r);const o=i?.FilterRestrictions;const s=o?.NonFilterableProperties;const a=n[n.length-1];if(s?.find(function(e){return e.$PropertyPath===a})){return true}}if(i===n.length-1){s=v(e,t,a)}else if(e.getObject(`${t}/$NavigationPropertyBinding/${r}`)){s=v(e,t,a);a="";t="/"+e.getObject(`${t}/$NavigationPropertyBinding/${r}`)}return s});return s}function m(e){let t=e.getProperty("$Type");if(!e.getProperty("$kind")){switch(t){case"com.sap.vocabularies.UI.v1.DataFieldForAction":case"com.sap.vocabularies.UI.v1.DataFieldForIntentBasedNavigation":t=undefined;break;case"com.sap.vocabularies.UI.v1.DataField":case"com.sap.vocabularies.UI.v1.DataFieldWithNavigationPath":case"com.sap.vocabularies.UI.v1.DataFieldWithUrl":case"com.sap.vocabularies.UI.v1.DataFieldWithIntentBasedNavigation":case"com.sap.vocabularies.UI.v1.DataFieldWithAction":t=e.getProperty("Value/$Path/$Type");break;case"com.sap.vocabularies.UI.v1.DataFieldForAnnotation":default:const r=e.getProperty("Target/$AnnotationPath");if(r){if(r.includes("com.sap.vocabularies.Communication.v1.Contact")){t=e.getProperty("Target/$AnnotationPath/fn/$Path/$Type")}else if(r.includes("com.sap.vocabularies.UI.v1.DataPoint")){t=e.getProperty("Value/$Path/$Type")}else{t=undefined}}else{t=undefined}break}}return t}function $(e,t,r,i){if(typeof r!=="string"){throw new Error("sProperty parameter must be a string")}if(e.getObject(`${t}/@com.sap.vocabularies.Common.v1.ResultContext`)===true){return true}const n=e.createBindingContext(`${t}/${r}`);if(n&&!i){if(n.getProperty("@com.sap.vocabularies.UI.v1.Hidden")===true||n.getProperty("@com.sap.vocabularies.UI.v1.HiddenFilter")===true){return false}const e=n.getProperty("@com.sap.vocabularies.UI.v1.Hidden/$Path");const t=n.getProperty("@com.sap.vocabularies.UI.v1.HiddenFilter/$Path");if(e&&t){return d(g(f(p(e),p(t))))}else if(e){return d(g(p(e)))}else if(t){return d(g(p(t)))}}return y(t,e,r,n)}o.isPropertyFilterable=$;function O(e,t,r){const i=s(e.getContext(t));const n=[];const o=[];const a=[];const p=V.getRequiredPropertiesFromInsertRestrictions(t,e);const f=i.targetEntityType.entityProperties;for(const e of f){const t=e.annotations,i=e.isKey,s=e.name,f=t.Core?.Immutable?.valueOf()===true,g=!(t.Core?.Computed?.valueOf()===true),d=!(t.UI?.Hidden?.valueOf()===true),P=t.Core?.ComputedDefaultValue?.valueOf()===true,h=i&&e.type==="Edm.Guid"?P&&t.Common?.Text:false;if((h||i&&e.type!=="Edm.Guid")&&g&&d){n.push(s)}else if(p.includes(s)&&d&&!(i&&!n.includes(s))){a.push(s)}else if(f&&g&&d){o.push(s)}if(!g&&P&&r){const e=r.getDiagnostics();const t="Core.ComputedDefaultValue is ignored as Core.Computed is already set to true";e.addIssue(u.Annotation,l.Medium,t,c,c.Annotations.IgnoredAnnotation)}}return n.concat(a).concat(o)}o.getCreatePopupFields=O;function F(e,t){let i=arguments.length>2&&arguments[2]!==undefined?arguments[2]:false;const n=[];let o=[];const s="$NavigationPropertyBinding";let a=null;if(e.endsWith("$")){e=e.replace("/$","")}const l=e.replaceAll("%2F","/").split("/").filter(r.filterOutNavPropBinding);const c=r.getEntitySetPath(e,t);const u=c.split("/").filter(r.filterOutNavPropBinding);const p=t.getObject(`/${l.join("/")}/$ContainsTarget`)?true:false;const f=p?l[l.length-1]:"";if(!p){a=t.getObject(`${c}@`)}if(l.length>1){const e=p?f:u[u.length-1];const r=`/${s}/`;const n=p?c:`/${u.slice(0,-1).join(r)}`;const l=V.getNavigationRestrictions(t,n,e.replaceAll("%2F","/"));if(l!==undefined&&V.hasRestrictedPropertiesInAnnotations(l,true,i)){o=i?l.UpdateRestrictions?.RequiredProperties??[]:l.InsertRestrictions?.RequiredProperties??[]}if(!o.length&&V.hasRestrictedPropertiesInAnnotations(a,false,i)){o=V.getRequiredPropertiesFromAnnotations(a,i)}}else if(V.hasRestrictedPropertiesInAnnotations(a,false,i)){o=V.getRequiredPropertiesFromAnnotations(a,i)}o.forEach(function(e){const t=e.$PropertyPath;n.push(t)});return n}function I(e,t){return V.getRequiredProperties(e,t)}o.getRequiredPropertiesFromInsertRestrictions=I;function C(e,t){return V.getRequiredProperties(e,t,true)}o.getRequiredPropertiesFromUpdateRestrictions=C;function A(e){let t=arguments.length>1&&arguments[1]!==undefined?arguments[1]:false;if(t){return e?.["@Org.OData.Capabilities.V1.UpdateRestrictions"]?.RequiredProperties??[]}return e?.["@Org.OData.Capabilities.V1.InsertRestrictions"]?.RequiredProperties??[]}function D(e){let t=arguments.length>1&&arguments[1]!==undefined?arguments[1]:false;let r=arguments.length>2&&arguments[2]!==undefined?arguments[2]:false;if(t){const t=e;if(r){return t?.UpdateRestrictions?.RequiredProperties?true:false}return t?.InsertRestrictions?.RequiredProperties?true:false}else if(r){const t=e;return t?.["@Org.OData.Capabilities.V1.UpdateRestrictions"]?.RequiredProperties?true:false}const i=e;return i?.["@Org.OData.Capabilities.V1.InsertRestrictions"]?.RequiredProperties?true:false}function N(e){const t={};let r;for(const i in e){if(i.startsWith("@Org.OData.Aggregation.V1.CustomAggregate")){r=i.replace("@Org.OData.Aggregation.V1.CustomAggregate#","");const n=r.split("@");if(n.length==2){const r={};if(n[1]=="Org.OData.Aggregation.V1.ContextDefiningProperties"){r.contextDefiningProperties=e[i]}if(n[1]=="com.sap.vocabularies.Common.v1.Label"){r.label=e[i]}t[n[0]]=r}else if(n.length==1){t[n[0]]={name:n[0],propertyPath:n[0],label:`Custom Aggregate (${r})`,sortable:true,sortOrder:"both",custom:true}}}}return t}o.getAllCustomAggregates=N;function q(e){const t={sortable:true,propertyInfo:{}};const r=e["@Org.OData.Capabilities.V1.SortRestrictions"];if(!r){return t}if(r.Sortable===false){t.sortable=false}for(const e of r.NonSortableProperties||[]){const r=e.$PropertyPath;t.propertyInfo[r]={sortable:false}}for(const e of r.AscendingOnlyProperties||[]){const r=e.$PropertyPath;t.propertyInfo[r]={sortable:true,sortDirection:"asc"}}for(const e of r.DescendingOnlyProperties||[]){const r=e.$PropertyPath;t.propertyInfo[r]={sortable:true,sortDirection:"desc"}}return t}o.getSortRestrictionsInfo=q;function U(e){let t,r;const i={filterable:true,requiresFilter:e?.RequiresFilter||false,propertyInfo:{},requiredProperties:[]};if(!e){return i}if(e.Filterable===false){i.filterable=false}if(e.RequiredProperties){for(t=0;t<e.RequiredProperties.length;t++){r=e.RequiredProperties[t].$PropertyPath;i.requiredProperties.push(r)}}const n=e.NonFilterableProperties?.map(e=>e.$PropertyPath)||[];const o=e.FilterExpressionRestrictions?.map(e=>e.Property?.$PropertyPath)||[];E(i.propertyInfo,n,o);if(e.FilterExpressionRestrictions){for(t=0;t<e.FilterExpressionRestrictions.length;t++){r=e.FilterExpressionRestrictions[t].Property?.$PropertyPath;if(r){i.propertyInfo[r]["allowedExpressions"]=e.FilterExpressionRestrictions[t].AllowedExpressions}}}return i}o.getFilterRestrictionsInfo=U;function E(e,t,r){for(let r=0;r<t.length;r++){e[t[r]]={filterable:false}}for(let t=0;t<r.length;t++){const i=r[t];if(i){e[i]={filterable:true}}}}o.getFilterableData=E;function j(e){let t=true;switch(e){case"SearchExpression":case"SingleRange":case"SingleValue":t=false;break;default:break}return t}o.isMultiValueFilterExpression=j;const V={getRequiredProperties:F,getRequiredPropertiesFromAnnotations:A,hasRestrictedPropertiesInAnnotations:D,getRequiredPropertiesFromInsertRestrictions:I,getNavigationRestrictions:h,getAllCustomAggregates:N,getFilterableData:E};o.METAMODEL_FUNCTIONS=V;return o},false);
//# sourceMappingURL=MetaModelFunction.js.map