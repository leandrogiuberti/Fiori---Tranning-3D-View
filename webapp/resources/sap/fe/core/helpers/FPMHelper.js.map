{"version":3,"file":"FPMHelper.js","names":["FPMHelper","loadModuleAndCallMethod","async","module","method","source","_len","arguments","length","args","Array","_key","Promise","resolve","extensionAPI","view","isA","CommonUtils","getTargetView","getSource","getControllerName","getController","getExtensionAPI","startsWith","fnTarget","ObjectPath","get","replace","substring","sap","ui","require","loadedModule","bind","actionWrapper","oEvent","sModule","sMethod","oParameters","Log","debug","oSource","oView","oBindingContext","getBindingContext","listBinding","aSelectedContexts","undefined","contexts","getParent","getMdcTable","getRowBinding","control","parent","validationWrapper","oValidationContexts","getCustomFunction","moduleName","functionName","customFunction","controllerExt","error"],"sources":["./FPMHelper.ts"],"sourcesContent":["import Log from \"sap/base/Log\";\nimport ObjectPath from \"sap/base/util/ObjectPath\";\nimport type { FEView } from \"sap/fe/core/BaseController\";\nimport CommonUtils from \"sap/fe/core/CommonUtils\";\nimport type ExtensionAPI from \"sap/fe/core/ExtensionAPI\";\nimport type UI5Event from \"sap/ui/base/Event\";\nimport type EventProvider from \"sap/ui/base/EventProvider\";\nimport type Control from \"sap/ui/core/Control\";\nimport type UI5Element from \"sap/ui/core/Element\";\nimport type View from \"sap/ui/core/mvc/View\";\nimport type MdcTable from \"sap/ui/mdc/Table\";\nimport type Context from \"sap/ui/model/Context\";\nimport type ODataListBinding from \"sap/ui/model/odata/v4/ODataListBinding\";\n\nconst FPMHelper = {\n\tloadModuleAndCallMethod: async function (\n\t\tmodule: string,\n\t\tmethod: string,\n\t\tsource: View | UI5Event<{}, Control>,\n\t\t...args: unknown[]\n\t): Promise<unknown> {\n\t\treturn new Promise(function (resolve: (value: unknown) => void) {\n\t\t\tlet extensionAPI: ExtensionAPI | undefined;\n\t\t\tlet view: View;\n\t\t\tif (source.isA<UI5Event>(\"sap.ui.base.Event\")) {\n\t\t\t\tview = CommonUtils.getTargetView(source.getSource());\n\t\t\t} else {\n\t\t\t\tview = source;\n\t\t\t}\n\n\t\t\tif (\n\t\t\t\tview.getControllerName() === \"sap.fe.templates.ObjectPage.ObjectPageController\" ||\n\t\t\t\tview.getControllerName() === \"sap.fe.ariba.ObjectPage.ObjectPageController\" ||\n\t\t\t\tview.getControllerName() === \"sap.fe.templates.ListReport.ListReportController\" ||\n\t\t\t\tview.getControllerName() === \"sap.fe.ariba.ListReport.ListReportController\"\n\t\t\t) {\n\t\t\t\textensionAPI = (view as FEView).getController().getExtensionAPI();\n\t\t\t}\n\n\t\t\tif (module.startsWith(\"/extension/\")) {\n\t\t\t\tconst fnTarget = ObjectPath.get(module.replace(/\\//g, \".\").substring(1), extensionAPI);\n\t\t\t\tresolve(fnTarget[method](...args));\n\t\t\t} else {\n\t\t\t\tsap.ui.require([module], function (loadedModule: Record<string, Function>) {\n\t\t\t\t\t// - we bind the action to the extensionAPI of the controller so it has the same scope as a custom section\n\t\t\t\t\t// - we provide the context as API, maybe if needed further properties\n\t\t\t\t\tresolve(loadedModule[method].bind(extensionAPI)(...args));\n\t\t\t\t});\n\t\t\t}\n\t\t});\n\t},\n\n\tactionWrapper: async function (\n\t\toEvent: UI5Event,\n\t\tsModule?: string,\n\t\tsMethod?: string,\n\t\toParameters?: { contexts?: Context[] }\n\t): Promise<unknown> {\n\t\tif (!sModule || !sMethod) {\n\t\t\tLog.debug(\"Both the module and the method must be defined to execute a custom action\");\n\t\t\treturn;\n\t\t}\n\n\t\t//The source would be command execution, in case a command is defined for the action in the manifest.\n\t\tconst oSource = (oEvent.getSource ? oEvent.getSource() : (oEvent as { oSource?: EventProvider }).oSource) as Control,\n\t\t\toView = CommonUtils.getTargetView(oSource),\n\t\t\toBindingContext = oSource.getBindingContext()!;\n\n\t\tlet listBinding: ODataListBinding | undefined;\n\t\tlet aSelectedContexts: Context[];\n\n\t\tif (oParameters !== undefined) {\n\t\t\taSelectedContexts = oParameters.contexts || [];\n\t\t} else if (oBindingContext !== undefined) {\n\t\t\taSelectedContexts = [oBindingContext];\n\t\t} else {\n\t\t\taSelectedContexts = [];\n\t\t}\n\t\tif (oSource.getParent()?.isA(\"sap.ui.mdc.actiontoolbar.ActionToolbarAction\") || oSource.getParent()?.isA(\"sap.m.MenuWrapper\")) {\n\t\t\tlistBinding = FPMHelper.getMdcTable(oSource)?.getRowBinding();\n\t\t}\n\n\t\treturn FPMHelper.loadModuleAndCallMethod(sModule, sMethod, oView, oBindingContext, aSelectedContexts, listBinding);\n\t},\n\tgetMdcTable: function (control: UI5Element): MdcTable | null | undefined {\n\t\tconst parent = control.getParent();\n\t\tif (!parent || parent.isA<MdcTable>(\"sap.ui.mdc.Table\")) {\n\t\t\treturn parent;\n\t\t}\n\t\treturn FPMHelper.getMdcTable(parent as Control);\n\t},\n\tvalidationWrapper: async function (\n\t\tsModule: string,\n\t\tsMethod: string,\n\t\toValidationContexts: Record<string, unknown>,\n\t\toView: View,\n\t\toBindingContext: Context\n\t): Promise<{ messageTarget?: string; messageText: string }[]> {\n\t\treturn FPMHelper.loadModuleAndCallMethod(sModule, sMethod, oView, oBindingContext, oValidationContexts) as Promise<\n\t\t\t{ messageTarget?: string; messageText: string }[]\n\t\t>;\n\t},\n\t/**\n\t * Returns an external custom function defined either in a custom controller extension or in an external module.\n\t * @param moduleName The external module name, or /extension/<path to the custom controller extension module>\n\t * @param functionName The name of the function\n\t * @param source A control in the view or an event triggered by a control in the view\n\t * @returns The function (or undefined if it couldn't be found)\n\t */\n\tgetCustomFunction<FunctionType>(\n\t\tmoduleName: string,\n\t\tfunctionName: string,\n\t\tsource: Control | UI5Event<{}, Control>\n\t): FunctionType | undefined {\n\t\tlet control: Control;\n\t\tif (source.isA<UI5Event>(\"sap.ui.base.Event\")) {\n\t\t\tcontrol = source.getSource();\n\t\t} else {\n\t\t\tcontrol = source;\n\t\t}\n\t\tconst view = CommonUtils.getTargetView(control);\n\t\tconst extensionAPI = view.getController().getExtensionAPI();\n\n\t\tlet customFunction: FunctionType | undefined;\n\n\t\tif (moduleName.startsWith(\"/extension/\")) {\n\t\t\tconst controllerExt = ObjectPath.get(moduleName.replace(/\\//g, \".\").substring(1), extensionAPI);\n\t\t\tcustomFunction = controllerExt ? controllerExt[functionName] : undefined;\n\t\t} else {\n\t\t\tconst module = sap.ui.require(moduleName);\n\t\t\tcustomFunction = module ? module[functionName]?.bind(extensionAPI) : undefined;\n\t\t}\n\n\t\tif (!customFunction) {\n\t\t\tLog.error(`Couldn't find method ${functionName} in ${moduleName}`);\n\t\t}\n\t\treturn customFunction;\n\t}\n};\n\nexport default FPMHelper;\n"],"mappings":";;;;iHAcA,MAAMA,EAAY,CACjBC,wBAAyBC,eACxBC,EACAC,EACAC,GAEmB,QAAAC,EAAAC,UAAAC,OADhBC,EAAI,IAAAC,MAAAJ,EAAA,EAAAA,EAAA,KAAAK,EAAA,EAAAA,EAAAL,EAAAK,IAAA,CAAJF,EAAIE,EAAA,GAAAJ,UAAAI,EAAA,CAEP,OAAO,IAAIC,QAAQ,SAAUC,GAC5B,IAAIC,EACJ,IAAIC,EACJ,GAAIV,EAAOW,IAAc,qBAAsB,CAC9CD,EAAOE,EAAYC,cAAcb,EAAOc,YACzC,KAAO,CACNJ,EAAOV,CACR,CAEA,GACCU,EAAKK,sBAAwB,oDAC7BL,EAAKK,sBAAwB,gDAC7BL,EAAKK,sBAAwB,oDAC7BL,EAAKK,sBAAwB,+CAC5B,CACDN,EAAgBC,EAAgBM,gBAAgBC,iBACjD,CAEA,GAAInB,EAAOoB,WAAW,eAAgB,CACrC,MAAMC,EAAWC,EAAWC,IAAIvB,EAAOwB,QAAQ,MAAO,KAAKC,UAAU,GAAId,GACzED,EAAQW,EAASpB,MAAWK,GAC7B,KAAO,CACNoB,IAAIC,GAAGC,QAAQ,CAAC5B,GAAS,SAAU6B,GAGlCnB,EAAQmB,EAAa5B,GAAQ6B,KAAKnB,EAA1BkB,IAA2CvB,GACpD,EACD,CACD,EACD,EAEAyB,cAAehC,eACdiC,EACAC,EACAC,EACAC,GAEA,IAAKF,IAAYC,EAAS,CACzBE,EAAIC,MAAM,6EACV,MACD,CAGA,MAAMC,EAAWN,EAAOhB,UAAYgB,EAAOhB,YAAegB,EAAuCM,QAChGC,EAAQzB,EAAYC,cAAcuB,GAClCE,EAAkBF,EAAQG,oBAE3B,IAAIC,EACJ,IAAIC,EAEJ,GAAIR,IAAgBS,UAAW,CAC9BD,EAAoBR,EAAYU,UAAY,EAC7C,MAAO,GAAIL,IAAoBI,UAAW,CACzCD,EAAoB,CAACH,EACtB,KAAO,CACNG,EAAoB,EACrB,CACA,GAAIL,EAAQQ,aAAajC,IAAI,iDAAmDyB,EAAQQ,aAAajC,IAAI,qBAAsB,CAC9H6B,EAAc7C,EAAUkD,YAAYT,IAAUU,eAC/C,CAEA,OAAOnD,EAAUC,wBAAwBmC,EAASC,EAASK,EAAOC,EAAiBG,EAAmBD,EACvG,EACAK,YAAa,SAAUE,GACtB,MAAMC,EAASD,EAAQH,YACvB,IAAKI,GAAUA,EAAOrC,IAAc,oBAAqB,CACxD,OAAOqC,CACR,CACA,OAAOrD,EAAUkD,YAAYG,EAC9B,EACAC,kBAAmBpD,eAClBkC,EACAC,EACAkB,EACAb,EACAC,GAEA,OAAO3C,EAAUC,wBAAwBmC,EAASC,EAASK,EAAOC,EAAiBY,EAGpF,EAQAC,kBACCC,EACAC,EACArD,GAEA,IAAI+C,EACJ,GAAI/C,EAAOW,IAAc,qBAAsB,CAC9CoC,EAAU/C,EAAOc,WAClB,KAAO,CACNiC,EAAU/C,CACX,CACA,MAAMU,EAAOE,EAAYC,cAAckC,GACvC,MAAMtC,EAAeC,EAAKM,gBAAgBC,kBAE1C,IAAIqC,EAEJ,GAAIF,EAAWlC,WAAW,eAAgB,CACzC,MAAMqC,EAAgBnC,EAAWC,IAAI+B,EAAW9B,QAAQ,MAAO,KAAKC,UAAU,GAAId,GAClF6C,EAAiBC,EAAgBA,EAAcF,GAAgBX,SAChE,KAAO,CACN,MAAM5C,EAAS0B,IAAIC,GAAGC,QAAQ0B,GAC9BE,EAAiBxD,EAASA,EAAOuD,IAAezB,KAAKnB,GAAgBiC,SACtE,CAEA,IAAKY,EAAgB,CACpBpB,EAAIsB,MAAM,wBAAwBH,QAAmBD,IACtD,CACA,OAAOE,CACR,GACC,OAEa3D,CAAS","ignoreList":[]}