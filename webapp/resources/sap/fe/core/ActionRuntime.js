/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)
 *      (c) Copyright 2009-2025 SAP SE. All rights reserved
 */
sap.ui.define(["sap/base/util/merge","sap/fe/base/BindingToolkit","sap/fe/core/CommonUtils","sap/fe/core/helpers/ModelHelper","sap/fe/core/helpers/TypeGuards","sap/ui/core/Messaging","sap/ui/core/message/Message","sap/ui/core/message/MessageType","./controls/AnyElement","./converters/ConverterContext","./converters/objectPage/HeaderAndFooterAction"],function(e,t,n,o,i,a,s,r,l,c,d){"use strict";var g=d.getHiddenExpression;var f=d.getEditButtonEnabled;var p=i.isEntitySet;var u=t.transformRecursively;var b=t.equal;var y=t.constant;var A=t.compileExpression;function m(e,t,n){e.setProperty(`dynamicActions/${t}/aApplicable`,[]);e.setProperty(`dynamicActions/${t}/aNotApplicable`,[]);if(n){e.setProperty(`dynamicActions/${t}/bEnabledForContextMenu`,false)}else{e.setProperty(`dynamicActions/${t}/bEnabled`,false)}}function P(e,t,o,i){e.setProperty(`dynamicActions/${t}`,{bEnabled:false,aApplicable:[],aNotApplicable:[]});o.push(n.setContextsBasedOnOperationAvailable(e,[],i).then(()=>[]))}function E(e,t,o,i){o.push(n.setContextsBasedOnOperationAvailable(e,t,i).then(()=>[]))}function h(e,t,n,o,i,a,s){if(!e.length){P(t,n,s,a)}else if(e.length&&typeof o==="string"){E(t,i,s,a)}}const x={_addMessageForActionParameter:function(e){a.addMessages(e.map(e=>{const t=e.actionParameterInfo.field.getBinding(e.actionParameterInfo.isMultiValue?"items":"value");return new s({message:e.message,type:r.Error,processor:t?.getModel()??undefined,persistent:true,target:t?.getResolvedPath()})}))},validateProperties:async function(e,t){await Promise.allSettled(e.map(e=>e.validationPromise));const n=e.filter(e=>e.field.getRequired&&e.field.getRequired());const o=a.getMessageModel().getData();const i=n.filter(e=>{const t=e.field.getId();const n=o.filter(e=>e.getControlIds().some(e=>e.includes(t)));if(n.length>0){return false}else if(e.isMultiValue){return e.value===undefined||!e.value.length}else{const t=e.field.getValue();const n=Array.isArray(e.field.getValue());if(n){return t[0]===null||t[0]===""}return t===undefined||t===null||t===""}});if(i.length){this._addMessageForActionParameter(i.map(e=>({actionParameterInfo:e,message:t.getText("C_OPERATIONS_ACTION_PARAMETER_DIALOG_MISSING_MANDATORY_MSG",[(e.field.getParent()?.getAggregation("label")).getText()])})))}const s=e.find(e=>e.field.getVisible()&&(e.hasError||e.field.getValueState()==="Error"||i.includes(e)));if(s){s.field.setVisible(true);s.field.focus();return false}else{return true}},setActionEnablement:async function(e,t,n,o){let i=arguments.length>4&&arguments[4]!==undefined?arguments[4]:false;const a=[];for(const s in t){let r=[];e.setProperty(s,false);if(o==="table"){m(e,s,i)}const l=t[s];for(const t of n){if(t){const n=t.getObject();if(o==="chart"){if(l===null&&!!n[`#${s}`]||t.getObject(l)){e.setProperty(s,true);break}}else if(o==="table"){r=this._setActionEnablementForTable(t,e,s,l,r,i)}}}if(o==="table"){h(n,e,s,l,r,i,a)}}if(n.length>0){const t=e.getProperty("selectedContexts")||[];e.setProperty("selectedContexts",[]);e.setProperty("selectedContexts",t)}return Promise.all(a).then(e=>e.flat())},setActionEnablementAfterPatch:function(e,t,n){const o=n?.getObject();const i=o?.controls||{};for(const n in i){if(i[n]&&i[n].controlId){const o=e.byId(n);if(o&&o.isA("sap.ui.mdc.Table")){const e=o.getRowBinding();if(e==t){const e=o.getParent();x.setActionEnablement(o.getBindingContext("internal"),JSON.parse(e.tableDefinition.operationAvailableMap),o.getSelectedContexts(),"table")}}}}},updateEditButtonVisibilityAndEnablement(t){const i=t.getViewData()?.viewLevel,a=n.getIsEditable(t);if(i>1&&a!==true){const i=t.getBindingContext();const a=n.getAppComponent(t);const s=o.getMetaPathForContext(i);const r=o.getRootEntitySetPath(s);const l=i?.getModel().getMetaModel()?.getContext(i?.getPath());const d=c?.createConverterContextForMacro(r,l,a.getDiagnostics(),e);const u=d.getEntitySet();const y=d.getEntityType();let m;const P=p(u)&&u.annotations.UI?.UpdateHidden?.valueOf();if(P!==true){m=o.isUpdateHidden(u,y)}const E=f(d);const h=o.getDraftRootPath(i);const x=o.getStickyRootPath(i);const C=h||x;const M=t.getBindingContext("internal");if(C){const e=t.getModel().bindContext(C).getBoundContext();if(m!==undefined){const n=A(b(g(d,m),false));this.updateEditModelContext(n,t,e,"rootEditVisible",M)}if(E){this.updateEditModelContext(E,t,e,"rootEditEnabled",M)}}}},updateEditModelContext:function(e,t,n,o,i){if(e){const a=new l({anyText:e});a.setBindingContext(null);t.addDependent(a);a.getBinding("anyText");const s=a.getModel()?.bindContext(n.getPath(),n,{$$groupId:"$auto.Heroes"})?.getBoundContext();a.setBindingContext(s);a?.getBinding("anyText")?.attachChange(e=>{const t=e.getSource().getExternalValue();i.setProperty(o,t)})}},_setActionEnablementForTable:function(e,t,o,i,a){let s=arguments.length>5&&arguments[5]!==undefined?arguments[5]:false;const r=s?"bEnabledForContextMenu":"bEnabled",l=t.getProperty(`dynamicActions/${o}/aApplicable`)||[],c=t.getProperty(`dynamicActions/${o}/aNotApplicable`)||[];let d=t.getProperty(`dynamicActions/${o}/${r}`)||false;if(!s){t.setProperty(`dynamicActions/${o}`,{bEnabled:false,aApplicable:[],aNotApplicable:[]})}else{t.setProperty(`dynamicActions/${o}`,{bEnabled:t.getProperty(`dynamicActions/${o}/bEnabled`),aApplicable:t.getProperty(`dynamicActions/${o}/aApplicable`),aNotApplicable:t.getProperty(`dynamicActions/${o}/aNotApplicable`),bEnabledForContextMenu:false,aApplicableForContextMenu:[],aNotApplicableForContextMenu:[]})}const g=`${t.getPath()}/dynamicActions/${o}/${r}`;if(typeof i==="object"&&i!==null&&i!==undefined){if(e){const n=e.getObject();const o=u(i,"PathInModel",function(e){return n?y(n[e.path]):y(false)},true);const a=A(o);d=d||a==="true";t.getModel().setProperty(g,d);(a==="true"?l:c).push(e)}n.setDynamicActionContexts(t,o,l,c,s)}else{const s=e?.getObject();if(i===null&&!!s[`#${o}`]){t.getModel().setProperty(g,true)}else if(e!==undefined){a.push(n.requestProperty(e,o,i,g))}}return a}};return x},false);
//# sourceMappingURL=ActionRuntime.js.map