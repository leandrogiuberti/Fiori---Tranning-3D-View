{"version":3,"file":"RoutingServiceFactory.js","names":["RoutingServiceEventing","_dec","defineUI5Class","_dec2","event","_dec3","_dec4","_class","_class2","_EventProvider","_this","_len","arguments","length","args","Array","_key","call","this","_initializerDefineProperty","_descriptor","_descriptor2","_descriptor3","_inheritsLoose","EventProvider","_applyDecoratedDescriptor","prototype","configurable","enumerable","writable","initializer","RoutingService","_Service","_this2","_len2","_key2","navigationInfoQueue","enabled","bindingCleanupPromises","_exports","_proto","init","oContext","getContext","scopeType","oAppComponent","scopeObject","oModel","getModel","oMetaModel","getMetaModel","oRouter","getRouter","oRouterProxy","getRouterProxy","eventProvider","oRoutingConfig","getManifestEntry","routing","_parseRoutingConfiguration","oAppConfig","outbounds","crossNavigation","initPromise","Promise","resolve","beforeExit","detachRouteMatched","_fnOnRouteMatched","detachBeforeRouteMatched","_fnOnBeforeRouteMatched","fireEvent","exit","destroy","addBindingCleanupPromise","promise","push","waitForBindingCleanup","async","all","isFCL","config","routerClass","_mTargets","targets","sTargetName","Object","keys","assign","targetName","contextPattern","undefined","viewLevel","_getViewLevelFromPattern","routingHints","_mRoutes","routes","oRouteManifestInfo","aRouteTargets","getRouteTargetNames","target","sRouteName","name","sRoutePattern","pattern","indexOf","Log","warning","iRouteLevel","routeLevel","item","sParentTargetName","parent","routerHashKeys","RouterProxy","extractEntitySetsFromHash","split","FCLLevel","controlAggregation","forEach","aLevel0RouteNames","aLevel1RouteNames","sDefaultRouteName","sName","iLevel","sDefaultTargetName","slice","sContextPath","oSettings","options","settings","contextPath","entitySet","map","sTargetKey","sort","a","b","fullContextPath","parentOf","navigation","sNavName","targetRoute","detail","route","startsWith","sPattern","replace","regex","RegExp","match","_getRouteInformation","_getTargetInformation","_getComponentId","sOwnerId","sComponentId","substring","getTargetInformationFor","componentOrView","correctTargetName","getTargetName","targetComponentId","_sOwnerId","getId","id","viewId","getTargetNameForView","view","pageComponent","Component","getOwnerComponentFor","getLastSemanticMapping","oLastSemanticMapping","setLastSemanticMapping","oMapping","getHashFromRoute","context","routeName","parameterMapping","targetURLPromise","SemanticKeyHelper","getSemanticPath","prepareParameters","then","parameters","getURL","navigateTo","mParameterMapping","bPreserveHistory","delayedUsage","sTargetURLPromise","bIsStickyMode","ModelHelper","isStickySessionSupported","mParameters","targetUrl","navigateFunction","navToHash","sTargetRoute","oParametersPromise","getPath","aContextPathParts","aAllResolvedParameterPromises","sParameterMappingExpression","sParameterKey","oParsedExpression","BindingInfo","parse","aParts","parts","aResolvedParameterPromises","oPathPart","aRelativeParts","path","aLocalParts","localContextPath","join","localContext","bindContext","getBoundContext","oMetaContext","getMetaContext","requestProperty","oValue","oPropertyInfo","getObject","sEdmType","$Type","ODataUtils","formatLiteral","aResolvedParameters","value","formatter","apply","key","aAllResolvedParameters","oParameters","oResolvedParameter","oError","error","_fireRouteMatchEvents","EditState","cleanProcessedEditState","navigateToContext","viewData","currentTargetInfo","routeParametersPromise","isStickyMode","targetPath","navigationInfo","oRouteDetail","isA","sTargetPath","_getPathFromContext","bExitOnNavigateBackToRoot","exitFromApp","createOnNavigateParameters","sLayout","_calculateLayout","oNavigationInfo","bTargetEditable","editable","bPersistOPScroll","persistOPScroll","bShowPlaceholder","showPlaceholder","reason","redirectedToNonDraft","updateFCLLevel","recreateContext","useContext","checkNoHashChange","sCurrentHashNoAppState","getHash","routeInfoByHash","getRouteInfoByHash","mEventParameters","routeInformation","sCurrentRouteName","routePattern","sCurrentRoutePattern","views","aCurrentViews","setFocusForced","forceFocus","transient","includes","navMode","sap","ui","require","shellServiceHelper","getShellServices","parsedUrl","parseShellHash","document","location","hash","navigationService","Container","getServiceAsync","href","getHref","semanticObject","action","params","applicationUrlBasedOnIframe","getInframeUrl","url","URL","encodeURI","window","origin","pathname","openWindow","oRouteInfo","oRoute","sLastTargetName","oTarget","messageHandling","removeUnboundTransitionMessages","oRouteParameters","navTo","preserveHistory","noPreservationCache","bNavigated","pop","navigateToRoute","sTargetRouteName","sTargetURL","isCurrentStateImpactedBy","sPath","test","sSemanticPath","technicalPath","semanticPath","getPathToNavigateBack","_checkIfContextSupportsSemanticPath","metaModel","MetaModelConverter","getInvolvedDataModelObjects","targetObject","isDraftRoot","getProperty","entitySetName","getSemanticKeys","getHeaderContext","layout","findLayoutForHash","getRootViewController","calculateLayout","keepCurrentLayout","_onBeforeRouteMatched","oEvent","viewPreloaderService","getViewPreloaderService","setCache","getParameter","bPlaceholderEnabled","Placeholder","isPlaceholderEnabled","oRootView","getRootControl","BusyLocker","lock","_isNavigationTriggeredByRouterProxy","history","state","feLevel","_onRouteMatched","oAppStateHandler","getAppStateHandler","isLocked","unlock","getParameters","checkIfRouteChangedByIApp","NavigationReason","AppStateChanged","resetRouteChangedByIApp","checkRestoreHistoryWasTriggered","RestoreHistory","resetRestoreHistoryFlag","restoreHistory","resolveRouteMatch","catch","attachRouteMatched","oData","fnFunction","oListener","attachEvent","attachBeforeRouteMatched","detachEvent","attachAfterRouteMatched","detachAfterRouteMatched","initializeRouting","getEnvironmentCapabilities","getCapabilities","Collaboration","default","CollaborationHelper","__ui5_require_async","processAndExpandHash","bind","resetEditState","manageStartupMode","onRestore","bIsIappState","getHashChanger","oStartupParameters","getStartupParameters","bHasStartUpParameters","sHash","preferredMode","toUpperCase","_manageCreateStartup","_manageDeepLinkStartup","_managedPreferredModeEdit","getDefaultCreateHash","AppStartupHelper","getContextPath","getCreateStartupHash","sNewHash","replaceHash","setStartupModeAutoCreate","setStartupModeCreate","getDeepLinkStartupHash","app","inboundParameterForTargetResolution","oDeepLink","sTechnicalPath","setStartupModeDeeplink","startupParameters","resultingHash","shouldEdit","verifyEditAnnotations","parameter","getOutbounds","getRoutingHints","getInterface","Service","RoutingServiceFactory","_ServiceFactory","_proto2","createInstance","oServiceContext","oRoutingService","ServiceFactory"],"sources":["./RoutingServiceFactory.ts"],"sourcesContent":["import type { EntitySet } from \"@sap-ux/vocabularies-types/Edm\";\nimport Log from \"sap/base/Log\";\n\nimport type { Route } from \"@ui5/manifest/types/manifest\";\nimport { defineUI5Class, event } from \"sap/fe/base/ClassSupport\";\nimport type AppComponent from \"sap/fe/core/AppComponent\";\nimport type { StartupParameters } from \"sap/fe/core/AppComponent\";\nimport type { NavigationConfiguration } from \"sap/fe/core/TemplateComponent\";\nimport BusyLocker from \"sap/fe/core/controllerextensions/BusyLocker\";\nimport Placeholder from \"sap/fe/core/controllerextensions/Placeholder\";\nimport messageHandling from \"sap/fe/core/controllerextensions/messageHandler/messageHandling\";\nimport NavigationReason from \"sap/fe/core/controllerextensions/routing/NavigationReason\";\nimport RouterProxy from \"sap/fe/core/controllerextensions/routing/RouterProxy\";\nimport AppStartupHelper from \"sap/fe/core/helpers/AppStartupHelper\";\nimport EditState from \"sap/fe/core/helpers/EditState\";\nimport { getRouteTargetNames } from \"sap/fe/core/helpers/ManifestHelper\";\nimport ModelHelper from \"sap/fe/core/helpers/ModelHelper\";\nimport SemanticKeyHelper from \"sap/fe/core/helpers/SemanticKeyHelper\";\nimport BindingInfo from \"sap/ui/base/BindingInfo\";\nimport EventProvider from \"sap/ui/base/EventProvider\";\nimport type { PropertyBindingInfo } from \"sap/ui/base/ManagedObject\";\nimport Component from \"sap/ui/core/Component\";\nimport type ComponentContainer from \"sap/ui/core/ComponentContainer\";\nimport type { ManifestOutboundEntry, RoutingConfiguration, RoutingTarget } from \"sap/ui/core/Manifest\";\nimport type View from \"sap/ui/core/mvc/View\";\nimport type { Route$MatchedEventParameters } from \"sap/ui/core/routing/Route\";\nimport type Router from \"sap/ui/core/routing/Router\";\nimport type { Router$RouteMatchedEvent } from \"sap/ui/core/routing/Router\";\nimport Service from \"sap/ui/core/service/Service\";\nimport ServiceFactory from \"sap/ui/core/service/ServiceFactory\";\nimport type Context from \"sap/ui/model/odata/v4/Context\";\nimport type ODataListBinding from \"sap/ui/model/odata/v4/ODataListBinding\";\nimport type ODataMetaModel from \"sap/ui/model/odata/v4/ODataMetaModel\";\nimport type ODataModel from \"sap/ui/model/odata/v4/ODataModel\";\nimport ODataUtils from \"sap/ui/model/odata/v4/ODataUtils\";\nimport openWindow from \"sap/ui/util/openWindow\";\nimport type Container from \"sap/ushell/Container\";\nimport type Navigation from \"sap/ushell/services/Navigation\";\nimport type { ServiceContext } from \"types/metamodel_types\";\nimport * as MetaModelConverter from \"../converters/MetaModelConverter\";\n\ntype RoutingServiceSettings = {};\n@defineUI5Class(\"sap.fe.core.services.RoutingServiceEventing\")\nclass RoutingServiceEventing extends EventProvider {\n\t@event()\n\tbeforeRouteMatched!: Function;\n\n\t@event()\n\trouteMatched!: Function;\n\n\t@event()\n\tafterRouteMatched!: Function;\n}\n\nexport type RoutingEventParameters = Route$MatchedEventParameters & {\n\tnavigationInfo?: { reason?: NavigationReason };\n\trouteInformation?: unknown;\n\troutePattern?: string;\n\tconfig: { pattern?: string };\n};\n\nexport type CreateOnNavigateParameters =\n\t| { mode: \"Async\"; createContextPromise: Promise<Context> }\n\t| { mode: \"Deferred\"; listBinding: ODataListBinding; parentContext?: Context; data?: object };\n\nexport type RoutingNavigationInfo = {\n\tcreateOnNavigateParameters?: CreateOnNavigateParameters;\n\tbTargetEditable?: boolean;\n\tbPersistOPScroll?: boolean;\n\tbShowPlaceholder?: boolean;\n\tuseContext?: Context;\n\treason?: NavigationReason;\n\tredirectedToNonDraft?: string;\n\tbActionCreate?: boolean;\n};\n\nexport type RoutingNavigationParameters = {\n\tcheckNoHashChange?: boolean;\n\tcreateOnNavigateParameters?: CreateOnNavigateParameters;\n\teditable?: boolean;\n\ttransient?: boolean;\n\tpersistOPScroll?: boolean;\n\tFCLLevel?: number;\n\tupdateFCLLevel?: number;\n\tpreserveHistory?: boolean;\n\tnoPreservationCache?: boolean;\n\trecreateContext?: boolean;\n\tforceFocus?: boolean;\n\ttargetPath?: string;\n\tshowPlaceholder?: boolean;\n\treason?: NavigationReason;\n\tcallExtension?: boolean;\n\tlayout?: string;\n\tkeepCurrentLayout?: boolean;\n\tnavMode?: string;\n\tredirectedToNonDraft?: string;\n\tsemanticPath?: string | undefined;\n};\n\nexport type RoutingParameterMap = {\n\t[k: string]: unknown;\n};\n\nexport type SemanticMapping = {\n\tsemanticPath: string;\n\ttechnicalPath: string;\n};\ntype MinimalPageSetting = {\n\tcontextPath?: string;\n\tentitySet?: string;\n\tfullContextPath?: string;\n\tnavigation?: Record<string, NavigationConfiguration>;\n};\n\ntype InternalRouteDefinition = {\n\tname: string;\n\tpattern: string;\n\ttargets: string[];\n\trouteLevel: number;\n};\n\ntype ResolvedParameters = { key: string; value: unknown };\n\nexport class RoutingService extends Service<RoutingServiceSettings> {\n\toAppComponent!: AppComponent;\n\n\toModel!: ODataModel;\n\n\toMetaModel!: ODataMetaModel;\n\n\toRouter!: Router;\n\n\toRouterProxy!: RouterProxy;\n\n\teventProvider!: EventProvider;\n\n\tinitPromise!: Promise<RoutingService>;\n\n\toutbounds!: Record<string, ManifestOutboundEntry>;\n\n\t_mTargets!: Record<string, RoutingTarget>;\n\n\t_mRoutes!: Record<string, InternalRouteDefinition>;\n\n\toLastSemanticMapping?: SemanticMapping;\n\n\tbExitOnNavigateBackToRoot?: boolean;\n\n\tsCurrentRouteName?: string;\n\n\tsCurrentRoutePattern?: string;\n\n\taCurrentViews?: (View | ComponentContainer)[];\n\n\tnavigationInfoQueue: RoutingNavigationInfo[] = [];\n\n\tsContextPath!: string;\n\n\t_fnOnRouteMatched!: (ev: Router$RouteMatchedEvent) => void;\n\n\t_fnOnBeforeRouteMatched!: (ev: Router$RouteMatchedEvent) => void;\n\n\tenabled = false;\n\n\troutingHints?: Record<string, { parentOf: string[] }>;\n\n\tbindingCleanupPromises: Promise<void>[] = [];\n\n\tinit(): void {\n\t\tconst oContext = this.getContext();\n\t\tif (oContext.scopeType === \"component\") {\n\t\t\tthis.oAppComponent = oContext.scopeObject;\n\t\t\tthis.oModel = this.oAppComponent.getModel();\n\t\t\tthis.oMetaModel = this.oModel?.getMetaModel();\n\t\t\tthis.oRouter = this.oAppComponent.getRouter();\n\t\t\tthis.oRouterProxy = this.oAppComponent.getRouterProxy();\n\t\t\tthis.eventProvider = new RoutingServiceEventing();\n\n\t\t\tconst oRoutingConfig = this.oAppComponent.getManifestEntry(\"sap.ui5\").routing;\n\t\t\tthis._parseRoutingConfiguration(oRoutingConfig!);\n\n\t\t\tconst oAppConfig = this.oAppComponent.getManifestEntry(\"sap.app\");\n\t\t\tthis.outbounds = oAppConfig.crossNavigation?.outbounds ?? {};\n\t\t}\n\n\t\tthis.initPromise = Promise.resolve(this);\n\t}\n\n\tbeforeExit(): void {\n\t\tthis.enabled = false;\n\t\tthis.oRouter.detachRouteMatched(this._fnOnRouteMatched, this);\n\t\tthis.oRouter.detachBeforeRouteMatched(this._fnOnBeforeRouteMatched, this);\n\t\tthis.eventProvider.fireEvent(\"routeMatched\", {});\n\t}\n\n\texit(): void {\n\t\tthis.eventProvider.destroy();\n\t}\n\n\taddBindingCleanupPromise(promise: Promise<void>): void {\n\t\tthis.bindingCleanupPromises.push(promise);\n\t}\n\n\tasync waitForBindingCleanup(): Promise<void> {\n\t\tawait Promise.all(this.bindingCleanupPromises);\n\t\tthis.bindingCleanupPromises = [];\n\t}\n\n\t/**\n\t * Parse a manifest routing configuration for internal usage.\n\t * @param oRoutingConfig The routing configuration from the manifest\n\t */\n\t_parseRoutingConfiguration(oRoutingConfig: RoutingConfiguration): void {\n\t\tconst isFCL = oRoutingConfig?.config?.routerClass === \"sap.f.routing.Router\";\n\n\t\t// Information of targets\n\t\tthis._mTargets = {};\n\t\tif (oRoutingConfig?.targets) {\n\t\t\tfor (const sTargetName of Object.keys(oRoutingConfig.targets)) {\n\t\t\t\tthis._mTargets[sTargetName] = Object.assign({ targetName: sTargetName }, oRoutingConfig.targets[sTargetName]);\n\n\t\t\t\t// View level for FCL cases is calculated from the target pattern\n\t\t\t\tconst contextPattern = this._mTargets[sTargetName].contextPattern;\n\t\t\t\tif (contextPattern !== undefined) {\n\t\t\t\t\tthis._mTargets[sTargetName].viewLevel = this._getViewLevelFromPattern(contextPattern, 0);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\tthis.routingHints = {};\n\n\t\t// Information of routes\n\t\tthis._mRoutes = {};\n\t\tif (oRoutingConfig?.routes) {\n\t\t\tfor (const oRouteManifestInfo of oRoutingConfig.routes) {\n\t\t\t\tconst aRouteTargets = getRouteTargetNames(oRouteManifestInfo.target),\n\t\t\t\t\tsRouteName = oRouteManifestInfo.name,\n\t\t\t\t\tsRoutePattern = oRouteManifestInfo.pattern;\n\t\t\t\tif (!sRoutePattern) {\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\t\t\t\t// Check route pattern: all patterns need to end with ':?query:', that we use for parameters\n\t\t\t\tif (sRoutePattern.length < 8 || sRoutePattern.indexOf(\":?query:\") !== sRoutePattern.length - 8) {\n\t\t\t\t\tLog.warning(`Pattern for route ${sRouteName} doesn't end with ':?query:' : ${sRoutePattern}`);\n\t\t\t\t}\n\t\t\t\tconst iRouteLevel = this._getViewLevelFromPattern(sRoutePattern, 0);\n\t\t\t\tthis._mRoutes[sRouteName] = {\n\t\t\t\t\tname: sRouteName,\n\t\t\t\t\tpattern: sRoutePattern,\n\t\t\t\t\ttargets: aRouteTargets,\n\t\t\t\t\trouteLevel: iRouteLevel\n\t\t\t\t};\n\n\t\t\t\t// Add the parent targets in the list of targets for the route\n\t\t\t\tfor (const item of aRouteTargets) {\n\t\t\t\t\tconst sParentTargetName = this._mTargets[item].parent;\n\t\t\t\t\tif (sParentTargetName) {\n\t\t\t\t\t\taRouteTargets.push(sParentTargetName);\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tthis._mTargets[aRouteTargets[0]].routerHashKeys = RouterProxy.extractEntitySetsFromHash(sRoutePattern.split(\":?query:\")[0]);\n\n\t\t\t\tif (!isFCL) {\n\t\t\t\t\t// View level for non-FCL cases is calculated from the route pattern\n\t\t\t\t\tconst viewLevel = this._mTargets[aRouteTargets[0]].viewLevel;\n\t\t\t\t\tif (viewLevel === undefined || viewLevel < iRouteLevel) {\n\t\t\t\t\t\t// There are cases when different routes point to the same target. We take the\n\t\t\t\t\t\t// largest viewLevel in that case.\n\t\t\t\t\t\tthis._mTargets[aRouteTargets[0]].viewLevel = iRouteLevel;\n\t\t\t\t\t}\n\n\t\t\t\t\t// FCL level for non-FCL cases is equal to -1\n\t\t\t\t\tthis._mTargets[aRouteTargets[0]].FCLLevel = -1;\n\t\t\t\t} else if (aRouteTargets.length === 1 && this._mTargets[aRouteTargets[0]].controlAggregation !== \"beginColumnPages\") {\n\t\t\t\t\t// We're in the case where there's only 1 target for the route, and it's not in the first column\n\t\t\t\t\t// --> this is a fullscreen column after all columns in the FCL have been used\n\t\t\t\t\tthis._mTargets[aRouteTargets[0]].FCLLevel = 3;\n\t\t\t\t} else {\n\t\t\t\t\t// Other FCL cases\n\t\t\t\t\taRouteTargets.forEach((sTargetName) => {\n\t\t\t\t\t\tswitch (this._mTargets[sTargetName].controlAggregation) {\n\t\t\t\t\t\t\tcase \"beginColumnPages\":\n\t\t\t\t\t\t\t\tthis._mTargets[sTargetName].FCLLevel = 0;\n\t\t\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t\t\tcase \"midColumnPages\":\n\t\t\t\t\t\t\t\tthis._mTargets[sTargetName].FCLLevel = 1;\n\t\t\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t\t\tdefault:\n\t\t\t\t\t\t\t\tthis._mTargets[sTargetName].FCLLevel = 2;\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\t// Propagate viewLevel, contextPattern, FCLLevel and controlAggregation to parent targets\n\t\tObject.keys(this._mTargets).forEach((sTargetName: string) => {\n\t\t\tlet sParentTargetName = this._mTargets[sTargetName].parent;\n\t\t\twhile (sParentTargetName) {\n\t\t\t\tthis._mTargets[sParentTargetName].viewLevel =\n\t\t\t\t\tthis._mTargets[sParentTargetName].viewLevel || this._mTargets[sTargetName].viewLevel;\n\t\t\t\tthis._mTargets[sParentTargetName].contextPattern =\n\t\t\t\t\tthis._mTargets[sParentTargetName].contextPattern || this._mTargets[sTargetName].contextPattern;\n\t\t\t\tthis._mTargets[sParentTargetName].FCLLevel =\n\t\t\t\t\tthis._mTargets[sParentTargetName].FCLLevel || this._mTargets[sTargetName].FCLLevel;\n\t\t\t\tthis._mTargets[sParentTargetName].controlAggregation =\n\t\t\t\t\tthis._mTargets[sParentTargetName].controlAggregation || this._mTargets[sTargetName].controlAggregation;\n\t\t\t\tsTargetName = sParentTargetName;\n\t\t\t\tsParentTargetName = this._mTargets[sTargetName].parent;\n\t\t\t}\n\t\t});\n\n\t\t// Determine the root entity for the app\n\t\tconst aLevel0RouteNames = [];\n\t\tconst aLevel1RouteNames = [];\n\t\tlet sDefaultRouteName;\n\n\t\tfor (const sName in this._mRoutes) {\n\t\t\tconst iLevel = this._mRoutes[sName].routeLevel;\n\t\t\tif (iLevel === 0) {\n\t\t\t\taLevel0RouteNames.push(sName);\n\t\t\t} else if (iLevel === 1) {\n\t\t\t\taLevel1RouteNames.push(sName);\n\t\t\t}\n\t\t}\n\n\t\tif (aLevel0RouteNames.length === 1) {\n\t\t\tsDefaultRouteName = aLevel0RouteNames[0];\n\t\t} else if (aLevel1RouteNames.length === 1) {\n\t\t\tsDefaultRouteName = aLevel1RouteNames[0];\n\t\t}\n\n\t\tif (sDefaultRouteName) {\n\t\t\tconst sDefaultTargetName = this._mRoutes[sDefaultRouteName].targets.slice(-1)[0];\n\t\t\tthis.sContextPath = \"\";\n\t\t\tconst oSettings = this._mTargets[sDefaultTargetName].options?.settings as MinimalPageSetting | undefined;\n\t\t\tif (oSettings) {\n\t\t\t\tthis.sContextPath = oSettings.contextPath || `/${oSettings.entitySet}`;\n\t\t\t}\n\t\t\tif (!this.sContextPath) {\n\t\t\t\tLog.warning(\n\t\t\t\t\t`Cannot determine default contextPath: contextPath or entitySet missing in default target: ${sDefaultTargetName}`\n\t\t\t\t);\n\t\t\t}\n\t\t} else {\n\t\t\tLog.warning(\"Cannot determine default contextPath: no default route found.\");\n\t\t}\n\n\t\t// We need to establish the correct path to the different pages, including the navigation properties\n\t\tObject.keys(this._mTargets)\n\t\t\t.map((sTargetKey: string) => {\n\t\t\t\treturn this._mTargets[sTargetKey];\n\t\t\t})\n\t\t\t.sort((a: RoutingTarget, b: RoutingTarget) => {\n\t\t\t\treturn a.viewLevel !== undefined && b.viewLevel !== undefined && a.viewLevel < b.viewLevel ? -1 : 1;\n\t\t\t})\n\t\t\t.forEach((target: RoutingTarget) => {\n\t\t\t\t// After sorting the targets per level we can then go through their navigation object and update the paths accordingly.\n\t\t\t\tif (target.options) {\n\t\t\t\t\tconst settings = target.options.settings as MinimalPageSetting;\n\t\t\t\t\tconst sContextPath = settings.contextPath || (settings.entitySet ? `/${settings.entitySet}` : \"\");\n\t\t\t\t\tif (!settings.fullContextPath && sContextPath) {\n\t\t\t\t\t\tsettings.fullContextPath = `${sContextPath}/`;\n\t\t\t\t\t}\n\t\t\t\t\tconst parentOf: string[] = [];\n\t\t\t\t\tif (target.routerHashKeys?.[0]) {\n\t\t\t\t\t\tthis.routingHints![target.routerHashKeys?.[0]] = { parentOf: parentOf };\n\t\t\t\t\t}\n\t\t\t\t\tObject.keys(settings.navigation || {}).forEach((sNavName: string) => {\n\t\t\t\t\t\t// Check if it's a navigation property\n\t\t\t\t\t\tif (target.name === \"sap.fe.templates.ListReport\") {\n\t\t\t\t\t\t\tparentOf.push(sNavName);\n\t\t\t\t\t\t}\n\t\t\t\t\t\tconst targetRoute = this._mRoutes[settings.navigation![sNavName].detail?.route];\n\n\t\t\t\t\t\tif (targetRoute && targetRoute.targets) {\n\t\t\t\t\t\t\ttargetRoute.targets.forEach((sTargetName: string) => {\n\t\t\t\t\t\t\t\tif (\n\t\t\t\t\t\t\t\t\tthis._mTargets[sTargetName].options?.settings &&\n\t\t\t\t\t\t\t\t\t!this._mTargets[sTargetName].options?.settings?.fullContextPath\n\t\t\t\t\t\t\t\t) {\n\t\t\t\t\t\t\t\t\tif (this._mTargets[sTargetName].options!.settings!.contextPath) {\n\t\t\t\t\t\t\t\t\t\tthis._mTargets[sTargetName].options!.settings!.fullContextPath =\n\t\t\t\t\t\t\t\t\t\t\tthis._mTargets[sTargetName].options!.settings!.contextPath + \"/\";\n\t\t\t\t\t\t\t\t\t} else if (target.viewLevel === 0) {\n\t\t\t\t\t\t\t\t\t\tthis._mTargets[sTargetName].options!.settings!.fullContextPath = `${\n\t\t\t\t\t\t\t\t\t\t\t(sNavName.startsWith(\"/\") ? \"\" : \"/\") + sNavName\n\t\t\t\t\t\t\t\t\t\t}/`;\n\t\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\t\tthis._mTargets[sTargetName].options!.settings!.fullContextPath = `${\n\t\t\t\t\t\t\t\t\t\t\tsettings.fullContextPath + sNavName\n\t\t\t\t\t\t\t\t\t\t}/`;\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t});\n\t}\n\n\t/**\n\t * Calculates a view level from a pattern by counting the number of segments.\n\t * @param sPattern The pattern\n\t * @param viewLevel The current level of view\n\t * @returns The level\n\t */\n\t_getViewLevelFromPattern(sPattern: string, viewLevel: number): number {\n\t\tsPattern = sPattern.replace(\":?query:\", \"\");\n\t\tconst regex = new RegExp(\"/[^/]*$\");\n\t\tif (sPattern && sPattern[0] !== \"/\" && sPattern[0] !== \"?\") {\n\t\t\tsPattern = `/${sPattern}`;\n\t\t}\n\t\tif (sPattern.length) {\n\t\t\tsPattern = sPattern.replace(regex, \"\");\n\t\t\tif (this.oRouter.match(sPattern) || sPattern === \"\") {\n\t\t\t\treturn this._getViewLevelFromPattern(sPattern, ++viewLevel);\n\t\t\t} else {\n\t\t\t\treturn this._getViewLevelFromPattern(sPattern, viewLevel);\n\t\t\t}\n\t\t} else {\n\t\t\treturn viewLevel;\n\t\t}\n\t}\n\n\t_getRouteInformation(sRouteName?: string): InternalRouteDefinition | undefined {\n\t\tif (sRouteName === undefined) {\n\t\t\treturn undefined;\n\t\t}\n\t\treturn this._mRoutes[sRouteName];\n\t}\n\n\t_getTargetInformation(sTargetName?: string): RoutingTarget | undefined {\n\t\tif (sTargetName === undefined) {\n\t\t\treturn undefined;\n\t\t}\n\t\treturn this._mTargets[sTargetName];\n\t}\n\n\t_getComponentId(sOwnerId: string, sComponentId: string): string {\n\t\tif (sComponentId.indexOf(`${sOwnerId}---`) === 0) {\n\t\t\treturn sComponentId.substring(sOwnerId.length + 3);\n\t\t}\n\t\treturn sComponentId;\n\t}\n\n\t/**\n\t * Get target information for a given component.\n\t * @param componentOrView Instance of the component or view\n\t * @returns The configuration for the target\n\t */\n\tgetTargetInformationFor(componentOrView: Component | View): RoutingTarget | undefined {\n\t\tconst correctTargetName = this.getTargetName(componentOrView);\n\t\treturn this._getTargetInformation(correctTargetName);\n\t}\n\n\t/**\n\t * Get the name of the page shown in the view as defined in the manifest routing section.\n\t * @param componentOrView\n\t * @returns The name of the page\n\t */\n\tgetTargetName(componentOrView: Component | View): string | undefined {\n\t\tconst targetComponentId = this._getComponentId(\n\t\t\t(componentOrView as unknown as { _sOwnerId: string })._sOwnerId,\n\t\t\tcomponentOrView.getId()\n\t\t);\n\t\tlet correctTargetName: string | undefined;\n\t\tObject.keys(this._mTargets).forEach((targetName: string) => {\n\t\t\tif (this._mTargets[targetName].id === targetComponentId || this._mTargets[targetName].viewId === targetComponentId) {\n\t\t\t\tcorrectTargetName = targetName;\n\t\t\t}\n\t\t});\n\t\treturn correctTargetName;\n\t}\n\n\t/**\n\t * Get the name of the page shown in the view as defined in the manifest routing section.\n\t * @param view\n\t * @returns The name of the page\n\t */\n\tgetTargetNameForView(view: View): string | undefined {\n\t\tconst pageComponent = Component.getOwnerComponentFor(view);\n\t\tlet targetName = pageComponent ? this.getTargetName(pageComponent) : undefined;\n\t\tif (!targetName) {\n\t\t\ttargetName = this.getTargetName(view);\n\t\t}\n\t\treturn targetName;\n\t}\n\n\tgetLastSemanticMapping(): SemanticMapping | undefined {\n\t\treturn this.oLastSemanticMapping;\n\t}\n\n\tsetLastSemanticMapping(oMapping?: SemanticMapping): void {\n\t\tthis.oLastSemanticMapping = oMapping;\n\t}\n\n\tasync getHashFromRoute(context: Context, routeName: string | null, parameterMapping?: unknown): Promise<string> {\n\t\tif (!this.enabled) {\n\t\t\treturn Promise.resolve(\"\");\n\t\t}\n\t\tlet targetURLPromise: Promise<string | undefined>;\n\t\tif (!parameterMapping) {\n\t\t\t// if there is no parameter mapping define this mean we rely entirely on the binding context path\n\t\t\ttargetURLPromise = Promise.resolve(SemanticKeyHelper.getSemanticPath(context));\n\t\t} else {\n\t\t\ttargetURLPromise = this.prepareParameters(parameterMapping as RoutingParameterMap, routeName, context).then(\n\t\t\t\t(parameters: object | undefined) => {\n\t\t\t\t\treturn this.oRouter.getURL(routeName!, parameters);\n\t\t\t\t}\n\t\t\t);\n\t\t}\n\t\treturn (await targetURLPromise) as string;\n\t}\n\n\tasync navigateTo(\n\t\toContext: Context,\n\t\tsRouteName: string | null,\n\t\tmParameterMapping: unknown,\n\t\tbPreserveHistory?: boolean,\n\t\tdelayedUsage?: false\n\t): Promise<void>;\n\n\tasync navigateTo(\n\t\toContext: Context,\n\t\tsRouteName: string | null,\n\t\tmParameterMapping: unknown,\n\t\tbPreserveHistory?: boolean,\n\t\tdelayedUsage?: true\n\t): Promise<() => void>;\n\n\tasync navigateTo(\n\t\toContext: Context,\n\t\tsRouteName: string | null,\n\t\tmParameterMapping: unknown,\n\t\tbPreserveHistory?: boolean,\n\t\tdelayedUsage?: boolean\n\t): Promise<(() => void) | void>;\n\n\tasync navigateTo(\n\t\toContext: Context,\n\t\tsRouteName: string | null,\n\t\tmParameterMapping: unknown,\n\t\tbPreserveHistory?: boolean,\n\t\tdelayedUsage?: boolean\n\t): Promise<(() => void) | void> {\n\t\tif (!this.enabled) {\n\t\t\treturn Promise.resolve();\n\t\t}\n\t\tlet sTargetURLPromise, bIsStickyMode: boolean;\n\t\tif (oContext.getModel() && oContext.getModel().getMetaModel && oContext.getModel().getMetaModel()) {\n\t\t\tbIsStickyMode = ModelHelper.isStickySessionSupported(oContext.getModel().getMetaModel());\n\t\t}\n\t\tif (!mParameterMapping) {\n\t\t\t// if there is no parameter mapping define this mean we rely entirely on the binding context path\n\t\t\tsTargetURLPromise = Promise.resolve(SemanticKeyHelper.getSemanticPath(oContext));\n\t\t} else {\n\t\t\tsTargetURLPromise = this.prepareParameters(mParameterMapping as RoutingParameterMap, sRouteName, oContext).then(\n\t\t\t\t(mParameters: object | undefined) => {\n\t\t\t\t\treturn this.oRouter.getURL(sRouteName!, mParameters);\n\t\t\t\t}\n\t\t\t);\n\t\t}\n\t\tconst targetUrl = await sTargetURLPromise;\n\t\tconst navigateFunction = (): void => {\n\t\t\tthis.oRouterProxy.navToHash(targetUrl!, bPreserveHistory, false, false, !bIsStickyMode);\n\t\t};\n\t\tif (delayedUsage === true) {\n\t\t\treturn navigateFunction; // wrong but somehow the types are annoying\n\t\t} else {\n\t\t\treturn navigateFunction();\n\t\t}\n\t}\n\n\t/**\n\t * Method to return a map of routing target parameters where the binding syntax is resolved to the current model.\n\t * @param mParameters Parameters map in the format [k: string] : ComplexBindingSyntax\n\t * @param sTargetRoute Name of the target route\n\t * @param oContext The instance of the binding context\n\t * @returns A promise which resolves to the routing target parameters\n\t */\n\tasync prepareParameters(mParameters: RoutingParameterMap, sTargetRoute: string | null, oContext: Context): Promise<object> {\n\t\tlet oParametersPromise;\n\t\ttry {\n\t\t\tconst sContextPath = oContext.getPath();\n\t\t\tconst oMetaModel: ODataMetaModel = oContext.getModel().getMetaModel();\n\t\t\tconst aContextPathParts = sContextPath.split(\"/\");\n\t\t\tconst aAllResolvedParameterPromises = Object.keys(mParameters).map(async (sParameterKey: string) => {\n\t\t\t\tconst sParameterMappingExpression = mParameters[sParameterKey];\n\t\t\t\t// We assume the defined parameters will be compatible with a binding expression\n\t\t\t\tconst oParsedExpression = BindingInfo.parse(sParameterMappingExpression);\n\t\t\t\tconst aParts = oParsedExpression.parts || [oParsedExpression];\n\t\t\t\tconst aResolvedParameterPromises = aParts.map(async function (oPathPart: PropertyBindingInfo) {\n\t\t\t\t\tconst aRelativeParts = oPathPart.path.split(\"../\");\n\t\t\t\t\t// We go up the current context path as many times as necessary\n\t\t\t\t\tconst aLocalParts = aContextPathParts.slice(0, aContextPathParts.length - aRelativeParts.length + 1);\n\t\t\t\t\tconst localContextPath = aLocalParts.join(\"/\");\n\t\t\t\t\tconst localContext =\n\t\t\t\t\t\tlocalContextPath === oContext.getPath()\n\t\t\t\t\t\t\t? oContext\n\t\t\t\t\t\t\t: oContext.getModel().bindContext(localContextPath).getBoundContext();\n\n\t\t\t\t\tconst oMetaContext = oMetaModel.getMetaContext(localContextPath + \"/\" + aRelativeParts[aRelativeParts.length - 1]);\n\t\t\t\t\treturn localContext.requestProperty(aRelativeParts[aRelativeParts.length - 1]).then(function (oValue) {\n\t\t\t\t\t\tconst oPropertyInfo = oMetaContext.getObject();\n\t\t\t\t\t\tconst sEdmType = oPropertyInfo.$Type;\n\t\t\t\t\t\treturn ODataUtils.formatLiteral(oValue, sEdmType);\n\t\t\t\t\t});\n\t\t\t\t});\n\n\t\t\t\treturn Promise.all(aResolvedParameterPromises).then((aResolvedParameters: PropertyBindingInfo) => {\n\t\t\t\t\tconst value = oParsedExpression.formatter\n\t\t\t\t\t\t? oParsedExpression.formatter.apply(this, aResolvedParameters)\n\t\t\t\t\t\t: aResolvedParameters.join(\"\");\n\t\t\t\t\treturn { key: sParameterKey, value: value };\n\t\t\t\t});\n\t\t\t});\n\n\t\t\toParametersPromise = Promise.all(aAllResolvedParameterPromises).then(function (aAllResolvedParameters: ResolvedParameters[]) {\n\t\t\t\tconst oParameters: Record<string, unknown> = {};\n\t\t\t\taAllResolvedParameters.forEach(function (oResolvedParameter: ResolvedParameters) {\n\t\t\t\t\toParameters[oResolvedParameter.key] = oResolvedParameter.value;\n\t\t\t\t});\n\t\t\t\treturn oParameters;\n\t\t\t});\n\t\t} catch (oError) {\n\t\t\tLog.error(`Could not parse the parameters for the navigation to route ${sTargetRoute}`);\n\t\t\toParametersPromise = Promise.resolve({});\n\t\t}\n\t\treturn oParametersPromise;\n\t}\n\n\t_fireRouteMatchEvents(mParameters: Route$MatchedEventParameters): void {\n\t\tthis.bindingCleanupPromises = [];\n\t\tthis.eventProvider.fireEvent(\"beforeRouteMatched\", mParameters);\n\t\tthis.eventProvider.fireEvent(\"routeMatched\", mParameters);\n\t\tthis.eventProvider.fireEvent(\"afterRouteMatched\", mParameters);\n\n\t\tEditState.cleanProcessedEditState(); // Reset UI state when all bindings have been refreshed\n\t}\n\n\t/**\n\t * Navigates to a context.\n\t * @param context The Context to be navigated to, or the list binding for creation (deferred creation)\n\t * @param [parameters] Optional, map containing the following attributes:\n\t * @param [parameters.checkNoHashChange] Navigate to the context without changing the URL\n\t * @param [parameters.asyncContext] The context is created async, navigate to (...) and\n\t *                    wait for Promise to be resolved and then navigate into the context\n\t * @param [parameters.bDeferredContext] The context shall be created deferred at the target page\n\t * @param [parameters.editable] The target page shall be immediately in the edit mode to avoid flickering\n\t * @param [parameters.bPersistOPScroll] The bPersistOPScroll will be used for scrolling to first tab\n\t * @param [parameters.updateFCLLevel] `+1` if we add a column in FCL, `-1` to remove a column, 0 to stay on the same column\n\t * @param [parameters.noPreservationCache] Do navigation without taking into account the preserved cache mechanism\n\t * @param [parameters.bRecreateContext] Force re-creation of the context instead of using the one passed as parameter\n\t * @param [parameters.bForceFocus] Forces focus selection after navigation\n\t * @param [viewData] View data\n\t * @param [viewData.navigation]\n\t * @param [currentTargetInfo] The target information from which the navigation is triggered\n\t * @param [currentTargetInfo.name]\n\t * @returns Promise which is resolved once the navigation is triggered\n\t * @final\n\t */\n\tasync navigateToContext(\n\t\tcontext: Context | ODataListBinding,\n\t\tparameters: RoutingNavigationParameters = {},\n\t\tviewData?: { navigation?: object },\n\t\tcurrentTargetInfo?: { name: string }\n\t): Promise<boolean> {\n\t\tif (!this.enabled) {\n\t\t\treturn Promise.resolve(false);\n\t\t}\n\n\t\tlet targetRoute = \"\";\n\t\tlet routeParametersPromise: Promise<object> | undefined;\n\t\tconst isStickyMode = ModelHelper.isStickySessionSupported(this.oMetaModel);\n\n\t\t// Manage parameter mapping\n\t\tif (parameters?.targetPath && viewData?.navigation) {\n\t\t\tconst navigationInfo = viewData.navigation as Record<string, { detail: { route: string; parameters: object } }>;\n\t\t\tconst oRouteDetail = navigationInfo[parameters.targetPath].detail;\n\t\t\ttargetRoute = oRouteDetail.route;\n\n\t\t\tif (oRouteDetail.parameters && context.isA<Context>(\"sap.ui.model.odata.v4.Context\")) {\n\t\t\t\trouteParametersPromise = this.prepareParameters(\n\t\t\t\t\toRouteDetail.parameters as unknown as RoutingParameterMap,\n\t\t\t\t\ttargetRoute,\n\t\t\t\t\tcontext\n\t\t\t\t);\n\t\t\t}\n\t\t}\n\n\t\tlet sTargetPath = this._getPathFromContext(context, parameters);\n\t\t// If the path is empty, we're supposed to navigate to the first page of the app\n\t\t// Check if we need to exit from the app instead\n\t\tif (sTargetPath.length === 0 && this.bExitOnNavigateBackToRoot) {\n\t\t\tthis.oRouterProxy.exitFromApp();\n\t\t\treturn Promise.resolve(true);\n\t\t}\n\n\t\t// If the navigation goes with a creation, we add (...) to the path (expecting context is an ODataListBinding)\n\t\tif (parameters?.createOnNavigateParameters) {\n\t\t\tsTargetPath += \"(...)\";\n\t\t}\n\n\t\t// Add layout parameter if needed\n\t\tconst sLayout = this._calculateLayout(sTargetPath, parameters);\n\t\tif (sLayout) {\n\t\t\tsTargetPath += `?layout=${sLayout}`;\n\t\t}\n\n\t\t// Navigation parameters for later usage\n\t\tconst oNavigationInfo: RoutingNavigationInfo = {\n\t\t\tcreateOnNavigateParameters: parameters.createOnNavigateParameters,\n\t\t\tbTargetEditable: parameters?.editable,\n\t\t\tbPersistOPScroll: parameters?.persistOPScroll,\n\t\t\tbShowPlaceholder: parameters?.showPlaceholder !== undefined ? parameters?.showPlaceholder : true,\n\t\t\treason: parameters?.reason,\n\t\t\tredirectedToNonDraft: parameters.redirectedToNonDraft\n\t\t};\n\n\t\tif (parameters?.updateFCLLevel !== -1 && parameters?.recreateContext !== true) {\n\t\t\tif (context.isA<Context>(\"sap.ui.model.odata.v4.Context\")) {\n\t\t\t\toNavigationInfo.useContext = context;\n\t\t\t}\n\t\t}\n\n\t\tif (parameters?.checkNoHashChange) {\n\t\t\t// Check if the new hash is different from the current one\n\t\t\tconst sCurrentHashNoAppState = this.oRouterProxy.getHash().replace(/[&?]{1}sap-iapp-state=[A-Z0-9]+/, \"\");\n\t\t\tif (sTargetPath === sCurrentHashNoAppState) {\n\t\t\t\t// The hash doesn't change, but we fire the routeMatch event to trigger page refresh / binding\n\t\t\t\tconst routeInfoByHash = this.oRouter.getRouteInfoByHash(this.oRouterProxy.getHash());\n\t\t\t\tlet mEventParameters: RoutingEventParameters = { config: {} };\n\t\t\t\tif (routeInfoByHash) {\n\t\t\t\t\tmEventParameters = { ...routeInfoByHash, config: {} };\n\t\t\t\t\tmEventParameters.navigationInfo = oNavigationInfo;\n\t\t\t\t\tmEventParameters.routeInformation = this._getRouteInformation(this.sCurrentRouteName);\n\t\t\t\t\tmEventParameters.routePattern = this.sCurrentRoutePattern;\n\t\t\t\t\tmEventParameters.views = this.aCurrentViews;\n\t\t\t\t}\n\n\t\t\t\tthis.oRouterProxy.setFocusForced(!!parameters.forceFocus);\n\n\t\t\t\tthis._fireRouteMatchEvents(mEventParameters);\n\n\t\t\t\treturn Promise.resolve(true);\n\t\t\t}\n\t\t}\n\n\t\tif (parameters?.transient && !!parameters.editable && !sTargetPath.includes(\"(...)\")) {\n\t\t\tif (sTargetPath.includes(\"?\")) {\n\t\t\t\tsTargetPath += \"&i-action=create\";\n\t\t\t} else {\n\t\t\t\tsTargetPath += \"?i-action=create\";\n\t\t\t}\n\t\t}\n\n\t\tif (parameters.navMode === \"openInNewTab\") {\n\t\t\t// Navigate to new tab/ window\n\t\t\tsap.ui.require([\"sap/ushell/Container\"], async (Container: Container) => {\n\t\t\t\tconst shellServiceHelper = this.oAppComponent.getShellServices();\n\t\t\t\tconst parsedUrl = shellServiceHelper.parseShellHash(document.location.hash);\n\t\t\t\tconst navigationService = (await Container.getServiceAsync(\"Navigation\")) as Navigation;\n\t\t\t\tconst href = await navigationService.getHref({\n\t\t\t\t\ttarget: {\n\t\t\t\t\t\tsemanticObject: parsedUrl.semanticObject,\n\t\t\t\t\t\taction: parsedUrl.action\n\t\t\t\t\t},\n\t\t\t\t\tparams: parsedUrl.params\n\t\t\t\t});\n\t\t\t\tconst applicationUrlBasedOnIframe = await shellServiceHelper.getInframeUrl();\n\t\t\t\tlet url, targetUrl: string;\n\t\t\t\tif (applicationUrlBasedOnIframe) {\n\t\t\t\t\turl = new URL(applicationUrlBasedOnIframe);\n\t\t\t\t\ttargetUrl = applicationUrlBasedOnIframe.replace(url.hash, `${href}&/${encodeURI(sTargetPath)}`);\n\t\t\t\t} else {\n\t\t\t\t\turl = new URL(window.location.href);\n\t\t\t\t\ttargetUrl = `${url.origin}${url.pathname}${href}&/${encodeURI(sTargetPath)}`;\n\t\t\t\t}\n\t\t\t\topenWindow(targetUrl);\n\t\t\t});\n\t\t\treturn Promise.resolve(true);\n\t\t} else {\n\t\t\t// Clear unbound messages upon navigating from LR to OP\n\t\t\t// This is to ensure stale error messages from LR are not shown to the user after navigation to OP.\n\t\t\tif (currentTargetInfo?.name === \"sap.fe.templates.ListReport\") {\n\t\t\t\tconst oRouteInfo = this.oRouter.getRouteInfoByHash(sTargetPath);\n\t\t\t\tif (oRouteInfo) {\n\t\t\t\t\tconst oRoute = this._getRouteInformation(oRouteInfo.name);\n\t\t\t\t\tif (oRoute && oRoute.targets && oRoute.targets.length > 0) {\n\t\t\t\t\t\tconst sLastTargetName = oRoute.targets[oRoute.targets.length - 1];\n\t\t\t\t\t\tconst oTarget = this._getTargetInformation(sLastTargetName);\n\t\t\t\t\t\tif (oTarget && oTarget.name === \"sap.fe.templates.ObjectPage\") {\n\t\t\t\t\t\t\tmessageHandling.removeUnboundTransitionMessages();\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// Add the navigation parameters in the queue\n\t\t\tthis.navigationInfoQueue.push(oNavigationInfo);\n\n\t\t\tif (targetRoute && routeParametersPromise) {\n\t\t\t\treturn routeParametersPromise.then((oRouteParameters: object) => {\n\t\t\t\t\tObject.assign(oRouteParameters, { bIsStickyMode: isStickyMode });\n\t\t\t\t\tthis.oRouter.navTo(targetRoute, oRouteParameters);\n\t\t\t\t\treturn true;\n\t\t\t\t});\n\t\t\t}\n\t\t\treturn this.oRouterProxy\n\t\t\t\t.navToHash(\n\t\t\t\t\tsTargetPath,\n\t\t\t\t\t!!parameters.preserveHistory,\n\t\t\t\t\tparameters?.noPreservationCache,\n\t\t\t\t\tparameters?.forceFocus,\n\t\t\t\t\t!isStickyMode\n\t\t\t\t)\n\t\t\t\t.then((bNavigated) => {\n\t\t\t\t\tif (!bNavigated) {\n\t\t\t\t\t\t// The navigation did not happen --> remove the navigation parameters from the queue as they shouldn't be used\n\t\t\t\t\t\tthis.navigationInfoQueue.pop();\n\t\t\t\t\t}\n\t\t\t\t\treturn bNavigated;\n\t\t\t\t});\n\t\t}\n\t}\n\n\t/**\n\t * Navigates to a route.\n\t * @param sTargetRouteName Name of the target route\n\t * @param [oRouteParameters] Parameters to be used with route to create the target hash\n\t * @param oRouteParameters.bIsStickyMode\n\t * @param oRouteParameters.preserveHistory\n\t * @returns Promise that is resolved when the navigation is finalized\n\t * @final\n\t */\n\tasync navigateToRoute(\n\t\tsTargetRouteName: string,\n\t\toRouteParameters?: { bIsStickyMode?: boolean; preserveHistory?: boolean }\n\t): Promise<boolean> {\n\t\tif (!this.enabled) {\n\t\t\treturn Promise.resolve(false);\n\t\t}\n\t\tthis.setLastSemanticMapping(undefined);\n\t\tconst sTargetURL = this.oRouter.getURL(sTargetRouteName, oRouteParameters);\n\t\treturn this.oRouterProxy.navToHash(\n\t\t\tsTargetURL!,\n\t\t\t!!oRouteParameters?.preserveHistory,\n\t\t\tundefined,\n\t\t\tundefined,\n\t\t\t!oRouteParameters?.bIsStickyMode\n\t\t);\n\t}\n\n\t/**\n\t * Checks if one of the current views on the screen is bound to a given context.\n\t * @param oContext The context\n\t * @returns `true` or `false` if the current state is impacted or not\n\t */\n\tisCurrentStateImpactedBy(oContext: Context): boolean {\n\t\tconst sPath = oContext.getPath();\n\n\t\t// First, check with the technical path. We have to try it, because for level > 1, we\n\t\t// uses technical keys even if Semantic keys are enabled\n\t\tif (this.oRouterProxy.isCurrentStateImpactedBy(sPath)) {\n\t\t\treturn true;\n\t\t} else if (/^[^()]+\\([^()]+\\)$/.test(sPath)) {\n\t\t\t// If the current path can be semantic (i.e. is like xxx(yyy))\n\t\t\t// check with the semantic path if we can find it\n\t\t\tlet sSemanticPath;\n\t\t\tif (this.oLastSemanticMapping && this.oLastSemanticMapping.technicalPath === sPath) {\n\t\t\t\t// We have already resolved this semantic path\n\t\t\t\tsSemanticPath = this.oLastSemanticMapping.semanticPath;\n\t\t\t} else {\n\t\t\t\tsSemanticPath = SemanticKeyHelper.getSemanticPath(oContext)!;\n\t\t\t}\n\n\t\t\treturn sSemanticPath != sPath ? this.oRouterProxy.isCurrentStateImpactedBy(sSemanticPath) : false;\n\t\t} else {\n\t\t\treturn false;\n\t\t}\n\t}\n\n\t/**\n\t * Returns the path used to navigate back from a specified path.\n\t * @param sPath\n\t * @returns The path\n\t */\n\tgetPathToNavigateBack(sPath: string): string {\n\t\tconst regex = new RegExp(\"/[^/]*$\");\n\t\tsPath = sPath.replace(regex, \"\");\n\t\tif (this.oRouter.match(sPath) || sPath === \"\") {\n\t\t\treturn sPath;\n\t\t} else {\n\t\t\treturn this.getPathToNavigateBack(sPath);\n\t\t}\n\t}\n\n\t/**\n\t * Checks if a semantic path shall be used to navigate to a given context.\n\t * @param context The context to navigate to\n\t * @returns True if semantic path shall be sued, false otherwise\n\t */\n\t_checkIfContextSupportsSemanticPath(context: Context): boolean {\n\t\t// First, check if this is a level-1 object (path = /aaa(bbb))\n\t\tif (!/^\\/[^(]+\\([^)]+\\)$/.test(context.getPath())) {\n\t\t\treturn false;\n\t\t}\n\n\t\t// Then check if the entity is a draft root\n\t\tconst metaModel = context.getModel().getMetaModel();\n\t\tconst entitySet = MetaModelConverter.getInvolvedDataModelObjects(metaModel.getMetaContext(context.getPath()))\n\t\t\t.targetObject as EntitySet;\n\n\t\tif (!ModelHelper.isDraftRoot(entitySet)) {\n\t\t\treturn false;\n\t\t}\n\n\t\t// We don't support semantic path for newly created objects\n\t\tif (context.getProperty(\"IsActiveEntity\") === false && context.getProperty(\"HasActiveEntity\") === false) {\n\t\t\treturn false;\n\t\t}\n\n\t\t// Finally, check if the entity has semantic keys\n\t\tconst entitySetName = entitySet.name;\n\t\treturn SemanticKeyHelper.getSemanticKeys(metaModel, entitySetName) !== undefined;\n\t}\n\n\t_getPathFromContext(context: Context | ODataListBinding, parameters: RoutingNavigationParameters): string {\n\t\tlet sPath = \"\";\n\n\t\tif (context.isA<ODataListBinding>(\"sap.ui.model.odata.v4.ODataListBinding\")) {\n\t\t\tsPath = context.getHeaderContext()?.getPath() ?? \"\";\n\t\t} else {\n\t\t\tsPath = context.getPath();\n\n\t\t\tif (parameters.updateFCLLevel === -1) {\n\t\t\t\t// When navigating back from a context, we need to remove the last component of the path\n\t\t\t\tsPath = this.getPathToNavigateBack(sPath);\n\n\t\t\t\t// Check if we're navigating back to a semantic path that was previously resolved\n\t\t\t\tif (this.oLastSemanticMapping?.technicalPath === sPath) {\n\t\t\t\t\tsPath = this.oLastSemanticMapping.semanticPath;\n\t\t\t\t}\n\t\t\t} else if (this._checkIfContextSupportsSemanticPath(context)) {\n\t\t\t\t// We check if we have to use a semantic path\n\t\t\t\tconst sSemanticPath = parameters.semanticPath ? parameters.semanticPath : SemanticKeyHelper.getSemanticPath(context, true);\n\n\t\t\t\tif (!sSemanticPath) {\n\t\t\t\t\t// We were not able to build the semantic path --> Use the technical path and\n\t\t\t\t\t// clear the previous mapping, otherwise the old mapping is used in EditFlow#updateDocument\n\t\t\t\t\t// and it leads to unwanted page reloads\n\t\t\t\t\tthis.setLastSemanticMapping(undefined);\n\t\t\t\t} else if (sSemanticPath !== sPath) {\n\t\t\t\t\t// Store the mapping technical <-> semantic path and use semantic path\n\t\t\t\t\tthis.setLastSemanticMapping({ technicalPath: sPath, semanticPath: sSemanticPath });\n\t\t\t\t\tsPath = sSemanticPath;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\t// remove extra '/' at the beginning of path\n\t\tif (sPath[0] === \"/\") {\n\t\t\tsPath = sPath.substring(1);\n\t\t}\n\n\t\treturn sPath;\n\t}\n\n\t_calculateLayout(hash: string, parameters: RoutingNavigationParameters): string {\n\t\t// Open in full screen mode when opening in new tab/ window\n\t\tif (parameters.navMode === \"openInNewTab\" && parameters.FCLLevel !== -1) {\n\t\t\treturn parameters.FCLLevel === 0 ? \"MidColumnFullScreen\" : \"EndColumnFullScreen\";\n\t\t}\n\t\tlet FCLLevel = parameters.FCLLevel ?? 0;\n\t\tif (parameters.updateFCLLevel) {\n\t\t\tFCLLevel += parameters.updateFCLLevel;\n\t\t\tif (FCLLevel < 0) {\n\t\t\t\tFCLLevel = 0;\n\t\t\t}\n\t\t}\n\n\t\t// When navigating back, try to find the layout in the navigation history if it's not provided as parameter\n\t\t// (layout calculation is not handled properly by the FlexibleColumnLayoutSemanticHelper in this case)\n\t\tif (parameters.updateFCLLevel !== undefined && parameters.updateFCLLevel < 0 && !parameters.layout) {\n\t\t\tparameters.layout = this.oRouterProxy.findLayoutForHash(hash);\n\t\t}\n\n\t\treturn this.oAppComponent.getRootViewController().calculateLayout(FCLLevel, hash, parameters.layout, parameters.keepCurrentLayout);\n\t}\n\n\t/**\n\t * Event handler before a route is matched.\n\t *\n\t */\n\t_onBeforeRouteMatched(oEvent: Router$RouteMatchedEvent): void {\n\t\tconst viewPreloaderService = this.oAppComponent.getViewPreloaderService();\n\t\tviewPreloaderService.setCache(\n\t\t\toEvent.getParameter(\"config\") as Route,\n\t\t\toEvent.getParameter(\"arguments\") as Record<string, string | object>,\n\t\t\tthis.oAppComponent\n\t\t);\n\n\t\tconst bPlaceholderEnabled = new Placeholder().isPlaceholderEnabled();\n\t\tif (!bPlaceholderEnabled) {\n\t\t\tconst oRootView = this.oAppComponent.getRootControl();\n\t\t\tBusyLocker.lock(oRootView);\n\t\t}\n\t}\n\n\t/**\n\t * Checks if the current navigation has been triggered by the RouterProxy.\n\t * @returns True if the current navigation has been triggered by the RouterProxy.\n\t */\n\t_isNavigationTriggeredByRouterProxy(): boolean {\n\t\t// The RouterProxy sets a 'feLevel' property on the history.state object\n\t\treturn history.state?.feLevel !== undefined;\n\t}\n\n\t/**\n\t * Event handler when a route is matched.\n\t * Hides the busy indicator and fires its own 'routematched' event.\n\t * @param oEvent The event\n\t */\n\t_onRouteMatched(oEvent: Router$RouteMatchedEvent): void {\n\t\tconst oAppStateHandler = this.oAppComponent.getAppStateHandler(),\n\t\t\toRootView = this.oAppComponent.getRootControl();\n\t\tconst bPlaceholderEnabled = new Placeholder().isPlaceholderEnabled();\n\t\tif (BusyLocker.isLocked(oRootView) && !bPlaceholderEnabled) {\n\t\t\tBusyLocker.unlock(oRootView);\n\t\t}\n\t\tconst mParameters: RoutingEventParameters = oEvent.getParameters() as RoutingEventParameters;\n\t\tif (this.navigationInfoQueue.length) {\n\t\t\tmParameters.navigationInfo = this.navigationInfoQueue[0];\n\t\t\tthis.navigationInfoQueue = this.navigationInfoQueue.slice(1);\n\t\t} else {\n\t\t\tmParameters.navigationInfo = {};\n\t\t}\n\t\tif (oAppStateHandler.checkIfRouteChangedByIApp()) {\n\t\t\tmParameters.navigationInfo.reason = NavigationReason.AppStateChanged;\n\t\t\toAppStateHandler.resetRouteChangedByIApp();\n\t\t} else if (this.oRouterProxy.checkRestoreHistoryWasTriggered()) {\n\t\t\tmParameters.navigationInfo.reason = NavigationReason.RestoreHistory;\n\t\t\tthis.oRouterProxy.resetRestoreHistoryFlag();\n\t\t}\n\n\t\tthis.sCurrentRouteName = oEvent.getParameter(\"name\");\n\t\tthis.sCurrentRoutePattern = mParameters.config.pattern;\n\t\tthis.aCurrentViews = oEvent.getParameter(\"views\");\n\n\t\tmParameters.routeInformation = this._getRouteInformation(this.sCurrentRouteName);\n\t\tmParameters.routePattern = this.sCurrentRoutePattern;\n\n\t\tthis._fireRouteMatchEvents(mParameters);\n\n\t\t// Check if current hash has been set by the routerProxy.navToHash function\n\t\t// If not, rebuild history properly (both in the browser and the RouterProxy)\n\t\tif (!this._isNavigationTriggeredByRouterProxy()) {\n\t\t\tthis.oRouterProxy\n\t\t\t\t.restoreHistory()\n\t\t\t\t.then((): void => {\n\t\t\t\t\tthis.oRouterProxy.resolveRouteMatch();\n\t\t\t\t\treturn;\n\t\t\t\t})\n\t\t\t\t.catch(function (oError: unknown) {\n\t\t\t\t\tLog.error(\"Error while restoring history\", oError as string);\n\t\t\t\t});\n\t\t} else {\n\t\t\tthis.oRouterProxy.resolveRouteMatch();\n\t\t}\n\t}\n\n\tattachRouteMatched(oData: object, fnFunction: Function, oListener?: object): void {\n\t\tthis.eventProvider.attachEvent(\"routeMatched\", oData, fnFunction, oListener);\n\t}\n\n\tattachBeforeRouteMatched(oData: object, fnFunction: Function, oListener?: object): void {\n\t\tthis.eventProvider.attachEvent(\"beforeRouteMatched\", oData, fnFunction, oListener);\n\t}\n\n\tdetachRouteMatched(fnFunction: Function, oListener?: object): void {\n\t\tthis.eventProvider.detachEvent(\"routeMatched\", fnFunction, oListener);\n\t}\n\n\tattachAfterRouteMatched(oData: object, fnFunction: Function, oListener?: object): void {\n\t\tthis.eventProvider.attachEvent(\"afterRouteMatched\", oData, fnFunction, oListener);\n\t}\n\n\tdetachAfterRouteMatched(fnFunction: Function, oListener: object): void {\n\t\tthis.eventProvider.detachEvent(\"afterRouteMatched\", fnFunction, oListener);\n\t}\n\n\tdetachBeforeRouteMatched(fnFunction: Function, oListener: object): void {\n\t\tthis.eventProvider.detachEvent(\"beforeRouteMatched\", fnFunction, oListener);\n\t}\n\tasync initializeRouting(): Promise<void> {\n\t\tthis.enabled = true;\n\n\t\tif (this.oAppComponent.getEnvironmentCapabilities().getCapabilities().Collaboration) {\n\t\t\tconst { default: CollaborationHelper } = await import(\"sap/suite/ui/commons/collaboration/CollaborationHelper\");\n\t\t\tawait CollaborationHelper.processAndExpandHash();\n\t\t}\n\t\t// Attach router handlers\n\n\t\tthis._fnOnRouteMatched = this._onRouteMatched.bind(this);\n\t\tthis.oRouter.attachRouteMatched(this._fnOnRouteMatched, this);\n\t\tthis.oRouter.attachBeforeRouteMatched(this._onBeforeRouteMatched, this);\n\t\t// Reset internal state\n\t\tthis.navigationInfoQueue = [];\n\t\tEditState.resetEditState();\n\t\tthis.bExitOnNavigateBackToRoot = !this.oRouter.match(\"\");\n\n\t\tawait this.manageStartupMode();\n\t}\n\n\tonRestore(): void {\n\t\tthis.manageStartupMode();\n\t}\n\n\tasync manageStartupMode(): Promise<void> {\n\t\tconst bIsIappState = this.oRouter.getHashChanger().getHash().includes(\"sap-iapp-state\");\n\t\ttry {\n\t\t\tconst oStartupParameters = await this.oAppComponent.getStartupParameters();\n\t\t\tconst bHasStartUpParameters = oStartupParameters !== undefined && Object.keys(oStartupParameters).length !== 0;\n\t\t\tconst sHash = this.oRouter.getHashChanger().getHash();\n\t\t\t// Manage startup parameters (in case of no iapp-state)\n\t\t\tif (!bIsIappState && bHasStartUpParameters && !sHash) {\n\t\t\t\tif (oStartupParameters.preferredMode && oStartupParameters.preferredMode[0].toUpperCase().includes(\"CREATE\")) {\n\t\t\t\t\t// Create mode\n\t\t\t\t\t// This check will catch multiple modes like create, createWith and autoCreateWith which all need\n\t\t\t\t\t// to be handled like create startup!\n\t\t\t\t\tawait this._manageCreateStartup(oStartupParameters);\n\t\t\t\t} else {\n\t\t\t\t\t// Deep link\n\t\t\t\t\tawait this._manageDeepLinkStartup(oStartupParameters);\n\t\t\t\t}\n\t\t\t}\n\t\t\tawait this._managedPreferredModeEdit(oStartupParameters);\n\t\t} catch (oError: unknown) {\n\t\t\tLog.error(\"Error during routing initialization\", oError as string);\n\t\t}\n\t}\n\n\tgetDefaultCreateHash(oStartupParameters?: StartupParameters): string {\n\t\treturn AppStartupHelper.getDefaultCreateHash(oStartupParameters, this.getContextPath(), this.oRouter);\n\t}\n\n\tasync _manageCreateStartup(oStartupParameters: StartupParameters): Promise<void> {\n\t\treturn AppStartupHelper.getCreateStartupHash(oStartupParameters, this.getContextPath(), this.oRouter, this.oMetaModel).then(\n\t\t\t(sNewHash: string): void => {\n\t\t\t\tif (sNewHash) {\n\t\t\t\t\t(this.oRouter.getHashChanger().replaceHash as Function)(sNewHash);\n\t\t\t\t\tif (oStartupParameters?.preferredMode && oStartupParameters.preferredMode[0].toUpperCase().includes(\"AUTOCREATE\")) {\n\t\t\t\t\t\tthis.oAppComponent.setStartupModeAutoCreate();\n\t\t\t\t\t} else {\n\t\t\t\t\t\tthis.oAppComponent.setStartupModeCreate();\n\t\t\t\t\t}\n\t\t\t\t\tthis.bExitOnNavigateBackToRoot = true;\n\t\t\t\t}\n\t\t\t\treturn;\n\t\t\t}\n\t\t);\n\t}\n\n\tasync _manageDeepLinkStartup(oStartupParameters: StartupParameters | null): Promise<void> {\n\t\treturn AppStartupHelper.getDeepLinkStartupHash(\n\t\t\tthis.oAppComponent.getManifestEntry(\"sap.ui5\").routing,\n\t\t\toStartupParameters,\n\t\t\tthis.oModel,\n\t\t\tthis.oAppComponent.getManifestEntry(\"sap.fe\")?.app?.inboundParameterForTargetResolution\n\t\t).then((oDeepLink) => {\n\t\t\tlet sHash;\n\t\t\tif (oDeepLink.context) {\n\t\t\t\tconst sTechnicalPath = oDeepLink.context.getPath();\n\t\t\t\tconst sSemanticPath = this._checkIfContextSupportsSemanticPath(oDeepLink.context)\n\t\t\t\t\t? SemanticKeyHelper.getSemanticPath(oDeepLink.context, false)!\n\t\t\t\t\t: sTechnicalPath;\n\n\t\t\t\tif (sSemanticPath !== sTechnicalPath) {\n\t\t\t\t\t// Store the mapping technical <-> semantic path to avoid recalculating it later\n\t\t\t\t\t// and use the semantic path instead of the technical one\n\t\t\t\t\tthis.setLastSemanticMapping({ technicalPath: sTechnicalPath, semanticPath: sSemanticPath });\n\t\t\t\t}\n\n\t\t\t\tsHash = sSemanticPath.substring(1); // To remove the leading '/'\n\t\t\t} else if (oDeepLink.hash) {\n\t\t\t\tsHash = oDeepLink.hash;\n\t\t\t}\n\n\t\t\tif (sHash) {\n\t\t\t\t//Replace the hash with newly created hash\n\t\t\t\t(this.oRouter.getHashChanger().replaceHash as Function)(sHash);\n\t\t\t\tthis.oAppComponent.setStartupModeDeeplink();\n\t\t\t}\n\t\t\treturn;\n\t\t});\n\t}\n\n\t/**\n\t * Manages the preferred mode edit by appending \"[&|?]i-action=edit\" to the hash if:\n\t * - There is a resulting hash from the previous logic,\n\t * - The preferred mode is edit, and\n\t * - The entity is editable\n\t * This works for both deep-link startup (#App?ID=myId&preferredMode=edit) and object page routing (#App?preferredMode=edit&/Entity(ID)).\n\t * @param startupParameters\n\t * @param startupParameters.preferredMode\n\t */\n\tasync _managedPreferredModeEdit(startupParameters: { preferredMode?: string[] }): Promise<void> {\n\t\tconst resultingHash = this.oRouter.getHashChanger().getHash();\n\t\tconst shouldEdit = !!startupParameters.preferredMode?.[0]?.toUpperCase()?.includes(\"EDIT\");\n\t\tconst editable = await AppStartupHelper.verifyEditAnnotations(this.getContextPath(), this.oMetaModel);\n\t\tif (resultingHash && shouldEdit && editable) {\n\t\t\tconst parameter = (resultingHash.includes(\"?\") ? \"&\" : \"?\") + \"i-action=edit\";\n\t\t\t(this.oRouter.getHashChanger().replaceHash as (hash: string) => void)(resultingHash + parameter);\n\t\t}\n\t}\n\n\tgetOutbounds(): Record<string, ManifestOutboundEntry> {\n\t\treturn this.outbounds;\n\t}\n\n\t/**\n\t * Returns the routing hints for the current route.\n\t * Currently, this only covers the parent-child relationship from a list report to an object page.\n\t * @returns The routing hints\n\t */\n\tgetRoutingHints(): Record<string, { parentOf: string[] }> {\n\t\treturn this.routingHints ?? {};\n\t}\n\n\t/**\n\t * Gets the name of the Draft root entity set or the sticky-enabled entity set.\n\t * @returns The name of the root EntitySet\n\t */\n\tgetContextPath(): string {\n\t\treturn this.sContextPath;\n\t}\n\n\tgetInterface(): this {\n\t\treturn this;\n\t}\n}\n\nclass RoutingServiceFactory extends ServiceFactory<RoutingServiceSettings> {\n\tasync createInstance(oServiceContext: ServiceContext<RoutingServiceSettings>): Promise<RoutingService> {\n\t\tconst oRoutingService = new RoutingService(oServiceContext);\n\t\treturn oRoutingService.initPromise;\n\t}\n}\n\nexport default RoutingServiceFactory;\n"],"mappings":"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","ignoreList":[]}