{"version":3,"names":["HistoryOptOutProvider","valueHelpHistoryService","resourceBundle","Library","getResourceBundleFor","_userAction","_exports","_proto","prototype","getDialog","dialog","createOptOutUserProfileEntry","shellExtensionService","getShellExtensionService","userAction","createUserAction","text","getText","icon","IconPool","getIconURI","press","historyEnabledSwitch","Switch","createDialog","enabled","getHistoryEnabled","setState","open","controlType","destroy","showForCurrentApp","err","Log","error","Error","message","String","createDialogLayout","historyEnabledLabel","Label","labelFor","addStyleClass","historyEnabledLayout","HBox","alignItems","items","deleteHistoryButton","Button","busyIndicatorDelay","onDeleteHistoryPress","bind","deleteHistoryLabel","deleteHistoryLayout","FlexBox","VBox","dialogLayout","saveButton","onSavePress","cancelButton","closeDialog","Dialog","title","content","buttons","afterClose","undefined","event","button","getSource","setBusy","MessageBox","confirm","onClose","result","deleteHistoryForAllApps","then","window","location","reload","getState","setHistoryEnabled","close"],"sourceRoot":".","sources":["HistoryOptOutProvider.ts"],"sourcesContent":["import Log from \"sap/base/Log\";\nimport type { IValueHelpHistoryService } from \"sap/fe/core/services/ValueHelpHistoryServiceFactory\";\nimport Button from \"sap/m/Button\";\nimport Dialog from \"sap/m/Dialog\";\nimport type { $FlexBoxSettings } from \"sap/m/FlexBox\";\nimport FlexBox from \"sap/m/FlexBox\";\nimport HBox, { type $HBoxSettings } from \"sap/m/HBox\";\nimport Label from \"sap/m/Label\";\nimport MessageBox from \"sap/m/MessageBox\";\nimport Switch from \"sap/m/Switch\";\nimport VBox from \"sap/m/VBox\";\nimport type Event from \"sap/ui/base/Event\";\nimport IconPool from \"sap/ui/core/IconPool\";\nimport Library from \"sap/ui/core/Lib\";\nimport type Item from \"sap/ushell/services/Extension/Item\";\n\nexport default class HistoryOptOutProvider {\n\tprivate valueHelpHistoryService: IValueHelpHistoryService;\n\n\tprivate dialog?: Dialog;\n\n\tprivate historyEnabledSwitch?: Switch;\n\n\tprivate resourceBundle = Library.getResourceBundleFor(\"sap.fe.core\")!;\n\n\tprivate _userAction: Item | null = null;\n\tconstructor(valueHelpHistoryService: IValueHelpHistoryService) {\n\t\tthis.valueHelpHistoryService = valueHelpHistoryService;\n\t}\n\n\tpublic getDialog(): Dialog | undefined {\n\t\treturn this.dialog;\n\t}\n\n\t/**\n\t * For history settings we need to create a user profile entry and a handler for opening the dialog.\n\t * @returns Promise that is resolved when user menu entry control is created\n\t */\n\tasync createOptOutUserProfileEntry(): Promise<Item | undefined> {\n\t\tconst shellExtensionService = this.valueHelpHistoryService.getShellExtensionService();\n\t\tlet userAction: Item | undefined;\n\n\t\ttry {\n\t\t\tuserAction = await shellExtensionService.createUserAction(\n\t\t\t\t{\n\t\t\t\t\ttext: this.resourceBundle.getText(\"C_HISTORY_SETTING_TITLE\"),\n\t\t\t\t\ticon: IconPool.getIconURI(\"history\"),\n\t\t\t\t\tpress: async (): Promise<void> => {\n\t\t\t\t\t\tthis.historyEnabledSwitch = new Switch();\n\n\t\t\t\t\t\tthis.dialog = this.createDialog();\n\n\t\t\t\t\t\tconst enabled = await this.valueHelpHistoryService.getHistoryEnabled();\n\t\t\t\t\t\tthis.historyEnabledSwitch.setState(enabled);\n\n\t\t\t\t\t\tthis.dialog.open();\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tcontrolType: \"sap.m.Button\"\n\t\t\t\t}\n\t\t\t);\n\t\t\tif (this._userAction) {\n\t\t\t\tthis._userAction.destroy();\n\t\t\t}\n\t\t\tthis._userAction = userAction;\n\n\t\t\tuserAction.showForCurrentApp();\n\t\t} catch (err) {\n\t\t\tLog.error(\"Cannot add user action\", err instanceof Error ? err.message : String(err));\n\t\t}\n\n\t\treturn userAction;\n\t}\n\n\t/*\n\t\tCreate Controls\n\t */\n\n\t/**\n\t * For the history setting dialog we need to create all the necessary UI elements for the\n\t * enable history tracking switch and the clear history button.\n\t * @returns The dialog layout\n\t */\n\tprivate createDialogLayout(): VBox {\n\t\tconst historyEnabledLabel = new Label({\n\t\t\ttext: this.resourceBundle.getText(\"C_HISTORY_SETTING_ENABLE_TRACKING_DESCRIPTION\"),\n\t\t\tlabelFor: this.historyEnabledSwitch\n\t\t}).addStyleClass(\"sapUiSmallMarginEnd\");\n\t\tconst historyEnabledLayout = new HBox({\n\t\t\talignItems: \"Center\",\n\t\t\titems: [historyEnabledLabel, this.historyEnabledSwitch]\n\t\t} as $HBoxSettings);\n\n\t\tconst deleteHistoryButton = new Button({\n\t\t\tbusyIndicatorDelay: 0,\n\t\t\ttext: this.resourceBundle.getText(\"C_HISTORY_SETTING_DELETE_BUTTON\"),\n\t\t\tpress: this.onDeleteHistoryPress.bind(this)\n\t\t});\n\t\tconst deleteHistoryLabel = new Label({\n\t\t\ttext: this.resourceBundle.getText(\"C_HISTORY_SETTING_DELETE_DESCRIPTION\"),\n\t\t\tlabelFor: deleteHistoryButton\n\t\t}).addStyleClass(\"sapUiSmallMarginEnd\");\n\t\tconst deleteHistoryLayout = new FlexBox({\n\t\t\talignItems: \"Center\",\n\t\t\titems: [deleteHistoryLabel, deleteHistoryButton]\n\t\t} as $FlexBoxSettings);\n\n\t\treturn new VBox({\n\t\t\titems: [historyEnabledLayout, deleteHistoryLayout]\n\t\t}).addStyleClass(\"sapUiSmallMargin\");\n\t}\n\n\t/**\n\t * Create history setting dialog with save and cancel buttons.\n\t * @returns The dialog for the history settings\n\t */\n\tprivate createDialog(): Dialog {\n\t\tconst dialogLayout = this.createDialogLayout();\n\n\t\tconst saveButton = new Button({\n\t\t\ttext: this.resourceBundle.getText(\"C_HISTORY_SETTING_SAVE\"),\n\t\t\tpress: this.onSavePress.bind(this)\n\t\t});\n\t\tconst cancelButton = new Button({\n\t\t\ttext: this.resourceBundle.getText(\"C_HISTORY_SETTING_CANCEL\"),\n\t\t\tpress: () => this.closeDialog()\n\t\t});\n\n\t\treturn new Dialog(\"sapui5.history.optOutDialog\", {\n\t\t\ttitle: this.resourceBundle.getText(\"C_HISTORY_SETTING_TITLE\"),\n\t\t\tcontent: [dialogLayout],\n\t\t\tbuttons: [saveButton, cancelButton],\n\t\t\tafterClose: (): void => {\n\t\t\t\t// When the dialog is closed we need to free the resources\n\t\t\t\tthis.dialog?.destroy();\n\t\t\t\tthis.dialog = undefined;\n\t\t\t\tthis.historyEnabledSwitch = undefined;\n\t\t\t}\n\t\t});\n\t}\n\n\t/*\n\t\tHandlers\n\t */\n\n\t/**\n\t * Handler which is called on clear history button press.\n\t * @param event Button press event\n\t */\n\tprivate onDeleteHistoryPress(event: Event<{}, Button>): void {\n\t\tconst button = event.getSource();\n\t\tbutton.setBusy(true);\n\n\t\tMessageBox.confirm(this.resourceBundle.getText(\"C_HISTORY_SETTING_DELETE_CONFIRM_MESSAGE\"), {\n\t\t\tonClose: async (result: string) => {\n\t\t\t\tif (result === \"CANCEL\") {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\tawait this.valueHelpHistoryService.deleteHistoryForAllApps().then(function () {\n\t\t\t\t\treturn window.location.reload();\n\t\t\t\t});\n\n\t\t\t\tthis.closeDialog();\n\t\t\t}\n\t\t});\n\n\t\tbutton.setBusy(false);\n\t}\n\n\t/**\n\t * Handler which is called on save button press.\n\t */\n\tprivate onSavePress(): void {\n\t\tMessageBox.confirm(this.resourceBundle.getText(\"C_HISTORY_SETTING_SAVE_CONFIRM_MESSAGE\"), {\n\t\t\tonClose: async (result: string) => {\n\t\t\t\tif (result === \"CANCEL\") {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tconst enabled = this.historyEnabledSwitch?.getState() ?? false;\n\t\t\t\tawait this.valueHelpHistoryService.setHistoryEnabled(enabled);\n\n\t\t\t\tthis.closeDialog();\n\t\t\t}\n\t\t});\n\t}\n\n\t/**\n\t * Close the dialog.\n\t */\n\tprivate closeDialog(): void {\n\t\tthis.dialog?.close();\n\t}\n}\n"],"mappings":"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","ignoreList":[],"file":"HistoryOptOutProvider-dbg.js"}