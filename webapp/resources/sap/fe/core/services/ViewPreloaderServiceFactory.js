/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)
 *      (c) Copyright 2009-2025 SAP SE. All rights reserved
 */
sap.ui.define(["sap/fe/base/ViewPreloaderCache","sap/ui/core/service/Service","sap/ui/core/service/ServiceFactory","../helpers/RoutingHelper"],function(e,t,r,n){"use strict";var a={};var i=e.viewPreloaderCache;function s(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e,o(e,t)}function o(e,t){return o=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},o(e,t)}let c=function(e){function t(){var t;for(var r=arguments.length,n=new Array(r),a=0;a<r;a++){n[a]=arguments[a]}t=e.call(this,...n)||this;t.newViews=[];return t}a.ViewPreloaderService=t;s(t,e);var r=t.prototype;r.init=function e(){this.initPromise=new Promise(e=>{this.appComponent=this.getContext().scopeObject;e(this)})};r.setCache=function e(t,r,a){const s=t.pattern;const{path:o}=n.buildBindingPath(r,s,{});const c=[];let u=t.target;u=Array.isArray(u)?u:[u];u.forEach(e=>{const t=a.getModel();this.setCurrentCacheEntryByTargetName(e);const r=i.getCurrentCacheEntry();if(r.visitedContextPath?.startsWith(o)){c.push(Promise.resolve());return}c.push(new Promise(async n=>{const i=a.getManifest();let s=false;const c=i["sap.ui5"]["routing"]?.["targets"]?.[e]?.["options"]?.["settings"]?.preloadConfigurationProperties?.map(async e=>{const n={};const a=await this.requestPropertyOrSingleton(e,t,o);s=r.values?.[e]!==a?true:s;n[e]=a;return n})??[];const u=(await Promise.all(c)).reduce((e,t)=>{const r=Object.keys(t)[0];e[r]=t[r];return e},{});s=!r.visitedContextPath?false:s;r.visitedContextPath=o;r.values=u;r.viewShouldbeRefreshed=s;n()}))});this.setCacheReady(Promise.all(c))};r.requestPropertyOrSingleton=async function e(t,r,n){const a=t.startsWith("/");const[i,s,o]=[.../(?:(.*)\/){0,1}([^/]*)/.exec(t)];const c=a?s:n;let u;const h=r.getAllBindings().find(e=>e.getContext()?.getPath()===c&&e.getPath()===o);u=h?.getValue();if(!u){u=await r.bindProperty(`${c}/${o}`).requestValue()}return u};r.setCacheReady=function e(t){this.cacheReady=t};r.isCacheReady=async function e(){await this.cacheReady;return true};r.getCurrentCacheEntry=function e(){return i.getCurrentCacheEntry()};r.getCacheEntryByTargetName=function e(t){return i.getCacheEntryByTargetName(t,this.appComponent)};r.setCurrentCacheEntryByTargetName=function e(t){const r=this.getCacheEntryByTargetName(t)??{values:{}};i.addEntryToCache(r,t,this.appComponent)};return t}(t);a.ViewPreloaderService=c;let u=function(e){function t(){return e.apply(this,arguments)||this}a.ViewPreloaderServiceFactory=t;s(t,e);var r=t.prototype;r.createInstance=async function e(t){this.instance=new c(t);return this.instance.initPromise};r.getInstance=function e(){return this.instance};return t}(r);a.ViewPreloaderServiceFactory=u;return a},false);
//# sourceMappingURL=ViewPreloaderServiceFactory.js.map