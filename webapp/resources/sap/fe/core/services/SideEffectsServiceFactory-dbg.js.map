{"version":3,"names":["SideEffectsService","_Service","apply","arguments","_exports","_inheritsLoose","_proto","prototype","init","context","getContext","appComponent","scopeObject","sideEffectsRegistry","oData","entities","actions","boundActions","unBoundActions","control","recommendationRegistry","roles","targetCallbacks","initializeWebSocketConnection","model","getModel","url","getWebSocketBaseUrl","channel","getWebSocketChannelUrl","ChannelType","SideEffectsEvents","webSocket","createWebSocket","attachMessage","onSideEffectsEventReceived","bind","webSocketStatus","WEBSOCKET_STATUS","CONNECTED","showConnectionLostDialog","CLOSED","ERROR","includes","resourceModel","getResourceModel","lostOfConnectionText","getText","MessageBox","warning","Action","OK","emphasizedAction","attachError","attachClose","evt","getParameter","event","message","serverAction","sideEffectEventName","sideEffectSource","metaPath","getMetaModel","getMetaContext","dataModel","MetaModelConverter","getInvolvedDataModelObjects","relevantSideEffects","getSideEffectWhereEventIsSource","targetEntityType","fullyQualifiedName","length","relevantPages","pages","getRootViewController","getVisibleViews","page","pageController","getController","isA","_sideEffects","isDataPathRelevant","push","sideEffectsControllerExtension","onlyRecommendations","isOnlyRecommendations","interactionType","getSideEffectsInteractionType","confirmDataRefresh","error","notifyDataRefresh","requestSideEffectsForEvent","recommendationPath","annotations","UI","Recommendations","path","sideEffect","annotation","entity","qualifier","targetProperties","targetEntities","undefined","interactionTypeDefinition","getManifestEntry","app","sideEffectsEventsInteractionType","events","default","addControlSideEffects","entityType","sourceControlId","controlSideEffect","entityControlSideEffects","executeAction","triggerAction","options","action","bindContext","executionOptions","groupId","getBinding","getUpdateGroupId","submitBatch","execute","getConvertedMetaModel","convertTypes","capabilities","getEntityTypeFromContext","metaModel","getMetaPath","getPath","getObject","getODataEntitySideEffects","entityTypeName","isControlSideEffects","sideEffects","getGlobalODataEntitySideEffects","entitySideEffects","globalSideEffects","key","sourceEntities","sourceProperties","sourceEvents","getODataActionSideEffects","actionName","getODataSideEffectsFromContextEvent","sideEffectsInfo","map","initialize","sideEffectSources","properties","environmentCapabilitiesService","getService","requestObject","getCapabilities","convertedMetaModel","containerName","entityContainer","containerRegexPattern","RegExp","entityTypeRegexPattern","entityTypes","forEach","mapFieldAnnotations","retrieveODataEntitySideEffects","mapSideEffectSources","isBound","sourceEntityType","retrieveODataActionsSideEffects","Object","keys","sourcesToSideEffectMappings","source","addRecommendationRoles","sourceName","hasOwnProperty","input","output","entityProperties","property","commonAnno","Common","RecommendationRole","roleType","valueOf","name","getRecommendationsMapping","checkIfFieldIsRecommendationRelevant","field","getBindingContext","propertyName","data","sourcePath","split","pop","metaContext","targetDataModelObject","targetObject","targetEntityTypeName","isEntitySet","isNavigationProperty","targetType","recommendationRolesForEntity","getRecommendationOutputFields","removeControlSideEffects","controlId","sEntityType","requestSideEffects","pathExpressions","logRequest","requestSideEffectsForODataAction","promises","triggerActions","Promise","all","resolve","requestSideEffectsForNavigationProperty","navigationProperty","ignoreTriggerActions","baseEntityType","navigationPath","sideEffectsTargets","filter","annotationName","some","navigation","$NavigationPropertyPath","propertyPath","startsWith","replace","sAnnotationName","concat","sideEffectsTargetDefinition","removeDuplicateTargets","catch","Log","getControlEntitySideEffects","getSideEffectWhereEntityIsSource","eventName","computeFieldGroupIds","sourceProperty","entityFieldGroupIds","sideEffectInfo","getFieldGroupIdForSideEffect","getSideEffectWherePropertyIsSource","registerTargetCallback","target","callback","deregisterTargetCallback","getRegisteredCallback","addTextProperties","setOfProperties","Set","setOfEntities","dataModelPropertyPath","getDataModelPropertiesFromAPath","associatedTextPath","getAssociatedTextPropertyPath","addTextProperty","Array","from","dataModelTextPath","enhanceDataModelPath","relativeNavigation","targetEntitySet","getTargetNavigationPath","targetPath","getTargetObjectPath","isAssociatedTextListedInSideEffectTargets","isPropertyAssociatedTextOnDifferentEntitySet","add","isProperty","has","navigationProperties","convertSideEffects","bindingParameter","TriggerAction","newSideEffects","convertSideEffectsFormat","removeBindingParameter","formatProperties","reduce","isPropertyPathExpression","value","formatEntities","targetEntity","SourceProperties","SourceEntities","SourceEvents","TargetProperties","TargetEntities","dataModelObjectPaths","propertyRelativePath","testEntityTypeName","match","testEntityType","resolvePath","entitySet","entitySets","find","relatedEntitySet","singletons","singleton","entitySetContext","createBindingContext","dataModelEntitySet","dataModelObjectPath","isComplexType","isEntityType","entityProperty","destroy","getSideEffectsFromSource","bindingAlias","isSourceEntityType","commonAnnotation","parameters","parameter","type","getSideEffectsAnnotationFromSource","sideEffectAnno","isSideEffectsAnnotation","$Type","targetPaths","paths","debug","bindingParameterName","replaceBindingParameter","targetProperty","targetEntitiesPaths","uniqueTargetedEntitiesPath","uniqueTargetProperties","uniqueTargetedEntities","entityPath","oDataSideEffect","sideEffectsSources","sideEffectDefinition","mapSideEffectSourceEntities","mapSideEffectSourceProperties","mapSideEffectSourceEvents","sourceEntity","$target","hasUniqueSourceProperty","sourceEvent","toString","isImmediate","sideEffectWithQualifier","getInterface","Service","SideEffectsServiceFactory","_ServiceFactory","_proto2","createInstance","oServiceContext","SideEffectsServiceService","ServiceFactory"],"sourceRoot":".","sources":["SideEffectsServiceFactory.ts"],"sourcesContent":["import type {\n\tAction,\n\tConvertedMetadata,\n\tEntitySet,\n\tEntityType,\n\tNavigationProperty,\n\tNavigationPropertyPath,\n\tProperty,\n\tPropertyPath\n} from \"@sap-ux/vocabularies-types\";\nimport type * as Edm from \"@sap-ux/vocabularies-types/Edm\";\nimport type { PathAnnotationExpression } from \"@sap-ux/vocabularies-types/Edm\";\nimport type { SideEffectsType as CommonSideEffectsType } from \"@sap-ux/vocabularies-types/vocabularies/Common\";\nimport { CommonAnnotationTypes } from \"@sap-ux/vocabularies-types/vocabularies/Common\";\nimport type { PropertyAnnotations_Common } from \"@sap-ux/vocabularies-types/vocabularies/Common_Edm\";\nimport Log from \"sap/base/Log\";\nimport type PageController from \"sap/fe/core/PageController\";\nimport type {\n\tSideEffectsEventsInteractionManifestSetting,\n\tSideEffectsEventsInteractionType\n} from \"sap/fe/core/converters/ManifestSettings\";\nimport * as MetaModelConverter from \"sap/fe/core/converters/MetaModelConverter\";\nimport { convertTypes, getInvolvedDataModelObjects } from \"sap/fe/core/converters/MetaModelConverter\";\nimport { getResourceModel } from \"sap/fe/core/helpers/ResourceModelHelper\";\nimport {\n\tisComplexType,\n\tisEntitySet,\n\tisEntityType,\n\tisNavigationProperty,\n\tisProperty,\n\tisPropertyPathExpression\n} from \"sap/fe/core/helpers/TypeGuards\";\nimport { ChannelType, WEBSOCKET_STATUS, createWebSocket, getWebSocketBaseUrl, getWebSocketChannelUrl } from \"sap/fe/core/helpers/WebSocket\";\nimport { getAssociatedTextPropertyPath } from \"sap/fe/core/templating/PropertyHelper\";\nimport MessageBox from \"sap/m/MessageBox\";\nimport type Event from \"sap/ui/base/Event\";\nimport type Control from \"sap/ui/core/Control\";\nimport Service from \"sap/ui/core/service/Service\";\nimport ServiceFactory from \"sap/ui/core/service/ServiceFactory\";\nimport type SapPcpWebSocket from \"sap/ui/core/ws/SapPcpWebSocket\";\nimport type { WebSocket$CloseEvent, WebSocket$MessageEvent } from \"sap/ui/core/ws/WebSocket\";\nimport type { default as Context } from \"sap/ui/model/odata/v4/Context\";\nimport type ODataMetaModel from \"sap/ui/model/odata/v4/ODataMetaModel\";\nimport type ODataModel from \"sap/ui/model/odata/v4/ODataModel\";\nimport type { ServiceContext } from \"types/metamodel_types\";\nimport type AppComponent from \"../AppComponent\";\nimport type { DataModelObjectPath } from \"../templating/DataModelPathHelper\";\nimport { enhanceDataModelPath, getTargetNavigationPath, getTargetObjectPath } from \"../templating/DataModelPathHelper\";\nimport type { EnvironmentCapabilities, EnvironmentCapabilitiesService } from \"./EnvironmentServiceFactory\";\n\nexport type PropertyAnnotationsWithRecommendation = PropertyAnnotations_Common & {\n\tRecommendationRole?: string;\n};\n\ntype SideEffectsSettings = {};\n\nexport type SideEffectsEntityType = {\n\t$NavigationPropertyPath: string;\n};\nexport type SideEffectsTarget = SideEffectsEntityType | string;\n\nexport type SideEffectsTargetType = {\n\ttargetProperties: string[];\n\ttargetEntities: SideEffectsEntityType[];\n};\n\ntype BaseSideEffectsType = {\n\tsourceProperties?: string[];\n\tsourceEntities?: SideEffectsEntityType[];\n\tsourceEvents?: string[];\n\tfullyQualifiedName: string;\n} & SideEffectsTargetType;\n\nexport type ODataSideEffectsType = BaseSideEffectsType & {\n\ttriggerAction?: string;\n};\n\nexport type ActionSideEffectsType = {\n\tpathExpressions?: SideEffectsTarget[];\n\ttriggerActions?: string[];\n};\n\nexport type ControlSideEffectsType = Partial<BaseSideEffectsType> & {\n\tfullyQualifiedName: string;\n\tsourceProperties: string[];\n\tsourceControlId: string;\n};\n\nexport type SideEffectsType = ControlSideEffectsType | ODataSideEffectsType;\n\n//TODO fix this type in the ux vocabularies\n//TODO: Source Events are still experimental, remove once public\ntype CommonSideEffectTypeWithQualifier = CommonSideEffectsType & { qualifier?: string; SourceEvents?: Edm.String[] };\n\nexport type SideEffectInfoForSource = { entity: string; qualifier?: string; hasUniqueSourceProperty?: boolean };\n\ntype SideEffectsOriginRegistry = {\n\toData: {\n\t\tentities: {\n\t\t\t[entity: string]: Record<string, ODataSideEffectsType>;\n\t\t};\n\t\tactions: {\n\t\t\tboundActions: {\n\t\t\t\t[entity: string]: Record<string, ActionSideEffectsType>;\n\t\t\t};\n\t\t\tunBoundActions: {\n\t\t\t\t[action: string]: ActionSideEffectsType;\n\t\t\t};\n\t\t};\n\t};\n\tcontrol: {\n\t\t[entity: string]: Record<string, ControlSideEffectsType>;\n\t};\n};\n\ntype RecommendationsRoles = {\n\tinput: string[];\n\toutput: string[];\n\trequired?: string[];\n};\n\nexport type RecommendationsRegistry = {\n\troles: Record<string, RecommendationsRoles>;\n};\n\ntype WebSocketMessage = {\n\tserverAction: \"RaiseSideEffect\";\n\tsideEffectEventName: string;\n\tsideEffectSource: string;\n};\n\nexport class SideEffectsService extends Service<SideEffectsSettings> {\n\tappComponent!: AppComponent;\n\n\tprivate sideEffectsRegistry!: SideEffectsOriginRegistry;\n\n\tprivate recommendationRegistry!: RecommendationsRegistry;\n\n\tprivate capabilities!: EnvironmentCapabilities | undefined;\n\n\tprivate sourcesToSideEffectMappings!: {\n\t\tentities: Record<string, SideEffectInfoForSource[]>;\n\t\tproperties: Record<string, SideEffectInfoForSource[]>;\n\t\tevents: Record<string, SideEffectInfoForSource[]>;\n\t};\n\n\t// Callback methods to be called whenever a side effect target is hit\n\tprivate targetCallbacks!: Record<string, Function>;\n\n\t// WebSocket connection to retrieve SideEffects events\n\tprivate webSocket?: SapPcpWebSocket;\n\n\tprivate containerName?: string;\n\n\tprivate containerRegexPattern!: RegExp;\n\n\tprivate entityTypeRegexPattern!: RegExp;\n\n\tprivate webSocketStatus!: WEBSOCKET_STATUS;\n\t// Interaction type for SideEffects events\n\tprivate interactionTypeDefinition?: SideEffectsEventsInteractionManifestSetting;\n\n\t// !: means that we know it will be assigned before usage\n\tinit(): void {\n\t\tconst context = this.getContext();\n\t\tthis.appComponent = context?.scopeObject as AppComponent;\n\t\tthis.sideEffectsRegistry = {\n\t\t\toData: {\n\t\t\t\tentities: {},\n\t\t\t\tactions: {\n\t\t\t\t\tboundActions: {},\n\t\t\t\t\tunBoundActions: {}\n\t\t\t\t}\n\t\t\t},\n\t\t\tcontrol: {}\n\t\t};\n\n\t\tthis.recommendationRegistry = {\n\t\t\troles: {}\n\t\t};\n\t\tthis.targetCallbacks = {};\n\t}\n\n\t/**\n\t * Connects to a given WebSocket connection to retrieve SideEffects events.\n\t *\n\t */\n\tinitializeWebSocketConnection(): void {\n\t\tconst model = this.appComponent.getModel();\n\t\tconst url = getWebSocketBaseUrl(model);\n\t\tconst channel = getWebSocketChannelUrl(ChannelType.SideEffectsEvents, model);\n\n\t\tif (url && channel) {\n\t\t\tthis.webSocket = createWebSocket(ChannelType.SideEffectsEvents, model);\n\t\t\tthis.webSocket.attachMessage(this.onSideEffectsEventReceived.bind(this));\n\t\t\tthis.webSocketStatus = WEBSOCKET_STATUS.CONNECTED;\n\n\t\t\tconst showConnectionLostDialog = (): void => {\n\t\t\t\tif ([WEBSOCKET_STATUS.CLOSED, WEBSOCKET_STATUS.ERROR].includes(this.webSocketStatus)) {\n\t\t\t\t\tconst resourceModel = getResourceModel(this.appComponent);\n\t\t\t\t\tconst lostOfConnectionText = resourceModel.getText(\"C_SIDEEFFECT_CONNECTION_LOST\");\n\n\t\t\t\t\tMessageBox.warning(lostOfConnectionText, {\n\t\t\t\t\t\tactions: [MessageBox.Action.OK],\n\t\t\t\t\t\temphasizedAction: MessageBox.Action.OK\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t};\n\n\t\t\tthis.webSocket.attachError(() => {\n\t\t\t\tthis.webSocketStatus = WEBSOCKET_STATUS.ERROR;\n\t\t\t\tshowConnectionLostDialog();\n\t\t\t});\n\n\t\t\tthis.webSocket.attachClose((evt: WebSocket$CloseEvent) => {\n\t\t\t\tif (this.webSocketStatus === WEBSOCKET_STATUS.ERROR) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\tthis.webSocketStatus = WEBSOCKET_STATUS.CLOSED;\n\t\t\t\t// RFC 6455 defines the status codes when closing an established connection :  https://datatracker.ietf.org/doc/html/rfc6455#section-7.4\n\t\t\t\t// status code 1000 means normal closure\n\t\t\t\tif ((evt.getParameter(\"code\") as number | undefined) !== 1000) {\n\t\t\t\t\tshowConnectionLostDialog();\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t}\n\n\t/**\n\t * This method is called whenever the connected WebSocket sends a message.\n\t * @param event The event with the relevant sideEffect information\n\t */\n\tasync onSideEffectsEventReceived(event: WebSocket$MessageEvent & Event<{ pcpFields?: WebSocketMessage }>): Promise<void> {\n\t\tconst message = event.getParameter(\"pcpFields\");\n\n\t\tif (message?.serverAction !== \"RaiseSideEffect\" || !message.sideEffectEventName || !message.sideEffectSource) {\n\t\t\t// message is not relevant\n\t\t\treturn;\n\t\t}\n\n\t\tconst metaPath = this.getMetaModel().getMetaContext(message.sideEffectSource);\n\t\tconst dataModel = MetaModelConverter.getInvolvedDataModelObjects(metaPath);\n\t\tconst relevantSideEffects = this.getSideEffectWhereEventIsSource(\n\t\t\tdataModel.targetEntityType.fullyQualifiedName,\n\t\t\tmessage.sideEffectEventName\n\t\t);\n\n\t\tif (relevantSideEffects.length === 0) {\n\t\t\t// no side effect for this source\n\t\t\treturn;\n\t\t}\n\n\t\tconst relevantPages: PageController[] = [];\n\t\tconst pages = this.appComponent.getRootViewController().getVisibleViews();\n\t\tfor (const page of pages) {\n\t\t\tconst pageController = page.getController();\n\t\t\tif (\n\t\t\t\tpageController.isA<PageController>(\"sap.fe.core.PageController\") &&\n\t\t\t\tpageController._sideEffects.isDataPathRelevant(message.sideEffectSource, message.sideEffectEventName)\n\t\t\t) {\n\t\t\t\trelevantPages.push(pageController);\n\t\t\t}\n\t\t}\n\n\t\tif (relevantPages.length === 0) {\n\t\t\t// no relevant page found for this source\n\t\t\treturn;\n\t\t}\n\n\t\t// we ask the user to confirm the refresh or notify the user, we use the most specific page\n\t\tconst sideEffectsControllerExtension = relevantPages[relevantPages.length - 1]._sideEffects;\n\t\tconst onlyRecommendations = this.isOnlyRecommendations(dataModel, relevantSideEffects);\n\t\tconst interactionType = this.getSideEffectsInteractionType(message.sideEffectEventName, onlyRecommendations);\n\n\t\tswitch (interactionType) {\n\t\t\tcase \"Confirmation\":\n\t\t\t\ttry {\n\t\t\t\t\tawait sideEffectsControllerExtension.confirmDataRefresh();\n\t\t\t\t} catch (error) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\tbreak;\n\t\t\tcase \"Notification\":\n\t\t\t\tsideEffectsControllerExtension.notifyDataRefresh();\n\t\t\t\tbreak;\n\t\t\tcase \"None\":\n\t\t\t\tbreak;\n\t\t}\n\n\t\t// now refresh the pages, forward this task to the side effects controller extensions to allow overriding per page (i.e. LR)\n\t\tfor (const page of relevantPages) {\n\t\t\tawait page._sideEffects.requestSideEffectsForEvent(message.sideEffectEventName, message.sideEffectSource);\n\t\t}\n\t}\n\n\t/**\n\t * Check if only recommendations are defined for a specific event.\n\t * @param dataModel The data model object path\n\t * @param relevantSideEffects The relevant side effects for the source\n\t * @returns True if only recommendations are defined for the event\n\t */\n\tisOnlyRecommendations(dataModel: DataModelObjectPath<unknown>, relevantSideEffects: SideEffectInfoForSource[]): boolean {\n\t\tconst recommendationPath = (\n\t\t\tdataModel.targetEntityType.annotations.UI?.Recommendations as PathAnnotationExpression<string> | undefined\n\t\t)?.path;\n\t\tfor (const sideEffect of relevantSideEffects) {\n\t\t\tconst annotation =\n\t\t\t\tthis.sideEffectsRegistry.oData.entities[dataModel.targetEntityType.fullyQualifiedName]?.[\n\t\t\t\t\t`${sideEffect.entity}@com.sap.vocabularies.Common.v1.SideEffects#${sideEffect.qualifier}`\n\t\t\t\t];\n\t\t\t// check if the side effect is only a recommendation\n\t\t\tif (\n\t\t\t\tannotation?.targetProperties.length === 1 &&\n\t\t\t\tannotation?.targetEntities.length === 0 &&\n\t\t\t\tannotation?.targetProperties[0] === recommendationPath\n\t\t\t) {\n\t\t\t\treturn true;\n\t\t\t}\n\t\t}\n\t\treturn false;\n\t}\n\n\t/**\n\t * Retrieve the side effects interaction type from the manifest.\n\t *  @param event The side effects event name\n\t *  @param onlyRecommendations Indicator if only recommendations are shown\n\t * @returns The side effects interaction type\n\t */\n\tgetSideEffectsInteractionType(event: string, onlyRecommendations = false): SideEffectsEventsInteractionType {\n\t\tif (!this.interactionTypeDefinition) {\n\t\t\tthis.interactionTypeDefinition = this.appComponent.getManifestEntry(\"sap.fe\")?.app?.sideEffectsEventsInteractionType;\n\t\t}\n\t\tif (onlyRecommendations) {\n\t\t\t// In case of only recommendations, we do not show any notification\n\t\t\treturn \"None\";\n\t\t}\n\n\t\tif (typeof this.interactionTypeDefinition === \"string\") {\n\t\t\t// a global interaction type is defined\n\t\t\treturn this.interactionTypeDefinition;\n\t\t}\n\n\t\tif (event && this.interactionTypeDefinition?.events?.[event]) {\n\t\t\t// an interaction type is defined for the event\n\t\t\treturn this.interactionTypeDefinition.events[event];\n\t\t}\n\n\t\tif (this.interactionTypeDefinition?.default) {\n\t\t\t// a default interaction type is defined for the event\n\t\t\treturn this.interactionTypeDefinition.default;\n\t\t}\n\n\t\treturn \"Notification\";\n\t}\n\n\t/**\n\t * Adds a SideEffects control\n\t * SideEffects definition is added by a control to keep data up to date\n\t * These SideEffects get limited scope compared with SideEffects coming from an OData service:\n\t * - Only one SideEffects definition can be defined for the combination entity type - control Id\n\t * - Only SideEffects source properties are recognized and used to trigger SideEffects\n\t *\n\t * Ensure the sourceControlId matches the associated SAPUI5 control ID.\n\t * @param entityType Name of the entity type\n\t * @param sideEffect SideEffects definition\n\t */\n\tpublic addControlSideEffects(entityType: string, sideEffect: Omit<ControlSideEffectsType, \"fullyQualifiedName\">): void {\n\t\tif (sideEffect.sourceControlId) {\n\t\t\tconst controlSideEffect: ControlSideEffectsType = {\n\t\t\t\t...sideEffect,\n\t\t\t\tfullyQualifiedName: `${entityType}/SideEffectsForControl/${sideEffect.sourceControlId}`\n\t\t\t};\n\t\t\tconst entityControlSideEffects = this.sideEffectsRegistry.control[entityType] || {};\n\t\t\tentityControlSideEffects[controlSideEffect.sourceControlId] = controlSideEffect;\n\t\t\tthis.sideEffectsRegistry.control[entityType] = entityControlSideEffects;\n\t\t}\n\t}\n\n\t/**\n\t * Executes SideEffects action.\n\t * @param triggerAction Name of the action\n\t * @param context Context\n\t * @param options Options for action execution\n\t * @param options.groupId The group ID to be used for the request\n\t * @param options.submitBatch If true, the $batch is submitted right after adding the action to it. Default is true.\n\t * @returns A promise that is resolved without data or with a return value context when the action call succeeds\n\t */\n\tpublic async executeAction(\n\t\ttriggerAction: string,\n\t\tcontext: Context,\n\t\toptions?: {\n\t\t\tgroupId?: string;\n\t\t\tsubmitBatch?: boolean;\n\t\t}\n\t): Promise<void> {\n\t\tconst action = context.getModel().bindContext(`${triggerAction}(...)`, context);\n\t\tconst executionOptions = options ?? {};\n\t\tconst groupId = executionOptions.groupId || context.getBinding().getUpdateGroupId();\n\t\t// the triggerAction is executed in same $batch but different changeset\n\t\tif (executionOptions.submitBatch != false) {\n\t\t\tcontext.getModel().submitBatch(groupId);\n\t\t}\n\t\tawait action.execute(groupId, true);\n\t}\n\n\t/**\n\t * Gets converted OData metaModel.\n\t * @returns Converted OData metaModel\n\t */\n\tpublic getConvertedMetaModel(): ConvertedMetadata {\n\t\treturn convertTypes(this.getMetaModel(), this.capabilities);\n\t}\n\n\t/**\n\t * Gets the entity type of a context.\n\t * @param context Context\n\t * @returns Entity Type\n\t */\n\tpublic getEntityTypeFromContext(context: Context): string | undefined {\n\t\tconst metaModel = context.getModel().getMetaModel(),\n\t\t\tmetaPath = metaModel.getMetaPath(context.getPath()),\n\t\t\tentityType = metaModel.getObject(metaPath)[\"$Type\"];\n\t\treturn entityType;\n\t}\n\n\t/**\n\t * Gets the SideEffects that come from an OData service.\n\t * @param entityTypeName Name of the entity type\n\t * @returns SideEffects dictionary\n\t */\n\tpublic getODataEntitySideEffects(entityTypeName: string): Record<string, ODataSideEffectsType> {\n\t\treturn this.sideEffectsRegistry.oData.entities[entityTypeName] || {};\n\t}\n\n\t/**\n\t * Is a SideEffects generated by a control.\n\t * @param sideEffects The SideEffects\n\t * @returns True if the SideEffects is generated by a control, otherwise false\n\t */\n\tpublic isControlSideEffects(sideEffects: SideEffectsType): sideEffects is ControlSideEffectsType {\n\t\treturn !!(sideEffects as ControlSideEffectsType).sourceControlId;\n\t}\n\n\t/**\n\t * Gets the global SideEffects that come from an OData service.\n\t * @param entityTypeName Name of the entity type\n\t * @returns Global SideEffects\n\t */\n\tpublic getGlobalODataEntitySideEffects(entityTypeName: string): ODataSideEffectsType[] {\n\t\tconst entitySideEffects = this.getODataEntitySideEffects(entityTypeName);\n\t\tconst globalSideEffects: ODataSideEffectsType[] = [];\n\t\tfor (const key in entitySideEffects) {\n\t\t\tconst sideEffects = entitySideEffects[key];\n\t\t\tif (!sideEffects.sourceEntities && !sideEffects.sourceProperties && !sideEffects.sourceEvents) {\n\t\t\t\tglobalSideEffects.push(sideEffects);\n\t\t\t}\n\t\t}\n\t\treturn globalSideEffects;\n\t}\n\n\t/**\n\t * Gets the SideEffects that come from an OData service.\n\t * @param actionName Name of the action\n\t * @param context Context\n\t * @returns SideEffects definition\n\t */\n\tpublic getODataActionSideEffects(actionName: string, context?: Context): ActionSideEffectsType | undefined {\n\t\tif (context) {\n\t\t\tconst entityType = this.getEntityTypeFromContext(context);\n\t\t\tif (entityType) {\n\t\t\t\treturn this.sideEffectsRegistry.oData.actions.boundActions[entityType]?.[actionName];\n\t\t\t}\n\t\t} else {\n\t\t\treturn this.sideEffectsRegistry.oData.actions.unBoundActions?.[actionName];\n\t\t}\n\t\treturn undefined;\n\t}\n\n\t/**\n\t * Gets the SideEffects for the context and the event.\n\t * @param context The context of the SideEffects\n\t * @param event The SideEffects of the event\n\t * @returns An array containing the SideEffects matching with the context and the event\n\t */\n\tpublic getODataSideEffectsFromContextEvent(context: Context, event: string): ODataSideEffectsType[] {\n\t\tconst metaPath = context.getModel().getMetaModel().getMetaContext(context.getPath());\n\t\tconst dataModel = getInvolvedDataModelObjects(metaPath);\n\t\tconst sideEffectsInfo = this.getSideEffectWhereEventIsSource(dataModel.targetEntityType.fullyQualifiedName, event);\n\t\treturn sideEffectsInfo.map(\n\t\t\t(sideEffect) =>\n\t\t\t\tthis.sideEffectsRegistry.oData.entities[dataModel.targetEntityType.fullyQualifiedName]?.[\n\t\t\t\t\t`${sideEffect.entity}@com.sap.vocabularies.Common.v1.SideEffects#${sideEffect.qualifier}`\n\t\t\t\t]\n\t\t);\n\t}\n\n\t/**\n\t * Generates the dictionary for the SideEffects.\n\t *  @returns Promise resolving with the SideEffects service once data has been written\n\t */\n\tasync initialize(): Promise<this> {\n\t\tconst sideEffectSources: {\n\t\t\tentities: Record<string, SideEffectInfoForSource[]>;\n\t\t\tproperties: Record<string, SideEffectInfoForSource[]>;\n\t\t\tevents: Record<string, SideEffectInfoForSource[]>;\n\t\t} = {\n\t\t\tentities: {},\n\t\t\tproperties: {},\n\t\t\tevents: {}\n\t\t};\n\t\tconst environmentCapabilitiesService = (await this.appComponent.getService(\n\t\t\t\"environmentCapabilities\"\n\t\t)) as EnvironmentCapabilitiesService;\n\t\tconst model = this.appComponent.getModel();\n\t\tif (model?.isA?.<ODataModel>(\"sap.ui.model.odata.v4.ODataModel\")) {\n\t\t\t// We need to wait for the MetaModel to be requested\n\t\t\tawait model.getMetaModel().requestObject(\"/$EntityContainer/\");\n\t\t\tthis.capabilities = environmentCapabilitiesService.getCapabilities();\n\n\t\t\tconst convertedMetaModel = this.getConvertedMetaModel();\n\t\t\tthis.containerName = convertedMetaModel.entityContainer.fullyQualifiedName;\n\t\t\tthis.containerRegexPattern = new RegExp(`^\\\\/${this.containerName}\\\\/[^/]+\\\\/(.+)?$`);\n\t\t\tthis.entityTypeRegexPattern = new RegExp(`^/${this.containerName}/([^/]+)`);\n\t\t\tconvertedMetaModel.entityTypes.forEach((entityType: EntityType) => {\n\t\t\t\tthis.mapFieldAnnotations(entityType);\n\t\t\t\tthis.sideEffectsRegistry.oData.entities[entityType.fullyQualifiedName] = this.retrieveODataEntitySideEffects(entityType);\n\t\t\t\tthis.mapSideEffectSources(entityType, sideEffectSources);\n\t\t\t});\n\t\t\tconvertedMetaModel.actions.forEach((action: Action) => {\n\t\t\t\tif (action.isBound) {\n\t\t\t\t\tthis.sideEffectsRegistry.oData.actions.boundActions[action.sourceEntityType!.fullyQualifiedName] = {\n\t\t\t\t\t\t...this.sideEffectsRegistry.oData.actions.boundActions[action.sourceEntityType!.fullyQualifiedName],\n\t\t\t\t\t\t...this.retrieveODataActionsSideEffects(action)\n\t\t\t\t\t};\n\t\t\t\t} else {\n\t\t\t\t\tthis.sideEffectsRegistry.oData.actions.unBoundActions = {\n\t\t\t\t\t\t...this.sideEffectsRegistry.oData.actions.unBoundActions,\n\t\t\t\t\t\t...this.retrieveODataActionsSideEffects(action)\n\t\t\t\t\t};\n\t\t\t\t}\n\t\t\t});\n\t\t\tif (Object.keys(sideEffectSources.events).length > 0) {\n\t\t\t\tthis.initializeWebSocketConnection();\n\t\t\t}\n\t\t}\n\t\tthis.sourcesToSideEffectMappings = sideEffectSources;\n\t\treturn this;\n\t}\n\n\tprivate mapFieldAnnotations(source: EntityType): void {\n\t\tconst addRecommendationRoles = (sourceName: string): void => {\n\t\t\tif (!this.recommendationRegistry.roles.hasOwnProperty(`${sourceName}`)) {\n\t\t\t\tthis.recommendationRegistry.roles[`${sourceName}`] = {\n\t\t\t\t\tinput: [],\n\t\t\t\t\toutput: []\n\t\t\t\t};\n\t\t\t}\n\t\t};\n\t\tsource.entityProperties.forEach((property) => {\n\t\t\tconst commonAnno = property.annotations.Common as PropertyAnnotationsWithRecommendation;\n\t\t\tif (commonAnno?.RecommendationRole) {\n\t\t\t\tconst roleType = commonAnno.RecommendationRole;\n\t\t\t\tif (roleType.valueOf().includes(\"Input\")) {\n\t\t\t\t\taddRecommendationRoles(`${source.name}`);\n\t\t\t\t\tthis.recommendationRegistry.roles[`${source.name}`].input.push(property.name);\n\t\t\t\t}\n\t\t\t\tif (roleType.valueOf().includes(\"Output\")) {\n\t\t\t\t\taddRecommendationRoles(`${source.name}`);\n\t\t\t\t\tthis.recommendationRegistry.roles[`${source.name}`].output.push(property.name);\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t}\n\n\tpublic getRecommendationsMapping(): RecommendationsRegistry {\n\t\treturn this.recommendationRegistry;\n\t}\n\n\t/**\n\t * This function will return true if field is part of Recommendation's input mapping and from the same entity.\n\t * Otherwise return false.\n\t * @param field\n\t * @returns True if field is has recommendation role - Input annotation\n\t */\n\tpublic checkIfFieldIsRecommendationRelevant(field: Control): boolean {\n\t\tconst context = field.getBindingContext();\n\t\tconst propertyName = field.data().sourcePath.split(\"/\").pop();\n\t\tif (context) {\n\t\t\tconst metaModel = context?.getModel().getMetaModel();\n\t\t\tconst metaContext = (metaModel as ODataMetaModel)?.getMetaContext(context.getPath());\n\t\t\tconst targetDataModelObject = MetaModelConverter.getInvolvedDataModelObjects<EntitySet | NavigationProperty>(metaContext)\n\t\t\t\t.targetObject!;\n\t\t\tlet targetEntityTypeName;\n\t\t\tif (isEntitySet(targetDataModelObject)) {\n\t\t\t\ttargetEntityTypeName = targetDataModelObject.entityType?.name;\n\t\t\t} else if (isNavigationProperty(targetDataModelObject)) {\n\t\t\t\ttargetEntityTypeName = targetDataModelObject.targetType?.name;\n\t\t\t}\n\t\t\tconst recommendationRolesForEntity = targetEntityTypeName && this.recommendationRegistry.roles[targetEntityTypeName];\n\t\t\tif (recommendationRolesForEntity && recommendationRolesForEntity?.input?.includes(propertyName)) {\n\t\t\t\treturn true;\n\t\t\t}\n\t\t}\n\t\treturn false;\n\t}\n\n\t/**\n\t * Method returns the properties in a specific entity type which are marked as RecommendationRole Output.\n\t * @param entityTypeName Entity type for which recommendation Output fields needs to be figured\n\t * @returns Array of property names which are marked RecommendationRole Output\n\t */\n\tpublic getRecommendationOutputFields(entityTypeName: string): string[] {\n\t\t//TODO: We have to consider 1:1 navigation properties as well.\n\t\tconst recommendationRolesForEntity = this.recommendationRegistry.roles[entityTypeName];\n\t\tif (recommendationRolesForEntity?.output?.length > 0) {\n\t\t\treturn recommendationRolesForEntity.output;\n\t\t}\n\n\t\treturn [];\n\t}\n\n\t/**\n\t * Removes all SideEffects related to a control.\n\t * @param controlId Control Id\n\t */\n\tpublic removeControlSideEffects(controlId: string): void {\n\t\tObject.keys(this.sideEffectsRegistry.control).forEach((sEntityType) => {\n\t\t\tif (this.sideEffectsRegistry.control[sEntityType][controlId]) {\n\t\t\t\tdelete this.sideEffectsRegistry.control[sEntityType][controlId];\n\t\t\t}\n\t\t});\n\t}\n\n\t/**\n\t * Requests the SideEffects on a specific context.\n\t * @param pathExpressions Targets of SideEffects to be executed\n\t * @param context Context where SideEffects need to be executed\n\t * @param groupId The group ID to be used for the request\n\t * @returns Promise on SideEffects request\n\t */\n\tpublic async requestSideEffects(pathExpressions: SideEffectsTarget[], context: Context, groupId?: string): Promise<void> {\n\t\tif (pathExpressions.length) {\n\t\t\tthis.logRequest(pathExpressions, context);\n\t\t\tawait context.requestSideEffects(pathExpressions, groupId);\n\t\t}\n\t}\n\n\t/**\n\t * Requests the SideEffects for an OData action.\n\t * @param sideEffects SideEffects definition\n\t * @param context Context where SideEffects need to be executed\n\t * @returns Promise on SideEffects requests and action execution\n\t */\n\tpublic async requestSideEffectsForODataAction(sideEffects: ActionSideEffectsType, context: Context): Promise<(void | undefined)[]> {\n\t\tlet promises: Promise<void | undefined>[];\n\n\t\tif (sideEffects.triggerActions?.length) {\n\t\t\tpromises = sideEffects.triggerActions.map(async (actionName): Promise<void> => {\n\t\t\t\treturn this.executeAction(actionName, context);\n\t\t\t});\n\t\t} else {\n\t\t\tpromises = [];\n\t\t}\n\n\t\tif (sideEffects.pathExpressions?.length) {\n\t\t\tpromises.push(this.requestSideEffects(sideEffects.pathExpressions, context));\n\t\t}\n\n\t\treturn promises.length ? Promise.all(promises) : Promise.resolve([]);\n\t}\n\n\t/**\n\t * Requests the SideEffects for a navigation property on a specific context.\n\t * @param navigationProperty Navigation property\n\t * @param context Context where SideEffects need to be executed\n\t * @param groupId Batch group for the query\n\t * @param ignoreTriggerActions If true, we do not trigger actions defined in the side effect\n\t * @returns SideEffects request on SAPUI5 context\n\t */\n\tpublic async requestSideEffectsForNavigationProperty(\n\t\tnavigationProperty: string,\n\t\tcontext: Context,\n\t\tgroupId?: string,\n\t\tignoreTriggerActions = false\n\t): Promise<void | undefined> {\n\t\tconst baseEntityType = this.getEntityTypeFromContext(context);\n\t\tif (baseEntityType) {\n\t\t\tconst navigationPath = `${navigationProperty}/`;\n\t\t\tconst entitySideEffects = this.getODataEntitySideEffects(baseEntityType);\n\t\t\tlet targetProperties: string[] = [];\n\t\t\tlet targetEntities: SideEffectsEntityType[] = [];\n\t\t\tlet sideEffectsTargets: SideEffectsTarget[] = [];\n\t\t\tObject.keys(entitySideEffects)\n\t\t\t\t.filter(\n\t\t\t\t\t// Keep relevant SideEffects\n\t\t\t\t\t// 1. SourceEntities match OR\n\t\t\t\t\t// 2. Only 1 SourceProperties and match\n\t\t\t\t\t(annotationName) => {\n\t\t\t\t\t\tconst sideEffects: ODataSideEffectsType = entitySideEffects[annotationName];\n\t\t\t\t\t\treturn (\n\t\t\t\t\t\t\t(sideEffects.sourceEntities || []).some(\n\t\t\t\t\t\t\t\t(navigation) => navigation.$NavigationPropertyPath === navigationProperty\n\t\t\t\t\t\t\t) ||\n\t\t\t\t\t\t\t(sideEffects.sourceProperties?.length === 1 &&\n\t\t\t\t\t\t\t\tsideEffects.sourceProperties.some(\n\t\t\t\t\t\t\t\t\t(propertyPath) =>\n\t\t\t\t\t\t\t\t\t\tpropertyPath.startsWith(navigationPath) && !propertyPath.replace(navigationPath, \"\").includes(\"/\")\n\t\t\t\t\t\t\t\t))\n\t\t\t\t\t\t);\n\t\t\t\t\t}\n\t\t\t\t)\n\t\t\t\t.forEach((sAnnotationName) => {\n\t\t\t\t\tconst sideEffects = entitySideEffects[sAnnotationName];\n\t\t\t\t\tif (sideEffects.triggerAction && !ignoreTriggerActions) {\n\t\t\t\t\t\tthis.executeAction(sideEffects.triggerAction, context, { groupId });\n\t\t\t\t\t}\n\t\t\t\t\ttargetProperties = targetProperties.concat(sideEffects.targetProperties);\n\t\t\t\t\ttargetEntities = targetEntities.concat(sideEffects.targetEntities);\n\t\t\t\t});\n\t\t\t// Remove duplicate targets\n\t\t\tconst sideEffectsTargetDefinition = this.removeDuplicateTargets({\n\t\t\t\ttargetProperties: targetProperties,\n\t\t\t\ttargetEntities: targetEntities\n\t\t\t});\n\t\t\tsideEffectsTargets = [...sideEffectsTargetDefinition.targetProperties, ...sideEffectsTargetDefinition.targetEntities];\n\t\t\tif (sideEffectsTargets.length) {\n\t\t\t\treturn this.requestSideEffects(sideEffectsTargets, context, groupId).catch((error) =>\n\t\t\t\t\tLog.error(`SideEffects - Error while processing SideEffects for Navigation Property ${navigationProperty}`, error)\n\t\t\t\t);\n\t\t\t}\n\t\t}\n\t\treturn Promise.resolve();\n\t}\n\n\t/**\n\t * Gets the SideEffects that come from controls.\n\t * @param entityTypeName Entity type Name\n\t * @returns SideEffects dictionary\n\t */\n\tpublic getControlEntitySideEffects(entityTypeName: string): Record<string, ControlSideEffectsType> {\n\t\treturn this.sideEffectsRegistry.control[entityTypeName] || {};\n\t}\n\n\t/**\n\t * Gets SideEffects' qualifier and owner entity where this entity is used as source.\n\t * @param entityTypeName Entity type fully qualified name\n\t * @returns Array of sideEffects info\n\t */\n\tpublic getSideEffectWhereEntityIsSource(entityTypeName: string): SideEffectInfoForSource[] {\n\t\treturn this.sourcesToSideEffectMappings.entities[entityTypeName] || [];\n\t}\n\n\t/**\n\t * Gets SideEffects' qualifiers where this event is used as source.\n\t * @param entityTypeName Entity type fully qualified\n\t * @param eventName Side Effect event name\n\t * @returns Array of sideEffects info\n\t */\n\tpublic getSideEffectWhereEventIsSource(entityTypeName: string, eventName: string): SideEffectInfoForSource[] {\n\t\treturn this.sourcesToSideEffectMappings.events[eventName]?.filter((event) => event.entity === entityTypeName) || [];\n\t}\n\n\t/**\n\t * Requests the SideEffects for a sideEffect event on a specific context.\n\t * @param event SideEffects event which should be\n\t * @param context Context where SideEffects need to be executed\n\t * @param groupId The group ID to be used for the request\n\t * @returns Promise on SideEffects request\n\t */\n\tasync requestSideEffectsForEvent(event: string, context: Context, groupId?: string): Promise<undefined> {\n\t\tconst sideEffects = this.getODataSideEffectsFromContextEvent(context, event);\n\t\tlet targetProperties: string[] = [];\n\t\tlet targetEntities: SideEffectsEntityType[] = [];\n\n\t\tsideEffects.forEach((sideEffect) => {\n\t\t\ttargetProperties = targetProperties.concat(sideEffect.targetProperties);\n\t\t\ttargetEntities = targetEntities.concat(sideEffect.targetEntities);\n\t\t});\n\n\t\tconst sideEffectsTargetDefinition = this.removeDuplicateTargets({\n\t\t\ttargetProperties: targetProperties,\n\t\t\ttargetEntities: targetEntities\n\t\t});\n\t\tconst sideEffectsTargets = [...sideEffectsTargetDefinition.targetProperties, ...sideEffectsTargetDefinition.targetEntities];\n\t\tif (sideEffectsTargets.length) {\n\t\t\ttry {\n\t\t\t\tawait this.requestSideEffects(sideEffectsTargets, context, groupId);\n\t\t\t} catch (error) {\n\t\t\t\tLog.error(`SideEffects - Error while processing SideEffects for Event ${event}`, error as string);\n\t\t\t}\n\t\t}\n\t}\n\n\t/**\n\t * Common method to get the field groupIds for a source entity and a source property.\n\t * @param sourceEntityType\n\t * @param sourceProperty\n\t * @returns A collection of fieldGroupIds\n\t */\n\tpublic computeFieldGroupIds(sourceEntityType: string, sourceProperty: string): string[] {\n\t\tconst entityFieldGroupIds = this.getSideEffectWhereEntityIsSource(sourceEntityType).map((sideEffectInfo) =>\n\t\t\tthis.getFieldGroupIdForSideEffect(sideEffectInfo, true)\n\t\t);\n\t\treturn entityFieldGroupIds.concat(\n\t\t\tthis.getSideEffectWherePropertyIsSource(sourceProperty).map((sideEffectInfo) =>\n\t\t\t\tthis.getFieldGroupIdForSideEffect(sideEffectInfo)\n\t\t\t)\n\t\t);\n\t}\n\n\t/**\n\t * Gets SideEffects' qualifier and owner entity where this property is used as source.\n\t * @param propertyName Property fully qualified name\n\t * @returns Array of sideEffects info\n\t */\n\tpublic getSideEffectWherePropertyIsSource(propertyName: string): SideEffectInfoForSource[] {\n\t\treturn this.sourcesToSideEffectMappings.properties[propertyName] || [];\n\t}\n\n\t// check if can define whether callbacks are async. Otherwise comment\n\t// only one callback for one target\n\tpublic registerTargetCallback(target: string, callback: Function): void {\n\t\tthis.targetCallbacks[target] = callback;\n\t}\n\n\tpublic deregisterTargetCallback(target: string): void {\n\t\tdelete this.targetCallbacks[target];\n\t}\n\n\t// pass parameter\n\tpublic getRegisteredCallback(target: string): Function | undefined {\n\t\treturn this.targetCallbacks[target];\n\t}\n\n\t/**\n\t * Returns updated side effects definition with all text related properties.\n\t * @param sideEffectsTargets The targets of the side effect\n\t * @param entityType Name of the entity where the side effect is registered\n\t * @returns Updated side effects' targets with added text properties or entities\n\t */\n\tprivate addTextProperties(sideEffectsTargets: SideEffectsTargetType, entityType?: EntityType): SideEffectsTargetType {\n\t\tconst setOfProperties = new Set(sideEffectsTargets.targetProperties);\n\t\tconst setOfEntities = new Set(sideEffectsTargets.targetEntities.map((target) => target.$NavigationPropertyPath));\n\t\t// Generate all paths related to the text properties and not already covered by the SideEffects\n\t\tfor (const propertyPath of sideEffectsTargets.targetProperties) {\n\t\t\tfor (const dataModelPropertyPath of this.getDataModelPropertiesFromAPath(propertyPath, entityType)) {\n\t\t\t\tconst associatedTextPath = getAssociatedTextPropertyPath(dataModelPropertyPath.targetObject);\n\t\t\t\tif (associatedTextPath) {\n\t\t\t\t\tthis.addTextProperty(dataModelPropertyPath, propertyPath, associatedTextPath, setOfProperties, setOfEntities);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\treturn {\n\t\t\ttargetProperties: Array.from(setOfProperties),\n\t\t\ttargetEntities: Array.from(setOfEntities).map((navigation) => {\n\t\t\t\treturn { $NavigationPropertyPath: navigation };\n\t\t\t})\n\t\t};\n\t}\n\n\t/**\n\t * Adds text related property to the side effects targets\n\t * If the property has an associated text then this text needs to be added if it's not already reflected in the side effects definition:\n\t * - as targetProperties if the property and its associated text are on the same entitySet\n\t * - as targetEntities if they are defined on different entitySets.\n\t * @param dataModelPropertyPath The model object path of the property\n\t * @param propertyPath The property path\n\t * @param associatedTextPath The associated text property path\n\t * @param setOfProperties Set of existing sideEffect's target properties\n\t * @param setOfEntities Set of existing sideEffect's target entities\n\t */\n\tprivate addTextProperty(\n\t\tdataModelPropertyPath: DataModelObjectPath<Property>,\n\t\tpropertyPath: string,\n\t\tassociatedTextPath: string,\n\t\tsetOfProperties: Set<string>,\n\t\tsetOfEntities: Set<string>\n\t): void {\n\t\tconst dataModelTextPath = enhanceDataModelPath<Property>(dataModelPropertyPath, associatedTextPath);\n\t\tconst relativeNavigation =\n\t\t\tpropertyPath.startsWith(\"/\") &&\n\t\t\tdataModelTextPath.targetEntitySet &&\n\t\t\tdataModelTextPath.targetEntitySet.name !== dataModelPropertyPath.targetEntitySet?.name\n\t\t\t\t? `/${dataModelTextPath.targetEntitySet?.fullyQualifiedName}`\n\t\t\t\t: getTargetNavigationPath(dataModelTextPath, true);\n\t\tconst targetPath = propertyPath.startsWith(\"/\")\n\t\t\t? `/${dataModelTextPath.targetEntitySet?.fullyQualifiedName}/${dataModelTextPath.targetObject!.name}`\n\t\t\t: getTargetObjectPath(dataModelTextPath, true);\n\t\tif (\n\t\t\tthis.isAssociatedTextListedInSideEffectTargets(\n\t\t\t\tdataModelTextPath,\n\t\t\t\trelativeNavigation,\n\t\t\t\ttargetPath,\n\t\t\t\tsetOfProperties,\n\t\t\t\tsetOfEntities\n\t\t\t)\n\t\t) {\n\t\t\tif (this.isPropertyAssociatedTextOnDifferentEntitySet(dataModelPropertyPath, dataModelTextPath)) {\n\t\t\t\tsetOfEntities.add(relativeNavigation);\n\t\t\t} else {\n\t\t\t\tsetOfProperties.add(targetPath);\n\t\t\t}\n\t\t}\n\t}\n\n\t/**\n\t * Checks if the associated text property needs to be added if it's not already reflected in the side effects definition:\n\t * - as targetProperties if the property and its associated text are on the same entitySet\n\t * - as targetEntities if they are defined on different entitySets.\n\t * @param dataModelTextPath The model object path of the associated text\n\t * @param relativeNavigation The navigation to the text property\n\t * @param targetPath The associated text property path\n\t * @param setOfProperties Set of existing sideEffect's target properties\n\t * @param setOfEntities Set of existing sideEffect's target entities\n\t * @returns Updated side effects' targets with added text property or entity\n\t */\n\tprivate isAssociatedTextListedInSideEffectTargets(\n\t\tdataModelTextPath: DataModelObjectPath<Property>,\n\t\trelativeNavigation: string,\n\t\ttargetPath: string,\n\t\tsetOfProperties: Set<string>,\n\t\tsetOfEntities: Set<string>\n\t): boolean {\n\t\treturn (\n\t\t\tisProperty(dataModelTextPath.targetObject) &&\n\t\t\t!setOfProperties.has(targetPath) && // the property is already listed\n\t\t\t!setOfProperties.has(`${relativeNavigation}${dataModelTextPath.navigationProperties.length ? \"/\" : \"\"}*`) && // the property is already listed thanks to the \"*\"\n\t\t\t!setOfEntities.has(`${relativeNavigation}`) // the property is not part of a TargetEntities\n\t\t);\n\t}\n\n\t/**\n\t * Checks if the property and its associated text property are on different entitySet.\n\t * @param dataModelPropertyPath The model object path of the property\n\t * @param dataModelTextPath The model object path of the associated text property\n\t * @returns True if the entitySet is different\n\t */\n\tprivate isPropertyAssociatedTextOnDifferentEntitySet(\n\t\tdataModelPropertyPath: DataModelObjectPath<Property>,\n\t\tdataModelTextPath: DataModelObjectPath<Property>\n\t): boolean {\n\t\treturn (\n\t\t\tdataModelPropertyPath.targetEntitySet !== dataModelTextPath.targetEntitySet &&\n\t\t\t!!dataModelTextPath.navigationProperties &&\n\t\t\t!!dataModelTextPath.targetEntityType\n\t\t);\n\t}\n\n\t/**\n\t * Converts the SideEffects to expected format\n\t * - Set TriggerAction as string\n\t * - Converts SideEffects targets to expected format\n\t * - Removes binding parameter from SideEffects targets properties\n\t * - Adds the text properties\n\t * - Replaces TargetProperties having reference to Source Properties for a SideEffects.\n\t * @param sideEffects SideEffects definition\n\t * @param entityType Entity type\n\t * @param bindingParameter Name of the binding parameter\n\t * @returns SideEffects definition\n\t */\n\tprivate convertSideEffects(\n\t\tsideEffects: CommonSideEffectsType,\n\t\tentityType?: EntityType,\n\t\tbindingParameter?: string\n\t): ODataSideEffectsType {\n\t\tconst triggerAction = sideEffects.TriggerAction as string;\n\t\tconst newSideEffects = this.convertSideEffectsFormat(sideEffects);\n\t\tlet sideEffectsTargets = { targetProperties: newSideEffects.targetProperties, targetEntities: newSideEffects.targetEntities };\n\t\tsideEffectsTargets = this.removeBindingParameter(sideEffectsTargets, bindingParameter);\n\t\tsideEffectsTargets = this.addTextProperties(sideEffectsTargets, entityType);\n\t\tsideEffectsTargets = this.removeDuplicateTargets(sideEffectsTargets);\n\t\treturn {\n\t\t\t...newSideEffects,\n\t\t\t...{ targetEntities: sideEffectsTargets.targetEntities, targetProperties: sideEffectsTargets.targetProperties, triggerAction }\n\t\t};\n\t}\n\n\t/**\n\t * Converts the SideEffects targets (TargetEntities and TargetProperties) to expected format\n\t * - TargetProperties as array of string\n\t * - TargetEntities as array of object with property $NavigationPropertyPath.\n\t * @param sideEffects SideEffects definition\n\t * @returns Converted SideEffects\n\t */\n\tprivate convertSideEffectsFormat(sideEffects: CommonSideEffectsType): ODataSideEffectsType {\n\t\tconst formatProperties = (properties?: (string | PropertyPath)[]): string[] | undefined => {\n\t\t\treturn properties\n\t\t\t\t? properties.reduce((targetProperties: string[], target) => {\n\t\t\t\t\t\tlet path = \"\";\n\t\t\t\t\t\tif (isPropertyPathExpression(target)) {\n\t\t\t\t\t\t\tpath = target.value;\n\t\t\t\t\t\t} else if (typeof target === \"string\") {\n\t\t\t\t\t\t\tpath = target;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif (path) {\n\t\t\t\t\t\t\ttargetProperties.push(path);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tLog.error(\n\t\t\t\t\t\t\t\t`SideEffects - Error while processing TargetProperties for SideEffects ${sideEffects.fullyQualifiedName}`\n\t\t\t\t\t\t\t);\n\t\t\t\t\t\t}\n\t\t\t\t\t\treturn targetProperties;\n\t\t\t\t  }, [])\n\t\t\t\t: properties;\n\t\t};\n\t\tconst formatEntities = (entities?: NavigationPropertyPath[]): { $NavigationPropertyPath: string }[] | undefined => {\n\t\t\treturn entities\n\t\t\t\t? entities.map((targetEntity) => {\n\t\t\t\t\t\treturn { $NavigationPropertyPath: targetEntity.value };\n\t\t\t\t  })\n\t\t\t\t: entities;\n\t\t};\n\n\t\t// TODO: SourceEvents are still experimental, remove once public\n\t\ttype CommonSideEffectTypeWithSourceEvents = CommonSideEffectsType & { SourceEvents?: Edm.String[] };\n\n\t\treturn {\n\t\t\tfullyQualifiedName: sideEffects.fullyQualifiedName,\n\t\t\tsourceProperties: formatProperties(sideEffects.SourceProperties),\n\t\t\tsourceEntities: formatEntities(sideEffects.SourceEntities),\n\t\t\tsourceEvents: (sideEffects as CommonSideEffectTypeWithSourceEvents).SourceEvents as string[],\n\t\t\ttargetProperties: formatProperties(sideEffects.TargetProperties as (string | PropertyPath)[]) ?? [],\n\t\t\ttargetEntities: formatEntities(sideEffects.TargetEntities) ?? []\n\t\t};\n\t}\n\n\t/**\n\t * Gets all dataModelObjectPath related to properties listed by a path\n\t *\n\t * The path can be:\n\t * - a path targeting a property on a complexType or an EntityType\n\t * - a path with a star targeting all properties on a complexType or an EntityType.\n\t * - absolute.\n\t * @param propertyPath The path to analyze\n\t * @param entityType Entity type\n\t * @returns Array of dataModelObjectPath representing the properties\n\t */\n\tprivate getDataModelPropertiesFromAPath(propertyPath: string, entityType?: EntityType): DataModelObjectPath<Property>[] {\n\t\tlet dataModelObjectPaths: DataModelObjectPath<Property>[] = [];\n\t\tconst convertedMetaModel = this.getConvertedMetaModel();\n\n\t\tlet propertyRelativePath: string | undefined, testEntityTypeName: string | undefined, match: RegExpMatchArray | null;\n\t\tif (propertyPath.startsWith(`/${this.containerName}/`)) {\n\t\t\tmatch = propertyPath.match(this.containerRegexPattern);\n\t\t\tpropertyRelativePath = match ? match[1] : undefined;\n\t\t}\n\t\tif (!entityType) {\n\t\t\tmatch = propertyPath.match(this.entityTypeRegexPattern);\n\t\t\ttestEntityTypeName = match ? match[1] : undefined;\n\t\t}\n\t\tconst testEntityType =\n\t\t\tentityType ??\n\t\t\t((testEntityTypeName ? convertedMetaModel.resolvePath(`/${testEntityTypeName}/`).target : undefined) as EntityType | undefined);\n\t\tconst entitySet =\n\t\t\tconvertedMetaModel.entitySets.find((relatedEntitySet) => relatedEntitySet.entityType === testEntityType) ??\n\t\t\tconvertedMetaModel.singletons.find((singleton) => singleton.entityType === testEntityType);\n\t\tif (entitySet) {\n\t\t\tconst metaModel = this.getMetaModel(),\n\t\t\t\tentitySetContext = metaModel.createBindingContext(`/${entitySet.name}`);\n\t\t\tif (entitySetContext) {\n\t\t\t\tconst dataModelEntitySet = getInvolvedDataModelObjects(entitySetContext);\n\t\t\t\tconst dataModelObjectPath = enhanceDataModelPath<Property | EntityType>(\n\t\t\t\t\t\tdataModelEntitySet,\n\t\t\t\t\t\t(propertyRelativePath || propertyPath).replace(\"*\", \"\") || \"/\"\n\t\t\t\t\t), // \"*\" is replaced by \"/\" to target the current EntityType\n\t\t\t\t\ttargetObject = dataModelObjectPath.targetObject;\n\t\t\t\tif (isProperty(targetObject)) {\n\t\t\t\t\tif (isComplexType(targetObject.targetType)) {\n\t\t\t\t\t\tdataModelObjectPaths = dataModelObjectPaths.concat(\n\t\t\t\t\t\t\ttargetObject.targetType.properties.map((property) =>\n\t\t\t\t\t\t\t\tenhanceDataModelPath<Property>(dataModelObjectPath, property.name)\n\t\t\t\t\t\t\t)\n\t\t\t\t\t\t);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tdataModelObjectPaths.push(dataModelObjectPath as DataModelObjectPath<Property>);\n\t\t\t\t\t}\n\t\t\t\t} else if (isEntityType(targetObject)) {\n\t\t\t\t\tdataModelObjectPaths = dataModelObjectPaths.concat(\n\t\t\t\t\t\tdataModelObjectPath.targetEntityType.entityProperties.map((entityProperty) => {\n\t\t\t\t\t\t\treturn enhanceDataModelPath<Property>(dataModelObjectPath, entityProperty.name);\n\t\t\t\t\t\t})\n\t\t\t\t\t);\n\t\t\t\t}\n\t\t\t\tentitySetContext.destroy();\n\t\t\t}\n\t\t}\n\t\treturn dataModelObjectPaths.filter((dataModelObjectPath) => dataModelObjectPath.targetObject);\n\t}\n\n\t/**\n\t * Gets the Odata metamodel.\n\t * @returns The OData metamodel\n\t */\n\tprivate getMetaModel(): ODataMetaModel {\n\t\treturn this.appComponent.getModel().getMetaModel();\n\t}\n\n\t/**\n\t * Gets the SideEffects related to an entity type or action that come from an OData Service\n\t * Internal routine to get, from converted oData metaModel, SideEffects related to a specific entity type or action\n\t * and to convert these SideEffects with expected format.\n\t * @param source Entity type or action\n\t * @returns Array of SideEffects\n\t */\n\tprivate getSideEffectsFromSource(source: EntityType | Action): ODataSideEffectsType[] {\n\t\tlet bindingAlias = \"\";\n\t\tconst isSourceEntityType = isEntityType(source);\n\t\tconst entityType: EntityType | undefined = isSourceEntityType ? source : source.sourceEntityType;\n\t\tconst commonAnnotation = source.annotations?.Common as undefined | unknown as Record<string, CommonAnnotationTypes>;\n\t\tif (commonAnnotation) {\n\t\t\tif (entityType && !isSourceEntityType) {\n\t\t\t\tconst bindingParameter = source.parameters?.find((parameter) => parameter.type === entityType.fullyQualifiedName);\n\t\t\t\tbindingAlias = bindingParameter?.fullyQualifiedName.split(\"/\")[1] ?? \"\";\n\t\t\t}\n\t\t\treturn this.getSideEffectsAnnotationFromSource(source).map((sideEffectAnno) =>\n\t\t\t\tthis.convertSideEffects(sideEffectAnno, entityType, bindingAlias)\n\t\t\t);\n\t\t}\n\t\treturn [];\n\t}\n\n\t/**\n\t * Gets the SideEffects related to an entity type or action that come from an OData Service\n\t * Internal routine to get, from converted oData metaModel, SideEffects related to a specific entity type or action.\n\t * @param source Entity type or action\n\t * @returns Array of SideEffects\n\t */\n\tprivate getSideEffectsAnnotationFromSource(source: EntityType | Action): CommonSideEffectTypeWithQualifier[] {\n\t\tconst sideEffects: CommonSideEffectsType[] = [];\n\t\tconst commonAnnotation = source.annotations?.Common as undefined | unknown as Record<string, CommonSideEffectTypeWithQualifier>;\n\t\tfor (const key in commonAnnotation) {\n\t\t\tconst annotation = commonAnnotation[key];\n\t\t\tif (this.isSideEffectsAnnotation(annotation)) {\n\t\t\t\tsideEffects.push(annotation);\n\t\t\t}\n\t\t}\n\t\treturn sideEffects;\n\t}\n\n\t/**\n\t * Checks if the annotation is a SideEffects annotation.\n\t * @param annotation Annotation\n\t * @returns Boolean\n\t */\n\tprivate isSideEffectsAnnotation(annotation: unknown): annotation is CommonSideEffectsType {\n\t\treturn (annotation as CommonSideEffectsType)?.$Type === CommonAnnotationTypes.SideEffectsType;\n\t}\n\n\t/**\n\t * Logs the SideEffects request.\n\t * @param pathExpressions SideEffects targets\n\t * @param context Context\n\t */\n\tprivate logRequest(pathExpressions: SideEffectsTarget[], context: Context): void {\n\t\tconst targetPaths = pathExpressions.reduce(function (paths, target) {\n\t\t\treturn `${paths}\\n\\t\\t${(target as SideEffectsEntityType).$NavigationPropertyPath || target || \"\"}`;\n\t\t}, \"\");\n\t\tLog.debug(`SideEffects - Request:\\n\\tContext path : ${context.getPath()}\\n\\tProperty paths :${targetPaths}`);\n\t}\n\n\t/**\n\t * Removes the name of the binding parameter on the SideEffects targets.\n\t * @param sideEffectsTargets SideEffects Targets\n\t * @param bindingParameterName Name of binding parameter\n\t * @returns SideEffects definition\n\t */\n\tprivate removeBindingParameter(sideEffectsTargets: SideEffectsTargetType, bindingParameterName?: string): SideEffectsTargetType {\n\t\tif (bindingParameterName) {\n\t\t\tconst replaceBindingParameter = function (value: string): string {\n\t\t\t\treturn value.replace(new RegExp(`^${bindingParameterName}/?`), \"\");\n\t\t\t};\n\t\t\treturn {\n\t\t\t\ttargetProperties: sideEffectsTargets.targetProperties.map((targetProperty) => replaceBindingParameter(targetProperty)),\n\t\t\t\ttargetEntities: sideEffectsTargets.targetEntities.map((targetEntity) => {\n\t\t\t\t\treturn { $NavigationPropertyPath: replaceBindingParameter(targetEntity.$NavigationPropertyPath) };\n\t\t\t\t})\n\t\t\t};\n\t\t}\n\t\treturn {\n\t\t\ttargetProperties: sideEffectsTargets.targetProperties,\n\t\t\ttargetEntities: sideEffectsTargets.targetEntities\n\t\t};\n\t}\n\n\t/**\n\t * Remove duplicates in SideEffects targets.\n\t * @param sideEffectsTargets SideEffects Targets\n\t * @returns SideEffects targets without duplicates\n\t */\n\tprivate removeDuplicateTargets(sideEffectsTargets: SideEffectsTargetType): SideEffectsTargetType {\n\t\tconst targetEntitiesPaths = sideEffectsTargets.targetEntities.map((targetEntity) => targetEntity.$NavigationPropertyPath);\n\t\tconst uniqueTargetedEntitiesPath = new Set<string>(targetEntitiesPaths);\n\t\tconst uniqueTargetProperties = new Set<string>(sideEffectsTargets.targetProperties);\n\n\t\tconst uniqueTargetedEntities = Array.from(uniqueTargetedEntitiesPath).map((entityPath) => {\n\t\t\treturn {\n\t\t\t\t$NavigationPropertyPath: entityPath\n\t\t\t};\n\t\t});\n\n\t\treturn { targetProperties: Array.from(uniqueTargetProperties), targetEntities: uniqueTargetedEntities };\n\t}\n\n\t/**\n\t * Gets SideEffects action type that come from an OData Service\n\t * Internal routine to get, from converted oData metaModel, SideEffects on actions\n\t * related to a specific entity type and to convert these SideEffects with\n\t * expected format.\n\t * @param action Action\n\t * @returns Entity type SideEffects dictionary\n\t */\n\tprivate retrieveODataActionsSideEffects(action: Action): Record<string, ActionSideEffectsType> {\n\t\tconst sideEffects: Record<string, ActionSideEffectsType> = {};\n\t\tconst triggerActions = new Set<string>();\n\t\tlet targetProperties: string[] = [];\n\t\tlet targetEntities: SideEffectsEntityType[] = [];\n\n\t\tthis.getSideEffectsFromSource(action).forEach((oDataSideEffect) => {\n\t\t\tconst triggerAction = oDataSideEffect.triggerAction;\n\t\t\ttargetProperties = targetProperties.concat(oDataSideEffect.targetProperties);\n\t\t\ttargetEntities = targetEntities.concat(oDataSideEffect.targetEntities);\n\t\t\tif (triggerAction) {\n\t\t\t\ttriggerActions.add(triggerAction);\n\t\t\t}\n\t\t});\n\t\tconst sideEffectsTargets = this.removeDuplicateTargets({ targetProperties, targetEntities });\n\t\tconst actionName = action.isBound ? action.fullyQualifiedName.match(/^[^(]+/)?.[0] : action.name;\n\t\tsideEffects[actionName!] = {\n\t\t\tpathExpressions: [...sideEffectsTargets.targetProperties, ...sideEffectsTargets.targetEntities],\n\t\t\ttriggerActions: Array.from(triggerActions)\n\t\t};\n\t\treturn sideEffects;\n\t}\n\n\t/**\n\t * Gets SideEffects entity type that come from an OData Service\n\t * Internal routine to get, from converted oData metaModel, SideEffects\n\t * related to a specific entity type and to convert these SideEffects with\n\t * expected format.\n\t * @param entityType Entity type\n\t * @returns Entity type SideEffects dictionary\n\t */\n\tprivate retrieveODataEntitySideEffects(entityType: EntityType): Record<string, ODataSideEffectsType> {\n\t\tconst entitySideEffects: Record<string, ODataSideEffectsType> = {};\n\t\tthis.getSideEffectsFromSource(entityType).forEach((sideEffects) => {\n\t\t\tentitySideEffects[sideEffects.fullyQualifiedName] = sideEffects;\n\t\t});\n\t\treturn entitySideEffects;\n\t}\n\n\t/**\n\t * Defines a map for the Sources of sideEffect on the entity to track where those sources are used in SideEffects annotation.\n\t * @param entityType The entityType we look for side Effects annotation\n\t * @param sideEffectsSources The mapping object in construction\n\t * @param sideEffectsSources.entities\n\t * @param sideEffectsSources.properties\n\t * @param sideEffectsSources.events\n\t */\n\tprivate mapSideEffectSources(\n\t\tentityType: EntityType,\n\t\tsideEffectsSources: {\n\t\t\tentities: Record<string, SideEffectInfoForSource[]>;\n\t\t\tproperties: Record<string, SideEffectInfoForSource[]>;\n\t\t\tevents: Record<string, SideEffectInfoForSource[]>;\n\t\t}\n\t): void {\n\t\tfor (const sideEffectDefinition of this.getSideEffectsAnnotationFromSource(entityType)) {\n\t\t\tthis.mapSideEffectSourceEntities(entityType, sideEffectsSources, sideEffectDefinition);\n\t\t\tthis.mapSideEffectSourceProperties(entityType, sideEffectsSources, sideEffectDefinition);\n\t\t\tthis.mapSideEffectSourceEvents(entityType, sideEffectsSources, sideEffectDefinition);\n\t\t}\n\t}\n\n\t/**\n\t * Fills the map for the Sources of sideEffect with source entities.\n\t * @param entityType The entityType we look for side Effects annotation\n\t * @param sideEffectsSources The mapping object in construction\n\t * @param sideEffectsSources.entities\n\t * @param sideEffectsSources.properties\n\t * @param sideEffectsSources.events\n\t * @param sideEffectDefinition The side effect definition to be evaluated\n\t */\n\tprivate mapSideEffectSourceEntities(\n\t\tentityType: EntityType,\n\t\tsideEffectsSources: {\n\t\t\tentities: Record<string, SideEffectInfoForSource[]>;\n\t\t\tproperties: Record<string, SideEffectInfoForSource[]>;\n\t\t\tevents: Record<string, SideEffectInfoForSource[]>;\n\t\t},\n\t\tsideEffectDefinition: CommonSideEffectTypeWithQualifier\n\t): void {\n\t\tfor (const sourceEntity of sideEffectDefinition.SourceEntities ?? []) {\n\t\t\tconst targetEntityType = sourceEntity.value ? sourceEntity.$target?.targetType : entityType;\n\t\t\tif (targetEntityType) {\n\t\t\t\tif (!sideEffectsSources.entities[targetEntityType.fullyQualifiedName]) {\n\t\t\t\t\tsideEffectsSources.entities[targetEntityType.fullyQualifiedName] = [];\n\t\t\t\t}\n\t\t\t\tsideEffectsSources.entities[targetEntityType.fullyQualifiedName].push({\n\t\t\t\t\tentity: entityType.fullyQualifiedName,\n\t\t\t\t\tqualifier: sideEffectDefinition.qualifier\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\t}\n\n\t/**\n\t * Fills the map for the Sources of sideEffect with source properties.\n\t * @param entityType The entityType we look for side Effects annotation\n\t * @param sideEffectsSources The mapping object in construction\n\t * @param sideEffectsSources.entities\n\t * @param sideEffectsSources.properties\n\t * @param sideEffectsSources.events\n\t * @param sideEffectDefinition The side effect definition to be evaluated\n\t */\n\tprivate mapSideEffectSourceProperties(\n\t\tentityType: EntityType,\n\t\tsideEffectsSources: {\n\t\t\tentities: Record<string, SideEffectInfoForSource[]>;\n\t\t\tproperties: Record<string, SideEffectInfoForSource[]>;\n\t\t\tevents: Record<string, SideEffectInfoForSource[]>;\n\t\t},\n\t\tsideEffectDefinition: CommonSideEffectTypeWithQualifier\n\t): void {\n\t\tconst hasUniqueSourceProperty = sideEffectDefinition.SourceProperties?.length === 1;\n\t\tfor (const sourceProperty of sideEffectDefinition.SourceProperties ?? []) {\n\t\t\tif (sourceProperty.$target) {\n\t\t\t\tif (!sideEffectsSources.properties[sourceProperty.$target.fullyQualifiedName]) {\n\t\t\t\t\tsideEffectsSources.properties[sourceProperty.$target.fullyQualifiedName] = [];\n\t\t\t\t}\n\t\t\t\tsideEffectsSources.properties[sourceProperty.$target.fullyQualifiedName].push({\n\t\t\t\t\tentity: entityType.fullyQualifiedName,\n\t\t\t\t\tqualifier: sideEffectDefinition.qualifier,\n\t\t\t\t\thasUniqueSourceProperty\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\t}\n\n\t/**\n\t * Fills the map for the Sources of sideEffect with source events.\n\t * @param entityType The entityType we look for side Effects annotation\n\t * @param sideEffectsSources The mapping object in construction\n\t * @param sideEffectsSources.entities\n\t * @param sideEffectsSources.properties\n\t * @param sideEffectsSources.events\n\t * @param sideEffectDefinition The side effect definition to be evaluated\n\t */\n\tprivate mapSideEffectSourceEvents(\n\t\tentityType: EntityType,\n\t\tsideEffectsSources: {\n\t\t\tentities: Record<string, SideEffectInfoForSource[]>;\n\t\t\tproperties: Record<string, SideEffectInfoForSource[]>;\n\t\t\tevents: Record<string, SideEffectInfoForSource[]>;\n\t\t},\n\t\tsideEffectDefinition: CommonSideEffectTypeWithQualifier\n\t): void {\n\t\tfor (const sourceEvent of sideEffectDefinition.SourceEvents ?? []) {\n\t\t\tif (!sideEffectsSources.events[sourceEvent.toString()]) {\n\t\t\t\tsideEffectsSources.events[sourceEvent.toString()] = [];\n\t\t\t}\n\t\t\tsideEffectsSources.events[sourceEvent.toString()].push({\n\t\t\t\tentity: entityType.fullyQualifiedName,\n\t\t\t\tqualifier: sideEffectDefinition.qualifier\n\t\t\t});\n\t\t}\n\t}\n\n\t/**\n\t * Get the fieldGroupId based on the stored information on th side effect.\n\t * @param sideEffectInfo\n\t * @param isImmediate\n\t * @returns A string for the fieldGroupId.\n\t */\n\tprivate getFieldGroupIdForSideEffect(sideEffectInfo: SideEffectInfoForSource, isImmediate = false): string {\n\t\tconst sideEffectWithQualifier = sideEffectInfo.qualifier\n\t\t\t? `${sideEffectInfo.entity}#${sideEffectInfo.qualifier}`\n\t\t\t: sideEffectInfo.entity;\n\t\treturn isImmediate || sideEffectInfo.hasUniqueSourceProperty === true\n\t\t\t? `${sideEffectWithQualifier}$$ImmediateRequest`\n\t\t\t: sideEffectWithQualifier;\n\t}\n\n\tgetInterface(): SideEffectsService {\n\t\treturn this;\n\t}\n}\n\nclass SideEffectsServiceFactory extends ServiceFactory<SideEffectsSettings> {\n\tasync createInstance(oServiceContext: ServiceContext<SideEffectsSettings>): Promise<SideEffectsService> {\n\t\tconst SideEffectsServiceService = new SideEffectsService(oServiceContext);\n\t\treturn SideEffectsServiceService.initialize();\n\t}\n}\n\nexport default SideEffectsServiceFactory;\n"],"mappings":"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","ignoreList":[],"file":"SideEffectsServiceFactory-dbg.js"}