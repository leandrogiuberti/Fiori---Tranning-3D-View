{"version":3,"file":"ResourceModelServiceFactory.js","names":["ResourceModelService","_Service","apply","this","arguments","_exports","_inheritsLoose","_proto","prototype","init","oContext","getContext","mSettings","settings","oFactory","factory","aBundles","bundles","concat","enhanceI18n","map","vI18n","isA","getResourceBundle","bundleName","replace","oResourceModel","ResourceModel","enhanceWith","slice","async","scopeType","oComponent","scopeObject","setModel","modelName","initPromise","Promise","all","_pEnhanced","resolve","then","oBundle","__bundle","getResourceModel","getInterface","exit","removeGlobalInstance","Service","ResourceModelServiceFactory","_ServiceFactory","_this","_len","length","args","Array","_key","call","_oInstances","_proto2","createInstance","oServiceContext","sKey","getId","join","Object","assign","ServiceFactory"],"sources":["./ResourceModelServiceFactory.ts"],"sourcesContent":["import type ResourceBundle from \"sap/base/i18n/ResourceBundle\";\nimport ResourceModel from \"sap/fe/core/ResourceModel\";\nimport type BaseObject from \"sap/ui/base/Object\";\nimport Service from \"sap/ui/core/service/Service\";\nimport ServiceFactory from \"sap/ui/core/service/ServiceFactory\";\nimport type { ServiceContext } from \"types/metamodel_types\";\ntype ResourceModelServiceSettings = {\n\tbundles: ResourceBundle[];\n\tenhanceI18n: string[];\n};\nexport class ResourceModelService extends Service<ResourceModelServiceSettings> {\n\tinitPromise!: Promise<this>;\n\n\toFactory!: ResourceModelServiceFactory;\n\n\toResourceModel!: ResourceModel;\n\n\tinit(): void {\n\t\tconst oContext = this.getContext();\n\t\tconst mSettings = oContext.settings;\n\t\tthis.oFactory = oContext.factory;\n\n\t\t// When enhancing i18n keys the value in the last resource bundle takes precedence\n\t\t// hence arrange various resource bundles so that enhanceI18n provided by the application is the last.\n\t\t// The following order is used :\n\t\t// 1. sap.fe bundle - sap.fe.core.messagebundle (passed with mSettings.bundles)\n\t\t// 2. sap.fe bundle - sap.fe.templates.messagebundle (passed with mSettings.bundles)\n\t\t// 3. Multiple bundles passed by the application as part of enhanceI18n\n\t\tconst aBundles = mSettings.bundles.concat(mSettings.enhanceI18n || []).map(function (vI18n: ResourceModel | string) {\n\t\t\t// if value passed for enhanceI18n is a Resource Model, return the associated bundle\n\t\t\t// else the value is a bundleUrl, return Resource Bundle configuration so that a bundle can be created\n\t\t\treturn typeof (vI18n as BaseObject).isA === \"function\" && (vI18n as BaseObject).isA(\"sap.ui.model.resource.ResourceModel\")\n\t\t\t\t? ((vI18n as ResourceModel).getResourceBundle() as ResourceBundle)\n\t\t\t\t: { bundleName: (vI18n as string).replace(/\\//g, \".\") };\n\t\t});\n\n\t\tthis.oResourceModel = new ResourceModel({\n\t\t\tbundleName: aBundles[0].bundleName,\n\t\t\tenhanceWith: aBundles.slice(1),\n\t\t\tasync: true\n\t\t});\n\n\t\tif (oContext.scopeType === \"component\") {\n\t\t\tconst oComponent = oContext.scopeObject;\n\t\t\toComponent.setModel(this.oResourceModel, mSettings.modelName);\n\t\t}\n\n\t\tthis.initPromise = Promise.all([\n\t\t\tthis.oResourceModel.getResourceBundle() as Promise<ResourceBundle>,\n\t\t\t(this.oResourceModel as { _pEnhanced?: boolean })._pEnhanced || Promise.resolve()\n\t\t]).then((oBundle: unknown[]) => {\n\t\t\t(this.oResourceModel as { __bundle?: unknown }).__bundle = oBundle[0];\n\t\t\treturn this;\n\t\t});\n\t}\n\n\tgetResourceModel(): ResourceModel {\n\t\treturn this.oResourceModel;\n\t}\n\n\tgetInterface(): this {\n\t\treturn this;\n\t}\n\n\texit(): void {\n\t\t// Deregister global instance\n\t\tthis.oFactory.removeGlobalInstance();\n\t}\n}\n\nclass ResourceModelServiceFactory extends ServiceFactory<ResourceModelServiceSettings> {\n\t_oInstances: Record<string, ResourceModelService> = {};\n\n\tasync createInstance(oServiceContext: ServiceContext<ResourceModelServiceSettings>): Promise<ResourceModelService> {\n\t\tconst sKey =\n\t\t\t`${oServiceContext.scopeObject.getId()}_${oServiceContext.settings.bundles.join(\",\")}` +\n\t\t\t(oServiceContext.settings.enhanceI18n ? `,${oServiceContext.settings.enhanceI18n.join(\",\")}` : \"\");\n\n\t\tif (!this._oInstances[sKey]) {\n\t\t\tthis._oInstances[sKey] = new ResourceModelService(Object.assign({ factory: this }, oServiceContext));\n\t\t}\n\n\t\treturn this._oInstances[sKey].initPromise;\n\t}\n\n\tremoveGlobalInstance(): void {\n\t\tthis._oInstances = {};\n\t}\n}\n\nexport default ResourceModelServiceFactory;\n"],"mappings":";;;;0WAUaA,EAAoB,SAAAC,GAAA,SAAAD,IAAA,OAAAC,EAAAC,MAAAC,KAAAC,YAAAD,IAAA,CAAAE,EAAAL,uBAAAM,EAAAN,EAAAC,GAAA,IAAAM,EAAAP,EAAAQ,UAAAD,EAOhCE,KAAA,SAAAA,IACC,MAAMC,EAAWP,KAAKQ,aACtB,MAAMC,EAAYF,EAASG,SAC3BV,KAAKW,SAAWJ,EAASK,QAQzB,MAAMC,EAAWJ,EAAUK,QAAQC,OAAON,EAAUO,aAAe,IAAIC,IAAI,SAAUC,GAGpF,cAAeA,EAAqBC,MAAQ,YAAeD,EAAqBC,IAAI,uCAC/ED,EAAwBE,oBAC1B,CAAEC,WAAaH,EAAiBI,QAAQ,MAAO,KACnD,GAEAtB,KAAKuB,eAAiB,IAAIC,EAAc,CACvCH,WAAYR,EAAS,GAAGQ,WACxBI,YAAaZ,EAASa,MAAM,GAC5BC,MAAO,OAGR,GAAIpB,EAASqB,YAAc,YAAa,CACvC,MAAMC,EAAatB,EAASuB,YAC5BD,EAAWE,SAAS/B,KAAKuB,eAAgBd,EAAUuB,UACpD,CAEAhC,KAAKiC,YAAcC,QAAQC,IAAI,CAC9BnC,KAAKuB,eAAeH,oBACnBpB,KAAKuB,eAA4Ca,YAAcF,QAAQG,YACtEC,KAAMC,IACPvC,KAAKuB,eAA0CiB,SAAWD,EAAQ,GACnE,OAAOvC,MAET,EAACI,EAEDqC,iBAAA,SAAAA,IACC,OAAOzC,KAAKuB,cACb,EAACnB,EAEDsC,aAAA,SAAAA,IACC,OAAO1C,IACR,EAACI,EAEDuC,KAAA,SAAAA,IAEC3C,KAAKW,SAASiC,sBACf,EAAC,OAAA/C,CAAA,CAzD+B,CAASgD,GAAO3C,EAAAL,uBAAA,IA4D3CiD,EAA2B,SAAAC,GAAA,SAAAD,IAAA,IAAAE,EAAA,QAAAC,EAAAhD,UAAAiD,OAAAC,EAAA,IAAAC,MAAAH,GAAAI,EAAA,EAAAA,EAAAJ,EAAAI,IAAA,CAAAF,EAAAE,GAAApD,UAAAoD,EAAA,CAAAL,EAAAD,EAAAO,KAAAtD,QAAAmD,IAAAnD,KAAAgD,EAChCO,YAAoD,CAAC,EAAC,OAAAP,CAAA,CAAA7C,EAAA2C,EAAAC,GAAA,IAAAS,EAAAV,EAAAzC,UAAAmD,EAEhDC,eAAN9B,eAAM8B,EAAeC,GACpB,MAAMC,EACL,GAAGD,EAAgB5B,YAAY8B,WAAWF,EAAgBhD,SAASI,QAAQ+C,KAAK,QAC/EH,EAAgBhD,SAASM,YAAc,IAAI0C,EAAgBhD,SAASM,YAAY6C,KAAK,OAAS,IAEhG,IAAK7D,KAAKuD,YAAYI,GAAO,CAC5B3D,KAAKuD,YAAYI,GAAQ,IAAI9D,EAAqBiE,OAAOC,OAAO,CAAEnD,QAASZ,MAAQ0D,GACpF,CAEA,OAAO1D,KAAKuD,YAAYI,GAAM1B,WAC/B,EAACuB,EAEDZ,qBAAA,SAAAA,IACC5C,KAAKuD,YAAc,CAAC,CACrB,EAAC,OAAAT,CAAA,CAjB+B,CAASkB,GAAc,OAoBzClB,CAA2B","ignoreList":[]}