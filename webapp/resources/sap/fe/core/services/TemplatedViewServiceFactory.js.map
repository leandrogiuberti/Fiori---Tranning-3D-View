{"version":3,"file":"TemplatedViewServiceFactory.js","names":["TemplatedViewService","_Service","apply","this","arguments","_exports","_inheritsLoose","_proto","prototype","init","aServiceDependencies","oContext","getContext","oComponent","scopeObject","oAppComponent","CommonUtils","getAppComponent","viewPreloaderService","getViewPreloaderService","oMetaModel","getMetaModel","pageId","getLocalId","getId","sStableId","getMetadata","getComponentName","aEnhanceI18n","getEnhanceI18n","sAppNamespace","oFactory","factory","i","length","oResourceModel","getModel","isA","replace","sCacheIdentifier","getName","Localization","getLanguageTag","push","ServiceFactoryRegistry","get","createInstance","scopeType","settings","bundles","enhanceI18n","modelName","then","oResourceModelService","getResourceModel","metaModel","appComponent","component","async","isCacheReady","oCacheHandlerService","validateCacheKey","getEnvironmentCapabilities","VersionInfo","load","oInfo","sTimestamp","libraries","Core","buildinfo","buildtime","forEach","oLibrary","buildTimestamp","catch","initPromise","Promise","all","aDependenciesResult","sCacheKey","TemplateConverter","MetaModelConverter","requireDependencies","createView","getInstance","invalidateIfNeeded","refreshView","oRootView","getRootControl","destroy","oView","resourceModel","stableId","getUIArea","invalidate","oError","Log","error","_getViewSettings","preprocessorContext","mServiceSettings","mViewData","oPageModel","viewType","getViewType","undefined","type","preprocessors","xml","controls","id","viewName","getViewName","viewData","cache","keys","additionalData","getAdditionalCacheData","getData","setAdditionalCacheData","value","setData","models","height","_createErrorPage","reason","oViewSettings","message","JSONModel","runAsOwner","View","create","setModel","setAggregation","getController","getPlaceholder","hideRootPlaceholder","sConverterType","converterType","sFullContextPath","getRoutingService","getTargetInformationFor","options","fullContextPath","getContextPath","oManifestContent","getManifest","oDeviceModel","Device","setDefaultBindingMode","oManifestModel","oViewDataModel","oRoutingService","getService","oTargetInfo","mOutbounds","crossNavigation","outbounds","mNavigation","getNavigation","convertedMetadata","convertTypes","getCapabilities","_enhanceNavigationConfig","definitionContext","DefinitionContext","addApplicationManifest","navigation","viewLevel","contentDensities","isDesktop","system","desktop","isPhone","phone","TemplateType","FreeStylePage","getViewData","Object","assign","TemplatedViewServiceFactory","setPageConfigurationChanges","isShareButtonVisibleForMyInbox","getShareButtonVisibilityForMyInbox","oShellServices","getShellServices","shellContentDensity","getContentDensity","sapfeManifestContent","sapFeManifestConfiguration","retrieveTextFromValueList","form","controlConfiguration","sAnnotationPath","includes","sTargetAnnotationPath","resolveDynamicExpression","TemplateModel","oDiagnostics","getDiagnostics","iIssueCount","getIssues","oConverterPageModel","convertPage","ManifestWrapper","_getControllerName","controllerName","aIssues","aAddedIssues","slice","warning","aSplitPath","split","sEntitySetPath","_getFullPathToEntitySet","bindingContexts","entitySet","createBindingContext","contextPath","converterContext","noResolve","device","manifest","getConvertedMetadata","getDefinitionContext","getDefinitionForPage","endsWith","substring","getPageFor","viewId","setPreprocessorContext","viewJSONModel","ModelHelper","enhanceViewJSONModel","errorViewName","e","Error","convertedTypes","navigationObjectKey","navigationObject","outboundConfig","detail","outbound","outboundDetail","semanticObject","action","parameters","availability","registerVirtualProperty","route","resolveBindingString","reduce","sPathSoFar","sNextPathPart","oTarget","getObject","getView","getInterface","exit","removeGlobalInstance","Service","_ServiceFactory","_this","_len","args","Array","_key","call","_oInstanceRegistry","_proto2","oServiceContext","iCreatingViews","oTemplatedViewService","componentData","getComponentData","feEnvironment","getShareControlVisibility","getNumberOfViewsInCreationState","targets","routing","realTarget","targetToFind","actualSettings","applyPageConfigurationChanges","ServiceFactory"],"sources":["./TemplatedViewServiceFactory.ts"],"sourcesContent":["import type { ConvertedMetadata } from \"@sap-ux/vocabularies-types\";\nimport type { SAPJSONSchemaForWebApplicationManifestFile } from \"@ui5/manifest/types/manifest\";\nimport Log from \"sap/base/Log\";\nimport Localization from \"sap/base/i18n/Localization\";\nimport { resolveBindingString } from \"sap/fe/base/BindingToolkit\";\nimport type { EnhanceWithUI5 } from \"sap/fe/base/ClassSupport\";\nimport type AppComponent from \"sap/fe/core/AppComponent\";\nimport type { ComponentData } from \"sap/fe/core/AppComponent\";\nimport type { SemanticObject } from \"sap/fe/core/CommonUtils\";\nimport CommonUtils from \"sap/fe/core/CommonUtils\";\nimport type ResourceModel from \"sap/fe/core/ResourceModel\";\nimport type TemplateComponent from \"sap/fe/core/TemplateComponent\";\nimport type { NavigationConfiguration, XMLPreprocessorContext } from \"sap/fe/core/TemplateComponent\";\nimport TemplateModel from \"sap/fe/core/TemplateModel\";\nimport type { SurveyConfig } from \"sap/fe/core/controllerextensions/Feedback\";\nimport type {\n\tBaseManifestSettings,\n\tContentDensitiesType,\n\tControlConfiguration,\n\tManifestAction,\n\tManifestHeaderFacet,\n\tVariantManagementType\n} from \"sap/fe/core/converters/ManifestSettings\";\nimport { TemplateType } from \"sap/fe/core/converters/ManifestSettings\";\nimport ManifestWrapper from \"sap/fe/core/converters/ManifestWrapper\";\nimport type * as _MetaModelConverter from \"sap/fe/core/converters/MetaModelConverter\";\nimport { registerVirtualProperty } from \"sap/fe/core/converters/MetaModelConverter\";\nimport type * as _TemplateConverter from \"sap/fe/core/converters/TemplateConverter\";\nimport type { ConfigurableRecord } from \"sap/fe/core/converters/helpers/ConfigurableObject\";\nimport type { DefinitionPage } from \"sap/fe/core/definition/FEDefinition\";\nimport { DefinitionContext } from \"sap/fe/core/definition/FEDefinition\";\nimport { requireDependencies } from \"sap/fe/core/helpers/LoaderUtils\";\nimport ModelHelper from \"sap/fe/core/helpers/ModelHelper\";\nimport { applyPageConfigurationChanges } from \"sap/fe/core/manifestMerger/ChangePageConfiguration\";\nimport type { CacheHandlerService } from \"sap/fe/core/services/CacheHandlerServiceFactory\";\nimport { type HierachyMode as BreadcrumbsHierachyMode } from \"sap/fe/macros/Breadcrumbs\";\nimport type { OverflowToolbarPriority } from \"sap/m/library\";\nimport Device from \"sap/ui/Device\";\nimport VersionInfo from \"sap/ui/VersionInfo\";\nimport Core from \"sap/ui/core/Core\";\nimport type { ManifestContent, ManifestOutboundEntry, ShareOptions } from \"sap/ui/core/Manifest\";\nimport View from \"sap/ui/core/mvc/View\";\nimport Service from \"sap/ui/core/service/Service\";\nimport ServiceFactory from \"sap/ui/core/service/ServiceFactory\";\nimport ServiceFactoryRegistry from \"sap/ui/core/service/ServiceFactoryRegistry\";\nimport type Model from \"sap/ui/model/Model\";\nimport JSONModel from \"sap/ui/model/json/JSONModel\";\nimport type ODataMetaModel from \"sap/ui/model/odata/v4/ODataMetaModel\";\nimport type { ServiceContext } from \"types/metamodel_types\";\nimport { resolveDynamicExpression } from \"../helpers/DynamicAnnotationPathHelper\";\nimport type { ResourceModelService } from \"./ResourceModelServiceFactory\";\n\ntype TemplatedViewServiceSettings = {\n\tviewType?: string;\n\tviewName?: string;\n};\n\ntype ViewSettings = Parameters<typeof View.create>[0] & { cache: unknown; models: unknown; height: string };\nexport type ViewData = {\n\tbreadcrumbsHierarchyMode?: BreadcrumbsHierachyMode;\n\tfclEnabled?: boolean;\n\teditableHeaderContent?: boolean;\n\thideFilterBar?: boolean;\n\tuseHiddenFilterBar?: boolean;\n\tsectionLayout?: string;\n\tadditionalSemanticObjects?: Record<string, SemanticObject>;\n\tappComponent: AppComponent;\n\tnavigation: object;\n\tviewLevel: number;\n\tvariantManagement?: VariantManagementType;\n\tstableId: string;\n\tcontentDensities?: ContentDensitiesType;\n\tresourceModel: ResourceModel;\n\tfullContextPath: string;\n\tisDesktop: boolean;\n\tisPhone: boolean;\n\tconverterType: TemplateType;\n\tshellContentDensity?: string;\n\tuseNewLazyLoading?: boolean;\n\tinitialLoad?: string;\n\tliveMode?: boolean;\n\tretrieveTextFromValueList?: boolean;\n\tcontrolConfiguration?: ControlConfiguration;\n\trefreshStrategyOnAppRestore?: unknown;\n\tentitySet?: string;\n\tisShareButtonVisibleForMyInbox?: boolean;\n\tcontextPath?: string;\n\tshare?: ShareOptions;\n\tshareOverflowPriority?: OverflowToolbarPriority;\n\tsapFeManifestConfiguration?: ManifestContent[\"sap.fe\"];\n\tcontent?: {\n\t\tfeedback?: { actions?: Record<string, SurveyConfig>; standardActions?: Record<string, SurveyConfig> };\n\t\theader?: {\n\t\t\tfacets?: ConfigurableRecord<ManifestHeaderFacet>;\n\t\t\tactions?: ConfigurableRecord<ManifestAction>;\n\t\t};\n\t\tfooter?: {\n\t\t\tactions?: ConfigurableRecord<ManifestAction>;\n\t\t};\n\t};\n};\nexport class TemplatedViewService extends Service<TemplatedViewServiceSettings> {\n\tinitPromise!: Promise<void>;\n\n\toView!: View;\n\n\toResourceModelService!: ResourceModelService;\n\n\toCacheHandlerService!: CacheHandlerService;\n\n\toFactory!: TemplatedViewServiceFactory;\n\n\tresourceModel!: ResourceModel;\n\n\tstableId!: string;\n\n\tpageId!: string;\n\n\tTemplateConverter?: typeof _TemplateConverter;\n\n\tMetaModelConverter?: typeof _MetaModelConverter;\n\n\tinit(): void {\n\t\tconst aServiceDependencies = [];\n\t\tconst oContext = this.getContext();\n\t\tconst oComponent = oContext.scopeObject;\n\t\tconst oAppComponent = CommonUtils.getAppComponent(oComponent);\n\t\tconst viewPreloaderService = oAppComponent.getViewPreloaderService();\n\t\tconst oMetaModel = oAppComponent.getMetaModel();\n\t\tthis.pageId = oAppComponent.getLocalId(oComponent.getId()) as string;\n\t\tconst sStableId = `${oAppComponent.getMetadata().getComponentName()}::${this.pageId}`;\n\t\tconst aEnhanceI18n = oComponent.getEnhanceI18n() || [];\n\t\tlet sAppNamespace;\n\t\tthis.oFactory = oContext.factory;\n\t\tif (aEnhanceI18n) {\n\t\t\tsAppNamespace = oAppComponent.getMetadata().getComponentName();\n\t\t\tfor (let i = 0; i < aEnhanceI18n.length; i++) {\n\t\t\t\t// In order to support text-verticalization applications can also pass a resource model defined in the manifest\n\t\t\t\t// UI5 takes care of text-verticalization for resource models defined in the manifest\n\t\t\t\t// Hence check if the given key is a resource model defined in the manifest\n\t\t\t\t// if so this model should be used to enhance the sap.fe resource model so pass it as it is\n\t\t\t\tconst oResourceModel = oAppComponent.getModel(aEnhanceI18n[i]);\n\t\t\t\tif (oResourceModel && oResourceModel.isA(\"sap.ui.model.resource.ResourceModel\")) {\n\t\t\t\t\taEnhanceI18n[i] = oResourceModel;\n\t\t\t\t} else {\n\t\t\t\t\taEnhanceI18n[i] = `${sAppNamespace}.${aEnhanceI18n[i].replace(\".properties\", \"\")}`;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\tconst sCacheIdentifier = `${oAppComponent.getMetadata().getName()}_${sStableId}_${Localization.getLanguageTag()}`;\n\t\taServiceDependencies.push(\n\t\t\tServiceFactoryRegistry.get(\"sap.fe.core.services.ResourceModelService\")\n\t\t\t\t.createInstance({\n\t\t\t\t\tscopeType: \"component\",\n\t\t\t\t\tscopeObject: oComponent,\n\t\t\t\t\tsettings: {\n\t\t\t\t\t\tbundles: [\"sap.fe.core.messagebundle\", \"sap.fe.macros.messagebundle\", \"sap.fe.templates.messagebundle\"],\n\t\t\t\t\t\tenhanceI18n: aEnhanceI18n,\n\t\t\t\t\t\tmodelName: \"sap.fe.i18n\"\n\t\t\t\t\t}\n\t\t\t\t})\n\t\t\t\t.then((oResourceModelService: ResourceModelService) => {\n\t\t\t\t\tthis.oResourceModelService = oResourceModelService;\n\t\t\t\t\treturn oResourceModelService.getResourceModel();\n\t\t\t\t})\n\t\t);\n\t\taServiceDependencies.push(\n\t\t\tServiceFactoryRegistry.get(\"sap.fe.core.services.CacheHandlerService\")\n\t\t\t\t.createInstance({\n\t\t\t\t\tsettings: {\n\t\t\t\t\t\tmetaModel: oMetaModel,\n\t\t\t\t\t\tappComponent: oAppComponent,\n\t\t\t\t\t\tcomponent: oComponent\n\t\t\t\t\t}\n\t\t\t\t})\n\t\t\t\t.then(async (oCacheHandlerService: CacheHandlerService): Promise<string | null> => {\n\t\t\t\t\tawait viewPreloaderService.isCacheReady();\n\t\t\t\t\tthis.oCacheHandlerService = oCacheHandlerService;\n\t\t\t\t\treturn oCacheHandlerService.validateCacheKey(sCacheIdentifier, oComponent, oAppComponent.getEnvironmentCapabilities());\n\t\t\t\t})\n\t\t);\n\t\taServiceDependencies.push(\n\t\t\tVersionInfo.load()\n\t\t\t\t.then(function (oInfo) {\n\t\t\t\t\tlet sTimestamp = \"\";\n\t\t\t\t\tif (!oInfo.libraries) {\n\t\t\t\t\t\tsTimestamp = (Core as { buildinfo?: { buildtime?: string } })?.buildinfo?.buildtime ?? \"<NOVALUE>\";\n\t\t\t\t\t} else {\n\t\t\t\t\t\toInfo.libraries.forEach(function (oLibrary) {\n\t\t\t\t\t\t\tsTimestamp += oLibrary.buildTimestamp;\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t\treturn sTimestamp;\n\t\t\t\t})\n\t\t\t\t.catch(function () {\n\t\t\t\t\treturn \"<NOVALUE>\";\n\t\t\t\t})\n\t\t);\n\t\tthis.initPromise = Promise.all(aServiceDependencies)\n\t\t\t.then(async (aDependenciesResult: unknown[]) => {\n\t\t\t\tconst oResourceModel = aDependenciesResult[0] as ResourceModel;\n\t\t\t\tconst sCacheKey = aDependenciesResult[1] as string | null;\n\t\t\t\tconst [TemplateConverter, MetaModelConverter] = await requireDependencies([\n\t\t\t\t\t\"sap/fe/core/converters/TemplateConverter\",\n\t\t\t\t\t\"sap/fe/core/converters/MetaModelConverter\"\n\t\t\t\t]);\n\t\t\t\treturn this.createView(\n\t\t\t\t\toResourceModel,\n\t\t\t\t\tsStableId,\n\t\t\t\t\tsCacheKey,\n\t\t\t\t\tTemplateConverter as typeof _TemplateConverter,\n\t\t\t\t\tMetaModelConverter as typeof _MetaModelConverter\n\t\t\t\t);\n\t\t\t})\n\t\t\t.then(function (sCacheKey: string | void | null): void {\n\t\t\t\tconst oCacheHandlerService = ServiceFactoryRegistry.get(\"sap.fe.core.services.CacheHandlerService\").getInstance(oMetaModel);\n\t\t\t\toCacheHandlerService.invalidateIfNeeded(\n\t\t\t\t\tsCacheKey,\n\t\t\t\t\tsCacheIdentifier,\n\t\t\t\t\toComponent,\n\t\t\t\t\toAppComponent.getEnvironmentCapabilities()\n\t\t\t\t);\n\t\t\t\treturn;\n\t\t\t});\n\t}\n\n\t/**\n\t * Refresh the current view using the same configuration as before.\n\t * @param oComponent\n\t * @returns A promise indicating when the view is refreshed\n\t */\n\tasync refreshView(oComponent: TemplateComponent): Promise<void> {\n\t\tconst oRootView = oComponent.getRootControl();\n\t\tif (oRootView) {\n\t\t\toRootView.destroy();\n\t\t} else if (this.oView) {\n\t\t\tthis.oView.destroy();\n\t\t}\n\t\treturn this.createView(this.resourceModel, this.stableId, \"\", this.TemplateConverter!, this.MetaModelConverter!)\n\t\t\t.then(function (): void {\n\t\t\t\toComponent.getUIArea().invalidate();\n\t\t\t\treturn;\n\t\t\t})\n\t\t\t.catch(function (oError: unknown) {\n\t\t\t\toComponent.getUIArea().invalidate();\n\t\t\t\tLog.error(oError as string);\n\t\t\t});\n\t}\n\n\t_getViewSettings(\n\t\tpreprocessorContext: XMLPreprocessorContext,\n\t\tmServiceSettings: TemplatedViewServiceSettings,\n\t\toComponent: EnhanceWithUI5<TemplateComponent>,\n\t\tmViewData: ViewData,\n\t\tsCacheKey: string | null,\n\t\toPageModel: JSONModel,\n\t\toResourceModel: ResourceModel\n\t): ViewSettings {\n\t\tlet viewType: string | undefined = mServiceSettings.viewType || oComponent.getViewType() || \"XML\";\n\t\tif (viewType !== \"XML\") {\n\t\t\tviewType = undefined;\n\t\t}\n\t\treturn {\n\t\t\ttype: viewType,\n\t\t\tpreprocessors: {\n\t\t\t\txml: preprocessorContext,\n\t\t\t\tcontrols: {}\n\t\t\t},\n\t\t\tid: mViewData.stableId,\n\t\t\tviewName: mServiceSettings.viewName || oComponent.getViewName?.(),\n\t\t\tviewData: mViewData,\n\t\t\tcache: {\n\t\t\t\tkeys: [sCacheKey],\n\t\t\t\tadditionalData: {\n\t\t\t\t\t// We store the page model data in the `additionalData` of the view cache, this way it is always in sync\n\t\t\t\t\tgetAdditionalCacheData: (): unknown => {\n\t\t\t\t\t\treturn oPageModel.getData();\n\t\t\t\t\t},\n\t\t\t\t\tsetAdditionalCacheData: (value: object): void => {\n\t\t\t\t\t\toPageModel.setData(value);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t},\n\t\t\tmodels: {\n\t\t\t\t\"sap.fe.i18n\": oResourceModel\n\t\t\t},\n\t\t\theight: \"100%\"\n\t\t};\n\t}\n\n\tasync _createErrorPage(\n\t\treason: Error,\n\t\toViewSettings: ViewSettings,\n\t\tviewName: string,\n\t\toComponent: TemplateComponent,\n\t\tsCacheKey: string | null\n\t): Promise<string> {\n\t\t// just replace the view name and a model containing the reason, but keep the other settings\n\t\tLog.error(reason.message, reason);\n\t\toViewSettings.viewName = viewName;\n\t\tif (oViewSettings.preprocessors) {\n\t\t\t(oViewSettings.preprocessors as Record<string, { models: Record<string, Model> }>).xml.models[\"error\"] = new JSONModel(reason);\n\t\t}\n\n\t\treturn oComponent.runAsOwner(async () => {\n\t\t\treturn View.create(oViewSettings).then((oView: View) => {\n\t\t\t\tthis.oView = oView;\n\t\t\t\tthis.oView.setModel(new JSONModel(this.oView), \"$view\");\n\t\t\t\toComponent.setAggregation(\"rootControl\", this.oView);\n\t\t\t\toComponent.getAppComponent().getRootControl().getController().getPlaceholder().hideRootPlaceholder();\n\t\t\t\treturn sCacheKey;\n\t\t\t});\n\t\t}) as Promise<string>;\n\t}\n\n\tasync createView(\n\t\toResourceModel: ResourceModel,\n\t\tsStableId: string,\n\t\tsCacheKey: string | null,\n\t\tTemplateConverter: typeof _TemplateConverter,\n\t\tMetaModelConverter: typeof _MetaModelConverter\n\t): Promise<string | null | void> {\n\t\tthis.resourceModel = oResourceModel;\n\t\tthis.stableId = sStableId;\n\t\tthis.TemplateConverter = TemplateConverter;\n\t\tthis.MetaModelConverter = MetaModelConverter;\n\t\tconst oContext = this.getContext();\n\t\tconst mServiceSettings = oContext.settings;\n\t\tconst sConverterType = mServiceSettings.converterType;\n\t\tconst oComponent = oContext.scopeObject as EnhanceWithUI5<TemplateComponent>;\n\t\tconst oAppComponent = CommonUtils.getAppComponent(oComponent);\n\t\tlet sFullContextPath: string =\n\t\t\toAppComponent.getRoutingService().getTargetInformationFor(oComponent)?.options?.settings?.fullContextPath ?? \"\";\n\t\tif (!sFullContextPath) {\n\t\t\t// if the context path couldn't be retrieved from the routing service, try to get it from the component itself\n\t\t\tsFullContextPath = oComponent.getContextPath() ?? \"\";\n\t\t}\n\t\tconst oMetaModel = oAppComponent.getMetaModel();\n\t\tconst oManifestContent = oAppComponent.getManifest();\n\t\tconst oDeviceModel = new JSONModel(Device).setDefaultBindingMode(\"OneWay\");\n\t\tconst oManifestModel = new JSONModel(oManifestContent);\n\t\tlet oPageModel: TemplateModel, oViewDataModel: Model, mViewData: ViewData;\n\t\t// Load the index for the additional building blocks which is responsible for initializing them\n\t\ttry {\n\t\t\tconst oRoutingService = await oAppComponent.getService(\"routingService\");\n\t\t\t// Retrieve the viewLevel for the component\n\t\t\tconst oTargetInfo = oRoutingService.getTargetInformationFor(oComponent);\n\t\t\tconst mOutbounds =\n\t\t\t\t(oManifestContent[\"sap.app\"] &&\n\t\t\t\t\toManifestContent[\"sap.app\"].crossNavigation &&\n\t\t\t\t\toManifestContent[\"sap.app\"].crossNavigation.outbounds) ||\n\t\t\t\t{};\n\t\t\tconst mNavigation = oComponent.getNavigation() || {};\n\t\t\tconst convertedMetadata = MetaModelConverter.convertTypes(\n\t\t\t\toMetaModel,\n\t\t\t\toAppComponent.getEnvironmentCapabilities().getCapabilities()\n\t\t\t);\n\t\t\tthis._enhanceNavigationConfig(mNavigation, mOutbounds, convertedMetadata, sStableId);\n\t\t\tconst definitionContext = new DefinitionContext(convertedMetadata);\n\t\t\tdefinitionContext.addApplicationManifest(oManifestContent as SAPJSONSchemaForWebApplicationManifestFile);\n\n\t\t\tmViewData = {\n\t\t\t\tappComponent: oAppComponent,\n\t\t\t\tnavigation: mNavigation,\n\t\t\t\tviewLevel: oTargetInfo?.viewLevel,\n\t\t\t\tstableId: sStableId,\n\t\t\t\tcontentDensities: oManifestContent[\"sap.ui5\"]?.contentDensities,\n\t\t\t\tresourceModel: oResourceModel,\n\t\t\t\tfullContextPath: sFullContextPath,\n\t\t\t\tisDesktop: Device.system.desktop,\n\t\t\t\tisPhone: Device.system.phone,\n\t\t\t\tconverterType: TemplateType.FreeStylePage\n\t\t\t};\n\t\t\tif (oComponent.getViewData) {\n\t\t\t\tObject.assign(mViewData, oComponent.getViewData());\n\t\t\t\tmViewData = TemplatedViewServiceFactory.setPageConfigurationChanges(\n\t\t\t\t\toManifestContent,\n\t\t\t\t\tmViewData,\n\t\t\t\t\toAppComponent,\n\t\t\t\t\tthis.pageId\n\t\t\t\t);\n\t\t\t}\n\t\t\tmViewData.isShareButtonVisibleForMyInbox = TemplatedViewServiceFactory.getShareButtonVisibilityForMyInbox(oAppComponent);\n\t\t\tconst oShellServices = oAppComponent.getShellServices();\n\t\t\tmViewData.converterType = sConverterType;\n\t\t\tmViewData.shellContentDensity = oShellServices.getContentDensity();\n\t\t\tconst sapfeManifestContent = oManifestContent[\"sap.fe\"];\n\t\t\tmViewData.sapFeManifestConfiguration = oManifestContent[\"sap.fe\"];\n\t\t\tmViewData.retrieveTextFromValueList = sapfeManifestContent?.form\n\t\t\t\t? sapfeManifestContent?.form?.retrieveTextFromValueList\n\t\t\t\t: undefined;\n\t\t\toViewDataModel = new JSONModel(mViewData);\n\t\t\tif (mViewData.controlConfiguration) {\n\t\t\t\tfor (const sAnnotationPath in mViewData.controlConfiguration) {\n\t\t\t\t\tif (sAnnotationPath.includes(\"[\")) {\n\t\t\t\t\t\tconst sTargetAnnotationPath = resolveDynamicExpression(sAnnotationPath, oMetaModel);\n\t\t\t\t\t\tmViewData.controlConfiguration[sTargetAnnotationPath] = mViewData.controlConfiguration[sAnnotationPath];\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\toPageModel = new TemplateModel(() => {\n\t\t\t\ttry {\n\t\t\t\t\tconst oDiagnostics = oAppComponent.getDiagnostics();\n\t\t\t\t\tconst iIssueCount = oDiagnostics.getIssues().length;\n\t\t\t\t\tconst oConverterPageModel = TemplateConverter.convertPage(\n\t\t\t\t\t\tsConverterType,\n\t\t\t\t\t\toMetaModel,\n\t\t\t\t\t\tmViewData as unknown as BaseManifestSettings,\n\t\t\t\t\t\tnew ManifestWrapper(mViewData as unknown as BaseManifestSettings, oAppComponent),\n\t\t\t\t\t\toDiagnostics,\n\t\t\t\t\t\tsFullContextPath,\n\t\t\t\t\t\toAppComponent.getEnvironmentCapabilities().getCapabilities(),\n\t\t\t\t\t\toComponent\n\t\t\t\t\t);\n\t\t\t\t\tif (oConverterPageModel && oComponent._getControllerName()) {\n\t\t\t\t\t\t(oConverterPageModel as { controllerName?: string }).controllerName = oComponent._getControllerName();\n\t\t\t\t\t}\n\t\t\t\t\tconst aIssues = oDiagnostics.getIssues();\n\t\t\t\t\tconst aAddedIssues = aIssues.slice(iIssueCount);\n\t\t\t\t\tif (aAddedIssues.length > 0) {\n\t\t\t\t\t\tLog.warning(\n\t\t\t\t\t\t\t\"Some issues have been detected in your project, please check the UI5 support assistant rule for sap.fe.core\"\n\t\t\t\t\t\t);\n\t\t\t\t\t}\n\t\t\t\t\treturn oConverterPageModel;\n\t\t\t\t} catch (error: unknown) {\n\t\t\t\t\tLog.error(error as string, error as string);\n\t\t\t\t\treturn {};\n\t\t\t\t}\n\t\t\t}, oMetaModel);\n\t\t\tconst aSplitPath = sFullContextPath.split(\"/\");\n\t\t\tconst sEntitySetPath = this._getFullPathToEntitySet(aSplitPath, oMetaModel);\n\t\t\tconst preprocessorContext: XMLPreprocessorContext = {\n\t\t\t\t\tbindingContexts: {\n\t\t\t\t\t\tentitySet: sEntitySetPath ? oMetaModel.createBindingContext(sEntitySetPath) : null,\n\t\t\t\t\t\tfullContextPath: sFullContextPath ? oMetaModel.createBindingContext(sFullContextPath) : null,\n\t\t\t\t\t\tcontextPath: sFullContextPath ? oMetaModel.createBindingContext(sFullContextPath) : null,\n\t\t\t\t\t\tconverterContext: oPageModel.createBindingContext(\"/\", undefined, { noResolve: true }),\n\t\t\t\t\t\tviewData: mViewData ? oViewDataModel.createBindingContext(\"/\") : null\n\t\t\t\t\t},\n\t\t\t\t\tmodels: {\n\t\t\t\t\t\tentitySet: oMetaModel,\n\t\t\t\t\t\tfullContextPath: oMetaModel,\n\t\t\t\t\t\tcontextPath: oMetaModel,\n\t\t\t\t\t\t\"sap.fe.i18n\": oResourceModel,\n\t\t\t\t\t\tmetaModel: oMetaModel,\n\t\t\t\t\t\tdevice: oDeviceModel,\n\t\t\t\t\t\tmanifest: oManifestModel,\n\t\t\t\t\t\tconverterContext: oPageModel as unknown as JSONModel,\n\t\t\t\t\t\tviewData: oViewDataModel\n\t\t\t\t\t},\n\t\t\t\t\tfullContextPath: sFullContextPath,\n\t\t\t\t\tgetConvertedMetadata: () => convertedMetadata,\n\t\t\t\t\tgetDefinitionContext(): DefinitionContext {\n\t\t\t\t\t\treturn definitionContext;\n\t\t\t\t\t},\n\t\t\t\t\tgetDefinitionForPage(): DefinitionPage {\n\t\t\t\t\t\tlet fullContextPath = sFullContextPath;\n\t\t\t\t\t\tif (fullContextPath.endsWith(\"/\")) {\n\t\t\t\t\t\t\tfullContextPath = fullContextPath.substring(0, fullContextPath.length - 1);\n\t\t\t\t\t\t}\n\t\t\t\t\t\treturn definitionContext.getPageFor(fullContextPath);\n\t\t\t\t\t},\n\t\t\t\t\tappComponent: oAppComponent,\n\t\t\t\t\tviewId: sStableId\n\t\t\t\t},\n\t\t\t\toViewSettings = this._getViewSettings(\n\t\t\t\t\tpreprocessorContext,\n\t\t\t\t\tmServiceSettings,\n\t\t\t\t\toComponent,\n\t\t\t\t\tmViewData,\n\t\t\t\t\tsCacheKey,\n\t\t\t\t\toPageModel as unknown as JSONModel,\n\t\t\t\t\toResourceModel\n\t\t\t\t);\n\t\t\t// Setting the pageModel on the component for potential reuse\n\t\t\toComponent.setModel(oPageModel as unknown as JSONModel, \"_pageModel\");\n\t\t\toComponent.setPreprocessorContext(preprocessorContext);\n\t\t\treturn oComponent.runAsOwner(async () => {\n\t\t\t\treturn View.create(oViewSettings)\n\n\t\t\t\t\t.then((oView: View) => {\n\t\t\t\t\t\tthis.oView = oView;\n\t\t\t\t\t\tconst viewJSONModel = new JSONModel(this.oView);\n\t\t\t\t\t\tModelHelper.enhanceViewJSONModel(viewJSONModel as JSONModel & { _getObject: Function });\n\t\t\t\t\t\tthis.oView.setModel(viewJSONModel, \"$view\");\n\t\t\t\t\t\tthis.oView.setModel(oViewDataModel, \"viewData\");\n\t\t\t\t\t\toComponent.setAggregation(\"rootControl\", this.oView);\n\t\t\t\t\t\treturn sCacheKey;\n\t\t\t\t\t})\n\t\t\t\t\t.catch(async (reason: Error) =>\n\t\t\t\t\t\tthis._createErrorPage(\n\t\t\t\t\t\t\treason,\n\t\t\t\t\t\t\toViewSettings,\n\t\t\t\t\t\t\tmServiceSettings.errorViewName || \"sap.fe.core.services.view.TemplatingErrorPage\",\n\t\t\t\t\t\t\toComponent,\n\t\t\t\t\t\t\tsCacheKey\n\t\t\t\t\t\t)\n\t\t\t\t\t)\n\t\t\t\t\t.catch((e) => Log.error(e.message, e));\n\t\t\t});\n\t\t} catch (error: unknown) {\n\t\t\tLog.error((error as Error).message, error as string);\n\t\t\tthrow new Error(`Error while creating view : ${error}`);\n\t\t}\n\t}\n\n\tprivate _enhanceNavigationConfig(\n\t\tmNavigation: Record<string, NavigationConfiguration>,\n\t\tmOutbounds: Record<string, ManifestOutboundEntry>,\n\t\tconvertedTypes: ConvertedMetadata,\n\t\tstableId: string\n\t): void {\n\t\tObject.keys(mNavigation).forEach(function (navigationObjectKey: string): void {\n\t\t\tconst navigationObject = mNavigation[navigationObjectKey];\n\t\t\tlet outboundConfig;\n\t\t\tif (navigationObject.detail && navigationObject.detail.outbound && mOutbounds[navigationObject.detail.outbound]) {\n\t\t\t\toutboundConfig = mOutbounds[navigationObject.detail.outbound];\n\t\t\t\tnavigationObject.detail.outboundDetail = {\n\t\t\t\t\tsemanticObject: outboundConfig.semanticObject,\n\t\t\t\t\taction: outboundConfig.action,\n\t\t\t\t\tparameters: outboundConfig.parameters\n\t\t\t\t};\n\t\t\t}\n\t\t\tif (navigationObject.detail.availability) {\n\t\t\t\tregisterVirtualProperty(\n\t\t\t\t\tconvertedTypes,\n\t\t\t\t\t\"routeNavigable-\" + navigationObject.detail.route,\n\t\t\t\t\t() => {\n\t\t\t\t\t\treturn resolveBindingString(navigationObject.detail.availability!);\n\t\t\t\t\t},\n\t\t\t\t\tstableId\n\t\t\t\t);\n\t\t\t}\n\t\t\tif (navigationObject.create && navigationObject.create.outbound && mOutbounds[navigationObject.create.outbound]) {\n\t\t\t\toutboundConfig = mOutbounds[navigationObject.create.outbound];\n\t\t\t\tnavigationObject.create.outboundDetail = {\n\t\t\t\t\tsemanticObject: outboundConfig.semanticObject,\n\t\t\t\t\taction: outboundConfig.action,\n\t\t\t\t\tparameters: outboundConfig.parameters\n\t\t\t\t};\n\t\t\t}\n\t\t});\n\t}\n\n\tprivate _getFullPathToEntitySet(aSplitPath: string[], oMetaModel: ODataMetaModel): string {\n\t\treturn aSplitPath.reduce(function (sPathSoFar: string, sNextPathPart: string): string {\n\t\t\tif (sNextPathPart === \"\") {\n\t\t\t\treturn sPathSoFar;\n\t\t\t}\n\t\t\tif (sPathSoFar === \"\") {\n\t\t\t\tsPathSoFar = `/${sNextPathPart}`;\n\t\t\t} else {\n\t\t\t\tconst oTarget = oMetaModel.getObject(`${sPathSoFar}/$NavigationPropertyBinding/${sNextPathPart}`);\n\t\t\t\tif (oTarget && Object.keys(oTarget).length > 0) {\n\t\t\t\t\tsPathSoFar += \"/$NavigationPropertyBinding\";\n\t\t\t\t}\n\t\t\t\tsPathSoFar += `/${sNextPathPart}`;\n\t\t\t}\n\t\t\treturn sPathSoFar;\n\t\t}, \"\");\n\t}\n\n\tgetView(): View {\n\t\treturn this.oView;\n\t}\n\n\tgetInterface(): TemplatedViewService {\n\t\treturn this;\n\t}\n\n\texit(): void {\n\t\t// Deregister global instance\n\t\tif (this.oResourceModelService) {\n\t\t\tthis.oResourceModelService.destroy();\n\t\t}\n\t\tif (this.oCacheHandlerService) {\n\t\t\tthis.oCacheHandlerService.destroy();\n\t\t}\n\t\tthis.oFactory.removeGlobalInstance();\n\t}\n}\nexport class TemplatedViewServiceFactory extends ServiceFactory<TemplatedViewServiceSettings> {\n\t_oInstanceRegistry: Record<string, TemplatedViewService> = {};\n\n\tstatic iCreatingViews: 0;\n\n\tasync createInstance(oServiceContext: ServiceContext<TemplatedViewServiceSettings>): Promise<TemplatedViewService> {\n\t\tTemplatedViewServiceFactory.iCreatingViews++;\n\t\tconst oTemplatedViewService = new TemplatedViewService(Object.assign({ factory: this }, oServiceContext));\n\t\treturn oTemplatedViewService.initPromise.then(function () {\n\t\t\tTemplatedViewServiceFactory.iCreatingViews--;\n\t\t\treturn oTemplatedViewService;\n\t\t});\n\t}\n\n\tremoveGlobalInstance(): void {\n\t\tthis._oInstanceRegistry = {};\n\t}\n\n\t/**\n\t * This function checks if the component data specifies the visibility of the 'Share' button and returns true or false based on the visibility.\n\t * @param appComponent Specifies the app component\n\t * @returns Boolean value as true or false based whether the 'Share' button should be visible or not\n\t */\n\tstatic getShareButtonVisibilityForMyInbox(appComponent: AppComponent): boolean | undefined {\n\t\tconst componentData: ComponentData = appComponent.getComponentData();\n\t\tif (componentData !== undefined && componentData.feEnvironment) {\n\t\t\treturn componentData.feEnvironment.getShareControlVisibility();\n\t\t}\n\t\treturn undefined;\n\t}\n\n\tstatic getNumberOfViewsInCreationState(): number {\n\t\treturn TemplatedViewServiceFactory.iCreatingViews;\n\t}\n\n\t/**\n\t * Sets page configuration changes for a specific page identified by its ID.\n\t * @param manifest The manifest content object containing configuration details.\n\t * @param viewData The view data object representing the current state of the view.\n\t * @param appComponent The application component instance.\n\t * @param pageId The unique identifier of the page for which configuration changes are to be applied.\n\t * @returns The updated view data object reflecting the applied changes.\n\t */\n\tstatic setPageConfigurationChanges(\n\t\tmanifest: ManifestContent,\n\t\tviewData: ViewData,\n\t\tappComponent: AppComponent,\n\t\tpageId: string\n\t): ViewData {\n\t\tconst targets = manifest?.[\"sap.ui5\"]?.routing?.targets ?? {};\n\t\tlet realTarget = \"\";\n\t\tfor (const targetToFind in targets) {\n\t\t\tif (targets[targetToFind].id === pageId) {\n\t\t\t\trealTarget = targetToFind;\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\t\tif (realTarget === \"\") {\n\t\t\trealTarget = pageId;\n\t\t}\n\t\tconst actualSettings = manifest?.[\"sap.ui5\"]?.routing?.targets?.[realTarget]?.options?.settings || {};\n\t\treturn applyPageConfigurationChanges(actualSettings, viewData, appComponent, pageId);\n\t}\n}\n"],"mappings":"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","ignoreList":[]}