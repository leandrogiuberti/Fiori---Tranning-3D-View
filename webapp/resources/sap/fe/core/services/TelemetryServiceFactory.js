/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)
 *      (c) Copyright 2009-2025 SAP SE. All rights reserved
 */
sap.ui.define(["sap/base/Log","sap/ui/core/service/Service","sap/ui/core/service/ServiceFactory"],function(e,t,n){"use strict";var o={};function r(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e,i(e,t)}function i(e,t){return i=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},i(e,t)}const a={"FE.FilterBarSearch":[{name:"countFilterActions",type:"number"},{name:"countFilters",type:"number"},{name:"countVariantFilters",type:"number"},{name:"variantLayer",type:"string"},{name:"autoLoad",type:"boolean"}],"FE.Recommendations":[{name:"numberOfTimesRecommendationsFetched",type:"number"},{name:"maxTimeTakenToReceiveRecommendations",type:"number"},{name:"minTimeTakenToReceiveRecommendations",type:"number"},{name:"averageTimeTakenToReceiveRecommendations",type:"number"},{name:"numberOfFieldsAcceptedThroughAcceptButton",type:"number"},{name:"numberOfFieldsIgnoredThroughIgnoreButton",type:"number"},{name:"numberOfTimesNoPlaceholderIsShownOnUI",type:"number"},{name:"numberOfRecommendedFields",type:"number"},{name:"numberOfTimesTopRecommendationsSelected",type:"number"},{name:"numberOfTimesNonTopRecommendationsSelected",type:"number"},{name:"numberOfTimesNonRecommendedValueWasSelected",type:"number"},{name:"numberOfTimesEmptyRecommendations",type:"number"},{name:"numberofTimesFormatterCalled",type:"number"},{name:"totalNumberOfRecommendationsReceived",type:"number"},{name:"numberOfTimesFormatterNotCalled",type:"number"},{name:"totalTimeTaken",type:"number"}]};let s=function(t){function n(){var e;for(var n=arguments.length,o=new Array(n),r=0;r<n;r++){o[r]=arguments[r]}e=t.call(this,...o)||this;e.isEnabled=false;return e}o.TelemetryService=n;r(n,t);var i=n.prototype;i.init=function e(){const t=this.getContext();this.appComponent=t?.scopeObject;const n=this.appComponent.getManifestEntry("sap.fiori");this.appId=n?.registrationIds?.join("-")};i.initialize=async function e(){const t=new URLSearchParams(window.location.search);if(t.get("sap-ui-xx-feEnableGSM")?.toLowerCase()==="true"){this.isEnabled=true}return Promise.resolve(this)};i.storeAction=async function t(n,o){if(this.isEnabled){const t={...n,template:o};try{await this.storeAndFlush(t)}catch(t){e.debug(t)}}};i.storeAndFlush=async function e(t){if(!this.validateEventCountPolicy()){return}if(!this.validateEndpointPolicy()){return}const o=window.localStorage.getItem(n.EventStoreKey);let r;if(!o){r=[]}else{r=JSON.parse(o)}r.push(t);if(r.length>=n.CountBeforeFlush){try{await this.flush(r);this.incrementEventCountStore(r.length);this.clearEndpointStore()}catch{this.updateEndpointStore()}r=[]}const i=JSON.stringify(r);window.localStorage.setItem(n.EventStoreKey,i)};i.flush=async function e(t){const o=this.buildRequestBody(t);return fetch(n.targetUrl,{method:"POST",body:o})};i.buildRequestBody=function e(t){return t.map(e=>{const t=a[e.type];const n=t.map(t=>{let{name:n,type:o}=t;switch(o){case"number":case"boolean":return`${n}=${e.parameters[n]}`;case"string":default:return`${n}="${e.parameters[n]}`}});return`ui5_action{ type="${e.type}", ${n.join(", ")} } 1\n`}).join("")};i.updateEventCountStore=function e(t){window.localStorage.setItem(n.EventCountStoreKey,`${t}`)};i.incrementEventCountStore=function e(t){const o=window.localStorage.getItem(n.EventCountStoreKey);if(!o){this.updateEventCountStore(t);return}const r=parseInt(o,10);this.updateEventCountStore(r+t)};i.validateEventCountPolicy=function e(){const t=window.localStorage.getItem(n.EventCountStoreKey);if(!t){return true}const o=parseInt(t,10);if(isNaN(o)){this.updateEventCountStore(0);return true}else{return o<n.MaxTelemetry}};i.updateEndpointStore=function e(){window.localStorage.setItem(n.EndpointStoreKey,`${Date.now()}`)};i.clearEndpointStore=function e(){window.localStorage.removeItem(n.EndpointStoreKey)};i.validateEndpointPolicy=function e(){const t=window.localStorage.getItem(n.EndpointStoreKey);if(!t){return true}const o=Date.now();const r=parseInt(t,10);if(isNaN(r)){this.updateEndpointStore();return false}else{return o-r>n.EndpointRetryPeriod}};return n}(t);s.MaxTelemetry=500;o.TelemetryService=s;s.CountBeforeFlush=50;s.EndpointRetryPeriod=1e3*60*60*24;s.targetUrl="/sap/bc/ui2/flp;sap-metrics-only";s.EventStoreKey="EventStore";s.EndpointStoreKey="EndpointStore";s.EventCountStoreKey="EventCountStore";let u=function(e){function t(){return e.apply(this,arguments)||this}o=t;r(t,e);var n=t.prototype;n.createInstance=async function e(t){const n=new s(t);return n.initialize()};return t}(n);o=u;return o},false);
//# sourceMappingURL=TelemetryServiceFactory.js.map