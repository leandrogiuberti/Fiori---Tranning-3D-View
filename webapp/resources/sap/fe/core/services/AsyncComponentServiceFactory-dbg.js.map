{"version":3,"names":["AsyncComponentService","_Service","apply","arguments","_inheritsLoose","_proto","prototype","init","initPromise","Promise","resolve","reject","resolveFn","rejectFn","oContext","getContext","oComponent","scopeObject","oServices","_getManifestEntry","services","all","Object","keys","filter","sServiceKey","startup","factoryName","map","getService","then","oServiceInstance","sMethodName","toUpperCase","substring","hasOwnProperty","allServices","pRootControlLoaded","onServicesStarted","catch","Service","AsyncComponentServiceFactory","_ServiceFactory","_proto2","createInstance","oServiceContext","asyncComponentService","ServiceFactory"],"sourceRoot":".","sources":["AsyncComponentServiceFactory.ts"],"sourcesContent":["import type AppComponent from \"sap/fe/core/AppComponent\";\nimport Service from \"sap/ui/core/service/Service\";\nimport ServiceFactory from \"sap/ui/core/service/ServiceFactory\";\nimport type { ServiceContext } from \"types/metamodel_types\";\n\ntype AsyncComponentSettings = {};\n\nclass AsyncComponentService extends Service<AsyncComponentSettings> {\n\tresolveFn!: Function;\n\n\trejectFn!: () => void;\n\n\tinitPromise!: Promise<this>;\n\t// !: means that we know it will be assigned before usage\n\n\tinit(): void {\n\t\tthis.initPromise = new Promise((resolve, reject) => {\n\t\t\tthis.resolveFn = resolve;\n\t\t\tthis.rejectFn = reject;\n\t\t});\n\t\tconst oContext = this.getContext();\n\t\tconst oComponent = oContext.scopeObject as AppComponent;\n\t\tconst oServices = oComponent._getManifestEntry(\"sap.ui5\", true).services;\n\t\tPromise.all(\n\t\t\tObject.keys(oServices)\n\t\t\t\t.filter(\n\t\t\t\t\t(sServiceKey) =>\n\t\t\t\t\t\toServices[sServiceKey].startup === \"waitFor\" &&\n\t\t\t\t\t\toServices[sServiceKey].factoryName !== \"sap.fe.core.services.AsyncComponentService\"\n\t\t\t\t)\n\t\t\t\t.map(async (sServiceKey: string): Promise<Service<unknown>> => {\n\t\t\t\t\treturn oComponent.getService(sServiceKey).then((oServiceInstance: Service<unknown>) => {\n\t\t\t\t\t\tconst sMethodName = `get${sServiceKey[0].toUpperCase()}${sServiceKey.substring(1)}`;\n\t\t\t\t\t\tif (!oComponent.hasOwnProperty(sMethodName)) {\n\t\t\t\t\t\t\t(oComponent as unknown as Record<string, unknown>)[sMethodName] = function (): unknown {\n\t\t\t\t\t\t\t\treturn oServiceInstance;\n\t\t\t\t\t\t\t};\n\t\t\t\t\t\t}\n\t\t\t\t\t\treturn oServiceInstance;\n\t\t\t\t\t});\n\t\t\t\t})\n\t\t)\n\t\t\t.then(async (allServices) => {\n\t\t\t\tawait (oComponent as { pRootControlLoaded?: Promise<boolean> }).pRootControlLoaded;\n\t\t\t\treturn allServices;\n\t\t\t})\n\t\t\t.then((allServices) => {\n\t\t\t\t// notifiy the component\n\t\t\t\tif (oComponent.onServicesStarted) {\n\t\t\t\t\toComponent.onServicesStarted(allServices);\n\t\t\t\t}\n\t\t\t\tthis.resolveFn(this);\n\t\t\t\treturn;\n\t\t\t})\n\t\t\t.catch(this.rejectFn);\n\t}\n}\n\nclass AsyncComponentServiceFactory extends ServiceFactory<AsyncComponentSettings> {\n\tasync createInstance(oServiceContext: ServiceContext<AsyncComponentSettings>): Promise<AsyncComponentService> {\n\t\tconst asyncComponentService = new AsyncComponentService(oServiceContext);\n\t\treturn asyncComponentService.initPromise;\n\t}\n}\n\nexport default AsyncComponentServiceFactory;\n"],"mappings":";;;;;;;;;MAOMA,qBAAqB,0BAAAC,QAAA;IAAA,SAAAD,sBAAA;MAAA,OAAAC,QAAA,CAAAC,KAAA,OAAAC,SAAA;IAAA;IAAAC,cAAA,CAAAJ,qBAAA,EAAAC,QAAA;IAAA,IAAAI,MAAA,GAAAL,qBAAA,CAAAM,SAAA;IAM1B;IAAAD,MAAA,CAEAE,IAAI,GAAJ,SAAAA,IAAIA,CAAA,EAAS;MACZ,IAAI,CAACC,WAAW,GAAG,IAAIC,OAAO,CAAC,CAACC,OAAO,EAAEC,MAAM,KAAK;QACnD,IAAI,CAACC,SAAS,GAAGF,OAAO;QACxB,IAAI,CAACG,QAAQ,GAAGF,MAAM;MACvB,CAAC,CAAC;MACF,MAAMG,QAAQ,GAAG,IAAI,CAACC,UAAU,CAAC,CAAC;MAClC,MAAMC,UAAU,GAAGF,QAAQ,CAACG,WAA2B;MACvD,MAAMC,SAAS,GAAGF,UAAU,CAACG,iBAAiB,CAAC,SAAS,EAAE,IAAI,CAAC,CAACC,QAAQ;MACxEX,OAAO,CAACY,GAAG,CACVC,MAAM,CAACC,IAAI,CAACL,SAAS,CAAC,CACpBM,MAAM,CACLC,WAAW,IACXP,SAAS,CAACO,WAAW,CAAC,CAACC,OAAO,KAAK,SAAS,IAC5CR,SAAS,CAACO,WAAW,CAAC,CAACE,WAAW,KAAK,4CACzC,CAAC,CACAC,GAAG,CAAC,MAAOH,WAAmB,IAAgC;QAC9D,OAAOT,UAAU,CAACa,UAAU,CAACJ,WAAW,CAAC,CAACK,IAAI,CAAEC,gBAAkC,IAAK;UACtF,MAAMC,WAAW,GAAG,MAAMP,WAAW,CAAC,CAAC,CAAC,CAACQ,WAAW,CAAC,CAAC,GAAGR,WAAW,CAACS,SAAS,CAAC,CAAC,CAAC,EAAE;UACnF,IAAI,CAAClB,UAAU,CAACmB,cAAc,CAACH,WAAW,CAAC,EAAE;YAC3ChB,UAAU,CAAwCgB,WAAW,CAAC,GAAG,YAAqB;cACtF,OAAOD,gBAAgB;YACxB,CAAC;UACF;UACA,OAAOA,gBAAgB;QACxB,CAAC,CAAC;MACH,CAAC,CACH,CAAC,CACCD,IAAI,CAAC,MAAOM,WAAW,IAAK;QAC5B,MAAOpB,UAAU,CAA+CqB,kBAAkB;QAClF,OAAOD,WAAW;MACnB,CAAC,CAAC,CACDN,IAAI,CAAEM,WAAW,IAAK;QACtB;QACA,IAAIpB,UAAU,CAACsB,iBAAiB,EAAE;UACjCtB,UAAU,CAACsB,iBAAiB,CAACF,WAAW,CAAC;QAC1C;QACA,IAAI,CAACxB,SAAS,CAAC,IAAI,CAAC;QACpB;MACD,CAAC,CAAC,CACD2B,KAAK,CAAC,IAAI,CAAC1B,QAAQ,CAAC;IACvB,CAAC;IAAA,OAAAb,qBAAA;EAAA,EAhDkCwC,OAAO;EAAA,IAmDrCC,4BAA4B,0BAAAC,eAAA;IAAA,SAAAD,6BAAA;MAAA,OAAAC,eAAA,CAAAxC,KAAA,OAAAC,SAAA;IAAA;IAAAC,cAAA,CAAAqC,4BAAA,EAAAC,eAAA;IAAA,IAAAC,OAAA,GAAAF,4BAAA,CAAAnC,SAAA;IAAAqC,OAAA,CAC3BC,cAAc,GAApB,eAAMA,cAAcA,CAACC,eAAuD,EAAkC;MAC7G,MAAMC,qBAAqB,GAAG,IAAI9C,qBAAqB,CAAC6C,eAAe,CAAC;MACxE,OAAOC,qBAAqB,CAACtC,WAAW;IACzC,CAAC;IAAA,OAAAiC,4BAAA;EAAA,EAJyCM,cAAc;EAAA,OAO1CN,4BAA4B;AAAA","ignoreList":[],"file":"AsyncComponentServiceFactory-dbg.js"}