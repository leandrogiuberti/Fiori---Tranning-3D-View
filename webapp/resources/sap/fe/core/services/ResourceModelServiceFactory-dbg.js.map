{"version":3,"names":["ResourceModelService","_Service","apply","arguments","_exports","_inheritsLoose","_proto","prototype","init","oContext","getContext","mSettings","settings","oFactory","factory","aBundles","bundles","concat","enhanceI18n","map","vI18n","isA","getResourceBundle","bundleName","replace","oResourceModel","ResourceModel","enhanceWith","slice","async","scopeType","oComponent","scopeObject","setModel","modelName","initPromise","Promise","all","_pEnhanced","resolve","then","oBundle","__bundle","getResourceModel","getInterface","exit","removeGlobalInstance","Service","ResourceModelServiceFactory","_ServiceFactory","_this","_len","length","args","Array","_key","call","_oInstances","_proto2","createInstance","oServiceContext","sKey","getId","join","Object","assign","ServiceFactory"],"sourceRoot":".","sources":["ResourceModelServiceFactory.ts"],"sourcesContent":["import type ResourceBundle from \"sap/base/i18n/ResourceBundle\";\nimport ResourceModel from \"sap/fe/core/ResourceModel\";\nimport type BaseObject from \"sap/ui/base/Object\";\nimport Service from \"sap/ui/core/service/Service\";\nimport ServiceFactory from \"sap/ui/core/service/ServiceFactory\";\nimport type { ServiceContext } from \"types/metamodel_types\";\ntype ResourceModelServiceSettings = {\n\tbundles: ResourceBundle[];\n\tenhanceI18n: string[];\n};\nexport class ResourceModelService extends Service<ResourceModelServiceSettings> {\n\tinitPromise!: Promise<this>;\n\n\toFactory!: ResourceModelServiceFactory;\n\n\toResourceModel!: ResourceModel;\n\n\tinit(): void {\n\t\tconst oContext = this.getContext();\n\t\tconst mSettings = oContext.settings;\n\t\tthis.oFactory = oContext.factory;\n\n\t\t// When enhancing i18n keys the value in the last resource bundle takes precedence\n\t\t// hence arrange various resource bundles so that enhanceI18n provided by the application is the last.\n\t\t// The following order is used :\n\t\t// 1. sap.fe bundle - sap.fe.core.messagebundle (passed with mSettings.bundles)\n\t\t// 2. sap.fe bundle - sap.fe.templates.messagebundle (passed with mSettings.bundles)\n\t\t// 3. Multiple bundles passed by the application as part of enhanceI18n\n\t\tconst aBundles = mSettings.bundles.concat(mSettings.enhanceI18n || []).map(function (vI18n: ResourceModel | string) {\n\t\t\t// if value passed for enhanceI18n is a Resource Model, return the associated bundle\n\t\t\t// else the value is a bundleUrl, return Resource Bundle configuration so that a bundle can be created\n\t\t\treturn typeof (vI18n as BaseObject).isA === \"function\" && (vI18n as BaseObject).isA(\"sap.ui.model.resource.ResourceModel\")\n\t\t\t\t? ((vI18n as ResourceModel).getResourceBundle() as ResourceBundle)\n\t\t\t\t: { bundleName: (vI18n as string).replace(/\\//g, \".\") };\n\t\t});\n\n\t\tthis.oResourceModel = new ResourceModel({\n\t\t\tbundleName: aBundles[0].bundleName,\n\t\t\tenhanceWith: aBundles.slice(1),\n\t\t\tasync: true\n\t\t});\n\n\t\tif (oContext.scopeType === \"component\") {\n\t\t\tconst oComponent = oContext.scopeObject;\n\t\t\toComponent.setModel(this.oResourceModel, mSettings.modelName);\n\t\t}\n\n\t\tthis.initPromise = Promise.all([\n\t\t\tthis.oResourceModel.getResourceBundle() as Promise<ResourceBundle>,\n\t\t\t(this.oResourceModel as { _pEnhanced?: boolean })._pEnhanced || Promise.resolve()\n\t\t]).then((oBundle: unknown[]) => {\n\t\t\t(this.oResourceModel as { __bundle?: unknown }).__bundle = oBundle[0];\n\t\t\treturn this;\n\t\t});\n\t}\n\n\tgetResourceModel(): ResourceModel {\n\t\treturn this.oResourceModel;\n\t}\n\n\tgetInterface(): this {\n\t\treturn this;\n\t}\n\n\texit(): void {\n\t\t// Deregister global instance\n\t\tthis.oFactory.removeGlobalInstance();\n\t}\n}\n\nclass ResourceModelServiceFactory extends ServiceFactory<ResourceModelServiceSettings> {\n\t_oInstances: Record<string, ResourceModelService> = {};\n\n\tasync createInstance(oServiceContext: ServiceContext<ResourceModelServiceSettings>): Promise<ResourceModelService> {\n\t\tconst sKey =\n\t\t\t`${oServiceContext.scopeObject.getId()}_${oServiceContext.settings.bundles.join(\",\")}` +\n\t\t\t(oServiceContext.settings.enhanceI18n ? `,${oServiceContext.settings.enhanceI18n.join(\",\")}` : \"\");\n\n\t\tif (!this._oInstances[sKey]) {\n\t\t\tthis._oInstances[sKey] = new ResourceModelService(Object.assign({ factory: this }, oServiceContext));\n\t\t}\n\n\t\treturn this._oInstances[sKey].initPromise;\n\t}\n\n\tremoveGlobalInstance(): void {\n\t\tthis._oInstances = {};\n\t}\n}\n\nexport default ResourceModelServiceFactory;\n"],"mappings":";;;;;;;;;;MAUaA,oBAAoB,0BAAAC,QAAA;IAAA,SAAAD,qBAAA;MAAA,OAAAC,QAAA,CAAAC,KAAA,OAAAC,SAAA;IAAA;IAAAC,QAAA,CAAAJ,oBAAA,GAAAA,oBAAA;IAAAK,cAAA,CAAAL,oBAAA,EAAAC,QAAA;IAAA,IAAAK,MAAA,GAAAN,oBAAA,CAAAO,SAAA;IAAAD,MAAA,CAOhCE,IAAI,GAAJ,SAAAA,IAAIA,CAAA,EAAS;MACZ,MAAMC,QAAQ,GAAG,IAAI,CAACC,UAAU,CAAC,CAAC;MAClC,MAAMC,SAAS,GAAGF,QAAQ,CAACG,QAAQ;MACnC,IAAI,CAACC,QAAQ,GAAGJ,QAAQ,CAACK,OAAO;;MAEhC;MACA;MACA;MACA;MACA;MACA;MACA,MAAMC,QAAQ,GAAGJ,SAAS,CAACK,OAAO,CAACC,MAAM,CAACN,SAAS,CAACO,WAAW,IAAI,EAAE,CAAC,CAACC,GAAG,CAAC,UAAUC,KAA6B,EAAE;QACnH;QACA;QACA,OAAO,OAAQA,KAAK,CAAgBC,GAAG,KAAK,UAAU,IAAKD,KAAK,CAAgBC,GAAG,CAAC,qCAAqC,CAAC,GACrHD,KAAK,CAAmBE,iBAAiB,CAAC,CAAC,GAC7C;UAAEC,UAAU,EAAGH,KAAK,CAAYI,OAAO,CAAC,KAAK,EAAE,GAAG;QAAE,CAAC;MACzD,CAAC,CAAC;MAEF,IAAI,CAACC,cAAc,GAAG,IAAIC,aAAa,CAAC;QACvCH,UAAU,EAAER,QAAQ,CAAC,CAAC,CAAC,CAACQ,UAAU;QAClCI,WAAW,EAAEZ,QAAQ,CAACa,KAAK,CAAC,CAAC,CAAC;QAC9BC,KAAK,EAAE;MACR,CAAC,CAAC;MAEF,IAAIpB,QAAQ,CAACqB,SAAS,KAAK,WAAW,EAAE;QACvC,MAAMC,UAAU,GAAGtB,QAAQ,CAACuB,WAAW;QACvCD,UAAU,CAACE,QAAQ,CAAC,IAAI,CAACR,cAAc,EAAEd,SAAS,CAACuB,SAAS,CAAC;MAC9D;MAEA,IAAI,CAACC,WAAW,GAAGC,OAAO,CAACC,GAAG,CAAC,CAC9B,IAAI,CAACZ,cAAc,CAACH,iBAAiB,CAAC,CAAC,EACtC,IAAI,CAACG,cAAc,CAA8Ba,UAAU,IAAIF,OAAO,CAACG,OAAO,CAAC,CAAC,CACjF,CAAC,CAACC,IAAI,CAAEC,OAAkB,IAAK;QAC9B,IAAI,CAAChB,cAAc,CAA4BiB,QAAQ,GAAGD,OAAO,CAAC,CAAC,CAAC;QACrE,OAAO,IAAI;MACZ,CAAC,CAAC;IACH,CAAC;IAAAnC,MAAA,CAEDqC,gBAAgB,GAAhB,SAAAA,gBAAgBA,CAAA,EAAkB;MACjC,OAAO,IAAI,CAAClB,cAAc;IAC3B,CAAC;IAAAnB,MAAA,CAEDsC,YAAY,GAAZ,SAAAA,YAAYA,CAAA,EAAS;MACpB,OAAO,IAAI;IACZ,CAAC;IAAAtC,MAAA,CAEDuC,IAAI,GAAJ,SAAAA,IAAIA,CAAA,EAAS;MACZ;MACA,IAAI,CAAChC,QAAQ,CAACiC,oBAAoB,CAAC,CAAC;IACrC,CAAC;IAAA,OAAA9C,oBAAA;EAAA,EAzDwC+C,OAAO;EAAA3C,QAAA,CAAAJ,oBAAA,GAAAA,oBAAA;EAAA,IA4D3CgD,2BAA2B,0BAAAC,eAAA;IAAA,SAAAD,4BAAA;MAAA,IAAAE,KAAA;MAAA,SAAAC,IAAA,GAAAhD,SAAA,CAAAiD,MAAA,EAAAC,IAAA,OAAAC,KAAA,CAAAH,IAAA,GAAAI,IAAA,MAAAA,IAAA,GAAAJ,IAAA,EAAAI,IAAA;QAAAF,IAAA,CAAAE,IAAA,IAAApD,SAAA,CAAAoD,IAAA;MAAA;MAAAL,KAAA,GAAAD,eAAA,CAAAO,IAAA,UAAAH,IAAA;MAAAH,KAAA,CAChCO,WAAW,GAAyC,CAAC,CAAC;MAAA,OAAAP,KAAA;IAAA;IAAA7C,cAAA,CAAA2C,2BAAA,EAAAC,eAAA;IAAA,IAAAS,OAAA,GAAAV,2BAAA,CAAAzC,SAAA;IAAAmD,OAAA,CAEhDC,cAAc,GAApB,eAAMA,cAAcA,CAACC,eAA6D,EAAiC;MAClH,MAAMC,IAAI,GACT,GAAGD,eAAe,CAAC5B,WAAW,CAAC8B,KAAK,CAAC,CAAC,IAAIF,eAAe,CAAChD,QAAQ,CAACI,OAAO,CAAC+C,IAAI,CAAC,GAAG,CAAC,EAAE,IACrFH,eAAe,CAAChD,QAAQ,CAACM,WAAW,GAAG,IAAI0C,eAAe,CAAChD,QAAQ,CAACM,WAAW,CAAC6C,IAAI,CAAC,GAAG,CAAC,EAAE,GAAG,EAAE,CAAC;MAEnG,IAAI,CAAC,IAAI,CAACN,WAAW,CAACI,IAAI,CAAC,EAAE;QAC5B,IAAI,CAACJ,WAAW,CAACI,IAAI,CAAC,GAAG,IAAI7D,oBAAoB,CAACgE,MAAM,CAACC,MAAM,CAAC;UAAEnD,OAAO,EAAE;QAAK,CAAC,EAAE8C,eAAe,CAAC,CAAC;MACrG;MAEA,OAAO,IAAI,CAACH,WAAW,CAACI,IAAI,CAAC,CAAC1B,WAAW;IAC1C,CAAC;IAAAuB,OAAA,CAEDZ,oBAAoB,GAApB,SAAAA,oBAAoBA,CAAA,EAAS;MAC5B,IAAI,CAACW,WAAW,GAAG,CAAC,CAAC;IACtB,CAAC;IAAA,OAAAT,2BAAA;EAAA,EAjBwCkB,cAAc;EAAA,OAoBzClB,2BAA2B;AAAA","ignoreList":[],"file":"ResourceModelServiceFactory-dbg.js"}