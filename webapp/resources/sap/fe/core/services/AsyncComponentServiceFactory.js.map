{"version":3,"file":"AsyncComponentServiceFactory.js","names":["AsyncComponentService","_Service","apply","this","arguments","_inheritsLoose","_proto","prototype","init","initPromise","Promise","resolve","reject","resolveFn","rejectFn","oContext","getContext","oComponent","scopeObject","oServices","_getManifestEntry","services","all","Object","keys","filter","sServiceKey","startup","factoryName","map","async","getService","then","oServiceInstance","sMethodName","toUpperCase","substring","hasOwnProperty","pRootControlLoaded","allServices","onServicesStarted","catch","Service","AsyncComponentServiceFactory","_ServiceFactory","_proto2","createInstance","oServiceContext","asyncComponentService","ServiceFactory"],"sources":["./AsyncComponentServiceFactory.ts"],"sourcesContent":["import type AppComponent from \"sap/fe/core/AppComponent\";\nimport Service from \"sap/ui/core/service/Service\";\nimport ServiceFactory from \"sap/ui/core/service/ServiceFactory\";\nimport type { ServiceContext } from \"types/metamodel_types\";\n\ntype AsyncComponentSettings = {};\n\nclass AsyncComponentService extends Service<AsyncComponentSettings> {\n\tresolveFn!: Function;\n\n\trejectFn!: () => void;\n\n\tinitPromise!: Promise<this>;\n\t// !: means that we know it will be assigned before usage\n\n\tinit(): void {\n\t\tthis.initPromise = new Promise((resolve, reject) => {\n\t\t\tthis.resolveFn = resolve;\n\t\t\tthis.rejectFn = reject;\n\t\t});\n\t\tconst oContext = this.getContext();\n\t\tconst oComponent = oContext.scopeObject as AppComponent;\n\t\tconst oServices = oComponent._getManifestEntry(\"sap.ui5\", true).services;\n\t\tPromise.all(\n\t\t\tObject.keys(oServices)\n\t\t\t\t.filter(\n\t\t\t\t\t(sServiceKey) =>\n\t\t\t\t\t\toServices[sServiceKey].startup === \"waitFor\" &&\n\t\t\t\t\t\toServices[sServiceKey].factoryName !== \"sap.fe.core.services.AsyncComponentService\"\n\t\t\t\t)\n\t\t\t\t.map(async (sServiceKey: string): Promise<Service<unknown>> => {\n\t\t\t\t\treturn oComponent.getService(sServiceKey).then((oServiceInstance: Service<unknown>) => {\n\t\t\t\t\t\tconst sMethodName = `get${sServiceKey[0].toUpperCase()}${sServiceKey.substring(1)}`;\n\t\t\t\t\t\tif (!oComponent.hasOwnProperty(sMethodName)) {\n\t\t\t\t\t\t\t(oComponent as unknown as Record<string, unknown>)[sMethodName] = function (): unknown {\n\t\t\t\t\t\t\t\treturn oServiceInstance;\n\t\t\t\t\t\t\t};\n\t\t\t\t\t\t}\n\t\t\t\t\t\treturn oServiceInstance;\n\t\t\t\t\t});\n\t\t\t\t})\n\t\t)\n\t\t\t.then(async (allServices) => {\n\t\t\t\tawait (oComponent as { pRootControlLoaded?: Promise<boolean> }).pRootControlLoaded;\n\t\t\t\treturn allServices;\n\t\t\t})\n\t\t\t.then((allServices) => {\n\t\t\t\t// notifiy the component\n\t\t\t\tif (oComponent.onServicesStarted) {\n\t\t\t\t\toComponent.onServicesStarted(allServices);\n\t\t\t\t}\n\t\t\t\tthis.resolveFn(this);\n\t\t\t\treturn;\n\t\t\t})\n\t\t\t.catch(this.rejectFn);\n\t}\n}\n\nclass AsyncComponentServiceFactory extends ServiceFactory<AsyncComponentSettings> {\n\tasync createInstance(oServiceContext: ServiceContext<AsyncComponentSettings>): Promise<AsyncComponentService> {\n\t\tconst asyncComponentService = new AsyncComponentService(oServiceContext);\n\t\treturn asyncComponentService.initPromise;\n\t}\n}\n\nexport default AsyncComponentServiceFactory;\n"],"mappings":";;;;mUAOMA,EAAqB,SAAAC,GAAA,SAAAD,IAAA,OAAAC,EAAAC,MAAAC,KAAAC,YAAAD,IAAA,CAAAE,EAAAL,EAAAC,GAAA,IAAAK,EAAAN,EAAAO,UAM1BD,EAEAE,KAAA,SAAAA,IACCL,KAAKM,YAAc,IAAIC,QAAQ,CAACC,EAASC,KACxCT,KAAKU,UAAYF,EACjBR,KAAKW,SAAWF,IAEjB,MAAMG,EAAWZ,KAAKa,aACtB,MAAMC,EAAaF,EAASG,YAC5B,MAAMC,EAAYF,EAAWG,kBAAkB,UAAW,MAAMC,SAChEX,QAAQY,IACPC,OAAOC,KAAKL,GACVM,OACCC,GACAP,EAAUO,GAAaC,UAAY,WACnCR,EAAUO,GAAaE,cAAgB,8CAExCC,IAAIC,SACGb,EAAWc,WAAWL,GAAaM,KAAMC,IAC/C,MAAMC,EAAc,MAAMR,EAAY,GAAGS,gBAAgBT,EAAYU,UAAU,KAC/E,IAAKnB,EAAWoB,eAAeH,GAAc,CAC3CjB,EAAkDiB,GAAe,WACjE,OAAOD,CACR,CACD,CACA,OAAOA,MAITD,KAAKF,gBACEb,EAAyDqB,mBAChE,OAAOC,IAEPP,KAAMO,IAEN,GAAItB,EAAWuB,kBAAmB,CACjCvB,EAAWuB,kBAAkBD,EAC9B,CACApC,KAAKU,UAAUV,MACf,SAEAsC,MAAMtC,KAAKW,SACd,EAAC,OAAAd,CAAA,CAhDyB,CAAS0C,GAAO,IAmDrCC,EAA4B,SAAAC,GAAA,SAAAD,IAAA,OAAAC,EAAA1C,MAAAC,KAAAC,YAAAD,IAAA,CAAAE,EAAAsC,EAAAC,GAAA,IAAAC,EAAAF,EAAApC,UAAAsC,EAC3BC,eAANhB,eAAMgB,EAAeC,GACpB,MAAMC,EAAwB,IAAIhD,EAAsB+C,GACxD,OAAOC,EAAsBvC,WAC9B,EAAC,OAAAkC,CAAA,CAJgC,CAASM,GAAc,OAO1CN,CAA4B","ignoreList":[]}