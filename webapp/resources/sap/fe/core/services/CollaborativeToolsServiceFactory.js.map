{"version":3,"file":"CollaborativeToolsServiceFactory.js","names":["CollaborativeToolsService","_Service","apply","this","arguments","_exports","_inheritsLoose","_proto","prototype","init","collaborationService","isInitialized","initPromise","Promise","resolve","getInterface","initializeMSTeams","async","getCollaborationServices","teamsHelperService","oTeamsHelperService","isContactsCollaborationSupported","cmHelperService","oCMHelperService","e","Log","info","getMailPopoverFromMsTeamsIntegration","mail","enableContactsCollaboration","undefined","getTeamContactStatus","email","getTeamsContactStatus","getTeamContactOptions","contactOptions","getTeamsContactCollabOptions","getTeamContactOption","option","contactOption","i","length","key","getTeamsCollabOptionsViaShare","params","getOptions","getCollaborationManagerOption","default","ServiceContainerClass","__ui5_require_async","Service","CollaborativeToolsServiceFactory","_ServiceFactory","_proto2","createInstance","serviceContext","collaborativeToolsService","ServiceFactory","CollaborativeToolsServiceClass"],"sources":["./CollaborativeToolsServiceFactory.ts"],"sourcesContent":["import Log from \"sap/base/Log\";\nimport type Popover from \"sap/m/Popover\";\nimport type {\n\tCollaborationOptionParams,\n\tCollaborationOptions,\n\tContactStatus,\n\tContactOption as TeamsContactOption,\n\tdefault as TeamsHelperService\n} from \"sap/suite/ui/commons/collaboration/TeamsHelperService\";\nimport type {\n\tdefault as CollaborationManagerService\n} from \"sap/suite/ui/commons/collaboration/CollaborationManagerService\";\nimport Service from \"sap/ui/core/service/Service\";\nimport ServiceFactory from \"sap/ui/core/service/ServiceFactory\";\nimport type { ServiceContext } from \"types/metamodel_types\";\ntype CollaborativeToolsServiceSettings = {};\ntype TeamsConnection = {\n\tisInitialized: boolean;\n\tisContactsCollaborationSupported?: boolean;\n\tteamsHelperService?: TeamsHelperService;\n\tcontactOptions?: TeamsContactOption[];\n\tcmHelperService?: CollaborationManagerService;\n};\ntype CollaborationService = {\n\toTeamsHelperService: TeamsHelperService,\n\toCMHelperService: CollaborationManagerService\n}\nexport class CollaborativeToolsService extends Service<CollaborativeToolsServiceSettings> {\n\tinitPromise!: Promise<CollaborativeToolsService>;\n\n\tcollaborationService!: TeamsConnection;\n\n\toFactory!: CollaborativeToolsServiceFactory;\n\n\tinit(): void {\n\t\tthis.collaborationService = {\n\t\t\tisInitialized: false\n\t\t};\n\n\t\tthis.initPromise = Promise.resolve(this);\n\t}\n\n\tgetInterface(): CollaborativeToolsService {\n\t\treturn this;\n\t}\n\n\tprivate async initializeMSTeams(): Promise<void> {\n\t\ttry {\n\t\t\tconst collaborationService = await this.getCollaborationServices();\n\t\t\tthis.collaborationService.isInitialized = true;\n\t\t\tthis.collaborationService.teamsHelperService = collaborationService.oTeamsHelperService;\n\t\t\tthis.collaborationService.isContactsCollaborationSupported =\n\t\t\t\t//await helperService.isTeamsModeActive() && // this checks for url params appState=lean&sap-collaboration-teams=true\n\t\t\t\ttypeof collaborationService.oTeamsHelperService.isContactsCollaborationSupported === \"function\" && collaborationService.oTeamsHelperService.isContactsCollaborationSupported();\n\t\t\tthis.collaborationService.cmHelperService = collaborationService.oCMHelperService;\n\t\t} catch (e) {\n\t\t\tLog.info(\"Couldn't evaluate the support for contacts collaboration in MS Teams\");\n\t\t}\n\t}\n\n\tpublic async getMailPopoverFromMsTeamsIntegration(mail: string): Promise<Popover | undefined> {\n\t\tif (!this.collaborationService.isInitialized) {\n\t\t\tawait this.initializeMSTeams();\n\t\t}\n\t\ttry {\n\t\t\treturn await this.collaborationService.teamsHelperService?.enableContactsCollaboration(mail);\n\t\t} catch {\n\t\t\treturn undefined;\n\t\t}\n\t}\n\n\tasync isContactsCollaborationSupported(): Promise<boolean> {\n\t\tif (!this.collaborationService.isInitialized) {\n\t\t\tawait this.initializeMSTeams();\n\t\t}\n\t\treturn this.collaborationService.isContactsCollaborationSupported === true;\n\t}\n\n\tpublic async getTeamContactStatus(email: string): Promise<ContactStatus[] | undefined> {\n\t\tif (!this.collaborationService.isInitialized) {\n\t\t\tawait this.initializeMSTeams();\n\t\t}\n\t\tif (!this.collaborationService.isContactsCollaborationSupported) {\n\t\t\treturn undefined;\n\t\t}\n\n\t\ttry {\n\t\t\treturn await this.collaborationService.teamsHelperService?.getTeamsContactStatus(email);\n\t\t} catch {\n\t\t\treturn undefined;\n\t\t}\n\t}\n\n\tpublic async getTeamContactOptions(): Promise<TeamsContactOption[] | undefined> {\n\t\tif (!this.collaborationService.isInitialized) {\n\t\t\tawait this.initializeMSTeams();\n\t\t}\n\t\tif (!this.collaborationService.isContactsCollaborationSupported) {\n\t\t\treturn undefined;\n\t\t}\n\t\tif (!this.collaborationService.contactOptions) {\n\t\t\ttry {\n\t\t\t\tthis.collaborationService.contactOptions = await this.collaborationService.teamsHelperService?.getTeamsContactCollabOptions();\n\t\t\t} catch {\n\t\t\t\treturn undefined;\n\t\t\t}\n\t\t}\n\t\treturn this.collaborationService.contactOptions;\n\t}\n\n\tpublic async getTeamContactOption(option: \"call\" | \"chat\" | \"videoCall\"): Promise<TeamsContactOption | undefined> {\n\t\tconst contactOptions = await this.getTeamContactOptions();\n\t\tlet contactOption;\n\t\tif (contactOptions) {\n\t\t\tfor (let i = 0; i < contactOptions.length; i++) {\n\t\t\t\tif (contactOptions[i].key === option) {\n\t\t\t\t\tcontactOption = contactOptions[i];\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\treturn contactOption;\n\t}\n\n\tpublic async getTeamsCollabOptionsViaShare(params: CollaborationOptionParams): Promise<CollaborationOptions[] | undefined> {\n\t\tif (!this.collaborationService.isInitialized) {\n\t\t\tawait this.initializeMSTeams();\n\t\t}\n\t\treturn this.collaborationService.teamsHelperService?.getOptions(params);\n\t}\n\n\tpublic async getCollaborationManagerOption(): Promise<CollaborationOptions | undefined> {\n\t\tif (!this.collaborationService.isInitialized) {\n\t\t\tawait this.initializeMSTeams();\n\t\t}\n\t\treturn this.collaborationService.cmHelperService?.getOptions();\n\t}\n\n\tpublic async getCollaborationServices(): Promise<CollaborationService> {\n\t\tconst { default: ServiceContainerClass } = await import(\"sap/suite/ui/commons/collaboration/ServiceContainer\");\n\t\treturn ServiceContainerClass.getCollaborationServices();\n\t}\n}\n\nclass CollaborativeToolsServiceFactory extends ServiceFactory<CollaborativeToolsServiceSettings> {\n\tpublic static CollaborativeToolsServiceClass = CollaborativeToolsService;\n\n\tasync createInstance(serviceContext: ServiceContext<CollaborativeToolsServiceSettings>): Promise<CollaborativeToolsService> {\n\t\tconst collaborativeToolsService = new CollaborativeToolsService(serviceContext);\n\t\treturn collaborativeToolsService.initPromise;\n\t}\n}\nexport default CollaborativeToolsServiceFactory;\n"],"mappings":"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","ignoreList":[]}