{"version":3,"names":["CollaborativeToolsService","_Service","apply","arguments","_exports","_inheritsLoose","_proto","prototype","init","collaborationService","isInitialized","initPromise","Promise","resolve","getInterface","initializeMSTeams","getCollaborationServices","teamsHelperService","oTeamsHelperService","isContactsCollaborationSupported","cmHelperService","oCMHelperService","e","Log","info","getMailPopoverFromMsTeamsIntegration","mail","enableContactsCollaboration","undefined","getTeamContactStatus","email","getTeamsContactStatus","getTeamContactOptions","contactOptions","getTeamsContactCollabOptions","getTeamContactOption","option","contactOption","i","length","key","getTeamsCollabOptionsViaShare","params","getOptions","getCollaborationManagerOption","default","ServiceContainerClass","__ui5_require_async","Service","CollaborativeToolsServiceFactory","_ServiceFactory","_proto2","createInstance","serviceContext","collaborativeToolsService","ServiceFactory","CollaborativeToolsServiceClass"],"sourceRoot":".","sources":["CollaborativeToolsServiceFactory.ts"],"sourcesContent":["import Log from \"sap/base/Log\";\nimport type Popover from \"sap/m/Popover\";\nimport type {\n\tCollaborationOptionParams,\n\tCollaborationOptions,\n\tContactStatus,\n\tContactOption as TeamsContactOption,\n\tdefault as TeamsHelperService\n} from \"sap/suite/ui/commons/collaboration/TeamsHelperService\";\nimport type {\n\tdefault as CollaborationManagerService\n} from \"sap/suite/ui/commons/collaboration/CollaborationManagerService\";\nimport Service from \"sap/ui/core/service/Service\";\nimport ServiceFactory from \"sap/ui/core/service/ServiceFactory\";\nimport type { ServiceContext } from \"types/metamodel_types\";\ntype CollaborativeToolsServiceSettings = {};\ntype TeamsConnection = {\n\tisInitialized: boolean;\n\tisContactsCollaborationSupported?: boolean;\n\tteamsHelperService?: TeamsHelperService;\n\tcontactOptions?: TeamsContactOption[];\n\tcmHelperService?: CollaborationManagerService;\n};\ntype CollaborationService = {\n\toTeamsHelperService: TeamsHelperService,\n\toCMHelperService: CollaborationManagerService\n}\nexport class CollaborativeToolsService extends Service<CollaborativeToolsServiceSettings> {\n\tinitPromise!: Promise<CollaborativeToolsService>;\n\n\tcollaborationService!: TeamsConnection;\n\n\toFactory!: CollaborativeToolsServiceFactory;\n\n\tinit(): void {\n\t\tthis.collaborationService = {\n\t\t\tisInitialized: false\n\t\t};\n\n\t\tthis.initPromise = Promise.resolve(this);\n\t}\n\n\tgetInterface(): CollaborativeToolsService {\n\t\treturn this;\n\t}\n\n\tprivate async initializeMSTeams(): Promise<void> {\n\t\ttry {\n\t\t\tconst collaborationService = await this.getCollaborationServices();\n\t\t\tthis.collaborationService.isInitialized = true;\n\t\t\tthis.collaborationService.teamsHelperService = collaborationService.oTeamsHelperService;\n\t\t\tthis.collaborationService.isContactsCollaborationSupported =\n\t\t\t\t//await helperService.isTeamsModeActive() && // this checks for url params appState=lean&sap-collaboration-teams=true\n\t\t\t\ttypeof collaborationService.oTeamsHelperService.isContactsCollaborationSupported === \"function\" && collaborationService.oTeamsHelperService.isContactsCollaborationSupported();\n\t\t\tthis.collaborationService.cmHelperService = collaborationService.oCMHelperService;\n\t\t} catch (e) {\n\t\t\tLog.info(\"Couldn't evaluate the support for contacts collaboration in MS Teams\");\n\t\t}\n\t}\n\n\tpublic async getMailPopoverFromMsTeamsIntegration(mail: string): Promise<Popover | undefined> {\n\t\tif (!this.collaborationService.isInitialized) {\n\t\t\tawait this.initializeMSTeams();\n\t\t}\n\t\ttry {\n\t\t\treturn await this.collaborationService.teamsHelperService?.enableContactsCollaboration(mail);\n\t\t} catch {\n\t\t\treturn undefined;\n\t\t}\n\t}\n\n\tasync isContactsCollaborationSupported(): Promise<boolean> {\n\t\tif (!this.collaborationService.isInitialized) {\n\t\t\tawait this.initializeMSTeams();\n\t\t}\n\t\treturn this.collaborationService.isContactsCollaborationSupported === true;\n\t}\n\n\tpublic async getTeamContactStatus(email: string): Promise<ContactStatus[] | undefined> {\n\t\tif (!this.collaborationService.isInitialized) {\n\t\t\tawait this.initializeMSTeams();\n\t\t}\n\t\tif (!this.collaborationService.isContactsCollaborationSupported) {\n\t\t\treturn undefined;\n\t\t}\n\n\t\ttry {\n\t\t\treturn await this.collaborationService.teamsHelperService?.getTeamsContactStatus(email);\n\t\t} catch {\n\t\t\treturn undefined;\n\t\t}\n\t}\n\n\tpublic async getTeamContactOptions(): Promise<TeamsContactOption[] | undefined> {\n\t\tif (!this.collaborationService.isInitialized) {\n\t\t\tawait this.initializeMSTeams();\n\t\t}\n\t\tif (!this.collaborationService.isContactsCollaborationSupported) {\n\t\t\treturn undefined;\n\t\t}\n\t\tif (!this.collaborationService.contactOptions) {\n\t\t\ttry {\n\t\t\t\tthis.collaborationService.contactOptions = await this.collaborationService.teamsHelperService?.getTeamsContactCollabOptions();\n\t\t\t} catch {\n\t\t\t\treturn undefined;\n\t\t\t}\n\t\t}\n\t\treturn this.collaborationService.contactOptions;\n\t}\n\n\tpublic async getTeamContactOption(option: \"call\" | \"chat\" | \"videoCall\"): Promise<TeamsContactOption | undefined> {\n\t\tconst contactOptions = await this.getTeamContactOptions();\n\t\tlet contactOption;\n\t\tif (contactOptions) {\n\t\t\tfor (let i = 0; i < contactOptions.length; i++) {\n\t\t\t\tif (contactOptions[i].key === option) {\n\t\t\t\t\tcontactOption = contactOptions[i];\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\treturn contactOption;\n\t}\n\n\tpublic async getTeamsCollabOptionsViaShare(params: CollaborationOptionParams): Promise<CollaborationOptions[] | undefined> {\n\t\tif (!this.collaborationService.isInitialized) {\n\t\t\tawait this.initializeMSTeams();\n\t\t}\n\t\treturn this.collaborationService.teamsHelperService?.getOptions(params);\n\t}\n\n\tpublic async getCollaborationManagerOption(): Promise<CollaborationOptions | undefined> {\n\t\tif (!this.collaborationService.isInitialized) {\n\t\t\tawait this.initializeMSTeams();\n\t\t}\n\t\treturn this.collaborationService.cmHelperService?.getOptions();\n\t}\n\n\tpublic async getCollaborationServices(): Promise<CollaborationService> {\n\t\tconst { default: ServiceContainerClass } = await import(\"sap/suite/ui/commons/collaboration/ServiceContainer\");\n\t\treturn ServiceContainerClass.getCollaborationServices();\n\t}\n}\n\nclass CollaborativeToolsServiceFactory extends ServiceFactory<CollaborativeToolsServiceSettings> {\n\tpublic static CollaborativeToolsServiceClass = CollaborativeToolsService;\n\n\tasync createInstance(serviceContext: ServiceContext<CollaborativeToolsServiceSettings>): Promise<CollaborativeToolsService> {\n\t\tconst collaborativeToolsService = new CollaborativeToolsService(serviceContext);\n\t\treturn collaborativeToolsService.initPromise;\n\t}\n}\nexport default CollaborativeToolsServiceFactory;\n"],"mappings":"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","ignoreList":[],"file":"CollaborativeToolsServiceFactory-dbg.js"}