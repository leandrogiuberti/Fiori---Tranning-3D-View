/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)
 *      (c) Copyright 2009-2025 SAP SE. All rights reserved
 */
sap.ui.define(["sap/base/Log","sap/ui/core/service/Service","sap/ui/core/service/ServiceFactory"],function(e,t,n){"use strict";var i={};function r(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e,s(e,t)}function s(e,t){return s=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},s(e,t)}let a=function(e){function t(){return e.apply(this,arguments)||this}r(t,e);var n=t.prototype;n.init=function e(){this.initPromise=Promise.resolve(this);this.instanceType="mock"};n.getLinks=async function e(){return Promise.resolve([])};n.__fetchSemanticObject=async function e(){return Promise.resolve([])};n.getLinksWithCache=async function e(){return Promise.resolve([])};n.toExternal=function e(){};n.getStartupAppState=async function e(){return Promise.resolve(undefined)};n.isJamActive=function e(){return false};n.backToPreviousApp=function e(){};n.hrefForExternal=async function e(){return Promise.resolve("")};n.getHref=async function e(){return Promise.resolve("")};n.getHash=function e(){return window.location.href};n.getAppState=async function e(){return Promise.resolve({})};n.createEmptyAppState=async function e(){return Promise.resolve({})};n.createEmptyAppStateAsync=async function e(){return Promise.resolve({})};n.navigate=async function e(){return Promise.resolve(undefined)};n.isNavigationSupported=async function e(){return Promise.resolve([])};n.isInitialNavigation=async function e(){return Promise.resolve(false)};n.expandCompactHash=async function e(){return Promise.resolve("")};n.parseShellHash=function e(){return{}};n.splitHash=function e(t){const n=/#[^/]*\/(.*)/.exec(t);return{shellPart:"",appSpecificRoute:n?.length===2?n[1]:""}};n.constructShellHash=function e(){return""};n.setDirtyFlag=function e(){};n.registerDirtyStateProvider=function e(){};n.deregisterDirtyStateProvider=function e(){};n.getUser=function e(){return{}};n.getUserInitials=function e(){return""};n.hasUShell=function e(){return false};n.registerNavigationFilter=function e(){};n.unregisterNavigationFilter=function e(){};n.setBackNavigation=async function e(){return Promise.resolve()};n.setHierarchy=async function e(){return Promise.resolve()};n.setTitle=async function e(){return Promise.resolve()};n.getContentDensity=function e(){if(document.body.classList.contains("sapUiSizeCozy")){return"cozy"}else if(document.body.classList.contains("sapUiSizeCompact")){return"compact"}else{return""}};n.getPrimaryIntent=async function e(){return Promise.resolve(undefined)};n.waitForPluginsLoad=async function e(){return Promise.resolve(true)};n.getTitle=async function e(){return Promise.resolve("")};n.getPersonalizer=async function e(t,n,i){return Promise.resolve({getPersData:async()=>Promise.resolve({historyEnabled:false,suggestionsEnabled:false,apps:{}}),setPersData:()=>{}})};n.getApplicationPersonalizer=async function e(t){return Promise.resolve({getPersData:async()=>Promise.resolve({}),setPersData:()=>{}})};n.getApplicationPersonalizationData=async function e(t){return Promise.resolve({})};n.setApplicationPersonalizationData=async function e(t,n){return Promise.resolve()};n.deletePersonalizationContainer=async function e(t,n){return Promise.resolve()};n.getShellConfig=function e(){return{}};n.getRegisteredPlugins=function e(){return{AppWarmup:{},RendererExtensions:{},UserDefaults:{},UserImage:{}}};n.isFlpOptimisticBatchPluginLoaded=function e(){return false};n.parseParameters=function e(){return{}};n.getExtensionService=function e(){return{}};n.getInframeUrl=async function e(){return Promise.resolve("")};return t}(t);let o=function(t){function n(){var e;for(var n=arguments.length,i=new Array(n),r=0;r<n;r++){i[r]=arguments[r]}e=t.call(this,...i)||this;e.applicationPersonnalizers={};return e}i.ShellServices=n;r(n,t);var s=n.prototype;s.init=function e(){const t=this.getContext();this.appComponent=t.scopeObject;this.oShellContainer=t.settings.shellContainer;this.instanceType="real";this.linksCache={};this.fnFindSemanticObjectsInCache=function(e){const t=[];const n=[];for(const i of e){if(!!i&&!!i.semanticObject){if(this.linksCache[i.semanticObject]){t.push(this.linksCache[i.semanticObject].links);Object.defineProperty(i,"links",{value:this.linksCache[i.semanticObject].links})}else{n.push(i)}}}return{oldArgs:e,newArgs:n,cachedLinks:t}};this.initPromise=new Promise((e,t)=>{this.resolveFn=e;this.rejectFn=t});const n=this.oShellContainer.getServiceAsync("Navigation");const i=this.oShellContainer.getServiceAsync("UserInfo");const r=this.oShellContainer.getServiceAsync("URLParsing");const s=this.oShellContainer.getServiceAsync("ShellNavigationInternal");const a=this.oShellContainer.getServiceAsync("PluginManager");const o=this.oShellContainer.getServiceAsync("PersonalizationV2");const c=this.oShellContainer.getServiceAsync("Extension");Promise.all([n,i,r,s,o,a,c]).then(e=>{let[t,n,i,r,s,a,o]=e;this.applicationNavigation=t;this.userInfoService=n;this.urlParsingService=i;this.shellNavigation=r;this.shellPersonalizationService=s;this.shellPluginManager=a;this.extensionService=o;this.resolveFn();return}).catch(this.rejectFn)};s.getLinks=async function e(t){return this.applicationNavigation.getLinks(t)};s.__fetchSemanticObject=async function e(){return this.applicationNavigation.getSemanticObjects()};s.getLinksWithCache=async function e(t){if(t.length===0){return[]}else{const e=this.fnFindSemanticObjectsInCache(t);if(e.newArgs.length===0){return e.cachedLinks}else{const t=await this.applicationNavigation.getLinks(e.newArgs);if(t.length!==0){const n={};for(let i=0;i<t.length;i++){if(t[i].length>0&&e.newArgs[i][0].links===undefined){n[e.newArgs[i][0].semanticObject]={links:t[i]};this.linksCache=Object.assign(this.linksCache,n)}}}if(e.cachedLinks.length===0){return t}else{const n=[];let i=0;for(const r of e.oldArgs){if(i<t.length){if(t[i].length>0&&r[0].semanticObject===e.newArgs[i][0].semanticObject){n.push(t[i]);i++}else{n.push(r[0].links)}}else{n.push(r[0].links)}}return n}}}};s.getShellUIService=async function e(){return this.appComponent.getService("ShellUIService")};s.getShellContainer=function e(){return this.oShellContainer};s.getInframeUrl=async function t(){const n=this.getShellContainer();let i;if(n?.inAppRuntime()){try{i=await n.getFLPUrlAsync(true)}catch(t){e.error("Error while getting the FLP URL",t)}}return i};s.toExternal=function e(t,n){this.navigate(t,n)};s.getStartupAppState=async function e(t){return this.applicationNavigation.getStartupAppState(t)};s.backToPreviousApp=async function e(){return this.applicationNavigation.backToPreviousApp()};s.hrefForExternal=async function e(t,n){return this.applicationNavigation.getHref(t,n)};s.getHref=async function e(t,n){return this.applicationNavigation.getHref(t,n)};s.getAppState=async function e(t,n){return this.applicationNavigation.getAppState(t,n)};s.createEmptyAppState=async function e(t){return this.applicationNavigation.createEmptyAppState(t)};s.isNavigationSupported=async function e(t,n){return this.applicationNavigation.isNavigationSupported(t,n)};s.navigate=async function e(t,n){return await this.applicationNavigation.navigate(t,n)};s.isInitialNavigation=async function e(){return this.applicationNavigation.isInitialNavigation()};s.expandCompactHash=async function e(t){return Promise.resolve(t)};s.getHash=function e(){return`#${this.urlParsingService.getShellHash(window.location.href)}`};s.getRegisteredPlugins=function e(){return this.shellPluginManager.getRegisteredPlugins()};s.isFlpOptimisticBatchPluginLoaded=function e(){const t=this.getRegisteredPlugins().RendererExtensions;if(t?.hasOwnProperty("MANAGE_FE_CACHES")&&!!t.MANAGE_FE_CACHES.enabled){return true}else{return false}};s.parseShellHash=function e(t){return this.urlParsingService.parseShellHash(t)};s.splitHash=function e(t){return this.urlParsingService.splitHash(t)};s.constructShellHash=function e(t){return this.urlParsingService.constructShellHash(t)};s.setDirtyFlag=function e(t){this.oShellContainer.setDirtyFlag(t)};s.registerDirtyStateProvider=function e(t){this.oShellContainer.registerDirtyStateProvider(t)};s.deregisterDirtyStateProvider=function e(t){this.oShellContainer.deregisterDirtyStateProvider(t)};s.getUser=function e(){return this.userInfoService};s.isJamActive=function e(){return this.oShellContainer.getUser().isJamActive()};s.getUserInitials=function e(){return this.oShellContainer.getUser().getInitials()};s.hasUShell=function e(){return true};s.registerNavigationFilter=function e(t){this.shellNavigation.registerNavigationFilter(t)};s.unregisterNavigationFilter=function e(t){this.shellNavigation.unregisterNavigationFilter(t)};s.setBackNavigation=async function e(t){(await this.getShellUIService()).setBackNavigation(t)};s.setHierarchy=async function e(t){(await this.getShellUIService()).setHierarchy(t)};s.setTitle=async function e(t,n){(await this.getShellUIService()).setTitle(t,n)};s.getTitle=async function e(){return(await this.getShellUIService()).getTitle()};s.getContentDensity=function e(){return this.oShellContainer.getUser().getContentDensity()};s.getPrimaryIntent=async function e(t,n){const i=await this.applicationNavigation.getPrimaryIntent(t,n);if(Array.isArray(i)){return i[0]}else{return i}};s.waitForPluginsLoad=async function t(){return new Promise(t=>{if(!this.shellPluginManager?.getPluginLoadingPromise){t(false)}else{this.shellPluginManager.getPluginLoadingPromise("RendererExtensions").fail(n=>{e.error(n,"sap.fe.core.services.ShellServicesFactory.waitForPluginsLoad");t(false)}).then(()=>t(true))}})};s.getPersonalizer=async function e(t,n,i){n={keyCategory:this.shellPersonalizationService.constants.keyCategory.FIXED_KEY,writeFrequency:this.shellPersonalizationService.constants.writeFrequency.LOW,clientStorageAllowed:false,validity:Infinity,...n};return await this.shellPersonalizationService.getPersonalizer(t,n,i)};s.deletePersonalizationContainer=async function e(t,n){return this.shellPersonalizationService.deleteContainer(t,n)};s.getApplicationPersonalizer=async function e(t){if(!this.applicationPersonnalizers[t]){this.applicationPersonnalizers[t]=this.getPersonalizer({container:`Application#${this.appComponent.getManifest()["sap.app"].id}`,item:t},{},this.appComponent)}return this.applicationPersonnalizers[t]};s.getApplicationPersonalizationData=async function e(t){return await((await this.getApplicationPersonalizer(t))?.getPersData())};s.setApplicationPersonalizationData=async function e(t,n){(await this.getApplicationPersonalizer(t)).setPersData(n)};s.getShellConfig=function e(){return window["sap-ushell-config"]};s.parseParameters=function e(t){return this.urlParsingService.parseParameters(t)};s.getExtensionService=function e(){return this.extensionService};return n}(t);i.ShellServices=o;let c=function(t){function n(){return t.apply(this,arguments)||this}r(n,t);var i=n.prototype;i.createInstance=async function t(n){n.settings.shellContainer=sap.ui.require("sap/ushell/Container");const i=n.settings.shellContainer?new o(n):new a(n);await i.initPromise;const r=n.scopeObject;r.getShellServices=()=>i;const s=r.getModel("internal");if(s){let t=[];try{t=await i.__fetchSemanticObject()}catch(t){e.error("Error while calling getSemanticObjects",t)}finally{s.setProperty("/semanticObjects",t)}}return i};return n}(n);return c},false);
//# sourceMappingURL=ShellServicesFactory.js.map