{"version":3,"file":"AppComponent.designtime.js","names":["urlParams","URLSearchParams","window","location","search","fioriToolsRtaMode","get","toLowerCase","getAllowList","element","allowList","elementName","getMetadata","getName","getParent","getId","includes","getExtensionAPI","appComponent","rootViewController","getRootViewController","appContentContainer","getAppContentContainer","isA","currentPage","getCurrentPage","currentView","getViewFromContainer","undefined","controller","getController","getCurrentBeginColumnPage","_exports","AppComponentDesignTime","actions","aggregations","rootControl","propagateMetadata","tool","start","setAdaptationMode","getEnvironmentCapabilities","setCapability","stop","versionWasActivated","AppStateHandler","setRTAVersionWasActivated","extensionAPI","updateAppState"],"sources":["./AppComponent.designtime.ts"],"sourcesContent":["import type FlexibleColumnLayout from \"sap/f/FlexibleColumnLayout\";\nimport type NavContainer from \"sap/m/NavContainer\";\nimport type ManagedObject from \"sap/ui/base/ManagedObject\";\nimport type AppComponent from \"../AppComponent\";\nimport type { VersionActivated } from \"../AppStateHandler\";\nimport AppStateHandler from \"../AppStateHandler\";\nimport type ExtensionAPI from \"../ExtensionAPI\";\nimport type PageController from \"../PageController\";\n\nconst urlParams = new URLSearchParams(window.location.search);\nconst fioriToolsRtaMode: boolean = urlParams.get(\"fiori-tools-rta-mode\")?.toLowerCase() === \"true\";\n\nconst getAllowList = function (element: ManagedObject): Record<string, boolean> {\n\tlet allowList: Record<string, boolean> = {};\n\tconst elementName = element.getMetadata().getName();\n\tif (fioriToolsRtaMode) {\n\t\t// build the allow list for Fiori tools (developers)\n\t\tallowList = {\n\t\t\t\"sap.fe.macros.controls.FilterBar\": true,\n\t\t\t\"sap.ui.fl.variants.VariantManagement\": true,\n\t\t\t\"sap.ui.mdc.Table\": true\n\t\t};\n\t} else {\n\t\t// build the allow list for UI Adaptation (key users)\n\t\tallowList = {\n\t\t\t\"sap.fe.macros.controls.FilterBar\": true,\n\t\t\t\"sap.fe.templates.ObjectPage.controls.StashableHBox\": true,\n\t\t\t\"sap.fe.templates.ObjectPage.controls.StashableVBox\": true,\n\t\t\t\"sap.m.IconTabBar\": true,\n\t\t\t\"sap.ui.fl.util.IFrame\": true,\n\t\t\t\"sap.ui.fl.variants.VariantManagement\": true,\n\t\t\t\"sap.ui.layout.form.Form\": true,\n\t\t\t\"sap.ui.layout.form.FormContainer\": true,\n\t\t\t\"sap.ui.layout.form.FormElement\": true,\n\t\t\t\"sap.ui.mdc.Table\": true,\n\t\t\t\"sap.uxap.AnchorBar\": true,\n\t\t\t\"sap.m.IconTabHeader\": true,\n\t\t\t\"sap.uxap.ObjectPageLayout\": true,\n\t\t\t\"sap.fe.macros.controls.Section\": true,\n\t\t\t\"sap.fe.macros.controls.section.SubSection\": true,\n\t\t\t\"sap.uxap.ObjectPageSection\": true,\n\t\t\t\"sap.uxap.ObjectPageSubSection\": true,\n\t\t\t\"sap.f.DynamicPage\": true,\n\t\t\t\"sap.uxap.ObjectPageDynamicHeaderTitle\": true,\n\t\t\t\"sap.m.OverflowToolbar\": true,\n\t\t\t\"sap.m.ToggleButton\": true,\n\t\t\t\"sap.m.Button\": true,\n\t\t\t\"sap.m.MenuButton\": true,\n\t\t\t\"sap.ui.mdc.actiontoolbar.ActionToolbarAction\": true,\n\t\t\t\"sap.ui.mdc.ActionToolbar\": true,\n\t\t\t\"sap.f.DynamicPageTitle\": true\n\t\t};\n\t\t// currently we support the adaptation of IconTabfilter only for the IconTabHeader on Object Page (adaptation of sections and subsections)\n\t\tif (elementName === \"sap.m.IconTabFilter\" && element.getParent()?.getMetadata().getName() === \"sap.m.IconTabHeader\") {\n\t\t\tallowList[\"sap.m.IconTabFilter\"] = true;\n\t\t}\n\t\tif (elementName === \"sap.m.FlexBox\" && element.getId().includes(\"--fe::HeaderContentContainer\")) {\n\t\t\tallowList[\"sap.m.FlexBox\"] = true;\n\t\t}\n\t}\n\treturn allowList;\n};\n\n/**\n * Retrieves the Extension API for the current page from the provided app component.\n * If the current view or controller does not provide an Extension API, the function will either return `undefined` or throw an error.\n * @param appComponent An instance of the app component or page controller from which to retrieve the Extension API.\n * @returns The Extension API for the current page, or `undefined` if it cannot be retrieved.\n * @throws {Error} If the controller does not expose the `getExtensionAPI` method.\n */\nexport function getExtensionAPI(appComponent: PageController | AppComponent): ExtensionAPI | undefined {\n\tif (appComponent) {\n\t\tconst rootViewController = (appComponent as AppComponent).getRootViewController();\n\n\t\tconst appContentContainer = rootViewController.getAppContentContainer();\n\t\tif (appContentContainer?.isA<NavContainer>(\"sap.m.NavContainer\")) {\n\t\t\tconst currentPage = appContentContainer.getCurrentPage();\n\n\t\t\tconst currentView = rootViewController.getViewFromContainer(currentPage);\n\t\t\tif (!currentView) return undefined;\n\n\t\t\tconst controller = currentView.getController() as PageController;\n\t\t\tif (controller.getExtensionAPI) {\n\t\t\t\treturn controller.getExtensionAPI();\n\t\t\t}\n\t\t} else if (appContentContainer?.isA<FlexibleColumnLayout>(\"sap.f.FlexibleColumnLayout\")) {\n\t\t\tconst currentPage = appContentContainer.getCurrentBeginColumnPage();\n\n\t\t\tconst currentView = rootViewController.getViewFromContainer(currentPage);\n\t\t\tif (!currentView) return undefined;\n\n\t\t\tconst controller = currentView.getController() as PageController;\n\t\t\tif (controller.getExtensionAPI) {\n\t\t\t\treturn controller.getExtensionAPI();\n\t\t\t}\n\t\t}\n\t}\n\n\t// To handle cases where `appComponent` is undefined, you may explicitly return undefined.\n\treturn undefined;\n}\n\n// To enable all actions, remove the propagateMetadata function. Or, remove this file and its entry in AppComponent.js referring 'designTime'.\nconst AppComponentDesignTime = {\n\tactions: \"not-adaptable\",\n\taggregations: {\n\t\trootControl: {\n\t\t\tactions: \"not-adaptable\",\n\t\t\tpropagateMetadata: function (element: ManagedObject): { actions?: string } {\n\t\t\t\tconst allowList = getAllowList(element);\n\t\t\t\tif (allowList[element.getMetadata().getName()]) {\n\t\t\t\t\t// by returning the empty object, the same will be merged with element's native designtime definition, i.e. all actions will be enabled for this element\n\t\t\t\t\treturn {};\n\t\t\t\t} else {\n\t\t\t\t\t// not-adaptable will be interpreted by flex to disable all actions for this element\n\t\t\t\t\treturn {\n\t\t\t\t\t\tactions: \"not-adaptable\"\n\t\t\t\t\t};\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t},\n\ttool: {\n\t\tstart: function (appComponent: AppComponent): void {\n\t\t\tappComponent.setAdaptationMode(true);\n\t\t\tappComponent.getEnvironmentCapabilities().setCapability(\"AppState\", false);\n\t\t},\n\t\tstop: function (appComponent: AppComponent, versionWasActivated: VersionActivated): void {\n\t\t\tappComponent.setAdaptationMode(false);\n\t\t\tappComponent.getEnvironmentCapabilities().setCapability(\"AppState\", true);\n\n\t\t\tAppStateHandler.setRTAVersionWasActivated(appComponent.getId(), versionWasActivated?.versionWasActivated ?? false);\n\t\t\t// Access the extension API and call updateAppState()\n\t\t\tconst extensionAPI = getExtensionAPI(appComponent);\n\t\t\textensionAPI?.updateAppState();\n\t\t}\n\t}\n};\n\nexport default AppComponentDesignTime;\n"],"mappings":";;;;uEASA,MAAMA,EAAY,IAAIC,gBAAgBC,OAAOC,SAASC,QACtD,MAAMC,EAA6BL,EAAUM,IAAI,yBAAyBC,gBAAkB,OAE5F,MAAMC,EAAe,SAAUC,GAC9B,IAAIC,EAAqC,CAAC,EAC1C,MAAMC,EAAcF,EAAQG,cAAcC,UAC1C,GAAIR,EAAmB,CAEtBK,EAAY,CACX,mCAAoC,KACpC,uCAAwC,KACxC,mBAAoB,KAEtB,KAAO,CAENA,EAAY,CACX,mCAAoC,KACpC,qDAAsD,KACtD,qDAAsD,KACtD,mBAAoB,KACpB,wBAAyB,KACzB,uCAAwC,KACxC,0BAA2B,KAC3B,mCAAoC,KACpC,iCAAkC,KAClC,mBAAoB,KACpB,qBAAsB,KACtB,sBAAuB,KACvB,4BAA6B,KAC7B,iCAAkC,KAClC,4CAA6C,KAC7C,6BAA8B,KAC9B,gCAAiC,KACjC,oBAAqB,KACrB,wCAAyC,KACzC,wBAAyB,KACzB,qBAAsB,KACtB,eAAgB,KAChB,mBAAoB,KACpB,+CAAgD,KAChD,2BAA4B,KAC5B,yBAA0B,MAG3B,GAAIC,IAAgB,uBAAyBF,EAAQK,aAAaF,cAAcC,YAAc,sBAAuB,CACpHH,EAAU,uBAAyB,IACpC,CACA,GAAIC,IAAgB,iBAAmBF,EAAQM,QAAQC,SAAS,gCAAiC,CAChGN,EAAU,iBAAmB,IAC9B,CACD,CACA,OAAOA,CACR,EASO,SAASO,EAAgBC,GAC/B,GAAIA,EAAc,CACjB,MAAMC,EAAsBD,EAA8BE,wBAE1D,MAAMC,EAAsBF,EAAmBG,yBAC/C,GAAID,GAAqBE,IAAkB,sBAAuB,CACjE,MAAMC,EAAcH,EAAoBI,iBAExC,MAAMC,EAAcP,EAAmBQ,qBAAqBH,GAC5D,IAAKE,EAAa,OAAOE,UAEzB,MAAMC,EAAaH,EAAYI,gBAC/B,GAAID,EAAWZ,gBAAiB,CAC/B,OAAOY,EAAWZ,iBACnB,CACD,MAAO,GAAII,GAAqBE,IAA0B,8BAA+B,CACxF,MAAMC,EAAcH,EAAoBU,4BAExC,MAAML,EAAcP,EAAmBQ,qBAAqBH,GAC5D,IAAKE,EAAa,OAAOE,UAEzB,MAAMC,EAAaH,EAAYI,gBAC/B,GAAID,EAAWZ,gBAAiB,CAC/B,OAAOY,EAAWZ,iBACnB,CACD,CACD,CAGA,OAAOW,SACR,CAEAI,EAAAf,kBACA,MAAMgB,EAAyB,CAC9BC,QAAS,gBACTC,aAAc,CACbC,YAAa,CACZF,QAAS,gBACTG,kBAAmB,SAAU5B,GAC5B,MAAMC,EAAYF,EAAaC,GAC/B,GAAIC,EAAUD,EAAQG,cAAcC,WAAY,CAE/C,MAAO,CAAC,CACT,KAAO,CAEN,MAAO,CACNqB,QAAS,gBAEX,CACD,IAGFI,KAAM,CACLC,MAAO,SAAUrB,GAChBA,EAAasB,kBAAkB,MAC/BtB,EAAauB,6BAA6BC,cAAc,WAAY,MACrE,EACAC,KAAM,SAAUzB,EAA4B0B,GAC3C1B,EAAasB,kBAAkB,OAC/BtB,EAAauB,6BAA6BC,cAAc,WAAY,MAEpEG,EAAgBC,0BAA0B5B,EAAaH,QAAS6B,GAAqBA,qBAAuB,OAE5G,MAAMG,EAAe9B,EAAgBC,GACrC6B,GAAcC,gBACf,IAEA,OAEaf,CAAsB","ignoreList":[]}