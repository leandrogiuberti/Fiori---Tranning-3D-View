{"version":3,"names":["normalizeSearchTerm","sSearchTerm","undefined","convertedSearchTerm","replace","waitForContextRequested","bindingContext","model","getModel","metaModel","getMetaModel","entityPath","getMetaPath","getPath","dataModel","MetaModelConverter","getInvolvedDataModelObjects","getContext","requestProperty","targetEntityType","keys","name","fnHasTransientContexts","oListBinding","bHasTransientContexts","getCurrentContexts","forEach","oContext","isTransient","_getSOIntents","oShellServiceHelper","oObjectPageLayout","oSemanticObject","oParam","getLinks","semanticObject","params","_createMappings","oMapping","aSOMappings","aMappingKeys","Object","oSemanticMapping","element","LocalProperty","$PropertyPath","SemanticObjectProperty","push","_getRelatedAppsMenuItems","linkGroup","aExcludedActions","oTargetParams","aItems","aAllowedActions","links","oLink","sIntent","intent","sAction","split","includes","text","targetSemObject","targetAction","targetParams","_getRelatedIntents","oAdditionalSemanticObjects","oBindingContext","aManifestSOItems","aLinks","length","allowedActions","unavailableActions","mapping","navigationContexts","semanticObjectMapping","_getRelatedIntentsWithSemanticObjectsAndAction","semanticObjectAndAction","appComponentSOItems","actions","action","excludedActions","soMappings","updateRelateAppsModel","oEntry","aSemKeys","oMetaModel","oMetaPath","appComponent","getShellServices","sCurrentSemObj","sCurrentAction","oSemanticObjectAnnotations","aRelatedAppsMenuItems","aManifestSOKeys","fnGetParseShellHashAndGetLinks","oParsedUrl","parseShellHash","document","location","hash","sSemKey","value","aTechnicalKeys","getObject","key","sObjKey","oManifestData","getTargetView","getViewData","semanticObjectIntents","additionalSemanticObjects","Promise","resolve","componentData","getComponentData","feEnvironment","getIntent","internalModelContext","getBindingContext","isSemanticObjectHasSameTargetInManifest","aAnnotationsSOItems","sEntitySetPath","sEntityTypePath","oEntitySetAnnotations","CommonUtils","getSemanticObjectAnnotations","bHasEntitySetSO","oEntityTypeAnnotations","aUnavailableActions","aMappings","_ref","soItems","concat","setProperty","error","Log","_getSemanticObjectAnnotations","oEntityAnnotations","sAnnotationMappingTerm","sAnnotationActionTerm","sQualifier","fnUpdateRelatedAppsDetails","path","sSemanticKeyVocabulary","requestObject","then","requestedObject","catch","oError","fnFireButtonPress","oButton","isA","getVisible","getEnabled","firePress","getAppComponent","oControl","oOwner","Component","getOwnerComponentFor","Error","getCurrentPageView","oAppComponent","rootViewController","getRootViewController","isFclEnabled","getRightmostView","getRootContainer","getCurrentPage","oComponent","getComponentInstance","getRootControl","getParent","_fnCheckIsMatch","oObject","oKeysToCheck","sKey","fnGetContextPathProperties","metaModelContext","sContextPath","oFilter","oEntityType","oProperties","hasOwnProperty","test","$kind","fnGetIBNActions","aIBNActions","aActions","getActions","oAction","getAction","oMenu","getMenu","getItems","oItem","data","fnUpdateDataFieldForIBNButtonsVisibility","oView","oParams","isSticky","ModelHelper","isStickySessionSupported","fnGetLinks","oData","aKeys","indexOf","oIBNAction","sSemanticObject","aLink","setVisible","getId","shellNavigationNotAvailable","updateMenuButtonVisiblity","IBNActions","menuButtonWithIBNAction","IBNAction","menuAction","menuItems","visibleMenuItems","filter","menuItem","getActionPath","actionContext","bReturnOnlyPath","inActionName","bCheckStaticValue","sActionName","toString","sEntityTypeName","$Type","sEntityName","getEntitySetName","sProperty","sBindingParameter","sEntityType","oEntityContainer","computeDisplayMode","oPropertyAnnotations","oCollectionAnnotations","oTextAnnotation","oTextArrangementAnnotation","$EnumMember","_getEntityType","_requestObject","oSelectedContext","nBracketIndex","sTargetType","slice","sCurrentType","getBinding","warning","sDynamicActionEnabledPath","oPromise","requestSingletonProperty","vPropertyValue","setContextsBasedOnOperationAvailable","oInternalModelContext","aRequestPromises","forContextMenu","arguments","all","aResults","aApplicableContexts","aNotApplicableContexts","aResult","setDynamicActionContexts","trace","applicable","notApplicable","dynamicActionPathPrefix","internalModel","applicableProperty","notApplicableProperty","getSpecificAllowedExpression","aExpressions","aAllowedExpressionsPriority","AllowedExpressionsPrio","sort","a","b","getOperatorsForGuidProperty","allowedOperatorsForGuid","getParameterInfo","sParameterContextPath","substring","lastIndexOf","bResultContext","oParameterInfo","contextPath","parameterProperties","getContextPathProperties","addPageContextToSelectionVariant","oSelectionVariant","mPageContext","oNavigationService","getNavigationService","mixAttributesAndSelectionVariant","toJSONString","isStickyEditMode","bIsStickyMode","bUIEditable","getIsEditable","setUserDefaults","parameters","isAction","isCreate","actionDefaultValues","BaseType","__ui5_require_async","default","TypeMap","startupParameters","shellServices","startupAppState","getStartupAppState","startupAppStateData","getData","extendedParameters","selectionVariant","SelectOptions","oParameter","sPropertyName","sParameterName","parametertType","type","getBaseType","String","typeInstance","getDataTypeInstance","parseValue","oExtendedParameter","PropertyName","oRange","Ranges","Sign","Option","Low","getAdditionalParamsForCreate","oStartupParameters","oInboundParameters","oInbounds","aCreateParameters","sParameter","useForCreate","oRet","sCreateParameter","aValues","create","getSemanticObjectMapping","oOutbound","aSemanticObjectMapping","aParameters","sParam","format","getHeaderFacetItemConfigForExternalNavigation","oViewData","oCrossNav","oHeaderFacetItems","sId","oControlConfig","controlConfiguration","config","sOutbound","navigation","targetOutbound","outbound","generate","setSemanticObjectMappings","vMappings","oMappings","JSON","parse","sLocalProperty","sSemanticObjectProperty","oSelectOption","getSelectOption","removeSelectOption","massAddSelectOption","fnGetSemanticObjectsFromPath","sPath","aSemanticObjectUnavailableActions","aSemanticObjectForGetLinks","semanticObjectPath","semanticObjectForGetLinks","fnGetSemanticObjectPromise","getSemanticObjectsFromPath","getFilterAllowedExpression","oFilterRestrictionsAnnotation","mAllowedExpressions","FilterExpressionRestrictions","oProperty","Property","AllowedExpressions","getFilterRestrictions","sRestriction","aProps","map","_fetchPropertiesForNavPath","paths","navPath","props","navPathPrefix","reduce","outPaths","pathToCheck","startsWith","outPath","getFilterRestrictionsByPath","RequiredProperties","NonFilterableProperties","FilterAllowedExpressions","oFilterRestrictions","navigationText","frTerm","entityTypePathParts","replaceAll","filterOutNavPropBinding","entityTypePath","join","entitySetPath","getEntitySetPath","entitySetPathParts","isContainment","containmentNavPath","resultContextCheck","parentEntitySetPath","oParentRet","oParentFR","completeAllowedExps","outProp","propPath","outPropPath","mergeObjects","oNavRestrictions","MetaModelFunction","getNavigationRestrictions","oNavFilterRest","navResReqProps","uniqueSort","navNonFilterProps","navAssociationEntityRest","navAssocReqProps","navAssocNonFilterProps","templateControlFragment","sFragmentName","oPreprocessorSettings","oInOptions","oModifier","oOptions","view","oFragment","targets","fragmentData","XMLTemplateProcessor","loadTemplate","XMLPreprocessor","process","firstElementChild","isXML","owner","runAsOwner","fn","containingView","viewOwner","controller","Fragment","load","id","definition","getSingletonPath","parts","Boolean","propertyName","pop","navigationPath","entitySet","singletonName","resolvedPath","propertyBinding","bindProperty","requestValue","getParameterPath","sContext","aAction","_fntranslatedTextFromExpBindingString","expBinding","control","anyResourceText","AnyElement","anyText","addDependent","resultText","getAnyText","removeDependent","destroy","isSmallDevice","Device","system","desktop","resize","width","getFiltersFromAnnotation","annotationPath","svContext","getMetaContext","propertyFilters","annotation","targetObject","isAnnotationOfType","SelectionVariant","selectOption","$target","propertyType","propertyPath","j","range","getRangeDefinition","Filter","operator","rangeLow","rangeHigh","filters","and","getConverterContextForPath","sMetaPath","sEntitySet","oDiagnostics","createBindingContext","ConverterContext","createConverterContextForMacro","createRootContext","programmingModel","bindingParameters","result","findOrCreateRootContext","isNew","rootContext","context","useCache","rootContextPath","getDraftRootPath","getStickyRootPath","simpleRootContext","existingBindingContextOnPage","getInstancedViews","find","pageView","getProperty","createNewRootContext","messagesPath","getMessagesPath","newBindingParameters","$select","newSelect","bindContext","getBoundContext","source","managedObject","getView","INLINEEDIT_UPDATEGROUPID","fireButtonPress","hasTransientContext","updateRelatedAppsDetails","updateDataFieldForIBNButtonsVisibility","getIBNActions","getSemanticObjectPromise","FilterRestrictions","REQUIRED_PROPERTIES","NON_FILTERABLE_PROPERTIES","ALLOWED_EXPRESSIONS","getRelatedAppsMenuItems","getTranslatedTextFromExpBindingString"],"sourceRoot":".","sources":["CommonUtils.ts"],"sourcesContent":["import type { ActionParameter as EdmActionParameter } from \"@sap-ux/vocabularies-types\";\nimport type * as Edm from \"@sap-ux/vocabularies-types/Edm\";\nimport type { FilterRestrictionsType } from \"@sap-ux/vocabularies-types/vocabularies/Capabilities\";\nimport type {\n\tSemanticObjectMappingAbstractTypes,\n\tSemanticObjectMappingTypeTypes,\n\tSemanticObjectUnavailableActions\n} from \"@sap-ux/vocabularies-types/vocabularies/Common\";\nimport { CommonAnnotationTerms } from \"@sap-ux/vocabularies-types/vocabularies/Common\";\nimport type { SelectionPresentationVariant, SelectionVariantType, TextArrangement } from \"@sap-ux/vocabularies-types/vocabularies/UI\";\nimport { UIAnnotationTypes } from \"@sap-ux/vocabularies-types/vocabularies/UI\";\nimport Log from \"sap/base/Log\";\nimport uniqueSort from \"sap/base/util/array/uniqueSort\";\nimport mergeObjects from \"sap/base/util/merge\";\nimport type AppComponent from \"sap/fe/core/AppComponent\";\nimport type { ComponentData } from \"sap/fe/core/AppComponent\";\nimport type { FEView } from \"sap/fe/core/BaseController\";\nimport type ExtensionAPI from \"sap/fe/core/ExtensionAPI\";\nimport type PageController from \"sap/fe/core/PageController\";\nimport ConverterContext from \"sap/fe/core/converters/ConverterContext\";\nimport * as MetaModelConverter from \"sap/fe/core/converters/MetaModelConverter\";\nimport type { PageContextPathTarget } from \"sap/fe/core/converters/TemplateConverter\";\nimport type { InternalModelContext } from \"sap/fe/core/helpers/ModelHelper\";\nimport ModelHelper from \"sap/fe/core/helpers/ModelHelper\";\nimport { generate } from \"sap/fe/core/helpers/StableIdHelper\";\nimport { isAnnotationOfType } from \"sap/fe/core/helpers/TypeGuards\";\nimport type { IShellServices } from \"sap/fe/core/services/ShellServicesFactory\";\nimport type Diagnostics from \"sap/fe/core/support/Diagnostics\";\nimport type SelectionVariant from \"sap/fe/navigation/SelectionVariant\";\nimport type Button from \"sap/m/Button\";\nimport type MenuButton from \"sap/m/MenuButton\";\nimport type MenuItem from \"sap/m/MenuItem\";\nimport type NavContainer from \"sap/m/NavContainer\";\nimport type OverflowToolbarButton from \"sap/m/OverflowToolbarButton\";\nimport Device from \"sap/ui/Device\";\nimport type ManagedObject from \"sap/ui/base/ManagedObject\";\nimport Component from \"sap/ui/core/Component\";\nimport type ComponentContainer from \"sap/ui/core/ComponentContainer\";\nimport type Control from \"sap/ui/core/Control\";\nimport type UI5Element from \"sap/ui/core/Element\";\nimport Fragment from \"sap/ui/core/Fragment\";\nimport XMLTemplateProcessor from \"sap/ui/core/XMLTemplateProcessor\";\nimport type View from \"sap/ui/core/mvc/View\";\nimport XMLPreprocessor from \"sap/ui/core/util/XMLPreprocessor\";\nimport type { default as MDCChart } from \"sap/ui/mdc/Chart\";\nimport type Table from \"sap/ui/mdc/Table\";\nimport type ActionToolbarAction from \"sap/ui/mdc/actiontoolbar/ActionToolbarAction\";\nimport type MDCTable from \"sap/ui/mdc/valuehelp/content/MDCTable\";\nimport type Context from \"sap/ui/model/Context\";\nimport Filter from \"sap/ui/model/Filter\";\nimport type FilterOperator from \"sap/ui/model/FilterOperator\";\nimport type JSONModel from \"sap/ui/model/json/JSONModel\";\nimport type ODataV4Context from \"sap/ui/model/odata/v4/Context\";\nimport type ODataListBinding from \"sap/ui/model/odata/v4/ODataListBinding\";\nimport type ODataMetaModel from \"sap/ui/model/odata/v4/ODataMetaModel\";\nimport type ODataModel from \"sap/ui/model/odata/v4/ODataModel\";\nimport type { Link } from \"sap/ushell/services/Navigation\";\nimport type ObjectPageDynamicHeaderTitle from \"sap/uxap/ObjectPageDynamicHeaderTitle\";\nimport type ObjectPageLayout from \"sap/uxap/ObjectPageLayout\";\nimport type ObjectPageSubSection from \"sap/uxap/ObjectPageSubSection\";\nimport type {\n\tExpandPathType,\n\tMetaModelEntityType,\n\tMetaModelEnum,\n\tMetaModelNavProperty,\n\tMetaModelProperty,\n\tMetaModelType\n} from \"types/metamodel_types\";\nimport type { BindContextParameters } from \"./controllerextensions/editFlow/draft\";\nimport AnyElement from \"./controls/AnyElement\";\nimport { getRangeDefinition } from \"./converters/helpers/SelectionVariantHelper\";\nimport * as MetaModelFunction from \"./helpers/MetaModelFunction\";\n\ntype MyInboxIntent = {\n\tsemanticObject: string;\n\taction: string;\n};\n\nfunction normalizeSearchTerm(sSearchTerm: string | undefined): string | undefined {\n\tif (!sSearchTerm) {\n\t\treturn undefined;\n\t}\n\n\t// checking for search term \"OR\" is to allow the SD specific search for SaleOrderType=OR (OR is a hana keyword)\n\tif (sSearchTerm === \"OR\") {\n\t\treturn '\"' + sSearchTerm + '\"';\n\t}\n\n\tconst convertedSearchTerm = sSearchTerm.replace(/[\"();]/g, \" \"); // these are the specific characters that fail on both, CAP and RAP: \"();\n\tif (convertedSearchTerm === \"\" || convertedSearchTerm === \" \") {\n\t\treturn undefined;\n\t}\n\treturn convertedSearchTerm;\n}\n\nasync function waitForContextRequested(bindingContext: ODataV4Context): Promise<void> {\n\tconst model = bindingContext.getModel();\n\tconst metaModel = model.getMetaModel();\n\tconst entityPath = metaModel.getMetaPath(bindingContext.getPath());\n\tconst dataModel = MetaModelConverter.getInvolvedDataModelObjects(metaModel.getContext(entityPath));\n\tawait bindingContext.requestProperty(dataModel.targetEntityType.keys[0]?.name);\n}\n\nfunction fnHasTransientContexts(oListBinding: ODataListBinding): boolean {\n\tlet bHasTransientContexts = false;\n\tif (oListBinding) {\n\t\toListBinding.getCurrentContexts().forEach(function (oContext: ODataV4Context) {\n\t\t\tif (oContext && oContext.isTransient()) {\n\t\t\t\tbHasTransientContexts = true;\n\t\t\t}\n\t\t});\n\t}\n\treturn bHasTransientContexts;\n}\n\n// there is no navigation in entitySet path and property path\n\nasync function _getSOIntents(\n\toShellServiceHelper: IShellServices,\n\toObjectPageLayout: ObjectPageLayout,\n\toSemanticObject: string | undefined,\n\toParam: object | undefined\n): Promise<Link[][]> {\n\treturn oShellServiceHelper.getLinks([\n\t\t{\n\t\t\tsemanticObject: oSemanticObject,\n\t\t\tparams: oParam\n\t\t}\n\t]);\n}\n\ntype SOMapping = { LocalProperty: { $PropertyPath: string }; SemanticObjectProperty: unknown };\n// TO-DO add this as part of applySemanticObjectmappings logic in IntentBasednavigation controller extension\nfunction _createMappings(oMapping: Record<string, unknown>): SOMapping[] {\n\tconst aSOMappings: SOMapping[] = [];\n\tconst aMappingKeys = Object.keys(oMapping);\n\tlet oSemanticMapping: SOMapping;\n\tfor (const element of aMappingKeys) {\n\t\toSemanticMapping = {\n\t\t\tLocalProperty: {\n\t\t\t\t$PropertyPath: element\n\t\t\t},\n\t\t\tSemanticObjectProperty: oMapping[element]\n\t\t};\n\t\taSOMappings.push(oSemanticMapping);\n\t}\n\n\treturn aSOMappings;\n}\ntype SemanticItem = {\n\ttext: string;\n\ttargetSemObject: string;\n\ttargetAction: string;\n\ttargetParams: unknown;\n};\n/**\n * @param linkGroup\n * @param aExcludedActions\n * @param oTargetParams\n * @param aItems\n * @param aAllowedActions\n */\nfunction _getRelatedAppsMenuItems(\n\tlinkGroup: Link[][],\n\taExcludedActions: unknown[],\n\toTargetParams: unknown,\n\taItems: SemanticItem[],\n\taAllowedActions?: unknown[]\n): void {\n\tfor (const links of linkGroup) {\n\t\tfor (const oLink of links) {\n\t\t\tconst sIntent = oLink.intent;\n\t\t\tconst sAction = sIntent.split(\"-\")[1].split(\"?\")[0];\n\t\t\tif (\n\t\t\t\t(aAllowedActions && aAllowedActions.includes(sAction)) ||\n\t\t\t\t(!aAllowedActions && aExcludedActions && !aExcludedActions.includes(sAction))\n\t\t\t) {\n\t\t\t\taItems.push({\n\t\t\t\t\ttext: oLink.text,\n\t\t\t\t\ttargetSemObject: sIntent.split(\"#\")[1].split(\"-\")[0],\n\t\t\t\t\ttargetAction: sAction.split(\"~\")[0],\n\t\t\t\t\ttargetParams: oTargetParams\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\t}\n}\n\nexport type SemanticObject = {\n\tallowedActions?: unknown[];\n\tunavailableActions?: unknown[];\n\tsemanticObject: string;\n\tpath: string;\n\tmapping?: Record<string, string>;\n};\n\nfunction _getRelatedIntents(\n\toAdditionalSemanticObjects: SemanticObject,\n\toBindingContext: Context,\n\taManifestSOItems: SemanticItem[],\n\taLinks: Link[][]\n): void {\n\tif (aLinks && aLinks.length > 0) {\n\t\tconst aAllowedActions = oAdditionalSemanticObjects.allowedActions || undefined;\n\t\tconst aExcludedActions = oAdditionalSemanticObjects.unavailableActions ? oAdditionalSemanticObjects.unavailableActions : [];\n\t\tconst aSOMappings = oAdditionalSemanticObjects.mapping ? _createMappings(oAdditionalSemanticObjects.mapping) : [];\n\t\tconst oTargetParams = { navigationContexts: oBindingContext, semanticObjectMapping: aSOMappings };\n\t\t_getRelatedAppsMenuItems(aLinks, aExcludedActions, oTargetParams, aManifestSOItems, aAllowedActions);\n\t}\n}\n\n/**\n * This function fetches the related intents when semantic object and action are passed from feEnvironment.getIntent() only in case of My Inbox integration.\n * @param semanticObjectAndAction This specifies the semantic object and action for fetching the intents\n * @param oBindingContext This sepcifies the binding context for updating related apps\n * @param appComponentSOItems This is a list of semantic items used for updating the related apps button\n * @param aLinks This is an array comprising of related intents\n */\n\nfunction _getRelatedIntentsWithSemanticObjectsAndAction(\n\tsemanticObjectAndAction: MyInboxIntent,\n\toBindingContext: Context,\n\tappComponentSOItems: SemanticItem[],\n\taLinks: Link[][]\n): void {\n\tif (aLinks.length > 0) {\n\t\tconst actions = [semanticObjectAndAction.action];\n\t\tconst excludedActions: [] = [];\n\t\tconst soMappings: [] = [];\n\t\tconst targetParams = { navigationContexts: oBindingContext, semanticObjectMapping: soMappings };\n\t\t_getRelatedAppsMenuItems(aLinks, excludedActions, targetParams, appComponentSOItems, actions);\n\t}\n}\n\ntype SemanticObjectConfig = {\n\tadditionalSemanticObjects: Record<string, SemanticObject>;\n};\ntype RelatedAppsConfig = {\n\ttext: string;\n\ttargetSemObject: string;\n\ttargetAction: string;\n};\nasync function updateRelateAppsModel(\n\toBindingContext: Context,\n\toEntry: Record<string, unknown> | undefined,\n\toObjectPageLayout: ObjectPageLayout,\n\taSemKeys: { $PropertyPath: string }[],\n\toMetaModel: ODataMetaModel,\n\toMetaPath: string,\n\tappComponent: AppComponent\n): Promise<RelatedAppsConfig[]> {\n\tconst oShellServiceHelper: IShellServices = appComponent.getShellServices();\n\tconst oParam: Record<string, unknown> = {};\n\tlet sCurrentSemObj = \"\",\n\t\tsCurrentAction = \"\";\n\tlet oSemanticObjectAnnotations;\n\tlet aRelatedAppsMenuItems: RelatedAppsConfig[] = [];\n\tlet aExcludedActions: unknown[] = [];\n\tlet aManifestSOKeys: string[];\n\n\tasync function fnGetParseShellHashAndGetLinks(): Promise<Link[][]> {\n\t\tconst oParsedUrl = oShellServiceHelper.parseShellHash(document.location.hash);\n\t\tsCurrentSemObj = oParsedUrl.semanticObject; // Current Semantic Object\n\t\tsCurrentAction = oParsedUrl.action;\n\t\treturn _getSOIntents(oShellServiceHelper, oObjectPageLayout, sCurrentSemObj, oParam);\n\t}\n\n\ttry {\n\t\tif (oEntry) {\n\t\t\tif (aSemKeys && aSemKeys.length > 0) {\n\t\t\t\tfor (const element of aSemKeys) {\n\t\t\t\t\tconst sSemKey = element.$PropertyPath;\n\t\t\t\t\tif (!oParam[sSemKey]) {\n\t\t\t\t\t\toParam[sSemKey] = { value: oEntry[sSemKey] };\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\t// fallback to Technical Keys if no Semantic Key is present\n\t\t\t\tconst aTechnicalKeys = oMetaModel.getObject(`${oMetaPath}/$Type/$Key`);\n\t\t\t\tfor (const key in aTechnicalKeys) {\n\t\t\t\t\tconst sObjKey = aTechnicalKeys[key];\n\t\t\t\t\tif (!oParam[sObjKey]) {\n\t\t\t\t\t\toParam[sObjKey] = { value: oEntry[sObjKey] };\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\t// Logic to read additional SO from manifest and updated relatedapps model\n\n\t\tconst oManifestData = getTargetView(oObjectPageLayout).getViewData() as SemanticObjectConfig;\n\t\tconst aManifestSOItems: SemanticItem[] = [];\n\t\tlet semanticObjectIntents;\n\t\tif (oManifestData.additionalSemanticObjects) {\n\t\t\taManifestSOKeys = Object.keys(oManifestData.additionalSemanticObjects);\n\t\t\tfor (const element of aManifestSOKeys) {\n\t\t\t\tsemanticObjectIntents = await Promise.resolve(_getSOIntents(oShellServiceHelper, oObjectPageLayout, element, oParam));\n\t\t\t\t_getRelatedIntents(\n\t\t\t\t\toManifestData.additionalSemanticObjects[element],\n\t\t\t\t\toBindingContext,\n\t\t\t\t\taManifestSOItems,\n\t\t\t\t\tsemanticObjectIntents\n\t\t\t\t);\n\t\t\t}\n\t\t}\n\n\t\t// appComponentSOItems is updated in case of My Inbox integration when semantic object and action are passed from feEnvironment.getIntent() method\n\t\t// In other cases it remains as an empty list\n\t\t// We concat this list towards the end with aManifestSOItems\n\n\t\tconst appComponentSOItems: SemanticItem[] = [];\n\t\tconst componentData: ComponentData = appComponent.getComponentData();\n\t\tif (componentData.feEnvironment && componentData.feEnvironment.getIntent()) {\n\t\t\tconst intent: MyInboxIntent = componentData.feEnvironment.getIntent();\n\t\t\tsemanticObjectIntents = await Promise.resolve(\n\t\t\t\t_getSOIntents(oShellServiceHelper, oObjectPageLayout, intent.semanticObject, oParam)\n\t\t\t);\n\t\t\t_getRelatedIntentsWithSemanticObjectsAndAction(intent, oBindingContext, appComponentSOItems, semanticObjectIntents);\n\t\t}\n\n\t\tconst internalModelContext = oObjectPageLayout.getBindingContext(\"internal\") as InternalModelContext;\n\t\tconst aLinks = await fnGetParseShellHashAndGetLinks();\n\t\tif (aLinks) {\n\t\t\tif (aLinks.length > 0) {\n\t\t\t\tlet isSemanticObjectHasSameTargetInManifest = false;\n\t\t\t\tconst oTargetParams: {\n\t\t\t\t\tnavigationContexts?: Context;\n\t\t\t\t\tsemanticObjectMapping?: MetaModelType<SemanticObjectMappingAbstractTypes>[];\n\t\t\t\t} = {};\n\t\t\t\tconst aAnnotationsSOItems: SemanticItem[] = [];\n\t\t\t\tconst sEntitySetPath = `${oMetaPath}@`;\n\t\t\t\tconst sEntityTypePath = `${oMetaPath}/@`;\n\t\t\t\tconst oEntitySetAnnotations = oMetaModel.getObject(sEntitySetPath);\n\t\t\t\toSemanticObjectAnnotations = CommonUtils.getSemanticObjectAnnotations(oEntitySetAnnotations, sCurrentSemObj);\n\t\t\t\tif (!oSemanticObjectAnnotations.bHasEntitySetSO) {\n\t\t\t\t\tconst oEntityTypeAnnotations = oMetaModel.getObject(sEntityTypePath);\n\t\t\t\t\toSemanticObjectAnnotations = CommonUtils.getSemanticObjectAnnotations(oEntityTypeAnnotations, sCurrentSemObj);\n\t\t\t\t}\n\t\t\t\taExcludedActions = oSemanticObjectAnnotations.aUnavailableActions;\n\t\t\t\t//Skip same application from Related Apps\n\t\t\t\taExcludedActions.push(sCurrentAction);\n\t\t\t\toTargetParams.navigationContexts = oBindingContext;\n\t\t\t\toTargetParams.semanticObjectMapping = oSemanticObjectAnnotations.aMappings;\n\t\t\t\t_getRelatedAppsMenuItems(aLinks, aExcludedActions, oTargetParams, aAnnotationsSOItems);\n\n\t\t\t\taManifestSOItems.forEach(function ({ targetSemObject }) {\n\t\t\t\t\tif (aAnnotationsSOItems[0]?.targetSemObject === targetSemObject) {\n\t\t\t\t\t\tisSemanticObjectHasSameTargetInManifest = true;\n\t\t\t\t\t}\n\t\t\t\t});\n\n\t\t\t\t// remove all actions from current hash application if manifest contains empty allowedActions\n\t\t\t\tif (\n\t\t\t\t\toManifestData.additionalSemanticObjects &&\n\t\t\t\t\taAnnotationsSOItems[0] &&\n\t\t\t\t\toManifestData.additionalSemanticObjects[aAnnotationsSOItems[0].targetSemObject] &&\n\t\t\t\t\t!!oManifestData.additionalSemanticObjects[aAnnotationsSOItems[0].targetSemObject].allowedActions\n\t\t\t\t) {\n\t\t\t\t\tisSemanticObjectHasSameTargetInManifest = true;\n\t\t\t\t}\n\t\t\t\tconst soItems = aManifestSOItems.concat(appComponentSOItems);\n\t\t\t\taRelatedAppsMenuItems = isSemanticObjectHasSameTargetInManifest ? soItems : soItems.concat(aAnnotationsSOItems);\n\t\t\t\t// If no app in list, related apps button will be hidden\n\t\t\t\tinternalModelContext.setProperty(\"relatedApps/visibility\", aRelatedAppsMenuItems.length > 0);\n\t\t\t\tinternalModelContext.setProperty(\"relatedApps/items\", aRelatedAppsMenuItems);\n\t\t\t} else {\n\t\t\t\tinternalModelContext.setProperty(\"relatedApps/visibility\", false);\n\t\t\t}\n\t\t} else {\n\t\t\tinternalModelContext.setProperty(\"relatedApps/visibility\", false);\n\t\t}\n\t} catch (error: unknown) {\n\t\tLog.error(\"Cannot read links\", error as string);\n\t}\n\treturn aRelatedAppsMenuItems;\n}\n\nfunction _getSemanticObjectAnnotations(\n\toEntityAnnotations: Record<string, unknown>,\n\tsCurrentSemObj: string\n): {\n\tbHasEntitySetSO: boolean;\n\taAllowedActions: string[];\n\taUnavailableActions: MetaModelType<SemanticObjectUnavailableActions>[];\n\taMappings: MetaModelType<SemanticObjectMappingAbstractTypes>[];\n} {\n\tconst oSemanticObjectAnnotations = {\n\t\tbHasEntitySetSO: false,\n\t\taAllowedActions: [],\n\t\taUnavailableActions: [] as MetaModelType<SemanticObjectUnavailableActions>[],\n\t\taMappings: [] as MetaModelType<SemanticObjectMappingAbstractTypes>[]\n\t};\n\tlet sAnnotationMappingTerm, sAnnotationActionTerm;\n\tlet sQualifier;\n\tfor (const key in oEntityAnnotations) {\n\t\tif (key.includes(CommonAnnotationTerms.SemanticObject) && oEntityAnnotations[key] === sCurrentSemObj) {\n\t\t\toSemanticObjectAnnotations.bHasEntitySetSO = true;\n\t\t\tsAnnotationMappingTerm = `@${CommonAnnotationTerms.SemanticObjectMapping}`;\n\t\t\tsAnnotationActionTerm = `@${CommonAnnotationTerms.SemanticObjectUnavailableActions}`;\n\n\t\t\tif (key.includes(\"#\")) {\n\t\t\t\tsQualifier = key.split(\"#\")[1];\n\t\t\t\tsAnnotationMappingTerm = `${sAnnotationMappingTerm}#${sQualifier}`;\n\t\t\t\tsAnnotationActionTerm = `${sAnnotationActionTerm}#${sQualifier}`;\n\t\t\t}\n\t\t\tif (oEntityAnnotations[sAnnotationMappingTerm]) {\n\t\t\t\toSemanticObjectAnnotations.aMappings = oSemanticObjectAnnotations.aMappings.concat(\n\t\t\t\t\toEntityAnnotations[sAnnotationMappingTerm] as MetaModelType<SemanticObjectMappingAbstractTypes>\n\t\t\t\t);\n\t\t\t}\n\n\t\t\tif (oEntityAnnotations[sAnnotationActionTerm]) {\n\t\t\t\toSemanticObjectAnnotations.aUnavailableActions = oSemanticObjectAnnotations.aUnavailableActions.concat(\n\t\t\t\t\toEntityAnnotations[sAnnotationActionTerm] as MetaModelType<SemanticObjectUnavailableActions>\n\t\t\t\t);\n\t\t\t}\n\n\t\t\tbreak;\n\t\t}\n\t}\n\treturn oSemanticObjectAnnotations;\n}\n\nasync function fnUpdateRelatedAppsDetails(oObjectPageLayout: ObjectPageLayout, appComponent: AppComponent): Promise<unknown> {\n\tconst oMetaModel = (oObjectPageLayout.getModel() as ODataModel).getMetaModel();\n\tconst oBindingContext = oObjectPageLayout.getBindingContext() as ODataV4Context;\n\tconst path = (oBindingContext && oBindingContext.getPath()) || \"\";\n\tconst oMetaPath = oMetaModel.getMetaPath(path);\n\t// Semantic Key Vocabulary\n\tconst sSemanticKeyVocabulary = `${oMetaPath}/` + `@com.sap.vocabularies.Common.v1.SemanticKey`;\n\t//Semantic Keys\n\tconst aSemKeys = oMetaModel.getObject(sSemanticKeyVocabulary);\n\t// Unavailable Actions\n\tconst oEntry = oBindingContext?.getObject();\n\tif (!oEntry && oBindingContext) {\n\t\toBindingContext\n\t\t\t.requestObject()\n\t\t\t.then(async function (requestedObject: Record<string, unknown> | undefined) {\n\t\t\t\treturn CommonUtils.updateRelateAppsModel(\n\t\t\t\t\toBindingContext,\n\t\t\t\t\trequestedObject,\n\t\t\t\t\toObjectPageLayout,\n\t\t\t\t\taSemKeys,\n\t\t\t\t\toMetaModel,\n\t\t\t\t\toMetaPath,\n\t\t\t\t\tappComponent\n\t\t\t\t);\n\t\t\t})\n\t\t\t.catch(function (oError: unknown) {\n\t\t\t\tLog.error(\"Cannot update the related app details\", oError as string);\n\t\t\t});\n\t} else {\n\t\treturn CommonUtils.updateRelateAppsModel(oBindingContext, oEntry, oObjectPageLayout, aSemKeys, oMetaModel, oMetaPath, appComponent);\n\t}\n}\n\n/**\n * @param oButton\n */\nfunction fnFireButtonPress(oButton?: Control): void {\n\tif (\n\t\toButton &&\n\t\toButton.isA<Button | OverflowToolbarButton>([\"sap.m.Button\", \"sap.m.OverflowToolbarButton\"]) &&\n\t\toButton.getVisible() &&\n\t\toButton.getEnabled()\n\t) {\n\t\toButton.firePress();\n\t}\n}\n\nfunction getAppComponent(oControl: Control | Component): AppComponent {\n\tif (oControl.isA<AppComponent>(\"sap.fe.core.AppComponent\")) {\n\t\treturn oControl;\n\t}\n\tconst oOwner = Component.getOwnerComponentFor(oControl);\n\tif (!oOwner) {\n\t\tthrow new Error(\"There should be a sap.fe.core.AppComponent as owner of the control\");\n\t} else {\n\t\treturn getAppComponent(oOwner);\n\t}\n}\n\nfunction getCurrentPageView(oAppComponent: AppComponent): FEView {\n\tconst rootViewController = oAppComponent.getRootViewController();\n\treturn rootViewController.isFclEnabled()\n\t\t? rootViewController.getRightmostView()\n\t\t: CommonUtils.getTargetView((oAppComponent.getRootContainer() as NavContainer).getCurrentPage());\n}\n\nfunction getTargetView(oControl: ManagedObject | null): FEView {\n\tif (oControl && oControl.isA<ComponentContainer>(\"sap.ui.core.ComponentContainer\")) {\n\t\tconst oComponent = oControl.getComponentInstance();\n\t\toControl = oComponent && oComponent.getRootControl();\n\t}\n\twhile (oControl && !oControl.isA<FEView>(\"sap.ui.core.mvc.View\")) {\n\t\toControl = oControl.getParent();\n\t}\n\treturn oControl!;\n}\n\nfunction _fnCheckIsMatch(oObject: object, oKeysToCheck: Record<string, unknown>): boolean {\n\tfor (const sKey in oKeysToCheck) {\n\t\tif (oKeysToCheck[sKey] !== oObject[sKey as keyof typeof oObject]) {\n\t\t\treturn false;\n\t\t}\n\t}\n\treturn true;\n}\n\nfunction fnGetContextPathProperties(\n\tmetaModelContext: ODataMetaModel,\n\tsContextPath: string,\n\toFilter?: Record<string, unknown>\n): Record<string, MetaModelProperty> | Record<string, MetaModelNavProperty> {\n\tconst oEntityType: MetaModelEntityType = (metaModelContext.getObject(`${sContextPath}/`) || {}) as MetaModelEntityType,\n\t\toProperties: Record<string, MetaModelProperty> | Record<string, MetaModelNavProperty> = {};\n\n\tfor (const sKey in oEntityType) {\n\t\tif (\n\t\t\toEntityType.hasOwnProperty(sKey) &&\n\t\t\t!/^\\$/i.test(sKey) &&\n\t\t\toEntityType[sKey].$kind &&\n\t\t\t_fnCheckIsMatch(oEntityType[sKey], oFilter || { $kind: \"Property\" })\n\t\t) {\n\t\t\toProperties[sKey] = oEntityType[sKey];\n\t\t}\n\t}\n\treturn oProperties;\n}\n\nfunction fnGetIBNActions(oControl: Table | ObjectPageDynamicHeaderTitle | ObjectPageSubSection, aIBNActions: UI5Element[]): UI5Element[] {\n\tconst aActions = oControl && oControl.getActions();\n\tif (aActions) {\n\t\taActions.forEach(function (oAction) {\n\t\t\tif (oAction.isA<ActionToolbarAction>(\"sap.ui.mdc.actiontoolbar.ActionToolbarAction\")) {\n\t\t\t\toAction = oAction.getAction();\n\t\t\t}\n\t\t\tif (oAction.isA<MenuButton>(\"sap.m.MenuButton\")) {\n\t\t\t\tconst oMenu = oAction.getMenu();\n\t\t\t\tconst aItems = oMenu.getItems();\n\t\t\t\taItems.forEach((oItem) => {\n\t\t\t\t\tif (oItem.data(\"IBNData\")) {\n\t\t\t\t\t\taIBNActions.push(oItem);\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t} else if (oAction.data(\"IBNData\")) {\n\t\t\t\taIBNActions.push(oAction);\n\t\t\t}\n\t\t});\n\t}\n\treturn aIBNActions;\n}\n\nasync function fnUpdateDataFieldForIBNButtonsVisibility(aIBNActions: UI5Element[], oView: View): Promise<void> {\n\tconst oParams: Record<string, { value: unknown }> = {};\n\tconst oAppComponent = CommonUtils.getAppComponent(oView);\n\tconst isSticky = ModelHelper.isStickySessionSupported((oView.getModel() as ODataModel).getMetaModel());\n\tconst fnGetLinks = function (oData?: Record<string, unknown> | undefined): void {\n\t\tif (oData) {\n\t\t\tconst aKeys = Object.keys(oData);\n\t\t\taKeys.forEach(function (sKey: string) {\n\t\t\t\tif (sKey.indexOf(\"_\") !== 0 && !sKey.includes(\"odata.context\")) {\n\t\t\t\t\toParams[sKey] = { value: oData[sKey] };\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t\tif (aIBNActions.length) {\n\t\t\taIBNActions.forEach(function (oIBNAction) {\n\t\t\t\tconst sSemanticObject = oIBNAction.data(\"IBNData\").semanticObject;\n\t\t\t\tconst sAction = oIBNAction.data(\"IBNData\").action;\n\t\t\t\toAppComponent\n\t\t\t\t\t.getShellServices()\n\t\t\t\t\t.getLinks([\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tsemanticObject: sSemanticObject,\n\t\t\t\t\t\t\taction: sAction,\n\t\t\t\t\t\t\tparams: oParams\n\t\t\t\t\t\t}\n\t\t\t\t\t])\n\t\t\t\t\t.then(function (aLink): void {\n\t\t\t\t\t\tif (oIBNAction.isA<Control>(\"sap.ui.core.Control\") || oIBNAction.isA<MenuItem>(\"sap.m.MenuItem\")) {\n\t\t\t\t\t\t\toIBNAction.setVisible(\n\t\t\t\t\t\t\t\toIBNAction.getVisible() && aLink && aLink.length === 1 && aLink[0] && aLink[0].length === 1\n\t\t\t\t\t\t\t);\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif (isSticky) {\n\t\t\t\t\t\t\t(oIBNAction.getBindingContext(\"internal\") as InternalModelContext).setProperty(\n\t\t\t\t\t\t\t\toIBNAction.getId().split(\"--\")[1],\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\tshellNavigationNotAvailable: !(aLink && aLink.length === 1 && aLink[0] && aLink[0].length === 1)\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t);\n\t\t\t\t\t\t}\n\t\t\t\t\t\treturn;\n\t\t\t\t\t})\n\t\t\t\t\t.catch(function (oError: unknown) {\n\t\t\t\t\t\tLog.error(\"Cannot retrieve the links from the shell service\", oError as string);\n\t\t\t\t\t});\n\t\t\t});\n\t\t}\n\t};\n\tif (oView && oView.getBindingContext()) {\n\t\treturn (oView.getBindingContext() as ODataV4Context)\n\t\t\t?.requestObject()\n\t\t\t.then(function (oData: Record<string, unknown> | undefined) {\n\t\t\t\treturn fnGetLinks(oData);\n\t\t\t})\n\t\t\t.catch(function (oError: unknown) {\n\t\t\t\tLog.error(\"Cannot retrieve the links from the shell service\", oError as string);\n\t\t\t});\n\t} else {\n\t\treturn fnGetLinks();\n\t}\n}\n\n/**\n * Updates the menu button visibility if all the underlying selection buttons are hidden.\n * @param IBNActions\n */\nfunction updateMenuButtonVisiblity(IBNActions: UI5Element[]): void {\n\tconst menuButtonWithIBNAction: MenuButton[] = [];\n\tIBNActions.forEach(function (IBNAction) {\n\t\tif (IBNAction.isA<MenuButton>(\"sap.m.MenuItem\")) {\n\t\t\tmenuButtonWithIBNAction.push(IBNAction.getParent()?.getParent()?.getParent()?.getParent()?.getParent() as MenuButton);\n\t\t}\n\t});\n\tmenuButtonWithIBNAction.forEach(function (menuAction) {\n\t\tconst menuItems = menuAction?.getMenu().getItems();\n\t\tconst visibleMenuItems = menuItems.filter(function (menuItem) {\n\t\t\treturn menuItem.getVisible();\n\t\t});\n\t\tif (visibleMenuItems.length === 0) {\n\t\t\tmenuAction.setVisible(false);\n\t\t}\n\t});\n}\n\nfunction getActionPath(\n\tactionContext: Context,\n\tbReturnOnlyPath: boolean,\n\tinActionName?: string,\n\tbCheckStaticValue?: boolean\n):\n\t| string\n\t| {\n\t\t\tsContextPath: string;\n\t\t\tsProperty: string;\n\t\t\tsBindingParameter: string;\n\t  } {\n\tconst sActionName: string = !inActionName ? actionContext.getObject(actionContext.getPath()).toString() : inActionName;\n\tlet sContextPath = actionContext.getPath().split(\"/@\")[0];\n\tconst sEntityTypeName = (actionContext.getObject(sContextPath) as MetaModelEntityType).$Type;\n\tconst sEntityName = getEntitySetName(actionContext.getModel() as ODataMetaModel, sEntityTypeName);\n\tif (sEntityName) {\n\t\tsContextPath = `/${sEntityName}`;\n\t}\n\tif (bCheckStaticValue) {\n\t\treturn actionContext.getObject(`${sContextPath}/${sActionName}@Org.OData.Core.V1.OperationAvailable`);\n\t}\n\tif (bReturnOnlyPath) {\n\t\treturn `${sContextPath}/${sActionName}`;\n\t} else {\n\t\treturn {\n\t\t\tsContextPath: sContextPath,\n\t\t\tsProperty: actionContext.getObject(`${sContextPath}/${sActionName}@Org.OData.Core.V1.OperationAvailable/$Path`),\n\t\t\tsBindingParameter: actionContext.getObject(`${sContextPath}/${sActionName}/@$ui5.overload/0/$Parameter/0/$Name`)\n\t\t};\n\t}\n}\n\nfunction getEntitySetName(oMetaModel: ODataMetaModel, sEntityType: string): string | undefined {\n\tconst oEntityContainer = oMetaModel.getObject(\"/\");\n\tfor (const key in oEntityContainer) {\n\t\tif (typeof oEntityContainer[key] === \"object\" && oEntityContainer[key].$Type === sEntityType) {\n\t\t\treturn key;\n\t\t}\n\t}\n}\n\nfunction computeDisplayMode(\n\toPropertyAnnotations: Record<string, unknown>,\n\toCollectionAnnotations?: Record<string, unknown>\n): \"Description\" | \"ValueDescription\" | \"Value\" | \"DescriptionValue\" {\n\tconst oTextAnnotation = oPropertyAnnotations[\"@com.sap.vocabularies.Common.v1.Text\"],\n\t\toTextArrangementAnnotation = (oTextAnnotation &&\n\t\t\t((oPropertyAnnotations &&\n\t\t\t\toPropertyAnnotations[\"@com.sap.vocabularies.Common.v1.Text@com.sap.vocabularies.UI.v1.TextArrangement\"]) ||\n\t\t\t\t(oCollectionAnnotations &&\n\t\t\t\t\toCollectionAnnotations[\"@com.sap.vocabularies.UI.v1.TextArrangement\"]))) as MetaModelEnum<TextArrangement>;\n\n\tif (oTextArrangementAnnotation) {\n\t\tif (oTextArrangementAnnotation.$EnumMember === \"com.sap.vocabularies.UI.v1.TextArrangementType/TextOnly\") {\n\t\t\treturn \"Description\";\n\t\t} else if (oTextArrangementAnnotation.$EnumMember === \"com.sap.vocabularies.UI.v1.TextArrangementType/TextLast\") {\n\t\t\treturn \"ValueDescription\";\n\t\t} else if (oTextArrangementAnnotation.$EnumMember === \"com.sap.vocabularies.UI.v1.TextArrangementType/TextSeparate\") {\n\t\t\treturn \"Value\";\n\t\t}\n\t\t//Default should be TextFirst if there is a Text annotation and neither TextOnly nor TextLast are set\n\t\treturn \"DescriptionValue\";\n\t}\n\treturn oTextAnnotation ? \"DescriptionValue\" : \"Value\";\n}\n\nfunction _getEntityType(oContext: ODataV4Context): string | undefined {\n\tconst oMetaModel = oContext.getModel().getMetaModel();\n\treturn oMetaModel.getObject(`${oMetaModel.getMetaPath(oContext.getPath())}/$Type`);\n}\n\nasync function _requestObject(sAction: string, oSelectedContext: ODataV4Context, sProperty: string): Promise<unknown> {\n\tlet oContext = oSelectedContext;\n\tconst nBracketIndex = sAction.indexOf(\"(\");\n\n\tif (nBracketIndex > -1) {\n\t\tconst sTargetType = sAction.slice(nBracketIndex + 1, -1);\n\t\tlet sCurrentType = _getEntityType(oContext);\n\n\t\twhile (sCurrentType !== sTargetType) {\n\t\t\t// Find parent binding context and retrieve entity type\n\t\t\toContext = oContext.getBinding().getContext() as ODataV4Context;\n\t\t\tif (oContext) {\n\t\t\t\tsCurrentType = _getEntityType(oContext);\n\t\t\t} else {\n\t\t\t\tLog.warning(\"Cannot determine target type to request property value for bound action invocation\");\n\t\t\t\treturn Promise.resolve(undefined);\n\t\t\t}\n\t\t}\n\t}\n\n\treturn oContext.requestObject(sProperty);\n}\n\nexport type _RequestedProperty = {\n\tvPropertyValue: unknown;\n\toSelectedContext: Context;\n\tsAction: string;\n\tsDynamicActionEnabledPath: string;\n};\nasync function requestProperty(\n\toSelectedContext: ODataV4Context,\n\tsAction: string,\n\tsProperty: string,\n\tsDynamicActionEnabledPath: string\n): Promise<_RequestedProperty> {\n\tconst oPromise =\n\t\tsProperty && sProperty.indexOf(\"/\") === 0\n\t\t\t? requestSingletonProperty(sProperty, oSelectedContext.getModel())\n\t\t\t: _requestObject(sAction, oSelectedContext, sProperty);\n\n\treturn oPromise.then(function (vPropertyValue: unknown) {\n\t\treturn {\n\t\t\tvPropertyValue: vPropertyValue,\n\t\t\toSelectedContext: oSelectedContext,\n\t\t\tsAction: sAction,\n\t\t\tsDynamicActionEnabledPath: sDynamicActionEnabledPath\n\t\t};\n\t});\n}\n\nasync function setContextsBasedOnOperationAvailable(\n\toInternalModelContext: InternalModelContext,\n\taRequestPromises: Promise<_RequestedProperty>[],\n\tforContextMenu = false\n): Promise<void> {\n\treturn Promise.all(aRequestPromises)\n\t\t.then(function (aResults): void {\n\t\t\tif (aResults.length) {\n\t\t\t\tconst aApplicableContexts: unknown[] = [],\n\t\t\t\t\taNotApplicableContexts: unknown[] = [];\n\t\t\t\taResults.forEach(function (aResult) {\n\t\t\t\t\tif (aResult) {\n\t\t\t\t\t\tif (aResult.vPropertyValue) {\n\t\t\t\t\t\t\toInternalModelContext.getModel().setProperty(aResult.sDynamicActionEnabledPath, true);\n\t\t\t\t\t\t\taApplicableContexts.push(aResult.oSelectedContext);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\taNotApplicableContexts.push(aResult.oSelectedContext);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t\tsetDynamicActionContexts(\n\t\t\t\t\toInternalModelContext,\n\t\t\t\t\taResults[0].sAction,\n\t\t\t\t\taApplicableContexts,\n\t\t\t\t\taNotApplicableContexts,\n\t\t\t\t\tforContextMenu\n\t\t\t\t);\n\t\t\t}\n\t\t\treturn;\n\t\t})\n\t\t.catch(function (oError: unknown) {\n\t\t\tLog.trace(\"Cannot retrieve property value from path\", oError as string);\n\t\t});\n}\n\n/**\n * @param internalModelContext\n * @param action\n * @param applicable\n * @param notApplicable\n * @param forContextMenu\n */\nfunction setDynamicActionContexts(\n\tinternalModelContext: InternalModelContext,\n\taction: string,\n\tapplicable: unknown[],\n\tnotApplicable: unknown[],\n\tforContextMenu = false\n): void {\n\tconst dynamicActionPathPrefix = `${internalModelContext.getPath()}/dynamicActions/${action}`,\n\t\tinternalModel = internalModelContext.getModel(),\n\t\tapplicableProperty = !forContextMenu ? \"aApplicable\" : \"aApplicableForContextMenu\",\n\t\tnotApplicableProperty = !forContextMenu ? \"aNotApplicable\" : \"aNotApplicableForContextMenu\";\n\tinternalModel.setProperty(`${dynamicActionPathPrefix}/${applicableProperty}`, applicable);\n\tinternalModel.setProperty(`${dynamicActionPathPrefix}/${notApplicableProperty}`, notApplicable);\n}\n\nfunction getSpecificAllowedExpression(aExpressions: string[]): string {\n\tconst aAllowedExpressionsPriority = CommonUtils.AllowedExpressionsPrio;\n\n\taExpressions.sort(function (a: string, b: string) {\n\t\treturn aAllowedExpressionsPriority.indexOf(a) - aAllowedExpressionsPriority.indexOf(b);\n\t});\n\n\treturn aExpressions[0];\n}\n\n/**\n * Method to return allowed operators for type Guid.\n * @returns Allowed operators for type Guid\n */\nfunction getOperatorsForGuidProperty(): string {\n\tconst allowedOperatorsForGuid = [\"EQ\", \"NE\"];\n\treturn allowedOperatorsForGuid.toString();\n}\n\ntype ParameterInfo = {\n\tcontextPath?: string;\n\tparameterProperties?: Record<string, MetaModelProperty>;\n};\nfunction getParameterInfo(metaModelContext: ODataMetaModel, sContextPath: string): ParameterInfo {\n\tconst sParameterContextPath = sContextPath.substring(0, sContextPath.lastIndexOf(\"/\"));\n\tconst bResultContext = metaModelContext.getObject(`${sParameterContextPath}/@com.sap.vocabularies.Common.v1.ResultContext`);\n\tconst oParameterInfo: ParameterInfo = {};\n\tif (bResultContext && sParameterContextPath !== sContextPath) {\n\t\toParameterInfo.contextPath = sParameterContextPath;\n\t\toParameterInfo.parameterProperties = CommonUtils.getContextPathProperties(metaModelContext, sParameterContextPath) as Record<\n\t\t\tstring,\n\t\t\tMetaModelProperty\n\t\t>;\n\t}\n\treturn oParameterInfo;\n}\n\ntype ViewData = {\n\tcontrolConfiguration?: Record<string, Record<string, unknown>>;\n};\n\nfunction addPageContextToSelectionVariant(oSelectionVariant: SelectionVariant, mPageContext: unknown[], oView: View): SelectionVariant {\n\tconst oAppComponent = CommonUtils.getAppComponent(oView);\n\tconst oNavigationService = oAppComponent.getNavigationService();\n\treturn oNavigationService.mixAttributesAndSelectionVariant(mPageContext, oSelectionVariant.toJSONString());\n}\n\nfunction isStickyEditMode(oControl: Control): boolean {\n\tconst bIsStickyMode = ModelHelper.isStickySessionSupported((oControl.getModel() as ODataModel).getMetaModel());\n\tconst bUIEditable = CommonUtils.getIsEditable(oControl);\n\treturn bIsStickyMode && bUIEditable;\n}\n\nexport type UserDefaultParameter = EdmActionParameter | Context;\n\n/**\n * Retrieves the user defaults from the startup app state (if available) or the startup parameter and sets them to a model.\n * @param appComponent\n * @param parameters\n * @param model\n * @param isAction\n * @param isCreate\n * @param actionDefaultValues\n */\nasync function setUserDefaults(\n\tappComponent: AppComponent,\n\tparameters: UserDefaultParameter[],\n\tmodel: JSONModel | ODataV4Context,\n\tisAction: boolean,\n\tisCreate?: boolean,\n\tactionDefaultValues?: Record<string, unknown>\n): Promise<void> {\n\tconst BaseType = (await import(\"sap/ui/mdc/enums/BaseType\")).default;\n\tconst TypeMap = (await import(\"sap/ui/mdc/odata/v4/TypeMap\")).default;\n\n\tconst componentData = appComponent.getComponentData(),\n\t\tstartupParameters = (componentData && componentData.startupParameters) || {},\n\t\tshellServices = appComponent.getShellServices();\n\tconst startupAppState = await shellServices.getStartupAppState(appComponent);\n\tconst startupAppStateData = startupAppState?.getData() || {},\n\t\textendedParameters = (startupAppStateData.selectionVariant && startupAppStateData.selectionVariant.SelectOptions) || [];\n\tparameters.forEach(function (oParameter) {\n\t\tconst sPropertyName = isAction\n\t\t\t? `/${(oParameter as { name: string }).name}`\n\t\t\t: (oParameter as Context).getPath?.().slice((oParameter as Context).getPath().lastIndexOf(\"/\") + 1);\n\t\tconst sParameterName = isAction ? sPropertyName.slice(1) : sPropertyName;\n\t\tif (actionDefaultValues && isCreate) {\n\t\t\tif (actionDefaultValues[sParameterName]) {\n\t\t\t\tmodel.setProperty(sPropertyName, actionDefaultValues[sParameterName]);\n\t\t\t}\n\t\t} else if (startupParameters[sParameterName]) {\n\t\t\tconst parametertType = (\n\t\t\t\toParameter as {\n\t\t\t\t\tname: string;\n\t\t\t\t\ttype?: string;\n\t\t\t\t}\n\t\t\t).type\n\t\t\t\t? TypeMap.getBaseType(\n\t\t\t\t\t\t(\n\t\t\t\t\t\t\toParameter as {\n\t\t\t\t\t\t\t\tname: string;\n\t\t\t\t\t\t\t\ttype: string;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t).type\n\t\t\t\t  )\n\t\t\t\t: BaseType.String;\n\t\t\tconst typeInstance = TypeMap.getDataTypeInstance(parametertType);\n\t\t\tmodel.setProperty(sPropertyName, typeInstance.parseValue(startupParameters[sParameterName][0], \"string\"));\n\t\t} else if (extendedParameters.length > 0) {\n\t\t\tfor (const oExtendedParameter of extendedParameters) {\n\t\t\t\tif (oExtendedParameter.PropertyName === sParameterName) {\n\t\t\t\t\tconst oRange = oExtendedParameter.Ranges.length\n\t\t\t\t\t\t? oExtendedParameter.Ranges[oExtendedParameter.Ranges.length - 1]\n\t\t\t\t\t\t: undefined;\n\t\t\t\t\tif (oRange && oRange.Sign === \"I\" && oRange.Option === \"EQ\") {\n\t\t\t\t\t\tmodel.setProperty(sPropertyName, oRange.Low); // high is ignored when Option=EQ\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t});\n}\n\nexport type InboundParameter = {\n\tuseForCreate: boolean;\n};\nfunction getAdditionalParamsForCreate(\n\toStartupParameters: Record<string, unknown[]>,\n\toInboundParameters?: Record<string, InboundParameter>\n): unknown {\n\tconst oInbounds = oInboundParameters,\n\t\taCreateParameters =\n\t\t\toInbounds !== undefined\n\t\t\t\t? Object.keys(oInbounds).filter(function (sParameter: string) {\n\t\t\t\t\t\treturn oInbounds[sParameter].useForCreate;\n\t\t\t\t  })\n\t\t\t\t: [];\n\tlet oRet;\n\tfor (const element of aCreateParameters) {\n\t\tconst sCreateParameter = element;\n\t\tconst aValues = oStartupParameters && oStartupParameters[sCreateParameter];\n\t\tif (aValues && aValues.length === 1) {\n\t\t\toRet = oRet || Object.create(null);\n\t\t\toRet[sCreateParameter] = aValues[0];\n\t\t}\n\t}\n\treturn oRet;\n}\ntype OutboundParameter = {\n\tparameters: Record<string, OutboundParameterValue>;\n\tsemanticObject?: string;\n\taction?: string;\n};\ntype OutboundParameterValue = {\n\tvalue?: {\n\t\tvalue?: string;\n\t\tformat?: string;\n\t};\n};\nfunction getSemanticObjectMapping(oOutbound: OutboundParameter): MetaModelType<SemanticObjectMappingTypeTypes>[] {\n\tconst aSemanticObjectMapping: MetaModelType<SemanticObjectMappingTypeTypes>[] = [];\n\t// eslint-disable-next-line @typescript-eslint/strict-boolean-expressions\n\tif (oOutbound.parameters) {\n\t\tconst aParameters = Object.keys(oOutbound.parameters) || [];\n\t\tif (aParameters.length > 0) {\n\t\t\taParameters.forEach(function (sParam: string) {\n\t\t\t\tconst oMapping = oOutbound.parameters[sParam];\n\t\t\t\tif (oMapping.value && oMapping.value.value && oMapping.value.format === \"binding\") {\n\t\t\t\t\t// using the format of UI.Mapping\n\t\t\t\t\tconst oSemanticMapping = {\n\t\t\t\t\t\tLocalProperty: {\n\t\t\t\t\t\t\t$PropertyPath: oMapping.value.value\n\t\t\t\t\t\t},\n\t\t\t\t\t\tSemanticObjectProperty: sParam\n\t\t\t\t\t};\n\n\t\t\t\t\tif (aSemanticObjectMapping.length > 0) {\n\t\t\t\t\t\t// To check if the semanticObject Mapping is done for the same local property more that once then first one will be considered\n\t\t\t\t\t\tfor (const element of aSemanticObjectMapping) {\n\t\t\t\t\t\t\tif (element.LocalProperty?.$PropertyPath !== oSemanticMapping.LocalProperty.$PropertyPath) {\n\t\t\t\t\t\t\t\taSemanticObjectMapping.push(oSemanticMapping);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t} else {\n\t\t\t\t\t\taSemanticObjectMapping.push(oSemanticMapping);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t}\n\treturn aSemanticObjectMapping;\n}\n\nfunction getHeaderFacetItemConfigForExternalNavigation(\n\toViewData: ViewData,\n\toCrossNav: Record<string, OutboundParameter>\n): Record<\n\tstring,\n\t{\n\t\tsemanticObject: string;\n\t\taction: string;\n\t\tsemanticObjectMapping: MetaModelType<SemanticObjectMappingTypeTypes>[];\n\t}\n> {\n\tconst oHeaderFacetItems: Record<\n\t\tstring,\n\t\t{\n\t\t\tsemanticObject: string;\n\t\t\taction: string;\n\t\t\tsemanticObjectMapping: MetaModelType<SemanticObjectMappingTypeTypes>[];\n\t\t}\n\t> = {};\n\tlet sId;\n\tconst oControlConfig = oViewData.controlConfiguration as Record<\n\t\tstring,\n\t\t{\n\t\t\tnavigation?: {\n\t\t\t\ttargetOutbound?: {\n\t\t\t\t\toutbound: string;\n\t\t\t\t};\n\t\t\t};\n\t\t}\n\t>;\n\tfor (const config in oControlConfig) {\n\t\tif (config.includes(\"@com.sap.vocabularies.UI.v1.DataPoint\") || config.includes(\"@com.sap.vocabularies.UI.v1.Chart\")) {\n\t\t\tconst sOutbound = oControlConfig[config].navigation?.targetOutbound?.outbound;\n\t\t\tif (sOutbound !== undefined) {\n\t\t\t\tconst oOutbound = oCrossNav[sOutbound];\n\t\t\t\tif (oOutbound.semanticObject && oOutbound.action) {\n\t\t\t\t\tif (config.includes(\"Chart\")) {\n\t\t\t\t\t\tsId = generate([\"fe\", \"MicroChartLink\", config]);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tsId = generate([\"fe\", \"HeaderDPLink\", config]);\n\t\t\t\t\t}\n\t\t\t\t\tconst aSemanticObjectMapping = CommonUtils.getSemanticObjectMapping(oOutbound);\n\t\t\t\t\toHeaderFacetItems[sId] = {\n\t\t\t\t\t\tsemanticObject: oOutbound.semanticObject,\n\t\t\t\t\t\taction: oOutbound.action,\n\t\t\t\t\t\tsemanticObjectMapping: aSemanticObjectMapping\n\t\t\t\t\t};\n\t\t\t\t} else {\n\t\t\t\t\tLog.error(`Cross navigation outbound is configured without semantic object and action for ${sOutbound}`);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\treturn oHeaderFacetItems;\n}\n\nfunction setSemanticObjectMappings(oSelectionVariant: SelectionVariant, vMappings: unknown): SelectionVariant {\n\tconst oMappings = typeof vMappings === \"string\" ? JSON.parse(vMappings) : vMappings;\n\tfor (const element of oMappings) {\n\t\tconst sLocalProperty =\n\t\t\t(element[\"LocalProperty\"] && element[\"LocalProperty\"][\"$PropertyPath\"]) ||\n\t\t\t(element[\"@com.sap.vocabularies.Common.v1.LocalProperty\"] && element[\"@com.sap.vocabularies.Common.v1.LocalProperty\"][\"$Path\"]);\n\t\tconst sSemanticObjectProperty =\n\t\t\telement[\"SemanticObjectProperty\"] || element[\"@com.sap.vocabularies.Common.v1.SemanticObjectProperty\"];\n\t\tconst oSelectOption = oSelectionVariant.getSelectOption(sLocalProperty);\n\t\tif (oSelectOption) {\n\t\t\t//Create a new SelectOption with sSemanticObjectProperty as the property Name and remove the older one\n\t\t\toSelectionVariant.removeSelectOption(sLocalProperty);\n\t\t\toSelectionVariant.massAddSelectOption(sSemanticObjectProperty, oSelectOption);\n\t\t}\n\t}\n\treturn oSelectionVariant;\n}\n\ntype SemanticObjectFromPath = {\n\tsemanticObjectPath: string;\n\tsemanticObjectForGetLinks: { semanticObject: string }[];\n\tsemanticObject: {\n\t\tsemanticObject: { $Path: string };\n\t};\n\tunavailableActions: string[];\n};\nasync function fnGetSemanticObjectsFromPath(\n\toMetaModel: ODataMetaModel,\n\tsPath: string,\n\tsQualifier: string\n): Promise<SemanticObjectFromPath> {\n\treturn new Promise<SemanticObjectFromPath>(function (resolve) {\n\t\tlet sSemanticObject, aSemanticObjectUnavailableActions;\n\t\tif (sQualifier === \"\") {\n\t\t\tsSemanticObject = oMetaModel.getObject(`${sPath}@${CommonAnnotationTerms.SemanticObject}`);\n\t\t\taSemanticObjectUnavailableActions = oMetaModel.getObject(`${sPath}@${CommonAnnotationTerms.SemanticObjectUnavailableActions}`);\n\t\t} else {\n\t\t\tsSemanticObject = oMetaModel.getObject(`${sPath}@${CommonAnnotationTerms.SemanticObject}#${sQualifier}`);\n\t\t\taSemanticObjectUnavailableActions = oMetaModel.getObject(\n\t\t\t\t`${sPath}@${CommonAnnotationTerms.SemanticObjectUnavailableActions}#${sQualifier}`\n\t\t\t);\n\t\t}\n\n\t\tconst aSemanticObjectForGetLinks = [{ semanticObject: sSemanticObject }];\n\t\tconst oSemanticObject = {\n\t\t\tsemanticObject: sSemanticObject\n\t\t};\n\t\tresolve({\n\t\t\tsemanticObjectPath: sPath,\n\t\t\tsemanticObjectForGetLinks: aSemanticObjectForGetLinks,\n\t\t\tsemanticObject: oSemanticObject,\n\t\t\tunavailableActions: aSemanticObjectUnavailableActions\n\t\t});\n\t});\n}\n\nasync function fnGetSemanticObjectPromise(oMetaModel: ODataMetaModel, sPath: string, sQualifier: string): Promise<SemanticObjectFromPath> {\n\treturn CommonUtils.getSemanticObjectsFromPath(oMetaModel, sPath, sQualifier);\n}\n\nfunction getFilterAllowedExpression(oFilterRestrictionsAnnotation?: MetaModelType<FilterRestrictionsType>): _FilterAllowedExpressions {\n\tconst mAllowedExpressions: _FilterAllowedExpressions = {};\n\tif (oFilterRestrictionsAnnotation && oFilterRestrictionsAnnotation.FilterExpressionRestrictions !== undefined) {\n\t\toFilterRestrictionsAnnotation.FilterExpressionRestrictions.forEach(function (oProperty) {\n\t\t\tif (oProperty.Property && oProperty.AllowedExpressions !== undefined) {\n\t\t\t\t//SingleValue | MultiValue | SingleRange | MultiRange | SearchExpression | MultiRangeOrSearchExpression\n\t\t\t\tif (mAllowedExpressions[oProperty.Property.$PropertyPath] !== undefined) {\n\t\t\t\t\tmAllowedExpressions[oProperty.Property.$PropertyPath].push(oProperty.AllowedExpressions);\n\t\t\t\t} else {\n\t\t\t\t\tmAllowedExpressions[oProperty.Property.$PropertyPath] = [oProperty.AllowedExpressions];\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t}\n\treturn mAllowedExpressions;\n}\nfunction getFilterRestrictions(\n\toFilterRestrictionsAnnotation?: MetaModelType<FilterRestrictionsType>,\n\tsRestriction?: \"RequiredProperties\" | \"NonFilterableProperties\"\n): string[] {\n\tlet aProps: string[] = [];\n\tif (oFilterRestrictionsAnnotation && oFilterRestrictionsAnnotation[sRestriction as keyof MetaModelType<FilterRestrictionsType>]) {\n\t\taProps = (\n\t\t\toFilterRestrictionsAnnotation[sRestriction as keyof MetaModelType<FilterRestrictionsType>] as ExpandPathType<Edm.PropertyPath>[]\n\t\t).map(function (oProperty: ExpandPathType<Edm.PropertyPath>) {\n\t\t\treturn oProperty.$PropertyPath;\n\t\t});\n\t}\n\treturn aProps;\n}\n\nfunction _fetchPropertiesForNavPath(paths: string[], navPath: string, props: string[]): string[] {\n\tconst navPathPrefix = navPath + \"/\";\n\treturn paths.reduce((outPaths: string[], pathToCheck: string) => {\n\t\tif (pathToCheck.startsWith(navPathPrefix)) {\n\t\t\tconst outPath = pathToCheck.replace(navPathPrefix, \"\");\n\t\t\tif (!outPaths.includes(outPath)) {\n\t\t\t\toutPaths.push(outPath);\n\t\t\t}\n\t\t}\n\t\treturn outPaths;\n\t}, props);\n}\ntype _FilterAllowedExpressions = Record<string, string[]>;\nexport type _FilterRestrictions = {\n\tRequiredProperties: string[];\n\tNonFilterableProperties: string[];\n\tFilterAllowedExpressions: _FilterAllowedExpressions;\n};\nfunction getFilterRestrictionsByPath(entityPath: string, oContext: ODataMetaModel): _FilterRestrictions {\n\t// NOTE: For getting FilterAllowedExpressions please use 'getAllowedFilterExpressionForProperty' from 'sap/fe/core/converters/controls/ListReport/FilterField.ts'.\n\tconst oRet: _FilterRestrictions = {\n\t\tRequiredProperties: [],\n\t\tNonFilterableProperties: [],\n\t\tFilterAllowedExpressions: {}\n\t};\n\tlet oFilterRestrictions;\n\tconst navigationText = \"$NavigationPropertyBinding\";\n\tconst frTerm = \"@Org.OData.Capabilities.V1.FilterRestrictions\";\n\tconst entityTypePathParts = entityPath.replaceAll(\"%2F\", \"/\").split(\"/\").filter(ModelHelper.filterOutNavPropBinding);\n\tconst entityTypePath = `/${entityTypePathParts.join(\"/\")}/`;\n\tconst entitySetPath = ModelHelper.getEntitySetPath(entityPath, oContext);\n\tconst entitySetPathParts = entitySetPath.split(\"/\").filter(ModelHelper.filterOutNavPropBinding);\n\tconst isContainment = oContext.getObject(`${entityTypePath}$ContainsTarget`);\n\tconst containmentNavPath = !!isContainment && entityTypePathParts[entityTypePathParts.length - 1];\n\n\t//LEAST PRIORITY - Filter restrictions directly at Entity Set\n\t//e.g. FR in \"NS.EntityContainer/SalesOrderManage\" ContextPath: /SalesOrderManage\n\tif (!isContainment) {\n\t\toFilterRestrictions = oContext.getObject(`${entitySetPath}${frTerm}`) as MetaModelType<FilterRestrictionsType> | undefined;\n\t\toRet.RequiredProperties = getFilterRestrictions(oFilterRestrictions, \"RequiredProperties\") || [];\n\t\tconst resultContextCheck = oContext.getObject(`${entityTypePath}@com.sap.vocabularies.Common.v1.ResultContext`);\n\t\tif (!resultContextCheck) {\n\t\t\toRet.NonFilterableProperties = getFilterRestrictions(oFilterRestrictions, \"NonFilterableProperties\") || [];\n\t\t}\n\t\t//SingleValue | MultiValue | SingleRange | MultiRange | SearchExpression | MultiRangeOrSearchExpression\n\t\toRet.FilterAllowedExpressions = getFilterAllowedExpression(oFilterRestrictions) || {};\n\t}\n\n\tif (entityTypePathParts.length > 1) {\n\t\tconst navPath = isContainment ? (containmentNavPath as string) : entitySetPathParts[entitySetPathParts.length - 1];\n\t\t// In case of containment we take entitySet provided as parent. And in case of normal we would remove the last navigation from entitySetPath.\n\t\tconst parentEntitySetPath = isContainment ? entitySetPath : `/${entitySetPathParts.slice(0, -1).join(`/${navigationText}/`)}`;\n\t\t//THIRD HIGHEST PRIORITY - Reading property path restrictions - Annotation at main entity but directly on navigation property path\n\t\t//e.g. Parent Customer with PropertyPath=\"Set/CityName\" ContextPath: Customer/Set\n\t\tconst oParentRet: _FilterRestrictions = {\n\t\t\tRequiredProperties: [],\n\t\t\tNonFilterableProperties: [],\n\t\t\tFilterAllowedExpressions: {}\n\t\t};\n\t\tif (!navPath.includes(\"%2F\")) {\n\t\t\tconst oParentFR = oContext.getObject(`${parentEntitySetPath}${frTerm}`) as MetaModelType<FilterRestrictionsType> | undefined;\n\t\t\toRet.RequiredProperties = _fetchPropertiesForNavPath(\n\t\t\t\tgetFilterRestrictions(oParentFR, \"RequiredProperties\") || [],\n\t\t\t\tnavPath,\n\t\t\t\toRet.RequiredProperties || []\n\t\t\t);\n\t\t\toRet.NonFilterableProperties = _fetchPropertiesForNavPath(\n\t\t\t\tgetFilterRestrictions(oParentFR, \"NonFilterableProperties\") || [],\n\t\t\t\tnavPath,\n\t\t\t\toRet.NonFilterableProperties || []\n\t\t\t);\n\t\t\t//SingleValue | MultiValue | SingleRange | MultiRange | SearchExpression | MultiRangeOrSearchExpression\n\t\t\tconst completeAllowedExps = getFilterAllowedExpression(oParentFR) || {};\n\t\t\toParentRet.FilterAllowedExpressions = Object.keys(completeAllowedExps).reduce(\n\t\t\t\t(outProp: Record<string, string[]>, propPath: string) => {\n\t\t\t\t\tif (propPath.startsWith(navPath + \"/\")) {\n\t\t\t\t\t\tconst outPropPath = propPath.replace(navPath + \"/\", \"\");\n\t\t\t\t\t\toutProp[outPropPath] = completeAllowedExps[propPath];\n\t\t\t\t\t}\n\t\t\t\t\treturn outProp;\n\t\t\t\t},\n\t\t\t\t{} as Record<string, string[]>\n\t\t\t);\n\t\t}\n\n\t\t//SingleValue | MultiValue | SingleRange | MultiRange | SearchExpression | MultiRangeOrSearchExpression\n\t\toRet.FilterAllowedExpressions = mergeObjects(\n\t\t\t{},\n\t\t\toRet.FilterAllowedExpressions || {},\n\t\t\toParentRet.FilterAllowedExpressions || {}\n\t\t) as Record<string, string[]>;\n\n\t\t//SECOND HIGHEST priority - Navigation restrictions\n\t\t//e.g. Parent \"/Customer\" with NavigationPropertyPath=\"Set\" ContextPath: Customer/Set\n\t\tconst oNavRestrictions = MetaModelFunction.getNavigationRestrictions(oContext, parentEntitySetPath, navPath.replaceAll(\"%2F\", \"/\"));\n\t\tconst oNavFilterRest = oNavRestrictions && (oNavRestrictions[\"FilterRestrictions\"] as MetaModelType<FilterRestrictionsType>);\n\t\tconst navResReqProps = getFilterRestrictions(oNavFilterRest, \"RequiredProperties\") || [];\n\t\toRet.RequiredProperties = uniqueSort(oRet.RequiredProperties.concat(navResReqProps));\n\t\tconst navNonFilterProps = getFilterRestrictions(oNavFilterRest, \"NonFilterableProperties\") || [];\n\t\toRet.NonFilterableProperties = uniqueSort(oRet.NonFilterableProperties.concat(navNonFilterProps));\n\t\t//SingleValue | MultiValue | SingleRange | MultiRange | SearchExpression | MultiRangeOrSearchExpression\n\t\toRet.FilterAllowedExpressions = mergeObjects(\n\t\t\t{},\n\t\t\toRet.FilterAllowedExpressions || {},\n\t\t\tgetFilterAllowedExpression(oNavFilterRest) || {}\n\t\t) as Record<string, string[]>;\n\n\t\t//HIGHEST priority - Restrictions having target with navigation association entity\n\t\t// e.g. FR in \"CustomerParameters/Set\" ContextPath: \"Customer/Set\"\n\t\tconst navAssociationEntityRest = oContext.getObject(\n\t\t\t`/${entityTypePathParts.join(\"/\")}${frTerm}`\n\t\t) as MetaModelType<FilterRestrictionsType>;\n\t\tconst navAssocReqProps = getFilterRestrictions(navAssociationEntityRest, \"RequiredProperties\") || [];\n\t\toRet.RequiredProperties = uniqueSort(oRet.RequiredProperties.concat(navAssocReqProps));\n\t\tconst navAssocNonFilterProps = getFilterRestrictions(navAssociationEntityRest, \"NonFilterableProperties\") || [];\n\t\toRet.NonFilterableProperties = uniqueSort(oRet.NonFilterableProperties.concat(navAssocNonFilterProps));\n\t\t//SingleValue | MultiValue | SingleRange | MultiRange | SearchExpression | MultiRangeOrSearchExpression\n\t\toRet.FilterAllowedExpressions = mergeObjects(\n\t\t\t{},\n\t\t\toRet.FilterAllowedExpressions,\n\t\t\tgetFilterAllowedExpression(navAssociationEntityRest) || {}\n\t\t) as _FilterAllowedExpressions;\n\t}\n\treturn oRet;\n}\n\nexport type PreprocessorSettings = {\n\tappComponent?: AppComponent;\n\tbindingContexts: object;\n\tmodels: object;\n};\nexport type BaseTreeModifier = {\n\ttemplateControlFragment(\n\t\tsFragmentName: string,\n\t\tmPreprocessorSettings: PreprocessorSettings,\n\t\toView?: View\n\t): Promise<UI5Element[] | Element[]>;\n\ttargets: string;\n\tgetId(vControl: UI5Element | Element): string;\n\tgetControlType(oControl: UI5Element | Element): string;\n\tgetProperty<T>(oControl: UI5Element | Element, sPropertyName: string): Promise<T>;\n\tgetAggregation(parent: UI5Element | Element, name: string): Promise<UI5Element[] | Element[]>;\n\tinsertAggregation(\n\t\tparent: UI5Element | Element,\n\t\tname: string,\n\t\tcontrol: UI5Element | Element | UI5Element[] | Element[],\n\t\tindex?: number,\n\t\tview?: Element,\n\t\tskipAdjustIndex?: boolean\n\t): Promise<void>;\n\tsetProperty(oControl: UI5Element | Element, sPropertyName: string, vValue: unknown): void;\n\tbySelector(oSelector: object, oAppComponent?: Component, oView?: Element): ManagedObject | Element;\n};\n\nasync function templateControlFragment(\n\tsFragmentName: string | Element | null,\n\toPreprocessorSettings: PreprocessorSettings,\n\toInOptions?: {\n\t\tview?: View;\n\t\tisXML?: boolean;\n\t\tid?: string;\n\t\tcontroller?: PageController | ExtensionAPI;\n\t\tcontainingView?: View;\n\t\tcontextPath?: string;\n\t},\n\toModifier?: BaseTreeModifier\n): Promise<Element | UI5Element | Element[] | UI5Element[]> {\n\tconst oOptions = oInOptions || {};\n\tif (oModifier && typeof sFragmentName === \"string\") {\n\t\treturn oModifier.templateControlFragment(sFragmentName, oPreprocessorSettings, oOptions.view).then(function (oFragment) {\n\t\t\t// This is required as Flex returns an HTMLCollection as templating result in XML time.\n\t\t\treturn oModifier.targets === \"xmlTree\" && oFragment.length > 0 ? oFragment[0] : oFragment;\n\t\t});\n\t} else {\n\t\tconst fragmentData =\n\t\t\ttypeof sFragmentName === \"string\" ? XMLTemplateProcessor.loadTemplate(sFragmentName, \"fragment\") : sFragmentName;\n\t\tconst oFragment = await XMLPreprocessor.process(fragmentData, { name: sFragmentName }, oPreprocessorSettings);\n\t\tconst oControl = oFragment.firstElementChild;\n\t\tif (!!oOptions.isXML && oControl) {\n\t\t\treturn oControl;\n\t\t}\n\t\tlet owner: { runAsOwner: <T>(fn: () => T) => T } = oPreprocessorSettings.appComponent ?? { runAsOwner: (fn) => fn() };\n\t\tif (oOptions.containingView) {\n\t\t\tconst viewOwner = Component.getOwnerComponentFor(oOptions.containingView);\n\t\t\tif (viewOwner) {\n\t\t\t\towner = viewOwner;\n\t\t\t}\n\t\t}\n\t\tlet containingView: View | undefined;\n\t\tif (oOptions.view && !oOptions.controller) {\n\t\t\t// this is overall stupid, in case we are coming from the delegate with an xml node instead of a fragment we need to pass the containingView in there (done by the oModifier call for instance)\n\t\t\t// But in other runtime case where we are here we need to maintain the controller and thus cannot have a containingView...\n\t\t\tcontainingView = oOptions.view;\n\t\t}\n\t\treturn owner.runAsOwner(async () => {\n\t\t\treturn Fragment.load({\n\t\t\t\tid: oOptions.id,\n\t\t\t\ttype: \"SCOPEDFEFRAGMENT\",\n\t\t\t\tcontextPath: oOptions.contextPath,\n\t\t\t\tdefinition: oFragment as unknown as string,\n\t\t\t\tcontroller: oOptions.controller,\n\t\t\t\tcontainingView: containingView\n\t\t\t});\n\t\t});\n\t}\n}\n\nfunction getSingletonPath(path: string, metaModel: ODataMetaModel): string | undefined {\n\tconst parts = path.split(\"/\").filter(Boolean),\n\t\tpropertyName = parts.pop()!,\n\t\tnavigationPath = parts.join(\"/\"),\n\t\tentitySet = navigationPath && metaModel.getObject(`/${navigationPath}`);\n\tif (entitySet?.$kind === \"Singleton\") {\n\t\tconst singletonName = parts[parts.length - 1];\n\t\treturn `/${singletonName}/${propertyName}`;\n\t}\n\treturn undefined;\n}\n\nasync function requestSingletonProperty(path: string, model: ODataModel): Promise<unknown> {\n\tif (!path || !model) {\n\t\treturn Promise.resolve(null);\n\t}\n\tconst metaModel = model.getMetaModel();\n\t// Find the underlying entity set from the property path and check whether it is a singleton.\n\tconst resolvedPath = getSingletonPath(path, metaModel);\n\tif (resolvedPath) {\n\t\tconst propertyBinding = model.bindProperty(resolvedPath);\n\t\treturn propertyBinding.requestValue();\n\t}\n\n\treturn Promise.resolve(null);\n}\n\n// Get the path for action parameters that is needed to read the annotations\nfunction getParameterPath(sPath: string, sParameter: string): string {\n\tlet sContext;\n\tif (sPath.includes(\"@$ui5.overload\")) {\n\t\tsContext = sPath.split(\"@$ui5.overload\")[0];\n\t} else {\n\t\t// For Unbound Actions in Action Parameter Dialogs\n\t\tconst aAction = sPath.split(\"/0\")[0].split(\".\");\n\t\tsContext = `/${aAction[aAction.length - 1]}/`;\n\t}\n\treturn sContext + sParameter;\n}\n\n/**\n * Get resolved expression binding used for texts at runtime.\n * @param expBinding\n * @param control\n * @returns A string after resolution.\n */\nfunction _fntranslatedTextFromExpBindingString(expBinding: string, control: Control): string {\n\t// The idea here is to create dummy element with the expresion binding.\n\t// Adding it as dependent to the view/control would propagate all the models to the dummy element and resolve the binding.\n\t// We remove the dummy element after that and destroy it.\n\n\tconst anyResourceText = new AnyElement({ anyText: expBinding });\n\tcontrol.addDependent(anyResourceText);\n\tconst resultText = anyResourceText.getAnyText();\n\tcontrol.removeDependent(anyResourceText);\n\tanyResourceText.destroy();\n\n\treturn resultText;\n}\n/**\n * Check if the current device has a small screen.\n * @returns A Boolean.\n */\nfunction isSmallDevice(): boolean {\n\treturn !Device.system.desktop || Device.resize.width <= 320;\n}\n\n/**\n * Parses a SelectionVariant or SelectionPresentationVariant annotation and creates the corresponding filters.\n * @param control MDC Chart, MDC Table or MultiView control on which the filters are applied\n * @param annotationPath SelectionVariant or SelectionPresentationVariant annotation\n * @returns Returns an array of filters.\n */\nfunction getFiltersFromAnnotation(control: Control | MDCChart | MDCTable, annotationPath: string): Filter[] {\n\tconst metaModel = CommonUtils.getAppComponent(control as Control).getMetaModel();\n\tconst svContext = metaModel.getMetaContext(`${control.data(\"entityType\")}${annotationPath}`);\n\tconst propertyFilters: Record<string, Filter[]> = {};\n\tlet annotation = MetaModelConverter.getInvolvedDataModelObjects(svContext).targetObject;\n\n\tif (isAnnotationOfType<SelectionPresentationVariant>(annotation, UIAnnotationTypes.SelectionPresentationVariantType)) {\n\t\tannotation = annotation.SelectionVariant;\n\t}\n\n\tif (!annotation || !isAnnotationOfType<SelectionVariantType>(annotation, UIAnnotationTypes.SelectionVariantType)) {\n\t\treturn [];\n\t}\n\n\t(annotation.SelectOptions || []).forEach((selectOption) => {\n\t\tif (selectOption.PropertyName?.$target && selectOption.Ranges?.length > 0) {\n\t\t\tconst propertyType = selectOption.PropertyName.$target.type;\n\t\t\tconst propertyPath = selectOption.PropertyName.value;\n\t\t\tfor (const j in selectOption.Ranges) {\n\t\t\t\tconst range = getRangeDefinition(selectOption.Ranges[j], propertyType);\n\t\t\t\tpropertyFilters[propertyPath] = (propertyFilters[propertyPath] ?? []).concat(\n\t\t\t\t\tnew Filter(propertyPath, range.operator as FilterOperator, range.rangeLow, range.rangeHigh)\n\t\t\t\t);\n\t\t\t}\n\t\t}\n\t});\n\n\tconst filters = [];\n\tfor (const path in propertyFilters) {\n\t\tfilters.push(\n\t\t\tnew Filter({\n\t\t\t\tfilters: propertyFilters[path],\n\t\t\t\tand: false\n\t\t\t})\n\t\t);\n\t}\n\treturn filters;\n}\n\nfunction getConverterContextForPath(\n\tsMetaPath: string,\n\toMetaModel: ODataMetaModel,\n\tsEntitySet: string,\n\toDiagnostics: Diagnostics\n): ConverterContext<PageContextPathTarget> {\n\tconst oContext = oMetaModel.createBindingContext(sMetaPath) as ODataV4Context;\n\treturn ConverterContext?.createConverterContextForMacro(sEntitySet, oContext || oMetaModel, oDiagnostics, mergeObjects);\n}\n\n/**\n * Gets the context of the DraftRoot path.\n * If a view has been created with the draft Root Path, this method returns its bindingContext.\n * Where no view is found a new created context is returned.\n * The new created context request the key of the entity in order to get the Etag of this entity.\n * @param programmingModel\n * @param view\n * @param appComponent\n * @param bindingParameters\n * @returns Returns a Promise\n */\nasync function createRootContext(\n\tprogrammingModel: string,\n\tview: View,\n\tappComponent: AppComponent,\n\tbindingParameters?: BindContextParameters\n): Promise<Context | undefined> {\n\tconst result = findOrCreateRootContext(\n\t\tview.getBindingContext() as ODataV4Context,\n\t\tprogrammingModel,\n\t\tview,\n\t\tappComponent,\n\t\tbindingParameters,\n\t\ttrue\n\t);\n\tif (result.isNew && result.rootContext !== undefined) {\n\t\tawait CommonUtils.waitForContextRequested(result.rootContext);\n\t}\n\n\treturn result.rootContext;\n}\n\n/**\n * Sync function to find or create a root context for a given context.\n * @param context\n * @param programmingModel\n * @param view\n * @param appComponent\n * @param bindingParameters\n * @param useCache\n * @returns The context and a boolean to specify if a new context was created\n */\nfunction findOrCreateRootContext(\n\tcontext: ODataV4Context | undefined | null,\n\tprogrammingModel: string,\n\tview: View,\n\tappComponent: AppComponent,\n\tbindingParameters?: BindContextParameters,\n\tuseCache = false\n): { rootContext: ODataV4Context | undefined; isNew: boolean } {\n\tif (context) {\n\t\tconst rootContextPath =\n\t\t\tprogrammingModel === \"Draft\" ? ModelHelper.getDraftRootPath(context) : ModelHelper.getStickyRootPath(context);\n\t\tlet simpleRootContext: ODataV4Context;\n\t\tif (rootContextPath) {\n\t\t\tif (context.getPath() === rootContextPath) {\n\t\t\t\treturn { rootContext: context, isNew: false };\n\t\t\t}\n\t\t\t// Check if a view matches with the draft root path, and had already loaded its context\n\t\t\tconst existingBindingContextOnPage = appComponent\n\t\t\t\t.getRootViewController()\n\t\t\t\t.getInstancedViews()\n\t\t\t\t.find(\n\t\t\t\t\t(pageView: View) =>\n\t\t\t\t\t\tpageView.getBindingContext()?.getPath() === rootContextPath &&\n\t\t\t\t\t\tpageView.getBindingContext()?.getObject() !== undefined\n\t\t\t\t)\n\t\t\t\t?.getBindingContext() as ODataV4Context;\n\t\t\tif (existingBindingContextOnPage) {\n\t\t\t\treturn { rootContext: existingBindingContextOnPage, isNew: false };\n\t\t\t}\n\t\t\tconst internalModel = view.getModel(\"internal\") as JSONModel;\n\t\t\tsimpleRootContext = internalModel.getProperty(\"/simpleRootContext\");\n\t\t\tif (useCache && simpleRootContext?.getPath() === rootContextPath) {\n\t\t\t\treturn { rootContext: simpleRootContext, isNew: false };\n\t\t\t}\n\t\t\tconst model = context.getModel();\n\t\t\tsimpleRootContext = createNewRootContext(model, rootContextPath, bindingParameters);\n\t\t\t// Store this new created context to use it on the next iterations\n\t\t\tif (useCache) {\n\t\t\t\tinternalModel.setProperty(\"/simpleRootContext\", simpleRootContext);\n\t\t\t}\n\n\t\t\treturn { rootContext: simpleRootContext, isNew: true };\n\t\t}\n\t}\n\treturn {\n\t\trootContext: undefined,\n\t\tisNew: false\n\t};\n}\n\n/**\n * Sync function to create a new root context for a given context.\n * @param model The oDataModel\n * @param rootContextPath The root context path\n * @param bindingParameters The binding parameters which can be OData query options\n * @returns The root context\n */\nfunction createNewRootContext(model: ODataModel, rootContextPath: string, bindingParameters?: BindContextParameters): ODataV4Context {\n\tconst messagesPath = ModelHelper.getMessagesPath(model.getMetaModel(), rootContextPath);\n\tconst newBindingParameters = { ...(bindingParameters ?? {}) };\n\tif (messagesPath && (!newBindingParameters.$select || newBindingParameters.$select.includes(messagesPath) === false)) {\n\t\tconst newSelect = newBindingParameters.$select?.split(\",\") ?? [];\n\t\tnewSelect.push(messagesPath);\n\t\tnewBindingParameters.$select = newSelect.join(\",\");\n\t}\n\treturn model.bindContext(rootContextPath, undefined, newBindingParameters).getBoundContext();\n}\n\n/**\n * Helper method to determine if the source is to be display for the editmode or not.\n * @param source\n * @returns If the source is to be displayed in edit mode\n */\nfunction getIsEditable(source: ManagedObject | PageController): boolean {\n\tconst managedObject = source.isA<PageController>(\"sap.fe.core.PageController\") ? source.getView() : source;\n\treturn managedObject.getBindingContext(\"ui\")?.getProperty(\"/isEditable\");\n}\n\nconst CommonUtils = {\n\tINLINEEDIT_UPDATEGROUPID: \"inline\",\n\tfireButtonPress: fnFireButtonPress,\n\tgetTargetView: getTargetView,\n\tgetCurrentPageView: getCurrentPageView,\n\thasTransientContext: fnHasTransientContexts,\n\tupdateRelatedAppsDetails: fnUpdateRelatedAppsDetails,\n\tgetAppComponent: getAppComponent,\n\tgetContextPathProperties: fnGetContextPathProperties,\n\tgetParameterInfo: getParameterInfo,\n\tupdateDataFieldForIBNButtonsVisibility: fnUpdateDataFieldForIBNButtonsVisibility,\n\tgetEntitySetName: getEntitySetName,\n\tgetActionPath: getActionPath,\n\tcomputeDisplayMode: computeDisplayMode,\n\tisStickyEditMode: isStickyEditMode,\n\tgetOperatorsForGuidProperty: getOperatorsForGuidProperty,\n\taddPageContextToSelectionVariant: addPageContextToSelectionVariant,\n\tsetUserDefaults: setUserDefaults,\n\tgetIBNActions: fnGetIBNActions,\n\tgetHeaderFacetItemConfigForExternalNavigation: getHeaderFacetItemConfigForExternalNavigation,\n\tgetSemanticObjectMapping: getSemanticObjectMapping,\n\tsetSemanticObjectMappings: setSemanticObjectMappings,\n\tgetSemanticObjectPromise: fnGetSemanticObjectPromise,\n\tgetSemanticObjectsFromPath: fnGetSemanticObjectsFromPath,\n\twaitForContextRequested: waitForContextRequested,\n\tgetFilterRestrictionsByPath: getFilterRestrictionsByPath,\n\tgetSpecificAllowedExpression: getSpecificAllowedExpression,\n\tgetAdditionalParamsForCreate: getAdditionalParamsForCreate,\n\trequestSingletonProperty: requestSingletonProperty,\n\ttemplateControlFragment: templateControlFragment,\n\tFilterRestrictions: {\n\t\tREQUIRED_PROPERTIES: \"RequiredProperties\",\n\t\tNON_FILTERABLE_PROPERTIES: \"NonFilterableProperties\",\n\t\tALLOWED_EXPRESSIONS: \"FilterAllowedExpressions\"\n\t},\n\tAllowedExpressionsPrio: [\"SingleValue\", \"MultiValue\", \"SingleRange\", \"MultiRange\", \"SearchExpression\", \"MultiRangeOrSearchExpression\"],\n\tnormalizeSearchTerm: normalizeSearchTerm,\n\tsetContextsBasedOnOperationAvailable: setContextsBasedOnOperationAvailable,\n\tsetDynamicActionContexts: setDynamicActionContexts,\n\trequestProperty: requestProperty,\n\tgetParameterPath: getParameterPath,\n\tgetRelatedAppsMenuItems: _getRelatedAppsMenuItems,\n\tgetTranslatedTextFromExpBindingString: _fntranslatedTextFromExpBindingString,\n\tupdateRelateAppsModel: updateRelateAppsModel,\n\tgetSemanticObjectAnnotations: _getSemanticObjectAnnotations,\n\tgetFiltersFromAnnotation: getFiltersFromAnnotation,\n\tcreateRootContext: createRootContext,\n\tfindOrCreateRootContext,\n\tupdateMenuButtonVisiblity: updateMenuButtonVisiblity,\n\tisSmallDevice,\n\tgetConverterContextForPath,\n\tgetIsEditable: getIsEditable\n};\n\nexport default CommonUtils;\n"],"mappings":"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","ignoreList":[],"file":"CommonUtils-dbg.js"}