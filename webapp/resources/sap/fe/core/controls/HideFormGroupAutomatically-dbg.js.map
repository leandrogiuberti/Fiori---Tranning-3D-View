{"version":3,"names":["HideFormGroupAutomatically","_dec","defineUI5Class","_class","_EventDelegateHook","_this","_len","arguments","length","args","Array","_key","call","appComponent","_inheritsLoose","_proto","prototype","onBeforeRendering","CommonUtils","getAppComponent","getParent","hideSubsectionsFormContainer","hideHeaderContainer","parent","isA","formContainers","getFormContainers","hideFormContainers","op","fetchObjectPage","sections","getSections","isArray","section","subSections","getSubSections","subSection","subSectionBlocks","getBlocks","isEditableHeader","some","headerBlock","subSectionBlock","formContainer","formElements","getFormElements","isThereAnyVisibleItem","fe","getVisible","isUsingPartOfPreviewAnnotation","formElement","bindingInfo","getBindingInfo","parts","bindingInfoPart","path","isUsingBindingOnVisibility","hideFormElements","isAdaptationMode","data","setVisible","fields","getFields","areAllFieldsHidden","every","field","EventDelegateHook"],"sourceRoot":".","sources":["HideFormGroupAutomatically.ts"],"sourcesContent":["import { defineUI5Class } from \"sap/fe/base/ClassSupport\";\nimport EventDelegateHook from \"sap/fe/base/EventDelegateHook\";\nimport type Section from \"sap/fe/macros/controls/Section\";\nimport type SubSectionBlock from \"sap/fe/templates/ObjectPage/controls/SubSectionBlock\";\nimport type Form from \"sap/ui/layout/form/Form\";\nimport type FormContainer from \"sap/ui/layout/form/FormContainer\";\nimport type FormElement from \"sap/ui/layout/form/FormElement\";\nimport type Control from \"sap/ui/mdc/Control\";\nimport type ObjectPageLayout from \"sap/uxap/ObjectPageLayout\";\nimport type AppComponent from \"../AppComponent\";\nimport CommonUtils from \"../CommonUtils\";\n\n@defineUI5Class(\"sap.fe.core.controls.HideFormGroupAutomatically\")\nclass HideFormGroupAutomatically extends EventDelegateHook {\n\tappComponent: AppComponent | null = null;\n\n\tonBeforeRendering(): void {\n\t\tthis.appComponent = CommonUtils.getAppComponent(this.getParent() as Control);\n\n\t\tthis.hideSubsectionsFormContainer();\n\t\tthis.hideHeaderContainer();\n\t}\n\n\t/**\n\t * Checks whether all the form elements are hidden, and then hides the form container.\n\t */\n\tprivate hideSubsectionsFormContainer(): void {\n\t\tconst parent = this?.getParent();\n\t\tif (parent?.isA<Form>(\"sap.ui.layout.form.Form\")) {\n\t\t\tconst formContainers = parent?.getFormContainers();\n\t\t\tthis.hideFormContainers(formContainers);\n\t\t}\n\t}\n\n\t/**\n\t * Checks whether all the form elements within an editable header are hidden, and then hides the form container.\n\t */\n\tprivate hideHeaderContainer(): void {\n\t\tconst op = this.fetchObjectPage();\n\t\t/**\n\t\t * Get the sections of the object page\n\t\t */\n\t\tconst sections = op?.getSections?.() as Section[];\n\n\t\tif (!Array.isArray(sections)) {\n\t\t\treturn;\n\t\t}\n\n\t\tfor (const section of sections) {\n\t\t\t/**\n\t\t\t * Navigate through the subsections within the sections.\n\t\t\t */\n\t\t\tconst subSections = section?.getSubSections();\n\n\t\t\tfor (const subSection of subSections) {\n\t\t\t\t/**\n\t\t\t\t * Get the subsection blocks.\n\t\t\t\t */\n\t\t\t\tconst subSectionBlocks = subSection?.getBlocks() as SubSectionBlock[];\n\t\t\t\t/**\n\t\t\t\t * Checks if there is a form inside the block.\n\t\t\t\t */\n\t\t\t\tconst isEditableHeader = subSectionBlocks?.some((headerBlock) => headerBlock.isA<Form>(\"sap.ui.layout.form.Form\"));\n\n\t\t\t\tif (!Array.isArray(subSectionBlocks) || !isEditableHeader) {\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\n\t\t\t\tfor (const subSectionBlock of subSectionBlocks) {\n\t\t\t\t\t/**\n\t\t\t\t\t * Get the form containers within the subsection.\n\t\t\t\t\t */\n\t\t\t\t\tif (subSectionBlock.isA<Form>(\"sap.ui.layout.form.Form\")) {\n\t\t\t\t\t\tconst formContainers = subSectionBlock?.getFormContainers?.();\n\t\t\t\t\t\tif (Array.isArray(formContainers)) {\n\t\t\t\t\t\t\tthis.hideFormContainers(formContainers);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\tprivate hideFormContainers(formContainers: FormContainer[]): void {\n\t\tif (!Array.isArray(formContainers)) return;\n\n\t\tfor (const formContainer of formContainers) {\n\t\t\tconst formElements = formContainer?.getFormElements();\n\t\t\tconst isThereAnyVisibleItem = formElements?.some((fe) => fe?.getVisible());\n\t\t\tconst isUsingPartOfPreviewAnnotation = formElements.some((formElement) => {\n\t\t\t\tconst bindingInfo = formElement?.getBindingInfo?.(\"visible\");\n\t\t\t\tif (Array.isArray(bindingInfo?.parts))\n\t\t\t\t\treturn bindingInfo.parts.some((bindingInfoPart: { path: string }) => bindingInfoPart.path === \"showDetails\");\n\t\t\t\treturn false;\n\t\t\t});\n\t\t\tconst isUsingBindingOnVisibility = formContainer?.getBindingInfo?.(\"visible\")?.parts?.length > 0;\n\n\t\t\t/**\n\t\t\t * This function checks the visibility of every field within the FormElement.\n\t\t\t * It hides the FormElement when the visibility of all contained fields is set to false\n\t\t\t */\n\t\t\tthis.hideFormElements(formElements);\n\n\t\t\t/**\n\t\t\t * This condition ignores the form container when a new group is created using the Adapt UI.\n\t\t\t * If the group is empty, we should not hide it, as it is required to be there to add additional form elements.\n\t\t\t * If the form container itself is marked as UI.Hidden, then we should not hide it.\n\t\t\t */\n\t\t\tif (\n\t\t\t\t(this.appComponent?.isAdaptationMode() === true && formElements?.length === 0) ||\n\t\t\t\tisUsingPartOfPreviewAnnotation ||\n\t\t\t\tisUsingBindingOnVisibility ||\n\t\t\t\tformContainer.data(\"UiHiddenPresent\") === \"true\"\n\t\t\t) {\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\t/**\n\t\t\t * Since this function is called every time there's a change in the form, we need to consider two scenarios.\n\t\t\t * First, if the form container is hidden, we must determine whether it should be shown again.\n\t\t\t * Second, if the form container is currently displayed, we need to assess whether it should be hidden.\n\t\t\t */\n\t\t\tif (isThereAnyVisibleItem === false) {\n\t\t\t\tformContainer.setVisible(false);\n\t\t\t} else if (!formContainer.getVisible()) {\n\t\t\t\tformContainer.setVisible(true);\n\t\t\t}\n\t\t}\n\t}\n\n\tprivate fetchObjectPage(): ObjectPageLayout | null {\n\t\tlet parent = this.getParent();\n\n\t\twhile (!(parent?.isA<ObjectPageLayout>(\"sap.uxap.ObjectPageLayout\") ?? false) && typeof parent?.getParent === \"function\") {\n\t\t\tparent = parent.getParent();\n\t\t}\n\n\t\treturn parent?.isA<ObjectPageLayout>(\"sap.uxap.ObjectPageLayout\") === true ? (parent as ObjectPageLayout) : null;\n\t}\n\n\tprivate hideFormElements(formElements: FormElement[]): void {\n\t\tif (!Array.isArray(formElements)) return;\n\n\t\tfor (const formElement of formElements) {\n\t\t\tconst fields = formElement?.getFields();\n\t\t\tconst areAllFieldsHidden = fields?.every((field) => field?.getVisible?.() === false);\n\n\t\t\tif (areAllFieldsHidden) formElement.setVisible(false);\n\t\t}\n\t}\n}\n\nexport default HideFormGroupAutomatically;\n"],"mappings":"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","ignoreList":[],"file":"HideFormGroupAutomatically-dbg.js"}