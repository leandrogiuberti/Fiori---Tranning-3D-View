{"version":3,"file":"HideFormGroupAutomatically.js","names":["HideFormGroupAutomatically","_dec","defineUI5Class","_class","_EventDelegateHook","_this","_len","arguments","length","args","Array","_key","call","this","appComponent","_inheritsLoose","_proto","prototype","onBeforeRendering","CommonUtils","getAppComponent","getParent","hideSubsectionsFormContainer","hideHeaderContainer","parent","isA","formContainers","getFormContainers","hideFormContainers","op","fetchObjectPage","sections","getSections","isArray","section","subSections","getSubSections","subSection","subSectionBlocks","getBlocks","isEditableHeader","some","headerBlock","subSectionBlock","formContainer","formElements","getFormElements","isThereAnyVisibleItem","fe","getVisible","isUsingPartOfPreviewAnnotation","formElement","bindingInfo","getBindingInfo","parts","bindingInfoPart","path","isUsingBindingOnVisibility","hideFormElements","isAdaptationMode","data","setVisible","fields","getFields","areAllFieldsHidden","every","field","EventDelegateHook"],"sources":["./HideFormGroupAutomatically.ts"],"sourcesContent":["import { defineUI5Class } from \"sap/fe/base/ClassSupport\";\nimport EventDelegateHook from \"sap/fe/base/EventDelegateHook\";\nimport type Section from \"sap/fe/macros/controls/Section\";\nimport type SubSectionBlock from \"sap/fe/templates/ObjectPage/controls/SubSectionBlock\";\nimport type Form from \"sap/ui/layout/form/Form\";\nimport type FormContainer from \"sap/ui/layout/form/FormContainer\";\nimport type FormElement from \"sap/ui/layout/form/FormElement\";\nimport type Control from \"sap/ui/mdc/Control\";\nimport type ObjectPageLayout from \"sap/uxap/ObjectPageLayout\";\nimport type AppComponent from \"../AppComponent\";\nimport CommonUtils from \"../CommonUtils\";\n\n@defineUI5Class(\"sap.fe.core.controls.HideFormGroupAutomatically\")\nclass HideFormGroupAutomatically extends EventDelegateHook {\n\tappComponent: AppComponent | null = null;\n\n\tonBeforeRendering(): void {\n\t\tthis.appComponent = CommonUtils.getAppComponent(this.getParent() as Control);\n\n\t\tthis.hideSubsectionsFormContainer();\n\t\tthis.hideHeaderContainer();\n\t}\n\n\t/**\n\t * Checks whether all the form elements are hidden, and then hides the form container.\n\t */\n\tprivate hideSubsectionsFormContainer(): void {\n\t\tconst parent = this?.getParent();\n\t\tif (parent?.isA<Form>(\"sap.ui.layout.form.Form\")) {\n\t\t\tconst formContainers = parent?.getFormContainers();\n\t\t\tthis.hideFormContainers(formContainers);\n\t\t}\n\t}\n\n\t/**\n\t * Checks whether all the form elements within an editable header are hidden, and then hides the form container.\n\t */\n\tprivate hideHeaderContainer(): void {\n\t\tconst op = this.fetchObjectPage();\n\t\t/**\n\t\t * Get the sections of the object page\n\t\t */\n\t\tconst sections = op?.getSections?.() as Section[];\n\n\t\tif (!Array.isArray(sections)) {\n\t\t\treturn;\n\t\t}\n\n\t\tfor (const section of sections) {\n\t\t\t/**\n\t\t\t * Navigate through the subsections within the sections.\n\t\t\t */\n\t\t\tconst subSections = section?.getSubSections();\n\n\t\t\tfor (const subSection of subSections) {\n\t\t\t\t/**\n\t\t\t\t * Get the subsection blocks.\n\t\t\t\t */\n\t\t\t\tconst subSectionBlocks = subSection?.getBlocks() as SubSectionBlock[];\n\t\t\t\t/**\n\t\t\t\t * Checks if there is a form inside the block.\n\t\t\t\t */\n\t\t\t\tconst isEditableHeader = subSectionBlocks?.some((headerBlock) => headerBlock.isA<Form>(\"sap.ui.layout.form.Form\"));\n\n\t\t\t\tif (!Array.isArray(subSectionBlocks) || !isEditableHeader) {\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\n\t\t\t\tfor (const subSectionBlock of subSectionBlocks) {\n\t\t\t\t\t/**\n\t\t\t\t\t * Get the form containers within the subsection.\n\t\t\t\t\t */\n\t\t\t\t\tif (subSectionBlock.isA<Form>(\"sap.ui.layout.form.Form\")) {\n\t\t\t\t\t\tconst formContainers = subSectionBlock?.getFormContainers?.();\n\t\t\t\t\t\tif (Array.isArray(formContainers)) {\n\t\t\t\t\t\t\tthis.hideFormContainers(formContainers);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\tprivate hideFormContainers(formContainers: FormContainer[]): void {\n\t\tif (!Array.isArray(formContainers)) return;\n\n\t\tfor (const formContainer of formContainers) {\n\t\t\tconst formElements = formContainer?.getFormElements();\n\t\t\tconst isThereAnyVisibleItem = formElements?.some((fe) => fe?.getVisible());\n\t\t\tconst isUsingPartOfPreviewAnnotation = formElements.some((formElement) => {\n\t\t\t\tconst bindingInfo = formElement?.getBindingInfo?.(\"visible\");\n\t\t\t\tif (Array.isArray(bindingInfo?.parts))\n\t\t\t\t\treturn bindingInfo.parts.some((bindingInfoPart: { path: string }) => bindingInfoPart.path === \"showDetails\");\n\t\t\t\treturn false;\n\t\t\t});\n\t\t\tconst isUsingBindingOnVisibility = formContainer?.getBindingInfo?.(\"visible\")?.parts?.length > 0;\n\n\t\t\t/**\n\t\t\t * This function checks the visibility of every field within the FormElement.\n\t\t\t * It hides the FormElement when the visibility of all contained fields is set to false\n\t\t\t */\n\t\t\tthis.hideFormElements(formElements);\n\n\t\t\t/**\n\t\t\t * This condition ignores the form container when a new group is created using the Adapt UI.\n\t\t\t * If the group is empty, we should not hide it, as it is required to be there to add additional form elements.\n\t\t\t * If the form container itself is marked as UI.Hidden, then we should not hide it.\n\t\t\t */\n\t\t\tif (\n\t\t\t\t(this.appComponent?.isAdaptationMode() === true && formElements?.length === 0) ||\n\t\t\t\tisUsingPartOfPreviewAnnotation ||\n\t\t\t\tisUsingBindingOnVisibility ||\n\t\t\t\tformContainer.data(\"UiHiddenPresent\") === \"true\"\n\t\t\t) {\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\t/**\n\t\t\t * Since this function is called every time there's a change in the form, we need to consider two scenarios.\n\t\t\t * First, if the form container is hidden, we must determine whether it should be shown again.\n\t\t\t * Second, if the form container is currently displayed, we need to assess whether it should be hidden.\n\t\t\t */\n\t\t\tif (isThereAnyVisibleItem === false) {\n\t\t\t\tformContainer.setVisible(false);\n\t\t\t} else if (!formContainer.getVisible()) {\n\t\t\t\tformContainer.setVisible(true);\n\t\t\t}\n\t\t}\n\t}\n\n\tprivate fetchObjectPage(): ObjectPageLayout | null {\n\t\tlet parent = this.getParent();\n\n\t\twhile (!(parent?.isA<ObjectPageLayout>(\"sap.uxap.ObjectPageLayout\") ?? false) && typeof parent?.getParent === \"function\") {\n\t\t\tparent = parent.getParent();\n\t\t}\n\n\t\treturn parent?.isA<ObjectPageLayout>(\"sap.uxap.ObjectPageLayout\") === true ? (parent as ObjectPageLayout) : null;\n\t}\n\n\tprivate hideFormElements(formElements: FormElement[]): void {\n\t\tif (!Array.isArray(formElements)) return;\n\n\t\tfor (const formElement of formElements) {\n\t\t\tconst fields = formElement?.getFields();\n\t\t\tconst areAllFieldsHidden = fields?.every((field) => field?.getVisible?.() === false);\n\n\t\t\tif (areAllFieldsHidden) formElement.setVisible(false);\n\t\t}\n\t}\n}\n\nexport default HideFormGroupAutomatically;\n"],"mappings":"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","ignoreList":[]}