/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)
 *      (c) Copyright 2009-2025 SAP SE. All rights reserved
 */
sap.ui.define(["sap/base/Log","sap/fe/base/ClassSupport","sap/fe/core/converters/MetaModelConverter","sap/fe/core/helpers/ResourceModelHelper","sap/fe/core/library","sap/m/Button","sap/m/CustomListItem","sap/m/Dialog","sap/m/FlexItemData","sap/m/HBox","sap/m/List","sap/m/Text","sap/m/Toolbar","sap/m/ToolbarSpacer","sap/ui/base/ManagedObject","sap/ui/core/library","sap/ui/model/Sorter","sap/ui/model/json/JSONModel","../../formatters/ValueFormatter","../../helpers/StandardRecommendationHelper","sap/fe/base/jsx-runtime/jsx","sap/fe/base/jsx-runtime/Fragment","sap/fe/base/jsx-runtime/jsxs"],function(e,t,n,o,i,r,a,c,s,l,m,d,u,g,f,p,h,R,C,x,D,A,M){"use strict";var v,_,O,b,T;var E={};var y=x.standardRecommendationHelper;var I=p.ValueState;var P=o.getResourceModel;var w=t.defineUI5Class;var j=t.defineReference;function N(e,t,n,o){n&&Object.defineProperty(e,t,{enumerable:n.enumerable,configurable:n.configurable,writable:n.writable,value:n.initializer?n.initializer.call(o):void 0})}function S(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e,L(e,t)}function L(e,t){return L=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},L(e,t)}function F(e,t,n,o,i){var r={};return Object.keys(o).forEach(function(e){r[e]=o[e]}),r.enumerable=!!r.enumerable,r.configurable=!!r.configurable,("value"in r||r.initializer)&&(r.writable=!0),r=n.slice().reverse().reduce(function(n,o){return o(e,t,n)||n},r),i&&void 0!==r.initializer&&(r.value=r.initializer?r.initializer.call(i):void 0,r.initializer=void 0),void 0===r.initializer?(Object.defineProperty(e,t,r),null):r}function B(e,t){throw Error("Decorating class property failed. Please ensure that transform-class-properties is enabled and runs after the decorators transform.")}const V=i.ProgrammingModel;let G=function(e){e["Accept"]="Accept_Recommendations";e["Reject"]="Reject_Recommendations";e["Continue"]="Continue_Editing";e["Skipped"]="Skipped";return e}({});E.RecommendationDialogDecision=G;let $=(v=w("sap.fe.core.controls.Recommendations.ConfirmRecommendationDialog"),_=j(),v(O=(b=function(t){function o(e){var n;n=t.call(this,e)||this;N(n,"confirmRecommendationDialog",T,n);n.view=e.view;n.programmingModel=e.programmingModel;n.confirmRecommendationDialogResourceModel=P(n.view);return n}E.ConfirmRecommendationDialog=o;S(o,t);var i=o.prototype;i.getOpenRecommendations=function e(){const t=this.getVisiblePageContextPaths();const n=this.getOpenRecommendationsForVisibleContextPaths(t);const o=[];if(n.length>0){n.forEach(e=>{const t=e.context;const n=this.view.getBindingContext();const i=e.propertyPath??"";const r=(e,t)=>{const n=e?.getProperty(t);return n===null||n===undefined||n===""};if(r(t,i)&&r(n,i)){o.push(e)}})}return o};i.getVisiblePageContextPaths=function e(){const t=[this.view.getBindingContext()?.getPath()];const n=this.view.getController();const o=n.getAppComponent().getRootViewController();const i=n.getAppComponent()._isFclEnabled();const r=i?o.getHelper().getCurrentUIState().isFullScreen:true;if(i&&!r){const e=o.getRightmostContext();if(!t.includes(e?.getPath())){t.push(e?.getPath())}}return t};i.getOpenRecommendationsForVisibleContextPaths=function e(t){const n=[];if(t.length>0){const e=this.view.getModel().getLocalAnnotationModel();t.forEach(t=>{if(t!==undefined){const o=e.getObject(t);if(o){const e=o;this.fetchLocalAnnotationObject(e,n)}}})}return n};i.fetchLocalAnnotationObject=function e(t,o){if(t["recommendationContext"]){const e={};e["recommendationContext"]=t["recommendationContext"];for(const n in t){const i=t[n];if(i){if(i["recommendationContext"]){this.fetchLocalAnnotationObject(t[n],o)}else if(n.includes("@$ui5.fe.recommendations.placeholderValue")||n.includes("@$ui5.fe.recommendations.placeholderDescription")||n.includes("@$ui5.fe.recommendations.typeAheadValues")){e[n]=i}}}const i=n.getInvolvedDataModelObjectEntityKeys(e["recommendationContext"]);e["recommendationContext"].contextIdentifier=i["semanticKeys"]?i["semanticKeys"]:i["technicalKeys"];this.getOpenRecommendationsForContext(e,e["recommendationContext"],o)}};i.getOpenRecommendationsForContext=function e(t,n,o){let i=arguments.length>3&&arguments[3]!==undefined?arguments[3]:"";for(const e in t){const r=t[e];if(r){const a=r.isA&&r.isA("sap.ui.model.odata.v4.Context");if(e.includes("@$ui5.fe.recommendations.placeholderValue")){const a=e.split("@$ui5.fe.recommendations.placeholderValue")[0];const c={context:n,propertyPath:i?`${i}/${a}`:a,value:r,contextIdentifier:n.contextIdentifier,contextIdentifierText:[]};const s=t[`${a}@$ui5.fe.recommendations.placeholderDescription`];if(s){c.text=s}o.push(c)}else if(typeof r==="object"&&!Array.isArray(r)&&!a){this.getOpenRecommendationsForContext(r,n,o,e)}}}};i.open=async function e(t){const n=this.getOpenRecommendations();if(n.length>0){y.addContextIdentifierText({recommendationData:n},this.view.getBindingContext()?.getPath());this.acceptAllParams={recommendationData:n};await(this.view?.getController()).recommendations.onBeforeAcceptRecommendations(this.acceptAllParams)}else{const e=(this.view?.getController()).recommendations.checkIfRecommendationsExist();if(e){this.acceptAllParams=await(this.view?.getController()).recommendations.fetchAcceptAllParams()}else{return undefined}}const o=this.getAcceptAllModel();this.view.setModel(o,"_acceptDialogModel");if(!o.getData().items?.length){return G.Skipped}this.isSave=t;const i=this.getContent();i?.setEscapeHandler(this.onContinueEditing.bind(this));this.view.addDependent(i);i?.open();return new Promise((e,t)=>{this.promiseResolve=e;this.promiseReject=t})};i.close=function e(){this.confirmRecommendationDialog.current?.close();this.confirmRecommendationDialog.current?.destroy()};i.onAcceptAndSave=async function t(){try{const e=await(this.view?.getController()).recommendations.acceptRecommendations(this.acceptAllParams);if(!e){this.promiseReject("Accept Failed")}this.promiseResolve(G.Accept)}catch{e.error("Accept Recommendations Failed");this.promiseReject("Accept Failed")}finally{this.close()}};i.onIgnoreAndSave=function e(){const t=this.view.getModel().getLocalAnnotationModel();const n=t.getProperty("/rejectedRecommendations")??{};if(!this.acceptAllParams?.recommendationData){return}const o=new Set;for(const e of this.acceptAllParams.recommendationData){const i=e.context?.getPath()??"";if(i!==""&&!o.has(i)){const e=t.getObject(i);if(e!==null&&typeof e==="object"){this._processRecommendationContext(i,e,n,t,o)}}}(this.view?.getController()).recommendations.ignoreRecommendationForContexts();this.promiseResolve(G.Reject);this.close()};i._processRecommendationContext=function e(t,n,o,i,r){const a=this._filterRecommendationKeys(n);this._clearRecommendationProperties(n,t,i);o[t]=a;i.setProperty("/rejectedRecommendations",o);r.add(t)};i._filterRecommendationKeys=function e(t){const n={};for(const e of Object.keys(t)){if(e.includes("ui5.fe.recommendations")){n[e]=t[e]}}return n};i._clearRecommendationProperties=function e(t,n,o){for(const e of Object.keys(t)){if(e.includes("ui5.fe.recommendations")){o.setProperty(`${n}/${e}`,undefined)}}};i.onContinueEditing=function e(){this.promiseResolve(G.Continue);this.close()};i.getFieldName=function e(t){const o=n.getInvolvedDataModelObjectsForTargetPath(t,this.view?.getBindingContext()?.getModel()?.getMetaModel());return o?.targetObject?.annotations?.Common?.Label?.toString()||t.split("/")[t.split("/").length-1]};i.getText=function e(t,n){if(t.text||t.value){switch(n){case"Description":return t.text;case"DescriptionValue":return C.formatWithBrackets(t.text,t.value);case"ValueDescription":return C.formatWithBrackets(t.value,t.text);case"Value":return t.value}}return t.value||""};i.getButton=function e(t,n,o){return D(r,{text:t,type:n,width:"auto",press:o,children:{layoutData:D(A,{children:D(s,{minWidth:"100%"})})}})};i.getFooter=function e(){return D(u,{children:{content:M(A,{children:[D(g,{}),this.getButton(this._getDialogButtonText(this.isSave,G.Accept),"Emphasized",this.onAcceptAndSave.bind(this)),this.getButton(this._getDialogButtonText(this.isSave,G.Reject),"Ghost",this.onIgnoreAndSave.bind(this)),this.getButton(this.confirmRecommendationDialogResourceModel.getText("C_RECOMMENDATION_DIALOG_CONTINUE_EDITING"),"Ghost",this.onContinueEditing.bind(this))]})}})};i._getDialogButtonText=function e(t,n){const o=n===G.Accept;if(t){const e=this.view.getBindingContext("pageInternal")?.getProperty("createMode");if(e){return o?this.confirmRecommendationDialogResourceModel.getText("C_RECOMMENDATION_DIALOG_ACCEPT_AND_CREATE"):this.confirmRecommendationDialogResourceModel.getText("C_RECOMMENDATION_DIALOG_REJECT_AND_CREATE")}return o?this.confirmRecommendationDialogResourceModel.getText("C_RECOMMENDATION_DIALOG_ACCEPT_AND_SAVE"):this.confirmRecommendationDialogResourceModel.getText("C_RECOMMENDATION_DIALOG_REJECT_AND_SAVE")}return o?this.confirmRecommendationDialogResourceModel.getText("C_RECOMMENDATION_DIALOG_ACCEPT"):this.confirmRecommendationDialogResourceModel.getText("C_RECOMMENDATION_DIALOG_REJECT")};i.getAcceptAllModel=function e(){const t=new R;const n=[];for(const e of this.acceptAllParams?.recommendationData||[]){const t=y.getEntityName(e.context)||"";const o=e.contextIdentifierText&&e.contextIdentifierText.length>0?`${t} (${e.contextIdentifierText})`:t;if(e.value||e.text){const t=e.context?.getPath()+"/"+e.propertyPath;const i=y.getDisplayModeForTargetPath(t,this.view?.getBindingContext()?.getModel()?.getMetaModel());const r={fieldName:this.getFieldName(t).valueOf(),fieldValue:this.getText(e,i),identifierTexts:o};n.push(r)}}t.setData({items:n});return t};i.getGroup=function e(t){return t.getProperty("identifierTexts")};i.getMessage=function e(){const t=this.view.getModel("_acceptDialogModel")?.getData()?.items;const n=t.length>1?this.confirmRecommendationDialogResourceModel.getText("C_RECOMMENDATION_DIALOG_TEXT",[t.length]):this.confirmRecommendationDialogResourceModel.getText("C_RECOMMENDATION_DIALOG_TEXT_SINGULAR");return D(d,{text:n})};i.getDialogContent=function e(){return D(m,{items:{model:"_acceptDialogModel",path:"/items",sorter:new h("identifierTexts",false,this.getGroup)},children:D(a,{children:D(l,{class:"sapUiSmallMarginBegin sapUiTinyMargin",children:D(d,{text:"{_acceptDialogModel>fieldName}: {_acceptDialogModel>fieldValue}"})})})})};i.getContent=function e(){return D(c,{title:this.confirmRecommendationDialogResourceModel.getText("C_RECOMMENDATION_DIALOG_TITLE"),state:I.Information,type:"Message",ref:this.confirmRecommendationDialog,resizable:"true",contentWidth:"35rem",children:{content:M(A,{children:[this.getMessage(),this.getDialogContent()]}),footer:D(A,{children:this.getFooter()})}})};return o}(f),T=F(b.prototype,"confirmRecommendationDialog",[_],{configurable:true,enumerable:true,writable:true,initializer:null}),b))||O);E.ConfirmRecommendationDialog=$;return E},false);
//# sourceMappingURL=ConfirmRecommendationDialog.js.map