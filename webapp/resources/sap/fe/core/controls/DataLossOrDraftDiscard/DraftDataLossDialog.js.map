{"version":3,"file":"DraftDataLossDialog.js","names":["DraftDataLossDialog","_dec","defineUI5Class","_dec2","defineReference","_dec3","_class","_class2","_ManagedObject","_this","_len","arguments","length","args","Array","_key","call","this","_initializerDefineProperty","_descriptor","_descriptor2","shallForceDraftSaveOrDiscard","_exports","_inheritsLoose","_proto","prototype","open","async","controller","focusOnCancel","view","getView","appComponent","CommonUtils","getAppComponent","isHiddenDraft","getEnvironmentCapabilities","getCapabilities","HiddenDraft","enabled","viewContext","getBindingContext","isRootContextNew","editFlow","dataLossResourceModel","getResourceModel","createContent","dataLossConfirm","handleDataLossOk","optionsList","current","addEventDelegate","onkeyup","e","key","addDependent","dataLossDialog","selectAndFocusFirstEntry","Promise","resolve","promiseResolve","close","destroy","getSelectedKey","handleDataLossCancel","cancelButton","getItems","setSelectedItem","focus","firstListItemOption","getSelectedItem","data","getConfirmButton","_jsx","Button","text","getText","type","press","getCancelButton","isSave","createOrSaveText","createOrSaveLabel","items","push","CustomListItem","customData","CustomData","value","children","_jsxs","VBox","class","Label","design","Text","hasActiveEntity","getObject","HasActiveEntity","description","Dialog","id","generate","getId","title","state","ValueState","Warning","contentWidth","ref","content","_Fragment","List","mode","showSeparators","includeItemInSelection","backgroundDesign","buttons","ManagedObject","_applyDecoratedDescriptor","configurable","enumerable","writable","initializer"],"sources":["./DraftDataLossDialog.tsx"],"sourcesContent":["import { defineReference, defineUI5Class } from \"sap/fe/base/ClassSupport\";\nimport type { Ref } from \"sap/fe/base/jsx-runtime/jsx\";\nimport { getResourceModel } from \"sap/fe/core/helpers/ResourceModelHelper\";\nimport { generate } from \"sap/fe/core/helpers/StableIdHelper\";\nimport Button from \"sap/m/Button\";\nimport CustomListItem from \"sap/m/CustomListItem\";\nimport Dialog from \"sap/m/Dialog\";\nimport Label from \"sap/m/Label\";\nimport List from \"sap/m/List\";\nimport Text from \"sap/m/Text\";\nimport VBox from \"sap/m/VBox\";\nimport ManagedObject from \"sap/ui/base/ManagedObject\";\nimport CustomData from \"sap/ui/core/CustomData\";\nimport type UI5Element from \"sap/ui/core/Element\";\nimport { ValueState } from \"sap/ui/core/library\";\nimport type View from \"sap/ui/core/mvc/View\";\nimport type Context from \"sap/ui/model/odata/v4/Context\";\nimport CommonUtils from \"../../CommonUtils\";\nimport type PageController from \"../../PageController\";\nimport type ResourceModel from \"../../ResourceModel\";\nimport type { HiddenDraft } from \"../../converters/ManifestSettings\";\n\n@defineUI5Class(\"sap.fe.core.controls.DataLossOrDraftDiscard.DraftDataLossDialog\")\nexport default class DraftDataLossDialog extends ManagedObject {\n\t@defineReference()\n\tdataLossDialog!: Ref<Dialog>;\n\n\t@defineReference()\n\toptionsList!: Ref<List>;\n\n\tprivate view!: View;\n\n\tprivate dataLossResourceModel!: ResourceModel;\n\n\t/**\n\t * Resolves the promise with the selected dialog list option\n\t */\n\tprivate promiseResolve!: Function;\n\n\tprivate shallForceDraftSaveOrDiscard = false;\n\n\tprivate isRootContextNew!: boolean;\n\n\tprivate isHiddenDraft!: boolean;\n\n\t/**\n\t * Opens the data loss dialog.\n\t * @param controller\n\t * @param focusOnCancel Determines whether to focus on the cancel button when the dialog opens.\n\t */\n\tpublic async open(controller: PageController, focusOnCancel?: boolean): Promise<unknown> {\n\t\tthis.view = controller.getView();\n\t\tconst appComponent = CommonUtils.getAppComponent(this.view);\n\t\tthis.isHiddenDraft = (appComponent.getEnvironmentCapabilities()?.getCapabilities()?.HiddenDraft as HiddenDraft)?.enabled;\n\t\tconst viewContext = this.view.getBindingContext() as Context;\n\t\tthis.isRootContextNew = viewContext ? await controller.editFlow.isRootContextNew(viewContext) : false;\n\t\tthis.shallForceDraftSaveOrDiscard = controller.editFlow.shallForceDraftSaveOrDiscard();\n\t\tthis.dataLossResourceModel = getResourceModel(this.view);\n\t\tthis.createContent();\n\t\tconst dataLossConfirm = (): void => this.handleDataLossOk();\n\t\tthis.optionsList.current?.addEventDelegate({\n\t\t\tonkeyup: function (e: KeyboardEvent) {\n\t\t\t\tif (e.key === \"Enter\") {\n\t\t\t\t\tdataLossConfirm();\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t\tthis.view.addDependent(this.dataLossDialog.current as UI5Element);\n\t\tthis.dataLossDialog.current?.open();\n\t\tif (focusOnCancel != null) {\n\t\t\tthis.selectAndFocusFirstEntry(focusOnCancel);\n\t\t} else {\n\t\t\tthis.selectAndFocusFirstEntry();\n\t\t}\n\n\t\treturn new Promise((resolve) => {\n\t\t\tthis.promiseResolve = resolve;\n\t\t});\n\t}\n\n\t/**\n\t * Handler to close the dataloss dialog.\n\t *\n\t */\n\tpublic close(): void {\n\t\tthis.dataLossDialog.current?.close();\n\t\tthis.dataLossDialog.current?.destroy();\n\t}\n\n\t/**\n\t * Executes the logic when the data loss dialog is confirmed. The selection of an option resolves the promise and leads to the\n\t * processing of the originally triggered action like e.g. a back navigation.\n\t *\n\t */\n\n\tprivate handleDataLossOk(): void {\n\t\tthis.promiseResolve(this.getSelectedKey());\n\t}\n\n\t/**\n\t * Handler to close the dataloss dialog.\n\t *\n\t */\n\tprivate handleDataLossCancel(): void {\n\t\tthis.promiseResolve(\"cancel\");\n\t}\n\n\t/**\n\t * Sets the focus on the first list item of the dialog.\n\t * @param focusOnCancel Determines whether to focus on the cancel button.\n\t */\n\tprivate selectAndFocusFirstEntry(focusOnCancel?: boolean): void {\n\t\tif (focusOnCancel === true) {\n\t\t\tconst cancelButton = this.optionsList.current?.getItems()[1] as CustomListItem;\n\t\t\tthis.optionsList.current?.setSelectedItem(cancelButton);\n\t\t\tcancelButton?.focus();\n\t\t\treturn;\n\t\t}\n\t\tconst firstListItemOption: CustomListItem = this.optionsList.current?.getItems()[0] as CustomListItem;\n\t\tthis.optionsList.current?.setSelectedItem(firstListItemOption);\n\t\t// We do not set the focus on the button, but catch the ENTER key in the dialog\n\t\t// and process it as Ok, since focusing the button was reported as an ACC issue\n\t\tfirstListItemOption?.focus();\n\t}\n\n\t/**\n\t * Gets the key of the selected item from the list of options that was set via customData.\n\t * @returns The key of the currently selected item\n\t */\n\tprivate getSelectedKey(): string {\n\t\tconst optionsList = this.optionsList.current as List;\n\t\treturn optionsList.getSelectedItem().data(\"itemKey\");\n\t}\n\n\t/**\n\t * Returns the confirm button.\n\t * @returns A button\n\t */\n\tprivate getConfirmButton(): Button {\n\t\treturn (\n\t\t\t<Button\n\t\t\t\ttext={this.dataLossResourceModel.getText(\"C_COMMON_DIALOG_OK\")}\n\t\t\t\ttype={\"Emphasized\"}\n\t\t\t\tpress={(): void => this.handleDataLossOk()}\n\t\t\t/>\n\t\t) as Button;\n\t}\n\n\t/**\n\t * Returns the cancel button.\n\t * @returns A button\n\t */\n\tprivate getCancelButton(): Button {\n\t\treturn (\n\t\t\t<Button\n\t\t\t\ttext={\n\t\t\t\t\tthis.isHiddenDraft\n\t\t\t\t\t\t? this.dataLossResourceModel.getText(\"C_COMMON_SAPFE_CLOSE\")\n\t\t\t\t\t\t: this.dataLossResourceModel.getText(\"C_COMMON_DIALOG_CANCEL\")\n\t\t\t\t}\n\t\t\t\tpress={(): void => this.handleDataLossCancel()}\n\t\t\t/>\n\t\t) as Button;\n\t}\n\n\t/**\n\t * Returns the options available in the dialog.\n\t * @param isSave\n\t * @returns The options as CustomListItems\n\t */\n\tprivate getItems(isSave: boolean): CustomListItem[] {\n\t\tlet createOrSaveText = \"\";\n\t\tlet createOrSaveLabel = this.dataLossResourceModel.getText(\"ST_DRAFT_DATALOSS_SAVE_DRAFT_RBL\");\n\t\tif (isSave) {\n\t\t\tcreateOrSaveText = this.isHiddenDraft\n\t\t\t\t? this.dataLossResourceModel.getText(\"ST_DRAFT_DATALOSS_SAVE_HIDDEN_DRAFT_TOL\")\n\t\t\t\t: this.dataLossResourceModel.getText(\"ST_DRAFT_DATALOSS_SAVE_DRAFT_TOL\");\n\t\t} else {\n\t\t\tcreateOrSaveLabel = this.dataLossResourceModel.getText(\"ST_DRAFT_DATALOSS_CREATE_ENTITY_RBL\");\n\t\t\tcreateOrSaveText = this.dataLossResourceModel.getText(\"ST_DRAFT_DATALOSS_CREATE_ENTITY_TOL\");\n\t\t}\n\t\tconst items: CustomListItem[] = [];\n\t\titems.push(\n\t\t\t<CustomListItem customData={[new CustomData({ key: \"itemKey\", value: \"draftDataLossOptionSave\" })]}>\n\t\t\t\t<VBox class=\"sapUiTinyMargin\">\n\t\t\t\t\t<Label text={createOrSaveLabel} design=\"Bold\" />\n\t\t\t\t\t<Text text={createOrSaveText} />\n\t\t\t\t</VBox>\n\t\t\t</CustomListItem>\n\t\t);\n\n\t\t// The option to keep the draft is not available for new drafts and if shallForceDraftSaveOrDiscard === true\n\t\t// (TreeTable in the ListReport)\n\t\tif ((isSave || !this.shallForceDraftSaveOrDiscard) && !this.isHiddenDraft) {\n\t\t\titems.push(\n\t\t\t\t<CustomListItem customData={[new CustomData({ key: \"itemKey\", value: \"draftDataLossOptionKeep\" })]}>\n\t\t\t\t\t<VBox class=\"sapUiTinyMargin\">\n\t\t\t\t\t\t<Label text={this.dataLossResourceModel.getText(\"ST_DRAFT_DATALOSS_KEEP_DRAFT_RBL\")} design=\"Bold\" />\n\t\t\t\t\t\t<Text text={this.dataLossResourceModel.getText(\"ST_DRAFT_DATALOSS_KEEP_DRAFT_TOL\")} />\n\t\t\t\t\t</VBox>\n\t\t\t\t</CustomListItem>\n\t\t\t);\n\t\t}\n\n\t\titems.push(\n\t\t\t<CustomListItem customData={[new CustomData({ key: \"itemKey\", value: \"draftDataLossOptionDiscard\" })]}>\n\t\t\t\t<VBox class=\"sapUiTinyMargin\">\n\t\t\t\t\t<Label\n\t\t\t\t\t\ttext={\n\t\t\t\t\t\t\tthis.isHiddenDraft\n\t\t\t\t\t\t\t\t? this.dataLossResourceModel.getText(\"ST_DRAFT_DATALOSS_DISCARD_HIDDEN_DRAFT_RBL\")\n\t\t\t\t\t\t\t\t: this.dataLossResourceModel.getText(\"ST_DRAFT_DATALOSS_DISCARD_DRAFT_RBL\")\n\t\t\t\t\t\t}\n\t\t\t\t\t\tdesign=\"Bold\"\n\t\t\t\t\t/>\n\t\t\t\t\t<Text text={this.dataLossResourceModel.getText(\"ST_DRAFT_DATALOSS_DISCARD_DRAFT_TOL\")} />\n\t\t\t\t</VBox>\n\t\t\t</CustomListItem>\n\t\t);\n\n\t\treturn items;\n\t}\n\n\t/**\n\t * The building block render function.\n\t * @returns An XML-based string\n\t */\n\tcreateContent(): Dialog {\n\t\tconst hasActiveEntity = this.view.getBindingContext()?.getObject().HasActiveEntity === true;\n\t\tconst isSave = this.isHiddenDraft ? !this.isRootContextNew : hasActiveEntity;\n\t\tconst description = isSave\n\t\t\t? this.dataLossResourceModel.getText(\"ST_DRAFT_DATALOSS_POPUP_MESSAGE_SAVE\")\n\t\t\t: this.dataLossResourceModel.getText(\"ST_DRAFT_DATALOSS_POPUP_MESSAGE_CREATE\");\n\n\t\treturn (\n\t\t\t<Dialog\n\t\t\t\tid={generate([this.getId(), \"draftDataLossDialog\"])}\n\t\t\t\ttitle={this.dataLossResourceModel.getText(\"WARNING\")}\n\t\t\t\tstate={ValueState.Warning}\n\t\t\t\ttype={\"Message\"}\n\t\t\t\tcontentWidth={\"22rem\"}\n\t\t\t\tref={this.dataLossDialog}\n\t\t\t>\n\t\t\t\t{{\n\t\t\t\t\tcontent: (\n\t\t\t\t\t\t<>\n\t\t\t\t\t\t\t<Text text={description} class=\"sapUiTinyMarginBegin sapUiTinyMarginTopBottom\" />\n\t\t\t\t\t\t\t<List\n\t\t\t\t\t\t\t\tmode=\"SingleSelectLeft\"\n\t\t\t\t\t\t\t\tshowSeparators=\"None\"\n\t\t\t\t\t\t\t\tincludeItemInSelection=\"true\"\n\t\t\t\t\t\t\t\tbackgroundDesign=\"Transparent\"\n\t\t\t\t\t\t\t\tclass=\"sapUiNoContentPadding\"\n\t\t\t\t\t\t\t\tref={this.optionsList}\n\t\t\t\t\t\t\t\titems={this.getItems(isSave)}\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t</>\n\t\t\t\t\t),\n\t\t\t\t\tbuttons: (\n\t\t\t\t\t\t<>\n\t\t\t\t\t\t\tconfirmButton = {this.getConfirmButton()}\n\t\t\t\t\t\t\tcancelButton = {this.getCancelButton()}\n\t\t\t\t\t\t</>\n\t\t\t\t\t)\n\t\t\t\t}}\n\t\t\t</Dialog>\n\t\t) as Dialog;\n\t}\n}\n"],"mappings":"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","ignoreList":[]}