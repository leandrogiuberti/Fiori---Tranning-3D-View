/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)
 *      (c) Copyright 2009-2025 SAP SE. All rights reserved
 */
sap.ui.define(["sap/base/Log","sap/fe/base/BindingToolkit","sap/fe/core/converters/controls/Common/Action","sap/fe/core/converters/controls/ObjectPage/HeaderFacet","sap/fe/core/converters/helpers/IssueManager","sap/fe/core/converters/helpers/Key","sap/fe/core/helpers/ActionUtilities","sap/fe/core/helpers/BindingHelper","sap/fe/core/helpers/TypeGuards","../../ManifestSettings","../../annotations/DataField","../../helpers/ConfigurableObject","../../helpers/ID","../../objectPage/FormMenuActions","../Common/DataVisualization","../Common/Form"],function(e,t,a,n,i,o,r,s,c,l,u,d,v,p,f,m){"use strict";var g={};var b=m.isReferenceFacet;var I=m.createFormDefinition;var F=f.getDataVisualizationConfiguration;var h=p.getFormHiddenActions;var y=p.getFormActions;var A=v.getSubSectionID;var U=v.getSideContentID;var S=v.getFormID;var C=v.getCustomSubSectionID;var D=d.insertCustomElements;var T=d.Placement;var k=d.OverrideType;var L=u.isActionWithDialog;var M=l.ActionType;var E=c.isPathAnnotationExpression;var N=s.singletonPathVisitor;var O=o.KeyHelper;var P=i.IssueType;var w=i.IssueSeverity;var $=i.IssueCategory;var x=n.getStashedSettingsForHeaderFacet;var R=n.getHeaderFacetsFromManifest;var V=n.getDesignTimeMetadataSettingsForHeaderFacet;var H=a.removeDuplicateActions;var z=a.prepareMenuActions;var j=a.isMenuAIOperation;var B=a.isActionNavigable;var _=a.isActionAIOperation;var G=a.getVisibilityEnablementMenuActions;var W=a.getSemanticObjectMapping;var q=a.getMatchingManifestAction;var K=a.getEnabledForAnnotationAction;var X=a.getAnnotationMenuActionItems;var Q=a.getActionsFromManifest;var J=a.ButtonType;var Y=t.resolveBindingString;var Z=t.ref;var ee=t.pathInModel;var te=t.or;var ae=t.notEqual;var ne=t.not;var ie=t.isConstant;var oe=t.ifElse;var re=t.getExpressionFromAnnotation;var se=t.fn;var ce=t.equal;var le=t.compileExpression;var ue=t.and;let de=function(e){e["Unknown"]="Unknown";e["Form"]="Form";e["Notes"]="Notes";e["DataVisualization"]="DataVisualization";e["XMLFragment"]="XMLFragment";e["Placeholder"]="Placeholder";e["Mixed"]="Mixed";e["EmbeddedComponent"]="EmbeddedComponent";return e}({});g.SubSectionType=de;const ve=["com.sap.vocabularies.UI.v1.LineItem","com.sap.vocabularies.UI.v1.Chart","com.sap.vocabularies.UI.v1.PresentationVariant","com.sap.vocabularies.UI.v1.SelectionPresentationVariant","com.sap.vocabularies.UI.v1.Note"];function pe(e,t,a,n){const i=e.reduce((e,t)=>{switch(t.$Type){case"com.sap.vocabularies.UI.v1.ReferenceFacet":e.push(t);break;case"com.sap.vocabularies.UI.v1.CollectionFacet":if(t.Facets.find(e=>e.$Type==="com.sap.vocabularies.UI.v1.CollectionFacet")){e.splice(e.length,0,...t.Facets)}else{e.push(t)}break;case"com.sap.vocabularies.UI.v1.ReferenceURLFacet":break}return e},[]);return i.map(e=>he(e,i,t,0,!e?.Facets?.length,a,n))}g.createSubSections=pe;function fe(e){const t=R(e.getManifestWrapper().getHeaderFacets());const a=[];Object.keys(t).forEach(function(e){a.push(t[e]);return a});const n=a.reduce((e,t)=>{if(t.templateEdit){e.push(t)}return e},[]);return n.map(e=>me(e))}g.createCustomHeaderFacetSubSections=fe;function me(e){const t=C(e.key);const a={id:t,key:e.key,title:e.title,type:de.XMLFragment,template:e.templateEdit||"",visible:e.visible,level:1,sideContent:undefined,stashed:e.stashed,flexSettings:e.flexSettings,actions:{},objectPageLazyLoaderEnabled:false};return a}const ge=(e,t)=>e.ID?.toString()||e.Label?.toString()||t;function be(e,t,a){for(let t=e.length-1;t>=0;t--){if(e[t].id?.startsWith("CustomAction::")&&(e[t].key.startsWith("DataFieldForAction::")||e[t].key.startsWith("DataFieldForIntentBasedNavigation::"))){e.splice(t,1)}}const n=h(t,a)||[],i={enabled:k.overwrite,visible:k.overwrite,command:k.overwrite,position:k.overwrite,menu:k.overwrite,priority:k.overwrite,group:k.overwrite},o=y(t,a),s=Q(o,a,e,undefined,undefined,n),c=X(e),l=q(c,s.actions),u=D(c,l,i);for(let t=e.length-1;t>=0;t--){if(e[t].id?.startsWith("CustomAction::")){for(const a in s.actions){if(a===e[t].key){e.splice(t,1);break}}}}let d=D(e,s.actions,i);z(d,u);d=H(d);d=G(d);d=r.ensurePrimaryActionNeverOverflows(d);d.forEach(e=>{if(e.type===M.Menu&&!!e.defaultAction){e.defaultAction.type=M.Default}});return{actions:d??e,commandActions:s.commandActions}}function Ie(e,t){let a=[];switch(e.$Type){case"com.sap.vocabularies.UI.v1.CollectionFacet":a=e.Facets.filter(e=>b(e)).reduce((e,a)=>Ae(e,a,t),[]);break;case"com.sap.vocabularies.UI.v1.ReferenceFacet":a=Ae([],e,t);break;default:break}return be(a,e,t)}function Fe(e){const t=ce(re(e),true);return le(oe(t,J.Ghost,J.Transparent))}function he(t,a,n,i,o,r,s){const c=A(t);const l=t.annotations?.UI?.Hidden;const u=ne(ce(true,re(l,[],false,e=>N(e,n.getConvertedTypes(),[]))));const d=!ie(u)&&!E(l);const v=t.Label!==undefined?le(re(t.Label)):undefined;const p={id:c,key:ge(t,c),title:v,type:de.Unknown,annotationPath:n.getEntitySetBasedAnnotationPath(t.fullyQualifiedName),visible:le(u),isVisibilityDynamic:d,level:i,sideContent:undefined,objectPageLazyLoaderEnabled:n.getManifestWrapper().getEnableLazyLoading()};if(r){p.stashed=x(t,t,n);p.flexSettings={designtime:V(t,t,n)}}let f="";i++;switch(t.$Type){case"com.sap.vocabularies.UI.v1.CollectionFacet":const c=t.Facets;const l=c.map((e,t)=>({index:t,facet:e})).filter(e=>{let{facet:t}=e;return b(t)&&t.Target.$target&&ve.includes(t.Target.$target.term)});const m=c.filter(e=>!l.find(t=>t.facet===e));if(l.length>0){const a=[];const s=[];const c=[];for(const{facet:e}of l){a.push(he(e,[],n,i,true,r))}if(m.length>0){e.warning(`Warning: CollectionFacet '${t.ID}' includes a combination of either a chart or a table and other content. This can lead to rendering issues. Consider moving the chart or table into a separate CollectionFacet.`);const a={...t};a.Facets=m;s.push(he(a,[],n,i,o,r))}if(l.find(e=>{let{index:t}=e;return t===0})){c.push(...a);c.push(...s)}else{c.push(...s);c.push(...a)}const u={...p,type:de.Mixed,level:i,content:c};return u}else{const e=Ie(t,n),a={...p,type:de.Form,formDefinition:I(t,le(u),n,e.actions,{useSingleTextAreaFieldAsNotes:s}),level:i,actions:e.actions.filter(e=>e.facetName===undefined),commandActions:e.commandActions};return a}case"com.sap.vocabularies.UI.v1.ReferenceFacet":if(!t.Target.$target){f=`Unable to find annotationPath ${t.Target.value}`}else{switch(t.Target.$target.term){case"com.sap.vocabularies.UI.v1.LineItem":case"com.sap.vocabularies.UI.v1.Chart":case"com.sap.vocabularies.UI.v1.PresentationVariant":case"com.sap.vocabularies.UI.v1.SelectionPresentationVariant":const e=F(t.Target.value,n,{isCondensedTableLayoutCompliant:Te(t,a,n),doNotCheckApplySupported:r,shouldCreateTemplateChartVisualization:true});const c=p.title?p.title:"";const l=e.visualizations[0]?.annotation?.title||e.visualizations[0]?.title;const m=t.annotations?.UI?.PartOfPreview?.valueOf()!==false;const g=ye(l??"",c,o);const b=oe(d,ue(u,ne(ce(v,"undefined")),g),ue(le(u)!==undefined,v!=="undefined",v!==undefined,u,g));const h={...p,type:de.DataVisualization,level:i,presentation:e,isPartOfPreview:m,showSubSectionTitle:le(g),dataVisualizationTitleVisible:le(b)};return h;case"com.sap.vocabularies.UI.v1.FieldGroup":case"com.sap.vocabularies.UI.v1.Identification":case"com.sap.vocabularies.UI.v1.DataPoint":case"com.sap.vocabularies.UI.v1.StatusInfo":case"com.sap.vocabularies.Communication.v1.Contact":const y=Ie(t,n),A={...p,type:de.Form,level:i,formDefinition:I(t,le(u),n,y.actions,{useSingleTextAreaFieldAsNotes:s}),actions:y.actions.filter(e=>e.facetName===undefined),commandActions:y.commandActions};return A;case"com.sap.vocabularies.UI.v1.Note":return{...p,type:de.Notes};default:f=`For ${t.Target.$target.term} Fragment`;break}}break;case"com.sap.vocabularies.UI.v1.ReferenceURLFacet":f="For Reference URL Facet";break;default:break}const m={...p,type:de.Unknown,text:f};return m}g.createSubSection=he;function ye(e,t,a){return te(ne(a),ae(Y(e),Y(t)))}g.getShowSubSectionTitle=ye;function Ae(e,t,a){const n=t.Target.$target;const i=t.Target.value;let o={};let r=[];let s;[s]=i.split("@");if(s.length>0){if(s.lastIndexOf("/")===s.length-1){s=s.substring(0,s.length-1)}}else{s=undefined}if(n){switch(n.term){case"com.sap.vocabularies.UI.v1.FieldGroup":r=n.Data;o=Q(a.getManifestControlConfiguration(n).actions,a,[],undefined,undefined,undefined,t.fullyQualifiedName).actions;break;case"com.sap.vocabularies.UI.v1.Identification":case"com.sap.vocabularies.UI.v1.StatusInfo":if(n.qualifier){r=n}break;default:break}e=r.reduce((e,i)=>{switch(i.$Type){case"com.sap.vocabularies.UI.v1.DataFieldForIntentBasedNavigation":if(i.RequiresContext?.valueOf()===true){a.getDiagnostics().addIssue($.Annotation,w.Low,P.MALFORMED_DATAFIELD_FOR_IBN.REQUIRESCONTEXT)}if(i.Inline?.valueOf()===true){a.getDiagnostics().addIssue($.Annotation,w.Low,P.MALFORMED_DATAFIELD_FOR_IBN.INLINE)}if(i.Determining?.valueOf()===true){a.getDiagnostics().addIssue($.Annotation,w.Low,P.MALFORMED_DATAFIELD_FOR_IBN.DETERMINING)}const o={};if(i.Mapping){o.semanticObjectMapping=W(i.Mapping)}e.push({type:M.DataFieldForIntentBasedNavigation,id:S(t,i),key:O.generateKeyFromDataField(i),text:i.Label?.toString(),annotationPath:"",enabled:i.NavigationAvailable!==undefined?le(ce(re(i.NavigationAvailable),true)):"true",visible:le(ne(ce(re(i.annotations?.UI?.Hidden),true))),buttonType:Fe(i.annotations?.UI?.Emphasized),press:le(se("._intentBasedNavigation.navigate",[re(i.SemanticObject),re(i.Action),o])),customData:le({semanticObject:re(i.SemanticObject),action:re(i.Action)})});break;case"com.sap.vocabularies.UI.v1.DataFieldForAction":const r=a.getManifestControlConfiguration(n).actions;e.push(Ue(i,t,a,r,s));break;case"com.sap.vocabularies.UI.v1.DataFieldForActionGroup":e.push({type:M.Menu,text:i.Label?.toString(),key:O.generateKeyFromDataField(i),id:S(t,i),visible:le(ne(ce(re(i.annotations?.UI?.Hidden),true))),isAIOperation:j(i.Actions)===true||undefined,menu:i.Actions.map(e=>{const i=a.getManifestControlConfiguration(n).actions;return Ue(e,t,a,i,s)})});break;default:break}return e},e)}return D(e,o)}function Ue(e,t,a,n,i){const o=O.generateKeyFromDataField(e);return{type:M.DataFieldForAction,id:S(t,e),key:O.generateKeyFromDataField(e),text:e.Label?.toString(),annotationPath:"",enabled:K(a,e.ActionTarget),binding:i&&!e.Inline?`{ 'path' : '${i}'}`:undefined,visible:le(ne(ce(re(e.annotations?.UI?.Hidden),true))),requiresDialog:L(e),buttonType:Fe(e.annotations?.UI?.Emphasized),isAIOperation:_(e)===true||undefined,press:le(se("invokeAction",[e.Action,{contexts:se("getBindingContext",[],ee("","$source")),invocationGrouping:e.InvocationGrouping==="UI.OperationGroupingType/ChangeSet"?"ChangeSet":"Isolated",label:e.Label?.toString(),model:se("getModel",[],ee("/","$source")),isNavigable:B(n&&n[o])}],Z(".editFlow"))),facetName:e.Inline?t.fullyQualifiedName:undefined}}function Se(e){if(e){const t=e.annotations?.Common?.IsActionCritical;if(e.parameters.length>1||t){return"Dialog"}else{return"None"}}else{return"None"}}g.isDialog=Se;function Ce(e,t){const a={};Object.keys(e).forEach(n=>a[n]=De(e[n],n,t));return a}g.createCustomSubSections=Ce;function De(e,t,a){const n=e.sideContent?{template:e.sideContent.template,id:U(t),visible:false,equalSplit:e.sideContent.equalSplit}:undefined;let i=e.position;if(!i){i={placement:T.After}}const o=e.visible!==undefined?e.visible:true;const r=o&&typeof o==="string"&&o.indexOf("{=")===0;const s=Q(e.actions,a);s.actions=H(Object.values(s.actions))?.reduce((e,t)=>({...e,[t.key]:t}),{});const c={type:de.Unknown,id:e.id||C(t),actions:s.actions,key:t,title:e.title,level:1,position:i,visible:e.visible!==undefined?e.visible:"true",sideContent:n,isVisibilityDynamic:r,objectPageLazyLoaderEnabled:e.enableLazyLoading??false,componentName:"",settings:"",applyState:e.applyState,retrieveState:e.retrieveState};if(e.template||e.name){c.type=de.XMLFragment;c.template=e.template||e.name||""}else if(e.embeddedComponent!==undefined){c.type=de.EmbeddedComponent;c.componentName=e.embeddedComponent.name;if(e.embeddedComponent.settings!==undefined){c.settings=JSON.stringify(e.embeddedComponent.settings)}}else{c.type=de.Placeholder}return c}g.createCustomSubSection=De;function Te(e,t,a){const n=a.getManifestWrapper();if(n.useIconTabBar()){return ke(e,t)}else{const n=a.getEntityType();if(n.annotations?.UI?.Facets?.length&&n.annotations?.UI?.Facets?.length>1){return ke(e,t)}else{return true}}}function ke(e,t){return t.every(function(t){if(t!==e){if(t.$Type==="com.sap.vocabularies.UI.v1.ReferenceFacet"){const e=t;if(e.Target?.$target?.term==="com.sap.vocabularies.UI.v1.LineItem"||e.Target?.$target?.term==="com.sap.vocabularies.UI.v1.PresentationVariant"||e.Target.$target?.term==="com.sap.vocabularies.UI.v1.SelectionPresentationVariant"){return e.annotations?.UI?.Hidden!==undefined?e.annotations?.UI?.Hidden:false}return true}else{const e=t;return e.Facets.every(function(e){const t=e;if(t.Target?.$target?.term==="com.sap.vocabularies.UI.v1.LineItem"||t.Target?.$target?.term==="com.sap.vocabularies.UI.v1.PresentationVariant"||t.Target?.$target?.term==="com.sap.vocabularies.UI.v1.SelectionPresentationVariant"){return t.annotations?.UI?.Hidden!==undefined?t.annotations?.UI?.Hidden:false}return true})}}return true})}return g},false);
//# sourceMappingURL=SubSection.js.map