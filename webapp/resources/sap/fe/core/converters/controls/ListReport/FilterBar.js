/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)
 *      (c) Copyright 2009-2025 SAP SE. All rights reserved
 */
sap.ui.define(["sap/fe/core/converters/controls/Common/DataVisualization","sap/fe/core/converters/controls/Common/Table","sap/fe/core/converters/controls/Common/table/Columns","sap/fe/core/converters/controls/ListReport/FilterField","sap/fe/core/converters/controls/ListReport/VisualFilters","sap/fe/core/converters/helpers/ConfigurableObject","sap/fe/core/converters/helpers/IssueManager","sap/fe/core/converters/helpers/Key","sap/fe/core/helpers/ModelHelper","sap/fe/core/helpers/TypeGuards","sap/fe/core/templating/DataModelPathHelper","sap/fe/core/templating/PropertyHelper","sap/m/library"],function(t,e,n,a,o,i,r,s,l,c,u,p,f){"use strict";var d={};var g=f.StandardDynamicDateRangeKeys;var h=p.getAssociatedUnitPropertyPath;var y=p.getAssociatedTimezonePropertyPath;var m=p.getAssociatedTextPropertyPath;var v=p.getAssociatedCurrencyPropertyPath;var b=u.getTargetNavigationPath;var P=u.getRelativePaths;var F=u.enhanceDataModelPath;var S=c.isNavigationProperty;var T=c.isMultipleNavigationProperty;var D=c.isEntitySet;var C=c.isComplexType;var E=s.KeyHelper;var O=r.IssueType;var I=r.IssueSeverity;var x=r.IssueCategory;var M=i.insertCustomElements;var N=i.Placement;var R=i.OverrideType;var U=o.getVisualFilters;var A=a.getMaxConditions;var L=n.isFilteringCaseSensitive;var $=n.getTypeConfig;var j=e.getSelectionVariantConfiguration;var k=t.getSelectionVariant;var V=function(t){t["Default"]="Default";t["Slot"]="Slot";return t}(V||{});const w="Edm.String";const q="sap.ui.model.odata.type.String";function H(t){const e={};t.Data.forEach(n=>{if(n.$Type==="com.sap.vocabularies.UI.v1.DataField"){e[n.Value.path]={group:t.fullyQualifiedName,groupLabel:t.Label?.toString()??t.annotations?.Common?.Label?.toString()??t.qualifier}}});return e}function W(t,e){const n=new Set;const a=e.getManifestWrapper().getFilterConfiguration().filterFields??{};const o=new Set([...(e.getDataModelObjectPath().targetEntityType?.annotations?.UI?.SelectionFields??[]).map(t=>t.value),...Object.keys(a).filter(t=>!!a[t].template)]);return new Set(t.map(t=>{const a=t.control.filters;if(!a){return[]}return[...a.hiddenFilters?.paths??[],...a.quickFilters?.paths??[]].map(t=>{const a=t.annotationPath;if(!n.has(a)){n.add(a);const t=j(a,e);if(t){t.propertyNames=t.propertyNames.filter(t=>!o.has(t));return t.propertyNames}}return[]})}).flat(2))}const B=function(t,e){const n=e.split("/");let a;let o="";while(n.length){let e=n.shift();a=a?`${a}/${e}`:e;const i=t.resolvePath(a);if(T(i)){e+="*"}o=o?`${o}/${e}`:e}return o};const K=function(t,e,n,a,o){if(e&&e.targetType===undefined&&(a||e.annotations?.UI?.Hidden?.valueOf()!==true)){const a=o.getAnnotationEntityType(e),i={key:E.getSelectionFieldKeyFromPath(n),annotationPath:o.getAbsoluteAnnotationPath(n),conditionPath:B(t,n),availability:e.annotations?.UI?.HiddenFilter?.valueOf()===true?"Hidden":"Adaptation",label:e.annotations.Common?.Label?.toString()??e.name,group:a.name,groupLabel:a?.annotations?.Common?.Label?.toString()??a.name};G(i);return i}return undefined};const G=function(t){if(t.key==="DraftAdministrativeData::CreationDateTime"||t.key==="DraftAdministrativeData::LastChangeDateTime"){const e=[g.TO,g.TOMORROW,g.NEXTWEEK,g.NEXTMONTH,g.NEXTQUARTER,g.NEXTYEAR];t.settings={operatorConfiguration:[{path:"key",equals:e.join(","),exclude:true}]}}};const X=function(t,e,n,a,o){const i={};if(n){n.forEach(n=>{const r=n.name;const s=(e?`${e}/`:"")+r;const l=K(t,n,s,a,o);if(l){i[s]=l}})}return i};const J=function(t,e,n,a){let o={};if(e){e.forEach(e=>{let i={};const r=F(a.getDataModelObjectPath(),e);const s=r.targetObject;if(s===undefined||!n&&r.navigationProperties.find(t=>t.annotations?.UI?.Hidden?.valueOf()===true)){return}if(S(s)){i=X(t,e,s.targetType.entityProperties,n,a)}else if(C(s.targetType)){i=X(t,e,s.targetType.properties,n,a)}else{i=X(t,b(r,true),[s],n,a)}o={...o,...i}})}return o};const Q=function(t,e,n,a){let o=t[e];if(o){delete t[e]}else{o=K(a,a.resolvePath(e),e,true,n)}if(!o){n.getDiagnostics()?.addIssue(x.Annotation,I.High,O.MISSING_SELECTIONFIELD)}if(o){o.availability=o.availability==="Hidden"?"Hidden":"Default";o.isParameter=!!a.annotations?.Common?.ResultContext}return o};const z=function(t,e,n,a,o){const i=[];const r={};const s=e.entityProperties;o?.forEach(t=>{r[t.value]=true});if(t&&t.length>0){t?.forEach(t=>{const r=t.PropertyName;const s=r?.value;const l={};o?.forEach(t=>{l[t.value]=true});if(s&&!a.has(s)){if(!(s in l)){const t=et(s,n,e);if(t){i.push(t)}}}})}else if(s){s.forEach(t=>{const o=t.annotations?.Common?.FilterDefaultValue;const s=t.name;if(!(s in a)){if(o&&!(s in r)){const t=et(s,n,e);if(t){i.push(t)}}}})}return i};function Y(t){const e=t.getDataModelObjectPath();const n=e.startingEntitySet.entityType;const a=!!n.annotations?.Common?.ResultContext&&!e.targetEntitySet;const o=a&&t.getConverterContextFor(`/${e.startingEntitySet.name}`);return o?n.entityProperties.map(function(t){return Q({},t.name,o,n)}):[]}const _=function(t,e,n){const a=e.length===0||e.every(t=>!t.applySupported.enableSearch);const o=t.length===0||t.every(t=>(t.enableAnalytics||t.control.type==="TreeTable")&&!t.enableBasicSearch);const i=n.getContextPath();if(i&&a&&o){return true}else{return false}};d.getFilterBarHideBasicSearch=_;const Z=function(t,e,n){const a=e.getManifestWrapper();const o=a.getContextPath()||(a.getEntitySet()?`/${a.getEntitySet()}`:undefined);const i=tt(e,o,n);let r={};r=a.getFilterConfiguration(i);const s=r?.filterFields||{};const l=J(t,Object.keys(s).map(t=>s[t].property??E.getPathFromSelectionFieldKey(t)),true,e);const c={};for(const n in s){const a=s[n];const o=a.property??E.getPathFromSelectionFieldKey(n);const i=l[o];const r=a.type==="Slot"?V.Slot:V.Default;const u=a&&a?.visualFilter?U(t,e,n,s):undefined;if(a.template||a.type===V.Slot){if(a.settings){a.settings.isCustomFilter=true}else{a.settings={isCustomFilter:true}}}c[n]={key:n,type:r,slotName:a?.slotName||n,annotationPath:i?.annotationPath,conditionPath:a.property?E.getPathFromSelectionFieldKey(n):i?.conditionPath||o,documentRefText:a.property&&e.fetchTextFromMetaModel("{metaModel>"+a.property+"@com.sap.vocabularies.Common.v1.DocumentationRef}"),template:a.template,label:e.fetchTextFromMetaModel(a.label),position:a.position||{placement:N.After},availability:a.availability||"Default",settings:a.settings,visualFilter:u,required:a.required}}return c};d.getManifestFilterFields=Z;const tt=function(t,e,n){let a;const o=t.getContextPath();const i=`${o}/${n}`;if(e&&i?.startsWith(e)&&n){a=i.replace(`${e}/`,"")}else{a=n}return a?a:undefined};const et=function(t,e,n){return Q({},t,e,n)};d.getFilterField=et;const nt=function(t,e){let n=[];if(t&&t[e]){n=t[e].map(function(t){return t.value})}return n};d.getFilterRestrictions=nt;const at=function(){return{name:"$search",path:"$search",dataType:q,maxConditions:1,label:"â€ˆ",constraints:{maxLength:1e3}}};const ot=function(){return{name:"$editState",maxConditions:1,path:"$editState",groupLabel:"",group:"",dataType:q,hiddenFilter:false}};const it=function(t){const e=t.getEntitySet();return D(e)?e.annotations.Capabilities?.SearchRestrictions:undefined};const rt=function(t,e){const n=t.getEntitySet()?.annotations?.Capabilities?.NavigationRestrictions;const a=n&&n.RestrictedProperties;return a&&a.find(function(t){return t&&t.NavigationProperty&&t.NavigationProperty.value===e})};d.getNavigationRestrictions=rt;const st=function(t){return{key:t.key,annotationPath:t.annotationPath,conditionPath:t.conditionPath,name:t.conditionPath,label:t.label,hiddenFilter:t.availability==="Hidden",display:"Value",isParameter:t.isParameter,caseSensitive:t.caseSensitive,availability:t.availability,position:t.position,type:t.type,template:t.template,menu:t.menu,required:t.required,isCustomFilter:t.settings?.isCustomFilter}};const lt=function(t,e){t.forEach(t=>{if(e.hasOwnProperty(t.key)&&!e[t.key].label){e[t.key].label=t.label}})};const ct=function(t,e){const n=t?.Common?.Text,a=n&&(t&&t?.Common?.Text?.annotations?.UI?.TextArrangement||e&&e?.UI?.TextArrangement);if(a){if(a.valueOf()==="UI.TextArrangementType/TextOnly"){return"Description"}else if(a.valueOf()==="UI.TextArrangementType/TextLast"){return"ValueDescription"}return"DescriptionValue"}return n?"DescriptionValue":"Value"};d.displayMode=ct;const ut=function(t,e,n){let a=st(e);const o=e.annotationPath;if(!o){return a}const i=t.getConverterContextFor(o).getDataModelObjectPath().targetObject;const r=i?.annotations;const s=t?.getDataModelObjectPath().targetObject?.annotations;const l=n.formatOptions;const c=n.constraints;const u=r?.Common?.QuickInfo?.toString();a=Object.assign(a,{formatOptions:l,constraints:c,display:ct(r,s),tooltip:u});return a};d.fetchPropertyInfo=ut;const pt=function(t){let e=true;switch(t.filterExpression){case"SearchExpression":case"SingleRange":case"SingleValue":e=false;break;default:break}if(t.type&&t.type.indexOf("Boolean")>0){e=false}return e};d.isMultiValue=pt;const ft=function(t){return(t.$Type==="com.sap.vocabularies.UI.v1.DataField"||t.$Type==="com.sap.vocabularies.UI.v1.DataFieldWithUrl"||t.$Type==="com.sap.vocabularies.UI.v1.DataFieldWithNavigationPath")&&t.Value.path?.includes("/")};const dt=function(t,e,n){const a=t.Value?.$target;if(a){const t=m(a)||v(a)||h(a)||y(a);const o=t?F(e.getDataModelObjectPath(),t).navigationProperties:undefined;if(o?.length){const t=o[0].name;if(!n.includes(t)){n.push(t)}}}};const gt=function(t,e,n){switch(e.$Type){case"com.sap.vocabularies.UI.v1.DataFieldForAnnotation":if(e.Target?.$target?.$Type==="com.sap.vocabularies.UI.v1.FieldGroupType"){e.Target.$target.Data?.forEach(e=>{gt(t,e,n)})}break;case"com.sap.vocabularies.UI.v1.DataField":case"com.sap.vocabularies.UI.v1.DataFieldWithUrl":case"com.sap.vocabularies.UI.v1.DataFieldWithNavigationPath":if(ft(e)){const a=P(F(n.getDataModelObjectPath(),e.Value.path),true).join("/");if(!t.includes(a)){t.push(a)}}dt(e,n,t);break;default:break}return t};const ht=function(t){let e=arguments.length>1&&arguments[1]!==undefined?arguments[1]:[];let n=arguments.length>2&&arguments[2]!==undefined?arguments[2]:"";let a=arguments.length>3&&arguments[3]!==undefined?arguments[3]:false;let o=arguments.length>4?arguments[4]:undefined;const i=W(e,t);const r=t.getEntityType();const s=n&&t.getEntityTypeAnnotation(n)?.annotation||r.annotations?.UI?.SelectionFields||[];let c=[];if(e.length===0&&!!o){t.getEntityTypeAnnotation(o).annotation?.forEach(e=>{c=gt(c,e,t)})}if(l.isDraftRoot(t.getEntitySet())){c.push("DraftAdministrativeData/CreationDateTime","DraftAdministrativeData/CreatedByUser","DraftAdministrativeData/LastChangeDateTime","DraftAdministrativeData/LastChangedByUser")}const u={...X(r,"",r.entityProperties,a,t),...J(r,c,false,t),...J(r,t.getManifestWrapper().getFilterConfiguration().navigationProperties,a,t)};let p=[];const f=k(r,t);if(f){p=f.SelectOptions}const d=s?.reduce((e,a)=>{const o=a.value;if(!i.has(o)){let a;if(n?.startsWith("@com.sap.vocabularies.UI.v1.SelectionFields")){a=""}else{a=n?.split("/@com.sap.vocabularies.UI.v1.SelectionFields")[0]}const i=a?a+"/"+o:o;const s=Q(u,i,t,r);if(s){s.group="";s.groupLabel="";e.push(s)}}return e},[])||[];const g=z(p,r,t,i,s);return{excludedFilterProperties:i,entityType:r,annotatedSelectionFields:s,filterFields:u,propertyInfoFields:d,defaultFilterFields:g}};const yt=function(t){const e=$(t);if(t?.type===w&&e.constraints?.nullable!==false){e.formatOptions={...e.formatOptions,parseKeepsEmptyString:false}}return e};d.fetchTypeConfig=yt;const mt=function(t,e,n,a){let o=ut(e,t,a[t.key]),i="";if(t.conditionPath){i=t.conditionPath.replace(/\+|\*/g,"")}if(o){o=Object.assign(o,{maxConditions:o.isParameter?1:A(F(e.getDataModelObjectPath(),i)),required:t.required??(o.isParameter||n.includes(i)),caseSensitive:L(e),dataType:a[t.key].type})}return o};d.assignDataTypeToPropertyInfo=mt;const vt=function(t,e,n){const a={};if(n){t=t.concat(n)}t.forEach(function(t){if(t.annotationPath){const n=e.getConverterContextFor(t.annotationPath);const o=n.getDataModelObjectPath().targetObject;const i=yt(o);a[t.key]=i}else{a[t.key]={type:q}}});const o=e.getEntitySet();const i=D(o)?o.annotations.Capabilities?.FilterRestrictions:undefined;const r={};r.RequiredProperties=nt(i,"RequiredProperties")||[];r.NonFilterableProperties=nt(i,"NonFilterableProperties")||[];const s=e.getContextPath();const c=s.split("/");if(c.length>2){const t=c[c.length-1];c.splice(-1,1);const n=rt(e,t);const a=n&&n.FilterRestrictions;r.RequiredProperties=r.RequiredProperties.concat(nt(a,"RequiredProperties")||[]);r.NonFilterableProperties=r.NonFilterableProperties.concat(nt(a,"NonFilterableProperties")||[])}const u=r.RequiredProperties;const p=r.NonFilterableProperties;const f=[];t.forEach(function(t){const n=t.conditionPath.replace(/[+*]/g,"");if(!p.includes(n)){const n=mt(t,e,u,a);f.push(n)}});const d=e.getDataModelObjectPath();const g=e.getManifestWrapper().getSapFeManifestConfiguration()?.app?.hideDraft?.enabled;if(l.isObjectPathDraftSupported(d)){const t=ot();t.hiddenFilter=g||!bt(e);f.push(t)}const h=it(e);const y=Boolean(h&&!h.Searchable);if(s&&y!==true){if(!h||h?.Searchable){f.push(at())}}return f};d.processSelectionFields=vt;const bt=function(t){const e=rt(t,"DraftAdministrativeData");return e?.FilterRestrictions?.Filterable===false?false:true};d.showDraftEditStatus=bt;const Pt=function(t,e,n,a){const o=Z(e,n,a);lt(t,o);return M(t,o,{availability:R.overwrite,label:R.overwrite,type:R.overwrite,position:R.overwrite,slotName:R.overwrite,documentRefText:R.overwrite,template:R.overwrite,settings:R.overwrite,visualFilter:R.overwrite,required:R.overwrite})};d.insertCustomManifestElements=Pt;const Ft=t=>{t.sort(function(t,e){const n=t.groupLabel!==undefined&&t.groupLabel!==null;const a=e.groupLabel!==undefined&&e.groupLabel!==null;if(!n&&!a){return 0}if(n&&!a){return-1}if(!n&&a){return 1}return t.groupLabel.localeCompare(e.groupLabel)})};d.sortPropertyInfosByGroupLabel=Ft;const St=function(t){let e=arguments.length>1&&arguments[1]!==undefined?arguments[1]:[];let n=arguments.length>2&&arguments[2]!==undefined?arguments[2]:"";let a=arguments.length>3?arguments[3]:undefined;let o=arguments.length>4?arguments[4]:undefined;const i=ht(t,e,n,a,o);const r=Y(t);let s=i.propertyInfoFields;const l=i.entityType;s=r.concat(s);s=Pt(s,l,t,n);const c=vt(s,t,i.defaultFilterFields);Ft(c);let u=JSON.stringify(c);u=u.replace(/\{/g,"\\{");u=u.replace(/\}/g,"\\}");const p=u;let f=JSON.parse(JSON.stringify(i.propertyInfoFields));f=r.concat(f);const d=i.excludedFilterProperties;const g=l?.annotations?.UI?.FilterFacets;let h={};const y=t.getAnnotationsByTerm("UI","com.sap.vocabularies.UI.v1.FieldGroup");if(g===undefined||g.length<0){for(const t in y){h={...h,...H(y[t])}}}else{h=g.reduce((t,e)=>{for(let n=0;n<e?.Target?.$target?.Data?.length;n++){t[e?.Target?.$target?.Data[n]?.Value?.path]={group:e?.ID?.toString(),groupLabel:e?.Label?.toString()}}return t},{})}const m=i.filterFields;const v=f.concat(Object.keys(m).filter(t=>!d.has(t)).map(t=>Object.assign(m[t],h[t])));const b=Pt(v,l,t,n);const P=L(t);b.forEach(t=>{t.caseSensitive=P});return{selectionFields:b,sPropertyInfo:p}};d.getSelectionFields=St;const Tt=function(t,e,n){const a=nt(e,"RequiredProperties");const o=it(t);const i=Boolean(o&&!o.Searchable);if(a.length>0||i||n?.FetchValues===2){return true}return false};d.getExpandFilterFields=Tt;return d},false);
//# sourceMappingURL=FilterBar.js.map