{"version":3,"names":["ALLOWED_EXPRESSIONS_PRIORITY","getSpecificAllowedExpression","expressions","sort","a","b","indexOf","getAllowedFilterExpressionForFilterRestictions","propertyName","filterRestictions","fR","FilterExpressionRestrictions","find","fr","Property","value","AllowedExpressions","toString","getAllowedFilterExpressionForProperty","propertyObjectPath","targetEntityType","annotations","Common","ResultContext","valueOf","navProps","navigationProperties","lastNavProp","length","isContainment","containsTarget","targetObject","name","Log","warning","allowedExps","navPropFR","Capabilities","FilterRestrictions","navPropAllowedExp","concat","parentEntitySet","parentNavigationPath","getTargetEntitySetInfo","parentFRAllowedExp","parentNR","NavigationRestrictions","RestrictedProperties","rp","NavigationProperty","parentNRAllowedExp","legacyParenNRtAllowedExp","targetEntitySet","allowedExp","_exports","getMaxConditions","max","allowedExpression","type"],"sourceRoot":".","sources":["FilterField.ts"],"sourcesContent":["import type { NavigationProperty, Property } from \"@sap-ux/vocabularies-types\";\nimport type {\n\tFilterExpressionType,\n\tFilterRestrictions,\n\tFilterRestrictionsType\n} from \"@sap-ux/vocabularies-types/vocabularies/Capabilities\";\nimport type { EntitySetAnnotations_Capabilities } from \"@sap-ux/vocabularies-types/vocabularies/Capabilities_Edm\";\nimport Log from \"sap/base/Log\";\nimport { getTargetEntitySetInfo, type DataModelObjectPath } from \"sap/fe/core/templating/DataModelPathHelper\";\n\nconst ALLOWED_EXPRESSIONS_PRIORITY = [\n\t\"SingleValue\",\n\t\"MultiValue\",\n\t\"SingleRange\",\n\t\"MultiRange\",\n\t\"SearchExpression\",\n\t\"MultiRangeOrSearchExpression\"\n];\n\n/**\n * Get allowed filter expression by priority.\n * @param expressions Allowed filter expressions from different sources.\n * @returns Allowed filter expression\n */\nfunction getSpecificAllowedExpression(expressions: string[]): string {\n\texpressions.sort(function (a: string, b: string) {\n\t\treturn ALLOWED_EXPRESSIONS_PRIORITY.indexOf(a) - ALLOWED_EXPRESSIONS_PRIORITY.indexOf(b);\n\t});\n\n\treturn expressions[0];\n}\n\n/**\n * Get allowed filter expression from filter restrictions.\n * @param propertyName Property name\n * @param filterRestictions Filter restrictions\n * @returns Allowed filter expression\n */\nfunction getAllowedFilterExpressionForFilterRestictions(\n\tpropertyName: string,\n\tfilterRestictions?: FilterRestrictions | FilterRestrictionsType\n): string | undefined {\n\tconst fR = filterRestictions?.FilterExpressionRestrictions?.find((fr) => fr.Property?.value === propertyName);\n\treturn fR?.AllowedExpressions?.toString();\n}\n\n/**\n * Get the allowed filter expression for a property.\n * @param propertyObjectPath Property object path\n * @returns Allowed filter expression\n */\nexport function getAllowedFilterExpressionForProperty<T extends Property>(\n\tpropertyObjectPath: DataModelObjectPath<T>\n): FilterExpressionType | undefined {\n\tif (propertyObjectPath.targetEntityType.annotations.Common?.ResultContext?.valueOf() === true) {\n\t\t// It is a Parameter\n\t\treturn \"SingleValue\";\n\t}\n\n\tconst navProps = propertyObjectPath.navigationProperties as NavigationProperty[];\n\tconst lastNavProp = navProps[navProps.length - 1];\n\tconst isContainment = lastNavProp?.containsTarget;\n\tconst propertyName = propertyObjectPath.targetObject?.name;\n\tif (!propertyName) {\n\t\tLog.warning(`Property name not found!`);\n\t\treturn;\n\t}\n\tlet allowedExps: string[] = [];\n\tif (lastNavProp) {\n\t\t// Allowed Exp at parent navigation property\n\t\tconst navPropFR = (lastNavProp.annotations.Capabilities as EntitySetAnnotations_Capabilities)?.FilterRestrictions;\n\t\tconst navPropAllowedExp = getAllowedFilterExpressionForFilterRestictions(propertyName, navPropFR);\n\t\tallowedExps = allowedExps.concat(navPropAllowedExp ? [navPropAllowedExp] : []);\n\n\t\tconst { parentEntitySet, parentNavigationPath } = getTargetEntitySetInfo(propertyObjectPath);\n\n\t\t// Allowed Exp at parent entitySet.\n\t\tconst parentFRAllowedExp = getAllowedFilterExpressionForFilterRestictions(\n\t\t\t`${parentNavigationPath}/${propertyName}`,\n\t\t\t(parentEntitySet?.annotations.Capabilities as EntitySetAnnotations_Capabilities)?.FilterRestrictions\n\t\t);\n\t\tallowedExps = allowedExps.concat(parentFRAllowedExp ? [parentFRAllowedExp] : []);\n\n\t\t// Allowed Exp at parent entitySet Nav Restrictions.\n\t\tconst parentNR = parentEntitySet?.annotations.Capabilities?.NavigationRestrictions?.RestrictedProperties.find(\n\t\t\t(rp) => rp.NavigationProperty.value === parentNavigationPath\n\t\t);\n\t\t// New way property name in restriction is expected to have navigation path at the start of it.\n\t\tconst parentNRAllowedExp = getAllowedFilterExpressionForFilterRestictions(\n\t\t\t`${parentNavigationPath}/${propertyName}`,\n\t\t\tparentNR?.FilterRestrictions\n\t\t);\n\t\tallowedExps = allowedExps.concat(parentNRAllowedExp ? [parentNRAllowedExp] : []);\n\n\t\t// Old way property name in restriction is relative to navigation path of the navigation restriction.\n\t\tconst legacyParenNRtAllowedExp = getAllowedFilterExpressionForFilterRestictions(propertyName, parentNR?.FilterRestrictions);\n\t\tallowedExps = allowedExps.concat(legacyParenNRtAllowedExp ? [legacyParenNRtAllowedExp] : []);\n\t}\n\n\t// Allowed Exp at target entitySet.\n\tif (!isContainment && propertyObjectPath.targetEntitySet) {\n\t\tconst targetEntitySet = propertyObjectPath.targetEntitySet;\n\t\tconst filterRestictions = (targetEntitySet.annotations.Capabilities as EntitySetAnnotations_Capabilities)?.FilterRestrictions;\n\n\t\tconst allowedExp = getAllowedFilterExpressionForFilterRestictions(propertyName, filterRestictions);\n\t\tallowedExps = allowedExps.concat(allowedExp ? [allowedExp] : []);\n\t}\n\treturn getSpecificAllowedExpression(allowedExps);\n}\n\n/**\n * Checks the maximum number of filter conditions for a property.\n * @param propertyObjectPath Property object path\n * @returns The number of maximum allowed conditions or -1 if there is no limit.\n */\nexport function getMaxConditions<T extends Property>(propertyObjectPath: DataModelObjectPath<T>): number {\n\tlet max = -1;\n\n\tconst allowedExpression = getAllowedFilterExpressionForProperty(propertyObjectPath);\n\tif (\n\t\tpropertyObjectPath.targetObject?.type === \"Edm.Boolean\" ||\n\t\tallowedExpression === \"SingleValue\" ||\n\t\tallowedExpression === \"SingleRange\"\n\t) {\n\t\tmax = 1;\n\t}\n\n\treturn max;\n}\n"],"mappings":"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","ignoreList":[],"file":"FilterField-dbg.js"}