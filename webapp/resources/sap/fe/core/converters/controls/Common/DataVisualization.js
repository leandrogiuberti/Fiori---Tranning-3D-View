/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)
 *      (c) Copyright 2009-2025 SAP SE. All rights reserved
 */
sap.ui.define(["sap/fe/core/converters/MetaModelConverter","sap/fe/core/converters/helpers/IssueManager","sap/fe/core/helpers/TypeGuards","../../ManifestSettings","./Chart","./Table"],function(t,e,n,a,i,o){"use strict";var r={};var s=i.createChartVisualizationForTemplating;var c=i.createChartVisualization;var l=i.createBlankChartVisualization;var u=a.VisualizationType;var f=a.TemplateType;var v=n.isAnnotationOfType;var p=e.IssueType;var m=e.IssueSeverity;var d=e.IssueCategory;const V=function(t,e,n,a){const{presentation:i,selectionVariant:o}=v(t,"com.sap.vocabularies.UI.v1.PresentationVariantType")?{presentation:t,selectionVariant:undefined}:{presentation:t.PresentationVariant,selectionVariant:t.SelectionVariant};const r=[];const s=E(n);const c=!s&&!(n.getTemplateType()===f.ListReport&&!a)?o:undefined;const l=e.split("@")[0];if((a===true||s)&&!P(i,s)){if(!L(i,"com.sap.vocabularies.UI.v1.LineItem")){const t=$("com.sap.vocabularies.UI.v1.LineItem",l,n);if(t){r.push({...t,...{selectionVariant:c}})}}if(!L(i,"com.sap.vocabularies.UI.v1.Chart")){const t=$("com.sap.vocabularies.UI.v1.Chart",l,n);if(t){r.push(t)}}}const u=i.Visualizations;const p=function(t){const e=u?.find(e=>e.$target!==undefined&&t.includes(e.$target.term));if(e){r.push({visualization:e.$target,annotationPath:`${l}${e.value}`,converterContext:n,selectionVariant:c})}};if(s){p(["com.sap.vocabularies.UI.v1.LineItem"]);p(["com.sap.vocabularies.UI.v1.Chart"])}else{p(["com.sap.vocabularies.UI.v1.LineItem","com.sap.vocabularies.UI.v1.Chart"])}return r};r.getVisualizationsFromAnnotation=V;function I(t,e,n){if(e){const t=n.getEntityTypeAnnotation(e);const a=t.annotation;if(a){if(a.term==="com.sap.vocabularies.UI.v1.SelectionPresentationVariant"){return a}}else{throw new Error("Annotation Path for the SPV mentioned in the manifest is not found, Please add the SPV in the annotation")}}else{return t.annotations?.UI?.SelectionPresentationVariant}}r.getSelectionPresentationVariant=I;function h(t,e){const n=t&&t.PresentationVariant;if(n){return P(n,e)}else{throw new Error("Presentation Variant is not present in the SPV annotation")}}r.isSelectionPresentationCompliant=h;function P(t){let e=arguments.length>1&&arguments[1]!==undefined?arguments[1]:false;let n=false,a=false;if(e){if(t?.Visualizations){const e=t.Visualizations;e.forEach(t=>{if(t.$target?.term==="com.sap.vocabularies.UI.v1.LineItem"){n=true}if(t.$target?.term==="com.sap.vocabularies.UI.v1.Chart"){a=true}})}return a&&n}else{return t?.Visualizations&&!!t.Visualizations.find(t=>t.$target?.term==="com.sap.vocabularies.UI.v1.LineItem"||t.$target?.term==="com.sap.vocabularies.UI.v1.Chart")}}r.isPresentationCompliant=P;function g(t){return t.annotations.UI?.LineItem}r.getDefaultLineItem=g;function b(t){return t.annotations.UI?.Chart}r.getDefaultChart=b;function C(t){return t.annotations?.UI?.SelectionVariant}r.getDefaultSelectionVariant=C;function y(t,e){const n=e.getManifestWrapper().getDefaultTemplateAnnotationPath();const a=I(t,n,e);let i;if(a){i=a.SelectionVariant;if(i){return i}}else{i=C(t);return i}}r.getSelectionVariant=y;function U(t,e,n){const{annotation:a,converterContext:i}=t;const o=a?.term;let r=[];if(o){switch(o){case"com.sap.vocabularies.UI.v1.LineItem":case"com.sap.vocabularies.UI.v1.Chart":r.push({visualization:a,annotationPath:e,converterContext:i});break;case"com.sap.vocabularies.UI.v1.PresentationVariant":case"com.sap.vocabularies.UI.v1.SelectionPresentationVariant":r=r.concat(V(a,e,i,n));break;default:break}}return r}function T(t,e){if(t===""){return undefined}const n=e.getEntityTypeAnnotation(t).annotation;if(v(n,"com.sap.vocabularies.UI.v1.SelectionPresentationVariantType")){return n.PresentationVariant}else if(n.term==="com.sap.vocabularies.UI.v1.PresentationVariant"){return n}return undefined}function S(t,e,n){const{isCondensedTableLayoutCompliant:a,doNotCheckApplySupported:i,associatedSelectionVariant:r,isMacroOrMultipleView:u,shouldCreateTemplateChartVisualization:f}=n;const V=t!==""?e.getEntityTypeAnnotation(t):{annotation:undefined,converterContext:e};const I=V.annotation;let h,P;const g=I?.term;for(const n of U(V,t,u)){const{visualization:l,annotationPath:u,converterContext:p,selectionVariant:m}=n;switch(l.term){case"com.sap.vocabularies.UI.v1.Chart":h=f?s(p,u,l):c(l,u,p,i,v(I,"com.sap.vocabularies.UI.v1.SelectionPresentationVariantType")?t:undefined);break;case"com.sap.vocabularies.UI.v1.LineItem":default:P=o.createTableVisualization(l,u,p,{presentationVariantAnnotation:T(t,e),selectionVariantAnnotation:r??m,isCondensedTableLayoutCompliant:a});break}}e=V.converterContext;const b=E(e);if(!g||b&&P===undefined){P=o.createDefaultTableVisualization(e,u!==true);e.getDiagnostics().addIssue(d.Annotation,m.Medium,p.MISSING_LINEITEM)}if(b&&h===undefined){h=l(e);e.getDiagnostics().addIssue(d.Annotation,m.Medium,p.MISSING_CHART)}return{visualizations:[h,P].filter(z),annotationPath:e.getEntitySetBasedAnnotationPath(I?.fullyQualifiedName??"/"),associatedSelectionVariantPath:n.associatedSelectionVariant?e.getEntitySetBasedAnnotationPath(n.associatedSelectionVariant.fullyQualifiedName):undefined}}r.getDataVisualizationConfiguration=S;function z(t){return[u.Table,u.Chart].includes(t?.type)}function A(t,e){if(t.includes(e.slice(0,e.lastIndexOf(".")))){const n=["com.sap.vocabularies.UI.v1.PresentationVariant","com.sap.vocabularies.UI.v1.SelectionPresentationVariant",e];if(!n.some(e=>t.search(new RegExp(`${e}(#|/|$)`))>-1)){throw new Error(`Annotation Path ${t} mentioned in the manifest is not valid for ${e}`)}}}r.validatePresentationMetaPath=A;function M(e,n){A(e.getPath(),n);const a=t.convertMetaModelContext(e),i=e.getModel();if(a){if(v(a,"com.sap.vocabularies.UI.v1.SelectionPresentationVariantType")||v(a,"com.sap.vocabularies.UI.v1.PresentationVariantType")){let t;if(v(a,"com.sap.vocabularies.UI.v1.SelectionPresentationVariantType")&&a.PresentationVariant){t=a.PresentationVariant.Visualizations}else if(v(a,"com.sap.vocabularies.UI.v1.PresentationVariantType")){t=a.Visualizations}if(Array.isArray(t)){for(const a of t){if(a.type=="AnnotationPath"&&a.value.includes(n)&&!!i.getMetaContext(e.getPath().split("@")[0]+a.value).getObject()){n=a.value;break}}}}else{return e}}return i.getMetaContext(e.getPath().split("@")[0]+n)}r.getUiControl=M;const L=function(t,e){return t.Visualizations?.some(t=>t.value.includes(e))??false};r.annotationExistsInPresentationVariant=L;const $=function(t,e,n){const a=n.getEntityType();const i=t==="com.sap.vocabularies.UI.v1.LineItem"?g(a):b(a);if(i){return{visualization:i,annotationPath:`${e}${n.getRelativeAnnotationPath(i.fullyQualifiedName,a)}`,converterContext:n}}return undefined};const E=function(t){return t.getManifestWrapper().hasMultipleVisualizations()||t.getTemplateType()===f.AnalyticalListPage};r.isAlpAnnotation=E;return r},false);
//# sourceMappingURL=DataVisualization.js.map