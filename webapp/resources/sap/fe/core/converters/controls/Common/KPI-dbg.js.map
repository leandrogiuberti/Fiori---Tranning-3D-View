{"version":3,"names":["DeviationIndicatorFromTrendType","KPIChartTypeFromUI","convertKPIChart","chartAnnotation","presentationVariantAnnotation","converterContext","Measures","undefined","charDimensions","Dimensions","map","propertyPath","dimAttribute","DimensionAttributes","find","attribute","Dimension","value","dimensionDefinition","name","label","$target","annotations","Common","Label","toString","role","Role","replace","dimensionProperty","enhanceDataModelPath","getDataModelObjectPath","targetObject","Text","text","getAssociatedTextPropertyPath","textArrangement","UI","TextArrangement","chartMeasures","measureAttribute","MeasureAttributes","Measure","chartDefinition","chartType","ChartType","dimensions","measures","sortOrder","SortOrder","Property","descending","Descending","maxItems","MaxItems","valueOf","chartTitle","Title","title","updateCurrency","datapointAnnotation","kpiDef","targetValueProperty","Value","ISOCurrency","currency","isPathAnnotationExpression","datapoint","unit","isCurrency","isPath","Unit","updateCriticality","aggregationHelper","Criticality","criticalityProperty","isPropertyAggregatable","criticalityPath","path","criticalityValue","MessageType","None","getMessageTypeFromCriticalityType","CriticalityCalculation","criticalityCalculationMode","ImprovementDirection","criticalityCalculationThresholds","push","DeviationRangeLowValue","ToleranceRangeLowValue","AcceptanceRangeLowValue","AcceptanceRangeHighValue","ToleranceRangeHighValue","DeviationRangeHighValue","updateTrend","Trend","trendProperty","trendPath","trendValue","TrendCalculation","trendCalculationIsRelative","IsRelativeDifference","ReferenceValue","referenceProperty","trendCalculationReferencePath","trendCalculationReferenceValue","trendCalculationTresholds","StrongDownDifference","DownDifference","UpDifference","StrongUpDifference","updateTarget","TargetValue","targetProperty","targetPath","targetValue","getNavigationInfoFromProperty","property","semanticObjectAnnotation","Object","keys","forEach","annotationKey","annotation","isAnnotationOfTerm","qualifier","result","semanticObject","unavailableActions","key","isCustomKPIConfiguration","kpiConfig","template","createAnalyticalKPIDefinition","kpiName","contextPath","entitySet","kpiConverterContext","getConverterContextFor","AggregationHelper","getEntityType","isAnalyticsSupported","getDiagnostics","addIssue","IssueCategory","Annotation","IssueSeverity","Medium","IssueType","KPI_ISSUES","NO_ANALYTICS","selectionVariantAnnotation","navigationInfo","aKPIAnnotations","getAnnotationsByTerm","targetKPI","kpi","DataPoint","SelectionVariant","Detail","DefaultPresentationVariant","Visualizations","viz","isAnnotationOfType","SemanticObject","action","Action","aSPVAnnotations","targetSPV","spv","PresentationVariant","KPI_NOT_FOUND","KPI_DETAIL_NOT_FOUND","datapointProperty","MAIN_PROPERTY_NOT_AGGREGATABLE","chartDef","type","id","getKPIID","annotationPath","getEntitySetBasedAnnotationPath","fullyQualifiedName","description","Description","selectionVariantFilterDefinitions","getFilterDefinitionsFromSelectionVariant","chart","ValueFormat","NumberOfFractionalDigits","numberOfFractionalDigits","detailNavigation","outboundNavigation","navigation","createKPIDefinition","getKPIDefinitions","kpiConfigs","getManifestWrapper","getKPIConfiguration","kpiDefs","oDef","_exports"],"sourceRoot":".","sources":["KPI.ts"],"sourcesContent":["import type { Property } from \"@sap-ux/vocabularies-types\";\nimport type { SemanticObject } from \"@sap-ux/vocabularies-types/vocabularies/Common\";\nimport { CommonAnnotationTerms } from \"@sap-ux/vocabularies-types/vocabularies/Common\";\nimport type {\n\tChart,\n\tCriticalityType,\n\tDataPoint,\n\tDataPointType,\n\tImprovementDirectionType,\n\tKPI,\n\tPresentationVariantType,\n\tSelectionPresentationVariant,\n\tSelectionVariantType\n} from \"@sap-ux/vocabularies-types/vocabularies/UI\";\nimport { UIAnnotationTerms, UIAnnotationTypes } from \"@sap-ux/vocabularies-types/vocabularies/UI\";\nimport type ConverterContext from \"sap/fe/core/converters/ConverterContext\";\nimport type { PageContextPathTarget } from \"sap/fe/core/converters/TemplateConverter\";\nimport { IssueCategory, IssueSeverity, IssueType } from \"sap/fe/core/converters/helpers/IssueManager\";\nimport type { FilterDefinition } from \"sap/fe/core/converters/helpers/SelectionVariantHelper\";\nimport { getFilterDefinitionsFromSelectionVariant } from \"sap/fe/core/converters/helpers/SelectionVariantHelper\";\nimport { isAnnotationOfTerm, isAnnotationOfType, isPathAnnotationExpression } from \"sap/fe/core/helpers/TypeGuards\";\nimport { enhanceDataModelPath } from \"sap/fe/core/templating/DataModelPathHelper\";\nimport { getAssociatedTextPropertyPath } from \"sap/fe/core/templating/PropertyHelper\";\nimport MessageType from \"sap/ui/core/message/MessageType\";\nimport type { AnalyticalKPIConfiguration, CustomKPIConfiguration, KPIConfiguration } from \"../../ManifestSettings\";\nimport { AggregationHelper } from \"../../helpers/Aggregation\";\nimport { getKPIID } from \"../../helpers/ID\";\nimport { getMessageTypeFromCriticalityType } from \"./Criticality\";\n\nexport type NavigationInfo = {\n\tsemanticObject?: string;\n\taction?: string;\n\tunavailableActions?: string[];\n\toutboundNavigation?: string;\n};\n\ntype DimensionDefinition = {\n\tname: string;\n\ttext?: string;\n\ttextArrangement?: \"TextFirst\" | \"TextLast\" | \"TextOnly\" | \"TextSeparate\";\n\tlabel: string;\n\trole?: string;\n};\n\nexport type KPIChartDefinition = {\n\tchartType: string;\n\ttitle?: string;\n\tdimensions: DimensionDefinition[];\n\tmeasures: { name: string; label: string; role?: string }[];\n\tsortOrder?: { name: string; descending: boolean }[];\n\tmaxItems?: number;\n};\n\nexport type AnalyticalKPIDefinition = {\n\ttype: \"Analytical\";\n\tid: string;\n\tcontextPath: string;\n\tdatapoint: {\n\t\tannotationPath: string;\n\t\tpropertyPath: string;\n\t\tnumberOfFractionalDigits?: number;\n\t\tunit?: {\n\t\t\tvalue: string;\n\t\t\tisPath: boolean;\n\t\t\tisCurrency: boolean;\n\t\t};\n\t\tcriticalityPath?: string;\n\t\tcriticalityValue?: MessageType;\n\t\tcriticalityCalculationMode?: ImprovementDirectionType;\n\t\tcriticalityCalculationThresholds?: (number | undefined | null)[];\n\t\ttitle?: string;\n\t\tdescription?: string;\n\t\ttrendPath?: string;\n\t\ttrendValue?: string;\n\t\ttrendCalculationReferenceValue?: number;\n\t\ttrendCalculationReferencePath?: string;\n\t\ttrendCalculationTresholds?: (number | undefined | null)[];\n\t\ttrendCalculationIsRelative?: boolean;\n\t\ttargetValue?: number;\n\t\ttargetPath?: string;\n\t};\n\tchart: KPIChartDefinition;\n\tselectionVariantFilterDefinitions?: FilterDefinition[];\n\tnavigation?: NavigationInfo;\n};\n\nexport type CustomKPIDefinition = {\n\ttype: \"Custom\";\n\tkey: string;\n\ttemplate: string;\n};\nexport type KPIDefinition = AnalyticalKPIDefinition | CustomKPIDefinition;\n\nconst DeviationIndicatorFromTrendType: Record<string, string> = {\n\t\"UI.TrendType/StrongUp\": \"Up\",\n\t\"UI.TrendType/Up\": \"Up\",\n\t\"UI.TrendType/StrongDown\": \"Down\",\n\t\"UI.TrendType/Down\": \"Down\",\n\t\"UI.TrendType/Sideways\": \"None\"\n};\n\nconst KPIChartTypeFromUI: Record<string, string> = {\n\t\"UI.ChartType/ColumnStacked\": \"StackedColumn\",\n\t\"UI.ChartType/BarStacked\": \"StackedBar\",\n\t\"UI.ChartType/Donut\": \"Donut\",\n\t\"UI.ChartType/Line\": \"Line\",\n\t\"UI.ChartType/Bubble\": \"bubble\",\n\t\"UI.ChartType/Column\": \"column\",\n\t\"UI.ChartType/Bar\": \"bar\",\n\t\"UI.ChartType/VerticalBullet\": \"vertical_bullet\",\n\t\"UI.ChartType/Combination\": \"combination\",\n\t\"UI.ChartType/Scatter\": \"scatter\"\n};\n\nfunction convertKPIChart(\n\tchartAnnotation: Chart,\n\tpresentationVariantAnnotation: PresentationVariantType,\n\tconverterContext: ConverterContext<PageContextPathTarget>\n): KPIChartDefinition | undefined {\n\tif (chartAnnotation.Measures === undefined) {\n\t\t// We need at least 1 measure (but no dimension is allowed, e.g. for bubble chart)\n\t\treturn undefined;\n\t}\n\n\tconst charDimensions = chartAnnotation.Dimensions\n\t\t? chartAnnotation.Dimensions.map((propertyPath) => {\n\t\t\t\tconst dimAttribute = chartAnnotation.DimensionAttributes?.find((attribute) => {\n\t\t\t\t\treturn attribute.Dimension?.value === propertyPath.value;\n\t\t\t\t});\n\n\t\t\t\tconst dimensionDefinition: DimensionDefinition = {\n\t\t\t\t\tname: propertyPath.value,\n\t\t\t\t\tlabel: propertyPath.$target?.annotations.Common?.Label?.toString() || propertyPath.value,\n\t\t\t\t\trole: dimAttribute?.Role?.replace(\"UI.ChartDimensionRoleType/\", \"\")\n\t\t\t\t};\n\n\t\t\t\tconst dimensionProperty = enhanceDataModelPath<Property>(\n\t\t\t\t\tconverterContext.getDataModelObjectPath(),\n\t\t\t\t\tpropertyPath.value\n\t\t\t\t).targetObject;\n\t\t\t\tif (dimensionProperty?.annotations.Common?.Text) {\n\t\t\t\t\tdimensionDefinition.text = getAssociatedTextPropertyPath(dimensionProperty);\n\t\t\t\t\tdimensionDefinition.textArrangement =\n\t\t\t\t\t\t(dimensionProperty.annotations.Common.Text.annotations?.UI?.TextArrangement?.toString().replace(\n\t\t\t\t\t\t\t\"UI.TextArrangementType/\",\n\t\t\t\t\t\t\t\"\"\n\t\t\t\t\t\t) ?? \"TextFirst\") as \"TextFirst\" | \"TextLast\" | \"TextOnly\" | \"TextSeparate\";\n\t\t\t\t}\n\n\t\t\t\treturn dimensionDefinition;\n\t\t  })\n\t\t: [];\n\n\tconst chartMeasures = chartAnnotation.Measures.map((propertyPath) => {\n\t\tconst measureAttribute = chartAnnotation.MeasureAttributes?.find((attribute) => {\n\t\t\treturn attribute.Measure?.value === propertyPath.value;\n\t\t});\n\t\treturn {\n\t\t\tname: propertyPath.value,\n\t\t\tlabel: propertyPath.$target?.annotations.Common?.Label?.toString() || propertyPath.value,\n\t\t\trole: measureAttribute?.Role?.replace(\"UI.ChartMeasureRoleType/\", \"\")\n\t\t};\n\t});\n\n\tconst chartDefinition: KPIChartDefinition = {\n\t\tchartType: KPIChartTypeFromUI[chartAnnotation.ChartType] || \"Line\",\n\t\tdimensions: charDimensions,\n\t\tmeasures: chartMeasures,\n\t\tsortOrder: presentationVariantAnnotation?.SortOrder?.map((sortOrder) => {\n\t\t\treturn { name: sortOrder.Property?.value || \"\", descending: !!sortOrder.Descending };\n\t\t}),\n\t\tmaxItems: presentationVariantAnnotation?.MaxItems?.valueOf() as number\n\t};\n\n\tconst chartTitle = chartAnnotation.Title?.valueOf();\n\tif (chartTitle !== undefined) {\n\t\tchartDefinition.title = chartTitle;\n\t}\n\n\treturn chartDefinition;\n}\n\nfunction updateCurrency(datapointAnnotation: DataPointType, kpiDef: AnalyticalKPIDefinition): void {\n\tconst targetValueProperty = datapointAnnotation.Value.$target as Property;\n\tif (targetValueProperty.annotations.Measures?.ISOCurrency) {\n\t\tconst currency = targetValueProperty.annotations.Measures?.ISOCurrency;\n\t\tif (isPathAnnotationExpression(currency)) {\n\t\t\tkpiDef.datapoint.unit = {\n\t\t\t\tvalue: (currency.$target as unknown as Property).name,\n\t\t\t\tisCurrency: true,\n\t\t\t\tisPath: true\n\t\t\t};\n\t\t} else {\n\t\t\tkpiDef.datapoint.unit = {\n\t\t\t\tvalue: currency.toString(),\n\t\t\t\tisCurrency: true,\n\t\t\t\tisPath: false\n\t\t\t};\n\t\t}\n\t} else if (targetValueProperty.annotations.Measures?.Unit) {\n\t\tconst unit = targetValueProperty.annotations.Measures?.Unit;\n\t\tif (isPathAnnotationExpression(unit)) {\n\t\t\tkpiDef.datapoint.unit = {\n\t\t\t\tvalue: (unit.$target as unknown as Property).name,\n\t\t\t\tisCurrency: false,\n\t\t\t\tisPath: true\n\t\t\t};\n\t\t} else {\n\t\t\tkpiDef.datapoint.unit = {\n\t\t\t\tvalue: unit.toString(),\n\t\t\t\tisCurrency: false,\n\t\t\t\tisPath: false\n\t\t\t};\n\t\t}\n\t}\n}\n\nfunction updateCriticality(\n\tdatapointAnnotation: DataPointType,\n\taggregationHelper: AggregationHelper,\n\tkpiDef: AnalyticalKPIDefinition\n): void {\n\tif (datapointAnnotation.Criticality) {\n\t\tif (isPathAnnotationExpression(datapointAnnotation.Criticality)) {\n\t\t\t// Criticality is a path --> check if the corresponding property is aggregatable\n\t\t\tconst criticalityProperty = datapointAnnotation.Criticality.$target;\n\t\t\tif (criticalityProperty && aggregationHelper.isPropertyAggregatable(criticalityProperty)) {\n\t\t\t\tkpiDef.datapoint.criticalityPath = datapointAnnotation.Criticality.path;\n\t\t\t} else {\n\t\t\t\t// The property isn't aggregatable --> we ignore it\n\t\t\t\tkpiDef.datapoint.criticalityValue = MessageType.None;\n\t\t\t}\n\t\t} else {\n\t\t\t// Criticality is an enum Value --> get the corresponding static value\n\t\t\t// We ignore all the other type of dynamic expressions for now\n\t\t\tkpiDef.datapoint.criticalityValue = getMessageTypeFromCriticalityType(\n\t\t\t\tdatapointAnnotation.Criticality as unknown as CriticalityType\n\t\t\t);\n\t\t}\n\t} else if (datapointAnnotation.CriticalityCalculation) {\n\t\tkpiDef.datapoint.criticalityCalculationMode = datapointAnnotation.CriticalityCalculation.ImprovementDirection;\n\t\tkpiDef.datapoint.criticalityCalculationThresholds = [];\n\t\tswitch (kpiDef.datapoint.criticalityCalculationMode) {\n\t\t\tcase \"UI.ImprovementDirectionType/Target\":\n\t\t\t\tkpiDef.datapoint.criticalityCalculationThresholds.push(datapointAnnotation.CriticalityCalculation.DeviationRangeLowValue);\n\t\t\t\tkpiDef.datapoint.criticalityCalculationThresholds.push(datapointAnnotation.CriticalityCalculation.ToleranceRangeLowValue);\n\t\t\t\tkpiDef.datapoint.criticalityCalculationThresholds.push(datapointAnnotation.CriticalityCalculation.AcceptanceRangeLowValue);\n\t\t\t\tkpiDef.datapoint.criticalityCalculationThresholds.push(datapointAnnotation.CriticalityCalculation.AcceptanceRangeHighValue);\n\t\t\t\tkpiDef.datapoint.criticalityCalculationThresholds.push(datapointAnnotation.CriticalityCalculation.ToleranceRangeHighValue);\n\t\t\t\tkpiDef.datapoint.criticalityCalculationThresholds.push(datapointAnnotation.CriticalityCalculation.DeviationRangeHighValue);\n\t\t\t\tbreak;\n\n\t\t\tcase \"UI.ImprovementDirectionType/Minimize\":\n\t\t\t\tkpiDef.datapoint.criticalityCalculationThresholds.push(datapointAnnotation.CriticalityCalculation.AcceptanceRangeHighValue);\n\t\t\t\tkpiDef.datapoint.criticalityCalculationThresholds.push(datapointAnnotation.CriticalityCalculation.ToleranceRangeHighValue);\n\t\t\t\tkpiDef.datapoint.criticalityCalculationThresholds.push(datapointAnnotation.CriticalityCalculation.DeviationRangeHighValue);\n\t\t\t\tbreak;\n\n\t\t\tcase \"UI.ImprovementDirectionType/Maximize\":\n\t\t\tdefault:\n\t\t\t\tkpiDef.datapoint.criticalityCalculationThresholds.push(datapointAnnotation.CriticalityCalculation.DeviationRangeLowValue);\n\t\t\t\tkpiDef.datapoint.criticalityCalculationThresholds.push(datapointAnnotation.CriticalityCalculation.ToleranceRangeLowValue);\n\t\t\t\tkpiDef.datapoint.criticalityCalculationThresholds.push(datapointAnnotation.CriticalityCalculation.AcceptanceRangeLowValue);\n\t\t}\n\t} else {\n\t\tkpiDef.datapoint.criticalityValue = MessageType.None;\n\t}\n}\n\nfunction updateTrend(datapointAnnotation: DataPointType, aggregationHelper: AggregationHelper, kpiDef: AnalyticalKPIDefinition): void {\n\tif (datapointAnnotation.Trend) {\n\t\tif (isPathAnnotationExpression(datapointAnnotation.Trend)) {\n\t\t\t// Trend is a path --> check if the corresponding property is aggregatable\n\t\t\tconst trendProperty = datapointAnnotation.Trend.$target;\n\t\t\tif (trendProperty && aggregationHelper.isPropertyAggregatable(trendProperty)) {\n\t\t\t\tkpiDef.datapoint.trendPath = datapointAnnotation.Trend.path;\n\t\t\t} else {\n\t\t\t\t// The property isn't aggregatable --> we ignore it\n\t\t\t\tkpiDef.datapoint.trendValue = \"None\";\n\t\t\t}\n\t\t} else {\n\t\t\t// Trend is an enum Value --> get the corresponding static value\n\t\t\tkpiDef.datapoint.trendValue = DeviationIndicatorFromTrendType[datapointAnnotation.Trend] || \"None\";\n\t\t}\n\t} else if (datapointAnnotation.TrendCalculation) {\n\t\tkpiDef.datapoint.trendCalculationIsRelative = datapointAnnotation.TrendCalculation.IsRelativeDifference ? true : false;\n\t\tif (datapointAnnotation.TrendCalculation.ReferenceValue.$target) {\n\t\t\t// Reference value is a path --> check if the corresponding property is aggregatable\n\t\t\tconst referenceProperty = datapointAnnotation.TrendCalculation.ReferenceValue.$target as Property;\n\t\t\tif (aggregationHelper.isPropertyAggregatable(referenceProperty)) {\n\t\t\t\tkpiDef.datapoint.trendCalculationReferencePath = datapointAnnotation.TrendCalculation.ReferenceValue.path;\n\t\t\t} else {\n\t\t\t\t// The property isn't aggregatable --> we ignore it and switch back to trend 'None'\n\t\t\t\tkpiDef.datapoint.trendValue = \"None\";\n\t\t\t}\n\t\t} else {\n\t\t\t// Reference value is a static value\n\t\t\tkpiDef.datapoint.trendCalculationReferenceValue = datapointAnnotation.TrendCalculation.ReferenceValue;\n\t\t}\n\t\tif (kpiDef.datapoint.trendCalculationReferencePath !== undefined || kpiDef.datapoint.trendCalculationReferenceValue !== undefined) {\n\t\t\tkpiDef.datapoint.trendCalculationTresholds = [\n\t\t\t\tdatapointAnnotation.TrendCalculation.StrongDownDifference.valueOf(),\n\t\t\t\tdatapointAnnotation.TrendCalculation.DownDifference.valueOf(),\n\t\t\t\tdatapointAnnotation.TrendCalculation.UpDifference.valueOf(),\n\t\t\t\tdatapointAnnotation.TrendCalculation.StrongUpDifference.valueOf()\n\t\t\t];\n\t\t}\n\t} else {\n\t\tkpiDef.datapoint.trendValue = \"None\";\n\t}\n}\n\nfunction updateTarget(datapointAnnotation: DataPointType, aggregationHelper: AggregationHelper, kpiDef: AnalyticalKPIDefinition): void {\n\tif (datapointAnnotation.TargetValue) {\n\t\tif (datapointAnnotation.TargetValue.$target) {\n\t\t\t// Target value is a path --> check if the corresponding property is aggregatable (otherwise ignore)\n\t\t\tconst targetProperty = datapointAnnotation.TargetValue.$target as Property;\n\t\t\tif (aggregationHelper.isPropertyAggregatable(targetProperty)) {\n\t\t\t\tkpiDef.datapoint.targetPath = datapointAnnotation.TargetValue.path;\n\t\t\t}\n\t\t} else {\n\t\t\t// Target value is a static value\n\t\t\tkpiDef.datapoint.targetValue = datapointAnnotation.TargetValue;\n\t\t}\n\t}\n}\n\nfunction getNavigationInfoFromProperty(property: Property): NavigationInfo | undefined {\n\tconst annotations = property.annotations[\"Common\"] || {};\n\t// Look for the semanticObject annotation (if any)\n\tlet semanticObjectAnnotation: SemanticObject | undefined;\n\tObject.keys(annotations).forEach((annotationKey) => {\n\t\tconst annotation = annotations[annotationKey as keyof typeof annotations];\n\t\tif (isAnnotationOfTerm(annotation, CommonAnnotationTerms.SemanticObject)) {\n\t\t\tif (!annotation.qualifier || !semanticObjectAnnotation) {\n\t\t\t\t// We always take the annotation without qualifier if there's one, otherwise we take the first one\n\t\t\t\tsemanticObjectAnnotation = annotation as SemanticObject;\n\t\t\t}\n\t\t}\n\t});\n\n\tif (semanticObjectAnnotation) {\n\t\tconst result: NavigationInfo = {\n\t\t\tsemanticObject: semanticObjectAnnotation.toString(),\n\t\t\tunavailableActions: []\n\t\t};\n\n\t\t// Look for the unavailable actions (if any)\n\t\tconst annotationKey = Object.keys(annotations).find((key) => {\n\t\t\tconst annotation = annotations[key as keyof typeof annotations];\n\t\t\treturn (\n\t\t\t\tisAnnotationOfTerm(annotation, CommonAnnotationTerms.SemanticObjectUnavailableActions) &&\n\t\t\t\tannotation.qualifier === semanticObjectAnnotation?.qualifier\n\t\t\t);\n\t\t});\n\t\tif (annotationKey) {\n\t\t\tresult.unavailableActions = annotations[annotationKey as keyof typeof annotations] as string[];\n\t\t}\n\n\t\treturn result;\n\t} else {\n\t\treturn undefined;\n\t}\n}\n\nfunction isCustomKPIConfiguration(kpiConfig: KPIConfiguration): kpiConfig is CustomKPIConfiguration {\n\treturn !!(kpiConfig as CustomKPIConfiguration).template;\n}\n\nfunction createAnalyticalKPIDefinition(\n\tconverterContext: ConverterContext<PageContextPathTarget>,\n\tkpiConfig: AnalyticalKPIConfiguration,\n\tkpiName: string\n): AnalyticalKPIDefinition | undefined {\n\tlet contextPath = \"\";\n\tif (kpiConfig.contextPath) {\n\t\tcontextPath = kpiConfig.contextPath;\n\t} else if (kpiConfig.entitySet) {\n\t\tcontextPath = `/${kpiConfig.entitySet}`;\n\t}\n\tconst kpiConverterContext = converterContext.getConverterContextFor<PageContextPathTarget>(contextPath);\n\tconst aggregationHelper = new AggregationHelper(kpiConverterContext.getEntityType(), kpiConverterContext);\n\n\tif (!aggregationHelper.isAnalyticsSupported()) {\n\t\t// The entity doesn't support analytical queries\n\t\tconverterContext\n\t\t\t.getDiagnostics()\n\t\t\t.addIssue(IssueCategory.Annotation, IssueSeverity.Medium, IssueType.KPI_ISSUES.NO_ANALYTICS + contextPath);\n\n\t\treturn undefined;\n\t}\n\n\tlet selectionVariantAnnotation: SelectionVariantType | undefined;\n\tlet datapointAnnotation: DataPointType | undefined;\n\tlet presentationVariantAnnotation: PresentationVariantType | undefined;\n\tlet chartAnnotation: Chart | undefined;\n\tlet navigationInfo: NavigationInfo | undefined;\n\n\t// Search for a KPI with the qualifier frmo the manifest\n\tconst aKPIAnnotations = kpiConverterContext.getAnnotationsByTerm(\"UI\", UIAnnotationTerms.KPI) as KPI[];\n\tconst targetKPI = aKPIAnnotations.find((kpi) => {\n\t\treturn kpi.qualifier === kpiConfig.qualifier;\n\t});\n\tif (targetKPI) {\n\t\tdatapointAnnotation = targetKPI.DataPoint;\n\t\tselectionVariantAnnotation = targetKPI.SelectionVariant;\n\t\tpresentationVariantAnnotation = targetKPI.Detail?.DefaultPresentationVariant;\n\t\tchartAnnotation = presentationVariantAnnotation?.Visualizations?.find((viz) => {\n\t\t\treturn isAnnotationOfType<Chart>(viz.$target, UIAnnotationTypes.ChartDefinitionType);\n\t\t})?.$target as Chart;\n\n\t\tif (targetKPI.Detail?.SemanticObject) {\n\t\t\tnavigationInfo = {\n\t\t\t\tsemanticObject: targetKPI.Detail.SemanticObject.toString(),\n\t\t\t\taction: targetKPI.Detail.Action?.toString(),\n\t\t\t\tunavailableActions: []\n\t\t\t};\n\t\t}\n\t} else {\n\t\t// Fallback: try to find a SPV with the same qualifier\n\t\tconst aSPVAnnotations = kpiConverterContext.getAnnotationsByTerm(\n\t\t\t\"UI\",\n\t\t\tUIAnnotationTerms.SelectionPresentationVariant\n\t\t) as SelectionPresentationVariant[];\n\t\tconst targetSPV = aSPVAnnotations.find((spv) => {\n\t\t\treturn spv.qualifier === kpiConfig.qualifier;\n\t\t});\n\t\tif (targetSPV) {\n\t\t\tselectionVariantAnnotation = targetSPV.SelectionVariant;\n\t\t\tpresentationVariantAnnotation = targetSPV.PresentationVariant;\n\t\t\tdatapointAnnotation = presentationVariantAnnotation?.Visualizations?.find((viz) => {\n\t\t\t\treturn isAnnotationOfType<DataPoint>(viz.$target, UIAnnotationTypes.DataPointType);\n\t\t\t})?.$target as DataPoint;\n\t\t\tchartAnnotation = presentationVariantAnnotation?.Visualizations?.find((viz) => {\n\t\t\t\treturn isAnnotationOfType<Chart>(viz.$target, UIAnnotationTypes.ChartDefinitionType);\n\t\t\t})?.$target as Chart;\n\t\t} else {\n\t\t\t// Couldn't find a KPI or a SPV annotation with the qualifier from the manifest\n\t\t\tconverterContext\n\t\t\t\t.getDiagnostics()\n\t\t\t\t.addIssue(IssueCategory.Annotation, IssueSeverity.Medium, IssueType.KPI_ISSUES.KPI_NOT_FOUND + kpiConfig.qualifier);\n\n\t\t\treturn undefined;\n\t\t}\n\t}\n\n\tif (!presentationVariantAnnotation || !datapointAnnotation || !chartAnnotation) {\n\t\t// Couldn't find a chart or datapoint definition\n\t\tconverterContext\n\t\t\t.getDiagnostics()\n\t\t\t.addIssue(IssueCategory.Annotation, IssueSeverity.Medium, IssueType.KPI_ISSUES.KPI_DETAIL_NOT_FOUND + kpiConfig.qualifier);\n\n\t\treturn undefined;\n\t}\n\n\tconst datapointProperty = datapointAnnotation.Value.$target as Property;\n\tif (!aggregationHelper.isPropertyAggregatable(datapointProperty)) {\n\t\t// The main property of the KPI is not aggregatable --> We can't calculate its value so we ignore the KPI\n\t\tconverterContext\n\t\t\t.getDiagnostics()\n\t\t\t.addIssue(\n\t\t\t\tIssueCategory.Annotation,\n\t\t\t\tIssueSeverity.Medium,\n\t\t\t\tIssueType.KPI_ISSUES.MAIN_PROPERTY_NOT_AGGREGATABLE + kpiConfig.qualifier\n\t\t\t);\n\t\treturn undefined;\n\t}\n\n\t// Chart definition\n\tconst chartDef = convertKPIChart(chartAnnotation, presentationVariantAnnotation, converterContext);\n\tif (!chartDef) {\n\t\treturn undefined;\n\t}\n\n\tconst kpiDef: AnalyticalKPIDefinition = {\n\t\ttype: \"Analytical\",\n\t\tid: \"kpiTag-\" + getKPIID(kpiName),\n\t\tcontextPath,\n\t\tdatapoint: {\n\t\t\tpropertyPath: datapointAnnotation.Value.path,\n\t\t\tannotationPath: kpiConverterContext.getEntitySetBasedAnnotationPath(datapointAnnotation.fullyQualifiedName),\n\t\t\ttitle: datapointAnnotation.Title?.toString(),\n\t\t\tdescription: datapointAnnotation.Description?.toString()\n\t\t},\n\t\tselectionVariantFilterDefinitions: selectionVariantAnnotation\n\t\t\t? getFilterDefinitionsFromSelectionVariant(selectionVariantAnnotation)\n\t\t\t: undefined,\n\t\tchart: chartDef\n\t};\n\n\tif (datapointAnnotation.ValueFormat?.NumberOfFractionalDigits !== undefined) {\n\t\tkpiDef.datapoint.numberOfFractionalDigits = datapointAnnotation.ValueFormat.NumberOfFractionalDigits.valueOf();\n\t}\n\n\t// Navigation\n\tif (!navigationInfo) {\n\t\t// No navigationInfo was found in the KPI annotation --> try the outbound navigation from the manifest\n\t\tif (kpiConfig.detailNavigation) {\n\t\t\tnavigationInfo = {\n\t\t\t\toutboundNavigation: kpiConfig.detailNavigation\n\t\t\t};\n\t\t} else {\n\t\t\t// No outbound navigation in the manifest --> try the semantic object on the Datapoint value\n\t\t\tnavigationInfo = getNavigationInfoFromProperty(datapointProperty);\n\t\t}\n\t}\n\tif (navigationInfo) {\n\t\tkpiDef.navigation = navigationInfo;\n\t}\n\n\tupdateCurrency(datapointAnnotation, kpiDef);\n\tupdateCriticality(datapointAnnotation, aggregationHelper, kpiDef);\n\tupdateTrend(datapointAnnotation, aggregationHelper, kpiDef);\n\tupdateTarget(datapointAnnotation, aggregationHelper, kpiDef);\n\n\treturn kpiDef;\n}\n\nfunction createKPIDefinition(\n\tkpiName: string,\n\tkpiConfig: KPIConfiguration,\n\tconverterContext: ConverterContext<PageContextPathTarget>\n): KPIDefinition | undefined {\n\tif (isCustomKPIConfiguration(kpiConfig)) {\n\t\treturn {\n\t\t\ttype: \"Custom\",\n\t\t\tkey: kpiName,\n\t\t\ttemplate: kpiConfig.template\n\t\t};\n\t} else {\n\t\treturn createAnalyticalKPIDefinition(converterContext, kpiConfig, kpiName);\n\t}\n}\n\n/**\n * Creates the KPI definitions from the manifest and the annotations.\n * @param converterContext The converter context for the page\n * @returns Returns an array of KPI definitions\n */\nexport function getKPIDefinitions(converterContext: ConverterContext<PageContextPathTarget>): KPIDefinition[] {\n\tconst kpiConfigs = converterContext.getManifestWrapper().getKPIConfiguration(),\n\t\tkpiDefs: KPIDefinition[] = [];\n\n\tObject.keys(kpiConfigs).forEach((kpiName) => {\n\t\tconst oDef = createKPIDefinition(kpiName, kpiConfigs[kpiName], converterContext);\n\t\tif (oDef) {\n\t\t\tkpiDefs.push(oDef);\n\t\t}\n\t});\n\n\treturn kpiDefs;\n}\n"],"mappings":"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","ignoreList":[],"file":"KPI-dbg.js"}