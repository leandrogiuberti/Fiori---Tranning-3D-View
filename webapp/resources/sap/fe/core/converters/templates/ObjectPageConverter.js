/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)
 *      (c) Copyright 2009-2025 SAP SE. All rights reserved
 */
sap.ui.define(["sap/fe/base/BindingToolkit","sap/fe/core/converters/controls/Common/Action","sap/fe/core/converters/objectPage/HeaderAndFooterAction","sap/fe/core/helpers/ActionUtilities","sap/fe/core/helpers/ModelHelper","../../helpers/BindingHelper","../ManifestSettings","../controls/ObjectPage/Avatar","../controls/ObjectPage/HeaderFacet","../controls/ObjectPage/SubSection","../helpers/ConfigurableObject","../helpers/ID"],function(e,t,n,o,i,a,s,r,c,l,d,u){"use strict";var f={};var p=u.getSectionID;var v=u.getEditableHeaderSectionID;var g=u.getCustomSectionID;var b=d.insertCustomElements;var y=d.Placement;var S=d.OverrideType;var h=l.createSubSections;var E=l.createCustomSubSections;var m=l.createCustomHeaderFacetSubSections;var A=l.SubSectionType;var w=c.getHeaderFacetsFromManifest;var C=c.getHeaderFacetsFromAnnotations;var T=r.getAvatar;var H=s.VisualizationType;var M=s.TemplateType;var F=a.singletonPathVisitor;var O=a.UI;var I=n.getHiddenHeaderActions;var L=n.getHeaderDefaultActions;var P=n.getFooterDefaultActions;var z=n.getEditButtonEnabledExpression;var V=t.removeDuplicateActions;var k=t.prepareMenuActions;var x=t.getVisibilityEnablementMenuActions;var j=t.getMatchingManifestAction;var D=t.getAnnotationMenuActionItems;var U=t.getActionsFromManifest;var B=e.not;var N=e.ifElse;var W=e.getExpressionFromAnnotation;var R=e.equal;var _=e.constant;var q=e.compileExpression;var G=e.and;const J=(e,t)=>e.ID?.toString()||e.Label?.toString()||t;function K(e,t){const n=v();const o=e.getEntityType().annotations?.UI?.HeaderFacets;const i=o?h(o,e,true):[];const a=m(e);let s=[];if(a.length>0){let e=0;t.forEach(function(t){while(i.length>e&&i[e].visible==="false"){s.push(i[e]);e++}if(i.length>e&&(t.key===i[e].key||t.key.slice(t.key.lastIndexOf("::")+2)===i[e].key.slice(i[e].key.lastIndexOf("::")+2))){s.push(i[e]);e++}else{a.forEach(function(e){if(t.key===e.key){s.push(e)}})}})}else{s=i}const r={id:n,key:"EditableHeaderContent",title:"{sap.fe.i18n>T_COMMON_OBJECT_PAGE_HEADER_SECTION}",visible:q(O.IsEditable),subSections:s};return r}f.createEditableHeaderSection=K;function Q(e){const t=e.getEntityType();const n=t.annotations?.UI?.Facets?.map(t=>Y(t,e))||[];return n}function X(e,t){const n=e.getSections();const o=n?.[t];return o?.useSingleTextAreaFieldAsNotes??false}function Y(e,t){const n=p(e);const o=J(e,n);const i=W(e.annotations?.UI?.Hidden,[],false,e=>F(e,t.getConvertedTypes(),[]));const a=X(t.getManifestWrapper(),o);const s={id:n,key:o,title:e.Label?q(W(e.Label)):undefined,showTitle:!!e.Label,visible:q(B(R(i,true))),subSections:h([e],t,undefined,a),useSingleTextAreaFieldAsNotes:a};return s}function Z(e,t){const n={};Object.keys(e).forEach(o=>{n[o]=$(e[o],o,t)});return n}function $(e,t,n){const o=e.id||g(t);let i=e.position;if(!i){i={placement:y.After}}let a;if(!e.subSections){a={[t]:{...e,position:undefined,visible:"true",applyState:undefined,retrieveState:undefined}}}else{a=e.subSections}const s=E(a,n);const r={id:o,key:t,title:e.title,showTitle:!!e.title,visible:e.visible!==undefined?e.visible:"true",position:i,subSections:s,onSectionLoaded:e.onSectionLoaded,applyState:e.applyState,retrieveState:e.retrieveState};return r}const ee=function(e,t){const n=L(e,t);const i=e.getManifestWrapper();const a={isNavigable:S.overwrite,enabled:S.overwrite,visible:S.overwrite,defaultValuesExtensionFunction:S.overwrite,command:S.overwrite,position:S.overwrite,menu:S.overwrite,priority:S.overwrite,group:S.overwrite};const s=U(i.getHeaderActions(),e,n,undefined,undefined,I(e));const r=D(n);const c=j(r,s.actions);const l=b(r,c,a);let d=b(n,s.actions,a);k(d,l);d=V(d);d=x(d);d=o.ensurePrimaryActionNeverOverflows(d);return{actions:d,commandActions:s.commandActions}};f.getHeaderActions=ee;const te=function(e,t){const n=e.getManifestWrapper();const i=P(n.getViewLevel(),e,t);const a=U(n.getFooterActions(),e,i);const s={isNavigable:S.overwrite,enabled:S.overwrite,visible:S.overwrite,defaultValuesExtensionFunction:S.overwrite,command:S.overwrite,position:S.overwrite,priority:S.overwrite,group:S.overwrite};const r=b(i,a.actions,s);const c=o.ensurePrimaryActionNeverOverflows(r);return{actions:c,commandActions:a.commandActions}};f.getFooterActions=te;function ne(e){return e?.presentation?.visualizations[0]?e.presentation.visualizations[0]:undefined}function oe(e,t){return e.visible==="true"&&e?.presentation?.visualizations&&t?.type==="Table"&&t?.control?.type!=="ResponsiveTable"}function ie(e,t,n,o){if(oe(t,n)){const i=n.control;t.dataVisualizationOptions??={};if(!(o==="Page"&&e.length>1)){t.dataVisualizationOptions["rowCountMode"]="Auto";i.rowCountMode="Auto"}if(o!=="Tabs"){t.dataVisualizationOptions["useCondensedTableLayout"]=false;i.useCondensedTableLayout=false}}}function ae(e,t){const n=e?.content?.length===1?e.content[0]:undefined;if(n?.type===A.DataVisualization){const e=(n.presentation?.visualizations[0]).control;if(e.type!=="ResponsiveTable"){n.dataVisualizationOptions??={};n.dataVisualizationOptions["rowCountMode"]="Auto";e.rowCountMode="Auto";if(t!=="Tabs"){n.dataVisualizationOptions["useCondensedTableLayout"]=false;e.useCondensedTableLayout=false}}}}function se(e,t,n){let o;const i=t.subSections;if(i.length===1){const t=i[0];switch(t.type){case"DataVisualization":o=ne(t);ie(e,t,o,n);break;case"Mixed":ae(t,n);break;default:break}return}re(i)}function re(e){let t;e.forEach(e=>{t=e;if(t?.presentation?.visualizations){t?.presentation?.visualizations.forEach(e=>{if(e.type===H.Table){e.control.useCondensedTableLayout=false}})}if(t?.content){t.content.forEach(e=>{e.presentation?.visualizations.forEach(e=>{if(e.type===H.Table){e.control.useCondensedTableLayout=false}})})}})}const ce=function(e){const t=e.getManifestWrapper();const n=b(Q(e),Z(t.getSections(),e),{title:S.overwrite,visible:S.overwrite,subSections:{actions:S.merge,title:S.overwrite,sideContent:S.overwrite,objectPageLazyLoaderEnabled:S.overwrite}});n.forEach(function(e){se(n,e,t.getSectionLayout());e.subSections?.forEach(function(e){e.title=e.title==="undefined"?undefined:e.title;if(e.type==="Mixed"){e.content?.forEach(t=>{t.objectPageLazyLoaderEnabled=e.objectPageLazyLoaderEnabled})}if(e.type==="Mixed"&&e.content?.length){const t=e.content.find(e=>e.type===A.Form);if(e.sideContent){if(t){t.sideContent=e.sideContent}else{e.content[0].sideContent=e.sideContent}e.sideContent=undefined}if(t&&e.actions?.length){t.actions=e.actions;e.actions=[]}}})});return n};f.getSections=ce;function le(e){const t=e.getManifestWrapper();return(e.getEntityType().annotations?.UI?.HeaderFacets||[]).length>0||Object.keys(t.getHeaderFacets()).length>0}function de(e){const t=e.getManifestWrapper();return N(!le(e),_(false),N(R(t.isHeaderEditable(),false),_(true),B(O.IsEditable)))}const ue=function(e){return q(de(e))};f.getShowHeaderContent=ue;const fe=function(e){const t=e?.getEntitySet(),n=e.getEntityType(),o=W(i.isUpdateHidden(t,n));const a=i.getRootEntitySetPath(e.getContextPath());const s=e.getConverterContextFor("/"+a);const r=W(i.isUpdateHidden(s.getEntitySet(),s.getEntityType()));const c=i.isObjectPathDraftSupported(e.getDataModelObjectPath());const l=i.isSticky(e.getDataModelObjectPath().startingEntitySet);if(!c&&!l){return q(false)}const d=e.getManifestWrapper().getViewLevel();const u=d>1?t?.annotations.Capabilities?.UpdateRestrictions?.Updatable:undefined;const f=z(e,u,d);return q(N(d>1,G(B(o),O.IsEditable,f),G(B(o),B(r),f)))};f.getEasyFillVisible=fe;const pe=function(e){return q(B(de(e)))};f.getExpandedImageVisible=pe;const ve=function(e,t){const n=e.getManifestWrapper();let o;const i=e.getEntityType();const a=b(C(e),w(n.getHeaderFacets()));const s=ee(e,t);const r=te(e,t);if(n.isHeaderEditable()&&(i.annotations.UI?.HeaderFacets||i.annotations.UI?.HeaderInfo)){o=K(e,a)}const c=ce(e);return{template:M.ObjectPage,header:{visible:n.getShowObjectPageHeader(),section:o,facets:a,actions:s.actions,easyFillVisible:fe(e),showContent:ue(e),hasContent:le(e),avatar:T(e),title:{expandedImageVisible:pe(e)}},sections:c,footerActions:r.actions,headerCommandActions:s.commandActions,footerCommandActions:r.commandActions,showAnchorBar:n.getShowAnchorBar(),useIconTabBar:n.useIconTabBar(),transportSelection:n.getTransportSelection()}};f.convertPage=ve;return f},false);
//# sourceMappingURL=ObjectPageConverter.js.map