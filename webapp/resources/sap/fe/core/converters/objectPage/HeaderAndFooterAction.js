/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)
 *      (c) Copyright 2009-2025 SAP SE. All rights reserved
 */
sap.ui.define(["sap/fe/base/BindingToolkit","sap/fe/core/converters/controls/Common/Action","sap/fe/core/converters/helpers/ConfigurableObject","sap/fe/core/converters/helpers/Key","sap/fe/core/helpers/ModelHelper","sap/fe/core/helpers/TypeGuards","sap/fe/core/templating/DataModelPathHelper","sap/fe/core/templating/UIFormatters","sap/ui/core/Lib","../../helpers/BindingHelper","../ManifestSettings"],function(e,t,n,i,a,o,r,s,l,c,u){"use strict";var f={};var d=u.ActionType;var p=c.singletonPathVisitor;var y=c.UI;var v=c.Draft;var g=s.isVisible;var b=r.isPathDeletable;var A=o.isEntitySet;var D=i.KeyHelper;var E=n.Placement;var m=t.isMenuAIOperation;var h=t.isActionAIOperation;var C=t.getSemanticObjectMapping;var I=t.getEnabledForAnnotationActionExpression;var F=t.getEnabledForAnnotationAction;var S=t.getCopyAction;var T=t.dataFieldIsCopyAction;var O=t.ButtonType;var B=e.pathInModel;var U=e.not;var N=e.ifElse;var P=e.getExpressionFromAnnotation;var H=e.fn;var x=e.equal;var M=e.constant;var k=e.compileExpression;var R=e.and;function V(e,t){return e.annotations?.UI?.Identification?.filter(e=>e.$Type==="com.sap.vocabularies.UI.v1.DataFieldForAction"&&Boolean(e.Determining?.valueOf())===t&&(e.ActionTarget?.isBound?.valueOf()!==true||e?.ActionTarget?.annotations?.Core?.OperationAvailable?.valueOf()!==false)?true:false)||[]}f.getIdentificationDataFieldForActions=V;function L(e,t){return e.annotations?.UI?.Identification?.filter(e=>e.$Type==="com.sap.vocabularies.UI.v1.DataFieldForAction"&&Boolean(e.Determining?.valueOf())===t&&(e.ActionTarget?.isBound?.valueOf()!==true||e?.ActionTarget?.annotations?.Core?.OperationAvailable?.valueOf()!==false)||e.$Type==="com.sap.vocabularies.UI.v1.DataFieldForActionGroup"?true:false)||[]}f.getIdentificationDataFieldForActionsOrGroups=L;function j(e,t){return e.annotations?.UI?.Identification?.filter(e=>e.$Type==="com.sap.vocabularies.UI.v1.DataFieldForIntentBasedNavigation"&&Boolean(e.Determining?.valueOf())===t?true:false)||[]}const w=["UI.CriticalityType/VeryPositive","UI.CriticalityType/Positive","UI.CriticalityType/Negative","UI.CriticalityType/VeryNegative"];f.IMPORTANT_CRITICALITIES=w;function $(e,t){const n=e.getDataModelObjectPath(),i=n.navigationProperties.map(e=>e.name),a=P(t,i,false,t=>p(t,e.getConvertedTypes(),[])),o=e.getManifestWrapper(),r=o.getViewLevel(),s=r>1?y.IsEditable:U(y.IsEditable);return N(t===undefined||t.valueOf()===false,s,R(s,x(a,false)))}f.getDeleteButtonVisibility=$;function K(e,t,n){const i=n.getEntitySet(),o=a.isDraftRoot(i);let r=N(t!==undefined,t,N(e!==undefined,x(P(e),true),M(true)));r=o?R(r,U(B("DraftAdministrativeData/InProcessByUser"))):r;return r}f.getDeleteButtonEnabled=K;function G(e,t,n,i,o,r){const s=n?.getEntitySet(),l=e.getEntitySet(),c=e.getManifestWrapper().isFclEnabled();let u;const f=z(n,t);const d=r?.HiddenDraft?.enabled;if(o&&o>1){u=a.isDraftNode(l)}else{u=a.isDraftRoot(s)}const p=z(n,i);const g=U(y.IsEditable);const b=N(o>1||d,N(i===undefined||i.valueOf()===false,R(g,x(B("rootEditVisible","internal"),true),N(c,x(B("/showEditButton","fclhelper"),true),true)),R(g,x(p,false),x(B("rootEditVisible","internal"),true),N(c,x(B("/showEditButton","fclhelper"),true),true))),N(t===undefined||t.valueOf()===false,g,R(g,x(f,false))));return N(u,R(b,v.HasNoDraftForCurrentUser),b)}f.getEditButtonVisibility=G;function z(e,t){const n=e.getDataModelObjectPath(),i=n.navigationProperties.map(e=>e.name),a=P(t,i,false,t=>p(t,e.getConvertedTypes(),i));return a}f.getHiddenExpression=z;function W(e,t,n){const i=e.getEntitySet(),o=a.isDraftRoot(i),r=a.isSticky(i);let s;if(o&&A(i)){s=i.annotations.Common?.DraftRoot?.EditAction}else if(r&&A(i)){s=i.annotations.Session?.StickySessionSupported?.EditAction}if(s){const i=e.getAbsoluteAnnotationPath(s);const a=e.resolveAbsolutePath(i).target;if(a?.annotations?.Core?.OperationAvailable===null){}else if(n>1){if(t!==undefined){return R(x(P(t),true),x(B("rootEditEnabled","internal"),true))}else{return x(B("rootEditEnabled","internal"),true)}}else{return I(e,a??undefined)}}return M(true)}f.getEditButtonEnabledExpression=W;function _(e,t,n){return k(W(e,t,n))}f.getEditButtonEnabled=_;function q(e,t){const n=e.getContextPath();const i=a.getRootEntitySetPath(n);const o=e.getConverterContextFor("/"+i);const r=e.getEntitySet(),s=e.getEntityType(),c=o.getEntitySet(),u=o.getEntityType(),f=a.getStickySession(c),v=a.getDraftRoot(c),g=a.isCollaborationDraftSupportedFromConverterContext(e)&&v,E=a.getDraftNode(c),m=r&&r.annotations?.Capabilities?.DeleteRestrictions,h=a.isUpdateHidden(c,u),I=c&&A(c)&&h?.valueOf(),F=e.getDataModelObjectPath(),N=b(F,{pathVisitor:(t,n)=>p(t,e.getConvertedTypes(),n)}),M=N?k(N):N,V=L(e.getEntityType(),false);const z=e.getManifestWrapper().getViewLevel()===1?S(V.filter(e=>{if(e.$Type==="com.sap.vocabularies.UI.v1.DataFieldForAction"){return T(e)}})):undefined;const W=V.filter(e=>!T(e));const q=[];if(A(r)&&v?.EditAction&&I!==true){q.push({type:d.DraftActions,key:"DraftActions"})}const Q=e.getManifestWrapper().getViewLevel();const Y=Q>1?r?.annotations.Capabilities?.UpdateRestrictions?.Updatable:undefined;if(v||E){q.push({type:d.CollaborationAvatars,key:"CollaborationAvatars"})}X(q,true,W,e);if((v?.EditAction||f?.EditAction)&&I!==true){let n=G(e,h,o,a.isUpdateHidden(r,s),Q,t);if(g){n=R(n,U(x(y.hasCollaborationAuthorization,false)))}q.push({type:d.Primary,key:"EditAction",visible:k(n),enabled:_(o,Y,Q)})}if(M&&M!=="false"||m?.Deletable?.valueOf()!==false&&M!=="false"){const t=a.getDeleteHidden(r,s);let n=$(e,t);if(g){n=R(n,U(x(y.hasCollaborationAuthorization,false)))}q.push({type:d.Secondary,key:"DeleteAction",visible:k(n),enabled:k(K(m?.Deletable,N,e)),parentEntityDeleteEnabled:M})}if(z){q.push({...J(z,e),type:d.Copy,text:z.Label?.toString()??l.getResourceBundleFor("sap.fe.core").getText("C_COMMON_COPY")})}const Z=j(e.getEntityType(),false);Z.filter(e=>{const t=k(P(e?.Criticality));return!w.includes(t)}).forEach(t=>{if(t.RequiresContext?.valueOf()===true){throw new Error(`RequiresContext property should not be true for header IBN action : ${t.Label}`)}if(t.Inline?.valueOf()===true){throw new Error(`Inline property should not be true for header IBN action : ${t.Label}`)}const n={semanticObjectMapping:C(t.Mapping)};q.push({type:d.DataFieldForIntentBasedNavigation,text:t.Label?.toString(),annotationPath:e.getEntitySetBasedAnnotationPath(t.fullyQualifiedName),buttonType:O.Ghost,visible:k(R(U(x(P(t.annotations?.UI?.Hidden),true)),U(x(B("shellNavigationNotAvailable","internal"),true)))),enabled:t.NavigationAvailable!==undefined?k(x(P(t.NavigationAvailable),true)):true,key:D.generateKeyFromDataField(t),isNavigable:true,press:k(H("._intentBasedNavigation.navigate",[P(t.SemanticObject),P(t.Action),n])),customData:k({semanticObject:P(t.SemanticObject),action:P(t.Action)})})});X(q,false,W,e);return q}f.getHeaderDefaultActions=q;function Q(e){const t=e.getEntityType();const n=t.annotations?.UI?.Identification?.filter(e=>e?.annotations?.UI?.Hidden?.valueOf()===true)||[];return n.map(e=>({type:d.Default,key:D.generateKeyFromDataField(e)}))}f.getHiddenHeaderActions=Q;function Y(e,t,n){const i=t.getEntitySet();const o=t.getEntityType();const r=a.getStickySession(i),s=A(i)&&(i.annotations.Common?.DraftRoot?.term??i.annotations.Session?.StickySessionSupported?.term),l=Boolean(s==="com.sap.vocabularies.Common.v1.DraftRoot"||n?.HiddenDraft?.enabled||r&&r?.SaveAction),c=e>1&&!n?.HiddenDraft?.enabled,u=Boolean(s==="com.sap.vocabularies.Common.v1.DraftRoot"||n?.HiddenDraft?.enabled||r&&r?.DiscardAction),f=e>1&&n?.HiddenDraft?.enabled&&!n?.HiddenDraft?.hideCreateNext;const p=V(t.getEntityType(),true);const y=p.filter(e=>{const t=k(P(e?.Criticality));return t&&w.includes(t)}).map(e=>J(e,t));if(f){y.push({type:d.CreateNext,key:"CreateNextAction"})}if(i?.entityTypeName===o?.fullyQualifiedName&&l){y.push({type:d.Primary,key:"SaveAction"})}if(c){y.push({type:d.DefaultApply,key:"ApplyAction"})}p.filter(e=>{const t=k(P(e?.Criticality));return t&&!w.includes(t)}).forEach(e=>{y.push(J(e,t))});if(u){y.push({type:d.Secondary,key:"CancelAction",position:{placement:E.End}})}return y}f.getFooterDefaultActions=Y;function J(e,t){let n=g(e);const i=a.isCollaborationDraftSupportedFromConverterContext(t)&&a.getDraftRoot(t.getEntitySet());if(i){n=R(n,U(x(y.hasCollaborationAuthorization,false)))}return{type:d.DataFieldForAction,annotationPath:t.getEntitySetBasedAnnotationPath(e.fullyQualifiedName),key:D.generateKeyFromDataField(e),visible:k(n),enabled:F(t,e.ActionTarget),isNavigable:true,isAIOperation:h(e)===true||undefined}}function X(e,t,n,i){n.filter(e=>{const n=k(P(e?.Criticality));return t?w.includes(n):!w.includes(n)}).forEach(t=>{if(t.$Type==="com.sap.vocabularies.UI.v1.DataFieldForAction"){e.push(J(t,i))}else if(t.$Type==="com.sap.vocabularies.UI.v1.DataFieldForActionGroup"){let n=U(x(P(t.annotations?.UI?.Hidden),true));const o=a.isCollaborationDraftSupportedFromConverterContext(i)&&a.getDraftRoot(i.getEntitySet());if(o){n=R(n,U(x(y.hasCollaborationAuthorization,false)))}e.push({type:d.Menu,text:t.Label,key:D.generateKeyFromDataField(t),id:D.generateKeyFromDataField(t),visible:k(n),menu:t.Actions.map(e=>J(e,i)),isAIOperation:m(t.Actions)===true||undefined})}})}return f},false);
//# sourceMappingURL=HeaderAndFooterAction.js.map