{"version":3,"file":"DataFieldHelper.js","names":["isReferencePropertyStaticallyHidden","source","isPropertyHidden","property","dataFieldDefault","annotations","UI","DataFieldDefault","isPropertyStaticallyHidden","isStaticallyHiddenDataField","isDataFieldAbstractTypesHidden","dataField","$Type","isAnnotationFieldStaticallyHidden","getPropertyPathFromPropertyWithHiddenFilter","name","getPropertyPathFromDataFieldWithHiddenFilter","isDataFieldTypes","Value","$target","path","isHidden","isProperty","propertyPathWithHiddenFilter","setLogMessageForHiddenFilter","_exports","annotationProperty","Target","term","measuresHidden","Measures","every","chartMeasure","Log","warning","Data","propertyValueAnnotation","isHeaderStaticallyHidden","propertyDataModel","targetObject","headerInfoAnnotation","Hidden","valueOf","hasOwnProperty","AnnotationTerm","isPotentiallySensitive","dataFieldTarget","fn","PersonalData","IsPotentiallySensitive"],"sources":["./DataFieldHelper.ts"],"sourcesContent":["import type { PrimitiveType, Property } from \"@sap-ux/vocabularies-types\";\nimport { CommunicationAnnotationTerms } from \"@sap-ux/vocabularies-types/vocabularies/Communication\";\nimport type {\n\tDataFieldAbstractTypes,\n\tDataFieldForAnnotationTypes,\n\tDataFieldTypes,\n\tDataPointType,\n\tFieldGroup,\n\tReferenceFacetTypes\n} from \"@sap-ux/vocabularies-types/vocabularies/UI\";\nimport { UIAnnotationTerms, UIAnnotationTypes } from \"@sap-ux/vocabularies-types/vocabularies/UI\";\nimport Log from \"sap/base/Log\";\nimport { isProperty } from \"../../helpers/TypeGuards\";\nimport type { DataModelObjectPath } from \"../../templating/DataModelPathHelper\";\n\n/**\n * Checks for statically hidden reference properties.\n * @param source The dataField or property to be analized\n * @returns Whether the argument has been set as hidden\n */\nexport function isReferencePropertyStaticallyHidden(source?: DataFieldAbstractTypes | Property): boolean {\n\tif (!source) {\n\t\treturn false;\n\t}\n\tfunction isPropertyHidden(property: Property): boolean {\n\t\tconst dataFieldDefault = property.annotations.UI?.DataFieldDefault || false;\n\t\treturn isPropertyStaticallyHidden(\"Hidden\", property) || (dataFieldDefault && isStaticallyHiddenDataField(dataFieldDefault));\n\t}\n\tfunction isDataFieldAbstractTypesHidden(dataField: DataFieldAbstractTypes): boolean {\n\t\treturn (\n\t\t\tisStaticallyHiddenDataField(dataField) ||\n\t\t\t(dataField.$Type === UIAnnotationTypes.DataFieldForAnnotation && isAnnotationFieldStaticallyHidden(dataField))\n\t\t);\n\t}\n\n\tfunction getPropertyPathFromPropertyWithHiddenFilter(property: Property): string | false {\n\t\treturn isPropertyStaticallyHidden(\"HiddenFilter\", property) && property.name;\n\t}\n\tfunction getPropertyPathFromDataFieldWithHiddenFilter(dataField: DataFieldAbstractTypes): string | false {\n\t\treturn isDataFieldTypes(dataField) && isPropertyStaticallyHidden(\"HiddenFilter\", dataField.Value.$target) && dataField.Value.path;\n\t}\n\n\tconst isHidden = isProperty(source) ? isPropertyHidden(source) : isDataFieldAbstractTypesHidden(source);\n\tconst propertyPathWithHiddenFilter = isProperty(source)\n\t\t? getPropertyPathFromPropertyWithHiddenFilter(source)\n\t\t: getPropertyPathFromDataFieldWithHiddenFilter(source);\n\tif (isHidden && propertyPathWithHiddenFilter) {\n\t\tsetLogMessageForHiddenFilter(propertyPathWithHiddenFilter);\n\t}\n\treturn isHidden;\n}\n\n/**\n * Checks for data fields for annotation with statically hidden referenced properties.\n * @param annotationProperty The dataField or reference Facet type to be analyzed\n * @returns Whether the argument has been set as hidden\n */\nexport function isAnnotationFieldStaticallyHidden(annotationProperty: DataFieldForAnnotationTypes | ReferenceFacetTypes): boolean {\n\tif (isStaticallyHiddenDataField(annotationProperty)) {\n\t\treturn true;\n\t}\n\tswitch (annotationProperty.Target.$target?.term) {\n\t\tcase UIAnnotationTerms.Chart:\n\t\t\tconst measuresHidden = annotationProperty.Target.$target.Measures.every((chartMeasure) => {\n\t\t\t\tif (chartMeasure.$target && isPropertyStaticallyHidden(\"Hidden\", chartMeasure.$target)) {\n\t\t\t\t\tif (isPropertyStaticallyHidden(\"HiddenFilter\", chartMeasure.$target)) {\n\t\t\t\t\t\tsetLogMessageForHiddenFilter(chartMeasure.$target.name);\n\t\t\t\t\t}\n\t\t\t\t\treturn true;\n\t\t\t\t}\n\t\t\t});\n\t\t\tif (measuresHidden) {\n\t\t\t\tLog.warning(\"Warning: All measures attribute for Chart are statically hidden hence chart can't be rendered\");\n\t\t\t}\n\t\t\treturn measuresHidden;\n\t\tcase UIAnnotationTerms.FieldGroup:\n\t\t\treturn (annotationProperty.Target.$target as FieldGroup).Data.every(isReferencePropertyStaticallyHidden);\n\t\tcase UIAnnotationTerms.DataPoint:\n\t\t\tconst propertyValueAnnotation = (annotationProperty.Target.$target as DataPointType).Value.$target as Property;\n\t\t\treturn isReferencePropertyStaticallyHidden(propertyValueAnnotation);\n\t\tdefault:\n\t\t\treturn false;\n\t}\n}\n\n/**\n * Checks if header is statically hidden.\n * @param propertyDataModel The property Data Model to be analized\n * @returns Whether the argument has been set as hidden\n */\n\nexport function isHeaderStaticallyHidden(propertyDataModel?: DataModelObjectPath<DataFieldAbstractTypes>): boolean {\n\tif (propertyDataModel?.targetObject) {\n\t\tconst headerInfoAnnotation = propertyDataModel.targetObject;\n\t\treturn isReferencePropertyStaticallyHidden(headerInfoAnnotation);\n\t}\n\treturn false;\n}\n\n/**\n * Checks if data field or Reference Facet is statically hidden.\n * @param dataField The dataField or Reference Facet to be analyzed\n * @returns Whether the argument has been set statically as hidden\n */\nfunction isStaticallyHiddenDataField(dataField: DataFieldAbstractTypes | ReferenceFacetTypes): boolean {\n\treturn (\n\t\tdataField.annotations?.UI?.Hidden?.valueOf() === true ||\n\t\t(isDataFieldTypes(dataField) && isPropertyStaticallyHidden(\"Hidden\", dataField?.Value?.$target))\n\t);\n}\n\n/**\n * Adds console warning when setting hidden and hidden filter together.\n * @param path The property path to be added to the warning error message\n */\nfunction setLogMessageForHiddenFilter(path: string): void {\n\tLog.warning(\n\t\t\"Warning: Property \" +\n\t\t\tpath +\n\t\t\t\" is set with both UI.Hidden and UI.HiddenFilter - please set only one of these! UI.HiddenFilter is ignored currently!\"\n\t);\n}\n\n/**\n * Identifies if the given dataFieldAbstract that is passed is a \"DataFieldTypes\".\n * DataField has a value defined.\n * @param dataField DataField to be evaluated\n * @returns Validate that dataField is a DataFieldTypes\n */\nfunction isDataFieldTypes(dataField: DataFieldAbstractTypes | unknown): dataField is DataFieldTypes {\n\treturn (dataField as DataFieldTypes).hasOwnProperty(\"Value\");\n}\n\n/**\n * Identifies if the given property is statically hidden or hidden Filter\".\n * @param AnnotationTerm AnnotationTerm to be evaluated, only options are \"Hidden\" or \"HiddenFilter\n * @param property The property to be checked\n * @returns `true` if it is a statically hidden or hidden filter property\n */\nfunction isPropertyStaticallyHidden(AnnotationTerm: \"Hidden\" | \"HiddenFilter\", property?: Property): boolean {\n\treturn property?.annotations?.UI?.[AnnotationTerm]?.valueOf() === true;\n}\n\n/**\n * Check if dataField or dataPoint main property is potentially sensitive.\n * @param dataField DataFieldAbstractTypes or DataPOint.\n * @returns Boolean\n */\nexport function isPotentiallySensitive(dataField: DataFieldAbstractTypes | DataPointType): boolean {\n\tlet property;\n\tswitch (dataField?.$Type) {\n\t\tcase UIAnnotationTypes.DataField:\n\t\tcase UIAnnotationTypes.DataFieldWithUrl:\n\t\tcase UIAnnotationTypes.DataFieldWithNavigationPath:\n\t\t\tproperty = dataField?.Value?.$target;\n\t\t\tbreak;\n\t\tcase UIAnnotationTypes.DataFieldForAnnotation:\n\t\t\tconst dataFieldTarget = dataField.Target.$target;\n\t\t\tif (dataFieldTarget?.term === UIAnnotationTerms.DataPoint) {\n\t\t\t\tproperty = dataFieldTarget?.Value?.$target;\n\t\t\t}\n\t\t\tif (dataFieldTarget?.term === CommunicationAnnotationTerms.Contact) {\n\t\t\t\tproperty = (dataFieldTarget as PrimitiveType)?.fn?.$target;\n\t\t\t}\n\t\t\tbreak;\n\t\tcase UIAnnotationTypes.DataPointType:\n\t\t\tproperty = dataField?.Value?.$target;\n\t\t\tbreak;\n\t\tdefault:\n\t\t\tbreak;\n\t}\n\treturn property?.annotations?.PersonalData?.IsPotentiallySensitive?.valueOf() === true;\n}\n"],"mappings":";;;;iHAoBO,SAASA,EAAoCC,GACnD,IAAKA,EAAQ,CACZ,OAAO,KACR,CACA,SAASC,EAAiBC,GACzB,MAAMC,EAAmBD,EAASE,YAAYC,IAAIC,kBAAoB,MACtE,OAAOC,EAA2B,SAAUL,IAAcC,GAAoBK,EAA4BL,EAC3G,CACA,SAASM,EAA+BC,GACvC,OACCF,EAA4BE,IAC3BA,EAAUC,QAAK,qDAAiDC,EAAkCF,EAErG,CAEA,SAASG,EAA4CX,GACpD,OAAOK,EAA2B,eAAgBL,IAAaA,EAASY,IACzE,CACA,SAASC,EAA6CL,GACrD,OAAOM,EAAiBN,IAAcH,EAA2B,eAAgBG,EAAUO,MAAMC,UAAYR,EAAUO,MAAME,IAC9H,CAEA,MAAMC,EAAWC,EAAWrB,GAAUC,EAAiBD,GAAUS,EAA+BT,GAChG,MAAMsB,EAA+BD,EAAWrB,GAC7Ca,EAA4Cb,GAC5Ce,EAA6Cf,GAChD,GAAIoB,GAAYE,EAA8B,CAC7CC,EAA6BD,EAC9B,CACA,OAAOF,CACR,CAEAI,EAAAzB,sCAKO,SAASa,EAAkCa,GACjD,GAAIjB,EAA4BiB,GAAqB,CACpD,OAAO,IACR,CACA,OAAQA,EAAmBC,OAAOR,SAASS,MAC1C,uCACC,MAAMC,EAAiBH,EAAmBC,OAAOR,QAAQW,SAASC,MAAOC,IACxE,GAAIA,EAAab,SAAWX,EAA2B,SAAUwB,EAAab,SAAU,CACvF,GAAIX,EAA2B,eAAgBwB,EAAab,SAAU,CACrEK,EAA6BQ,EAAab,QAAQJ,KACnD,CACA,OAAO,IACR,IAED,GAAIc,EAAgB,CACnBI,EAAIC,QAAQ,gGACb,CACA,OAAOL,EACR,4CACC,OAAQH,EAAmBC,OAAOR,QAAuBgB,KAAKJ,MAAM/B,GACrE,2CACC,MAAMoC,EAA2BV,EAAmBC,OAAOR,QAA0BD,MAAMC,QAC3F,OAAOnB,EAAoCoC,GAC5C,QACC,OAAO,MAEV,CAEAX,EAAAZ,oCAMO,SAASwB,EAAyBC,GACxC,GAAIA,GAAmBC,aAAc,CACpC,MAAMC,EAAuBF,EAAkBC,aAC/C,OAAOvC,EAAoCwC,EAC5C,CACA,OAAO,KACR,CAEAf,EAAAY,2BAKA,SAAS5B,EAA4BE,GACpC,OACCA,EAAUN,aAAaC,IAAImC,QAAQC,YAAc,MAChDzB,EAAiBN,IAAcH,EAA2B,SAAUG,GAAWO,OAAOC,QAEzF,CAMA,SAASK,EAA6BJ,GACrCa,EAAIC,QACH,qBACCd,EACA,wHAEH,CAQA,SAASH,EAAiBN,GACzB,OAAQA,EAA6BgC,eAAe,QACrD,CAQA,SAASnC,EAA2BoC,EAA2CzC,GAC9E,OAAOA,GAAUE,aAAaC,KAAKsC,IAAiBF,YAAc,IACnE,CAOO,SAASG,EAAuBlC,GACtC,IAAIR,EACJ,OAAQQ,GAAWC,OAClB,2CACA,kDACA,6DACCT,EAAWQ,GAAWO,OAAOC,QAC7B,MACD,wDACC,MAAM2B,EAAkBnC,EAAUgB,OAAOR,QACzC,GAAI2B,GAAiBlB,OAAI,uCAAkC,CAC1DzB,EAAW2C,GAAiB5B,OAAOC,OACpC,CACA,GAAI2B,GAAiBlB,OAAI,gDAA2C,CACnEzB,EAAY2C,GAAmCC,IAAI5B,OACpD,CACA,MACD,+CACChB,EAAWQ,GAAWO,OAAOC,QAC7B,MACD,QACC,MAEF,OAAOhB,GAAUE,aAAa2C,cAAcC,wBAAwBP,YAAc,IACnF,CAACjB,EAAAoB,yBAAA,OAAApB,CAAA","ignoreList":[]}