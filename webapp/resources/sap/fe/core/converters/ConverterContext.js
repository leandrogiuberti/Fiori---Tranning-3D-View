/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)
 *      (c) Copyright 2009-2025 SAP SE. All rights reserved
 */
sap.ui.define(["sap/fe/core/converters/ManifestWrapper","sap/fe/core/converters/MetaModelConverter","sap/fe/core/helpers/BindingHelper","sap/fe/core/helpers/ModelHelper","sap/fe/core/helpers/TypeGuards","sap/fe/core/templating/DataModelPathHelper"],function(t,e,n,i,a,r){"use strict";var o=r.getTargetObjectPath;var s=r.getContextRelativeTargetObjectPath;var h=r.enhanceDataModelPath;var f=a.isServiceObject;var c=n.singletonPathVisitor;var u=e.getInvolvedDataModelObjectFromPath;var l=e.convertTypes;const p=function(t){return typeof t==="object"};const g=function(t,e){let n;let i;let a;let r;let o=[];const s=[];t.objectPath.forEach(t=>{if(f(t)){switch(t._type){case"NavigationProperty":o.push(t.name);s.push(t);r=t.targetType;if(a&&a.navigationPropertyBinding.hasOwnProperty(o.join("/"))){i=a.navigationPropertyBinding[o.join("/")];a=i;o=[]}else{i=undefined}break;case"EntitySet":if(n===undefined){n=t}i=t;a=i;r=i?.entityType;break;default:break}}});const h={startingEntitySet:n,targetEntityType:r,targetEntitySet:i,navigationProperties:s,contextLocation:undefined,targetObject:t.target,convertedTypes:e};h.contextLocation=h;return h};let y=function(){function e(t,e,n,i){this.convertedTypes=t;this.manifestWrapper=e;this.diagnostics=n;this.targetDataModelPath=i;this.baseContextPath=o(this.targetDataModelPath)}var n=e.prototype;n._getEntityTypeFromFullyQualifiedName=function t(e){return this.convertedTypes.entityTypes.find(t=>{if(e.startsWith(t.fullyQualifiedName)){const n=e.replace(t.fullyQualifiedName,"");return n.startsWith("/")||n.startsWith("@")}return false})};n.getAnnotationEntityType=function t(e){if(e&&typeof e==="object"){const t=e.fullyQualifiedName;const n=this._getEntityTypeFromFullyQualifiedName(t);if(!n){throw new Error(`Cannot find Entity Type for ${e.fullyQualifiedName}`)}return n}else{return this.targetDataModelPath.targetEntityType}};n.getManifestControlConfiguration=function t(e){if(p(e)){return this.manifestWrapper.getControlConfiguration(e.fullyQualifiedName.replace(this.targetDataModelPath.targetEntityType.fullyQualifiedName,""))}const n=typeof this.manifestWrapper.getEntitySet()==="string"&&this.manifestWrapper.getEntitySet().length>0;const i=typeof this.manifestWrapper.getContextPath()==="string"&&this.manifestWrapper.getContextPath().length>0;const a=e.startsWith("/");if(!this.manifestWrapper.hasMultipleEntitySets()){return this.manifestWrapper.getControlConfiguration(e)}else if(!a&&(n&&this.baseContextPath!==`/${this.manifestWrapper.getEntitySet()}`||i&&this.baseContextPath!==this.manifestWrapper.getContextPath())){return this.manifestWrapper.getControlConfiguration(`${this.baseContextPath}/${e}`)}else if(Object.keys(this.manifestWrapper.getControlConfiguration(`${this.baseContextPath}/${e}`)).length>0){return this.manifestWrapper.getControlConfiguration(`${this.baseContextPath}/${e}`)}else if(Object.keys(this.manifestWrapper.getControlConfiguration(e)).length>0){return this.manifestWrapper.getControlConfiguration(e)}return this.manifestWrapper.getControlConfiguration(`${this.baseContextPath}/${e}`)};n.getAbsoluteAnnotationPath=function t(e){if(!e){return e}if(e[0]==="/"){return e}return`${this.baseContextPath}/${e}`};n.getEntitySet=function t(){return this.targetDataModelPath.targetEntitySet};n.getContextPath=function t(){return this.baseContextPath};n.getDataModelObjectPath=function t(){return this.targetDataModelPath};n.getEntityContainer=function t(){return this.convertedTypes.entityContainer};n.getEntityType=function t(){return this.targetDataModelPath.targetEntityType};n.getParameterEntityType=function t(){const e=this.targetDataModelPath.startingEntitySet.entityType;const n=!!e.annotations?.Common?.ResultContext;return n&&e};n.getEntityTypeAnnotation=function t(n){if(!n.includes("@")){throw new Error(`Not an annotation path: '${n}'`)}const i=n.startsWith("/");let a;if(i){a=n}else{const t=this.getContextPath().split("@",1)[0];a=t.endsWith("/")?t+n:`${t}/${n}`}const r=this.resolveAbsolutePath(a);const o=u({target:r.target,visitedObjects:r.objectPath},this.convertedTypes,i?undefined:this.targetDataModelPath.contextLocation,true);return{annotation:r.target,converterContext:new e(this.convertedTypes,this.manifestWrapper,this.diagnostics,o)}};n.getTemplateType=function t(){return this.manifestWrapper.getTemplateType()};n.getConvertedTypes=function t(){return this.convertedTypes};n.getRelativeAnnotationPath=function t(e,n){return e.replace(n.fullyQualifiedName,"")};n.getEntitySetBasedAnnotationPath=function t(e){if(!e){return e}const n=this.targetDataModelPath.targetEntityType.fullyQualifiedName;if(this.targetDataModelPath.targetEntitySet||(this.baseContextPath.startsWith("/")&&this.baseContextPath.match(/\//g)||[]).length>1){let t=e.replace(n,"/");if(t.length>2&&t[0]==="/"&&t[1]==="/"){t=t.substring(1)}return this.baseContextPath+(t.startsWith("/")?t:`/${t}`)}else{return`/${e}`}};n.getManifestWrapper=function t(){return this.manifestWrapper};n.getDiagnostics=function t(){return this.diagnostics};n.resolveAbsolutePath=function t(e){return this.convertedTypes.resolvePath(e)};n.getConverterContextFor=function t(n){const i=this.convertedTypes.resolvePath(n);const a=g(i,this.convertedTypes);return new e(this.convertedTypes,this.manifestWrapper,this.diagnostics,a)};n.getAnnotationsByTerm=function t(e,n){let i=arguments.length>2&&arguments[2]!==undefined?arguments[2]:[this.getEntityType()];let a=[];i.forEach(t=>{if(t){const i=t?.annotations[e]||{};if(i){a=Object.keys(i).filter(t=>i[t].term===n).reduce((t,e)=>{t.push(i[e]);return t},a)}}});return a};n.getRelativeModelPathFunction=function t(){const e=this.targetDataModelPath;const n=this.convertedTypes;return function(t){const i=c(t,n,[]);const a=h(e,t);const r=s(a,true);if(r){return r}return i}};e.createConverterContextForMacro=function n(i,a,r,o,s,h){const f=a.isA("sap.ui.model.odata.v4.ODataMetaModel")?a:a.getModel();const c=l(f);let u=c.entitySets.find(t=>t.name===i);if(!u){u=c.singletons.find(t=>t.name===i)}if(!s||u!==s.startingEntitySet){s={startingEntitySet:u,navigationProperties:[],targetEntitySet:u,targetEntityType:u?.entityType||c.entityTypes.find(t=>t.name===i),targetObject:u,convertedTypes:c}}if(!h){h=new t({})}return new e(c,h,r,s)};n.fetchTextFromMetaModel=function t(e){return i.fetchTextFromMetaModel(e,this)};return e}();return y},false);
//# sourceMappingURL=ConverterContext.js.map