{"version":3,"file":"TemplateConverter.js","names":["handleErrorForCollectionFacets","oFacets","oDiagnostics","sEntitySetName","level","forEach","oFacet","Message","$Type","ID","addIssue","IssueCategory","Facets","IssueSeverity","High","IssueCategoryType","MissingID","Label","Medium","UnSupportedLevel","convertPage","sTemplateType","oMetaModel","oManifestSettings","manifestWrapper","sFullContextPath","oCapabilities","component","oConvertedMetadata","convertTypes","diagnostics","annotationErrorDetail","checkIfIssueExists","Annotation","message","entityTypes","oEntitySet","annotations","UI","name","sTargetEntitySetName","entitySet","sContextPath","contextPath","oContext","createBindingContext","oFullContext","getInvolvedDataModelObjects","oConvertedPage","converterContext","ConverterContext","TemplateType","ListReport","AnalyticalListPage","ListReportConverter","ObjectPage","ObjectPageConverter","FreeStylePage","extendPageDefinition","undefined","_exports"],"sources":["./TemplateConverter.ts"],"sourcesContent":["import type { EntitySet, NavigationProperty, Singleton } from \"@sap-ux/vocabularies-types\";\nimport type { FacetTypes } from \"@sap-ux/vocabularies-types/vocabularies/UI\";\nimport { UIAnnotationTypes } from \"@sap-ux/vocabularies-types/vocabularies/UI\";\nimport type TemplateComponent from \"sap/fe/core/TemplateComponent\";\nimport type ManifestWrapper from \"sap/fe/core/converters/ManifestWrapper\";\nimport { IssueCategory, IssueCategoryType, IssueSeverity } from \"sap/fe/core/converters/helpers/IssueManager\";\nimport type { EnvironmentCapabilities } from \"sap/fe/core/services/EnvironmentServiceFactory\";\nimport type { IssueDefinition } from \"sap/fe/core/support/Diagnostics\";\nimport type Context from \"sap/ui/model/Context\";\nimport type ODataMetaModel from \"sap/ui/model/odata/v4/ODataMetaModel\";\nimport ConverterContext from \"./ConverterContext\";\nimport type { BaseManifestSettings } from \"./ManifestSettings\";\nimport { TemplateType } from \"./ManifestSettings\";\nimport { convertTypes, getInvolvedDataModelObjects } from \"./MetaModelConverter\";\nimport * as ListReportConverter from \"./templates/ListReportConverter\";\nimport * as ObjectPageConverter from \"./templates/ObjectPageConverter\";\n\n// A context path for a page can either point to an EntitySet, a NavigationProperty or a Singleton\nexport type PageContextPathTarget = EntitySet | NavigationProperty | Singleton;\n\nexport type PageDefinition = {\n\ttemplate: string;\n};\n\nexport interface IDiagnostics {\n\taddIssue(\n\t\tissueCategory: IssueCategory,\n\t\tissueSeverity: IssueSeverity,\n\t\tdetails: string,\n\t\tissueCategoryType?: typeof IssueCategoryType,\n\t\tissueSubCategory?: string\n\t): void;\n\tgetIssues(): IssueDefinition[];\n\tcheckIfIssueExists(\n\t\tissueCategory: IssueCategory,\n\t\tissueSeverity: IssueSeverity,\n\t\tdetails: string,\n\t\tissueCategoryType?: typeof IssueCategoryType,\n\t\tissueSubCategory?: string\n\t): boolean;\n}\nfunction handleErrorForCollectionFacets(oFacets: FacetTypes[], oDiagnostics: IDiagnostics, sEntitySetName: string, level: number): void {\n\toFacets.forEach((oFacet) => {\n\t\tlet Message = `For entity set ${sEntitySetName}`;\n\t\tif (oFacet?.$Type === UIAnnotationTypes.CollectionFacet && !oFacet?.ID) {\n\t\t\tMessage = `${Message}, ` + `level ${level}, the collection facet does not have an ID.`;\n\t\t\toDiagnostics.addIssue(\n\t\t\t\tIssueCategory.Facets,\n\t\t\t\tIssueSeverity.High,\n\t\t\t\tMessage,\n\t\t\t\tIssueCategoryType,\n\t\t\t\tIssueCategoryType?.Facets?.MissingID\n\t\t\t);\n\t\t}\n\t\tif (oFacet?.$Type === UIAnnotationTypes.CollectionFacet && level >= 3) {\n\t\t\tMessage = `${Message}, collection facet ${oFacet.Label} is not supported at ` + `level ${level}`;\n\t\t\toDiagnostics.addIssue(\n\t\t\t\tIssueCategory.Facets,\n\t\t\t\tIssueSeverity.Medium,\n\t\t\t\tMessage,\n\t\t\t\tIssueCategoryType,\n\t\t\t\tIssueCategoryType?.Facets?.UnSupportedLevel\n\t\t\t);\n\t\t}\n\t\tif (oFacet?.$Type === UIAnnotationTypes.CollectionFacet && oFacet?.Facets) {\n\t\t\thandleErrorForCollectionFacets(oFacet?.Facets, oDiagnostics, sEntitySetName, ++level);\n\t\t\tlevel = level - 1;\n\t\t}\n\t});\n}\n/**\n * Based on a template type, convert the metamodel and manifest definition into a json structure for the page.\n * @param sTemplateType The template type\n * @param oMetaModel The odata model metaModel\n * @param oManifestSettings The current manifest settings\n * @param manifestWrapper\n * @param oDiagnostics The diagnostics wrapper\n * @param sFullContextPath The context path to reach this page\n * @param oCapabilities\n * @param component The template component\n * @returns The target page definition\n */\nexport function convertPage(\n\tsTemplateType: TemplateType,\n\toMetaModel: ODataMetaModel,\n\toManifestSettings: BaseManifestSettings,\n\tmanifestWrapper: ManifestWrapper,\n\toDiagnostics: IDiagnostics,\n\tsFullContextPath: string,\n\toCapabilities?: EnvironmentCapabilities,\n\tcomponent?: TemplateComponent\n): object | undefined {\n\tconst oConvertedMetadata = convertTypes(oMetaModel, oCapabilities);\n\t// TODO: This will have incomplete information because the conversion happens lazily\n\toConvertedMetadata.diagnostics.forEach((annotationErrorDetail) => {\n\t\tconst checkIfIssueExists = oDiagnostics.checkIfIssueExists(\n\t\t\tIssueCategory.Annotation,\n\t\t\tIssueSeverity.High,\n\t\t\tannotationErrorDetail.message\n\t\t);\n\t\tif (!checkIfIssueExists) {\n\t\t\toDiagnostics.addIssue(IssueCategory.Annotation, IssueSeverity.High, annotationErrorDetail.message);\n\t\t}\n\t});\n\toConvertedMetadata?.entityTypes?.forEach((oEntitySet) => {\n\t\tif (oEntitySet?.annotations?.UI?.Facets) {\n\t\t\thandleErrorForCollectionFacets(oEntitySet?.annotations?.UI?.Facets, oDiagnostics, oEntitySet?.name, 1);\n\t\t}\n\t});\n\tconst sTargetEntitySetName = oManifestSettings.entitySet;\n\tconst sContextPath =\n\t\toManifestSettings?.contextPath || (sFullContextPath === \"/\" ? sFullContextPath + sTargetEntitySetName : sFullContextPath);\n\tconst oContext = oMetaModel.createBindingContext(sContextPath) as Context;\n\tconst oFullContext = getInvolvedDataModelObjects<PageContextPathTarget>(oContext);\n\tif (oFullContext) {\n\t\tlet oConvertedPage = {};\n\t\tconst converterContext = new ConverterContext(oConvertedMetadata, manifestWrapper, oDiagnostics, oFullContext);\n\t\tswitch (sTemplateType) {\n\t\t\tcase TemplateType.ListReport:\n\t\t\tcase TemplateType.AnalyticalListPage:\n\t\t\t\toConvertedPage = ListReportConverter.convertPage(converterContext, oCapabilities);\n\t\t\t\tbreak;\n\t\t\tcase TemplateType.ObjectPage:\n\t\t\t\toConvertedPage = ObjectPageConverter.convertPage(converterContext, oCapabilities);\n\t\t\t\tbreak;\n\t\t\tcase TemplateType.FreeStylePage:\n\t\t\t\tbreak;\n\t\t}\n\t\tif (component?.extendPageDefinition) {\n\t\t\toConvertedPage = component.extendPageDefinition(oConvertedPage, converterContext);\n\t\t}\n\t\treturn oConvertedPage;\n\t}\n\treturn undefined;\n}\n"],"mappings":";;;;mYAyCA,SAASA,EAA+BC,EAAuBC,EAA4BC,EAAwBC,GAClHH,EAAQI,QAASC,IAChB,IAAIC,EAAU,kBAAkBJ,IAChC,GAAIG,GAAQE,QAAK,+CAA2CF,GAAQG,GAAI,CACvEF,EAAU,GAAGA,MAAc,SAASH,+CACpCF,EAAaQ,SACZC,EAAcC,OACdC,EAAcC,KACdP,EACAQ,EACAA,GAAmBH,QAAQI,UAE7B,CACA,GAAIV,GAAQE,QAAK,8CAA0CJ,GAAS,EAAG,CACtEG,EAAU,GAAGA,uBAA6BD,EAAOW,6BAA+B,SAASb,IACzFF,EAAaQ,SACZC,EAAcC,OACdC,EAAcK,OACdX,EACAQ,EACAA,GAAmBH,QAAQO,iBAE7B,CACA,GAAIb,GAAQE,QAAK,8CAA0CF,GAAQM,OAAQ,CAC1EZ,EAA+BM,GAAQM,OAAQV,EAAcC,IAAkBC,GAC/EA,EAAQA,EAAQ,CACjB,GAEF,CAaO,SAASgB,EACfC,EACAC,EACAC,EACAC,EACAtB,EACAuB,EACAC,EACAC,GAEA,MAAMC,EAAqBC,EAAaP,EAAYI,GAEpDE,EAAmBE,YAAYzB,QAAS0B,IACvC,MAAMC,EAAqB9B,EAAa8B,mBACvCrB,EAAcsB,WACdpB,EAAcC,KACdiB,EAAsBG,SAEvB,IAAKF,EAAoB,CACxB9B,EAAaQ,SAASC,EAAcsB,WAAYpB,EAAcC,KAAMiB,EAAsBG,QAC3F,IAEDN,GAAoBO,aAAa9B,QAAS+B,IACzC,GAAIA,GAAYC,aAAaC,IAAI1B,OAAQ,CACxCZ,EAA+BoC,GAAYC,aAAaC,IAAI1B,OAAQV,EAAckC,GAAYG,KAAM,EACrG,IAED,MAAMC,EAAuBjB,EAAkBkB,UAC/C,MAAMC,EACLnB,GAAmBoB,cAAgBlB,IAAqB,IAAMA,EAAmBe,EAAuBf,GACzG,MAAMmB,EAAWtB,EAAWuB,qBAAqBH,GACjD,MAAMI,EAAeC,EAAmDH,GACxE,GAAIE,EAAc,CACjB,IAAIE,EAAiB,CAAC,EACtB,MAAMC,EAAmB,IAAIC,EAAiBtB,EAAoBJ,EAAiBtB,EAAc4C,GACjG,OAAQzB,GACP,KAAK8B,EAAaC,WAClB,KAAKD,EAAaE,mBACjBL,EAAiBM,EAAoBlC,YAAY6B,EAAkBvB,GACnE,MACD,KAAKyB,EAAaI,WACjBP,EAAiBQ,EAAoBpC,YAAY6B,EAAkBvB,GACnE,MACD,KAAKyB,EAAaM,cACjB,MAEF,GAAI9B,GAAW+B,qBAAsB,CACpCV,EAAiBrB,EAAU+B,qBAAqBV,EAAgBC,EACjE,CACA,OAAOD,CACR,CACA,OAAOW,SACR,CAACC,EAAAxC,cAAA,OAAAwC,CAAA","ignoreList":[]}