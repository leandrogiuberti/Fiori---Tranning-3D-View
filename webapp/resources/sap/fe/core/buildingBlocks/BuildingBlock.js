/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)
 *      (c) Copyright 2009-2025 SAP SE. All rights reserved
 */
sap.ui.define(["sap/base/Log","sap/fe/base/BuildingBlockBase","sap/fe/base/ClassSupport","sap/fe/base/HookSupport","sap/fe/core/converters/MetaModelConverter","sap/fe/core/helpers/MetaPath","sap/fe/core/helpers/StableIdHelper","sap/ui/core/Component","sap/ui/core/ElementRegistry"],function(e,t,n,r,o,i,a,s,l){"use strict";var c,u,f,h,g,d;var p=a.generate;var b=o.getMetaModelById;var v=o.getInvolvedDataModelObjectsForTargetPath;var w=o.convertTypes;var M=r.removeControllerExtensionHookHandlers;var m=r.initControllerExtensionHookHandlers;var C=n.property;var y=n.defineUI5Class;function O(e,t,n,r){n&&Object.defineProperty(e,t,{enumerable:n.enumerable,configurable:n.configurable,writable:n.writable,value:n.initializer?n.initializer.call(r):void 0})}function P(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e,_(e,t)}function _(e,t){return _=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},_(e,t)}function B(e,t,n,r,o){var i={};return Object.keys(r).forEach(function(e){i[e]=r[e]}),i.enumerable=!!i.enumerable,i.configurable=!!i.configurable,("value"in i||i.initializer)&&(i.writable=!0),i=n.slice().reverse().reduce(function(n,r){return r(e,t,n)||n},i),o&&void 0!==i.initializer&&(i.value=i.initializer?i.initializer.call(o):void 0,i.initializer=void 0),void 0===i.initializer?(Object.defineProperty(e,t,i),null):i}function x(e,t){throw Error("Decorating class property failed. Please ensure that transform-class-properties is enabled and runs after the decorators transform.")}let A=(c=y("sap.fe.core.buildingBlocks.BuildingBlock"),u=C({type:"string"}),c(f=(h=(d=function(t){function n(e,n){var r;r=t.call(this,e,n)||this;O(r,"metaModel",g,r);r._applyingSettings=false;r.notifyBBObservers();return r}P(n,t);var r=n.prototype;r.applySettings=function e(n,r){this._applyingSettings=true;t.prototype.applySettings.call(this,n,r);this._applyingSettings=false;this._checkIfMetadataReady(true);return this};r.notifyBBObservers=function e(){let t=arguments.length>0&&arguments[0]!==undefined?arguments[0]:false;const r=n._bbobserverMap.get(this.getId());if(r&&r.length>0){for(const e of r){if(t){if(e.onDestroy){e.onDestroy(this)}}else if(e.onAvailable){e.onAvailable(this)}}}};n.observeBuildingBlock=function e(t,r){const o=l.get(t);if(o){if(r.onAvailable){r.onAvailable(o)}}else{const e=n._bbobserverMap.get(t);if(e){e.push(r)}else{n._bbobserverMap.set(t,[r])}}};r._getOwner=function e(){let t=this;let n=s.getOwnerComponentFor(t);while(!n&&t&&!t.isA("sap.ui.core.mvc.View")){t=t.getParent();if(t){n=s.getOwnerComponentFor(t)}}if(n?.isA("sap.fe.core.TemplateComponent")){return n}if(n?.isA("sap.fe.core.buildingBlocks.IBuildingBlockOwnerComponent")){return n}};r.getPageController=function t(){let n=arguments.length>0&&arguments[0]!==undefined?arguments[0]:true;const r=this._getOwner()?.getRootController?.();if(!r&&n){e.error("No sap.fe.core.PageController found")}return r};r.getMetaModel=function e(){const t=this._getOwner();if(t?.isA("sap.fe.core.buildingBlocks.IBuildingBlockOwnerComponent")){let e=t?.getMetaModel(this.metaModel);if(!e&&this.metaModel?.startsWith("id-")){e=b(this.metaModel)}return e}else{return t?.getMetaModel(this.metaModel)}};r.destroy=function e(n){if(this.isA("sap.fe.core.controllerextensions.viewState.IViewStateContributor")){this.getPageController(false)?.viewState?.deregisterStateContributor(this)}if(this.getPageController(false)){M(this,this.getPageController())}this.notifyBBObservers(true);t.prototype.destroy.call(this,n)};r._checkIfMetadataReady=function t(){let n=arguments.length>0&&arguments[0]!==undefined?arguments[0]:false;const r=this._getOwner();if(r){try{this.onMetadataAvailable(r)}catch(t){e.error(`Error creating content for building block ${this.getMetadata().getName()} with ID: ${this.getId()}`,t)}if(this.isA("sap.fe.core.controllerextensions.viewState.IViewStateContributor")){this.getPageController()?.viewState.registerStateContributor(this)}if(this.getPageController()){m(this,this.getPageController())}}else{if(!n&&!this.content){e.warning("The building block was not created within an ExtensionAPI.runWithFPMContext call, for performance reason it's recommended to do so.",this)}this.attachEventOnce("modelContextChange",function(){this._checkIfMetadataReady()})}};r.clone=function e(n,r){const o=this._getOwner();if(o){return o.runAsOwner(()=>t.prototype.clone.call(this,n,r))}else{return t.prototype.clone.call(this,n,r)}};r.onMetadataAvailable=function e(t){};r.getAppComponent=function e(){const t=this._getOwner();return t?.getAppComponent()};r.getDataModelObjectPath=function e(t){const n=this.getMetaModel();const r=t??this.getOwnerContextPath();return v(r,n)};r.getOwnerContextPath=function e(){const t=this._getOwner();return t.getFullContextPath(this.metaModel)};r.getDataModelObjectForMetaPath=function e(t,n){const r=this.getMetaModel();const i=this.getComputedContextPath(n);let a;if(i){a=i.endsWith("/")?i:i+"/"}if(!r||!(a||t.charAt(0)==="/")){throw new Error("No metamodel or metapath is not reachable with contextPath")}let s=a?r.createBindingContext(a):undefined;s=s?s:undefined;const l=r.createBindingContext(t,s);return l?o.getInvolvedDataModelObjects(l,s):undefined};r.getComputedContextPath=function e(t){let n=t??this.getOwnerContextPath();if(n&&!n.startsWith("/")){n=this.getOwnerContextPath()+n}return n};r.getMetaPathObject=function t(n,r){const o=this.getMetaModel();const a=this.getComputedContextPath(r);if(!o||!(a||n.charAt(0)==="/")){e.warning(`No metamodel or metaPath is not reachable with ${r}:${n}`);return null}try{return new i(w(o),n,a)}catch(t){if(!a.endsWith("/")){return this.getMetaPathObject(n,a+"/")}e.warning(`No metamodel or metaPath is not reachable with ${r}:${n}`);return null}};r.createId=function e(){if(this.getId()){for(var t=arguments.length,n=new Array(t),r=0;r<t;r++){n[r]=arguments[r]}return p([this.getId(),...n])}return undefined};r.getTranslatedText=function e(t,n,r){return(this.getModel("sap.fe.i18n")??this._getOwner()?.getModel("sap.fe.i18n"))?.getText(t,n,r)||t};r.getManifestWrapper=function e(){return this._getOwner()?.getManifestWrapper()};r.getOwnerPageDefinition=function e(){return this._getOwner()?.preprocessorContext?.getDefinitionForPage()};return n}(t),d._bbobserverMap=new Map,d),g=B(h.prototype,"metaModel",[u],{configurable:true,enumerable:true,writable:true,initializer:null}),h))||f);return A},false);
//# sourceMappingURL=BuildingBlock.js.map