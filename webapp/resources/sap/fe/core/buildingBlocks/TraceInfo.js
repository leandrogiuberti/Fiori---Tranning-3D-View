/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)
 *      (c) Copyright 2009-2025 SAP SE. All rights reserved
 */
sap.ui.define(["sap/base/Log","sap/ui/base/BindingInfo","sap/ui/core/util/XMLPreprocessor"],function(t,e,n){"use strict";const r=[];const i="http://schemas.sap.com/sapui5/extension/sap.fe.info/1",o="http://www.w3.org/2000/xmlns/",a=location.search.includes("sap-ui-xx-feTraceInfo=true"),s=["sap.m","sap.uxap","sap.ui.unified","sap.f","sap.ui.table","sap.suite.ui.microchart","sap.ui.layout.form","sap.ui.mdc","sap.ui.mdc.link","sap.ui.mdc.field","sap.fe.fpm"],c={};function u(t){return JSON.parse(JSON.stringify(t))}async function f(t,n,r,i){let o;const a=[];try{o=e.parse(t)||[]}catch(t){o=[]}o=Array.isArray(o)?o:[o];o.filter(function(t){return t.path||t.parts}).forEach(function(t){const e=t.parts||[t];e.filter(function(t){return t.path}).forEach(function(t){const e=n[t.model]=n[t.model]||{};const o=!t.path.includes(">")?(t.model&&`${t.model}>`)+t.path:t.path;let s;let c;if(typeof t.model==="undefined"&&o.includes(">")){c=o.split(">");t.model=c[0];t.path=c[1]}try{s=r.getContext(o);const n=r.getResult(`{${o}}`,i);a.push(n.then(function(n){if(s?.getModel().getMetadata().getName()==="sap.ui.model.json.JSONModel"){if(!n.getModel()){e[t.path]=n}else{e[t.path]=`Context from ${n.getPath()}`}}else{e[t.path]={path:s.getPath(),data:typeof n==="object"?"[ctrl/cmd-click] on path to see data":n}}return}).catch(function(){e[t.path]={bindingFor:"Runtime"}}))}catch(n){e[t.path]={bindingFor:"Runtime"}}})});return Promise.all(a)}async function l(t,e,n,r){return t.then(function(t){e[n]=r!==t?{originalValue:r,resolvedValue:t}:r;return}).catch(function(t){const i=t;e[n]={originalValue:r,error:i.stack&&i.stack.toString()||t}})}async function p(t,e){const n={};const r=[];const i={};let o;for(let a=t.attributes.length>>>0;a--;){const s=t.attributes[a],c=s.nodeName,u=t.getAttribute(c);if(!["core:require"].includes(c)){r.push(f(u,i,e,t));o=e.getResult(u,t);if(o){r.push(l(o,n,c,u))}else{}}}return Promise.all(r).then(function(){return{properties:n,contexts:i}})}async function h(e,n){try{const t=e.nodeName.split(":")[1]||e.nodeName,a=/^[A-Z]/.test(t),s={isError:false,control:`${e.namespaceURI}.${e.nodeName.split(":")[1]||e.nodeName}`,metaDataContexts:[],properties:{}};if(a){const t=[...e.ownerDocument.children].find(t=>!t.nodeName.startsWith("#"));if(t&&!t.getAttribute("xmlns:trace")){t.setAttributeNS(o,"xmlns:trace",i);t.setAttributeNS(i,"trace:is","on")}return await p(e,n).then(async function(t){const o=Object.keys(t.contexts).length>0;if(o){Object.assign(s,t);s.viewInfo=n.getViewInfo();s.macroInfo=n.getSettings()["_macroInfo"];s.traceID=r.length;e.setAttributeNS(i,"trace:traceID",s.traceID.toString());r.push(s)}return n.visitAttributes(e)}).then(async function(){return n.visitChildNodes(e)}).catch(function(t){s.error={exception:t,node:(new XMLSerializer).serializeToString(e)}})}else{await n.visitAttributes(e);await n.visitChildNodes(e)}}catch(r){t.error(`Error while tracing '${e?.nodeName}': ${r.message}`,"TraceInfo");return n.visitAttributes(e).then(async function(){return n.visitChildNodes(e)})}}if(a){s.forEach(function(t){c[t]=n.plugIn(h.bind(t),t)})}function m(t,e,n,a,s){try{let c=e.metadataContexts&&Object.keys(e.metadataContexts)||[];const f=e.properties&&Object.keys(e.properties)||[];const l=u(s.getSettings()["_macroInfo"]||{});const p={isError:false,macro:t,metaDataContexts:[],properties:{}};if(c.length===0){c=Object.keys(n).filter(function(t){return t!=="this"})}if(!a.getAttribute("xmlns:trace")){a.setAttributeNS(o,"xmlns:trace",i)}if(c.length>0){c.forEach(function(t){const e=n[t],r=e&&{name:t,path:e.getPath()};if(r){p.metaDataContexts.push(r)}});f.forEach(function(t){const e=n.this.getObject(t);if(e){p.properties[t]=e}});p.viewInfo=s.getViewInfo();p.traceID=r.length;l.parentMacroID=l.macroID;l.macroID=p.traceID.toString();p.macroInfo=l;a.setAttributeNS(i,"trace:macroID",p.traceID.toString());r.push(p)}return p}catch(e){return{isError:true,error:{exception:e,node:(new XMLSerializer).serializeToString(a)},name:t,contextPath:s?.getContext()?.getPath(),metaDataContexts:[],properties:{}}}}function d(t){if(t){return r[t]}const e=r.filter(function(t){return t.error});return e.length>0&&e||r}function g(){return a}return{isTraceInfoActive:g,traceMacroCalls:m,getTraceInfo:d}},true);
//# sourceMappingURL=TraceInfo.js.map