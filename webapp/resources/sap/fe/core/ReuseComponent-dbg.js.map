{"version":3,"names":["ReuseComponent","_dec","defineUI5Class","_dec2","property","type","_dec3","event","_class","_class2","_FPMComponent","_this","_len","arguments","length","args","Array","_key","call","_initializerDefineProperty","_descriptor","_descriptor2","hooksApplied","_inheritsLoose","_proto","prototype","setContainer","container","router","getRouter","initialize","applyHooks","pageController","getPageComponent","getRootController","controllerExtensionOverrideName","override","controllerExtensionOverride","pageControllerExtension","Log","error","hookName","attachHook","String","handlerFunction","getView","attachBeforeExit","fireEvent","createContent","attachModelContextChange","bind","Promise","resolve","rootControlCreated","setAggregation","aggregationName","object","suppressInvalidate","rootControl","getContextPath","contextPath","startsWith","currentView","CommonUtils","getCurrentPageView","getAppComponent","parentContextPath","getViewData","entitySet","getViewName","rootViewName","getManifestEntry","rootView","viewName","Error","parent","getParent","Component","getOwnerComponentFor","getExtensionAPI","FPMComponent","_applyDecoratedDescriptor","configurable","enumerable","writable","initializer"],"sourceRoot":".","sources":["ReuseComponent.ts"],"sourcesContent":["import Log from \"sap/base/Log\";\nimport { defineUI5Class, event, property } from \"sap/fe/base/ClassSupport\";\nimport CommonUtils from \"sap/fe/core/CommonUtils\";\nimport type ExtensionAPI from \"sap/fe/core/ExtensionAPI\";\nimport type TemplateComponent from \"sap/fe/core/TemplateComponent\";\nimport FPMComponent from \"sap/fe/core/fpm/Component\";\nimport type ManagedObject from \"sap/ui/base/ManagedObject\";\nimport Component from \"sap/ui/core/Component\";\nimport type ComponentContainer from \"sap/ui/core/ComponentContainer\";\nimport type Control from \"sap/ui/core/Control\";\n\n@defineUI5Class(\"sap.fe.core.ReuseComponent\")\nclass ReuseComponent extends FPMComponent {\n\t@property({ type: \"object\" })\n\toverride?: Record<string, object>;\n\n\t// event that is fired once the component is initialized\n\t@event()\n\tinitialized!: Function;\n\n\tcontainer!: ComponentContainer;\n\n\thooksApplied = false;\n\n\trootControlCreated!: (control: Control) => void;\n\n\t/**\n\t * Sets the container of the component.\n\t *\n\t * This is being called by UI5. We override this method to keep track of the container and to initialize the router.\n\t * @param container The container\n\t * @returns The instance of the component\n\t */\n\tsetContainer(container: ComponentContainer): this {\n\t\tsuper.setContainer(container);\n\t\tthis.container = container;\n\n\t\tconst router = this.getRouter();\n\t\tif (router) {\n\t\t\t// once the container is set, we can initialize the router\n\t\t\trouter.initialize();\n\t\t}\n\n\t\treturn this;\n\t}\n\n\tapplyHooks(): void {\n\t\ttype FunctionMap = {\n\t\t\t[key: string]: Function;\n\t\t};\n\t\ttype DeepFunctionMap = {\n\t\t\t[key: string]: FunctionMap;\n\t\t};\n\n\t\tif (this.hooksApplied || !this.container) {\n\t\t\treturn;\n\t\t}\n\t\tconst pageController = this.getPageComponent().getRootController();\n\n\t\tif (!pageController) {\n\t\t\treturn;\n\t\t}\n\n\t\tfor (const controllerExtensionOverrideName in this.override) {\n\t\t\tconst controllerExtensionOverride = this.override[controllerExtensionOverrideName];\n\t\t\tconst pageControllerExtension = (pageController as unknown as DeepFunctionMap)[controllerExtensionOverrideName];\n\n\t\t\tif (!pageControllerExtension) {\n\t\t\t\tLog.error(`The controller extension ${controllerExtensionOverrideName} does not exist in the page controller.`);\n\t\t\t\tcontinue;\n\t\t\t}\n\t\t\tfor (const hookName in controllerExtensionOverride) {\n\t\t\t\tconst attachHook = pageControllerExtension[`attach${String(hookName)}`];\n\t\t\t\tif (!attachHook) {\n\t\t\t\t\tLog.error(`The hook ${hookName} does not exist in the page controller extension ${controllerExtensionOverrideName}.`);\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\t\t\t\tconst handlerFunction = (controllerExtensionOverride as FunctionMap)[hookName];\n\n\t\t\t\tattachHook(handlerFunction);\n\t\t\t\tpageController.getView().attachBeforeExit(() => {\n\t\t\t\t\tthis.hooksApplied = false;\n\t\t\t\t\tpageControllerExtension[`detach${String(hookName)}`](handlerFunction);\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\t\tthis.hooksApplied = true;\n\t\tthis.fireEvent(\"initialized\");\n\t}\n\n\t/**\n\t * Creates the content of the component.\n\t *\n\t * This is being called by UI5. We override this method to implement our own template logic\n\t * and to inform UI5 when the root control is being created.\n\t * @returns A promise that resolves with the root control\n\t */\n\tasync createContent(): Promise<Control> {\n\t\tthis.attachModelContextChange(this.applyHooks.bind(this));\n\n\t\treturn new Promise((resolve) => {\n\t\t\tthis.rootControlCreated = resolve;\n\t\t});\n\t}\n\n\t/**\n\t * Sets an aggregation of the component.\n\t *\n\t * This is being called by UI5. We override this method to know when the rootControl is being set.\n\t * @param aggregationName The name of the aggregation\n\t * @param object The object to set\n\t * @param suppressInvalidate Whether to suppress invalidation\n\t * @returns The instance of the component\n\t */\n\tsetAggregation(aggregationName: string, object: ManagedObject, suppressInvalidate?: boolean): this {\n\t\tif (aggregationName === \"rootControl\") {\n\t\t\tconst rootControl = object as Control;\n\t\t\tthis.rootControlCreated(rootControl);\n\t\t}\n\t\treturn super.setAggregation(aggregationName, object, suppressInvalidate);\n\t}\n\n\tgetContextPath(): string {\n\t\tconst contextPath = this.contextPath;\n\t\tif (contextPath?.startsWith(\"/\")) {\n\t\t\t// absolute path\n\t\t\treturn contextPath;\n\t\t} else {\n\t\t\t// relative path - we need to prepend the context path of the parent view\n\t\t\tconst currentView = CommonUtils.getCurrentPageView(this.getAppComponent());\n\t\t\tconst parentContextPath = currentView.getViewData().contextPath || \"/\" + currentView.getViewData().entitySet;\n\t\t\tif (contextPath) {\n\t\t\t\treturn parentContextPath + \"/\" + contextPath;\n\t\t\t} else {\n\t\t\t\treturn parentContextPath;\n\t\t\t}\n\t\t}\n\t}\n\n\t/**\n\t * Returns the view name of the reuse component.\n\t * This is being called by the template service to create the view.\n\t * @returns The view name\n\t */\n\tgetViewName(): string {\n\t\tconst rootViewName = this.getManifestEntry(\"sap.ui5\").rootView?.viewName;\n\t\tif (!rootViewName && !this.viewName) {\n\t\t\tthrow new Error(\"No root view defined in the manifest nor viewName set in the component\");\n\t\t}\n\t\treturn rootViewName || this.viewName;\n\t}\n\n\t/**\n\t * Returns the page component that owns the reuse component.\n\t * @returns The page component\n\t */\n\tgetPageComponent(): TemplateComponent {\n\t\t// the owner of the reuse component is not the page component but the app component.\n\t\t// we rely on the parent of the container to be the owned by the page component\n\t\t// and get the extensionAPI from there. If the parent is not a control, we throw an error\n\t\tconst parent = this.container?.getParent();\n\t\tif (!parent) {\n\t\t\tthrow new Error(\"The parent of the reuse component is not yet set. Thus, the page component cannot be retrieved.\");\n\t\t}\n\t\treturn Component.getOwnerComponentFor(parent) as TemplateComponent;\n\t}\n\n\t/**\n\t * Returns the extension API of the page component that owns the reuse component.\n\t * @returns The extension API\n\t */\n\tgetExtensionAPI(): ExtensionAPI {\n\t\treturn this.getPageComponent().getExtensionAPI();\n\t}\n}\n\nexport default ReuseComponent;\n"],"mappings":"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","ignoreList":[],"file":"ReuseComponent-dbg.js"}