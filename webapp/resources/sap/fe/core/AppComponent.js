/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)
 *      (c) Copyright 2009-2025 SAP SE. All rights reserved
 */
sap.ui.define(["sap/base/Log","sap/fe/base/ClassSupport","sap/fe/core/AppStateHandler","sap/fe/core/controllerextensions/routing/RouterProxy","sap/fe/core/helpers/HTTP503Handler","sap/fe/core/helpers/ModelHelper","sap/fe/core/helpers/PromiseKeeper","sap/fe/core/library","sap/fe/core/manifestMerger/ChangePageConfiguration","sap/fe/core/support/Diagnostics","sap/m/routing/Router","sap/ui/core/Lib","sap/ui/core/UIComponent","sap/ui/model/json/JSONModel","sap/ui/model/odata/type/Currency","sap/ui/model/odata/type/Unit","./controllerextensions/BusyLocker","./converters/MetaModelConverter","./helpers/ResourceModelHelper"],function(e,t,i,r,o,n,a,s,c,l,u,f,d,p,g,h,C,v,S){"use strict";var m,R,y,M,N,A;var E=S.getResourceModel;var b=v.deleteModelCacheData;var w=c.changeConfiguration;var I=t.implementInterface;var _=t.defineUI5Class;function P(e,t,i,r){i&&Object.defineProperty(e,t,{enumerable:i.enumerable,configurable:i.configurable,writable:i.writable,value:i.initializer?i.initializer.call(r):void 0})}function V(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e,T(e,t)}function T(e,t){return T=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},T(e,t)}function O(e,t,i,r,o){var n={};return Object.keys(r).forEach(function(e){n[e]=r[e]}),n.enumerable=!!n.enumerable,n.configurable=!!n.configurable,("value"in n||n.initializer)&&(n.writable=!0),n=i.slice().reverse().reduce(function(i,r){return r(e,t,i)||i},n),o&&void 0!==n.initializer&&(n.value=n.initializer?n.initializer.call(o):void 0,n.initializer=void 0),void 0===n.initializer?(Object.defineProperty(e,t,n),null):n}function F(e,t){throw Error("Decorating class property failed. Please ensure that transform-class-properties is enabled and runs after the decorators transform.")}const H=s.StartupMode;const L={FCL:{VIEWNAME:"sap.fe.core.rootView.Fcl",VIEWNAME_COMPATIBILITY:"sap.fe.templates.RootContainer.view.Fcl",ROUTERCLASS:"sap.f.routing.Router"},NAVCONTAINER:{VIEWNAME:"sap.fe.core.rootView.NavContainer",VIEWNAME_COMPATIBILITY:"sap.fe.templates.RootContainer.view.NavContainer",ROUTERCLASS:"sap.m.routing.Router"}};const k=u;let D=(m=_("sap.fe.core.AppComponent",{config:{fullWidth:true},manifest:{_version:"2.0.0","sap.ui5":{services:{viewPreloaderService:{factoryName:"sap.fe.core.services.ViewPreloaderService",startup:"waitFor"},resourceModel:{factoryName:"sap.fe.core.services.ResourceModelService",startup:"waitFor",settings:{bundles:["sap.fe.core.messagebundle"],modelName:"sap.fe.i18n"}},routingService:{factoryName:"sap.fe.core.services.RoutingService",startup:"waitFor"},shellServices:{factoryName:"sap.fe.core.services.ShellServices",startup:"waitFor"},ShellUIService:{factoryName:"sap.ushell.ui5service.ShellUIService"},navigationService:{factoryName:"sap.fe.core.services.NavigationService",startup:"waitFor"},environmentCapabilities:{factoryName:"sap.fe.core.services.EnvironmentService",startup:"waitFor"},sideEffectsService:{factoryName:"sap.fe.core.services.SideEffectsService",startup:"waitFor"},asyncComponentService:{factoryName:"sap.fe.core.services.AsyncComponentService",startup:"waitFor"},collaborationManagerService:{factoryName:"sap.fe.core.services.CollaborationManagerService",startup:"waitFor"},collaborativeToolsService:{factoryName:"sap.fe.core.services.CollaborativeToolsService",startup:"waitFor"},telemetryService:{factoryName:"sap.fe.core.services.TelemetryService",startup:"waitFor"},valueHelpHistoryService:{factoryName:"sap.fe.core.services.ValueHelpHistoryService",startup:"waitFor"},CollaborativeDraftService:{factoryName:"sap.fe.core.services.CollaborativeDraftService",startup:"waitFor"},ContextSharingService:{factoryName:"sap.fe.core.services.ContextSharingService",startup:"waitFor"},inlineEditService:{factoryName:"sap.fe.core.services.InlineEditService",startup:"waitFor"}},rootView:{viewName:L.NAVCONTAINER.VIEWNAME,id:"appRootView"},routing:{config:{controlId:"appContent",routerClass:L.NAVCONTAINER.ROUTERCLASS,viewType:"XML",controlAggregation:"pages",containerOptions:{propagateModel:true}}}}},designtime:"sap/fe/core/designtime/AppComponent.designtime",library:"sap.fe.core"}),R=I("sap.ui.core.IAsyncContentCreation"),m(y=(M=(A=function(t){function c(){var e;for(var i=arguments.length,r=new Array(i),o=0;o<i;o++){r[o]=arguments[o]}e=t.call(this,...r)||this;P(e,"__implements__sap_ui_core_IAsyncContentCreation",N,e);e.additionalConfiguration={};e.startupMode=H.Normal;e._startedServices=[];e.isAdaptationEnabled=false;e.isExiting=false;e.pageConfigurationChanges={};e.suspended=false;e.discardPromise=Promise.resolve();return e}V(c,t);var u=c.prototype;u.getAdditionalConfiguration=function e(){return this.additionalConfiguration};u._isFclEnabled=function e(){const t=this.getManifestEntry("sap.ui5");return t?.routing?.config?.routerClass===L.FCL.ROUTERCLASS};u.setAdaptationMode=function e(t){this.isAdaptationEnabled=t};u.isAdaptationMode=function e(){return this.isAdaptationEnabled};c.registerConfigurationHandlers=function e(t){this.configurationHandlers.push(t)};u.initializeFeatureToggles=async function e(){return Promise.resolve()};u.changePageConfiguration=function e(t,i,r){const o=w(this.getManifest(),t,i,r,true,this);if(i==="app/disableInputAssistance"&&o?.["sap.fe"]?.["app"]?.["disableInputAssistance"]===r){this.getEnvironmentCapabilities().setCapability("DisableInputAssistance",r)}};u.cleanPageConfigurationChanges=function e(){this.pageConfigurationChanges={}};u.getRouterProxy=function e(){return this._oRouterProxy};u.getAppStateHandler=function e(){return this._oAppStateHandler};u.getRootViewController=function e(){return this.getRootControl().getController()};u.getRootContainer=function e(){return this.getRootControl().getContent()[0]};u.getStartupMode=function e(){return this.startupMode};u.setStartupModeCreate=function e(){this.startupMode=H.Create};u.setStartupModeAutoCreate=function e(){this.startupMode=H.AutoCreate};u.setStartupModeDeeplink=function e(){this.startupMode=H.Deeplink};u.init=function e(){const o=new URLSearchParams(window.location.search);if(o.has("sap-ui-xx-fe-support")){setTimeout(function(){f.load({name:"sap.fe.tools"})},2e3)}this._initializedKeeper=new a;this.initialized=this._initializedKeeper.promise;const u=new p({editMode:s.EditMode.Display,isEditable:false,draftStatus:s.DraftStatus.Clear,busy:false,busyLocal:{},pages:{}});const d=new p({pages:{}});u.setDefaultBindingMode("OneWay");n.enhanceUiJSONModel(u,s);n.enhanceInternalJSONModel(d);this.setModel(u,"ui");this.setModel(d,"internal");this.bInitializeRouting=this.bInitializeRouting!==undefined?this.bInitializeRouting:true;this._oRouterProxy=new r;this._oAppStateHandler=new i(this);this._oDiagnostics=new l;const g=this.getModel();if(g?.isA?.("sap.ui.model.odata.v4.ODataModel")){n.enhanceODataModel(g,this);g.setRetryAfterHandler(this.http503RetryHandler.bind(this));this.entityContainer=g.getMetaModel().requestObject("/$EntityContainer/")}else{this.entityContainer=Promise.resolve()}if(this.getManifestEntry("sap.fe")?.app?.disableCollaborationDraft){n.disableCollaborationDraft=true}const h=this.getManifest()["sap.ui5"];this.checkRoutingConfiguration(h);c._customManifestChecks.forEach(e=>e.call(this,h));t.prototype.init.call(this);c.instanceMap[this.getId()]=this};u.http503RetryHandler=async function e(t){return o.handle503Delay(t,this.getRootControl(),E(this))};u.checkRoutingConfiguration=function t(i){if(i?.rootView?.viewName){if(i.rootView.viewName===L.FCL.VIEWNAME_COMPATIBILITY){i.rootView.viewName=L.FCL.VIEWNAME}else if(i.rootView.viewName===L.NAVCONTAINER.VIEWNAME_COMPATIBILITY){i.rootView.viewName=L.NAVCONTAINER.VIEWNAME}if(i.rootView.viewName===L.FCL.VIEWNAME&&i.routing?.config?.routerClass===L.FCL.ROUTERCLASS){e.info(`Rootcontainer: "${L.FCL.VIEWNAME}" - Routerclass: "${L.FCL.ROUTERCLASS}"`)}else if(i.rootView.viewName===L.NAVCONTAINER.VIEWNAME&&i.routing?.config?.routerClass===L.NAVCONTAINER.ROUTERCLASS){e.info(`Rootcontainer: "${L.NAVCONTAINER.VIEWNAME}" - Routerclass: "${L.NAVCONTAINER.ROUTERCLASS}"`)}else if(i.rootView?.viewName?.includes("sap.fe.core.rootView")){throw Error(`\nWrong configuration for the couple (rootView/routerClass) in manifest file.\n`+`Current values are :(${i.rootView.viewName}/${i.routing?.config?.routerClass||"<missing router class>"})\n`+`Expected values are \n`+`\t - (${L.NAVCONTAINER.VIEWNAME}/${L.NAVCONTAINER.ROUTERCLASS})\n`+`\t - (${L.FCL.VIEWNAME}/${L.FCL.ROUTERCLASS})`)}else{e.info(`Rootcontainer: "${i.rootView.viewName}" - Routerclass: "${L.NAVCONTAINER.ROUTERCLASS}"`)}}};u.onServicesStarted=async function t(i){this._startedServices=i;await Promise.all(c.configurationHandlers.map(async e=>e(this.additionalConfiguration)));await this.initializeFeatureToggles();await Promise.allSettled(c.instanceDependentProcesses.map(async e=>e.call(null,this)));const r=()=>{this.entityContainer.then(async()=>{if(this.getRootViewController().attachRouteMatchers){this.getRootViewController().attachRouteMatchers()}this.getRouter().initialize();this.getRouterProxy().init(this,this._isFclEnabled());return this.getValueHelpHistoryService().registerShellHook()}).catch(e=>{const t=f.getResourceBundleFor("sap.fe.core");this.getRootViewController().displayErrorPage(t.getText("C_APP_COMPONENT_SAPFE_APPSTART_TECHNICAL_ISSUES"),{title:t.getText("C_COMMON_SAPFE_ERROR"),description:e.message})})};if(this.bInitializeRouting){return this.getRoutingService().initializeRouting().then(()=>{if(this.getRootViewController()){r()}else{this.getRootControl().attachAfterInit(function(){r()})}this._initializedKeeper.resolve();return}).catch(function(t){e.error(`cannot cannot initialize routing: ${t.toString()}`)})}else{this._initializedKeeper.resolve()}};u.exit=function e(){this._startedServices=[];this._oAppStateHandler.destroy();this._oRouterProxy.destroy();delete this._oAppStateHandler;delete this._oRouterProxy;b(this.getMetaModel());this.getModel("ui").destroy();this.cleanPageConfigurationChanges()};u.getMetaModel=function e(){return this.getModel().getMetaModel()};u.getDiagnostics=function e(){return this._oDiagnostics};u.destroy=function i(r){this.isExiting=true;try{delete c.instanceMap[this.getId()];delete window._routing}catch(t){e.info(t)}const o=this.oModels[undefined];let n;if(o?.oRequestor){n=Object.assign({},o.oRequestor.mHeaders)}this.getRoutingService()?.beforeExit?.();this.unregisterCallbacks();t.prototype.destroy.call(this,r);if(n&&o.oRequestor){o.oRequestor.mHeaders=n}};u.getRoutingService=function e(){return{}};u.getShellServices=function e(){return{}};u.getNavigationService=function e(){return{}};u.getSideEffectsService=function e(){return{}};u.getEnvironmentCapabilities=function e(){return{}};u.getCollaborationManagerService=function e(){return{}};u.getViewPreloaderService=function e(){return{}};u.getCollaborativeToolsService=function e(){return{}};u.getCollaborativeDraftService=function e(){return{}};u.getContextSharingService=function e(){return{}};u.getTelemetryService=function e(){return{}};u.getValueHelpHistoryService=function e(){return{}};u.getInlineEditService=function e(){return{}};u.getStartupParameters=async function e(){const t=this.getComponentData();return Promise.resolve(t&&t.startupParameters||{})};u.restore=function e(){for(const e of this._startedServices){e.onRestore?.()}this.getRootViewController().viewState.onRestore();i.resetVersionActivationStatus();this.suspended=false};u.suspend=function e(){for(const e of this._startedServices){e.onSuspend?.()}this.getRootViewController().viewState.onSuspend();this.suspended=true};u.isSuspended=function e(){return this.suspended};u.isAppComponentBusy=async function e(){return this.discardPromise};u.navigateBasedOnStartupParameter=async function t(i){try{if(!C.isLocked(this.getModel("ui"))){if(!i){i=null}const e=this.getRoutingService();await e._manageDeepLinkStartup(i)}}catch(t){e.error(t);C.unlock(this.getModel("ui"))}};u.isCollaborationManagerServiceEnabled=function e(){return true};c.registerInstanceDependentProcessForStartUp=function e(t){this.instanceDependentProcesses.push(t)};c.registerInitChecks=function e(t){this._customManifestChecks.push(t)};u.registerCallbacks=function e(t,i,r){this.dirtyStateProviderCallback=t;this.getShellServices().registerDirtyStateProvider(t);if(r){this.stickySessionTimeoutCallback=r;this.getModel().attachSessionTimeout(r)}this.discardAfterNavigationCallback=i;this._routeMatchHandler=()=>{if(this.discardAfterNavigationCallback){this.discardPromise=this.discardAfterNavigationCallback()}};this.getRoutingService().attachRouteMatched({},this._routeMatchHandler)};u.unregisterCallbacks=function e(){if(this.dirtyStateProviderCallback){this.getShellServices().deregisterDirtyStateProvider(this.dirtyStateProviderCallback);this.dirtyStateProviderCallback=undefined}if(this.stickySessionTimeoutCallback&&this.getModel()){this.getModel().detachSessionTimeout(this.stickySessionTimeoutCallback);this.stickySessionTimeoutCallback=undefined}if(this._routeMatchHandler){this.getRoutingService().detachRouteMatched(this._routeMatchHandler);this._routeMatchHandler=undefined;this.discardAfterNavigationCallback=undefined}};u._isEmbedded=function e(){return!!this.getComponentData().feEnvironment};return c}(d),A.instanceMap={},A.configurationHandlers=[],A.instanceDependentProcesses=[],A._customManifestChecks=[],A),N=O(M.prototype,"__implements__sap_ui_core_IAsyncContentCreation",[R],{configurable:true,enumerable:true,writable:true,initializer:function(){return true}}),M))||y);return D},false);
//# sourceMappingURL=AppComponent.js.map