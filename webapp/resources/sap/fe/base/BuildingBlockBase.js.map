{"version":3,"file":"BuildingBlockBase.js","names":["BuildingBlockBase","_dec","defineUI5Class","_dec2","aggregation","type","multiple","isDefault","_dec3","association","singularName","_dec4","defineState","_class","_class2","_Control","settings","others","scope","_this","id","call","this","_initializerDefineProperty","_descriptor","_descriptor2","_descriptor3","_oldDomRef","_inheritsLoose","render","oRm","oControl","content","getVisible","InvisibleRenderer","renderControl","_proto","prototype","bindProperty","name","bindingInfo","propertyMetadata","getMetadata","getProperty","bindable","group","onAfterRendering","event","domRef","getDomRef","WeakRef","suffix","oContent","deref","document","getElementById","getFocusDomRef","enhanceAccessibilityState","_oElement","mAriaProps","oParent","getParent","getAccessibilityInfo","accessibilityInfo","isA","getIdForLabel","addStyleClass","styleClass","removeStyleClass","bindState","path","BindingToolkit","state","Control","_applyDecoratedDescriptor","configurable","enumerable","writable","initializer"],"sources":["./BuildingBlockBase.ts"],"sourcesContent":["import type { ConstantExpression, PathInModelExpression, PrimitiveType } from \"sap/fe/base/BindingToolkit\";\nimport * as BindingToolkit from \"sap/fe/base/BindingToolkit\";\nimport type { PropertiesOf, StateOf } from \"sap/fe/base/ClassSupport\";\nimport { aggregation, association, defineState, defineUI5Class } from \"sap/fe/base/ClassSupport\";\nimport type ManagedObject from \"sap/ui/base/ManagedObject\";\nimport type { PropertyBindingInfo } from \"sap/ui/base/ManagedObject\";\nimport Control from \"sap/ui/core/Control\";\nimport type UI5Element from \"sap/ui/core/Element\";\nimport InvisibleRenderer from \"sap/ui/core/InvisibleRenderer\";\nimport type RenderManager from \"sap/ui/core/RenderManager\";\nimport type { AccessibilityInfo } from \"sap/ui/core/library\";\n\ninterface BuildingBlockBase<T extends UI5Element = Control, K extends object = {}> {\n\t// Force a state update\n\t_updateState(): Promise<void>;\n}\n\n/**\n * Base class for building blocks.\n * This contains the low level functionality of having a content aggregation and handling the rendering of the content without an actual DOM element.\n * The building block also defines a state object that can be used to store the state of the building block.\n * Accessibility and classes information are forwarded to the content control.\n * @public\n */\n@defineUI5Class(\"sap.fe.base.BuildingBlockBase\")\nclass BuildingBlockBase<T extends UI5Element = Control, K extends object = {}> extends Control {\n\t@aggregation({ type: \"sap.ui.core.Element\", multiple: false, isDefault: true })\n\tcontent?: T;\n\n\t/**\n\t * Association to controls / IDs that label this control (see WAI-ARIA attribute aria-labelledby).\n\t */\n\t@association({ type: \"sap.ui.core.Control\", multiple: true, singularName: \"ariaLabelledBy\" })\n\tariaLabelledBy!: string[];\n\n\t@defineState()\n\tprotected state!: StateOf<K>;\n\n\tconstructor(settings?: string | PropertiesOf<BuildingBlockBase<T>>, others?: PropertiesOf<BuildingBlockBase<T>>, scope?: object) {\n\t\tif (typeof settings === \"string\") {\n\t\t\tothers ??= {};\n\t\t\tothers.id = settings;\n\t\t}\n\t\t// Scope is defined and is there, but somehow doesn't appear on all the children of ManagedObject\n\t\t// eslint-disable-next-line @typescript-eslint/ban-ts-comment\n\t\t// @ts-ignore\n\t\tsuper(settings as unknown as string, others, scope);\n\t}\n\n\tprivate _oldDomRef: WeakRef<Element> | null = null;\n\n\tstatic render<T extends Control>(oRm: RenderManager, oControl: BuildingBlockBase<T>): void {\n\t\tif (!oControl.content || oControl.getVisible() === false) {\n\t\t\tInvisibleRenderer.render(oRm, oControl);\n\t\t} else {\n\t\t\toRm.renderControl(oControl.content);\n\t\t}\n\t}\n\n\t/**\n\t * Override the bindProperty to deal with the case where the property is a binding info.\n\t * @param name The name of te property\n\t * @param bindingInfo The binding info\n\t * @returns The instance of the building block for chaining\n\t */\n\toverride bindProperty(name: string, bindingInfo: PropertyBindingInfo): this {\n\t\tconst propertyMetadata = this.getMetadata().getProperty(name);\n\t\tif (propertyMetadata?.bindable === false && propertyMetadata.group === \"Data\") {\n\t\t\t(this as Record<string, unknown>)[name] = bindingInfo;\n\t\t} else {\n\t\t\tsuper.bindProperty(name, bindingInfo);\n\t\t}\n\t\treturn this;\n\t}\n\n\t//set the old dom ref\n\toverride onAfterRendering(event: JQuery.Event): void {\n\t\tconst domRef = this.getDomRef();\n\t\tif (domRef) {\n\t\t\tthis._oldDomRef = new WeakRef(domRef);\n\t\t} else {\n\t\t\tthis._oldDomRef = null;\n\t\t}\n\t\tsuper.onAfterRendering(event);\n\t}\n\n\toverride getDomRef(suffix?: string): Element | null {\n\t\tconst oContent = this.content;\n\t\tlet domRef: Element | null = oContent?.getDomRef(suffix) ?? super.getDomRef(suffix);\n\t\tif (!domRef && !suffix) {\n\t\t\tdomRef = this._oldDomRef?.deref() ?? null;\n\t\t\tif (domRef) {\n\t\t\t\treturn document.getElementById(domRef.id);\n\t\t\t}\n\t\t}\n\t\treturn domRef;\n\t}\n\n\toverride getFocusDomRef(): Element | null {\n\t\tconst oContent = this.content;\n\t\treturn oContent ? oContent.getFocusDomRef() : super.getFocusDomRef();\n\t}\n\n\t/**\n\t * This function asks up the control tree to enhance the accessibility state of the control.\n\t * @param _oElement The element to enhance\n\t * @param mAriaProps The current aria properties\n\t * @returns The enhanced aria properties\n\t */\n\toverride enhanceAccessibilityState(_oElement: object, mAriaProps: object): object {\n\t\tconst oParent = this.getParent();\n\n\t\tif (oParent && (oParent as ManagedObject & { enhanceAccessibilityState?: Function }).enhanceAccessibilityState) {\n\t\t\t// forward  enhanceAccessibilityState call to the parent\n\t\t\t(oParent as ManagedObject & { enhanceAccessibilityState: Function }).enhanceAccessibilityState(_oElement, mAriaProps);\n\t\t}\n\n\t\treturn mAriaProps;\n\t}\n\n\t/**\n\t * This function (if available on the concrete control) provides the current accessibility state of the control.\n\t * @returns The accessibility information for the control.\n\t */\n\toverride getAccessibilityInfo(): AccessibilityInfo {\n\t\tlet accessibilityInfo = {};\n\t\tif (this.content?.isA<Control>(\"sap.ui.core.Control\") && this.content.getAccessibilityInfo) {\n\t\t\taccessibilityInfo = this.content.getAccessibilityInfo();\n\t\t}\n\t\treturn accessibilityInfo;\n\t}\n\n\t/**\n\t * Returns the DOMNode ID to be used for the \"labelFor\" attribute.\n\t *\n\t * We forward the call of this method to the content control.\n\t * @returns ID to be used for the <code>labelFor</code>\n\t */\n\toverride getIdForLabel(): string {\n\t\tif (this.content?.isA<Control>(\"sap.ui.core.Control\")) {\n\t\t\treturn this.content.getIdForLabel();\n\t\t}\n\t\treturn \"\";\n\t}\n\n\toverride addStyleClass(styleClass: string): this {\n\t\t(this.content as unknown as Control)?.addStyleClass(styleClass);\n\t\tsuper.addStyleClass(styleClass);\n\t\treturn this;\n\t}\n\n\toverride removeStyleClass(styleClass: string): this {\n\t\t(this.content as unknown as Control)?.removeStyleClass(styleClass);\n\t\tsuper.removeStyleClass(styleClass);\n\t\treturn this;\n\t}\n\n\t/**\n\t * Shorthand for the BindingToolkit.bindState function with the current state object.\n\t * @param path A property in the state object\n\t * @returns The binding toolkit expression for the state\n\t */\n\tprotected bindState<ST extends PrimitiveType>(path: keyof K): PathInModelExpression<ST> | ConstantExpression<ST> {\n\t\treturn BindingToolkit.bindState(this.state as K, path);\n\t}\n}\n\nexport default BuildingBlockBase;\n"],"mappings":"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","ignoreList":[]}