/*!
 * SAPUI5
 * (c) Copyright 2025 SAP SE. All rights reserved.
 */
sap.ui.define(["sap/ui/thirdparty/jquery","./CalendarDate","./library","sap/ui/core/Control","sap/ui/core/LocaleData","sap/ui/core/IconPool","sap/ui/core/date/UniversalDate","sap/m/library","sap/ui/core/Icon","./CalendarRenderer","sap/ui/Device","sap/base/Log"],function(jQuery,e,t,a,s,i,n,o,r,l,p,h){"use strict";var u=t.CalendarEventType;var g=t.CalendarSelectionMode;var f=t.CalendarDesign;var D=a.extend("sap.me.Calendar",{metadata:{library:"sap.me",properties:{visible:{type:"boolean",group:"Misc",defaultValue:true},hideNavControls:{type:"boolean",group:"Misc",defaultValue:false},hideMonthTitles:{type:"boolean",group:"Misc",defaultValue:false},monthsPerRow:{type:"int",group:"Misc",defaultValue:1},dayWidth:{type:"int",group:"Misc",defaultValue:45},dayHeight:{type:"int",group:"Misc",defaultValue:50},weeksPerRow:{type:"int",group:"Misc",defaultValue:1},singleRow:{type:"boolean",group:"Misc",defaultValue:null},monthsToDisplay:{type:"int",group:"Misc",defaultValue:1},currentDate:{type:"string",group:"Misc",defaultValue:null},enableMultiselection:{type:"boolean",group:"Misc",defaultValue:false},firstDayOffset:{type:"int",group:"Misc",defaultValue:0},disabledWeekDays:{type:"any",group:"Misc",defaultValue:null},disabledDates:{type:"any",group:"Misc",defaultValue:null},swipeToNavigate:{type:"boolean",group:"Misc",defaultValue:false},design:{type:"sap.me.CalendarDesign",group:"Appearance",defaultValue:f.Approval},selectionMode:{type:"sap.me.CalendarSelectionMode",group:"Behavior",defaultValue:g.SINGLE},width:{type:"sap.ui.core.CSSSize",group:"Dimension",defaultValue:"100%"},days:{type:"any",group:"Appearance",defaultValue:null},months:{type:"any",group:"Appearance",defaultValue:null}},events:{tapOnDate:{parameters:{date:{type:"string"},didSelect:{type:"boolean"}}},changeCurrentDate:{parameters:{currentDate:{type:"string"}}},changeRange:{parameters:{fromDate:{type:"string"},toDate:{type:"string"}}}}}});D.prototype.init=function(){this.__setCurrentDate((new e).toDateString(),true);var t=o.getLocaleData();this.setDays(t.getDays("abbreviated"));this.setMonths(t.getMonths("abbreviated"));var a=new r({src:i.getIconURI("navigation-left-arrow")});a.addStyleClass("sapMeCalendarPrevious");a.attachPress(null,this._gotoPrevious,this);a.setParent(this);this._oPrevBtn=a;var n=new r({src:i.getIconURI("navigation-right-arrow")});n.addStyleClass("sapMeCalendarNext");n.attachPress(null,this._gotoNext,this);n.setParent(this);this._oNextBtn=n;this._oDatesClasses={};this._$interactiveDates=null;this._oLocale=sap.ui.getCore().getConfiguration().getFormatSettings().getFormatLocale();this._oLocaleData=s.getInstance(this._oLocale);this._bRtl=sap.ui.getCore().getConfiguration().getRTL()};D.prototype.exit=function(){this._oPrevBtn.destroy();delete this._oPrevBtn;this._oNextBtn.destroy();delete this._oNextBtn;delete this._oDatesClasses;delete this._$interactiveDates;delete this._$fromDate;delete this._$toDate};D.prototype.onBeforeRendering=function(){delete this._$interactiveDates};D.prototype.onAfterRendering=function(){var e=this.$();var t=null;var a=this.getDisabledWeekDays()||[];var s=[];var i;var n;for(i=0;i<a.length;i++){s.push(".sapMeCalendarWeekDay"+a[i])}var o=this.getSingleRow()||this.getMonthsToDisplay()===1;if(!o){s.push(".sapMeCalendarDayNotInCurrentMonth")}if(s.length){var r=s.join(", ");e.find(".sapMeCalendarMonth > div.sapMeCalendarMonthDays").children(r).css({"pointer-events":"none"});t=e.find(".sapMeCalendarMonth > div.sapMeCalendarMonthDays > .sapMeCalendarMonthDay:not("+r+")")}else{t=e.find(".sapMeCalendarMonth > div.sapMeCalendarMonthDays > .sapMeCalendarMonthDay")}var l=this.getDisabledDates()||[];for(i=0;i<l.length;i++){n=l[i];t.children("input[value='"+n+"']").parent().css({"pointer-events":"none"})}for(n in this._oDatesClasses){var p=this._oDatesClasses[n].join(" ");t.children("input[value='"+n+"']").parent().addClass(p)}this._$interactiveDates=t;var h=this.getHideNavControls();this._oPrevBtn.$().css({display:h?"none":""});this._oNextBtn.$().css({display:h?"none":""})};D.prototype.setEnableMultiselection=function(e){return this.setProperty("selectionMode",e?g.MULTIPLE:g.SINGLE,true)};D.prototype.getEnableMultiselection=function(){return this.getProperty("selectionMode")==g.MULTIPLE};D.prototype.setHideNavControls=function(e){if(this.getDomRef()){this._oPrevBtn.$().css({display:e?"none":""});this._oNextBtn.$().css({display:e?"none":""})}return this.setProperty("hideNavControls",e,true)};D.prototype.setHideMonthTitles=function(e){if(this.getDomRef()){this.$().find(".sapMeCalendarMonthName").css({visibility:e?"hidden":""})}return this.setProperty("hideMonthTitles",e,true)};D.prototype.setFirstDayOffset=function(e){e=e%this.getDays().length;return this.setProperty("firstDayOffset",e)};D.prototype.setWeeksPerRow=function(e){e=e%5;return this.setProperty("weeksPerRow",e)};D.prototype.setDisabledWeekDays=function(e){e=e||[];return this.setProperty("disabledWeekDays",e)};D.prototype.setDisabledDates=function(t){t=t||[];var a;for(a=0;a<t.length;a++){var s=t[a];if(typeof s==="string"){s=e.parseFromToDateString(s)}var i=s.toDateString();t[a]=i}return this.setProperty("disabledDates",t)};D.prototype.ontouchstart=function(e){if(!this.getSwipeToNavigate()){this._gestureStart(e)}};D.prototype._gestureStart=function(e){this._$fromDate=this.getEnableMultiselection()?this._getDateDomRef(e.target):null};D.prototype.ontouchmove=function(e){if(!this.getSwipeToNavigate()){this._gestureMove(e)}};D.prototype._gestureMove=function(e){if(this._$fromDate){if(!this._$toDate){this._$fromDate.addClass("sapMeCalendarHighlight");this._$toDate=this._$fromDate}e.stopPropagation();e.preventDefault();var t=e.target;if(e.touches.length){var a=e.touches[0];t=document.elementFromPoint(a.clientX,a.clientY)}var s=this._getDateDomRef(t);if(s&&s!=this._$toDate){this._$toDate.removeClass("sapMeCalendarHighlight");this._$fromDate.addClass("sapMeCalendarHighlight");s.addClass("sapMeCalendarHighlight");this._$toDate=s}}};D.prototype.ontouchend=function(e){if(!this.getSwipeToNavigate()){this._gestureEnd(e)}};D.prototype._gestureEnd=function(e){if(this._$fromDate&&this._$toDate){e.stopPropagation();e.preventDefault();var t=this._getDateValue(this._$fromDate);var a=this._getDateValue(this._$toDate);this._$fromDate.removeClass("sapMeCalendarHighlight");this._$toDate.removeClass("sapMeCalendarHighlight");this.toggleDatesRangeSelection(t,a,true);this.fireChangeRange({fromDate:t,toDate:a})}delete this._$fromDate;delete this._$toDate};D.prototype.ontap=function(e){this._gestureSelect(e)};D.prototype._gestureSelect=function(e){var t=this._getDateDomRef(e.target);if(p.browser.msie&&p.browser.version<11){if(t.css("pointer-events")=="none"){return}}if(t){var a=this._getDateValue(t);var s=!t.hasClass("sapMeCalendarSelected");if(!this.getEnableMultiselection()){if(this.getSelectionMode()==g.SINGLE){this.unselectAllDates()}else if(this.getSelectedDates().length>1){this.unselectAllDates()}}if(this.getSelectionMode()==g.RANGE&&this.getSelectedDates().length==1){var i=this.getSelectedDates()[0];this.toggleDatesRangeSelection(i,a,true);this.fireChangeRange({fromDate:i,toDate:a})}else{t.toggleClass("sapMeCalendarSelected",s);this._updateDatesWithClass("sapMeCalendarSelected",a,s);this.fireTapOnDate({didSelect:s,date:a})}}};D.prototype.onswipeleft=function(e){if(this.getSwipeToNavigate()){if(!this._bRtl){this._gotoNext()}else{this._gotoPrevious()}}};D.prototype.onswiperight=function(e){if(this.getSwipeToNavigate()){if(!this._bRtl){this._gotoPrevious()}else{this._gotoNext()}}};D.prototype.getSelectedDates=function(){return this._getDatesWithStyleClass("sapMeCalendarSelected")};D.prototype.toggleDatesSelection=function(e,t){this._toggleDatesStyleClass("sapMeCalendarSelected",e,t)};D.prototype.toggleDatesType=function(e,t,a){this._toggleDatesStyleClass("sapMeCalendar"+t,e,a)};D.prototype.removeTypesOfAllDates=function(){this._removeStyleClassOfAllDates("sapMeCalendar"+u.Type00);this._removeStyleClassOfAllDates("sapMeCalendar"+u.Type01);this._removeStyleClassOfAllDates("sapMeCalendar"+u.Type04);this._removeStyleClassOfAllDates("sapMeCalendar"+u.Type06);this._removeStyleClassOfAllDates("sapMeCalendar"+u.Type07);this._removeStyleClassOfAllDates("sapMeCalendar"+u.Type10)};D.prototype.unselectAllDates=function(){this._removeStyleClassOfAllDates("sapMeCalendarSelected")};D.prototype.toggleDatesRangeSelection=function(e,t,a){this._toggleDatesRangeStyleClass("sapMeCalendarSelected",e,t,a)};D.prototype._getDatesWithStyleClass=function(e){var t=[];var a;for(a in this._oDatesClasses){if(this._oDatesClasses[a]&&this._oDatesClasses[a].indexOf(e)!==-1){t.push(a)}}return t};D.prototype._toggleDatesRangeStyleClass=function(t,a,s,i){var o;var r;if(typeof a=="string"){o=e.parseFromToDateString(a)}else if(a instanceof Date){o=new n(a.getTime())}if(typeof s=="string"){r=e.parseFromToDateString(s)}else if(s instanceof Date){r=new n(s.getTime())}if(o&&r&&typeof o.getTime=="function"&&typeof r.getTime=="function"){if(o.getTime()>r.getTime()){var l=new n(o.getTime());o=r;r=l}var p=[];var h=new n(o.getTime());var u;while(r-h>=0){u=new Date(h.getTime());p.push(u.toDateString());h.setDate(h.getDate()+1)}this._toggleDatesStyleClass(t,p,i)}};D.prototype._toggleDatesStyleClass=function(t,a,s){var i;for(i=0;i<a.length;i++){var o=a[i];if(typeof o=="string"){o=e.parseFromToDateString(o)}else if(o instanceof Date){o=new n(o.getTime())}o=new Date(o.getTime());var r=o.toDateString();a[i]=r;this._updateDatesWithClass(t,r,s);if(this._$interactiveDates){this._$interactiveDates.children("input[value='"+r+"']").parent().toggleClass(t,s)}}};D.prototype._removeStyleClassOfAllDates=function(e){var t;for(t in this._oDatesClasses){this._updateDatesWithClass(e,t,false)}if(this._$interactiveDates){this._$interactiveDates.removeClass(e)}};D.prototype._gotoPrevious=function(){var e=this.getSingleRow();if(e){this._oInternalDate.previousWeek()}else{this._oInternalDate.previousMonth()}var t=this._oInternalDate.toDateString();this.setCurrentDate(t);this.fireChangeCurrentDate({currentDate:t})};D.prototype._gotoNext=function(){var e=this.getSingleRow();if(e){this._oInternalDate.nextWeek()}else{this._oInternalDate.nextMonth()}var t=this._oInternalDate.toDateString();this.setCurrentDate(t);this.fireChangeCurrentDate({currentDate:t})};D.prototype._updateDatesWithClass=function(e,t,a){var s=this._oDatesClasses[t]||[];var i=s.indexOf(e);if(a&&i===-1){s.push(e)}else if(!a&&i!==-1){s.splice(i,1)}if(s.length===0){this._oDatesClasses[t]=null;delete this._oDatesClasses[t]}else{this._oDatesClasses[t]=s}};D.prototype._getDateValue=function(e){return e.children("input").eq(0).val()};D.prototype._getMonthDate=function(e){var t=jQuery(e);var a=jQuery(this.getDomRef());while(t&&t!=a&&!t.hasClass("sapMeCalendarMonthDay")){t=t.parent()}return t&&t.parent().hasClass("sapMeCalendarMonth")?t:null};D.prototype._getDateDomRef=function(e){var t=e?jQuery(e):null;var a=this.getId();var s=null;while(t&&t[0].id!=a&&!t.hasClass("sapMeCalendarMonth")){if(t.hasClass("sapMeCalendarMonthDay")&&t.parent().hasClass("sapMeCalendarMonthDays")){s=t;break}t=t.parent()}return s};D.prototype._checkLanguageRegion=function(e,t){return t===this._oLocale.getRegion()&&e===this._oLocale.getLanguage()};D.prototype._getIntervalPattern=function(e){return this._oLocaleData.getIntervalPattern(e)};D.prototype.getCurrentDate=function(){return this._oInternalDate.toDateString()};D.prototype.setCurrentDate=function(e){this.__setCurrentDate(e,false);return this};D.prototype.__setCurrentDate=function(t,a){this._oInternalDate=new e(e.parseFromToDateString(t));this.setProperty("currentDate",this._oInternalDate.toDateString(),a)};D.parseDate=function(t){var a=e.parseFromToDateString(t,true);return new Date(a.getTime())};D.prototype._getCalendarFirstDate=function(){var e=new n(this._oInternalDate._date.getTime());if(this.getSingleRow()){e.setHours(12);var t=e.getDay()-this.getFirstDayOffset();var a;if(t<0){a=(7-Math.abs(t))%7}else{a=t}e.setDate(e.getDate()-a)}else{h.error("You cannot use this method in a non single row calendar, returning current date.")}return e};D.prototype.isWeekend=function(e){var t=this._oLocaleData.getWeekendStart(),a=this._oLocaleData.getWeekendEnd(),s=false;if(t<=a){s=t<=e&&e<=a}else{s=e>=t||e<=a}return s};return D});
//# sourceMappingURL=Calendar.js.map