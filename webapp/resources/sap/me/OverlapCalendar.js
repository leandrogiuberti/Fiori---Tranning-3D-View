/*!
 * SAPUI5
 * (c) Copyright 2025 SAP SE. All rights reserved.
 */
sap.ui.define(["sap/ui/thirdparty/jquery","./Calendar","./CalendarDate","./library","sap/ui/core/Control","sap/ui/core/theming/Parameters","sap/ui/core/date/UniversalDate","sap/m/Label","./OverlapCalendarRenderer","sap/base/Log","sap/ui/Device"],function(jQuery,e,t,a,r,s,i,n,l,o,p){"use strict";var d=r.extend("sap.me.OverlapCalendar",{metadata:{library:"sap.me",properties:{startDate:{type:"string",group:"Data",defaultValue:null},weeksPerRow:{type:"int",group:"Appearance",defaultValue:2},firstDayOffset:{type:"int",group:"Appearance",defaultValue:0},showOverlapIndicator:{type:"boolean",group:"Appearance",defaultValue:false},visible:{type:"boolean",group:"Appearance",defaultValue:true},swipeToNavigate:{type:"boolean",group:"Behavior",defaultValue:true},width:{type:"sap.ui.core.CSSSize",group:"Dimension",defaultValue:"100%"}},aggregations:{calendarEvents:{type:"sap.me.OverlapCalendarEvent",multiple:true,singularName:"calendarEvent"},calendar:{type:"sap.me.Calendar",multiple:false,visibility:"hidden"},typeLabels:{type:"sap.m.Label",multiple:true,singularName:"typeLabel",visibility:"hidden"},nameLabels:{type:"sap.m.Label",multiple:true,singularName:"nameLabel",visibility:"hidden"}},events:{endOfData:{parameters:{before:{type:"boolean"}}},changeDate:{parameters:{firstDate:{type:"object"},lastDate:{type:"object"}}}}}});d.prototype.init=function(){this.setAggregation("calendar",new e({singleRow:true,weeksPerRow:this.getWeeksPerRow(),monthsPerRow:1,monthsToDisplay:1,dayWidth:48,dayHeight:48,swipeToNavigate:this.getSwipeToNavigate()}));this.getCalendar().attachChangeCurrentDate(this.onCurrentDateChanged,this);this._typeWithBgImages=["04","07"];this._oDaysOverlap={};this._bRtl=sap.ui.getCore().getConfiguration().getRTL()};d.prototype.onswiperight=function(e){if(this.getSwipeToNavigate()){this.getCalendar().onswiperight(e)}};d.prototype.onswipeleft=function(e){if(this.getSwipeToNavigate()){this.getCalendar().onswipeleft(e)}};d.prototype.setSwipeToNavigate=function(e){this.getCalendar().setSwipeToNavigate(e);this.setProperty("swipeToNavigate",e,true);return this};d.prototype._getFirstDateDisplayed=function(){var e=this.getCalendar().getFirstDayOffset();var t=this._createDateInDays(this.getStartDate());var a=t.getDate();var r=t.getDay();t.setDate(1);var s=r+1-e;t.setDate(a-s+1);return t};d.prototype._getLastDateDisplayed=function(){var e=this.getCalendar().getDays();var t=e.length;var a=this.getCalendar().getWeeksPerRow();var r=a*t;var s=this._getFirstDateDisplayed();var i=this._createDateInDays(s.getTime());i.setDate(i.getDate()+r-1);return i};d.prototype.setWeeksPerRow=function(e){this.getCalendar().setWeeksPerRow(e);this.setProperty("weeksPerRow",e);return this};d.prototype.getCalendar=function(){return this.getAggregation("calendar")};d._ctorSafeDate=function(e){var t=e;if(e instanceof i){t=e.getTime()}return t};d._getJSDate=function(e){var t=e;if(e instanceof i){t=new Date(e.getTime())}return t};d.prototype.setStartDate=function(e){var t=d._ctorSafeDate(e);this.getCalendar().setFirstDayOffset(0);this.getCalendar().setCurrentDate(t);this.setProperty("startDate",t);var a=this._getDaysOffset(this._createDateInDays(t),this._getFirstDateDisplayed());this.getCalendar().setFirstDayOffset(a);return this};d.prototype.onCurrentDateChanged=function(e){this.setProperty("startDate",e.getParameter("currentDate"),true);this.getCalendar().invalidate();this._renderCalendarEvents();this.fireChangeDate({firstDate:d._getJSDate(this._getFirstDateDisplayed()),endDate:d._getJSDate(this._getLastDateDisplayed())})};d.prototype.onBeforeRendering=function(){this._cleanUp();this._aRows=[];this._lastDate=null;this._firstDate=null;var e=this.getCalendarEvents();jQuery.each(e,jQuery.proxy(this._parseCalendarEvent,this))};d.prototype.onAfterRendering=function(){this._renderCalendarEvents();p.resize.attachHandler(this._onResize,this)};d.prototype._onResize=function(){if(this._sDelayedResize){clearInterval(this._sDelayedResize)}this._sDelayedResize=setTimeout(this._fireRecomputeElementsSizes.bind(this),200)};d.prototype.exit=function(){this._cleanUp()};d.prototype._cleanUp=function(){p.resize.detachHandler(this._onResize,this)};d.prototype._fireRecomputeElementsSizes=function(){var e=this.$();var t=e.find(".sapMeOverlapCalendarHalfDay");jQuery.merge(t,e.find(".sapMeOverlapCalendarRowLabels"));this._sizeElementsToParent(t)};d.prototype._getDayId=function(e){var t=this._createDateInDays(this._getFirstDateDisplayed());return this._getDaysOffset(t,this._createDateInDays(e))};d.prototype._cleanUpDivs=function(){var e=this.$();e.find(".sapMeOverlapCalendarDay").removeClass().addClass("sapMeOverlapCalendarDay");e.find(".sapMeOverlapCalendarHalfDay").remove();e.find(".sapMeOverlapCalendarDay.sapMeOverlapCalendarDayWithHalf").removeClass(".sapMeOverlapCalendarDayWithHalf");e.find(".sapMeOverlapCalendarOverlap").css("background-color","transparent").css("border","none");e.find(".sapMeOverlapCalendarTypeLbl").remove()};d.prototype._renderCalendarEvents=function(){var e;this._mHalfDays={};this._cleanUpDivs();this._oDaysOverlap={};var t=this.getCalendarEvents();jQuery.each(t,jQuery.proxy(this._renderCalendarEvent,this));jQuery.each(this._mHalfDays,jQuery.proxy(this._renderHalfDayCalendarEvent,this));if(this.getShowOverlapIndicator()){for(e in this._oDaysOverlap){if(this._oDaysOverlap[e]!=undefined&&this._oDaysOverlap[e]>1){var a=jQuery(document.getElementById(this._provideId("overlap",e)));a.css("background-color",s.get("sapMeOverlapCalendarIndicator"));a.css("border-right","1px solid "+s.get("sapMeOverlapCalendarIndicator"))}}}if(this._firstDate&&this._lastDate){var r=this._getFirstDateDisplayed();r.setDate(r.getDate()+7);var i=this._getLastDateDisplayed();i.setDate(i.getDate()-7);if(this._dayIsBefore(this._lastDate,r)){this.fireEndOfData({before:false})}else if(this._dayIsAfter(this._firstDate,i)){this.fireEndOfData({before:true})}}};d.prototype._provideId=function(){var e=jQuery.makeArray(arguments).join("-");return this.getId()+"-"+e};d.prototype._addToDayOverlap=function(e){if(this._oDaysOverlap[e]==undefined){this._oDaysOverlap[e]=0}this._oDaysOverlap[e]++};d.prototype._getDaysOffset=function(e,t){return Math.abs(this._getRawDaysDifference(e,t))};d.prototype._getDaysDifference=function(e,t){return this._getRawDaysDifference(e,t)};d.prototype._getRawDaysDifference=function(e,t){var a=864e5;var r=e.getTime();var s=t.getTime();var i=r-s;return Math.round(i/a)};d.prototype._dayIsAfter=function(e,t){return this._getDaysDifference(e,t)>0};d.prototype._dayIsBefore=function(e,t){return this._getDaysDifference(e,t)<0};d.prototype._createDateInDays=function(e){var a=d._ctorSafeDate(e);var r=new Date(a);return t.createDate(r.getUTCFullYear(),r.getUTCMonth(),r.getUTCDate())};d.prototype._sizeElementsToParent=function(e){var t=e!==null&&e.length?e.length:0;var a,r;var s,i,n;for(s=0;s<t;s++){a=jQuery(e[s]);if(a){r=a.parent();i=r.width();n=r.height();a.width(i).height(n)}}};d.prototype._renderHalfDayCalendarEvent=function(e,t){var a=t[0];var r=jQuery(document.getElementById(e));var s=a.getType();var i=this._typeWithBgImages.indexOf(s)>-1;r.addClass("sapMeOverlapCalendarDayWithHalf");var n=jQuery("<div></div>");n.addClass("sapMeOverlapCalendarHalfDay").addClass("sapMeOverlapCalendarType"+s+"HalfDayStart");r.append(n);var l=null;if(t.length>1){var o=t[1];var p=o.getType();l=jQuery("<div></div>");l.addClass("sapMeOverlapCalendarHalfDay").addClass("sapMeOverlapCalendarType"+p+"HalfDayEnd")}else if(i){l=jQuery("<div></div>");l.addClass("sapMeOverlapCalendarHalfDay").addClass("sapMeOverlapCalendarTypeHalfDayEnd")}if(l!==null){r.append(l)}this._sizeElementsToParent([n,l])};d.prototype._defineFirstAndLastDates=function(e,t){if(this._lastDate==undefined){this._lastDate=t}if(this._dayIsAfter(t,this._lastDate)){this._lastDate=t}if(this._firstDate==undefined){this._firstDate=e}if(this._dayIsBefore(e,this._firstDate)){this._firstDate=e}};d.prototype._renderCalendarEvent=function(e,t){var a=this._createDateInDays(t.getStartDay());var r=this._createDateInDays(t.getEndDay());this._defineFirstAndLastDates(a,r);var s=this._getFirstDateDisplayed();var i=this._getLastDateDisplayed();if(!this._dayIsBefore(r,s)&&!this._dayIsAfter(a,i)){var n=t.getRow();var l=this._dayIsAfter(a,s)?a:s;r=this._dayIsAfter(r,i)?i:r;var o=this._getDaysOffset(l,r)+1;var p=this._getDaysOffset(s,l);var d="sapMeOverlapCalendarType"+t.getType();var h;var f;if(t.getHalfDay()===true){f=this._getDayId(l);var y=this._provideId(n,f);if(this._mHalfDays[y]==undefined){this._mHalfDays[y]=[];h=jQuery(document.getElementById(y))}this._mHalfDays[y].push(t)}else{while(!this._dayIsAfter(l,r)){f=this._getDayId(l);this._addToDayOverlap(f);h=jQuery(document.getElementById(this._provideId(n,f)));h.addClass(d);l.setDate(l.getDate()+1)}}if(h!=undefined){this._createEventLabel(t,l,o,p)}}};d.prototype._createEventLabel=function(e,t,a,r){var s=e.getTypeName();if(s&&s.length>0){var i=e.getRow();var n=this._provideId(i,this._getDayId(t));var l=this._provideId("row",i,"lbls");var o=jQuery(document.getElementById(l));o.width(jQuery(document.getElementById(this.getId())).width());var p=this._provideId("lbl",n);if(jQuery(document.getElementById(p)).length===0){var d=jQuery("<label dir='Inherit' id='"+p+"'>"+s+"</label>");o.append(d);d.addClass("sapMeOverlapCalendarTypeLbl sapMLabel");this._modifyLabel(d,a,r)}}};d.prototype._modifyLabel=function(e,t,a){var r=100/(this.getCalendar().getWeeksPerRow()*7);var s=t*r;e.width(s+"%");var i=a*r;var n=a==0?1:.5;var l=i+"%";if(this._bRtl){e.css("right",l);e.css("padding-right",n+"rem");e.css("text-align","right")}else{e.css("left",l);e.css("padding-left",n+"rem")}};d.prototype._parseCalendarEvent=function(e,t){var a=t.getRow();if(a!=-1){if(t.getName()!=undefined){if(this._aRows[a]==undefined&&t.getName()!=""){this._aRows[a]=t.getName()}}else{o.debug("Calendar event has no name")}}else{o.debug("Invalid calendar event row")}};d.prototype._getLabelForRow=function(e){return this._getLabel(this._aRows[e],"nameLabels").addStyleClass("sapMeOverlapCalendarNameLbl")};d.prototype._getLabel=function(e,t){var a=new n({text:e});this.addAggregation(t,a,true);return a};return d});
//# sourceMappingURL=OverlapCalendar.js.map