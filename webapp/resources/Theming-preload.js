//@ui5-bundle Theming-preload.js
/*!
 * OpenUI5
 * (c) Copyright 2025 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.predefine("sap/ui/core/theming/ThemeManager", ["sap/base/assert","sap/base/Eventing","sap/base/future","sap/base/Log","sap/base/i18n/Localization","sap/ui/base/OwnStatics","sap/ui/VersionInfo","sap/ui/core/Theming","sap/ui/core/theming/ThemeHelper","sap/ui/dom/includeStylesheet"],function(e,t,n,i,s,r,o,a,l,d){"use strict";const c=/\.sapUiThemeDesignerCustomCss/i;const u="sap.ui.core.theming.ThemeManager";const f="sap-ui-core-customcss";const m="sap-ui-theme-";const h=`^${m}(.*)`;const g=new RegExp(h);const b=new RegExp(`${h}-(?=\\[(.*)\\]).*$`);const p=new t;const v=new Map;const{attachChange:y,registerThemeManager:L,getThemePath:$}=r.get(a);let k;let T=Promise.resolve();let E=false;let S=null;let w=null;let I=null;let C;let U;function N(){const e=a.getTheme();return!l.isStandardTheme(e)&&a.getThemeRoot(e)}const R=o.load().then(e=>{C=e.version;U=new Set(e.libraries.map(e=>e.name))},e=>{if(N()){i.error("UI5 theming lifecycle requires valid version information when a theming service is active. Please check why the version info could not be loaded in this system.",e,u)}});const F={themeLoaded:true};function P(e){function t(e){const t={id:"",libName:"",linkId:"",cssLinkElement:null,cssLoaded:null,failed:false,customCss:false,fileName:"library",variant:"",themeFallback:false,getUrl:function(e){const t=t=>{e??=a.getTheme();if(U&&!U.has(this.libName)&&!l.isStandardTheme(e)&&a.getThemeRoot(e,this.libName)){e=w||I;if(!e){return undefined}}const n=new URL($(this.libName,e),document.baseURI).toString();const i=this.variant||"";let r;const o=this.libName.indexOf(":");if(this.libName&&o==-1){r=`${n}${this.fileName}${i}${s.getRTL()?"-RTL":""}.css`}else{r=`${n}${this.libName.substring(o+1)}${i}.css`}const d=document.createElement("link");d.href=`${r}${t?"":`?sap-ui-dist-version=${C||k||""}`}`;return d.href};return{urlPromise:R.then(t),url:t(),baseUrl:t(true)}}};const n=Object.assign(t,e);if(n.id===f){n.fileName="custom";n.libName="sap.ui.core"}n.linkId=`${n.id===f?"":m}${n.id}`;n.cssLinkElement??=document.querySelector(`link[id='${n.linkId}']`);return n}e.id??=`${e.libName}${e.variant?`-[${e.variant}]`:""}`;if(!v.has(e.id)){e=t(e);v.set(e.id,e)}else{e=v.get(e.id)}return e}function O(t){const{libName:n,variant:i,version:s}=t;e(typeof n==="string","libName must be a string");e(i===undefined||typeof i==="string","variant must be a string or undefined");if(n==="sap.ui.core"){k=s}if(!v.has(n)){if(n==="sap.ui.legacy"||n==="sap.ui.classic"){return}const e=P({libName:n,variant:i});if(!e.cssLinkElement){A({libInfo:e,suppressFOUC:true});sap.ui.require("sap/ui/core/theming/Parameters")?._addLibraryTheme(e.id)}}}function A({libInfo:e,theme:t,suppressFOUC:n,force:s}){if(n){T=Promise.resolve();F.themeLoaded=false;i.debug(`Register theme change for library ${e.id}`,undefined,u)}if(!C&&N()){i.error("UI5 theming lifecycle requires valid version information when a theming service is active. Please check why the version info could not be loaded in this system.",undefined,u)}const r=e.cssLinkElement?.getAttribute("href");const o=r?.replace(/\?.*/,"");const a=e.getUrl(t).baseUrl;if(!a||o!==a||s){e.finishedLoading=false;e.failed=false;if(n){z(e.linkId)}const o=e.getUrl(t).urlPromise.then(t=>{if(t){i.debug(`Add new CSS for library ${e.id} with URL: ${t}`,undefined,u);return d({url:s?r:t,id:e.linkId})}else{const t=document.createElement("link");t.setAttribute("id",e.linkId);t.setAttribute("rel","stylesheet");if(e.cssLinkElement){e.cssLinkElement.parentNode.replaceChild(t,e.cssLinkElement)}else{document.head.insertBefore(t,document.getElementById(f))}e.cssLinkElement=t;return Promise.reject()}});if(e.cssLoaded){e.cssLoaded.aborted=true}q(e,o,n)}}function q(e,t,n){e.cssLoaded=t.finally(function(){if(!e.cssLoaded.aborted){e.finishedLoading=true;document.querySelector(`link[data-sap-ui-foucmarker='${e.linkId}']`)?.remove();e.cssLinkElement=document.getElementById(`${e.linkId}`);i.debug(`New stylesheet loaded and old stylesheet removed for library: ${e.id}`,undefined,u)}}).then(function(){if(!e.cssLoaded.aborted){B(e.id)}}).catch(function(){if(!e.cssLoaded.aborted){j(e.id)}}).finally(function(){if(!e.cssLoaded.aborted){M(e.id);T=Promise.allSettled([...v.values()].map(e=>e.cssLoaded));T.finally(function(){if(this===T){i.debug("Theme change finished",undefined,u);if(n||!F.themeLoaded){F.themeLoaded=true;p.fireEvent("applied",{theme:a.getTheme()})}}}.bind(T))}})}function x(e,t){for(const[,n]of v){A({libInfo:n,themeName:e,suppressFOUC:t})}}function M(e){const t=a.getTheme();const n=v.get(e);l.reset();if(!E||S!=t){if(!l.isStandardTheme(t)&&D(e)){const e=P({id:f});A({libInfo:e,suppressFOUC:true});E=true;S=t;i.debug("Delivered custom CSS needs to be loaded, Theme not yet applied",undefined,u)}else if(E){document.querySelector(`LINK[id='${f}']`)?.remove();v.delete(f);i.debug("Custom CSS removed",undefined,u);E=false}}if(!I){const n=a.getThemeRoot(t,e);if(n){const e=/~v=[^\/]+\(([a-zA-Z0-9_]+)\)/;I=e.exec(n)?.[1];if(I){I=l.validateAndFallbackTheme(I)}}}const s=w||I;if(s){for(const[e,r]of v){if(r.failed){i.warning(`Custom theme '${t}' could not be loaded for library '${e}'. Falling back to its base theme '${s}'.`,undefined,u);A({libInfo:r,theme:s,suppressFOUC:true});n.themeFallback=true}}}}function B(e){if(!w){const t=l.getMetadata(e);if(t&&t.Extends&&t.Extends[0]){w=t.Extends[0]}}}function j(e){const t=P({id:e});if(!l.isStandardTheme(a.getTheme())&&!t.themeFallback){if(t.cssLinkElement&&!(t.cssLinkElement.sheet&&H(t.cssLinkElement.sheet))){t.failed=true}}}function D(e){const t=window.document.getElementById(`${m}${e}`);if(!t){return false}const s=window.getComputedStyle(t,":after");let r=s?s.getPropertyValue("content"):null;if(r&&r!=="none"){try{if(r[0]==="'"||r[0]==='"'){r=r.substring(1,r.length-1)}return r==="true"}catch(e){n.errorThrows("Custom check: Error parsing JSON string for custom.css indication.",{cause:e})}}const o=t.sheet?_(t.sheet):null;if(!o||o.length===0){i.warning(`Custom check: Failed retrieving a CSS rule from stylesheet ${e}`,undefined,u);return false}for(let e=0;e<2&&e<o.length;e++){if(c.test(o[e].selectorText)){return true}}return false}function z(e){const t=document.getElementById(e);if(t){t.dataset.sapUiFoucmarker=e}}function V(e){const t=document.documentElement;const n=e.new;for(const[,e]of v){delete e.themeFallback}w=I=null;i.debug(`ThemeManager: Theme changed from ${e.old} to ${n}`,undefined,u);x(n,true);t.classList.remove(`sapUiTheme-${e.old}`);t.classList.add(`sapUiTheme-${n}`)}function _(e){try{return e.cssRules}catch(e){return null}}function H(e){const t=_(e);return!!t&&t.length>0}document.querySelectorAll(`link[id^=${m}]`).forEach(function(e){let t=true;const n=e.getAttribute("id");const[,s,r]=n.match(b)||n.match(g);const o=P({libName:s,variant:r,linkId:n});i.info(`Preloaded CSS for library ${s+(r?` with variant ${r} `:"")} detected: ${e.href}`,undefined,u);const{promise:a,resolve:l,reject:d}=Promise.withResolvers();const c=function(e){if(e){d()}else{l()}};try{t=!!(e.sheet?.href===e.href&&e.sheet?.cssRules);if(!t){F.themeLoaded=t;e.addEventListener("load",()=>{c(false)});e.addEventListener("error",()=>{c(true)})}else{c(!(e.sheet.cssRules.length>0))}q(o,a,true)}catch(e){i.info("Could not detect ready state of preloaded CSS. Request stylesheet again to verify the response status",undefined,u);F.themeLoaded=false;A({libInfo:o,suppressFOUC:true,force:true})}});document.documentElement.classList.add("sapUiTheme-"+a.getTheme());i.info(`Declared theme ${a.getTheme()}`,undefined,u);y(function(e){var t=e.themeRoots;var n=e.theme;var i=e.library;if(t&&t.forceUpdate){x(a.getTheme())}if(n){V(n)}if(i){O(i)}});s.attachChange(function(e){const t=e.rtl;if(t!==undefined){x(a.getTheme())}});L(e=>{p.attachEvent("applied",e)});r.set(F,{getAllLibraryInfoObjects:e=>{if(e){return v.get(e)}const t=new Map(v);t.delete(f);return t}});return F});
/*!
 * OpenUI5
 * (c) Copyright 2025 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.predefine("sap/ui/dom/includeStylesheet", ["sap/base/assert"],function(e){"use strict";function t(e,t,r,i){var n=function(){var n=document.createElement("link");n.rel="stylesheet";n.href=e;if(t&&typeof t==="object"){Object.keys(t).forEach(function(e){if(t[e]!=null){n.setAttribute(e,t[e])}})}function a(e){var t=e.type==="error";n.removeEventListener("load",a);n.removeEventListener("error",a);var o=t?i:r;if(typeof o==="function"){o()}}n.addEventListener("load",a);n.addEventListener("error",a);return n};var a=t&&t.id;var o=document.getElementById(a);var s=n();if(o&&o.tagName==="LINK"&&o.rel==="stylesheet"){if(typeof r==="function"||typeof i==="function"||o.href!==s.href){if(o.getAttribute("data-sap-ui-foucmarker")===a){o.removeAttribute("id");o.parentNode.insertBefore(s,o)}else{o.parentNode.replaceChild(s,o)}}else if(o.getAttribute("data-sap-ui-foucmarker")===a){o.removeAttribute("data-sap-ui-foucmarker")}}else{var u=document.getElementById("sap-ui-core-customcss");if(u){u.parentNode.insertBefore(s,u)}else{document.head.appendChild(s)}}}var r=function r(i,n,a,o){var s;if(typeof i==="string"){s=typeof n==="string"?{id:n}:n;t(i,s,a,o)}else{e(typeof i==="object"&&i.url,"vUrl must be an object and requires a URL");s=Object.assign({},i.attributes);if(i.id){s.id=i.id}return new Promise(function(e,r){t(i.url,s,e,r)})}};return r});
//# sourceMappingURL=Theming-preload.js.map
